<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<!--[if IE]><meta http-equiv="X-UA-Compatible" content="IE=edge"><![endif]-->
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 1.5.2">
<meta name="author" content="Alejandro Such Berengier">
<title>AngularJS</title>
<style>/*! normalize.css v2.1.2 | MIT License | git.io/normalize */
/* ========================================================================== HTML5 display definitions ========================================================================== */
/** Correct `block` display not defined in IE 8/9. */
article, aside, details, figcaption, figure, footer, header, hgroup, main, nav, section, summary { display: block; }

/** Correct `inline-block` display not defined in IE 8/9. */
audio, canvas, video { display: inline-block; }

/** Prevent modern browsers from displaying `audio` without controls. Remove excess height in iOS 5 devices. */
audio:not([controls]) { display: none; height: 0; }

/** Address `[hidden]` styling not present in IE 8/9. Hide the `template` element in IE, Safari, and Firefox < 22. */
[hidden], template { display: none; }

script { display: none !important; }

/* ========================================================================== Base ========================================================================== */
/** 1. Set default font family to sans-serif. 2. Prevent iOS text size adjust after orientation change, without disabling user zoom. */
html { font-family: sans-serif; /* 1 */ -ms-text-size-adjust: 100%; /* 2 */ -webkit-text-size-adjust: 100%; /* 2 */ }

/** Remove default margin. */
body { margin: 0; }

/* ========================================================================== Links ========================================================================== */
/** Remove the gray background color from active links in IE 10. */
a { background: transparent; }

/** Address `outline` inconsistency between Chrome and other browsers. */
a:focus { outline: thin dotted; }

/** Improve readability when focused and also mouse hovered in all browsers. */
a:active, a:hover { outline: 0; }

/* ========================================================================== Typography ========================================================================== */
/** Address variable `h1` font-size and margin within `section` and `article` contexts in Firefox 4+, Safari 5, and Chrome. */
h1 { font-size: 2em; margin: 0.67em 0; }

/** Address styling not present in IE 8/9, Safari 5, and Chrome. */
abbr[title] { border-bottom: 1px dotted; }

/** Address style set to `bolder` in Firefox 4+, Safari 5, and Chrome. */
b, strong { font-weight: bold; }

/** Address styling not present in Safari 5 and Chrome. */
dfn { font-style: italic; }

/** Address differences between Firefox and other browsers. */
hr { -moz-box-sizing: content-box; box-sizing: content-box; height: 0; }

/** Address styling not present in IE 8/9. */
mark { background: #ff0; color: #000; }

/** Correct font family set oddly in Safari 5 and Chrome. */
code, kbd, pre, samp { font-family: monospace, serif; font-size: 1em; }

/** Improve readability of pre-formatted text in all browsers. */
pre { white-space: pre-wrap; }

/** Set consistent quote types. */
q { quotes: "\201C" "\201D" "\2018" "\2019"; }

/** Address inconsistent and variable font size in all browsers. */
small { font-size: 80%; }

/** Prevent `sub` and `sup` affecting `line-height` in all browsers. */
sub, sup { font-size: 75%; line-height: 0; position: relative; vertical-align: baseline; }

sup { top: -0.5em; }

sub { bottom: -0.25em; }

/* ========================================================================== Embedded content ========================================================================== */
/** Remove border when inside `a` element in IE 8/9. */
img { border: 0; }

/** Correct overflow displayed oddly in IE 9. */
svg:not(:root) { overflow: hidden; }

/* ========================================================================== Figures ========================================================================== */
/** Address margin not present in IE 8/9 and Safari 5. */
figure { margin: 0; }

/* ========================================================================== Forms ========================================================================== */
/** Define consistent border, margin, and padding. */
fieldset { border: 1px solid #c0c0c0; margin: 0 2px; padding: 0.35em 0.625em 0.75em; }

/** 1. Correct `color` not being inherited in IE 8/9. 2. Remove padding so people aren't caught out if they zero out fieldsets. */
legend { border: 0; /* 1 */ padding: 0; /* 2 */ }

/** 1. Correct font family not being inherited in all browsers. 2. Correct font size not being inherited in all browsers. 3. Address margins set differently in Firefox 4+, Safari 5, and Chrome. */
button, input, select, textarea { font-family: inherit; /* 1 */ font-size: 100%; /* 2 */ margin: 0; /* 3 */ }

/** Address Firefox 4+ setting `line-height` on `input` using `!important` in the UA stylesheet. */
button, input { line-height: normal; }

/** Address inconsistent `text-transform` inheritance for `button` and `select`. All other form control elements do not inherit `text-transform` values. Correct `button` style inheritance in Chrome, Safari 5+, and IE 8+. Correct `select` style inheritance in Firefox 4+ and Opera. */
button, select { text-transform: none; }

/** 1. Avoid the WebKit bug in Android 4.0.* where (2) destroys native `audio` and `video` controls. 2. Correct inability to style clickable `input` types in iOS. 3. Improve usability and consistency of cursor style between image-type `input` and others. */
button, html input[type="button"], input[type="reset"], input[type="submit"] { -webkit-appearance: button; /* 2 */ cursor: pointer; /* 3 */ }

/** Re-set default cursor for disabled elements. */
button[disabled], html input[disabled] { cursor: default; }

/** 1. Address box sizing set to `content-box` in IE 8/9. 2. Remove excess padding in IE 8/9. */
input[type="checkbox"], input[type="radio"] { box-sizing: border-box; /* 1 */ padding: 0; /* 2 */ }

/** 1. Address `appearance` set to `searchfield` in Safari 5 and Chrome. 2. Address `box-sizing` set to `border-box` in Safari 5 and Chrome (include `-moz` to future-proof). */
input[type="search"] { -webkit-appearance: textfield; /* 1 */ -moz-box-sizing: content-box; -webkit-box-sizing: content-box; /* 2 */ box-sizing: content-box; }

/** Remove inner padding and search cancel button in Safari 5 and Chrome on OS X. */
input[type="search"]::-webkit-search-cancel-button, input[type="search"]::-webkit-search-decoration { -webkit-appearance: none; }

/** Remove inner padding and border in Firefox 4+. */
button::-moz-focus-inner, input::-moz-focus-inner { border: 0; padding: 0; }

/** 1. Remove default vertical scrollbar in IE 8/9. 2. Improve readability and alignment in all browsers. */
textarea { overflow: auto; /* 1 */ vertical-align: top; /* 2 */ }

/* ========================================================================== Tables ========================================================================== */
/** Remove most spacing between table cells. */
table { border-collapse: collapse; border-spacing: 0; }

meta.foundation-mq-small { font-family: "only screen and (min-width: 768px)"; width: 768px; }

meta.foundation-mq-medium { font-family: "only screen and (min-width:1280px)"; width: 1280px; }

meta.foundation-mq-large { font-family: "only screen and (min-width:1440px)"; width: 1440px; }

*, *:before, *:after { -moz-box-sizing: border-box; -webkit-box-sizing: border-box; box-sizing: border-box; }

html, body { font-size: 97%; }

body { background: white; color: #222222; padding: 0; margin: 0; font-family: "Helvetica Neue", "Helvetica", Helvetica, Arial, sans-serif; font-weight: normal; font-style: normal; line-height: 1; position: relative; cursor: auto; }

a:hover { cursor: pointer; }

img, object, embed { max-width: 100%; height: auto; }

object, embed { height: 100%; }

img { -ms-interpolation-mode: bicubic; }

#map_canvas img, #map_canvas embed, #map_canvas object, .map_canvas img, .map_canvas embed, .map_canvas object { max-width: none !important; }

.left { float: left !important; }

.right { float: right !important; }

.text-left { text-align: left !important; }

.text-right { text-align: right !important; }

.text-center { text-align: center !important; }

.text-justify { text-align: justify !important; }

.hide { display: none; }

.antialiased, body { -webkit-font-smoothing: antialiased; }

img { display: inline-block; vertical-align: middle; }

textarea { height: auto; min-height: 50px; }

select { width: 100%; }

p.lead, .paragraph.lead > p, #preamble > .sectionbody > .paragraph:first-of-type p { font-size: 1.21875em; line-height: 1.6; }

.subheader, .admonitionblock td.content > .title, .audioblock > .title, .exampleblock > .title, .imageblock > .title, .listingblock > .title, .literalblock > .title, .stemblock > .title, .openblock > .title, .paragraph > .title, .quoteblock > .title, table.tableblock > .title, .verseblock > .title, .videoblock > .title, .dlist > .title, .olist > .title, .ulist > .title, .qlist > .title, .hdlist > .title { line-height: 1.4; color: #6f6f6f; font-weight: 300; margin-top: 0.2em; margin-bottom: 0.5em; }

/* Typography resets */
div, dl, dt, dd, ul, ol, li, h1, h2, h3, #toctitle, .sidebarblock > .content > .title, h4, h5, h6, pre, form, p, blockquote, th, td { margin: 0; padding: 0; direction: ltr; }

/* Default Link Styles */
a { color: #1164be; text-decoration: none; line-height: inherit; }
a img { border: none; }

/* Default paragraph styles */
p { font-family: inherit; font-weight: normal; font-size: 1em; line-height: 1.4; margin-bottom: 1em; text-rendering: optimizeLegibility; }
p aside { font-size: 0.875em; line-height: 1.35; font-style: italic; }

/* Default header styles */
h1, h2, h3, #toctitle, .sidebarblock > .content > .title, h4, h5, h6 { font-family: "Helvetica Neue", "Helvetica", Helvetica, Arial, sans-serif; font-weight: bold; font-style: normal; color: #222222; text-rendering: optimizeLegibility; margin-top: 1em; margin-bottom: 0.5em; line-height: 1.2125em; }
h1 small, h2 small, h3 small, #toctitle small, .sidebarblock > .content > .title small, h4 small, h5 small, h6 small { font-size: 60%; color: #6f6f6f; line-height: 0; }

h1 { font-size: 2.125em; }

h2 { font-size: 1.6875em; }

h3, #toctitle, .sidebarblock > .content > .title { font-size: 1.375em; }

h4 { font-size: 1.125em; }

h5 { font-size: 1.125em; }

h6 { font-size: 1em; }

hr { border: solid #dddddd; border-width: 1px 0 0; clear: both; margin: 1.25em 0 1.1875em; height: 0; }

/* Helpful Typography Defaults */
em, i { font-style: italic; line-height: inherit; }

strong, b { font-weight: bold; line-height: inherit; }

small { font-size: 60%; line-height: inherit; }

code { font-family: Consolas, "Liberation Mono", Courier, monospace; font-weight: bold; }

/* Lists */
ul, ol, dl { font-size: 1em; line-height: 1.4; margin-bottom: 1.25em; list-style-position: outside; font-family: inherit; }

ul, ol { margin-left: 2.5em; }
ul.no-bullet, ol.no-bullet { margin-left: 1.5em; }

/* Unordered Lists */
ul li ul, ul li ol { margin-left: 1.25em; margin-bottom: 0; font-size: 1em; /* Override nested font-size change */ }
ul.square li ul, ul.circle li ul, ul.disc li ul { list-style: inherit; }
ul.square { list-style-type: square; }
ul.circle { list-style-type: circle; }
ul.disc { list-style-type: disc; }
ul.no-bullet { list-style: none; }

/* Ordered Lists */
ol li ul, ol li ol { margin-left: 1.25em; margin-bottom: 0; }

/* Definition Lists */
dl dt { margin-bottom: 0.3125em; font-weight: bold; }
dl dd { margin-bottom: 1.25em; }

/* Abbreviations */
abbr, acronym { text-transform: uppercase; font-size: 90%; color: #222222; border-bottom: 1px dotted #dddddd; cursor: help; }

abbr { text-transform: none; }

/* Blockquotes */
blockquote { margin: 0 0 1.25em; padding: 0.5625em 1.25em 0 1.1875em; border-left: 1px solid #dddddd; }
blockquote cite { display: block; font-size: 0.8125em; color: #555555; }
blockquote cite:before { content: "\2014 \0020"; }
blockquote cite a, blockquote cite a:visited { color: #555555; }

blockquote, blockquote p { line-height: 1.6; color: #6f6f6f; }

/* Microformats */
.vcard { display: inline-block; margin: 0 0 1.25em 0; border: 1px solid #dddddd; padding: 0.625em 0.75em; }
.vcard li { margin: 0; display: block; }
.vcard .fn { font-weight: bold; font-size: 0.9375em; }

.vevent .summary { font-weight: bold; }
.vevent abbr { cursor: auto; text-decoration: none; font-weight: bold; border: none; padding: 0 0.0625em; }

@media only screen and (min-width: 768px) { h1, h2, h3, #toctitle, .sidebarblock > .content > .title, h4, h5, h6 { line-height: 1.4; }
  h1 { font-size: 2.75em; }
  h2 { font-size: 2.3125em; }
  h3, #toctitle, .sidebarblock > .content > .title { font-size: 1.6875em; }
  h4 { font-size: 1.4375em; } }
/* Tables */
table { background: white; margin-bottom: 1.25em; border: solid 1px #dddddd; }
table thead, table tfoot { background: whitesmoke; font-weight: bold; }
table thead tr th, table thead tr td, table tfoot tr th, table tfoot tr td { padding: 0.5em 0.625em 0.625em; font-size: inherit; color: #222222; text-align: left; }
table tr th, table tr td { padding: 0.5625em 0.625em; font-size: inherit; color: #222222; }
table tr.even, table tr.alt, table tr:nth-of-type(even) { background: #f9f9f9; }
table thead tr th, table tfoot tr th, table tbody tr td, table tr td, table tfoot tr td { display: table-cell; line-height: 1.4; }

h1, h2, h3, #toctitle, .sidebarblock > .content > .title, h4, h5, h6 { line-height: 1.4; border-bottom: 1px solid #dddddd }

.clearfix:before, .clearfix:after, .float-group:before, .float-group:after { content: " "; display: table; }
.clearfix:after, .float-group:after { clear: both; }

*:not(pre) > code { font-size: inherit; font-style: normal !important; letter-spacing: 0; padding: 3px 2px 1px 2px; background-color: #eeeeee; border: 1px solid #dddddd; -webkit-border-radius: 0; border-radius: 0; line-height: inherit; font-weight: normal; }

pre, pre > code { line-height: 1.4; color: black; font-family: monospace, serif; font-weight: normal; }

.keyseq { color: #555555; }

kbd { display: inline-block; color: #222222; font-size: 0.75em; line-height: 1.4; background-color: #f7f7f7; border: 1px solid #ccc; -webkit-border-radius: 3px; border-radius: 3px; -webkit-box-shadow: 0 1px 0 rgba(0, 0, 0, 0.2), 0 0 0 0.1em white inset; box-shadow: 0 1px 0 rgba(0, 0, 0, 0.2), 0 0 0 0.1em white inset; margin: -0.15em 0.15em 0 0.15em; padding: 0.2em 0.6em 0.2em 0.5em; vertical-align: middle; white-space: nowrap; }

.keyseq kbd:first-child { margin-left: 0; }

.keyseq kbd:last-child { margin-right: 0; }

.menuseq, .menu { color: #090909; }

b.button:before, b.button:after { position: relative; top: -1px; font-weight: normal; }

b.button:before { content: "["; padding: 0 3px 0 2px; }

b.button:after { content: "]"; padding: 0 2px 0 3px; }

#header, #content, #footnotes, #footer { width: 100%; margin-left: auto; margin-right: auto; margin-top: 0; margin-bottom: 0; max-width: 62.5em; *zoom: 1; position: relative; padding-left: 0.9375em; padding-right: 0.9375em; }
#header:before, #header:after, #content:before, #content:after, #footnotes:before, #footnotes:after, #footer:before, #footer:after { content: " "; display: table; }
#header:after, #content:after, #footnotes:after, #footer:after { clear: both; }

#content { margin-top: 1.25em; }

#content:before { content: none; }

#header > h1:first-child { color: black; margin-top: 2.25rem; margin-bottom: 0; }
#header > h1:first-child + #toc { margin-top: 8px; border-top: 1px solid #dddddd; }
#header > h1:only-child, body.toc2 #header > h1:nth-last-child(2) { border-bottom: 1px solid #dddddd; padding-bottom: 8px; }
#header .details { border-bottom: 1px solid #dddddd; line-height: 1.45; padding-top: 0.25em; padding-bottom: 0.25em; padding-left: 0.25em; color: #555555; display: -ms-flexbox; display: -webkit-flex; display: flex; -ms-flex-flow: row wrap; -webkit-flex-flow: row wrap; flex-flow: row wrap; }
#header .details span:first-child { margin-left: -0.125em; }
#header .details span.email a { color: #6f6f6f; }
#header .details br { display: none; }
#header .details br + span:before { content: "\00a0\2013\00a0"; }
#header .details br + span.author:before { content: "\00a0\22c5\00a0"; color: #6f6f6f; }
#header .details br + span#revremark:before { content: "\00a0|\00a0"; }
#header #revnumber { text-transform: capitalize; }
#header #revnumber:after { content: "\00a0"; }

#content > h1:first-child:not([class]) { color: black; border-bottom: 1px solid #dddddd; padding-bottom: 8px; margin-top: 0; padding-top: 1rem; margin-bottom: 1.25rem; }

#floating {
  position: fixed;
  z-index: 1000;
  padding: 0.5em;
  right: 0;
  top: 0;
  background: white;
  box-shadow: 0 0 1em #777777;
  -webkit-box-shadow: 0 0 1em #777777;
  -moz-box-shadow: 0 0 1em #777777;
  -webkit-border-bottom-left-radius: 5px;
  -moz-border-radius-bottomleft: 5px;
  max-height: 80%;
  overflow: auto;
}

#floating #full { display: none; } /* Hide the full TOC by default */

#floating:hover #full{
  display: block; /* Show it on hover */
}


#toc { border-bottom: 1px solid #dddddd; padding-bottom: 0.5em; }
#toc > ul { margin-left: 0.125em; }
#toc ul.sectlevel0 > li > a { font-style: italic; }
#toc ul.sectlevel0 ul.sectlevel1 { margin: 0.5em 0; }
#toc ul { font-family: "Helvetica Neue", "Helvetica", Helvetica, Arial, sans-serif; list-style-type: none; }
#toc a { text-decoration: none; }
#toc a:active { text-decoration: underline; }

#toctitle { color: #6f6f6f; font-size: 1.2em; }

@media only screen and (min-width: 768px) { #toctitle { font-size: 1.375em; }
  body.toc2 { padding-left: 15em; padding-right: 0; }
  #toc.toc2 { margin-top: 0 !important; background-color: #f2f2f2; position: fixed; width: 15em; left: 0; top: 0; border-right: 1px solid #dddddd; border-top-width: 0 !important; border-bottom-width: 0 !important; z-index: 1000; padding: 1.25em 1em; height: 100%; overflow: auto; }
  #toc.toc2 #toctitle { margin-top: 0; font-size: 1.2em; }
  #toc.toc2 > ul { font-size: 0.9em; margin-bottom: 0; }
  #toc.toc2 ul ul { margin-left: 0; padding-left: 1em; }
  #toc.toc2 ul.sectlevel0 ul.sectlevel1 { padding-left: 0; margin-top: 0.5em; margin-bottom: 0.5em; }
  body.toc2.toc-right { padding-left: 0; padding-right: 15em; }
  body.toc2.toc-right #toc.toc2 { border-right-width: 0; border-left: 1px solid #dddddd; left: auto; right: 0; } }
@media only screen and (min-width: 1280px) { body.toc2 { padding-left: 20em; padding-right: 0; }
  #toc.toc2 { width: 20em; }
  #toc.toc2 #toctitle { font-size: 1.375em; }
  #toc.toc2 > ul { font-size: 0.95em; }
  #toc.toc2 ul ul { padding-left: 1.25em; }
  body.toc2.toc-right { padding-left: 0; padding-right: 20em; } }
#content #toc { border-style: solid; border-width: 1px; border-color: #d9d9d9; margin-bottom: 1.25em; padding: 1.25em; background: #f2f2f2; -webkit-border-radius: 0; border-radius: 0; }
#content #toc > :first-child { margin-top: 0; }
#content #toc > :last-child { margin-bottom: 0; }

#footer { max-width: 100%; background-color: #222222; padding: 1.25em; }

#footer-text { color: #dddddd; line-height: 1.44; }

.sect1 { padding-bottom: 0.625em; }

@media only screen and (min-width: 768px) { .sect1 { padding-bottom: 1.25em; } }
.sect1 + .sect1 { border-top: 1px solid #dddddd; }

#content h1 > a.anchor, h2 > a.anchor, h3 > a.anchor, #toctitle > a.anchor, .sidebarblock > .content > .title > a.anchor, h4 > a.anchor, h5 > a.anchor, h6 > a.anchor { position: absolute; z-index: 1001; width: 1.5ex; margin-left: -1.5ex; display: block; text-decoration: none !important; visibility: hidden; text-align: center; font-weight: normal; }
#content h1 > a.anchor:before, h2 > a.anchor:before, h3 > a.anchor:before, #toctitle > a.anchor:before, .sidebarblock > .content > .title > a.anchor:before, h4 > a.anchor:before, h5 > a.anchor:before, h6 > a.anchor:before { content: "\00A7"; font-size: 0.85em; display: block; padding-top: 0.1em; }
#content h1:hover > a.anchor, #content h1 > a.anchor:hover, h2:hover > a.anchor, h2 > a.anchor:hover, h3:hover > a.anchor, #toctitle:hover > a.anchor, .sidebarblock > .content > .title:hover > a.anchor, h3 > a.anchor:hover, #toctitle > a.anchor:hover, .sidebarblock > .content > .title > a.anchor:hover, h4:hover > a.anchor, h4 > a.anchor:hover, h5:hover > a.anchor, h5 > a.anchor:hover, h6:hover > a.anchor, h6 > a.anchor:hover { visibility: visible; }
#content h1 > a.link, h2 > a.link, h3 > a.link, #toctitle > a.link, .sidebarblock > .content > .title > a.link, h4 > a.link, h5 > a.link, h6 > a.link { color: #222222; text-decoration: none; }
#content h1 > a.link:hover, h2 > a.link:hover, h3 > a.link:hover, #toctitle > a.link:hover, .sidebarblock > .content > .title > a.link:hover, h4 > a.link:hover, h5 > a.link:hover, h6 > a.link:hover { color: #151515; }

.audioblock, .imageblock, .literalblock, .listingblock, .stemblock, .videoblock { margin-bottom: 1.25em; }

.admonitionblock td.content > .title, .audioblock > .title, .exampleblock > .title, .imageblock > .title, .listingblock > .title, .literalblock > .title, .stemblock > .title, .openblock > .title, .paragraph > .title, .quoteblock > .title, table.tableblock > .title, .verseblock > .title, .videoblock > .title, .dlist > .title, .olist > .title, .ulist > .title, .qlist > .title, .hdlist > .title { text-rendering: optimizeLegibility; text-align: left; }

table.tableblock > caption.title { white-space: nowrap; overflow: visible; max-width: 0; }

.paragraph.lead > p, #preamble > .sectionbody > .paragraph:first-of-type p { color: black; }

table.tableblock #preamble > .sectionbody > .paragraph:first-of-type p { font-size: inherit; }

.admonitionblock > table { border-collapse: separate; border: 0; background: none; width: 100%; }
.admonitionblock > table td.icon { text-align: center; width: 80px; }
.admonitionblock > table td.icon img { max-width: none; }
.admonitionblock > table td.icon .title { font-weight: bold; font-family: "Helvetica Neue", "Helvetica", Helvetica, Arial, sans-serif; text-transform: uppercase; }
.admonitionblock > table td.content { padding-left: 1.125em; padding-right: 1.25em; border-left: 1px solid #dddddd; color: #555555; }
.admonitionblock > table td.content > :last-child > :last-child { margin-bottom: 0; }

.exampleblock > .content { border-style: solid; border-width: 1px; border-color: #e6e6e6; margin-bottom: 1.25em; padding: 1.25em; background: white; -webkit-border-radius: 0; border-radius: 0; }
.exampleblock > .content > :first-child { margin-top: 0; }
.exampleblock > .content > :last-child { margin-bottom: 0; }

.sidebarblock { border-style: solid; border-width: 1px; border-color: #d9d9d9; margin-bottom: 1.25em; padding: 1.25em; background: #f2f2f2; -webkit-border-radius: 0; border-radius: 0; }
.sidebarblock > :first-child { margin-top: 0; }
.sidebarblock > :last-child { margin-bottom: 0; }
.sidebarblock > .content > .title { color: #6f6f6f; margin-top: 0; }

.exampleblock > .content > :last-child > :last-child, .exampleblock > .content .olist > ol > li:last-child > :last-child, .exampleblock > .content .ulist > ul > li:last-child > :last-child, .exampleblock > .content .qlist > ol > li:last-child > :last-child, .sidebarblock > .content > :last-child > :last-child, .sidebarblock > .content .olist > ol > li:last-child > :last-child, .sidebarblock > .content .ulist > ul > li:last-child > :last-child, .sidebarblock > .content .qlist > ol > li:last-child > :last-child { margin-bottom: 0; }

.literalblock pre, .listingblock pre:not(.highlight), .listingblock pre[class="highlight"], .listingblock pre[class^="highlight "], .listingblock pre.CodeRay, .listingblock pre.prettyprint { background: #eeeeee; }
.sidebarblock .literalblock pre, .sidebarblock .listingblock pre:not(.highlight), .sidebarblock .listingblock pre[class="highlight"], .sidebarblock .listingblock pre[class^="highlight "], .sidebarblock .listingblock pre.CodeRay, .sidebarblock .listingblock pre.prettyprint { background: #f2f1f1; }

.literalblock pre, .literalblock pre[class], .listingblock pre, .listingblock pre[class] { border: 1px solid #cccccc; -webkit-border-radius: 0; border-radius: 0; word-wrap: break-word; padding: 0.8em 0.8em 0.65em 0.8em; font-size: 0.8125em; }
.literalblock pre.nowrap, .literalblock pre[class].nowrap, .listingblock pre.nowrap, .listingblock pre[class].nowrap { overflow-x: auto; white-space: pre; word-wrap: normal; }
@media only screen and (min-width: 768px) { .literalblock pre, .literalblock pre[class], .listingblock pre, .listingblock pre[class] { font-size: 0.90625em; } }
@media only screen and (min-width: 1280px) { .literalblock pre, .literalblock pre[class], .listingblock pre, .listingblock pre[class] { font-size: 1em; } }

.literalblock.output pre { color: #eeeeee; background-color: black; }

.listingblock pre.highlightjs { padding: 0; }
.listingblock pre.highlightjs > code { padding: 0.8em 0.8em 0.65em 0.8em; -webkit-border-radius: 0; border-radius: 0; }

.listingblock > .content { position: relative; }

.listingblock code[data-lang]:before { display: none; content: attr(data-lang); position: absolute; font-size: 0.75em; top: 0.425rem; right: 0.5rem; line-height: 1; text-transform: uppercase; color: #999; }

.listingblock:hover code[data-lang]:before { display: block; }

.listingblock.terminal pre .command:before { content: attr(data-prompt); padding-right: 0.5em; color: #999; }

.listingblock.terminal pre .command:not([data-prompt]):before { content: "$"; }

table.pyhltable { border-collapse: separate; border: 0; margin-bottom: 0; background: none; }

table.pyhltable td { vertical-align: top; padding-top: 0; padding-bottom: 0; }

table.pyhltable td.code { padding-left: .75em; padding-right: 0; }

pre.pygments .lineno, table.pyhltable td:not(.code) { color: #999; padding-left: 0; padding-right: .5em; border-right: 1px solid #dddddd; }

pre.pygments .lineno { display: inline-block; margin-right: .25em; }

table.pyhltable .linenodiv { background: none !important; padding-right: 0 !important; }

.quoteblock { margin: 0 1em 1.25em 1.5em; display: table; }
.quoteblock > .title { margin-left: -1.5em; margin-bottom: 0.75em; }
.quoteblock blockquote, .quoteblock blockquote p { color: #6f6f6f; font-size: 1.15rem; line-height: 1.75; word-spacing: 0.1em; letter-spacing: 0; font-style: italic; text-align: justify; }
.quoteblock blockquote { margin: 0; padding: 0; border: 0; }
.quoteblock blockquote:before { content: "\201c"; float: left; font-size: 2.75em; font-weight: bold; line-height: 0.6em; margin-left: -0.6em; color: #6f6f6f; text-shadow: 0 1px 2px rgba(0, 0, 0, 0.1); }
.quoteblock blockquote > .paragraph:last-child p { margin-bottom: 0; }
.quoteblock .attribution { margin-top: 0.5em; margin-right: 0.5ex; text-align: right; }
.quoteblock .quoteblock { margin-left: 0; margin-right: 0; padding: 0.5em 0; border-left: 3px solid #555555; }
.quoteblock .quoteblock blockquote { padding: 0 0 0 0.75em; }
.quoteblock .quoteblock blockquote:before { display: none; }

.verseblock { margin: 0 1em 1.25em 1em; }
.verseblock pre { font-family: "Open Sans", "DejaVu Sans", sans; font-size: 1.15rem; color: #6f6f6f; font-weight: 300; text-rendering: optimizeLegibility; }
.verseblock pre strong { font-weight: 400; }
.verseblock .attribution { margin-top: 1.25rem; margin-left: 0.5ex; }

.quoteblock .attribution, .verseblock .attribution { font-size: 0.8125em; line-height: 1.45; font-style: italic; }
.quoteblock .attribution br, .verseblock .attribution br { display: none; }
.quoteblock .attribution cite, .verseblock .attribution cite { display: block; letter-spacing: -0.05em; color: #555555; }

.quoteblock.abstract { margin: 0 0 1.25em 0; display: block; }
.quoteblock.abstract blockquote, .quoteblock.abstract blockquote p { text-align: left; word-spacing: 0; }
.quoteblock.abstract blockquote:before, .quoteblock.abstract blockquote p:first-of-type:before { display: none; }

table.tableblock { max-width: 100%; border-collapse: separate; }
table.tableblock td > .paragraph:last-child p > p:last-child, table.tableblock th > p:last-child, table.tableblock td > p:last-child { margin-bottom: 0; }

table.spread { width: 100%; }

table.tableblock, th.tableblock, td.tableblock { border: 0 solid #dddddd; }

table.grid-all th.tableblock, table.grid-all td.tableblock { border-width: 0 1px 1px 0; }

table.grid-all tfoot > tr > th.tableblock, table.grid-all tfoot > tr > td.tableblock { border-width: 1px 1px 0 0; }

table.grid-cols th.tableblock, table.grid-cols td.tableblock { border-width: 0 1px 0 0; }

table.grid-all * > tr > .tableblock:last-child, table.grid-cols * > tr > .tableblock:last-child { border-right-width: 0; }

table.grid-rows th.tableblock, table.grid-rows td.tableblock { border-width: 0 0 1px 0; }

table.grid-all tbody > tr:last-child > th.tableblock, table.grid-all tbody > tr:last-child > td.tableblock, table.grid-all thead:last-child > tr > th.tableblock, table.grid-rows tbody > tr:last-child > th.tableblock, table.grid-rows tbody > tr:last-child > td.tableblock, table.grid-rows thead:last-child > tr > th.tableblock { border-bottom-width: 0; }

table.grid-rows tfoot > tr > th.tableblock, table.grid-rows tfoot > tr > td.tableblock { border-width: 1px 0 0 0; }

table.frame-all { border-width: 1px; }

table.frame-sides { border-width: 0 1px; }

table.frame-topbot { border-width: 1px 0; }

th.halign-left, td.halign-left { text-align: left; }

th.halign-right, td.halign-right { text-align: right; }

th.halign-center, td.halign-center { text-align: center; }

th.valign-top, td.valign-top { vertical-align: top; }

th.valign-bottom, td.valign-bottom { vertical-align: bottom; }

th.valign-middle, td.valign-middle { vertical-align: middle; }

table thead th, table tfoot th { font-weight: bold; }

tbody tr th { display: table-cell; line-height: 1.4; background: whitesmoke; }

tbody tr th, tbody tr th p, tfoot tr th, tfoot tr th p { color: #222222; font-weight: bold; }

p.tableblock > code:only-child { background: none; padding: 0; }

p.tableblock { font-size: 1em; }

td > div.verse { white-space: pre; }

ol { margin-left: 2.5em; }

ul li ol { margin-left: 1.5em; }

dl dd { margin-left: 1.125em; }

dl dd:last-child, dl dd:last-child > :last-child { margin-bottom: 0; }

ol > li p, ul > li p, ul dd, ol dd, .olist .olist, .ulist .ulist, .ulist .olist, .olist .ulist { margin-bottom: 0.625em; }

ul.unstyled, ol.unnumbered, ul.checklist, ul.none { list-style-type: none; }

ul.unstyled, ol.unnumbered, ul.checklist { margin-left: 0.625em; }

ul.checklist li > p:first-child > .fa-check-square-o:first-child, ul.checklist li > p:first-child > input[type="checkbox"]:first-child { margin-right: 0.25em; }

ul.checklist li > p:first-child > input[type="checkbox"]:first-child { position: relative; top: 1px; }

ul.inline { margin: 0 auto 0.625em auto; margin-left: -1.375em; margin-right: 0; padding: 0; list-style: none; overflow: hidden; }
ul.inline > li { list-style: none; float: left; margin-left: 1.375em; display: block; }
ul.inline > li > * { display: block; }

.unstyled dl dt { font-weight: normal; font-style: normal; }

ol.arabic { list-style-type: decimal; }

ol.decimal { list-style-type: decimal-leading-zero; }

ol.loweralpha { list-style-type: lower-alpha; }

ol.upperalpha { list-style-type: upper-alpha; }

ol.lowerroman { list-style-type: lower-roman; }

ol.upperroman { list-style-type: upper-roman; }

ol.lowergreek { list-style-type: lower-greek; }

.hdlist > table, .colist > table { border: 0; background: none; }
.hdlist > table > tbody > tr, .colist > table > tbody > tr { background: none; }

td.hdlist1 { padding-right: .75em; font-weight: bold; }

td.hdlist1, td.hdlist2 { vertical-align: top; }

.literalblock + .colist, .listingblock + .colist { margin-top: -0.5em; }

.colist > table tr > td:first-of-type { padding: 0 0.75em; line-height: 1; }
.colist > table tr > td:last-of-type { padding: 0.25em 0; }

.thumb, .th { line-height: 0; display: inline-block; border: solid 4px white; -webkit-box-shadow: 0 0 0 1px #dddddd; box-shadow: 0 0 0 1px #dddddd; }

.imageblock.left, .imageblock[style*="float: left"] { margin: 0.25em 0.625em 1.25em 0; }
.imageblock.right, .imageblock[style*="float: right"] { margin: 0.25em 0 1.25em 0.625em; }
.imageblock > .title { margin-bottom: 0; }
.imageblock.thumb, .imageblock.th { border-width: 6px; }
.imageblock.thumb > .title, .imageblock.th > .title { padding: 0 0.125em; }

.image.left, .image.right { margin-top: 0.25em; margin-bottom: 0.25em; display: inline-block; line-height: 0; }
.image.left { margin-right: 0.625em; }
.image.right { margin-left: 0.625em; }

a.image { text-decoration: none; }

span.footnote, span.footnoteref { vertical-align: super; font-size: 0.875em; }
span.footnote a, span.footnoteref a { text-decoration: none; }
span.footnote a:active, span.footnoteref a:active { text-decoration: underline; }

#footnotes { padding-top: 0.75em; padding-bottom: 0.75em; margin-bottom: 0.625em; }
#footnotes hr { width: 20%; min-width: 6.25em; margin: -.25em 0 .75em 0; border-width: 1px 0 0 0; }
#footnotes .footnote { padding: 0 0.375em; line-height: 1.3; font-size: 0.875em; margin-left: 1.2em; text-indent: -1.2em; margin-bottom: .2em; }
#footnotes .footnote a:first-of-type { font-weight: bold; text-decoration: none; }
#footnotes .footnote:last-of-type { margin-bottom: 0; }

#content #footnotes { margin-top: -0.625em; margin-bottom: 0; padding: 0.75em 0; }

.gist .file-data > table { border: 0; background: #fff; width: 100%; margin-bottom: 0; }
.gist .file-data > table td.line-data { width: 99%; }

div.unbreakable { page-break-inside: avoid; }

.big { font-size: larger; }

.small { font-size: smaller; }

.underline { text-decoration: underline; }

.overline { text-decoration: overline; }

.line-through { text-decoration: line-through; }

.aqua { color: #00bfbf; }

.aqua-background { background-color: #00fafa; }

.black { color: black; }

.black-background { background-color: black; }

.blue { color: #0000bf; }

.blue-background { background-color: #0000fa; }

.fuchsia { color: #bf00bf; }

.fuchsia-background { background-color: #fa00fa; }

.gray { color: #606060; }

.gray-background { background-color: #7d7d7d; }

.green { color: #006000; }

.green-background { background-color: #007d00; }

.lime { color: #00bf00; }

.lime-background { background-color: #00fa00; }

.maroon { color: #600000; }

.maroon-background { background-color: #7d0000; }

.navy { color: #000060; }

.navy-background { background-color: #00007d; }

.olive { color: #606000; }

.olive-background { background-color: #7d7d00; }

.purple { color: #600060; }

.purple-background { background-color: #7d007d; }

.red { color: #bf0000; }

.red-background { background-color: #fa0000; }

.silver { color: #909090; }

.silver-background { background-color: #bcbcbc; }

.teal { color: #006060; }

.teal-background { background-color: #007d7d; }

.white { color: #bfbfbf; }

.white-background { background-color: #fafafa; }

.yellow { color: #bfbf00; }

.yellow-background { background-color: #fafa00; }

span.icon > .fa { cursor: default; }

.admonitionblock td.icon [class^="fa icon-"] { font-size: 2.5em; text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.5); cursor: default; }
.admonitionblock td.icon .icon-note:before { content: "\f05a"; color: #207c98; }
.admonitionblock td.icon .icon-tip:before { content: "\f0eb"; text-shadow: 1px 1px 2px rgba(155, 155, 0, 0.8); color: #111; }
.admonitionblock td.icon .icon-warning:before { content: "\f071"; color: #bf6900; }
.admonitionblock td.icon .icon-caution:before { content: "\f06d"; color: #bf3400; }
.admonitionblock td.icon .icon-important:before { content: "\f06a"; color: #bf0000; }

.conum[data-value] { display: inline-block; color: #fff !important; background-color: #222222; -webkit-border-radius: 100px; border-radius: 100px; text-align: center; font-size: 0.75em; width: 1.67em; height: 1.67em; line-height: 1.67em; font-family: "Open Sans", "DejaVu Sans", sans-serif; font-style: normal; font-weight: bold; }
.conum[data-value] * { color: #fff !important; }
.conum[data-value] + b { display: none; }
.conum[data-value]:after { content: attr(data-value); }
pre .conum[data-value] { position: relative; top: -0.125em; }

b.conum * { color: inherit !important; }

.conum:not([data-value]):empty { display: none; }

.literalblock pre, .listingblock pre { background: #eeeeee; }

</style>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.2.0/css/font-awesome.min.css">
<style>.listingblock .pygments .hll { background-color: #ffffcc }
.listingblock .pygments  { background: #f8f8f8; }
.listingblock .pygments .tok-c { color: #408080; font-style: italic } /* Comment */
.listingblock .pygments .tok-err { border: 1px solid #FF0000 } /* Error */
.listingblock .pygments .tok-k { color: #008000; font-weight: bold } /* Keyword */
.listingblock .pygments .tok-o { color: #666666 } /* Operator */
.listingblock .pygments .tok-cm { color: #408080; font-style: italic } /* Comment.Multiline */
.listingblock .pygments .tok-cp { color: #BC7A00 } /* Comment.Preproc */
.listingblock .pygments .tok-c1 { color: #408080; font-style: italic } /* Comment.Single */
.listingblock .pygments .tok-cs { color: #408080; font-style: italic } /* Comment.Special */
.listingblock .pygments .tok-gd { color: #A00000 } /* Generic.Deleted */
.listingblock .pygments .tok-ge { font-style: italic } /* Generic.Emph */
.listingblock .pygments .tok-gr { color: #FF0000 } /* Generic.Error */
.listingblock .pygments .tok-gh { color: #000080; font-weight: bold } /* Generic.Heading */
.listingblock .pygments .tok-gi { color: #00A000 } /* Generic.Inserted */
.listingblock .pygments .tok-go { color: #888888 } /* Generic.Output */
.listingblock .pygments .tok-gp { color: #000080; font-weight: bold } /* Generic.Prompt */
.listingblock .pygments .tok-gs { font-weight: bold } /* Generic.Strong */
.listingblock .pygments .tok-gu { color: #800080; font-weight: bold } /* Generic.Subheading */
.listingblock .pygments .tok-gt { color: #0044DD } /* Generic.Traceback */
.listingblock .pygments .tok-kc { color: #008000; font-weight: bold } /* Keyword.Constant */
.listingblock .pygments .tok-kd { color: #008000; font-weight: bold } /* Keyword.Declaration */
.listingblock .pygments .tok-kn { color: #008000; font-weight: bold } /* Keyword.Namespace */
.listingblock .pygments .tok-kp { color: #008000 } /* Keyword.Pseudo */
.listingblock .pygments .tok-kr { color: #008000; font-weight: bold } /* Keyword.Reserved */
.listingblock .pygments .tok-kt { color: #B00040 } /* Keyword.Type */
.listingblock .pygments .tok-m { color: #666666 } /* Literal.Number */
.listingblock .pygments .tok-s { color: #BA2121 } /* Literal.String */
.listingblock .pygments .tok-na { color: #7D9029 } /* Name.Attribute */
.listingblock .pygments .tok-nb { color: #008000 } /* Name.Builtin */
.listingblock .pygments .tok-nc { color: #0000FF; font-weight: bold } /* Name.Class */
.listingblock .pygments .tok-no { color: #880000 } /* Name.Constant */
.listingblock .pygments .tok-nd { color: #AA22FF } /* Name.Decorator */
.listingblock .pygments .tok-ni { color: #999999; font-weight: bold } /* Name.Entity */
.listingblock .pygments .tok-ne { color: #D2413A; font-weight: bold } /* Name.Exception */
.listingblock .pygments .tok-nf { color: #0000FF } /* Name.Function */
.listingblock .pygments .tok-nl { color: #A0A000 } /* Name.Label */
.listingblock .pygments .tok-nn { color: #0000FF; font-weight: bold } /* Name.Namespace */
.listingblock .pygments .tok-nt { color: #008000; font-weight: bold } /* Name.Tag */
.listingblock .pygments .tok-nv { color: #19177C } /* Name.Variable */
.listingblock .pygments .tok-ow { color: #AA22FF; font-weight: bold } /* Operator.Word */
.listingblock .pygments .tok-w { color: #bbbbbb } /* Text.Whitespace */
.listingblock .pygments .tok-mb { color: #666666 } /* Literal.Number.Bin */
.listingblock .pygments .tok-mf { color: #666666 } /* Literal.Number.Float */
.listingblock .pygments .tok-mh { color: #666666 } /* Literal.Number.Hex */
.listingblock .pygments .tok-mi { color: #666666 } /* Literal.Number.Integer */
.listingblock .pygments .tok-mo { color: #666666 } /* Literal.Number.Oct */
.listingblock .pygments .tok-sb { color: #BA2121 } /* Literal.String.Backtick */
.listingblock .pygments .tok-sc { color: #BA2121 } /* Literal.String.Char */
.listingblock .pygments .tok-sd { color: #BA2121; font-style: italic } /* Literal.String.Doc */
.listingblock .pygments .tok-s2 { color: #BA2121 } /* Literal.String.Double */
.listingblock .pygments .tok-se { color: #BB6622; font-weight: bold } /* Literal.String.Escape */
.listingblock .pygments .tok-sh { color: #BA2121 } /* Literal.String.Heredoc */
.listingblock .pygments .tok-si { color: #BB6688; font-weight: bold } /* Literal.String.Interpol */
.listingblock .pygments .tok-sx { color: #008000 } /* Literal.String.Other */
.listingblock .pygments .tok-sr { color: #BB6688 } /* Literal.String.Regex */
.listingblock .pygments .tok-s1 { color: #BA2121 } /* Literal.String.Single */
.listingblock .pygments .tok-ss { color: #19177C } /* Literal.String.Symbol */
.listingblock .pygments .tok-bp { color: #008000 } /* Name.Builtin.Pseudo */
.listingblock .pygments .tok-vc { color: #19177C } /* Name.Variable.Class */
.listingblock .pygments .tok-vg { color: #19177C } /* Name.Variable.Global */
.listingblock .pygments .tok-vi { color: #19177C } /* Name.Variable.Instance */
.listingblock .pygments .tok-il { color: #666666 } /* Literal.Number.Integer.Long */
</style>
</head>
<body class="article toc2 toc-left">
<div id="header">
<h1>AngularJS</h1>
<div class="details">
<span id="author" class="author">Alejandro Such Berengier</span><br>
<span id="email" class="email">&lt;<a href="mailto:alejandro.such@gmail.com">alejandro.such@gmail.com</a>&gt;</span><br>
</div>
<div id="toc" class="toc2">
<div id="toctitle">Índice de contenidos</div>
<ul class="sectlevel1">
<li><a href="#sesion01">1. AngularJS</a>
<ul class="sectlevel2">
<li><a href="#__qu%C3%A9_es_angularjs">1.1. ¿Qué es AngularJS?</a></li>
<li><a href="#_volviendo_a_angularjs">1.2. Volviendo a AngularJS&#8230;&#8203;</a></li>
<li><a href="#_principales_caracter%C3%ADsticas_de_angularjs">1.3. Principales características de AngularJS</a></li>
<li><a href="#_ventajas_e_inconvenientes_de_angularjs">1.4. Ventajas e inconvenientes de AngularJS</a></li>
<li><a href="#_recursos_online">1.5. Recursos online</a></li>
</ul>
</li>
<li><a href="#sesion02">2. Una tarde con AngularJS</a>
<ul class="sectlevel2">
<li><a href="#_creando_la_aplicaci%C3%B3n">2.1. Creando la aplicación</a></li>
<li><a href="#_directivas_data_binding">2.2. Directivas, data binding</a></li>
<li><a href="#_declarando_colecciones_e_iterando_sobre_ellas">2.3. Declarando colecciones e iterando sobre ellas</a></li>
<li><a href="#_filtros">2.4. Filtros</a></li>
<li><a href="#_vistas_controladores_y_scope">2.5. Vistas, controladores y scope</a></li>
<li><a href="#_m%C3%B3dulos_rutas_y_factor%C3%ADas">2.6. Módulos, Rutas y Factorías</a></li>
<li><a href="#_usando_factor%C3%ADas_y_servicios">2.7. Usando factorías y servicios</a></li>
<li><a href="#_ejercicio_1_punto">2.8. Ejercicio (1 punto)</a></li>
</ul>
</li>
<li><a href="#sesion03">3. Scopes</a>
<ul class="sectlevel2">
<li><a href="#_hola_mundo_otra_vez">3.1. Hola mundo (otra vez)</a></li>
<li><a href="#_el_objeto_scope">3.2. El objeto Scope</a></li>
<li><a href="#_ejercicios">3.3. Ejercicios</a></li>
</ul>
</li>
<li><a href="#sesion04">4. Módulos y servicios</a>
<ul class="sectlevel2">
<li><a href="#_hola_mundo_y_van_tres">4.1. Hola Mundo (y van tres)</a></li>
<li><a href="#_module">4.2. Module</a></li>
<li><a href="#_servicios">4.3. Servicios</a></li>
<li><a href="#_objetos_de_prop%C3%B3sito_especial">4.4. Objetos de propósito especial</a></li>
<li><a href="#_en_resumen">4.5. En resumen</a></li>
<li><a href="#_ejercicios_2">4.6. Ejercicios</a></li>
</ul>
</li>
<li><a href="#sesion05">5. Filtros</a>
<ul class="sectlevel2">
<li><a href="#_c%C3%B3mo_usar_un_filtro">5.1. Cómo usar un filtro</a></li>
<li><a href="#_filtros_predefinidos_en_angularjs">5.2. Filtros predefinidos en AngularJS</a></li>
<li><a href="#_c%C3%B3mo_crear_un_filtro_personalizado">5.3. Cómo crear un filtro personalizado</a></li>
<li><a href="#__em_tip_em_c%C3%B3mo_acceder_a_un_array_filtrado_fuera_de_code_ng_repeat_code">5.4. <em>Tip</em>: cómo acceder a un array filtrado fuera de <code>ng-repeat</code></a></li>
<li><a href="#_ejercicios_3">5.5. Ejercicios</a></li>
</ul>
</li>
<li><a href="#sesion06">6. Routing con <code>ngRoute</code></a>
<ul class="sectlevel2">
<li><a href="#_gesti%C3%B3n_de_la_navegaci%C3%B3n">6.1. Gestión de la navegación</a></li>
<li><a href="#_la_directiva_ngview">6.2. La directiva ngView</a></li>
<li><a href="#_definici%C3%B3n_de_rutas">6.3. Definición de rutas</a></li>
<li><a href="#_rutas_parametrizadas">6.4. Rutas parametrizadas</a></li>
<li><a href="#_redirecci%C3%B3n">6.5. Redirección</a></li>
<li><a href="#_ejercicio_1_punto_2">6.6. Ejercicio (1 punto)</a></li>
</ul>
</li>
<li><a href="#sesion07">7. Routing con <code>ui-router</code></a>
<ul class="sectlevel2">
<li><a href="#_primeros_cambios_en_la_aplicaci%C3%B3n">7.1. Primeros cambios en la aplicación</a></li>
<li><a href="#_la_directiva_code_uiview_code">7.2. La directiva <code>uiView</code></a></li>
<li><a href="#_definiendo_nuestro_primer_estado">7.3. Definiendo nuestro primer estado</a></li>
<li><a href="#_estados_anidados">7.4. Estados anidados</a></li>
<li><a href="#_definiendo_una_ruta_por_defecto">7.5. Definiendo una ruta por defecto</a></li>
<li><a href="#_estados_abstractos">7.6. Estados abstractos</a></li>
<li><a href="#_recepci%C3%B3n_de_par%C3%A1metros_en_el_controlador">7.7. Recepción de parámetros en el controlador</a></li>
<li><a href="#_redirecci%C3%B3n_2">7.8. Redirección</a></li>
<li><a href="#_ejercicio_1_punto_3">7.9. Ejercicio (1 punto)</a></li>
</ul>
</li>
<li><a href="#sesion08">8. Formularios y validación</a>
<ul class="sectlevel2">
<li><a href="#_comparando_formullarios_tradicionales_con_formularios_en_angularjs">8.1. Comparando formullarios tradicionales con formularios en AngularJS</a></li>
<li><a href="#_continuemos">8.2. Continuemos</a></li>
<li><a href="#_creando_un_formulario_de_registro">8.3. Creando un formulario de registro</a></li>
<li><a href="#_mejorando_la_experiencia_mobile">8.4. Mejorando la experiencia mobile</a></li>
<li><a href="#_el_controlador_code_ngmodelcontroller_code">8.5. El controlador <code>ngModelController</code></a></li>
<li><a href="#_el_controlador_code_ngformcontroller_code">8.6. El controlador <code>ngFormController</code></a></li>
<li><a href="#_ejercicio_0_5_puntos">8.7. Ejercicio (0.5 puntos)</a></li>
</ul>
</li>
<li><a href="#sesion09">9. Custom directives</a>
<ul class="sectlevel2">
<li><a href="#_definiendo_nuevas_directivas">9.1. Definiendo nuevas directivas</a></li>
<li><a href="#_nuestra_primera_directiva">9.2. Nuestra primera directiva</a></li>
<li><a href="#_el_atributo_code_restrict_code">9.3. El atributo <code>restrict</code></a></li>
<li><a href="#_paso_de_datos_a_la_directiva">9.4. Paso de datos a la directiva</a></li>
<li><a href="#_el_atributo_code_transclude_code">9.5. El atributo <code>transclude</code></a></li>
<li><a href="#_un_vistazo_a_todas_las_propiedades_de_una_directiva">9.6. Un vistazo a todas las propiedades de una directiva</a></li>
<li><a href="#_directivas_de_validaci%C3%B3n">9.7. Directivas de validación</a></li>
<li><a href="#_ejercicios_2_puntos">9.8. Ejercicios (2 puntos)</a></li>
</ul>
</li>
<li><a href="#sesion10">10. Promesas de resultados</a>
<ul class="sectlevel2">
<li><a href="#_por_qu%C3%A9_utilizar_promesas">10.1. Por qué utilizar promesas</a></li>
<li><a href="#_promesas_y_em_deferred_objects_em">10.2. Promesas y <em>deferred objects</em></a></li>
<li><a href="#_promesas_en_angularjs">10.3. Promesas en AngularJS</a></li>
<li><a href="#_encadenando_promesas">10.4. Encadenando promesas</a></li>
<li><a href="#_otros_m%C3%A9todos_%C3%BAtiles">10.5. Otros métodos útiles</a></li>
<li><a href="#_ejercicio_0_5_puntos_2">10.6. Ejercicio (0.5 puntos)</a></li>
</ul>
</li>
<li><a href="#sesion11">11. Comunicación con el servidor</a>
<ul class="sectlevel2">
<li><a href="#_el_servicio_http">11.1. El servicio $http</a></li>
<li><a href="#_integraci%C3%B3n_con_servicios_restful_el_servicio_resource">11.2. Integración con servicios RESTful: el servicio $resource</a></li>
<li><a href="#_interceptores">11.3. Interceptores</a></li>
</ul>
</li>
<li><a href="#sesion12">12. Automatización y testing</a>
<ul class="sectlevel2">
<li><a href="#_instalaci%C3%B3n_de_grunt_cli">12.1. Instalación de Grunt CLI</a></li>
<li><a href="#_instalaci%C3%B3n_de_bower">12.2. Instalación de Bower</a></li>
<li><a href="#_estructura_inicial_de_nuestro_proyecto">12.3. Estructura inicial de nuestro proyecto</a></li>
<li><a href="#_automatizando_tareas_con_grunt_dise%C3%B1ando_nuestro_em_workflow_em">12.4. Automatizando tareas con Grunt. Diseñando nuestro <em>workflow</em></a></li>
<li><a href="#_un_paso_m%C3%A1s_all%C3%A1">12.5. Un paso más allá</a></li>
</ul>
</li>
</ul>
</div>
</div>
<div id="content">
<div id="preamble">
<div class="sectionbody">
<div style="page-break-after: always;"></div>
</div>
</div>
<div class="sect1">
<h2 id="sesion01">1. AngularJS</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="__qué_es_angularjs">1.1. ¿Qué es AngularJS?</h3>
<div class="paragraph">
<p>AngularJS es un framework de JavaScript de código abierto, mantenido por Google, que ayuda con la gestión de lo que se conoce como aplicaciones de una sola página (en inglés, single-page applications). Su objetivo es aumentar las aplicaciones basadas en navegador con (MVC) Capacidad de Modelo Vista Controlador, en un esfuerzo para hacer que el desarrollo y las pruebas más fáciles.</p>
</div>
<div class="paragraph">
<p>AngularJS es un framework JavaScript, mantenido por Google, que se ejecuta en el lado del cliente, y se utiliza para crear <em>single-page web applications</em>.</p>
</div>
<div class="sect3">
<h4 id="__single_page_web_applications">1.1.1. ¿Single-page web applications?</h4>
<div class="paragraph">
<p>Una <em>single-page web application</em> (en adelante SPA), es una aplicación web que se ejecuta completamente en una única página web, con el objetivo de proporcionar una experiencia más fluida y similar a la que nos encontraríamos en una aplicación de escritorio</p>
</div>
<div class="paragraph">
<p>En una aplicación SPA, todos los datos necesarios, como el HTML, CSS o JavaScript, se cargan y añaden en la página cuando es necesario, normalmente respondiendo a acciones del usuario. En ningún momento del proceso veremos una recarga total de la página. Para esto, como os imaginaréis a lo largo del proceso de ejecución de una aplicación SPA existe una comunicación con el servidor en segundo plano.</p>
</div>
<div class="sect4">
<h5 id="_ejemplos_de_aplcaciones_spa">Ejemplos de aplcaciones SPA</h5>
<div class="ulist">
<ul>
<li>
<p>GMail</p>
</li>
<li>
<p>Google+</p>
</li>
<li>
<p>Facebook</p>
</li>
<li>
<p>Twitter</p>
</li>
<li>
<p>App de YouTube de PS3, que además está realizada con AngularJS</p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_volviendo_a_angularjs">1.2. Volviendo a AngularJS&#8230;&#8203;</h3>
<div class="paragraph">
<p>Volviendo a AngularJS y a sus características principales. AngularJS es un framework para escribir aplicaciones en JavaScript. Es prescriptivo, ya que existe una manera recomendada de hacer las cosas con él. Además, tiene su propia vuelta de tuerca del omnipresente patrón MVC, especialmente adaptado a JavaScript y al desarrollo de aplicaciones SPA.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="img/ses01/001_feelings.jpg" alt="{large-size}">
</div>
</div>
</div>
<div class="sect2">
<h3 id="_principales_características_de_angularjs">1.3. Principales características de AngularJS</h3>
<div class="paragraph">
<p>A continuación, vamos a ver alogos de los aspectos más importantes de AngularJS. Puede que ahora se mencionen otros conceptos, que en su momento quedarán aclarados.</p>
</div>
<div class="sect3">
<h4 id="_two_way_data_binding">1.3.1. Two-way data binding</h4>
<div class="paragraph">
<p>Según Martin Fowler<span class="footnote">[<a id="_footnoteref_1" class="footnote" href="#_footnote_1" title="View footnote.">1</a>]</span>, este patrón consiste en: <em>Un mecanismo que garantiza que cualquier cambio realizado sobre los datos en un control de la interfaz, se traslada inmediatamente al estado de la sesión (y viceversa).</em></p>
</div>
<div class="paragraph">
<p>En una aplicaciónAngularJS el <em>two-way data binding</em> consiste en la sincronización automática entre los componentes del modelo y de la vista. La vista es una proyección del modelo en todo momento. Cuando realizamos un cambio sobre el modelo éste se refleja inmediatamente sobre la vista.
image::img/ses01/02.png[{large-size}]</p>
</div>
<div class="paragraph">
<p>En AngularJS, este mecanismo funciona de la siguiente manera: una plantilla (que es código HTML) se compila en el navegador. Esta compilación hace que cualquier cambio en el modelo se refleje inmediatamente en la vista. También hará que todo cambio que realicemos en la vista se propage al modelo. El modelo es la <em>single-source-of-truth</em> del estado de la aplicación, lo que simplifica mucho las cosas, al no tener que gestionar más que el modelo, y pensar el la vista como una proyección de éste.</p>
</div>
<div class="paragraph">
<p>Dado que la vista es una proyección del modelo, el controlador queda totalmente separado de la vista y no es consciente de ella. De esta manera, realizar tests sobre un controlador es mucho más sencillo, ya que no depende de la vista ni de ningún elemento del DOM.</p>
</div>
<div class="paragraph">
<p>Imaginémonos que queremos implementar esta funcionalidad en JavaScript plano, o con jQuery. Tendríamos que hacer un número enorme de consultas al DOM para mantener esta funcionalidad, y hacer que se ejecute periódicamente para que los datos siempre se encuentren actualizados. Sin embargo, AngularJS ya realiza este trabajo por nosotros, y el <em>data binding</em> se realiza de manera transparente.</p>
</div>
<div class="paragraph">
<p>Así, para una pantalla que muestre el nombre de usuario, sería tan sencillo como declarar una variable con el nombre de usuario en nuestro código JavaScript:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="javascript"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1</div></td><td class="code"><span class="tok-kd">var</span> <span class="tok-nx">name</span> <span class="tok-o">=</span> <span class="tok-s1">&#39;Alex&#39;</span><span class="tok-p">;</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>En nuestra vista, utilizaremos la notación {{ }}, que nos pemite ligar expresiones a elementos:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="html"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1</div></td><td class="code"><span class="tok-nt">&lt;h1&gt;</span>Bienvenido, {{ name }}<span class="tok-nt">&lt;/h1&gt;</span>
</td></tr></table></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_mvw_model_view_whatever">1.3.2. MVW (Model-View-Whatever)</h4>
<div class="paragraph">
<p>Esto es lo que piensa Igor Minar, <em>lead</em> de AngularJS, cuando se entra en cuestiones sobre qué patrón sigue el framework.</p>
</div>
<div class="quoteblock">
<blockquote>
MVC vs MVVM vs MVP. Un asunto controvertido en el que muchos desarrolladores pueden pasarse horas y horas discutiendo.
Durante muchos años, AngularJS estaba más cerca del MVC que de cualquier otra cosa. Sin embargo, a medida que pasó el tiempo y debifo a una serie de refactorings y mejoras en la API, ahora está más cerca de MVVM, donde el objeto $scope puede considerarse como un ViewModel que podemos decorar con una función que llamamos Controlador.
Ser capaces de categorizar un framework como un MV* tiene sus ventajas. Ayuda a los desarrolladores a estar más cómodos con sus APIS, haciendo más fácil crear un modelo mental que representa la aplicación que están construyendo con el framework. También, ayuda a establecer cierta terminología a emplear por los desarrolladores.
Una vez dicho esto, veo muchos desarrolladores que construyen aplicaciones alucinantes, muy bien diseñadas, que siguen los principios de <em>separation of concerns</em>; y muy pocos que pierden el tiempo discutiendo chorradas dobre MV*. Y por esta razón, por la presente declaro que AngularJS es un framework MVW (Model-View-Whatever). Donde <em>whatever</em> es <em>whatever works for you</em>.
Angular proporciona mucha flexibilidad para separar de manera sencilla la lógica de presentación de la de diseño y el estado de presentación. Por favor, úsalo para incrementar tu productividad y mantenibilidad de tu aplicación, y no para discutir sobre cosas que, en el fondo, no importan tanto.
</blockquote>
<div class="attribution">
&#8212; Igor Minar<br>
<cite>https://plus.google.com/+AngularJS/posts/aZNVhj355G2</cite>
</div>
</div>
<div class="paragraph">
<p>A efectos prácticos, y como se dice en la cita, el patrón <em>Model View ViewModel</em> (MVVM) es una aproximación bastante cercana para describir de manera general el comportamiento de AngularJS.</p>
</div>
<div class="paragraph">
<p>El patrón MVVM funciona muy bien en aplicaciones con interfaces de usuario ricas, ya que la Vista se vincula al ViewModel y, cuando el estado del ViewModel cambia, la Vista se actualiza automáticamente gracias, precisamente, al <em>two-way-databinding</em>. En AngularJS, una Vista es simplemente código HTML compilado con elementos propios del framework. Una vez finaliza el ciclo de compilación, la Vista se vincula al objeto $scope, que es el ViewModel. Ya veremos en profundidad el objeto $scope, pero adelantamos que es un objeto JavaScript que captura ciertos eventos para permitir el <em>data binding</em>. También, podemos exponer funciones al ViewModel para poder ejecutar funciones.</p>
</div>
<div class="paragraph">
<p>image::img/ses01/003_mvvm.png</p>
</div>
<div class="paragraph">
<p>Ya veremos esto más adelante, y veremos lo sencillo que es trabajar con este patrón, que crea una separación muy clara entre la Vista y la lógica que la conduce. Uno de los "efectos secundarios" del patrón ViewModel, es que permite que el código sea muy testable.</p>
</div>
</div>
<div class="sect3">
<h4 id="_plantillas_html">1.3.3. Plantillas HTML</h4>
<div class="paragraph">
<p>Otra de las grandes características de AngularJS es el uso de HTML para la creación de plantillas. Éstas pueden ser útiles cuando queremos predefinir un layout con secciones dinámicas está conectado con una estructura de datos. Por ejemplo, para repetir un mismo elemento DOM en una página, como una lista o una tabla. Podríamos definir cómo queremos que se vea una fila, y después asociarle una estructura de datos, como un array de JavaScript. Esta plantilla se repetiría tantas veces como ítems encontremos en el array, asociando el ítem al contenido.</p>
</div>
<div class="paragraph">
<p>Hay muchas librerías de <em>templating</em>, y muy buenas. Pero para la mayoría de ellas se requiere aprender una nueva sintaxis. Esta complejidad adicional puede ralentizar al desarrollador. Además, muchas suelen pasar por un preprocesador.</p>
</div>
<div class="paragraph">
<p>El navegador evalúa las plantillas de AngularJS como el resto de HTML de la página. Hay cierta funcionalidad de AngularJS que gestiona cómo se representan los datos, que veremos cómo funciona en las próximas sesiones.</p>
</div>
</div>
<div class="sect3">
<h4 id="_deep_linking">1.3.4. Deep linking</h4>
<div class="paragraph">
<p>Como hemos comoentado, AngularJS es un framework para construir aplicaciones SPA. Sin embargo, es posible que nuestros usuarios no se den cuenta de este detalle. En muchas aplicaciones SPA modernas, está prohibido usar el <em>back button</em> ya que no se tiene en cuenta a la hora de programar. Sin embargo, AngularJS hace uso de la API de history de HTML5. ¿Que tu navegador no implementa esa API? Es igual, AngularJS seguirá gestionando bien el histórico gracias al control de cambios en el hashbang.</p>
</div>
<div class="paragraph">
<p>Para un usuario, esto significa que se pueden guardar y compartir cualquier estado de la apliación, cosa muy importante hoy en día debido al social media. También nos permite a los desarrolladores cambiar el estado de la aplicación de la manera más sencilla posible: mediante el uso de hipervínculos.</p>
</div>
</div>
<div class="sect3">
<h4 id="_inyección_de_dependencias">1.3.5. Inyección de dependencias</h4>
<div class="paragraph">
<p>La inyección de dependencias (DI por sus siglas en inglés) describe una técnica que hemos estado usando toda la vida. Si alguna vez has usado una función que acepta un parámetro, ya has hecho uso de la inyección de dependencias. Inyectas algo de lo que depende tu función para realizar su trabajo. Nada más y nada menos.</p>
</div>
<div class="paragraph">
<p>image::img/ses01/004_di.png</p>
</div>
<div class="paragraph">
<p>Al modularizar tu código con elementos inyectables, éste es más fácil de testear, ya que en cualquier momento puedes reemplazar uno de los elementos por otro, siempre y cuando implemente la misma interfaz.</p>
</div>
<div class="paragraph">
<p>Veamos un sencillo caso de inyección de dependencias. El siguiente código no hace uso de ellas:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="javascript"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3
4
5
6
7</div></td><td class="code"><span class="tok-kd">function</span> <span class="tok-nx">a</span> <span class="tok-p">()</span> <span class="tok-p">{</span>
 <span class="tok-k">return</span> <span class="tok-mi">5</span><span class="tok-p">;</span>
<span class="tok-p">}</span>
<span class="tok-kd">function</span> <span class="tok-nx">b</span> <span class="tok-p">()</span> <span class="tok-p">{</span>
 <span class="tok-k">return</span> <span class="tok-nx">a</span><span class="tok-p">()</span> <span class="tok-o">+</span> <span class="tok-mi">1</span><span class="tok-p">;</span>
<span class="tok-p">}</span>
<span class="tok-nx">console</span><span class="tok-p">.</span><span class="tok-nx">log</span><span class="tok-p">(</span><span class="tok-nx">b</span><span class="tok-p">());</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>Con un código tan pequeño y tan simple, ya se plantean dos problemas:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Orden: necesariamente, la función <em>a</em> debe cargarse antes que <em>b</em>. Si están en ficheros separados, hay que tener esto en cuenta. ¿Qué pasa cuando nuestra aplicación crece más y más? Nuestra aplicación se hace dependiente del orden.</p>
</li>
<li>
<p>Testabilidad: Se hace imposible sustituir <em>a</em> por un objeto mock para poder testarlo.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Si usáramos DI, nuestro código tendría un aspecto similar al siguiente:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="javascript"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3
4
5
6
7
8
9</div></td><td class="code"><span class="tok-nx">service</span><span class="tok-p">(</span><span class="tok-s1">&#39;a&#39;</span><span class="tok-p">,</span> <span class="tok-kd">function</span> <span class="tok-p">()</span> <span class="tok-p">{</span>
 <span class="tok-k">return</span> <span class="tok-mi">5</span><span class="tok-p">;</span>
<span class="tok-p">});</span>
<span class="tok-nx">service</span><span class="tok-p">(</span><span class="tok-s1">&#39;b&#39;</span><span class="tok-p">,</span> <span class="tok-kd">function</span> <span class="tok-p">(</span><span class="tok-nx">a</span><span class="tok-p">)</span> <span class="tok-p">{</span>
 <span class="tok-k">return</span> <span class="tok-nx">a</span><span class="tok-p">()</span> <span class="tok-o">+</span> <span class="tok-mi">5</span><span class="tok-p">;</span>
<span class="tok-p">});</span>
<span class="tok-nx">service</span><span class="tok-p">(</span><span class="tok-s1">&#39;main&#39;</span><span class="tok-p">,</span> <span class="tok-kd">function</span> <span class="tok-p">(</span><span class="tok-nx">b</span><span class="tok-p">)</span> <span class="tok-p">{</span>
 <span class="tok-nx">console</span><span class="tok-p">.</span><span class="tok-nx">log</span><span class="tok-p">(</span><span class="tok-nx">b</span><span class="tok-p">());</span>
<span class="tok-p">});</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>Este cambio tiene varias ventajas: por una parte, ya no dependemos del orden, y nuestro código no tiene que seguir una secuencia. estp implica que, podemos extraer cualquiera de los bloques a otro fichero, lo que en aplicaciones grandes será más que conveniente. Además, en cualquier momento podemos sobreescribir cualquiera de las funciones, cosa muy importante para realizar tests.</p>
</div>
</div>
<div class="sect3">
<h4 id="_directivas">1.3.6. Directivas</h4>
<div class="paragraph">
<p>Las directivas son la parte más interesante de AngularJS, ya que nos permiten extender HTML para que realice todo lo que nosotros queramos.</p>
</div>
<div class="paragraph">
<p>Podemos crear elementos del DOM personalizados, atributos o clases que incorporan cierta funcionalidad definida en JavaScript. Aunque HTML es excelente para definir un layout, para el resto se queda corto. Las directivas nos proporcionan un mecanismo para unir la naturaleza declarativa de HTML con la naturaleza funcional de JavaScript en un mismo elemento. Así, cuando aprendamos a utilizar directivas, en lugar de pintar un modal de bootstrap de esta manera:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="javascript"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11</div></td><td class="code"><span class="tok-o">&lt;</span><span class="tok-nx">div</span> <span class="tok-kr">class</span><span class="tok-o">=</span><span class="tok-s2">&quot;modal fade&quot;</span><span class="tok-o">&gt;</span>
  <span class="tok-o">&lt;</span><span class="tok-nx">div</span> <span class="tok-kr">class</span><span class="tok-o">=</span><span class="tok-s2">&quot;modal-dialog&quot;</span><span class="tok-o">&gt;</span>
    <span class="tok-o">&lt;</span><span class="tok-nx">div</span> <span class="tok-kr">class</span><span class="tok-o">=</span><span class="tok-s2">&quot;modal-content&quot;</span><span class="tok-o">&gt;</span>
      <span class="tok-o">&lt;</span><span class="tok-nx">div</span> <span class="tok-kr">class</span><span class="tok-o">=</span><span class="tok-s2">&quot;modal-header&quot;</span><span class="tok-o">&gt;</span>
        <span class="tok-o">&lt;</span><span class="tok-nx">button</span> <span class="tok-nx">type</span><span class="tok-o">=</span><span class="tok-s2">&quot;button&quot;</span> <span class="tok-kr">class</span><span class="tok-o">=</span><span class="tok-s2">&quot;close&quot;</span> <span class="tok-nx">data</span><span class="tok-o">-</span><span class="tok-nx">dismiss</span><span class="tok-o">=</span><span class="tok-s2">&quot;modal&quot;</span> <span class="tok-nx">aria</span><span class="tok-o">-</span><span class="tok-nx">hidden</span><span class="tok-o">=</span><span class="tok-s2">&quot;true&quot;</span><span class="tok-o">&gt;&amp;</span><span class="tok-nx">times</span><span class="tok-p">;</span><span class="tok-o">&lt;</span><span class="tok-err">/button&gt;</span>
        <span class="tok-o">&lt;</span><span class="tok-nx">h4</span> <span class="tok-kr">class</span><span class="tok-o">=</span><span class="tok-s2">&quot;modal-title&quot;</span><span class="tok-o">&gt;</span><span class="tok-nx">Esto</span> <span class="tok-nx">ser</span><span class="tok-err">í</span><span class="tok-nx">a</span> <span class="tok-nx">un</span> <span class="tok-nx">modal</span> <span class="tok-nx">con</span> <span class="tok-nx">bootstrap</span> <span class="tok-nx">y</span> <span class="tok-nx">jQuery</span><span class="tok-o">&lt;</span><span class="tok-err">/h4&gt;</span>
      <span class="tok-o">&lt;</span><span class="tok-err">/div&gt;</span>
      <span class="tok-o">&lt;</span><span class="tok-nx">div</span> <span class="tok-kr">class</span><span class="tok-o">=</span><span class="tok-s2">&quot;modal-body&quot;</span><span class="tok-o">&gt;</span><span class="tok-nx">He</span> <span class="tok-nx">aqu</span><span class="tok-err">í</span> <span class="tok-nx">el</span> <span class="tok-nx">contenido</span> <span class="tok-nx">del</span> <span class="tok-nx">modal</span><span class="tok-o">&lt;</span><span class="tok-err">/div&gt;</span>
    <span class="tok-o">&lt;</span><span class="tok-err">/div&gt;</span>
  <span class="tok-o">&lt;</span><span class="tok-err">/div&gt;</span>
<span class="tok-o">&lt;</span><span class="tok-err">/div&gt;</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>Lo haremos de esta otra:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="javascript"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1</div></td><td class="code"><span class="tok-o">&lt;</span><span class="tok-nx">modal</span> <span class="tok-nx">title</span><span class="tok-o">=</span><span class="tok-s2">&quot;Esto sería un modal con AngularJS&quot;</span><span class="tok-o">&gt;</span><span class="tok-nx">He</span> <span class="tok-nx">aqu</span><span class="tok-err">í</span> <span class="tok-nx">el</span> <span class="tok-nx">contenido</span> <span class="tok-nx">del</span> <span class="tok-nx">modal</span><span class="tok-p">.</span> <span class="tok-nx">F</span><span class="tok-err">á</span><span class="tok-nx">cil</span><span class="tok-p">,</span> <span class="tok-err">¿</span><span class="tok-nx">no</span><span class="tok-o">?&lt;</span><span class="tok-err">/modal&gt;</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>Para los curiosos, podéis ir jugando con el código de este modal en <a href="http://jsfiddle.net/alexsuch/RLQhh/" class="bare">http://jsfiddle.net/alexsuch/RLQhh/</a>.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_ventajas_e_inconvenientes_de_angularjs">1.4. Ventajas e inconvenientes de AngularJS</h3>
<div class="paragraph">
<p>Se ha escrito mucho acerca de las ventajas e inconvenientes de este framework. En este apartado hacemos una recopilación de los elementos más destacados y odiados por la comunidad.</p>
</div>
<div class="sect3">
<h4 id="_ventajas">1.4.1. Ventajas</h4>
<div class="ulist">
<ul>
<li>
<p>Es comprensivo. Se trata de un framework con una curva de aprendizaje poco elevada, lo que nos permite estar desarrollando aplicaciones sencillas en poco tiempo. No necesitamos conocer a fondo los conceptos de módule, service, factory, scope, inyección de dependencias o directive. ¡Con saber hacer un controlador y las directivas que proporciona el sistema ya podemos echar a correr!.</p>
</li>
<li>
<p>Trabajamos con POJSOS (Plain Old Javascript Objects). Se puede, y se recomienda, el uso de primitivas y objetos Javascript como Arrays, Dates, y objetos todo lo complejos que queramos para trabajar con AngularJS.</p>
</li>
<li>
<p>Inyección de depenedencias. Como hemos visto, la inyección de dependencias nos permite desacoplar nuestro código, y hacerlo más testable.</p>
</li>
<li>
<p>Las plantillas pueden escribirse en HTML. AngularJS es muy bueno para la construcción de single page applications, y eso se nota en la facilidad para la creación de plantillas. A diferencia de otros frameworks, donde las plantillas se definen en variables o con una sintaxis específica, en AngularJS podemos definir plantillas utilizando exclusivamente HTML y documentos HTML, que podemos extender o no mediante directivas.</p>
</li>
<li>
<p>Muy buena integración del framework con REST y AJAX. De manera que con muy pocas líneas de código podemos realizar una petición al servidor, obtener y procesar los datos, y mostrar la información que necesitamos en nuestra vista.</p>
</li>
<li>
<p>Integración con jQuery. AngularJS trabaja de base con un subset de jQuery, llamado jqLite, que permite la manipulación del DOM de manera compatible en todos los navegadores. Todas las referencias a elementos de angular están envueltos con jqLite. Sin embargo, si añadimos jQuery a nuestro proyecto, el framework lo detecta y hace uso de éste en lugar de jQuery.</p>
</li>
<li>
<p>Modularidad. Se pueden elaborar de manera sencilla componentes que podremos reutilizar en posteriores desarrollos.</p>
</li>
<li>
<p>Minificación. La Minificación tiene un doble objetivo: por un lado, conseguir que nuestra aplicación “pese” menos; por otro, se pretende ofuscar de alguna manera el código para hacer un poco más segura nuestra aplicación. AngularJS tiene en cuenta esto, y nos permite minificar nuestra aplicación de manera sencilla y con pocos cambios, en caso de no haberlo previsto inicialmente.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_inconvenientes">1.4.2. Inconvenientes</h4>
<div class="ulist">
<ul>
<li>
<p>Al igual que hemos dicho que la curva de aprendizaje inicial es muy baja, cuando queremos hacer algo avanzado en aplicaciones más serias, la cosa puede resultar un poco difícil debido a la falta de documentación, o documentación errónea en algunos casos. Afortunadamente, el equipo de AngularJS está trabajando a diario en esto, y entre esto y la cada vez más creciente comunidad de usuarios, este problema se va minificando a la carrera.</p>
</li>
<li>
<p>El framework de validación de formularios no es del todo perfecto, y de vez en cuando hay que hacer algunos trucos para que haga lo que nosotros queremos.</p>
</li>
<li>
<p>Como pasa con todos los frameworks, ninguno es la panacea y encontraremos escenarios donde AngularJS no encaje.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_recursos_online">1.5. Recursos online</h3>
<div class="paragraph">
<p>AngularJS tiene una comunidad de desarrolladores cada vez más extensa. Algu nos de los canales que podemos utilizar para discutir sobre cualquier elemento del framework o pedir ayuda son:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Lista de correo en <a href="mailto:angular@googlegroups.com">angular@googlegroups.com</a></p>
</li>
<li>
<p>Comunidad de Google+ <a href="https://plus.google.com/u/0/communities/115368820700870330756" class="bare">https://plus.google.com/u/0/communities/115368820700870330756</a></p>
</li>
<li>
<p>Canal de IRC #angularjs</p>
</li>
<li>
<p>Tag *angularjs* en <a href="http://stackoverflow.com" class="bare">http://stackoverflow.com</a></p>
</li>
<li>
<p>Twitter @angularjs</p>
</li>
<li>
<p><a href="http://builtwith.angularjs.org/" class="bare">http://builtwith.angularjs.org/</a> nos proporciona un listado de grandes aplicaciones realizadas con AngularJS</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Además, tenemos diversos sitios donde poder seguir con el aprendizaje de AngularJS, como pueden ser:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Página oficial de AngularJS (<a href="http://www.angularjs.org" class="bare">http://www.angularjs.org</a>). Donde tenemos un poco de todo: videotutoriales, referencia de la API, posibilidad de descargarnos el código fuente, etc. Un must have en nuestros marcadores del navegador.</p>
</li>
<li>
<p>Blog de AngularJS: <a href="http://blog.angularjs.org" class="bare">http://blog.angularjs.org</a></p>
</li>
<li>
<p>Canal de youtube de AngularJS (<a href="http://www.youtube.com/user/angularjs" class="bare">http://www.youtube.com/user/angularjs</a>) donde hay charlas, tutoriales y una variedad muy extensa de vídeos.</p>
</li>
<li>
<p><a href="http://egghead.io/" class="bare">http://egghead.io/</a>. Otro <em>must have</em>, y probablemente uno de los mejores sitios de videotutoriales de AngularJS</p>
</li>
<li>
<p>Blog de Alejandro Such (<a href="http://veamospues.wordpress.com" class="bare">http://veamospues.wordpress.com</a>). Escribe poco, pero cuando lo hace es muy interesante ;)</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>También, hacer especial mención a la web <a href="http://ngmodules.org/" class="bare">http://ngmodules.org/</a>. En ella encontramos una base de datos con un extenso repertorio de módulos hechos por la comunidad y que pueden servirnos en muchos de nuestros proyectos. Encontramos módulos tan usados como angular-ui o angulartics. Cómo no, siempre es recomendable pasarse de vez en cuando por github a ver si hay proyectos similares a módulos que podamos necesitar.
&lt;&lt;&lt;</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="sesion02">2. Una tarde con AngularJS</h2>
<div class="sectionbody">
<div class="paragraph">
<p>En este capítulo vamos a ver todos los fundamentos de AngularJS para ponernos a trabajar rápidamente con el Framework.</p>
</div>
<div class="paragraph">
<p>Una vez terminada la sesión, seremos capaces de crear aplicaciones sencillas con AngularJS, y tendremos conocimiento de unos fundamentos que iremos desarrollando y ampliando en sesiones posteriores.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Todo el código que hagamos de aquí en adelante lo pondremos en un <em>fork</em> del proyecto <code>java_ua/angular-expertojava</code>.</p>
</div>
<div class="paragraph">
<p>Como hay una parte del código de los ejercicios que evolucionará a lo largo de las sesiones, identificaremos cada entrega mediante el uso de <strong><em>tags</em></strong>. El nombre de dichos tags se indicará en cada apartado de ejercicios.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="sect2">
<h3 id="_creando_la_aplicación">2.1. Creando la aplicación</h3>
<div class="paragraph">
<p>Para nuestra aplicación, crearemos un nuevo proyecto IntelliJ</p>
</div>
<div class="imageblock">
<div class="content">
<img src="img/ses02/001.png" alt="{large-size}">
</div>
</div>
<div class="paragraph">
<p>Crearemos un proyecto vacío, que será la base de todos nuestros módulos y será lo que subiremos a BitBucket</p>
</div>
<div class="imageblock">
<div class="content">
<img src="img/ses02/002.png" alt="{large-size}">
</div>
</div>
<div class="paragraph">
<p>Llamaremos al proyecto <code>angular-expertojava</code></p>
</div>
<div class="imageblock">
<div class="content">
<img src="img/ses02/003.png" alt="{large-size}">
</div>
</div>
<div class="paragraph">
<p>A continuación, introduciremos un nuevo módulo de tipo <em>Static Web</em>. Lo llamaremos <code>unatardeconangular</code></p>
</div>
<div class="imageblock">
<div class="content">
<img src="img/ses02/004.png" alt="{large-size}">
</div>
</div>
<div class="imageblock">
<div class="content">
<img src="img/ses02/004_2.png" alt="{large-size}">
</div>
</div>
</div>
<div class="sect2">
<h3 id="_directivas_data_binding">2.2. Directivas, data binding</h3>
<div class="paragraph">
<p>Dado que AngularJS es un framework JavaScript se se va a ejecutar en una página web, vamos a necesitar un fichero html. En éste, tendremos que incluir el código fuente de AngularJS.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="html"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11</div></td><td class="code"><span class="tok-cp">&lt;!DOCTYPE html&gt;</span>
<span class="tok-nt">&lt;html</span> <span class="tok-na">ng-app</span><span class="tok-nt">&gt;</span>
    <span class="tok-nt">&lt;head&gt;</span>
        <span class="tok-nt">&lt;title&gt;</span>Una tarde con AngularJS<span class="tok-nt">&lt;/title&gt;</span>
        <span class="tok-nt">&lt;meta</span> <span class="tok-na">charset=</span><span class="tok-s">&quot;UTF-8&quot;</span><span class="tok-nt">&gt;</span>
        <span class="tok-nt">&lt;meta</span> <span class="tok-na">name=</span><span class="tok-s">&quot;viewport&quot;</span> <span class="tok-na">content=</span><span class="tok-s">&quot;width=device-width, initial-scale=1.0&quot;</span><span class="tok-nt">&gt;</span>
    <span class="tok-nt">&lt;/head&gt;</span>
    <span class="tok-nt">&lt;body&gt;</span>
        <span class="tok-nt">&lt;script </span><span class="tok-na">src=</span><span class="tok-s">&quot;https://code.angularjs.org/1.2.16/angular.min.js&quot;</span><span class="tok-nt">&gt;&lt;/script&gt;</span>
    <span class="tok-nt">&lt;/body&gt;</span>
<span class="tok-nt">&lt;/html&gt;</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>En el momento de escribir estos apuntes, la última versión estable es la 1.2.16. Cualquier versión posterior, bien sea 1.2.x o la más reciente 1.3.x es totalmente compatible con lo que aquí veamos.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Una vez añadido el script de AngularJS en nuestra página, ya podemos empezar a usarlo. Para esto, nos vamos a topar con el primero de los elementos propios de AngularJS: las directivas. Una directiva, como se ha mencionado, nos permite extender HTML, creando componentes, clases o atributos con una funcionalidad dada.</p>
</div>
<div class="paragraph">
<p>Por ejemplo, en el código de arriba, ya vemos nuestra primera directiva, y una de las más importantes: <code>ng-app</code>. Por convenio, todo lo que tenga la forma <code>ng-*</code> va a ser una directiva <em>built in</em> de AngularJS. Dado que no son exclusivas del core del framework y nosotros podemos crearnos nuestras propias directivas, por convenio las <em>third parties</em> suelen utilizar un prefijo de 2-3 caracteres para cada directiva y así evitar conflictos de nombres.</p>
</div>
<div class="paragraph">
<p>Volviendo a la directiva <code>ng-app</code>. Ésta se encarga de inicializar nuestra aplicación. Lo más normal es ubicarla cerca del elemento raíz de la página, es decir, en las etiquetas <code>&lt;body&gt;</code> o <code>&lt;html&gt;</code>.</p>
</div>
<div class="paragraph">
<p>También podemos definir un módulo de AngularJS, que será nuestro módulo raíz para la aplicación. De momento, no le definiremos ningún nombre a la directiva ya que podemos hacer muchas cosas sin añadir ningún módulo. Por ejemplo, probemos el siguiente bloque de código:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="html"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16</div></td><td class="code"><span class="tok-cp">&lt;!DOCTYPE html&gt;</span>
<span class="tok-nt">&lt;html</span> <span class="tok-na">ng-app</span><span class="tok-nt">&gt;</span>
    <span class="tok-nt">&lt;head&gt;</span>
        <span class="tok-nt">&lt;title&gt;</span>Una tarde con AngularJS<span class="tok-nt">&lt;/title&gt;</span>
        <span class="tok-nt">&lt;meta</span> <span class="tok-na">charset=</span><span class="tok-s">&quot;UTF-8&quot;</span><span class="tok-nt">&gt;</span>
        <span class="tok-nt">&lt;meta</span> <span class="tok-na">name=</span><span class="tok-s">&quot;viewport&quot;</span> <span class="tok-na">content=</span><span class="tok-s">&quot;width=device-width, initial-scale=1.0&quot;</span><span class="tok-nt">&gt;</span>
        <span class="tok-nt">&lt;link</span> <span class="tok-na">rel=</span><span class="tok-s">&quot;stylesheet&quot;</span> <span class="tok-na">href=</span><span class="tok-s">&quot;components/lib/twitter-bootstrap/css/bootstrap.css&quot;</span> <span class="tok-nt">/&gt;</span>
    <span class="tok-nt">&lt;/head&gt;</span>
    <span class="tok-nt">&lt;body&gt;</span>
        <span class="tok-nt">&lt;div</span> <span class="tok-na">class=</span><span class="tok-s">&quot;container&quot;</span><span class="tok-nt">&gt;</span>
            <span class="tok-nt">&lt;label&gt;</span>Nombre:<span class="tok-nt">&lt;/label&gt;</span> <span class="tok-nt">&lt;input</span> <span class="tok-na">type=</span><span class="tok-s">&quot;text&quot;</span> <span class="tok-na">ng-model=</span><span class="tok-s">&quot;name&quot;</span> <span class="tok-nt">/&gt;&lt;br/&gt;</span>
            Has escrito {{ name }}.
        <span class="tok-nt">&lt;/div&gt;</span>
        <span class="tok-nt">&lt;script </span><span class="tok-na">src=</span><span class="tok-s">&quot;https://code.angularjs.org/1.2.16/angular.min.js&quot;</span><span class="tok-nt">&gt;&lt;/script&gt;</span>
    <span class="tok-nt">&lt;/body&gt;</span>
<span class="tok-nt">&lt;/html&gt;</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>Aquí vemos en acción otra directiva fundamental de AngularJS, llamada <code>ng-model</code>. Lo que hace esta directiva es crear una variable (en este caso llamada <em>name</em> porque estamos solicitando un nombre al usuario, pero podría ser <em>surname</em> o <em>phone</em>), en un elemento en memoria llamado <code>scope</code>. Este <code>scope</code> es un ViewModel que estaba vacío hasta que le hemos asignado esa propiedad. Para escribir ese valor del <code>scope</code> en cualquier sitio de la vista, lo único que tenemos que hacer es usar la expresión de <em>data binding</em> <code>{{ }}</code>.</p>
</div>
<div class="paragraph">
<p>Como algunos sabréis, la especificación de HTML5 dice que los <em>custom attributes</em> deben empezar con el prefijo <code>data-</code>. Si en algún proyecto os encontráis que hay que seguir esta especificación no os preocupéis: el core de AngularJS soporta este prefijo e identifica todas las directivas que lo lleven.</p>
</div>
<div class="paragraph">
<p>Si probamos el código en nuestro navegador, veremos cómo el nombre se va escribiendo a medida que introducimos caracteres en el input, gracias a la acción del <em>two way data binding</em>.</p>
</div>
</div>
<div class="sect2">
<h3 id="_declarando_colecciones_e_iterando_sobre_ellas">2.3. Declarando colecciones e iterando sobre ellas</h3>
<div class="paragraph">
<p>Otra cosa que podemos hacer es recorrer una colección. Para ello, AngularJS nos proporciona una directiva, <code>ng-repeat</code>, que nos permite iterar sobre un array de elementos. Este array lo vamos a inicializar con otra directiva, llamada <code>ng-init</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="html"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17</div></td><td class="code"><span class="tok-cp">&lt;!DOCTYPE html&gt;</span>
<span class="tok-nt">&lt;html</span> <span class="tok-na">ng-app</span><span class="tok-nt">&gt;</span>
    <span class="tok-nt">&lt;head&gt;</span>
        <span class="tok-nt">&lt;title&gt;</span>Una tarde con AngularJS<span class="tok-nt">&lt;/title&gt;</span>
        <span class="tok-nt">&lt;meta</span> <span class="tok-na">charset=</span><span class="tok-s">&quot;UTF-8&quot;</span><span class="tok-nt">&gt;</span>
        <span class="tok-nt">&lt;meta</span> <span class="tok-na">name=</span><span class="tok-s">&quot;viewport&quot;</span> <span class="tok-na">content=</span><span class="tok-s">&quot;width=device-width, initial-scale=1.0&quot;</span><span class="tok-nt">&gt;</span>
        <span class="tok-nt">&lt;link</span> <span class="tok-na">rel=</span><span class="tok-s">&quot;stylesheet&quot;</span> <span class="tok-na">href=</span><span class="tok-s">&quot;components/lib/twitter-bootstrap/css/bootstrap.css&quot;</span> <span class="tok-nt">/&gt;</span>
    <span class="tok-nt">&lt;/head&gt;</span>
    <span class="tok-nt">&lt;body&gt;</span>
        <span class="tok-nt">&lt;div</span> <span class="tok-na">class=</span><span class="tok-s">&quot;container&quot;</span> <span class="tok-na">ng-init=</span><span class="tok-s">&quot;people = [&#39;Domingo&#39;, &#39;Otto&#39;, &#39;Aitor&#39;, &#39;Eli&#39;, &#39;Fran&#39;, &#39;José Luís&#39;, &#39;Alex&#39;]&quot;</span><span class="tok-nt">&gt;</span>
            <span class="tok-nt">&lt;ul&gt;</span>
                <span class="tok-nt">&lt;li</span> <span class="tok-na">ng-repeat=</span><span class="tok-s">&quot;person in people&quot;</span><span class="tok-nt">&gt;</span>{{ person }}<span class="tok-nt">&lt;/li&gt;</span>
            <span class="tok-nt">&lt;/ul&gt;</span>
        <span class="tok-nt">&lt;/div&gt;</span>
        <span class="tok-nt">&lt;script </span><span class="tok-na">src=</span><span class="tok-s">&quot;https://code.angularjs.org/1.2.16/angular.min.js&quot;</span><span class="tok-nt">&gt;&lt;/script&gt;</span>
    <span class="tok-nt">&lt;/body&gt;</span>
<span class="tok-nt">&lt;/html&gt;</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>El uso de la directiva ng-init es muy similar a la declaración de variables dentro de código JavaScript. Por suerte, muy pronto veremos que no vamos a inicializar variables de esta manera, ya que como imaginaréis una vista no es el mejor lugar para inicializar una variable.</p>
</div>
<div class="paragraph">
<p>Por su parte, hemos visto que únicamente hemos declarado una plantilla para la colección, y ha sido la directiva <code>ng-repeat</code> quien se ha encargado de instanciarla para cada elemento de la colección. El formato de expresión más utilizado para esta directiva es <code>variable in expression</code>, donde <code>variable</code> es el nombre de una variable definida por el usuario, y <code>expression</code> es el nombre de nuestra colección. Más adelante, veremos que hay más expresiones que podemos usar con esta directiva.</p>
</div>
</div>
<div class="sect2">
<h3 id="_filtros">2.4. Filtros</h3>
<div class="paragraph">
<p>Otra cosa que podemos usar en AngularJS son filtros. Un filtro se encarga de recibir entrada determinada, realizar una transformación sobre ella, y devolver el resultado de la misma.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="html"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18</div></td><td class="code"><span class="tok-cp">&lt;!DOCTYPE html&gt;</span>
<span class="tok-nt">&lt;html</span> <span class="tok-na">ng-app</span><span class="tok-nt">&gt;</span>
    <span class="tok-nt">&lt;head&gt;</span>
        <span class="tok-nt">&lt;title&gt;</span>Una tarde con AngularJS<span class="tok-nt">&lt;/title&gt;</span>
        <span class="tok-nt">&lt;meta</span> <span class="tok-na">charset=</span><span class="tok-s">&quot;UTF-8&quot;</span><span class="tok-nt">&gt;</span>
        <span class="tok-nt">&lt;meta</span> <span class="tok-na">name=</span><span class="tok-s">&quot;viewport&quot;</span> <span class="tok-na">content=</span><span class="tok-s">&quot;width=device-width, initial-scale=1.0&quot;</span><span class="tok-nt">&gt;</span>
        <span class="tok-nt">&lt;link</span> <span class="tok-na">rel=</span><span class="tok-s">&quot;stylesheet&quot;</span> <span class="tok-na">href=</span><span class="tok-s">&quot;components/lib/twitter-bootstrap/css/bootstrap.css&quot;</span> <span class="tok-nt">/&gt;</span>
    <span class="tok-nt">&lt;/head&gt;</span>
    <span class="tok-nt">&lt;body&gt;</span>
        <span class="tok-nt">&lt;div</span> <span class="tok-na">class=</span><span class="tok-s">&quot;container&quot;</span> <span class="tok-na">ng-init=</span><span class="tok-s">&quot;people = [{name:&#39;Domingo&#39;, subject:&#39;JPA&#39;}, {name:&#39;Otto&#39;, subject:&#39;Backbone&#39;}, {name:&#39;Aitor&#39;,subject:&#39;JavaScript&#39;}, {name:&#39;Miguel Ángel&#39;,subject:&#39;JHD&#39;}, {name:&#39;Eli&#39;, subject:&#39;REST&#39;}, {name:&#39;Fran&#39;, subject:&#39;Grails&#39;}, {name:&#39;José Luís&#39;, subject:&#39;PaaS&#39;}, {name:&#39;Alex&#39;, subject:&#39;AngularJS&#39;}]&quot;</span><span class="tok-nt">&gt;</span>
            <span class="tok-nt">&lt;label&gt;</span>Filtro:<span class="tok-nt">&lt;/label&gt;</span> <span class="tok-nt">&lt;input</span> <span class="tok-na">type=</span><span class="tok-s">&quot;text&quot;</span> <span class="tok-na">ng-model=</span><span class="tok-s">&quot;textFilter&quot;</span> <span class="tok-nt">/&gt;&lt;br/&gt;</span>
            <span class="tok-nt">&lt;ul&gt;</span>
                <span class="tok-nt">&lt;li</span> <span class="tok-na">ng-repeat=</span><span class="tok-s">&quot;person in people | filter:textFilter | orderBy:&#39;name&#39;&quot;</span><span class="tok-nt">&gt;</span>{{ person.name }} - {{ person.subject | uppercase }}<span class="tok-nt">&lt;/li&gt;</span>
            <span class="tok-nt">&lt;/ul&gt;</span>
        <span class="tok-nt">&lt;/div&gt;</span>
        <span class="tok-nt">&lt;script </span><span class="tok-na">src=</span><span class="tok-s">&quot;https://code.angularjs.org/1.2.16/angular.min.js&quot;</span><span class="tok-nt">&gt;&lt;/script&gt;</span>
    <span class="tok-nt">&lt;/body&gt;</span>
<span class="tok-nt">&lt;/html&gt;</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>AngularJS dispone de una gran cantidad de filtros predefinidos. En el bloque de código anterior, vemos cómo utilizamos, el filtro <code>uppercase</code> para transformar una cadena a mayúsculas una cadena, o el filtro <code>orderBy</code> nos permite ordenar una colección de elementos. También vemos que podemos encadenar tantos filtros como queramos. En la directiva <code>ng-repeat</code> usamos los filtros <code>filter</code> y <code>orderBy</code>.</p>
</div>
<div class="paragraph">
<p>Al encadenar filtros, el resultado se irá propagando al siguiente en el orden que los hemos declarado. En este caso, primero Hemos usado el filtro <code>filter</code> para filtrar elementos basándonos en el modelo <code>textFilter</code>. Luego, hemos ordenado el conjunto de resultados por la propiedad <code>name</code>.</p>
</div>
<div class="paragraph">
<p>Para no repetirnos en el uso de filtros ya tienen cierto coste computacional, podemos declarar variables en una directiva <code>ng-repeat</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="html"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3
4</div></td><td class="code"><span class="tok-nt">&lt;ul&gt;</span>
	<span class="tok-nt">&lt;li</span> <span class="tok-na">ng-repeat=</span><span class="tok-s">&quot;person in filteredPeople = (people | filter:textFilter | orderBy:&#39;name&#39;)&quot;</span><span class="tok-nt">&gt;</span>{{ person.name }} - {{ person.subject | uppercase }}<span class="tok-nt">&lt;/li&gt;</span>
<span class="tok-nt">&lt;/ul&gt;</span>
Encontrados {{ filteredPeople.length }} resultados.
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>Nos detendremos en el capítulo dedicado a filtros a explicar cómo funciona cada uno de ellos. También, veremos cómo construir nuestros propios filtros.</p>
</div>
</div>
<div class="sect2">
<h3 id="_vistas_controladores_y_scope">2.5. Vistas, controladores y scope</h3>
<div class="paragraph">
<p>Vamos a centrarnos ahora en la parte MVVM de AngularJS. Las Vistas y Controladores serán similares a lo que hemos visto en otros frameworks, y además disponemos de un elemento, llamado <code>scope</code>, que hace las veces de ViewModel.</p>
</div>
<div class="paragraph">
<p>En AngularJS, tenemos una vista, como las que hemos estado viendo en los anteriores ejemplos con sus filtros, sus directivas y su <em>data binding</em>. Como se ha comentado, no queremos declarar variables en la vista, porque hace nuestro código menos portable y testable. Para estos menesteres, disponemos de un objeto JavaScript llamado <code>Controller</code>, que va a gestionar qué datos se pasan a la vista, si éstos se actualizan y, también, va a comunicarse con el servidor en caso de que haya que actializar información en su lado.</p>
</div>
<div class="paragraph">
<p>Entre la vista y el controlador, hay un elemento llamado <code>scope</code>. El <code>scope</code> es el "pegamento" que une la vista y el controlador. Ni la vista sabe nada del controlador, ni el controlador de la vista. Nuevamente, esto nos permite hacer nuestro código muy modular y testable, al no haber una relación directa entre estos elementos.</p>
</div>
<div class="paragraph">
<p>Otra ventaja, es que podemos tener un único controlador vinculado a diferentes vistas. Por ejemplo, podemos tener una vista para una versión mobile otra para una versión desktop asociadas al mismo controlador.</p>
</div>
<div class="paragraph">
<p>¿Y qué es exactamente un ViewModel? Un ViewModel no es, ni más ni menos, que los datos que van a ser gestionados por la vista. Y eso es lo que el <code>scope</code> es.</p>
</div>
<div class="paragraph">
<p>Vamos a transformar nuestro último ejemplo, creando un controlador y pasando los datos a la vista, en lugar de declararlos en ella.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="html"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33</div></td><td class="code"><span class="tok-cp">&lt;!DOCTYPE html&gt;</span>
<span class="tok-nt">&lt;html</span> <span class="tok-na">ng-app</span><span class="tok-nt">&gt;</span>
    <span class="tok-nt">&lt;head&gt;</span>
        <span class="tok-nt">&lt;title&gt;</span>Una tarde con AngularJS<span class="tok-nt">&lt;/title&gt;</span>
        <span class="tok-nt">&lt;meta</span> <span class="tok-na">charset=</span><span class="tok-s">&quot;UTF-8&quot;</span><span class="tok-nt">&gt;</span>
        <span class="tok-nt">&lt;meta</span> <span class="tok-na">name=</span><span class="tok-s">&quot;viewport&quot;</span> <span class="tok-na">content=</span><span class="tok-s">&quot;width=device-width, initial-scale=1.0&quot;</span><span class="tok-nt">&gt;</span>
        <span class="tok-nt">&lt;link</span> <span class="tok-na">rel=</span><span class="tok-s">&quot;stylesheet&quot;</span> <span class="tok-na">href=</span><span class="tok-s">&quot;components/lib/twitter-bootstrap/css/bootstrap.css&quot;</span> <span class="tok-nt">/&gt;</span>
    <span class="tok-nt">&lt;/head&gt;</span>
    <span class="tok-nt">&lt;body&gt;</span>
        <span class="tok-nt">&lt;div</span> <span class="tok-na">class=</span><span class="tok-s">&quot;container&quot;</span> <span class="tok-na">ng-controller=</span><span class="tok-s">&quot;TeachersCtrl&quot;</span><span class="tok-nt">&gt;</span>
            <span class="tok-nt">&lt;label&gt;</span>Filtro:<span class="tok-nt">&lt;/label&gt;</span> <span class="tok-nt">&lt;input</span> <span class="tok-na">type=</span><span class="tok-s">&quot;text&quot;</span> <span class="tok-na">ng-model=</span><span class="tok-s">&quot;textFilter&quot;</span> <span class="tok-nt">/&gt;&lt;br/&gt;</span>
            <span class="tok-nt">&lt;ul&gt;</span>
                <span class="tok-nt">&lt;li</span> <span class="tok-na">ng-repeat=</span><span class="tok-s">&quot;person in filteredPeople = (people | filter:textFilter | orderBy:&#39;name&#39;)&quot;</span><span class="tok-nt">&gt;</span>{{ person.name }} - {{ person.subject | uppercase }}<span class="tok-nt">&lt;/li&gt;</span>
            <span class="tok-nt">&lt;/ul&gt;</span>
            Encontrados {{ filteredPeople.length }} resultados.
        <span class="tok-nt">&lt;/div&gt;</span>
        <span class="tok-nt">&lt;script </span><span class="tok-na">src=</span><span class="tok-s">&quot;https://code.angularjs.org/1.2.16/angular.min.js&quot;</span><span class="tok-nt">&gt;&lt;/script&gt;</span>
        <span class="tok-nt">&lt;script&gt;</span>
            <span class="tok-kd">function</span> <span class="tok-nx">TeachersCtrl</span><span class="tok-p">(</span><span class="tok-nx">$scope</span><span class="tok-p">){</span>
                <span class="tok-nx">$scope</span><span class="tok-p">.</span><span class="tok-nx">people</span> <span class="tok-o">=</span> <span class="tok-p">[</span>
                    <span class="tok-p">{</span><span class="tok-nx">name</span><span class="tok-o">:</span><span class="tok-s1">&#39;Domingo&#39;</span><span class="tok-p">,</span> <span class="tok-nx">subject</span><span class="tok-o">:</span><span class="tok-s1">&#39;JPA&#39;</span><span class="tok-p">},</span>
                    <span class="tok-p">{</span><span class="tok-nx">name</span><span class="tok-o">:</span><span class="tok-s1">&#39;Otto&#39;</span><span class="tok-p">,</span> <span class="tok-nx">subject</span><span class="tok-o">:</span><span class="tok-s1">&#39;Backbone&#39;</span><span class="tok-p">},</span>
                    <span class="tok-p">{</span><span class="tok-nx">name</span><span class="tok-o">:</span><span class="tok-s1">&#39;Aitor&#39;</span><span class="tok-p">,</span><span class="tok-nx">subject</span><span class="tok-o">:</span><span class="tok-s1">&#39;JavaScript&#39;</span><span class="tok-p">},</span>
                    <span class="tok-p">{</span><span class="tok-nx">name</span><span class="tok-o">:</span><span class="tok-s1">&#39;Miguel Ángel&#39;</span><span class="tok-p">,</span><span class="tok-nx">subject</span><span class="tok-o">:</span><span class="tok-s1">&#39;JHD&#39;</span><span class="tok-p">},</span>
                    <span class="tok-p">{</span><span class="tok-nx">name</span><span class="tok-o">:</span><span class="tok-s1">&#39;Eli&#39;</span><span class="tok-p">,</span> <span class="tok-nx">subject</span><span class="tok-o">:</span><span class="tok-s1">&#39;REST&#39;</span><span class="tok-p">},</span>
                    <span class="tok-p">{</span><span class="tok-nx">name</span><span class="tok-o">:</span><span class="tok-s1">&#39;Fran&#39;</span><span class="tok-p">,</span> <span class="tok-nx">subject</span><span class="tok-o">:</span><span class="tok-s1">&#39;Grails&#39;</span><span class="tok-p">},</span>
                    <span class="tok-p">{</span><span class="tok-nx">name</span><span class="tok-o">:</span><span class="tok-s1">&#39;José Luís&#39;</span><span class="tok-p">,</span> <span class="tok-nx">subject</span><span class="tok-o">:</span><span class="tok-s1">&#39;PaaS&#39;</span><span class="tok-p">},</span>
                    <span class="tok-p">{</span><span class="tok-nx">name</span><span class="tok-o">:</span><span class="tok-s1">&#39;Alex&#39;</span><span class="tok-p">,</span> <span class="tok-nx">subject</span><span class="tok-o">:</span><span class="tok-s1">&#39;AngularJS&#39;</span><span class="tok-p">}</span>
                <span class="tok-p">];</span>
            <span class="tok-p">}</span>
        <span class="tok-nt">&lt;/script&gt;</span>
    <span class="tok-nt">&lt;/body&gt;</span>
<span class="tok-nt">&lt;/html&gt;</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>Vemos que nuestro controlador es, simplemente, una función JavaScript. Una cosa interesante es que le pasamos como parámetro la variable <code>$scope</code>. Este <code>$scope</code> se pasa por Inyección de Dependencias, otra de las características de AngularJS de las que hemos hablado. En el momento en que se usa este controlador, AngularJS le inyectará de manera automática el objeto <code>$scope</code>. Una vez lo tenga, el controlador le añade una propiedad, llamada people, que es el array que anteriormente habíamos declarado en nuestra vista.</p>
</div>
<div class="paragraph">
<p>El controlador actúa como fuente de datos para la vista, pero no debería saber nada de la vista. Así que por eso inyectamos la variable <code>$scope</code>. Ésta va a permitir que nuestro controlador se comunique con la vista. El <code>$scope</code> pasará a la vista, una vez ésta sepa cuál es el controlador que la gestiona. Esto lo conseguimos gracias al atributo <code>ng-controller="TeachersCtrl"</code>. El <code>scope</code> estará visible para el <code>div</code> que lo ha llamado, así como para sus hijos. Vemos que el resto de nuestro código no ha variado y podemos seguir accediendo a la colección <code>people</code>. Solo que ahora estamos accediendo a la propiedad <code>people</code> del <code>$scope</code>.</p>
</div>
</div>
<div class="sect2">
<h3 id="_módulos_rutas_y_factorías">2.6. Módulos, Rutas y Factorías</h3>
<div class="paragraph">
<p>Ya hemos visto cómo funciona el <em>data binding</em>, las directivas, los filtros, controladores, cómo integramos una vista y un controlador gracias al objeto <code>$scope</code>&#8230;&#8203; ¡Ya casi estamos listos para crear una aplicación completa en AngularJS!</p>
</div>
<div class="paragraph">
<p>Ahora vamos a ver cómo modularizar nuestra aplicación, y conceptos como Rutas y Factorías.</p>
</div>
<div class="paragraph">
<p>En AngularJS, un módulo puede tener una función de configuración. En esta función es donde, entre otras cosas, podemos definir rutas. Las rutas son importantes porque si nuestra aplicación tiene varias vistas, y éstas deben ser cargadas en nuestra página, debemos entonces tener un mecanismo para saber dónde estamos, qué vista tenemos asociada, qué controlador la gestiona&#8230;&#8203;</p>
</div>
<div class="paragraph">
<p>Cuando definimos una ruta en AngularJS, también debemos definir dos elementos:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Una vista. Por ejemplo, si estamos en la ruta <code>/profile</code>, entonces mostraremos la vista <code>/partials/profile.html</code></p>
</li>
<li>
<p>Un controlador. En lugar de definir el controlador en la vista con la etiqueta <code>ng-controller</code>, podemos establecerlo al definir una ruta. Siguiendo con el ejemplo anterior, asociaríamos el controlador <code>ProfileCtrl</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Un controlador no debería tener toda la lógica de la aplicación. En una aplicación bien estructurada, esta lógica la sacaríamos fuera a unos objetos que, en AngularJS, se llaman <em>Factories</em>, <em>Services</em> y <em>Providers</em>.</p>
</div>
<div class="paragraph">
<p>En la vista, tenemos el apoyo de las directivas y filtros, algunos de las cuales ya hemos visto.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="img/ses02/006.png" alt="{large-size}">
</div>
</div>
<div class="paragraph">
<p>Para poder definir rutas, tenemos que estructurar nuestra aplicación un poquito mejor de lo que hemos hecho hasta ahora. Aunque lo que hemos hecho hasta ahora es una aplicación AngularJS, no es la manera recomendada de implementarla.</p>
</div>
<div class="paragraph">
<p>En primer lugar, tenemos que definir un módulo en nuestra etiqueta <code>ng-app</code>, cosa que no habíamos hecho aún. Dentro de nuestro objeto <code>module</code> es donde vamos a poder configurar nuestras rutas, y también definir filtros, directivas, controladores, factorías, y demás servicios que serán específicos para nuestra app. Podríamos pensar en un <code>module</code> como un contenedor de objetos donde podemos tener todas estas cosas.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="img/ses02/007.png" alt="{large-size}">
</div>
</div>
<div class="paragraph">
<p>Lo importante es definir un nombre para nuestro módulo. Como estamos haciendo una pequeña aplicación que muestra un listado de profesores y asignaturas, la llamaremos <code>teachersApp</code>. Éste es el nombre que irá en nuestra etiqueta [ng-app].</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="html"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1</div></td><td class="code"><span class="tok-nt">&lt;html</span> <span class="tok-na">ng-app=</span><span class="tok-s">&quot;teachersApp&quot;</span><span class="tok-nt">&gt;</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>Y ésta es la manera de crear un módulo en AngularJS:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="javascript"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1</div></td><td class="code"><span class="tok-kd">var</span> <span class="tok-nx">teachersApp</span> <span class="tok-o">=</span> <span class="tok-nx">angular</span><span class="tok-p">.</span><span class="tok-nx">module</span><span class="tok-p">(</span><span class="tok-s1">&#39;teachersApp&#39;</span><span class="tok-p">,</span> <span class="tok-p">[]);</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>Fácil, ¿no?. Con esto, estamos creando un módulo, y diciendo a AngularJS que se va a llamar <em>teachersApp</em>. Vemos que está seguido por un array vacío. Aquí es donde vemos la potencia de la inyección de dependencias. Resulta que nuestro módulo puede incluir otros módulos de los que nuestra aplicación depende en cierto grado. Por ejemplo, en el siguiente fragmento estamos incluyendo un módulo llamado <code>myCustomModule</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="javascript"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1</div></td><td class="code"><span class="tok-kd">var</span> <span class="tok-nx">teachersApp</span> <span class="tok-o">=</span> <span class="tok-nx">angular</span><span class="tok-p">.</span><span class="tok-nx">module</span><span class="tok-p">(</span><span class="tok-s1">&#39;teachersApp&#39;</span><span class="tok-p">,</span> <span class="tok-p">[</span><span class="tok-s1">&#39;myCustomModule&#39;</span><span class="tok-p">]);</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>Aquí, estamos diciendo a Angular que busque otro módulo, llamado <code>myCustomModule</code>, y lo inyecte en el nuestro, de manera que todos sus elementos (directivas, filtros, factorías, &#8230;&#8203;) estarán disponibles en el momento que los inyectemos.</p>
</div>
<div class="paragraph">
<p>Haciendo una analogía, el incluir aquí estos elementos sería como hacer un <code>import</code> de un paquete completo en Java.</p>
</div>
<div class="paragraph">
<p>Crear un controlador para nuestro módulo no es nada distinto a como lo hemos hecho hasta ahora. La única diferencia radica en que hay que definirlo dentro de nuestro módulo:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="javascript"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12</div></td><td class="code"><span class="tok-nx">teachersApp</span><span class="tok-p">.</span><span class="tok-nx">controller</span><span class="tok-p">(</span><span class="tok-s1">&#39;teachersCtrl&#39;</span><span class="tok-p">,</span> <span class="tok-kd">function</span><span class="tok-p">(</span><span class="tok-nx">$scope</span><span class="tok-p">){</span>
   <span class="tok-nx">$scope</span><span class="tok-p">.</span><span class="tok-nx">people</span> <span class="tok-o">=</span> <span class="tok-p">[</span>
        <span class="tok-p">{</span><span class="tok-nx">name</span><span class="tok-o">:</span><span class="tok-s1">&#39;Domingo&#39;</span><span class="tok-p">,</span> <span class="tok-nx">subject</span><span class="tok-o">:</span><span class="tok-s1">&#39;JPA&#39;</span><span class="tok-p">},</span>
        <span class="tok-p">{</span><span class="tok-nx">name</span><span class="tok-o">:</span><span class="tok-s1">&#39;Otto&#39;</span><span class="tok-p">,</span> <span class="tok-nx">subject</span><span class="tok-o">:</span><span class="tok-s1">&#39;Backbone&#39;</span><span class="tok-p">},</span>
        <span class="tok-p">{</span><span class="tok-nx">name</span><span class="tok-o">:</span><span class="tok-s1">&#39;Aitor&#39;</span><span class="tok-p">,</span><span class="tok-nx">subject</span><span class="tok-o">:</span><span class="tok-s1">&#39;JavaScript&#39;</span><span class="tok-p">},</span>
        <span class="tok-p">{</span><span class="tok-nx">name</span><span class="tok-o">:</span><span class="tok-s1">&#39;Miguel Ángel&#39;</span><span class="tok-p">,</span><span class="tok-nx">subject</span><span class="tok-o">:</span><span class="tok-s1">&#39;JHD&#39;</span><span class="tok-p">},</span>
        <span class="tok-p">{</span><span class="tok-nx">name</span><span class="tok-o">:</span><span class="tok-s1">&#39;Eli&#39;</span><span class="tok-p">,</span> <span class="tok-nx">subject</span><span class="tok-o">:</span><span class="tok-s1">&#39;REST&#39;</span><span class="tok-p">},</span>
        <span class="tok-p">{</span><span class="tok-nx">name</span><span class="tok-o">:</span><span class="tok-s1">&#39;Fran&#39;</span><span class="tok-p">,</span> <span class="tok-nx">subject</span><span class="tok-o">:</span><span class="tok-s1">&#39;Grails&#39;</span><span class="tok-p">},</span>
        <span class="tok-p">{</span><span class="tok-nx">name</span><span class="tok-o">:</span><span class="tok-s1">&#39;José Luís&#39;</span><span class="tok-p">,</span> <span class="tok-nx">subject</span><span class="tok-o">:</span><span class="tok-s1">&#39;PaaS&#39;</span><span class="tok-p">},</span>
        <span class="tok-p">{</span><span class="tok-nx">name</span><span class="tok-o">:</span><span class="tok-s1">&#39;Alex&#39;</span><span class="tok-p">,</span> <span class="tok-nx">subject</span><span class="tok-o">:</span><span class="tok-s1">&#39;AngularJS&#39;</span><span class="tok-p">}</span>
    <span class="tok-p">];</span>
<span class="tok-p">});</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>La manera de llamar al controlador desde la vista es exactamente la misma que hace un rato.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="html"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35</div></td><td class="code"><span class="tok-cp">&lt;!DOCTYPE html&gt;</span>
<span class="tok-nt">&lt;html</span> <span class="tok-na">ng-app=</span><span class="tok-s">&quot;teachersApp&quot;</span><span class="tok-nt">&gt;</span>
    <span class="tok-nt">&lt;head&gt;</span>
        <span class="tok-nt">&lt;title&gt;</span>Una tarde con AngularJS<span class="tok-nt">&lt;/title&gt;</span>
        <span class="tok-nt">&lt;meta</span> <span class="tok-na">charset=</span><span class="tok-s">&quot;UTF-8&quot;</span><span class="tok-nt">&gt;</span>
        <span class="tok-nt">&lt;meta</span> <span class="tok-na">name=</span><span class="tok-s">&quot;viewport&quot;</span> <span class="tok-na">content=</span><span class="tok-s">&quot;width=device-width, initial-scale=1.0&quot;</span><span class="tok-nt">&gt;</span>
        <span class="tok-nt">&lt;link</span> <span class="tok-na">rel=</span><span class="tok-s">&quot;stylesheet&quot;</span> <span class="tok-na">href=</span><span class="tok-s">&quot;components/lib/twitter-bootstrap/css/bootstrap.css&quot;</span> <span class="tok-nt">/&gt;</span>
    <span class="tok-nt">&lt;/head&gt;</span>
    <span class="tok-nt">&lt;body</span> <span class="tok-na">ng-controller=</span><span class="tok-s">&quot;TeachersCtrl&quot;</span><span class="tok-nt">&gt;</span>
        <span class="tok-nt">&lt;div</span> <span class="tok-na">class=</span><span class="tok-s">&quot;container&quot;</span><span class="tok-nt">&gt;</span>
            <span class="tok-nt">&lt;label&gt;</span>Filtro:<span class="tok-nt">&lt;/label&gt;</span> <span class="tok-nt">&lt;input</span> <span class="tok-na">type=</span><span class="tok-s">&quot;text&quot;</span> <span class="tok-na">ng-model=</span><span class="tok-s">&quot;textFilter&quot;</span> <span class="tok-nt">/&gt;&lt;br/&gt;</span>
            <span class="tok-nt">&lt;ul&gt;</span>
                <span class="tok-nt">&lt;li</span> <span class="tok-na">ng-repeat=</span><span class="tok-s">&quot;person in filteredPeople = (people | filter:textFilter | orderBy:&#39;name&#39;)&quot;</span><span class="tok-nt">&gt;</span>{{ person.name }} - {{ person.subject | uppercase }}<span class="tok-nt">&lt;/li&gt;</span>
            <span class="tok-nt">&lt;/ul&gt;</span>
            Encontrados {{ filteredPeople.length }} resultados.
        <span class="tok-nt">&lt;/div&gt;</span>
        <span class="tok-nt">&lt;script </span><span class="tok-na">src=</span><span class="tok-s">&quot;https://code.angularjs.org/1.2.16/angular.min.js&quot;</span><span class="tok-nt">&gt;&lt;/script&gt;</span>
        <span class="tok-nt">&lt;script&gt;</span>
            <span class="tok-kd">var</span> <span class="tok-nx">teachersApp</span> <span class="tok-o">=</span> <span class="tok-nx">angular</span><span class="tok-p">.</span><span class="tok-nx">module</span><span class="tok-p">(</span><span class="tok-s1">&#39;teachersApp&#39;</span><span class="tok-p">,</span> <span class="tok-p">[]);</span>

            <span class="tok-nx">teachersApp</span><span class="tok-p">.</span><span class="tok-nx">controller</span><span class="tok-p">(</span><span class="tok-s1">&#39;TeachersCtrl&#39;</span><span class="tok-p">,</span> <span class="tok-kd">function</span><span class="tok-p">(</span><span class="tok-nx">$scope</span><span class="tok-p">){</span>
               <span class="tok-nx">$scope</span><span class="tok-p">.</span><span class="tok-nx">people</span> <span class="tok-o">=</span> <span class="tok-p">[</span>
                    <span class="tok-p">{</span><span class="tok-nx">name</span><span class="tok-o">:</span><span class="tok-s1">&#39;Domingo&#39;</span><span class="tok-p">,</span> <span class="tok-nx">subject</span><span class="tok-o">:</span><span class="tok-s1">&#39;JPA&#39;</span><span class="tok-p">},</span>
                    <span class="tok-p">{</span><span class="tok-nx">name</span><span class="tok-o">:</span><span class="tok-s1">&#39;Otto&#39;</span><span class="tok-p">,</span> <span class="tok-nx">subject</span><span class="tok-o">:</span><span class="tok-s1">&#39;Backbone&#39;</span><span class="tok-p">},</span>
                    <span class="tok-p">{</span><span class="tok-nx">name</span><span class="tok-o">:</span><span class="tok-s1">&#39;Aitor&#39;</span><span class="tok-p">,</span><span class="tok-nx">subject</span><span class="tok-o">:</span><span class="tok-s1">&#39;JavaScript&#39;</span><span class="tok-p">},</span>
                    <span class="tok-p">{</span><span class="tok-nx">name</span><span class="tok-o">:</span><span class="tok-s1">&#39;Miguel Ángel&#39;</span><span class="tok-p">,</span><span class="tok-nx">subject</span><span class="tok-o">:</span><span class="tok-s1">&#39;JHD&#39;</span><span class="tok-p">},</span>
                    <span class="tok-p">{</span><span class="tok-nx">name</span><span class="tok-o">:</span><span class="tok-s1">&#39;Eli&#39;</span><span class="tok-p">,</span> <span class="tok-nx">subject</span><span class="tok-o">:</span><span class="tok-s1">&#39;REST&#39;</span><span class="tok-p">},</span>
                    <span class="tok-p">{</span><span class="tok-nx">name</span><span class="tok-o">:</span><span class="tok-s1">&#39;Fran&#39;</span><span class="tok-p">,</span> <span class="tok-nx">subject</span><span class="tok-o">:</span><span class="tok-s1">&#39;Grails&#39;</span><span class="tok-p">},</span>
                    <span class="tok-p">{</span><span class="tok-nx">name</span><span class="tok-o">:</span><span class="tok-s1">&#39;José Luís&#39;</span><span class="tok-p">,</span> <span class="tok-nx">subject</span><span class="tok-o">:</span><span class="tok-s1">&#39;PaaS&#39;</span><span class="tok-p">},</span>
                    <span class="tok-p">{</span><span class="tok-nx">name</span><span class="tok-o">:</span><span class="tok-s1">&#39;Alex&#39;</span><span class="tok-p">,</span> <span class="tok-nx">subject</span><span class="tok-o">:</span><span class="tok-s1">&#39;AngularJS&#39;</span><span class="tok-p">}</span>
                <span class="tok-p">];</span>
            <span class="tok-p">});</span>
        <span class="tok-nt">&lt;/script&gt;</span>
    <span class="tok-nt">&lt;/body&gt;</span>
<span class="tok-nt">&lt;/html&gt;</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>En el ejemplo, hemos decidido refactorizar nuestro código y crear una función anónima para el controlador. Recordemos que esto es JavaScript, donde las funciones se pueden pasar como argumentos. Otra manera de hacer lo mismo tocando menos código hubiera sido:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="javascript"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14</div></td><td class="code"><span class="tok-kd">function</span> <span class="tok-nx">TeachersCtrl</span><span class="tok-p">(</span><span class="tok-nx">$scope</span><span class="tok-p">){</span>
    <span class="tok-nx">$scope</span><span class="tok-p">.</span><span class="tok-nx">people</span> <span class="tok-o">=</span> <span class="tok-p">[</span>
        <span class="tok-p">{</span><span class="tok-nx">name</span><span class="tok-o">:</span><span class="tok-s1">&#39;Domingo&#39;</span><span class="tok-p">,</span> <span class="tok-nx">subject</span><span class="tok-o">:</span><span class="tok-s1">&#39;JPA&#39;</span><span class="tok-p">},</span>
        <span class="tok-p">{</span><span class="tok-nx">name</span><span class="tok-o">:</span><span class="tok-s1">&#39;Otto&#39;</span><span class="tok-p">,</span> <span class="tok-nx">subject</span><span class="tok-o">:</span><span class="tok-s1">&#39;Backbone&#39;</span><span class="tok-p">},</span>
        <span class="tok-p">{</span><span class="tok-nx">name</span><span class="tok-o">:</span><span class="tok-s1">&#39;Aitor&#39;</span><span class="tok-p">,</span><span class="tok-nx">subject</span><span class="tok-o">:</span><span class="tok-s1">&#39;JavaScript&#39;</span><span class="tok-p">},</span>
        <span class="tok-p">{</span><span class="tok-nx">name</span><span class="tok-o">:</span><span class="tok-s1">&#39;Miguel Ángel&#39;</span><span class="tok-p">,</span><span class="tok-nx">subject</span><span class="tok-o">:</span><span class="tok-s1">&#39;JHD&#39;</span><span class="tok-p">},</span>
        <span class="tok-p">{</span><span class="tok-nx">name</span><span class="tok-o">:</span><span class="tok-s1">&#39;Eli&#39;</span><span class="tok-p">,</span> <span class="tok-nx">subject</span><span class="tok-o">:</span><span class="tok-s1">&#39;REST&#39;</span><span class="tok-p">},</span>
        <span class="tok-p">{</span><span class="tok-nx">name</span><span class="tok-o">:</span><span class="tok-s1">&#39;Fran&#39;</span><span class="tok-p">,</span> <span class="tok-nx">subject</span><span class="tok-o">:</span><span class="tok-s1">&#39;Grails&#39;</span><span class="tok-p">},</span>
        <span class="tok-p">{</span><span class="tok-nx">name</span><span class="tok-o">:</span><span class="tok-s1">&#39;José Luís&#39;</span><span class="tok-p">,</span> <span class="tok-nx">subject</span><span class="tok-o">:</span><span class="tok-s1">&#39;PaaS&#39;</span><span class="tok-p">},</span>
        <span class="tok-p">{</span><span class="tok-nx">name</span><span class="tok-o">:</span><span class="tok-s1">&#39;Alex&#39;</span><span class="tok-p">,</span> <span class="tok-nx">subject</span><span class="tok-o">:</span><span class="tok-s1">&#39;AngularJS&#39;</span><span class="tok-p">}</span>
    <span class="tok-p">];</span>
<span class="tok-p">}</span>
<span class="tok-kd">var</span> <span class="tok-nx">teachersApp</span> <span class="tok-o">=</span> <span class="tok-nx">angular</span><span class="tok-p">.</span><span class="tok-nx">module</span><span class="tok-p">(</span><span class="tok-s1">&#39;teachersApp&#39;</span><span class="tok-p">,</span> <span class="tok-p">[]);</span>
<span class="tok-nx">teachersApp</span><span class="tok-p">.</span><span class="tok-nx">controller</span><span class="tok-p">(</span><span class="tok-s1">&#39;TeachersCtrl&#39;</span><span class="tok-p">,</span> <span class="tok-nx">TeachersCtrl</span><span class="tok-p">);</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>Una vez hemos definido un módulo y un controlador, en algún momento vamos a tener que definir rutas para nuestra aplicación SPA.</p>
</div>
<div class="paragraph">
<p>Veamos aquí un ejemplo de rutas para una aplicación. En algún momento, debido a un evento, nuestra aplicación pasará de la vista 1 a la 2, mapeada por la ruta <code>/view2</code>, de la 2 a la 3&#8230;&#8203; y así realizando un ciclo.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="img/ses02/008.png" alt="{large-size}">
</div>
</div>
<div class="paragraph">
<p>Lo importante aquí es saber que, con el cambio de ruta, no se recargará la página completa, sino el bloque que nosotros hayamos indicado.</p>
</div>
<div class="paragraph">
<p>La manera de definir estos bloques puede ser:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Como una plantilla dentro de nuestro <code>index.html</code>.</p>
</li>
<li>
<p>Como ficheros HTML independientes, habitualmente conocidos como <code>partials</code>. Ésta suele ser la manera habitual de hacerlo, sobre todo en aplicaciones grandes.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>A partir de la versión 1.2, el módulo de rutas se extrajo del core de AngularJS como módulo independiente, con lo que lo primero que tendremos que hacer es traernos este módulo:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="html"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1</div></td><td class="code"><span class="tok-nt">&lt;script </span><span class="tok-na">src=</span><span class="tok-s">&quot;https://code.angularjs.org/1.2.16/angular-route.min.js&quot;</span><span class="tok-nt">&gt;&lt;/script&gt;</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>Como hemos mencionado anteriormente, para incluir módulos extras en el nuestro, tenemos que declararlo en la definición:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="javascript"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1</div></td><td class="code"><span class="tok-kd">var</span> <span class="tok-nx">teachersApp</span> <span class="tok-o">=</span> <span class="tok-nx">angular</span><span class="tok-p">.</span><span class="tok-nx">module</span><span class="tok-p">(</span><span class="tok-s1">&#39;teachersApp&#39;</span><span class="tok-p">,</span> <span class="tok-p">[</span><span class="tok-s1">&#39;ngRoute&#39;</span><span class="tok-p">]);</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>Una vez hecho esto, ya podemos definir las rutas. Hemos dicho anteriormente que un módulo de AngularJS tenía una función de configuración, donde definíamos las rutas. Vamos a usar esta función, a la que tenemos que inyectarle un objeto llamado <code>$routeProvider</code>.</p>
</div>
<div class="paragraph">
<p>Vamos a definir dos rutas en nuestra aplicación:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>La primera será el listado de profesores que hemos hecho antes.</p>
</li>
<li>
<p>La segunda consistirá en una página de asignaturas. Como aún no lo hemos implementado, mostrará un bonito mensaje de <em>En construcción</em>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>En cualquier otro caso, podemos definir una ruta por defecto a la que seremos redirigidos si introducimos algo a donde nuestra aplicación no sabe qué hacer con ello. Para este ejemplo, será la lista de profesores:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="javascript"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11</div></td><td class="code"><span class="tok-nx">teachersApp</span><span class="tok-p">.</span><span class="tok-nx">config</span><span class="tok-p">(</span><span class="tok-kd">function</span><span class="tok-p">(</span><span class="tok-nx">$routeProvider</span><span class="tok-p">){</span>
    <span class="tok-nx">$routeProvider</span>
        <span class="tok-p">.</span><span class="tok-nx">when</span><span class="tok-p">(</span><span class="tok-s1">&#39;/teachers&#39;</span><span class="tok-p">,{</span>
            <span class="tok-nx">controller</span> <span class="tok-o">:</span> <span class="tok-s1">&#39;teachersCtrl&#39;</span><span class="tok-p">,</span>
            <span class="tok-nx">templateUrl</span> <span class="tok-o">:</span> <span class="tok-s1">&#39;teachers.html&#39;</span>
        <span class="tok-p">})</span>
        <span class="tok-p">.</span><span class="tok-nx">when</span><span class="tok-p">(</span><span class="tok-s1">&#39;/subjects&#39;</span><span class="tok-p">,{</span>
            <span class="tok-nx">templateUrl</span> <span class="tok-o">:</span> <span class="tok-s1">&#39;subjects.html&#39;</span>
        <span class="tok-p">})</span>
        <span class="tok-p">.</span><span class="tok-nx">otherwise</span><span class="tok-p">({</span> <span class="tok-nx">redirectTo</span> <span class="tok-o">:</span> <span class="tok-s1">&#39;/teachers&#39;</span><span class="tok-p">});</span>
<span class="tok-p">});</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>Para cada ruta, podemos definir una plantilla y un controlador. La configuración de rutas no obliga a introducir un par controlador - plantilla, como vemos en la segunda ruta.</p>
</div>
<div class="paragraph">
<p>Para adaptar nuestra aplicación a lo que acabamos de definir, tenremos que crearnos una página HTML, a la que llamaremos teachers.html. En ella estará el listado de profesores.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="html"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3
4
5</div></td><td class="code"><span class="tok-nt">&lt;label&gt;</span>Filtro:<span class="tok-nt">&lt;/label&gt;</span> <span class="tok-nt">&lt;input</span> <span class="tok-na">type=</span><span class="tok-s">&quot;text&quot;</span> <span class="tok-na">ng-model=</span><span class="tok-s">&quot;textFilter&quot;</span> <span class="tok-nt">/&gt;&lt;br/&gt;</span>
<span class="tok-nt">&lt;ul&gt;</span>
    <span class="tok-nt">&lt;li</span> <span class="tok-na">ng-repeat=</span><span class="tok-s">&quot;person in filteredPeople = (people | filter:textFilter | orderBy:&#39;name&#39;)&quot;</span><span class="tok-nt">&gt;</span>{{ person.name }} - {{ person.subject | uppercase }}<span class="tok-nt">&lt;/li&gt;</span>
<span class="tok-nt">&lt;/ul&gt;</span>
Encontrados {{ filteredPeople.length }} resultados.
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>Tendremos que refactorizar nuestro fichero <code>index.html</code> e introducir una nueva directiva, llamada <code>ng-view</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="html"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20</div></td><td class="code"><span class="tok-cp">&lt;!DOCTYPE html&gt;</span>
<span class="tok-nt">&lt;html</span> <span class="tok-na">ng-app=</span><span class="tok-s">&quot;teachersApp&quot;</span><span class="tok-nt">&gt;</span>
    <span class="tok-nt">&lt;head&gt;</span>
        ...
    <span class="tok-nt">&lt;/head&gt;</span>
    <span class="tok-nt">&lt;body</span> <span class="tok-na">ng-controller=</span><span class="tok-s">&quot;teachersCtrl&quot;</span><span class="tok-nt">&gt;</span>
        <span class="tok-nt">&lt;div</span> <span class="tok-na">class=</span><span class="tok-s">&quot;container&quot;</span><span class="tok-nt">&gt;</span>
            <span class="tok-nt">&lt;ul</span> <span class="tok-na">class=</span><span class="tok-s">&quot;nav nav-pills nav-justified&quot;</span><span class="tok-nt">&gt;</span>
                <span class="tok-nt">&lt;li&gt;&lt;a</span> <span class="tok-na">href=</span><span class="tok-s">&quot;#/teachers&quot;</span><span class="tok-nt">&gt;</span>Profesores<span class="tok-nt">&lt;/a&gt;&lt;/li&gt;</span>
                <span class="tok-nt">&lt;li&gt;&lt;a</span> <span class="tok-na">href=</span><span class="tok-s">&quot;#/subjects&quot;</span><span class="tok-nt">&gt;</span>Asignaturas<span class="tok-nt">&lt;/a&gt;&lt;/li&gt;</span>
            <span class="tok-nt">&lt;/ul&gt;</span>
            <span class="tok-nt">&lt;ng-view&gt;&lt;/ng-view&gt;</span>
        <span class="tok-nt">&lt;/div&gt;</span>
        <span class="tok-nt">&lt;script </span><span class="tok-na">src=</span><span class="tok-s">&quot;https://code.angularjs.org/1.2.16/angular.min.js&quot;</span><span class="tok-nt">&gt;&lt;/script&gt;</span>
        <span class="tok-nt">&lt;script </span><span class="tok-na">src=</span><span class="tok-s">&quot;https://code.angularjs.org/1.2.16/angular-route.min.js&quot;</span><span class="tok-nt">&gt;&lt;/script&gt;</span>
        <span class="tok-nt">&lt;script&gt;</span>
            <span class="tok-p">...</span>
        <span class="tok-nt">&lt;/script&gt;</span>
    <span class="tok-nt">&lt;/body&gt;</span>
<span class="tok-nt">&lt;/html&gt;</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>La directiva <code>ng-view</code> complementa al servicio <code>$route</code>, incluyendo la plantilla que hemos definido en la función <code>config</code>. Cada vez que la ruta cambia, la vista cambiará en función de lo configurado. La directiva <code>ng-view</code> puede ser tanto una etiqueta como un atributo, con lo que os la podréis encontrar habitualmente con la forma: <code>&lt;div ng-view&gt;&lt;/div&gt;</code>.</p>
</div>
<div class="paragraph">
<p>Justo antes de la directiva <code>ng-view</code> hemos definido dos links, que nos permitirán navegar por la aplicación. Al no estar incluídos dentro del bloque <code>ng-view</code>, éstos permanecerán invariables durante toda la navegación.</p>
</div>
<div class="paragraph">
<p>Haciendo click en el enlace <em>asignaturas</em>, llegaremos a una página en construcción, que mantiene los elementos. Observando la barra de dirección, veremos que la ruta ha cambiado. Y lo más increíble de todo, es que si hacemos click en el <em>back button</em> del navegador, volveremos al listado de profesores. El histórico del navegador funciona&#8230;&#8203; ¡y sin hacer nada! AngularJS se encarga de gestionar el histórico del navegador.</p>
</div>
<div class="sect3">
<h4 id="_comunicándonos_con_el_controlador">2.6.1. Comunicándonos con el controlador</h4>
<div class="paragraph">
<p>Ahora que tenemos nuestra lógica de navegación implementada, vamos a ver de qué manera podemos comunicarnos con el controlador. Para ello, en el listado de profesores, vamos a introducir la posibilidad de crear uno nuevo.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="html"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11</div></td><td class="code"><span class="tok-nt">&lt;h1&gt;</span>Profesorado<span class="tok-nt">&lt;/h1&gt;</span>
<span class="tok-nt">&lt;label&gt;</span>Filtro:<span class="tok-nt">&lt;/label&gt;</span> <span class="tok-nt">&lt;input</span> <span class="tok-na">type=</span><span class="tok-s">&quot;text&quot;</span> <span class="tok-na">ng-model=</span><span class="tok-s">&quot;textFilter&quot;</span> <span class="tok-nt">/&gt;&lt;br/&gt;</span>
<span class="tok-nt">&lt;ul&gt;</span>
    <span class="tok-nt">&lt;li</span> <span class="tok-na">ng-repeat=</span><span class="tok-s">&quot;person in filteredPeople = (people | filter:textFilter | orderBy:&#39;name&#39;)&quot;</span><span class="tok-nt">&gt;</span>{{ person.name }} - {{ person.subject | uppercase }}<span class="tok-nt">&lt;/li&gt;</span>
<span class="tok-nt">&lt;/ul&gt;</span>
Encontrados {{ filteredPeople.length }} resultados.
<span class="tok-nt">&lt;br/&gt;&lt;br/&gt;</span>
<span class="tok-nt">&lt;h2&gt;</span>Nuevo profesor<span class="tok-nt">&lt;/h2&gt;</span>
<span class="tok-nt">&lt;label&gt;</span>Nombre:<span class="tok-nt">&lt;/label&gt;</span> <span class="tok-nt">&lt;input</span> <span class="tok-na">type=</span><span class="tok-s">&quot;text&quot;</span> <span class="tok-na">ng-model=</span><span class="tok-s">&quot;newTeacher.name&quot;</span> <span class="tok-nt">/&gt;&lt;br/&gt;</span>
<span class="tok-nt">&lt;label&gt;</span>Asignatura<span class="tok-nt">&lt;/label&gt;</span> <span class="tok-nt">&lt;input</span> <span class="tok-na">type=</span><span class="tok-s">&quot;text&quot;</span> <span class="tok-na">ng-model=</span><span class="tok-s">&quot;newTeacher.subject&quot;</span> <span class="tok-nt">/&gt;&lt;br/&gt;</span>
<span class="tok-nt">&lt;button</span> <span class="tok-na">ng-click=</span><span class="tok-s">&quot;addTeacher()&quot;</span><span class="tok-nt">&gt;</span>Guardar<span class="tok-nt">&lt;/button&gt;</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>Fijémonos en el botón, que incorpora una nueva directiva, llamada <code>ng-click</code>. Ésta responde al evento <code>onClick</code>, realizando una llamada a la función <code>addTeacher()</code>.</p>
</div>
<div class="paragraph">
<p>Como hemos dicho antes, la vista no sabe nada del controlador. Pero disponemos del objeto <code>$scope</code>, que permite exponer elementos del controlador en la vista. Lo hemos hecho con una colección (el array de profesores), y también podemos exponer una función:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="javascript"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12</div></td><td class="code"><span class="tok-nx">teachersApp</span><span class="tok-p">.</span><span class="tok-nx">controller</span><span class="tok-p">(</span><span class="tok-s1">&#39;teachersCtrl&#39;</span><span class="tok-p">,</span> <span class="tok-kd">function</span><span class="tok-p">(</span><span class="tok-nx">$scope</span><span class="tok-p">){</span>
    <span class="tok-nx">$scope</span><span class="tok-p">.</span><span class="tok-nx">people</span> <span class="tok-o">=</span> <span class="tok-p">[</span>
        <span class="tok-p">...</span>
    <span class="tok-p">];</span>

    <span class="tok-nx">$scope</span><span class="tok-p">.</span><span class="tok-nx">addTeacher</span> <span class="tok-o">=</span> <span class="tok-kd">function</span><span class="tok-p">()</span> <span class="tok-p">{</span>
        <span class="tok-nx">$scope</span><span class="tok-p">.</span><span class="tok-nx">people</span><span class="tok-p">.</span><span class="tok-nx">push</span><span class="tok-p">({</span>
            <span class="tok-nx">name</span> <span class="tok-o">:</span> <span class="tok-nx">$scope</span><span class="tok-p">.</span><span class="tok-nx">newTeacher</span><span class="tok-p">.</span><span class="tok-nx">name</span><span class="tok-p">,</span>
            <span class="tok-nx">subject</span> <span class="tok-o">:</span> <span class="tok-nx">$scope</span><span class="tok-p">.</span><span class="tok-nx">newTeacher</span><span class="tok-p">.</span><span class="tok-nx">subject</span>
        <span class="tok-p">});</span>
    <span class="tok-p">};</span>
<span class="tok-p">});</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>Vemos que no se ha pasado ningún dato como parámetro, ya que al pasarlo como <code>ng-model</code> en nuestros inputs, ya lo podemos obtener a través del <code>$scope</code>.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_usando_factorías_y_servicios">2.7. Usando factorías y servicios</h3>
<div class="paragraph">
<p>Una de las cosas que observamos en nuestra aplicación, es que si pasamos del listado de profesores al de asignaturas y luego volvemos a los profesores otra vez, es que los que hayamos podido introducir han desaparecido. Esto es porque los datos están vinculados al objeto <code>$scope</code>, que se crea y se destruye con cada cambio de ruta.</p>
</div>
<div class="paragraph">
<p>AngularJS nos permite encapsular los datos de nuestra aplicación en una serie de elementos:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Factorías</p>
</li>
<li>
<p>Servicios</p>
</li>
<li>
<p>Providers</p>
</li>
<li>
<p>Valores</p>
</li>
<li>
<p>Constantes</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Los tres primeros (Factorías, Servicios y Providers), además de datos, nos permiten encapsular funcionalidades dentro de nuestra aplicación. Por ejemplo, si necesito mi lista de profesores en múltiples controladores, lo correcto sería guardarlos en uno de estos elementos.</p>
</div>
<div class="paragraph">
<p>Estos tres elementos pueden realizar la misma funcionalidad, y la diferencia entre ellos radica en cómo se crean. Lo veremos más adelante.</p>
</div>
<div class="paragraph">
<p>Además, estos elementos implementan el patrón singleton, lo que los convierte en los candidatos perfectos para intercambiar información entre controladores.</p>
</div>
<div class="paragraph">
<p>Así, ahora vamos a modificar nuestro código para utilizar una factoría, donde podremos obtener el listado de profesores, así como añadir ítems a la lista. Una factoría en AngularJS devuelve un objeto javascript, con lo que su forma será la siguiente:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="javascript"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25</div></td><td class="code"><span class="tok-nx">teachersApp</span><span class="tok-p">.</span><span class="tok-nx">factory</span><span class="tok-p">(</span><span class="tok-s1">&#39;teachersFactory&#39;</span><span class="tok-p">,</span> <span class="tok-kd">function</span><span class="tok-p">(){</span>
    <span class="tok-kd">var</span> <span class="tok-nx">teachers</span> <span class="tok-o">=</span> <span class="tok-p">[</span>
        <span class="tok-p">{</span><span class="tok-nx">name</span><span class="tok-o">:</span><span class="tok-s1">&#39;Domingo&#39;</span><span class="tok-p">,</span> <span class="tok-nx">subject</span><span class="tok-o">:</span><span class="tok-s1">&#39;JPA&#39;</span><span class="tok-p">},</span>
        <span class="tok-p">{</span><span class="tok-nx">name</span><span class="tok-o">:</span><span class="tok-s1">&#39;Otto&#39;</span><span class="tok-p">,</span> <span class="tok-nx">subject</span><span class="tok-o">:</span><span class="tok-s1">&#39;Backbone&#39;</span><span class="tok-p">},</span>
        <span class="tok-p">{</span><span class="tok-nx">name</span><span class="tok-o">:</span><span class="tok-s1">&#39;Aitor&#39;</span><span class="tok-p">,</span><span class="tok-nx">subject</span><span class="tok-o">:</span><span class="tok-s1">&#39;JavaScript&#39;</span><span class="tok-p">},</span>
        <span class="tok-p">{</span><span class="tok-nx">name</span><span class="tok-o">:</span><span class="tok-s1">&#39;Miguel Ángel&#39;</span><span class="tok-p">,</span><span class="tok-nx">subject</span><span class="tok-o">:</span><span class="tok-s1">&#39;JHD&#39;</span><span class="tok-p">},</span>
        <span class="tok-p">{</span><span class="tok-nx">name</span><span class="tok-o">:</span><span class="tok-s1">&#39;Eli&#39;</span><span class="tok-p">,</span> <span class="tok-nx">subject</span><span class="tok-o">:</span><span class="tok-s1">&#39;REST&#39;</span><span class="tok-p">},</span>
        <span class="tok-p">{</span><span class="tok-nx">name</span><span class="tok-o">:</span><span class="tok-s1">&#39;Fran&#39;</span><span class="tok-p">,</span> <span class="tok-nx">subject</span><span class="tok-o">:</span><span class="tok-s1">&#39;Grails&#39;</span><span class="tok-p">},</span>
        <span class="tok-p">{</span><span class="tok-nx">name</span><span class="tok-o">:</span><span class="tok-s1">&#39;José Luís&#39;</span><span class="tok-p">,</span> <span class="tok-nx">subject</span><span class="tok-o">:</span><span class="tok-s1">&#39;PaaS&#39;</span><span class="tok-p">},</span>
        <span class="tok-p">{</span><span class="tok-nx">name</span><span class="tok-o">:</span><span class="tok-s1">&#39;Alex&#39;</span><span class="tok-p">,</span> <span class="tok-nx">subject</span><span class="tok-o">:</span><span class="tok-s1">&#39;AngularJS&#39;</span><span class="tok-p">}</span>
    <span class="tok-p">];</span>

    <span class="tok-k">return</span> <span class="tok-p">{</span>
        <span class="tok-nx">getTeachers</span> <span class="tok-o">:</span> <span class="tok-kd">function</span><span class="tok-p">()</span> <span class="tok-p">{</span>
            <span class="tok-k">return</span> <span class="tok-nx">teachers</span><span class="tok-p">;</span>
        <span class="tok-p">},</span>

        <span class="tok-nx">addTeacher</span> <span class="tok-o">:</span> <span class="tok-kd">function</span><span class="tok-p">(</span><span class="tok-nx">newTeacher</span><span class="tok-p">)</span> <span class="tok-p">{</span>
            <span class="tok-nx">teachers</span><span class="tok-p">.</span><span class="tok-nx">push</span><span class="tok-p">({</span>
                <span class="tok-nx">name</span> <span class="tok-o">:</span> <span class="tok-nx">newTeacher</span><span class="tok-p">.</span><span class="tok-nx">name</span><span class="tok-p">,</span>
                <span class="tok-nx">subject</span> <span class="tok-o">:</span> <span class="tok-nx">newTeacher</span><span class="tok-p">.</span><span class="tok-nx">subject</span>
            <span class="tok-p">})</span>
        <span class="tok-p">}</span>
    <span class="tok-p">}</span>
<span class="tok-p">});</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>Más adelante en el curso, veremos de qué manera podemos obtener ese listado de profesores a través de una llamada AJAX o un servicio REST, en lugar de tener ese array <em>harcoded</em> en nuestra factoría.</p>
</div>
<div class="paragraph">
<p>Al crear la factoría, podemos usarla en nuestro controlador simplemente inyectándola como parámetro. Así, ya estará disponible y podremos usarla:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="javascript"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3
4
5
6
7</div></td><td class="code"><span class="tok-nx">teachersApp</span><span class="tok-p">.</span><span class="tok-nx">controller</span><span class="tok-p">(</span><span class="tok-s1">&#39;teachersCtrl&#39;</span><span class="tok-p">,</span> <span class="tok-kd">function</span><span class="tok-p">(</span><span class="tok-nx">$scope</span><span class="tok-p">,</span> <span class="tok-nx">teachersFactory</span><span class="tok-p">){</span>
    <span class="tok-nx">$scope</span><span class="tok-p">.</span><span class="tok-nx">people</span> <span class="tok-o">=</span> <span class="tok-nx">teachersFactory</span><span class="tok-p">.</span><span class="tok-nx">getTeachers</span><span class="tok-p">();</span>

    <span class="tok-nx">$scope</span><span class="tok-p">.</span><span class="tok-nx">addTeacher</span> <span class="tok-o">=</span> <span class="tok-kd">function</span><span class="tok-p">()</span> <span class="tok-p">{</span>
        <span class="tok-nx">teachersFactory</span><span class="tok-p">.</span><span class="tok-nx">addTeacher</span><span class="tok-p">(</span><span class="tok-nx">$scope</span><span class="tok-p">.</span><span class="tok-nx">newTeacher</span><span class="tok-p">);</span>
    <span class="tok-p">};</span>
<span class="tok-p">});</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>La inyección de dependencias no se limita sólo a controladores, como veremos más adelante, podemos inyectar una factoría en otra factoría, o cualquiera de los elementos propios de AngularJS.</p>
</div>
<div class="paragraph">
<p>Como hemos dicho, una factoría implementa el patrón singleton. Esto significa que se instancia una única vez (la primera vez que es requerida), y está disponible durante toda la vida de la aplicación. Ahora, si nos vamos al listado de asignaturas y volvemos al de profesores, veremos que no perdemos los datos que hayamos podido introducir.</p>
</div>
<div class="paragraph">
<p>Otra cosa que debemos saber, es que AngularJS permite encadenar operaciones. Esto significa que podemos refactorizar nuestro código de la siguiente manera:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="javascript"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11</div></td><td class="code"><span class="tok-nx">angular</span>
    <span class="tok-p">.</span><span class="tok-nx">module</span><span class="tok-p">(</span><span class="tok-s1">&#39;teachersApp&#39;</span><span class="tok-p">,</span> <span class="tok-p">[</span><span class="tok-s1">&#39;ngRoute&#39;</span><span class="tok-p">])</span>
    <span class="tok-p">.</span><span class="tok-nx">config</span><span class="tok-p">(</span><span class="tok-kd">function</span><span class="tok-p">(</span><span class="tok-nx">$routeProvider</span><span class="tok-p">){</span>
        <span class="tok-p">...</span>
    <span class="tok-p">})</span>
    <span class="tok-p">.</span><span class="tok-nx">controller</span><span class="tok-p">(</span><span class="tok-s1">&#39;teachersCtrl&#39;</span><span class="tok-p">,</span> <span class="tok-kd">function</span><span class="tok-p">(</span><span class="tok-nx">$scope</span><span class="tok-p">,</span> <span class="tok-nx">teachersFactory</span><span class="tok-p">){</span>
        <span class="tok-p">...</span>
    <span class="tok-p">})</span>
    <span class="tok-p">.</span><span class="tok-nx">factory</span><span class="tok-p">(</span><span class="tok-s1">&#39;teachersFactory&#39;</span><span class="tok-p">,</span> <span class="tok-kd">function</span><span class="tok-p">(){</span>
        <span class="tok-p">...</span>
    <span class="tok-p">});</span>
</td></tr></table></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_ejercicio_1_punto">2.8. Ejercicio (1 punto)</h3>
<div class="paragraph">
<p>Sube el código que hayas hecho en esta sesión, y aplícale el <em>tag</em> <code>intro</code> a la versión que quieres que se corrija.</p>
</div>
<div class="paragraph">
<p>Todo el código de la sesión estará dentro de una carpeta llamada <code>intro</code> también.</p>
</div>
<div class="paragraph">
<p>Tras haber realizado este breve tutorial, ya tenemos unos fundamentos bastante básicos del <code>core</code> de AngularJS. Opcionalmente, podemos ampliar nuestra aplicación realizando los siguientes incrementos:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>En el formulario de alta de profesores, introduciremos un nuevo campo que nos permita añadir la descripción de la asignatura.</p>
</li>
<li>
<p>En el listado de asignaturas, mostraremos un listado de las asignaturas disponibles en el curso, y su descripción. Para ello crearemos el controlador subjectsCtrl</p>
</li>
<li>
<p>Introduciremos la opción de eliminar un profesor. Quizá pueda ser interesante el uso de la función <a href="http://www.w3schools.com/jsref/jsref_splice.asp">splice</a> de JavaScript, así como echarle un ojo a la documentación de la directiva <a href="https://docs.angularjs.org/api/ng/directive/ngRepeat"><code>ngRepeat</code></a>  de AngularJS, a ver si podemos encontrar la manera de hacer uso de los índices.</p>
</li>
</ul>
</div>
<div style="page-break-after: always;"></div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="sesion03">3. Scopes</h2>
<div class="sectionbody">
<div class="paragraph">
<p>La mayoría de las aplicaciones web están basadas en el patrón MVC (Model-View-Controller).
Sin embargo, MVC no es un patrón muy preciso, sino un patrón arquitectural de alto nivel.
Además, existen muchas variaciones del patrón original, siendo los más conocidos MVP y MVVM.
Para añadir un poco más de confusión, muchos frameworks y desarrolladores interpretan estos patrones de manera diferente.
Esto da como resultado que el nombre MVC se use para describir diferentes arquitecturas y aproximaciones.</p>
</div>
<div class="paragraph">
<p>El equipo de AngularJS ha sido más pragmático con su aproximación, definiendo el framework como basado en el patrón MVW (Model-View-Whatever).</p>
</div>
<div class="sect2">
<h3 id="_hola_mundo_otra_vez">3.1. Hola mundo (otra vez)</h3>
<div class="paragraph">
<p>Veamos nuevamente un típico ejemplo de <em>Hola mundo</em> para desgranar todos los elementos que intervienen:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="html"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23</div></td><td class="code"><span class="tok-cp">&lt;!DOCTYPE html&gt;</span>
<span class="tok-nt">&lt;html&gt;</span>
  <span class="tok-nt">&lt;head&gt;</span>
    <span class="tok-nt">&lt;title&gt;</span>Hola mundo<span class="tok-nt">&lt;/title&gt;</span>
    <span class="tok-nt">&lt;meta</span> <span class="tok-na">charset=</span><span class="tok-s">&quot;UTF-8&quot;</span><span class="tok-nt">&gt;</span>
    <span class="tok-nt">&lt;meta</span> <span class="tok-na">name=</span><span class="tok-s">&quot;viewport&quot;</span> <span class="tok-na">content=</span><span class="tok-s">&quot;width=device-width, initial-scale=1.0&quot;</span><span class="tok-nt">&gt;</span>
  <span class="tok-nt">&lt;/head&gt;</span>
  <span class="tok-nt">&lt;body</span> <span class="tok-na">ng-app=</span><span class="tok-s">&quot;holaMundo&quot;</span><span class="tok-nt">&gt;</span>
    <span class="tok-nt">&lt;div</span> <span class="tok-na">ng-controller=</span><span class="tok-s">&quot;SaludaCtrl&quot;</span><span class="tok-nt">&gt;</span>
      Saluda a: <span class="tok-nt">&lt;input</span> <span class="tok-na">type=</span><span class="tok-s">&quot;text&quot;</span> <span class="tok-na">ng-model=</span><span class="tok-s">&quot;nombre&quot;</span> <span class="tok-nt">/&gt;&lt;br/&gt;&lt;br/&gt;</span>
      <span class="tok-nt">&lt;h1&gt;</span>¡Hola, {{ nombre }}!<span class="tok-nt">&lt;/h1&gt;</span>
    <span class="tok-nt">&lt;/div&gt;</span>

    <span class="tok-nt">&lt;script </span><span class="tok-na">src=</span><span class="tok-s">&quot;/angular.js/angular.js&quot;</span> <span class="tok-na">type=</span><span class="tok-s">&quot;text/javascript&quot;</span><span class="tok-nt">&gt;&lt;/script&gt;</span>
    <span class="tok-nt">&lt;script&gt;</span>
      <span class="tok-nx">angular</span>
        <span class="tok-p">.</span><span class="tok-nx">module</span><span class="tok-p">(</span><span class="tok-s1">&#39;holaMundo&#39;</span><span class="tok-p">,</span> <span class="tok-p">[])</span>
        <span class="tok-p">.</span><span class="tok-nx">controller</span><span class="tok-p">(</span><span class="tok-s1">&#39;SaludaCtrl&#39;</span><span class="tok-p">,</span> <span class="tok-kd">function</span><span class="tok-p">(</span><span class="tok-nx">$scope</span><span class="tok-p">){</span>
          <span class="tok-nx">$scope</span><span class="tok-p">.</span><span class="tok-nx">nombre</span> <span class="tok-o">=</span> <span class="tok-s1">&#39;mundo&#39;</span><span class="tok-p">;</span>
        <span class="tok-p">});</span>
    <span class="tok-nt">&lt;/script&gt;</span>
  <span class="tok-nt">&lt;/body&gt;</span>
<span class="tok-nt">&lt;/html&gt;</span>
</td></tr></table></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_el_objeto_scope">3.2. El objeto Scope</h3>
<div class="paragraph">
<p>Siempre que queramos exponer un modelo a la vista (plantilla), haremos uso del objeto <code>$scope</code>.
Para ello, simplemente deberemos asignar nuevas propiedades a una instancia de este objeto.
Al hacerlo, ya estarán los valores disponibles en la plantilla.</p>
</div>
<div class="paragraph">
<p>Además, podemos también exponer funcionalidades a la vista, asociando funciones como propiedades de un <code>$scope</code>.
Por ejemplo, podríamos crear un <em>getter</em> para la variable <code>nombre</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="html"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27</div></td><td class="code"><span class="tok-cp">&lt;!DOCTYPE html&gt;</span>
<span class="tok-nt">&lt;html&gt;</span>
  <span class="tok-nt">&lt;head&gt;</span>
    <span class="tok-nt">&lt;title&gt;</span>Hola mundo<span class="tok-nt">&lt;/title&gt;</span>
    <span class="tok-nt">&lt;meta</span> <span class="tok-na">charset=</span><span class="tok-s">&quot;UTF-8&quot;</span><span class="tok-nt">&gt;</span>
    <span class="tok-nt">&lt;meta</span> <span class="tok-na">name=</span><span class="tok-s">&quot;viewport&quot;</span> <span class="tok-na">content=</span><span class="tok-s">&quot;width=device-width, initial-scale=1.0&quot;</span><span class="tok-nt">&gt;</span>
  <span class="tok-nt">&lt;/head&gt;</span>
  <span class="tok-nt">&lt;body</span> <span class="tok-na">ng-app=</span><span class="tok-s">&quot;holaMundo&quot;</span><span class="tok-nt">&gt;</span>
    <span class="tok-nt">&lt;div</span> <span class="tok-na">ng-controller=</span><span class="tok-s">&quot;SaludaCtrl&quot;</span><span class="tok-nt">&gt;</span>
      Saluda a: <span class="tok-nt">&lt;input</span> <span class="tok-na">type=</span><span class="tok-s">&quot;text&quot;</span> <span class="tok-na">ng-model=</span><span class="tok-s">&quot;nombre&quot;</span> <span class="tok-nt">/&gt;&lt;br/&gt;&lt;br/&gt;</span>
      <span class="tok-nt">&lt;h1&gt;</span>¡Hola, {{ getNombre() }}!<span class="tok-nt">&lt;/h1&gt;</span>
    <span class="tok-nt">&lt;/div&gt;</span>

    <span class="tok-nt">&lt;script </span><span class="tok-na">src=</span><span class="tok-s">&quot;/angular.js/angular.js&quot;</span> <span class="tok-na">type=</span><span class="tok-s">&quot;text/javascript&quot;</span><span class="tok-nt">&gt;&lt;/script&gt;</span>
    <span class="tok-nt">&lt;script&gt;</span>
      <span class="tok-nx">angular</span>
        <span class="tok-p">.</span><span class="tok-nx">module</span><span class="tok-p">(</span><span class="tok-s1">&#39;holaMundo&#39;</span><span class="tok-p">,</span> <span class="tok-p">[])</span>
        <span class="tok-p">.</span><span class="tok-nx">controller</span><span class="tok-p">(</span><span class="tok-s1">&#39;SaludaCtrl&#39;</span><span class="tok-p">,</span> <span class="tok-kd">function</span><span class="tok-p">(</span><span class="tok-nx">$scope</span><span class="tok-p">){</span>
          <span class="tok-nx">$scope</span><span class="tok-p">.</span><span class="tok-nx">nombre</span> <span class="tok-o">=</span> <span class="tok-s1">&#39;mundo&#39;</span><span class="tok-p">;</span>

          <span class="tok-nx">$scope</span><span class="tok-p">.</span><span class="tok-nx">getNombre</span> <span class="tok-o">=</span> <span class="tok-kd">function</span><span class="tok-p">()</span> <span class="tok-p">{</span>
            <span class="tok-k">return</span> <span class="tok-nx">$scope</span><span class="tok-p">.</span><span class="tok-nx">nombre</span><span class="tok-p">.</span><span class="tok-nx">toUpperCase</span><span class="tok-p">();</span>
          <span class="tok-p">};</span>
        <span class="tok-p">});</span>
    <span class="tok-nt">&lt;/script&gt;</span>
  <span class="tok-nt">&lt;/body&gt;</span>
<span class="tok-nt">&lt;/html&gt;</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>De esta forma, podemos controlar precisamente qué parte del modelo y qué operaciones queremos exponer a la capa de presentación.
Conceptualmente, un <code>$scope</code> tiene un comportamiento muy similar al de un <em>ViewModel</em> en el patrón MVVM.</p>
</div>
<div class="sect3">
<h4 id="_jerarquía_y_herencia_de_scopes">3.2.1. Jerarquía y herencia de scopes</h4>
<div class="paragraph">
<p>Cuando iniciamos una aplicación con AngularJS, se genera un scope a nivel de aplicación, llamado <code>$rootScope</code>.
Desde ese momento, todo nuevo scope será hijo del <code>$rootScope</code>.</p>
</div>
<div class="paragraph">
<p>Podemos instanciar un nuevo <code>$scope</code> en cualquier momento a través del método <code>$new()</code>. Cuando lo instanciamos, un <code>$scope</code> hereda las propiedades de su padre, como vemos en este ejemplo:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="javascript"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12</div></td><td class="code">  <span class="tok-kd">var</span> <span class="tok-nx">padre</span> <span class="tok-o">=</span> <span class="tok-nx">$rootScope</span><span class="tok-p">;</span>
  <span class="tok-kd">var</span> <span class="tok-nx">hijo</span> <span class="tok-o">=</span> <span class="tok-nx">padre</span><span class="tok-p">.</span><span class="tok-nx">$new</span><span class="tok-p">();</span>

  <span class="tok-nx">padre</span><span class="tok-p">.</span><span class="tok-nx">saludo</span> <span class="tok-o">=</span> <span class="tok-s2">&quot;Hola&quot;</span><span class="tok-p">;</span>
  <span class="tok-nx">hijo</span><span class="tok-p">.</span><span class="tok-nx">nombre</span> <span class="tok-o">=</span> <span class="tok-s2">&quot;Mundo&quot;</span><span class="tok-p">;</span>

  <span class="tok-nx">console</span><span class="tok-p">.</span><span class="tok-nx">log</span><span class="tok-p">(</span><span class="tok-nx">hijo</span><span class="tok-p">.</span><span class="tok-nx">saludo</span><span class="tok-p">);</span> <span class="tok-c1">// --&gt; &#39;Hola&#39;</span>

  <span class="tok-nx">hijo</span><span class="tok-p">.</span><span class="tok-nx">saludo</span> <span class="tok-o">=</span> <span class="tok-s2">&quot;Bienvenido&quot;</span><span class="tok-p">;</span>

  <span class="tok-nx">console</span><span class="tok-p">.</span><span class="tok-nx">log</span><span class="tok-p">(</span><span class="tok-nx">hijo</span><span class="tok-p">.</span><span class="tok-nx">saludo</span><span class="tok-p">);</span> <span class="tok-c1">// --&gt; &#39;Bienvenido&#39;</span>
  <span class="tok-nx">console</span><span class="tok-p">.</span><span class="tok-nx">log</span><span class="tok-p">(</span><span class="tok-nx">padre</span><span class="tok-p">.</span><span class="tok-nx">saludo</span><span class="tok-p">);</span> <span class="tok-c1">// --&gt; &#39;Hola&#39;</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>Como hemos visto, podemos instanciar un nuevo <code>scope</code> en cualquier momento, lo normal es que AngularJS lo haga por nosotros cuando lo necesitemos.
Por ejemplo, la directiva <code>ng-controller</code> instancia un nuevo scope, que será el que inyecte en el controlador.
En este caso, el scope será hijo del <code>$rootScope</code>.</p>
</div>
<div class="paragraph">
<p>A las directivas que crean nuevos <em>scopes</em> se las conoce como <em>scope creating directives</em>, y como hemos dicho será el propio AngularJS el encargado de crear los scopes por nosotros cuando se encuentre con una de estas directivas en el árbol del DOM.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Los scopes forman una estructura de árbol, cuya raíz siempre será el <code>$rootScope</code>. Como la creación de scopes, está dirigida por el árbol del DOM, no debería resultar extraño que el árbol de scopes imite de alguna manera el árbol del DOM.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Ahora que sabemos que algunas directivas crean nuevos scopes hijos, quizá nos preguntemos por qué tanta complejidad.
Para entenderlo, echemos un ojo a este ejemplo que utiliza la directiva <code>ng-repeat</code>:</p>
</div>
<div class="paragraph">
<p>El controlador sería:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="javascript"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3
4
5
6
7</div></td><td class="code"><span class="tok-kd">var</span> <span class="tok-nx">peopleCtrl</span> <span class="tok-o">=</span> <span class="tok-kd">function</span><span class="tok-p">(</span><span class="tok-nx">$scope</span><span class="tok-p">){</span>
  <span class="tok-nx">$scope</span><span class="tok-p">.</span><span class="tok-nx">people</span> <span class="tok-o">=</span> <span class="tok-p">[</span>
    <span class="tok-p">{</span> <span class="tok-nx">name</span><span class="tok-o">:</span><span class="tok-s1">&#39;Alex&#39;</span><span class="tok-p">,</span> <span class="tok-nx">subject</span><span class="tok-o">:</span> <span class="tok-s1">&#39;Angular&#39;</span><span class="tok-p">,</span> <span class="tok-nx">hours</span><span class="tok-o">:</span> <span class="tok-mi">20</span><span class="tok-p">},</span>
    <span class="tok-p">{</span> <span class="tok-nx">name</span><span class="tok-o">:</span><span class="tok-s1">&#39;Otto&#39;</span><span class="tok-p">,</span> <span class="tok-nx">subject</span><span class="tok-o">:</span> <span class="tok-s1">&#39;Backbone&#39;</span><span class="tok-p">,</span> <span class="tok-nx">hours</span><span class="tok-o">:</span> <span class="tok-mi">20</span><span class="tok-p">},</span>
    <span class="tok-p">{</span> <span class="tok-nx">name</span><span class="tok-o">:</span><span class="tok-s1">&#39;Domingo&#39;</span><span class="tok-p">,</span> <span class="tok-nx">subject</span><span class="tok-o">:</span> <span class="tok-s1">&#39;JPA&#39;</span><span class="tok-p">,</span> <span class="tok-nx">hours</span><span class="tok-o">:</span> <span class="tok-mi">15</span><span class="tok-p">}</span>
  <span class="tok-p">];</span>
<span class="tok-p">};</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>Nuestra plantilla tendría la siguiente forma:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="html"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3</div></td><td class="code"><span class="tok-nt">&lt;ul</span> <span class="tok-na">ng-controller=</span><span class="tok-s">&quot;peopleCtrl&quot;</span><span class="tok-nt">&gt;</span>
  <span class="tok-nt">&lt;li</span> <span class="tok-na">ng-repeat=</span><span class="tok-s">&quot;person in people&quot;</span><span class="tok-nt">&gt;</span>{{person.name}} da la asignatura: {{person.subject}} ({{ person.hours}} horas)<span class="tok-nt">&lt;/li&gt;</span>
<span class="tok-nt">&lt;/ul&gt;</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>La directiva <code>ng-repeat</code> nos permite iterar sobre una colección de, en este caso, personas.
Mientras itera, irá creando nuevos elementos en el DOM.
El problema es que si utilizáramos el mismo <code>$scope</code>, estaríamos sobreescribiendo el valor de la variable <code>persona</code>.
AngularJS soluciona este problema creando un nuevo <code>$scope</code> para cada elemento de la colección.
Como se ha comentado, los scopes generan una jerarquía en forma de árbol, similar a la de los elementos del DOM.
La extensión de AngularJS para Chrome nos permite verla:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="img/ses03/scopes.png" alt="{large-size}">
</div>
</div>
<div class="paragraph">
<p>Podemos ver en el pantallazo que cada <em>scope</em> (delimitado por un recuadro rojo) tiene su propio conjunto de valores del modelo.
Así, cada item tiene su propio <em>namespace</em>, donde cada <code>&lt;li&gt;</code> posee un <code>scope</code> propio donde se puede definir la variable <code>person</code>.</p>
</div>
<div class="paragraph">
<p>Otra característica interesante de los objetos <code>scope</code> es que toda propiedad que
definamos en un <code>scope</code> será visible para sus descendientes. Es muy interesante
porque hace que no sea necesario redefinir elementos a medida que creamos scopes
hijos.</p>
</div>
<div class="paragraph">
<p>Siguiendo con el ejemplo anterior, podemos calcular, en el <code>scope</code> del controlador padre,
el número total de horas en base al conjunto de gente:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="javascript"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3</div></td><td class="code"><span class="tok-nx">$scope</span><span class="tok-p">.</span><span class="tok-nx">hours</span> <span class="tok-o">=</span> <span class="tok-nx">$scope</span><span class="tok-p">.</span><span class="tok-nx">people</span><span class="tok-p">.</span><span class="tok-nx">reduce</span><span class="tok-p">(</span><span class="tok-kd">function</span><span class="tok-p">(</span><span class="tok-nx">value</span><span class="tok-p">,</span> <span class="tok-nx">person</span><span class="tok-p">){</span>
  <span class="tok-k">return</span> <span class="tok-nx">value</span> <span class="tok-err">`</span> <span class="tok-nx">person</span><span class="tok-p">.</span><span class="tok-nx">hours</span><span class="tok-p">;</span>
<span class="tok-p">},</span> <span class="tok-mi">0</span><span class="tok-p">);</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>En este caso, se ha hecho uso del método <em>reduce</em> de un Array.</p>
</div>
<div class="paragraph">
<p>Este método fue introducido en la <a href="http://www.ecma-international.org/publications/files/ECMA-ST/Ecma-262.pdf">versión 5 de ECMAScript</a>, con lo que puede haber
problemas de retrocompatibilidad con algunos navegadores. <a href="http://kangax.github.io/compat-table/es5/#Array.prototype.reduce">Aquí</a> podemos ver
una tabla de compatibilidad de todas las funciones de ECMAScript 5 con los navegadores
más usados del mercado.</p>
</div>
<div class="paragraph">
<p>La mayoría de estas funciones pueden implementarse en los navegadores que no las
soportan de primeras, maximizando así la compatibilidad. Existen multiud de librerías
que ya las implementan. Una de ellas es <a href="https://github.com/es-shims/es5-shim">es5-shim</a>.</p>
</div>
<div class="paragraph">
<p>Siempre que se necesite hacer uso de estas funcionalidades y sea necesaria retrocompatibilidad,
es muy recomendable usar librerías de este tipo.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Como habíamos comentado, este total de horas se propagará a los ámbitos hijos,
que podrán hacer uso de él para, por ejemplo, determinar el porcentaje del total
que supondrá cada asignatura:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="html"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3</div></td><td class="code"><span class="tok-nt">&lt;ul</span> <span class="tok-na">ng-controller=</span><span class="tok-s">&quot;PeopleCtrl&quot;</span><span class="tok-nt">&gt;</span>
    <span class="tok-nt">&lt;li</span> <span class="tok-na">ng-repeat=</span><span class="tok-s">&quot;person in people&quot;</span><span class="tok-nt">&gt;</span>{{person.name}} da la asignatura: {{person.subject}} ({{ person.hours}} horas - {{person.hours / hours * 100 | number:2}}%)<span class="tok-nt">&lt;/li&gt;</span>
<span class="tok-nt">&lt;/ul&gt;</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>La herencia de scopes sigue el mismo patrón que la herencia prototípica de JavaScript:
si no encontramos una propiedad en el objeto, subimos por el árbol de la jerarquía hasta
dar con ella.</p>
</div>
<div class="paragraph">
<p>La herencia resulta muy sencilla de usar cuando estamos leyendo, pero sin embargo
cuando estamos escribiendo puede darnos algún problema. Supongamos el siguiente
bloque de código:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="html"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14</div></td><td class="code"><span class="tok-nt">&lt;div</span> <span class="tok-na">ng-app</span><span class="tok-nt">&gt;</span>
 <span class="tok-nt">&lt;form</span> <span class="tok-na">name=</span><span class="tok-s">&quot;myForm&quot;</span> <span class="tok-na">ng-controller=</span><span class="tok-s">&quot;Ctrl&quot;</span><span class="tok-nt">&gt;</span>
 Input dentro de un switch:
 <span class="tok-nt">&lt;span</span> <span class="tok-na">ng-switch=</span><span class="tok-s">&quot;show&quot;</span><span class="tok-nt">&gt;</span>
     <span class="tok-nt">&lt;input</span> <span class="tok-na">ng-switch-when=</span><span class="tok-s">&quot;true&quot;</span> <span class="tok-na">type=</span><span class="tok-s">&quot;text&quot;</span> <span class="tok-na">ng-model=</span><span class="tok-s">&quot;myModel&quot;</span> <span class="tok-nt">/&gt;</span>
 <span class="tok-nt">&lt;/span&gt;</span>
     <span class="tok-nt">&lt;br/&gt;</span>
 Input fuera del switch:
 <span class="tok-nt">&lt;input</span> <span class="tok-na">type=</span><span class="tok-s">&quot;text&quot;</span> <span class="tok-na">ng-model=</span><span class="tok-s">&quot;myModel&quot;</span> <span class="tok-nt">/&gt;</span>
     <span class="tok-nt">&lt;br/&gt;</span>
 Valor:
 {{myModel}}
 <span class="tok-nt">&lt;/form&gt;</span>
<span class="tok-nt">&lt;/div&gt;</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="javascript"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3
4</div></td><td class="code"><span class="tok-kd">function</span> <span class="tok-nx">Ctrl</span><span class="tok-p">(</span><span class="tok-nx">$scope</span><span class="tok-p">)</span> <span class="tok-p">{</span>
     <span class="tok-nx">$scope</span><span class="tok-p">.</span><span class="tok-nx">show</span> <span class="tok-o">=</span> <span class="tok-kc">true</span><span class="tok-p">;</span>
     <span class="tok-nx">$scope</span><span class="tok-p">.</span><span class="tok-nx">myModel</span> <span class="tok-o">=</span> <span class="tok-s1">&#39;hello&#39;</span><span class="tok-p">;</span>
<span class="tok-p">}</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>Si manipulamos el segundo <code>input</code>, todos los elementos se modificarán a la vez.
Pero, ¿qué sucede si modificamos el primero, y luego el segundo nuevamente? Parece
como que el primero queda <em>desconectado</em> del resto. De hecho, se crea una nueva
variable en el <code>scope</code> hijo que hace que esto funcione de esta manera. Podéis hacer la
prueba usando el inspector de AngularJS para Chrome.</p>
</div>
<div class="paragraph">
<p>Esto se debe a la herencia prototípica (<em>prototipal inheritance</em> a partir de ahora)
de JavaScript, y todas las reglas que se aplican a ésta, se aplican a los scopes,
que al fin y al cabo son objetos JavaScript. El <code>scope</code> no es el modelo, sino que
referencia al modelo. Por tanto, en el momento que modificamos el primer input,
que tiene un <code>scope</code> propio, estamos referenciando a un nuevo modelo.</p>
</div>
<div class="paragraph">
<p>Esto es fácil de solucionar, haciendo uso de objetos. Podemos redeclarar el
objeto <code>myModel</code> de la siguiente manera:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="javascript"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3
4</div></td><td class="code"><span class="tok-kd">function</span> <span class="tok-nx">Ctrl</span><span class="tok-p">(</span><span class="tok-nx">$scope</span><span class="tok-p">)</span> <span class="tok-p">{</span>
     <span class="tok-nx">$scope</span><span class="tok-p">.</span><span class="tok-nx">show</span> <span class="tok-o">=</span> <span class="tok-kc">true</span><span class="tok-p">;</span>
     <span class="tok-nx">$scope</span><span class="tok-p">.</span><span class="tok-nx">myModel</span> <span class="tok-o">=</span> <span class="tok-p">{</span> <span class="tok-nx">value</span><span class="tok-o">:</span> <span class="tok-s1">&#39;hello&#39;</span><span class="tok-p">};</span>
<span class="tok-p">}</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>Y usarlo así en nuestra vista:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="html"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14</div></td><td class="code"><span class="tok-nt">&lt;div</span> <span class="tok-na">ng-app</span><span class="tok-nt">&gt;</span>
 <span class="tok-nt">&lt;form</span> <span class="tok-na">name=</span><span class="tok-s">&quot;myForm&quot;</span> <span class="tok-na">ng-controller=</span><span class="tok-s">&quot;Ctrl&quot;</span><span class="tok-nt">&gt;</span>
 Input dentro de un switch:
 <span class="tok-nt">&lt;span</span> <span class="tok-na">ng-switch=</span><span class="tok-s">&quot;show&quot;</span><span class="tok-nt">&gt;</span>
     <span class="tok-nt">&lt;input</span> <span class="tok-na">ng-switch-when=</span><span class="tok-s">&quot;true&quot;</span> <span class="tok-na">type=</span><span class="tok-s">&quot;text&quot;</span> <span class="tok-na">ng-model=</span><span class="tok-s">&quot;myModel.value&quot;</span> <span class="tok-nt">/&gt;</span>
 <span class="tok-nt">&lt;/span&gt;</span>
     <span class="tok-nt">&lt;br/&gt;</span>
 Input fuera del switch:
 <span class="tok-nt">&lt;input</span> <span class="tok-na">type=</span><span class="tok-s">&quot;text&quot;</span> <span class="tok-na">ng-model=</span><span class="tok-s">&quot;myModel.value&quot;</span> <span class="tok-nt">/&gt;</span>
     <span class="tok-nt">&lt;br/&gt;</span>
 Valor:
 {{ myModel.value }}
 <span class="tok-nt">&lt;/form&gt;</span>
<span class="tok-nt">&lt;/div&gt;</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>De esta manera, estaremos referenciando siempre al mismo objeto y no tendremos
elementos desconectados sin querer.</p>
</div>
<div class="paragraph">
<p>Existe otra manera, que es hacer uso del elemento <code>parent</code>. Éste hace referencia
al ámbito padre, y lo podríamos llamar de la siguiente manera en el <em>switch</em>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="html"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3</div></td><td class="code"><span class="tok-nt">&lt;span</span> <span class="tok-na">ng-switch=</span><span class="tok-s">&quot;show&quot;</span><span class="tok-nt">&gt;</span>
    <span class="tok-nt">&lt;input</span> <span class="tok-na">ng-switch-when=</span><span class="tok-s">&quot;true&quot;</span> <span class="tok-na">type=</span><span class="tok-s">&quot;text&quot;</span> <span class="tok-na">ng-model=</span><span class="tok-s">&quot;$parent.myModel&quot;</span> <span class="tok-nt">/&gt;</span>
<span class="tok-nt">&lt;/span&gt;</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>Sin embargo, esto resolvería nuestros problemas sólo si el dato estuviera en el
ámbito padre, no si el padre también lo hubiera heredado. Además, no podemos estar
seguros al 100% que <code>parent</code> va a ser el ámbito superior, ya que puede que estemos
empleando alguna directiva que haya creado un <code>scope</code> adicional.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Podemos encontrar más información acerca de esto en <a href="https://github.com/angular/angular.js/wiki/Understanding-Scopes">este enlace</a></p>
</div>
<div class="paragraph">
<p>También, <a href="https://www.youtube.com/watch?v=ZhfUv0spHCY&amp;t=29m19s">en este vídeo</a>, Miško Hevery
hace una serie de reflexiones sobre cómo trabajar con los scopes.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_propagación_de_eventos">3.2.2. Propagación de eventos</h4>
<div class="paragraph">
<p>Como hemos comentado, en nuestra aplicación se generará un árbol de objetos <code>scope</code>
similar a la estructura del DOM. En la raíz de este árbol se encuentra el objeto
<code>$rootScope</code></p>
</div>
<div class="paragraph">
<p>Podemos usar esta jerarquía para transmitir eventos dentro del árbol, tanto en
dirección ascendente con el método <code>scope.$emit</code> como descendente con <code>scope.$broadcast</code>.</p>
</div>
<div class="paragraph">
<p>La captura de estos eventos se realiza con el método <code>scope.$on</code>.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="img/ses03/eventos.png" alt="{large-size}">
</div>
</div>
<div class="paragraph">
<p>La función <code>scope.$emit(name, args);</code> envía un evento hacia arriba en la jearquía,
notificando a todos los <em>listeners</em>. El ciclo de vida del evento comienza en aquel
<code>scope</code> que ha llamado a <code>$emit</code>. Este evento irá hacia arriba hasta llegar al
<code>$rootScope</code>, y todos los que hayan dado de alta un <em>listener</em> y estén en el camino
del evento serán notificados. Los suscritos a un evento pueden cancelarlo.</p>
</div>
<div class="paragraph">
<p>Por su parte, la función <code>scope.$broadcast(name, args);</code> envía un evento hacia abajo
en la jearquía, notificando todos los <em>listeners</em> herederos.</p>
</div>
<div class="paragraph">
<p>Ambos métodos tienen los mismos argumentos:</p>
</div>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 33%;">
<col style="width: 33%;">
<col style="width: 33%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Param</th>
<th class="tableblock halign-left valign-top">Tipo</th>
<th class="tableblock halign-left valign-top">Detalles</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>name</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>string</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Nombre del evento que se propaga.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>args</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>*</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Uno o más argumentos, que se propagarán con el evento.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Para suscribirnos a un evento, lo hacemos con <code>scope.$on(eventName, listener)</code> .
Los parámetros son:</p>
</div>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 33%;">
<col style="width: 33%;">
<col style="width: 33%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Param</th>
<th class="tableblock halign-left valign-top">Tipo</th>
<th class="tableblock halign-left valign-top">Detalles</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>name</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>string</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Nombre del evento al que nos suscribimos</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>listener</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>function(event, &#8230;&#8203;args)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Función a invocar cuando se recibe el evento.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>El objeto <code>event</code> que se le pasa al listener tiene los siguientes atributos:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>targetScope</code>: el <code>scope</code> en el que el evento fue emitido o difundido</p>
</li>
<li>
<p><code>currentScope</code>: el <code>scope</code> que maneja el evento.</p>
</li>
<li>
<p><code>name</code>: nombre del evento</p>
</li>
<li>
<p><code>stopPropagation</code>: esta función cancela el evneto y hace que no se siga propagando.</p>
</li>
<li>
<p><code>preventDefault</code>: establece el <em>flag</em> <code>defaultPrevented</code> a <code>true</code>.</p>
</li>
<li>
<p><code>defaultPrevented</code>: valdrá <code>true</code> si se ha llamado a la función <code>preventDefault</code>.</p>
</li>
</ul>
</div>
<div class="sect4">
<h5 id="_eventos_de_angularjs">Eventos de AngularJS</h5>
<div class="paragraph">
<p>Dentro del framework, existen tres eventos que se emiten</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>$includeContentRequested</code></p>
</li>
<li>
<p><code>$includeContentLoaded</code></p>
</li>
<li>
<p><code>$viewContentLoaded</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>y siente eventos que se difunden</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>$locationChangeStart</code></p>
</li>
<li>
<p><code>$locationChangeSuccess</code></p>
</li>
<li>
<p><code>$routeUpdate</code></p>
</li>
<li>
<p><code>$routeChangeStart</code></p>
</li>
<li>
<p><code>$routeChangeSuccess</code></p>
</li>
<li>
<p><code>$routeChangeError</code></p>
</li>
<li>
<p><code>$destroy</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Podemos ver que se usan escasamemnte en el <em>core</em> de AngularJS. Pese a ser una
manera sencilla de intercambiar datos entre controladores, debemos evaluar si es
la mejor opción. Por ejemplo, en muchos casos puede ser útil el uso del <em>two-way data binding</em>
para obtener una solución más sencilla.</p>
</div>
<div class="paragraph">
<p>Esto nos lleva a otro método interesante del objeto <code>scope</code>. Es el método <code>watch(watchExpression, [listener], [objectEquality])</code>,
que registra un <em>listener</em> que se ejecuta cada vez que el resultado de la expresión
<em>watchExpression</em> cambia.</p>
</div>
<div class="paragraph">
<p>La función <code>watchExpression</code> se llama en cada iteración del ciclo de vida de Angular,
y debe devolver el valor que queramos observar.</p>
</div>
<div class="paragraph">
<p>El <code>listener</code> se ejecuta sólo cuando el valor de la <code>watchExpression</code> ha variado
desde su última ejecución. Esta inecualidad se determina según la función <a href="https://docs.angularjs.org/api/ng/function/angular.equals">angular.equals</a>
También, se hace uso de la función <a href="https://docs.angularjs.org/api/ng/function/angular.copy">angular.copy</a>
para guardar el objeto, para utilizarlo en la siguiente iteración de la comparación.
La <code>watchExpression</code> debe ser lo más sencilla posible, ya que de otra
manera podríamos tener problemas de rendimiento de rendimiento y memoria.</p>
</div>
<div class="paragraph">
<p>El <code>listener</code> puede modificar el modelo si así lo desea, lo que podría implicar
la activación de otros <em>listeners</em>, re-lanzando los <em>watchers</em> hasta que no se detecta
ningún cambio. Para prevenir entrar en bucles infinitos, existe un límite de re-lanzado
de iteraciones, que es 10.</p>
</div>
<div class="paragraph">
<p>El siguiente ejemplo hace uso de una expresión y de una función de evaluación para
observar una serie de cambios, y realizar una acción al respecto, que será contabilizar
el número de cambios realizados sobre la variable.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="html"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45</div></td><td class="code"><span class="tok-cp">&lt;!DOCTYPE html&gt;</span>
<span class="tok-nt">&lt;html</span> <span class="tok-na">ng-app=</span><span class="tok-s">&quot;ses03.watch&quot;</span><span class="tok-nt">&gt;</span>
<span class="tok-nt">&lt;head</span> <span class="tok-na">lang=</span><span class="tok-s">&quot;en&quot;</span><span class="tok-nt">&gt;</span>
    <span class="tok-nt">&lt;meta</span> <span class="tok-na">charset=</span><span class="tok-s">&quot;UTF-8&quot;</span><span class="tok-nt">&gt;</span>
    <span class="tok-nt">&lt;title&gt;&lt;/title&gt;</span>
<span class="tok-nt">&lt;/head&gt;</span>
<span class="tok-nt">&lt;body</span> <span class="tok-na">ng-controller=</span><span class="tok-s">&quot;WatchCtrl&quot;</span><span class="tok-nt">&gt;</span>
<span class="tok-nt">&lt;p&gt;</span> <span class="tok-nt">&lt;label&gt;</span>Nombre <span class="tok-nt">&lt;input</span> <span class="tok-na">type=</span><span class="tok-s">&quot;text&quot;</span> <span class="tok-na">ng-model=</span><span class="tok-s">&quot;name&quot;</span><span class="tok-nt">/&gt;&lt;/label&gt;</span> <span class="tok-nt">&lt;/p&gt;</span>

<span class="tok-nt">&lt;p&gt;</span> Contador de cambios en el nombre: {{ counter }} <span class="tok-nt">&lt;/p&gt;</span>

<span class="tok-nt">&lt;p&gt;</span> <span class="tok-nt">&lt;label&gt;</span>Alimento <span class="tok-nt">&lt;input</span> <span class="tok-na">type=</span><span class="tok-s">&quot;text&quot;</span> <span class="tok-na">ng-model=</span><span class="tok-s">&quot;food&quot;</span><span class="tok-nt">/&gt;&lt;/label&gt;</span> <span class="tok-nt">&lt;/p&gt;</span>

<span class="tok-nt">&lt;p&gt;</span> Contador de cambios en el alimento: {{ foodCounter }} <span class="tok-nt">&lt;/p&gt;</span>

<span class="tok-nt">&lt;script </span><span class="tok-na">src=</span><span class="tok-s">&quot;//ajax.googleapis.com/ajax/libs/angularjs/1.2.19/angular.min.js&quot;</span><span class="tok-nt">&gt;&lt;/script&gt;</span>
<span class="tok-nt">&lt;script&gt;</span>
    <span class="tok-nx">angular</span>
            <span class="tok-p">.</span><span class="tok-nx">module</span><span class="tok-p">(</span><span class="tok-s1">&#39;ses03.watch&#39;</span><span class="tok-p">,</span> <span class="tok-p">[])</span>
            <span class="tok-p">.</span><span class="tok-nx">controller</span><span class="tok-p">(</span><span class="tok-s1">&#39;WatchCtrl&#39;</span><span class="tok-p">,</span> <span class="tok-kd">function</span> <span class="tok-p">(</span><span class="tok-nx">$scope</span><span class="tok-p">)</span> <span class="tok-p">{</span>
                <span class="tok-nx">$scope</span><span class="tok-p">.</span><span class="tok-nx">name</span> <span class="tok-o">=</span> <span class="tok-s1">&#39;alex&#39;</span><span class="tok-p">;</span>
                <span class="tok-nx">$scope</span><span class="tok-p">.</span><span class="tok-nx">counter</span> <span class="tok-o">=</span> <span class="tok-mi">0</span><span class="tok-p">;</span>

                <span class="tok-c1">//Usaremos una expresión para evaluar</span>
                <span class="tok-nx">$scope</span><span class="tok-p">.</span><span class="tok-nx">$watch</span><span class="tok-p">(</span><span class="tok-s1">&#39;name&#39;</span><span class="tok-p">,</span> <span class="tok-kd">function</span> <span class="tok-p">(</span><span class="tok-nx">newValue</span><span class="tok-p">,</span> <span class="tok-nx">oldValue</span><span class="tok-p">)</span> <span class="tok-p">{</span>
                    <span class="tok-nx">$scope</span><span class="tok-p">.</span><span class="tok-nx">counter</span><span class="tok-o">++</span><span class="tok-p">;</span>
                <span class="tok-p">});</span>


                <span class="tok-c1">// Usaremos una función para evaluar</span>
                <span class="tok-nx">$scope</span><span class="tok-p">.</span><span class="tok-nx">food</span> <span class="tok-o">=</span> <span class="tok-s1">&#39;paella&#39;</span><span class="tok-p">;</span>
                <span class="tok-nx">$scope</span><span class="tok-p">.</span><span class="tok-nx">foodCounter</span> <span class="tok-o">=</span> <span class="tok-mi">0</span><span class="tok-p">;</span>
                <span class="tok-nx">$scope</span><span class="tok-p">.</span><span class="tok-nx">$watch</span><span class="tok-p">(</span>
                        <span class="tok-kd">function</span> <span class="tok-p">()</span> <span class="tok-p">{</span> <span class="tok-k">return</span> <span class="tok-nx">$scope</span><span class="tok-p">.</span><span class="tok-nx">food</span><span class="tok-p">.</span><span class="tok-nx">length</span><span class="tok-p">;</span> <span class="tok-p">},</span> <span class="tok-c1">//Función de evaluación</span>

                        <span class="tok-kd">function</span> <span class="tok-p">(</span><span class="tok-nx">newValue</span><span class="tok-p">,</span> <span class="tok-nx">oldValue</span><span class="tok-p">)</span> <span class="tok-p">{</span> <span class="tok-c1">//Listener</span>
                            <span class="tok-k">if</span> <span class="tok-p">(</span><span class="tok-nx">newValue</span> <span class="tok-o">!==</span> <span class="tok-nx">oldValue</span><span class="tok-p">)</span> <span class="tok-p">{</span>
                                <span class="tok-nx">$scope</span><span class="tok-p">.</span><span class="tok-nx">foodCounter</span><span class="tok-o">++</span><span class="tok-p">;</span>
                            <span class="tok-p">}</span>
                        <span class="tok-p">}</span>
                <span class="tok-p">);</span>
            <span class="tok-p">});</span>
<span class="tok-nt">&lt;/script&gt;</span>
<span class="tok-nt">&lt;/body&gt;</span>
<span class="tok-nt">&lt;/html&gt;</span>
</td></tr></table></code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_el_ciclo_de_vida_del_scope">3.2.3. El ciclo de vida del scope</h4>
<div class="paragraph">
<p>El flujo normal de un browser cuando se recibe un evento es que éste termine llamando a una
función JavaScript de <em>callback</em>. Una vez ésta ha finalizado, el browser renderiza
el DOM de nuevo y espera a recibir más eventos.</p>
</div>
<div class="paragraph">
<p>Cuando se hace esta llamada JavaScript al navegador, el código se ejecuta fuera
del contexto de ejecución de AngularJS, lo que significa que AngularJS no tiene ni
idea de que se haya modificado el modelo. Para poder procesar estas modificaciones
en el modelo, hay que hacer que todo lo que se ha hecho fuera del contexto de ejecución
de AngularJS entre dentro de él a través del método <code>$apply</code>. Sólo las modificaciones del
modelo que hagamos dentro de un método <code>$apply</code> serán tenidas en cuenta por AngularJS.
Por ejemplo, una directiva como <code>ng-click</code> que escucha eventos del DOM, debe evaluar la expresión
dentro de un método <code>$apply</code>. Así lo podemos ver <a href="https://github.com/angular/angular.js/blob/master/src/ng/directive/ngEventDirs.js#L50">En su código fuente</a>.</p>
</div>
<div class="paragraph">
<p>Tras evaluar la expresión el método <code>$apply</code> realiza un <code>$digest</code>. En esta fase, el
<code>scope</code> examina todas las expresiones <code>$watch</code> y compara sus resultados con los
valores previos de manera asíncrona. Esto significa que una asignación como <code>$scope.username = 'admin'</code>
no lanzará inmediatamente el listener de <code>$watch('username')</code>. En lugar de eso, se
retrasará hasta la fase de <code>$digest</code>, de manera que se unifican las actualizaciones
 del modelo, y se garantiza que se ejecute una función <code>$watch</code> a la vez. Si un
<code>$watch</code> cambia el modelo, forzará un ciclo <code>$digest</code> adicional.</p>
</div>
<div class="paragraph">
<p>Esto podemos resumirlo en las cinco fases por las que pasa una aplicación en AngularJS:</p>
</div>
<div class="sect4">
<h5 id="_creación">Creación</h5>
<div class="paragraph">
<p>El <code>$injector</code> crea el objeto <code>rootScope</code> durante el <em>application bootstrap</em>.
Cuando se produce el linkado de plantillas, algunas directivas crearán nuevos scopes.</p>
</div>
</div>
<div class="sect4">
<h5 id="_registro_de_watchers">Registro de watchers</h5>
<div class="paragraph">
<p>Durante el linkado de plantillas, las directivas suelen registrar <em>watchers</em>. Éstos
se usarán para propagar los valores del modelo al DOM.</p>
</div>
</div>
<div class="sect4">
<h5 id="_mutación_del_modelo">Mutación del modelo</h5>
<div class="paragraph">
<p>Para observar correctamente las mutaciones, habría que hacerlo dentro de <code>scope.$apply()</code>.
Afortunadamente para nosotros, la API de AngularJS lo hace implícitamente, de manera
que no es necesario hacerlo dentro de nuestros controladores si estamos realizando
alguna tarea síncrona, o si estamos realizando tareas asíncronas con los servicios <code>$http</code>,
<code>$timeout</code> o <code>$interval</code>.</p>
</div>
</div>
<div class="sect4">
<h5 id="_observación_de_la_mutación">Observación de la mutación</h5>
<div class="paragraph">
<p>Al final de <code>$apply</code>, AngularJS realiza un ciclo <code>$digest</code> en el <code>rootScope</code> que
se propagará posteriormente a todos los hijos. Durante este ciclo, todas las expresiones
en un <code>$watch</code> se evaluarán para observar cambios en el modelo y, si esta se detecta,
se invocará al <em>listener</em>.</p>
</div>
</div>
<div class="sect4">
<h5 id="_destrucción">Destrucción</h5>
<div class="paragraph">
<p>Cuando no se necesita más un <code>scope</code> hijo, su creador tiene la responsabilidad de
destruirlo mediante una llamada a <code>scope.destroy()</code>. Esto detendrá la propagación
llamadas <code>$digest</code> al hijo, y permitirá la llamada al recolector de basura para eliminar
la memoria usada.</p>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_ejercicios">3.3. Ejercicios</h3>
<div class="paragraph">
<p>Aplica el <em>tag</em> <code>scopes</code> a la versión que quieres que se corrija.</p>
</div>
<div class="sect3">
<h4 id="_calculadora_0_66_puntos">3.3.1. Calculadora (0,66 puntos)</h4>
<div class="paragraph">
<p>Este ejercicio lo realizaremos en una carpeta llamada <code>calculator</code>.</p>
</div>
<div class="paragraph">
<p>Completa el siguiente código para implementar una calculadora que haga sumas, restas, multiplicaciones y divisiones.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="html"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19</div></td><td class="code"><span class="tok-nt">&lt;div</span> <span class="tok-na">ng-app</span><span class="tok-nt">&gt;</span>
  <span class="tok-nt">&lt;h1&gt;</span>Calculadora<span class="tok-nt">&lt;/h1&gt;</span>

  <span class="tok-nt">&lt;div</span> <span class="tok-na">ng-controller=</span><span class="tok-s">&quot;CalcController&quot;</span><span class="tok-nt">&gt;</span>
    <span class="tok-nt">&lt;div&gt;</span>
      <span class="tok-nt">&lt;label&gt;</span>Primer operando <span class="tok-nt">&lt;input</span> <span class="tok-na">type=</span><span class="tok-s">&quot;number&quot;</span> <span class="tok-nt">/&gt;&lt;/label&gt;</span>
    <span class="tok-nt">&lt;/div&gt;</span>
    <span class="tok-nt">&lt;div&gt;</span>
      <span class="tok-nt">&lt;label&gt;</span>Segundo operando operando <span class="tok-nt">&lt;input</span> <span class="tok-na">type=</span><span class="tok-s">&quot;number&quot;</span> <span class="tok-nt">/&gt;&lt;/label&gt;</span>
    <span class="tok-nt">&lt;/div&gt;</span>
    <span class="tok-nt">&lt;div&gt;</span>
      <span class="tok-nt">&lt;button</span> <span class="tok-na">ng-click=</span><span class="tok-s">&quot;&quot;</span><span class="tok-nt">&gt;</span>Suma<span class="tok-nt">&lt;/button&gt;</span>
      <span class="tok-nt">&lt;button</span> <span class="tok-na">ng-click=</span><span class="tok-s">&quot;&quot;</span><span class="tok-nt">&gt;</span>Resta<span class="tok-nt">&lt;/button&gt;</span>
      <span class="tok-nt">&lt;button</span> <span class="tok-na">ng-click=</span><span class="tok-s">&quot;&quot;</span><span class="tok-nt">&gt;</span>Multiplicación<span class="tok-nt">&lt;/button&gt;</span>
      <span class="tok-nt">&lt;button</span> <span class="tok-na">ng-click=</span><span class="tok-s">&quot;&quot;</span><span class="tok-nt">&gt;</span>División<span class="tok-nt">&lt;/button&gt;</span>
    <span class="tok-nt">&lt;/div&gt;</span>
    <span class="tok-nt">&lt;h2&gt;</span>Resultado: XXX<span class="tok-nt">&lt;/h2&gt;</span>
  <span class="tok-nt">&lt;/div&gt;</span>
<span class="tok-nt">&lt;/div&gt;</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="javascript"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17</div></td><td class="code"><span class="tok-kd">function</span> <span class="tok-nx">CalcController</span><span class="tok-p">(</span><span class="tok-nx">$scope</span><span class="tok-p">)</span> <span class="tok-p">{</span>
  <span class="tok-nx">$scope</span><span class="tok-p">.</span><span class="tok-nx">add</span> <span class="tok-o">=</span> <span class="tok-kd">function</span><span class="tok-p">()</span> <span class="tok-p">{</span>

  <span class="tok-p">};</span>

  <span class="tok-nx">$scope</span><span class="tok-p">.</span><span class="tok-nx">substract</span> <span class="tok-o">=</span> <span class="tok-kd">function</span><span class="tok-p">(</span><span class="tok-nx">a</span><span class="tok-p">,</span><span class="tok-nx">b</span><span class="tok-p">)</span> <span class="tok-p">{</span>

  <span class="tok-p">};</span>

  <span class="tok-nx">$scope</span><span class="tok-p">.</span><span class="tok-nx">divide</span> <span class="tok-o">=</span> <span class="tok-kd">function</span><span class="tok-p">()</span> <span class="tok-p">{</span>

  <span class="tok-p">};</span>

  <span class="tok-nx">$scope</span><span class="tok-p">.</span><span class="tok-nx">multiply</span> <span class="tok-o">=</span> <span class="tok-kd">function</span><span class="tok-p">(</span><span class="tok-nx">a</span><span class="tok-p">,</span><span class="tok-nx">b</span><span class="tok-p">)</span> <span class="tok-p">{</span>

  <span class="tok-p">};</span>
<span class="tok-p">}</span>
</td></tr></table></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_carrito_de_la_compra_0_67_puntos">3.3.2. Carrito de la compra (0,67 puntos)</h4>
<div class="paragraph">
<p>Este ejercicio lo realizaremos en una carpeta llamada <code>shoppingcart</code>.</p>
</div>
<div class="paragraph">
<p>Vamos a hacer uso de la función <code>$watch</code> que nos ofrece el <code>scope</code> para implementar un sencillo carro de la compra.</p>
</div>
<div class="paragraph">
<p>Disponemos de una plantilla ya hecha, que muestra un listado de productos (generados aleatoriamente con <a href="http://beta.json-generator.com/OpatzFu">JSON Generator</a>). También, disponemos de un controlador  donde tenemos el listado de productos, una serie de variables y una función <code>addToCart</code> vacía.</p>
</div>
<div class="paragraph">
<p>Tendremos que implementar la función <code>addToCart</code>, para que añada ítems al carro. Además, implementaremos un <em>watcher</em> que observará cambios en el tamaño de dicho array. Cuando éstos se produzcan, actualizaremos la variable <code>$scope.totalItems</code> al número de ítems del carro. También, actualizaremos el valor de la variable <code>$scope.total</code>, con el importe total de los productos. Se recomienda hacer uso de la función <a href="https://developer.mozilla.org/es/docs/Web/JavaScript/Referencia/Objetos_globales/Array/reduce"><code>Array.prototype.reduce</code></a> para calcular este total.</p>
</div>
<div class="paragraph">
<p>La plantilla de nuestro índice será:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="html"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16</div></td><td class="code"><span class="tok-nt">&lt;div</span> <span class="tok-na">ng-app</span><span class="tok-nt">&gt;</span>
  <span class="tok-nt">&lt;div</span> <span class="tok-na">ng-controller=</span><span class="tok-s">&quot;CartCtrl&quot;</span><span class="tok-nt">&gt;</span>
    <span class="tok-nt">&lt;h2&gt;</span>{{totalItems}} ítems en la cesta ({{total}} <span class="tok-ni">&amp;euro;</span>)<span class="tok-nt">&lt;/h2&gt;</span>
    <span class="tok-nt">&lt;div</span> <span class="tok-na">ng-repeat=</span><span class="tok-s">&quot;product in products&quot;</span> <span class="tok-na">style=</span><span class="tok-s">&quot;float:left&quot;</span><span class="tok-nt">&gt;</span>
      <span class="tok-nt">&lt;div&gt;</span>
        <span class="tok-nt">&lt;img</span> <span class="tok-na">ng-src=</span><span class="tok-s">&quot;{{product.picture}}&quot;</span> <span class="tok-na">alt=</span><span class="tok-s">&quot;&quot;</span> <span class="tok-nt">/&gt;</span>
        <span class="tok-nt">&lt;p&gt;</span>
          {{product.brand}} {{product.name}}
          <span class="tok-nt">&lt;br/&gt;</span>
          {{product.price}} <span class="tok-ni">&amp;euro;</span>
        <span class="tok-nt">&lt;/p&gt;</span>
        <span class="tok-nt">&lt;button</span> <span class="tok-na">ng-click=</span><span class="tok-s">&quot;addToCart(product)&quot;</span><span class="tok-nt">&gt;</span>Añadir a la cesta<span class="tok-nt">&lt;/button&gt;</span>
      <span class="tok-nt">&lt;/div&gt;</span>
    <span class="tok-nt">&lt;/div&gt;</span>
  <span class="tok-nt">&lt;/div&gt;</span>
<span class="tok-nt">&lt;/div&gt;</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>Por su parte, la plantilla de nuestro controlador será:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="javascript"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">  1
  2
  3
  4
  5
  6
  7
  8
  9
 10
 11
 12
 13
 14
 15
 16
 17
 18
 19
 20
 21
 22
 23
 24
 25
 26
 27
 28
 29
 30
 31
 32
 33
 34
 35
 36
 37
 38
 39
 40
 41
 42
 43
 44
 45
 46
 47
 48
 49
 50
 51
 52
 53
 54
 55
 56
 57
 58
 59
 60
 61
 62
 63
 64
 65
 66
 67
 68
 69
 70
 71
 72
 73
 74
 75
 76
 77
 78
 79
 80
 81
 82
 83
 84
 85
 86
 87
 88
 89
 90
 91
 92
 93
 94
 95
 96
 97
 98
 99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
153
154
155
156
157
158
159
160
161
162
163
164
165
166
167
168
169
170
171
172
173
174</div></td><td class="code"><span class="tok-kd">function</span> <span class="tok-nx">CartCtrl</span><span class="tok-p">(</span><span class="tok-nx">$scope</span><span class="tok-p">)</span> <span class="tok-p">{</span>
  <span class="tok-nx">$scope</span><span class="tok-p">.</span><span class="tok-nx">total</span> <span class="tok-o">=</span> <span class="tok-mi">0</span><span class="tok-p">;</span>
  <span class="tok-nx">$scope</span><span class="tok-p">.</span><span class="tok-nx">totalItems</span> <span class="tok-o">=</span> <span class="tok-mi">0</span><span class="tok-p">;</span>
  <span class="tok-nx">$scope</span><span class="tok-p">.</span><span class="tok-nx">cart</span> <span class="tok-o">=</span> <span class="tok-p">[];</span>

  <span class="tok-nx">$scope</span><span class="tok-p">.</span><span class="tok-nx">addToCart</span> <span class="tok-o">=</span> <span class="tok-kd">function</span><span class="tok-p">(</span><span class="tok-nx">product</span><span class="tok-p">){</span>
    <span class="tok-c1">//TODO: ADD TO CART</span>
  <span class="tok-p">};</span>

  <span class="tok-c1">//TODO: WATCH</span>

  <span class="tok-nx">$scope</span><span class="tok-p">.</span><span class="tok-nx">products</span> <span class="tok-o">=</span> <span class="tok-p">[</span>
    <span class="tok-p">{</span>
        <span class="tok-s2">&quot;_id&quot;</span><span class="tok-o">:</span> <span class="tok-s2">&quot;54c688af49814edb036a2c33&quot;</span><span class="tok-p">,</span>
        <span class="tok-s2">&quot;price&quot;</span><span class="tok-o">:</span> <span class="tok-mf">145.4</span><span class="tok-p">,</span>
        <span class="tok-s2">&quot;picture&quot;</span><span class="tok-o">:</span> <span class="tok-s2">&quot;http://lorempixel.com/200/200/food/?id=846.9758&quot;</span><span class="tok-p">,</span>
        <span class="tok-s2">&quot;brand&quot;</span><span class="tok-o">:</span> <span class="tok-s2">&quot;adidas&quot;</span><span class="tok-p">,</span>
        <span class="tok-s2">&quot;name&quot;</span><span class="tok-o">:</span> <span class="tok-s2">&quot;Zone Job&quot;</span><span class="tok-p">,</span>
        <span class="tok-s2">&quot;rating&quot;</span><span class="tok-o">:</span> <span class="tok-mi">4</span>
    <span class="tok-p">},</span>
    <span class="tok-p">{</span>
        <span class="tok-s2">&quot;_id&quot;</span><span class="tok-o">:</span> <span class="tok-s2">&quot;54c688afeffb1bad23bea9f7&quot;</span><span class="tok-p">,</span>
        <span class="tok-s2">&quot;price&quot;</span><span class="tok-o">:</span> <span class="tok-mf">137.24</span><span class="tok-p">,</span>
        <span class="tok-s2">&quot;picture&quot;</span><span class="tok-o">:</span> <span class="tok-s2">&quot;http://lorempixel.com/200/200/technics/?id=155.1389&quot;</span><span class="tok-p">,</span>
        <span class="tok-s2">&quot;brand&quot;</span><span class="tok-o">:</span> <span class="tok-s2">&quot;nike&quot;</span><span class="tok-p">,</span>
        <span class="tok-s2">&quot;name&quot;</span><span class="tok-o">:</span> <span class="tok-s2">&quot;Zoomair&quot;</span><span class="tok-p">,</span>
        <span class="tok-s2">&quot;rating&quot;</span><span class="tok-o">:</span> <span class="tok-mi">0</span>
    <span class="tok-p">},</span>
    <span class="tok-p">{</span>
        <span class="tok-s2">&quot;_id&quot;</span><span class="tok-o">:</span> <span class="tok-s2">&quot;54c688af5f342fa2c06d2f3b&quot;</span><span class="tok-p">,</span>
        <span class="tok-s2">&quot;price&quot;</span><span class="tok-o">:</span> <span class="tok-mf">80.47</span><span class="tok-p">,</span>
        <span class="tok-s2">&quot;picture&quot;</span><span class="tok-o">:</span> <span class="tok-s2">&quot;http://lorempixel.com/200/200/food/?id=927.9926&quot;</span><span class="tok-p">,</span>
        <span class="tok-s2">&quot;brand&quot;</span><span class="tok-o">:</span> <span class="tok-s2">&quot;reebok&quot;</span><span class="tok-p">,</span>
        <span class="tok-s2">&quot;name&quot;</span><span class="tok-o">:</span> <span class="tok-s2">&quot;Volit&quot;</span><span class="tok-p">,</span>
        <span class="tok-s2">&quot;rating&quot;</span><span class="tok-o">:</span> <span class="tok-mi">2</span>
    <span class="tok-p">},</span>
    <span class="tok-p">{</span>
        <span class="tok-s2">&quot;_id&quot;</span><span class="tok-o">:</span> <span class="tok-s2">&quot;54c688afbe7e2107363d0945&quot;</span><span class="tok-p">,</span>
        <span class="tok-s2">&quot;price&quot;</span><span class="tok-o">:</span> <span class="tok-mf">93.53</span><span class="tok-p">,</span>
        <span class="tok-s2">&quot;picture&quot;</span><span class="tok-o">:</span> <span class="tok-s2">&quot;http://lorempixel.com/200/200/animals/?id=387.7504&quot;</span><span class="tok-p">,</span>
        <span class="tok-s2">&quot;brand&quot;</span><span class="tok-o">:</span> <span class="tok-s2">&quot;nike&quot;</span><span class="tok-p">,</span>
        <span class="tok-s2">&quot;name&quot;</span><span class="tok-o">:</span> <span class="tok-s2">&quot;Konkis&quot;</span><span class="tok-p">,</span>
        <span class="tok-s2">&quot;rating&quot;</span><span class="tok-o">:</span> <span class="tok-mi">4</span>
    <span class="tok-p">},</span>
    <span class="tok-p">{</span>
        <span class="tok-s2">&quot;_id&quot;</span><span class="tok-o">:</span> <span class="tok-s2">&quot;54c688af92223b7f877f096f&quot;</span><span class="tok-p">,</span>
        <span class="tok-s2">&quot;price&quot;</span><span class="tok-o">:</span> <span class="tok-mf">94.82</span><span class="tok-p">,</span>
        <span class="tok-s2">&quot;picture&quot;</span><span class="tok-o">:</span> <span class="tok-s2">&quot;http://lorempixel.com/200/200/nightlife/?id=296.9771&quot;</span><span class="tok-p">,</span>
        <span class="tok-s2">&quot;brand&quot;</span><span class="tok-o">:</span> <span class="tok-s2">&quot;adidas&quot;</span><span class="tok-p">,</span>
        <span class="tok-s2">&quot;name&quot;</span><span class="tok-o">:</span> <span class="tok-s2">&quot;Stockstring&quot;</span><span class="tok-p">,</span>
        <span class="tok-s2">&quot;rating&quot;</span><span class="tok-o">:</span> <span class="tok-mi">3</span>
    <span class="tok-p">},</span>
    <span class="tok-p">{</span>
        <span class="tok-s2">&quot;_id&quot;</span><span class="tok-o">:</span> <span class="tok-s2">&quot;54c688af24de4b9fc39e0d48&quot;</span><span class="tok-p">,</span>
        <span class="tok-s2">&quot;price&quot;</span><span class="tok-o">:</span> <span class="tok-mf">109.24</span><span class="tok-p">,</span>
        <span class="tok-s2">&quot;picture&quot;</span><span class="tok-o">:</span> <span class="tok-s2">&quot;http://lorempixel.com/200/200/city/?id=427.4133&quot;</span><span class="tok-p">,</span>
        <span class="tok-s2">&quot;brand&quot;</span><span class="tok-o">:</span> <span class="tok-s2">&quot;adidas&quot;</span><span class="tok-p">,</span>
        <span class="tok-s2">&quot;name&quot;</span><span class="tok-o">:</span> <span class="tok-s2">&quot;Dong-Phase&quot;</span><span class="tok-p">,</span>
        <span class="tok-s2">&quot;rating&quot;</span><span class="tok-o">:</span> <span class="tok-mi">1</span>
    <span class="tok-p">},</span>
    <span class="tok-p">{</span>
        <span class="tok-s2">&quot;_id&quot;</span><span class="tok-o">:</span> <span class="tok-s2">&quot;54c688afee99272b911e93fd&quot;</span><span class="tok-p">,</span>
        <span class="tok-s2">&quot;price&quot;</span><span class="tok-o">:</span> <span class="tok-mf">92.19</span><span class="tok-p">,</span>
        <span class="tok-s2">&quot;picture&quot;</span><span class="tok-o">:</span> <span class="tok-s2">&quot;http://lorempixel.com/200/200/nature/?id=580.5475&quot;</span><span class="tok-p">,</span>
        <span class="tok-s2">&quot;brand&quot;</span><span class="tok-o">:</span> <span class="tok-s2">&quot;adidas&quot;</span><span class="tok-p">,</span>
        <span class="tok-s2">&quot;name&quot;</span><span class="tok-o">:</span> <span class="tok-s2">&quot;Duozoozap&quot;</span><span class="tok-p">,</span>
        <span class="tok-s2">&quot;rating&quot;</span><span class="tok-o">:</span> <span class="tok-mi">0</span>
    <span class="tok-p">},</span>
    <span class="tok-p">{</span>
        <span class="tok-s2">&quot;_id&quot;</span><span class="tok-o">:</span> <span class="tok-s2">&quot;54c688af3593d3f6a34bc2a4&quot;</span><span class="tok-p">,</span>
        <span class="tok-s2">&quot;price&quot;</span><span class="tok-o">:</span> <span class="tok-mf">82.37</span><span class="tok-p">,</span>
        <span class="tok-s2">&quot;picture&quot;</span><span class="tok-o">:</span> <span class="tok-s2">&quot;http://lorempixel.com/200/200/nightlife/?id=366.9091&quot;</span><span class="tok-p">,</span>
        <span class="tok-s2">&quot;brand&quot;</span><span class="tok-o">:</span> <span class="tok-s2">&quot;reebok&quot;</span><span class="tok-p">,</span>
        <span class="tok-s2">&quot;name&quot;</span><span class="tok-o">:</span> <span class="tok-s2">&quot;X-dom&quot;</span><span class="tok-p">,</span>
        <span class="tok-s2">&quot;rating&quot;</span><span class="tok-o">:</span> <span class="tok-mi">3</span>
    <span class="tok-p">},</span>
    <span class="tok-p">{</span>
        <span class="tok-s2">&quot;_id&quot;</span><span class="tok-o">:</span> <span class="tok-s2">&quot;54c688af804d847b847935ac&quot;</span><span class="tok-p">,</span>
        <span class="tok-s2">&quot;price&quot;</span><span class="tok-o">:</span> <span class="tok-mf">76.53</span><span class="tok-p">,</span>
        <span class="tok-s2">&quot;picture&quot;</span><span class="tok-o">:</span> <span class="tok-s2">&quot;http://lorempixel.com/200/200/nature/?id=971.7978&quot;</span><span class="tok-p">,</span>
        <span class="tok-s2">&quot;brand&quot;</span><span class="tok-o">:</span> <span class="tok-s2">&quot;nike&quot;</span><span class="tok-p">,</span>
        <span class="tok-s2">&quot;name&quot;</span><span class="tok-o">:</span> <span class="tok-s2">&quot;Konkis&quot;</span><span class="tok-p">,</span>
        <span class="tok-s2">&quot;rating&quot;</span><span class="tok-o">:</span> <span class="tok-mi">3</span>
    <span class="tok-p">},</span>
    <span class="tok-p">{</span>
        <span class="tok-s2">&quot;_id&quot;</span><span class="tok-o">:</span> <span class="tok-s2">&quot;54c688af96ba1759662c4274&quot;</span><span class="tok-p">,</span>
        <span class="tok-s2">&quot;price&quot;</span><span class="tok-o">:</span> <span class="tok-mf">90.01</span><span class="tok-p">,</span>
        <span class="tok-s2">&quot;picture&quot;</span><span class="tok-o">:</span> <span class="tok-s2">&quot;http://lorempixel.com/200/200/city/?id=37.581&quot;</span><span class="tok-p">,</span>
        <span class="tok-s2">&quot;brand&quot;</span><span class="tok-o">:</span> <span class="tok-s2">&quot;reebok&quot;</span><span class="tok-p">,</span>
        <span class="tok-s2">&quot;name&quot;</span><span class="tok-o">:</span> <span class="tok-s2">&quot;Ecooveit&quot;</span><span class="tok-p">,</span>
        <span class="tok-s2">&quot;rating&quot;</span><span class="tok-o">:</span> <span class="tok-mi">4</span>
    <span class="tok-p">},</span>
    <span class="tok-p">{</span>
        <span class="tok-s2">&quot;_id&quot;</span><span class="tok-o">:</span> <span class="tok-s2">&quot;54c688afa4ee53c977c9ca3a&quot;</span><span class="tok-p">,</span>
        <span class="tok-s2">&quot;price&quot;</span><span class="tok-o">:</span> <span class="tok-mf">81.28</span><span class="tok-p">,</span>
        <span class="tok-s2">&quot;picture&quot;</span><span class="tok-o">:</span> <span class="tok-s2">&quot;http://lorempixel.com/200/200/transport/?id=752.8523&quot;</span><span class="tok-p">,</span>
        <span class="tok-s2">&quot;brand&quot;</span><span class="tok-o">:</span> <span class="tok-s2">&quot;adidas&quot;</span><span class="tok-p">,</span>
        <span class="tok-s2">&quot;name&quot;</span><span class="tok-o">:</span> <span class="tok-s2">&quot;Superstrong&quot;</span><span class="tok-p">,</span>
        <span class="tok-s2">&quot;rating&quot;</span><span class="tok-o">:</span> <span class="tok-mi">1</span>
    <span class="tok-p">},</span>
    <span class="tok-p">{</span>
        <span class="tok-s2">&quot;_id&quot;</span><span class="tok-o">:</span> <span class="tok-s2">&quot;54c688af85e103fa79c83752&quot;</span><span class="tok-p">,</span>
        <span class="tok-s2">&quot;price&quot;</span><span class="tok-o">:</span> <span class="tok-mf">134.79</span><span class="tok-p">,</span>
        <span class="tok-s2">&quot;picture&quot;</span><span class="tok-o">:</span> <span class="tok-s2">&quot;http://lorempixel.com/200/200/fashion/?id=358.5133&quot;</span><span class="tok-p">,</span>
        <span class="tok-s2">&quot;brand&quot;</span><span class="tok-o">:</span> <span class="tok-s2">&quot;reebok&quot;</span><span class="tok-p">,</span>
        <span class="tok-s2">&quot;name&quot;</span><span class="tok-o">:</span> <span class="tok-s2">&quot;Superstrong&quot;</span><span class="tok-p">,</span>
        <span class="tok-s2">&quot;rating&quot;</span><span class="tok-o">:</span> <span class="tok-mi">5</span>
    <span class="tok-p">},</span>
    <span class="tok-p">{</span>
        <span class="tok-s2">&quot;_id&quot;</span><span class="tok-o">:</span> <span class="tok-s2">&quot;54c688af04a986612841b7dc&quot;</span><span class="tok-p">,</span>
        <span class="tok-s2">&quot;price&quot;</span><span class="tok-o">:</span> <span class="tok-mf">76.37</span><span class="tok-p">,</span>
        <span class="tok-s2">&quot;picture&quot;</span><span class="tok-o">:</span> <span class="tok-s2">&quot;http://lorempixel.com/200/200/cats/?id=912.0469&quot;</span><span class="tok-p">,</span>
        <span class="tok-s2">&quot;brand&quot;</span><span class="tok-o">:</span> <span class="tok-s2">&quot;reebok&quot;</span><span class="tok-p">,</span>
        <span class="tok-s2">&quot;name&quot;</span><span class="tok-o">:</span> <span class="tok-s2">&quot;Fresh-Home&quot;</span><span class="tok-p">,</span>
        <span class="tok-s2">&quot;rating&quot;</span><span class="tok-o">:</span> <span class="tok-mi">0</span>
    <span class="tok-p">},</span>
    <span class="tok-p">{</span>
        <span class="tok-s2">&quot;_id&quot;</span><span class="tok-o">:</span> <span class="tok-s2">&quot;54c688af5605253556078cff&quot;</span><span class="tok-p">,</span>
        <span class="tok-s2">&quot;price&quot;</span><span class="tok-o">:</span> <span class="tok-mf">147.47</span><span class="tok-p">,</span>
        <span class="tok-s2">&quot;picture&quot;</span><span class="tok-o">:</span> <span class="tok-s2">&quot;http://lorempixel.com/200/200/transport/?id=884.8266&quot;</span><span class="tok-p">,</span>
        <span class="tok-s2">&quot;brand&quot;</span><span class="tok-o">:</span> <span class="tok-s2">&quot;adidas&quot;</span><span class="tok-p">,</span>
        <span class="tok-s2">&quot;name&quot;</span><span class="tok-o">:</span> <span class="tok-s2">&quot;Touch-Hold&quot;</span><span class="tok-p">,</span>
        <span class="tok-s2">&quot;rating&quot;</span><span class="tok-o">:</span> <span class="tok-mi">2</span>
    <span class="tok-p">},</span>
    <span class="tok-p">{</span>
        <span class="tok-s2">&quot;_id&quot;</span><span class="tok-o">:</span> <span class="tok-s2">&quot;54c688afa71c0978b878efd6&quot;</span><span class="tok-p">,</span>
        <span class="tok-s2">&quot;price&quot;</span><span class="tok-o">:</span> <span class="tok-mf">106.83</span><span class="tok-p">,</span>
        <span class="tok-s2">&quot;picture&quot;</span><span class="tok-o">:</span> <span class="tok-s2">&quot;http://lorempixel.com/200/200/fashion/?id=598.1251&quot;</span><span class="tok-p">,</span>
        <span class="tok-s2">&quot;brand&quot;</span><span class="tok-o">:</span> <span class="tok-s2">&quot;nike&quot;</span><span class="tok-p">,</span>
        <span class="tok-s2">&quot;name&quot;</span><span class="tok-o">:</span> <span class="tok-s2">&quot;Saorunlab&quot;</span><span class="tok-p">,</span>
        <span class="tok-s2">&quot;rating&quot;</span><span class="tok-o">:</span> <span class="tok-mi">2</span>
    <span class="tok-p">},</span>
    <span class="tok-p">{</span>
        <span class="tok-s2">&quot;_id&quot;</span><span class="tok-o">:</span> <span class="tok-s2">&quot;54c688af0450426ca2d7680a&quot;</span><span class="tok-p">,</span>
        <span class="tok-s2">&quot;price&quot;</span><span class="tok-o">:</span> <span class="tok-mf">72.76</span><span class="tok-p">,</span>
        <span class="tok-s2">&quot;picture&quot;</span><span class="tok-o">:</span> <span class="tok-s2">&quot;http://lorempixel.com/200/200/food/?id=831.3375&quot;</span><span class="tok-p">,</span>
        <span class="tok-s2">&quot;brand&quot;</span><span class="tok-o">:</span> <span class="tok-s2">&quot;adidas&quot;</span><span class="tok-p">,</span>
        <span class="tok-s2">&quot;name&quot;</span><span class="tok-o">:</span> <span class="tok-s2">&quot;Konkis&quot;</span><span class="tok-p">,</span>
        <span class="tok-s2">&quot;rating&quot;</span><span class="tok-o">:</span> <span class="tok-mi">1</span>
    <span class="tok-p">},</span>
    <span class="tok-p">{</span>
        <span class="tok-s2">&quot;_id&quot;</span><span class="tok-o">:</span> <span class="tok-s2">&quot;54c688afe30ff32f443e7c20&quot;</span><span class="tok-p">,</span>
        <span class="tok-s2">&quot;price&quot;</span><span class="tok-o">:</span> <span class="tok-mf">83.46</span><span class="tok-p">,</span>
        <span class="tok-s2">&quot;picture&quot;</span><span class="tok-o">:</span> <span class="tok-s2">&quot;http://lorempixel.com/200/200/sports/?id=604.4555&quot;</span><span class="tok-p">,</span>
        <span class="tok-s2">&quot;brand&quot;</span><span class="tok-o">:</span> <span class="tok-s2">&quot;adidas&quot;</span><span class="tok-p">,</span>
        <span class="tok-s2">&quot;name&quot;</span><span class="tok-o">:</span> <span class="tok-s2">&quot;Rank Sololax&quot;</span><span class="tok-p">,</span>
        <span class="tok-s2">&quot;rating&quot;</span><span class="tok-o">:</span> <span class="tok-mi">5</span>
    <span class="tok-p">},</span>
    <span class="tok-p">{</span>
        <span class="tok-s2">&quot;_id&quot;</span><span class="tok-o">:</span> <span class="tok-s2">&quot;54c688afd24500b5cbc85148&quot;</span><span class="tok-p">,</span>
        <span class="tok-s2">&quot;price&quot;</span><span class="tok-o">:</span> <span class="tok-mf">77.19</span><span class="tok-p">,</span>
        <span class="tok-s2">&quot;picture&quot;</span><span class="tok-o">:</span> <span class="tok-s2">&quot;http://lorempixel.com/200/200/abstract/?id=333.8619&quot;</span><span class="tok-p">,</span>
        <span class="tok-s2">&quot;brand&quot;</span><span class="tok-o">:</span> <span class="tok-s2">&quot;reebok&quot;</span><span class="tok-p">,</span>
        <span class="tok-s2">&quot;name&quot;</span><span class="tok-o">:</span> <span class="tok-s2">&quot;Ecooveit&quot;</span><span class="tok-p">,</span>
        <span class="tok-s2">&quot;rating&quot;</span><span class="tok-o">:</span> <span class="tok-mi">0</span>
    <span class="tok-p">},</span>
    <span class="tok-p">{</span>
        <span class="tok-s2">&quot;_id&quot;</span><span class="tok-o">:</span> <span class="tok-s2">&quot;54c688afb08a3950c86aa47f&quot;</span><span class="tok-p">,</span>
        <span class="tok-s2">&quot;price&quot;</span><span class="tok-o">:</span> <span class="tok-mf">82.05</span><span class="tok-p">,</span>
        <span class="tok-s2">&quot;picture&quot;</span><span class="tok-o">:</span> <span class="tok-s2">&quot;http://lorempixel.com/200/200/food/?id=118.5947&quot;</span><span class="tok-p">,</span>
        <span class="tok-s2">&quot;brand&quot;</span><span class="tok-o">:</span> <span class="tok-s2">&quot;nike&quot;</span><span class="tok-p">,</span>
        <span class="tok-s2">&quot;name&quot;</span><span class="tok-o">:</span> <span class="tok-s2">&quot;Zonedex&quot;</span><span class="tok-p">,</span>
        <span class="tok-s2">&quot;rating&quot;</span><span class="tok-o">:</span> <span class="tok-mi">5</span>
    <span class="tok-p">},</span>
    <span class="tok-p">{</span>
        <span class="tok-s2">&quot;_id&quot;</span><span class="tok-o">:</span> <span class="tok-s2">&quot;54c688af234056a9e3f5c902&quot;</span><span class="tok-p">,</span>
        <span class="tok-s2">&quot;price&quot;</span><span class="tok-o">:</span> <span class="tok-mf">100.76</span><span class="tok-p">,</span>
        <span class="tok-s2">&quot;picture&quot;</span><span class="tok-o">:</span> <span class="tok-s2">&quot;http://lorempixel.com/200/200/technics/?id=20.7657&quot;</span><span class="tok-p">,</span>
        <span class="tok-s2">&quot;brand&quot;</span><span class="tok-o">:</span> <span class="tok-s2">&quot;reebok&quot;</span><span class="tok-p">,</span>
        <span class="tok-s2">&quot;name&quot;</span><span class="tok-o">:</span> <span class="tok-s2">&quot;Saorunlab&quot;</span><span class="tok-p">,</span>
        <span class="tok-s2">&quot;rating&quot;</span><span class="tok-o">:</span> <span class="tok-mi">0</span>
    <span class="tok-p">}</span>
<span class="tok-p">];</span>
<span class="tok-p">}</span>
</td></tr></table></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_ping_pong_0_67_puntos">3.3.3. Ping-pong (0,67 puntos)</h4>
<div class="paragraph">
<p>Este ejercicio lo realizaremos en una carpeta llamada <code>pingpong</code>.</p>
</div>
<div class="paragraph">
<p>En este ejercicio vamos a probar la propagación de eventos. Dispondremos de la siguiente plantilla HTML:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="html"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37</div></td><td class="code"><span class="tok-nt">&lt;div</span> <span class="tok-na">ng-app</span><span class="tok-nt">&gt;</span>

  <span class="tok-nt">&lt;style&gt;</span>
    <span class="tok-nc">.ng-scope</span> <span class="tok-p">{</span>
      <span class="tok-k">border</span><span class="tok-o">:</span> <span class="tok-m">1px</span> <span class="tok-k">dotted</span> <span class="tok-nb">red</span><span class="tok-p">;</span>
      <span class="tok-k">margin</span><span class="tok-o">:</span> <span class="tok-m">5px</span><span class="tok-p">;</span>
    <span class="tok-p">}</span>
  <span class="tok-nt">&lt;/style&gt;</span>

  <span class="tok-nt">&lt;div</span> <span class="tok-na">ng-controller=</span><span class="tok-s">&quot;Controller1&quot;</span><span class="tok-nt">&gt;</span>
    <span class="tok-nt">&lt;div</span> <span class="tok-na">ng-init=</span><span class="tok-s">&quot;ping = 0&quot;</span><span class="tok-nt">&gt;&lt;/div&gt;</span>
    <span class="tok-nt">&lt;div</span> <span class="tok-na">ng-init=</span><span class="tok-s">&quot;pong = 0&quot;</span><span class="tok-nt">&gt;&lt;/div&gt;</span>

    <span class="tok-nt">&lt;button</span> <span class="tok-na">ng-click=</span><span class="tok-s">&quot;$emit(&#39;ping&#39;)&quot;</span><span class="tok-nt">&gt;</span>Emit event<span class="tok-nt">&lt;/button&gt;</span>
    <span class="tok-nt">&lt;button</span> <span class="tok-na">ng-click=</span><span class="tok-s">&quot;$broadcast(&#39;pong&#39;)&quot;</span><span class="tok-nt">&gt;</span>Broadcast event<span class="tok-nt">&lt;/button&gt;</span>

    <span class="tok-nt">&lt;div&gt;</span>ping = {{ ping }}<span class="tok-nt">&lt;/div&gt;</span>
    <span class="tok-nt">&lt;div&gt;</span>pong = {{ pong }}<span class="tok-nt">&lt;/div&gt;</span>

    <span class="tok-nt">&lt;div</span> <span class="tok-na">ng-controller=</span><span class="tok-s">&quot;Controller2&quot;</span><span class="tok-nt">&gt;</span>
      <span class="tok-nt">&lt;button</span> <span class="tok-na">ng-click=</span><span class="tok-s">&quot;&quot;</span><span class="tok-nt">&gt;</span>Emit event<span class="tok-nt">&lt;/button&gt;</span>
      <span class="tok-nt">&lt;button</span> <span class="tok-na">ng-click=</span><span class="tok-s">&quot;&quot;</span><span class="tok-nt">&gt;</span>Broadcast event<span class="tok-nt">&lt;/button&gt;</span>

      <span class="tok-nt">&lt;div&gt;</span>ping = {{ ping }}<span class="tok-nt">&lt;/div&gt;</span>
      <span class="tok-nt">&lt;div&gt;</span>pong = {{ pong }}<span class="tok-nt">&lt;/div&gt;</span>

      <span class="tok-nt">&lt;div</span> <span class="tok-na">ng-controller=</span><span class="tok-s">&quot;Controller2&quot;</span><span class="tok-nt">&gt;</span>
        <span class="tok-nt">&lt;button</span> <span class="tok-na">ng-click=</span><span class="tok-s">&quot;&quot;</span><span class="tok-nt">&gt;</span>Emit event<span class="tok-nt">&lt;/button&gt;</span>
        <span class="tok-nt">&lt;button</span> <span class="tok-na">ng-click=</span><span class="tok-s">&quot;&quot;</span><span class="tok-nt">&gt;</span>Broadcast event<span class="tok-nt">&lt;/button&gt;</span>

        <span class="tok-nt">&lt;div&gt;</span>ping = {{ ping }}<span class="tok-nt">&lt;/div&gt;</span>
        <span class="tok-nt">&lt;div&gt;</span>pong = {{ pong }}<span class="tok-nt">&lt;/div&gt;&lt;/div&gt;</span>

    <span class="tok-nt">&lt;/div&gt;</span>

  <span class="tok-nt">&lt;/div&gt;</span>
<span class="tok-nt">&lt;/div&gt;</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>Y la siguiente plantilla JavaScript:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="javascript"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17</div></td><td class="code"><span class="tok-kd">function</span> <span class="tok-nx">Controller1</span><span class="tok-p">(</span><span class="tok-nx">$scope</span><span class="tok-p">)</span> <span class="tok-p">{</span>
  <span class="tok-nx">$scope</span><span class="tok-p">.</span><span class="tok-nx">$on</span><span class="tok-p">(</span><span class="tok-s1">&#39;ping&#39;</span><span class="tok-p">,</span> <span class="tok-kd">function</span><span class="tok-p">(){</span>
    <span class="tok-nx">$scope</span><span class="tok-p">.</span><span class="tok-nx">ping</span><span class="tok-err">``</span><span class="tok-p">;</span>
  <span class="tok-p">});</span>

  <span class="tok-nx">$scope</span><span class="tok-p">.</span><span class="tok-nx">$on</span><span class="tok-p">(</span><span class="tok-s1">&#39;pong&#39;</span><span class="tok-p">,</span> <span class="tok-kd">function</span><span class="tok-p">(){</span>
    <span class="tok-nx">$scope</span><span class="tok-p">.</span><span class="tok-nx">pong</span><span class="tok-err">``</span><span class="tok-p">;</span>
  <span class="tok-p">});</span>
<span class="tok-p">}</span>

<span class="tok-kd">function</span> <span class="tok-nx">Controller2</span><span class="tok-p">(</span><span class="tok-nx">$scope</span><span class="tok-p">)</span> <span class="tok-p">{</span>

<span class="tok-p">}</span>

<span class="tok-kd">function</span> <span class="tok-nx">Controller3</span><span class="tok-p">(</span><span class="tok-nx">$scope</span><span class="tok-p">)</span> <span class="tok-p">{</span>

<span class="tok-p">}</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>Si ahora pulsamos en cualquiera de los dos primeros botones, veremos que los contadores <em>ping</em> y <em>pong</em> adquieren los mismos valores.</p>
</div>
<div class="paragraph">
<p>Deberemos:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Emitir eventos <em>ping</em> y <em>pong</em> en el resto de botones.</p>
</li>
<li>
<p>Introducir la lógica necesaria para que  el evento que desencadene cada botón afecte al <code>scope</code> propio y a los ascendentes (en caso de <code>$emit</code>) o descendientes (en caso de <code>$broadcast</code>).</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>No se puede renombrar ninguno de los nombres de variable de la vista (todos deben llamarse <code>ping</code> y <code>pong</code>).</p>
</div>
<div class="paragraph">
<p>Tener en cuenta la herencia prototípica que hemos estado viendo.</p>
</div>
<div class="paragraph">
<p>Se ha introducido un poco de CSS para que se delimiten bien los tres <code>scope</code> que hay en la aplicación.</p>
</div>
<div class="paragraph">
<p>Si los bloques <code>ng-init</code> te molestan, puedes quitarlos
&lt;&lt;&lt;</p>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="sesion04">4. Módulos y servicios</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Desde el inicio de las sesiones, hemos visto que se han usado en varias ocasiones
funciones globales para definir controladores. Esto acaba aquí, definirlo de esta
manera es poco elegante, afecta a la estructura de la aplicación y hace el código más
difícil de mantener y testear. Es por ello que AngularJS dispone de una serie de
APIs que nos permiten definir módulos, y definir objetos dentro de ésto, de una
manera muy sencilla.</p>
</div>
<div class="sect2">
<h3 id="_hola_mundo_y_van_tres">4.1. Hola Mundo (y van tres)</h3>
<div class="paragraph">
<p>Despidámonos para siempre de</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="javascript"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1</div></td><td class="code"><span class="tok-kd">var</span> <span class="tok-nx">HelloCtrl</span> <span class="tok-o">=</span> <span class="tok-kd">function</span> <span class="tok-p">(</span> <span class="tok-nx">$scope</span> <span class="tok-p">)</span> <span class="tok-p">{</span> <span class="tok-nx">$scope</span><span class="tok-p">.</span><span class="tok-nx">name</span> <span class="tok-o">=</span> <span class="tok-s1">&#39;World&#39;</span><span class="tok-p">;</span> <span class="tok-p">}</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>y digamos hola a</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="javascript"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1</div></td><td class="code"><span class="tok-nx">angular</span><span class="tok-p">.</span><span class="tok-nx">module</span><span class="tok-p">(</span><span class="tok-s1">&#39;helloApp&#39;</span><span class="tok-p">,</span> <span class="tok-p">[])</span> <span class="tok-p">.</span><span class="tok-nx">controller</span> <span class="tok-p">(</span><span class="tok-s1">&#39;HelloCtrl&#39;</span><span class="tok-p">,</span> <span class="tok-kd">function</span><span class="tok-p">(</span><span class="tok-nx">$scope</span><span class="tok-p">){</span> <span class="tok-nx">$scope</span><span class="tok-p">.</span><span class="tok-nx">name</span> <span class="tok-o">=</span> <span class="tok-s1">&#39;World&#39;</span><span class="tok-p">;</span> <span class="tok-p">});</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>El objeto <code>angular</code> define una serie de utilidades. Una de ellas es module, que
permite definir módulos. Un módulo es como una especie de contenedor de objetos
gestionados por AngularJS, como por ejemplo los controladores.</p>
</div>
</div>
<div class="sect2">
<h3 id="_module">4.2. Module</h3>
<div class="paragraph">
<p>Para que el inyector de AngularJS sepa cómo crear y conectar todos estos objetos,
neceista un registro de <em>recetas</em>. Cada <em>receta</em> tiene un identificador del objeto
y la descripción de cómo crearlo.</p>
</div>
<div class="paragraph">
<p>Una <em>receta</em> debe pertenecer a un módulo de AngularJS, que es un saco que contiene
una o más <em>recetas</em>. Y además, un módulo también puede contener información sobre otros módulos.</p>
</div>
<div class="paragraph">
<p>Cuando se inicia una aplicación de AngularJS con un módulo, AngularJS crea una instancia de un injector, que es quien crea el registro
de las <em>recetas</em> como una unión de las existentes en el <em>core</em>, el módulo de la aplicación y sus
dependencias El inyector consulta al registro de <em>recetas</em> cuando ve que tiene que crear un objeto para la aplicación.</p>
</div>
<div class="paragraph">
<p>Para definir un módulo, indicamos su nombre como primer argumento. El segundo argumento
es un array, en el que incluiremos otros módulos, en caso de tener alguna dependencia.
Ya vimos algo de esto en la sesión de introducción cuando introdujimos las rutas.</p>
</div>
<div class="paragraph">
<p>La llamada a <code>angular.module('helloApp', [])</code> devuelve una instancia de un módulo recién creado.
Una vez tenemos la instancia, podemos definir controladores. Como hemos visto en el
ejemplo, ésto se hace llamando a la función <code>controller(controllerName, controllerConstructor)</code>.</p>
</div>
<div class="paragraph">
<p>Una vez hemos definido un módulo, tenemos que informar a AngularJS de su existencia,
cosa que haremos dando un valor a la directiva <code>ng-app</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="html"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1</div></td><td class="code"><span class="tok-nt">&lt;body</span> <span class="tok-na">ng-app=</span><span class="tok-s">&quot;helloApp&quot;</span><span class="tok-nt">&gt;</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>La directiva <code>ngApp</code> designa el elemento raíz de nuestra aplicación, y habitualmente
se coloca cerca del elemento raíz de la página, como las etiquetas <code>&lt;body&gt;</code> o <code>&lt;html&gt;</code>.</p>
</div>
</div>
<div class="sect2">
<h3 id="_servicios">4.3. Servicios</h3>
<div class="paragraph">
<p>Una vez hemos declarado un módulo, hemos dicho que podemos usarlo para
registrar una serie de <em>recetas</em>
para la creación de objetos de diversa índole.</p>
</div>
<div class="paragraph">
<p>Pero aunque sean de diversa índole, podríamos categorizar estos objetos en
dos grandes grupos: <strong>servicios</strong> y <strong>objetos especializados</strong>.</p>
</div>
<div class="paragraph">
<p>Un servicio es un objeto cuya API está definida por el desarrollador que escribe dicho servicio.</p>
</div>
<div class="paragraph">
<p>Por su parte, un objeto especializado se ajusta a una API específica de AngularJS.
Estos objetos pueden ser: controladores, directivas, filtros o animaciones.</p>
</div>
<div class="paragraph">
<p>El inyector de AngularJS necesita saber cómo crear estos objetos, y se lo decimos
tipificando nuestro objeto a la hora de crearlo. Hay cinco tipos de <em>recetas</em>.</p>
</div>
<div class="paragraph">
<p>La más verbosa, pero también la más comprensible, es la del <code>Provider</code>. El resto
(<code>Value</code>, <code>factory</code>, <code>Service</code> y <code>constant</code>) son sólo <em>azúcar sintáctico</em> sobre
la definición de un <code>Provider</code>.</p>
</div>
<div class="paragraph">
<p>Veamos los diferentes escenarios para crear y usar servicios.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Todos los servicios en AngularJS son <em>singletons</em> <span class="footnote">[<a id="_footnoteref_2" class="footnote" href="#_footnote_2" title="View footnote.">2</a>]</span>.
Esto significa que el inyector usará las <em>recetas</em> como mucho una vez para crear
el objeto. Posteriormente, éste se cacheará para la próxima vez que pueda hacer
falta.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Como veremos, los creadores de AngularJS llamaron <code>Service</code> a una de estas <em>recetas</em>
que designan servicios. De manera que cuando veamos su término en inglés nos estaremos
refiriendo a la <em>receta</em> en concreto, mientras que cuando hagamos referencia al término
<em>servicio</em> nos estaremos refiriendo a cualquiera de ellos.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="sect3">
<h4 id="_value">4.3.1. Value</h4>
<div class="paragraph">
<p>Digamos que queremos un servicio muy sencillo, llamado <code>clientId</code>, que nos devuelve
un String que representa el identificador de usuario que usamos para alguna API
remota. Lo podríamos definir de esta manera</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="javascript"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2</div></td><td class="code"><span class="tok-kd">var</span> <span class="tok-nx">myApp</span> <span class="tok-o">=</span> <span class="tok-nx">angular</span><span class="tok-p">.</span><span class="tok-nx">module</span><span class="tok-p">(</span><span class="tok-s1">&#39;myApp&#39;</span><span class="tok-p">,</span> <span class="tok-p">[]);</span>
<span class="tok-nx">myApp</span><span class="tok-p">.</span><span class="tok-nx">value</span><span class="tok-p">(</span><span class="tok-s1">&#39;clientId&#39;</span><span class="tok-p">,</span> <span class="tok-s1">&#39;a123456le54321x&#39;</span><span class="tok-p">);</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>Hemos creado un módulo de AngularJS llamado <code>myApp</code>. Posteriormente, hemoss dicho
que este módulo contiene la <em>receta</em> para construir el servicio <code>clientId</code>, que
en este caso únicamente devuelve una cadena.</p>
</div>
<div class="paragraph">
<p>Si quisiéramos mostrarlo vía <em>two-way data binding</em> lo haríamos de la siguiente manera:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="javascript"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3</div></td><td class="code"><span class="tok-nx">myApp</span><span class="tok-p">.</span><span class="tok-nx">controller</span><span class="tok-p">(</span><span class="tok-s1">&#39;DemoController&#39;</span><span class="tok-p">,</span> <span class="tok-p">[</span><span class="tok-s1">&#39;clientId&#39;</span><span class="tok-p">,</span> <span class="tok-s1">&#39;$scope&#39;</span><span class="tok-p">,</span> <span class="tok-kd">function</span> <span class="tok-nx">DemoController</span><span class="tok-p">(</span><span class="tok-nx">clientId</span><span class="tok-p">,</span> <span class="tok-nx">$scope</span><span class="tok-p">)</span> <span class="tok-p">{</span>
  <span class="tok-nx">$scope</span><span class="tok-p">.</span><span class="tok-nx">clientId</span> <span class="tok-o">=</span> <span class="tok-nx">clientId</span><span class="tok-p">;</span>
<span class="tok-p">}]);</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="html"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3
4
5</div></td><td class="code"><span class="tok-nt">&lt;html</span> <span class="tok-na">ng-app=</span><span class="tok-s">&quot;myApp&quot;</span><span class="tok-nt">&gt;</span>
  <span class="tok-nt">&lt;body</span> <span class="tok-na">ng-controller=</span><span class="tok-s">&quot;DemoController&quot;</span><span class="tok-nt">&gt;</span>
    Client ID: {{clientId}}
  <span class="tok-nt">&lt;/body&gt;</span>
<span class="tok-nt">&lt;/html&gt;</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>En este ejemplo, hemos usado la <em>receta</em> <code>Value</code> para dársela a <code>DemoCtrl</code> cuando
invoca al servicio <code>clientId</code>.</p>
</div>
</div>
<div class="sect3">
<h4 id="_factory">4.3.2. Factory</h4>
<div class="paragraph">
<p>Un <code>Value</code> es fácil de escribir, pero se echan de menos unos elementos importantes
que necesitamos a menudo a la hora de escribir servicios. Así, pasaremos a conocer
un elemento más complejo, llamado <code>factory</code>. Una <code>factory</code> nos permite:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>tener dependencias con otros servicios</p>
</li>
<li>
<p>inicializar el servicio</p>
</li>
<li>
<p>inicialización perezosa</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Una <code>factory</code> construye un nuevo servicio mediante una función con cero o más argumentos.
Estos argumentos son dependencias con otros servicios, que se inyectarán en tiempo de creación.</p>
</div>
<div class="paragraph">
<p>Una <code>factory</code> no es más que una versión más potente de un <code>Value</code>, de manera que
podemos reescribir el servicio <code>clientId</code> de la siguiente manera:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="javascript"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3</div></td><td class="code"><span class="tok-nx">myApp</span><span class="tok-p">.</span><span class="tok-nx">factory</span><span class="tok-p">(</span><span class="tok-s1">&#39;clientId&#39;</span><span class="tok-p">,</span> <span class="tok-kd">function</span> <span class="tok-nx">clientIdFactory</span><span class="tok-p">()</span> <span class="tok-p">{</span>
  <span class="tok-k">return</span> <span class="tok-s1">&#39;a12345654321x&#39;</span><span class="tok-p">;</span>
<span class="tok-p">});</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>Pero dado que el token no es más que un a cadena, quizá crear un <code>Value</code> sería más
apropiado en este caso, y el código sería además más sencillo de interpretar.</p>
</div>
<div class="paragraph">
<p>Digamos que, por ejemplo, queremos crear un servicio encargado de calcular un <em>token</em>
para autenticarse contra una API remota. Este <em>token</em> se llamará <code>apiToken</code> y
se calculará en función del valor de <code>clientId</code>, y de una clave secreta guardada
en el almacenamiento local del navegador:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="javascript"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11</div></td><td class="code"><span class="tok-nx">myApp</span><span class="tok-p">.</span><span class="tok-nx">factory</span><span class="tok-p">(</span><span class="tok-s1">&#39;apiToken&#39;</span><span class="tok-p">,</span> <span class="tok-p">[</span><span class="tok-s1">&#39;clientId&#39;</span><span class="tok-p">,</span> <span class="tok-kd">function</span> <span class="tok-nx">apiTokenFactory</span><span class="tok-p">(</span><span class="tok-nx">clientId</span><span class="tok-p">)</span> <span class="tok-p">{</span>
  <span class="tok-kd">var</span> <span class="tok-nx">encrypt</span> <span class="tok-o">=</span> <span class="tok-kd">function</span><span class="tok-p">(</span><span class="tok-nx">data1</span><span class="tok-p">,</span> <span class="tok-nx">data2</span><span class="tok-p">)</span> <span class="tok-p">{</span>
    <span class="tok-c1">// NSA-proof encryption algorithm:</span>
    <span class="tok-k">return</span> <span class="tok-p">(</span><span class="tok-nx">data1</span> <span class="tok-o">+</span> <span class="tok-s1">&#39;:&#39;</span> <span class="tok-o">+</span> <span class="tok-nx">data2</span><span class="tok-p">).</span><span class="tok-nx">toUpperCase</span><span class="tok-p">();</span>
  <span class="tok-p">};</span>

  <span class="tok-kd">var</span> <span class="tok-nx">secret</span> <span class="tok-o">=</span> <span class="tok-nb">window</span><span class="tok-p">.</span><span class="tok-nx">localStorage</span><span class="tok-p">.</span><span class="tok-nx">getItem</span><span class="tok-p">(</span><span class="tok-s1">&#39;myApp.secret&#39;</span><span class="tok-p">);</span>
  <span class="tok-kd">var</span> <span class="tok-nx">apiToken</span> <span class="tok-o">=</span> <span class="tok-nx">encrypt</span><span class="tok-p">(</span><span class="tok-nx">clientId</span><span class="tok-p">,</span> <span class="tok-nx">secret</span><span class="tok-p">);</span>

  <span class="tok-k">return</span> <span class="tok-nx">apiToken</span><span class="tok-p">;</span>
<span class="tok-p">}]);</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>En el código anterior, vemos cómo se define el servicio <code>apiToken</code> con la <em>receta</em>
de una <code>factory</code> que depende del servicio <code>clientId</code>. Entonces crea un token de
autenticación a través de una encriptación hiperpotente indescifrable por la NSA <span class="footnote">[<a id="_footnoteref_3" class="footnote" href="#_footnote_3" title="View footnote.">3</a>]</span>.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Entre las <em>best practices</em> se recomienda nombrar una <code>factory</code> de la forma <code>&lt;nombreDelServicio&gt;Factory</code>.
Aunque nadie lo requiere, ayuda a la hora de revisar código, o bien a la hora de <em>debuggear</em>.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>De igual manera que un <code>Value</code> una <code>factory</code> puede crear un servicio de cualquier
tipo, ya sea una primitiva, un objeto, una función o una instancia de un tipo de dato propio. primitive, object literal, function, or even an instance of a custom type.</p>
</div>
</div>
<div class="sect3">
<h4 id="_service">4.3.3. Service</h4>
<div class="paragraph">
<p>Los desarrolladores JavaScript usan tipos de datos <em>custom</em> para escribir código OO.
Veamos cómo podríamos lanzar un Unicornio <span class="footnote">[<a id="_footnoteref_4" class="footnote" href="#_footnote_4" title="View footnote.">4</a>]</span>
al espacio mediante un servicio unicornLauncher, que es una instancia del siguiente
objeto:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="javascript"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3
4
5
6
7
8
9</div></td><td class="code"><span class="tok-kd">function</span> <span class="tok-nx">UnicornLauncher</span><span class="tok-p">(</span><span class="tok-nx">apiToken</span><span class="tok-p">)</span> <span class="tok-p">{</span>

  <span class="tok-k">this</span><span class="tok-p">.</span><span class="tok-nx">launchedCount</span> <span class="tok-o">=</span> <span class="tok-mi">0</span><span class="tok-p">;</span>
  <span class="tok-k">this</span><span class="tok-p">.</span><span class="tok-nx">launch</span> <span class="tok-o">=</span> <span class="tok-kd">function</span><span class="tok-p">()</span> <span class="tok-p">{</span>
    <span class="tok-c1">// make a request to the remote api and include the apiToken</span>
    <span class="tok-p">...</span>
    <span class="tok-k">this</span><span class="tok-p">.</span><span class="tok-nx">launchedCount</span><span class="tok-o">++</span><span class="tok-p">;</span>
  <span class="tok-p">}</span>
<span class="tok-p">}</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>Ya podemos lanzar unicornios al espacio, pero démonos cuenta que nuestro lanzador
requiere un <code>apiToken</code>. Lo bueno es que ya habíamos creado una <code>factory</code> que resolvía
este problema.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="javascript"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3</div></td><td class="code"><span class="tok-nx">myApp</span><span class="tok-p">.</span><span class="tok-nx">factory</span><span class="tok-p">(</span><span class="tok-s1">&#39;unicornLauncher&#39;</span><span class="tok-p">,</span> <span class="tok-p">[</span><span class="tok-s2">&quot;apiToken&quot;</span><span class="tok-p">,</span> <span class="tok-kd">function</span><span class="tok-p">(</span><span class="tok-nx">apiToken</span><span class="tok-p">)</span> <span class="tok-p">{</span>
  <span class="tok-k">return</span> <span class="tok-k">new</span> <span class="tok-nx">UnicornLauncher</span><span class="tok-p">(</span><span class="tok-nx">apiToken</span><span class="tok-p">);</span>
<span class="tok-p">}]);</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>Éste es, precisamente, el caso de uso más adecuado para un <code>Service</code>.</p>
</div>
<div class="paragraph">
<p>La <em>receta</em> de un <code>Service</code> produce un servicio, de igual manera que habíamos visto
con <code>Value</code> y <code>factory</code>, pero lo hace invocando un constructor mediante el operador
new. El constructor puede recibir cero o más argumentos, que representan dependencias
que necesita la instancia de este tipo.</p>
</div>
<div class="paragraph">
<p>Además, un <code>Service</code> sigue un patrón de diseño llamado <em>constructor injection</em>.
De manera que es el propio AngularJS quien se encarga de instanciar un nuevo objeto
de la clase dada. Como nuestro UnicornLauncher tiene un constricutor, podemos
reemplazar la <code>factory</code> por un <code>Service</code>, de la siguiente manera:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="javascript"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1</div></td><td class="code"><span class="tok-nx">myApp</span><span class="tok-p">.</span><span class="tok-nx">service</span><span class="tok-p">(</span><span class="tok-s1">&#39;unicornLauncher&#39;</span><span class="tok-p">,</span> <span class="tok-p">[</span><span class="tok-s2">&quot;apiToken&quot;</span><span class="tok-p">,</span> <span class="tok-nx">UnicornLauncher</span><span class="tok-p">]);</span>
</td></tr></table></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_provider">4.3.4. Provider</h4>
<div class="paragraph">
<p>Como se ha dicho anteriormente, el <code>Provider</code> es la base sobre la que se crean el
resto de servicios que hemos visto en los apartados anteriores. Precisamente porque
es la base sobre la que se asientan el resto, no será difícil comprender que es la que
nos ofrece mayores posibilidades. Pero en la mayoría de los casos todo lo que ofrece
es excesivo, y será recomendable hacer uso de los otros servicios.</p>
</div>
<div class="paragraph">
<p>La receta de un <code>Provider</code> se define como un tipo propio que implementa un método
<code>$get</code>. Este método es una función factoría <span class="footnote">[<a id="_footnoteref_5" class="footnote" href="#_footnote_5" title="View footnote.">5</a>]</span>,
como el que se usa en una <code>factory</code>. De hecho, si definimos una <code>factory</code>, lo que
se hace es crear un <code>Provider</code> vacío cuyo método <code>$get</code> apunta directamente a nuestra función.</p>
</div>
<div class="paragraph">
<p>Deberíamos usar un <code>Provider</code> cuando queremos introducir cierta configuración que esté
disponible a para toda la aplicación. Para asegurar esto, esto debe hacerse antes
de que se ejecute la aplicación, en una fase llamada <em>fase de configuración</em>. De
esta manera, podemos crear servicios reutilizables cuyo comportamiento podría cambiar
ligeramente entre aplicaciones.</p>
</div>
<div class="paragraph">
<p>Por ejemplo, nuestro lanzador de unicornios es tan potente y útil que lo van a usar
muchas de las aplicaciones del parque de aplicaciones de nuestra empresa. Por defecto,
el lanzador de unicornios los proyecta al espacio sin ningún tipo de protección ni escudo.
Pero en algunos planetas, la atmósfera es tan pesada que debemos proteger a nuestros
unicornios con papel de plata para evitar que se incineren al atravesar la atmósfera
y así evitar su extinción. Estaría muy bien que pudiéramos configurar esto nuestro
lanzador, y usarlo en la app que haga falta. Lo haríamos configurable de la siguiente
manera:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="javascript"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14</div></td><td class="code"><span class="tok-nx">myApp</span><span class="tok-p">.</span><span class="tok-nx">provider</span><span class="tok-p">(</span><span class="tok-s1">&#39;unicornLauncher&#39;</span><span class="tok-p">,</span> <span class="tok-kd">function</span> <span class="tok-nx">UnicornLauncherProvider</span><span class="tok-p">()</span> <span class="tok-p">{</span>
  <span class="tok-kd">var</span> <span class="tok-nx">useTinfoilShielding</span> <span class="tok-o">=</span> <span class="tok-kc">false</span><span class="tok-p">;</span>

  <span class="tok-k">this</span><span class="tok-p">.</span><span class="tok-nx">useTinfoilShielding</span> <span class="tok-o">=</span> <span class="tok-kd">function</span><span class="tok-p">(</span><span class="tok-nx">value</span><span class="tok-p">)</span> <span class="tok-p">{</span>
    <span class="tok-nx">useTinfoilShielding</span> <span class="tok-o">=</span> <span class="tok-o">!!</span><span class="tok-nx">value</span><span class="tok-p">;</span>
  <span class="tok-p">};</span>

  <span class="tok-k">this</span><span class="tok-p">.</span><span class="tok-nx">$get</span> <span class="tok-o">=</span> <span class="tok-p">[</span><span class="tok-s2">&quot;apiToken&quot;</span><span class="tok-p">,</span> <span class="tok-kd">function</span> <span class="tok-nx">unicornLauncherFactory</span><span class="tok-p">(</span><span class="tok-nx">apiToken</span><span class="tok-p">)</span> <span class="tok-p">{</span>

    <span class="tok-c1">// let&#39;s assume that the UnicornLauncher constructor was also changed to</span>
    <span class="tok-c1">// accept and use the useTinfoilShielding argument</span>
    <span class="tok-k">return</span> <span class="tok-k">new</span> <span class="tok-nx">UnicornLauncher</span><span class="tok-p">(</span><span class="tok-nx">apiToken</span><span class="tok-p">,</span> <span class="tok-nx">useTinfoilShielding</span><span class="tok-p">);</span>
  <span class="tok-p">}];</span>
<span class="tok-p">});</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>Para activar el traje espacial de papel de plata, necesitamos crear una función
<code>config</code> en la API de nuestro módulo, e inyectar en ella el <code>unicornLauncherProvider</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="javascript"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3</div></td><td class="code"><span class="tok-nx">myApp</span><span class="tok-p">.</span><span class="tok-nx">config</span><span class="tok-p">([</span><span class="tok-s2">&quot;unicornLauncherProvider&quot;</span><span class="tok-p">,</span> <span class="tok-kd">function</span><span class="tok-p">(</span><span class="tok-nx">unicornLauncherProvider</span><span class="tok-p">)</span> <span class="tok-p">{</span>
  <span class="tok-nx">unicornLauncherProvider</span><span class="tok-p">.</span><span class="tok-nx">useTinfoilShielding</span><span class="tok-p">(</span><span class="tok-kc">true</span><span class="tok-p">);</span>
<span class="tok-p">}]);</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>Observemos que el <code>Provider</code> ha sido inyectado en la función de configuración. Esta
inyección la hace in <em>provider injector</em>, que es distinto del inyector de instancias
habitual que usaremos en el resto de nuestra aplicación. Este inyector únicamente
trabaja con <em>providers</em>, ya que el resto de objetos no se crean en la fase de configuración.</p>
</div>
<div class="paragraph">
<p>Durante la inicialización de la aplicación, antes de que AngularJS haya creado ningún
servicio, configura e instancia los <em>providers</em>. A esto lo llamamos la <strong>fase de configuración</strong>
del ciclo de vida de la aplicación. Durante esta fase, como hemos dicho, los servicios
no son accesibles porque aún no se han creado.</p>
</div>
<div class="paragraph">
<p>Una vez se ha finalizado la fase de configuración, ya no se puede interactuar con un
<code>Provider</code> y empieza el proceso de crear servicios. A esta parte del ciclo de vida
de la aplicación se le conoce como <strong>fase de ejecución</strong>.</p>
</div>
</div>
<div class="sect3">
<h4 id="_constant">4.3.5. Constant</h4>
<div class="paragraph">
<p>Hemos visto cómo AngularJS divide el ciclo de vida de una aplicación en las fases
de configuración y ejecución, y cómo se puede dotar de configuración a la aplicación
a través de la función <code>config</code>. Dado que la función <code>config</code> se ejecuta en una fase
en la que no tenemos servicios disponibles, no se tiene acceso ni siquiera a objetos
sencillos creados con la utilidad <code>Value</code>.</p>
</div>
<div class="paragraph">
<p>Sin embargo, podemos tener valores tan simples como un prefijo de una url, que no necesiten
dependencias o configuración, y que sean útiles en las fases de configuración y ejecución.
Para esto sirve la utilidad <code>constant</code>.</p>
</div>
<div class="paragraph">
<p>Supongamos que nuestro servicio unicornLauncher puede estampar, en un unicorion,
el nombre del planeta contra el que está siendo lanzado en la fase de configuración.
El nombre del planeta es específico para cada aplicación, y también lo usan muchos
controladores en tiempo de ejecución. Podemos definir entonces el nombre del planeta
como una constante:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="javascript"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1</div></td><td class="code"><span class="tok-nx">myApp</span><span class="tok-p">.</span><span class="tok-nx">constant</span><span class="tok-p">(</span><span class="tok-s1">&#39;planetName&#39;</span><span class="tok-p">,</span> <span class="tok-s1">&#39;Greasy Giant&#39;</span><span class="tok-p">);</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>Ahora, podemos configurar nuestro <code>unicornLauncherProvider</code> de la siguiente manera:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="javascript"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3
4</div></td><td class="code"><span class="tok-nx">myApp</span><span class="tok-p">.</span><span class="tok-nx">config</span><span class="tok-p">([</span><span class="tok-s1">&#39;unicornLauncherProvider&#39;</span><span class="tok-p">,</span> <span class="tok-s1">&#39;planetName&#39;</span><span class="tok-p">,</span> <span class="tok-kd">function</span><span class="tok-p">(</span><span class="tok-nx">unicornLauncherProvider</span><span class="tok-p">,</span> <span class="tok-nx">planetName</span><span class="tok-p">)</span> <span class="tok-p">{</span>
  <span class="tok-nx">unicornLauncherProvider</span><span class="tok-p">.</span><span class="tok-nx">useTinfoilShielding</span><span class="tok-p">(</span><span class="tok-kc">true</span><span class="tok-p">);</span>
  <span class="tok-nx">unicornLauncherProvider</span><span class="tok-p">.</span><span class="tok-nx">stampText</span><span class="tok-p">(</span><span class="tok-nx">planetName</span><span class="tok-p">);</span>
<span class="tok-p">}]);</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>Y dado que una <code>constant</code> hace que el valor también esté disponible en la fase de
ejecución, podemos usarla también en nuestros controladores:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="javascript"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3
4</div></td><td class="code"><span class="tok-nx">myApp</span><span class="tok-p">.</span><span class="tok-nx">controller</span><span class="tok-p">(</span><span class="tok-s1">&#39;DemoController&#39;</span><span class="tok-p">,</span> <span class="tok-p">[</span><span class="tok-s2">&quot;clientId&quot;</span><span class="tok-p">,</span> <span class="tok-s2">&quot;planetName&quot;</span><span class="tok-p">,</span> <span class="tok-kd">function</span> <span class="tok-nx">DemoController</span><span class="tok-p">(</span><span class="tok-nx">clientId</span><span class="tok-p">,</span> <span class="tok-nx">planetName</span><span class="tok-p">)</span> <span class="tok-p">{</span>
  <span class="tok-k">this</span><span class="tok-p">.</span><span class="tok-nx">clientId</span> <span class="tok-o">=</span> <span class="tok-nx">clientId</span><span class="tok-p">;</span>
  <span class="tok-k">this</span><span class="tok-p">.</span><span class="tok-nx">planetName</span> <span class="tok-o">=</span> <span class="tok-nx">planetName</span><span class="tok-p">;</span>
<span class="tok-p">}]);</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="html"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3
4
5
6
7</div></td><td class="code"><span class="tok-nt">&lt;html</span> <span class="tok-na">ng-app=</span><span class="tok-s">&quot;myApp&quot;</span><span class="tok-nt">&gt;</span>
  <span class="tok-nt">&lt;body</span> <span class="tok-na">ng-controller=</span><span class="tok-s">&quot;DemoController as demo&quot;</span><span class="tok-nt">&gt;</span>
   Client ID: {{demo.clientId}}
   <span class="tok-nt">&lt;br&gt;</span>
   Planet Name: {{demo.planetName}}
  <span class="tok-nt">&lt;/body&gt;</span>
<span class="tok-nt">&lt;/html&gt;</span>
</td></tr></table></code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_objetos_de_propósito_especial">4.4. Objetos de propósito especial</h3>
<div class="paragraph">
<p>Anteriormente, hemos mencionado que tenemos objetos de propósito especial, cuya
funcionalidad es diferente de la que ofrece un servicio. Estos objetos extienden
el framework como <em>plugins</em>, implementando interfaces definidas por AngularJs. Estas
interfaces son: <code>controller</code>, <code>directive</code>, <code>filter</code> y <code>animation</code>.</p>
</div>
<div class="paragraph">
<p>A excepción del objeto <code>controller</code>, el inyector usa la <em>receta</em> de una <code>factory</code>
para crear estos objetos.</p>
</div>
<div class="paragraph">
<p>Ya hemos visto algo de estos objetos en las sesiones anteriores, y profundizaremos
más en los siguietnes capítulos.</p>
</div>
</div>
<div class="sect2">
<h3 id="_en_resumen">4.5. En resumen</h3>
<div class="paragraph">
<p>Un inyector usa una serie de <em>recetas</em> para crear dos tipos de objetos: servicios y
objetos de propósito especial. Para crear servicios, usamos cinco tipos de <em>receta</em>
dinstintos: <code>Value</code>, <code>factory</code>, <code>Service</code>, <code>Provider</code> y <code>constant</code>.</p>
</div>
<div class="paragraph">
<p>De ellos, los más comunes són <code>factory</code> y <code>Service</code>, y sólo se distinguen en que los
<code>Service</code> funcionan mejor con tipos de objetos ya definidos, y una <code>factory</code> devuelve
funciones y primitivas JavaScript. Un <code>Provider</code> es la receta "padre" de todos ellos,
que no son más que <em>azúcar sintáctico</em> de un <code>Provider</code>. Un <code>Provider</code> es la <em>receta</em>
más potente, pero no es necesaria a menos que necesitemos un componente reutilizable
que requiera de algún tipo de configuración a nivel de aplicación, y es por esto
que es el único elemento disponible en la fase de configuración de un aplicación.</p>
</div>
</div>
<div class="sect2">
<h3 id="_ejercicios_2">4.6. Ejercicios</h3>
<div class="paragraph">
<p>Aplica el <em>tag</em> <code>modules</code> a la versión que quieres que se corrija.</p>
</div>
<div class="sect3">
<h4 id="_convertir_a_módulo_0_66_puntos">4.6.1. Convertir a módulo (0,66 puntos)</h4>
<div class="paragraph">
<p>Vamos a coger el carrito de la compra del ejercicio anterior, y crear un módulo llamado <code>org.expertojava.carrito</code>, que no tenga ninguna dependencia.</p>
</div>
<div class="paragraph">
<p>El controlador deberá pasar ahora a formar parte del módulo.</p>
</div>
</div>
<div class="sect3">
<h4 id="_creación_de_una_factoría_0_67_puntos">4.6.2. Creación de una factoría (0,67 puntos)</h4>
<div class="paragraph">
<p>En nuestro módulo, debemos crear una factoría. La llamaremos <code>productsFactory</code> y expondrá un único método, llamado <code>getProducts()</code>, que devolverá el listado de productos que teníamos en el controlador. Inyectaremos la factoría en el controlador, y ahora el listado de productos será <code>$scope.products = productsFactory.getProducts()</code>.</p>
</div>
<div class="sect4">
<h5 id="_creación_de_un_servicio_0_67_puntos">Creación de un servicio (0,67 puntos)</h5>
<div class="paragraph">
<p>En nuestro módulo, también crearemos un servicio al que llamaremos <code>shoppingCartService</code>. Dicho servicio tendrá tres métodos: <code>addToCart(product)</code>, <code>getCart()</code> y <code>getTotal()</code>. Inyectaremos el servicio en nuestro controlador, donde refactorizaremos nuestra lógica: <code>$scope.addToCart = shoppingCartService.addToCart</code>, <code>$scope.total = shoppingCartService.getTotal()</code> y <code>$scope.cart = shoppingCartService.getCart()</code>.
&lt;&lt;&lt;</p>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="sesion05">5. Filtros</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Un filtro se encarga de formater el valor de una expresión, para ofrecérsela al usuario sin modificar el valor original.
Puede usarse en vistas, controladores o servicios y son muy sencillos de declarar y programar.</p>
</div>
<div class="paragraph">
<p>La API subyacente es el <code>filterProvider</code>.</p>
</div>
<div class="sect2">
<h3 id="_cómo_usar_un_filtro">5.1. Cómo usar un filtro</h3>
<div class="paragraph">
<p>Un mismo filtro se puede utilizar de dos maneras diferentes, en función de si lo hacemos desde una vista o desde código JavaScript.</p>
</div>
<div class="sect3">
<h4 id="_en_una_vista">5.1.1. En una vista</h4>
<div class="paragraph">
<p>Para usar un filtro en una vista, podemos aplicar una expresión con la siguiente sintaxis:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="html"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2</div></td><td class="code">{{ expression | filter }}
{{ 12 | currency }} <span class="tok-c">&lt;!-- 12€ --&gt;</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>Los filtros, además, pueden encadenarse. En el siguiente ejemplo, la salida del primer filtro se pasa como entrada del segundo.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="html"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2</div></td><td class="code">{{ expression | filter1 | filter2 }}
{{ 12 | number:2 | currency }} <span class="tok-c">&lt;!-- 12.00€ --&gt;</span>
</td></tr></table></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_en_controladores_servicios_y_directivas">5.1.2. En controladores, servicios y directivas</h4>
<div class="paragraph">
<p>Para usar un filtro en un controlador/servicio/directiva, debemos inyectar una dependencia con <code>&lt;nombreDelFiltro&gt;Filter</code>. Por ejemplo,
para usar el filtro <code>number</code> que hemos visto en el ejemplo anterior (que formatea un número con los decimales indicados en el segundo
parámetro), inyectaríamos <code>numberFilter</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="javascript"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3
4</div></td><td class="code"><span class="tok-nx">angular</span><span class="tok-p">.</span><span class="tok-nx">module</span><span class="tok-p">(</span><span class="tok-s1">&#39;FilterInControllerModule&#39;</span><span class="tok-p">,</span> <span class="tok-p">[]).</span>
  <span class="tok-nx">controller</span><span class="tok-p">(</span><span class="tok-s1">&#39;FilterController&#39;</span><span class="tok-p">,</span> <span class="tok-p">[</span><span class="tok-s1">&#39;$scope&#39;</span><span class="tok-p">,</span> <span class="tok-s1">&#39;numberFilter&#39;</span><span class="tok-p">,</span> <span class="tok-kd">function</span><span class="tok-p">(</span><span class="tok-nx">$scope</span><span class="tok-p">,</span> <span class="tok-nx">numberFilter</span><span class="tok-p">)</span> <span class="tok-p">{</span>
    <span class="tok-nx">$scope</span><span class="tok-p">.</span><span class="tok-nx">filteredText</span> <span class="tok-o">=</span> <span class="tok-nx">numberFilter</span><span class="tok-p">(</span><span class="tok-mi">12</span><span class="tok-p">,</span><span class="tok-mi">2</span><span class="tok-p">);</span>
  <span class="tok-p">}]);</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>Otra manera consiste en inyectar el servicio <code>$filter</code> en nuestro código javascript. Con él, podemos llamar a todos los filtros de la siguiente manera:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="javascript"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3
4</div></td><td class="code"><span class="tok-nx">angular</span><span class="tok-p">.</span><span class="tok-nx">module</span><span class="tok-p">(</span><span class="tok-s1">&#39;FilterInControllerModuleV2&#39;</span><span class="tok-p">,</span> <span class="tok-p">[]).</span>
  <span class="tok-nx">controller</span><span class="tok-p">(</span><span class="tok-s1">&#39;FilterController&#39;</span><span class="tok-p">,</span> <span class="tok-p">[</span><span class="tok-s1">&#39;$scope&#39;</span><span class="tok-p">,</span> <span class="tok-s1">&#39;$filter&#39;</span><span class="tok-p">,</span> <span class="tok-kd">function</span><span class="tok-p">(</span><span class="tok-nx">$scope</span><span class="tok-p">,</span> <span class="tok-nx">$filter</span><span class="tok-p">)</span> <span class="tok-p">{</span>
    <span class="tok-nx">$scope</span><span class="tok-p">.</span><span class="tok-nx">filteredText</span> <span class="tok-o">=</span> <span class="tok-nx">$filter</span><span class="tok-p">(</span><span class="tok-s1">&#39;number&#39;</span><span class="tok-p">)(</span><span class="tok-mi">12</span><span class="tok-p">,</span><span class="tok-mi">2</span><span class="tok-p">);</span>
  <span class="tok-p">}]);</span>
</td></tr></table></code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_filtros_predefinidos_en_angularjs">5.2. Filtros predefinidos en AngularJS</h3>
<div class="sect3">
<h4 id="_filter">5.2.1. filter</h4>
<div class="paragraph">
<p>El filtro <a href="https://docs.angularjs.org/api/ng/filter/filter"><code>filter</code></a> selecciona un subset de ítems dentro de un array, devolviéndolo en un nuevo array</p>
</div>
<div class="paragraph">
<p>En una plantilla HTML lo usaremos de la forma:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="html"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1</div></td><td class="code">{{ filter_expression | filter : expression : comparator}}
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>En nuestro código javascript lo usaremos de la siguiente forma:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="javascript"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1</div></td><td class="code"><span class="tok-nx">$filter</span><span class="tok-p">(</span><span class="tok-s1">&#39;filter&#39;</span><span class="tok-p">)(</span><span class="tok-nx">array</span><span class="tok-p">,</span> <span class="tok-nx">expression</span><span class="tok-p">,</span> <span class="tok-nx">comparator</span><span class="tok-p">)</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>El parámetro <code>array</code> se corresponde con el array a filtrar. Por su parte, <code>expression</code> puede ser una cadena (búsqueda en todos los objetos), o bien un objeto (que servirá de "ejemplo" para hacer las búsquedas en el array). El último parámetro es opcional nos permite implementar una función de comparación customizada.</p>
</div>
<div class="paragraph">
<p>Ejemplo:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="html"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31</div></td><td class="code"><span class="tok-nt">&lt;div</span> <span class="tok-na">ng-app</span><span class="tok-nt">&gt;</span>
  <span class="tok-nt">&lt;div</span> <span class="tok-na">ng-init=</span><span class="tok-s">&quot;friends = [</span>
<span class="tok-s">    {name:&#39;John&#39;, phone:&#39;555-1276&#39;},</span>
<span class="tok-s">    {name:&#39;Mary&#39;, phone:&#39;800-BIG-MARY&#39;},</span>
<span class="tok-s">    {name:&#39;Mike&#39;, phone:&#39;555-4321&#39;},</span>
<span class="tok-s">    {name:&#39;Adam&#39;, phone:&#39;555-5678&#39;},</span>
<span class="tok-s">    {name:&#39;Julie&#39;, phone:&#39;555-8765&#39;},</span>
<span class="tok-s">    {name:&#39;Juliette&#39;, phone:&#39;555-5678&#39;}</span>
<span class="tok-s">  ]&quot;</span><span class="tok-nt">&gt;&lt;/div&gt;</span>

  Search: <span class="tok-nt">&lt;input</span> <span class="tok-na">ng-model=</span><span class="tok-s">&quot;searchText&quot;</span><span class="tok-nt">&gt;</span>
  <span class="tok-nt">&lt;table</span> <span class="tok-na">id=</span><span class="tok-s">&quot;searchTextResults&quot;</span><span class="tok-nt">&gt;</span>
    <span class="tok-nt">&lt;tr&gt;&lt;th&gt;</span>Name<span class="tok-nt">&lt;/th&gt;&lt;th&gt;</span>Phone<span class="tok-nt">&lt;/th&gt;&lt;/tr&gt;</span>
    <span class="tok-nt">&lt;tr</span> <span class="tok-na">ng-repeat=</span><span class="tok-s">&quot;friend in friends | filter:searchText&quot;</span><span class="tok-nt">&gt;</span>
      <span class="tok-nt">&lt;td&gt;</span>{{friend.name}}<span class="tok-nt">&lt;/td&gt;</span>
      <span class="tok-nt">&lt;td&gt;</span>{{friend.phone}}<span class="tok-nt">&lt;/td&gt;</span>
    <span class="tok-nt">&lt;/tr&gt;</span>
  <span class="tok-nt">&lt;/table&gt;</span>
  <span class="tok-nt">&lt;hr&gt;</span>
  Any: <span class="tok-nt">&lt;input</span> <span class="tok-na">ng-model=</span><span class="tok-s">&quot;search.$&quot;</span><span class="tok-nt">&gt;</span> <span class="tok-nt">&lt;br&gt;</span>
  Name only <span class="tok-nt">&lt;input</span> <span class="tok-na">ng-model=</span><span class="tok-s">&quot;search.name&quot;</span><span class="tok-nt">&gt;&lt;br&gt;</span>
  Phone only <span class="tok-nt">&lt;input</span> <span class="tok-na">ng-model=</span><span class="tok-s">&quot;search.phone&quot;</span><span class="tok-nt">&gt;&lt;br&gt;</span>
  Equality <span class="tok-nt">&lt;input</span> <span class="tok-na">type=</span><span class="tok-s">&quot;checkbox&quot;</span> <span class="tok-na">ng-model=</span><span class="tok-s">&quot;strict&quot;</span><span class="tok-nt">&gt;&lt;br&gt;</span>
  <span class="tok-nt">&lt;table</span> <span class="tok-na">id=</span><span class="tok-s">&quot;searchObjResults&quot;</span><span class="tok-nt">&gt;</span>
    <span class="tok-nt">&lt;tr&gt;&lt;th&gt;</span>Name<span class="tok-nt">&lt;/th&gt;&lt;th&gt;</span>Phone<span class="tok-nt">&lt;/th&gt;&lt;/tr&gt;</span>
    <span class="tok-nt">&lt;tr</span> <span class="tok-na">ng-repeat=</span><span class="tok-s">&quot;friendObj in friends | filter:search:strict&quot;</span><span class="tok-nt">&gt;</span>
      <span class="tok-nt">&lt;td&gt;</span>{{friendObj.name}}<span class="tok-nt">&lt;/td&gt;</span>
      <span class="tok-nt">&lt;td&gt;</span>{{friendObj.phone}}<span class="tok-nt">&lt;/td&gt;</span>
    <span class="tok-nt">&lt;/tr&gt;</span>
  <span class="tok-nt">&lt;/table&gt;</span>
<span class="tok-nt">&lt;/div&gt;</span>
</td></tr></table></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_currency">5.2.2. currency</h4>
<div class="paragraph">
<p>El filtro <a href="https://docs.angularjs.org/api/ng/filter/currency"><code>currency</code></a> nos permite expresar un número en formato moneda. En una plantilla HTML lo usaremos de la forma:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="html"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1</div></td><td class="code">{{ currency_expression | currency : symbol : fractionSize}}
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>En nuestro código javascript lo usaremos de la siguiente forma:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="javascript"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1</div></td><td class="code"><span class="tok-nx">$filter</span><span class="tok-p">(</span><span class="tok-s1">&#39;currency&#39;</span><span class="tok-p">)(</span><span class="tok-nx">amount</span><span class="tok-p">,</span> <span class="tok-nx">symbol</span><span class="tok-p">,</span> <span class="tok-nx">fractionSize</span><span class="tok-p">)</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>Tanto <code>currency</code> como <code>fractionSize</code> son opcionales. Si no ponemos nada, se expresará en dólares con el formato de separación de miles y decimales estadounidense. Para expresarlo a una región en concreto, lo mejor es instalar el módulo  <a href="https://github.com/angular/angular.js/tree/master/src/ngLocale"><code>ngLocale</code></a> que corresponda, en nuestro caso sería <code>angular-locale_es-es.js</code>. Según la versión de AngularJS que estemos utilizando, tendremos que añadirlo a nuestro módulo principal.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="javascript"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1</div></td><td class="code"><span class="tok-nx">angular</span><span class="tok-p">.</span><span class="tok-nx">module</span><span class="tok-p">(</span><span class="tok-s1">&#39;myModule&#39;</span><span class="tok-p">,</span> <span class="tok-p">[</span><span class="tok-s1">&#39;ngLocale&#39;</span><span class="tok-p">])</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>Ejemplo:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="html"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3
4</div></td><td class="code"><span class="tok-nt">&lt;script </span><span class="tok-na">src=</span><span class="tok-s">&quot;http://path/to/angular-locale_es-es.js&quot;</span><span class="tok-nt">&gt;&lt;/script&gt;</span>
<span class="tok-nt">&lt;div</span> <span class="tok-na">ng-app</span><span class="tok-nt">&gt;</span>
  {{ 1234567890.25 | currency }}
<span class="tok-nt">&lt;/div&gt;</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="http://codepen.io/alexsuch/pen/EaXWyK?editors=101">Ejemplo de moneda con locale por defecto de AngularJs</a></p>
</li>
<li>
<p><a href="http://codepen.io/alexsuch/pen/gbWgZe?editors=101">Ejemplo de moneda con locale español</a></p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_date">5.2.3. date</h4>
<div class="paragraph">
<p>El filtro <a href="https://docs.angularjs.org/api/ng/filter/date"><code>date</code></a> nos permite formatear una fecha de la manera deseada. En una plantilla HTML lo usaremos de la forma:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="html"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1</div></td><td class="code">{{ date_expression | date : format : timezone}}
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>En nuestro código javascript lo usaremos de la siguiente forma:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="javascript"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1</div></td><td class="code"><span class="tok-nx">$filter</span><span class="tok-p">(</span><span class="tok-s1">&#39;date&#39;</span><span class="tok-p">)(</span><span class="tok-nx">date</span><span class="tok-p">,</span> <span class="tok-nx">format</span><span class="tok-p">,</span> <span class="tok-nx">timezone</span><span class="tok-p">)</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>El parámetro <code>date</code> puede ser de varios tipos, aunque lo más habitual es que sea un objeto <code>Date</code> o una fecha en milisegundos. Tanto <code>format</code> como <code>timezone</code> son opcionales. En la referencia de este filtro en la web de AngularJS podemos ver todas las formas que acepta.</p>
</div>
<div class="paragraph">
<p>El filtro <code>date</code> también se ve afectado por el módulo <code>ngLocale</code>. Ejemplo:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="html"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11</div></td><td class="code"><span class="tok-nt">&lt;script </span><span class="tok-na">src=</span><span class="tok-s">&quot;http://path/to/angular-locale_es-es.js&quot;</span><span class="tok-nt">&gt;&lt;/script&gt;</span>
<span class="tok-nt">&lt;div</span> <span class="tok-na">ng-app</span><span class="tok-nt">&gt;</span>
  <span class="tok-nt">&lt;span</span> <span class="tok-na">ng-non-bindable</span><span class="tok-nt">&gt;</span>{{1288323623006 | date:&#39;medium&#39;}}<span class="tok-nt">&lt;/span&gt;</span>:
  <span class="tok-nt">&lt;span&gt;</span>{{1288323623006 | date:&#39;medium&#39;}}<span class="tok-nt">&lt;/span&gt;&lt;br&gt;</span>
  <span class="tok-nt">&lt;span</span> <span class="tok-na">ng-non-bindable</span><span class="tok-nt">&gt;</span>{{1288323623006 | date:&#39;yyyy-MM-dd HH:mm:ss Z&#39;}}<span class="tok-nt">&lt;/span&gt;</span>:
  <span class="tok-nt">&lt;span&gt;</span>{{1288323623006 | date:&#39;yyyy-MM-dd HH:mm:ss Z&#39;}}<span class="tok-nt">&lt;/span&gt;&lt;br&gt;</span>
  <span class="tok-nt">&lt;span</span> <span class="tok-na">ng-non-bindable</span><span class="tok-nt">&gt;</span>{{1288323623006 | date:&#39;MM/dd/yyyy @ h:mma&#39;}}<span class="tok-nt">&lt;/span&gt;</span>:
  <span class="tok-nt">&lt;span&gt;</span>{{&#39;1288323623006&#39; | date:&#39;MM/dd/yyyy @ h:mma&#39;}}<span class="tok-nt">&lt;/span&gt;&lt;br&gt;</span>
  <span class="tok-nt">&lt;span</span> <span class="tok-na">ng-non-bindable</span><span class="tok-nt">&gt;</span>{{1288323623006 | date:&quot;MM/dd/yyyy &#39;at&#39; h:mma&quot;}}<span class="tok-nt">&lt;/span&gt;</span>:
  <span class="tok-nt">&lt;span&gt;</span>{{&#39;1288323623006&#39; | date:&quot;MM/dd/yyyy &#39;at&#39; h:mma&quot;}}<span class="tok-nt">&lt;/span&gt;&lt;br&gt;</span>
<span class="tok-nt">&lt;/div&gt;</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="http://codepen.io/alexsuch/pen/LELWRW?editors=101">Ejemplo de <code>date</code> con locale español</a></p>
</li>
<li>
<p><a href="http://codepen.io/alexsuch/pen/wBeJzY?editors=101">Ejemplo de <code>date</code> con locale por defecto</a></p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_json">5.2.4. json</h4>
<div class="paragraph">
<p>El filtro <a href="https://docs.angularjs.org/api/ng/filter/json"><code>json</code></a> recibe un objeto como entrada, y devuelve una cadena representando dicho objeto en formato JSON. En nuestro código HTML se usa de la siguiente forma:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="html"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1</div></td><td class="code">{{ json_expression | json : spacing}}
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>En nuestro código javascript lo usaremos de la siguiente forma:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="javascript"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1</div></td><td class="code"><span class="tok-nx">$filter</span><span class="tok-p">(</span><span class="tok-s1">&#39;json&#39;</span><span class="tok-p">)(</span><span class="tok-nx">object</span><span class="tok-p">,</span> <span class="tok-nx">spacing</span><span class="tok-p">)</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>El parámetro <code>spacing</code> es opcional, e indica el número de espacios que se utilizará en la indetación (el valor por defecto es 2). En el <a href="http://codepen.io/alexsuch/pen/pvweNM">este enlace</a> podemos ver el siguiente ejemplo funcionando:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="html"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3
4
5
6</div></td><td class="code"><span class="tok-nt">&lt;div</span> <span class="tok-na">ng-app</span><span class="tok-nt">&gt;</span>
  <span class="tok-nt">&lt;h3&gt;</span>Default spacing<span class="tok-nt">&lt;/h3&gt;</span>
  <span class="tok-nt">&lt;pre</span> <span class="tok-na">id=</span><span class="tok-s">&quot;default-spacing&quot;</span><span class="tok-nt">&gt;</span>{{ {nombre:&#39;Alejandro&#39;, asignatura:&#39;Frameworks JavaScript: AngularJS&#39;} | json }}<span class="tok-nt">&lt;/pre&gt;</span>
  <span class="tok-nt">&lt;h3&gt;</span>Custom spacing<span class="tok-nt">&lt;/h3&gt;</span>
<span class="tok-nt">&lt;pre</span> <span class="tok-na">id=</span><span class="tok-s">&quot;custom-spacing&quot;</span><span class="tok-nt">&gt;</span>{{ {nombre:&#39;Domingo&#39;, asignatura: &#39;Frameworks de persistencia: JPA&#39;} | json:4 }}<span class="tok-nt">&lt;/pre&gt;</span>
<span class="tok-nt">&lt;/div&gt;</span>
</td></tr></table></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_limitto">5.2.5. limitTo</h4>
<div class="paragraph">
<p>El filtro <a href="https://docs.angularjs.org/api/ng/filter/limitTo"><code>limitTo</code></a> recibe como entrada un array, del que tomará un número de elementos igual al parámetro recibido (<code>limit</code>). Estos elementos se tomaran del principio si el número es positivo, y del final si es negativo. En nuestro código HTML se usa de la siguiente forma:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="html"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1</div></td><td class="code">{{ limitTo_expression | limitTo : limit}}
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>En nuestro código javascript lo usaremos de la siguiente forma:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="javascript"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1</div></td><td class="code"><span class="tok-nx">$filter</span><span class="tok-p">(</span><span class="tok-s1">&#39;limitTo&#39;</span><span class="tok-p">)(</span><span class="tok-nx">input</span><span class="tok-p">,</span> <span class="tok-nx">limit</span><span class="tok-p">)</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p><a href="http://codepen.io/alexsuch/pen/Pwjpmd">Ejemplo</a>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="html"><span class="tok-nt">&lt;script&gt;</span>
  <span class="tok-nx">angular</span><span class="tok-p">.</span><span class="tok-nx">module</span><span class="tok-p">(</span><span class="tok-s1">&#39;limitToExample&#39;</span><span class="tok-p">,</span> <span class="tok-p">[])</span>
    <span class="tok-p">.</span><span class="tok-nx">controller</span><span class="tok-p">(</span><span class="tok-s1">&#39;ExampleController&#39;</span><span class="tok-p">,</span> <span class="tok-p">[</span><span class="tok-s1">&#39;$scope&#39;</span><span class="tok-p">,</span> <span class="tok-kd">function</span><span class="tok-p">(</span><span class="tok-nx">$scope</span><span class="tok-p">)</span> <span class="tok-p">{</span>
      <span class="tok-nx">$scope</span><span class="tok-p">.</span><span class="tok-nx">numbers</span> <span class="tok-o">=</span> <span class="tok-p">[</span><span class="tok-mi">1</span><span class="tok-p">,</span><span class="tok-mi">2</span><span class="tok-p">,</span><span class="tok-mi">3</span><span class="tok-p">,</span><span class="tok-mi">4</span><span class="tok-p">,</span><span class="tok-mi">5</span><span class="tok-p">,</span><span class="tok-mi">6</span><span class="tok-p">,</span><span class="tok-mi">7</span><span class="tok-p">,</span><span class="tok-mi">8</span><span class="tok-p">,</span><span class="tok-mi">9</span><span class="tok-p">];</span>
      <span class="tok-nx">$scope</span><span class="tok-p">.</span><span class="tok-nx">letters</span> <span class="tok-o">=</span> <span class="tok-s2">&quot;abcdefghi&quot;</span><span class="tok-p">;</span>
      <span class="tok-nx">$scope</span><span class="tok-p">.</span><span class="tok-nx">longNumber</span> <span class="tok-o">=</span> <span class="tok-mi">2345432342</span><span class="tok-p">;</span>
      <span class="tok-nx">$scope</span><span class="tok-p">.</span><span class="tok-nx">numLimit</span> <span class="tok-o">=</span> <span class="tok-mi">3</span><span class="tok-p">;</span>
      <span class="tok-nx">$scope</span><span class="tok-p">.</span><span class="tok-nx">letterLimit</span> <span class="tok-o">=</span> <span class="tok-mi">3</span><span class="tok-p">;</span>
      <span class="tok-nx">$scope</span><span class="tok-p">.</span><span class="tok-nx">longNumberLimit</span> <span class="tok-o">=</span> <span class="tok-mi">3</span><span class="tok-p">;</span>
    <span class="tok-p">}]);</span>
<span class="tok-nt">&lt;/script&gt;</span>
<span class="tok-nt">&lt;div</span> <span class="tok-na">ng-app=</span><span class="tok-s">&quot;limitToExample&quot;</span><span class="tok-nt">&gt;</span>
  <span class="tok-nt">&lt;div</span> <span class="tok-na">ng-controller=</span><span class="tok-s">&quot;ExampleController&quot;</span><span class="tok-nt">&gt;</span>
    Limit {{numbers}} to: <span class="tok-nt">&lt;input</span> <span class="tok-na">type=</span><span class="tok-s">&quot;number&quot;</span> <span class="tok-na">step=</span><span class="tok-s">&quot;1&quot;</span> <span class="tok-na">ng-model=</span><span class="tok-s">&quot;numLimit&quot;</span><span class="tok-nt">&gt;</span>
    <span class="tok-nt">&lt;p&gt;</span>Output numbers: {{ numbers | limitTo:numLimit }}<span class="tok-nt">&lt;/p&gt;</span>
    Limit {{letters}} to: <span class="tok-nt">&lt;input</span> <span class="tok-na">type=</span><span class="tok-s">&quot;number&quot;</span> <span class="tok-na">step=</span><span class="tok-s">&quot;1&quot;</span> <span class="tok-na">ng-model=</span><span class="tok-s">&quot;letterLimit&quot;</span><span class="tok-nt">&gt;</span>
    <span class="tok-nt">&lt;p&gt;</span>Output letters: {{ letters | limitTo:letterLimit }}<span class="tok-nt">&lt;/p&gt;</span>
    Limit {{longNumber}} to: <span class="tok-nt">&lt;input</span> <span class="tok-na">type=</span><span class="tok-s">&quot;number&quot;</span> <span class="tok-na">step=</span><span class="tok-s">&quot;1&quot;</span> <span class="tok-na">ng-model=</span><span class="tok-s">&quot;longNumberLimit&quot;</span><span class="tok-nt">&gt;</span>
    <span class="tok-nt">&lt;p&gt;</span>Output long number: {{ longNumber | limitTo:longNumberLimit }}<span class="tok-nt">&lt;/p&gt;</span>
  <span class="tok-nt">&lt;/div&gt;</span>
<span class="tok-nt">&lt;/div&gt;</span></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_lowercase">5.2.6. lowercase</h4>
<div class="paragraph">
<p>El filtro <a href="https://docs.angularjs.org/api/ng/filter/lowercase"><code>lowercase</code></a> convierte una cadena a minúsculas. En nuestro código HTML se usa de la siguiente forma:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="html"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1</div></td><td class="code">{{ lowercase_expression | lowercase}}
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>En nuestro código javascript lo usaremos de la siguiente forma:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="javascript"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1</div></td><td class="code"><span class="tok-nx">$filter</span><span class="tok-p">(</span><span class="tok-s1">&#39;lowercase&#39;</span><span class="tok-p">)(</span><span class="tok-nx">lowercase_expression</span><span class="tok-p">)</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>Ejemplo:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="html"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1</div></td><td class="code">{{ &#39;HOLA MUNDO&#39; | lowercase }}
</td></tr></table></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_uppercase">5.2.7. uppercase</h4>
<div class="paragraph">
<p>El filtro <a href="https://docs.angularjs.org/api/ng/filter/uppercase"><code>uppercase</code></a> convierte una cadena a mayúsculas. En nuestro código HTML se usa de la siguiente forma:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="html"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1</div></td><td class="code">{{ uppercase_expression | uppercase}}
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>En nuestro código javascript lo usaremos de la siguiente forma:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="javascript"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1</div></td><td class="code"><span class="tok-nx">$filter</span><span class="tok-p">(</span><span class="tok-s1">&#39;uppercase&#39;</span><span class="tok-p">)(</span><span class="tok-nx">uppercase_expression</span><span class="tok-p">)</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>Ejemplo:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="html"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1</div></td><td class="code">{{ &#39;hola mundo&#39; | uppercase }}
</td></tr></table></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_number">5.2.8. number</h4>
<div class="paragraph">
<p>El filtro <a href="https://docs.angularjs.org/api/ng/filter/number"><code>number</code></a> formatea un número en el locale que hayamos importado, y con el número de decimales indicado en su segundo parámetro, que es opcional.</p>
</div>
<div class="literalblock">
<div class="content">
<pre>En nuestro código HTML se usa de la siguiente forma:</pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="html"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1</div></td><td class="code">{{ number_expression | number : fractionSize}}
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>En nuestro código javascript lo usaremos de la siguiente forma:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="javascript"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1</div></td><td class="code"><span class="tok-nx">$filter</span><span class="tok-p">(</span><span class="tok-s1">&#39;number&#39;</span><span class="tok-p">)(</span><span class="tok-nx">number</span><span class="tok-p">,</span> <span class="tok-nx">fractionSize</span><span class="tok-p">)</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p><a href="http://codepen.io/alexsuch/pen/XJgMad">Ejemplo</a>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="html"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14</div></td><td class="code"><span class="tok-nt">&lt;script&gt;</span>
<span class="tok-nx">angular</span><span class="tok-p">.</span><span class="tok-nx">module</span><span class="tok-p">(</span><span class="tok-s1">&#39;numberFilterExample&#39;</span><span class="tok-p">,</span> <span class="tok-p">[])</span>
    <span class="tok-p">.</span><span class="tok-nx">controller</span><span class="tok-p">(</span><span class="tok-s1">&#39;ExampleController&#39;</span><span class="tok-p">,</span> <span class="tok-p">[</span><span class="tok-s1">&#39;$scope&#39;</span><span class="tok-p">,</span> <span class="tok-kd">function</span><span class="tok-p">(</span><span class="tok-nx">$scope</span><span class="tok-p">)</span> <span class="tok-p">{</span>
      <span class="tok-nx">$scope</span><span class="tok-p">.</span><span class="tok-nx">val</span> <span class="tok-o">=</span> <span class="tok-mf">1234.56789</span><span class="tok-p">;</span>
    <span class="tok-p">}]);</span>
<span class="tok-nt">&lt;/script&gt;</span>
<span class="tok-nt">&lt;div</span> <span class="tok-na">ng-app=</span><span class="tok-s">&quot;numberFilterExample&quot;</span><span class="tok-nt">&gt;</span>
<span class="tok-nt">&lt;div</span> <span class="tok-na">ng-controller=</span><span class="tok-s">&quot;ExampleController&quot;</span><span class="tok-nt">&gt;</span>
  Enter number: <span class="tok-nt">&lt;input</span> <span class="tok-na">ng-model=</span><span class="tok-s">&#39;val&#39;</span><span class="tok-nt">&gt;&lt;br&gt;</span>
  Default formatting: <span class="tok-nt">&lt;span</span> <span class="tok-na">id=</span><span class="tok-s">&#39;number-default&#39;</span><span class="tok-nt">&gt;</span>{{val | number}}<span class="tok-nt">&lt;/span&gt;&lt;br&gt;</span>
  No fractions: <span class="tok-nt">&lt;span&gt;</span>{{val | number:0}}<span class="tok-nt">&lt;/span&gt;&lt;br&gt;</span>
  Negative number: <span class="tok-nt">&lt;span&gt;</span>{{-val | number:4}}<span class="tok-nt">&lt;/span&gt;</span>
<span class="tok-nt">&lt;/div&gt;</span>
<span class="tok-nt">&lt;div&gt;</span>
</td></tr></table></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_orderby">5.2.9. orderBy</h4>
<div class="paragraph">
<p>El filtro <a href="https://docs.angularjs.org/api/ng/filter/orderBy"><code>orderBy</code></a> nos permite ordenar un array por una propiedad, en sentido normal o inverso. En nuestro código HTML se usa de la siguiente forma:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="html"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1</div></td><td class="code">{{ orderBy_expression | orderBy : expression : reverse}}
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>En nuestro código javascript lo usaremos de la siguiente forma:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="javascript"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1</div></td><td class="code"><span class="tok-nx">$filter</span><span class="tok-p">(</span><span class="tok-s1">&#39;orderBy&#39;</span><span class="tok-p">)(</span><span class="tok-nx">array</span><span class="tok-p">,</span> <span class="tok-nx">expression</span><span class="tok-p">,</span> <span class="tok-nx">reverse</span><span class="tok-p">)</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>Veamos un <a href="http://codepen.io/alexsuch/pen/XJgMzK">ejemplo</a> de cómo funciona, y lo sencillo que es el uso de <code>expression</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="html"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32</div></td><td class="code"><span class="tok-nt">&lt;script&gt;</span>
  <span class="tok-nx">angular</span><span class="tok-p">.</span><span class="tok-nx">module</span><span class="tok-p">(</span><span class="tok-s1">&#39;orderByExample&#39;</span><span class="tok-p">,</span> <span class="tok-p">[])</span>
    <span class="tok-p">.</span><span class="tok-nx">controller</span><span class="tok-p">(</span><span class="tok-s1">&#39;ExampleController&#39;</span><span class="tok-p">,</span> <span class="tok-p">[</span><span class="tok-s1">&#39;$scope&#39;</span><span class="tok-p">,</span> <span class="tok-kd">function</span><span class="tok-p">(</span><span class="tok-nx">$scope</span><span class="tok-p">)</span> <span class="tok-p">{</span>
      <span class="tok-nx">$scope</span><span class="tok-p">.</span><span class="tok-nx">friends</span> <span class="tok-o">=</span>
          <span class="tok-p">[{</span><span class="tok-nx">name</span><span class="tok-o">:</span><span class="tok-s1">&#39;John&#39;</span><span class="tok-p">,</span> <span class="tok-nx">phone</span><span class="tok-o">:</span><span class="tok-s1">&#39;555-1212&#39;</span><span class="tok-p">,</span> <span class="tok-nx">age</span><span class="tok-o">:</span><span class="tok-mi">10</span><span class="tok-p">},</span>
           <span class="tok-p">{</span><span class="tok-nx">name</span><span class="tok-o">:</span><span class="tok-s1">&#39;Mary&#39;</span><span class="tok-p">,</span> <span class="tok-nx">phone</span><span class="tok-o">:</span><span class="tok-s1">&#39;555-9876&#39;</span><span class="tok-p">,</span> <span class="tok-nx">age</span><span class="tok-o">:</span><span class="tok-mi">19</span><span class="tok-p">},</span>
           <span class="tok-p">{</span><span class="tok-nx">name</span><span class="tok-o">:</span><span class="tok-s1">&#39;Mike&#39;</span><span class="tok-p">,</span> <span class="tok-nx">phone</span><span class="tok-o">:</span><span class="tok-s1">&#39;555-4321&#39;</span><span class="tok-p">,</span> <span class="tok-nx">age</span><span class="tok-o">:</span><span class="tok-mi">21</span><span class="tok-p">},</span>
           <span class="tok-p">{</span><span class="tok-nx">name</span><span class="tok-o">:</span><span class="tok-s1">&#39;Adam&#39;</span><span class="tok-p">,</span> <span class="tok-nx">phone</span><span class="tok-o">:</span><span class="tok-s1">&#39;555-5678&#39;</span><span class="tok-p">,</span> <span class="tok-nx">age</span><span class="tok-o">:</span><span class="tok-mi">35</span><span class="tok-p">},</span>
           <span class="tok-p">{</span><span class="tok-nx">name</span><span class="tok-o">:</span><span class="tok-s1">&#39;Julie&#39;</span><span class="tok-p">,</span> <span class="tok-nx">phone</span><span class="tok-o">:</span><span class="tok-s1">&#39;555-8765&#39;</span><span class="tok-p">,</span> <span class="tok-nx">age</span><span class="tok-o">:</span><span class="tok-mi">29</span><span class="tok-p">}];</span>
      <span class="tok-nx">$scope</span><span class="tok-p">.</span><span class="tok-nx">predicate</span> <span class="tok-o">=</span> <span class="tok-s1">&#39;-age&#39;</span><span class="tok-p">;</span>
    <span class="tok-p">}]);</span>
<span class="tok-nt">&lt;/script&gt;</span>
<span class="tok-nt">&lt;div</span> <span class="tok-na">ng-app=</span><span class="tok-s">&quot;orderByExample&quot;</span><span class="tok-nt">&gt;</span>
<span class="tok-nt">&lt;div</span> <span class="tok-na">ng-controller=</span><span class="tok-s">&quot;ExampleController&quot;</span><span class="tok-nt">&gt;</span>
  <span class="tok-nt">&lt;pre&gt;</span>Sorting predicate = {{predicate}}; reverse = {{reverse}}<span class="tok-nt">&lt;/pre&gt;</span>
  <span class="tok-nt">&lt;hr/&gt;</span>
  [ <span class="tok-nt">&lt;a</span> <span class="tok-na">href=</span><span class="tok-s">&quot;&quot;</span> <span class="tok-na">ng-click=</span><span class="tok-s">&quot;predicate=&#39;&#39;&quot;</span><span class="tok-nt">&gt;</span>unsorted<span class="tok-nt">&lt;/a&gt;</span> ]
  <span class="tok-nt">&lt;table</span> <span class="tok-na">class=</span><span class="tok-s">&quot;friend&quot;</span><span class="tok-nt">&gt;</span>
    <span class="tok-nt">&lt;tr&gt;</span>
      <span class="tok-nt">&lt;th&gt;&lt;a</span> <span class="tok-na">href=</span><span class="tok-s">&quot;&quot;</span> <span class="tok-na">ng-click=</span><span class="tok-s">&quot;predicate = &#39;name&#39;; reverse=false&quot;</span><span class="tok-nt">&gt;</span>Name<span class="tok-nt">&lt;/a&gt;</span>
          (<span class="tok-nt">&lt;a</span> <span class="tok-na">href=</span><span class="tok-s">&quot;&quot;</span> <span class="tok-na">ng-click=</span><span class="tok-s">&quot;predicate = &#39;-name&#39;; reverse=false&quot;</span><span class="tok-nt">&gt;</span>^<span class="tok-nt">&lt;/a&gt;</span>)<span class="tok-nt">&lt;/th&gt;</span>
      <span class="tok-nt">&lt;th&gt;&lt;a</span> <span class="tok-na">href=</span><span class="tok-s">&quot;&quot;</span> <span class="tok-na">ng-click=</span><span class="tok-s">&quot;predicate = &#39;phone&#39;; reverse=!reverse&quot;</span><span class="tok-nt">&gt;</span>Phone Number<span class="tok-nt">&lt;/a&gt;&lt;/th&gt;</span>
      <span class="tok-nt">&lt;th&gt;&lt;a</span> <span class="tok-na">href=</span><span class="tok-s">&quot;&quot;</span> <span class="tok-na">ng-click=</span><span class="tok-s">&quot;predicate = &#39;age&#39;; reverse=!reverse&quot;</span><span class="tok-nt">&gt;</span>Age<span class="tok-nt">&lt;/a&gt;&lt;/th&gt;</span>
    <span class="tok-nt">&lt;/tr&gt;</span>
    <span class="tok-nt">&lt;tr</span> <span class="tok-na">ng-repeat=</span><span class="tok-s">&quot;friend in friends | orderBy:predicate:reverse&quot;</span><span class="tok-nt">&gt;</span>
      <span class="tok-nt">&lt;td&gt;</span>{{friend.name}}<span class="tok-nt">&lt;/td&gt;</span>
      <span class="tok-nt">&lt;td&gt;</span>{{friend.phone}}<span class="tok-nt">&lt;/td&gt;</span>
      <span class="tok-nt">&lt;td&gt;</span>{{friend.age}}<span class="tok-nt">&lt;/td&gt;</span>
    <span class="tok-nt">&lt;/tr&gt;</span>
  <span class="tok-nt">&lt;/table&gt;</span>
<span class="tok-nt">&lt;/div&gt;</span>
<span class="tok-nt">&lt;/div&gt;</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>La documentación de AngularJs dice que <code>expression</code> puede ser una función que podemos getionar, por ejemplo, en nuestro controlador. <a href="http://codepen.io/alexsuch/pen/gbRmXd">Ejemplo</a>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="javascript"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31</div></td><td class="code">  <span class="tok-nx">angular</span><span class="tok-p">.</span><span class="tok-nx">module</span><span class="tok-p">(</span><span class="tok-s1">&#39;orderByExample&#39;</span><span class="tok-p">,</span> <span class="tok-p">[])</span>
    <span class="tok-p">.</span><span class="tok-nx">controller</span><span class="tok-p">(</span><span class="tok-s1">&#39;ExampleController&#39;</span><span class="tok-p">,</span> <span class="tok-p">[</span><span class="tok-s1">&#39;$scope&#39;</span><span class="tok-p">,</span> <span class="tok-kd">function</span><span class="tok-p">(</span><span class="tok-nx">$scope</span><span class="tok-p">)</span> <span class="tok-p">{</span>
      <span class="tok-nx">$scope</span><span class="tok-p">.</span><span class="tok-nx">friends</span> <span class="tok-o">=</span>
          <span class="tok-p">[{</span><span class="tok-nx">name</span><span class="tok-o">:</span><span class="tok-s1">&#39;John&#39;</span><span class="tok-p">,</span> <span class="tok-nx">phone</span><span class="tok-o">:</span><span class="tok-s1">&#39;555-1212&#39;</span><span class="tok-p">,</span> <span class="tok-nx">age</span><span class="tok-o">:</span><span class="tok-mi">10</span><span class="tok-p">},</span>
           <span class="tok-p">{</span><span class="tok-nx">name</span><span class="tok-o">:</span><span class="tok-s1">&#39;Mary&#39;</span><span class="tok-p">,</span> <span class="tok-nx">phone</span><span class="tok-o">:</span><span class="tok-s1">&#39;555-9876&#39;</span><span class="tok-p">,</span> <span class="tok-nx">age</span><span class="tok-o">:</span><span class="tok-mi">19</span><span class="tok-p">},</span>
           <span class="tok-p">{</span><span class="tok-nx">name</span><span class="tok-o">:</span><span class="tok-s1">&#39;Mike&#39;</span><span class="tok-p">,</span> <span class="tok-nx">phone</span><span class="tok-o">:</span><span class="tok-s1">&#39;555-4321&#39;</span><span class="tok-p">,</span> <span class="tok-nx">age</span><span class="tok-o">:</span><span class="tok-mi">21</span><span class="tok-p">},</span>
           <span class="tok-p">{</span><span class="tok-nx">name</span><span class="tok-o">:</span><span class="tok-s1">&#39;Adam&#39;</span><span class="tok-p">,</span> <span class="tok-nx">phone</span><span class="tok-o">:</span><span class="tok-s1">&#39;555-5678&#39;</span><span class="tok-p">,</span> <span class="tok-nx">age</span><span class="tok-o">:</span><span class="tok-mi">35</span><span class="tok-p">},</span>
           <span class="tok-p">{</span><span class="tok-nx">name</span><span class="tok-o">:</span><span class="tok-s1">&#39;Julie&#39;</span><span class="tok-p">,</span> <span class="tok-nx">phone</span><span class="tok-o">:</span><span class="tok-s1">&#39;555-8765&#39;</span><span class="tok-p">,</span> <span class="tok-nx">age</span><span class="tok-o">:</span><span class="tok-mi">29</span><span class="tok-p">}];</span>

      <span class="tok-kd">var</span> <span class="tok-nx">predicate</span> <span class="tok-o">=</span> <span class="tok-s1">&#39;age&#39;</span><span class="tok-p">;</span>
      <span class="tok-kd">var</span> <span class="tok-nx">reverse</span> <span class="tok-o">=</span> <span class="tok-kc">false</span><span class="tok-p">;</span>

      <span class="tok-nx">$scope</span><span class="tok-p">.</span><span class="tok-nx">predicate</span> <span class="tok-o">=</span> <span class="tok-nx">predicate</span><span class="tok-p">;</span>
      <span class="tok-nx">$scope</span><span class="tok-p">.</span><span class="tok-nx">reverse</span> <span class="tok-o">=</span> <span class="tok-nx">reverse</span><span class="tok-p">;</span>

      <span class="tok-nx">$scope</span><span class="tok-p">.</span><span class="tok-nx">setPredicate</span> <span class="tok-o">=</span> <span class="tok-kd">function</span><span class="tok-p">(</span><span class="tok-nx">_predicate</span><span class="tok-p">){</span>
        <span class="tok-k">if</span><span class="tok-p">(</span><span class="tok-nx">predicate</span> <span class="tok-o">===</span> <span class="tok-nx">_predicate</span><span class="tok-p">)</span> <span class="tok-p">{</span>
          <span class="tok-nx">reverse</span> <span class="tok-o">=</span> <span class="tok-o">!</span><span class="tok-nx">reverse</span><span class="tok-p">;</span>
        <span class="tok-p">}</span> <span class="tok-k">else</span> <span class="tok-p">{</span>
          <span class="tok-nx">predicate</span> <span class="tok-o">=</span> <span class="tok-nx">_predicate</span><span class="tok-p">;</span>
          <span class="tok-nx">reverse</span> <span class="tok-o">=</span> <span class="tok-kc">false</span><span class="tok-p">;</span>
        <span class="tok-p">}</span>

        <span class="tok-nx">$scope</span><span class="tok-p">.</span><span class="tok-nx">predicate</span> <span class="tok-o">=</span> <span class="tok-nx">predicate</span><span class="tok-p">;</span>
        <span class="tok-nx">$scope</span><span class="tok-p">.</span><span class="tok-nx">reverse</span> <span class="tok-o">=</span> <span class="tok-nx">reverse</span><span class="tok-p">;</span>
      <span class="tok-p">};</span>

      <span class="tok-nx">$scope</span><span class="tok-p">.</span><span class="tok-nx">getPredicate</span> <span class="tok-o">=</span> <span class="tok-kd">function</span><span class="tok-p">(){</span>
        <span class="tok-k">return</span> <span class="tok-p">(</span><span class="tok-nx">reverse</span><span class="tok-o">?</span><span class="tok-s1">&#39;-&#39;</span><span class="tok-o">:</span><span class="tok-s1">&#39;&#39;</span><span class="tok-p">)</span> <span class="tok-o">+</span> <span class="tok-nx">predicate</span><span class="tok-p">;</span>
      <span class="tok-p">};</span>
    <span class="tok-p">}]);</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="html"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19</div></td><td class="code"><span class="tok-nt">&lt;div</span> <span class="tok-na">ng-app=</span><span class="tok-s">&quot;orderByExample&quot;</span><span class="tok-nt">&gt;</span>
<span class="tok-nt">&lt;div</span> <span class="tok-na">ng-controller=</span><span class="tok-s">&quot;ExampleController&quot;</span><span class="tok-nt">&gt;</span>
  <span class="tok-nt">&lt;pre&gt;</span>Ordenando por = {{predicate}}; reverse = {{reverse}}<span class="tok-nt">&lt;/pre&gt;</span>
  <span class="tok-nt">&lt;hr/&gt;</span>
  [ <span class="tok-nt">&lt;a</span> <span class="tok-na">href=</span><span class="tok-s">&quot;&quot;</span> <span class="tok-na">ng-click=</span><span class="tok-s">&quot;setPredicate(null)&quot;</span><span class="tok-nt">&gt;</span>unsorted<span class="tok-nt">&lt;/a&gt;</span> ]
  <span class="tok-nt">&lt;table</span> <span class="tok-na">class=</span><span class="tok-s">&quot;friend&quot;</span><span class="tok-nt">&gt;</span>
    <span class="tok-nt">&lt;tr&gt;</span>
      <span class="tok-nt">&lt;th&gt;&lt;a</span> <span class="tok-na">href=</span><span class="tok-s">&quot;&quot;</span> <span class="tok-na">ng-click=</span><span class="tok-s">&quot;setPredicate(&#39;name&#39;)&quot;</span><span class="tok-nt">&gt;</span>Name<span class="tok-nt">&lt;/a&gt;&lt;/th&gt;</span>
      <span class="tok-nt">&lt;th&gt;&lt;a</span> <span class="tok-na">href=</span><span class="tok-s">&quot;&quot;</span> <span class="tok-na">ng-click=</span><span class="tok-s">&quot;setPredicate(&#39;phone&#39;)&quot;</span><span class="tok-nt">&gt;</span>Phone Number<span class="tok-nt">&lt;/a&gt;&lt;/th&gt;</span>
      <span class="tok-nt">&lt;th&gt;&lt;a</span> <span class="tok-na">href=</span><span class="tok-s">&quot;&quot;</span> <span class="tok-na">ng-click=</span><span class="tok-s">&quot;setPredicate(&#39;age&#39;)&quot;</span><span class="tok-nt">&gt;</span>Age<span class="tok-nt">&lt;/a&gt;&lt;/th&gt;</span>
    <span class="tok-nt">&lt;/tr&gt;</span>
    <span class="tok-nt">&lt;tr</span> <span class="tok-na">ng-repeat=</span><span class="tok-s">&quot;friend in friends | orderBy:getPredicate():reverse&quot;</span><span class="tok-nt">&gt;</span>
      <span class="tok-nt">&lt;td&gt;</span>{{friend.name}}<span class="tok-nt">&lt;/td&gt;</span>
      <span class="tok-nt">&lt;td&gt;</span>{{friend.phone}}<span class="tok-nt">&lt;/td&gt;</span>
      <span class="tok-nt">&lt;td&gt;</span>{{friend.age}}<span class="tok-nt">&lt;/td&gt;</span>
    <span class="tok-nt">&lt;/tr&gt;</span>
  <span class="tok-nt">&lt;/table&gt;</span>
<span class="tok-nt">&lt;/div&gt;</span>
<span class="tok-nt">&lt;/div&gt;</span>
</td></tr></table></code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_cómo_crear_un_filtro_personalizado">5.3. Cómo crear un filtro personalizado</h3>
<div class="paragraph">
<p>Para crear un filtro, hay que registrar una nueva función factoría de tipo <code>filter</code> en nuestro módulo. Esta factoría debe devolver una función,
que recibe como parámetro el elemento de entrada. Se pueden pasar los parámetros adicionales que haga falta.</p>
</div>
<div class="paragraph">
<p>En el siguiente ejemplo, construiremos un filtro que se encargue de formatear un número de teléfono <span class="footnote">[<a id="_footnoteref_6" class="footnote" href="#_footnote_6" title="View footnote.">6</a>]</span>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="javascript"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24</div></td><td class="code"> <span class="tok-nx">angular</span>
  <span class="tok-p">.</span><span class="tok-nx">module</span><span class="tok-p">(</span><span class="tok-s1">&#39;telephoneSample&#39;</span><span class="tok-p">,</span> <span class="tok-p">[])</span>
  <span class="tok-p">.</span><span class="tok-nx">filter</span><span class="tok-p">(</span><span class="tok-s1">&#39;telephone&#39;</span><span class="tok-p">,</span> <span class="tok-kd">function</span><span class="tok-p">(){</span>
    <span class="tok-k">return</span> <span class="tok-kd">function</span><span class="tok-p">(</span><span class="tok-nx">input</span><span class="tok-p">)</span> <span class="tok-p">{</span>
      <span class="tok-kd">var</span> <span class="tok-nx">number</span> <span class="tok-o">=</span> <span class="tok-nx">input</span> <span class="tok-o">||</span> <span class="tok-s1">&#39;&#39;</span><span class="tok-p">;</span>
      <span class="tok-nx">number</span> <span class="tok-o">=</span> <span class="tok-nx">number</span><span class="tok-p">.</span><span class="tok-nx">trim</span><span class="tok-p">().</span><span class="tok-nx">replace</span><span class="tok-p">(</span><span class="tok-sr">/[-\s\(\)]/g</span><span class="tok-p">,</span> <span class="tok-s1">&#39;&#39;</span><span class="tok-p">);</span>

      <span class="tok-k">if</span><span class="tok-p">(</span><span class="tok-nx">number</span><span class="tok-p">.</span><span class="tok-nx">length</span> <span class="tok-o">===</span> <span class="tok-mi">11</span><span class="tok-p">)</span> <span class="tok-p">{</span>
        <span class="tok-kd">var</span> <span class="tok-nx">area</span> <span class="tok-o">=</span> <span class="tok-p">[</span><span class="tok-s1">&#39;(&#39;</span><span class="tok-p">,</span> <span class="tok-s1">&#39;+&#39;</span><span class="tok-p">,</span> <span class="tok-nx">number</span><span class="tok-p">.</span><span class="tok-nx">substr</span><span class="tok-p">(</span><span class="tok-mi">0</span><span class="tok-p">,</span><span class="tok-mi">2</span><span class="tok-p">)</span> <span class="tok-p">,</span><span class="tok-s1">&#39;)&#39;</span><span class="tok-p">].</span><span class="tok-nx">join</span><span class="tok-p">(</span><span class="tok-s1">&#39;&#39;</span><span class="tok-p">);</span>

        <span class="tok-kd">var</span> <span class="tok-nx">local</span> <span class="tok-o">=</span> <span class="tok-p">[</span><span class="tok-nx">number</span><span class="tok-p">.</span><span class="tok-nx">substr</span><span class="tok-p">(</span><span class="tok-mi">2</span><span class="tok-p">,</span> <span class="tok-mi">3</span><span class="tok-p">),</span> <span class="tok-nx">number</span><span class="tok-p">.</span><span class="tok-nx">substr</span><span class="tok-p">(</span><span class="tok-mi">5</span><span class="tok-p">,</span> <span class="tok-mi">3</span><span class="tok-p">),</span> <span class="tok-nx">number</span><span class="tok-p">.</span><span class="tok-nx">substr</span><span class="tok-p">(</span><span class="tok-mi">8</span><span class="tok-p">,</span> <span class="tok-mi">11</span><span class="tok-p">)].</span><span class="tok-nx">join</span><span class="tok-p">(</span><span class="tok-s1">&#39;-&#39;</span><span class="tok-p">);</span>

        <span class="tok-k">return</span> <span class="tok-p">[</span><span class="tok-nx">area</span><span class="tok-p">,</span><span class="tok-nx">local</span><span class="tok-p">].</span><span class="tok-nx">join</span><span class="tok-p">(</span><span class="tok-s1">&#39; &#39;</span><span class="tok-p">)</span>
      <span class="tok-p">}</span>

      <span class="tok-k">if</span><span class="tok-p">(</span><span class="tok-nx">number</span><span class="tok-p">.</span><span class="tok-nx">length</span> <span class="tok-o">===</span> <span class="tok-mi">9</span><span class="tok-p">)</span> <span class="tok-p">{</span>
        <span class="tok-kd">var</span> <span class="tok-nx">local</span> <span class="tok-o">=</span> <span class="tok-p">[</span><span class="tok-nx">number</span><span class="tok-p">.</span><span class="tok-nx">substr</span><span class="tok-p">(</span><span class="tok-mi">0</span><span class="tok-p">,</span> <span class="tok-mi">3</span><span class="tok-p">),</span> <span class="tok-nx">number</span><span class="tok-p">.</span><span class="tok-nx">substr</span><span class="tok-p">(</span><span class="tok-mi">3</span><span class="tok-p">,</span> <span class="tok-mi">3</span><span class="tok-p">),</span> <span class="tok-nx">number</span><span class="tok-p">.</span><span class="tok-nx">substr</span><span class="tok-p">(</span><span class="tok-mi">6</span><span class="tok-p">,</span> <span class="tok-mi">11</span><span class="tok-p">)].</span><span class="tok-nx">join</span><span class="tok-p">(</span><span class="tok-s1">&#39;-&#39;</span><span class="tok-p">);</span>

        <span class="tok-k">return</span> <span class="tok-nx">local</span>
      <span class="tok-p">}</span>

      <span class="tok-k">return</span> <span class="tok-nx">number</span><span class="tok-p">;</span>
    <span class="tok-p">};</span>
  <span class="tok-p">});</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>Para probarlo en nuestra vista:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="html"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3
4
5</div></td><td class="code"><span class="tok-nt">&lt;div</span> <span class="tok-na">ng-app=</span><span class="tok-s">&quot;telephoneSample&quot;</span><span class="tok-nt">&gt;</span>
  <span class="tok-nt">&lt;div&gt;</span>{{&#39;965123&#39; | telephone}}<span class="tok-nt">&lt;/div&gt;</span>
  <span class="tok-nt">&lt;div&gt;</span>{{&#39;965123456&#39; | telephone}}<span class="tok-nt">&lt;/div&gt;</span>
  <span class="tok-nt">&lt;div&gt;</span>{{&#39;34965123456&#39; | telephone}}<span class="tok-nt">&lt;/div&gt;</span>
<span class="tok-nt">&lt;/div&gt;</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>Para crear un filtro parametrizado, actuaríamos de la misma manera. El siguiente ejemplo muestra cómo sería
un filtro que introduce un valor por defecto en caso de que el elemento que pasemos esté vacío. Éste texto será '-', o bien
la cadena que pasemos como primer parámetro <span class="footnote">[<a id="_footnoteref_7" class="footnote" href="#_footnote_7" title="View footnote.">7</a>]</span>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="javascript"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30</div></td><td class="code"><span class="tok-nx">angular</span>
<span class="tok-p">.</span><span class="tok-nx">module</span><span class="tok-p">(</span><span class="tok-s1">&#39;textOrDefaultSample&#39;</span><span class="tok-p">,</span> <span class="tok-p">[])</span>
<span class="tok-p">.</span><span class="tok-nx">controller</span><span class="tok-p">(</span><span class="tok-s1">&#39;mainCtrl&#39;</span><span class="tok-p">,</span> <span class="tok-kd">function</span><span class="tok-p">(</span><span class="tok-nx">$scope</span><span class="tok-p">){</span>
  <span class="tok-nx">$scope</span><span class="tok-p">.</span><span class="tok-nx">data</span> <span class="tok-o">=</span> <span class="tok-p">{</span>
    <span class="tok-nx">nullValue</span> <span class="tok-o">:</span> <span class="tok-kc">null</span><span class="tok-p">,</span>
    <span class="tok-nx">notNullValue</span><span class="tok-o">:</span> <span class="tok-s1">&#39;Hello world&#39;</span>
  <span class="tok-p">};</span>
<span class="tok-p">})</span>
<span class="tok-p">.</span><span class="tok-nx">filter</span><span class="tok-p">(</span><span class="tok-s1">&#39;textOrDefault&#39;</span><span class="tok-p">,</span> <span class="tok-kd">function</span> <span class="tok-p">()</span> <span class="tok-p">{</span>
  <span class="tok-k">return</span> <span class="tok-kd">function</span> <span class="tok-p">(</span><span class="tok-nx">input</span><span class="tok-p">,</span> <span class="tok-nx">defaultValue</span><span class="tok-p">)</span> <span class="tok-p">{</span>
   <span class="tok-nx">defaultValue</span> <span class="tok-o">=</span> <span class="tok-nx">defaultValue</span> <span class="tok-o">||</span> <span class="tok-s1">&#39;-&#39;</span><span class="tok-p">;</span>
   <span class="tok-k">if</span> <span class="tok-p">(</span><span class="tok-o">!</span><span class="tok-nx">input</span><span class="tok-p">)</span> <span class="tok-p">{</span>
     <span class="tok-k">return</span> <span class="tok-nx">defaultValue</span><span class="tok-p">;</span>
   <span class="tok-p">}</span>

   <span class="tok-k">if</span> <span class="tok-p">(</span><span class="tok-o">!</span><span class="tok-nx">angular</span><span class="tok-p">.</span><span class="tok-nx">isString</span><span class="tok-p">())</span> <span class="tok-p">{</span>
     <span class="tok-k">if</span> <span class="tok-p">(</span><span class="tok-nx">input</span><span class="tok-p">.</span><span class="tok-nx">toString</span><span class="tok-p">)</span> <span class="tok-p">{</span>
       <span class="tok-nx">input</span> <span class="tok-o">=</span> <span class="tok-nx">input</span><span class="tok-p">.</span><span class="tok-nx">toString</span><span class="tok-p">();</span>
     <span class="tok-p">}</span> <span class="tok-k">else</span> <span class="tok-p">{</span>
       <span class="tok-k">return</span> <span class="tok-nx">defaultValue</span><span class="tok-p">;</span>
     <span class="tok-p">}</span>
   <span class="tok-p">}</span>

   <span class="tok-k">if</span> <span class="tok-p">(</span><span class="tok-nx">input</span><span class="tok-p">.</span><span class="tok-nx">trim</span><span class="tok-p">().</span><span class="tok-nx">length</span> <span class="tok-o">&gt;</span> <span class="tok-mi">0</span><span class="tok-p">)</span> <span class="tok-p">{</span>
     <span class="tok-k">return</span> <span class="tok-nx">input</span><span class="tok-p">;</span>
   <span class="tok-p">}</span>

     <span class="tok-k">return</span> <span class="tok-nx">defaultValue</span><span class="tok-p">;</span>
   <span class="tok-p">};</span>
 <span class="tok-p">});</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="html"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3
4
5
6</div></td><td class="code"><span class="tok-nt">&lt;div</span> <span class="tok-na">ng-app=</span><span class="tok-s">&quot;textOrDefaultSample&quot;</span> <span class="tok-na">ng-controller=</span><span class="tok-s">&quot;mainCtrl&quot;</span><span class="tok-nt">&gt;</span>
  <span class="tok-nt">&lt;div&gt;</span>{{ data.nullValue | textOrDefault}}<span class="tok-nt">&lt;/div&gt;</span>
  <span class="tok-nt">&lt;div&gt;</span>{{ data.nullValue | textOrDefault:&#39;N/D&#39;}}<span class="tok-nt">&lt;/div&gt;</span>
  <span class="tok-nt">&lt;div&gt;</span>{{ data.notNullValue | textOrDefault}}<span class="tok-nt">&lt;/div&gt;</span>
  <span class="tok-nt">&lt;div&gt;</span>{{ data.notNullValue | textOrDefault:&#39;N/D&#39;}}<span class="tok-nt">&lt;/div&gt;</span>
<span class="tok-nt">&lt;/div&gt;</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>Vemos que hemos hecho uso de la función <code>angular.isString</code>. El objeto <code>angular</code> nos proporciona
una serie de utilidades que pueden sernos de gran ayuda, y que podemos ver listados en <a href="https://docs.angularjs.org/api/ng/function" class="bare">https://docs.angularjs.org/api/ng/function</a>.</p>
</div>
</div>
<div class="sect2">
<h3 id="__em_tip_em_cómo_acceder_a_un_array_filtrado_fuera_de_code_ng_repeat_code">5.4. <em>Tip</em>: cómo acceder a un array filtrado fuera de <code>ng-repeat</code></h3>
<div class="paragraph">
<p>Como hemos dicho varias veces, un filtro genera una salida nueva, sin modificar el elemento original. Así, supongamos el siguiente ejemplo <span class="footnote">[<a id="_footnoteref_8" class="footnote" href="#_footnote_8" title="View footnote.">8</a>]</span>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="javascript"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14</div></td><td class="code"><span class="tok-nx">angular</span>
  <span class="tok-p">.</span><span class="tok-nx">module</span><span class="tok-p">(</span><span class="tok-s1">&#39;app&#39;</span><span class="tok-p">,</span> <span class="tok-p">[])</span>
  <span class="tok-p">.</span><span class="tok-nx">controller</span><span class="tok-p">(</span><span class="tok-s1">&#39;mainCtrl&#39;</span><span class="tok-p">,</span> <span class="tok-kd">function</span><span class="tok-p">(</span><span class="tok-nx">$scope</span><span class="tok-p">){</span>
    <span class="tok-nx">$scope</span><span class="tok-p">.</span><span class="tok-nx">teachers</span> <span class="tok-o">=</span> <span class="tok-p">[</span>
      <span class="tok-s1">&#39;Domingo&#39;</span><span class="tok-p">,</span>
      <span class="tok-s1">&#39;Otto&#39;</span><span class="tok-p">,</span>
      <span class="tok-s1">&#39;Eli&#39;</span><span class="tok-p">,</span>
      <span class="tok-s1">&#39;Miguel Ángel&#39;</span><span class="tok-p">,</span>
      <span class="tok-s1">&#39;Aitor&#39;</span><span class="tok-p">,</span>
      <span class="tok-s1">&#39;Fran&#39;</span><span class="tok-p">,</span>
      <span class="tok-s1">&#39;José Luís&#39;</span><span class="tok-p">,</span>
      <span class="tok-s1">&#39;Álex&#39;</span>
    <span class="tok-p">];</span>
  <span class="tok-p">});</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="html"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3
4
5
6
7</div></td><td class="code"><span class="tok-nt">&lt;div</span> <span class="tok-na">ng-app=</span><span class="tok-s">&quot;app&quot;</span> <span class="tok-na">ng-controller=</span><span class="tok-s">&quot;mainCtrl&quot;</span><span class="tok-nt">&gt;</span>
<span class="tok-nt">&lt;label&gt;</span>Filtrar: <span class="tok-nt">&lt;input</span> <span class="tok-na">type=</span><span class="tok-s">&quot;text&quot;</span> <span class="tok-na">ng-model=</span><span class="tok-s">&quot;search&quot;</span> <span class="tok-nt">/&gt;&lt;/label&gt;</span>
<span class="tok-nt">&lt;ul&gt;</span>
  <span class="tok-nt">&lt;li</span> <span class="tok-na">ng-repeat=</span><span class="tok-s">&quot;it in teachers | filter:search&quot;</span><span class="tok-nt">&gt;</span>{{it}}<span class="tok-nt">&lt;/li&gt;</span>
<span class="tok-nt">&lt;/ul&gt;</span>
  Profesores filtrados: {{ teachers.length }}.
<span class="tok-nt">&lt;/div&gt;</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>El resultado de <em>profesores filtrados</em>, filtremos los ítems que filtremos, siempre será 8.</p>
</div>
<div class="paragraph">
<p>Una cosa que se nos podría ocurrir para corregir esto, sería volver a filtrar el resultado:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="html"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1</div></td><td class="code">Profesores filtrados: {{ teachers.length | filter:search }}.
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>Es una opción válida, pero no óptima: recordemos que un filtro es una operación que puede resultar bastante
costosa, en función de lo que hayamos programado. Además, podemos encadenar filtros, lo que hace que su
complejidad aumente en cada filtro:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="html"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1</div></td><td class="code">Profesores filtrados: {{ teachers.length | filter:search | sort | uppercase | prepend:&#39;---&gt;&#39; | append: &#39;<span class="tok-nt">&lt;---</span><span class="tok-err">&#39;</span> <span class="tok-err">}}.</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>Lo ideal para este caso sería emplear el mismo array filtrado para ambos casos. Y lo podemos conseguir, simplemente
inicializando una variable al valor de los elementos filtrados <span class="footnote">[<a id="_footnoteref_9" class="footnote" href="#_footnote_9" title="View footnote.">9</a>]</span> :</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="html"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3
4
5
6
7</div></td><td class="code"><span class="tok-nt">&lt;div</span> <span class="tok-na">ng-app=</span><span class="tok-s">&quot;app&quot;</span> <span class="tok-na">ng-controller=</span><span class="tok-s">&quot;mainCtrl&quot;</span><span class="tok-nt">&gt;</span>
<span class="tok-nt">&lt;label&gt;</span>Filtrar: <span class="tok-nt">&lt;input</span> <span class="tok-na">type=</span><span class="tok-s">&quot;text&quot;</span> <span class="tok-na">ng-model=</span><span class="tok-s">&quot;search&quot;</span> <span class="tok-nt">/&gt;&lt;/label&gt;</span>
<span class="tok-nt">&lt;ul&gt;</span>
  <span class="tok-nt">&lt;li</span> <span class="tok-na">ng-repeat=</span><span class="tok-s">&quot;it in filteredTeachers = (teachers | filter:search)&quot;</span><span class="tok-nt">&gt;</span>{{it}}<span class="tok-nt">&lt;/li&gt;</span>
<span class="tok-nt">&lt;/ul&gt;</span>
  Profesores filtrados: {{ filteredTeachers.length }}.
<span class="tok-nt">&lt;/div&gt;</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>Para el caso de los filtros encadenados que hemos visto antes, sería exactamente igual:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="html"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3
4
5
6
7</div></td><td class="code"><span class="tok-nt">&lt;div</span> <span class="tok-na">ng-app=</span><span class="tok-s">&quot;app&quot;</span> <span class="tok-na">ng-controller=</span><span class="tok-s">&quot;mainCtrl&quot;</span><span class="tok-nt">&gt;</span>
<span class="tok-nt">&lt;label&gt;</span>Filtrar: <span class="tok-nt">&lt;input</span> <span class="tok-na">type=</span><span class="tok-s">&quot;text&quot;</span> <span class="tok-na">ng-model=</span><span class="tok-s">&quot;search&quot;</span> <span class="tok-nt">/&gt;&lt;/label&gt;</span>
<span class="tok-nt">&lt;ul&gt;</span>
  <span class="tok-nt">&lt;li</span> <span class="tok-na">ng-repeat=</span><span class="tok-s">&quot;it in filteredTeachers = ( | filter:search | sort | uppercase | prepend:&#39;---&gt;&#39; | append: &#39;&lt;---&#39;)&quot;</span><span class="tok-nt">&gt;</span>{{it}}<span class="tok-nt">&lt;/li&gt;</span>
<span class="tok-nt">&lt;/ul&gt;</span>
  Profesores filtrados: {{ filteredTeachers.length }}.
<span class="tok-nt">&lt;/div&gt;</span>
</td></tr></table></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_ejercicios_3">5.5. Ejercicios</h3>
<div class="paragraph">
<p>Aplica el <em>tag</em> <code>filters</code> a la versión que quieres que se corrija.</p>
</div>
<div class="sect3">
<h4 id="_adición_de_filtro_de_moneda_0_66_puntos">5.5.1. Adición de filtro de moneda (0,66 puntos)</h4>
<div class="paragraph">
<p>Modifica el ejemplo del carrito de la compra para que los importes se formateen en euros y formato español de decimales. Revisa la documentación del filtro <code>currency</code>, porque tendremos que asegurarnos que siempre se muestren dos decimales, haya más o menos en el importe determinado para un prodcto en el servicio.</p>
</div>
</div>
<div class="sect3">
<h4 id="_custom_filter_0_67_puntos">5.5.2. Custom filter (0,67 puntos)</h4>
<div class="paragraph">
<p>Vamos a crear un filtro propio que nos devuelva el nombre del producto. Este filtro se llamará <code>productFullName</code>.</p>
</div>
<div class="paragraph">
<p>Recibirá como parámetro un objeto de tipo producto, con lo que en la vista lo pasaremos de la siguiente manera:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="html"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3
4
5</div></td><td class="code"><span class="tok-nt">&lt;p&gt;</span>
  {{ product | productFullName }}
  <span class="tok-nt">&lt;br/&gt;</span>
  {{ product.price }} <span class="tok-ni">&amp;euro;</span>
<span class="tok-nt">&lt;/p&gt;</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>Este filtro mostrará, concatenados, la marca y el nombre del producto. La marca deberá mostrarse en mayúsculas, y no deberemos usar la función <code>toUpperCase()</code> de JavaScript, sino inyectar el filtro <code>upperCaseFilter</code> en nuestro filtro y hacer uso de él.</p>
</div>
</div>
<div class="sect3">
<h4 id="_custom_filter_con_parámetros_0_67_puntos">5.5.3. Custom filter con parámetros (0,67 puntos)</h4>
<div class="paragraph">
<p>Vamos a crear un filtro personalizado para la puntuación de los productos. Mostrará la puntuación en forma de estrellas.  Se mostrarán tantas estrellas rellenas como puntuación tenga el producto, y luego se mostrarán estrellas vacías hasta llegar a un total de cinco. Por ejemplo, una puntuación de 3 mostrará ★★★☆☆.</p>
</div>
<div class="paragraph">
<p>Para ello, vamos a crear un filtro de propósito general. Éste, por tanto, no recibirá un objeto como parámetro sino un valor. También, recibirá un parámetro adicional, que será el máximo de puntuación del producto. En este caso la puntuación máxima son cinco estrellas, pero de esta manera e filtro también nos valdrá para cuando puntuemos sobre diez.</p>
</div>
<div class="paragraph">
<p>Modificaremos nuestra plantilla para mostrar la puntuación debajo del importe:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="html"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3
4
5
6
7</div></td><td class="code"><span class="tok-nt">&lt;p&gt;</span>
  {{ product | productFullName }}
  <span class="tok-nt">&lt;br/&gt;</span>
  {{ product.price }} <span class="tok-ni">&amp;euro;</span>
  <span class="tok-nt">&lt;br/&gt;</span>
  {{ product.rating | rating:5 }}
<span class="tok-nt">&lt;/p&gt;</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Para el ejercicio, pegaremos directamente el carácter de las estrellas, en lugar de emplear su <a href="http://www.edlazorvfx.com/ysu/html/ascii.html">código HTML</a>. Si quisiéramos usar código html, tendríamos que hacer uso del servicio <a href="https://docs.angularjs.org/api/ng/service/$sce"><code>$sce</code></a> y de la directiva <a href="https://docs.angularjs.org/api/ng/directive/ngBindHtml"><code>ngBindHtml</code></a>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="html"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3
4
5
6
7</div></td><td class="code"><span class="tok-nt">&lt;p&gt;</span>
  {{ product | productFullName }}
  <span class="tok-nt">&lt;br/&gt;</span>
  {{ product.price }} <span class="tok-ni">&amp;euro;</span>
  <span class="tok-nt">&lt;br/&gt;</span>
  <span class="tok-nt">&lt;span</span> <span class="tok-na">ng-bind-html=</span><span class="tok-s">&quot;product.rating | rating:5&quot;</span><span class="tok-nt">&gt;&lt;/span&gt;</span>
<span class="tok-nt">&lt;/p&gt;</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="javascript"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11</div></td><td class="code"><span class="tok-p">.</span><span class="tok-nx">filter</span><span class="tok-p">(</span><span class="tok-s1">&#39;rating&#39;</span><span class="tok-p">,</span> <span class="tok-kd">function</span><span class="tok-p">(</span><span class="tok-nx">$sce</span><span class="tok-p">){</span>
    <span class="tok-k">return</span> <span class="tok-kd">function</span><span class="tok-p">(</span><span class="tok-nx">rating</span><span class="tok-p">,</span><span class="tok-nx">maxVal</span><span class="tok-p">){</span>
      <span class="tok-kd">var</span> <span class="tok-nx">result</span> <span class="tok-o">=</span> <span class="tok-s1">&#39;&#39;</span><span class="tok-p">;</span>
      <span class="tok-kd">var</span> <span class="tok-nx">solidStar</span> <span class="tok-o">=</span> <span class="tok-s2">&quot;&amp;#9733;&quot;</span><span class="tok-p">;</span> <span class="tok-c1">//★</span>
      <span class="tok-kd">var</span> <span class="tok-nx">outlineStar</span> <span class="tok-o">=</span> <span class="tok-s2">&quot;&amp;#9734;&quot;</span> <span class="tok-c1">//☆</span>

      <span class="tok-c1">//TODO: implement filter</span>

      <span class="tok-k">return</span> <span class="tok-nx">$sce</span><span class="tok-p">.</span><span class="tok-nx">trustAsHtml</span><span class="tok-p">(</span><span class="tok-nx">result</span><span class="tok-p">);</span>
    <span class="tok-p">};</span>
  <span class="tok-p">})</span>
</td></tr></table></code></pre>
</div>
</div>
</td>
</tr>
</table>
</div>
<div style="page-break-after: always;"></div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="sesion06">6. Routing con <code>ngRoute</code></h2>
<div class="sectionbody">
<div class="paragraph">
<p>Al principio de la sesión introductoria, vimos que todo el código estaba
en la página principal y no había navegación hasta que se introdujo el
módulo <code>ngRoute</code>, que nos permitió convertir nuestra aplicación en una SPA.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Desde la versión 1.2 de AngularJS, el módulo ngRoute no forma parte del <em>core</em>
con lo que habrá que importarlo y añadirlo como dependencia de nuestra aplicación.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="sect2">
<h3 id="_gestión_de_la_navegación">6.1. Gestión de la navegación</h3>
<div class="paragraph">
<p>Para gestionar la navegación, AngularJS utiliza un truco, que consiste en que
modifica partes de la barra de direcciones de una URL. ¿Cuáles? aquellas que van
detrás del carácter <code>#</code>, también llamado <em>hashbang</em>. Todo lo que modifiquemos
por detrás de este carácter se llama <em>URL fragment</em>. La especificación
dice que, si cambiamos este fragmento sin alterar nada de lo que va por delante,
el navegador no recargará la página. Sin embargo, este cambio sí que se guarda en
el histórico del navegador, con lo cual los botones de atrás y adelante de nuestro
navegador sí que funcionan. Será cosa nuestra gestionarlo correctamente para que la
aplicación funcione como se desea al hacer uso de ellos.</p>
</div>
<div class="paragraph">
<p>Supongamos una serie de URLS de tipo CRUD. Idealmente, tendremos una URL para una lista
de ítems, un formulario de edición, a lo mejor otro de creación, etc. Así, podrían ser:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>/admin/users/list</code> – Para mostrar un listado de usuarios</p>
</li>
<li>
<p><code>/admin/users/new</code> – Formulario para crear un nuevo usuario</p>
</li>
<li>
<p><code>/admin/users/[userId]+ – Formulario para editar un usuario, cuyo ID es igual a +userId</code>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Podríamos traducir estas URLs parciales a URLs con fragmentos para una SPA, usando el
truco del hashbang que hemos comentado:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="http://www.miaplicaciondegestion.com/#/admin/users/list" class="bare">http://www.miaplicaciondegestion.com/#/admin/users/list</a></p>
</li>
<li>
<p><a href="http://www.miaplicaciondegestion.com/#/admin/users/new" class="bare">http://www.miaplicaciondegestion.com/#/admin/users/new</a></p>
</li>
<li>
<p><a href="http://www.miaplicaciondegestion.com/#/admin/users/">userId</a></p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_la_directiva_ngview">6.2. La directiva ngView</h3>
<div class="paragraph">
<p>La directiva <code>ngView+ es esencial para el uso de rutas, y complementa al servicio +$route</code>, incluyendo
la plantilla de la ruta actual en nuestro layout principal, que debe estar situado en nuestro fichero
<code>index.html</code>. Cada vez que la ruta cambia, todo el contenido de esta etiqueta cambiará, en función de
lo que hayamos configurado en nuestro servicio de routing.</p>
</div>
<div class="paragraph">
<p>La directiva ng-view se puede usar a modo de elemento, o bien como atributo de un elemento <code>div</code>. Sin
embargo, por cuestiones de compatibiliad con IE7 se recomienda su uso como atributo.</p>
</div>
<div class="paragraph">
<p>En el siguiente ejemplo se muestran las dos variantes, habiendo dejado comentado su uso como elemento.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="html"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21</div></td><td class="code"><span class="tok-cp">&lt;!DOCTYPE html&gt;</span>
<span class="tok-nt">&lt;html&gt;</span>
<span class="tok-nt">&lt;head</span> <span class="tok-na">lang=</span><span class="tok-s">&quot;en&quot;</span><span class="tok-nt">&gt;</span>
    <span class="tok-nt">&lt;meta</span> <span class="tok-na">charset=</span><span class="tok-s">&quot;UTF-8&quot;</span><span class="tok-nt">&gt;</span>
    <span class="tok-nt">&lt;title&gt;&lt;/title&gt;</span>
    <span class="tok-nt">&lt;link</span> <span class="tok-na">rel=</span><span class="tok-s">&quot;stylesheet&quot;</span> <span class="tok-na">href=</span><span class="tok-s">&quot;//maxcdn.bootstrapcdn.com/bootstrap/3.2.0/css/bootstrap.min.css&quot;</span><span class="tok-nt">/&gt;</span>
<span class="tok-nt">&lt;/head&gt;</span>
<span class="tok-nt">&lt;body</span> <span class="tok-na">ng-app=</span><span class="tok-s">&quot;routing&quot;</span><span class="tok-nt">&gt;</span>

<span class="tok-nt">&lt;div</span> <span class="tok-na">class=</span><span class="tok-s">&quot;container&quot;</span><span class="tok-nt">&gt;</span>
    <span class="tok-nt">&lt;div</span> <span class="tok-na">ng-include=</span><span class="tok-s">&quot;&#39;templates/common/header.html&#39;&quot;</span><span class="tok-nt">&gt;&lt;/div&gt;</span>
    <span class="tok-nt">&lt;div</span> <span class="tok-na">ng-view</span><span class="tok-nt">&gt;&lt;/div&gt;</span>
    <span class="tok-c">&lt;!-- &lt;ng-view&gt;&lt;/ng-view&gt; --&gt;</span>
    <span class="tok-nt">&lt;div</span> <span class="tok-na">ng-include=</span><span class="tok-s">&quot;&#39;templates/common/footer.html&#39;&quot;</span><span class="tok-nt">&gt;&lt;/div&gt;</span>
<span class="tok-nt">&lt;/div&gt;</span>

<span class="tok-nt">&lt;script </span><span class="tok-na">src=</span><span class="tok-s">&quot;https://code.angularjs.org/1.2.22/angular.js&quot;</span><span class="tok-nt">&gt;&lt;/script&gt;</span>
<span class="tok-nt">&lt;script </span><span class="tok-na">src=</span><span class="tok-s">&quot;https://code.angularjs.org/1.2.22/angular-route.js&quot;</span><span class="tok-nt">&gt;&lt;/script&gt;</span>
<span class="tok-nt">&lt;script </span><span class="tok-na">src=</span><span class="tok-s">&quot;app.js&quot;</span><span class="tok-nt">&gt;&lt;/script&gt;</span>
<span class="tok-nt">&lt;/body&gt;</span>
<span class="tok-nt">&lt;/html&gt;</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="sect3">
<h4 id="_nginclude">6.2.1. ngInclude</h4>
<div class="paragraph">
<p>En el fragmento de código anterior, hemos visto dos bloques que hacen uso de la directiva
<code>ngInclude</code>. Ésta se encarga de obtener un fragmento de HTML, compilarlo e introducirlo en
nuestra aplicación.</p>
</div>
<div class="paragraph">
<p>Es muy útil para insertar elementos parciales que se van a repetir a lo largo de nuestra
aplicación. Por ejemplo, en el bloque anterior se ha utilizado para añadir la cabecera
y el pie de la aplicación. Son dos elementos que van a estar siempre ahí, y no queremos
"ensuciar" nuestro fichero <code>index.html</code> con su código.</p>
</div>
<div class="paragraph">
<p><a href="https://bitbucket.org/alejandro_such/angularjs-routing-examples/src/7789079fea7cb3677c507f7e7067ecfa0c74ec5e?at=v1.0">Aquí</a> tenemos un enlace
de una aplicación en ese estado.</p>
</div>
<div class="paragraph">
<p>Fijáos que la directiva recibe como parámetro una expresión, por eso su valor está entre comillas simples.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_definición_de_rutas">6.3. Definición de rutas</h3>
<div class="paragraph">
<p>En AngularJS, las rutas se definen en la fase de configuración de la aplicación, haciendo uso del servicio <code>$routeProvider</code>.
Éste proporciona una API sencilla donde podemos encadenar métodos para definir rutas (método <code>when</code>), y establecer una
ruta por defecto (<code>otherwise</code>).</p>
</div>
<div class="paragraph">
<p>El método <code>when</code> recibe como entrada dos parámetros:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>path</code> (string). Ej: /user/list</p>
</li>
<li>
<p><code>ruta</code> (objeto). Puede tener varios atributos <span class="footnote">[<a id="_footnoteref_10" class="footnote" href="#_footnote_10" title="View footnote.">10</a>]</span>, pero lo normal es que usemos:</p>
<div class="ulist">
<ul>
<li>
<p><code>controller</code>. Será el nombre de un controlador que hayamos creado en nuestra aplicación. Al definir aquí el controlador, ya nos ahorramos el tener que emplear la directiva `ng-controller
en nuestro código.</p>
</li>
<li>
<p><code>templateUrl</code>. Ruta hacia la plantilla HTML con el contenido de nuestro parcial.</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>Por su parte, el método <code>otherwise</code> suele recibir un parámetro, consistente en un objeto con un atributo <code>redirectTo</code>, indicando la URL a la que redirigir cuando no se encuentra ninguna ruta
concordante.</p>
</div>
<div class="paragraph">
<p>Supongamos una aplicación de dos páginas. Consiste en una aplicación de pedidos, donde en la primera página tenemos un listado de pedidos, y en la segunda un formulario para realizar nuevos pedidos.
La página por defecto de nuestra aplicación será el listado de pedidos.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Un índice, que contiene un listado de todos los pedidos realizados.</p>
</li>
<li>
<p>Un formulario de introducción de nuevos pedidos.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Para no incrementar la complejidad de nuestra aplicación, los pedidos consistirán en una cadena de texto. <a href="https://bitbucket.org/alejandro_such/angularjs-routing-examples/src/22fe7b8441e74be3e2352e1c0034f0376f6014b6/?at=v2.0">Aquí</a>
tenemos el código completo de esta aplicación. Veamos cómo hemos configurado las rutas:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="javascript"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14</div></td><td class="code"><span class="tok-nx">angular</span>
    <span class="tok-p">.</span><span class="tok-nx">module</span><span class="tok-p">(</span><span class="tok-s1">&#39;ordersapp&#39;</span><span class="tok-p">,</span> <span class="tok-p">[</span><span class="tok-s1">&#39;ngRoute&#39;</span><span class="tok-p">])</span>
    <span class="tok-p">.</span><span class="tok-nx">config</span><span class="tok-p">(</span><span class="tok-kd">function</span><span class="tok-p">(</span><span class="tok-nx">$routeProvider</span><span class="tok-p">){</span>
        <span class="tok-nx">$routeProvider</span>
            <span class="tok-p">.</span><span class="tok-nx">when</span><span class="tok-p">(</span><span class="tok-s1">&#39;/orders&#39;</span><span class="tok-p">,</span> <span class="tok-p">{</span>
                <span class="tok-nx">templateUrl</span><span class="tok-o">:</span><span class="tok-s1">&#39;orders/tpl/list.html&#39;</span><span class="tok-p">,</span>
                <span class="tok-nx">controller</span><span class="tok-o">:</span> <span class="tok-s1">&#39;OrdersCtrl&#39;</span>
            <span class="tok-p">})</span>
            <span class="tok-p">.</span><span class="tok-nx">when</span><span class="tok-p">(</span><span class="tok-s1">&#39;/orders/new&#39;</span><span class="tok-p">,</span> <span class="tok-p">{</span>
                <span class="tok-nx">templateUrl</span><span class="tok-o">:</span> <span class="tok-s1">&#39;new-order/tpl/new.html&#39;</span><span class="tok-p">,</span>
                <span class="tok-nx">controller</span><span class="tok-o">:</span> <span class="tok-s1">&#39;NewOrderCtrl&#39;</span>
            <span class="tok-p">})</span>
            <span class="tok-p">.</span><span class="tok-nx">otherwise</span><span class="tok-p">({</span> <span class="tok-nx">redirectTo</span> <span class="tok-o">:</span> <span class="tok-s1">&#39;/orders&#39;</span><span class="tok-p">});</span>
    <span class="tok-p">});</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>Si nos vamos a una de las vistas, por ejemplo <code>orders/tpl/list.html</code> vemos que no se ha introducido la directiva <code>ng-controller</code> al haber definido el controlador en la definición de rutas.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="html"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12</div></td><td class="code"><span class="tok-nt">&lt;h2&gt;</span>Order list<span class="tok-nt">&lt;/h2&gt;</span>
<span class="tok-nt">&lt;div</span> <span class="tok-na">class=</span><span class="tok-s">&quot;row&quot;</span> <span class="tok-na">ng-repeat=</span><span class="tok-s">&quot;order in orders&quot;</span><span class="tok-nt">&gt;</span>
    <span class="tok-nt">&lt;div</span> <span class="tok-na">class=</span><span class="tok-s">&quot;col col-xs-12&quot;</span><span class="tok-nt">&gt;</span>
        <span class="tok-nt">&lt;p&gt;</span>{{ order }}<span class="tok-nt">&lt;/p&gt;</span>
    <span class="tok-nt">&lt;/div&gt;</span>
<span class="tok-nt">&lt;/div&gt;</span>

<span class="tok-nt">&lt;div</span> <span class="tok-na">class=</span><span class="tok-s">&quot;row&quot;</span><span class="tok-nt">&gt;</span>
    <span class="tok-nt">&lt;div</span> <span class="tok-na">class=</span><span class="tok-s">&quot;col col-xs-12&quot;</span><span class="tok-nt">&gt;</span>
        <span class="tok-nt">&lt;a</span> <span class="tok-na">href=</span><span class="tok-s">&quot;#/orders/new&quot;</span> <span class="tok-na">class=</span><span class="tok-s">&quot;btn btn-default&quot;</span><span class="tok-nt">&gt;</span>New order<span class="tok-nt">&lt;/a&gt;</span>
    <span class="tok-nt">&lt;/div&gt;</span>
<span class="tok-nt">&lt;/div&gt;</span>
</td></tr></table></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_rutas_parametrizadas">6.4. Rutas parametrizadas</h3>
<div class="paragraph">
<p>En la aplicación que hemos hecho, utilizamos un sistema de rutas bastante sencillo, que no utiliza ninguna parte variable en la URL.
Sin embargo, hoy en día estamos hartos de ver URLs con partes variables. Los antiguos <em>search parameters</em></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code>/users/edit/id?=1
/users/edit/id?=2
/users/edit/id?=114</code></pre>
</div>
</div>
<div class="paragraph">
<p>Ha pasado de moda, y ahora lo habitual es construir URLs de la forma</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code>/users/edit/1
/users/edit/2
/users/edit/114</code></pre>
</div>
</div>
<div class="paragraph">
<p>Hacer esto con el sistema de <em>routing</em> de AngularJS es bastante sencillo: podemos declarar elementos variables simplemente
poniendo el símbolo de los dos puntos (<code>:</code>) delante de éste. Así, en nuestra aplicación de pedidos, introduciremos una ruta nueva
para ver el detalle de un pedido.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="javascript"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18</div></td><td class="code"><span class="tok-nx">angular</span>
    <span class="tok-p">.</span><span class="tok-nx">module</span><span class="tok-p">(</span><span class="tok-s1">&#39;ordersapp&#39;</span><span class="tok-p">,</span> <span class="tok-p">[</span><span class="tok-s1">&#39;ngRoute&#39;</span><span class="tok-p">])</span>
    <span class="tok-p">.</span><span class="tok-nx">config</span><span class="tok-p">(</span><span class="tok-kd">function</span><span class="tok-p">(</span><span class="tok-nx">$routeProvider</span><span class="tok-p">){</span>
        <span class="tok-nx">$routeProvider</span>
            <span class="tok-p">.</span><span class="tok-nx">when</span><span class="tok-p">(</span><span class="tok-s1">&#39;/orders&#39;</span><span class="tok-p">,</span> <span class="tok-p">{</span>
                <span class="tok-nx">templateUrl</span><span class="tok-o">:</span><span class="tok-s1">&#39;orders/tpl/list.html&#39;</span><span class="tok-p">,</span>
                <span class="tok-nx">controller</span><span class="tok-o">:</span> <span class="tok-s1">&#39;OrdersCtrl&#39;</span>
            <span class="tok-p">})</span>
            <span class="tok-p">.</span><span class="tok-nx">when</span><span class="tok-p">(</span><span class="tok-s1">&#39;/orders/new&#39;</span><span class="tok-p">,</span> <span class="tok-p">{</span>
                <span class="tok-nx">templateUrl</span><span class="tok-o">:</span> <span class="tok-s1">&#39;new-order/tpl/new.html&#39;</span><span class="tok-p">,</span>
                <span class="tok-nx">controller</span><span class="tok-o">:</span> <span class="tok-s1">&#39;NewOrderCtrl&#39;</span>
            <span class="tok-p">})</span>
            <span class="tok-p">.</span><span class="tok-nx">when</span><span class="tok-p">(</span><span class="tok-s1">&#39;/orders/edit/:idx&#39;</span><span class="tok-p">,</span> <span class="tok-p">{</span> <span class="tok-c1">//Ruta parametrizada</span>
                <span class="tok-nx">templateUrl</span><span class="tok-o">:</span> <span class="tok-s1">&#39;view-order/tpl/view.html&#39;</span><span class="tok-p">,</span>
                <span class="tok-nx">controller</span><span class="tok-o">:</span> <span class="tok-s1">&#39;ViewOrderCtrl&#39;</span>
            <span class="tok-p">})</span>
            <span class="tok-p">.</span><span class="tok-nx">otherwise</span><span class="tok-p">({</span> <span class="tok-nx">redirectTo</span> <span class="tok-o">:</span> <span class="tok-s1">&#39;/orders&#39;</span><span class="tok-p">});</span>
    <span class="tok-p">});</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>Para recibir los parámetros en nuestro controlador, deberemos hacer uso del servicio <code>$routeParams</code>. Éste
nos permite recibir todos los parámetros que hayamos pasado a la URL.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="javascript"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3
4
5</div></td><td class="code"><span class="tok-nx">angular</span>
    <span class="tok-p">.</span><span class="tok-nx">module</span><span class="tok-p">(</span><span class="tok-s1">&#39;ordersapp&#39;</span><span class="tok-p">)</span>
    <span class="tok-p">.</span><span class="tok-nx">controller</span><span class="tok-p">(</span><span class="tok-s1">&#39;ViewOrderCtrl&#39;</span><span class="tok-p">,</span> <span class="tok-kd">function</span> <span class="tok-p">(</span><span class="tok-nx">$scope</span><span class="tok-p">,</span> <span class="tok-nx">OrdersService</span><span class="tok-p">,</span> <span class="tok-nx">$routeParams</span><span class="tok-p">){</span>
        <span class="tok-nx">$scope</span><span class="tok-p">.</span><span class="tok-nx">order</span> <span class="tok-o">=</span> <span class="tok-nx">OrdersService</span><span class="tok-p">.</span><span class="tok-nx">getOrder</span><span class="tok-p">(</span><span class="tok-nx">$routeParams</span><span class="tok-p">.</span><span class="tok-nx">idx</span><span class="tok-p">);</span>
    <span class="tok-p">});</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>Lo bueno del servicio <code>$routeParams</code> es que combina los parámetros que llegan tanto por
URL como por <em>search parameters</em>. Con lo cual, hubiera funcionado exactamente igual, y sin tocar nada,
de haber utilizado una url de la forma <code>orders/edit?idx=3</code></p>
</div>
<div class="paragraph">
<p><a href="https://bitbucket.org/alejandro_such/angularjs-routing-examples/src/4124f251b15d83dd793bd0d85df7979faa16bb8a/?at=v3.0">Aquí</a> tenemos el código completo de la aplicación de pedidos.</p>
</div>
</div>
<div class="sect2">
<h3 id="_redirección">6.5. Redirección</h3>
<div class="paragraph">
<p>En el código de ejemplo ya hay bloques que muestran cómo realizar una redirección de una página a otra. No obstante lo mencionaremos más detenidamente, con un par de recomendaciones.</p>
</div>
<div class="sect3">
<h4 id="_desde_una_vista">6.5.1. Desde una vista</h4>
<div class="paragraph">
<p>Para navegar de una ruta a otra desde una vista, lo haremos de manera exactamente igual a como lo haríamos en HTML: con la etiqueta <code>&lt;a&gt;</code>. No obstante,
los destinos irán todos precedidos por el <em>hashbang</em>. Por ejemplo:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="html"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1</div></td><td class="code"><span class="tok-nt">&lt;a</span> <span class="tok-na">href=</span><span class="tok-s">&quot;#/users/list&quot;</span><span class="tok-nt">&gt;</span>Listado de usuarios<span class="tok-nt">&lt;/a&gt;</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>Para referenciar una ruta variable, podemos hacerlo de igual manera, haciendo uso de las variables de AngularJS:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="html"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1</div></td><td class="code"><span class="tok-nt">&lt;a</span> <span class="tok-na">href=</span><span class="tok-s">&quot;#/users/edit/{{user.id}}&quot;</span><span class="tok-nt">&gt;</span>Editar usuario<span class="tok-nt">&lt;/a&gt;</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>Sin embargo, cuando utilizamos código dinámico (variables, funciones, etc.) en un enlace, la manera más correcta de hacerlo es
utilizando la directiva <code>ngHref</code>.</p>
</div>
<div class="paragraph">
<p>En algunas ocasiones al generar el enlace dinámico anterior, podría darse el caso de que el usuario hace clic antes de que AngularJS
haya tenido la oportunidad de establecer el valor dinámico. Al usar la directiva <code>ngHref</code>, AngularJS no establece el valor del atributo
<code>href</code> hasta que ha podido interpretar el valor completo de la cadena. Así, lo que hace es traducir esto:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="html"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1</div></td><td class="code"><span class="tok-nt">&lt;a</span> <span class="tok-na">ng-href=</span><span class="tok-s">&quot;#/users/edit/{{user.id}}&quot;</span><span class="tok-nt">&gt;</span>Editar usuario<span class="tok-nt">&lt;/a&gt;</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>a esto otro:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="html"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1</div></td><td class="code"><span class="tok-nt">&lt;a</span> <span class="tok-na">href=</span><span class="tok-s">&quot;#/users/edit/1&quot;</span><span class="tok-nt">&gt;</span>Editar usuario<span class="tok-nt">&lt;/a&gt;</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>en cuanto tiene la mínima oportunidad.</p>
</div>
</div>
<div class="sect3">
<h4 id="_desde_un_controlador_el_objeto_location">6.5.2. Desde un controlador. El objeto $location</h4>
<div class="paragraph">
<p>En no pocas ocasiones querremos que la redirección se haga en función de que cierta lógica de negocio se haya aplicado correctamente o no.
Esto implica que dicha redirección tenga que hacerse desde un controlador u otro servicio. Para hacerlo desde aquí, recurriremos al servicio
<code>$location</code>.</p>
</div>
<div class="paragraph">
<p>El servicio <code>$location+ <span class="footnote">[<a id="_footnoteref_11" class="footnote" href="#_footnote_11" title="View footnote.">11</a>]</span> parsea la URL de la barra de direcciones del navegador (según los valores de +window.location</code>), y hace que la URL esté
accesible para nuestra aplicación. Todo cambio que se haga en la URL se verá reflejado en el servicio <code>$location</code> y viceversa.</p>
</div>
<div class="paragraph">
<p>El servicio <code>$location</code>:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Expone la URL actual de la barra de direcciones del navegador, para que podamos:</p>
<div class="ulist">
<ul>
<li>
<p>Observar la URL</p>
</li>
<li>
<p>Modificar la URL</p>
</li>
</ul>
</div>
</li>
<li>
<p>Sincroniza la URL de la barra de direcciones del navegador cuando el usuario:</p>
<div class="ulist">
<ul>
<li>
<p>Modifica la barra de direcciones</p>
</li>
<li>
<p>Hace clic en los botones <em>forward</em> o <em>back</em> del navegador (o hace click en un enlace histórico)</p>
</li>
<li>
<p>Hace clic en un enlace.</p>
</li>
</ul>
</div>
</li>
<li>
<p>Representa el objeto URL como un conjunto de métodos:</p>
<div class="ulist">
<ul>
<li>
<p><code>protocol</code>: http, https,&#8230;&#8203;</p>
</li>
<li>
<p><code>host</code>: localhost, dccia.ua.es</p>
</li>
<li>
<p><code>port</code>: 80, 8080, 63342,&#8230;&#8203;</p>
</li>
<li>
<p><code>path</code>: /orders</p>
</li>
<li>
<p><code>search</code></p>
</li>
<li>
<p><code>hash</code></p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="imageblock">
<div class="content">
<img src="img/ses06/servicio_location.jpg" alt="{large-size}">
</div>
</div>
<div class="paragraph">
<p>Estos métodos actúan a la vez como getters y setters, en función de si tienen o no parámetros.
Así hemos podido ver cómo en el controlador <code>NewOrderCtrl</code>, redirigíamos a la página principal
una vez insertado un pedido mediante la orden:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="javascript"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1</div></td><td class="code"><span class="tok-nx">$location</span><span class="tok-p">.</span><span class="tok-nx">path</span><span class="tok-p">(</span><span class="tok-s1">&#39;/orders&#39;</span><span class="tok-p">);</span>
</td></tr></table></code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_ejercicio_1_punto_2">6.6. Ejercicio (1 punto)</h3>
<div class="paragraph">
<p>Modifica el ejemplo de los pedidos para adaptar el carrito de la compra que hemos estado haciendo en las últimas sesiones.</p>
</div>
<div class="paragraph">
<p>Tendremos de igual manera dos pantallas: una de listado (ruta: <code>/list</code>) y otra de detalle de producto (ruta: <code>/detail/:id_producto</code>). La ruta por defecto será la del listado.</p>
</div>
<div class="paragraph">
<p>Como vemos en los siguientes <em>mockups</em>, la cabecera tendrá un título genérico, o bien el nombre del producto. Además, tendrá la cesta de la compra indicando el número de productos y el importe total.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="img/ses06/listado.png" alt="{large-size}">
</div>
</div>
<div class="imageblock">
<div class="content">
<img src="img/ses06/detalle.png" alt="{large-size}">
</div>
</div>
<div class="paragraph">
<p>Aplica el <em>tag</em> <code>ngRoute</code> a la versión que quieres que se corrija.
&lt;&lt;&lt;</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="sesion07">7. Routing con <code>ui-router</code></h2>
<div class="sectionbody">
<div class="paragraph">
<p>Una cosa que puede no parecer muy obvia, es que el routing de URLs puede
considerarse como una máquina de estados finitos. Cuando configuramos las
rutas, estamos definiendo los distintos estados por los que atraviesa nuestra
aplicación, e informando a la aplicación qué debe mostrarse cuando estamos
en una ruta determinada.</p>
</div>
<div class="paragraph">
<p>Hemos visto que AngularJS nos proporciona un mecanismo de routing que, pese
a ser totalmente válido, tiene ciertas limitaciones. Entre ellas, en la clase
anterior hemos visto la necesidad de incluir, en cada una de las vistas, la
cabecera y el pie con directivas <code>ngInclude</code>. Además, las redirecciones se
hacían directamente contra la ruta de manera que, si esta cambia, debemos
ir a cada etiqueta <code>a</code> y cada llamada a <code>$location.path()</code> a modificarla.</p>
</div>
<div class="paragraph">
<p>El módulo <code>ui-rouoter</code> se adapta perfectamente al concepto de routing como
máquina de estados finita. Permite definir estados, y transiciones de un
estado a otro. Además, nos permite desacoplar estados anidados, y gestionar
layouts más complejos de una manera sencilla y elegante.</p>
</div>
<div class="paragraph">
<p>El concepto de routing es un poco distinto, pero a la larga acaba gustando
más que el de <code>ngRoute</code></p>
</div>
<div class="paragraph">
<p>En este capítulo, vamos a modificar la aplicación de pedidos realizada en el
capítulo anterior y adaptarla a <code>ui-router</code>.</p>
</div>
<div class="paragraph">
<p>En nuestra aplicación, identificamos un layout con tres componentes:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Cabecera</p>
</li>
<li>
<p>Cuerpo</p>
</li>
<li>
<p>Pie</p>
</li>
</ul>
</div>
<div class="sect2">
<h3 id="_primeros_cambios_en_la_aplicación">7.1. Primeros cambios en la aplicación</h3>
<div class="paragraph">
<p>Lo primero que haremos será deshacernos del módulo <code>ngRoute</code>, e incluir el
módulo de <code>ui-router</code>, para ello, eliminaremos la línea</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="html"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1</div></td><td class="code"><span class="tok-nt">&lt;script </span><span class="tok-na">src=</span><span class="tok-s">&quot;https://code.angularjs.org/1.2.22/angular-route.js&quot;</span><span class="tok-nt">&gt;&lt;/script&gt;</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>Y en su lugar introduciremos la siguiente:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="html"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1</div></td><td class="code"><span class="tok-nt">&lt;script </span><span class="tok-na">src=</span><span class="tok-s">&quot;//cdnjs.cloudflare.com/ajax/libs/angular-ui-router/0.2.10/angular-ui-router.js&quot;</span><span class="tok-nt">&gt;&lt;/script&gt;</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>Deberemos inyectar, además, el módulo <code>ui.router</code> en nuestra aplicación:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="javascript"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2</div></td><td class="code"><span class="tok-nx">angular</span>
    <span class="tok-p">.</span><span class="tok-nx">module</span><span class="tok-p">(</span><span class="tok-s1">&#39;ordersapp&#39;</span><span class="tok-p">,</span> <span class="tok-p">[</span><span class="tok-s1">&#39;ui.router&#39;</span><span class="tok-p">])</span>
</td></tr></table></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_la_directiva_code_uiview_code">7.2. La directiva <code>uiView</code></h3>
<div class="paragraph">
<p>Al igual que con <code>ngRoute</code> era imprescindible el uso de la directiva <code>ngView</code> para declarar
dónde iba el contenido de cada ruta en la vista, aquí haremos uso de la directiva <code>uiView</code>.</p>
</div>
<div class="paragraph">
<p>Sin embargo, una de las ventajas de <code>ui-router</code> es que nos permite definir más de un bloque
de este tipo, por lo que vamos a definir tres de ellos:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="html"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24</div></td><td class="code"><span class="tok-cp">&lt;!DOCTYPE html&gt;</span>
<span class="tok-nt">&lt;html&gt;</span>
<span class="tok-nt">&lt;head</span> <span class="tok-na">lang=</span><span class="tok-s">&quot;en&quot;</span><span class="tok-nt">&gt;</span>
    <span class="tok-nt">&lt;meta</span> <span class="tok-na">charset=</span><span class="tok-s">&quot;UTF-8&quot;</span><span class="tok-nt">&gt;</span>
    <span class="tok-nt">&lt;title&gt;&lt;/title&gt;</span>
    <span class="tok-nt">&lt;link</span> <span class="tok-na">rel=</span><span class="tok-s">&quot;stylesheet&quot;</span> <span class="tok-na">href=</span><span class="tok-s">&quot;//maxcdn.bootstrapcdn.com/bootstrap/3.2.0/css/bootstrap.min.css&quot;</span><span class="tok-nt">/&gt;</span>
<span class="tok-nt">&lt;/head&gt;</span>
<span class="tok-nt">&lt;body</span> <span class="tok-na">ng-app=</span><span class="tok-s">&quot;ordersapp&quot;</span><span class="tok-nt">&gt;</span>

<span class="tok-nt">&lt;div</span> <span class="tok-na">class=</span><span class="tok-s">&quot;container&quot;</span><span class="tok-nt">&gt;</span>
    <span class="tok-nt">&lt;div</span> <span class="tok-na">ui-view</span> <span class="tok-na">name=</span><span class="tok-s">&quot;header&quot;</span><span class="tok-nt">&gt;&lt;/div&gt;</span>
    <span class="tok-nt">&lt;div</span> <span class="tok-na">ui-view</span> <span class="tok-na">name=</span><span class="tok-s">&quot;content&quot;</span><span class="tok-nt">&gt;&lt;/div&gt;</span>
    <span class="tok-nt">&lt;div</span> <span class="tok-na">ui-view</span> <span class="tok-na">name=</span><span class="tok-s">&quot;footer&quot;</span><span class="tok-nt">&gt;&lt;/div&gt;</span>
<span class="tok-nt">&lt;/div&gt;</span>

<span class="tok-nt">&lt;script </span><span class="tok-na">src=</span><span class="tok-s">&quot;https://code.angularjs.org/1.2.22/angular.js&quot;</span><span class="tok-nt">&gt;&lt;/script&gt;</span>
<span class="tok-nt">&lt;script </span><span class="tok-na">src=</span><span class="tok-s">&quot;//cdnjs.cloudflare.com/ajax/libs/angular-ui-router/0.2.10/angular-ui-router.js&quot;</span><span class="tok-nt">&gt;&lt;/script&gt;</span>
<span class="tok-nt">&lt;script </span><span class="tok-na">src=</span><span class="tok-s">&quot;app.js&quot;</span><span class="tok-nt">&gt;&lt;/script&gt;</span>
<span class="tok-nt">&lt;script </span><span class="tok-na">src=</span><span class="tok-s">&quot;components/services/OrdersService.js&quot;</span><span class="tok-nt">&gt;&lt;/script&gt;</span>
<span class="tok-nt">&lt;script </span><span class="tok-na">src=</span><span class="tok-s">&quot;orders/controllers/OrdersCtrl.js&quot;</span><span class="tok-nt">&gt;&lt;/script&gt;</span>
<span class="tok-nt">&lt;script </span><span class="tok-na">src=</span><span class="tok-s">&quot;new-order/controllers/NewOrderCtrl.js&quot;</span><span class="tok-nt">&gt;&lt;/script&gt;</span>
<span class="tok-nt">&lt;script </span><span class="tok-na">src=</span><span class="tok-s">&quot;view-order/controllers/ViewOrderCtrl.js&quot;</span><span class="tok-nt">&gt;&lt;/script&gt;</span>
<span class="tok-nt">&lt;/body&gt;</span>
<span class="tok-nt">&lt;/html&gt;</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>Al realizar este cambio, vamos a olvidarnos de tener que realizar un <code>ng-include</code> en cada una de las vistas.</p>
</div>
<div class="paragraph">
<p>Al igual que teníamos una plantilla llamada <code>header</code> y otra llamada <code>footer</code>, crearemos ahora una tercera
plantilla, <code>content.html</code>, cuyo contenido será:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="html"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3
4
5</div></td><td class="code"><span class="tok-nt">&lt;div</span> <span class="tok-na">class=</span><span class="tok-s">&quot;row&quot;</span><span class="tok-nt">&gt;</span>
    <span class="tok-nt">&lt;div</span> <span class="tok-na">class=</span><span class="tok-s">&quot;col col-xs-12&quot;</span> <span class="tok-na">ui-view</span><span class="tok-nt">&gt;</span>
        <span class="tok-nt">&lt;h4&gt;</span>Welcome to the orders app<span class="tok-nt">&lt;/h4&gt;</span>
    <span class="tok-nt">&lt;/div&gt;</span>
<span class="tok-nt">&lt;/div&gt;</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>Vemos que éste también tiene una directiva <code>ui-view</code>. En seguida veremos por qué.</p>
</div>
</div>
<div class="sect2">
<h3 id="_definiendo_nuestro_primer_estado">7.3. Definiendo nuestro primer estado</h3>
<div class="paragraph">
<p>Nuestro primer estado se corresponderá con la ruta /orders.</p>
</div>
<div class="paragraph">
<p>Al igual que en el capítulo anterior hacíamos uso del servicio <code>$routeProvider</code> para la
definición de rutas, aquí utilizaremos el servicio <code>$stateProvider</code>, ya que hemos dicho
que consideraremos nuestro sistema de <em>routing</em> como una máquina de estados.</p>
</div>
<div class="paragraph">
<p>Para ello, el servicio $stateProvider dispone de un método llamado <code>state</code>, que recibe
como primer parámetro un nombre de estado (el que nosotros queramos), y como segundo parámetro
un objeto con los atributos:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>url</code>: url del estado que estamos definiendo</p>
</li>
<li>
<p><code>views</code>: objeto que tendrá tantos atributos como directivas <code>ui-view</code> hayamos definido.
En nuestro caso habrá tres (<code>header</code>, <code>content</code>, <code>footer</code>). Al igual que en el caso de <code>ngRoute</code>,
aquí podremos definir el <code>templateUrl</code> para la vista a cargar, y un <code>controller</code> para definir el
controlador que gestionará dicha vista. Como de momento no vamos a querer un controlador, no lo
definimos para ninguna de ellas.</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="javascript"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19</div></td><td class="code"><span class="tok-nx">angular</span>
    <span class="tok-p">.</span><span class="tok-nx">module</span><span class="tok-p">(</span><span class="tok-s1">&#39;ordersapp&#39;</span><span class="tok-p">,</span> <span class="tok-p">[</span><span class="tok-s1">&#39;ui.router&#39;</span><span class="tok-p">])</span>
    <span class="tok-p">.</span><span class="tok-nx">config</span><span class="tok-p">(</span><span class="tok-kd">function</span> <span class="tok-p">(</span><span class="tok-nx">$stateProvider</span><span class="tok-p">)</span> <span class="tok-p">{</span>
        <span class="tok-nx">$stateProvider</span>
            <span class="tok-p">.</span><span class="tok-nx">state</span><span class="tok-p">(</span><span class="tok-s1">&#39;orders&#39;</span><span class="tok-p">,</span> <span class="tok-p">{</span>
                <span class="tok-nx">url</span><span class="tok-o">:</span> <span class="tok-s1">&#39;/orders&#39;</span><span class="tok-p">,</span>
                <span class="tok-nx">views</span><span class="tok-o">:</span> <span class="tok-p">{</span>
                    <span class="tok-nx">header</span><span class="tok-o">:</span> <span class="tok-p">{</span>
                        <span class="tok-nx">templateUrl</span><span class="tok-o">:</span> <span class="tok-s1">&#39;components/templates/common/header.html&#39;</span>
                    <span class="tok-p">},</span>
                    <span class="tok-nx">content</span><span class="tok-o">:</span> <span class="tok-p">{</span>
                        <span class="tok-nx">templateUrl</span><span class="tok-o">:</span> <span class="tok-s1">&#39;components/templates/common/content.html&#39;</span>
                    <span class="tok-p">},</span>
                    <span class="tok-nx">footer</span><span class="tok-o">:</span> <span class="tok-p">{</span>
                        <span class="tok-nx">templateUrl</span><span class="tok-o">:</span> <span class="tok-s1">&#39;components/templates/common/footer.html&#39;</span>
                    <span class="tok-p">}</span>
                <span class="tok-p">}</span>
            <span class="tok-p">});</span>
    <span class="tok-p">});</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>Si vamos a <a href="http://localhost:63342/angularjs-routing-examples/index.html#/orders" class="bare">http://localhost:63342/angularjs-routing-examples/index.html#/orders</a>, veremos que el layout de nuestra aplicación ya está conformado.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="img/ses07/ngroute-orders.png" alt="{large-size}">
</div>
</div>
</div>
<div class="sect2">
<h3 id="_estados_anidados">7.4. Estados anidados</h3>
<div class="paragraph">
<p>Hasta ahora, hemos creado el esqueleto de nuestra aplicación. No vemos dónde está el listado de pedidos. Para ello, definiremos un nuevos estado,
llamado <code>orders.list</code></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="javascript"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3
4
5</div></td><td class="code"><span class="tok-p">.</span><span class="tok-nx">state</span><span class="tok-p">(</span><span class="tok-s1">&#39;orders.list&#39;</span><span class="tok-p">,</span> <span class="tok-p">{</span>
    <span class="tok-nx">url</span><span class="tok-o">:</span> <span class="tok-s1">&#39;/list&#39;</span><span class="tok-p">,</span>
    <span class="tok-nx">controller</span><span class="tok-o">:</span> <span class="tok-s1">&#39;OrdersCtrl&#39;</span><span class="tok-p">,</span>
    <span class="tok-nx">templateUrl</span><span class="tok-o">:</span> <span class="tok-s1">&#39;orders/tpl/list.html&#39;</span>
<span class="tok-p">})</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>Si nos vamos ahora a la URL <a href="http://localhost:63342/angularjs-routing-examples/index.html#/orders/list" class="bare">http://localhost:63342/angularjs-routing-examples/index.html#/orders/list</a>, veremos que ya tenemos el listado de productos
de igual manera que teníamos en el capítulo anterior.</p>
</div>
<div class="paragraph">
<p>A priori, nos llamará la atención varias cosas. La primera de ellas, es que en nuestro estado hemos definido la url como <code>list</code>, y en nuestra aplicación
aparece <code>/orders/list</code> como URL.</p>
</div>
<div class="paragraph">
<p>Esto se debe a que, por definición, todo estado que tenga un nombre dado, precedido por el nombre de otro estado y un punto (<code>orders.list</code>) se considera
un estado anidado (<em>nested state</em>).</p>
</div>
<div class="paragraph">
<p>Un estado anidado hereda todo lo definido en el estado padre. Su URL, además, será composición de la URL del padre, más la URL que en el estado definamos.
Es por ello que la URl es <code>/orders/list</code>. Una gran ventaja que aporta es que, si queremos renombrar la URL a <code>order</code> (por poner un ejemplo), únicamente
debemos hacerlo en un punto. Además, todo el layout del padre se hereda, por eso no hemos tenido que definir la cabecera ni el pie.</p>
</div>
<div class="paragraph">
<p>¿Pero cómo sabe <code>ui-router</code> dónde colocar la vista? Muy sencillo. Si volvemos a ver el código de la plantilla <code>content.html</code> veremos que ahí se había
definido un objeto <code>div</code> con un atributo <code>ui-view</code>. Éste es el punto que aprovecha <code>ui-router</code> para introducir la nueva plantilla, dejando el resto intacto.</p>
</div>
<div class="paragraph">
<p>Además, como a este nivel ya disponemos sólo de un <code>ui-view</code>, no es necesario jugar con el objeto <code>views</code> como habíammos hecho en la definición del estado anterior:
podemos definir el <code>controller</code> (aquí sí que necesitamos ya uno) y el <code>templateUrl</code> a nivel de raíz del objeto.</p>
</div>
<div class="paragraph">
<p>De igual manera, definiremos los estados de creación y detalle:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="javascript"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10</div></td><td class="code"><span class="tok-p">.</span><span class="tok-nx">state</span><span class="tok-p">(</span><span class="tok-s1">&#39;orders.new&#39;</span><span class="tok-p">,</span> <span class="tok-p">{</span>
    <span class="tok-nx">url</span><span class="tok-o">:</span> <span class="tok-s1">&#39;/new&#39;</span><span class="tok-p">,</span>
    <span class="tok-nx">templateUrl</span><span class="tok-o">:</span> <span class="tok-s1">&#39;new-order/tpl/new.html&#39;</span><span class="tok-p">,</span>
    <span class="tok-nx">controller</span><span class="tok-o">:</span> <span class="tok-s1">&#39;NewOrderCtrl&#39;</span>
<span class="tok-p">})</span>
<span class="tok-p">.</span><span class="tok-nx">state</span><span class="tok-p">(</span><span class="tok-s1">&#39;orders.edit&#39;</span><span class="tok-p">,</span> <span class="tok-p">{</span>
    <span class="tok-nx">url</span><span class="tok-o">:</span> <span class="tok-s1">&#39;/edit/:idx&#39;</span><span class="tok-p">,</span>
    <span class="tok-nx">templateUrl</span><span class="tok-o">:</span> <span class="tok-s1">&#39;view-order/tpl/view.html&#39;</span><span class="tok-p">,</span>
    <span class="tok-nx">controller</span><span class="tok-o">:</span> <span class="tok-s1">&#39;ViewOrderCtrl&#39;</span>
<span class="tok-p">})</span>
</td></tr></table></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_definiendo_una_ruta_por_defecto">7.5. Definiendo una ruta por defecto</h3>
<div class="paragraph">
<p>Al igual que con el servicio <code>ngRoute</code> podíamos definir un estado por defecto en caso de no encontrar
ninguna ruta, aquí también lo podemos hacer. Para ello, necesitamos inyectar el servicio <code>$urlRouterProvider</code>
en nuestra función de configuración. Este servicio dispone de un método <code>otherwise</code>,
que recibe como parámetro la URL destino a la que redirigir en caso de no haber resuelto ninguna.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="javascript"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3
4
5
6
7
8</div></td><td class="code"><span class="tok-nx">angular</span>
    <span class="tok-p">.</span><span class="tok-nx">module</span><span class="tok-p">(</span><span class="tok-s1">&#39;ordersapp&#39;</span><span class="tok-p">,</span> <span class="tok-p">[</span><span class="tok-s1">&#39;ui.router&#39;</span><span class="tok-p">])</span>
    <span class="tok-p">.</span><span class="tok-nx">config</span><span class="tok-p">(</span><span class="tok-kd">function</span> <span class="tok-p">(</span><span class="tok-nx">$stateProvider</span><span class="tok-p">,</span> <span class="tok-nx">$urlRouterProvider</span><span class="tok-p">)</span> <span class="tok-p">{</span>

        <span class="tok-c1">// DEFINICIÓN DE ESTADOS</span>

        <span class="tok-nx">$urlRouterProvider</span><span class="tok-p">.</span><span class="tok-nx">otherwise</span><span class="tok-p">(</span><span class="tok-s1">&#39;/orders/list&#39;</span><span class="tok-p">);</span>
    <span class="tok-p">});</span>
</td></tr></table></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_estados_abstractos">7.6. Estados abstractos</h3>
<div class="paragraph">
<p>Puede que os hayáis preguntado si realmente es necesario tener una ruta <code>/orders</code> que sea accesible
desde el navegador. Efectivamente, esta ruta nos ha valido para conformar el <em>layout</em> inicial y no la
necesitamos para nada más, ya que no aporta nada en absoluto. El módulo <code>ui-router</code> contempla este caso,
y nos permite definir el estado <code>orders</code> como un estado abstracto. Al igual que una clase java, un estado
abstracto no puede generarse por sí sólo, sino a través de alguna de las clases que lo extienden.
Podemos declarar un estado como abstracto añadiéndole el atributo <code>abstract:true</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="javascript"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15</div></td><td class="code"><span class="tok-p">.</span><span class="tok-nx">state</span><span class="tok-p">(</span><span class="tok-s1">&#39;orders&#39;</span><span class="tok-p">,</span> <span class="tok-p">{</span>
    <span class="tok-kr">abstract</span><span class="tok-o">:</span> <span class="tok-kc">true</span><span class="tok-p">,</span>
    <span class="tok-nx">url</span><span class="tok-o">:</span> <span class="tok-s1">&#39;/orders&#39;</span><span class="tok-p">,</span>
    <span class="tok-nx">views</span><span class="tok-o">:</span> <span class="tok-p">{</span>
        <span class="tok-nx">header</span><span class="tok-o">:</span> <span class="tok-p">{</span>
            <span class="tok-nx">templateUrl</span><span class="tok-o">:</span> <span class="tok-s1">&#39;components/templates/common/header.html&#39;</span>
        <span class="tok-p">},</span>
        <span class="tok-nx">content</span><span class="tok-o">:</span> <span class="tok-p">{</span>
            <span class="tok-nx">templateUrl</span><span class="tok-o">:</span> <span class="tok-s1">&#39;components/templates/common/content.html&#39;</span>
        <span class="tok-p">},</span>
        <span class="tok-nx">footer</span><span class="tok-o">:</span> <span class="tok-p">{</span>
            <span class="tok-nx">templateUrl</span><span class="tok-o">:</span> <span class="tok-s1">&#39;components/templates/common/footer.html&#39;</span>
        <span class="tok-p">}</span>
    <span class="tok-p">}</span>
<span class="tok-p">})</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>Si intentamos ir ahora a <a href="http://localhost:63342/angularjs-routing-examples/index.html#/orders" class="bare">http://localhost:63342/angularjs-routing-examples/index.html#/orders</a>, veremos que la
URL no se resuelve correctamente, con lo que seremos redirigidos al estado definido en <code>$urlRouterProvider.otherwise</code>.</p>
</div>
</div>
<div class="sect2">
<h3 id="_recepción_de_parámetros_en_el_controlador">7.7. Recepción de parámetros en el controlador</h3>
<div class="paragraph">
<p>Para la recepción de parámetros en un controlador utilizaremos el servicio <code>$stateParams</code>, que funciona de igual manera
que el servicio <code>routeParams</code>. Así, nuestro cambios en el controlador <code>ViewOrderCtrl</code> serán m��nimos.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="javascript"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3
4
5</div></td><td class="code"><span class="tok-nx">angular</span>
    <span class="tok-p">.</span><span class="tok-nx">module</span><span class="tok-p">(</span><span class="tok-s1">&#39;ordersapp&#39;</span><span class="tok-p">)</span>
    <span class="tok-p">.</span><span class="tok-nx">controller</span><span class="tok-p">(</span><span class="tok-s1">&#39;ViewOrderCtrl&#39;</span><span class="tok-p">,</span> <span class="tok-kd">function</span> <span class="tok-p">(</span><span class="tok-nx">$scope</span><span class="tok-p">,</span> <span class="tok-nx">OrdersService</span><span class="tok-p">,</span> <span class="tok-nx">$stateParams</span><span class="tok-p">){</span>
        <span class="tok-nx">$scope</span><span class="tok-p">.</span><span class="tok-nx">order</span> <span class="tok-o">=</span> <span class="tok-nx">OrdersService</span><span class="tok-p">.</span><span class="tok-nx">getOrder</span><span class="tok-p">(</span><span class="tok-nx">$stateParams</span><span class="tok-p">.</span><span class="tok-nx">idx</span><span class="tok-p">);</span>
    <span class="tok-p">});</span>
</td></tr></table></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_redirección_2">7.8. Redirección</h3>
<div class="paragraph">
<p>A nivel de redirección, tendremos que hacer unos cambios mayores. En <code>ui-router</code>, en lugar de la ruta, indicaremos al estado al
que queremos realizar la transición. Es muy fácil querer cambiar el nombre de una ruta. Sin embargo, los estados tienen una nomenclatura
con un significado semántico, que no querremos cambiar. Ahora, si decidimos traducir nuestras URLs a español, sólo tendremos que hacerlo
a nivel de configuración.</p>
</div>
<div class="sect3">
<h4 id="_desde_una_vista_2">7.8.1. Desde una vista</h4>
<div class="paragraph">
<p>Desde una vista, cambiaremos nuestros <code>ng-href="route"</code> por <code>ui-sref="state"</code>.</p>
</div>
<div class="paragraph">
<p>En caso de incluir parámetros, añadiremos un objeto con el nombre de el(los) parámetro(s).</p>
</div>
<div class="paragraph">
<p>Por ejemplo, la plantilla <code>orders/tpl/list.html</code> quedará:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="html"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14</div></td><td class="code"><span class="tok-nt">&lt;div&gt;</span>
    <span class="tok-nt">&lt;h2&gt;</span>Order list<span class="tok-nt">&lt;/h2&gt;</span>
    <span class="tok-nt">&lt;div</span> <span class="tok-na">class=</span><span class="tok-s">&quot;row&quot;</span> <span class="tok-na">ng-repeat=</span><span class="tok-s">&quot;order in orders&quot;</span><span class="tok-nt">&gt;</span>
        <span class="tok-nt">&lt;div</span> <span class="tok-na">class=</span><span class="tok-s">&quot;col col-xs-12&quot;</span><span class="tok-nt">&gt;</span>
            <span class="tok-nt">&lt;p&gt;</span>{{ order }} <span class="tok-nt">&lt;a</span> <span class="tok-na">ui-sref=</span><span class="tok-s">&quot;orders.edit({idx:$index})&quot;</span><span class="tok-nt">&gt;</span>[Edit]<span class="tok-nt">&lt;/a&gt;&lt;/p&gt;</span>
        <span class="tok-nt">&lt;/div&gt;</span>
    <span class="tok-nt">&lt;/div&gt;</span>

    <span class="tok-nt">&lt;div</span> <span class="tok-na">class=</span><span class="tok-s">&quot;row&quot;</span><span class="tok-nt">&gt;</span>
        <span class="tok-nt">&lt;div</span> <span class="tok-na">class=</span><span class="tok-s">&quot;col col-xs-12&quot;</span><span class="tok-nt">&gt;</span>
            <span class="tok-nt">&lt;a</span> <span class="tok-na">ui-sref=</span><span class="tok-s">&quot;orders.new&quot;</span> <span class="tok-na">class=</span><span class="tok-s">&quot;btn btn-default&quot;</span><span class="tok-nt">&gt;</span>New order<span class="tok-nt">&lt;/a&gt;</span>
        <span class="tok-nt">&lt;/div&gt;</span>
    <span class="tok-nt">&lt;/div&gt;</span>
<span class="tok-nt">&lt;/div&gt;</span>
</td></tr></table></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_desde_un_controlador">7.8.2. Desde un controlador</h4>
<div class="paragraph">
<p>Desde un controlador, haremos uso del servicio <code>state</code>, que dispone del método <code>go(stateName)</code>.
La variación a realizar sobre el controlador <code>NewOrderCtrl</code> sería:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="javascript"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10</div></td><td class="code"><span class="tok-nx">angular</span>
    <span class="tok-p">.</span><span class="tok-nx">module</span><span class="tok-p">(</span><span class="tok-s1">&#39;ordersapp&#39;</span><span class="tok-p">)</span>
    <span class="tok-p">.</span><span class="tok-nx">controller</span><span class="tok-p">(</span><span class="tok-s1">&#39;NewOrderCtrl&#39;</span><span class="tok-p">,</span> <span class="tok-kd">function</span> <span class="tok-p">(</span><span class="tok-nx">$scope</span><span class="tok-p">,</span> <span class="tok-nx">OrdersService</span><span class="tok-p">,</span> <span class="tok-nx">$state</span><span class="tok-p">)</span> <span class="tok-p">{</span>
        <span class="tok-nx">$scope</span><span class="tok-p">.</span><span class="tok-nx">order</span> <span class="tok-o">=</span> <span class="tok-kc">null</span><span class="tok-p">;</span>

        <span class="tok-nx">$scope</span><span class="tok-p">.</span><span class="tok-nx">saveOrder</span> <span class="tok-o">=</span> <span class="tok-kd">function</span><span class="tok-p">(){</span>
            <span class="tok-nx">OrdersService</span><span class="tok-p">.</span><span class="tok-nx">addOrder</span><span class="tok-p">(</span><span class="tok-nx">$scope</span><span class="tok-p">.</span><span class="tok-nx">order</span><span class="tok-p">);</span>
            <span class="tok-nx">$state</span><span class="tok-p">.</span><span class="tok-nx">go</span><span class="tok-p">(</span><span class="tok-s1">&#39;orders.list&#39;</span><span class="tok-p">);</span>
        <span class="tok-p">};</span>
    <span class="tok-p">});</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>En caso de querer redirigir a una ruta con parámetros, los pasaremos en un objeto JSON:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="javascript"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1</div></td><td class="code"><span class="tok-nx">$state</span><span class="tok-p">.</span><span class="tok-nx">go</span><span class="tok-p">(</span><span class="tok-s1">&#39;orders.list&#39;</span><span class="tok-p">,</span> <span class="tok-p">{</span><span class="tok-nx">idx</span><span class="tok-o">:</span> <span class="tok-mi">0</span><span class="tok-p">});</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p><a href="https://bitbucket.org/alejandro_such/angularjs-routing-examples/src/44799f9217ea37318564eae04194481d70eb43e0/?at=v4.0">Aquí</a> tenéis
acceso al código de la aplicación de pedidos modificada y adaptada a <code>ui-router</code>.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_ejercicio_1_punto_3">7.9. Ejercicio (1 punto)</h3>
<div class="paragraph">
<p>Adapta el ejemplo de la sesión anterior para utilizar ui-router.</p>
</div>
<div class="paragraph">
<p>Aplica el <em>tag</em> <code>uiRouter</code> a la versión que quieres que se corrija.
&lt;&lt;&lt;</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="sesion08">8. Formularios y validación</h2>
<div class="sectionbody">
<div class="paragraph">
<p>AngularJS se basa en formularios HTML e inputs estándar. Esto quiere decir que podemos seguir creando nuestra UI a partir de los mismos elementos que ya conocemos, usando herramientas de desarrollo HTML estándar.</p>
</div>
<div class="sect2">
<h3 id="_comparando_formullarios_tradicionales_con_formularios_en_angularjs">8.1. Comparando formullarios tradicionales con formularios en AngularJS</h3>
<div class="paragraph">
<p>Vamos a ver cómo funcionan los formularios en AngularJS, y cómo éste modifica y extiende el comportamiento de los inputs de HTML, y cómo gestiona las actualizaciones del modelo. También veremos las directivas de validación incluidas en el <em>core</em> de AngularJS, para finalmente crear nuestras propias directivas de validación.</p>
</div>
<div class="paragraph">
<p>En un formulario HTML estándar, el valor de un input es el valor que se enviará al servidor al ejecutarse la acción <em>submit</em> del formulario.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="img/ses08/forms001.png" alt="{large-size}">
</div>
</div>
<div class="paragraph">
<p>El problema es que a veces, no queremos trabajar con los datos tal y como se muestran en el formulario. Por ejemplo, podríamos querer mostrar una fecha formateada (ej: 14 de julio de 2.012), pero lo más seguro es que queramos trabajar con un objeto JavaScript de tipo Date. Tener que realizar estas transformaciones constantemente es algo muy tedioso, y puede conducir a errores.</p>
</div>
<div class="paragraph">
<p>Al desacoplar el modelo de la vista en AngularJS, no nos tenemos que preocupar del valor del modelo cuando éste cambia en la vista, ni del tipo de dato cuando trabajamos con él en un controlador.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="img/ses08/forms002.png" alt="{large-size}">
</div>
</div>
<div class="paragraph">
<p>Esto se consigue a través de las directivas <code>form</code> e <code>input</code>, así como con las directivas de validación y los controladores. Estas directivas de validación sobreescriben el comportamiento por defecto de los formularios HTML. Sin embargo, mirando su código, vemos que son prácticamente iguales que los formularios HTML estándar.</p>
</div>
<div class="paragraph">
<p>En primer lugar, la directiva <code>ngModel</code> nos permite definir cómo los <code>input</code> se deben asociar (<em>bind</em>) al modelo.</p>
</div>
<div class="paragraph">
<p>Hemos visto cómo AngularJS crea un databinding entre los campos del objeto <code>scope</code> y los elementos HTML en la página, usando dobles llaves <code>{{}}</code> y la directiva <code>ngBind</code>, que explicaremos ahora haciendo un inciso.</p>
</div>
<div class="sect3">
<h4 id="_la_directiva_code_ngbind_code">8.1.1. La directiva <code>ngBind</code></h4>
<div class="paragraph">
<p>En algunos navegadores, podemos experimentar cierto "parpadeo" de valores en AngularJS. Esto se debe a que primero se carga el HTML y luego el código AngualrJS. De este modo, es posible que veamos las variables entre llaves antes que sus valores.</p>
</div>
<div class="paragraph">
<p>A este fenómeno se le conoce como PRF (<em>Pre-Render Flickering</em>). Para evitarlo, se introdujo la directiva <code>ngBind</code>.</p>
</div>
<div class="paragraph">
<p>Para hacer uso de ella sólo tenemos que añadir el atributo <code>ng-bind</code> a un elemento, y escribir una expresión dentro de éste. Por ejemplo, en lugar de:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="html"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1</div></td><td class="code"><span class="tok-nt">&lt;h1&gt;</span>{{model.header.title}}<span class="tok-nt">&lt;/h1&gt;</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>podemos usar:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="html"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1</div></td><td class="code"><span class="tok-nt">&lt;h1</span> <span class="tok-na">ng-bind=</span><span class="tok-s">&quot;model.header.title&quot;</span><span class="tok-nt">&gt;&lt;/h1&gt;</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>Si en nuestro html no teníamos ningún elemento para nuestro texto, siempre podemos utilizar un <code>&lt;span&gt;</code> para introducir ahí nuestra expresión. Como véis, es igual de sencillo que usar los corchetes dobles, y ayuda a prevenir el PRF.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_continuemos">8.2. Continuemos</h3>
<div class="paragraph">
<p>Como decíamos, ya sabemos cómo se realiza el databinding con la doble llave o la directiva <code>ngBind</code>. Estas técnicas sólo permiten el <em>binding</em> en una dirección (<em>one-way binding</em>). Para asociar el valor de una directiva <code>input</code>, y así conseguir un <em>two-way data binding</em> usamos, además, la directiva <code>ngModel</code>. Veamos el siguiente ejemplo <span class="footnote">[<a id="_footnoteref_12" class="footnote" href="#_footnote_12" title="View footnote.">12</a>]</span>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="html"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11</div></td><td class="code"><span class="tok-nt">&lt;div</span> <span class="tok-na">ng-app=</span><span class="tok-s">&quot;databinding&quot;</span> <span class="tok-na">ng-controller=</span><span class="tok-s">&quot;MainCtrl&quot;</span><span class="tok-nt">&gt;</span>
  <span class="tok-nt">&lt;div&gt;</span>
    Hola, {{name}}!
  <span class="tok-nt">&lt;/div&gt;</span>
  <span class="tok-nt">&lt;div&gt;</span>
    Hola, <span class="tok-nt">&lt;span</span> <span class="tok-na">ng-bind=</span><span class="tok-s">&quot;name&quot;</span><span class="tok-nt">&gt;&lt;/span&gt;</span>!
  <span class="tok-nt">&lt;/div&gt;</span>
  <span class="tok-nt">&lt;div&gt;</span>
    <span class="tok-nt">&lt;label&gt;</span>Nombre: <span class="tok-nt">&lt;input</span> <span class="tok-na">type=</span><span class="tok-s">&quot;text&quot;</span> <span class="tok-na">ng-model=</span><span class="tok-s">&quot;name&quot;</span> <span class="tok-nt">/&gt;&lt;/label&gt;</span>
  <span class="tok-nt">&lt;/div&gt;</span>
<span class="tok-nt">&lt;/div&gt;</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="javascript"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3
4
5</div></td><td class="code"><span class="tok-nx">angular</span>
  <span class="tok-p">.</span><span class="tok-nx">module</span><span class="tok-p">(</span><span class="tok-s1">&#39;databinding&#39;</span><span class="tok-p">,</span> <span class="tok-p">[])</span>
  <span class="tok-p">.</span><span class="tok-nx">controller</span><span class="tok-p">(</span><span class="tok-s1">&#39;MainCtrl&#39;</span><span class="tok-p">,</span> <span class="tok-kd">function</span><span class="tok-p">(</span><span class="tok-nx">$scope</span><span class="tok-p">){</span>
    <span class="tok-nx">$scope</span><span class="tok-p">.</span><span class="tok-nx">name</span> <span class="tok-o">=</span> <span class="tok-s1">&#39;Alejandro&#39;</span><span class="tok-p">;</span>
  <span class="tok-p">})</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>En los dos primeros <code>div</code>, <em>bindamos</em> el atributo <code>name</code> del <code>scope</code> con dobles llaves, mientras que en el segundo lo hacemos a través de la directiva <code>ng-bind</code>. Este <em>binding</em> se realiza únicamente en una dirección: si cambiamos el valor de <code>scope.name</code> en el controlador, éste cambiará en la vista. Sin embargo, no hay manera de cambiarlo en la vista y que esto afecte al controlador.</p>
</div>
<div class="paragraph">
<p>Sin embargo, en el último div, AngularJS <em>binda</em> el valor de <code>scope.name</code> al del elemento <code>input</code>, a través de la directiva <code>ngModel</code>. Aquí es donde se realiza un <em>two-way data binding</em>. Se puede observar sencillamente ya que, si modificamos el valor del input, los otros dos elementos modifican el texto.</p>
</div>
<div class="paragraph">
<p>Además, veremos que AngularJS permite que las directivas transformen y validen los valores de <code>ngModel</code> en el momento que se realiza el paso de valores de la vista al controlador.</p>
</div>
</div>
<div class="sect2">
<h3 id="_creando_un_formulario_de_registro">8.3. Creando un formulario de registro</h3>
<div class="paragraph">
<p>Para tratar estos temas, vamos a crear un formulario de registro, que tendrá los siguientes campos y restricciones.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Nombre. Requerido. Longitud mínima de 3 caracteres y máxima de 25.</p>
</li>
<li>
<p>Apellidos. Requerido. Mínimo dos palabras</p>
</li>
<li>
<p>Email. Requerido. Email válido</p>
</li>
<li>
<p>Sexo. Requerido. Será un selector de tipo <code>radio</code>.</p>
</li>
<li>
<p>Website. Requerido. Deberá ser una URL válida.</p>
</li>
<li>
<p>Provincia. Requerido. Será un selector de tipo <code>select</code>.</p>
</li>
<li>
<p>Suscripción a newsletter. Opcional. Tipo <code>checkbox</code>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Nuestra primera aproximación sería la siguiente <span class="footnote">[<a id="_footnoteref_13" class="footnote" href="#_footnote_13" title="View footnote.">13</a>]</span>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="html"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46</div></td><td class="code"><span class="tok-nt">&lt;div</span> <span class="tok-na">ng-app=</span><span class="tok-s">&quot;formExample&quot;</span> <span class="tok-na">ng-controller=</span><span class="tok-s">&quot;mainCtrl&quot;</span><span class="tok-nt">&gt;</span>

  <span class="tok-nt">&lt;form</span> <span class="tok-na">ng-submit=</span><span class="tok-s">&quot;&quot;</span><span class="tok-nt">&gt;</span>
    <span class="tok-nt">&lt;div&gt;</span>
      <span class="tok-nt">&lt;label&gt;</span>
        nombre: <span class="tok-nt">&lt;input</span> <span class="tok-na">type=</span><span class="tok-s">&quot;text&quot;</span> <span class="tok-na">ng-model=</span><span class="tok-s">&quot;user.name&quot;</span> <span class="tok-nt">/&gt;</span>
      <span class="tok-nt">&lt;/label&gt;</span>
    <span class="tok-nt">&lt;/div&gt;</span>
    <span class="tok-nt">&lt;div&gt;</span>
      <span class="tok-nt">&lt;label&gt;</span>
        apellidos: <span class="tok-nt">&lt;input</span> <span class="tok-na">type=</span><span class="tok-s">&quot;text&quot;</span> <span class="tok-na">ng-model=</span><span class="tok-s">&quot;user.lastName&quot;</span> <span class="tok-nt">/&gt;</span>
      <span class="tok-nt">&lt;/label&gt;</span>
    <span class="tok-nt">&lt;/div&gt;</span>
    <span class="tok-nt">&lt;div&gt;</span>
      <span class="tok-nt">&lt;label&gt;</span>
        email: <span class="tok-nt">&lt;input</span> <span class="tok-na">type=</span><span class="tok-s">&quot;text&quot;</span> <span class="tok-na">ng-model=</span><span class="tok-s">&quot;user.email&quot;</span> <span class="tok-nt">/&gt;</span>
      <span class="tok-nt">&lt;/label&gt;</span>
    <span class="tok-nt">&lt;/div&gt;</span>
    <span class="tok-nt">&lt;div&gt;</span>
      sexo:
      <span class="tok-nt">&lt;label&gt;</span>
        hombre <span class="tok-nt">&lt;input</span> <span class="tok-na">type=</span><span class="tok-s">&quot;radio&quot;</span> <span class="tok-na">value=</span><span class="tok-s">&quot;h&quot;</span> <span class="tok-na">ng-model=</span><span class="tok-s">&quot;user.sex&quot;</span> <span class="tok-nt">/&gt;</span>
      <span class="tok-nt">&lt;/label&gt;</span>
      <span class="tok-nt">&lt;label&gt;</span>
        mujer <span class="tok-nt">&lt;input</span> <span class="tok-na">type=</span><span class="tok-s">&quot;radio&quot;</span> <span class="tok-na">value=</span><span class="tok-s">&quot;m&quot;</span> <span class="tok-na">ng-model=</span><span class="tok-s">&quot;user.sex&quot;</span> <span class="tok-nt">/&gt;</span>
      <span class="tok-nt">&lt;/label&gt;</span>
    <span class="tok-nt">&lt;/div&gt;</span>
    <span class="tok-nt">&lt;div&gt;</span>
      <span class="tok-nt">&lt;label&gt;</span>website: <span class="tok-nt">&lt;input</span> <span class="tok-na">type=</span><span class="tok-s">&quot;text&quot;</span> <span class="tok-na">ng-model=</span><span class="tok-s">&quot;user.website&quot;</span> <span class="tok-nt">/&gt;&lt;/label&gt;</span>
    <span class="tok-nt">&lt;/div&gt;</span>
    <span class="tok-nt">&lt;div&gt;</span>
      provincia:
      <span class="tok-nt">&lt;select</span> <span class="tok-na">ng-model=</span><span class="tok-s">&quot;user.province&quot;</span><span class="tok-nt">&gt;</span>
        <span class="tok-nt">&lt;option</span> <span class="tok-na">value=</span><span class="tok-s">&quot;12&quot;</span><span class="tok-nt">&gt;</span>Castellón<span class="tok-nt">&lt;/option&gt;</span>
        <span class="tok-nt">&lt;option</span> <span class="tok-na">value=</span><span class="tok-s">&quot;46&quot;</span><span class="tok-nt">&gt;</span>Valencia<span class="tok-nt">&lt;/option&gt;</span>
        <span class="tok-nt">&lt;option</span> <span class="tok-na">value=</span><span class="tok-s">&quot;03&quot;</span><span class="tok-nt">&gt;</span>Alicante<span class="tok-nt">&lt;/option&gt;</span>
      <span class="tok-nt">&lt;/select&gt;</span>
    <span class="tok-nt">&lt;/div&gt;</span>
    <span class="tok-nt">&lt;div&gt;</span>
      <span class="tok-nt">&lt;label&gt;</span>
        suscribirse a la newsletter <span class="tok-nt">&lt;input</span> <span class="tok-na">type=</span><span class="tok-s">&quot;checkbox&quot;</span> <span class="tok-na">ng-model=</span><span class="tok-s">&quot;user.newsletter&quot;</span> <span class="tok-nt">/&gt;</span>
      <span class="tok-nt">&lt;/label&gt;</span>
    <span class="tok-nt">&lt;/div&gt;</span>
  <span class="tok-nt">&lt;/form&gt;</span>
  <span class="tok-nt">&lt;pre</span> <span class="tok-na">ng-bind=</span><span class="tok-s">&quot;user | json&quot;</span><span class="tok-nt">&gt;&lt;/pre&gt;</span>
<span class="tok-nt">&lt;/div&gt;</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="sect3">
<h4 id="_campos_requeridos">8.3.1. Campos requeridos</h4>
<div class="paragraph">
<p>Usaremos la directiva <code>ngRequired</code> (o simplemente <code>required</code>) para especificar aquellos campos  obligatorios. Así, todos aquellos campos cuyo valor sea <code>null</code>, <code>undefined</code> o una cadena vacía serán inválidos. Por ejemplo, el campo nombre es uno de los campos obligatorios:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="html"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1</div></td><td class="code"><span class="tok-nt">&lt;input</span> <span class="tok-na">type=</span><span class="tok-s">&quot;text&quot;</span> <span class="tok-na">ng-model=</span><span class="tok-s">&quot;user.name&quot;</span> <span class="tok-na">required</span> <span class="tok-nt">/&gt;</span>
</td></tr></table></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_tamaño_mínimo_y_máximo">8.3.2. Tamaño mínimo y máximo</h4>
<div class="paragraph">
<p>En el campo nombre, también habíamos definido un tamaño mínimo y máximo. Esto lo conseguimos gracias a las directivas <code>ngMinlength</code> y <code>ngMaxLength</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="html"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1</div></td><td class="code"><span class="tok-nt">&lt;input</span> <span class="tok-na">type=</span><span class="tok-s">&quot;text&quot;</span> <span class="tok-na">ng-model=</span><span class="tok-s">&quot;user.name&quot;</span> <span class="tok-na">required</span> <span class="tok-na">ng-minlength=</span><span class="tok-s">&quot;3&quot;</span> <span class="tok-na">ng-maxlength=</span><span class="tok-s">&quot;25&quot;</span> <span class="tok-nt">/&gt;</span>
</td></tr></table></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_expresiones_regulares">8.3.3. Expresiones regulares</h4>
<div class="paragraph">
<p>Por su parte, el campo <em>apellidos</em>, además de ser obligatorio, tenía la restricción de que debía contar, al menos con dos palabras. Podemos definir esta restricción de manera sencilla con expresiones regulares. La directiva <code>ngPattern</code> se encarga de validar que un elemento cumpla con una expresión regular determinada:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="html"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1</div></td><td class="code"><span class="tok-nt">&lt;input</span> <span class="tok-na">type=</span><span class="tok-s">&quot;text&quot;</span> <span class="tok-na">ng-model=</span><span class="tok-s">&quot;user.lastName&quot;</span> <span class="tok-na">required</span> <span class="tok-na">ng-pattern=</span><span class="tok-s">&quot;/^\w+(\s\w`)`$/&quot;</span> <span class="tok-nt">/&gt;</span>
</td></tr></table></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_email">8.3.4. Email</h4>
<div class="paragraph">
<p>La validación de emails es muy sencilla. Simplemente debemos cambiar el <code>input type="text"</code> por <code>input type="email"</code>. AngularJS ya se encargará realizar las validaciones necesarias para este tipo:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="html"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1</div></td><td class="code"><span class="tok-nt">&lt;input</span> <span class="tok-na">type=</span><span class="tok-s">&quot;email&quot;</span> <span class="tok-na">ng-model=</span><span class="tok-s">&quot;user.email&quot;</span> <span class="tok-na">required</span> <span class="tok-nt">/&gt;</span>
</td></tr></table></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_radio_buttons">8.3.5. Radio buttons</h4>
<div class="paragraph">
<p>Los <code>radiobuttons</code> proporcionan un grupo fijo de opciones para un campo. Son muy sencillos de implemntar. Sólo hay que asociar los <code>radiobutton</code> de un mismo grupo al mismo modelo. Se usará el atributo estándar <code>value</code> para determinar qué valor pasar al modelo. Así, el valor de sexo será:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="html"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3
4
5
6
7
8
9</div></td><td class="code"><span class="tok-nt">&lt;div&gt;</span>
  sexo:
  <span class="tok-nt">&lt;label&gt;</span>
    hombre <span class="tok-nt">&lt;input</span> <span class="tok-na">type=</span><span class="tok-s">&quot;radio&quot;</span> <span class="tok-na">value=</span><span class="tok-s">&quot;h&quot;</span> <span class="tok-na">ng-model=</span><span class="tok-s">&quot;user.sex&quot;</span> <span class="tok-na">required</span> <span class="tok-nt">/&gt;</span>
  <span class="tok-nt">&lt;/label&gt;</span>
  <span class="tok-nt">&lt;label&gt;</span>
    mujer <span class="tok-nt">&lt;input</span> <span class="tok-na">type=</span><span class="tok-s">&quot;radio&quot;</span> <span class="tok-na">value=</span><span class="tok-s">&quot;m&quot;</span> <span class="tok-na">ng-model=</span><span class="tok-s">&quot;user.sex&quot;</span> <span class="tok-na">required</span> <span class="tok-nt">/&gt;</span>
  <span class="tok-nt">&lt;/label&gt;</span>
<span class="tok-nt">&lt;/div&gt;</span>
</td></tr></table></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_urls">8.3.6. URLs</h4>
<div class="paragraph">
<p>Al igual que el <code>type="email"</code>, también disponemos de un <code>type="url"</code> para que la validación de URLs sea lo más sencilla posible:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="html"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1</div></td><td class="code"><span class="tok-nt">&lt;input</span> <span class="tok-na">type=</span><span class="tok-s">&quot;url&quot;</span> <span class="tok-na">ng-model=</span><span class="tok-s">&quot;user.website&quot;</span> <span class="tok-na">required</span> <span class="tok-nt">/&gt;&lt;/label&gt;</span>
</td></tr></table></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_selectores">8.3.7. Selectores</h4>
<div class="paragraph">
<p>La directiva <code>select</code> nos permite crear una <em>drop-down list</em> desde la que el usuario puede seleccionar uno o varios ítems. AngularJS nos permite especificar estas opciones de manera estática, como en un <code>select</code> HTML estándar, o de manera dinámica a partir de un array.</p>
</div>
<div class="paragraph">
<p>De hecho, es muy normal el uso de un array de objetos. Aquí para simplificar, hemos utilizado las tres provincias de la Comunidad Valenciana. Sería normal introducir las 50 provincias de España (más las dos ciudades autónomas de Ceuta y Melilla) a partir de los datos proporcionados por un servicio. Para simplificarlo, vamos a suponer que ya las tenemos en nuestro controlador:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="javascript"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3
4
5</div></td><td class="code"><span class="tok-nx">$scope</span><span class="tok-p">.</span><span class="tok-nx">provinces</span> <span class="tok-o">=</span>  <span class="tok-p">[</span>
  <span class="tok-p">{</span> <span class="tok-nx">name</span> <span class="tok-o">:</span> <span class="tok-s1">&#39;Castellón&#39;</span><span class="tok-p">,</span> <span class="tok-nx">code</span> <span class="tok-o">:</span> <span class="tok-s1">&#39;12&#39;</span><span class="tok-p">},</span>
  <span class="tok-p">{</span> <span class="tok-nx">name</span> <span class="tok-o">:</span> <span class="tok-s1">&#39;Valencia&#39;</span><span class="tok-p">,</span> <span class="tok-nx">code</span> <span class="tok-o">:</span> <span class="tok-s1">&#39;46&#39;</span><span class="tok-p">},</span>
  <span class="tok-p">{</span> <span class="tok-nx">name</span> <span class="tok-o">:</span> <span class="tok-s1">&#39;Alicante&#39;</span><span class="tok-p">,</span> <span class="tok-nx">code</span> <span class="tok-o">:</span> <span class="tok-s1">&#39;03&#39;</span><span class="tok-p">}</span>
<span class="tok-p">];</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>Para <em>bindar</em> el valor de este array a un elemento <code>select</code> tenemos que asociarle el atributo <code>ng-options</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="html"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3</div></td><td class="code"><span class="tok-nt">&lt;select</span> <span class="tok-na">ng-model=</span><span class="tok-s">&quot;user.province&quot;</span> <span class="tok-na">required</span> <span class="tok-na">ng-options=</span><span class="tok-s">&quot;province.code as province.name for province in provinces&quot;</span><span class="tok-nt">&gt;</span>
  <span class="tok-nt">&lt;option</span> <span class="tok-na">value=</span><span class="tok-s">&quot;&quot;</span><span class="tok-nt">&gt;</span>-- Seleccione una opción --<span class="tok-nt">&lt;/option&gt;</span>
<span class="tok-nt">&lt;/select&gt;</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>En el ejemplo, estamos iterarndo el array de provincias. El valor que se asocia al modelo es el código de provincia. Sin embargo, la opción que se muestra es el nombre de dicha provincia. Además, establecemos un valor vacío por defecto, con <code>option value=""</code></p>
</div>
<div class="paragraph">
<p>Aunque esta es la forma más habitual de trabajar con un <code>select</code> en AngularJS, éste nos permite hacerlo de muchas más maneras. La ayuda de AngularJS<span class="footnote">[<a id="_footnoteref_14" class="footnote" href="#_footnote_14" title="View footnote.">14</a>]</span>, nos explica cómo hacerlo de todas las maneras posibles cuando esta fuente es un array de cadenas, o un array de objetos.</p>
</div>
</div>
<div class="sect3">
<h4 id="_checkboxes">8.3.8. Checkboxes</h4>
<div class="paragraph">
<p>Un <code>checkbox</code> no ex más que un valor booleano. En nuestro formulario, la directiva <code>input</code> le asociará el valor <code>true</code> o <code>false</code> al modelo en función de si está marcado o no. En caso de estar marcado, suscribiremos a nuestro usuario al boletín de noticias.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="html"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1</div></td><td class="code"><span class="tok-nt">&lt;input</span> <span class="tok-na">type=</span><span class="tok-s">&quot;checkbox&quot;</span> <span class="tok-na">ng-model=</span><span class="tok-s">&quot;user.newsletter&quot;</span> <span class="tok-nt">/&gt;</span>
</td></tr></table></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_probando_el_formulario_con_las_nuevas_restricciones">8.3.9. Probando el formulario con las nuevas restricciones</h4>
<div class="paragraph">
<p>Si probamos ahora el formulario<span class="footnote">[<a id="_footnoteref_15" class="footnote" href="#_footnote_15" title="View footnote.">15</a>]</span>, con las restricciones de validación que hemos añadido, veremos en el elemento <code>&lt;pre&gt;</code> que el objeto adquiere valores cuando superamos dichas restricciones.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_mejorando_la_experiencia_mobile">8.4. Mejorando la experiencia mobile</h3>
<div class="paragraph">
<p>Hemos visto el uso de ciertas directivas para validación de URLs, fechas o emails que cambiaban el atributo <code>type</code> de nuestros <code>inputs</code>. Esto tiene una ventaja adicional: usar estos tipos mejoran la experiencia de uso cuando empleamos dispositivos móviles, ya que permiten que el usuario se evite presionar varias veces el teclado para pulsar botones que debería tener a mano. Esto se debe a que el layout del teclado de nuestros móviles se adapta al tipo de <code>input</code> que estamos definiendo. Y, si estamos usando AngularJS, tenemos la ventaja que que la validación del tipo de dato está garantizada.</p>
</div>
<div class="paragraph">
<p>Ya hemos visto algunos, pero hay más que merece la pena conocer. Repasémoslos todos.</p>
</div>
<div class="sect3">
<h4 id="_text">8.4.1. text</h4>
<div class="paragraph">
<p>El tipo estándar que ya conocemos todos.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="img/ses08/text.png" alt="{large-size}">
</div>
</div>
</div>
<div class="sect3">
<h4 id="_email_2">8.4.2. email</h4>
<div class="paragraph">
<p>Muchas veces habremos visto lo incómodo que es introducir un email en nuestro móvil, porque la <code>@</code> siempre está oculta. Esto se soluciona con el <code>type="email"</code>, ya que la hace visible. En muchos casos, además, hace que el teclado muestre directamente un botón <code>.com</code>, ya que es la extensión más habitual.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="img/ses08/email.png" alt="{large-size}">
</div>
</div>
</div>
<div class="sect3">
<h4 id="_tel">8.4.3. tel</h4>
<div class="paragraph">
<p>El <code>type="tel"</code> abre un teclado numérico, permitiendo al usuario introducir un número de teléfono, y los caracteres típicos asociados a los teléfonos.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="img/ses08/tel.png" alt="{large-size}">
</div>
</div>
</div>
<div class="sect3">
<h4 id="_number_2">8.4.4. number</h4>
<div class="paragraph">
<p>Nos permite introducir números y símbolos.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="img/ses08/number.png" alt="{large-size}">
</div>
</div>
</div>
<div class="sect3">
<h4 id="_password">8.4.5. password</h4>
<div class="paragraph">
<p>Conocido por todos, oculta los caracteres de una contraseña de la vista de curiosos.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="img/ses08/password.png" alt="{large-size}">
</div>
</div>
</div>
<div class="sect3">
<h4 id="_date_2">8.4.6. date</h4>
<div class="paragraph">
<p>Ya no nos tendremos que preocupar en nuestros móviles de componentes de tipo calendario, ya que el <code>type="date"</code> nos muestra, en el teclado nativo de nuestro dispositivo, un selector de fechas muy cómodo de utilizar.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="img/ses08/date.png" alt="{large-size}">
</div>
</div>
</div>
<div class="sect3">
<h4 id="_month">8.4.7. month</h4>
<div class="paragraph">
<p>El <code>type="month"</code> es similar al <code>date</code>, permitiéndonos seleccionar un mes y un año.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="img/ses08/month.png" alt="{large-size}">
</div>
</div>
</div>
<div class="sect3">
<h4 id="_datetime">8.4.8. datetime</h4>
<div class="paragraph">
<p>Otro selector de fechas, esta vez más completo ya que el <code>type="datetime"</code> nos permite seleccionar una fecha y una hora.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="img/ses08/datetime.png" alt="{large-size}">
</div>
</div>
</div>
<div class="sect3">
<h4 id="_search">8.4.9. search</h4>
<div class="paragraph">
<p>El <code>input type="search"</code> reemplaza el botón <em><strong>ok</strong></em> de nuestros teclados por un botón <em><strong>buscar</strong></em>.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="img/ses08/search.png" alt="{large-size}">
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_el_controlador_code_ngmodelcontroller_code">8.5. El controlador <code>ngModelController</code></h3>
<div class="paragraph">
<p>Cada directiva <code>ngModel</code> crea una instancia de <code>ngModelController</code>. Se trata de un controlador que estará disponible en todas las directivas asociadas al elemento <code>input</code></p>
</div>
<div class="imageblock">
<div class="content">
<img src="img/ses08/ngModelCtrl1.png" alt="{large-size}">
</div>
</div>
<div class="paragraph">
<p>El controlador <code>ngModelController</code> es el encargado de gestionar el <em>data binding</em> entre el valor almacenado en la el modelo, y el que se muestra en el elemento <code>input</code>.</p>
</div>
<div class="paragraph">
<p>Además, el <code>ngModelController</code> se encarga de determinar que el valor de la vista es válido, y si el <code>input</code> lo ha modificado para actualizar el modelo.</p>
</div>
<div class="paragraph">
<p>Para esta actualización, sigue un <em>pipeline</em> de transformaciones que se producen cada vez que se actualiza el <em>data binding</em>. Este <em>pipeline</em> consiste en dos arrays:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>$formatters</code>: transforman el dato del modelo a la vista. Tengamos en cuenta que los inputs sólo entienden datos de tipo texto, mientras que los datos en el modelo pueden ser objetos complejos.</p>
</li>
<li>
<p><code>$parsers</code>: transforman los datos de la vista a objetos del modelo.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Cualquier directiva que creemos, puede añadir sus propios <code>parsers</code> y <code>formatters</code> al <em>pipeline</em> para modificar lo que ocurre en el <em>data binding</em>. En la siguiente imagen podemos ver cómo afecta el uso de las directivas <code>date</code> y <code>required</code>. La directiva <code>date</code> parsea y formatea las fechas, mientras que la directiva <code>required</code> se asegura que no falte el valor.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="img/ses08/ngModelCtrl2.png" alt="{large-size}">
</div>
</div>
<div class="sect3">
<h4 id="_seguimiento_de_cambios_en_el_modelo">8.5.1. Seguimiento de cambios en el modelo</h4>
<div class="paragraph">
<p>Además de transformar el valor entre el modelo y la vista el <code>ngModelController</code> realiza un seguimiento de cambios.</p>
</div>
<div class="paragraph">
<p>Cuando se inicializa por primera vez, el <code>ngModelController</code> marca el valor como <code>pristine</code> (limpio, no modificado). Además, añade al <code>input</code> la clase CSS <code>.ng-pristine</code>. Una vez cambia el valor en la vista, se marca como <code>dirty</code>, y la clase <code>.ng-pristine</code> se substituye por <code>.ng-dirty</code>.</p>
</div>
<div class="paragraph">
<p>Gracias a estos estilos CSS, podemos cambiar la apariencia de nuestros elementos <code>input</code> en función de si el usuario ha introducido datos o no.</p>
</div>
<div class="paragraph">
<p>Las siguientes reglas de CSS hacen el elemento más grueso cuando introducimos datos en un input:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="css"><span class="tok-nc">.ng-pristine</span> <span class="tok-p">{</span> <span class="tok-k">border</span><span class="tok-o">:</span> <span class="tok-m">1px</span> <span class="tok-k">solid</span> <span class="tok-nb">black</span> <span class="tok-p">;</span> <span class="tok-p">}</span>

<span class="tok-nc">.ng-dirty</span> <span class="tok-p">{</span> <span class="tok-k">border</span><span class="tok-o">:</span> <span class="tok-m">3px</span> <span class="tok-k">solid</span> <span class="tok-nb">black</span><span class="tok-p">;</span> <span class="tok-p">}</span></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_seguimiento_de_la_validez_del_dato">8.5.2. Seguimiento de la validez del dato</h4>
<div class="paragraph">
<p>Al igual que podemos realizar un <em>tracking</em> de cambios sobre el modelo, también lo podemos hacer sobre un dato válido o no.</p>
</div>
<div class="paragraph">
<p>De manera análoga a como hacía para los valores modificados o no, el <code>ngModelController</code> introduce las clases CSS <code>.ng-valid</code> y <code>.ng-invalid</code> cuando la validación de un elemento es correcta o no.</p>
</div>
<div class="paragraph">
<p>Por ejemplo, para marcar de verde o rojo los elementos modificados en función de su validez, utilizaremos las siguientes reglas CSS:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="css"><span class="tok-nc">.ng-valid.ng-dirty</span> <span class="tok-p">{</span>
  <span class="tok-k">border</span><span class="tok-o">:</span> <span class="tok-m">3px</span> <span class="tok-k">solid</span> <span class="tok-nb">green</span><span class="tok-p">;</span>
<span class="tok-p">}</span>

<span class="tok-nc">.ng-invalid.ng-dirty</span> <span class="tok-p">{</span>
  <span class="tok-k">border</span><span class="tok-o">:</span> <span class="tok-m">3px</span> <span class="tok-k">solid</span> <span class="tok-nb">red</span><span class="tok-p">;</span>
<span class="tok-p">}</span></code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_el_controlador_code_ngformcontroller_code">8.6. El controlador <code>ngFormController</code></h3>
<div class="paragraph">
<p>Al igual que cada <code>ng-model</code> genera un <code>ngModelController</code>, todo elemento <code>form</code> genera un controlador <code>ngFormController</code>. Éste hace uso de todos los <code>ngModelController</code> en su interior y determina si el formulario está <code>pristine</code> o <code>dirty</code>, así como <code>valid</code> o <code>invalid</code>.</p>
</div>
<div class="paragraph">
<p>Esto es posible porque, cuando se crea un <code>ngModelController</code>, éste busca un formulario en el árbol del DOM, y se registra en el primero que encuentra. Así, el <code>ngFormController</code> sabe a qué directivas debe realizar un seguimiento.</p>
</div>
<div class="sect3">
<h4 id="_dando_nombres_a_los_elementos">8.6.1. Dando nombres a los elementos</h4>
<div class="paragraph">
<p>Podemos conseguir que el <code>ngFormController</code> aparezca en el scope, simplemente dándole un nombre al formularios. Además, si damos nombre a todos los elementos <code>input</code> que tengan una directiva <code>ngModelController</code>, éstos aparecerán como propiedades del objeto <code>ngModelController</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="html"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1</div></td><td class="code"><span class="tok-nt">&lt;form</span> <span class="tok-na">ng-submit=</span><span class="tok-s">&quot;submitAction()&quot;</span> <span class="tok-na">name=</span><span class="tok-s">&quot;userForm&quot;</span><span class="tok-nt">&gt;</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="html"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1</div></td><td class="code"><span class="tok-nt">&lt;input</span> <span class="tok-na">type=</span><span class="tok-s">&quot;email&quot;</span> <span class="tok-na">ng-model=</span><span class="tok-s">&quot;user.email&quot;</span> <span class="tok-na">required</span> <span class="tok-na">name=</span><span class="tok-s">&quot;userEmail&quot;</span> <span class="tok-nt">/&gt;</span>
</td></tr></table></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_validación_programática">8.6.2. Validación programática</h4>
<div class="paragraph">
<p>Al tener los objetos <code>ngModelController</code> y <code>ngFormController</code> en el <code>scope</code>, podemos trabajar con el estado del formulario de maner programática, usando los valores <code>$dirty</code> e <code>$invalid</code> para cambiar lo que está habilitado o visible para el usuario.</p>
</div>
<div class="paragraph">
<p>Por ejemplo, podemos hacer uso de la directiva `ng-class`<span class="footnote">[<a id="_footnoteref_16" class="footnote" href="#_footnote_16" title="View footnote.">16</a>]</span> para mostrar los elementos que no son válidos:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="css"><span class="tok-nc">.invalidelement</span> <span class="tok-p">{</span> <span class="tok-k">border</span><span class="tok-o">:</span> <span class="tok-m">1px</span> <span class="tok-k">solid</span> <span class="tok-m">#f00</span><span class="tok-p">;</span> <span class="tok-p">}</span>
<span class="tok-nc">.validelement</span> <span class="tok-p">{</span> <span class="tok-k">border</span><span class="tok-o">:</span> <span class="tok-m">1px</span> <span class="tok-k">solid</span> <span class="tok-m">#0f0</span><span class="tok-p">;</span> <span class="tok-p">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Aunque podemos hacerlo directamente en la vista:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="html"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3</div></td><td class="code"><span class="tok-nt">&lt;label&gt;</span>
  nombre:
  <span class="tok-nt">&lt;input</span> <span class="tok-na">type=</span><span class="tok-s">&quot;text&quot;</span> <span class="tok-na">ng-model=</span><span class="tok-s">&quot;user.name&quot;</span> <span class="tok-na">required</span> <span class="tok-na">ng-minlength=</span><span class="tok-s">&quot;3&quot;</span> <span class="tok-na">ng-maxlength=</span><span class="tok-s">&quot;25&quot;</span> <span class="tok-na">name=</span><span class="tok-s">&quot;userName&quot;</span> <span class="tok-na">ng-class=</span><span class="tok-s">&quot;{ &#39;invalidelement&#39; : userForm.userName.$invalid, &#39;validelement&#39; : userForm.userName.$valid }&quot;</span> <span class="tok-nt">/&gt;</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>Es más adecuado y duplicamos menos código llevando esta funcionalidad al controlador:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="javascript"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3
4
5
6</div></td><td class="code"><span class="tok-nx">$scope</span><span class="tok-p">.</span><span class="tok-nx">getCssClasses</span>  <span class="tok-o">=</span> <span class="tok-kd">function</span><span class="tok-p">(</span><span class="tok-nx">ngModelCtrl</span><span class="tok-p">){</span>
  <span class="tok-k">return</span> <span class="tok-p">{</span>
    <span class="tok-nx">invalidelement</span><span class="tok-o">:</span> <span class="tok-nx">ngModelCtrl</span><span class="tok-p">.</span><span class="tok-nx">$invalid</span> <span class="tok-o">&amp;&amp;</span> <span class="tok-nx">ngModelCtrl</span><span class="tok-p">.</span><span class="tok-nx">$dirty</span><span class="tok-p">,</span>
    <span class="tok-nx">validelement</span><span class="tok-o">:</span> <span class="tok-nx">ngModelCtrl</span><span class="tok-p">.</span><span class="tok-nx">$valid</span> <span class="tok-o">&amp;&amp;</span> <span class="tok-nx">ngModelCtrl</span><span class="tok-p">.</span><span class="tok-nx">$dirty</span>
  <span class="tok-p">};</span>
<span class="tok-p">};</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="html"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3
4</div></td><td class="code"><span class="tok-nt">&lt;label&gt;</span>
  nombre:
  <span class="tok-nt">&lt;input</span> <span class="tok-na">type=</span><span class="tok-s">&quot;text&quot;</span> <span class="tok-na">ng-model=</span><span class="tok-s">&quot;user.name&quot;</span> <span class="tok-na">required</span> <span class="tok-na">ng-minlength=</span><span class="tok-s">&quot;3&quot;</span> <span class="tok-na">ng-maxlength=</span><span class="tok-s">&quot;25&quot;</span> <span class="tok-na">name=</span><span class="tok-s">&quot;userName&quot;</span> <span class="tok-na">ng-class=</span><span class="tok-s">&quot;getCssClasses(userForm.userName)&quot;</span> <span class="tok-nt">/&gt;</span>
<span class="tok-nt">&lt;/label&gt;</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>Para mostrar los errores de validación, haremos uso de la directiva <code>ngShow</code> <span class="footnote">[<a id="_footnoteref_17" class="footnote" href="#_footnote_17" title="View footnote.">17</a>]</span>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="javascript"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3</div></td><td class="code"><span class="tok-nx">$scope</span><span class="tok-p">.</span><span class="tok-nx">showError</span> <span class="tok-o">=</span> <span class="tok-kd">function</span><span class="tok-p">(</span><span class="tok-nx">ngModelCtrl</span><span class="tok-p">,</span> <span class="tok-nx">error</span><span class="tok-p">)</span> <span class="tok-p">{</span>
  <span class="tok-k">return</span> <span class="tok-nx">ngModelCtrl</span><span class="tok-p">.</span><span class="tok-nx">$error</span><span class="tok-p">[</span><span class="tok-nx">error</span><span class="tok-p">];</span>
<span class="tok-p">};</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="html"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14</div></td><td class="code">  <span class="tok-nt">&lt;div&gt;</span>
      <span class="tok-nt">&lt;label&gt;</span>
        nombre: <span class="tok-nt">&lt;input</span> <span class="tok-na">type=</span><span class="tok-s">&quot;text&quot;</span> <span class="tok-na">ng-model=</span><span class="tok-s">&quot;user.name&quot;</span> <span class="tok-na">required</span> <span class="tok-na">ng-minlength=</span><span class="tok-s">&quot;3&quot;</span> <span class="tok-na">ng-maxlength=</span><span class="tok-s">&quot;25&quot;</span> <span class="tok-na">name=</span><span class="tok-s">&quot;userName&quot;</span> <span class="tok-na">ng-class=</span><span class="tok-s">&quot;getCssClasses(userForm.userName)&quot;</span> <span class="tok-nt">/&gt;</span>
      <span class="tok-nt">&lt;/label&gt;</span>
      <span class="tok-nt">&lt;span</span> <span class="tok-na">ng-show=</span><span class="tok-s">&quot;showError(userForm.userName, &#39;required&#39;)&quot;</span><span class="tok-nt">&gt;</span>
        Campo obligatorio
      <span class="tok-nt">&lt;/span&gt;</span>
      <span class="tok-nt">&lt;span</span> <span class="tok-na">ng-show=</span><span class="tok-s">&quot;showError(userForm.userName, &#39;minlength&#39;)&quot;</span><span class="tok-nt">&gt;</span>
        Longitud mínima: 3
      <span class="tok-nt">&lt;/span&gt;</span>
      <span class="tok-nt">&lt;span</span> <span class="tok-na">ng-show=</span><span class="tok-s">&quot;showError(userForm.userName, &#39;maxlength&#39;)&quot;</span><span class="tok-nt">&gt;</span>
        Longitud máxima: 25
      <span class="tok-nt">&lt;/span&gt;</span>
    <span class="tok-nt">&lt;/div&gt;</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>En <a href="http://codepen.io/alexsuch/pen/fJgaK" class="bare">http://codepen.io/alexsuch/pen/fJgaK</a> tenemos un ejemplo funcionando con todas las validaciones y comprobaciones del formulario. Además, en él también hemos introducido un botón para enviar el formulario. Sin embargo no nos interesará enviarlo a menos que estén todos los campos correctamente introducidos. Es por ello que haremos uso de la directiva <code>ngDisabled</code> <span class="footnote">[<a id="_footnoteref_18" class="footnote" href="#_footnote_18" title="View footnote.">18</a>]</span> para deshabilitar el botón si el formulario no es válido.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="html"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1</div></td><td class="code"><span class="tok-nt">&lt;button</span> <span class="tok-na">type=</span><span class="tok-s">&quot;submit&quot;</span> <span class="tok-na">ng-disabled=</span><span class="tok-s">&quot;userForm.$invalid&quot;</span><span class="tok-nt">&gt;</span>Registrar<span class="tok-nt">&lt;/button&gt;</span>
</td></tr></table></code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_ejercicio_0_5_puntos">8.7. Ejercicio (0.5 puntos)</h3>
<div class="paragraph">
<p>Aplica el <em>tag</em> <code>form</code> a la versión que quieres que se corrija.</p>
</div>
<div class="paragraph">
<p>Crea una nueva ruta en nuestra página del carrito, llamada <code>/edit/:productId</code>, donde mostraremos un formulario donde editar nuestro producto. Tendrá los campos:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Marca. Texto obligatorio. Longitud máxima: 55 caracteres.</p>
</li>
<li>
<p>Modelo. Texto obligatorio. Longitud máxima: 255 caracteres.</p>
</li>
<li>
<p>Precio. Número obligatorio. Mínimo: 0. Máximo: 999.</p>
</li>
<li>
<p>Descripción: Texto obligatorio. Debe contener al menos dos palabras y terminar en punto. Utilizaremos expresiones regulares para validarlo.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>El formulario tendrá un botón <em>Guardar</em>, que estará deshabilitado mientras algún ítem del formulario sea incorrecto. Cuando se válido, se añadirá el ítem al listado de productos.
&lt;&lt;&lt;</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="sesion09">9. Custom directives</h2>
<div class="sectionbody">
<div class="paragraph">
<p>A lo largo de los distintos capítulos hemos visto que casi todo lo que utilizamos en nuestras plantillas HTML es una directiva. Las directivas son los elementos que nos permiten extender el DOM, generando componentes con el comportamiento que nosotros queramos.</p>
</div>
<div class="paragraph">
<p>Aunque AngularJS trae un conjunto de directivas muy potente en su <em>core</em>, en alguna ocasion querremos crear elementos con cierta funcionalidad propia y reusable. En este capítulo veremos cómo podemos hacerlo a través de la creación de nuevas directivas.</p>
</div>
<div class="sect2">
<h3 id="_definiendo_nuevas_directivas">9.1. Definiendo nuevas directivas</h3>
<div class="paragraph">
<p>Podemos definir nuevas directivas gracias al método <code>directive()</code>, que nos proporciona un <code>module</code> de AngularJS. La definición es similar a como ya hemos visto para controladores, filtros o servicios. El nombre de la directiva debe definirse en <em>camelCase</em>, y la función debe devolver un objeto, conocido como <em>Directive Definition Object</em> (DDO).</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>En nuestro código javascript, definiremos nuestra directiva en <em>camelCase</em> (ej: <code>youtubeVideo</code>). Sin embargo en nuestras plantillas tendremos cada palabra separada por guiones (ej: <code>youtubeVideo</code> pasa a convertirse en <code>youtube-video</code>)</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_nuestra_primera_directiva">9.2. Nuestra primera directiva</h3>
<div class="paragraph">
<p>Vamos a crear una directiva muy sencilla, cuya etiqueta será <code>login-button</code>. En ella, haciendo clic en el botón de login, seríamos redirigidos a la página de login de nuestra aplicación:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="html"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3</div></td><td class="code"><span class="tok-nt">&lt;div</span> <span class="tok-na">ng-app=</span><span class="tok-s">&quot;directives1&quot;</span><span class="tok-nt">&gt;</span>
 <span class="tok-nt">&lt;login-button&gt;&lt;/login-button&gt;</span>
<span class="tok-nt">&lt;/div&gt;</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>Al introducir esta directiva en nuestro módulo, AngularJS compilará el HTML e invocará esta directiva. El <strong>DDO</strong> de la directiva es:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="javascript"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3
4
5
6
7
8</div></td><td class="code"><span class="tok-nx">angular</span>
 <span class="tok-p">.</span><span class="tok-nx">module</span><span class="tok-p">(</span><span class="tok-s1">&#39;directives1&#39;</span><span class="tok-p">,</span> <span class="tok-p">[])</span>
 <span class="tok-p">.</span><span class="tok-nx">directive</span><span class="tok-p">(</span><span class="tok-s1">&#39;loginButton&#39;</span><span class="tok-p">,</span> <span class="tok-kd">function</span><span class="tok-p">(){</span>
  <span class="tok-k">return</span> <span class="tok-p">{</span>
   <span class="tok-nx">restrict</span> <span class="tok-o">:</span> <span class="tok-s1">&#39;E&#39;</span><span class="tok-p">,</span>
   <span class="tok-nx">template</span> <span class="tok-o">:</span> <span class="tok-s1">&#39;&lt;a class=&quot;btn btn-primary btn-lg&quot; ng-href=&quot;#/login&quot;&gt;&lt;span class=&quot;glyphicon glyphicon-log-in&quot;&gt;&lt;/span&gt; Acceder&lt;/a&gt;&#39;</span>
  <span class="tok-p">}</span>
 <span class="tok-p">});</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>Inspeccionando el código de la aplicación<span class="footnote">[<a id="_footnoteref_19" class="footnote" href="#_footnote_19" title="View footnote.">19</a>]</span>, vemos que el contenido de la etiqueta se ha reemplazado por el atributo <code>template</code> de nuestro DDO.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="html"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10</div></td><td class="code"><span class="tok-nt">&lt;body&gt;</span>
 <span class="tok-nt">&lt;div</span> <span class="tok-na">ng-app=</span><span class="tok-s">&quot;directives1&quot;</span> <span class="tok-na">class=</span><span class="tok-s">&quot;ng-scope&quot;</span><span class="tok-nt">&gt;</span>
  <span class="tok-nt">&lt;login-button&gt;</span>
   <span class="tok-nt">&lt;a</span> <span class="tok-na">class=</span><span class="tok-s">&quot;btn btn-primary btn-lg&quot;</span> <span class="tok-na">ng-href=</span><span class="tok-s">&quot;#/login&quot;</span> <span class="tok-na">href=</span><span class="tok-s">&quot;#/login&quot;</span><span class="tok-nt">&gt;</span>
    <span class="tok-nt">&lt;span</span> <span class="tok-na">class=</span><span class="tok-s">&quot;glyphicon glyphicon-log-in&quot;</span><span class="tok-nt">&gt;&lt;/span&gt;</span>
    Acceder
   <span class="tok-nt">&lt;/a&gt;</span>
  <span class="tok-nt">&lt;/login-button&gt;</span>
 <span class="tok-nt">&lt;/div&gt;</span>
<span class="tok-nt">&lt;/body&gt;</span>
</td></tr></table></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_el_atributo_code_restrict_code">9.3. El atributo <code>restrict</code></h3>
<div class="paragraph">
<p>Hemos visto que la directiva <code>loginButton</code> consiste en una etiqueta HTML. Esto se debe al valor del atributo <code>restrict</code>. Éste acepta los siguientes valores:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>E</code> para elementos: <code>&lt;login-button&gt;&lt;/login-button&gt;</code>.</p>
</li>
<li>
<p><code>A</code> para atributos: <code>&lt;span login-button&gt;&lt;/span&gt;</code>.</p>
</li>
<li>
<p><code>C</code> para clases: <code>&lt;div class="login-button"&gt;&lt;/div&gt;</code>.</p>
</li>
<li>
<p><code>M</code> para comentarios: <code>&lt;!-- directive: login-button -&#8594;</code>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Pero una directiva no tiene por qué ser de un tipo únicamente. Podemos definir varios tipos el atributo <code>restrict</code>. En el siguiente ejemplo<span class="footnote">[<a id="_footnoteref_20" class="footnote" href="#_footnote_20" title="View footnote.">20</a>]</span>, nuestra directiva será capaz de funcionar como atributo, elemento o clase.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="javascript"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1</div></td><td class="code"><span class="tok-nx">restrict</span> <span class="tok-o">:</span> <span class="tok-s1">&#39;EAC&#39;</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="html"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3
4
5</div></td><td class="code"><span class="tok-nt">&lt;login-button&gt;&lt;/login-button&gt;</span>

<span class="tok-nt">&lt;div</span> <span class="tok-na">login-button</span><span class="tok-nt">&gt;&lt;/div&gt;</span>

<span class="tok-nt">&lt;div</span> <span class="tok-na">class=</span><span class="tok-s">&quot;login-button&quot;</span><span class="tok-nt">&gt;&lt;/div&gt;</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Aunque disponemos de estas cuatro maneras de crear directivas, la declaración que mejor compatibilidad tienen con todos los navegadores es <code>A</code> (atributo).</p>
</div>
<div class="paragraph">
<p>Como os habréis imaginado, cuando hablamos de problemas con navegadores estamos haciendo una referencia indirecta a Internet Explorer. <a href="https://docs.angularjs.org/guide/ie">Aquí</a> hay cierta información de los problemas de compatibilidad de las directivas con algunas versiones de Internet explorer y cómo solventarlas.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_paso_de_datos_a_la_directiva">9.4. Paso de datos a la directiva</h3>
<div class="paragraph">
<p>Nuestra directiva <code>loginButton</code> está muy bien. Sin embargo, no todas las aplicaciones tienen el acceso en la ruta <code>#/login</code>. Además, si quisiéramos internacionalizar nuestra aplicación, tampoco sería recomendable poner la palabra <em>Acceso</em> allí donde la hemos puesto.</p>
</div>
<div class="paragraph">
<p>Quizá sería mejor refactorizar nuestra directiva para que soporte estas posibilidades, y pasarle estos datos como atributos de la siguiente manera:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="html"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3
4</div></td><td class="code"><span class="tok-nt">&lt;div</span> <span class="tok-na">login-button</span>
 <span class="tok-na">login-path=</span><span class="tok-s">&quot;#/login&quot;</span>
 <span class="tok-na">login-text=</span><span class="tok-s">&quot;Área de usuario&quot;</span><span class="tok-nt">&gt;</span>
<span class="tok-nt">&lt;/div&gt;</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>Aunque podríamos haber cogido estos datos directamente del <code>$scope</code> o <code>$rootScope</code>, esto puede acarrear problemas si el dato se elimina. Para solucionar esto, Angular nos permite crear un <em>scope</em> hijo, o lo que se conoce como un <em>isolate scope</em>. Este segundo está completamente separado del <em>scope</em> padre en el DOM, y se crea de una manera sencilla: simplemente definiremos un atributo <code>scope</code> en nuestro DDO<span class="footnote">[<a id="_footnoteref_21" class="footnote" href="#_footnote_21" title="View footnote.">21</a>]</span>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="javascript"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14</div></td><td class="code"><span class="tok-nx">angular</span>
 <span class="tok-p">.</span><span class="tok-nx">module</span><span class="tok-p">(</span><span class="tok-s1">&#39;directives3&#39;</span><span class="tok-p">,</span> <span class="tok-p">[])</span>
 <span class="tok-p">.</span><span class="tok-nx">directive</span><span class="tok-p">(</span><span class="tok-s1">&#39;loginButton&#39;</span><span class="tok-p">,</span> <span class="tok-kd">function</span><span class="tok-p">(){</span>
  <span class="tok-k">return</span> <span class="tok-p">{</span>
   <span class="tok-nx">restrict</span> <span class="tok-o">:</span> <span class="tok-s1">&#39;A&#39;</span><span class="tok-p">,</span>

   <span class="tok-nx">scope</span><span class="tok-o">:</span> <span class="tok-p">{</span>
    <span class="tok-nx">loginPath</span> <span class="tok-o">:</span> <span class="tok-s1">&#39;@&#39;</span><span class="tok-p">,</span>
    <span class="tok-nx">loginText</span> <span class="tok-o">:</span> <span class="tok-s1">&#39;@&#39;</span>
   <span class="tok-p">},</span>

   <span class="tok-nx">template</span> <span class="tok-o">:</span> <span class="tok-s1">&#39;&lt;a class=&quot;btn btn-primary btn-lg&quot; ng-href=&quot;{{loginPath}}&quot;&gt;&lt;span class=&quot;glyphicon glyphicon-log-in&quot;&gt;&lt;/span&gt; {{loginText}}&lt;/a&gt;&#39;</span>
  <span class="tok-p">}</span>
 <span class="tok-p">});</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>Vemos cómo hemos introducido un objeto <code>scope</code>, y además hemos modificado el <code>template</code> para hacer <em>binding</em> con las variables definidas en él.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Vemos que la convención camelCase se mantiene también para los atributos del <em>scope</em>.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>La convención de nombrado por defectoes que el atributo y la propiedad del <code>scope</code> se llamen igual. En algunas ocasiones podríamos querer que la variable del scope tuviese un nombre distinto. Para ello especificaríamos los nombres de la siguiente manera:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="javascript"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3
4</div></td><td class="code"><span class="tok-nx">scope</span> <span class="tok-o">:</span> <span class="tok-p">{</span>
 <span class="tok-nx">loginPath</span> <span class="tok-o">:</span> <span class="tok-s1">&#39;@uri&#39;</span><span class="tok-p">,</span>
 <span class="tok-nx">loginText</span> <span class="tok-o">:</span> <span class="tok-s1">&#39;@customText&#39;</span>
<span class="tok-p">}</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>y, en nuestra plantilla:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="html"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3
4</div></td><td class="code"><span class="tok-nt">&lt;div</span> <span class="tok-na">login-button</span>
 <span class="tok-na">uri=</span><span class="tok-s">&quot;#/login&quot;</span>
 <span class="tok-na">custom-text=</span><span class="tok-s">&quot;Área de usuario&quot;</span><span class="tok-nt">&gt;</span>
<span class="tok-nt">&lt;/div&gt;</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>Aquí, estamos diciendo que se establezca el valor de la variable <code>loginPath</code> del <em>isolate scope</em> con lo que pasamos como atributo <code>uri</code>.</p>
</div>
<div class="paragraph">
<p>Ahora, imaginemos que no queremos tener la URL <em>hardcodeada</em>, ya que tenemos un servicio en nuestra aplicación que nos proporciona todas las URLs de la misma. Nuestro controlador pasa dicho servicio a la vista:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="javascript"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3</div></td><td class="code"><span class="tok-p">.</span><span class="tok-nx">controller</span><span class="tok-p">(</span><span class="tok-s1">&#39;MainCtrl&#39;</span><span class="tok-p">,</span> <span class="tok-kd">function</span><span class="tok-p">(</span><span class="tok-nx">$scope</span><span class="tok-p">,</span> <span class="tok-nx">AppUrls</span><span class="tok-p">){</span>
  <span class="tok-nx">$scope</span><span class="tok-p">.</span><span class="tok-nx">urls</span> <span class="tok-o">=</span> <span class="tok-nx">AppUrls</span><span class="tok-p">;</span>
 <span class="tok-p">})</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>y la plantilla pasa la url como parámetro de la directiva:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="html"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3
4</div></td><td class="code"><span class="tok-nt">&lt;div</span> <span class="tok-na">login-button</span>
 <span class="tok-na">login-path=</span><span class="tok-s">&quot;urls.login&quot;</span>
 <span class="tok-na">login-text=</span><span class="tok-s">&quot;Área de usuario&quot;</span><span class="tok-nt">&gt;</span>
<span class="tok-nt">&lt;/div&gt;</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>Tras este cambio, si observamos el fuente de nuestra aplicación, veremos que no tenemos el resultado que esperábamos, y en lugar de un esperado <code>a href="#/login"</code>, nuestro enlace es <code>a href="urls.login"</code>.</p>
</div>
<div class="paragraph">
<p>Para obtener el resultado esperado, tenemos que hacer una ligera modificación en el <code>scope</code> de nuestra directiva:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="javascript"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3
4</div></td><td class="code"><span class="tok-nx">scope</span> <span class="tok-o">:</span> <span class="tok-p">{</span>
 <span class="tok-nx">loginPath</span> <span class="tok-o">:</span> <span class="tok-s1">&#39;=&#39;</span><span class="tok-p">,</span>
 <span class="tok-nx">loginText</span> <span class="tok-o">:</span> <span class="tok-s1">&#39;@&#39;</span>
<span class="tok-p">}</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>Podemos ver un ejemplo completo de este funcionamiento en <a href="http://codepen.io/alexsuch/pen/mdAFa" class="bare">http://codepen.io/alexsuch/pen/mdAFa</a>.</p>
</div>
<div class="paragraph">
<p>Vemos que hemos cambiado la primera <code>@</code> por un <code>=</code>. Este símbolo determina la <strong>estrategia de <em>binding</em></strong>:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>@</code> lee el valor de un atributo. El valor final siempre será una cadena. Al leerse tras la evaluación del DOM, también podemos usarlo de la forma <code>title="{{title}}"</code>, el valor del atributo es el que hayamos establecido en el <code>$scope</code> para la variable <code>title</code>.</p>
</li>
<li>
<p><code>=</code> nos permite realizar el <em>two-way data binding</em> en nuestra directiva, <em>bindando</em> la propiedad del <code>scope</code> de la directiva a una propiedad del <code>scope</code> padre. Cuando utilicemos <code>=</code>, usaremos el nombre de la propiedad sin las llaves <code>{{}}</code>.</p>
</li>
<li>
<p><code>&amp;</code> permite realizar referencias a funciones en el <code>scope</code> padre.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_el_atributo_code_transclude_code">9.5. El atributo <code>transclude</code></h3>
<div class="paragraph">
<p>Vamos a realizar una modificación adicional en nuestro botón, haciendo que se parezca más a una etiqueta HTML. En un enlace normal introduciríamos el texto detro de la etiqueta, en lugar de como un atributo, ¿no?. Vamos a hacer lo mismo, con nuestra directiva, para que tenga la forma:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="html"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3</div></td><td class="code"><span class="tok-nt">&lt;div</span> <span class="tok-na">login-button</span> <span class="tok-na">login-path=</span><span class="tok-s">&quot;urls.login&quot;</span><span class="tok-nt">&gt;</span>
  Área de usuario
<span class="tok-nt">&lt;/div&gt;</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>Para ello, haremos uso de la <em>transclusión</em>. Ésta consiste en la inclusión de un documento (o parte de un documento) dentro de otro documento. Realmente es algo que ya hemos visto en la parte de <em>routing</em> con las directivas <code>ngView</code> o <code>uiView</code>, donde introducíamos unas plantillas dentro de otras.</p>
</div>
<div class="paragraph">
<p>Es justo lo que vamos a hacer en nuestra directiva: queremos que el fragmento <em>Área de usuario</em> se introduzca en una zona concreta de la plantilla.</p>
</div>
<div class="paragraph">
<p>Para permitir la <em>transclusión</em> en AngularJS, debemos hacer dos cosas:</p>
</div>
<div class="paragraph">
<p>En primer lugar, nuestra directiva tiene que permitir la <em>transclusión</em>. Para ello, añadir el atributo <code>transclusion</code> al DDO.</p>
</div>
<div class="paragraph">
<p>Además, tenemos que indicar dónde se va a realizar la <em>transclusión</em>. AngularJS nos proporciona la directiva <code>ngTransclude</code>, que introduciremos en la parte de nuestra plantilla dode queramos realizarla.</p>
</div>
<div class="paragraph">
<p>Así, nuestro DDO queda de la siguiente manera:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="javascript"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11</div></td><td class="code"><span class="tok-p">{</span>
 <span class="tok-nx">restrict</span> <span class="tok-o">:</span> <span class="tok-s1">&#39;A&#39;</span><span class="tok-p">,</span>

 <span class="tok-nx">scope</span> <span class="tok-o">:</span> <span class="tok-p">{</span>
  <span class="tok-nx">loginPath</span> <span class="tok-o">:</span> <span class="tok-s1">&#39;=&#39;</span>
 <span class="tok-p">},</span>

 <span class="tok-nx">transclude</span> <span class="tok-o">:</span> <span class="tok-kc">true</span><span class="tok-p">,</span>

 <span class="tok-nx">template</span> <span class="tok-o">:</span> <span class="tok-s1">&#39;&lt;a class=&quot;btn btn-primary btn-lg&quot; ng-href=&quot;{{loginPath}}&quot;&gt;&lt;span class=&quot;glyphicon glyphicon-log-in&quot;&gt;&lt;/span&gt; &lt;span ng-transclude&gt;&lt;/span&gt;&lt;/a&gt;&#39;</span>
<span class="tok-p">}</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>Ahora, ya no es necesario el atributo <code>loginText</code>, y por eso se ha eliminado. Se ha substituído por un <code>&lt;span ng-transclude&gt;&lt;/span&gt;</code> en la plantilla.</p>
</div>
<div class="paragraph">
<p>Podemos ver este ejemplo funcionando en <a href="http://codepen.io/alexsuch/pen/DxjEu" class="bare">http://codepen.io/alexsuch/pen/DxjEu</a>.</p>
</div>
</div>
<div class="sect2">
<h3 id="_un_vistazo_a_todas_las_propiedades_de_una_directiva">9.6. Un vistazo a todas las propiedades de una directiva</h3>
<div class="paragraph">
<p>Ahora que tenemos un varios ejemplos de cómo crear una directiva, veamos cuáles son todas las propiedades que podemos definir en una directiva:</p>
</div>
<div class="sect3">
<h4 id="_restrict">9.6.1. restrict</h4>
<div class="paragraph">
<p>Como hemos visto, permite determinar cómo puede usarse una directiva:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>`A`tributo</p>
</li>
<li>
<p>`E`lemento</p>
</li>
<li>
<p>`C`lase</p>
</li>
<li>
<p>Co`M`entario</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_scope">9.6.2. scope</h4>
<div class="paragraph">
<p>Lo utlizamos para crear un <em>scope</em> hijo (<code>scope : true</code>) o un <em>isolate scope</em> (<code>scope : {}</code>).</p>
</div>
</div>
<div class="sect3">
<h4 id="_template">9.6.3. template</h4>
<div class="paragraph">
<p>Define el contenido de la directiva. Puede incluir código HTML, <em>data binding expressions</em> y otras directivas.</p>
</div>
</div>
<div class="sect3">
<h4 id="_templateurl">9.6.4. templateUrl</h4>
<div class="paragraph">
<p>Al igual que en el <em>routing</em>, podemos definir un path para la plantilla de nuestra directiva.</p>
</div>
<div class="paragraph">
<p>Definir un <code>templateUrl</code> puede ser útil en componentes muy específicos para una aplicación. Sin embargo, cuando desarrollamos componentes reutilizables, lo mejor es definir la plantilla dentro de la directiva como un atributo <code>template</code>.</p>
</div>
</div>
<div class="sect3">
<h4 id="_controller">9.6.5. controller</h4>
<div class="paragraph">
<p>Nos permite definir un controlador, que se asociará a la plantilla de la directiva de igual manera que hacíamos en el <em>routing</em>.</p>
</div>
<div class="paragraph">
<p>Recibe como parámetros cuatro argumentos:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="javascript"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10</div></td><td class="code"><span class="tok-nx">angular</span>
 <span class="tok-p">.</span><span class="tok-nx">module</span><span class="tok-p">(</span><span class="tok-s1">&#39;exampleModule&#39;</span><span class="tok-p">,</span> <span class="tok-p">[])</span>
 <span class="tok-p">.</span><span class="tok-nx">directive</span><span class="tok-p">(</span><span class="tok-s1">&#39;exampleDirective&#39;</span><span class="tok-p">,</span> <span class="tok-kd">function</span><span class="tok-p">(){</span>
  <span class="tok-k">return</span> <span class="tok-p">{</span>
   <span class="tok-nx">restrict</span> <span class="tok-o">:</span> <span class="tok-s1">&#39;A&#39;</span><span class="tok-p">,</span>
   <span class="tok-nx">controller</span> <span class="tok-o">:</span> <span class="tok-kd">function</span><span class="tok-p">(</span><span class="tok-nx">$scope</span><span class="tok-p">,</span> <span class="tok-nx">$element</span><span class="tok-p">,</span> <span class="tok-nx">$attrs</span><span class="tok-p">,</span> <span class="tok-nx">$transclude</span><span class="tok-p">)</span> <span class="tok-p">{</span>
    <span class="tok-c1">//Código de nuestro controlador</span>
   <span class="tok-p">}</span>
  <span class="tok-p">};</span>
 <span class="tok-p">})</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="sect4">
<h5 id="__code_scope_code"><code>$scope</code></h5>
<div class="paragraph">
<p>Hace referencia al objeto <code>scope</code> asociado a la directiva.</p>
</div>
</div>
<div class="sect4">
<h5 id="__code_element_code"><code>$element</code></h5>
<div class="paragraph">
<p>Hace referencia al objeto jqLite (similiar a un objeto jQuery) de la directiva.</p>
</div>
<div class="paragraph">
<p>=====<code>$attrs</code>
Hace referencia a los atributos del elemento. Por ejemplo para un elemento</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="html"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1</div></td><td class="code"><span class="tok-nt">&lt;div</span> <span class="tok-na">id=</span><span class="tok-s">&quot;myId&quot;</span> <span class="tok-na">class=</span><span class="tok-s">&quot;blue-bordered&quot;</span><span class="tok-nt">&gt;&lt;/div&gt;</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>el objeto <code>$attrs</code> tendría el valor:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="javascript"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3
4</div></td><td class="code"><span class="tok-p">{</span>
 <span class="tok-nx">id</span> <span class="tok-o">:</span> <span class="tok-s1">&#39;myId&#39;</span><span class="tok-p">,</span>
 <span class="tok-kr">class</span> <span class="tok-o">:</span> <span class="tok-s1">&#39;blue-bordered&#39;</span>
<span class="tok-p">}</span>
</td></tr></table></code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="__transclude">$transclude</h5>
<div class="paragraph">
<p>Esta función crea un clon del elemento a transcluir, permitiéndonos manipular el DOM.</p>
</div>
<div class="paragraph">
<p>En teoría, aunque podemos manipular el DOM desde un controlador, el lugar adecuado donde hacerlo es en el código de una directiva.</p>
</div>
<div class="paragraph">
<p>El siguiente ejemplo crea un enlace vacío con el texto a transcluir a continuación de nuestro elemento:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="javascript"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10</div></td><td class="code"><span class="tok-nx">controller</span> <span class="tok-o">:</span> <span class="tok-kd">function</span><span class="tok-p">(</span><span class="tok-nx">$scope</span><span class="tok-p">,</span> <span class="tok-nx">$element</span><span class="tok-p">,</span> <span class="tok-nx">$attrs</span><span class="tok-p">,</span><span class="tok-nx">$transclude</span><span class="tok-p">)</span> <span class="tok-p">{</span>
 <span class="tok-nx">$transclude</span><span class="tok-p">(</span><span class="tok-kd">function</span><span class="tok-p">(</span><span class="tok-nx">clone</span><span class="tok-p">){</span>
  <span class="tok-nx">console</span><span class="tok-p">.</span><span class="tok-nx">log</span><span class="tok-p">(</span><span class="tok-s1">&#39;clone is&#39;</span><span class="tok-p">,</span> <span class="tok-nx">clone</span><span class="tok-p">)</span>
  <span class="tok-nx">console</span><span class="tok-p">.</span><span class="tok-nx">log</span><span class="tok-p">(</span><span class="tok-s1">&#39;clone txt is&#39;</span><span class="tok-p">,</span> <span class="tok-nx">clone</span><span class="tok-p">.</span><span class="tok-nx">text</span><span class="tok-p">())</span>

  <span class="tok-kd">var</span> <span class="tok-nx">a</span> <span class="tok-o">=</span> <span class="tok-nx">angular</span><span class="tok-p">.</span><span class="tok-nx">element</span><span class="tok-p">(</span><span class="tok-s1">&#39;&lt;span&gt;&#39;</span><span class="tok-p">);</span>
  <span class="tok-nx">a</span><span class="tok-p">.</span><span class="tok-nx">text</span><span class="tok-p">(</span><span class="tok-nx">clone</span><span class="tok-p">.</span><span class="tok-nx">text</span><span class="tok-p">());</span>
  <span class="tok-nx">$element</span><span class="tok-p">.</span><span class="tok-nx">append</span><span class="tok-p">(</span><span class="tok-nx">a</span><span class="tok-p">);</span>
 <span class="tok-p">});</span>
<span class="tok-p">},</span>
</td></tr></table></code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_transclude">9.6.6. transclude</h4>
<div class="paragraph">
<p>Nos permite realizar la <em>transclusión</em> del bloque HTML que queramos, combinando su uso con la directiva <code>ngTransclude</code>.</p>
</div>
</div>
<div class="sect3">
<h4 id="_replace">9.6.7. replace</h4>
<div class="paragraph">
<p>Si inspeccionamos el código de nuestra aplicación, veremos que cuando introducimos una directiva se crea un elemento padre con la definición de la directiva, y dentro de él se desarrolla la directiva.</p>
</div>
<div class="paragraph">
<p>Cuando se establece con el valor <code>true</code>, reemplazamos el elemento padre por el valor de la directiva, en lugar de introducirlo como hijo.</p>
</div>
<div class="paragraph">
<p>Es decir, pasamos de</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="html"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12</div></td><td class="code"><span class="tok-nt">&lt;div</span> <span class="tok-na">ng-app=</span><span class="tok-s">&quot;directives5&quot;</span> <span class="tok-na">ng-controller=</span><span class="tok-s">&quot;MainCtrl&quot;</span> <span class="tok-na">class=</span><span class="tok-s">&quot;ng-scope&quot;</span><span class="tok-nt">&gt;</span>
 <span class="tok-nt">&lt;div</span> <span class="tok-na">login-button=</span><span class="tok-s">&quot;&quot;</span> <span class="tok-na">login-path=</span><span class="tok-s">&quot;urls.login&quot;</span> <span class="tok-na">class=</span><span class="tok-s">&quot;ng-isolate-scope&quot;</span><span class="tok-nt">&gt;</span>
  <span class="tok-nt">&lt;a</span> <span class="tok-na">class=</span><span class="tok-s">&quot;btn btn-primary btn-lg&quot;</span> <span class="tok-na">ng-href=</span><span class="tok-s">&quot;#/login&quot;</span> <span class="tok-na">href=</span><span class="tok-s">&quot;#/login&quot;</span><span class="tok-nt">&gt;</span>
   <span class="tok-nt">&lt;span</span> <span class="tok-na">class=</span><span class="tok-s">&quot;glyphicon glyphicon-log-in&quot;</span><span class="tok-nt">&gt;&lt;/span&gt;</span>
   <span class="tok-nt">&lt;span</span> <span class="tok-na">ng-transclude=</span><span class="tok-s">&quot;&quot;</span><span class="tok-nt">&gt;</span>
    <span class="tok-nt">&lt;span</span> <span class="tok-na">class=</span><span class="tok-s">&quot;ng-scope&quot;</span><span class="tok-nt">&gt;</span>
     Área de usuario
    <span class="tok-nt">&lt;/span&gt;</span>
   <span class="tok-nt">&lt;/span&gt;</span>
  <span class="tok-nt">&lt;/a&gt;</span>
 <span class="tok-nt">&lt;/div&gt;</span>
<span class="tok-nt">&lt;/div&gt;</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>a</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="html"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10</div></td><td class="code"><span class="tok-nt">&lt;div</span> <span class="tok-na">ng-app=</span><span class="tok-s">&quot;directives5&quot;</span> <span class="tok-na">ng-controller=</span><span class="tok-s">&quot;MainCtrl&quot;</span> <span class="tok-na">class=</span><span class="tok-s">&quot;ng-scope&quot;</span><span class="tok-nt">&gt;</span>
 <span class="tok-nt">&lt;a</span> <span class="tok-na">class=</span><span class="tok-s">&quot;btn btn-primary btn-lg&quot;</span> <span class="tok-na">ng-href=</span><span class="tok-s">&quot;#/login&quot;</span> <span class="tok-na">href=</span><span class="tok-s">&quot;#/login&quot;</span><span class="tok-nt">&gt;</span>
  <span class="tok-nt">&lt;span</span> <span class="tok-na">class=</span><span class="tok-s">&quot;glyphicon glyphicon-log-in&quot;</span><span class="tok-nt">&gt;&lt;/span&gt;</span>
  <span class="tok-nt">&lt;span</span> <span class="tok-na">ng-transclude=</span><span class="tok-s">&quot;&quot;</span><span class="tok-nt">&gt;</span>
   <span class="tok-nt">&lt;span</span> <span class="tok-na">class=</span><span class="tok-s">&quot;ng-scope&quot;</span><span class="tok-nt">&gt;</span>
    Área de usuario
   <span class="tok-nt">&lt;/span&gt;</span>
  <span class="tok-nt">&lt;/span&gt;</span>
 <span class="tok-nt">&lt;/a&gt;</span>
<span class="tok-nt">&lt;/div&gt;</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>Vemos que, en el segundo caso, ha desaparecido el bloque <code>div login-button</code>.</p>
</div>
</div>
<div class="sect3">
<h4 id="_link">9.6.8. link</h4>
<div class="paragraph">
<p>El <code>template</code> o <code>templateUrl</code> no tiene utilidad hasta que se compila contra un <code>scope</code>. Hemos visto que una directiva no tiene un <code>scope</code> por defecto, y utilizará el del padre a no ser que se lo indiquemos.</p>
</div>
<div class="paragraph">
<p>Para hacer uso del scope, utilizaremos la función <code>link</code>, que recibe tres argumentos:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>scope</code>: el <code>scope</code> que se pasa a la directiva, pudiendo ser propio o el del padre.</p>
</li>
<li>
<p><code>element</code>: un elemento jQLite (un <em>subset</em> de jQuery) donde se aplica nuestra directiva. Si tenemos jQuery instalado en nuestra aplicación, será un elemento jQuery en lugar de un lQLite.</p>
</li>
<li>
<p><code>attrs</code>: un objeto que contiene todos los atributos del elemento donde aplicamos nuestra directiva, de igual manera que vimos con el controlador.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>El uso principal de la función <code>link</code> es para asociar <em>listeners</em> a elementos del DOM, observar cambios en propiedades del modelo, y validación de elementos.</p>
</div>
</div>
<div class="sect3">
<h4 id="_require">9.6.9. require</h4>
<div class="paragraph">
<p>La opción <code>require</code> puede ser una cadena array de cadenas, correspondoentes a nombres de directivas. Al usarla, se asume que esas directivas indicadas en el array han sido previamente aplicadas en el propio elemento, o en su elemento padre (si se ha marcado con un <code>^</code>). Se utiliza para inyectar el controlador de la directiva requerida como cuarto argumento de la función <code>link</code> de nuestra directiva.</p>
</div>
<div class="paragraph">
<p>Esta cadena o conjunto de cadenas se corresponde con el nombre de las directivas cuyo controlador queremos utilizar.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="javascript"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3
4</div></td><td class="code"><span class="tok-c1">// ...</span>
  <span class="tok-nx">restrict</span> <span class="tok-o">:</span> <span class="tok-s1">&#39;EA&#39;</span><span class="tok-p">,</span>
  <span class="tok-nx">require</span> <span class="tok-o">:</span> <span class="tok-s1">&#39;ngModel&#39;</span> <span class="tok-c1">// el elemento debe tener la directiva ngModel para poder utilizar su controlador</span>
<span class="tok-c1">// ...</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="javascript"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3
4</div></td><td class="code"><span class="tok-c1">// ...</span>
  <span class="tok-nx">restrict</span> <span class="tok-o">:</span> <span class="tok-s1">&#39;EA&#39;</span><span class="tok-p">,</span>
  <span class="tok-nx">require</span> <span class="tok-o">:</span> <span class="tok-s1">&#39;^ngModel&#39;</span> <span class="tok-c1">// el elemento o su padre, deben tener la directiva ngModel</span>
<span class="tok-c1">// ...</span>
</td></tr></table></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_compile">9.6.10. compile</h4>
<div class="paragraph">
<p>Utilizaremos la función <code>compile</code> para realizar transformaciones en el DOM antes de que se ejecute la función <code>link</code>. Esta función recibe dos elementos:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>element</code>: elemento sobre el que se aplicará la directiva</p>
</li>
<li>
<p><code>attrs</code>: listado de atributos de la directiva.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>La función <code>compile</code> no tiene acceso al <code>scope</code>, y debe devolver una función <code>link</code>.</p>
</div>
<div class="paragraph">
<p>El esqueleto de una directiva cuando utilizamos una función <code>compile</code> es:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="javascript"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12</div></td><td class="code"><span class="tok-nx">angular</span>
  <span class="tok-p">.</span><span class="tok-nx">module</span><span class="tok-p">(</span><span class="tok-s1">&#39;compileSkel&#39;</span><span class="tok-p">,</span> <span class="tok-p">[])</span>
  <span class="tok-p">.</span><span class="tok-nx">directive</span><span class="tok-p">(</span><span class="tok-s1">&#39;sample&#39;</span><span class="tok-p">,</span> <span class="tok-kd">function</span><span class="tok-p">(){</span>
    <span class="tok-k">return</span> <span class="tok-p">{</span>
      <span class="tok-nx">compile</span> <span class="tok-o">:</span> <span class="tok-kd">function</span><span class="tok-p">(</span><span class="tok-nx">element</span><span class="tok-p">,</span> <span class="tok-nx">attrs</span><span class="tok-p">)</span> <span class="tok-p">{</span>
        <span class="tok-c1">//realizar transformaciones sobre el DOM</span>
        <span class="tok-k">return</span> <span class="tok-kd">function</span><span class="tok-p">(</span><span class="tok-nx">scope</span><span class="tok-p">,</span> <span class="tok-nx">element</span><span class="tok-p">,</span> <span class="tok-nx">attrs</span><span class="tok-p">){</span>
          <span class="tok-c1">//función link normal y corriente</span>
        <span class="tok-p">};</span>
      <span class="tok-p">}</span>
    <span class="tok-p">};</span>
  <span class="tok-p">});</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>En <a href="http://codepen.io/alexsuch/pen/LpcsK" class="bare">http://codepen.io/alexsuch/pen/LpcsK</a> tenemos un ejemplo que usa la función <code>compile</code> para establecer un estilo por defecto a una serie de elementos <code>div</code>.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_directivas_de_validación">9.7. Directivas de validación</h3>
<div class="paragraph">
<p>Éste es un buen ejemplo para varias cosas. Por un lado, veremos un ejemplo real del funcionamiento del atributo <code>require</code> en una directiva. Además, haremos uso del controlador ngModelController que habíamos visto en la parte de los formularios. Por último, veremos cómo ampliar la API de validadción de AngularJS con directivas propias, ya que ésta es la manera recomendada de implementar la validación en AngularJS.</p>
</div>
<div class="paragraph">
<p>Para el ejemplo, introduciremos una directiva que valide DNIs. Como todos sabremos, la letra del DNI es un dígito de control que se obtiene al aplicar una fórmula matemática sobre el número. Nuestra directiva validará que la longitud del DNI y el dígito de control sean correctos. Tendrá una forma similar a:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="html"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1</div></td><td class="code"><span class="tok-nt">&lt;input</span> <span class="tok-na">type=</span><span class="tok-s">&quot;text&quot;</span> <span class="tok-na">ng-model=</span><span class="tok-s">&quot;user.dni&quot;</span> <span class="tok-na">is-dni</span> <span class="tok-nt">/&gt;</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>Internet está lleno de sitios donde encontrar la fórmula de validación del DNI. Nosotros la hemos obtenido de <a href="http://www.yporqueno.es/blog/javascript-validar-dni">aquí</a>, porque también acepta NIEs.</p>
</div>
<div class="paragraph">
<p>Para este tipo de directivas, vamos a tener que hacer, sí o sí, una restricción de tipo atributo.</p>
</div>
<div class="paragraph">
<p>También, recordemos cómo funcionaba el <em>pipeline</em> de <em>parsers</em> y <em>formatters</em> que vimos en el capítulo anterior:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="img/ses08/ngModelCtrl2.png" alt="{large-size}">
</div>
</div>
<div class="paragraph">
<p>Lo que haremos en nuestra directiva será introducir nuestro validador como primer elemento del array de <em>parsers</em>, y como último elemento del array de <em>formatters</em> para el <code>ngModelController</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="javascript"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44</div></td><td class="code"><span class="tok-nx">angular</span>
  <span class="tok-p">.</span><span class="tok-nx">module</span><span class="tok-p">(</span><span class="tok-s1">&#39;validator.nif&#39;</span><span class="tok-p">,</span> <span class="tok-p">[])</span>
  <span class="tok-p">.</span><span class="tok-nx">directive</span><span class="tok-p">(</span><span class="tok-s1">&#39;isNif&#39;</span><span class="tok-p">,</span> <span class="tok-kd">function</span> <span class="tok-p">()</span> <span class="tok-p">{</span>
    <span class="tok-k">return</span> <span class="tok-p">{</span>
      <span class="tok-nx">restrict</span><span class="tok-o">:</span> <span class="tok-s1">&#39;A&#39;</span><span class="tok-p">,</span>
      <span class="tok-nx">require</span><span class="tok-o">:</span> <span class="tok-s1">&#39;ngModel&#39;</span><span class="tok-p">,</span>
      <span class="tok-nx">link</span><span class="tok-o">:</span> <span class="tok-kd">function</span><span class="tok-p">(</span><span class="tok-nx">scope</span><span class="tok-p">,</span> <span class="tok-nx">element</span><span class="tok-p">,</span> <span class="tok-nx">attrs</span><span class="tok-p">,</span> <span class="tok-nx">ngModelCtrl</span><span class="tok-p">)</span> <span class="tok-p">{</span>
        <span class="tok-c1">// Acepta NIEs (Extranjeros con X, Y o Z al principio)</span>
        <span class="tok-c1">// http://www.yporqueno.es/blog/javascript-validar-dni</span>
        <span class="tok-kd">var</span> <span class="tok-nx">validarNif</span> <span class="tok-o">=</span> <span class="tok-kd">function</span> <span class="tok-p">(</span><span class="tok-nx">value</span><span class="tok-p">)</span> <span class="tok-p">{</span>
          <span class="tok-kd">var</span> <span class="tok-nx">numero</span><span class="tok-p">,</span> <span class="tok-nx">letraDni</span><span class="tok-p">,</span> <span class="tok-nx">letra</span><span class="tok-p">;</span>
          <span class="tok-kd">var</span> <span class="tok-nx">expresion_regular_dni</span> <span class="tok-o">=</span> <span class="tok-sr">/^[XYZ]?\d{5,8}[A-Z]$/</span><span class="tok-p">;</span>
          <span class="tok-kd">var</span> <span class="tok-nx">result</span><span class="tok-p">;</span>

          <span class="tok-nx">value</span> <span class="tok-o">=</span> <span class="tok-nx">value</span><span class="tok-p">.</span><span class="tok-nx">toUpperCase</span><span class="tok-p">();</span>

          <span class="tok-k">if</span> <span class="tok-p">(</span><span class="tok-nx">expresion_regular_dni</span><span class="tok-p">.</span><span class="tok-nx">test</span><span class="tok-p">(</span><span class="tok-nx">value</span><span class="tok-p">)</span> <span class="tok-o">===</span> <span class="tok-kc">true</span><span class="tok-p">)</span> <span class="tok-p">{</span>
            <span class="tok-nx">numero</span> <span class="tok-o">=</span> <span class="tok-nx">value</span><span class="tok-p">.</span><span class="tok-nx">substr</span><span class="tok-p">(</span><span class="tok-mi">0</span><span class="tok-p">,</span> <span class="tok-nx">value</span><span class="tok-p">.</span><span class="tok-nx">length</span> <span class="tok-o">-</span> <span class="tok-mi">1</span><span class="tok-p">);</span>
            <span class="tok-nx">numero</span> <span class="tok-o">=</span> <span class="tok-nx">numero</span><span class="tok-p">.</span><span class="tok-nx">replace</span><span class="tok-p">(</span><span class="tok-s1">&#39;X&#39;</span><span class="tok-p">,</span> <span class="tok-mi">0</span><span class="tok-p">);</span>
            <span class="tok-nx">numero</span> <span class="tok-o">=</span> <span class="tok-nx">numero</span><span class="tok-p">.</span><span class="tok-nx">replace</span><span class="tok-p">(</span><span class="tok-s1">&#39;Y&#39;</span><span class="tok-p">,</span> <span class="tok-mi">1</span><span class="tok-p">);</span>
            <span class="tok-nx">numero</span> <span class="tok-o">=</span> <span class="tok-nx">numero</span><span class="tok-p">.</span><span class="tok-nx">replace</span><span class="tok-p">(</span><span class="tok-s1">&#39;Z&#39;</span><span class="tok-p">,</span> <span class="tok-mi">2</span><span class="tok-p">);</span>
            <span class="tok-nx">letraDni</span> <span class="tok-o">=</span> <span class="tok-nx">value</span><span class="tok-p">.</span><span class="tok-nx">substr</span><span class="tok-p">(</span><span class="tok-nx">value</span><span class="tok-p">.</span><span class="tok-nx">length</span> <span class="tok-o">-</span> <span class="tok-mi">1</span><span class="tok-p">,</span> <span class="tok-mi">1</span><span class="tok-p">);</span>
            <span class="tok-nx">numero</span> <span class="tok-o">=</span> <span class="tok-nx">numero</span> <span class="tok-o">%</span> <span class="tok-mi">23</span><span class="tok-p">;</span>
            <span class="tok-nx">letra</span> <span class="tok-o">=</span> <span class="tok-s1">&#39;TRWAGMYFPDXBNJZSQVHLCKET&#39;</span><span class="tok-p">;</span>
            <span class="tok-nx">letra</span> <span class="tok-o">=</span> <span class="tok-nx">letra</span><span class="tok-p">.</span><span class="tok-nx">substring</span><span class="tok-p">(</span><span class="tok-nx">numero</span><span class="tok-p">,</span> <span class="tok-nx">numero</span> <span class="tok-o">+</span> <span class="tok-mi">1</span><span class="tok-p">);</span>

            <span class="tok-k">if</span> <span class="tok-p">(</span><span class="tok-nx">letra</span> <span class="tok-o">!=</span> <span class="tok-nx">letraDni</span><span class="tok-p">)</span> <span class="tok-p">{</span>
              <span class="tok-nx">result</span> <span class="tok-o">=</span> <span class="tok-kc">false</span><span class="tok-p">;</span>
            <span class="tok-p">}</span> <span class="tok-k">else</span> <span class="tok-p">{</span>
              <span class="tok-nx">result</span> <span class="tok-o">=</span> <span class="tok-kc">true</span><span class="tok-p">;</span>
            <span class="tok-p">}</span>
          <span class="tok-p">}</span> <span class="tok-k">else</span> <span class="tok-p">{</span>
            <span class="tok-nx">result</span> <span class="tok-o">=</span> <span class="tok-kc">false</span><span class="tok-p">;</span>
          <span class="tok-p">}</span>

          <span class="tok-nx">ngModelCtrl</span><span class="tok-p">.</span><span class="tok-nx">$setValidity</span><span class="tok-p">(</span><span class="tok-s1">&#39;isNif&#39;</span><span class="tok-p">,</span> <span class="tok-nx">result</span><span class="tok-p">);</span>
          <span class="tok-k">return</span> <span class="tok-nx">value</span><span class="tok-p">;</span>
        <span class="tok-p">};</span>

        <span class="tok-nx">ngModelCtrl</span><span class="tok-p">.</span><span class="tok-nx">$parsers</span><span class="tok-p">.</span><span class="tok-nx">unshift</span><span class="tok-p">(</span><span class="tok-nx">validarNif</span><span class="tok-p">);</span>
        <span class="tok-nx">ngModelCtrl</span><span class="tok-p">.</span><span class="tok-nx">$formatters</span><span class="tok-p">.</span><span class="tok-nx">push</span><span class="tok-p">(</span><span class="tok-nx">validarNif</span><span class="tok-p">);</span>
      <span class="tok-p">}</span>
    <span class="tok-p">}</span>
  <span class="tok-p">});</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>Como podemos ver en la función <code>validarNif</code>, el validador tiene una doble responsabilidad:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Indicar al <code>ngModelController</code> si la validación de DNI/NIE es correcta o no.</p>
</li>
<li>
<p>Devolver el nuevo valor del modelo. En nuestro caso estamos devolviendo siempre el valor del modelo, pero puede haber circunstancias en que queramos devolver otra cosa. También, en el caso de los <em>formatters</em> podríamos querer transformar la cadena a objeto antes de dárselo al controlador.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Podemos ver un ejemplo de nuestra directiva funcionando en <a href="http://codepen.io/alexsuch/pen/cdzyw" class="bare">http://codepen.io/alexsuch/pen/cdzyw</a>.</p>
</div>
</div>
<div class="sect2">
<h3 id="_ejercicios_2_puntos">9.8. Ejercicios (2 puntos)</h3>
<div class="paragraph">
<p>Aplica el <em>tag</em> <code>directives</code> a la versión que quieres que se corrija.</p>
</div>
<div class="sect3">
<h4 id="_directiva_de_componente_1_puntos">9.8.1. Directiva de componente (1 puntos)</h4>
<div class="paragraph">
<p>Vamos a crear una directiva llamada <code>product</code>, que requiere un <code>ngModel</code>. Como <em>template</em> tendrá el div que habíamos hecho para pintar los productos del carrito. Aquí está nuestra plantilla de directiva:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="javascript"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12</div></td><td class="code"><span class="tok-nx">angular</span>
  <span class="tok-p">.</span><span class="tok-nx">module</span><span class="tok-p">(</span><span class="tok-s1">&#39;org.expertojava.carrito&#39;</span><span class="tok-p">)</span>
  <span class="tok-p">.</span><span class="tok-nx">directive</span><span class="tok-p">(</span><span class="tok-s1">&#39;product&#39;</span><span class="tok-p">,</span> <span class="tok-kd">function</span><span class="tok-p">(){</span>
    <span class="tok-k">return</span> <span class="tok-p">{</span>
      <span class="tok-nx">require</span><span class="tok-o">:</span> <span class="tok-s1">&#39;&#39;</span><span class="tok-p">,</span> <span class="tok-c1">//¿requiere algo?</span>
      <span class="tok-nx">restrict</span><span class="tok-o">:</span> <span class="tok-s1">&#39;&#39;</span><span class="tok-p">,</span> <span class="tok-c1">//¿qué restrict le ponemos?</span>
      <span class="tok-nx">scope</span><span class="tok-o">:</span> <span class="tok-p">{</span>
        <span class="tok-nx">product</span><span class="tok-o">:</span> <span class="tok-s1">&#39;&#39;</span> <span class="tok-c1">//ver qué ponemos aquí.</span>
      <span class="tok-p">},</span>
      <span class="tok-nx">templateUrl</span><span class="tok-o">:</span> <span class="tok-s1">&#39;&#39;</span> <span class="tok-c1">//crear plantilla</span>
    <span class="tok-p">};</span>
  <span class="tok-p">})</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>Cambiaremos el bucle que mostraba los productos por el siguiente:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="html"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3</div></td><td class="code"><span class="tok-nt">&lt;div</span> <span class="tok-na">ng-repeat=</span><span class="tok-s">&quot;product in products&quot;</span><span class="tok-nt">&gt;</span>
  <span class="tok-nt">&lt;product</span> <span class="tok-na">ng-model=</span><span class="tok-s">&quot;product&quot;</span> <span class="tok-nt">/&gt;</span>
<span class="tok-nt">&lt;/div&gt;</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>o bien por este otro:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="html"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3</div></td><td class="code"><span class="tok-nt">&lt;div</span> <span class="tok-na">ng-repeat=</span><span class="tok-s">&quot;product in products&quot;</span><span class="tok-nt">&gt;</span>
  <span class="tok-nt">&lt;div</span> <span class="tok-na">product</span> <span class="tok-na">ng-model=</span><span class="tok-s">&quot;product&quot;</span><span class="tok-nt">&gt;&lt;/div&gt;</span>
<span class="tok-nt">&lt;/div&gt;</span>
</td></tr></table></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_directiva_de_validación_1_puntos">9.8.2. Directiva de validación (1 puntos)</h4>
<div class="paragraph">
<p>Vamos a crear una directiva, llamada <code>maxDecimals</code>, que usaremos en el formulario de edición del capítulo anterior. El dato será inválido si el número de decimales del input es mayor que valor que se asigne a <code>max-decimals</code>. Ejemplo:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="html"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1</div></td><td class="code"><span class="tok-nt">&lt;input</span> <span class="tok-na">type=</span><span class="tok-s">&quot;number&quot;</span> <span class="tok-na">required</span> <span class="tok-na">max-decimals=</span><span class="tok-s">&quot;2&quot;</span> <span class="tok-nt">/&gt;</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>La plantilla de nuestra directiva será:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="javascript"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22</div></td><td class="code"> <span class="tok-nx">angular</span>
  <span class="tok-p">.</span><span class="tok-nx">module</span><span class="tok-p">(</span><span class="tok-s1">&#39;org.expertojava.carrito&#39;</span><span class="tok-p">)</span>
  <span class="tok-p">.</span><span class="tok-nx">directive</span><span class="tok-p">(</span><span class="tok-s1">&#39;maxDecimals&#39;</span><span class="tok-p">,</span> <span class="tok-kd">function</span><span class="tok-p">(){</span>
    <span class="tok-k">return</span> <span class="tok-p">{</span>
      <span class="tok-nx">require</span><span class="tok-o">:</span> <span class="tok-s1">&#39;ngModel&#39;</span><span class="tok-p">,</span>
      <span class="tok-nx">restrict</span><span class="tok-o">:</span> <span class="tok-s1">&#39;&#39;</span><span class="tok-p">,</span> <span class="tok-c1">//TODO: ¿Qué ponemos aquí?</span>
      <span class="tok-nx">link</span><span class="tok-o">:</span> <span class="tok-kd">function</span><span class="tok-p">(</span><span class="tok-nx">scope</span><span class="tok-p">,</span> <span class="tok-nx">element</span><span class="tok-p">,</span> <span class="tok-nx">attrs</span><span class="tok-p">,</span> <span class="tok-nx">ngModelCtrl</span><span class="tok-p">)</span> <span class="tok-p">{</span>
        <span class="tok-kd">var</span> <span class="tok-nx">validationFn</span> <span class="tok-o">=</span> <span class="tok-kd">function</span><span class="tok-p">(</span><span class="tok-nx">value</span><span class="tok-p">){</span>
          <span class="tok-kd">var</span> <span class="tok-nx">maxDecimals</span> <span class="tok-o">=</span> <span class="tok-nx">attrs</span><span class="tok-p">.</span><span class="tok-nx">maxDecimals</span><span class="tok-p">;</span>
          <span class="tok-kd">var</span> <span class="tok-nx">validity</span> <span class="tok-o">=</span> <span class="tok-kc">true</span><span class="tok-p">;</span>

          <span class="tok-c1">//TODO: IMPLEMENTAR LÓGICA</span>

          <span class="tok-nx">ngModelCtrl</span><span class="tok-p">.</span><span class="tok-nx">$setValidity</span><span class="tok-p">(</span><span class="tok-s1">&#39;maxDecimals&#39;</span><span class="tok-p">,</span> <span class="tok-nx">validity</span><span class="tok-p">);</span>

          <span class="tok-k">return</span> <span class="tok-nx">value</span><span class="tok-p">;</span>
        <span class="tok-p">};</span>

        <span class="tok-c1">//TODO: ASOCIAR A PARSERS Y FORMATTERS</span>
      <span class="tok-p">}</span>
    <span class="tok-p">};</span>
  <span class="tok-p">});</span>
</td></tr></table></code></pre>
</div>
</div>
<div style="page-break-after: always;"></div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="sesion10">10. Promesas de resultados</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Una promesa, o <em>deferred object</em>, es una herramienta muy sencilla y útil cuando realizamos programación asíncrona.</p>
</div>
<div class="paragraph">
<p>Aunque hay muchas implementaciones en JavaScript, el equipo de AngularJS realizó una adaptación de la librería <a href="https://github.com/kriskowal/q">Q, de Kris Kowal</a>, debido a su éxito y difusión.</p>
</div>
<div class="sect2">
<h3 id="_por_qué_utilizar_promesas">10.1. Por qué utilizar promesas</h3>
<div class="paragraph">
<p>En JavaScript, los métodos asíncronos normalmente utilizan funciones de <em>callback</em> para devolver un estado de éxito o error. Por ejemplo, la API de gelocalización requiere de estas dos funciones de <em>callback</em> para <a href="http://codepen.io/alexsuch/pen/xgzCn">obtener la posición actual</a>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="javascript"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3
4
5
6
7
8
9</div></td><td class="code"><span class="tok-kd">var</span> <span class="tok-nx">successFn</span> <span class="tok-o">=</span> <span class="tok-kd">function</span><span class="tok-p">(</span><span class="tok-nx">response</span><span class="tok-p">){</span>
 <span class="tok-nx">console</span><span class="tok-p">.</span><span class="tok-nx">log</span><span class="tok-p">(</span><span class="tok-s1">&#39;SUCCESS! &#39;</span> <span class="tok-o">+</span> <span class="tok-nx">JSON</span><span class="tok-p">.</span><span class="tok-nx">stringify</span><span class="tok-p">(</span><span class="tok-nx">response</span><span class="tok-p">));</span>
<span class="tok-p">};</span>

<span class="tok-kd">var</span> <span class="tok-nx">errorFn</span> <span class="tok-o">=</span> <span class="tok-kd">function</span><span class="tok-p">(</span><span class="tok-nx">err</span><span class="tok-p">)</span> <span class="tok-p">{</span>
  <span class="tok-nx">console</span><span class="tok-p">.</span><span class="tok-nx">log</span><span class="tok-p">(</span><span class="tok-s1">&#39;ERROR! &#39;</span> <span class="tok-o">+</span> <span class="tok-nx">JSON</span><span class="tok-p">.</span><span class="tok-nx">stringify</span><span class="tok-p">(</span><span class="tok-nx">response</span><span class="tok-p">));</span>
<span class="tok-p">}</span>

<span class="tok-nx">navigator</span><span class="tok-p">.</span><span class="tok-nx">geolocation</span><span class="tok-p">.</span><span class="tok-nx">getCurrentPosition</span><span class="tok-p">(</span><span class="tok-nx">successFn</span><span class="tok-p">,</span> <span class="tok-nx">errorFn</span><span class="tok-p">);</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>Otro ejemplo es el objeto XMLHttpRequest, que utilizamos para realizar peticiones AJAX. Tiene una función de <em>callback</em> llamada <code>onReadyStateChange</code>, que se llama cuando cambia el atributo <code>readyState</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="javascript"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10</div></td><td class="code"><span class="tok-kd">var</span> <span class="tok-nx">xhr</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-nb">window</span><span class="tok-p">.</span><span class="tok-nx">XMLHttpRequest</span><span class="tok-p">();</span>
<span class="tok-nx">xhr</span><span class="tok-p">.</span><span class="tok-nx">open</span><span class="tok-p">(</span><span class="tok-s1">&#39;GET&#39;</span><span class="tok-p">,</span> <span class="tok-s1">&#39;http://www.webdeveasy.com&#39;</span><span class="tok-p">,</span> <span class="tok-kc">true</span><span class="tok-p">);</span>
<span class="tok-nx">xhr</span><span class="tok-p">.</span><span class="tok-nx">onreadystatechange</span> <span class="tok-o">=</span> <span class="tok-kd">function</span><span class="tok-p">()</span> <span class="tok-p">{</span>
    <span class="tok-k">if</span> <span class="tok-p">(</span><span class="tok-nx">xhr</span><span class="tok-p">.</span><span class="tok-nx">readyState</span> <span class="tok-o">===</span> <span class="tok-mi">4</span><span class="tok-p">)</span> <span class="tok-p">{</span>
        <span class="tok-k">if</span> <span class="tok-p">(</span><span class="tok-nx">xhr</span><span class="tok-p">.</span><span class="tok-nx">status</span> <span class="tok-o">===</span> <span class="tok-mi">200</span><span class="tok-p">)</span> <span class="tok-p">{</span>
            <span class="tok-nx">console</span><span class="tok-p">.</span><span class="tok-nx">log</span><span class="tok-p">(</span><span class="tok-s1">&#39;Success&#39;</span><span class="tok-p">);</span>
        <span class="tok-p">}</span>
    <span class="tok-p">}</span>
<span class="tok-p">};</span>
<span class="tok-nx">xhr</span><span class="tok-p">.</span><span class="tok-nx">send</span><span class="tok-p">();</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>En nuestro día a día nos encontraremos con una infinidad de usos y ejemplos. Aunque puede parecer sencillo de manejar, puede volverse un infierno cuando tenemos que encadenar funciones de sincronización.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="img/ses10/callbackHell.png" alt="{large-size}">
</div>
</div>
<div class="paragraph">
<p>La imagen ilustra un ejemplo de la famosa <em>callback pyramid of doom</em>. Aunque hay maneras más elegantes de escribir y refactorizar el código, siempre será difícil de leer y mantener.</p>
</div>
</div>
<div class="sect2">
<h3 id="_promesas_y_em_deferred_objects_em">10.2. Promesas y <em>deferred objects</em></h3>
<div class="paragraph">
<p>Una promesa representa el resultado de una operación asíncrona. Expone una interfaz que puede usarse para interactuar con el resultado que tendrá dicha operación. Así, también permite que quien esté interesado pueda hacer uso de dicho resultado.</p>
</div>
<div class="paragraph">
<p>La promesa está asociada a un <em>deferred object</em>, cuyo estado será "pendiente", y no tiene ningún resultado. Cuando invoquemos los métodos <code>resolve()</code> o <code>reject()</code>, este estado pasará a "resuelto" o "rechazado". Además, podemos coger la promesa una vez inicializada y definir operaciones con su resultado futuro, que se llevarán a cabo cuando se cambie a los estados "resuelto" o "rechazado" que acabamos de mencionar.</p>
</div>
<div class="paragraph">
<p>Mientras el <em>deferred object</em> tiene métodos para cambiar el estado de una operación, la promesa sólo expone métodos para operar con el resultado. Es por ello que es una buena práctica devolver una promesa y no un <em>deferred object</em>.</p>
</div>
</div>
<div class="sect2">
<h3 id="_promesas_en_angularjs">10.3. Promesas en AngularJS</h3>
<div class="paragraph">
<p>En primer lugar, deberemos crear un <em>deferred object</em>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="javascript"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1</div></td><td class="code"><span class="tok-kd">var</span> <span class="tok-nx">deferred</span> <span class="tok-o">=</span> <span class="tok-nx">$q</span><span class="tok-p">.</span><span class="tok-nx">defer</span><span class="tok-p">();</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>El objeto <code>deferred</code> apunta a un <em>deferred object</em>, cuyo estado podremos resolver o rechazar tras realizar una operación asíncrona. Supongamos el método asíncrono <code>async(successFn, errorFn)</code>, donde los dos parámetros son funciones de <em>callback</em>. Cuando <code>async</code> finaliza su ejecución, queremos resolver o rechazar <code>deferred</code> con su resultado:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="javascript"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3
4
5
6
7
8</div></td><td class="code"><span class="tok-nx">async</span><span class="tok-p">(</span>
  <span class="tok-kd">function</span><span class="tok-p">(</span><span class="tok-nx">val</span><span class="tok-p">){</span>
    <span class="tok-nx">deferred</span><span class="tok-p">.</span><span class="tok-nx">resolve</span><span class="tok-p">(</span><span class="tok-nx">val</span><span class="tok-p">);</span>
  <span class="tok-p">},</span>
  <span class="tok-kd">function</span><span class="tok-p">(</span><span class="tok-nx">err</span><span class="tok-p">){</span>
    <span class="tok-nx">deferred</span><span class="tok-p">.</span><span class="tok-nx">reject</span><span class="tok-p">(</span><span class="tok-nx">err</span><span class="tok-p">);</span>
  <span class="tok-p">}</span>
<span class="tok-p">);</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>Incluso podemos simplificar la llamada, ya que los métodos <code>resolve</code> y <code>reject</code> no precisan de un contexto:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="javascript"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1</div></td><td class="code"><span class="tok-nx">async</span><span class="tok-p">(</span><span class="tok-nx">deferred</span><span class="tok-p">.</span><span class="tok-nx">resolve</span><span class="tok-p">(</span><span class="tok-nx">val</span><span class="tok-p">),</span> <span class="tok-nx">deferred</span><span class="tok-p">.</span><span class="tok-nx">reject</span><span class="tok-p">(</span><span class="tok-nx">err</span><span class="tok-p">));</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>Ahora, asignar operaciones una vez haya habido éxito o error es bastante sencillo:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="javascript"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3
4
5
6
7</div></td><td class="code"><span class="tok-kd">var</span> <span class="tok-nx">promise</span> <span class="tok-o">=</span> <span class="tok-nx">deferred</span><span class="tok-p">.</span><span class="tok-nx">promise</span><span class="tok-p">;</span>

<span class="tok-nx">promise</span>
  <span class="tok-p">.</span><span class="tok-nx">then</span><span class="tok-p">(</span>
    <span class="tok-kd">function</span><span class="tok-p">(</span><span class="tok-nx">data</span><span class="tok-p">){</span> <span class="tok-nx">alert</span><span class="tok-p">(</span><span class="tok-s1">&#39;Success! &#39;</span> <span class="tok-o">+</span> <span class="tok-nx">data</span><span class="tok-p">);</span> <span class="tok-p">},</span>
    <span class="tok-kd">function</span><span class="tok-p">(</span><span class="tok-nx">data</span><span class="tok-p">){</span> <span class="tok-nx">alert</span><span class="tok-p">(</span><span class="tok-s1">&#39;Error! &#39;</span> <span class="tok-o">+</span> <span class="tok-nx">data</span><span class="tok-p">);</span> <span class="tok-p">}</span>
  <span class="tok-p">)</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>Podemos asignar tantas funciones de éxito o error como queramos. En el siguiente ejemplo, tanto las funciones asignadas antes de la llamada a <code>async</code> como las que se realizan después se ejecutarán al resultado:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="javascript"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16</div></td><td class="code"><span class="tok-kd">var</span> <span class="tok-nx">deferred</span> <span class="tok-o">=</span> <span class="tok-nx">$q</span><span class="tok-p">.</span><span class="tok-nx">defer</span><span class="tok-p">();</span>
<span class="tok-nx">deferred</span><span class="tok-p">.</span><span class="tok-nx">promise</span>
    <span class="tok-p">.</span><span class="tok-nx">then</span><span class="tok-p">(</span><span class="tok-kd">function</span><span class="tok-p">(</span><span class="tok-nx">data</span><span class="tok-p">)</span> <span class="tok-p">{</span>
        <span class="tok-nx">console</span><span class="tok-p">.</span><span class="tok-nx">log</span><span class="tok-p">(</span><span class="tok-s1">&#39;Success asignado antes de invocar async()&#39;</span><span class="tok-p">,</span> <span class="tok-nx">data</span><span class="tok-p">);</span>
    <span class="tok-p">},</span> <span class="tok-kd">function</span><span class="tok-p">(</span><span class="tok-nx">error</span><span class="tok-p">)</span> <span class="tok-p">{</span>
        <span class="tok-nx">console</span><span class="tok-p">.</span><span class="tok-nx">log</span><span class="tok-p">(</span><span class="tok-s1">&#39;Error asignado antes de invocar async()&#39;</span><span class="tok-p">,</span> <span class="tok-nx">error</span><span class="tok-p">);</span>
    <span class="tok-p">});</span>

<span class="tok-nx">async</span><span class="tok-p">(</span><span class="tok-nx">deferred</span><span class="tok-p">.</span><span class="tok-nx">resolve</span><span class="tok-p">,</span> <span class="tok-nx">deferred</span><span class="tok-p">.</span><span class="tok-nx">reject</span><span class="tok-p">);</span>

<span class="tok-nx">deferred</span><span class="tok-p">.</span><span class="tok-nx">promise</span>
    <span class="tok-p">.</span><span class="tok-nx">then</span><span class="tok-p">(</span><span class="tok-kd">function</span><span class="tok-p">(</span><span class="tok-nx">data</span><span class="tok-p">)</span> <span class="tok-p">{</span>
        <span class="tok-nx">console</span><span class="tok-p">.</span><span class="tok-nx">log</span><span class="tok-p">(</span><span class="tok-s1">&#39;Success asignado tras invocar async()&#39;</span><span class="tok-p">,</span> <span class="tok-nx">data</span><span class="tok-p">);</span>
    <span class="tok-p">},</span> <span class="tok-kd">function</span><span class="tok-p">(</span><span class="tok-nx">error</span><span class="tok-p">)</span> <span class="tok-p">{</span>
        <span class="tok-nx">console</span><span class="tok-p">.</span><span class="tok-nx">log</span><span class="tok-p">(</span><span class="tok-s1">&#39;Error asignado tras invocar async()&#39;</span><span class="tok-p">,</span> <span class="tok-nx">error</span><span class="tok-p">);</span>
    <span class="tok-p">});</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>Hemos visto que el método <code>then</code> recibe dos funciones, una de éxito y una de error. Sin embargo, podemos usar <code>then</code> para asignar funciones de éxito, y utilizar <code>catch</code> cuando se produce un error. Además, existe una función <code>finally</code>, que se ejecutará siempre, se haya resuelto correctamente o no. Gracias a <code>finally</code>, no tendremos que duplicar código que se podría ejecutar tanto en la parte del éxito como la del error.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="javascript"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3
4
5</div></td><td class="code"><span class="tok-nx">deferred</span><span class="tok-p">.</span><span class="tok-nx">then</span><span class="tok-p">(</span><span class="tok-kd">function</span><span class="tok-p">(){</span> <span class="tok-nx">console</span><span class="tok-p">.</span><span class="tok-nx">log</span><span class="tok-p">(</span><span class="tok-s1">&#39;All OK&#39;</span><span class="tok-p">)});</span>

<span class="tok-nx">deferred</span><span class="tok-p">.</span><span class="tok-k">catch</span><span class="tok-p">(</span><span class="tok-kd">function</span><span class="tok-p">(){</span> <span class="tok-nx">console</span><span class="tok-p">.</span><span class="tok-nx">log</span><span class="tok-p">(</span><span class="tok-s1">&#39;Error!&#39;</span><span class="tok-p">)});</span>

<span class="tok-nx">deferred</span><span class="tok-p">.</span><span class="tok-k">finally</span><span class="tok-p">(</span><span class="tok-kd">function</span><span class="tok-p">(){</span> <span class="tok-nx">console</span><span class="tok-p">.</span><span class="tok-nx">log</span><span class="tok-p">(</span><span class="tok-s1">&#39;End.&#39;</span><span class="tok-p">);</span> <span class="tok-p">});</span>
</td></tr></table></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_encadenando_promesas">10.4. Encadenando promesas</h3>
<div class="paragraph">
<p>Un dato interesante que hay que conocer, es que el método <code>then</code> de una promesa devuelve otra promesa. Cuando resolvemos la primera promesa, el valor que devolvamos se enviará a la promesa siguiente, de manera que podemos encadenar y transformar una serie de promesas de resultados. Veámoslo con un <a href="http://codepen.io/alexsuch/pen/dlrID">ejemplo concreto</a>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="javascript"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21</div></td><td class="code"><span class="tok-kd">function</span> <span class="tok-nx">async</span><span class="tok-p">(</span><span class="tok-nx">value</span><span class="tok-p">)</span> <span class="tok-p">{</span> <span class="tok-c1">// Supongamos que se trata de una operación asíncrona de verdad</span>
    <span class="tok-kd">var</span> <span class="tok-nx">deferred</span> <span class="tok-o">=</span> <span class="tok-nx">$q</span><span class="tok-p">.</span><span class="tok-nx">defer</span><span class="tok-p">();</span>
    <span class="tok-kd">var</span> <span class="tok-nx">asyncCalculation</span> <span class="tok-o">=</span> <span class="tok-nx">value</span> <span class="tok-o">/</span> <span class="tok-mi">2</span><span class="tok-p">;</span>
    <span class="tok-nx">deferred</span><span class="tok-p">.</span><span class="tok-nx">resolve</span><span class="tok-p">(</span><span class="tok-nx">asyncCalculation</span><span class="tok-p">);</span>
    <span class="tok-k">return</span> <span class="tok-nx">deferred</span><span class="tok-p">.</span><span class="tok-nx">promise</span><span class="tok-p">;</span>
<span class="tok-p">}</span>

<span class="tok-kd">var</span> <span class="tok-nx">promise</span> <span class="tok-o">=</span> <span class="tok-nx">async</span><span class="tok-p">(</span><span class="tok-mi">8</span><span class="tok-p">)</span>
    <span class="tok-p">.</span><span class="tok-nx">then</span><span class="tok-p">(</span><span class="tok-kd">function</span><span class="tok-p">(</span><span class="tok-nx">x</span><span class="tok-p">)</span> <span class="tok-p">{</span>
        <span class="tok-k">return</span> <span class="tok-nx">x</span><span class="tok-o">+</span><span class="tok-mi">1</span><span class="tok-p">;</span>
    <span class="tok-p">})</span>
    <span class="tok-p">.</span><span class="tok-nx">then</span><span class="tok-p">(</span><span class="tok-kd">function</span><span class="tok-p">(</span><span class="tok-nx">x</span><span class="tok-p">)</span> <span class="tok-p">{</span>
        <span class="tok-k">return</span> <span class="tok-nx">x</span><span class="tok-o">*</span><span class="tok-mi">2</span><span class="tok-p">;</span>
    <span class="tok-p">})</span>
    <span class="tok-p">.</span><span class="tok-nx">then</span><span class="tok-p">(</span><span class="tok-kd">function</span><span class="tok-p">(</span><span class="tok-nx">x</span><span class="tok-p">)</span> <span class="tok-p">{</span>
        <span class="tok-k">return</span> <span class="tok-nx">x</span><span class="tok-o">-</span><span class="tok-mi">1</span><span class="tok-p">;</span>
    <span class="tok-p">});</span>

<span class="tok-nx">promise</span><span class="tok-p">.</span><span class="tok-nx">then</span><span class="tok-p">(</span><span class="tok-kd">function</span><span class="tok-p">(</span><span class="tok-nx">x</span><span class="tok-p">)</span> <span class="tok-p">{</span>
    <span class="tok-nx">console</span><span class="tok-p">.</span><span class="tok-nx">log</span><span class="tok-p">(</span><span class="tok-nx">x</span><span class="tok-p">);</span>
<span class="tok-p">});</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>La promesa empieza con llamando a <code>async(8)</code>, que resuelve con el valor <code>4</code>. Este valor pasa por todas las funciones <code>then</code> secuencialmente, hasta pintar el valor <code>9</code>, ya que hace <code>(8 / 2 + 1) * 2 - 1</code>.</p>
</div>
<div class="paragraph">
<p>Como hemos visto antes que las funciones no necesitan contexto, podemos <a href="http://codepen.io/alexsuch/pen/jDrxu">refactorizarlo</a> de la siguiente manera:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="javascript"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3
4
5</div></td><td class="code"><span class="tok-kd">var</span> <span class="tok-nx">promise</span> <span class="tok-o">=</span> <span class="tok-nx">async</span><span class="tok-p">(</span><span class="tok-mi">8</span><span class="tok-p">)</span>
                <span class="tok-p">.</span><span class="tok-nx">then</span><span class="tok-p">(</span><span class="tok-nx">addOne</span><span class="tok-p">)</span>
                <span class="tok-p">.</span><span class="tok-nx">then</span><span class="tok-p">(</span><span class="tok-nx">mult2</span><span class="tok-p">)</span>
                <span class="tok-p">.</span><span class="tok-nx">then</span><span class="tok-p">(</span><span class="tok-nx">minusOne</span><span class="tok-p">)</span>
                <span class="tok-p">.</span><span class="tok-nx">then</span><span class="tok-p">(</span><span class="tok-nx">paintValue</span><span class="tok-p">);</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>El ejemplo es muy optimista y asume que todo va a ir bien. Pero si no es así, ¿dónde colocamos nuestro <code>catch</code>? Bien, en caso de operaciones encadenadas, <code>catch</code> y <code>finally</code> se colocan en último lugar:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="javascript"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3
4
5
6
7</div></td><td class="code"><span class="tok-kd">var</span> <span class="tok-nx">promise</span> <span class="tok-o">=</span> <span class="tok-nx">async</span><span class="tok-p">(</span><span class="tok-mi">8</span><span class="tok-p">)</span>
                <span class="tok-p">.</span><span class="tok-nx">then</span><span class="tok-p">(</span><span class="tok-nx">addOne</span><span class="tok-p">)</span>
                <span class="tok-p">.</span><span class="tok-nx">then</span><span class="tok-p">(</span><span class="tok-nx">mult2</span><span class="tok-p">)</span>
                <span class="tok-p">.</span><span class="tok-nx">then</span><span class="tok-p">(</span><span class="tok-nx">minusOne</span><span class="tok-p">)</span>
                <span class="tok-p">.</span><span class="tok-nx">then</span><span class="tok-p">(</span><span class="tok-nx">paintValue</span><span class="tok-p">)</span>
                <span class="tok-p">.</span><span class="tok-k">catch</span><span class="tok-p">(</span><span class="tok-nx">showError</span><span class="tok-p">)</span>
                <span class="tok-p">.</span><span class="tok-k">finally</span><span class="tok-p">(</span><span class="tok-nx">endFn</span><span class="tok-p">);</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>En el momento que cualquier elemento resuelva incorrectamente (ya sea el primero o el tercero), se ejecutará a continuación el <code>catch</code>, y se terminará con el <code>finally</code>.</p>
</div>
</div>
<div class="sect2">
<h3 id="_otros_métodos_útiles">10.5. Otros métodos útiles</h3>
<div class="sect3">
<h4 id="__q_reject">10.5.1. $q.reject</h4>
<div class="paragraph">
<p>En algunas ocasiones, puede que necesitemos devolver una promesa rechazada. En lugar de crear una promesa y rechazarla, podemos usar <code>$q.reject(reason)</code>, que devuelve una promesa rechazada, con el motivo que le digamos. Por ejemplo:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="javascript"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10</div></td><td class="code"><span class="tok-kd">var</span> <span class="tok-nx">promise</span> <span class="tok-o">=</span> <span class="tok-nx">async</span><span class="tok-p">()</span>
  <span class="tok-p">.</span><span class="tok-nx">then</span><span class="tok-p">(</span>
    <span class="tok-kd">function</span><span class="tok-p">(</span><span class="tok-nx">value</span><span class="tok-p">){</span>
      <span class="tok-k">if</span><span class="tok-p">(</span><span class="tok-nx">isValid</span><span class="tok-p">(</span><span class="tok-nx">value</span><span class="tok-p">))</span> <span class="tok-p">{</span>
        <span class="tok-k">return</span> <span class="tok-nx">value</span><span class="tok-p">;</span>
      <span class="tok-p">}</span>

      <span class="tok-k">return</span> <span class="tok-nx">$q</span><span class="tok-p">.</span><span class="tok-nx">reject</span><span class="tok-p">(</span><span class="tok-s1">&#39;Valor no válido&#39;</span><span class="tok-p">);</span>
    <span class="tok-p">}</span>
  <span class="tok-p">);</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>Si <code>value</code> es válido, un conjunto de promesas encadenadas funcionará correctamente. Sin embargo, se irá al bloque <code>catch</code> si no es válido.</p>
</div>
</div>
<div class="sect3">
<h4 id="__q_when">10.5.2. $q.when</h4>
<div class="paragraph">
<p>Similar a <code>$q.reject</code>, pero devuelve un valor correctamente resuelto. Un ejemplo muy claro de uso es cuando tenemos que pedir un dato al servidor si no lo tenemos cacheado.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="javascript"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3
4
5
6
7</div></td><td class="code"><span class="tok-kd">function</span> <span class="tok-nx">getElement</span><span class="tok-p">(</span><span class="tok-nx">key</span><span class="tok-p">){</span>
  <span class="tok-k">if</span><span class="tok-p">(</span><span class="tok-o">!!</span><span class="tok-nx">$localStorage</span><span class="tok-p">.</span><span class="tok-nx">key</span><span class="tok-p">)</span> <span class="tok-p">{</span>
    <span class="tok-k">return</span> <span class="tok-nx">$q</span><span class="tok-p">.</span><span class="tok-nx">when</span><span class="tok-p">(</span><span class="tok-nx">$localStorage</span><span class="tok-p">.</span><span class="tok-nx">key</span><span class="tok-p">);</span>
  <span class="tok-p">}</span> <span class="tok-k">else</span> <span class="tok-p">{</span>
    <span class="tok-k">return</span> <span class="tok-nx">getFromServer</span><span class="tok-p">(</span><span class="tok-nx">key</span><span class="tok-p">);</span>
  <span class="tok-p">}</span>
<span class="tok-p">}</span>
</td></tr></table></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="__q_all">10.5.3. $q.all</h4>
<div class="paragraph">
<p>En algunas ocasiones podríamos querer tener una serie de elementos de manera asíncrona, sin importarnos el orden, y ser notificados al terminar. Para ello, hacemos uso de <code>$q.all(promisesArray)</code>. Devuelve una promesa que se resuelve sólo cuando todas las promesas del array se han resuelto. Si al menos una de las promesas del array se rechaza, también lo hará el resultado de <code>$q.all</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="javascript"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17</div></td><td class="code"><span class="tok-kd">var</span> <span class="tok-nx">allPromises</span> <span class="tok-o">=</span> <span class="tok-nx">$q</span><span class="tok-p">.</span><span class="tok-nx">all</span><span class="tok-p">([</span>
  <span class="tok-nx">async1</span><span class="tok-p">(),</span>
  <span class="tok-nx">async2</span><span class="tok-p">(),</span>
  <span class="tok-nx">async3</span><span class="tok-p">(),</span>
  <span class="tok-p">...</span>
  <span class="tok-nx">asyncN</span><span class="tok-p">()</span>
<span class="tok-p">]);</span>

<span class="tok-nx">allPromises</span><span class="tok-p">.</span><span class="tok-nx">then</span><span class="tok-p">(</span><span class="tok-kd">function</span><span class="tok-p">(</span><span class="tok-nx">values</span><span class="tok-p">){</span>
  <span class="tok-kd">var</span> <span class="tok-nx">value1</span> <span class="tok-o">=</span> <span class="tok-nx">values</span><span class="tok-p">[</span><span class="tok-mi">0</span><span class="tok-p">];</span>
  <span class="tok-kd">var</span> <span class="tok-nx">value2</span> <span class="tok-o">=</span> <span class="tok-nx">values</span><span class="tok-p">[</span><span class="tok-mi">1</span><span class="tok-p">];</span>
  <span class="tok-kd">var</span> <span class="tok-nx">value3</span> <span class="tok-o">=</span> <span class="tok-nx">values</span><span class="tok-p">[</span><span class="tok-mi">2</span><span class="tok-p">];</span>
  <span class="tok-p">...</span>
  <span class="tok-kd">var</span> <span class="tok-nx">valueN</span> <span class="tok-o">=</span> <span class="tok-nx">values</span><span class="tok-p">[</span><span class="tok-nx">N</span><span class="tok-o">+</span><span class="tok-mi">1</span><span class="tok-p">];</span>

  <span class="tok-nx">console</span><span class="tok-p">.</span><span class="tok-nx">log</span><span class="tok-p">(</span><span class="tok-s1">&#39;end&#39;</span><span class="tok-p">);</span>
<span class="tok-p">});</span>
</td></tr></table></code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_ejercicio_0_5_puntos_2">10.6. Ejercicio (0.5 puntos)</h3>
<div class="paragraph">
<p>Genera un servicio en AngularJS que haga uso de promesas y de la API de geoposicionamiento para devolver las coordenadas del navegador. Haz también un programa en AngularJS que pinte las coordenadas en pantalla.</p>
</div>
<div class="paragraph">
<p>Aplica el <em>tag</em> <code>promises</code> a la versión que quieres que se corrija.
&lt;&lt;&lt;</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="sesion11">11. Comunicación con el servidor</h2>
<div class="sectionbody">
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Guardaremos todos los ejercicios que hagamos en la carpeta <code>server</code></p>
</div>
<div class="paragraph">
<p>Aplica el tag <code>server</code> a la versión que quieres que se corrija.</p>
</div>
<div class="paragraph">
<p>Los ejercicios tienen una puntuación total de un punto, repartido equitativamente entre todos ellos.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Lo normal en una aplicación web es que, tarde o temprano, haya que comunicarse con el servidor para traernos algún tipo de dato, o bien para persistirlo. Es más, existen muchas aplicaciones que únicamente hacen CRUD, con lo que la comunicación con el servidor se convierte en algo esencial.</p>
</div>
<div class="paragraph">
<p>AngularJS dispone de una serie de APIs para comunicarse con cualquier <em>backend</em> a realizando peticiones <code>XMLHttpRequest</code> (XHR), o bien peticiones JSONP a través del servicio <code>$http</code>. Además, existe un servicio llamado <code>$resource</code>, especializado en la comunicación con interfaces RESTful.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>JSONP, o "JSON with padding", es una técinca de comunicación que usan los programas escritos en JavaScript y que corren en un navegador web. Con JSONP, podemos realizar una petición de datos a un servidor que se encuentra en otro dominio, cosa habitualmente prohibida en un navegador web debido a la <em>same-origin policy</em>.</p>
</div>
<div class="paragraph">
<p>Dado que muchos navegadores no tienen penalización <em>same-origin</em> en las etiquetas <code>script</code>, lo qu ese hace es traerse la respuesta del servidor, envuelta en una llamada a una función.</p>
</div>
<div class="paragraph">
<p>Para que JSONP funcione, el servidor al que se realizan las peticiones debe saber que tiene que devolver los resultados formateados en JSONP. Para ello, normamente se genera una URL con un parámetro llamado <code>callback=funcion_de_callback</code> (ej: <a href="http://jsonplaceholder.typicode.com/users/1?callback=processUser" class="bare">http://jsonplaceholder.typicode.com/users/1?callback=processUser</a>)</p>
</div>
<div class="paragraph">
<p><a href="http://en.wikipedia.org/wiki/JSONP" class="bare">http://en.wikipedia.org/wiki/JSONP</a></p>
</div>
</td>
</tr>
</table>
</div>
<div class="sect2">
<h3 id="_el_servicio_http">11.1. El servicio $http</h3>
<div class="paragraph">
<p>El servicio <code>$http</code> consiste en una API de propósito general para realizar peticiones XHR y JSONP. Es una API bastante sólida y sencilla de usar.</p>
</div>
<div class="paragraph">
<p>El servicio <code>$http</code> ofrece una serie de funciones que reciben como parámetros una URL y un objeto de configuración, para generar una petición HTTP. Devuelve una promesa de resultados con dos métodos: <code>success</code> y <code>error</code>.</p>
</div>
<div class="paragraph">
<p>Los métodos son equivalentes a los que podríamos hacer en una petición HTTP.</p>
</div>
<div class="paragraph">
<p>Para hacer las pruebas haremos uso de los servicios situados en <a href="http://jsonplaceholder.typicode.com/">JSONPlaceholder</a>, que permite hacer uso del servicio <code>$http</code> sobre sus servidores, ya que tiene habilitado el soporte para CORS</p>
</div>
<div class="sect3">
<h4 id="__http_get">11.1.1. $http.get</h4>
<div class="paragraph">
<p>Realiza una petición <code>GET</code>, para obtener datos.</p>
</div>
<div class="paragraph">
<p>Parámetros:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>url</code>: URL destino</p>
</li>
<li>
<p><code>config</code>: objeto de configuración opcional. A destacar el atributo <code>params</code>, que contiene un mapa de los parámetros a pasar.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><a href="http://codepen.io/alexsuch/pen/wsAgj">El siguiente ejemplo</a> pide el detalle de un usuario:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="javascript"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13</div></td><td class="code"><span class="tok-nx">angular</span>
  <span class="tok-p">.</span><span class="tok-nx">module</span><span class="tok-p">(</span><span class="tok-s1">&#39;httpModule&#39;</span><span class="tok-p">,</span> <span class="tok-p">[])</span>
  <span class="tok-p">.</span><span class="tok-nx">controller</span><span class="tok-p">(</span><span class="tok-s1">&#39;MainCtrl&#39;</span><span class="tok-p">,</span> <span class="tok-kd">function</span><span class="tok-p">(</span><span class="tok-nx">$scope</span><span class="tok-p">,</span> <span class="tok-nx">$http</span><span class="tok-p">){</span>
    <span class="tok-nx">$http</span><span class="tok-p">.</span><span class="tok-nx">get</span><span class="tok-p">(</span>
      <span class="tok-s1">&#39;http://jsonplaceholder.typicode.com/posts&#39;</span><span class="tok-p">,{</span> <span class="tok-nx">params</span><span class="tok-o">:</span> <span class="tok-p">{</span><span class="tok-nx">id</span><span class="tok-o">:</span><span class="tok-mi">1</span><span class="tok-p">}</span> <span class="tok-p">}</span>
    <span class="tok-p">)</span>
    <span class="tok-p">.</span><span class="tok-nx">success</span><span class="tok-p">(</span><span class="tok-kd">function</span><span class="tok-p">(</span><span class="tok-nx">data</span><span class="tok-p">){</span>
      <span class="tok-nx">$scope</span><span class="tok-p">.</span><span class="tok-nx">resultdata</span> <span class="tok-o">=</span> <span class="tok-nx">data</span><span class="tok-p">;</span>
    <span class="tok-p">})</span>
    <span class="tok-p">.</span><span class="tok-nx">error</span><span class="tok-p">(</span><span class="tok-kd">function</span><span class="tok-p">(</span><span class="tok-nx">data</span><span class="tok-p">){</span>
      <span class="tok-nx">alert</span><span class="tok-p">(</span><span class="tok-s1">&#39;Se ha producido un error&#39;</span><span class="tok-p">)</span>
    <span class="tok-p">});</span>
<span class="tok-p">});</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="html"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3
4
5
6
7</div></td><td class="code"><span class="tok-nt">&lt;div</span> <span class="tok-na">ng-app=</span><span class="tok-s">&quot;httpModule&quot;</span> <span class="tok-na">ng-controller=</span><span class="tok-s">&quot;MainCtrl&quot;</span><span class="tok-nt">&gt;</span>
  <span class="tok-nt">&lt;h1&gt;</span>Resultado<span class="tok-nt">&lt;/h1&gt;</span>
  <span class="tok-nt">&lt;pre&gt;</span>
{{ resultdata[0] | json }}
  <span class="tok-nt">&lt;/pre&gt;</span>
  <span class="tok-nt">&lt;hr</span> <span class="tok-nt">/&gt;</span>
<span class="tok-nt">&lt;/div&gt;</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="title">EJERCICIO</div>
Genera un pequeño programa, similar al del ejemplo, que realice una petición <code>GET</code> y devuelva el listado de comentarios para el post con ID 1.
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_post">11.1.2. POST</h4>
<div class="paragraph">
<p>Realiza una petición <code>POST</code>, para dar de alta algún dato en el servidor.</p>
</div>
<div class="paragraph">
<p>Parámetros:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>url</code>: URL destino</p>
</li>
<li>
<p><code>data</code>: datos a enviar.</p>
</li>
<li>
<p><code>config</code>: objeto de configuración opcional.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><a href="http://codepen.io/alexsuch/pen/xCEeJ">El siguiente ejemplo</a> se encarga de dar de alta un usuario:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="javascript"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23</div></td><td class="code"><span class="tok-nx">angular</span>
  <span class="tok-p">.</span><span class="tok-nx">module</span><span class="tok-p">(</span><span class="tok-s1">&#39;httpModule&#39;</span><span class="tok-p">,</span> <span class="tok-p">[])</span>
  <span class="tok-p">.</span><span class="tok-nx">controller</span><span class="tok-p">(</span><span class="tok-s1">&#39;MainCtrl&#39;</span><span class="tok-p">,</span> <span class="tok-kd">function</span><span class="tok-p">(</span><span class="tok-nx">$scope</span><span class="tok-p">,</span> <span class="tok-nx">$http</span><span class="tok-p">){</span>
    <span class="tok-nx">$http</span><span class="tok-p">.</span><span class="tok-nx">post</span><span class="tok-p">(</span>
      <span class="tok-s1">&#39;http://jsonplaceholder.typicode.com/users&#39;</span><span class="tok-p">,</span>
      <span class="tok-p">{</span>
          <span class="tok-s2">&quot;name&quot;</span><span class="tok-o">:</span> <span class="tok-s2">&quot;Winchester McFly&quot;</span><span class="tok-p">,</span>
          <span class="tok-s2">&quot;username&quot;</span><span class="tok-o">:</span> <span class="tok-s2">&quot;wmcfly&quot;</span><span class="tok-p">,</span>
          <span class="tok-s2">&quot;email&quot;</span><span class="tok-o">:</span> <span class="tok-s2">&quot;wmcfly@ua.es&quot;</span><span class="tok-p">,</span>
          <span class="tok-s2">&quot;address&quot;</span><span class="tok-o">:</span> <span class="tok-p">{</span>
            <span class="tok-s2">&quot;street&quot;</span><span class="tok-o">:</span> <span class="tok-s2">&quot;Calle del atún 22&quot;</span><span class="tok-p">,</span>
          <span class="tok-p">},</span>
          <span class="tok-s2">&quot;phone&quot;</span><span class="tok-o">:</span> <span class="tok-s2">&quot;666 112233&quot;</span><span class="tok-p">,</span>
          <span class="tok-s2">&quot;website&quot;</span><span class="tok-o">:</span> <span class="tok-s2">&quot;http://winchester-mcfly.com/&quot;</span>
      <span class="tok-p">}</span>
    <span class="tok-p">)</span>
    <span class="tok-p">.</span><span class="tok-nx">success</span><span class="tok-p">(</span><span class="tok-kd">function</span><span class="tok-p">(</span><span class="tok-nx">data</span><span class="tok-p">){</span>
      <span class="tok-nx">$scope</span><span class="tok-p">.</span><span class="tok-nx">id</span> <span class="tok-o">=</span> <span class="tok-nx">data</span><span class="tok-p">.</span><span class="tok-nx">id</span><span class="tok-p">;</span>
    <span class="tok-p">})</span>
    <span class="tok-p">.</span><span class="tok-nx">error</span><span class="tok-p">(</span><span class="tok-kd">function</span><span class="tok-p">(</span><span class="tok-nx">data</span><span class="tok-p">){</span>
      <span class="tok-nx">alert</span><span class="tok-p">(</span><span class="tok-s1">&#39;Se ha producido un error&#39;</span><span class="tok-p">)</span>
    <span class="tok-p">});</span>
<span class="tok-p">});</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="html"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3
4
5
6
7</div></td><td class="code"><span class="tok-nt">&lt;div</span> <span class="tok-na">ng-app=</span><span class="tok-s">&quot;httpModule&quot;</span> <span class="tok-na">ng-controller=</span><span class="tok-s">&quot;MainCtrl&quot;</span><span class="tok-nt">&gt;</span>
  <span class="tok-nt">&lt;h1&gt;</span>Resultado<span class="tok-nt">&lt;/h1&gt;</span>
  <span class="tok-nt">&lt;pre</span> <span class="tok-na">ng-show=</span><span class="tok-s">&quot;id&quot;</span><span class="tok-nt">&gt;</span>
Se ha dado de alta el usuario, con id: {{ id }}
  <span class="tok-nt">&lt;/pre&gt;</span>
  <span class="tok-nt">&lt;hr</span> <span class="tok-nt">/&gt;</span>
<span class="tok-nt">&lt;/div&gt;</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Podemos ver cómo falla si hacemos una petición <code>POST</code> a <code>/users/1</code></p>
</div>
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="title">EJERCICIO</div>
Genera un pequeño programa, similar al del ejemplo, que realice una petición <code>POST</code>  realice el alta de una imagen.
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_put">11.1.3. PUT</h4>
<div class="paragraph">
<p>Realiza una petición <code>PUT</code>, para actualizar algún elemento en el servidor.</p>
</div>
<div class="paragraph">
<p>Parámetros:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>url</code>: URL destino</p>
</li>
<li>
<p><code>data</code>: datos a enviar</p>
</li>
<li>
<p><code>config</code>: objeto de configuración opcional.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>[<a href="http://codepen.io/alexsuch/pen/FvsuH" class="bare">http://codepen.io/alexsuch/pen/FvsuH</a>]El siguiente ejemplo se encarga de actualizar el usuario con id = 1.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="javascript"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23</div></td><td class="code"><span class="tok-nx">angular</span>
  <span class="tok-p">.</span><span class="tok-nx">module</span><span class="tok-p">(</span><span class="tok-s1">&#39;httpModule&#39;</span><span class="tok-p">,</span> <span class="tok-p">[])</span>
  <span class="tok-p">.</span><span class="tok-nx">controller</span><span class="tok-p">(</span><span class="tok-s1">&#39;MainCtrl&#39;</span><span class="tok-p">,</span> <span class="tok-kd">function</span><span class="tok-p">(</span><span class="tok-nx">$scope</span><span class="tok-p">,</span> <span class="tok-nx">$http</span><span class="tok-p">){</span>
    <span class="tok-nx">$http</span><span class="tok-p">.</span><span class="tok-nx">put</span><span class="tok-p">(</span>
      <span class="tok-s1">&#39;http://jsonplaceholder.typicode.com/users/1&#39;</span><span class="tok-p">,</span>
      <span class="tok-p">{</span>
          <span class="tok-s2">&quot;name&quot;</span><span class="tok-o">:</span> <span class="tok-s2">&quot;Winchester McFly&quot;</span><span class="tok-p">,</span>
          <span class="tok-s2">&quot;username&quot;</span><span class="tok-o">:</span> <span class="tok-s2">&quot;wmcfly&quot;</span><span class="tok-p">,</span>
          <span class="tok-s2">&quot;email&quot;</span><span class="tok-o">:</span> <span class="tok-s2">&quot;wmcfly@ua.es&quot;</span><span class="tok-p">,</span>
          <span class="tok-s2">&quot;address&quot;</span><span class="tok-o">:</span> <span class="tok-p">{</span>
            <span class="tok-s2">&quot;street&quot;</span><span class="tok-o">:</span> <span class="tok-s2">&quot;Calle del atún 22&quot;</span><span class="tok-p">,</span>
          <span class="tok-p">},</span>
          <span class="tok-s2">&quot;phone&quot;</span><span class="tok-o">:</span> <span class="tok-s2">&quot;666 112233&quot;</span><span class="tok-p">,</span>
          <span class="tok-s2">&quot;website&quot;</span><span class="tok-o">:</span> <span class="tok-s2">&quot;http://winchester-mcfly.com/&quot;</span>
      <span class="tok-p">}</span>
    <span class="tok-p">)</span>
    <span class="tok-p">.</span><span class="tok-nx">success</span><span class="tok-p">(</span><span class="tok-kd">function</span><span class="tok-p">(</span><span class="tok-nx">data</span><span class="tok-p">){</span>
      <span class="tok-nx">$scope</span><span class="tok-p">.</span><span class="tok-nx">data</span> <span class="tok-o">=</span> <span class="tok-nx">data</span><span class="tok-p">;</span>
    <span class="tok-p">})</span>
    <span class="tok-p">.</span><span class="tok-nx">error</span><span class="tok-p">(</span><span class="tok-kd">function</span><span class="tok-p">(</span><span class="tok-nx">data</span><span class="tok-p">){</span>
      <span class="tok-nx">alert</span><span class="tok-p">(</span><span class="tok-s1">&#39;Se ha producido un error&#39;</span><span class="tok-p">)</span>
    <span class="tok-p">});</span>
<span class="tok-p">});</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="html"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3
4
5
6
7
8</div></td><td class="code"><span class="tok-nt">&lt;div</span> <span class="tok-na">ng-app=</span><span class="tok-s">&quot;httpModule&quot;</span> <span class="tok-na">ng-controller=</span><span class="tok-s">&quot;MainCtrl&quot;</span><span class="tok-nt">&gt;</span>
  <span class="tok-nt">&lt;h1&gt;</span>Resultado<span class="tok-nt">&lt;/h1&gt;</span>
  <span class="tok-nt">&lt;pre</span> <span class="tok-na">ng-show=</span><span class="tok-s">&quot;data&quot;</span><span class="tok-nt">&gt;</span>
Se ha actualizado el usuario, sus nuevos datos son:
{{ data | json }}
  <span class="tok-nt">&lt;/pre&gt;</span>
  <span class="tok-nt">&lt;hr</span> <span class="tok-nt">/&gt;</span>
<span class="tok-nt">&lt;/div&gt;</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="title">EJERCICIO</div>
Genera un pequeño programa, similar al del ejemplo, que realice una petición <code>PUT</code>  para actualizar el título del POST con id=1.
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_delete">11.1.4. DELETE</h4>
<div class="paragraph">
<p>Realiza una petición <code>DELETE</code>, para solicitar el borrado de algún elemento en el servidor.</p>
</div>
<div class="paragraph">
<p>Parámetros:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>url</code>: URL destino</p>
</li>
<li>
<p><code>config</code>: objeto de configuración opcional.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><a href="http://codepen.io/alexsuch/pen/jhfdB">En el siguiente ejemplo</a>, eliminaremos un usuario.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="javascript"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12</div></td><td class="code"><span class="tok-nx">angular</span>
  <span class="tok-p">.</span><span class="tok-nx">module</span><span class="tok-p">(</span><span class="tok-s1">&#39;httpModule&#39;</span><span class="tok-p">,</span> <span class="tok-p">[])</span>
  <span class="tok-p">.</span><span class="tok-nx">controller</span><span class="tok-p">(</span><span class="tok-s1">&#39;MainCtrl&#39;</span><span class="tok-p">,</span> <span class="tok-kd">function</span><span class="tok-p">(</span><span class="tok-nx">$scope</span><span class="tok-p">,</span> <span class="tok-nx">$http</span><span class="tok-p">){</span>
    <span class="tok-nx">$http</span><span class="tok-p">.</span><span class="tok-k">delete</span><span class="tok-p">(</span>
      <span class="tok-s1">&#39;http://jsonplaceholder.typicode.com/users/1&#39;</span><span class="tok-p">)</span>
    <span class="tok-p">.</span><span class="tok-nx">success</span><span class="tok-p">(</span><span class="tok-kd">function</span><span class="tok-p">(</span><span class="tok-nx">data</span><span class="tok-p">){</span>
      <span class="tok-nx">alert</span><span class="tok-p">(</span><span class="tok-s1">&#39;Se ha eliminado el usuario con éxito&#39;</span><span class="tok-p">)</span>
    <span class="tok-p">})</span>
    <span class="tok-p">.</span><span class="tok-nx">error</span><span class="tok-p">(</span><span class="tok-kd">function</span><span class="tok-p">(</span><span class="tok-nx">data</span><span class="tok-p">){</span>
      <span class="tok-nx">alert</span><span class="tok-p">(</span><span class="tok-s1">&#39;Se ha producido un error&#39;</span><span class="tok-p">)</span>
    <span class="tok-p">});</span>
<span class="tok-p">});</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="html"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3
4</div></td><td class="code"><span class="tok-nt">&lt;div</span> <span class="tok-na">ng-app=</span><span class="tok-s">&quot;httpModule&quot;</span> <span class="tok-na">ng-controller=</span><span class="tok-s">&quot;MainCtrl&quot;</span><span class="tok-nt">&gt;</span>
  <span class="tok-nt">&lt;h1&gt;</span>Resultado<span class="tok-nt">&lt;/h1&gt;</span>
  <span class="tok-nt">&lt;hr</span> <span class="tok-nt">/&gt;</span>
<span class="tok-nt">&lt;/div&gt;</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="title">EJERCICIO</div>
Genera un pequeño programa, similar al del ejemplo, que contenga un botón y, al presionarlo, realice una petición <code>DELETE</code>  para eliminar el POST con id=1.
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_jsonp">11.1.5. JSONP</h4>
<div class="paragraph">
<p>Realiza una petición <code>JSONP</code>.</p>
</div>
<div class="paragraph">
<p>Parámetros:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>url</code>: URL destino. El nombre del <em>callback</em> debe ser, obligatoriamente, <code>JSON_CALLBACK</code></p>
</li>
<li>
<p><code>config</code>: objeto de configuración opcional.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><a href="http://codepen.io/alexsuch/pen/cyavD">En este ejemplo</a> haremos uso del servicio <code>$http.jsonp</code> para obtener los datos de un post.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="javascript"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11</div></td><td class="code"><span class="tok-nx">angular</span>
  <span class="tok-p">.</span><span class="tok-nx">module</span><span class="tok-p">(</span><span class="tok-s1">&#39;httpModule&#39;</span><span class="tok-p">,</span> <span class="tok-p">[])</span>
  <span class="tok-p">.</span><span class="tok-nx">controller</span><span class="tok-p">(</span><span class="tok-s1">&#39;MainCtrl&#39;</span><span class="tok-p">,</span> <span class="tok-kd">function</span><span class="tok-p">(</span><span class="tok-nx">$scope</span><span class="tok-p">,</span> <span class="tok-nx">$http</span><span class="tok-p">){</span>
    <span class="tok-nx">$http</span><span class="tok-p">.</span><span class="tok-nx">jsonp</span><span class="tok-p">(</span> <span class="tok-s1">&#39;http://jsonplaceholder.typicode.com/posts/1?callback=JSON_CALLBACK&#39;</span><span class="tok-p">)</span>
    <span class="tok-p">.</span><span class="tok-nx">success</span><span class="tok-p">(</span><span class="tok-kd">function</span><span class="tok-p">(</span><span class="tok-nx">data</span><span class="tok-p">){</span>
      <span class="tok-nx">$scope</span><span class="tok-p">.</span><span class="tok-nx">data</span> <span class="tok-o">=</span> <span class="tok-nx">data</span><span class="tok-p">;</span>
    <span class="tok-p">})</span>
    <span class="tok-p">.</span><span class="tok-nx">error</span><span class="tok-p">(</span><span class="tok-kd">function</span><span class="tok-p">(</span><span class="tok-nx">data</span><span class="tok-p">){</span>
      <span class="tok-nx">alert</span><span class="tok-p">(</span><span class="tok-s1">&#39;Se ha producido un error&#39;</span><span class="tok-p">)</span>
    <span class="tok-p">});</span>
<span class="tok-p">});</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="html"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3
4
5
6
7</div></td><td class="code"><span class="tok-nt">&lt;div</span> <span class="tok-na">ng-app=</span><span class="tok-s">&quot;httpModule&quot;</span> <span class="tok-na">ng-controller=</span><span class="tok-s">&quot;MainCtrl&quot;</span><span class="tok-nt">&gt;</span>
  <span class="tok-nt">&lt;h1&gt;</span>Resultado<span class="tok-nt">&lt;/h1&gt;</span>
  <span class="tok-nt">&lt;pre&gt;</span>
{{ data | json }}
  <span class="tok-nt">&lt;/pre&gt;</span>
  <span class="tok-nt">&lt;hr</span> <span class="tok-nt">/&gt;</span>
<span class="tok-nt">&lt;/div&gt;</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="title">EJERCICIO</div>
Genera un pequeño programa, similar al del ejemplo, que contenga un botón y, al presionarlo, realice una petición <code>JSONP</code>  para obtener los datos del usuario con id=1.
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_integración_con_servicios_restful_el_servicio_resource">11.2. Integración con servicios RESTful: el servicio $resource</h3>
<div class="paragraph">
<p>Como hemos visto en los ejemplos anteriores, el uso habitual de los servicios RESTful es para exponer operaciones CRUD, haciéndolas accesibles a través de una URL que acepta diferentes métodos HTTP.</p>
</div>
<div class="paragraph">
<p>El servicio $http nos da la posibilidad de interactuar con este tipo de servicios de manera sencilla. Sin embargo, disponemos de otro servicio, <code>$resource</code>, que nos permite hacer lo mismo eliminando además el código redundante.</p>
</div>
<div class="paragraph">
<p>El servicio <code>$resource</code> se distribuye en un módulo separado del <em>core</em> de AngularJS llamado <code>ngResource</code>. Es por ello que tendremos que descargarnos su código fuente y declarar una dependencia con este módulo donde lo vayamos a utilizar.</p>
</div>
<div class="paragraph">
<p>Para probarlo, seguiremos haciendo uso de los servicios de ejemplo de <code>jsonplaceholder</code>.</p>
</div>
<div class="paragraph">
<p>En primer lugar, crearemos un <code>resource</code> para la colección de usuarios del servicio:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="javascript"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1</div></td><td class="code">  <span class="tok-kd">var</span> <span class="tok-nx">User</span> <span class="tok-o">=</span> <span class="tok-nx">$resource</span><span class="tok-p">(</span><span class="tok-s1">&#39;http://jsonplaceholder.typicode.com/users/:id&#39;</span><span class="tok-p">,</span> <span class="tok-p">{</span><span class="tok-nx">id</span><span class="tok-o">:</span><span class="tok-s1">&#39;@id&#39;</span><span class="tok-p">}});</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>A partir de esta URL, el servicio <code>$resource</code> creará par nosotros una serie de métodos para interactuar con el servicio RESTful.</p>
</div>
<div class="paragraph">
<p>Si nos centramos en la sintaxis de la declaración, vemos que recibe dos parámetros:</p>
</div>
<div class="paragraph">
<p>El primero es obligatorio, y consiste en una URL que puede estar parametrizada. Los parámetros irán siempre prefijados por el símbolo de los dos puntos <code>:</code>, de igual manera que hacíamos con los servicios de routing.</p>
</div>
<div class="paragraph">
<p>En cuanto al segundo parámetro, es opcional y consiste en el conjunto de valores por defecto para los parámetros de la URL. Podemos sobreescribirlos luego en las llamadas a métodos concretos.</p>
</div>
<div class="paragraph">
<p>Si alguno de los parámetros es una función, se ejecutará siempre antes de cada uso.</p>
</div>
<div class="paragraph">
<p>En caso de que en la URL parametrizada no tenga alguno de los parámetros, se pasará como parametro de búsqueda en la URL. Ejemplo: para la URL <code>/camera/:brand</code> y los parámetros <code>{brand:'canon', filter:'EOS 1100d'}</code>, obrendríamos la URL <code>/camera/canon?filter=EOS%201100D</code></p>
</div>
<div class="paragraph">
<p>Si el valor del parámetro va precedido por una arroba <code>@</code>, entonces el valor de ese parámetro se extraerá del objeto que pasemos cuando invoquemos una acción, como veremos más adelante en los ejemplos.</p>
</div>
<div class="paragraph">
<p>El servicio acepta también un tercer parámetro, que veremos tras los ejemplos.</p>
</div>
<div class="paragraph">
<p>Volviendo al código que hemos generado</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="javascript"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1</div></td><td class="code">  <span class="tok-kd">var</span> <span class="tok-nx">User</span> <span class="tok-o">=</span> <span class="tok-nx">$resource</span><span class="tok-p">(</span><span class="tok-s1">&#39;http://jsonplaceholder.typicode.com/users/:id&#39;</span><span class="tok-p">,</span> <span class="tok-p">{</span><span class="tok-nx">id</span><span class="tok-o">:</span><span class="tok-s1">&#39;@id&#39;</span><span class="tok-p">}});</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>Veamos las operaciones que podemos realizar con él</p>
</div>
<div class="sect3">
<h4 id="_query">11.2.1. Query</h4>
<div class="paragraph">
<p>Forma: <code>User.query(params, successCallback, errorCallback)</code></p>
</div>
<div class="paragraph">
<p>Realiza una petición <code>GET</code>, y espera recibir un array de ítems en la respuesta JSON.</p>
</div>
<div class="paragraph">
<p>Como vemos <a href="http://codepen.io/alexsuch/pen/wystx">en el siguiente ejemplo</a>, el atributo <code>params</code> es opcional, así como el la función de callback de error:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="javascript"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11</div></td><td class="code"><span class="tok-nx">angular</span><span class="tok-p">.</span><span class="tok-nx">module</span><span class="tok-p">(</span><span class="tok-s1">&#39;restful&#39;</span><span class="tok-p">,</span> <span class="tok-p">[</span><span class="tok-s1">&#39;ngResource&#39;</span><span class="tok-p">])</span>
<span class="tok-p">.</span><span class="tok-nx">controller</span><span class="tok-p">(</span><span class="tok-s1">&#39;MainCtrl&#39;</span><span class="tok-p">,</span> <span class="tok-kd">function</span><span class="tok-p">(</span><span class="tok-nx">$scope</span><span class="tok-p">,</span> <span class="tok-nx">$resource</span><span class="tok-p">){</span>
  <span class="tok-kd">var</span> <span class="tok-nx">User</span> <span class="tok-o">=</span> <span class="tok-nx">$resource</span><span class="tok-p">(</span>
    <span class="tok-s1">&#39;http://jsonplaceholder.typicode.com/users/:id&#39;</span><span class="tok-p">,</span>
    <span class="tok-p">{</span><span class="tok-nx">id</span><span class="tok-o">:</span><span class="tok-s1">&#39;@id&#39;</span><span class="tok-p">}</span>
  <span class="tok-p">);</span>

  <span class="tok-kd">var</span> <span class="tok-nx">userList</span> <span class="tok-o">=</span> <span class="tok-nx">User</span><span class="tok-p">.</span><span class="tok-nx">query</span><span class="tok-p">(</span><span class="tok-kd">function</span><span class="tok-p">(</span><span class="tok-nx">userList</span><span class="tok-p">)</span> <span class="tok-p">{</span>
    <span class="tok-nx">$scope</span><span class="tok-p">.</span><span class="tok-nx">userList</span> <span class="tok-o">=</span> <span class="tok-nx">userList</span><span class="tok-p">;</span>
  <span class="tok-p">});</span>
<span class="tok-p">});</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="html"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3
4</div></td><td class="code"><span class="tok-nt">&lt;div</span> <span class="tok-na">ng-app=</span><span class="tok-s">&quot;restful&quot;</span> <span class="tok-na">ng-controller=</span><span class="tok-s">&quot;MainCtrl&quot;</span><span class="tok-nt">&gt;</span>
  <span class="tok-nt">&lt;h3&gt;</span>Query<span class="tok-nt">&lt;/h3&gt;</span>
  <span class="tok-nt">&lt;pre&gt;</span>{{ userList | json}}<span class="tok-nt">&lt;/pre&gt;</span>
<span class="tok-nt">&lt;/div&gt;</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>Aunque, si queremos, podemos acceder a la promesa de resultados que genera la petición del servicio <code>$http</code> <a href="http://codepen.io/alexsuch/pen/oHCKD">de la siguiente manera</a>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="javascript"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13</div></td><td class="code"><span class="tok-nx">angular</span><span class="tok-p">.</span><span class="tok-nx">module</span><span class="tok-p">(</span><span class="tok-s1">&#39;restful&#39;</span><span class="tok-p">,</span> <span class="tok-p">[</span><span class="tok-s1">&#39;ngResource&#39;</span><span class="tok-p">])</span>
<span class="tok-p">.</span><span class="tok-nx">controller</span><span class="tok-p">(</span><span class="tok-s1">&#39;MainCtrl&#39;</span><span class="tok-p">,</span> <span class="tok-kd">function</span><span class="tok-p">(</span><span class="tok-nx">$scope</span><span class="tok-p">,</span> <span class="tok-nx">$resource</span><span class="tok-p">){</span>
  <span class="tok-kd">var</span> <span class="tok-nx">User</span> <span class="tok-o">=</span> <span class="tok-nx">$resource</span><span class="tok-p">(</span>
    <span class="tok-s1">&#39;http://jsonplaceholder.typicode.com/users/:id&#39;</span><span class="tok-p">,</span>
    <span class="tok-p">{</span><span class="tok-nx">id</span><span class="tok-o">:</span><span class="tok-s1">&#39;@id&#39;</span><span class="tok-p">}</span>
  <span class="tok-p">);</span>

  <span class="tok-kd">var</span> <span class="tok-nx">userList</span> <span class="tok-o">=</span> <span class="tok-nx">User</span>
    <span class="tok-p">.</span><span class="tok-nx">query</span><span class="tok-p">().</span><span class="tok-nx">$promise</span>
    <span class="tok-p">.</span><span class="tok-nx">then</span><span class="tok-p">(</span><span class="tok-kd">function</span><span class="tok-p">(</span><span class="tok-nx">userList</span><span class="tok-p">)</span> <span class="tok-p">{</span>
      <span class="tok-nx">$scope</span><span class="tok-p">.</span><span class="tok-nx">userList</span> <span class="tok-o">=</span> <span class="tok-nx">userList</span><span class="tok-p">;</span>
    <span class="tok-p">});</span>
<span class="tok-p">});</span>
</td></tr></table></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_get">11.2.2. Get</h4>
<div class="paragraph">
<p>Forma: <code>User.get(params, successCallback, errorCallback)</code></p>
</div>
<div class="paragraph">
<p>Realiza una petición GET al servidor, y espera recibir un objeto como resultado de la respuesta JSON.</p>
</div>
<div class="paragraph">
<p><a href="http://codepen.io/alexsuch/pen/lCsmA">Ejemplo</a>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="javascript"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11</div></td><td class="code"><span class="tok-nx">angular</span><span class="tok-p">.</span><span class="tok-nx">module</span><span class="tok-p">(</span><span class="tok-s1">&#39;restful&#39;</span><span class="tok-p">,</span> <span class="tok-p">[</span><span class="tok-s1">&#39;ngResource&#39;</span><span class="tok-p">])</span>
<span class="tok-p">.</span><span class="tok-nx">controller</span><span class="tok-p">(</span><span class="tok-s1">&#39;MainCtrl&#39;</span><span class="tok-p">,</span> <span class="tok-kd">function</span><span class="tok-p">(</span><span class="tok-nx">$scope</span><span class="tok-p">,</span> <span class="tok-nx">$resource</span><span class="tok-p">){</span>
  <span class="tok-kd">var</span> <span class="tok-nx">User</span> <span class="tok-o">=</span> <span class="tok-nx">$resource</span><span class="tok-p">(</span>
    <span class="tok-s1">&#39;http://jsonplaceholder.typicode.com/users/:id&#39;</span><span class="tok-p">,</span>
    <span class="tok-p">{</span><span class="tok-nx">id</span><span class="tok-o">:</span><span class="tok-s1">&#39;@id&#39;</span><span class="tok-p">}</span>
  <span class="tok-p">);</span>

  <span class="tok-kd">var</span> <span class="tok-nx">user</span> <span class="tok-o">=</span> <span class="tok-nx">User</span><span class="tok-p">.</span><span class="tok-nx">get</span><span class="tok-p">({</span><span class="tok-nx">id</span><span class="tok-o">:</span><span class="tok-mi">1</span><span class="tok-p">},</span> <span class="tok-kd">function</span><span class="tok-p">(</span><span class="tok-nx">user</span><span class="tok-p">)</span> <span class="tok-p">{</span>
    <span class="tok-nx">$scope</span><span class="tok-p">.</span><span class="tok-nx">user</span> <span class="tok-o">=</span> <span class="tok-nx">user</span><span class="tok-p">;</span>
  <span class="tok-p">});</span>
<span class="tok-p">});</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="html"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3
4</div></td><td class="code"><span class="tok-nt">&lt;div</span> <span class="tok-na">ng-app=</span><span class="tok-s">&quot;restful&quot;</span> <span class="tok-na">ng-controller=</span><span class="tok-s">&quot;MainCtrl&quot;</span><span class="tok-nt">&gt;</span>
  <span class="tok-nt">&lt;h3&gt;</span>GET<span class="tok-nt">&lt;/h3&gt;</span>
  <span class="tok-nt">&lt;pre&gt;</span>{{ user | json}}<span class="tok-nt">&lt;/pre&gt;</span>
<span class="tok-nt">&lt;/div&gt;</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>En este caso, hemos pasado un objeto como primer parámetro que tiene el atributo <code>id</code>.  Éste reemplazará el valor en el <em>template</em> de la url por el valor <code>1</code>.</p>
</div>
</div>
<div class="sect3">
<h4 id="_save">11.2.3. Save</h4>
<div class="paragraph">
<p>Forma: <code>User.save(params, payloadData, successCallback, errorCallback)</code>.</p>
</div>
<div class="paragraph">
<p>Envía una petición POST al servido. El cuerpo de la petición será el objeto que pasemos en el atributo <code>payloadData</code>.</p>
</div>
<div class="paragraph">
<p><a href="http://codepen.io/alexsuch/pen/pEcjw">Ejemplo</a>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="javascript"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24</div></td><td class="code"><span class="tok-nx">angular</span><span class="tok-p">.</span><span class="tok-nx">module</span><span class="tok-p">(</span><span class="tok-s1">&#39;restful&#39;</span><span class="tok-p">,</span> <span class="tok-p">[</span><span class="tok-s1">&#39;ngResource&#39;</span><span class="tok-p">])</span>
<span class="tok-p">.</span><span class="tok-nx">controller</span><span class="tok-p">(</span><span class="tok-s1">&#39;MainCtrl&#39;</span><span class="tok-p">,</span> <span class="tok-kd">function</span><span class="tok-p">(</span><span class="tok-nx">$scope</span><span class="tok-p">,</span> <span class="tok-nx">$resource</span><span class="tok-p">){</span>
  <span class="tok-kd">var</span> <span class="tok-nx">userToSave</span> <span class="tok-o">=</span> <span class="tok-p">{</span>
    <span class="tok-s2">&quot;id&quot;</span><span class="tok-o">:</span> <span class="tok-mi">1</span><span class="tok-p">,</span>
    <span class="tok-s2">&quot;name&quot;</span><span class="tok-o">:</span> <span class="tok-s2">&quot;Winchester McFly&quot;</span><span class="tok-p">,</span>
    <span class="tok-s2">&quot;username&quot;</span><span class="tok-o">:</span> <span class="tok-s2">&quot;wmf&quot;</span><span class="tok-p">,</span>
    <span class="tok-s2">&quot;email&quot;</span><span class="tok-o">:</span> <span class="tok-s2">&quot;wmf@hdh.com&quot;</span><span class="tok-p">,</span>
  <span class="tok-p">};</span>

  <span class="tok-kd">var</span> <span class="tok-nx">User</span> <span class="tok-o">=</span> <span class="tok-nx">$resource</span><span class="tok-p">(</span>
    <span class="tok-s1">&#39;http://jsonplaceholder.typicode.com/users/:id&#39;</span><span class="tok-p">,</span>
    <span class="tok-p">{</span><span class="tok-nx">id</span><span class="tok-o">:</span><span class="tok-s1">&#39;@id&#39;</span><span class="tok-p">}</span>
  <span class="tok-p">);</span>

  <span class="tok-nx">User</span><span class="tok-p">.</span><span class="tok-nx">save</span><span class="tok-p">(</span>
    <span class="tok-nx">userToSave</span><span class="tok-p">,</span>
    <span class="tok-kd">function</span><span class="tok-p">(){</span>
      <span class="tok-nx">$scope</span><span class="tok-p">.</span><span class="tok-nx">message</span> <span class="tok-o">=</span> <span class="tok-s1">&#39;usuario guardado con éxito&#39;</span><span class="tok-p">;</span>
    <span class="tok-p">},</span>
    <span class="tok-kd">function</span><span class="tok-p">(){</span>
      <span class="tok-nx">$scope</span><span class="tok-p">.</span><span class="tok-nx">message</span> <span class="tok-o">=</span> <span class="tok-s1">&#39;error al guardar&#39;</span><span class="tok-p">;</span>
    <span class="tok-p">}</span>
  <span class="tok-p">);</span>
<span class="tok-p">});</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="html"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3
4</div></td><td class="code"><span class="tok-nt">&lt;div</span> <span class="tok-na">ng-app=</span><span class="tok-s">&quot;restful&quot;</span> <span class="tok-na">ng-controller=</span><span class="tok-s">&quot;MainCtrl&quot;</span><span class="tok-nt">&gt;</span>
  <span class="tok-nt">&lt;h3&gt;</span>Save<span class="tok-nt">&lt;/h3&gt;</span>
  <span class="tok-nt">&lt;pre&gt;</span>{{ message | json}}<span class="tok-nt">&lt;/pre&gt;</span>
<span class="tok-nt">&lt;/div&gt;</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>En este caso, hemos introducido función de <em>callback</em> de error, ya que la API no nos permite realizar peticiones POST.</p>
</div>
</div>
<div class="sect3">
<h4 id="_delete_2">11.2.4. Delete</h4>
<div class="paragraph">
<p>Formas:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>User.delete(params, successCallback, errorCallback)</code></p>
</li>
<li>
<p><code>User.remove(params, successCallback, errorCallback)</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Realiza una petición HTTP DELETE al servidor. <a href="http://codepen.io/alexsuch/pen/wAGpq">Ejemplo</a>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="javascript"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17</div></td><td class="code"><span class="tok-nx">angular</span><span class="tok-p">.</span><span class="tok-nx">module</span><span class="tok-p">(</span><span class="tok-s1">&#39;restful&#39;</span><span class="tok-p">,</span> <span class="tok-p">[</span><span class="tok-s1">&#39;ngResource&#39;</span><span class="tok-p">])</span>
<span class="tok-p">.</span><span class="tok-nx">controller</span><span class="tok-p">(</span><span class="tok-s1">&#39;MainCtrl&#39;</span><span class="tok-p">,</span> <span class="tok-kd">function</span><span class="tok-p">(</span><span class="tok-nx">$scope</span><span class="tok-p">,</span> <span class="tok-nx">$resource</span><span class="tok-p">){</span>
  <span class="tok-kd">var</span> <span class="tok-nx">User</span> <span class="tok-o">=</span> <span class="tok-nx">$resource</span><span class="tok-p">(</span>
    <span class="tok-s1">&#39;http://jsonplaceholder.typicode.com/users/:id&#39;</span><span class="tok-p">,</span>
    <span class="tok-p">{</span><span class="tok-nx">id</span><span class="tok-o">:</span><span class="tok-s1">&#39;@id&#39;</span><span class="tok-p">}</span>
  <span class="tok-p">);</span>

  <span class="tok-nx">User</span><span class="tok-p">.</span><span class="tok-k">delete</span><span class="tok-p">(</span>
    <span class="tok-p">{</span><span class="tok-nx">id</span><span class="tok-o">:</span><span class="tok-mi">1</span><span class="tok-p">},</span>
    <span class="tok-kd">function</span><span class="tok-p">(){</span>
      <span class="tok-nx">$scope</span><span class="tok-p">.</span><span class="tok-nx">message</span> <span class="tok-o">=</span> <span class="tok-s1">&#39;Usuario eliminado correctamente&#39;</span>
    <span class="tok-p">},</span>
    <span class="tok-kd">function</span><span class="tok-p">(){</span>
      <span class="tok-nx">$scope</span><span class="tok-p">.</span><span class="tok-nx">message</span> <span class="tok-o">=</span> <span class="tok-s1">&#39;Eror al eliminar&#39;</span>
    <span class="tok-p">}</span>
  <span class="tok-p">);</span>
<span class="tok-p">});</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="html"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3
4</div></td><td class="code"><span class="tok-nt">&lt;div</span> <span class="tok-na">ng-app=</span><span class="tok-s">&quot;restful&quot;</span> <span class="tok-na">ng-controller=</span><span class="tok-s">&quot;MainCtrl&quot;</span><span class="tok-nt">&gt;</span>
  <span class="tok-nt">&lt;h3&gt;</span>Save<span class="tok-nt">&lt;/h3&gt;</span>
  <span class="tok-nt">&lt;pre&gt;</span>{{ message | json}}<span class="tok-nt">&lt;/pre&gt;</span>
<span class="tok-nt">&lt;/div&gt;</span>
</td></tr></table></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_definiendo_acciones_nuevas">11.2.5. Definiendo acciones nuevas</h4>
<div class="paragraph">
<p>Los métodos vistos (<code>query</code>, <code>get</code>, <code>save</code> y <code>delete</code>) son los únicos métodos que proporciona el servicio $resource, con el que podríamos comunicarnos con una gran cantidad de servicios RESTful.</p>
</div>
<div class="paragraph">
<p>Pero, ¿qué pasa si me comunico con una API que usa POST para guardar ítems nuevos, mientras espera PUT para actualizar ítems existentes? ¿Ya no es válido el servicio <code>$resource</code>?</p>
</div>
<div class="paragraph">
<p>Aunque no viene un método PUT por defecto en el servicio, sí que tenemos la posibilidad de crearlo. Es aquí donde entra en juego el tercer parámetro que habíamos obviado hasta ahora en la creación del servicio.</p>
</div>
<div class="paragraph">
<p>En él podemos definir nuevas acciones en nuestro servicio. Se trata de un <em>hash</em> donde declararemos todas las acciones <em>custom</em> que queramos añadir. <a href="https://docs.angularjs.org/api/ngResource/service/$resource">La documentación de AngularJS</a> detalla al completo todos los parámetros que recibe. Nosotros, <a href="http://codepen.io/alexsuch/pen/sgJlI">declararemos una función <code>update</code></a> que realizará una petición PUT al servidor:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="javascript"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27</div></td><td class="code"><span class="tok-nx">angular</span><span class="tok-p">.</span><span class="tok-nx">module</span><span class="tok-p">(</span><span class="tok-s1">&#39;restful&#39;</span><span class="tok-p">,</span> <span class="tok-p">[</span><span class="tok-s1">&#39;ngResource&#39;</span><span class="tok-p">])</span>
<span class="tok-p">.</span><span class="tok-nx">controller</span><span class="tok-p">(</span><span class="tok-s1">&#39;MainCtrl&#39;</span><span class="tok-p">,</span> <span class="tok-kd">function</span><span class="tok-p">(</span><span class="tok-nx">$scope</span><span class="tok-p">,</span> <span class="tok-nx">$resource</span><span class="tok-p">){</span>
  <span class="tok-kd">var</span> <span class="tok-nx">userToUpdate</span> <span class="tok-o">=</span> <span class="tok-p">{</span>
    <span class="tok-s2">&quot;id&quot;</span><span class="tok-o">:</span> <span class="tok-mi">1</span><span class="tok-p">,</span>
    <span class="tok-s2">&quot;name&quot;</span><span class="tok-o">:</span> <span class="tok-s2">&quot;Winchester McFly&quot;</span><span class="tok-p">,</span>
    <span class="tok-s2">&quot;username&quot;</span><span class="tok-o">:</span> <span class="tok-s2">&quot;wmf&quot;</span><span class="tok-p">,</span>
    <span class="tok-s2">&quot;email&quot;</span><span class="tok-o">:</span> <span class="tok-s2">&quot;wmf@hdh.com&quot;</span><span class="tok-p">,</span>
  <span class="tok-p">};</span>

  <span class="tok-kd">var</span> <span class="tok-nx">User</span> <span class="tok-o">=</span> <span class="tok-nx">$resource</span><span class="tok-p">(</span>
    <span class="tok-s1">&#39;http://jsonplaceholder.typicode.com/users/:id&#39;</span><span class="tok-p">,</span>
    <span class="tok-p">{</span><span class="tok-nx">id</span><span class="tok-o">:</span><span class="tok-s1">&#39;@id&#39;</span><span class="tok-p">},</span>
    <span class="tok-p">{</span>
      <span class="tok-nx">update</span><span class="tok-o">:</span> <span class="tok-p">{</span><span class="tok-nx">method</span><span class="tok-o">:</span><span class="tok-s1">&#39;PUT&#39;</span><span class="tok-p">}</span>
    <span class="tok-p">}</span>
  <span class="tok-p">);</span>

  <span class="tok-nx">User</span><span class="tok-p">.</span><span class="tok-nx">update</span><span class="tok-p">(</span>
    <span class="tok-nx">userToUpdate</span><span class="tok-p">,</span>
    <span class="tok-kd">function</span><span class="tok-p">(</span><span class="tok-nx">data</span><span class="tok-p">){</span>
      <span class="tok-nx">$scope</span><span class="tok-p">.</span><span class="tok-nx">message</span> <span class="tok-o">=</span> <span class="tok-nx">data</span><span class="tok-p">;</span>
    <span class="tok-p">},</span>
    <span class="tok-kd">function</span><span class="tok-p">(){</span>
      <span class="tok-nx">$scope</span><span class="tok-p">.</span><span class="tok-nx">message</span> <span class="tok-o">=</span> <span class="tok-s1">&#39;error al actualizar&#39;</span><span class="tok-p">;</span>
    <span class="tok-p">}</span>
  <span class="tok-p">);</span>
<span class="tok-p">});</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="html"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3
4</div></td><td class="code"><span class="tok-nt">&lt;div</span> <span class="tok-na">ng-app=</span><span class="tok-s">&quot;restful&quot;</span> <span class="tok-na">ng-controller=</span><span class="tok-s">&quot;MainCtrl&quot;</span><span class="tok-nt">&gt;</span>
  <span class="tok-nt">&lt;h3&gt;</span>Save<span class="tok-nt">&lt;/h3&gt;</span>
  <span class="tok-nt">&lt;pre&gt;</span>{{ message | json}}<span class="tok-nt">&lt;/pre&gt;</span>
<span class="tok-nt">&lt;/div&gt;</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="title">EJERCICIO</div>
Adapta los ejemplos para conseguir aplicaciones que hagan lo mismo con comentarios (<code>query</code>, <code>get</code>, <code>update</code>).
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_métodos_a_nivel_de_instancia">11.2.6. Métodos a nivel de instancia</h4>
<div class="paragraph">
<p>Puede que haya llamado la atención la declaración <code>var User = $resource(&#8230;&#8203;)</code>, por haber usado mayúsculas. Esto es porque <code>$resource</code> genera una clase, y todos los métodos que hemos visto los hemos invocado a nivel de constructor.</p>
</div>
<div class="paragraph">
<p>Sin embargo, también podemos crear instancias de la clase <code>User</code>, lo que expone métodos a nivel de dicha instancia. Los métodos serán los mismos, pero prefijados por el símbolo del dólar <code>$</code>.</p>
</div>
<div class="paragraph">
<p><a href="http://codepen.io/alexsuch/pen/icwyd">Ejemplo</a>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="javascript"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30</div></td><td class="code"><span class="tok-nx">angular</span><span class="tok-p">.</span><span class="tok-nx">module</span><span class="tok-p">(</span><span class="tok-s1">&#39;restful&#39;</span><span class="tok-p">,</span> <span class="tok-p">[</span><span class="tok-s1">&#39;ngResource&#39;</span><span class="tok-p">])</span>
<span class="tok-p">.</span><span class="tok-nx">controller</span><span class="tok-p">(</span><span class="tok-s1">&#39;MainCtrl&#39;</span><span class="tok-p">,</span> <span class="tok-kd">function</span><span class="tok-p">(</span><span class="tok-nx">$scope</span><span class="tok-p">,</span> <span class="tok-nx">$resource</span><span class="tok-p">){</span>
  <span class="tok-kd">var</span> <span class="tok-nx">data</span> <span class="tok-o">=</span> <span class="tok-p">{</span>
    <span class="tok-s2">&quot;id&quot;</span><span class="tok-o">:</span> <span class="tok-mi">1</span><span class="tok-p">,</span>
    <span class="tok-s2">&quot;name&quot;</span><span class="tok-o">:</span> <span class="tok-s2">&quot;Winchester McFly&quot;</span><span class="tok-p">,</span>
    <span class="tok-s2">&quot;username&quot;</span><span class="tok-o">:</span> <span class="tok-s2">&quot;wmf&quot;</span><span class="tok-p">,</span>
    <span class="tok-s2">&quot;email&quot;</span><span class="tok-o">:</span> <span class="tok-s2">&quot;wmf@hdh.com&quot;</span><span class="tok-p">,</span>
  <span class="tok-p">};</span>

  <span class="tok-kd">var</span> <span class="tok-nx">User</span> <span class="tok-o">=</span> <span class="tok-nx">$resource</span><span class="tok-p">(</span><span class="tok-s1">&#39;http://jsonplaceholder.typicode.com/users/:id&#39;</span><span class="tok-p">,</span> <span class="tok-p">{</span><span class="tok-nx">id</span><span class="tok-o">:</span><span class="tok-s1">&#39;@id&#39;</span><span class="tok-p">},</span> <span class="tok-p">{</span><span class="tok-nx">update</span><span class="tok-o">:</span> <span class="tok-p">{</span><span class="tok-nx">method</span><span class="tok-o">:</span><span class="tok-s1">&#39;PUT&#39;</span><span class="tok-p">}});</span>

  <span class="tok-kd">var</span> <span class="tok-nx">u1</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-nx">User</span><span class="tok-p">(</span><span class="tok-nx">data</span><span class="tok-p">);</span>
  <span class="tok-kd">var</span> <span class="tok-nx">u2</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-nx">User</span><span class="tok-p">(</span><span class="tok-nx">data</span><span class="tok-p">);</span>
  <span class="tok-kd">var</span> <span class="tok-nx">u3</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-nx">User</span><span class="tok-p">(</span><span class="tok-nx">data</span><span class="tok-p">);</span>

  <span class="tok-nx">u1</span><span class="tok-p">.</span><span class="tok-nx">$delete</span><span class="tok-p">(</span>
    <span class="tok-kd">function</span><span class="tok-p">(</span><span class="tok-nx">res</span><span class="tok-p">){</span> <span class="tok-nx">$scope</span><span class="tok-p">.</span><span class="tok-nx">message1</span> <span class="tok-o">=</span> <span class="tok-nx">res</span><span class="tok-p">;</span> <span class="tok-p">},</span>
    <span class="tok-kd">function</span><span class="tok-p">(</span><span class="tok-nx">res</span><span class="tok-p">){</span> <span class="tok-nx">$scope</span><span class="tok-p">.</span><span class="tok-nx">message1</span> <span class="tok-o">=</span> <span class="tok-s1">&#39;error al eliminar&#39;</span><span class="tok-p">;</span> <span class="tok-p">}</span>
  <span class="tok-p">);</span>

  <span class="tok-nx">u1</span><span class="tok-p">.</span><span class="tok-nx">$save</span><span class="tok-p">(</span>
    <span class="tok-kd">function</span><span class="tok-p">(</span><span class="tok-nx">res</span><span class="tok-p">){</span> <span class="tok-nx">$scope</span><span class="tok-p">.</span><span class="tok-nx">message2</span> <span class="tok-o">=</span> <span class="tok-nx">res</span><span class="tok-p">;</span> <span class="tok-p">},</span>
    <span class="tok-kd">function</span><span class="tok-p">(</span><span class="tok-nx">res</span><span class="tok-p">){</span> <span class="tok-nx">$scope</span><span class="tok-p">.</span><span class="tok-nx">message2</span> <span class="tok-o">=</span> <span class="tok-s1">&#39;error al guardar&#39;</span><span class="tok-p">;</span> <span class="tok-p">}</span>
  <span class="tok-p">);</span>

  <span class="tok-nx">u1</span><span class="tok-p">.</span><span class="tok-nx">$update</span><span class="tok-p">(</span>
    <span class="tok-kd">function</span><span class="tok-p">(</span><span class="tok-nx">res</span><span class="tok-p">){</span> <span class="tok-nx">$scope</span><span class="tok-p">.</span><span class="tok-nx">message3</span> <span class="tok-o">=</span> <span class="tok-nx">res</span><span class="tok-p">;</span> <span class="tok-p">},</span>
    <span class="tok-kd">function</span><span class="tok-p">(</span><span class="tok-nx">res</span><span class="tok-p">){</span> <span class="tok-nx">$scope</span><span class="tok-p">.</span><span class="tok-nx">message3</span> <span class="tok-o">=</span> <span class="tok-s1">&#39;error al actualizar&#39;</span><span class="tok-p">;</span> <span class="tok-p">}</span>
  <span class="tok-p">);</span>
<span class="tok-p">});</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="html"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10</div></td><td class="code"><span class="tok-nt">&lt;div</span> <span class="tok-na">ng-app=</span><span class="tok-s">&quot;restful&quot;</span> <span class="tok-na">ng-controller=</span><span class="tok-s">&quot;MainCtrl&quot;</span><span class="tok-nt">&gt;</span>
  <span class="tok-nt">&lt;h3&gt;</span>Delete<span class="tok-nt">&lt;/h3&gt;</span>
  <span class="tok-nt">&lt;pre&gt;</span>{{ message1 | json}}<span class="tok-nt">&lt;/pre&gt;</span>

  <span class="tok-nt">&lt;h3&gt;</span>Save<span class="tok-nt">&lt;/h3&gt;</span>
  <span class="tok-nt">&lt;pre&gt;</span>{{ message2 | json}}<span class="tok-nt">&lt;/pre&gt;</span>

  <span class="tok-nt">&lt;h3&gt;</span>Update<span class="tok-nt">&lt;/h3&gt;</span>
  <span class="tok-nt">&lt;pre&gt;</span>{{ message3 | json}}<span class="tok-nt">&lt;/pre&gt;</span>
<span class="tok-nt">&lt;/div&gt;</span>
</td></tr></table></code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_interceptores">11.3. Interceptores</h3>
<div class="paragraph">
<p>El servicio <code>$http</code> de AngularJS nos permite registrar interceptores que se ejecutarán en cada petición. Éstos resultan muy útiles cuando queremos realizar algún tipo de procesamiento sobre todas, o prácticamente todas las peticiones.</p>
</div>
<div class="paragraph">
<p>Supongamos que queremos comprobar cuándo tenemos permisos para realizar una petición. Para ello, podemos definir un interceptor que comprueba el código de estado de la respuesta y, si es un 401 (<em>HTTP 401 Unauthorized</em>), relanza lanza un evento indicando que se está realizando una operación no autorizada. Además, modificará todas las peticiones que enviemos, añadiendo las cabeceras de autorización básica.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="javascript"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86</div></td><td class="code"><span class="tok-nx">angular</span>
  <span class="tok-p">.</span><span class="tok-nx">module</span><span class="tok-p">(</span><span class="tok-s1">&#39;auth&#39;</span><span class="tok-p">,</span> <span class="tok-p">[])</span>
  <span class="tok-p">.</span><span class="tok-nx">factory</span><span class="tok-p">(</span><span class="tok-s1">&#39;AuthService&#39;</span><span class="tok-p">,</span> <span class="tok-p">[</span><span class="tok-s1">&#39;$log&#39;</span><span class="tok-p">,</span> <span class="tok-kd">function</span> <span class="tok-p">(</span><span class="tok-nx">$log</span><span class="tok-p">)</span> <span class="tok-p">{</span>
    <span class="tok-kd">var</span> <span class="tok-nx">instance</span> <span class="tok-o">=</span> <span class="tok-p">{};</span>
    <span class="tok-kd">var</span> <span class="tok-nx">authServiceLastDate</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-nb">Date</span><span class="tok-p">();</span>
    <span class="tok-kd">var</span> <span class="tok-nx">userData</span> <span class="tok-o">=</span> <span class="tok-kc">null</span><span class="tok-p">;</span>
    <span class="tok-kd">var</span> <span class="tok-nx">authToken</span> <span class="tok-o">=</span> <span class="tok-kc">null</span><span class="tok-p">;</span>

    <span class="tok-kd">var</span> <span class="tok-nx">doCheck</span> <span class="tok-o">=</span> <span class="tok-kd">function</span><span class="tok-p">(){</span>
      <span class="tok-k">if</span><span class="tok-p">((</span><span class="tok-k">new</span> <span class="tok-nb">Date</span><span class="tok-p">()).</span><span class="tok-nx">add</span><span class="tok-p">(</span><span class="tok-o">-</span><span class="tok-mi">30</span><span class="tok-p">).</span><span class="tok-nx">minutes</span><span class="tok-p">().</span><span class="tok-nx">getTime</span><span class="tok-p">()</span> <span class="tok-o">&gt;</span> <span class="tok-nx">authServiceLastDate</span><span class="tok-p">)</span> <span class="tok-p">{</span>
        <span class="tok-nx">$log</span><span class="tok-p">.</span><span class="tok-nx">debug</span><span class="tok-p">(</span><span class="tok-s1">&#39;Session expired.&#39;</span><span class="tok-p">);</span>
        <span class="tok-nx">authServiceLastDate</span> <span class="tok-o">=</span> <span class="tok-kc">null</span><span class="tok-p">;</span>
        <span class="tok-nx">userData</span> <span class="tok-o">=</span> <span class="tok-kc">null</span><span class="tok-p">;</span>
      <span class="tok-p">}</span>

      <span class="tok-nx">authServiceLastDate</span> <span class="tok-o">=</span> <span class="tok-p">(</span><span class="tok-k">new</span> <span class="tok-nb">Date</span><span class="tok-p">()).</span><span class="tok-nx">getTime</span><span class="tok-p">();</span>
    <span class="tok-p">};</span>

    <span class="tok-nx">instance</span><span class="tok-p">.</span><span class="tok-nx">setUserData</span> <span class="tok-o">=</span> <span class="tok-kd">function</span> <span class="tok-p">(</span><span class="tok-nx">userData</span><span class="tok-p">)</span> <span class="tok-p">{</span>
      <span class="tok-nx">authServiceLastDate</span> <span class="tok-o">=</span> <span class="tok-p">(</span><span class="tok-k">new</span> <span class="tok-nb">Date</span><span class="tok-p">()).</span><span class="tok-nx">getTime</span><span class="tok-p">();</span>
      <span class="tok-nx">userData</span> <span class="tok-o">=</span> <span class="tok-nx">userData</span><span class="tok-p">;</span>
    <span class="tok-p">};</span>

    <span class="tok-nx">instance</span><span class="tok-p">.</span><span class="tok-nx">getUserData</span> <span class="tok-o">=</span> <span class="tok-kd">function</span> <span class="tok-p">()</span> <span class="tok-p">{</span>
      <span class="tok-nx">doCheck</span><span class="tok-p">();</span>
      <span class="tok-k">return</span> <span class="tok-nx">userData</span><span class="tok-p">;</span>
    <span class="tok-p">};</span>

    <span class="tok-nx">instance</span><span class="tok-p">.</span><span class="tok-nx">deleteUserData</span> <span class="tok-o">=</span> <span class="tok-kd">function</span> <span class="tok-p">()</span> <span class="tok-p">{</span>
      <span class="tok-nx">userData</span> <span class="tok-o">=</span> <span class="tok-kc">null</span><span class="tok-p">;</span>
    <span class="tok-p">};</span>

    <span class="tok-nx">instance</span><span class="tok-p">.</span><span class="tok-nx">createBasicAuthToken</span> <span class="tok-o">=</span> <span class="tok-kd">function</span><span class="tok-p">(</span><span class="tok-nx">login</span><span class="tok-p">,</span> <span class="tok-nx">password</span><span class="tok-p">)</span> <span class="tok-p">{</span>
      <span class="tok-k">return</span> <span class="tok-nx">btoa</span><span class="tok-p">(</span><span class="tok-nx">login</span> <span class="tok-o">+</span> <span class="tok-s1">&#39;:&#39;</span> <span class="tok-o">+</span> <span class="tok-nx">password</span><span class="tok-p">);</span>
    <span class="tok-p">};</span>

    <span class="tok-nx">instance</span><span class="tok-p">.</span><span class="tok-nx">setToken</span> <span class="tok-o">=</span> <span class="tok-kd">function</span> <span class="tok-p">(</span><span class="tok-nx">token</span><span class="tok-p">)</span> <span class="tok-p">{</span>
      <span class="tok-nx">authServiceLastDate</span> <span class="tok-o">=</span> <span class="tok-p">(</span><span class="tok-k">new</span> <span class="tok-nb">Date</span><span class="tok-p">()).</span><span class="tok-nx">getTime</span><span class="tok-p">();</span>
      <span class="tok-nx">authToken</span> <span class="tok-o">=</span> <span class="tok-nx">token</span><span class="tok-p">;</span>
    <span class="tok-p">};</span>

    <span class="tok-nx">instance</span><span class="tok-p">.</span><span class="tok-nx">getToken</span> <span class="tok-o">=</span> <span class="tok-kd">function</span> <span class="tok-p">()</span> <span class="tok-p">{</span>
      <span class="tok-nx">doCheck</span><span class="tok-p">();</span>
      <span class="tok-k">return</span> <span class="tok-nx">authToken</span><span class="tok-p">;</span>
    <span class="tok-p">};</span>

    <span class="tok-nx">instance</span><span class="tok-p">.</span><span class="tok-nx">deleteToken</span> <span class="tok-o">=</span> <span class="tok-kd">function</span> <span class="tok-p">()</span> <span class="tok-p">{</span>
      <span class="tok-nx">authToken</span> <span class="tok-o">=</span> <span class="tok-kc">null</span><span class="tok-p">;</span>
    <span class="tok-p">};</span>

    <span class="tok-k">return</span> <span class="tok-nx">instance</span><span class="tok-p">;</span>
  <span class="tok-p">}]);</span>
  <span class="tok-p">.</span><span class="tok-nx">factory</span><span class="tok-p">(</span><span class="tok-s1">&#39;AuthInterceptor&#39;</span><span class="tok-p">,</span> <span class="tok-p">[</span><span class="tok-s1">&#39;$rootScope&#39;</span><span class="tok-p">,</span> <span class="tok-s1">&#39;$q&#39;</span><span class="tok-p">,</span> <span class="tok-s1">&#39;AuthService&#39;</span><span class="tok-p">,</span> <span class="tok-kd">function</span> <span class="tok-p">(</span><span class="tok-nx">$rootScope</span><span class="tok-p">,</span> <span class="tok-nx">$q</span><span class="tok-p">,</span> <span class="tok-nx">AuthService</span><span class="tok-p">)</span> <span class="tok-p">{</span>
    <span class="tok-kd">var</span> <span class="tok-nx">instance</span> <span class="tok-o">=</span> <span class="tok-p">{};</span>

    <span class="tok-nx">instance</span><span class="tok-p">.</span><span class="tok-nx">request</span> <span class="tok-o">=</span> <span class="tok-kd">function</span><span class="tok-p">(</span><span class="tok-nx">config</span><span class="tok-p">)</span> <span class="tok-p">{</span>
      <span class="tok-nx">config</span><span class="tok-p">.</span><span class="tok-nx">headers</span> <span class="tok-o">=</span> <span class="tok-nx">config</span><span class="tok-p">.</span><span class="tok-nx">headers</span> <span class="tok-o">||</span> <span class="tok-p">{};</span>

      <span class="tok-k">if</span> <span class="tok-p">(</span><span class="tok-o">!!</span><span class="tok-nx">AuthService</span><span class="tok-p">.</span><span class="tok-nx">getToken</span><span class="tok-p">())</span> <span class="tok-p">{</span>
        <span class="tok-nx">config</span><span class="tok-p">.</span><span class="tok-nx">headers</span><span class="tok-p">.</span><span class="tok-nx">Authorization</span> <span class="tok-o">=</span> <span class="tok-s1">&#39;Basic &#39;</span> <span class="tok-o">+</span> <span class="tok-nx">AuthService</span><span class="tok-p">.</span><span class="tok-nx">getToken</span><span class="tok-p">();</span>
      <span class="tok-p">}</span> <span class="tok-k">else</span> <span class="tok-p">{</span>
        <span class="tok-k">delete</span> <span class="tok-nx">config</span><span class="tok-p">.</span><span class="tok-nx">headers</span><span class="tok-p">.</span><span class="tok-nx">Authorization</span><span class="tok-p">;</span>
      <span class="tok-p">}</span>

      <span class="tok-k">return</span> <span class="tok-nx">config</span><span class="tok-p">;</span>
    <span class="tok-p">};</span>

    <span class="tok-nx">instance</span><span class="tok-p">.</span><span class="tok-nx">response</span> <span class="tok-o">=</span> <span class="tok-kd">function</span><span class="tok-p">(</span><span class="tok-nx">response</span><span class="tok-p">)</span> <span class="tok-p">{</span>
      <span class="tok-k">if</span> <span class="tok-p">(</span><span class="tok-nx">response</span><span class="tok-p">.</span><span class="tok-nx">status</span> <span class="tok-o">===</span> <span class="tok-mi">401</span><span class="tok-p">)</span> <span class="tok-p">{</span>
        <span class="tok-nx">AuthService</span><span class="tok-p">.</span><span class="tok-nx">deleteUserData</span><span class="tok-p">();</span>
        <span class="tok-nx">AuthService</span><span class="tok-p">.</span><span class="tok-nx">deleteToken</span><span class="tok-p">();</span>
        <span class="tok-nx">$rootScope</span><span class="tok-p">.</span><span class="tok-nx">$emit</span><span class="tok-p">(</span><span class="tok-s1">&#39;auth.unauthorized&#39;</span><span class="tok-p">,</span> <span class="tok-p">[]);</span>
      <span class="tok-p">}</span>

      <span class="tok-k">if</span><span class="tok-p">(</span><span class="tok-nx">response</span><span class="tok-p">.</span><span class="tok-nx">data</span><span class="tok-p">.</span><span class="tok-nx">status</span> <span class="tok-o">&amp;&amp;</span> <span class="tok-nx">response</span><span class="tok-p">.</span><span class="tok-nx">data</span><span class="tok-p">.</span><span class="tok-nx">status</span> <span class="tok-o">===</span> <span class="tok-s1">&#39;ERROR&#39;</span><span class="tok-p">)</span> <span class="tok-p">{</span> <span class="tok-c1">//Force error</span>
        <span class="tok-k">return</span> <span class="tok-nx">$q</span><span class="tok-p">.</span><span class="tok-nx">reject</span><span class="tok-p">(</span><span class="tok-nx">response</span><span class="tok-p">);</span>
      <span class="tok-p">}</span>

      <span class="tok-k">return</span> <span class="tok-nx">response</span><span class="tok-p">;</span>
    <span class="tok-p">};</span>

    <span class="tok-k">return</span> <span class="tok-nx">instance</span><span class="tok-p">;</span>
  <span class="tok-p">}])</span>
  <span class="tok-p">.</span><span class="tok-nx">config</span><span class="tok-p">(</span><span class="tok-kd">function</span><span class="tok-p">(</span><span class="tok-nx">$httpProvider</span><span class="tok-p">){</span>
    <span class="tok-nx">$httpProvider</span><span class="tok-p">.</span><span class="tok-nx">interceptors</span><span class="tok-p">.</span><span class="tok-nx">push</span><span class="tok-p">(</span><span class="tok-s1">&#39;AuthInterceptor&#39;</span><span class="tok-p">);</span>
  <span class="tok-p">});</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>Los interceptores son servicios de tipo factoría que registramos en el <code>$httpProvider</code>, añadiéndolos a la cola <code>$httpProvider.interceptors</code>. Al hacerse en un <code>provider</code>, tenemos que realizar esta operación en la fase de configuración.</p>
</div>
<div class="paragraph">
<p>Hay dos tipos de interceptores, y dos tipos de interceptores de rechazo:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>request</code>: estos interceptores reciben como parámetro un objeto http <code>config</code>. Podemos modificar este objeto <code>config</code>, o bien crear uno nuevo. Se espera que esta función devuelva un objeto <code>config</code> (bien sea el existente o el nuevo) o una promesa que contenga el objeto <code>config</code>.</p>
</li>
<li>
<p><code>requestError</code>: este interceptor se llama cuando un interceptor previo lanza un error o se resuelve con un rechazo.</p>
</li>
<li>
<p><code>response</code>:  estos interceptores reciben como parámetro un objeto http <code>response</code>. Podemos modificar este objeto <code>response</code> o crear uno nuevo. Se espera que esta función devuelva un objeto <code>response</code> (bien sea el existente o el nuevo) o una promesa que contenga el objeto <code>response</code>.</p>
</li>
<li>
<p><code>responseError</code>: este interceptor se llama cuando un interceptor previo lanza un error o se resuelve con un rechazo.</p>
</li>
</ul>
</div>
<div style="page-break-after: always;"></div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="sesion12">12. Automatización y testing</h2>
<div class="sectionbody">
<div class="paragraph">
<p>A lo largo de este capítulo iremos echando un vistazo a las herramientas de las que disponemos para poder seguir un <em>workflow</em> de desarrollo en AngularJS, que integre automatización y testing de nuestras aplicaciones.</p>
</div>
<div class="paragraph">
<p>Partimos de la base de que tenemos instalado en nuestro equipo tanto <a href="http://nodejs.org/">node.js</a> como <a href="https://www.npmjs.org/">npm</a>.</p>
</div>
<div class="sect2">
<h3 id="_instalación_de_grunt_cli">12.1. Instalación de Grunt CLI</h3>
<div class="paragraph">
<p><em>Grunt Command Line Interface</em> (Grunt CLI) es un módulo de node.js que nos permite ejecutar tareas de Grunt en nuestro proyecto, vía línea de comandos. Así, podremos ejecutar cada tarea relacionada con el proceso de desarrollo de nuestra aplicación (verificación de sintaxis, ejecución de los tests unitarios, minificación, &#8230;&#8203;). De esta manera, grunt se convierte en el único asistente que necesitamos para cubrir las necesidades de nuestro proyecto.</p>
</div>
<div class="paragraph">
<p>Podemos instalar el Grunt CLI a través de npm:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="bash">npm install -g grunt-cli</code></pre>
</div>
</div>
<div class="paragraph">
<p>La opción <em>-g</em> hace que <code>grunt-cli</code> se instale de manera <strong>global</strong> y podremos ejecutarla a través del comando <code>grunt</code>. Grunt necesita una serie de componentes adicionales, que se instalarán de manera local a nuestro proyecto.</p>
</div>
</div>
<div class="sect2">
<h3 id="_instalación_de_bower">12.2. Instalación de Bower</h3>
<div class="paragraph">
<p>Otro elemento global que necesitaremos es <a href="http://bower.io/">Bower</a>. Bower es a las librerías JavaScript de front-end lo que NPM a las librerías de backend de node.js. Este gestor de paquetes nos puede descargar librerías como AngularJS, ui-router, jQuery, etc. De manera que ya no es necesario irse al sitio web del framework/librería para descargarnos lo que necesitemos.</p>
</div>
<div class="paragraph">
<p>Bower se instala de manera similar a como hemos hecho para Grunt CLI:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="bash">npm install -g bower</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_estructura_inicial_de_nuestro_proyecto">12.3. Estructura inicial de nuestro proyecto</h3>
<div class="sect3">
<h4 id="_gestión_de_dependencias">12.3.1. Gestión de dependencias</h4>
<div class="paragraph">
<p>Vamos a definir las dependencias de nuestro proyecto. Necesitaremos una serie de librerías de backend, que gestionará npm, y de frontend, que gestionará Bower. Ambas herramientas necesitan un fichero de configuración JSON que define estas dependencias.</p>
</div>
<div class="paragraph">
<p>El fichero de configuración de node.js se llama <code>package.json</code>, y podemos inicializarlo lanzando, desde consola, el comando <code>npm init</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="bash"><span class="tok-nv">$ </span>npm init
This utility will walk you through creating a package.json file.
It only covers the most common items, and tries to guess sane defaults.

See <span class="tok-sb">`</span>npm <span class="tok-nb">help </span>json<span class="tok-sb">`</span> <span class="tok-k">for</span> definitive documentation on these fields
and exactly what they <span class="tok-k">do</span>.

Use <span class="tok-sb">`</span>npm install &lt;pkg&gt; --save<span class="tok-sb">`</span> afterwards to install a package and
save it as a dependency in the package.json file.

Press ^C at any <span class="tok-nb">time </span>to quit.
name: <span class="tok-o">(</span>angular-automation-testing<span class="tok-o">)</span>
version: <span class="tok-o">(</span>0.0.0<span class="tok-o">)</span>
description:
entry point: <span class="tok-o">(</span>index.js<span class="tok-o">)</span>
<span class="tok-nb">test command</span>:
git repository:
keywords:
author:
license: <span class="tok-o">(</span>ISC<span class="tok-o">)</span>
About to write to /Volumes/MSL64/tmp/angular-automation-testing/package.json:

<span class="tok-o">{</span>
  <span class="tok-s2">&quot;name&quot;</span>: <span class="tok-s2">&quot;angular-automation-testing&quot;</span>,
  <span class="tok-s2">&quot;version&quot;</span>: <span class="tok-s2">&quot;0.0.0&quot;</span>,
  <span class="tok-s2">&quot;description&quot;</span>: <span class="tok-s2">&quot;&quot;</span>,
  <span class="tok-s2">&quot;main&quot;</span>: <span class="tok-s2">&quot;index.js&quot;</span>,
  <span class="tok-s2">&quot;scripts&quot;</span>: <span class="tok-o">{</span>
    <span class="tok-s2">&quot;test&quot;</span>: <span class="tok-s2">&quot;echo \&quot;Error: no test specified\&quot; &amp;&amp; exit 1&quot;</span>
  <span class="tok-o">}</span>,
  <span class="tok-s2">&quot;author&quot;</span>: <span class="tok-s2">&quot;&quot;</span>,
  <span class="tok-s2">&quot;license&quot;</span>: <span class="tok-s2">&quot;ISC&quot;</span>
<span class="tok-o">}</span>


Is this ok? <span class="tok-o">(</span>yes<span class="tok-o">)</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>El fichero de configuración de bower se llama <code>bower.json</code>, y se inicializa con el comando <code>bower init</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="bash"><span class="tok-nv">$ </span>bower init
? name: angular-automation-testing
? version: 0.0.0
? description:
? main file:
? what types of modules does this package expose?:
? keywords:
? authors: Alejandro Such Berenguer &lt;alejandro.such@gmail.com&gt;
? license: MIT
? homepage:
? <span class="tok-nb">set </span>currently installed components as dependencies?: Yes
? add commonly ignored files to ignore list?: Yes
? would you like to mark this package as private which prevents it from being accidentally published to the registry?: No

<span class="tok-o">{</span>
  name: <span class="tok-s1">&#39;angular-automation-testing&#39;</span>,
  version: <span class="tok-s1">&#39;0.0.0&#39;</span>,
  authors: <span class="tok-o">[</span>
    <span class="tok-s1">&#39;Alejandro Such Berenguer &lt;alejandro.such@gmail.com&gt;&#39;</span>
  <span class="tok-o">]</span>,
  license: <span class="tok-s1">&#39;MIT&#39;</span>,
  ignore: <span class="tok-o">[</span>
    <span class="tok-s1">&#39;**/.*&#39;</span>,
    <span class="tok-s1">&#39;node_modules&#39;</span>,
    <span class="tok-s1">&#39;bower_components&#39;</span>,
    <span class="tok-s1">&#39;test&#39;</span>,
    <span class="tok-s1">&#39;tests&#39;</span>
  <span class="tok-o">]</span>
<span class="tok-o">}</span>

? Looks good?: Yes</code></pre>
</div>
</div>
<div class="paragraph">
<p>Aunque vamos a querer introducir en nuestro sistema de control de versiones estos ficheros de configuración, vamos a querer ignorar las dependencias descargadas por bower y npm:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="bash"><span class="tok-nv">$ </span><span class="tok-nb">echo</span> <span class="tok-s2">&quot;node_modules/&quot;</span> &gt;&gt; .gitignore
<span class="tok-nv">$ </span><span class="tok-nb">echo</span> <span class="tok-s2">&quot;bower_components/&quot;</span> &gt;&gt; .gitignore</code></pre>
</div>
</div>
<div class="paragraph">
<p>Ahora las dependencias. En la parte de front-end vamos a instalar las dependencias vistas en las sesiones de este módulo:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>AngularJS</p>
</li>
<li>
<p>ui-router</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="bash"><span class="tok-nv">$ </span>bower install angular --save
<span class="tok-nv">$ </span>bower install angular-ui-router --save</code></pre>
</div>
</div>
<div class="paragraph">
<p>Añadimos la opción <code>-g</code>, para que las dependencias aparezcan en el fichero de configuración:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="json"><span class="tok-p">{</span>
  <span class="tok-nt">&quot;name&quot;</span><span class="tok-p">:</span> <span class="tok-s2">&quot;angular-automation-testing&quot;</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;version&quot;</span><span class="tok-p">:</span> <span class="tok-s2">&quot;0.0.0&quot;</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;authors&quot;</span><span class="tok-p">:</span> <span class="tok-p">[</span>
    <span class="tok-s2">&quot;Alejandro Such Berenguer &lt;alejandro.such@gmail.com&gt;&quot;</span>
  <span class="tok-p">],</span>
  <span class="tok-nt">&quot;license&quot;</span><span class="tok-p">:</span> <span class="tok-s2">&quot;MIT&quot;</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;ignore&quot;</span><span class="tok-p">:</span> <span class="tok-p">[</span>
    <span class="tok-s2">&quot;**/.*&quot;</span><span class="tok-p">,</span>
    <span class="tok-s2">&quot;node_modules&quot;</span><span class="tok-p">,</span>
    <span class="tok-s2">&quot;bower_components&quot;</span><span class="tok-p">,</span>
    <span class="tok-s2">&quot;test&quot;</span><span class="tok-p">,</span>
    <span class="tok-s2">&quot;tests&quot;</span>
  <span class="tok-p">],</span>
  <span class="tok-nt">&quot;dependencies&quot;</span><span class="tok-p">:</span> <span class="tok-p">{</span>
    <span class="tok-nt">&quot;angular&quot;</span><span class="tok-p">:</span> <span class="tok-s2">&quot;~1.3.2&quot;</span><span class="tok-p">,</span>
    <span class="tok-nt">&quot;angular-ui-router&quot;</span><span class="tok-p">:</span> <span class="tok-s2">&quot;~0.2.11&quot;</span>
  <span class="tok-p">}</span>
<span class="tok-p">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>En cuanto a las dependencias de grunt, se instalan de la siguiente manera:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="bash"><span class="tok-nv">$ </span>npm install angular-mocks --save-dev
<span class="tok-nv">$ </span>npm install grunt --save-dev
<span class="tok-nv">$ </span>npm install grunt-exec --save-dev
<span class="tok-nv">$ </span>npm install grunt-contrib-clean --save-dev
<span class="tok-nv">$ </span>npm install grunt-contrib-jshint --save-dev
<span class="tok-nv">$ </span>npm install grunt-contrib-watch --save-dev
<span class="tok-nv">$ </span>npm install grunt-contrib-concat --save-dev
<span class="tok-nv">$ </span>npm install grunt-contrib-copy --save-dev
<span class="tok-nv">$ </span>npm install grunt-contrib-uglify --save-dev
<span class="tok-nv">$ </span>npm install karma --save-dev
<span class="tok-nv">$ </span>npm install grunt-karma --save-dev
<span class="tok-nv">$ </span>npm install karma-jasmine --save-dev
<span class="tok-nv">$ </span>npm install load-grunt-tasks --save-dev
<span class="tok-nv">$ </span>npm install karma-phantomjs-launcher --save-dev
<span class="tok-nv">$ </span>npm install jquery --save-dev</code></pre>
</div>
</div>
<div class="paragraph">
<p>También podemos ver que esas dependencias han aparecido en el fichero <code>package.json</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="json"><span class="tok-p">{</span>
  <span class="tok-nt">&quot;name&quot;</span><span class="tok-p">:</span> <span class="tok-s2">&quot;angular-automation-testing&quot;</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;version&quot;</span><span class="tok-p">:</span> <span class="tok-s2">&quot;0.0.0&quot;</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;description&quot;</span><span class="tok-p">:</span> <span class="tok-s2">&quot;&quot;</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;main&quot;</span><span class="tok-p">:</span> <span class="tok-s2">&quot;index.js&quot;</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;scripts&quot;</span><span class="tok-p">:</span> <span class="tok-p">{</span>
    <span class="tok-nt">&quot;test&quot;</span><span class="tok-p">:</span> <span class="tok-s2">&quot;echo \&quot;Error: no test specified\&quot; &amp;&amp; exit 1&quot;</span>
  <span class="tok-p">},</span>
  <span class="tok-nt">&quot;author&quot;</span><span class="tok-p">:</span> <span class="tok-s2">&quot;&quot;</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;license&quot;</span><span class="tok-p">:</span> <span class="tok-s2">&quot;ISC&quot;</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;devDependencies&quot;</span><span class="tok-p">:</span> <span class="tok-p">{</span>
    <span class="tok-nt">&quot;angular-mocks&quot;</span><span class="tok-p">:</span> <span class="tok-s2">&quot;^1.3.2&quot;</span><span class="tok-p">,</span>
    <span class="tok-nt">&quot;grunt&quot;</span><span class="tok-p">:</span> <span class="tok-s2">&quot;^0.4.5&quot;</span><span class="tok-p">,</span>
    <span class="tok-nt">&quot;grunt-contrib-clean&quot;</span><span class="tok-p">:</span> <span class="tok-s2">&quot;^0.6.0&quot;</span><span class="tok-p">,</span>
    <span class="tok-nt">&quot;grunt-contrib-concat&quot;</span><span class="tok-p">:</span> <span class="tok-s2">&quot;^0.5.0&quot;</span><span class="tok-p">,</span>
    <span class="tok-nt">&quot;grunt-contrib-copy&quot;</span><span class="tok-p">:</span> <span class="tok-s2">&quot;^0.7.0&quot;</span><span class="tok-p">,</span>
    <span class="tok-nt">&quot;grunt-contrib-jshint&quot;</span><span class="tok-p">:</span> <span class="tok-s2">&quot;^0.10.0&quot;</span><span class="tok-p">,</span>
    <span class="tok-nt">&quot;grunt-contrib-uglify&quot;</span><span class="tok-p">:</span> <span class="tok-s2">&quot;^0.6.0&quot;</span><span class="tok-p">,</span>
    <span class="tok-nt">&quot;grunt-contrib-watch&quot;</span><span class="tok-p">:</span> <span class="tok-s2">&quot;^0.6.1&quot;</span><span class="tok-p">,</span>
    <span class="tok-nt">&quot;grunt-exec&quot;</span><span class="tok-p">:</span> <span class="tok-s2">&quot;^0.4.6&quot;</span><span class="tok-p">,</span>
    <span class="tok-nt">&quot;grunt-karma&quot;</span><span class="tok-p">:</span> <span class="tok-s2">&quot;^0.9.0&quot;</span><span class="tok-p">,</span>
    <span class="tok-nt">&quot;jquery&quot;</span><span class="tok-p">:</span> <span class="tok-s2">&quot;^2.1.3&quot;</span><span class="tok-p">,</span>
    <span class="tok-nt">&quot;karma&quot;</span><span class="tok-p">:</span> <span class="tok-s2">&quot;^0.12.24&quot;</span><span class="tok-p">,</span>
    <span class="tok-nt">&quot;karma-jasmine&quot;</span><span class="tok-p">:</span> <span class="tok-s2">&quot;^0.2.3&quot;</span><span class="tok-p">,</span>
    <span class="tok-nt">&quot;karma-phantomjs-launcher&quot;</span><span class="tok-p">:</span> <span class="tok-s2">&quot;^0.1.4&quot;</span><span class="tok-p">,</span>
    <span class="tok-nt">&quot;load-grunt-tasks&quot;</span><span class="tok-p">:</span> <span class="tok-s2">&quot;^1.0.0&quot;</span>
  <span class="tok-p">}</span>
<span class="tok-p">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Utilizaremos la opción <code>--save-dev</code> para indicar que todas estas dependendencias son depenedencias de desarrollo, y no las utilizaremos nunca en un entorno de producción, ni son necesarias para que la aplicación se ejecute.</p>
</div>
<div class="paragraph">
<p>Muy importante la librería <a href="https://docs.angularjs.org/api/ngMock"><code>angular-mocks</code></a>. Ésta nos dará soporte para inyectar y <em>mockear</em> servicios de AngularJS en nuestros tests unitarios. También extiende varios servicios del <em>core</em> de AngularJS para que sean controlados de manera síncrona en nuestros tests (como veremos, por ejemplo, a la hora de hacer <em>mocks</em> de servicios HTTP).</p>
</div>
</div>
<div class="sect3">
<h4 id="_testing_de_filtros_nuestro_primer_test">12.3.2. Testing de filtros: nuestro primer test</h4>
<div class="paragraph">
<p>Probaremos nuestra infraestructura. Para ello, seguiremos el paradigma <em>TDD</em>, diseñando un test para un filtro. El filtro se llamará <code>textOrDefault</code>, y devolverá la cadena que se le pase. En caso de no pasarse una cadena, se devolverá un valor por defecto (<code>-</code>), o el valor que se le pase como atributo (ej: <code>N/D</code>, <code>desconocido</code>, etc).</p>
</div>
<div class="paragraph">
<p>El fichero será <code>test/filters/textOrDefaultSpec.js</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="javascript"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35</div></td><td class="code"><span class="tok-s1">&#39;use strict&#39;</span><span class="tok-p">;</span>

<span class="tok-nx">describe</span><span class="tok-p">(</span><span class="tok-s1">&#39;filter: textOrDefault&#39;</span><span class="tok-p">,</span> <span class="tok-kd">function</span> <span class="tok-p">()</span> <span class="tok-p">{</span>
  <span class="tok-kd">var</span> <span class="tok-nx">textOrDefault</span><span class="tok-p">;</span>

  <span class="tok-c1">//Inicializar el módulo indicado antes de caa test</span>
  <span class="tok-nx">beforeEach</span><span class="tok-p">(</span><span class="tok-nx">module</span><span class="tok-p">(</span><span class="tok-s1">&#39;filters.textordefault&#39;</span><span class="tok-p">));</span>

  <span class="tok-c1">//Inyección de dependencias textOrDefault se apuntará al filtro inyectado</span>
  <span class="tok-nx">beforeEach</span><span class="tok-p">(</span><span class="tok-nx">inject</span><span class="tok-p">(</span><span class="tok-kd">function</span> <span class="tok-p">(</span><span class="tok-nx">_textOrDefaultFilter_</span><span class="tok-p">)</span> <span class="tok-p">{</span>
    <span class="tok-nx">textOrDefault</span> <span class="tok-o">=</span> <span class="tok-nx">_textOrDefaultFilter_</span><span class="tok-p">;</span>
  <span class="tok-p">}));</span>

  <span class="tok-nx">it</span><span class="tok-p">(</span><span class="tok-s2">&quot;should return &#39;-&#39;&quot;</span><span class="tok-p">,</span> <span class="tok-kd">function</span> <span class="tok-p">()</span> <span class="tok-p">{</span>
    <span class="tok-nx">expect</span><span class="tok-p">(</span><span class="tok-nx">textOrDefault</span><span class="tok-p">(</span><span class="tok-kc">null</span><span class="tok-p">)).</span><span class="tok-nx">toBe</span><span class="tok-p">(</span><span class="tok-s1">&#39;-&#39;</span><span class="tok-p">);</span>
    <span class="tok-nx">expect</span><span class="tok-p">(</span><span class="tok-nx">textOrDefault</span><span class="tok-p">(</span><span class="tok-s1">&#39;&#39;</span><span class="tok-p">)).</span><span class="tok-nx">toBe</span><span class="tok-p">(</span><span class="tok-s1">&#39;-&#39;</span><span class="tok-p">);</span>
    <span class="tok-nx">expect</span><span class="tok-p">(</span><span class="tok-nx">textOrDefault</span><span class="tok-p">(</span><span class="tok-s1">&#39;   &#39;</span><span class="tok-p">)).</span><span class="tok-nx">toBe</span><span class="tok-p">(</span><span class="tok-s1">&#39;-&#39;</span><span class="tok-p">);</span>
  <span class="tok-p">});</span>

  <span class="tok-nx">it</span><span class="tok-p">(</span><span class="tok-s2">&quot;should return &#39;N/D&#39;&quot;</span><span class="tok-p">,</span> <span class="tok-kd">function</span> <span class="tok-p">()</span> <span class="tok-p">{</span>
    <span class="tok-nx">expect</span><span class="tok-p">(</span><span class="tok-nx">textOrDefault</span><span class="tok-p">(</span><span class="tok-kc">null</span><span class="tok-p">,</span> <span class="tok-s1">&#39;N/D&#39;</span><span class="tok-p">)).</span><span class="tok-nx">toBe</span><span class="tok-p">(</span><span class="tok-s1">&#39;N/D&#39;</span><span class="tok-p">);</span>
    <span class="tok-nx">expect</span><span class="tok-p">(</span><span class="tok-nx">textOrDefault</span><span class="tok-p">(</span><span class="tok-s1">&#39;&#39;</span><span class="tok-p">,</span> <span class="tok-s1">&#39;N/D&#39;</span><span class="tok-p">)).</span><span class="tok-nx">toBe</span><span class="tok-p">(</span><span class="tok-s1">&#39;N/D&#39;</span><span class="tok-p">);</span>
    <span class="tok-nx">expect</span><span class="tok-p">(</span><span class="tok-nx">textOrDefault</span><span class="tok-p">(</span><span class="tok-s1">&#39;  \n\t &#39;</span><span class="tok-p">,</span> <span class="tok-s1">&#39;N/D&#39;</span><span class="tok-p">)).</span><span class="tok-nx">toBe</span><span class="tok-p">(</span><span class="tok-s1">&#39;N/D&#39;</span><span class="tok-p">);</span>
  <span class="tok-p">});</span>

  <span class="tok-nx">it</span><span class="tok-p">(</span><span class="tok-s2">&quot;should return the same value&quot;</span><span class="tok-p">,</span> <span class="tok-kd">function</span> <span class="tok-p">()</span> <span class="tok-p">{</span>
    <span class="tok-kd">var</span> <span class="tok-nx">hello</span> <span class="tok-o">=</span> <span class="tok-s1">&#39;hello&#39;</span><span class="tok-p">;</span>
    <span class="tok-nx">expect</span><span class="tok-p">(</span><span class="tok-nx">textOrDefault</span><span class="tok-p">(</span><span class="tok-nx">hello</span><span class="tok-p">,</span> <span class="tok-s1">&#39;N/D&#39;</span><span class="tok-p">)).</span><span class="tok-nx">toBe</span><span class="tok-p">(</span><span class="tok-nx">hello</span><span class="tok-p">);</span>
    <span class="tok-nx">expect</span><span class="tok-p">(</span><span class="tok-nx">textOrDefault</span><span class="tok-p">(</span><span class="tok-nx">hello</span><span class="tok-p">)).</span><span class="tok-nx">toBe</span><span class="tok-p">(</span><span class="tok-nx">hello</span><span class="tok-p">);</span>

    <span class="tok-kd">var</span> <span class="tok-nx">helloWithSpaces</span> <span class="tok-o">=</span> <span class="tok-s1">&#39;   hello   &#39;</span><span class="tok-p">;</span>
    <span class="tok-nx">expect</span><span class="tok-p">(</span><span class="tok-nx">textOrDefault</span><span class="tok-p">(</span><span class="tok-nx">helloWithSpaces</span><span class="tok-p">,</span> <span class="tok-s1">&#39;N/D&#39;</span><span class="tok-p">)).</span><span class="tok-nx">toBe</span><span class="tok-p">(</span><span class="tok-nx">helloWithSpaces</span><span class="tok-p">);</span>
    <span class="tok-nx">expect</span><span class="tok-p">(</span><span class="tok-nx">textOrDefault</span><span class="tok-p">(</span><span class="tok-nx">helloWithSpaces</span><span class="tok-p">)).</span><span class="tok-nx">toBe</span><span class="tok-p">(</span><span class="tok-nx">helloWithSpaces</span><span class="tok-p">);</span>
  <span class="tok-p">});</span>
<span class="tok-p">});</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>Como su nombre indica, la función <code>beforeEach</code> es llamada antes de que se ejecute cada test dentro del <code>describe</code>.</p>
</div>
<div class="paragraph">
<p>Utilizaremos esta función <code>beforeEach</code> para cargar el el módulo donde se encuentra nuestro filtro.</p>
</div>
<div class="paragraph">
<p>Definimos cada uno de nuestros tests dentro de una función <code>if</code>. Y ahí utilizaremos <em>expectations</em>, con la función <code>expect</code>. Ésta recibe un valor, llamado <strong>valor real</strong>, que se encadenará con una función de <em>matching</em> para compararlo con el valor esperado.</p>
</div>
<div class="paragraph">
<p><a href="http://jasmine.github.io/edge/introduction.html">La página de introducción a Jasmine</a> dispone de ejemplos de todos y cada uno de los matchers por defecto.</p>
</div>
<div class="paragraph">
<p>Ahora, debemos establecer la configuración de <a href="http://karma-runner.github.io/0.12/index.html">Karma</a>, para poder lanzar el test. Para ello, en la raíz del proyecto lanzaremos el comando <code>karma init</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="bash"><span class="tok-nv">$ </span>karma init

Which testing framework <span class="tok-k">do</span> you want to use ?
Press tab to list possible options. Enter to move to the next question.
&gt; jasmine

Do you want to use Require.js ?
This will add Require.js plugin.
Press tab to list possible options. Enter to move to the next question.
&gt; no

Do you want to capture any browsers automatically ?
Press tab to list possible options. Enter empty string to move to the next question.
&gt; PhantomJS
&gt;

What is the location of your <span class="tok-nb">source </span>and <span class="tok-nb">test </span>files ?
You can use glob patterns, eg. <span class="tok-s2">&quot;js/*.js&quot;</span> or <span class="tok-s2">&quot;test/**/*Spec.js&quot;</span>.
Enter empty string to move to the next question.
&gt; <span class="tok-nb">test</span>/**/*Spec.js
&gt; src/**/*.js

Should any of the files included by the previous patterns be excluded ?
You can use glob patterns, eg. <span class="tok-s2">&quot;**/*.swp&quot;</span>.
Enter empty string to move to the next question.
&gt;

Do you want Karma to watch all the files and run the tests on change ?
Press tab to list possible options.
&gt; yes


Config file generated at <span class="tok-s2">&quot;[RUTA_DEL_PROYECTO]/karma.conf.js&quot;</span>.</code></pre>
</div>
</div>
<div class="paragraph">
<p>Esta inicialización nos habrá creado el fichero <code>karma.conf.js</code>. Modificaremos el atributo <code>files</code> (listado de ficheros que se cargarán en el navegador en el momento de realizar los tests), dejándolo de la siguiente manera:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="javascript"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3
4
5
6
7
8</div></td><td class="code"><span class="tok-c1">// list of files / patterns to load in the browser</span>
<span class="tok-nx">files</span><span class="tok-o">:</span> <span class="tok-p">[</span>
  <span class="tok-s1">&#39;bower_components/angular/angular.js&#39;</span><span class="tok-p">,</span>
  <span class="tok-s1">&#39;node_modules/angular-mocks/angular-mocks.js&#39;</span><span class="tok-p">,</span>
  <span class="tok-s1">&#39;bower_components/angular-ui-router/release/angular-ui-router.js&#39;</span><span class="tok-p">,</span>
  <span class="tok-s1">&#39;src/**/*.js&#39;</span><span class="tok-p">,</span>
  <span class="tok-s1">&#39;test/**/*Spec.js&#39;</span>
<span class="tok-p">],</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>Si lanzamos los tests con <code>karma start karma.conf.js</code>, veremos cómo se levanta el navegador PhantomJS y nos devuelve un error. Esto se debe a que el test se ha lanzado, pero no se encuentra el módulo a testear. Crearemos el fichero <code>src/filters/testOrDefault.js</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="javascript"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3
4
5
6
7
8
9</div></td><td class="code"><span class="tok-p">(</span><span class="tok-kd">function</span> <span class="tok-p">()</span> <span class="tok-p">{</span>
    <span class="tok-s1">&#39;use strict&#39;</span><span class="tok-p">;</span>
    <span class="tok-nx">angular</span><span class="tok-p">.</span><span class="tok-nx">module</span><span class="tok-p">(</span><span class="tok-s1">&#39;filters.textordefault&#39;</span><span class="tok-p">,</span> <span class="tok-p">[])</span>
        <span class="tok-p">.</span><span class="tok-nx">filter</span><span class="tok-p">(</span><span class="tok-s1">&#39;textOrDefault&#39;</span><span class="tok-p">,</span> <span class="tok-kd">function</span> <span class="tok-p">()</span> <span class="tok-p">{</span>
            <span class="tok-k">return</span> <span class="tok-kd">function</span> <span class="tok-p">(</span><span class="tok-nx">input</span><span class="tok-p">,</span> <span class="tok-nx">defaultValue</span><span class="tok-p">)</span> <span class="tok-p">{</span>
                <span class="tok-k">return</span> <span class="tok-nx">input</span><span class="tok-p">;</span>
            <span class="tok-p">};</span>
        <span class="tok-p">});</span>
<span class="tok-p">})();</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>Volviendo a lanzar los tests, veremos que ahora éstos fallan porque el filtro no está devolviendo los valores que esperábamos.</p>
</div>
<div class="paragraph">
<p>Modificaremos el código de nuestro filtro para que realice la funcionalidad esperada:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="javascript"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26</div></td><td class="code"><span class="tok-p">(</span><span class="tok-kd">function</span> <span class="tok-p">()</span> <span class="tok-p">{</span>
    <span class="tok-s1">&#39;use strict&#39;</span><span class="tok-p">;</span>
    <span class="tok-nx">angular</span><span class="tok-p">.</span><span class="tok-nx">module</span><span class="tok-p">(</span><span class="tok-s1">&#39;filters.textordefault&#39;</span><span class="tok-p">,</span> <span class="tok-p">[])</span>
        <span class="tok-p">.</span><span class="tok-nx">filter</span><span class="tok-p">(</span><span class="tok-s1">&#39;textOrDefault&#39;</span><span class="tok-p">,</span> <span class="tok-kd">function</span> <span class="tok-p">()</span> <span class="tok-p">{</span>
            <span class="tok-k">return</span> <span class="tok-kd">function</span> <span class="tok-p">(</span><span class="tok-nx">input</span><span class="tok-p">,</span> <span class="tok-nx">defaultValue</span><span class="tok-p">)</span> <span class="tok-p">{</span>
                <span class="tok-nx">defaultValue</span> <span class="tok-o">=</span> <span class="tok-nx">defaultValue</span> <span class="tok-o">||</span> <span class="tok-s1">&#39;-&#39;</span><span class="tok-p">;</span>

                <span class="tok-k">if</span> <span class="tok-p">(</span><span class="tok-o">!</span><span class="tok-nx">input</span><span class="tok-p">)</span>
                    <span class="tok-k">return</span> <span class="tok-nx">defaultValue</span><span class="tok-p">;</span>

                <span class="tok-k">if</span> <span class="tok-p">(</span><span class="tok-o">!</span><span class="tok-nx">angular</span><span class="tok-p">.</span><span class="tok-nx">isString</span><span class="tok-p">(</span><span class="tok-nx">input</span><span class="tok-p">))</span> <span class="tok-p">{</span>
                    <span class="tok-k">if</span> <span class="tok-p">(</span><span class="tok-nx">input</span><span class="tok-p">.</span><span class="tok-nx">toString</span><span class="tok-p">)</span> <span class="tok-p">{</span>
                        <span class="tok-nx">input</span> <span class="tok-o">=</span> <span class="tok-nx">input</span><span class="tok-p">.</span><span class="tok-nx">toString</span><span class="tok-p">();</span>
                    <span class="tok-p">}</span> <span class="tok-k">else</span> <span class="tok-p">{</span>
                        <span class="tok-k">return</span> <span class="tok-nx">defaultValue</span><span class="tok-p">;</span>
                    <span class="tok-p">}</span>
                <span class="tok-p">}</span>

                <span class="tok-k">if</span> <span class="tok-p">(</span><span class="tok-nx">input</span><span class="tok-p">.</span><span class="tok-nx">trim</span><span class="tok-p">().</span><span class="tok-nx">length</span> <span class="tok-o">&gt;</span> <span class="tok-mi">0</span><span class="tok-p">)</span> <span class="tok-p">{</span>
                    <span class="tok-k">return</span> <span class="tok-nx">input</span><span class="tok-p">;</span>
                <span class="tok-p">}</span>

                <span class="tok-k">return</span> <span class="tok-nx">defaultValue</span><span class="tok-p">;</span>
            <span class="tok-p">};</span>
        <span class="tok-p">});</span>
<span class="tok-p">})();</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>Al realizar estos cambios, los tests pasarán exitosamente.</p>
</div>
<div class="paragraph">
<p>Una cosa que podemos ver es que se detectan los cambios "en caliente". A medida que modificamos el código de nuestro filtro, si salvamos, se volverán a lanzar los tests.</p>
</div>
</div>
<div class="sect3">
<h4 id="_testing_de_servicios">12.3.3. Testing de servicios</h4>
<div class="paragraph">
<p>Veamos ahora cómo testear un servicio de cualquier tipo (provider, factory o service). Haremos nuestro ejemplo con un provider, ya que tiene un componente de configuración que el resto de servicios no tiene.</p>
</div>
<div class="paragraph">
<p>La idea es crear un servicio de validaciones. Tendremos por una parte una serie de validaciones predefinidas, y además podremos añadir los validadores <em>custom</em> al servicio.</p>
</div>
<div class="paragraph">
<p>El código de nuestro test (<code>test/providers/expertoJeeValidationProviderSpec.js</code>) será el siguiente:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="javascript"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">  1
  2
  3
  4
  5
  6
  7
  8
  9
 10
 11
 12
 13
 14
 15
 16
 17
 18
 19
 20
 21
 22
 23
 24
 25
 26
 27
 28
 29
 30
 31
 32
 33
 34
 35
 36
 37
 38
 39
 40
 41
 42
 43
 44
 45
 46
 47
 48
 49
 50
 51
 52
 53
 54
 55
 56
 57
 58
 59
 60
 61
 62
 63
 64
 65
 66
 67
 68
 69
 70
 71
 72
 73
 74
 75
 76
 77
 78
 79
 80
 81
 82
 83
 84
 85
 86
 87
 88
 89
 90
 91
 92
 93
 94
 95
 96
 97
 98
 99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
153
154
155
156
157
158
159
160
161
162
163
164
165
166
167
168
169
170
171
172
173
174
175
176
177
178
179
180
181
182
183
184
185
186
187
188
189
190
191
192
193
194
195
196
197
198
199
200
201
202
203
204
205
206
207
208
209
210
211
212
213
214
215
216
217
218
219
220
221
222
223
224
225
226
227
228
229
230
231
232
233
234
235
236
237
238
239
240
241
242
243
244
245
246
247
248
249
250
251
252
253
254
255
256
257
258
259
260
261
262
263
264
265
266
267
268
269
270
271
272
273
274
275
276
277
278
279
280
281
282
283
284
285
286
287
288
289
290
291
292
293
294
295
296
297
298
299
300
301
302
303
304
305
306
307
308
309
310
311
312
313
314
315
316
317
318
319
320
321
322
323
324
325
326
327
328
329
330
331
332
333
334
335
336
337
338
339
340
341
342
343
344
345
346
347
348
349
350
351
352
353
354
355
356
357
358
359
360
361
362
363
364
365
366
367
368
369
370
371
372
373
374
375
376
377
378
379
380
381
382
383
384
385
386
387
388
389
390
391
392
393
394
395
396
397
398
399
400
401
402
403
404
405
406
407
408
409
410
411
412
413
414
415
416
417
418
419
420
421
422
423
424
425
426
427
428
429
430
431
432
433
434
435
436
437
438
439
440
441
442
443
444
445
446
447
448
449
450
451
452
453
454
455
456
457
458
459
460
461
462
463
464
465
466
467
468
469
470
471
472
473
474
475
476
477
478
479</div></td><td class="code"><span class="tok-s1">&#39;use strict&#39;</span><span class="tok-p">;</span>

<span class="tok-nx">describe</span><span class="tok-p">(</span><span class="tok-s1">&#39;provider: expertoJeeValidation&#39;</span><span class="tok-p">,</span> <span class="tok-kd">function</span> <span class="tok-p">()</span> <span class="tok-p">{</span>
    <span class="tok-kd">var</span> <span class="tok-nx">validationProvider</span><span class="tok-p">;</span>
    <span class="tok-kd">var</span> <span class="tok-nx">undefinedVar</span><span class="tok-p">;</span>
    <span class="tok-kd">var</span> <span class="tok-nx">validationService</span><span class="tok-p">;</span>

    <span class="tok-nx">beforeEach</span><span class="tok-p">(</span><span class="tok-nx">module</span><span class="tok-p">(</span><span class="tok-s1">&#39;providers.validation&#39;</span><span class="tok-p">));</span>

    <span class="tok-nx">beforeEach</span><span class="tok-p">(</span><span class="tok-kd">function</span> <span class="tok-p">()</span> <span class="tok-p">{</span>
        <span class="tok-c1">// Creamos un módulo de pega, al que inyectamos el provider y definimos una función de configuración</span>
        <span class="tok-kd">var</span> <span class="tok-nx">fakeModule</span> <span class="tok-o">=</span> <span class="tok-nx">angular</span>
            <span class="tok-p">.</span><span class="tok-nx">module</span><span class="tok-p">(</span><span class="tok-s1">&#39;test.app.config&#39;</span><span class="tok-p">,</span> <span class="tok-kd">function</span><span class="tok-p">(){}).</span><span class="tok-nx">config</span><span class="tok-p">(</span><span class="tok-kd">function</span> <span class="tok-p">(</span><span class="tok-nx">expertoJeeValidationProvider</span><span class="tok-p">)</span> <span class="tok-p">{</span>
                <span class="tok-nx">validationProvider</span> <span class="tok-o">=</span> <span class="tok-nx">expertoJeeValidationProvider</span><span class="tok-p">;</span>

                <span class="tok-nx">validationProvider</span><span class="tok-p">.</span><span class="tok-nx">addConstraint</span><span class="tok-p">(</span><span class="tok-s1">&#39;customConstraint&#39;</span><span class="tok-p">,</span> <span class="tok-kd">function</span> <span class="tok-p">(</span><span class="tok-nx">value</span><span class="tok-p">,</span> <span class="tok-nx">needsToBeFive</span><span class="tok-p">)</span> <span class="tok-p">{</span>
                    <span class="tok-k">if</span> <span class="tok-p">(</span><span class="tok-nx">needsToBeFive</span><span class="tok-p">)</span> <span class="tok-p">{</span>
                        <span class="tok-k">return</span> <span class="tok-nx">value</span> <span class="tok-o">===</span> <span class="tok-mi">5</span><span class="tok-p">;</span>
                    <span class="tok-p">}</span>

                    <span class="tok-k">return</span> <span class="tok-kc">true</span><span class="tok-p">;</span>
                <span class="tok-p">});</span>
            <span class="tok-p">});</span>

        <span class="tok-c1">// Cargamos los módulos</span>
        <span class="tok-nx">module</span><span class="tok-p">(</span><span class="tok-s1">&#39;test.app.config&#39;</span><span class="tok-p">);</span>
   <span class="tok-p">});</span>

  <span class="tok-nx">beforeEach</span><span class="tok-p">(</span>
        <span class="tok-c1">//Inyectar los servicios en los tests</span>
        <span class="tok-nx">inject</span><span class="tok-p">(</span><span class="tok-kd">function</span><span class="tok-p">(</span><span class="tok-nx">_expertoJeeValidation_</span><span class="tok-p">){</span>
          <span class="tok-nx">validationService</span> <span class="tok-o">=</span> <span class="tok-nx">_expertoJeeValidation_</span><span class="tok-p">;</span>
        <span class="tok-p">})</span>
    <span class="tok-p">);</span>

    <span class="tok-nx">it</span><span class="tok-p">(</span><span class="tok-s1">&#39;tests the providers has been injected&#39;</span><span class="tok-p">,</span> <span class="tok-kd">function</span> <span class="tok-p">()</span> <span class="tok-p">{</span>
        <span class="tok-nx">expect</span><span class="tok-p">(</span><span class="tok-nx">validationProvider</span><span class="tok-p">).</span><span class="tok-nx">not</span><span class="tok-p">.</span><span class="tok-nx">toBeUndefined</span><span class="tok-p">();</span>
        <span class="tok-nx">expect</span><span class="tok-p">(</span><span class="tok-nx">validationService</span><span class="tok-p">).</span><span class="tok-nx">not</span><span class="tok-p">.</span><span class="tok-nx">toBeUndefined</span><span class="tok-p">();</span>
    <span class="tok-p">});</span>

    <span class="tok-nx">it</span><span class="tok-p">(</span><span class="tok-s1">&#39;tests the blank constraint&#39;</span><span class="tok-p">,</span> <span class="tok-kd">function</span> <span class="tok-p">()</span> <span class="tok-p">{</span>
        <span class="tok-kd">var</span> <span class="tok-nx">blankConstraint</span> <span class="tok-o">=</span> <span class="tok-nx">validationService</span><span class="tok-p">.</span><span class="tok-nx">blank</span><span class="tok-p">;</span>

        <span class="tok-nx">expect</span><span class="tok-p">(</span><span class="tok-nx">blankConstraint</span><span class="tok-p">(</span><span class="tok-s1">&#39;&#39;</span><span class="tok-p">,</span> <span class="tok-kc">true</span><span class="tok-p">)).</span><span class="tok-nx">toBe</span><span class="tok-p">(</span><span class="tok-kc">true</span><span class="tok-p">);</span>
        <span class="tok-nx">expect</span><span class="tok-p">(</span><span class="tok-nx">blankConstraint</span><span class="tok-p">(</span><span class="tok-s1">&#39;&#39;</span><span class="tok-p">,</span> <span class="tok-kc">false</span><span class="tok-p">)).</span><span class="tok-nx">toBe</span><span class="tok-p">(</span><span class="tok-kc">false</span><span class="tok-p">);</span>

        <span class="tok-nx">expect</span><span class="tok-p">(</span><span class="tok-nx">blankConstraint</span><span class="tok-p">(</span><span class="tok-nx">undefinedVar</span><span class="tok-p">,</span> <span class="tok-kc">true</span><span class="tok-p">)).</span><span class="tok-nx">toBe</span><span class="tok-p">(</span><span class="tok-kc">true</span><span class="tok-p">);</span>
        <span class="tok-nx">expect</span><span class="tok-p">(</span><span class="tok-nx">blankConstraint</span><span class="tok-p">(</span><span class="tok-nx">undefinedVar</span><span class="tok-p">,</span> <span class="tok-kc">false</span><span class="tok-p">)).</span><span class="tok-nx">toBe</span><span class="tok-p">(</span><span class="tok-kc">false</span><span class="tok-p">);</span>

        <span class="tok-nx">expect</span><span class="tok-p">(</span><span class="tok-nx">blankConstraint</span><span class="tok-p">(</span><span class="tok-kc">null</span><span class="tok-p">,</span> <span class="tok-kc">true</span><span class="tok-p">)).</span><span class="tok-nx">toBe</span><span class="tok-p">(</span><span class="tok-kc">true</span><span class="tok-p">);</span>
        <span class="tok-nx">expect</span><span class="tok-p">(</span><span class="tok-nx">blankConstraint</span><span class="tok-p">(</span><span class="tok-kc">null</span><span class="tok-p">,</span> <span class="tok-kc">false</span><span class="tok-p">)).</span><span class="tok-nx">toBe</span><span class="tok-p">(</span><span class="tok-kc">false</span><span class="tok-p">);</span>

        <span class="tok-nx">expect</span><span class="tok-p">(</span><span class="tok-nx">blankConstraint</span><span class="tok-p">(</span><span class="tok-s1">&#39;hello&#39;</span><span class="tok-p">,</span> <span class="tok-kc">true</span><span class="tok-p">)).</span><span class="tok-nx">toBe</span><span class="tok-p">(</span><span class="tok-kc">true</span><span class="tok-p">);</span>
        <span class="tok-nx">expect</span><span class="tok-p">(</span><span class="tok-nx">blankConstraint</span><span class="tok-p">(</span><span class="tok-s1">&#39;hello&#39;</span><span class="tok-p">,</span> <span class="tok-kc">false</span><span class="tok-p">)).</span><span class="tok-nx">toBe</span><span class="tok-p">(</span><span class="tok-kc">true</span><span class="tok-p">);</span>
    <span class="tok-p">});</span>

    <span class="tok-nx">it</span><span class="tok-p">(</span><span class="tok-s1">&#39;tets the creditCard constraint&#39;</span><span class="tok-p">,</span> <span class="tok-kd">function</span> <span class="tok-p">()</span> <span class="tok-p">{</span>
        <span class="tok-kd">var</span> <span class="tok-nx">creditCardConstraint</span> <span class="tok-o">=</span> <span class="tok-nx">validationService</span><span class="tok-p">.</span><span class="tok-nx">creditCard</span><span class="tok-p">;</span>
        <span class="tok-kd">var</span> <span class="tok-nx">testFn</span> <span class="tok-o">=</span> <span class="tok-kd">function</span> <span class="tok-p">()</span> <span class="tok-p">{</span>
            <span class="tok-nx">creditCardConstraint</span><span class="tok-p">(</span><span class="tok-kc">null</span><span class="tok-p">,</span> <span class="tok-kc">true</span><span class="tok-p">);</span>
        <span class="tok-p">};</span>

        <span class="tok-nx">expect</span><span class="tok-p">(</span><span class="tok-nx">testFn</span><span class="tok-p">).</span><span class="tok-nx">toThrow</span><span class="tok-p">(</span><span class="tok-s1">&#39;CreditCard constraint: Not implemented yet&#39;</span><span class="tok-p">);</span>
    <span class="tok-p">});</span>

    <span class="tok-nx">it</span><span class="tok-p">(</span><span class="tok-s1">&#39;tests the email constraint&#39;</span><span class="tok-p">,</span> <span class="tok-kd">function</span> <span class="tok-p">()</span> <span class="tok-p">{</span>
        <span class="tok-kd">var</span> <span class="tok-nx">emailConstraint</span> <span class="tok-o">=</span> <span class="tok-nx">validationService</span><span class="tok-p">.</span><span class="tok-nx">email</span><span class="tok-p">;</span>

        <span class="tok-nx">expect</span><span class="tok-p">(</span><span class="tok-nx">emailConstraint</span><span class="tok-p">(</span><span class="tok-s1">&#39;&#39;</span><span class="tok-p">,</span> <span class="tok-kc">true</span><span class="tok-p">)).</span><span class="tok-nx">toBe</span><span class="tok-p">(</span><span class="tok-kc">false</span><span class="tok-p">);</span>
        <span class="tok-nx">expect</span><span class="tok-p">(</span><span class="tok-nx">emailConstraint</span><span class="tok-p">(</span><span class="tok-s1">&#39;&#39;</span><span class="tok-p">,</span> <span class="tok-kc">false</span><span class="tok-p">)).</span><span class="tok-nx">toBe</span><span class="tok-p">(</span><span class="tok-kc">true</span><span class="tok-p">);</span>

        <span class="tok-nx">expect</span><span class="tok-p">(</span><span class="tok-nx">emailConstraint</span><span class="tok-p">(</span><span class="tok-nx">undefinedVar</span><span class="tok-p">,</span> <span class="tok-kc">true</span><span class="tok-p">)).</span><span class="tok-nx">toBe</span><span class="tok-p">(</span><span class="tok-kc">false</span><span class="tok-p">);</span>
        <span class="tok-nx">expect</span><span class="tok-p">(</span><span class="tok-nx">emailConstraint</span><span class="tok-p">(</span><span class="tok-nx">undefinedVar</span><span class="tok-p">,</span> <span class="tok-kc">false</span><span class="tok-p">)).</span><span class="tok-nx">toBe</span><span class="tok-p">(</span><span class="tok-kc">true</span><span class="tok-p">);</span>

        <span class="tok-nx">expect</span><span class="tok-p">(</span><span class="tok-nx">emailConstraint</span><span class="tok-p">(</span><span class="tok-kc">null</span><span class="tok-p">,</span> <span class="tok-kc">true</span><span class="tok-p">)).</span><span class="tok-nx">toBe</span><span class="tok-p">(</span><span class="tok-kc">false</span><span class="tok-p">);</span>
        <span class="tok-nx">expect</span><span class="tok-p">(</span><span class="tok-nx">emailConstraint</span><span class="tok-p">(</span><span class="tok-kc">null</span><span class="tok-p">,</span> <span class="tok-kc">false</span><span class="tok-p">)).</span><span class="tok-nx">toBe</span><span class="tok-p">(</span><span class="tok-kc">true</span><span class="tok-p">);</span>


        <span class="tok-nx">expect</span><span class="tok-p">(</span><span class="tok-nx">emailConstraint</span><span class="tok-p">(</span><span class="tok-s1">&#39;admin&#39;</span><span class="tok-p">,</span> <span class="tok-kc">true</span><span class="tok-p">)).</span><span class="tok-nx">toBe</span><span class="tok-p">(</span><span class="tok-kc">false</span><span class="tok-p">);</span>
        <span class="tok-nx">expect</span><span class="tok-p">(</span><span class="tok-nx">emailConstraint</span><span class="tok-p">(</span><span class="tok-s1">&#39;admin&#39;</span><span class="tok-p">,</span> <span class="tok-kc">false</span><span class="tok-p">)).</span><span class="tok-nx">toBe</span><span class="tok-p">(</span><span class="tok-kc">true</span><span class="tok-p">);</span>

        <span class="tok-nx">expect</span><span class="tok-p">(</span><span class="tok-nx">emailConstraint</span><span class="tok-p">(</span><span class="tok-s1">&#39;admin@&#39;</span><span class="tok-p">,</span> <span class="tok-kc">true</span><span class="tok-p">)).</span><span class="tok-nx">toBe</span><span class="tok-p">(</span><span class="tok-kc">false</span><span class="tok-p">);</span>
        <span class="tok-nx">expect</span><span class="tok-p">(</span><span class="tok-nx">emailConstraint</span><span class="tok-p">(</span><span class="tok-s1">&#39;admin@&#39;</span><span class="tok-p">,</span> <span class="tok-kc">false</span><span class="tok-p">)).</span><span class="tok-nx">toBe</span><span class="tok-p">(</span><span class="tok-kc">true</span><span class="tok-p">);</span>

        <span class="tok-nx">expect</span><span class="tok-p">(</span><span class="tok-nx">emailConstraint</span><span class="tok-p">(</span><span class="tok-s1">&#39;admin@admin&#39;</span><span class="tok-p">,</span> <span class="tok-kc">true</span><span class="tok-p">)).</span><span class="tok-nx">toBe</span><span class="tok-p">(</span><span class="tok-kc">true</span><span class="tok-p">);</span>
        <span class="tok-nx">expect</span><span class="tok-p">(</span><span class="tok-nx">emailConstraint</span><span class="tok-p">(</span><span class="tok-s1">&#39;admin@admin&#39;</span><span class="tok-p">,</span> <span class="tok-kc">false</span><span class="tok-p">)).</span><span class="tok-nx">toBe</span><span class="tok-p">(</span><span class="tok-kc">true</span><span class="tok-p">);</span>

        <span class="tok-nx">expect</span><span class="tok-p">(</span><span class="tok-nx">emailConstraint</span><span class="tok-p">(</span><span class="tok-s1">&#39;admin@admin.&#39;</span><span class="tok-p">,</span> <span class="tok-kc">true</span><span class="tok-p">)).</span><span class="tok-nx">toBe</span><span class="tok-p">(</span><span class="tok-kc">false</span><span class="tok-p">);</span>
        <span class="tok-nx">expect</span><span class="tok-p">(</span><span class="tok-nx">emailConstraint</span><span class="tok-p">(</span><span class="tok-s1">&#39;admin@admin.&#39;</span><span class="tok-p">,</span> <span class="tok-kc">false</span><span class="tok-p">)).</span><span class="tok-nx">toBe</span><span class="tok-p">(</span><span class="tok-kc">true</span><span class="tok-p">);</span>

        <span class="tok-nx">expect</span><span class="tok-p">(</span><span class="tok-nx">emailConstraint</span><span class="tok-p">(</span><span class="tok-s1">&#39;admin@admin.com&#39;</span><span class="tok-p">,</span> <span class="tok-kc">true</span><span class="tok-p">)).</span><span class="tok-nx">toBe</span><span class="tok-p">(</span><span class="tok-kc">true</span><span class="tok-p">);</span>
        <span class="tok-nx">expect</span><span class="tok-p">(</span><span class="tok-nx">emailConstraint</span><span class="tok-p">(</span><span class="tok-s1">&#39;admin@admin.com&#39;</span><span class="tok-p">,</span> <span class="tok-kc">false</span><span class="tok-p">)).</span><span class="tok-nx">toBe</span><span class="tok-p">(</span><span class="tok-kc">true</span><span class="tok-p">);</span>
    <span class="tok-p">});</span>

    <span class="tok-nx">it</span><span class="tok-p">(</span><span class="tok-s1">&#39;tests the inList constraint&#39;</span><span class="tok-p">,</span> <span class="tok-kd">function</span> <span class="tok-p">()</span> <span class="tok-p">{</span>
        <span class="tok-kd">var</span> <span class="tok-nx">inListConstraint</span> <span class="tok-o">=</span> <span class="tok-nx">validationService</span><span class="tok-p">.</span><span class="tok-nx">inList</span><span class="tok-p">;</span>

        <span class="tok-kd">var</span> <span class="tok-nx">testFn</span> <span class="tok-o">=</span> <span class="tok-kd">function</span> <span class="tok-p">()</span> <span class="tok-p">{</span>
            <span class="tok-nx">inListConstraint</span><span class="tok-p">(</span><span class="tok-kc">null</span><span class="tok-p">,</span> <span class="tok-kc">true</span><span class="tok-p">);</span>
        <span class="tok-p">};</span>

        <span class="tok-kd">var</span> <span class="tok-nx">testFn2</span> <span class="tok-o">=</span> <span class="tok-kd">function</span> <span class="tok-p">()</span> <span class="tok-p">{</span>
            <span class="tok-nx">inListConstraint</span><span class="tok-p">(</span><span class="tok-kc">null</span><span class="tok-p">,</span> <span class="tok-mi">1</span><span class="tok-p">);</span>
        <span class="tok-p">};</span>

        <span class="tok-kd">var</span> <span class="tok-nx">testFn2</span> <span class="tok-o">=</span> <span class="tok-kd">function</span> <span class="tok-p">()</span> <span class="tok-p">{</span>
            <span class="tok-nx">inListConstraint</span><span class="tok-p">(</span><span class="tok-kc">null</span><span class="tok-p">,</span> <span class="tok-s1">&#39;hello&#39;</span><span class="tok-p">);</span>
        <span class="tok-p">};</span>

        <span class="tok-kd">var</span> <span class="tok-nx">testFn3</span> <span class="tok-o">=</span> <span class="tok-kd">function</span> <span class="tok-p">()</span> <span class="tok-p">{</span>
            <span class="tok-nx">inListConstraint</span><span class="tok-p">(</span><span class="tok-kc">null</span><span class="tok-p">,</span> <span class="tok-p">{</span> <span class="tok-nx">name</span><span class="tok-o">:</span> <span class="tok-s1">&#39;John&#39;</span><span class="tok-p">,</span> <span class="tok-nx">lastName</span><span class="tok-o">:</span> <span class="tok-s1">&#39;Locke&#39;</span><span class="tok-p">});</span>
        <span class="tok-p">};</span>

        <span class="tok-nx">expect</span><span class="tok-p">(</span><span class="tok-nx">testFn</span><span class="tok-p">).</span><span class="tok-nx">toThrow</span><span class="tok-p">(</span><span class="tok-s1">&#39;InList constraint only applies to Arrays&#39;</span><span class="tok-p">);</span>
        <span class="tok-nx">expect</span><span class="tok-p">(</span><span class="tok-nx">testFn2</span><span class="tok-p">).</span><span class="tok-nx">toThrow</span><span class="tok-p">(</span><span class="tok-s1">&#39;InList constraint only applies to Arrays&#39;</span><span class="tok-p">);</span>
        <span class="tok-nx">expect</span><span class="tok-p">(</span><span class="tok-nx">testFn3</span><span class="tok-p">).</span><span class="tok-nx">toThrow</span><span class="tok-p">(</span><span class="tok-s1">&#39;InList constraint only applies to Arrays&#39;</span><span class="tok-p">);</span>

        <span class="tok-nx">expect</span><span class="tok-p">(</span><span class="tok-nx">inListConstraint</span><span class="tok-p">(</span><span class="tok-s1">&#39;a&#39;</span><span class="tok-p">,</span> <span class="tok-p">[</span><span class="tok-s1">&#39;a&#39;</span><span class="tok-p">,</span> <span class="tok-s1">&#39;b&#39;</span><span class="tok-p">,</span> <span class="tok-s1">&#39;c&#39;</span><span class="tok-p">])).</span><span class="tok-nx">toBe</span><span class="tok-p">(</span><span class="tok-kc">true</span><span class="tok-p">);</span>
        <span class="tok-nx">expect</span><span class="tok-p">(</span><span class="tok-nx">inListConstraint</span><span class="tok-p">(</span><span class="tok-s1">&#39;d&#39;</span><span class="tok-p">,</span> <span class="tok-p">[</span><span class="tok-s1">&#39;a&#39;</span><span class="tok-p">,</span> <span class="tok-s1">&#39;b&#39;</span><span class="tok-p">,</span> <span class="tok-s1">&#39;c&#39;</span><span class="tok-p">])).</span><span class="tok-nx">toBe</span><span class="tok-p">(</span><span class="tok-kc">false</span><span class="tok-p">);</span>
        <span class="tok-nx">expect</span><span class="tok-p">(</span><span class="tok-nx">inListConstraint</span><span class="tok-p">(</span><span class="tok-mi">1</span><span class="tok-p">,</span> <span class="tok-p">[</span><span class="tok-s1">&#39;a&#39;</span><span class="tok-p">,</span> <span class="tok-s1">&#39;b&#39;</span><span class="tok-p">,</span> <span class="tok-s1">&#39;c&#39;</span><span class="tok-p">])).</span><span class="tok-nx">toBe</span><span class="tok-p">(</span><span class="tok-kc">false</span><span class="tok-p">);</span>
        <span class="tok-nx">expect</span><span class="tok-p">(</span><span class="tok-nx">inListConstraint</span><span class="tok-p">(</span><span class="tok-mi">1</span><span class="tok-p">,</span> <span class="tok-p">[</span><span class="tok-s1">&#39;1&#39;</span><span class="tok-p">,</span> <span class="tok-s1">&#39;2&#39;</span><span class="tok-p">,</span> <span class="tok-s1">&#39;3&#39;</span><span class="tok-p">])).</span><span class="tok-nx">toBe</span><span class="tok-p">(</span><span class="tok-kc">false</span><span class="tok-p">);</span>
        <span class="tok-nx">expect</span><span class="tok-p">(</span><span class="tok-nx">inListConstraint</span><span class="tok-p">(</span><span class="tok-mi">1</span><span class="tok-p">,</span> <span class="tok-p">[</span><span class="tok-mi">1</span><span class="tok-p">,</span> <span class="tok-mi">2</span><span class="tok-p">,</span> <span class="tok-mi">3</span><span class="tok-p">])).</span><span class="tok-nx">toBe</span><span class="tok-p">(</span><span class="tok-kc">true</span><span class="tok-p">);</span>
        <span class="tok-nx">expect</span><span class="tok-p">(</span><span class="tok-nx">inListConstraint</span><span class="tok-p">(</span><span class="tok-nx">undefinedVar</span><span class="tok-p">,</span> <span class="tok-p">[</span><span class="tok-mi">1</span><span class="tok-p">,</span> <span class="tok-mi">2</span><span class="tok-p">,</span> <span class="tok-mi">3</span><span class="tok-p">])).</span><span class="tok-nx">toBe</span><span class="tok-p">(</span><span class="tok-kc">false</span><span class="tok-p">);</span>
        <span class="tok-nx">expect</span><span class="tok-p">(</span><span class="tok-nx">inListConstraint</span><span class="tok-p">(</span><span class="tok-nx">undefinedVar</span><span class="tok-p">,</span> <span class="tok-p">[</span><span class="tok-s1">&#39;a&#39;</span><span class="tok-p">,</span> <span class="tok-s1">&#39;b&#39;</span><span class="tok-p">,</span> <span class="tok-s1">&#39;c&#39;</span><span class="tok-p">])).</span><span class="tok-nx">toBe</span><span class="tok-p">(</span><span class="tok-kc">false</span><span class="tok-p">);</span>
        <span class="tok-nx">expect</span><span class="tok-p">(</span><span class="tok-nx">inListConstraint</span><span class="tok-p">(</span><span class="tok-kc">null</span><span class="tok-p">,</span> <span class="tok-p">[</span><span class="tok-s1">&#39;a&#39;</span><span class="tok-p">,</span> <span class="tok-s1">&#39;b&#39;</span><span class="tok-p">,</span> <span class="tok-s1">&#39;c&#39;</span><span class="tok-p">])).</span><span class="tok-nx">toBe</span><span class="tok-p">(</span><span class="tok-kc">false</span><span class="tok-p">);</span>
        <span class="tok-nx">expect</span><span class="tok-p">(</span><span class="tok-nx">inListConstraint</span><span class="tok-p">(</span><span class="tok-kc">null</span><span class="tok-p">,</span> <span class="tok-p">[</span><span class="tok-s1">&#39;a&#39;</span><span class="tok-p">,</span> <span class="tok-s1">&#39;b&#39;</span><span class="tok-p">,</span> <span class="tok-s1">&#39;c&#39;</span><span class="tok-p">,</span> <span class="tok-kc">null</span><span class="tok-p">])).</span><span class="tok-nx">toBe</span><span class="tok-p">(</span><span class="tok-kc">true</span><span class="tok-p">);</span>
    <span class="tok-p">});</span>

    <span class="tok-nx">it</span><span class="tok-p">(</span><span class="tok-s1">&#39;tests the regex constraint&#39;</span><span class="tok-p">,</span> <span class="tok-kd">function</span> <span class="tok-p">()</span> <span class="tok-p">{</span>
        <span class="tok-kd">var</span> <span class="tok-nx">matchesConstraint</span> <span class="tok-o">=</span> <span class="tok-nx">validationService</span><span class="tok-p">.</span><span class="tok-nx">matches</span><span class="tok-p">;</span>
        <span class="tok-kd">var</span> <span class="tok-nx">emailRegex</span> <span class="tok-o">=</span> <span class="tok-s1">&#39;^[a-z0-9!#$%&amp;\&#39;*+\/=?^_`{|}~.-]+@[a-z0-9]([a-z0-9-]*[a-z0-9])?(\.[a-z0-9]([a-z0-9-]*[a-z0-9])?)*$&#39;</span><span class="tok-p">;</span>

        <span class="tok-kd">var</span> <span class="tok-nx">testFn</span> <span class="tok-o">=</span> <span class="tok-kd">function</span> <span class="tok-p">()</span> <span class="tok-p">{</span>
            <span class="tok-nx">matchesConstraint</span><span class="tok-p">(</span><span class="tok-mi">5</span><span class="tok-p">,</span> <span class="tok-nx">emailRegex</span><span class="tok-p">);</span>
        <span class="tok-p">};</span>

        <span class="tok-kd">var</span> <span class="tok-nx">testFn2</span> <span class="tok-o">=</span> <span class="tok-kd">function</span> <span class="tok-p">()</span> <span class="tok-p">{</span>
            <span class="tok-nx">matchesConstraint</span><span class="tok-p">(</span><span class="tok-nx">undefinedVar</span><span class="tok-p">,</span> <span class="tok-nx">emailRegex</span><span class="tok-p">);</span>
        <span class="tok-p">};</span>

        <span class="tok-kd">var</span> <span class="tok-nx">testFn3</span> <span class="tok-o">=</span> <span class="tok-kd">function</span> <span class="tok-p">()</span> <span class="tok-p">{</span>
            <span class="tok-nx">matchesConstraint</span><span class="tok-p">(</span><span class="tok-kc">null</span><span class="tok-p">,</span> <span class="tok-nx">emailRegex</span><span class="tok-p">);</span>
        <span class="tok-p">};</span>

        <span class="tok-kd">var</span> <span class="tok-nx">testFn4</span> <span class="tok-o">=</span> <span class="tok-kd">function</span> <span class="tok-p">()</span> <span class="tok-p">{</span>
            <span class="tok-nx">matchesConstraint</span><span class="tok-p">([],</span> <span class="tok-nx">emailRegex</span><span class="tok-p">);</span>
        <span class="tok-p">};</span>

        <span class="tok-kd">var</span> <span class="tok-nx">testFn5</span> <span class="tok-o">=</span> <span class="tok-kd">function</span> <span class="tok-p">()</span> <span class="tok-p">{</span>
            <span class="tok-nx">matchesConstraint</span><span class="tok-p">({},</span> <span class="tok-nx">emailRegex</span><span class="tok-p">);</span>
        <span class="tok-p">};</span>

        <span class="tok-nx">expect</span><span class="tok-p">(</span><span class="tok-nx">testFn</span><span class="tok-p">).</span><span class="tok-nx">toThrow</span><span class="tok-p">(</span><span class="tok-s1">&#39;Matches constraint only applies to Strings&#39;</span><span class="tok-p">);</span>
        <span class="tok-nx">expect</span><span class="tok-p">(</span><span class="tok-nx">testFn2</span><span class="tok-p">).</span><span class="tok-nx">toThrow</span><span class="tok-p">(</span><span class="tok-s1">&#39;Matches constraint only applies to Strings&#39;</span><span class="tok-p">);</span>
        <span class="tok-nx">expect</span><span class="tok-p">(</span><span class="tok-nx">testFn3</span><span class="tok-p">).</span><span class="tok-nx">toThrow</span><span class="tok-p">(</span><span class="tok-s1">&#39;Matches constraint only applies to Strings&#39;</span><span class="tok-p">);</span>
        <span class="tok-nx">expect</span><span class="tok-p">(</span><span class="tok-nx">testFn4</span><span class="tok-p">).</span><span class="tok-nx">toThrow</span><span class="tok-p">(</span><span class="tok-s1">&#39;Matches constraint only applies to Strings&#39;</span><span class="tok-p">);</span>
        <span class="tok-nx">expect</span><span class="tok-p">(</span><span class="tok-nx">testFn5</span><span class="tok-p">).</span><span class="tok-nx">toThrow</span><span class="tok-p">(</span><span class="tok-s1">&#39;Matches constraint only applies to Strings&#39;</span><span class="tok-p">);</span>

        <span class="tok-nx">expect</span><span class="tok-p">(</span><span class="tok-nx">matchesConstraint</span><span class="tok-p">(</span><span class="tok-s1">&#39;&#39;</span><span class="tok-p">,</span> <span class="tok-nx">emailRegex</span><span class="tok-p">)).</span><span class="tok-nx">toBe</span><span class="tok-p">(</span><span class="tok-kc">false</span><span class="tok-p">);</span>
        <span class="tok-nx">expect</span><span class="tok-p">(</span><span class="tok-nx">matchesConstraint</span><span class="tok-p">(</span><span class="tok-s1">&#39;admin&#39;</span><span class="tok-p">,</span> <span class="tok-nx">emailRegex</span><span class="tok-p">)).</span><span class="tok-nx">toBe</span><span class="tok-p">(</span><span class="tok-kc">false</span><span class="tok-p">);</span>
        <span class="tok-nx">expect</span><span class="tok-p">(</span><span class="tok-nx">matchesConstraint</span><span class="tok-p">(</span><span class="tok-s1">&#39;admin@&#39;</span><span class="tok-p">,</span> <span class="tok-nx">emailRegex</span><span class="tok-p">)).</span><span class="tok-nx">toBe</span><span class="tok-p">(</span><span class="tok-kc">false</span><span class="tok-p">);</span>
        <span class="tok-nx">expect</span><span class="tok-p">(</span><span class="tok-nx">matchesConstraint</span><span class="tok-p">(</span><span class="tok-s1">&#39;admin@admin&#39;</span><span class="tok-p">,</span> <span class="tok-nx">emailRegex</span><span class="tok-p">)).</span><span class="tok-nx">toBe</span><span class="tok-p">(</span><span class="tok-kc">true</span><span class="tok-p">);</span>
        <span class="tok-nx">expect</span><span class="tok-p">(</span><span class="tok-nx">matchesConstraint</span><span class="tok-p">(</span><span class="tok-s1">&#39;admin@admin.&#39;</span><span class="tok-p">,</span> <span class="tok-nx">emailRegex</span><span class="tok-p">)).</span><span class="tok-nx">toBe</span><span class="tok-p">(</span><span class="tok-kc">false</span><span class="tok-p">);</span>
        <span class="tok-nx">expect</span><span class="tok-p">(</span><span class="tok-nx">matchesConstraint</span><span class="tok-p">(</span><span class="tok-s1">&#39;admin@admin.com&#39;</span><span class="tok-p">,</span> <span class="tok-nx">emailRegex</span><span class="tok-p">)).</span><span class="tok-nx">toBe</span><span class="tok-p">(</span><span class="tok-kc">true</span><span class="tok-p">);</span>

    <span class="tok-p">});</span>

    <span class="tok-nx">it</span><span class="tok-p">(</span><span class="tok-s1">&#39;tests the max constraint&#39;</span><span class="tok-p">,</span> <span class="tok-kd">function</span> <span class="tok-p">()</span> <span class="tok-p">{</span>
        <span class="tok-kd">var</span> <span class="tok-nx">maxConstraint</span> <span class="tok-o">=</span> <span class="tok-nx">validationService</span><span class="tok-p">.</span><span class="tok-nx">max</span><span class="tok-p">;</span>
        <span class="tok-kd">var</span> <span class="tok-nx">throwErr</span> <span class="tok-o">=</span> <span class="tok-s1">&#39;Max constraint only applies to numbers&#39;</span><span class="tok-p">;</span>

        <span class="tok-kd">var</span> <span class="tok-nx">testFn</span> <span class="tok-o">=</span> <span class="tok-kd">function</span> <span class="tok-p">()</span> <span class="tok-p">{</span>
            <span class="tok-nx">maxConstraint</span><span class="tok-p">(</span><span class="tok-s1">&#39;5&#39;</span><span class="tok-p">,</span> <span class="tok-mi">4</span><span class="tok-p">);</span>
        <span class="tok-p">};</span>

        <span class="tok-kd">var</span> <span class="tok-nx">testFn2</span> <span class="tok-o">=</span> <span class="tok-kd">function</span> <span class="tok-p">()</span> <span class="tok-p">{</span>
            <span class="tok-nx">maxConstraint</span><span class="tok-p">(</span><span class="tok-nx">undefinedVar</span><span class="tok-p">,</span> <span class="tok-mi">4</span><span class="tok-p">);</span>
        <span class="tok-p">};</span>

        <span class="tok-kd">var</span> <span class="tok-nx">testFn3</span> <span class="tok-o">=</span> <span class="tok-kd">function</span> <span class="tok-p">()</span> <span class="tok-p">{</span>
            <span class="tok-nx">maxConstraint</span><span class="tok-p">(</span><span class="tok-kc">null</span><span class="tok-p">,</span> <span class="tok-mi">4</span><span class="tok-p">);</span>
        <span class="tok-p">};</span>

        <span class="tok-kd">var</span> <span class="tok-nx">testFn4</span> <span class="tok-o">=</span> <span class="tok-kd">function</span> <span class="tok-p">()</span> <span class="tok-p">{</span>
            <span class="tok-nx">maxConstraint</span><span class="tok-p">([],</span> <span class="tok-mi">4</span><span class="tok-p">);</span>
        <span class="tok-p">};</span>

        <span class="tok-kd">var</span> <span class="tok-nx">testFn5</span> <span class="tok-o">=</span> <span class="tok-kd">function</span> <span class="tok-p">()</span> <span class="tok-p">{</span>
            <span class="tok-nx">maxConstraint</span><span class="tok-p">({},</span> <span class="tok-mi">4</span><span class="tok-p">);</span>
        <span class="tok-p">};</span>

        <span class="tok-nx">expect</span><span class="tok-p">(</span><span class="tok-nx">testFn</span><span class="tok-p">).</span><span class="tok-nx">toThrow</span><span class="tok-p">(</span><span class="tok-nx">throwErr</span><span class="tok-p">);</span>
        <span class="tok-nx">expect</span><span class="tok-p">(</span><span class="tok-nx">testFn2</span><span class="tok-p">).</span><span class="tok-nx">toThrow</span><span class="tok-p">(</span><span class="tok-nx">throwErr</span><span class="tok-p">);</span>
        <span class="tok-nx">expect</span><span class="tok-p">(</span><span class="tok-nx">testFn3</span><span class="tok-p">).</span><span class="tok-nx">toThrow</span><span class="tok-p">(</span><span class="tok-nx">throwErr</span><span class="tok-p">);</span>
        <span class="tok-nx">expect</span><span class="tok-p">(</span><span class="tok-nx">testFn4</span><span class="tok-p">).</span><span class="tok-nx">toThrow</span><span class="tok-p">(</span><span class="tok-nx">throwErr</span><span class="tok-p">);</span>
        <span class="tok-nx">expect</span><span class="tok-p">(</span><span class="tok-nx">testFn5</span><span class="tok-p">).</span><span class="tok-nx">toThrow</span><span class="tok-p">(</span><span class="tok-nx">throwErr</span><span class="tok-p">);</span>

        <span class="tok-nx">expect</span><span class="tok-p">(</span><span class="tok-nx">maxConstraint</span><span class="tok-p">(</span><span class="tok-mi">1</span><span class="tok-p">,</span> <span class="tok-mi">4</span><span class="tok-p">)).</span><span class="tok-nx">toBe</span><span class="tok-p">(</span><span class="tok-kc">true</span><span class="tok-p">);</span>
        <span class="tok-nx">expect</span><span class="tok-p">(</span><span class="tok-nx">maxConstraint</span><span class="tok-p">(</span><span class="tok-mi">4</span><span class="tok-p">,</span> <span class="tok-mi">4</span><span class="tok-p">)).</span><span class="tok-nx">toBe</span><span class="tok-p">(</span><span class="tok-kc">true</span><span class="tok-p">);</span>
        <span class="tok-nx">expect</span><span class="tok-p">(</span><span class="tok-nx">maxConstraint</span><span class="tok-p">(</span><span class="tok-mi">5</span><span class="tok-p">,</span> <span class="tok-mi">4</span><span class="tok-p">)).</span><span class="tok-nx">toBe</span><span class="tok-p">(</span><span class="tok-kc">false</span><span class="tok-p">);</span>
    <span class="tok-p">});</span>

    <span class="tok-nx">it</span><span class="tok-p">(</span><span class="tok-s1">&#39;tests the maxSize constraint&#39;</span><span class="tok-p">,</span> <span class="tok-kd">function</span> <span class="tok-p">()</span> <span class="tok-p">{</span>
        <span class="tok-kd">var</span> <span class="tok-nx">maxSizeConstraint</span> <span class="tok-o">=</span> <span class="tok-nx">validationService</span><span class="tok-p">.</span><span class="tok-nx">maxSize</span><span class="tok-p">;</span>
        <span class="tok-kd">var</span> <span class="tok-nx">throwErr</span> <span class="tok-o">=</span> <span class="tok-s1">&#39;MaxSize constraint only applies to Arrays and Strings&#39;</span><span class="tok-p">;</span>
        <span class="tok-kd">var</span> <span class="tok-nx">throwErr2</span> <span class="tok-o">=</span> <span class="tok-s1">&#39;Argument maxSize should be a number&#39;</span><span class="tok-p">;</span>

        <span class="tok-kd">var</span> <span class="tok-nx">testFn</span> <span class="tok-o">=</span> <span class="tok-kd">function</span> <span class="tok-p">()</span> <span class="tok-p">{</span>
            <span class="tok-nx">maxSizeConstraint</span><span class="tok-p">(</span><span class="tok-nx">undefinedVar</span><span class="tok-p">,</span> <span class="tok-s1">&#39;&#39;</span><span class="tok-p">);</span>
        <span class="tok-p">};</span>

        <span class="tok-kd">var</span> <span class="tok-nx">testFn2</span> <span class="tok-o">=</span> <span class="tok-kd">function</span> <span class="tok-p">()</span> <span class="tok-p">{</span>
            <span class="tok-nx">maxSizeConstraint</span><span class="tok-p">(</span><span class="tok-nx">undefinedVar</span><span class="tok-p">,</span> <span class="tok-mi">4</span><span class="tok-p">);</span>
        <span class="tok-p">};</span>

        <span class="tok-kd">var</span> <span class="tok-nx">testFn3</span> <span class="tok-o">=</span> <span class="tok-kd">function</span> <span class="tok-p">()</span> <span class="tok-p">{</span>
            <span class="tok-nx">maxSizeConstraint</span><span class="tok-p">(</span><span class="tok-kc">null</span><span class="tok-p">,</span> <span class="tok-mi">4</span><span class="tok-p">);</span>
        <span class="tok-p">};</span>

        <span class="tok-kd">var</span> <span class="tok-nx">testFn5</span> <span class="tok-o">=</span> <span class="tok-kd">function</span> <span class="tok-p">()</span> <span class="tok-p">{</span>
            <span class="tok-nx">maxSizeConstraint</span><span class="tok-p">({},</span> <span class="tok-mi">4</span><span class="tok-p">);</span>
        <span class="tok-p">};</span>

        <span class="tok-nx">expect</span><span class="tok-p">(</span><span class="tok-nx">testFn</span><span class="tok-p">).</span><span class="tok-nx">toThrow</span><span class="tok-p">(</span><span class="tok-nx">throwErr2</span><span class="tok-p">);</span>
        <span class="tok-nx">expect</span><span class="tok-p">(</span><span class="tok-nx">testFn2</span><span class="tok-p">).</span><span class="tok-nx">toThrow</span><span class="tok-p">(</span><span class="tok-nx">throwErr</span><span class="tok-p">);</span>
        <span class="tok-nx">expect</span><span class="tok-p">(</span><span class="tok-nx">testFn3</span><span class="tok-p">).</span><span class="tok-nx">toThrow</span><span class="tok-p">(</span><span class="tok-nx">throwErr</span><span class="tok-p">);</span>
        <span class="tok-nx">expect</span><span class="tok-p">(</span><span class="tok-nx">testFn5</span><span class="tok-p">).</span><span class="tok-nx">toThrow</span><span class="tok-p">(</span><span class="tok-nx">throwErr</span><span class="tok-p">);</span>

        <span class="tok-nx">expect</span><span class="tok-p">(</span><span class="tok-nx">maxSizeConstraint</span><span class="tok-p">(</span><span class="tok-s1">&#39;hello&#39;</span><span class="tok-p">,</span> <span class="tok-mi">4</span><span class="tok-p">)).</span><span class="tok-nx">toBe</span><span class="tok-p">(</span><span class="tok-kc">false</span><span class="tok-p">);</span>
        <span class="tok-nx">expect</span><span class="tok-p">(</span><span class="tok-nx">maxSizeConstraint</span><span class="tok-p">(</span><span class="tok-s1">&#39;hello&#39;</span><span class="tok-p">,</span> <span class="tok-mi">5</span><span class="tok-p">)).</span><span class="tok-nx">toBe</span><span class="tok-p">(</span><span class="tok-kc">true</span><span class="tok-p">);</span>
        <span class="tok-nx">expect</span><span class="tok-p">(</span><span class="tok-nx">maxSizeConstraint</span><span class="tok-p">(</span><span class="tok-s1">&#39;hello&#39;</span><span class="tok-p">,</span> <span class="tok-mi">6</span><span class="tok-p">)).</span><span class="tok-nx">toBe</span><span class="tok-p">(</span><span class="tok-kc">true</span><span class="tok-p">);</span>

        <span class="tok-nx">expect</span><span class="tok-p">(</span><span class="tok-nx">maxSizeConstraint</span><span class="tok-p">([</span><span class="tok-mi">1</span><span class="tok-p">,</span> <span class="tok-mi">2</span><span class="tok-p">,</span> <span class="tok-mi">3</span><span class="tok-p">,</span> <span class="tok-mi">4</span><span class="tok-p">,</span> <span class="tok-mi">5</span><span class="tok-p">],</span> <span class="tok-mi">4</span><span class="tok-p">)).</span><span class="tok-nx">toBe</span><span class="tok-p">(</span><span class="tok-kc">false</span><span class="tok-p">);</span>
        <span class="tok-nx">expect</span><span class="tok-p">(</span><span class="tok-nx">maxSizeConstraint</span><span class="tok-p">([</span><span class="tok-mi">1</span><span class="tok-p">,</span> <span class="tok-mi">2</span><span class="tok-p">,</span> <span class="tok-mi">3</span><span class="tok-p">,</span> <span class="tok-mi">4</span><span class="tok-p">,</span> <span class="tok-mi">5</span><span class="tok-p">],</span> <span class="tok-mi">5</span><span class="tok-p">)).</span><span class="tok-nx">toBe</span><span class="tok-p">(</span><span class="tok-kc">true</span><span class="tok-p">);</span>
        <span class="tok-nx">expect</span><span class="tok-p">(</span><span class="tok-nx">maxSizeConstraint</span><span class="tok-p">([</span><span class="tok-mi">1</span><span class="tok-p">,</span> <span class="tok-mi">2</span><span class="tok-p">,</span> <span class="tok-mi">3</span><span class="tok-p">,</span> <span class="tok-mi">4</span><span class="tok-p">,</span> <span class="tok-mi">5</span><span class="tok-p">],</span> <span class="tok-mi">6</span><span class="tok-p">)).</span><span class="tok-nx">toBe</span><span class="tok-p">(</span><span class="tok-kc">true</span><span class="tok-p">);</span>
    <span class="tok-p">});</span>

    <span class="tok-nx">it</span><span class="tok-p">(</span><span class="tok-s1">&#39;tests the min constraint&#39;</span><span class="tok-p">,</span> <span class="tok-kd">function</span> <span class="tok-p">()</span> <span class="tok-p">{</span>
        <span class="tok-kd">var</span> <span class="tok-nx">minConstraint</span> <span class="tok-o">=</span> <span class="tok-nx">validationService</span><span class="tok-p">.</span><span class="tok-nx">min</span><span class="tok-p">;</span>
        <span class="tok-kd">var</span> <span class="tok-nx">throwErr</span> <span class="tok-o">=</span> <span class="tok-s1">&#39;Min constraint only applies to numbers&#39;</span><span class="tok-p">;</span>

        <span class="tok-kd">var</span> <span class="tok-nx">testFn</span> <span class="tok-o">=</span> <span class="tok-kd">function</span> <span class="tok-p">()</span> <span class="tok-p">{</span>
            <span class="tok-nx">minConstraint</span><span class="tok-p">(</span><span class="tok-s1">&#39;5&#39;</span><span class="tok-p">,</span> <span class="tok-mi">4</span><span class="tok-p">);</span>
        <span class="tok-p">};</span>

        <span class="tok-kd">var</span> <span class="tok-nx">testFn2</span> <span class="tok-o">=</span> <span class="tok-kd">function</span> <span class="tok-p">()</span> <span class="tok-p">{</span>
            <span class="tok-nx">minConstraint</span><span class="tok-p">(</span><span class="tok-nx">undefinedVar</span><span class="tok-p">,</span> <span class="tok-mi">4</span><span class="tok-p">);</span>
        <span class="tok-p">};</span>

        <span class="tok-kd">var</span> <span class="tok-nx">testFn3</span> <span class="tok-o">=</span> <span class="tok-kd">function</span> <span class="tok-p">()</span> <span class="tok-p">{</span>
            <span class="tok-nx">minConstraint</span><span class="tok-p">(</span><span class="tok-kc">null</span><span class="tok-p">,</span> <span class="tok-mi">4</span><span class="tok-p">);</span>
        <span class="tok-p">};</span>

        <span class="tok-kd">var</span> <span class="tok-nx">testFn4</span> <span class="tok-o">=</span> <span class="tok-kd">function</span> <span class="tok-p">()</span> <span class="tok-p">{</span>
            <span class="tok-nx">minConstraint</span><span class="tok-p">([],</span> <span class="tok-mi">4</span><span class="tok-p">);</span>
        <span class="tok-p">};</span>

        <span class="tok-kd">var</span> <span class="tok-nx">testFn5</span> <span class="tok-o">=</span> <span class="tok-kd">function</span> <span class="tok-p">()</span> <span class="tok-p">{</span>
            <span class="tok-nx">minConstraint</span><span class="tok-p">({},</span> <span class="tok-mi">4</span><span class="tok-p">);</span>
        <span class="tok-p">};</span>

        <span class="tok-nx">expect</span><span class="tok-p">(</span><span class="tok-nx">testFn</span><span class="tok-p">).</span><span class="tok-nx">toThrow</span><span class="tok-p">(</span><span class="tok-nx">throwErr</span><span class="tok-p">);</span>
        <span class="tok-nx">expect</span><span class="tok-p">(</span><span class="tok-nx">testFn2</span><span class="tok-p">).</span><span class="tok-nx">toThrow</span><span class="tok-p">(</span><span class="tok-nx">throwErr</span><span class="tok-p">);</span>
        <span class="tok-nx">expect</span><span class="tok-p">(</span><span class="tok-nx">testFn3</span><span class="tok-p">).</span><span class="tok-nx">toThrow</span><span class="tok-p">(</span><span class="tok-nx">throwErr</span><span class="tok-p">);</span>
        <span class="tok-nx">expect</span><span class="tok-p">(</span><span class="tok-nx">testFn4</span><span class="tok-p">).</span><span class="tok-nx">toThrow</span><span class="tok-p">(</span><span class="tok-nx">throwErr</span><span class="tok-p">);</span>
        <span class="tok-nx">expect</span><span class="tok-p">(</span><span class="tok-nx">testFn5</span><span class="tok-p">).</span><span class="tok-nx">toThrow</span><span class="tok-p">(</span><span class="tok-nx">throwErr</span><span class="tok-p">);</span>

        <span class="tok-nx">expect</span><span class="tok-p">(</span><span class="tok-nx">minConstraint</span><span class="tok-p">(</span><span class="tok-mi">1</span><span class="tok-p">,</span> <span class="tok-mi">4</span><span class="tok-p">)).</span><span class="tok-nx">toBe</span><span class="tok-p">(</span><span class="tok-kc">false</span><span class="tok-p">);</span>
        <span class="tok-nx">expect</span><span class="tok-p">(</span><span class="tok-nx">minConstraint</span><span class="tok-p">(</span><span class="tok-mi">4</span><span class="tok-p">,</span> <span class="tok-mi">4</span><span class="tok-p">)).</span><span class="tok-nx">toBe</span><span class="tok-p">(</span><span class="tok-kc">true</span><span class="tok-p">);</span>
        <span class="tok-nx">expect</span><span class="tok-p">(</span><span class="tok-nx">minConstraint</span><span class="tok-p">(</span><span class="tok-mi">5</span><span class="tok-p">,</span> <span class="tok-mi">4</span><span class="tok-p">)).</span><span class="tok-nx">toBe</span><span class="tok-p">(</span><span class="tok-kc">true</span><span class="tok-p">);</span>
    <span class="tok-p">});</span>

    <span class="tok-nx">it</span><span class="tok-p">(</span><span class="tok-s1">&#39;tests the minSize constraint&#39;</span><span class="tok-p">,</span> <span class="tok-kd">function</span> <span class="tok-p">()</span> <span class="tok-p">{</span>
        <span class="tok-kd">var</span> <span class="tok-nx">minSizeConstraint</span> <span class="tok-o">=</span> <span class="tok-nx">validationService</span><span class="tok-p">.</span><span class="tok-nx">minSize</span><span class="tok-p">;</span>
        <span class="tok-kd">var</span> <span class="tok-nx">throwErr</span> <span class="tok-o">=</span> <span class="tok-s1">&#39;MinSize constraint only applies to Arrays and Strings&#39;</span><span class="tok-p">;</span>
        <span class="tok-kd">var</span> <span class="tok-nx">throwErr2</span> <span class="tok-o">=</span> <span class="tok-s1">&#39;Argument minSize should be a number&#39;</span><span class="tok-p">;</span>

        <span class="tok-kd">var</span> <span class="tok-nx">testFn</span> <span class="tok-o">=</span> <span class="tok-kd">function</span> <span class="tok-p">()</span> <span class="tok-p">{</span>
            <span class="tok-nx">minSizeConstraint</span><span class="tok-p">(</span><span class="tok-nx">undefinedVar</span><span class="tok-p">,</span> <span class="tok-s1">&#39;&#39;</span><span class="tok-p">);</span>
        <span class="tok-p">};</span>

        <span class="tok-kd">var</span> <span class="tok-nx">testFn2</span> <span class="tok-o">=</span> <span class="tok-kd">function</span> <span class="tok-p">()</span> <span class="tok-p">{</span>
            <span class="tok-nx">minSizeConstraint</span><span class="tok-p">(</span><span class="tok-nx">undefinedVar</span><span class="tok-p">,</span> <span class="tok-mi">4</span><span class="tok-p">);</span>
        <span class="tok-p">};</span>

        <span class="tok-kd">var</span> <span class="tok-nx">testFn3</span> <span class="tok-o">=</span> <span class="tok-kd">function</span> <span class="tok-p">()</span> <span class="tok-p">{</span>
            <span class="tok-nx">minSizeConstraint</span><span class="tok-p">(</span><span class="tok-kc">null</span><span class="tok-p">,</span> <span class="tok-mi">4</span><span class="tok-p">);</span>
        <span class="tok-p">};</span>

        <span class="tok-kd">var</span> <span class="tok-nx">testFn5</span> <span class="tok-o">=</span> <span class="tok-kd">function</span> <span class="tok-p">()</span> <span class="tok-p">{</span>
            <span class="tok-nx">minSizeConstraint</span><span class="tok-p">({},</span> <span class="tok-mi">4</span><span class="tok-p">);</span>
        <span class="tok-p">};</span>

        <span class="tok-nx">expect</span><span class="tok-p">(</span><span class="tok-nx">testFn</span><span class="tok-p">).</span><span class="tok-nx">toThrow</span><span class="tok-p">(</span><span class="tok-nx">throwErr2</span><span class="tok-p">);</span>
        <span class="tok-nx">expect</span><span class="tok-p">(</span><span class="tok-nx">testFn2</span><span class="tok-p">).</span><span class="tok-nx">toThrow</span><span class="tok-p">(</span><span class="tok-nx">throwErr</span><span class="tok-p">);</span>
        <span class="tok-nx">expect</span><span class="tok-p">(</span><span class="tok-nx">testFn3</span><span class="tok-p">).</span><span class="tok-nx">toThrow</span><span class="tok-p">(</span><span class="tok-nx">throwErr</span><span class="tok-p">);</span>
        <span class="tok-nx">expect</span><span class="tok-p">(</span><span class="tok-nx">testFn5</span><span class="tok-p">).</span><span class="tok-nx">toThrow</span><span class="tok-p">(</span><span class="tok-nx">throwErr</span><span class="tok-p">);</span>

        <span class="tok-nx">expect</span><span class="tok-p">(</span><span class="tok-nx">minSizeConstraint</span><span class="tok-p">(</span><span class="tok-s1">&#39;hello&#39;</span><span class="tok-p">,</span> <span class="tok-mi">4</span><span class="tok-p">)).</span><span class="tok-nx">toBe</span><span class="tok-p">(</span><span class="tok-kc">true</span><span class="tok-p">);</span>
        <span class="tok-nx">expect</span><span class="tok-p">(</span><span class="tok-nx">minSizeConstraint</span><span class="tok-p">(</span><span class="tok-s1">&#39;hello&#39;</span><span class="tok-p">,</span> <span class="tok-mi">5</span><span class="tok-p">)).</span><span class="tok-nx">toBe</span><span class="tok-p">(</span><span class="tok-kc">true</span><span class="tok-p">);</span>
        <span class="tok-nx">expect</span><span class="tok-p">(</span><span class="tok-nx">minSizeConstraint</span><span class="tok-p">(</span><span class="tok-s1">&#39;hello&#39;</span><span class="tok-p">,</span> <span class="tok-mi">6</span><span class="tok-p">)).</span><span class="tok-nx">toBe</span><span class="tok-p">(</span><span class="tok-kc">false</span><span class="tok-p">);</span>

        <span class="tok-nx">expect</span><span class="tok-p">(</span><span class="tok-nx">minSizeConstraint</span><span class="tok-p">([</span><span class="tok-mi">1</span><span class="tok-p">,</span> <span class="tok-mi">2</span><span class="tok-p">,</span> <span class="tok-mi">3</span><span class="tok-p">,</span> <span class="tok-mi">4</span><span class="tok-p">,</span> <span class="tok-mi">5</span><span class="tok-p">],</span> <span class="tok-mi">4</span><span class="tok-p">)).</span><span class="tok-nx">toBe</span><span class="tok-p">(</span><span class="tok-kc">true</span><span class="tok-p">);</span>
        <span class="tok-nx">expect</span><span class="tok-p">(</span><span class="tok-nx">minSizeConstraint</span><span class="tok-p">([</span><span class="tok-mi">1</span><span class="tok-p">,</span> <span class="tok-mi">2</span><span class="tok-p">,</span> <span class="tok-mi">3</span><span class="tok-p">,</span> <span class="tok-mi">4</span><span class="tok-p">,</span> <span class="tok-mi">5</span><span class="tok-p">],</span> <span class="tok-mi">5</span><span class="tok-p">)).</span><span class="tok-nx">toBe</span><span class="tok-p">(</span><span class="tok-kc">true</span><span class="tok-p">);</span>
        <span class="tok-nx">expect</span><span class="tok-p">(</span><span class="tok-nx">minSizeConstraint</span><span class="tok-p">([</span><span class="tok-mi">1</span><span class="tok-p">,</span> <span class="tok-mi">2</span><span class="tok-p">,</span> <span class="tok-mi">3</span><span class="tok-p">,</span> <span class="tok-mi">4</span><span class="tok-p">,</span> <span class="tok-mi">5</span><span class="tok-p">],</span> <span class="tok-mi">6</span><span class="tok-p">)).</span><span class="tok-nx">toBe</span><span class="tok-p">(</span><span class="tok-kc">false</span><span class="tok-p">);</span>
    <span class="tok-p">});</span>

    <span class="tok-nx">it</span><span class="tok-p">(</span><span class="tok-s1">&#39;tests the notEqual constraint&#39;</span><span class="tok-p">,</span> <span class="tok-kd">function</span> <span class="tok-p">()</span> <span class="tok-p">{</span>
        <span class="tok-kd">var</span> <span class="tok-nx">notEqualConstraint</span> <span class="tok-o">=</span> <span class="tok-nx">validationService</span><span class="tok-p">.</span><span class="tok-nx">notEqual</span><span class="tok-p">;</span>

        <span class="tok-kd">var</span> <span class="tok-nx">testFn</span> <span class="tok-o">=</span> <span class="tok-kd">function</span> <span class="tok-p">()</span> <span class="tok-p">{</span>
            <span class="tok-nx">notEqualConstraint</span><span class="tok-p">(</span><span class="tok-mi">1</span><span class="tok-p">,</span> <span class="tok-mi">1</span><span class="tok-p">);</span>
        <span class="tok-p">};</span>

        <span class="tok-nx">expect</span><span class="tok-p">(</span><span class="tok-nx">testFn</span><span class="tok-p">).</span><span class="tok-nx">toThrow</span><span class="tok-p">(</span><span class="tok-s1">&#39;NotEqual constraint: Not implemented yet&#39;</span><span class="tok-p">);</span>
    <span class="tok-p">});</span>

    <span class="tok-nx">it</span><span class="tok-p">(</span><span class="tok-s1">&#39;tests the nullable constraint&#39;</span><span class="tok-p">,</span> <span class="tok-kd">function</span> <span class="tok-p">()</span> <span class="tok-p">{</span>
        <span class="tok-kd">var</span> <span class="tok-nx">nullableConstraint</span> <span class="tok-o">=</span> <span class="tok-nx">validationService</span><span class="tok-p">.</span><span class="tok-nx">nullable</span><span class="tok-p">;</span>

        <span class="tok-nx">expect</span><span class="tok-p">(</span><span class="tok-nx">nullableConstraint</span><span class="tok-p">(</span><span class="tok-s1">&#39;&#39;</span><span class="tok-p">,</span> <span class="tok-kc">true</span><span class="tok-p">)).</span><span class="tok-nx">toBe</span><span class="tok-p">(</span><span class="tok-kc">true</span><span class="tok-p">);</span>
        <span class="tok-nx">expect</span><span class="tok-p">(</span><span class="tok-nx">nullableConstraint</span><span class="tok-p">(</span><span class="tok-s1">&#39;&#39;</span><span class="tok-p">,</span> <span class="tok-kc">false</span><span class="tok-p">)).</span><span class="tok-nx">toBe</span><span class="tok-p">(</span><span class="tok-kc">true</span><span class="tok-p">);</span>

        <span class="tok-nx">expect</span><span class="tok-p">(</span><span class="tok-nx">nullableConstraint</span><span class="tok-p">(</span><span class="tok-kc">null</span><span class="tok-p">,</span> <span class="tok-kc">true</span><span class="tok-p">)).</span><span class="tok-nx">toBe</span><span class="tok-p">(</span><span class="tok-kc">true</span><span class="tok-p">);</span>
        <span class="tok-nx">expect</span><span class="tok-p">(</span><span class="tok-nx">nullableConstraint</span><span class="tok-p">(</span><span class="tok-kc">null</span><span class="tok-p">,</span> <span class="tok-kc">false</span><span class="tok-p">)).</span><span class="tok-nx">toBe</span><span class="tok-p">(</span><span class="tok-kc">false</span><span class="tok-p">);</span>

        <span class="tok-nx">expect</span><span class="tok-p">(</span><span class="tok-nx">nullableConstraint</span><span class="tok-p">(</span><span class="tok-nx">undefinedVar</span><span class="tok-p">,</span> <span class="tok-kc">true</span><span class="tok-p">)).</span><span class="tok-nx">toBe</span><span class="tok-p">(</span><span class="tok-kc">true</span><span class="tok-p">);</span>
        <span class="tok-nx">expect</span><span class="tok-p">(</span><span class="tok-nx">nullableConstraint</span><span class="tok-p">(</span><span class="tok-nx">undefinedVar</span><span class="tok-p">,</span> <span class="tok-kc">false</span><span class="tok-p">)).</span><span class="tok-nx">toBe</span><span class="tok-p">(</span><span class="tok-kc">false</span><span class="tok-p">);</span>
    <span class="tok-p">});</span>

    <span class="tok-nx">it</span><span class="tok-p">(</span><span class="tok-s1">&#39;tests the numeric constraint&#39;</span><span class="tok-p">,</span> <span class="tok-kd">function</span> <span class="tok-p">()</span> <span class="tok-p">{</span>
        <span class="tok-kd">var</span> <span class="tok-nx">numericConstraint</span> <span class="tok-o">=</span> <span class="tok-nx">validationService</span><span class="tok-p">.</span><span class="tok-nx">numeric</span><span class="tok-p">;</span>
        <span class="tok-kd">var</span> <span class="tok-nx">throwErr</span> <span class="tok-o">=</span> <span class="tok-s1">&#39;Numeric constraint expects two arguments&#39;</span><span class="tok-p">;</span>

        <span class="tok-kd">var</span> <span class="tok-nx">testFn</span> <span class="tok-o">=</span> <span class="tok-kd">function</span> <span class="tok-p">()</span> <span class="tok-p">{</span>
            <span class="tok-nx">numericConstraint</span><span class="tok-p">(</span><span class="tok-s1">&#39;a&#39;</span><span class="tok-p">);</span>
        <span class="tok-p">};</span>

        <span class="tok-nx">expect</span><span class="tok-p">(</span><span class="tok-nx">testFn</span><span class="tok-p">).</span><span class="tok-nx">toThrow</span><span class="tok-p">(</span><span class="tok-nx">throwErr</span><span class="tok-p">);</span>

        <span class="tok-nx">expect</span><span class="tok-p">(</span><span class="tok-nx">numericConstraint</span><span class="tok-p">(</span><span class="tok-mi">5</span><span class="tok-p">,</span> <span class="tok-kc">true</span><span class="tok-p">)).</span><span class="tok-nx">toBe</span><span class="tok-p">(</span><span class="tok-kc">true</span><span class="tok-p">);</span>
        <span class="tok-nx">expect</span><span class="tok-p">(</span><span class="tok-nx">numericConstraint</span><span class="tok-p">(</span><span class="tok-mi">5</span><span class="tok-p">,</span> <span class="tok-kc">false</span><span class="tok-p">)).</span><span class="tok-nx">toBe</span><span class="tok-p">(</span><span class="tok-kc">true</span><span class="tok-p">);</span>

        <span class="tok-nx">expect</span><span class="tok-p">(</span><span class="tok-nx">numericConstraint</span><span class="tok-p">(</span><span class="tok-kc">null</span><span class="tok-p">,</span> <span class="tok-kc">true</span><span class="tok-p">)).</span><span class="tok-nx">toBe</span><span class="tok-p">(</span><span class="tok-kc">false</span><span class="tok-p">);</span>
        <span class="tok-nx">expect</span><span class="tok-p">(</span><span class="tok-nx">numericConstraint</span><span class="tok-p">(</span><span class="tok-kc">null</span><span class="tok-p">,</span> <span class="tok-kc">false</span><span class="tok-p">)).</span><span class="tok-nx">toBe</span><span class="tok-p">(</span><span class="tok-kc">true</span><span class="tok-p">);</span>

        <span class="tok-nx">expect</span><span class="tok-p">(</span><span class="tok-nx">numericConstraint</span><span class="tok-p">(</span><span class="tok-nx">undefinedVar</span><span class="tok-p">,</span> <span class="tok-kc">true</span><span class="tok-p">)).</span><span class="tok-nx">toBe</span><span class="tok-p">(</span><span class="tok-kc">false</span><span class="tok-p">);</span>
        <span class="tok-nx">expect</span><span class="tok-p">(</span><span class="tok-nx">numericConstraint</span><span class="tok-p">(</span><span class="tok-nx">undefinedVar</span><span class="tok-p">,</span> <span class="tok-kc">false</span><span class="tok-p">)).</span><span class="tok-nx">toBe</span><span class="tok-p">(</span><span class="tok-kc">true</span><span class="tok-p">);</span>

        <span class="tok-nx">expect</span><span class="tok-p">(</span><span class="tok-nx">numericConstraint</span><span class="tok-p">(</span><span class="tok-s1">&#39;5&#39;</span><span class="tok-p">,</span> <span class="tok-kc">true</span><span class="tok-p">)).</span><span class="tok-nx">toBe</span><span class="tok-p">(</span><span class="tok-kc">false</span><span class="tok-p">);</span>
        <span class="tok-nx">expect</span><span class="tok-p">(</span><span class="tok-nx">numericConstraint</span><span class="tok-p">(</span><span class="tok-s1">&#39;5&#39;</span><span class="tok-p">,</span> <span class="tok-kc">false</span><span class="tok-p">)).</span><span class="tok-nx">toBe</span><span class="tok-p">(</span><span class="tok-kc">true</span><span class="tok-p">);</span>

        <span class="tok-nx">expect</span><span class="tok-p">(</span><span class="tok-nx">numericConstraint</span><span class="tok-p">([],</span> <span class="tok-kc">true</span><span class="tok-p">)).</span><span class="tok-nx">toBe</span><span class="tok-p">(</span><span class="tok-kc">false</span><span class="tok-p">);</span>
        <span class="tok-nx">expect</span><span class="tok-p">(</span><span class="tok-nx">numericConstraint</span><span class="tok-p">([],</span> <span class="tok-kc">false</span><span class="tok-p">)).</span><span class="tok-nx">toBe</span><span class="tok-p">(</span><span class="tok-kc">true</span><span class="tok-p">);</span>

        <span class="tok-nx">expect</span><span class="tok-p">(</span><span class="tok-nx">numericConstraint</span><span class="tok-p">({},</span> <span class="tok-kc">true</span><span class="tok-p">)).</span><span class="tok-nx">toBe</span><span class="tok-p">(</span><span class="tok-kc">false</span><span class="tok-p">);</span>
        <span class="tok-nx">expect</span><span class="tok-p">(</span><span class="tok-nx">numericConstraint</span><span class="tok-p">({},</span> <span class="tok-kc">false</span><span class="tok-p">)).</span><span class="tok-nx">toBe</span><span class="tok-p">(</span><span class="tok-kc">true</span><span class="tok-p">);</span>
    <span class="tok-p">});</span>

    <span class="tok-nx">it</span><span class="tok-p">(</span><span class="tok-s1">&#39;tests the range constraint&#39;</span><span class="tok-p">,</span> <span class="tok-kd">function</span> <span class="tok-p">()</span> <span class="tok-p">{</span>
        <span class="tok-kd">var</span> <span class="tok-nx">rangeConstraint</span> <span class="tok-o">=</span> <span class="tok-nx">validationService</span><span class="tok-p">.</span><span class="tok-nx">range</span><span class="tok-p">;</span>
        <span class="tok-kd">var</span> <span class="tok-nx">throwErr</span> <span class="tok-o">=</span> <span class="tok-s1">&#39;Range constraint expects three arguments&#39;</span><span class="tok-p">;</span>
        <span class="tok-kd">var</span> <span class="tok-nx">throwErr2</span> <span class="tok-o">=</span> <span class="tok-s1">&#39;All three values must be numbers&#39;</span><span class="tok-p">;</span>

        <span class="tok-kd">var</span> <span class="tok-nx">testFn</span> <span class="tok-o">=</span> <span class="tok-kd">function</span> <span class="tok-p">()</span> <span class="tok-p">{</span>
            <span class="tok-nx">rangeConstraint</span><span class="tok-p">(</span><span class="tok-s1">&#39;a&#39;</span><span class="tok-p">,</span> <span class="tok-s1">&#39;1&#39;</span><span class="tok-p">);</span>
        <span class="tok-p">};</span>

        <span class="tok-kd">var</span> <span class="tok-nx">testFn2</span> <span class="tok-o">=</span> <span class="tok-kd">function</span> <span class="tok-p">()</span> <span class="tok-p">{</span>
            <span class="tok-nx">rangeConstraint</span><span class="tok-p">(</span><span class="tok-s1">&#39;a&#39;</span><span class="tok-p">,</span> <span class="tok-s1">&#39;1&#39;</span><span class="tok-p">,</span> <span class="tok-mi">10</span><span class="tok-p">);</span>
        <span class="tok-p">};</span>

        <span class="tok-nx">expect</span><span class="tok-p">(</span><span class="tok-nx">testFn</span><span class="tok-p">).</span><span class="tok-nx">toThrow</span><span class="tok-p">(</span><span class="tok-nx">throwErr</span><span class="tok-p">);</span>
        <span class="tok-nx">expect</span><span class="tok-p">(</span><span class="tok-nx">testFn2</span><span class="tok-p">).</span><span class="tok-nx">toThrow</span><span class="tok-p">(</span><span class="tok-nx">throwErr2</span><span class="tok-p">);</span>

        <span class="tok-nx">expect</span><span class="tok-p">(</span><span class="tok-nx">rangeConstraint</span><span class="tok-p">(</span><span class="tok-mi">5</span><span class="tok-p">,</span> <span class="tok-mi">0</span><span class="tok-p">,</span> <span class="tok-mi">10</span><span class="tok-p">)).</span><span class="tok-nx">toBe</span><span class="tok-p">(</span><span class="tok-kc">true</span><span class="tok-p">);</span>
        <span class="tok-nx">expect</span><span class="tok-p">(</span><span class="tok-nx">rangeConstraint</span><span class="tok-p">(</span><span class="tok-mi">0</span><span class="tok-p">,</span> <span class="tok-mi">0</span><span class="tok-p">,</span> <span class="tok-mi">10</span><span class="tok-p">)).</span><span class="tok-nx">toBe</span><span class="tok-p">(</span><span class="tok-kc">true</span><span class="tok-p">);</span>
        <span class="tok-nx">expect</span><span class="tok-p">(</span><span class="tok-nx">rangeConstraint</span><span class="tok-p">(</span><span class="tok-mi">10</span><span class="tok-p">,</span> <span class="tok-mi">0</span><span class="tok-p">,</span> <span class="tok-mi">10</span><span class="tok-p">)).</span><span class="tok-nx">toBe</span><span class="tok-p">(</span><span class="tok-kc">true</span><span class="tok-p">);</span>
        <span class="tok-nx">expect</span><span class="tok-p">(</span><span class="tok-nx">rangeConstraint</span><span class="tok-p">(</span><span class="tok-o">-</span><span class="tok-mi">1</span><span class="tok-p">,</span> <span class="tok-mi">0</span><span class="tok-p">,</span> <span class="tok-mi">10</span><span class="tok-p">)).</span><span class="tok-nx">toBe</span><span class="tok-p">(</span><span class="tok-kc">false</span><span class="tok-p">);</span>
        <span class="tok-nx">expect</span><span class="tok-p">(</span><span class="tok-nx">rangeConstraint</span><span class="tok-p">(</span><span class="tok-mi">11</span><span class="tok-p">,</span> <span class="tok-mi">0</span><span class="tok-p">,</span> <span class="tok-mi">10</span><span class="tok-p">)).</span><span class="tok-nx">toBe</span><span class="tok-p">(</span><span class="tok-kc">false</span><span class="tok-p">);</span>
    <span class="tok-p">});</span>

    <span class="tok-nx">it</span><span class="tok-p">(</span><span class="tok-s1">&#39;tests the size constraint&#39;</span><span class="tok-p">,</span> <span class="tok-kd">function</span> <span class="tok-p">()</span> <span class="tok-p">{</span>
        <span class="tok-kd">var</span> <span class="tok-nx">sizeConstraint</span> <span class="tok-o">=</span> <span class="tok-nx">validationService</span><span class="tok-p">.</span><span class="tok-nx">size</span><span class="tok-p">;</span>
        <span class="tok-kd">var</span> <span class="tok-nx">throwErr</span> <span class="tok-o">=</span> <span class="tok-s1">&#39;Size constraint expects three arguments&#39;</span><span class="tok-p">;</span>
        <span class="tok-kd">var</span> <span class="tok-nx">throwErr2</span> <span class="tok-o">=</span> <span class="tok-s1">&#39;Size constraint only applies to Arrays and Strings&#39;</span><span class="tok-p">;</span>
        <span class="tok-kd">var</span> <span class="tok-nx">throwErr3</span> <span class="tok-o">=</span> <span class="tok-s1">&#39;Start and end values must be numbers&#39;</span><span class="tok-p">;</span>

        <span class="tok-kd">var</span> <span class="tok-nx">testFn</span> <span class="tok-o">=</span> <span class="tok-kd">function</span> <span class="tok-p">()</span> <span class="tok-p">{</span>
            <span class="tok-nx">sizeConstraint</span><span class="tok-p">(</span><span class="tok-s1">&#39;a&#39;</span><span class="tok-p">,</span> <span class="tok-s1">&#39;1&#39;</span><span class="tok-p">);</span>
        <span class="tok-p">};</span>

        <span class="tok-kd">var</span> <span class="tok-nx">testFn2</span> <span class="tok-o">=</span> <span class="tok-kd">function</span> <span class="tok-p">()</span> <span class="tok-p">{</span>
            <span class="tok-nx">sizeConstraint</span><span class="tok-p">({},</span> <span class="tok-mi">1</span><span class="tok-p">,</span> <span class="tok-mi">10</span><span class="tok-p">);</span>
        <span class="tok-p">};</span>

        <span class="tok-kd">var</span> <span class="tok-nx">testFn3</span> <span class="tok-o">=</span> <span class="tok-kd">function</span> <span class="tok-p">()</span> <span class="tok-p">{</span>
            <span class="tok-nx">sizeConstraint</span><span class="tok-p">(</span><span class="tok-s1">&#39;a&#39;</span><span class="tok-p">,</span> <span class="tok-s1">&#39;1&#39;</span><span class="tok-p">,</span> <span class="tok-mi">10</span><span class="tok-p">);</span>
        <span class="tok-p">};</span>

        <span class="tok-nx">expect</span><span class="tok-p">(</span><span class="tok-nx">testFn</span><span class="tok-p">).</span><span class="tok-nx">toThrow</span><span class="tok-p">(</span><span class="tok-nx">throwErr</span><span class="tok-p">);</span>
        <span class="tok-nx">expect</span><span class="tok-p">(</span><span class="tok-nx">testFn2</span><span class="tok-p">).</span><span class="tok-nx">toThrow</span><span class="tok-p">(</span><span class="tok-nx">throwErr2</span><span class="tok-p">);</span>
        <span class="tok-nx">expect</span><span class="tok-p">(</span><span class="tok-nx">testFn3</span><span class="tok-p">).</span><span class="tok-nx">toThrow</span><span class="tok-p">(</span><span class="tok-nx">throwErr3</span><span class="tok-p">);</span>

        <span class="tok-nx">expect</span><span class="tok-p">(</span><span class="tok-nx">sizeConstraint</span><span class="tok-p">(</span><span class="tok-s2">&quot;hello&quot;</span><span class="tok-p">,</span> <span class="tok-mi">0</span><span class="tok-p">,</span> <span class="tok-mi">5</span><span class="tok-p">)).</span><span class="tok-nx">toBe</span><span class="tok-p">(</span><span class="tok-kc">true</span><span class="tok-p">);</span>
        <span class="tok-nx">expect</span><span class="tok-p">(</span><span class="tok-nx">sizeConstraint</span><span class="tok-p">(</span><span class="tok-s2">&quot;&quot;</span><span class="tok-p">,</span> <span class="tok-mi">0</span><span class="tok-p">,</span> <span class="tok-mi">5</span><span class="tok-p">)).</span><span class="tok-nx">toBe</span><span class="tok-p">(</span><span class="tok-kc">true</span><span class="tok-p">);</span>
        <span class="tok-nx">expect</span><span class="tok-p">(</span><span class="tok-nx">sizeConstraint</span><span class="tok-p">(</span><span class="tok-s2">&quot;hi&quot;</span><span class="tok-p">,</span> <span class="tok-mi">0</span><span class="tok-p">,</span> <span class="tok-mi">5</span><span class="tok-p">)).</span><span class="tok-nx">toBe</span><span class="tok-p">(</span><span class="tok-kc">true</span><span class="tok-p">);</span>
        <span class="tok-nx">expect</span><span class="tok-p">(</span><span class="tok-nx">sizeConstraint</span><span class="tok-p">(</span><span class="tok-s2">&quot;hello world&quot;</span><span class="tok-p">,</span> <span class="tok-mi">0</span><span class="tok-p">,</span> <span class="tok-mi">5</span><span class="tok-p">)).</span><span class="tok-nx">toBe</span><span class="tok-p">(</span><span class="tok-kc">false</span><span class="tok-p">);</span>

        <span class="tok-nx">expect</span><span class="tok-p">(</span><span class="tok-nx">sizeConstraint</span><span class="tok-p">([</span><span class="tok-mi">1</span><span class="tok-p">,</span> <span class="tok-mi">2</span><span class="tok-p">,</span> <span class="tok-mi">3</span><span class="tok-p">,</span> <span class="tok-mi">4</span><span class="tok-p">,</span> <span class="tok-mi">5</span><span class="tok-p">],</span> <span class="tok-mi">0</span><span class="tok-p">,</span> <span class="tok-mi">5</span><span class="tok-p">)).</span><span class="tok-nx">toBe</span><span class="tok-p">(</span><span class="tok-kc">true</span><span class="tok-p">);</span>
        <span class="tok-nx">expect</span><span class="tok-p">(</span><span class="tok-nx">sizeConstraint</span><span class="tok-p">([],</span> <span class="tok-mi">0</span><span class="tok-p">,</span> <span class="tok-mi">5</span><span class="tok-p">)).</span><span class="tok-nx">toBe</span><span class="tok-p">(</span><span class="tok-kc">true</span><span class="tok-p">);</span>
        <span class="tok-nx">expect</span><span class="tok-p">(</span><span class="tok-nx">sizeConstraint</span><span class="tok-p">([</span><span class="tok-mi">1</span><span class="tok-p">,</span> <span class="tok-mi">2</span><span class="tok-p">],</span> <span class="tok-mi">0</span><span class="tok-p">,</span> <span class="tok-mi">5</span><span class="tok-p">)).</span><span class="tok-nx">toBe</span><span class="tok-p">(</span><span class="tok-kc">true</span><span class="tok-p">);</span>
        <span class="tok-nx">expect</span><span class="tok-p">(</span><span class="tok-nx">sizeConstraint</span><span class="tok-p">([</span><span class="tok-mi">1</span><span class="tok-p">,</span> <span class="tok-mi">2</span><span class="tok-p">,</span> <span class="tok-mi">3</span><span class="tok-p">,</span> <span class="tok-mi">4</span><span class="tok-p">,</span> <span class="tok-mi">5</span><span class="tok-p">,</span> <span class="tok-mi">6</span><span class="tok-p">,</span> <span class="tok-mi">7</span><span class="tok-p">,</span> <span class="tok-mi">8</span><span class="tok-p">,</span> <span class="tok-mi">9</span><span class="tok-p">],</span> <span class="tok-mi">0</span><span class="tok-p">,</span> <span class="tok-mi">5</span><span class="tok-p">)).</span><span class="tok-nx">toBe</span><span class="tok-p">(</span><span class="tok-kc">false</span><span class="tok-p">);</span>
    <span class="tok-p">});</span>

    <span class="tok-nx">it</span><span class="tok-p">(</span><span class="tok-s1">&#39;tests the unique constraint&#39;</span><span class="tok-p">,</span> <span class="tok-kd">function</span> <span class="tok-p">()</span> <span class="tok-p">{</span>
        <span class="tok-kd">var</span> <span class="tok-nx">uniqueConstraint</span> <span class="tok-o">=</span> <span class="tok-nx">validationService</span><span class="tok-p">.</span><span class="tok-nx">unique</span><span class="tok-p">;</span>

        <span class="tok-kd">var</span> <span class="tok-nx">throwErr</span> <span class="tok-o">=</span> <span class="tok-s1">&#39;Unique constraint: not implemented yet&#39;</span><span class="tok-p">;</span>

        <span class="tok-kd">var</span> <span class="tok-nx">testFn</span> <span class="tok-o">=</span> <span class="tok-kd">function</span> <span class="tok-p">()</span> <span class="tok-p">{</span>
            <span class="tok-nx">uniqueConstraint</span><span class="tok-p">(</span><span class="tok-s1">&#39;a&#39;</span><span class="tok-p">,</span> <span class="tok-kc">true</span><span class="tok-p">);</span>
        <span class="tok-p">};</span>

        <span class="tok-nx">expect</span><span class="tok-p">(</span><span class="tok-nx">testFn</span><span class="tok-p">).</span><span class="tok-nx">toThrow</span><span class="tok-p">(</span><span class="tok-nx">throwErr</span><span class="tok-p">);</span>
    <span class="tok-p">});</span>

    <span class="tok-nx">it</span><span class="tok-p">(</span><span class="tok-s1">&#39;tests the url constraint&#39;</span><span class="tok-p">,</span> <span class="tok-kd">function</span> <span class="tok-p">()</span> <span class="tok-p">{</span>
        <span class="tok-kd">var</span> <span class="tok-nx">urlConstraint</span> <span class="tok-o">=</span> <span class="tok-nx">validationService</span><span class="tok-p">.</span><span class="tok-nx">url</span><span class="tok-p">;</span>

        <span class="tok-kd">var</span> <span class="tok-nx">throwErr</span> <span class="tok-o">=</span> <span class="tok-s1">&#39;Url constraint: expected 2 arguments&#39;</span><span class="tok-p">;</span>
        <span class="tok-kd">var</span> <span class="tok-nx">throwErr2</span> <span class="tok-o">=</span> <span class="tok-s1">&#39;Url constraint: value expected to be a string&#39;</span><span class="tok-p">;</span>
        <span class="tok-kd">var</span> <span class="tok-nx">throwErr3</span> <span class="tok-o">=</span> <span class="tok-s1">&#39;Url constraint: url expected to be a boolean&#39;</span><span class="tok-p">;</span>

        <span class="tok-kd">var</span> <span class="tok-nx">testFn</span> <span class="tok-o">=</span> <span class="tok-kd">function</span> <span class="tok-p">()</span> <span class="tok-p">{</span>
            <span class="tok-nx">urlConstraint</span><span class="tok-p">(</span><span class="tok-mi">1</span><span class="tok-p">);</span>
        <span class="tok-p">};</span>

        <span class="tok-kd">var</span> <span class="tok-nx">testFn2</span> <span class="tok-o">=</span> <span class="tok-kd">function</span> <span class="tok-p">()</span> <span class="tok-p">{</span>
            <span class="tok-nx">urlConstraint</span><span class="tok-p">(</span><span class="tok-mi">1</span><span class="tok-p">,</span> <span class="tok-kc">true</span><span class="tok-p">);</span>
        <span class="tok-p">};</span>

        <span class="tok-kd">var</span> <span class="tok-nx">testFn3</span> <span class="tok-o">=</span> <span class="tok-kd">function</span> <span class="tok-p">()</span> <span class="tok-p">{</span>
            <span class="tok-nx">urlConstraint</span><span class="tok-p">(</span><span class="tok-s1">&#39;1&#39;</span><span class="tok-p">,</span> <span class="tok-s1">&#39;true&#39;</span><span class="tok-p">);</span>
        <span class="tok-p">};</span>

        <span class="tok-nx">expect</span><span class="tok-p">(</span><span class="tok-nx">testFn</span><span class="tok-p">).</span><span class="tok-nx">toThrow</span><span class="tok-p">(</span><span class="tok-nx">throwErr</span><span class="tok-p">);</span>
        <span class="tok-nx">expect</span><span class="tok-p">(</span><span class="tok-nx">testFn2</span><span class="tok-p">).</span><span class="tok-nx">toThrow</span><span class="tok-p">(</span><span class="tok-nx">throwErr2</span><span class="tok-p">);</span>
        <span class="tok-nx">expect</span><span class="tok-p">(</span><span class="tok-nx">testFn3</span><span class="tok-p">).</span><span class="tok-nx">toThrow</span><span class="tok-p">(</span><span class="tok-nx">throwErr3</span><span class="tok-p">);</span>

        <span class="tok-nx">expect</span><span class="tok-p">(</span><span class="tok-nx">urlConstraint</span><span class="tok-p">(</span><span class="tok-s1">&#39;www.ua.es&#39;</span><span class="tok-p">,</span> <span class="tok-kc">false</span><span class="tok-p">)).</span><span class="tok-nx">toBe</span><span class="tok-p">(</span><span class="tok-kc">true</span><span class="tok-p">);</span>
        <span class="tok-nx">expect</span><span class="tok-p">(</span><span class="tok-nx">urlConstraint</span><span class="tok-p">(</span><span class="tok-s1">&#39;asdf&#39;</span><span class="tok-p">,</span> <span class="tok-kc">true</span><span class="tok-p">)).</span><span class="tok-nx">toBe</span><span class="tok-p">(</span><span class="tok-kc">false</span><span class="tok-p">);</span>
        <span class="tok-nx">expect</span><span class="tok-p">(</span><span class="tok-nx">urlConstraint</span><span class="tok-p">(</span><span class="tok-s1">&#39;www.ua.es&#39;</span><span class="tok-p">,</span> <span class="tok-kc">true</span><span class="tok-p">)).</span><span class="tok-nx">toBe</span><span class="tok-p">(</span><span class="tok-kc">false</span><span class="tok-p">);</span>
        <span class="tok-nx">expect</span><span class="tok-p">(</span><span class="tok-nx">urlConstraint</span><span class="tok-p">(</span><span class="tok-s1">&#39;http://www.ua.es&#39;</span><span class="tok-p">,</span> <span class="tok-kc">true</span><span class="tok-p">)).</span><span class="tok-nx">toBe</span><span class="tok-p">(</span><span class="tok-kc">true</span><span class="tok-p">);</span>
    <span class="tok-p">});</span>

    <span class="tok-nx">it</span><span class="tok-p">(</span><span class="tok-s1">&#39;tests a custom constraint&#39;</span><span class="tok-p">,</span> <span class="tok-kd">function</span> <span class="tok-p">()</span> <span class="tok-p">{</span>
        <span class="tok-kd">var</span> <span class="tok-nx">customConstraint</span> <span class="tok-o">=</span> <span class="tok-nx">validationService</span><span class="tok-p">.</span><span class="tok-nx">customConstraint</span><span class="tok-p">;</span>

        <span class="tok-nx">expect</span><span class="tok-p">(</span><span class="tok-nx">customConstraint</span><span class="tok-p">(</span><span class="tok-mi">5</span><span class="tok-p">,</span> <span class="tok-kc">true</span><span class="tok-p">)).</span><span class="tok-nx">toBe</span><span class="tok-p">(</span><span class="tok-kc">true</span><span class="tok-p">);</span>
        <span class="tok-nx">expect</span><span class="tok-p">(</span><span class="tok-nx">customConstraint</span><span class="tok-p">(</span><span class="tok-mi">4</span><span class="tok-p">,</span> <span class="tok-kc">false</span><span class="tok-p">)).</span><span class="tok-nx">toBe</span><span class="tok-p">(</span><span class="tok-kc">true</span><span class="tok-p">);</span>
        <span class="tok-nx">expect</span><span class="tok-p">(</span><span class="tok-nx">customConstraint</span><span class="tok-p">(</span><span class="tok-mi">54</span><span class="tok-p">,</span> <span class="tok-kc">true</span><span class="tok-p">)).</span><span class="tok-nx">toBe</span><span class="tok-p">(</span><span class="tok-kc">false</span><span class="tok-p">);</span>
    <span class="tok-p">});</span>

    <span class="tok-nx">it</span><span class="tok-p">(</span><span class="tok-s1">&#39;should fail trying to override an existing constraint&#39;</span><span class="tok-p">,</span> <span class="tok-kd">function</span> <span class="tok-p">()</span> <span class="tok-p">{</span>
        <span class="tok-kd">var</span> <span class="tok-nx">throwErr</span> <span class="tok-o">=</span> <span class="tok-s1">&#39;Cannot override a default constraint&#39;</span><span class="tok-p">;</span>
        <span class="tok-kd">var</span> <span class="tok-nx">testFn</span> <span class="tok-o">=</span> <span class="tok-kd">function</span> <span class="tok-p">()</span> <span class="tok-p">{</span>
            <span class="tok-nx">validationProvider</span><span class="tok-p">.</span><span class="tok-nx">addConstraint</span><span class="tok-p">(</span><span class="tok-s1">&#39;url&#39;</span><span class="tok-p">,</span> <span class="tok-kd">function</span> <span class="tok-p">(</span><span class="tok-nx">value</span><span class="tok-p">,</span> <span class="tok-nx">needsToBeFive</span><span class="tok-p">)</span> <span class="tok-p">{</span>
                <span class="tok-k">if</span> <span class="tok-p">(</span><span class="tok-nx">needsToBeFive</span><span class="tok-p">)</span> <span class="tok-p">{</span>
                    <span class="tok-k">return</span> <span class="tok-nx">value</span> <span class="tok-o">===</span> <span class="tok-mi">5</span><span class="tok-p">;</span>
                <span class="tok-p">}</span>

                <span class="tok-k">return</span> <span class="tok-kc">true</span><span class="tok-p">;</span>
            <span class="tok-p">});</span>
        <span class="tok-p">};</span>

        <span class="tok-nx">expect</span><span class="tok-p">(</span><span class="tok-nx">testFn</span><span class="tok-p">).</span><span class="tok-nx">toThrow</span><span class="tok-p">(</span><span class="tok-nx">throwErr</span><span class="tok-p">);</span>
    <span class="tok-p">});</span>
<span class="tok-p">});</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>La función <code>module</code> se utiliza para indicar al test que deberían prepararse los servicios del módulo indicado.
El rol de este método es similar al de la directiva <code>ng-app</code> en una vista.</p>
</div>
<div class="paragraph">
<p>La función <a href="https://docs.angularjs.org/api/ngMock/function/angular.mock.inject"><code>inject</code></a> tiene la responsabilidad de inyectar los servicios en nuestros tests.</p>
</div>
<div class="paragraph">
<p>Por su parte, el código del provider será:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="javascript"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">  1
  2
  3
  4
  5
  6
  7
  8
  9
 10
 11
 12
 13
 14
 15
 16
 17
 18
 19
 20
 21
 22
 23
 24
 25
 26
 27
 28
 29
 30
 31
 32
 33
 34
 35
 36
 37
 38
 39
 40
 41
 42
 43
 44
 45
 46
 47
 48
 49
 50
 51
 52
 53
 54
 55
 56
 57
 58
 59
 60
 61
 62
 63
 64
 65
 66
 67
 68
 69
 70
 71
 72
 73
 74
 75
 76
 77
 78
 79
 80
 81
 82
 83
 84
 85
 86
 87
 88
 89
 90
 91
 92
 93
 94
 95
 96
 97
 98
 99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
153
154
155
156
157
158
159
160
161
162
163
164
165
166
167
168
169
170
171
172
173
174
175
176
177
178
179
180
181
182
183
184
185
186
187
188
189
190
191
192
193
194
195
196
197
198
199
200
201
202
203
204
205
206
207
208
209
210
211
212
213
214
215
216
217
218
219
220
221
222
223
224
225
226
227
228
229
230
231
232
233
234
235
236
237
238
239
240
241
242
243
244
245
246
247
248
249
250
251
252
253
254
255
256
257
258
259
260
261
262
263
264
265
266
267
268
269
270
271
272
273
274
275
276
277
278
279
280
281
282
283
284
285
286
287
288
289
290
291
292
293
294
295
296
297
298
299
300
301
302
303
304
305
306</div></td><td class="code"><span class="tok-p">(</span><span class="tok-kd">function</span> <span class="tok-p">()</span> <span class="tok-p">{</span>
    <span class="tok-s1">&#39;use strict&#39;</span><span class="tok-p">;</span>

    <span class="tok-nx">angular</span>
        <span class="tok-p">.</span><span class="tok-nx">module</span><span class="tok-p">(</span><span class="tok-s1">&#39;providers.validation&#39;</span><span class="tok-p">)</span>
        <span class="tok-p">.</span><span class="tok-nx">provider</span><span class="tok-p">(</span><span class="tok-s1">&#39;expertoJeeValidation&#39;</span><span class="tok-p">,</span> <span class="tok-kd">function</span> <span class="tok-p">()</span> <span class="tok-p">{</span>
            <span class="tok-kd">var</span> <span class="tok-nx">instance</span> <span class="tok-o">=</span> <span class="tok-p">{};</span>
            <span class="tok-cm">/**</span>
<span class="tok-cm">             * Validates that a String value is not blank</span>
<span class="tok-cm">             * @param value</span>
<span class="tok-cm">             * @param blank</span>
<span class="tok-cm">             * @returns {boolean}</span>
<span class="tok-cm">             */</span>
            <span class="tok-nx">instance</span><span class="tok-p">.</span><span class="tok-nx">blank</span> <span class="tok-o">=</span> <span class="tok-kd">function</span> <span class="tok-p">(</span><span class="tok-nx">value</span><span class="tok-p">,</span> <span class="tok-nx">blank</span><span class="tok-p">)</span> <span class="tok-p">{</span>
                <span class="tok-k">if</span> <span class="tok-p">(</span><span class="tok-k">typeof</span> <span class="tok-nx">value</span> <span class="tok-o">!==</span> <span class="tok-s1">&#39;undefined&#39;</span> <span class="tok-o">&amp;&amp;</span> <span class="tok-nx">value</span> <span class="tok-o">!==</span> <span class="tok-kc">null</span> <span class="tok-o">&amp;&amp;</span> <span class="tok-k">typeof</span> <span class="tok-nx">value</span> <span class="tok-o">!==</span> <span class="tok-s1">&#39;string&#39;</span> <span class="tok-o">&amp;&amp;</span> <span class="tok-o">!</span><span class="tok-p">(</span><span class="tok-nx">value</span> <span class="tok-k">instanceof</span> <span class="tok-nb">String</span><span class="tok-p">))</span> <span class="tok-p">{</span>
                    <span class="tok-k">throw</span> <span class="tok-s1">&#39;Blank constraint only applies to strings&#39;</span><span class="tok-p">;</span>
                <span class="tok-p">}</span>

                <span class="tok-kd">var</span> <span class="tok-nx">isBlank</span> <span class="tok-o">=</span> <span class="tok-k">typeof</span> <span class="tok-nx">value</span> <span class="tok-o">===</span> <span class="tok-s1">&#39;undefined&#39;</span> <span class="tok-o">||</span> <span class="tok-nx">value</span> <span class="tok-o">===</span> <span class="tok-kc">null</span> <span class="tok-o">||</span> <span class="tok-nx">value</span><span class="tok-p">.</span><span class="tok-nx">length</span> <span class="tok-o">===</span> <span class="tok-mi">0</span> <span class="tok-o">||</span> <span class="tok-o">!</span><span class="tok-nx">value</span><span class="tok-p">.</span><span class="tok-nx">trim</span><span class="tok-p">();</span>

                <span class="tok-k">if</span> <span class="tok-p">(</span><span class="tok-o">!</span><span class="tok-nx">blank</span><span class="tok-p">)</span> <span class="tok-p">{</span>
                    <span class="tok-k">return</span> <span class="tok-o">!</span><span class="tok-nx">isBlank</span><span class="tok-p">;</span>
                <span class="tok-p">}</span>

                <span class="tok-k">return</span> <span class="tok-kc">true</span><span class="tok-p">;</span>
            <span class="tok-p">};</span>

            <span class="tok-cm">/**</span>
<span class="tok-cm">             * Validates that a String value is a valid credit card number</span>
<span class="tok-cm">             * @param value</span>
<span class="tok-cm">             * @param creditCard</span>
<span class="tok-cm">             * @returns {boolean}</span>
<span class="tok-cm">             */</span>
            <span class="tok-nx">instance</span><span class="tok-p">.</span><span class="tok-nx">creditCard</span> <span class="tok-o">=</span> <span class="tok-kd">function</span> <span class="tok-p">(</span><span class="tok-nx">value</span><span class="tok-p">,</span> <span class="tok-nx">creditCard</span><span class="tok-p">)</span> <span class="tok-p">{</span>
                <span class="tok-k">throw</span> <span class="tok-s1">&#39;CreditCard constraint: Not implemented yet&#39;</span><span class="tok-p">;</span>

<span class="tok-c1">//                return false;</span>
            <span class="tok-p">};</span>

            <span class="tok-cm">/**</span>
<span class="tok-cm">             * Validates that a String value is a valid email address.</span>
<span class="tok-cm">             * @param value</span>
<span class="tok-cm">             * @param email</span>
<span class="tok-cm">             * @returns {boolean}</span>
<span class="tok-cm">             */</span>
            <span class="tok-nx">instance</span><span class="tok-p">.</span><span class="tok-nx">email</span> <span class="tok-o">=</span> <span class="tok-kd">function</span> <span class="tok-p">(</span><span class="tok-nx">value</span><span class="tok-p">,</span> <span class="tok-nx">email</span><span class="tok-p">)</span> <span class="tok-p">{</span>
                <span class="tok-kd">var</span> <span class="tok-nx">emailRegex</span> <span class="tok-o">=</span> <span class="tok-sr">/^[a-z0-9!#$%&amp;&#39;*+\/=?^_`{|}~.-]+@[a-z0-9]([a-z0-9-]*[a-z0-9])?(\.[a-z0-9]([a-z0-9-]*[a-z0-9])?)*$/i</span><span class="tok-p">;</span>

                <span class="tok-k">if</span> <span class="tok-p">(</span><span class="tok-nx">email</span><span class="tok-p">)</span> <span class="tok-p">{</span>
                    <span class="tok-k">return</span> <span class="tok-nx">emailRegex</span><span class="tok-p">.</span><span class="tok-nx">test</span><span class="tok-p">(</span><span class="tok-nx">value</span><span class="tok-p">);</span>
                <span class="tok-p">}</span>

                <span class="tok-k">return</span> <span class="tok-kc">true</span><span class="tok-p">;</span>
            <span class="tok-p">};</span>

            <span class="tok-cm">/**</span>
<span class="tok-cm">             * Validates that a value is within a range or collection of constrained values.</span>
<span class="tok-cm">             * @param value</span>
<span class="tok-cm">             * @param array</span>
<span class="tok-cm">             * @returns {boolean}</span>
<span class="tok-cm">             */</span>
            <span class="tok-nx">instance</span><span class="tok-p">.</span><span class="tok-nx">inList</span> <span class="tok-o">=</span> <span class="tok-kd">function</span> <span class="tok-p">(</span><span class="tok-nx">value</span><span class="tok-p">,</span> <span class="tok-nx">array</span><span class="tok-p">)</span> <span class="tok-p">{</span>
                <span class="tok-k">if</span> <span class="tok-p">(</span><span class="tok-o">!</span><span class="tok-p">(</span><span class="tok-nx">array</span> <span class="tok-k">instanceof</span> <span class="tok-nb">Array</span><span class="tok-p">))</span> <span class="tok-p">{</span>
                    <span class="tok-k">throw</span> <span class="tok-s1">&#39;InList constraint only applies to Arrays&#39;</span><span class="tok-p">;</span>
                <span class="tok-p">}</span>

                <span class="tok-k">return</span> <span class="tok-nx">array</span><span class="tok-p">.</span><span class="tok-nx">indexOf</span><span class="tok-p">(</span><span class="tok-nx">value</span><span class="tok-p">)</span> <span class="tok-o">!==</span> <span class="tok-o">-</span><span class="tok-mi">1</span><span class="tok-p">;</span>
            <span class="tok-p">};</span>

            <span class="tok-cm">/**</span>
<span class="tok-cm">             * Validates that a String value matches a given regular expression.</span>
<span class="tok-cm">             * @param value</span>
<span class="tok-cm">             * @param expr</span>
<span class="tok-cm">             * @returns {boolean}</span>
<span class="tok-cm">             */</span>
            <span class="tok-nx">instance</span><span class="tok-p">.</span><span class="tok-nx">matches</span> <span class="tok-o">=</span> <span class="tok-kd">function</span> <span class="tok-p">(</span><span class="tok-nx">value</span><span class="tok-p">,</span> <span class="tok-nx">expr</span><span class="tok-p">)</span> <span class="tok-p">{</span>
                <span class="tok-k">if</span> <span class="tok-p">(</span><span class="tok-k">typeof</span> <span class="tok-nx">value</span> <span class="tok-o">!==</span> <span class="tok-s1">&#39;string&#39;</span> <span class="tok-o">&amp;&amp;</span> <span class="tok-o">!</span><span class="tok-p">(</span><span class="tok-nx">value</span> <span class="tok-k">instanceof</span> <span class="tok-nb">String</span><span class="tok-p">))</span> <span class="tok-p">{</span>
                    <span class="tok-k">throw</span> <span class="tok-s1">&#39;Matches constraint only applies to Strings&#39;</span><span class="tok-p">;</span>
                <span class="tok-p">}</span>

                <span class="tok-kd">var</span> <span class="tok-nx">regexp</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-nb">RegExp</span><span class="tok-p">(</span><span class="tok-nx">expr</span><span class="tok-p">);</span>

                <span class="tok-k">return</span> <span class="tok-nx">regexp</span><span class="tok-p">.</span><span class="tok-nx">test</span><span class="tok-p">(</span><span class="tok-nx">value</span><span class="tok-p">);</span>
            <span class="tok-p">};</span>

            <span class="tok-cm">/**</span>
<span class="tok-cm">             * Validates that a value does not exceed the given maximum value.</span>
<span class="tok-cm">             * @param value</span>
<span class="tok-cm">             * @param max</span>
<span class="tok-cm">             * @returns {boolean}</span>
<span class="tok-cm">             */</span>
            <span class="tok-nx">instance</span><span class="tok-p">.</span><span class="tok-nx">max</span> <span class="tok-o">=</span> <span class="tok-kd">function</span> <span class="tok-p">(</span><span class="tok-nx">value</span><span class="tok-p">,</span> <span class="tok-nx">max</span><span class="tok-p">)</span> <span class="tok-p">{</span>
                <span class="tok-k">if</span> <span class="tok-p">(</span><span class="tok-k">typeof</span> <span class="tok-nx">value</span> <span class="tok-o">!==</span> <span class="tok-s1">&#39;number&#39;</span> <span class="tok-o">&amp;&amp;</span> <span class="tok-o">!</span><span class="tok-p">(</span><span class="tok-nx">value</span> <span class="tok-k">instanceof</span> <span class="tok-nb">Number</span><span class="tok-p">))</span> <span class="tok-p">{</span>
                    <span class="tok-k">throw</span> <span class="tok-s1">&#39;Max constraint only applies to numbers&#39;</span><span class="tok-p">;</span>
                <span class="tok-p">}</span>

                <span class="tok-k">return</span> <span class="tok-nx">value</span> <span class="tok-o">&lt;=</span> <span class="tok-nx">max</span><span class="tok-p">;</span>
            <span class="tok-p">};</span>

            <span class="tok-cm">/**</span>
<span class="tok-cm">             * Validates that a value&#39;s size does not exceed the given maximum value.</span>
<span class="tok-cm">             * @param value</span>
<span class="tok-cm">             * @param maxSize</span>
<span class="tok-cm">             * @returns {boolean}</span>
<span class="tok-cm">             */</span>
            <span class="tok-nx">instance</span><span class="tok-p">.</span><span class="tok-nx">maxSize</span> <span class="tok-o">=</span> <span class="tok-kd">function</span> <span class="tok-p">(</span><span class="tok-nx">value</span><span class="tok-p">,</span> <span class="tok-nx">maxSize</span><span class="tok-p">)</span> <span class="tok-p">{</span>
                <span class="tok-k">if</span> <span class="tok-p">(</span><span class="tok-nx">value</span> <span class="tok-k">instanceof</span> <span class="tok-nb">Array</span> <span class="tok-o">||</span> <span class="tok-nx">value</span> <span class="tok-k">instanceof</span> <span class="tok-nb">String</span> <span class="tok-o">||</span> <span class="tok-k">typeof</span> <span class="tok-nx">value</span> <span class="tok-o">===</span> <span class="tok-s1">&#39;string&#39;</span><span class="tok-p">)</span> <span class="tok-p">{</span>
                    <span class="tok-k">return</span> <span class="tok-nx">value</span><span class="tok-p">.</span><span class="tok-nx">length</span> <span class="tok-o">&lt;=</span> <span class="tok-nx">maxSize</span><span class="tok-p">;</span>
                <span class="tok-p">}</span>

                <span class="tok-k">if</span> <span class="tok-p">(</span><span class="tok-k">typeof</span> <span class="tok-nx">maxSize</span> <span class="tok-o">!==</span> <span class="tok-s1">&#39;number&#39;</span> <span class="tok-o">&amp;&amp;</span> <span class="tok-o">!</span><span class="tok-p">(</span><span class="tok-nx">maxSize</span> <span class="tok-k">instanceof</span> <span class="tok-nb">Number</span><span class="tok-p">))</span> <span class="tok-p">{</span>
                    <span class="tok-k">throw</span> <span class="tok-s1">&#39;Argument maxSize should be a number&#39;</span><span class="tok-p">;</span>
                <span class="tok-p">}</span>

                <span class="tok-k">throw</span> <span class="tok-s1">&#39;MaxSize constraint only applies to Arrays and Strings&#39;</span><span class="tok-p">;</span>
            <span class="tok-p">};</span>

            <span class="tok-cm">/**</span>
<span class="tok-cm">             * Validates that a value does not fall below the given minimum value.</span>
<span class="tok-cm">             * @param value</span>
<span class="tok-cm">             * @param min</span>
<span class="tok-cm">             * @returns {boolean}</span>
<span class="tok-cm">             */</span>
            <span class="tok-nx">instance</span><span class="tok-p">.</span><span class="tok-nx">min</span> <span class="tok-o">=</span> <span class="tok-kd">function</span> <span class="tok-p">(</span><span class="tok-nx">value</span><span class="tok-p">,</span> <span class="tok-nx">min</span><span class="tok-p">)</span> <span class="tok-p">{</span>
                <span class="tok-k">if</span> <span class="tok-p">(</span><span class="tok-k">typeof</span> <span class="tok-nx">value</span> <span class="tok-o">!==</span> <span class="tok-s1">&#39;number&#39;</span> <span class="tok-o">&amp;&amp;</span> <span class="tok-o">!</span><span class="tok-p">(</span><span class="tok-nx">value</span> <span class="tok-k">instanceof</span> <span class="tok-nb">Number</span><span class="tok-p">))</span> <span class="tok-p">{</span>
                    <span class="tok-k">throw</span> <span class="tok-s1">&#39;Min constraint only applies to numbers&#39;</span><span class="tok-p">;</span>
                <span class="tok-p">}</span>

                <span class="tok-k">return</span> <span class="tok-nx">value</span> <span class="tok-o">&gt;=</span> <span class="tok-nx">min</span><span class="tok-p">;</span>
            <span class="tok-p">};</span>

            <span class="tok-cm">/**</span>
<span class="tok-cm">             * Validates that a value&#39;s size does not fall below the given minimum value.</span>
<span class="tok-cm">             * @param value</span>
<span class="tok-cm">             * @param minSize</span>
<span class="tok-cm">             * @returns {boolean}</span>
<span class="tok-cm">             */</span>
            <span class="tok-nx">instance</span><span class="tok-p">.</span><span class="tok-nx">minSize</span> <span class="tok-o">=</span> <span class="tok-kd">function</span> <span class="tok-p">(</span><span class="tok-nx">value</span><span class="tok-p">,</span> <span class="tok-nx">minSize</span><span class="tok-p">)</span> <span class="tok-p">{</span>
                <span class="tok-k">if</span> <span class="tok-p">(</span><span class="tok-nx">value</span> <span class="tok-k">instanceof</span> <span class="tok-nb">Array</span> <span class="tok-o">||</span> <span class="tok-nx">value</span> <span class="tok-k">instanceof</span> <span class="tok-nb">String</span> <span class="tok-o">||</span> <span class="tok-k">typeof</span> <span class="tok-nx">value</span> <span class="tok-o">===</span> <span class="tok-s1">&#39;string&#39;</span><span class="tok-p">)</span> <span class="tok-p">{</span>
                    <span class="tok-k">return</span> <span class="tok-nx">value</span><span class="tok-p">.</span><span class="tok-nx">length</span> <span class="tok-o">&gt;=</span> <span class="tok-nx">minSize</span><span class="tok-p">;</span>
                <span class="tok-p">}</span>

                <span class="tok-k">if</span> <span class="tok-p">(</span><span class="tok-k">typeof</span> <span class="tok-nx">minSize</span> <span class="tok-o">!==</span> <span class="tok-s1">&#39;number&#39;</span> <span class="tok-o">&amp;&amp;</span> <span class="tok-o">!</span><span class="tok-p">(</span><span class="tok-nx">minSize</span> <span class="tok-k">instanceof</span> <span class="tok-nb">Number</span><span class="tok-p">))</span> <span class="tok-p">{</span>
                    <span class="tok-k">throw</span> <span class="tok-s1">&#39;Argument minSize should be a number&#39;</span><span class="tok-p">;</span>
                <span class="tok-p">}</span>

                <span class="tok-k">throw</span> <span class="tok-s1">&#39;MinSize constraint only applies to Arrays and Strings&#39;</span><span class="tok-p">;</span>
            <span class="tok-p">};</span>

            <span class="tok-cm">/**</span>
<span class="tok-cm">             * Validates that that a property is not equal to the specified value</span>
<span class="tok-cm">             * @param value</span>
<span class="tok-cm">             * @param otherValue</span>
<span class="tok-cm">             * @returns {boolean}</span>
<span class="tok-cm">             */</span>
            <span class="tok-nx">instance</span><span class="tok-p">.</span><span class="tok-nx">notEqual</span> <span class="tok-o">=</span> <span class="tok-kd">function</span> <span class="tok-p">(</span><span class="tok-nx">value</span><span class="tok-p">,</span> <span class="tok-nx">otherValue</span><span class="tok-p">)</span> <span class="tok-p">{</span>
                <span class="tok-k">throw</span> <span class="tok-s1">&#39;NotEqual constraint: Not implemented yet&#39;</span><span class="tok-p">;</span>

<span class="tok-c1">//                return value !== otherValue;</span>
            <span class="tok-p">};</span>

            <span class="tok-cm">/**</span>
<span class="tok-cm">             * Allows a property to be set to null - defaults to true. Undefined is considered null in this constraint</span>
<span class="tok-cm">             * @param value</span>
<span class="tok-cm">             * @param nullable</span>
<span class="tok-cm">             * @returns {boolean}</span>
<span class="tok-cm">             */</span>
            <span class="tok-nx">instance</span><span class="tok-p">.</span><span class="tok-nx">nullable</span> <span class="tok-o">=</span> <span class="tok-kd">function</span> <span class="tok-p">(</span><span class="tok-nx">value</span><span class="tok-p">,</span> <span class="tok-nx">nullable</span><span class="tok-p">)</span> <span class="tok-p">{</span>
                <span class="tok-k">if</span> <span class="tok-p">(</span><span class="tok-nx">arguments</span><span class="tok-p">.</span><span class="tok-nx">length</span> <span class="tok-o">!==</span> <span class="tok-mi">2</span><span class="tok-p">)</span> <span class="tok-p">{</span>
                    <span class="tok-k">throw</span> <span class="tok-s1">&#39;Constraint error. Must provide a boolean value for nullable&#39;</span><span class="tok-p">;</span>
                <span class="tok-p">}</span>

                <span class="tok-k">if</span> <span class="tok-p">(</span><span class="tok-o">!</span><span class="tok-nx">nullable</span><span class="tok-p">)</span> <span class="tok-p">{</span>
                    <span class="tok-k">return</span> <span class="tok-nx">value</span> <span class="tok-o">!==</span> <span class="tok-kc">null</span> <span class="tok-o">&amp;&amp;</span> <span class="tok-k">typeof</span> <span class="tok-nx">value</span> <span class="tok-o">!==</span> <span class="tok-s1">&#39;undefined&#39;</span><span class="tok-p">;</span>
                <span class="tok-p">}</span>

                <span class="tok-k">return</span> <span class="tok-kc">true</span><span class="tok-p">;</span>
            <span class="tok-p">};</span>

            <span class="tok-cm">/**</span>
<span class="tok-cm">             * Ensures that the given value should be numeric</span>
<span class="tok-cm">             * @param value</span>
<span class="tok-cm">             * @param numeric</span>
<span class="tok-cm">             */</span>
            <span class="tok-nx">instance</span><span class="tok-p">.</span><span class="tok-nx">numeric</span> <span class="tok-o">=</span> <span class="tok-kd">function</span> <span class="tok-p">(</span><span class="tok-nx">value</span><span class="tok-p">,</span> <span class="tok-nx">numeric</span><span class="tok-p">)</span> <span class="tok-p">{</span>
                <span class="tok-k">if</span> <span class="tok-p">(</span><span class="tok-nx">arguments</span><span class="tok-p">.</span><span class="tok-nx">length</span> <span class="tok-o">!==</span> <span class="tok-mi">2</span><span class="tok-p">)</span> <span class="tok-p">{</span>
                    <span class="tok-k">throw</span> <span class="tok-s1">&#39;Numeric constraint expects two arguments&#39;</span><span class="tok-p">;</span>
                <span class="tok-p">}</span>

                <span class="tok-kd">var</span> <span class="tok-nx">isNumeric</span> <span class="tok-o">=</span> <span class="tok-k">typeof</span> <span class="tok-nx">value</span> <span class="tok-o">===</span> <span class="tok-s1">&#39;number&#39;</span> <span class="tok-o">||</span> <span class="tok-nx">value</span> <span class="tok-k">instanceof</span> <span class="tok-nb">Number</span><span class="tok-p">;</span>

                <span class="tok-k">if</span> <span class="tok-p">(</span><span class="tok-nx">numeric</span><span class="tok-p">)</span> <span class="tok-p">{</span>
                    <span class="tok-k">return</span> <span class="tok-nx">isNumeric</span><span class="tok-p">;</span>
                <span class="tok-p">}</span>

                <span class="tok-k">return</span> <span class="tok-kc">true</span><span class="tok-p">;</span>
            <span class="tok-p">};</span>

            <span class="tok-cm">/**</span>
<span class="tok-cm">             * Ensures that a property&#39;s value occurs within a specified range</span>
<span class="tok-cm">             * @param value</span>
<span class="tok-cm">             * @param start</span>
<span class="tok-cm">             * @param end</span>
<span class="tok-cm">             * @returns {boolean}</span>
<span class="tok-cm">             */</span>
            <span class="tok-nx">instance</span><span class="tok-p">.</span><span class="tok-nx">range</span> <span class="tok-o">=</span> <span class="tok-kd">function</span> <span class="tok-p">(</span><span class="tok-nx">value</span><span class="tok-p">,</span> <span class="tok-nx">start</span><span class="tok-p">,</span> <span class="tok-nx">end</span><span class="tok-p">)</span> <span class="tok-p">{</span>
                <span class="tok-k">if</span> <span class="tok-p">(</span><span class="tok-nx">arguments</span><span class="tok-p">.</span><span class="tok-nx">length</span> <span class="tok-o">!==</span> <span class="tok-mi">3</span><span class="tok-p">)</span> <span class="tok-p">{</span>
                    <span class="tok-k">throw</span> <span class="tok-s1">&#39;Range constraint expects three arguments&#39;</span><span class="tok-p">;</span>
                <span class="tok-p">}</span>

                <span class="tok-k">if</span> <span class="tok-p">(</span><span class="tok-o">!</span><span class="tok-nx">instance</span><span class="tok-p">.</span><span class="tok-nx">numeric</span><span class="tok-p">(</span><span class="tok-nx">value</span><span class="tok-p">,</span> <span class="tok-kc">true</span><span class="tok-p">)</span> <span class="tok-o">||</span> <span class="tok-o">!</span><span class="tok-nx">instance</span><span class="tok-p">.</span><span class="tok-nx">numeric</span><span class="tok-p">(</span><span class="tok-nx">start</span><span class="tok-p">,</span> <span class="tok-kc">true</span><span class="tok-p">)</span> <span class="tok-o">||</span> <span class="tok-o">!</span><span class="tok-nx">instance</span><span class="tok-p">.</span><span class="tok-nx">numeric</span><span class="tok-p">(</span><span class="tok-nx">end</span><span class="tok-p">,</span> <span class="tok-kc">true</span><span class="tok-p">))</span> <span class="tok-p">{</span>
                    <span class="tok-k">throw</span> <span class="tok-s1">&#39;All three values must be numbers&#39;</span><span class="tok-p">;</span>
                <span class="tok-p">}</span>

                <span class="tok-k">return</span> <span class="tok-nx">value</span> <span class="tok-o">&gt;=</span> <span class="tok-nb">Math</span><span class="tok-p">.</span><span class="tok-nx">min</span><span class="tok-p">(</span><span class="tok-nx">start</span><span class="tok-p">,</span> <span class="tok-nx">end</span><span class="tok-p">)</span> <span class="tok-o">&amp;&amp;</span> <span class="tok-nx">value</span> <span class="tok-o">&lt;=</span> <span class="tok-nb">Math</span><span class="tok-p">.</span><span class="tok-nx">max</span><span class="tok-p">(</span><span class="tok-nx">start</span><span class="tok-p">,</span> <span class="tok-nx">end</span><span class="tok-p">);</span>
            <span class="tok-p">};</span>

            <span class="tok-cm">/**</span>
<span class="tok-cm">             * Restricts the size of a collection or the length of a String.</span>
<span class="tok-cm">             * @param value</span>
<span class="tok-cm">             * @param start</span>
<span class="tok-cm">             * @param end</span>
<span class="tok-cm">             * @returns {boolean}</span>
<span class="tok-cm">             */</span>
            <span class="tok-nx">instance</span><span class="tok-p">.</span><span class="tok-nx">size</span> <span class="tok-o">=</span> <span class="tok-kd">function</span> <span class="tok-p">(</span><span class="tok-nx">value</span><span class="tok-p">,</span> <span class="tok-nx">start</span><span class="tok-p">,</span> <span class="tok-nx">end</span><span class="tok-p">)</span> <span class="tok-p">{</span>
                <span class="tok-k">if</span> <span class="tok-p">(</span><span class="tok-nx">arguments</span><span class="tok-p">.</span><span class="tok-nx">length</span> <span class="tok-o">!==</span> <span class="tok-mi">3</span><span class="tok-p">)</span> <span class="tok-p">{</span>
                    <span class="tok-k">throw</span> <span class="tok-s1">&#39;Size constraint expects three arguments&#39;</span><span class="tok-p">;</span>
                <span class="tok-p">}</span>

                <span class="tok-k">if</span> <span class="tok-p">(</span><span class="tok-o">!</span><span class="tok-nx">instance</span><span class="tok-p">.</span><span class="tok-nx">numeric</span><span class="tok-p">(</span><span class="tok-nx">start</span><span class="tok-p">,</span> <span class="tok-kc">true</span><span class="tok-p">)</span> <span class="tok-o">||</span> <span class="tok-o">!</span><span class="tok-nx">instance</span><span class="tok-p">.</span><span class="tok-nx">numeric</span><span class="tok-p">(</span><span class="tok-nx">end</span><span class="tok-p">,</span> <span class="tok-kc">true</span><span class="tok-p">))</span> <span class="tok-p">{</span>
                    <span class="tok-k">throw</span> <span class="tok-s1">&#39;Start and end values must be numbers&#39;</span><span class="tok-p">;</span>
                <span class="tok-p">}</span>

                <span class="tok-k">if</span> <span class="tok-p">(</span><span class="tok-nx">value</span> <span class="tok-k">instanceof</span> <span class="tok-nb">Array</span> <span class="tok-o">||</span> <span class="tok-nx">value</span> <span class="tok-k">instanceof</span> <span class="tok-nb">String</span> <span class="tok-o">||</span> <span class="tok-k">typeof</span> <span class="tok-nx">value</span> <span class="tok-o">===</span> <span class="tok-s1">&#39;string&#39;</span><span class="tok-p">)</span> <span class="tok-p">{</span>
                    <span class="tok-k">return</span> <span class="tok-nx">value</span><span class="tok-p">.</span><span class="tok-nx">length</span> <span class="tok-o">&gt;=</span> <span class="tok-nb">Math</span><span class="tok-p">.</span><span class="tok-nx">min</span><span class="tok-p">(</span><span class="tok-nx">start</span><span class="tok-p">,</span> <span class="tok-nx">end</span><span class="tok-p">)</span> <span class="tok-o">&amp;&amp;</span> <span class="tok-nx">value</span><span class="tok-p">.</span><span class="tok-nx">length</span> <span class="tok-o">&lt;=</span> <span class="tok-nb">Math</span><span class="tok-p">.</span><span class="tok-nx">max</span><span class="tok-p">(</span><span class="tok-nx">start</span><span class="tok-p">,</span> <span class="tok-nx">end</span><span class="tok-p">);</span>
                <span class="tok-p">}</span>

                <span class="tok-k">throw</span> <span class="tok-s1">&#39;Size constraint only applies to Arrays and Strings&#39;</span><span class="tok-p">;</span>
            <span class="tok-p">};</span>

            <span class="tok-cm">/**</span>
<span class="tok-cm">             * Constrains a property as unique at the database level</span>
<span class="tok-cm">             * @param value</span>
<span class="tok-cm">             * @param unique</span>
<span class="tok-cm">             * @returns {boolean}</span>
<span class="tok-cm">             */</span>
            <span class="tok-nx">instance</span><span class="tok-p">.</span><span class="tok-nx">unique</span> <span class="tok-o">=</span> <span class="tok-kd">function</span> <span class="tok-p">(</span><span class="tok-nx">value</span><span class="tok-p">,</span> <span class="tok-nx">unique</span><span class="tok-p">)</span> <span class="tok-p">{</span>
                <span class="tok-k">throw</span> <span class="tok-s1">&#39;Unique constraint: not implemented yet&#39;</span><span class="tok-p">;</span>

<span class="tok-c1">//                return false;</span>
            <span class="tok-p">};</span>

            <span class="tok-cm">/**</span>
<span class="tok-cm">             * Validates that a String value is a valid URL.</span>
<span class="tok-cm">             * @param value</span>
<span class="tok-cm">             * @param url</span>
<span class="tok-cm">             * @returns {boolean}</span>
<span class="tok-cm">             */</span>
            <span class="tok-nx">instance</span><span class="tok-p">.</span><span class="tok-nx">url</span> <span class="tok-o">=</span> <span class="tok-kd">function</span> <span class="tok-p">(</span><span class="tok-nx">value</span><span class="tok-p">,</span> <span class="tok-nx">url</span><span class="tok-p">)</span> <span class="tok-p">{</span>
                <span class="tok-k">if</span><span class="tok-p">(</span><span class="tok-nx">arguments</span><span class="tok-p">.</span><span class="tok-nx">length</span> <span class="tok-o">!==</span> <span class="tok-mi">2</span><span class="tok-p">)</span> <span class="tok-p">{</span>
                    <span class="tok-k">throw</span> <span class="tok-s1">&#39;Url constraint: expected 2 arguments&#39;</span><span class="tok-p">;</span>
                <span class="tok-p">}</span>

                <span class="tok-k">if</span><span class="tok-p">(</span><span class="tok-k">typeof</span> <span class="tok-nx">value</span> <span class="tok-o">!==</span> <span class="tok-s1">&#39;string&#39;</span> <span class="tok-o">&amp;&amp;</span> <span class="tok-o">!</span><span class="tok-p">(</span><span class="tok-nx">value</span> <span class="tok-k">instanceof</span> <span class="tok-nb">String</span><span class="tok-p">))</span> <span class="tok-p">{</span>
                    <span class="tok-k">throw</span> <span class="tok-s1">&#39;Url constraint: value expected to be a string&#39;</span><span class="tok-p">;</span>
                <span class="tok-p">}</span>

                <span class="tok-k">if</span><span class="tok-p">(</span><span class="tok-k">typeof</span> <span class="tok-nx">url</span> <span class="tok-o">!==</span> <span class="tok-s1">&#39;boolean&#39;</span> <span class="tok-o">&amp;&amp;</span> <span class="tok-o">!</span><span class="tok-p">(</span><span class="tok-nx">url</span> <span class="tok-k">instanceof</span> <span class="tok-nb">Boolean</span><span class="tok-p">))</span> <span class="tok-p">{</span>
                    <span class="tok-k">throw</span> <span class="tok-s1">&#39;Url constraint: url expected to be a boolean&#39;</span><span class="tok-p">;</span>
                <span class="tok-p">}</span>

                <span class="tok-kd">var</span> <span class="tok-nx">urlRegex</span> <span class="tok-o">=</span> <span class="tok-sr">/^(ftp|http|https):\/\/(\w+:{0,1}\w*@)?(\S+)(:[0-9]+)?(\/|\/([\w#!:.?+=&amp;%@!\-\/]))?$/</span><span class="tok-p">;</span>

                <span class="tok-k">if</span> <span class="tok-p">(</span><span class="tok-nx">url</span><span class="tok-p">)</span> <span class="tok-p">{</span>
                    <span class="tok-k">return</span> <span class="tok-nx">urlRegex</span><span class="tok-p">.</span><span class="tok-nx">test</span><span class="tok-p">(</span><span class="tok-nx">value</span><span class="tok-p">);</span>
                <span class="tok-p">}</span>

                <span class="tok-k">return</span> <span class="tok-kc">true</span><span class="tok-p">;</span>
            <span class="tok-p">};</span>

            <span class="tok-kd">var</span> <span class="tok-nx">defaultConstraints</span> <span class="tok-o">=</span> <span class="tok-p">[];</span>
            <span class="tok-k">for</span> <span class="tok-p">(</span><span class="tok-kd">var</span> <span class="tok-nx">i</span> <span class="tok-k">in</span> <span class="tok-nx">instance</span><span class="tok-p">)</span> <span class="tok-p">{</span>
                <span class="tok-nx">defaultConstraints</span><span class="tok-p">.</span><span class="tok-nx">push</span><span class="tok-p">(</span><span class="tok-nx">i</span><span class="tok-p">);</span>
            <span class="tok-p">}</span>

            <span class="tok-k">this</span><span class="tok-p">.</span><span class="tok-nx">addConstraint</span> <span class="tok-o">=</span> <span class="tok-kd">function</span> <span class="tok-p">(</span><span class="tok-nx">constraintName</span><span class="tok-p">,</span> <span class="tok-nx">fn</span><span class="tok-p">)</span> <span class="tok-p">{</span>
                <span class="tok-k">if</span> <span class="tok-p">(</span><span class="tok-nx">defaultConstraints</span><span class="tok-p">.</span><span class="tok-nx">indexOf</span><span class="tok-p">(</span><span class="tok-nx">constraintName</span><span class="tok-p">)</span> <span class="tok-o">!==</span> <span class="tok-o">-</span><span class="tok-mi">1</span><span class="tok-p">)</span> <span class="tok-p">{</span>
                    <span class="tok-k">throw</span> <span class="tok-s1">&#39;Cannot override a default constraint&#39;</span><span class="tok-p">;</span>
                <span class="tok-p">}</span>

                <span class="tok-nx">instance</span><span class="tok-p">[</span><span class="tok-nx">constraintName</span><span class="tok-p">]</span> <span class="tok-o">=</span> <span class="tok-nx">fn</span><span class="tok-p">;</span>
            <span class="tok-p">};</span>

            <span class="tok-k">this</span><span class="tok-p">.</span><span class="tok-nx">setErrorMessage</span> <span class="tok-o">=</span> <span class="tok-kd">function</span> <span class="tok-p">(</span><span class="tok-nx">constraintName</span><span class="tok-p">,</span> <span class="tok-nx">message</span><span class="tok-p">)</span> <span class="tok-p">{</span>
                <span class="tok-nx">instance</span><span class="tok-p">[</span><span class="tok-nx">constraintName</span> <span class="tok-o">+</span> <span class="tok-s1">&#39;Message&#39;</span><span class="tok-p">]</span> <span class="tok-o">=</span> <span class="tok-nx">message</span><span class="tok-p">;</span>
            <span class="tok-p">};</span>

            <span class="tok-nx">instance</span><span class="tok-p">.</span><span class="tok-nx">getErrorMessage</span> <span class="tok-o">=</span> <span class="tok-kd">function</span> <span class="tok-p">(</span><span class="tok-nx">constraintName</span><span class="tok-p">)</span> <span class="tok-p">{</span>
                <span class="tok-k">return</span> <span class="tok-nx">instance</span><span class="tok-p">[</span><span class="tok-nx">constraintName</span> <span class="tok-o">+</span> <span class="tok-s1">&#39;Message&#39;</span><span class="tok-p">];</span>
            <span class="tok-p">};</span>

            <span class="tok-k">this</span><span class="tok-p">.</span><span class="tok-nx">getInstance</span> <span class="tok-o">=</span> <span class="tok-k">this</span><span class="tok-p">.</span><span class="tok-nx">$get</span> <span class="tok-o">=</span> <span class="tok-kd">function</span> <span class="tok-p">()</span> <span class="tok-p">{</span>
                <span class="tok-k">return</span> <span class="tok-nx">instance</span><span class="tok-p">;</span>
            <span class="tok-p">};</span>
        <span class="tok-p">});</span>
<span class="tok-p">})();</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>Lanzando ahora el test nos dará error. Esto se debe a que el módulo del provider no está correctamente definido. Lo corregiremos para que todo funcione correctamente:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="javascript"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2</div></td><td class="code"><span class="tok-nx">angular</span>
    <span class="tok-p">.</span><span class="tok-nx">module</span><span class="tok-p">(</span><span class="tok-s1">&#39;providers.validation&#39;</span><span class="tok-p">,</span> <span class="tok-p">[])</span>
</td></tr></table></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_sobre_el_método_code_inject_code">12.3.4. Sobre el método <code>inject</code></h4>
<div class="paragraph">
<p><code>inject</code> permite que el servicio a inyectar tenga su nombre habitual (ej: <code>$http</code>), o bien su nombre habitual, envuelto por guiones bajos (ej: <code><em>$http</em></code>). Estos guiones son ignorados por el inyector a la hora de resolver el nombre del servicio, y puede ser de gran utilidad si preferimos usar su nombre habitual en nuestros tests.</p>
</div>
<div class="paragraph">
<p>Así estos dos tests serían equivalentes, solo que en un caso mantendríamos el nombre del servicio en lugar de una variable con otro nombre:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="javascript"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16</div></td><td class="code"><span class="tok-nx">describe</span><span class="tok-p">(</span><span class="tok-s1">&#39;provider: expertoJeeValidation&#39;</span><span class="tok-p">,</span> <span class="tok-kd">function</span> <span class="tok-p">()</span> <span class="tok-p">{</span>
    <span class="tok-kd">var</span> <span class="tok-nx">expertoJeeValidation</span><span class="tok-p">;</span>

    <span class="tok-nx">beforeEach</span><span class="tok-p">(</span><span class="tok-nx">module</span><span class="tok-p">(</span><span class="tok-s1">&#39;providers.validation&#39;</span><span class="tok-p">));</span>

    <span class="tok-nx">beforeEach</span><span class="tok-p">(</span>
        <span class="tok-c1">//Inyectar los servicios en los tests</span>
        <span class="tok-nx">inject</span><span class="tok-p">(</span><span class="tok-kd">function</span><span class="tok-p">(</span><span class="tok-nx">_expertoJeeValidation_</span><span class="tok-p">){</span>
          <span class="tok-nx">expertoJeeValidation</span> <span class="tok-o">=</span> <span class="tok-nx">_expertoJeeValidation_</span><span class="tok-p">;</span>
        <span class="tok-p">})</span>
    <span class="tok-p">);</span>

    <span class="tok-c1">// Resto del test. Usaremos &#39;expertoJeeValidation&#39;,</span>
    <span class="tok-c1">// que es lo mismo que usaríamos en el código</span>
    <span class="tok-c1">// de nuestra aplicación</span>
<span class="tok-p">}</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="javascript"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14</div></td><td class="code"><span class="tok-nx">describe</span><span class="tok-p">(</span><span class="tok-s1">&#39;provider: expertoJeeValidation&#39;</span><span class="tok-p">,</span> <span class="tok-kd">function</span> <span class="tok-p">()</span> <span class="tok-p">{</span>
    <span class="tok-kd">var</span> <span class="tok-nx">theService</span><span class="tok-p">;</span>

    <span class="tok-nx">beforeEach</span><span class="tok-p">(</span><span class="tok-nx">module</span><span class="tok-p">(</span><span class="tok-s1">&#39;providers.validation&#39;</span><span class="tok-p">));</span>

    <span class="tok-nx">beforeEach</span><span class="tok-p">(</span>
        <span class="tok-c1">//Inyectar los servicios en los tests</span>
        <span class="tok-nx">inject</span><span class="tok-p">(</span><span class="tok-kd">function</span><span class="tok-p">(</span><span class="tok-nx">expertoJeeValidation</span><span class="tok-p">){</span>
          <span class="tok-nx">theService</span> <span class="tok-o">=</span> <span class="tok-nx">expertoJeeValidation</span><span class="tok-p">;</span>
        <span class="tok-p">})</span>
    <span class="tok-p">);</span>

    <span class="tok-c1">//Resto del test. Usaremos &#39;theService&#39;</span>
<span class="tok-p">}</span>
</td></tr></table></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_testing_de_controladores_y_em_mocking_em_de_peticiones_http">12.3.5. Testing de controladores y <em>Mocking</em> de peticiones HTTP.</h4>
<div class="paragraph">
<p>Vamos ahora a ver qué sería necesario para testear un controlador. Supondremos un controlador que expondrá en el <code>scope</code> un método llamado <code>getUsers</code>, que se conectará a un servicio HTTP (<code>/users</code>) y devolverá un listado de usuarios. El controlador también deberá contemplar posibles errores en la llamada al servicio.</p>
</div>
<div class="paragraph">
<p>Si se produjera algún error, existe una variable en el <code>scope</code> llamada <code>hasError</code> que pasaría a tener un valor cierto. Los usuarios se guardarán en una variable del <code>scope</code> llamada <code>users</code>.</p>
</div>
<div class="paragraph">
<p>El código del test (<code>test/controller/usersCtrlSpec.js</code>) será el siguiente:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="javascript"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61</div></td><td class="code"><span class="tok-s1">&#39;use strict&#39;</span><span class="tok-p">;</span>

<span class="tok-nx">describe</span><span class="tok-p">(</span><span class="tok-s1">&#39;Controller: usersCtrl&#39;</span><span class="tok-p">,</span> <span class="tok-kd">function</span><span class="tok-p">()</span> <span class="tok-p">{</span>
    <span class="tok-kd">var</span> <span class="tok-nx">scope</span><span class="tok-p">,</span> <span class="tok-nx">controller</span><span class="tok-p">,</span> <span class="tok-nx">httpBackend</span><span class="tok-p">;</span>

    <span class="tok-c1">// Inicializar el módulo antes de cada test</span>
    <span class="tok-nx">beforeEach</span><span class="tok-p">(</span><span class="tok-nx">module</span><span class="tok-p">(</span><span class="tok-s1">&#39;expertojee.controllers&#39;</span><span class="tok-p">));</span>

    <span class="tok-c1">// Inyección de dependencias, mockearemos $http con el servicio $httpBackend</span>
    <span class="tok-nx">beforeEach</span><span class="tok-p">(</span><span class="tok-nx">inject</span><span class="tok-p">(</span><span class="tok-kd">function</span><span class="tok-p">(</span><span class="tok-nx">$rootScope</span><span class="tok-p">,</span> <span class="tok-nx">$controller</span><span class="tok-p">,</span> <span class="tok-nx">$httpBackend</span><span class="tok-p">)</span> <span class="tok-p">{</span>
        <span class="tok-nx">scope</span> <span class="tok-o">=</span> <span class="tok-nx">$rootScope</span><span class="tok-p">.</span><span class="tok-nx">$new</span><span class="tok-p">();</span>
        <span class="tok-nx">controller</span> <span class="tok-o">=</span> <span class="tok-nx">$controller</span><span class="tok-p">;</span>
        <span class="tok-nx">httpBackend</span> <span class="tok-o">=</span> <span class="tok-nx">$httpBackend</span><span class="tok-p">;</span>
    <span class="tok-p">}));</span>

    <span class="tok-nx">iit</span><span class="tok-p">(</span><span class="tok-s1">&#39;should query the webservice&#39;</span><span class="tok-p">,</span> <span class="tok-kd">function</span><span class="tok-p">()</span> <span class="tok-p">{</span>
        <span class="tok-c1">// Definimos qué petición HTTP esperamos, y qué resultado queremos devolver</span>
        <span class="tok-nx">httpBackend</span>
          <span class="tok-p">.</span><span class="tok-nx">expectGET</span><span class="tok-p">(</span><span class="tok-s1">&#39;/users&#39;</span><span class="tok-p">)</span>
          <span class="tok-p">.</span><span class="tok-nx">respond</span><span class="tok-p">(</span><span class="tok-s1">&#39;[{&quot;firstName&quot;: &quot;Alejandro&quot;, &quot;lastName&quot;: &quot;Such&quot;}, {&quot;firstName&quot;: &quot;Domingo&quot;, &quot;lastName&quot;: &quot;Gallardo&quot;}]&#39;</span><span class="tok-p">);</span>

        <span class="tok-c1">// Inicializamos el controlador</span>
        <span class="tok-nx">controller</span><span class="tok-p">(</span><span class="tok-s1">&#39;usersCtrl&#39;</span><span class="tok-p">,</span> <span class="tok-p">{</span><span class="tok-s1">&#39;$scope&#39;</span><span class="tok-o">:</span> <span class="tok-nx">scope</span> <span class="tok-p">});</span>

        <span class="tok-c1">//Llamamos al método del controlador</span>
        <span class="tok-nx">scope</span><span class="tok-p">.</span><span class="tok-nx">getUsers</span><span class="tok-p">()</span>

        <span class="tok-c1">// Responder a todas las peticiones HTTP</span>
        <span class="tok-nx">httpBackend</span><span class="tok-p">.</span><span class="tok-nx">flush</span><span class="tok-p">();</span>

        <span class="tok-c1">// Lanzamos scope.$apply() para que se resuelvan todas las promesas</span>
        <span class="tok-nx">scope</span><span class="tok-p">.</span><span class="tok-nx">$apply</span><span class="tok-p">();</span>

        <span class="tok-c1">// Evaluar los valores esperados</span>
        <span class="tok-nx">expect</span><span class="tok-p">(</span><span class="tok-nx">scope</span><span class="tok-p">.</span><span class="tok-nx">users</span><span class="tok-p">.</span><span class="tok-nx">length</span><span class="tok-p">).</span><span class="tok-nx">toBe</span><span class="tok-p">(</span><span class="tok-mi">2</span><span class="tok-p">);</span>
        <span class="tok-nx">expect</span><span class="tok-p">(</span><span class="tok-nx">scope</span><span class="tok-p">.</span><span class="tok-nx">hasError</span><span class="tok-p">).</span><span class="tok-nx">toBe</span><span class="tok-p">(</span><span class="tok-kc">false</span><span class="tok-p">);</span>
    <span class="tok-p">});</span>

    <span class="tok-nx">iit</span><span class="tok-p">(</span><span class="tok-s1">&#39;should catch an error&#39;</span><span class="tok-p">,</span> <span class="tok-kd">function</span><span class="tok-p">()</span> <span class="tok-p">{</span>
        <span class="tok-c1">// Cuando se realice una petición a /users, responder con un error 500</span>
        <span class="tok-nx">httpBackend</span>
          <span class="tok-p">.</span><span class="tok-nx">expectGET</span><span class="tok-p">(</span><span class="tok-s1">&#39;/users&#39;</span><span class="tok-p">)</span>
          <span class="tok-p">.</span><span class="tok-nx">respond</span><span class="tok-p">(</span><span class="tok-mi">500</span><span class="tok-p">,</span> <span class="tok-kc">null</span><span class="tok-p">);</span>

        <span class="tok-c1">// Inicializar el controlador</span>
        <span class="tok-nx">controller</span><span class="tok-p">(</span><span class="tok-s1">&#39;usersCtrl&#39;</span><span class="tok-p">,</span> <span class="tok-p">{</span><span class="tok-s1">&#39;$scope&#39;</span><span class="tok-o">:</span> <span class="tok-nx">scope</span> <span class="tok-p">});</span>

        <span class="tok-c1">// Llamamos al método del controlador</span>
        <span class="tok-nx">scope</span><span class="tok-p">.</span><span class="tok-nx">getUsers</span><span class="tok-p">()</span>

        <span class="tok-c1">// Responder a todas las peticiones HTTP</span>
        <span class="tok-nx">httpBackend</span><span class="tok-p">.</span><span class="tok-nx">flush</span><span class="tok-p">();</span>

        <span class="tok-c1">// Lanzamos scope.$apply() para que se resuelvan todas las promesas</span>
        <span class="tok-nx">scope</span><span class="tok-p">.</span><span class="tok-nx">$apply</span><span class="tok-p">();</span>

        <span class="tok-c1">// Evaluar los valores esperados</span>
        <span class="tok-nx">expect</span><span class="tok-p">(</span><span class="tok-nx">scope</span><span class="tok-p">.</span><span class="tok-nx">hasError</span><span class="tok-p">).</span><span class="tok-nx">toBe</span><span class="tok-p">(</span><span class="tok-kc">true</span><span class="tok-p">);</span>
        <span class="tok-nx">expect</span><span class="tok-p">(</span><span class="tok-nx">scope</span><span class="tok-p">.</span><span class="tok-nx">users</span><span class="tok-p">).</span><span class="tok-nx">toBeNull</span><span class="tok-p">();</span>
    <span class="tok-p">});</span>
<span class="tok-p">});</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>A destacar que cada test se define con la función <code>iit</code> en lugar de <code>it</code>. Si en algún momento introducimos alguna función <code>iit</code> el resto de funciones definidas con <code>it</code> serán ignoradas. Esto es cómodo si nos queremos centrar en algún test en concreto.</p>
</div>
<div class="paragraph">
<p>Vemos cómo inicializamos el controlador con el servicio <code>$controller</code>, e inyectándole un <code>scope</code> que hemos creado en la función <code>beforeEach</code> (<code>scope = $rootScope.$new()</code>).</p>
</div>
<div class="paragraph">
<p>Lo más importante es el uso del servicio <a href="https://docs.angularjs.org/api/ngMock/service/$httpBackend">$httpBackend</a>. Éste nos permite implementar llamadas falsas a un servicio y simular los resultados que queramos obtener en cada test. Al inicio de nuestro test escribimos el resultado que queremos probar en cada caso, y una vez llamada a la función que hace uso del servicio, deberemos realizar una llamada al método <code>$httpBackend.flush()</code> para que todas las llamadas al servicio <code>$http</code> que se hayan hecho en el controlador reciban su respuesta.</p>
</div>
<div class="paragraph">
<p>Aunque en el código que implementaremos no es necesario, en algunas ocasiones, dado que las peticiones http trabajan con promesas de resultados, tendremos que llamar a <code>scope.$digest()</code> o <code>scope.$apply()</code> para que los resultados pasen al <code>scope</code>.</p>
</div>
<div class="paragraph">
<p>Un código de controlador que pasaría los dos tests escritos es (<code>src/controller/usersCtrl.js</code>):</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="javascript"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23</div></td><td class="code"><span class="tok-p">(</span><span class="tok-kd">function</span><span class="tok-p">(){</span>
  <span class="tok-s1">&#39;use strict&#39;</span><span class="tok-p">;</span>

  <span class="tok-nx">angular</span>
      <span class="tok-p">.</span><span class="tok-nx">module</span><span class="tok-p">(</span><span class="tok-s1">&#39;expertojee.controllers&#39;</span><span class="tok-p">,</span> <span class="tok-p">[])</span>
      <span class="tok-p">.</span><span class="tok-nx">controller</span><span class="tok-p">(</span><span class="tok-s1">&#39;usersCtrl&#39;</span><span class="tok-p">,</span> <span class="tok-kd">function</span><span class="tok-p">(</span><span class="tok-nx">$scope</span><span class="tok-p">,</span> <span class="tok-nx">$http</span><span class="tok-p">){</span>
        <span class="tok-nx">$scope</span><span class="tok-p">.</span><span class="tok-nx">hasError</span> <span class="tok-o">=</span> <span class="tok-kc">false</span><span class="tok-p">;</span>
        <span class="tok-nx">$scope</span><span class="tok-p">.</span><span class="tok-nx">users</span> <span class="tok-o">=</span> <span class="tok-kc">null</span>

        <span class="tok-nx">$scope</span><span class="tok-p">.</span><span class="tok-nx">getUsers</span> <span class="tok-o">=</span> <span class="tok-kd">function</span><span class="tok-p">(){</span>
          <span class="tok-nx">$http</span>
            <span class="tok-p">.</span><span class="tok-nx">get</span><span class="tok-p">(</span><span class="tok-s1">&#39;/users&#39;</span><span class="tok-p">)</span>
            <span class="tok-p">.</span><span class="tok-nx">success</span><span class="tok-p">(</span><span class="tok-kd">function</span><span class="tok-p">(</span><span class="tok-nx">users</span><span class="tok-p">){</span>
              <span class="tok-nx">$scope</span><span class="tok-p">.</span><span class="tok-nx">users</span> <span class="tok-o">=</span> <span class="tok-nx">users</span><span class="tok-p">;</span>
              <span class="tok-nx">$scope</span><span class="tok-p">.</span><span class="tok-nx">hasError</span> <span class="tok-o">=</span> <span class="tok-kc">false</span><span class="tok-p">;</span>
            <span class="tok-p">})</span>
            <span class="tok-p">.</span><span class="tok-k">catch</span><span class="tok-p">(</span><span class="tok-kd">function</span><span class="tok-p">(){</span>
              <span class="tok-nx">$scope</span><span class="tok-p">.</span><span class="tok-nx">users</span> <span class="tok-o">=</span> <span class="tok-kc">null</span>
              <span class="tok-nx">$scope</span><span class="tok-p">.</span><span class="tok-nx">hasError</span> <span class="tok-o">=</span> <span class="tok-kc">true</span><span class="tok-p">;</span>
            <span class="tok-p">});</span>
        <span class="tok-p">};</span>
      <span class="tok-p">});</span>
<span class="tok-p">})();</span>
</td></tr></table></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_testing_de_directivas">12.3.6. Testing de directivas</h4>
<div class="paragraph">
<p>Finalmente, veremos cómo podemos realizar tests unitarios de directivas. Aunque pueda parecer más difícil, veremos como el proceso es bastante similar a lo que hemos hecho hasta ahora.</p>
</div>
<div class="paragraph">
<p>El truco está en que necesitaremos <em>compilar</em> el código HTML. Para ello utilizaremos el servicio <a href="https://docs.angularjs.org/api/ng/service/$compile">$compile</a>. Compilar consiste en introducir una cadena HTML en el ciclo de AngularJS, asociándole un <em>scope</em>.</p>
</div>
<div class="paragraph">
<p>Para testear una directiva vamos a tener que compilarla, realizar la tarea que tenemos que realizar (si fuese necesario), y finalmente invocar al método <code>$apply()</code> o <code>$digest()</code> del <em>scope</em> para que procesar los cambios.</p>
</div>
<div class="paragraph">
<p>Supongamos la siguiente directiva (<code>src/directive/scheduleEvent.js</code>):</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="javascript"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31</div></td><td class="code"><span class="tok-p">(</span><span class="tok-kd">function</span> <span class="tok-p">()</span> <span class="tok-p">{</span>
  <span class="tok-s1">&#39;use strict&#39;</span><span class="tok-p">;</span>
  <span class="tok-nx">angular</span><span class="tok-p">.</span><span class="tok-nx">module</span><span class="tok-p">(</span><span class="tok-s1">&#39;directives.schedule&#39;</span><span class="tok-p">,</span> <span class="tok-p">[])</span>
  <span class="tok-p">.</span><span class="tok-nx">directive</span><span class="tok-p">(</span><span class="tok-s1">&#39;scheduleEvent&#39;</span><span class="tok-p">,</span> <span class="tok-kd">function</span> <span class="tok-p">()</span> <span class="tok-p">{</span>
    <span class="tok-k">return</span> <span class="tok-p">{</span>
      <span class="tok-nx">restrict</span><span class="tok-o">:</span> <span class="tok-s1">&#39;E&#39;</span><span class="tok-p">,</span>
      <span class="tok-nx">scope</span><span class="tok-o">:</span> <span class="tok-p">{</span>
        <span class="tok-nx">event</span><span class="tok-o">:</span> <span class="tok-s1">&#39;=&#39;</span><span class="tok-p">,</span>
        <span class="tok-nx">deleteAction</span><span class="tok-o">:</span> <span class="tok-s1">&#39;&amp;&#39;</span>
      <span class="tok-p">},</span>
      <span class="tok-nx">template</span><span class="tok-o">:</span> <span class="tok-s1">&#39;&lt;div=&quot;schedule-event&quot;&gt; &#39;</span> <span class="tok-o">+</span>
      <span class="tok-s1">&#39;&lt;h2&gt; &#39;</span> <span class="tok-o">+</span>
      <span class="tok-s1">&#39;&lt;span ng-if=&quot;isToday&quot;&gt;&lt;i class=&quot;icon ion-ios7-time-outline&quot;&gt;&lt;/i&gt;&lt;/span&gt; &#39;</span> <span class="tok-o">+</span>
      <span class="tok-s1">&#39;&lt;span ng-if=&quot;!isToday&quot;&gt;&lt;i class=&quot;icon ion-ios7-calendar-outline&quot;&gt;&lt;/i&gt; {{ event.date | date }} - &lt;/span&gt; &#39;</span> <span class="tok-o">+</span>
      <span class="tok-s1">&#39;&lt;span ng-bind=&quot;event.date | date:\&#39;HH:mm\&#39;&quot;&gt;&lt;/span&gt;. &lt;span ng-bind=&quot;event.title&quot;&gt;&lt;/span&gt; &#39;</span> <span class="tok-o">+</span>
      <span class="tok-s1">&#39;&lt;p ng-if=&quot;showHolder&quot; ng-bind=&quot;event.contact.name + \&#39; \&#39; + event.contact.middleName + \&#39; \&#39; + event.contact.lastName&quot;&gt;&lt;/p&gt; &#39;</span> <span class="tok-o">+</span>
      <span class="tok-s1">&#39;&lt;/h2&gt; &#39;</span> <span class="tok-o">+</span>
      <span class="tok-s1">&#39;&lt;a class=&quot;button&quot; ng-click=&quot;deleteAction()&quot;&gt;Eliminar&lt;/a&gt; &#39;</span> <span class="tok-o">+</span>
      <span class="tok-s1">&#39;&lt;/div&gt;&#39;</span><span class="tok-p">,</span>

      <span class="tok-nx">link</span><span class="tok-o">:</span> <span class="tok-kd">function</span> <span class="tok-p">(</span><span class="tok-nx">scope</span><span class="tok-p">,</span> <span class="tok-nx">element</span><span class="tok-p">,</span> <span class="tok-nx">attrs</span><span class="tok-p">)</span> <span class="tok-p">{</span>
        <span class="tok-nx">scope</span><span class="tok-p">.</span><span class="tok-nx">isToday</span> <span class="tok-o">=</span> <span class="tok-nx">scope</span><span class="tok-p">.</span><span class="tok-nx">$eval</span><span class="tok-p">(</span><span class="tok-nx">attrs</span><span class="tok-p">.</span><span class="tok-nx">isToday</span><span class="tok-p">);</span>
        <span class="tok-nx">scope</span><span class="tok-p">.</span><span class="tok-nx">showHolder</span> <span class="tok-o">=</span> <span class="tok-o">!!</span><span class="tok-nx">scope</span><span class="tok-p">.</span><span class="tok-nx">event</span><span class="tok-p">.</span><span class="tok-nx">contact</span> <span class="tok-o">&amp;&amp;</span> <span class="tok-o">!</span><span class="tok-nx">scope</span><span class="tok-p">.</span><span class="tok-nx">$eval</span><span class="tok-p">(</span><span class="tok-nx">attrs</span><span class="tok-p">.</span><span class="tok-nx">hideContact</span><span class="tok-p">);</span>

        <span class="tok-nx">scope</span><span class="tok-p">.</span><span class="tok-nx">$on</span><span class="tok-p">(</span><span class="tok-s1">&#39;$destroy&#39;</span><span class="tok-p">,</span> <span class="tok-kd">function</span><span class="tok-p">(){</span>
          <span class="tok-nx">angular</span><span class="tok-p">.</span><span class="tok-nx">element</span><span class="tok-p">(</span><span class="tok-nx">element</span><span class="tok-p">).</span><span class="tok-nx">remove</span><span class="tok-p">();</span>
        <span class="tok-p">});</span>
      <span class="tok-p">}</span>
    <span class="tok-p">};</span>
  <span class="tok-p">});</span>
<span class="tok-p">})();</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>Ésta consiste en una entrada de agenda, que puede estar o no asociada a un contacto. Mostrará un botón "Eliminar" Acepta los siguientes atributos:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><em>event</em>: Entrada de agenda. Objeto con los atributos <em>title</em> y <em>contact</em>. <em>contact</em> tiene, a su vez, los atributos <em>firstName</em>, <em>middleName</em> y <em>lastName</em>.</p>
</li>
<li>
<p><em>hideContact</em>: Ocultar el nombre del contacto.</p>
</li>
<li>
<p><em>isToday</em>: el evento es del día de hoy. Acepta los valores "true" o "false".
_ <em>deleteAction</em>: acción a realizar cuando se hace click en el botón de eliminar</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Como hemos comentado, en el test habrá que compilar primero un bloque HTML. Para ello, necesitaremos inyectar el servicio <code>$compile</code> antes de cada test. Como hemos dicho que este servicio asocia una cadena HTML a un <em>scope</em>, también haremos uso del <code>$rootScope</code>, donde definiremos la acción a realizar cuando hagamos click en el botón <em>delete</em>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="javascript"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3
4
5
6
7
8</div></td><td class="code"><span class="tok-nx">beforeEach</span><span class="tok-p">(</span><span class="tok-nx">inject</span><span class="tok-p">(</span><span class="tok-kd">function</span> <span class="tok-p">(</span><span class="tok-nx">$compile</span><span class="tok-p">,</span> <span class="tok-nx">$rootScope</span><span class="tok-p">)</span> <span class="tok-p">{</span>
  <span class="tok-nx">scope</span> <span class="tok-o">=</span> <span class="tok-nx">$rootScope</span><span class="tok-p">;</span>
  <span class="tok-nx">compile</span> <span class="tok-o">=</span> <span class="tok-nx">$compile</span><span class="tok-p">;</span>

  <span class="tok-nx">scope</span><span class="tok-p">.</span><span class="tok-nx">deleteEvent</span> <span class="tok-o">=</span> <span class="tok-kd">function</span> <span class="tok-p">()</span> <span class="tok-p">{</span>
    <span class="tok-nx">console</span><span class="tok-p">.</span><span class="tok-nx">log</span><span class="tok-p">(</span><span class="tok-s1">&#39;deleting event&#39;</span><span class="tok-p">);</span>
  <span class="tok-p">};</span>
<span class="tok-p">}));</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>En cada uno de nuestros tests, compilaremos el código HTML que deseemos probar:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="javascript"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17</div></td><td class="code"><span class="tok-c1">//Añadir un evento al scope</span>
<span class="tok-nx">scope</span><span class="tok-p">.</span><span class="tok-nx">event</span> <span class="tok-o">=</span> <span class="tok-p">{</span>
  <span class="tok-nx">date</span><span class="tok-o">:</span> <span class="tok-p">(</span><span class="tok-k">new</span> <span class="tok-nb">Date</span><span class="tok-p">()).</span><span class="tok-nx">getTime</span><span class="tok-p">(),</span>
  <span class="tok-nx">title</span><span class="tok-o">:</span> <span class="tok-s1">&#39;Entrega ejercicios sesión 1&#39;</span><span class="tok-p">,</span>
  <span class="tok-nx">contact</span><span class="tok-o">:</span> <span class="tok-p">{</span>
    <span class="tok-nx">name</span><span class="tok-o">:</span> <span class="tok-s1">&#39;Juan&#39;</span><span class="tok-p">,</span>
    <span class="tok-nx">middleName</span><span class="tok-o">:</span> <span class="tok-s1">&#39;Perez&#39;</span><span class="tok-p">,</span>
    <span class="tok-nx">lastName</span><span class="tok-o">:</span> <span class="tok-s1">&#39;Perez&#39;</span>
  <span class="tok-p">}</span>
<span class="tok-p">};</span>

<span class="tok-c1">//Crear nuestra plantilla</span>
<span class="tok-nx">element</span> <span class="tok-o">=</span> <span class="tok-nx">angular</span><span class="tok-p">.</span><span class="tok-nx">element</span><span class="tok-p">(</span><span class="tok-s1">&#39;&lt;schedule-event event=&quot;event&quot; is-today=&quot;true&quot; delete-action=&quot;deleteEvent(event)&quot; edit-action=&quot;editEvent(event)&quot;&gt;&lt;/schedule-event&gt;&#39;</span><span class="tok-p">);</span>

<span class="tok-c1">//Compilar la plantilla</span>
<span class="tok-nx">element</span> <span class="tok-o">=</span> <span class="tok-nx">compile</span><span class="tok-p">(</span><span class="tok-nx">element</span><span class="tok-p">)(</span><span class="tok-nx">scope</span><span class="tok-p">);</span>
<span class="tok-nx">scope</span><span class="tok-p">.</span><span class="tok-nx">$apply</span><span class="tok-p">();</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>Una batería de tests para esta directiva podría ser la siguiente, donde iremos probando distintas combinaciones de atributos para ver si hace lo que queremos (<code>test/directive/scheduleEventSpec.js</code>):</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="javascript"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">  1
  2
  3
  4
  5
  6
  7
  8
  9
 10
 11
 12
 13
 14
 15
 16
 17
 18
 19
 20
 21
 22
 23
 24
 25
 26
 27
 28
 29
 30
 31
 32
 33
 34
 35
 36
 37
 38
 39
 40
 41
 42
 43
 44
 45
 46
 47
 48
 49
 50
 51
 52
 53
 54
 55
 56
 57
 58
 59
 60
 61
 62
 63
 64
 65
 66
 67
 68
 69
 70
 71
 72
 73
 74
 75
 76
 77
 78
 79
 80
 81
 82
 83
 84
 85
 86
 87
 88
 89
 90
 91
 92
 93
 94
 95
 96
 97
 98
 99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133</div></td><td class="code"><span class="tok-s1">&#39;use strict&#39;</span><span class="tok-p">;</span>

<span class="tok-nx">describe</span><span class="tok-p">(</span><span class="tok-s1">&#39;directive: scheduleEvent&#39;</span><span class="tok-p">,</span> <span class="tok-kd">function</span> <span class="tok-p">()</span> <span class="tok-p">{</span>
  <span class="tok-kd">var</span> <span class="tok-nx">element</span><span class="tok-p">;</span>
  <span class="tok-kd">var</span> <span class="tok-nx">scope</span><span class="tok-p">;</span>
  <span class="tok-kd">var</span> <span class="tok-nx">compile</span><span class="tok-p">;</span>

  <span class="tok-nx">beforeEach</span><span class="tok-p">(</span><span class="tok-kd">function</span><span class="tok-p">(){</span>
    <span class="tok-nx">module</span><span class="tok-p">(</span><span class="tok-s1">&#39;directives.schedule&#39;</span><span class="tok-p">)</span>
  <span class="tok-p">});</span>

  <span class="tok-nx">beforeEach</span><span class="tok-p">(</span><span class="tok-nx">inject</span><span class="tok-p">(</span><span class="tok-kd">function</span> <span class="tok-p">(</span><span class="tok-nx">$compile</span><span class="tok-p">,</span> <span class="tok-nx">$rootScope</span><span class="tok-p">)</span> <span class="tok-p">{</span>
    <span class="tok-nx">scope</span> <span class="tok-o">=</span> <span class="tok-nx">$rootScope</span><span class="tok-p">;</span>
    <span class="tok-nx">compile</span> <span class="tok-o">=</span> <span class="tok-nx">$compile</span><span class="tok-p">;</span>

    <span class="tok-nx">scope</span><span class="tok-p">.</span><span class="tok-nx">deleteEvent</span> <span class="tok-o">=</span> <span class="tok-kd">function</span> <span class="tok-p">()</span> <span class="tok-p">{</span>
      <span class="tok-nx">console</span><span class="tok-p">.</span><span class="tok-nx">log</span><span class="tok-p">(</span><span class="tok-s1">&#39;deleting event&#39;</span><span class="tok-p">);</span>
    <span class="tok-p">};</span>
  <span class="tok-p">}));</span>

  <span class="tok-nx">it</span><span class="tok-p">(</span><span class="tok-s1">&#39;should show a today event&#39;</span><span class="tok-p">,</span> <span class="tok-kd">function</span> <span class="tok-p">()</span> <span class="tok-p">{</span>
    <span class="tok-nx">scope</span><span class="tok-p">.</span><span class="tok-nx">event</span> <span class="tok-o">=</span> <span class="tok-p">{</span>
      <span class="tok-nx">date</span><span class="tok-o">:</span> <span class="tok-p">(</span><span class="tok-k">new</span> <span class="tok-nb">Date</span><span class="tok-p">()).</span><span class="tok-nx">getTime</span><span class="tok-p">(),</span>
      <span class="tok-nx">title</span><span class="tok-o">:</span> <span class="tok-s1">&#39;Entregar los ejercicios de la sesión 1&#39;</span><span class="tok-p">,</span>
      <span class="tok-nx">contact</span><span class="tok-o">:</span> <span class="tok-p">{</span>
        <span class="tok-nx">name</span><span class="tok-o">:</span> <span class="tok-s1">&#39;Juan&#39;</span><span class="tok-p">,</span>
        <span class="tok-nx">middleName</span><span class="tok-o">:</span> <span class="tok-s1">&#39;Perez&#39;</span><span class="tok-p">,</span>
        <span class="tok-nx">lastName</span><span class="tok-o">:</span> <span class="tok-s1">&#39;Perez&#39;</span>
      <span class="tok-p">}</span>
    <span class="tok-p">};</span>

    <span class="tok-nx">element</span> <span class="tok-o">=</span> <span class="tok-nx">angular</span><span class="tok-p">.</span><span class="tok-nx">element</span><span class="tok-p">(</span><span class="tok-s1">&#39;&lt;schedule-event event=&quot;event&quot; is-today=&quot;true&quot;&gt;&lt;/schedule-event&gt;&#39;</span><span class="tok-p">);</span>
    <span class="tok-nx">element</span> <span class="tok-o">=</span> <span class="tok-nx">compile</span><span class="tok-p">(</span><span class="tok-nx">element</span><span class="tok-p">)(</span><span class="tok-nx">scope</span><span class="tok-p">);</span>
    <span class="tok-nx">scope</span><span class="tok-p">.</span><span class="tok-nx">$apply</span><span class="tok-p">();</span>
    <span class="tok-kd">var</span> <span class="tok-nx">i</span> <span class="tok-o">=</span> <span class="tok-nx">element</span><span class="tok-p">.</span><span class="tok-nx">find</span><span class="tok-p">(</span><span class="tok-s1">&#39;i&#39;</span><span class="tok-p">);</span>
    <span class="tok-nx">expect</span><span class="tok-p">(</span><span class="tok-nx">i</span><span class="tok-p">.</span><span class="tok-nx">hasClass</span><span class="tok-p">(</span><span class="tok-s1">&#39;ion-ios7-time-outline&#39;</span><span class="tok-p">)).</span><span class="tok-nx">toBe</span><span class="tok-p">(</span><span class="tok-kc">true</span><span class="tok-p">);</span>
  <span class="tok-p">});</span>

  <span class="tok-nx">it</span><span class="tok-p">(</span><span class="tok-s1">&#39;should show a future event&#39;</span><span class="tok-p">,</span> <span class="tok-kd">function</span> <span class="tok-p">()</span> <span class="tok-p">{</span>
    <span class="tok-nx">scope</span><span class="tok-p">.</span><span class="tok-nx">event</span> <span class="tok-o">=</span> <span class="tok-p">{</span>
      <span class="tok-nx">date</span><span class="tok-o">:</span> <span class="tok-p">(</span><span class="tok-k">new</span> <span class="tok-nb">Date</span><span class="tok-p">()).</span><span class="tok-nx">getTime</span><span class="tok-p">()</span> <span class="tok-o">+</span> <span class="tok-mi">86400000</span><span class="tok-p">,</span> <span class="tok-c1">//+2 days</span>
      <span class="tok-nx">title</span><span class="tok-o">:</span> <span class="tok-s1">&#39;JPA 3,4&#39;</span><span class="tok-p">,</span>
      <span class="tok-nx">contact</span><span class="tok-o">:</span> <span class="tok-p">{</span>
        <span class="tok-nx">name</span><span class="tok-o">:</span> <span class="tok-s1">&#39;Juan&#39;</span><span class="tok-p">,</span>
        <span class="tok-nx">middleName</span><span class="tok-o">:</span> <span class="tok-s1">&#39;Perez&#39;</span><span class="tok-p">,</span>
        <span class="tok-nx">lastName</span><span class="tok-o">:</span> <span class="tok-s1">&#39;Perez&#39;</span>
      <span class="tok-p">}</span>
    <span class="tok-p">};</span>

    <span class="tok-nx">element</span> <span class="tok-o">=</span> <span class="tok-nx">angular</span><span class="tok-p">.</span><span class="tok-nx">element</span><span class="tok-p">(</span><span class="tok-s1">&#39;&lt;schedule-event event=&quot;event&quot; is-today=&quot;false&quot;&gt;&lt;/schedule-event&gt;&#39;</span><span class="tok-p">);</span>
    <span class="tok-nx">element</span> <span class="tok-o">=</span> <span class="tok-nx">compile</span><span class="tok-p">(</span><span class="tok-nx">element</span><span class="tok-p">)(</span><span class="tok-nx">scope</span><span class="tok-p">);</span>
    <span class="tok-nx">scope</span><span class="tok-p">.</span><span class="tok-nx">$apply</span><span class="tok-p">();</span>
    <span class="tok-kd">var</span> <span class="tok-nx">i</span> <span class="tok-o">=</span> <span class="tok-nx">element</span><span class="tok-p">.</span><span class="tok-nx">find</span><span class="tok-p">(</span><span class="tok-s1">&#39;i&#39;</span><span class="tok-p">);</span>
    <span class="tok-nx">expect</span><span class="tok-p">(</span><span class="tok-nx">i</span><span class="tok-p">.</span><span class="tok-nx">hasClass</span><span class="tok-p">(</span><span class="tok-s1">&#39;ion-ios7-calendar-outline&#39;</span><span class="tok-p">)).</span><span class="tok-nx">toBe</span><span class="tok-p">(</span><span class="tok-kc">true</span><span class="tok-p">);</span>
  <span class="tok-p">});</span>

  <span class="tok-nx">it</span><span class="tok-p">(</span><span class="tok-s1">&#39;should show the contact block&#39;</span><span class="tok-p">,</span> <span class="tok-kd">function</span> <span class="tok-p">()</span> <span class="tok-p">{</span>
    <span class="tok-nx">scope</span><span class="tok-p">.</span><span class="tok-nx">event</span> <span class="tok-o">=</span> <span class="tok-p">{</span>
      <span class="tok-nx">date</span><span class="tok-o">:</span> <span class="tok-p">(</span><span class="tok-k">new</span> <span class="tok-nb">Date</span><span class="tok-p">()).</span><span class="tok-nx">getTime</span><span class="tok-p">(),</span>
      <span class="tok-nx">title</span><span class="tok-o">:</span> <span class="tok-s1">&#39;Entrega ejercicios sesión 1&#39;</span><span class="tok-p">,</span>
      <span class="tok-nx">contact</span><span class="tok-o">:</span> <span class="tok-p">{</span>
        <span class="tok-nx">name</span><span class="tok-o">:</span> <span class="tok-s1">&#39;Juan&#39;</span><span class="tok-p">,</span>
        <span class="tok-nx">middleName</span><span class="tok-o">:</span> <span class="tok-s1">&#39;Perez&#39;</span><span class="tok-p">,</span>
        <span class="tok-nx">lastName</span><span class="tok-o">:</span> <span class="tok-s1">&#39;Perez&#39;</span>
      <span class="tok-p">}</span>
    <span class="tok-p">};</span>

    <span class="tok-nx">element</span> <span class="tok-o">=</span> <span class="tok-nx">angular</span><span class="tok-p">.</span><span class="tok-nx">element</span><span class="tok-p">(</span><span class="tok-s1">&#39;&lt;schedule-event event=&quot;event&quot; hide-contact=&quot;false&quot; is-today=&quot;true&quot; delete-action=&quot;deleteEvent(event)&quot; edit-action=&quot;editEvent(event)&quot;&gt;&lt;/schedule-event&gt;&#39;</span><span class="tok-p">);</span>
    <span class="tok-nx">element</span> <span class="tok-o">=</span> <span class="tok-nx">compile</span><span class="tok-p">(</span><span class="tok-nx">element</span><span class="tok-p">)(</span><span class="tok-nx">scope</span><span class="tok-p">);</span>
    <span class="tok-nx">scope</span><span class="tok-p">.</span><span class="tok-nx">$apply</span><span class="tok-p">();</span>

    <span class="tok-nx">expect</span><span class="tok-p">(</span><span class="tok-nx">element</span><span class="tok-p">.</span><span class="tok-nx">find</span><span class="tok-p">(</span><span class="tok-s1">&#39;p&#39;</span><span class="tok-p">)[</span><span class="tok-mi">0</span><span class="tok-p">]).</span><span class="tok-nx">not</span><span class="tok-p">.</span><span class="tok-nx">toBeUndefined</span><span class="tok-p">();</span>
    <span class="tok-nx">expect</span><span class="tok-p">(</span><span class="tok-nx">element</span><span class="tok-p">.</span><span class="tok-nx">text</span><span class="tok-p">()).</span><span class="tok-nx">toContain</span><span class="tok-p">(</span><span class="tok-s1">&#39;Juan Perez Perez&#39;</span><span class="tok-p">);</span>
    <span class="tok-nx">expect</span><span class="tok-p">(</span><span class="tok-nx">element</span><span class="tok-p">.</span><span class="tok-nx">text</span><span class="tok-p">()).</span><span class="tok-nx">toContain</span><span class="tok-p">(</span><span class="tok-s1">&#39;Entrega ejercicios sesión 1&#39;</span><span class="tok-p">);</span>
  <span class="tok-p">});</span>

  <span class="tok-nx">it</span><span class="tok-p">(</span><span class="tok-s1">&#39;should\&#39;t show the contact block&#39;</span><span class="tok-p">,</span> <span class="tok-kd">function</span> <span class="tok-p">()</span> <span class="tok-p">{</span>
    <span class="tok-nx">scope</span><span class="tok-p">.</span><span class="tok-nx">event</span> <span class="tok-o">=</span> <span class="tok-p">{</span>
      <span class="tok-nx">date</span><span class="tok-o">:</span> <span class="tok-p">(</span><span class="tok-k">new</span> <span class="tok-nb">Date</span><span class="tok-p">()).</span><span class="tok-nx">getTime</span><span class="tok-p">(),</span>
      <span class="tok-nx">title</span><span class="tok-o">:</span> <span class="tok-s1">&#39;Entrega ejercicios sesión 1&#39;</span><span class="tok-p">,</span>
      <span class="tok-nx">contact</span><span class="tok-o">:</span> <span class="tok-kc">null</span>
    <span class="tok-p">};</span>

    <span class="tok-nx">element</span> <span class="tok-o">=</span> <span class="tok-nx">angular</span><span class="tok-p">.</span><span class="tok-nx">element</span><span class="tok-p">(</span><span class="tok-s1">&#39;&lt;schedule-event event=&quot;event&quot; is-today=&quot;true&quot; delete-action=&quot;deleteEvent(event)&quot; edit-action=&quot;editEvent(event)&quot;&gt;&lt;/schedule-event&gt;&#39;</span><span class="tok-p">);</span>
    <span class="tok-nx">element</span> <span class="tok-o">=</span> <span class="tok-nx">compile</span><span class="tok-p">(</span><span class="tok-nx">element</span><span class="tok-p">)(</span><span class="tok-nx">scope</span><span class="tok-p">);</span>
    <span class="tok-nx">scope</span><span class="tok-p">.</span><span class="tok-nx">$apply</span><span class="tok-p">();</span>

    <span class="tok-nx">expect</span><span class="tok-p">(</span><span class="tok-nx">element</span><span class="tok-p">.</span><span class="tok-nx">find</span><span class="tok-p">(</span><span class="tok-s1">&#39;p&#39;</span><span class="tok-p">)[</span><span class="tok-mi">0</span><span class="tok-p">]).</span><span class="tok-nx">toBeUndefined</span><span class="tok-p">();</span>
    <span class="tok-nx">expect</span><span class="tok-p">(</span><span class="tok-nx">element</span><span class="tok-p">.</span><span class="tok-nx">text</span><span class="tok-p">()).</span><span class="tok-nx">toContain</span><span class="tok-p">(</span><span class="tok-s1">&#39;Entrega ejercicios sesión 1&#39;</span><span class="tok-p">);</span>
  <span class="tok-p">});</span>

  <span class="tok-nx">it</span><span class="tok-p">(</span><span class="tok-s1">&#39;should\&#39;t show the contact block despite it has a contact&#39;</span><span class="tok-p">,</span> <span class="tok-kd">function</span> <span class="tok-p">()</span> <span class="tok-p">{</span>
    <span class="tok-nx">scope</span><span class="tok-p">.</span><span class="tok-nx">event</span> <span class="tok-o">=</span> <span class="tok-p">{</span>
      <span class="tok-nx">date</span><span class="tok-o">:</span> <span class="tok-p">(</span><span class="tok-k">new</span> <span class="tok-nb">Date</span><span class="tok-p">()).</span><span class="tok-nx">getTime</span><span class="tok-p">(),</span>
      <span class="tok-nx">title</span><span class="tok-o">:</span> <span class="tok-s1">&#39;Entrega ejercicios sesión 1&#39;</span><span class="tok-p">,</span>
      <span class="tok-nx">contact</span><span class="tok-o">:</span> <span class="tok-p">{</span>
        <span class="tok-nx">name</span><span class="tok-o">:</span> <span class="tok-s1">&#39;Juan&#39;</span><span class="tok-p">,</span>
        <span class="tok-nx">middleName</span><span class="tok-o">:</span> <span class="tok-s1">&#39;Perez&#39;</span><span class="tok-p">,</span>
        <span class="tok-nx">lastName</span><span class="tok-o">:</span> <span class="tok-s1">&#39;Perez&#39;</span>
      <span class="tok-p">}</span>
    <span class="tok-p">};</span>

    <span class="tok-nx">element</span> <span class="tok-o">=</span> <span class="tok-nx">angular</span><span class="tok-p">.</span><span class="tok-nx">element</span><span class="tok-p">(</span><span class="tok-s1">&#39;&lt;schedule-event event=&quot;event&quot; is-today=&quot;true&quot; delete-action=&quot;deleteEvent(event)&quot; edit-action=&quot;editEvent(event)&quot; hide-contact=&quot;true&quot;&gt;&lt;/schedule-event&gt;&#39;</span><span class="tok-p">);</span>
    <span class="tok-nx">element</span> <span class="tok-o">=</span> <span class="tok-nx">compile</span><span class="tok-p">(</span><span class="tok-nx">element</span><span class="tok-p">)(</span><span class="tok-nx">scope</span><span class="tok-p">);</span>
    <span class="tok-nx">scope</span><span class="tok-p">.</span><span class="tok-nx">$apply</span><span class="tok-p">();</span>

    <span class="tok-nx">expect</span><span class="tok-p">(</span><span class="tok-nx">element</span><span class="tok-p">.</span><span class="tok-nx">find</span><span class="tok-p">(</span><span class="tok-s1">&#39;p&#39;</span><span class="tok-p">)[</span><span class="tok-mi">0</span><span class="tok-p">]).</span><span class="tok-nx">toBeUndefined</span><span class="tok-p">();</span>
    <span class="tok-nx">expect</span><span class="tok-p">(</span><span class="tok-nx">element</span><span class="tok-p">.</span><span class="tok-nx">text</span><span class="tok-p">()).</span><span class="tok-nx">toContain</span><span class="tok-p">(</span><span class="tok-s1">&#39;Entrega ejercicios sesión 1&#39;</span><span class="tok-p">);</span>
  <span class="tok-p">});</span>

  <span class="tok-nx">it</span><span class="tok-p">(</span><span class="tok-s1">&#39;should trigger a delete event&#39;</span><span class="tok-p">,</span> <span class="tok-kd">function</span> <span class="tok-p">()</span> <span class="tok-p">{</span>
    <span class="tok-nx">spyOn</span><span class="tok-p">(</span><span class="tok-nx">scope</span><span class="tok-p">,</span> <span class="tok-s1">&#39;deleteEvent&#39;</span><span class="tok-p">);</span>

    <span class="tok-nx">scope</span><span class="tok-p">.</span><span class="tok-nx">event</span> <span class="tok-o">=</span> <span class="tok-p">{</span>
      <span class="tok-nx">date</span><span class="tok-o">:</span> <span class="tok-p">(</span><span class="tok-k">new</span> <span class="tok-nb">Date</span><span class="tok-p">()).</span><span class="tok-nx">getTime</span><span class="tok-p">(),</span>
      <span class="tok-nx">title</span><span class="tok-o">:</span> <span class="tok-s1">&#39;Entrega ejercicios sesión 1&#39;</span><span class="tok-p">,</span>
      <span class="tok-nx">contact</span><span class="tok-o">:</span> <span class="tok-p">{</span>
        <span class="tok-nx">name</span><span class="tok-o">:</span> <span class="tok-s1">&#39;Juan&#39;</span><span class="tok-p">,</span>
        <span class="tok-nx">middleName</span><span class="tok-o">:</span> <span class="tok-s1">&#39;Perez&#39;</span><span class="tok-p">,</span>
        <span class="tok-nx">lastName</span><span class="tok-o">:</span> <span class="tok-s1">&#39;Perez&#39;</span>
      <span class="tok-p">}</span>
    <span class="tok-p">};</span>

    <span class="tok-nx">element</span> <span class="tok-o">=</span> <span class="tok-nx">angular</span><span class="tok-p">.</span><span class="tok-nx">element</span><span class="tok-p">(</span><span class="tok-s1">&#39;&lt;schedule-event event=&quot;event&quot; is-today=&quot;true&quot; delete-action=&quot;deleteEvent(event)&quot; edit-action=&quot;editEvent(event)&quot;&gt;&lt;/schedule-event&gt;&#39;</span><span class="tok-p">);</span>
    <span class="tok-nx">element</span> <span class="tok-o">=</span> <span class="tok-nx">compile</span><span class="tok-p">(</span><span class="tok-nx">element</span><span class="tok-p">)(</span><span class="tok-nx">scope</span><span class="tok-p">);</span>
    <span class="tok-nx">scope</span><span class="tok-p">.</span><span class="tok-nx">$apply</span><span class="tok-p">();</span>

    <span class="tok-kd">var</span> <span class="tok-nx">editBtn</span> <span class="tok-o">=</span> <span class="tok-nx">angular</span><span class="tok-p">.</span><span class="tok-nx">element</span><span class="tok-p">(</span><span class="tok-nx">element</span><span class="tok-p">.</span><span class="tok-nx">find</span><span class="tok-p">(</span><span class="tok-s1">&#39;a&#39;</span><span class="tok-p">)[</span><span class="tok-mi">0</span><span class="tok-p">]);</span>
    <span class="tok-nx">editBtn</span><span class="tok-p">.</span><span class="tok-nx">triggerHandler</span><span class="tok-p">(</span><span class="tok-s1">&#39;click&#39;</span><span class="tok-p">);</span>
    <span class="tok-nx">scope</span><span class="tok-p">.</span><span class="tok-nx">$apply</span><span class="tok-p">();</span>
    <span class="tok-nx">expect</span><span class="tok-p">(</span><span class="tok-nx">scope</span><span class="tok-p">.</span><span class="tok-nx">deleteEvent</span><span class="tok-p">).</span><span class="tok-nx">toHaveBeenCalled</span><span class="tok-p">();</span>
  <span class="tok-p">});</span>
<span class="tok-p">});</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>Cabe destacar el último test, donde utilizamos un <em>spy</em>, una funcionalidad de Jasmine que nos permite determinar si una función en concreto ha sido llamada.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_automatizando_tareas_con_grunt_diseñando_nuestro_em_workflow_em">12.4. Automatizando tareas con Grunt. Diseñando nuestro <em>workflow</em></h3>
<div class="paragraph">
<p>Ahora vamos a ver lo útil que puede resultarnos grunt para automatizar una serie de tareas. Para ello, crearemos un fichero llamado <code>Gruntfile.js</code> en la raíz de nuestro proyecto, que inicialmente será el siguiente:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="javascript"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3
4
5
6
7</div></td><td class="code"><span class="tok-nx">module</span><span class="tok-p">.</span><span class="tok-nx">exports</span> <span class="tok-o">=</span> <span class="tok-kd">function</span> <span class="tok-p">(</span><span class="tok-nx">grunt</span><span class="tok-p">)</span> <span class="tok-p">{</span>
  <span class="tok-c1">// load all grunt tasks matching the `grunt-*` pattern</span>
  <span class="tok-nx">require</span><span class="tok-p">(</span><span class="tok-s1">&#39;load-grunt-tasks&#39;</span><span class="tok-p">)(</span><span class="tok-nx">grunt</span><span class="tok-p">);</span>

  <span class="tok-nx">grunt</span><span class="tok-p">.</span><span class="tok-nx">initConfig</span><span class="tok-p">({});</span>
  <span class="tok-nx">grunt</span><span class="tok-p">.</span><span class="tok-nx">registerTask</span><span class="tok-p">(</span><span class="tok-s1">&#39;default&#39;</span><span class="tok-p">,</span> <span class="tok-p">[]);</span>
<span class="tok-p">}</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>En él, ya hemos introducido un módulo, llamado <code>load-grunt-tasks</code>, que nos permite cargar de manera más cómoda el resto de módulos que incluyamos en nuestro fichero.</p>
</div>
<div class="sect3">
<h4 id="_verificación_de_código">12.4.1. Verificación de código</h4>
<div class="paragraph">
<p>Dado que JavaScript es un lenguaje tan permisivo, siempre es importante establecer unas convenciones de código. Es ahí donde entra <a href="http://jshint.com/">JSHint</a>, una herramienta <em>open source</em> que detecta errores y problemas potenciales en nuestro código JavaScript, y establece una serie de convenciones. Es muy restrictivo, y podemos relajarlo en base a nuestras necesidades y las de nuestro proyecto.</p>
</div>
<div class="paragraph">
<p>Para configurar JSHint en nuestro proyecto, modificaremos el fichero <code>Gruntfile.js</code> de la siguiente manera:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="javascript"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21</div></td><td class="code"><span class="tok-nx">module</span><span class="tok-p">.</span><span class="tok-nx">exports</span> <span class="tok-o">=</span> <span class="tok-kd">function</span> <span class="tok-p">(</span><span class="tok-nx">grunt</span><span class="tok-p">)</span> <span class="tok-p">{</span>
  <span class="tok-c1">// load all grunt tasks matching the `grunt-*` pattern</span>
  <span class="tok-nx">require</span><span class="tok-p">(</span><span class="tok-s1">&#39;load-grunt-tasks&#39;</span><span class="tok-p">)(</span><span class="tok-nx">grunt</span><span class="tok-p">);</span>

  <span class="tok-nx">grunt</span><span class="tok-p">.</span><span class="tok-nx">initConfig</span><span class="tok-p">({</span>
    <span class="tok-s1">&#39;jshint&#39;</span> <span class="tok-o">:</span> <span class="tok-p">{</span>
      <span class="tok-nx">options</span><span class="tok-o">:</span> <span class="tok-p">{</span>
        <span class="tok-nx">curly</span><span class="tok-o">:</span> <span class="tok-kc">true</span><span class="tok-p">,</span>
        <span class="tok-nx">eqeqeq</span><span class="tok-o">:</span> <span class="tok-kc">true</span><span class="tok-p">,</span>
        <span class="tok-nx">eqnull</span><span class="tok-o">:</span> <span class="tok-kc">true</span><span class="tok-p">,</span>
        <span class="tok-nx">browser</span><span class="tok-o">:</span> <span class="tok-kc">true</span><span class="tok-p">,</span>
        <span class="tok-nx">globals</span><span class="tok-o">:</span> <span class="tok-p">{</span>
          <span class="tok-nx">jQuery</span><span class="tok-o">:</span> <span class="tok-kc">true</span>
        <span class="tok-p">},</span>
      <span class="tok-p">},</span>
      <span class="tok-k">default</span> <span class="tok-o">:</span> <span class="tok-p">[</span><span class="tok-s1">&#39;src/**/*.js&#39;</span><span class="tok-p">]</span>
    <span class="tok-p">}</span>
  <span class="tok-p">});</span>

  <span class="tok-nx">grunt</span><span class="tok-p">.</span><span class="tok-nx">registerTask</span><span class="tok-p">(</span><span class="tok-s1">&#39;default&#39;</span><span class="tok-p">,</span> <span class="tok-p">[</span><span class="tok-s1">&#39;jshint&#39;</span><span class="tok-p">]);</span>
<span class="tok-p">}</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>Si ahora lanzamos el comando <code>grunt</code> en nuestra terminal, se ejecutará la tarea <em>default</em>, que realiza la validación de todos los ficheros con extensión <code>.js</code> en alguna de las subcarpetas de <code>src</code>.</p>
</div>
<div class="paragraph">
<p>Veremos que nos da error en el fichero <code>src/controller/AccessController.js</code> porque hay un par de líneas que no hemos finalizado con punto y coma. También, nos dirá que hay una sentencia <code>if</code> en el fichero <code>src/filters/textOrDefault.js</code> que no tiene llaves</p>
</div>
<div class="paragraph">
<p>Una vez corregidos estos dos errores, la tarea se ejecutará correctamente.</p>
</div>
</div>
<div class="sect3">
<h4 id="_testing">12.4.2. Testing</h4>
<div class="paragraph">
<p>Una vez verificado el código, haremos que los tests se lancen automáticamente con karma. Para ello, añadiremos karma a nuestro <em>workflow</em>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="javascript"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20</div></td><td class="code"><span class="tok-nx">module</span><span class="tok-p">.</span><span class="tok-nx">exports</span> <span class="tok-o">=</span> <span class="tok-kd">function</span> <span class="tok-p">(</span><span class="tok-nx">grunt</span><span class="tok-p">)</span> <span class="tok-p">{</span>
  <span class="tok-c1">//...</span>

  <span class="tok-nx">grunt</span><span class="tok-p">.</span><span class="tok-nx">initConfig</span><span class="tok-p">({</span>
    <span class="tok-s1">&#39;jshint&#39;</span> <span class="tok-o">:</span> <span class="tok-p">{</span>
      <span class="tok-c1">//...</span>
    <span class="tok-p">},</span>

    <span class="tok-s1">&#39;karma&#39;</span> <span class="tok-o">:</span> <span class="tok-p">{</span>
      <span class="tok-s1">&#39;default&#39;</span> <span class="tok-o">:</span> <span class="tok-p">{</span>
        <span class="tok-s1">&#39;configFile&#39;</span> <span class="tok-o">:</span> <span class="tok-s1">&#39;karma.conf.js&#39;</span><span class="tok-p">,</span>
        <span class="tok-s1">&#39;options&#39;</span><span class="tok-o">:</span> <span class="tok-p">{</span>
          <span class="tok-nx">singleRun</span><span class="tok-o">:</span> <span class="tok-kc">true</span>
        <span class="tok-p">}</span>
      <span class="tok-p">}</span>
    <span class="tok-p">}</span>
  <span class="tok-p">});</span>

  <span class="tok-nx">grunt</span><span class="tok-p">.</span><span class="tok-nx">registerTask</span><span class="tok-p">(</span><span class="tok-s1">&#39;default&#39;</span><span class="tok-p">,</span> <span class="tok-p">[</span><span class="tok-s1">&#39;jshint&#39;</span><span class="tok-p">,</span> <span class="tok-s1">&#39;karma&#39;</span><span class="tok-p">]);</span>
<span class="tok-p">}</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>Como véis, hemos sobreescrito la opción <code>singleRun</code> para asegurarnos de que no se queda a la espera de cambios para volver a lanzar la batería de tests.</p>
</div>
<div class="paragraph">
<p>Ahora, al lanzar <code>grunt</code> se ejecutará JSHint y, si pasa correctamente, se lanzarán después los tests que habíamos hecho con karma.</p>
</div>
</div>
<div class="sect3">
<h4 id="_generando_código_de_distribución">12.4.3. Generando código de distribución</h4>
<div class="paragraph">
<p>En tiempo de desarrollo, es muy cómodo y recomendable tener varios ficheros de código fuente. Sin embargo, a la hora de ir a producción, lo normal es tener un único fichero fuente con todo el código, ya sea minificado o no. El mismo angularJS, como podemos ver en su <a href="https://github.com/angular/angular/tree/master/modules">GitHub</a>, tiene un sinfín de ficheros pero nosotros únicamente importamos el fichero <code>angular.js</code> o <code>angular.min.js</code>. Esto se realiza de una manera sencilla con los plugins <code>grunt-contrib-concat</code> y <code>grunt-contrib-uglify</code>. El primero de ellos se encargará de concatenar todos los ficheros en uno solo, mientras que el segundo utilizará este resultado para generar un fichero minificado.</p>
</div>
<div class="paragraph">
<p>Como esto no lo realizaremos siempre, registraremos una tarea, que llamaremos <code>dist</code>, que realizará esta labor. Es muy importante que los tests pasen correctamente antes de generar un fichero de distribución, con lo que repetiremos las vistas anteriormente.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="javascript"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36</div></td><td class="code"><span class="tok-nx">module</span><span class="tok-p">.</span><span class="tok-nx">exports</span> <span class="tok-o">=</span> <span class="tok-kd">function</span> <span class="tok-p">(</span><span class="tok-nx">grunt</span><span class="tok-p">)</span> <span class="tok-p">{</span>
  <span class="tok-c1">// ...</span>

  <span class="tok-nx">grunt</span><span class="tok-p">.</span><span class="tok-nx">initConfig</span><span class="tok-p">({</span>
    <span class="tok-s1">&#39;pkg&#39;</span><span class="tok-o">:</span> <span class="tok-nx">grunt</span><span class="tok-p">.</span><span class="tok-nx">file</span><span class="tok-p">.</span><span class="tok-nx">readJSON</span><span class="tok-p">(</span><span class="tok-s1">&#39;package.json&#39;</span><span class="tok-p">),</span>

    <span class="tok-s1">&#39;jshint&#39;</span> <span class="tok-o">:</span> <span class="tok-p">{</span>
      <span class="tok-c1">// ...</span>
    <span class="tok-p">},</span>

    <span class="tok-s1">&#39;karma&#39;</span> <span class="tok-o">:</span> <span class="tok-p">{</span>
      <span class="tok-c1">// ...</span>
    <span class="tok-p">},</span>

    <span class="tok-s1">&#39;concat&#39;</span><span class="tok-o">:</span> <span class="tok-p">{</span>
      <span class="tok-s1">&#39;dist&#39;</span> <span class="tok-o">:</span> <span class="tok-p">{</span>
        <span class="tok-s1">&#39;src&#39;</span> <span class="tok-o">:</span> <span class="tok-p">[</span><span class="tok-s1">&#39;src/**/*.js&#39;</span><span class="tok-p">],</span>
        <span class="tok-s1">&#39;dest&#39;</span><span class="tok-o">:</span> <span class="tok-s1">&#39;dist/&lt;%=pkg.name%&gt;-&lt;%=pkg.version%&gt;.js&#39;</span>
      <span class="tok-p">}</span>
    <span class="tok-p">},</span>

    <span class="tok-s1">&#39;uglify&#39;</span><span class="tok-o">:</span> <span class="tok-p">{</span>
      <span class="tok-s1">&#39;options&#39;</span><span class="tok-o">:</span> <span class="tok-p">{</span>
        <span class="tok-s1">&#39;mangle&#39;</span><span class="tok-o">:</span><span class="tok-kc">false</span>
      <span class="tok-p">},</span>
      <span class="tok-s1">&#39;dist&#39;</span><span class="tok-o">:</span><span class="tok-p">{</span>
        <span class="tok-s1">&#39;files&#39;</span><span class="tok-o">:</span> <span class="tok-p">{</span>
          <span class="tok-s1">&#39;dist/&lt;%=pkg.name%&gt;-&lt;%=pkg.version%&gt;.min.js&#39;</span> <span class="tok-o">:</span> <span class="tok-p">[</span><span class="tok-s1">&#39;dist/&lt;%=pkg.name%&gt;-&lt;%=pkg.version%&gt;.js&#39;</span><span class="tok-p">]</span>
        <span class="tok-p">}</span>
      <span class="tok-p">}</span>
    <span class="tok-p">}</span>
  <span class="tok-p">});</span>

  <span class="tok-nx">grunt</span><span class="tok-p">.</span><span class="tok-nx">registerTask</span><span class="tok-p">(</span><span class="tok-s1">&#39;default&#39;</span><span class="tok-p">,</span> <span class="tok-p">[</span><span class="tok-s1">&#39;jshint&#39;</span><span class="tok-p">,</span> <span class="tok-s1">&#39;karma&#39;</span><span class="tok-p">]);</span>
  <span class="tok-nx">grunt</span><span class="tok-p">.</span><span class="tok-nx">registerTask</span><span class="tok-p">(</span><span class="tok-s1">&#39;dist&#39;</span><span class="tok-p">,</span> <span class="tok-p">[</span><span class="tok-s1">&#39;jshint&#39;</span><span class="tok-p">,</span> <span class="tok-s1">&#39;karma&#39;</span><span class="tok-p">,</span> <span class="tok-s1">&#39;concat:dist&#39;</span><span class="tok-p">,</span> <span class="tok-s1">&#39;uglify:dist&#39;</span><span class="tok-p">]);</span>
<span class="tok-p">}</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>Lanzando el comando <code>grunt dist</code>, veremos que se ejecuta todo, y finalmente se habrá creado una carpeta <code>dist</code> con dos nuevos ficheros:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="bash">.
├── Gruntfile.js
├── bower_components
├── dist
│   ├── angular-automation-testing-0.0.0.js
│   └── angular-automation-testing-0.0.0.min.js
├── karma.conf.js
├── node_modules
├── src
│   ├── controller
│   ├── directive
│   ├── filters
│   └── providers
└── <span class="tok-nb">test</span>
    ├── controller
    ├── directive
    ├── filters
    └── providers</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_observando_cambios_para_lanzar_tests">12.4.4. Observando cambios para lanzar tests</h4>
<div class="paragraph">
<p>Otra tarea muy interesante que podemos programar es que los tests se lancen automáticamente tan pronto salvemos los cambios de algún fichero javascript. Para ello nos valdremos de la ayuda del plugin <code>grunt-contrib-watch</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="javascript"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21</div></td><td class="code"><span class="tok-nx">module</span><span class="tok-p">.</span><span class="tok-nx">exports</span> <span class="tok-o">=</span> <span class="tok-kd">function</span> <span class="tok-p">(</span><span class="tok-nx">grunt</span><span class="tok-p">)</span> <span class="tok-p">{</span>
  <span class="tok-c1">// ...</span>

  <span class="tok-nx">grunt</span><span class="tok-p">.</span><span class="tok-nx">initConfig</span><span class="tok-p">({</span>

    <span class="tok-c1">// ...</span>

    <span class="tok-nx">watch</span><span class="tok-o">:</span> <span class="tok-p">{</span>
      <span class="tok-nx">scripts</span><span class="tok-o">:</span> <span class="tok-p">{</span>
        <span class="tok-nx">files</span><span class="tok-o">:</span> <span class="tok-p">[</span><span class="tok-s1">&#39;src/**/*.js&#39;</span><span class="tok-p">,</span> <span class="tok-s1">&#39;test/**/*.js&#39;</span><span class="tok-p">],</span>
        <span class="tok-nx">tasks</span><span class="tok-o">:</span> <span class="tok-p">[</span><span class="tok-s1">&#39;jshint&#39;</span><span class="tok-p">,</span> <span class="tok-s1">&#39;karma&#39;</span><span class="tok-p">],</span>
        <span class="tok-nx">options</span><span class="tok-o">:</span> <span class="tok-p">{</span>
          <span class="tok-nx">spawn</span><span class="tok-o">:</span> <span class="tok-kc">false</span><span class="tok-p">,</span>
        <span class="tok-p">},</span>
      <span class="tok-p">},</span>
    <span class="tok-p">},</span>
  <span class="tok-p">});</span>

  <span class="tok-nx">grunt</span><span class="tok-p">.</span><span class="tok-nx">registerTask</span><span class="tok-p">(</span><span class="tok-s1">&#39;default&#39;</span><span class="tok-p">,</span> <span class="tok-p">[</span><span class="tok-s1">&#39;jshint&#39;</span><span class="tok-p">,</span> <span class="tok-s1">&#39;karma&#39;</span><span class="tok-p">]);</span>
  <span class="tok-nx">grunt</span><span class="tok-p">.</span><span class="tok-nx">registerTask</span><span class="tok-p">(</span><span class="tok-s1">&#39;dist&#39;</span><span class="tok-p">,</span> <span class="tok-p">[</span><span class="tok-s1">&#39;jshint&#39;</span><span class="tok-p">,</span> <span class="tok-s1">&#39;karma&#39;</span><span class="tok-p">,</span> <span class="tok-s1">&#39;concat:dist&#39;</span><span class="tok-p">,</span> <span class="tok-s1">&#39;uglify:dist&#39;</span><span class="tok-p">]);</span>
<span class="tok-p">}</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>Lanzando ahora el comando <code>grunt watch</code>, veremos que la terminal se pone en espera. Modificando cualquier fichero, vemos cómo se registra el cambio y se lanzan los tests.</p>
</div>
</div>
<div class="sect3">
<h4 id="_otros_plugins_de_utilidad">12.4.5. Otros plugins de utilidad</h4>
<div class="paragraph">
<p>Hemos visto unos cuantos plugins que son de gran utilidad para nuestros, y ampliamente usados.</p>
</div>
<div class="paragraph">
<p>Otros plugins interesantes podrían ser:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="https://github.com/alexgorbatchev/grunt-angular-injector"><code>grunt-angular-injector</code></a>: modifica nuestro código AngularJS para ayudarnos a solventar el problema de la minificación de código y la inyección de dependencias.</p>
</li>
<li>
<p><a href="https://www.npmjs.com/package/grunt-html2js"><code>grunt-html2js</code></a>: introduce en el servicio <code>$templateCache</code> todas nuestras vistas. De esta manera, ya están cacheadas y no se tienen que pedir por AJAX.</p>
</li>
<li>
<p><a href="https://github.com/Couto/grunt-groundskeeper"><code>grunt-groundskeeper</code></a>: elimina los <code>console.log</code> y <code>debugger</code> de nuestro código.</p>
</li>
<li>
<p><a href="https://www.npmjs.com/package/grunt-contrib-cssmin"><code>grunt-contrib-cssmin</code></a>: al igual que minificamos javascript, también podemos hacerlo con nuestros CSS.</p>
</li>
<li>
<p><a href="https://www.npmjs.com/package/grunt-contrib-less"><code>grunt-contrib-less</code></a>: compila nuestro código LESS a CSS.</p>
</li>
<li>
<p><a href="https://www.npmjs.com/package/grunt-contrib-imagemin"><code>grunt-contrib-imagemin</code></a>: optimiza nuestras imágenes para un entorno web.</p>
</li>
<li>
<p><a href="https://www.npmjs.com/package/grunt-contrib-htmlmin"><code>grunt-contrib-htmlmin</code></a>: minifica nuestro código HTML.</p>
</li>
<li>
<p><a href="https://github.com/jsoverson/grunt-open"><code>grunt-open</code></a>: podría usarse, por ejemplo, para abrir el navegador una vez generado el código.</p>
</li>
<li>
<p><a href="https://github.com/sindresorhus/grunt-concurrent"><code>grunt-concurrent</code></a>: nos permite lanzar tareas de grunt de manera concurrente.</p>
</li>
<li>
<p><a href="https://github.com/btford/grunt-conventional-changelog"><code>grunt-conventional-changelog</code></a>: genera un <em>changelog</em> a partir de los metadatos de Git.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_un_paso_más_allá">12.5. Un paso más allá</h3>
<div class="paragraph">
<p>Hoy en día tenemos una gran cantidad de servidores de integración continua que nos permiten realizar estas tareas automáticas una vez hemos hecho push en nuestro repositorio. <a href="https://travis-ci.org/">Travis</a>, por ejemplo, nos da este servicio de manera gratuita para proyectos <em>open source</em>. Podemos generar un <em>hook</em> que lanza los tests y genera el código de distribución, y luego despliega <em>releases</em> en el repositorio de nuestro proyecto.</p>
</div>
</div>
</div>
</div>
</div>
<div id="footnotes">
<hr>
<div class="footnote" id="_footnote_1">
<a href="#_footnoteref_1">1</a>. <a href="http://martinfowler.com/eaaDev/DataBinding.html" class="bare">http://martinfowler.com/eaaDev/DataBinding.html</a>
</div>
<div class="footnote" id="_footnote_2">
<a href="#_footnoteref_2">2</a>. <a href="http://en.wikipedia.org/wiki/Singleton_pattern" class="bare">http://en.wikipedia.org/wiki/Singleton_pattern</a>
</div>
<div class="footnote" id="_footnote_3">
<a href="#_footnoteref_3">3</a>. <a href="http://en.wikipedia.org/wiki/National_Security_Agency" class="bare">http://en.wikipedia.org/wiki/National_Security_Agency</a>
</div>
<div class="footnote" id="_footnote_4">
<a href="#_footnoteref_4">4</a>. <a href="http://en.wikipedia.org/wiki/Unicorn" class="bare">http://en.wikipedia.org/wiki/Unicorn</a>
</div>
<div class="footnote" id="_footnote_5">
<a href="#_footnoteref_5">5</a>. <a href="http://en.wikipedia.org/wiki/Factory_method_pattern" class="bare">http://en.wikipedia.org/wiki/Factory_method_pattern</a>
</div>
<div class="footnote" id="_footnote_6">
<a href="#_footnoteref_6">6</a>. <a href="http://codepen.io/alexsuch/pen/prqtn" class="bare">http://codepen.io/alexsuch/pen/prqtn</a>
</div>
<div class="footnote" id="_footnote_7">
<a href="#_footnoteref_7">7</a>. <a href="http://codepen.io/alexsuch/pen/cnmlJ" class="bare">http://codepen.io/alexsuch/pen/cnmlJ</a>
</div>
<div class="footnote" id="_footnote_8">
<a href="#_footnoteref_8">8</a>. Demo en <a href="http://codepen.io/alexsuch/pen/qJCpd" class="bare">http://codepen.io/alexsuch/pen/qJCpd</a>
</div>
<div class="footnote" id="_footnote_9">
<a href="#_footnoteref_9">9</a>. Demo en <a href="http://codepen.io/alexsuch/pen/olJnD" class="bare">http://codepen.io/alexsuch/pen/olJnD</a>
</div>
<div class="footnote" id="_footnote_10">
<a href="#_footnoteref_10">10</a>. Podemos ver toda la configuración en <a href="https://docs.angularjs.org/api/ngRoute/provider/$routeProvider" class="bare">https://docs.angularjs.org/api/ngRoute/provider/$routeProvider</a>
</div>
<div class="footnote" id="_footnote_11">
<a href="#_footnoteref_11">11</a>. <a href="https://docs.angularjs.org/api/ng/service/$location" class="bare">https://docs.angularjs.org/api/ng/service/$location</a>
</div>
<div class="footnote" id="_footnote_12">
<a href="#_footnoteref_12">12</a>. <a href="http://codepen.io/alexsuch/pen/gezjy" class="bare">http://codepen.io/alexsuch/pen/gezjy</a>
</div>
<div class="footnote" id="_footnote_13">
<a href="#_footnoteref_13">13</a>. <a href="http://codepen.io/alexsuch/pen/DkBmn" class="bare">http://codepen.io/alexsuch/pen/DkBmn</a>
</div>
<div class="footnote" id="_footnote_14">
<a href="#_footnoteref_14">14</a>. <a href="https://docs.angularjs.org/api/ng/directive/select" class="bare">https://docs.angularjs.org/api/ng/directive/select</a>
</div>
<div class="footnote" id="_footnote_15">
<a href="#_footnoteref_15">15</a>. <a href="http://codepen.io/alexsuch/pen/yKbre" class="bare">http://codepen.io/alexsuch/pen/yKbre</a>
</div>
<div class="footnote" id="_footnote_16">
<a href="#_footnoteref_16">16</a>. <a href="https://docs.angularjs.org/api/ng/directive/ngClass" class="bare">https://docs.angularjs.org/api/ng/directive/ngClass</a>
</div>
<div class="footnote" id="_footnote_17">
<a href="#_footnoteref_17">17</a>. <a href="https://docs.angularjs.org/api/ng/directive/ngShow" class="bare">https://docs.angularjs.org/api/ng/directive/ngShow</a>
</div>
<div class="footnote" id="_footnote_18">
<a href="#_footnoteref_18">18</a>. <a href="https://docs.angularjs.org/api/ng/directive/ngDisabled" class="bare">https://docs.angularjs.org/api/ng/directive/ngDisabled</a>
</div>
<div class="footnote" id="_footnote_19">
<a href="#_footnoteref_19">19</a>. <a href="http://codepen.io/alexsuch/pen/nyuGp" class="bare">http://codepen.io/alexsuch/pen/nyuGp</a>
</div>
<div class="footnote" id="_footnote_20">
<a href="#_footnoteref_20">20</a>. <a href="http://codepen.io/alexsuch/pen/kjDFL" class="bare">http://codepen.io/alexsuch/pen/kjDFL</a>
</div>
<div class="footnote" id="_footnote_21">
<a href="#_footnoteref_21">21</a>. <a href="http://codepen.io/alexsuch/pen/cdDJA" class="bare">http://codepen.io/alexsuch/pen/cdDJA</a>
</div>
</div>
<div id="footer">
<div id="footer-text">
Last updated 2015-03-05 07:33:13 CET
</div>
</div>
</body>
</html>