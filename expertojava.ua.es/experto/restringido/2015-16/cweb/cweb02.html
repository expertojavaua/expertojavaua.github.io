<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<!--[if IE]><meta http-equiv="X-UA-Compatible" content="IE=edge"><![endif]-->
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 1.5.2">
<meta name="author" content="Miguel Angel Lozano">
<title>Componentes Web</title>
<style>/*! normalize.css v2.1.2 | MIT License | git.io/normalize */
/* ========================================================================== HTML5 display definitions ========================================================================== */
/** Correct `block` display not defined in IE 8/9. */
article, aside, details, figcaption, figure, footer, header, hgroup, main, nav, section, summary { display: block; }

/** Correct `inline-block` display not defined in IE 8/9. */
audio, canvas, video { display: inline-block; }

/** Prevent modern browsers from displaying `audio` without controls. Remove excess height in iOS 5 devices. */
audio:not([controls]) { display: none; height: 0; }

/** Address `[hidden]` styling not present in IE 8/9. Hide the `template` element in IE, Safari, and Firefox < 22. */
[hidden], template { display: none; }

script { display: none !important; }

/* ========================================================================== Base ========================================================================== */
/** 1. Set default font family to sans-serif. 2. Prevent iOS text size adjust after orientation change, without disabling user zoom. */
html { font-family: sans-serif; /* 1 */ -ms-text-size-adjust: 100%; /* 2 */ -webkit-text-size-adjust: 100%; /* 2 */ }

/** Remove default margin. */
body { margin: 0; }

/* ========================================================================== Links ========================================================================== */
/** Remove the gray background color from active links in IE 10. */
a { background: transparent; }

/** Address `outline` inconsistency between Chrome and other browsers. */
a:focus { outline: thin dotted; }

/** Improve readability when focused and also mouse hovered in all browsers. */
a:active, a:hover { outline: 0; }

/* ========================================================================== Typography ========================================================================== */
/** Address variable `h1` font-size and margin within `section` and `article` contexts in Firefox 4+, Safari 5, and Chrome. */
h1 { font-size: 2em; margin: 0.67em 0; }

/** Address styling not present in IE 8/9, Safari 5, and Chrome. */
abbr[title] { border-bottom: 1px dotted; }

/** Address style set to `bolder` in Firefox 4+, Safari 5, and Chrome. */
b, strong { font-weight: bold; }

/** Address styling not present in Safari 5 and Chrome. */
dfn { font-style: italic; }

/** Address differences between Firefox and other browsers. */
hr { -moz-box-sizing: content-box; box-sizing: content-box; height: 0; }

/** Address styling not present in IE 8/9. */
mark { background: #ff0; color: #000; }

/** Correct font family set oddly in Safari 5 and Chrome. */
code, kbd, pre, samp { font-family: monospace, serif; font-size: 1em; }

/** Improve readability of pre-formatted text in all browsers. */
pre { white-space: pre-wrap; }

/** Set consistent quote types. */
q { quotes: "\201C" "\201D" "\2018" "\2019"; }

/** Address inconsistent and variable font size in all browsers. */
small { font-size: 80%; }

/** Prevent `sub` and `sup` affecting `line-height` in all browsers. */
sub, sup { font-size: 75%; line-height: 0; position: relative; vertical-align: baseline; }

sup { top: -0.5em; }

sub { bottom: -0.25em; }

/* ========================================================================== Embedded content ========================================================================== */
/** Remove border when inside `a` element in IE 8/9. */
img { border: 0; }

/** Correct overflow displayed oddly in IE 9. */
svg:not(:root) { overflow: hidden; }

/* ========================================================================== Figures ========================================================================== */
/** Address margin not present in IE 8/9 and Safari 5. */
figure { margin: 0; }

/* ========================================================================== Forms ========================================================================== */
/** Define consistent border, margin, and padding. */
fieldset { border: 1px solid #c0c0c0; margin: 0 2px; padding: 0.35em 0.625em 0.75em; }

/** 1. Correct `color` not being inherited in IE 8/9. 2. Remove padding so people aren't caught out if they zero out fieldsets. */
legend { border: 0; /* 1 */ padding: 0; /* 2 */ }

/** 1. Correct font family not being inherited in all browsers. 2. Correct font size not being inherited in all browsers. 3. Address margins set differently in Firefox 4+, Safari 5, and Chrome. */
button, input, select, textarea { font-family: inherit; /* 1 */ font-size: 100%; /* 2 */ margin: 0; /* 3 */ }

/** Address Firefox 4+ setting `line-height` on `input` using `!important` in the UA stylesheet. */
button, input { line-height: normal; }

/** Address inconsistent `text-transform` inheritance for `button` and `select`. All other form control elements do not inherit `text-transform` values. Correct `button` style inheritance in Chrome, Safari 5+, and IE 8+. Correct `select` style inheritance in Firefox 4+ and Opera. */
button, select { text-transform: none; }

/** 1. Avoid the WebKit bug in Android 4.0.* where (2) destroys native `audio` and `video` controls. 2. Correct inability to style clickable `input` types in iOS. 3. Improve usability and consistency of cursor style between image-type `input` and others. */
button, html input[type="button"], input[type="reset"], input[type="submit"] { -webkit-appearance: button; /* 2 */ cursor: pointer; /* 3 */ }

/** Re-set default cursor for disabled elements. */
button[disabled], html input[disabled] { cursor: default; }

/** 1. Address box sizing set to `content-box` in IE 8/9. 2. Remove excess padding in IE 8/9. */
input[type="checkbox"], input[type="radio"] { box-sizing: border-box; /* 1 */ padding: 0; /* 2 */ }

/** 1. Address `appearance` set to `searchfield` in Safari 5 and Chrome. 2. Address `box-sizing` set to `border-box` in Safari 5 and Chrome (include `-moz` to future-proof). */
input[type="search"] { -webkit-appearance: textfield; /* 1 */ -moz-box-sizing: content-box; -webkit-box-sizing: content-box; /* 2 */ box-sizing: content-box; }

/** Remove inner padding and search cancel button in Safari 5 and Chrome on OS X. */
input[type="search"]::-webkit-search-cancel-button, input[type="search"]::-webkit-search-decoration { -webkit-appearance: none; }

/** Remove inner padding and border in Firefox 4+. */
button::-moz-focus-inner, input::-moz-focus-inner { border: 0; padding: 0; }

/** 1. Remove default vertical scrollbar in IE 8/9. 2. Improve readability and alignment in all browsers. */
textarea { overflow: auto; /* 1 */ vertical-align: top; /* 2 */ }

/* ========================================================================== Tables ========================================================================== */
/** Remove most spacing between table cells. */
table { border-collapse: collapse; border-spacing: 0; }

meta.foundation-mq-small { font-family: "only screen and (min-width: 768px)"; width: 768px; }

meta.foundation-mq-medium { font-family: "only screen and (min-width:1280px)"; width: 1280px; }

meta.foundation-mq-large { font-family: "only screen and (min-width:1440px)"; width: 1440px; }

*, *:before, *:after { -moz-box-sizing: border-box; -webkit-box-sizing: border-box; box-sizing: border-box; }

html, body { font-size: 97%; }

body { background: white; color: #222222; padding: 0; margin: 0; font-family: "Helvetica Neue", "Helvetica", Helvetica, Arial, sans-serif; font-weight: normal; font-style: normal; line-height: 1; position: relative; cursor: auto; }

a:hover { cursor: pointer; }

img, object, embed { max-width: 100%; height: auto; }

object, embed { height: 100%; }

img { -ms-interpolation-mode: bicubic; }

#map_canvas img, #map_canvas embed, #map_canvas object, .map_canvas img, .map_canvas embed, .map_canvas object { max-width: none !important; }

.left { float: left !important; }

.right { float: right !important; }

.text-left { text-align: left !important; }

.text-right { text-align: right !important; }

.text-center { text-align: center !important; }

.text-justify { text-align: justify !important; }

.hide { display: none; }

.antialiased, body { -webkit-font-smoothing: antialiased; }

img { display: inline-block; vertical-align: middle; }

textarea { height: auto; min-height: 50px; }

select { width: 100%; }

p.lead, .paragraph.lead > p, #preamble > .sectionbody > .paragraph:first-of-type p { font-size: 1.21875em; line-height: 1.6; }

.subheader, .admonitionblock td.content > .title, .audioblock > .title, .exampleblock > .title, .imageblock > .title, .listingblock > .title, .literalblock > .title, .stemblock > .title, .openblock > .title, .paragraph > .title, .quoteblock > .title, table.tableblock > .title, .verseblock > .title, .videoblock > .title, .dlist > .title, .olist > .title, .ulist > .title, .qlist > .title, .hdlist > .title { line-height: 1.4; color: #6f6f6f; font-weight: 300; margin-top: 0.2em; margin-bottom: 0.5em; }

/* Typography resets */
div, dl, dt, dd, ul, ol, li, h1, h2, h3, #toctitle, .sidebarblock > .content > .title, h4, h5, h6, pre, form, p, blockquote, th, td { margin: 0; padding: 0; direction: ltr; }

/* Default Link Styles */
a { color: #1164be; text-decoration: none; line-height: inherit; }
a img { border: none; }

/* Default paragraph styles */
p { font-family: inherit; font-weight: normal; font-size: 1em; line-height: 1.4; margin-bottom: 1em; text-rendering: optimizeLegibility; }
p aside { font-size: 0.875em; line-height: 1.35; font-style: italic; }

/* Default header styles */
h1, h2, h3, #toctitle, .sidebarblock > .content > .title, h4, h5, h6 { font-family: "Helvetica Neue", "Helvetica", Helvetica, Arial, sans-serif; font-weight: bold; font-style: normal; color: #1c355e; text-rendering: optimizeLegibility; margin-top: 1em; margin-bottom: 0.5em; line-height: 1.2125em; }
h1 small, h2 small, h3 small, #toctitle small, .sidebarblock > .content > .title small, h4 small, h5 small, h6 small { font-size: 60%; color: #6f6f6f; line-height: 0; }

h1 { font-size: 2.125em; }

h2 { font-size: 1.6875em; }

h3, #toctitle, .sidebarblock > .content > .title { font-size: 1.375em; }

h4 { font-size: 1.125em; }

h5 { font-size: 1.125em; }

h6 { font-size: 1em; }

hr { border: solid #dddddd; border-width: 1px 0 0; clear: both; margin: 1.25em 0 1.1875em; height: 0; }

/* Helpful Typography Defaults */
em, i { font-style: italic; line-height: inherit; }

strong, b { font-weight: bold; line-height: inherit; }

small { font-size: 60%; line-height: inherit; }

code { font-family: Consolas, "Liberation Mono", Courier, monospace; font-weight: bold; }

/* Lists */
ul, ol, dl { font-size: 1em; line-height: 1.4; margin-bottom: 1.25em; list-style-position: outside; font-family: inherit; }

ul, ol { margin-left: 2.5em; }
ul.no-bullet, ol.no-bullet { margin-left: 1.5em; }

/* Unordered Lists */
ul li ul, ul li ol { margin-left: 1.25em; margin-bottom: 0; font-size: 1em; /* Override nested font-size change */ }
ul.square li ul, ul.circle li ul, ul.disc li ul { list-style: inherit; }
ul.square { list-style-type: square; }
ul.circle { list-style-type: circle; }
ul.disc { list-style-type: disc; }
ul.no-bullet { list-style: none; }

/* Ordered Lists */
ol li ul, ol li ol { margin-left: 1.25em; margin-bottom: 0; }

/* Definition Lists */
dl dt { margin-bottom: 0.3125em; font-weight: bold; }
dl dd { margin-bottom: 1.25em; }

/* Abbreviations */
abbr, acronym { text-transform: uppercase; font-size: 90%; color: #222222; border-bottom: 1px dotted #dddddd; cursor: help; }

abbr { text-transform: none; }

/* Blockquotes */
blockquote { margin: 0 0 1.25em; padding: 0.5625em 1.25em 0 1.1875em; border-left: 1px solid #dddddd; }
blockquote cite { display: block; font-size: 0.8125em; color: #555555; }
blockquote cite:before { content: "\2014 \0020"; }
blockquote cite a, blockquote cite a:visited { color: #555555; }

blockquote, blockquote p { line-height: 1.6; color: #6f6f6f; }

/* Microformats */
.vcard { display: inline-block; margin: 0 0 1.25em 0; border: 1px solid #dddddd; padding: 0.625em 0.75em; }
.vcard li { margin: 0; display: block; }
.vcard .fn { font-weight: bold; font-size: 0.9375em; }

.vevent .summary { font-weight: bold; }
.vevent abbr { cursor: auto; text-decoration: none; font-weight: bold; border: none; padding: 0 0.0625em; }

/*@media only screen and (min-width: 768px) { h1, h2, h3, #toctitle, .sidebarblock > .content > .title, h4, h5, h6 { line-height: 1.4; }
  h1 { font-size: 2.75em; }
  h2 { font-size: 2.3125em; }
  h3, #toctitle, .sidebarblock > .content > .title { font-size: 1.6875em; }
  h4 { font-size: 1.4375em; } }*/
/* Tables */
table { background: white; margin-bottom: 1.25em; border: solid 1px #dddddd; }
table thead, table tfoot { background: whitesmoke; font-weight: bold; }
table thead tr th, table thead tr td, table tfoot tr th, table tfoot tr td { padding: 0.5em 0.625em 0.625em; font-size: inherit; color: #222222; text-align: left; }
table tr th, table tr td { padding: 0.5625em 0.625em; font-size: inherit; color: #222222; }
table tr.even, table tr.alt, table tr:nth-of-type(even) { background: #f9f9f9; }
table thead tr th, table tfoot tr th, table tbody tr td, table tr td, table tfoot tr td { display: table-cell; line-height: 1.4; }

h1, h2, h3, #toctitle, .sidebarblock > .content > .title, h4, h5, h6 { line-height: 1.4; border-bottom: 1px solid #dddddd }

.clearfix:before, .clearfix:after, .float-group:before, .float-group:after { content: " "; display: table; }
.clearfix:after, .float-group:after { clear: both; }

*:not(pre) > code { font-size: inherit; font-style: normal !important; letter-spacing: 0; padding: 3px 2px 1px 2px; background-color: #eeeeee; border: 1px solid #dddddd; -webkit-border-radius: 0; border-radius: 0; line-height: inherit; font-weight: normal; }

pre, pre > code { line-height: 1.4; color: black; font-family: monospace, serif; font-weight: normal; }

.keyseq { color: #555555; }

kbd { display: inline-block; color: #222222; font-size: 0.75em; line-height: 1.4; background-color: #f7f7f7; border: 1px solid #ccc; -webkit-border-radius: 3px; border-radius: 3px; -webkit-box-shadow: 0 1px 0 rgba(0, 0, 0, 0.2), 0 0 0 0.1em white inset; box-shadow: 0 1px 0 rgba(0, 0, 0, 0.2), 0 0 0 0.1em white inset; margin: -0.15em 0.15em 0 0.15em; padding: 0.2em 0.6em 0.2em 0.5em; vertical-align: middle; white-space: nowrap; }

.keyseq kbd:first-child { margin-left: 0; }

.keyseq kbd:last-child { margin-right: 0; }

.menuseq, .menu { color: #090909; }

b.button:before, b.button:after { position: relative; top: -1px; font-weight: normal; }

b.button:before { content: "["; padding: 0 3px 0 2px; }

b.button:after { content: "]"; padding: 0 2px 0 3px; }

#header, #content, #footnotes, #footer { width: 100%; margin-left: auto; margin-right: auto; margin-top: 0; margin-bottom: 0; max-width: 62.5em; *zoom: 1; position: relative; padding-left: 0.9375em; padding-right: 0.9375em; }
#header:before, #header:after, #content:before, #content:after, #footnotes:before, #footnotes:after, #footer:before, #footer:after { content: " "; display: table; }
#header:after, #content:after, #footnotes:after, #footer:after { clear: both; }

#content { margin-top: 1.25em; }

#content:before { content: none; }

#header > h1:first-child { color: black; margin-top: 2.25rem; margin-bottom: 0; }
#header > h1:first-child + #toc { margin-top: 8px; border-top: 1px solid #dddddd; }
#header > h1:only-child, body.toc2 #header > h1:nth-last-child(2) { border-bottom: 1px solid #dddddd; padding-bottom: 8px; }
#header .details { border-bottom: 1px solid #dddddd; line-height: 1.45; padding-top: 0.25em; padding-bottom: 0.25em; padding-left: 0.25em; color: #555555; display: -ms-flexbox; display: -webkit-flex; display: flex; -ms-flex-flow: row wrap; -webkit-flex-flow: row wrap; flex-flow: row wrap; }
#header .details span:first-child { margin-left: -0.125em; }
#header .details span.email a { color: #6f6f6f; }
#header .details br { display: none; }
#header .details br + span:before { content: "\00a0\2013\00a0"; }
#header .details br + span.author:before { content: "\00a0\22c5\00a0"; color: #6f6f6f; }
#header .details br + span#revremark:before { content: "\00a0|\00a0"; }
#header #revnumber { text-transform: capitalize; }
#header #revnumber:after { content: "\00a0"; }

#content > h1:first-child:not([class]) { color: black; border-bottom: 1px solid #dddddd; padding-bottom: 8px; margin-top: 0; padding-top: 1rem; margin-bottom: 1.25rem; }

#floating {
  position: fixed;
  z-index: 1000;
  padding: 0.5em;
  right: 0;
  top: 0;
  background: white;
  box-shadow: 0 0 1em #777777;
  -webkit-box-shadow: 0 0 1em #777777;
  -moz-box-shadow: 0 0 1em #777777;
  -webkit-border-bottom-left-radius: 5px;
  -moz-border-radius-bottomleft: 5px;
  max-height: 80%;
  overflow: auto;
}

#floating #full { display: none; } /* Hide the full TOC by default */

#floating:hover #full{
  display: block; /* Show it on hover */
}


#toc { border-bottom: 1px solid #dddddd; padding-bottom: 0.5em; }
#toc > ul { margin-left: 0.125em; }
#toc ul.sectlevel0 > li > a { font-style: italic; }
#toc ul.sectlevel0 ul.sectlevel1 { margin: 0.5em 0; }
#toc ul { font-family: "Helvetica Neue", "Helvetica", Helvetica, Arial, sans-serif; list-style-type: none; }
#toc a { text-decoration: none; }
#toc a:active { text-decoration: underline; }

#toctitle { color: #6f6f6f; font-size: 1.2em; }

@media only screen and (min-width: 768px) { #toctitle { font-size: 1.375em; }
  body.toc2 { padding-left: 15em; padding-right: 0; }
  #toc.toc2 { margin-top: 0 !important; background-color: #f2f2f2; position: fixed; width: 15em; left: 0; top: 0; border-right: 1px solid #dddddd; border-top-width: 0 !important; border-bottom-width: 0 !important; z-index: 1000; padding: 1.25em 1em; height: 100%; overflow: auto; }
  #toc.toc2 #toctitle { margin-top: 0; font-size: 1.2em; }
  #toc.toc2 > ul { font-size: 0.9em; margin-bottom: 0; }
  #toc.toc2 ul ul { margin-left: 0; padding-left: 1em; }
  #toc.toc2 ul.sectlevel0 ul.sectlevel1 { padding-left: 0; margin-top: 0.5em; margin-bottom: 0.5em; }
  body.toc2.toc-right { padding-left: 0; padding-right: 15em; }
  body.toc2.toc-right #toc.toc2 { border-right-width: 0; border-left: 1px solid #dddddd; left: auto; right: 0; } }
@media only screen and (min-width: 1280px) { body.toc2 { padding-left: 20em; padding-right: 0; }
  #toc.toc2 { width: 20em; }
  #toc.toc2 #toctitle { font-size: 1.375em; }
  #toc.toc2 > ul { font-size: 0.95em; }
  #toc.toc2 ul ul { padding-left: 1.25em; }
  body.toc2.toc-right { padding-left: 0; padding-right: 20em; } }
#content #toc { border-style: solid; border-width: 1px; border-color: #d9d9d9; margin-bottom: 1.25em; padding: 1.25em; background: #f2f2f2; -webkit-border-radius: 0; border-radius: 0; }
#content #toc > :first-child { margin-top: 0; }
#content #toc > :last-child { margin-bottom: 0; }

#footer { max-width: 100%; background-color: #222222; padding: 1.25em; }

#footer-text { color: #dddddd; line-height: 1.44; }

.sect1 { padding-bottom: 0.625em; }

@media only screen and (min-width: 768px) { .sect1 { padding-bottom: 1.25em; } }
.sect1 + .sect1 { border-top: 1px solid #dddddd; }

#content h1 > a.anchor, h2 > a.anchor, h3 > a.anchor, #toctitle > a.anchor, .sidebarblock > .content > .title > a.anchor, h4 > a.anchor, h5 > a.anchor, h6 > a.anchor { position: absolute; z-index: 1001; width: 1.5ex; margin-left: -1.5ex; display: block; text-decoration: none !important; visibility: hidden; text-align: center; font-weight: normal; }
#content h1 > a.anchor:before, h2 > a.anchor:before, h3 > a.anchor:before, #toctitle > a.anchor:before, .sidebarblock > .content > .title > a.anchor:before, h4 > a.anchor:before, h5 > a.anchor:before, h6 > a.anchor:before { content: "\00A7"; font-size: 0.85em; display: block; padding-top: 0.1em; }
#content h1:hover > a.anchor, #content h1 > a.anchor:hover, h2:hover > a.anchor, h2 > a.anchor:hover, h3:hover > a.anchor, #toctitle:hover > a.anchor, .sidebarblock > .content > .title:hover > a.anchor, h3 > a.anchor:hover, #toctitle > a.anchor:hover, .sidebarblock > .content > .title > a.anchor:hover, h4:hover > a.anchor, h4 > a.anchor:hover, h5:hover > a.anchor, h5 > a.anchor:hover, h6:hover > a.anchor, h6 > a.anchor:hover { visibility: visible; }
#content h1 > a.link, h2 > a.link, h3 > a.link, #toctitle > a.link, .sidebarblock > .content > .title > a.link, h4 > a.link, h5 > a.link, h6 > a.link { color: #222222; text-decoration: none; }
#content h1 > a.link:hover, h2 > a.link:hover, h3 > a.link:hover, #toctitle > a.link:hover, .sidebarblock > .content > .title > a.link:hover, h4 > a.link:hover, h5 > a.link:hover, h6 > a.link:hover { color: #151515; }

.audioblock, .imageblock, .literalblock, .listingblock, .stemblock, .videoblock { margin-bottom: 1.25em; }

.admonitionblock td.content > .title, .audioblock > .title, .exampleblock > .title, .imageblock > .title, .listingblock > .title, .literalblock > .title, .stemblock > .title, .openblock > .title, .paragraph > .title, .quoteblock > .title, table.tableblock > .title, .verseblock > .title, .videoblock > .title, .dlist > .title, .olist > .title, .ulist > .title, .qlist > .title, .hdlist > .title { text-rendering: optimizeLegibility; text-align: left; }

table.tableblock > caption.title { white-space: nowrap; overflow: visible; max-width: 0; }

.paragraph.lead > p, #preamble > .sectionbody > .paragraph:first-of-type p { color: black; }

table.tableblock #preamble > .sectionbody > .paragraph:first-of-type p { font-size: inherit; }

.admonitionblock > table { border-collapse: separate; border: 0; background: none; width: 100%; }
.admonitionblock > table td.icon { text-align: center; width: 80px; }
.admonitionblock > table td.icon img { max-width: none; }
.admonitionblock > table td.icon .title { font-weight: bold; font-family: "Helvetica Neue", "Helvetica", Helvetica, Arial, sans-serif; text-transform: uppercase; }
.admonitionblock > table td.content { padding-left: 1.125em; padding-right: 1.25em; border-left: 1px solid #dddddd; color: #555555; }
.admonitionblock > table td.content > :last-child > :last-child { margin-bottom: 0; }

.exampleblock > .content { border-style: solid; border-width: 1px; border-color: #e6e6e6; margin-bottom: 1.25em; padding: 1.25em; background: white; -webkit-border-radius: 0; border-radius: 0; }
.exampleblock > .content > :first-child { margin-top: 0; }
.exampleblock > .content > :last-child { margin-bottom: 0; }

.sidebarblock { border-style: solid; border-width: 1px; border-color: #d9d9d9; margin-bottom: 1.25em; padding: 1.25em; background: #f2f2f2; -webkit-border-radius: 0; border-radius: 0; }
.sidebarblock > :first-child { margin-top: 0; }
.sidebarblock > :last-child { margin-bottom: 0; }
.sidebarblock > .content > .title { color: #6f6f6f; margin-top: 0; }

.exampleblock > .content > :last-child > :last-child, .exampleblock > .content .olist > ol > li:last-child > :last-child, .exampleblock > .content .ulist > ul > li:last-child > :last-child, .exampleblock > .content .qlist > ol > li:last-child > :last-child, .sidebarblock > .content > :last-child > :last-child, .sidebarblock > .content .olist > ol > li:last-child > :last-child, .sidebarblock > .content .ulist > ul > li:last-child > :last-child, .sidebarblock > .content .qlist > ol > li:last-child > :last-child { margin-bottom: 0; }

.literalblock pre, .listingblock pre:not(.highlight), .listingblock pre[class="highlight"], .listingblock pre[class^="highlight "], .listingblock pre.CodeRay, .listingblock pre.prettyprint { background: #eeeeee; }
.sidebarblock .literalblock pre, .sidebarblock .listingblock pre:not(.highlight), .sidebarblock .listingblock pre[class="highlight"], .sidebarblock .listingblock pre[class^="highlight "], .sidebarblock .listingblock pre.CodeRay, .sidebarblock .listingblock pre.prettyprint { background: #f2f1f1; }

.literalblock pre, .literalblock pre[class], .listingblock pre, .listingblock pre[class] { border: 1px solid #cccccc; -webkit-border-radius: 0; border-radius: 0; word-wrap: break-word; padding: 0.8em 0.8em 0.65em 0.8em; font-size: 0.8125em; }
.literalblock pre.nowrap, .literalblock pre[class].nowrap, .listingblock pre.nowrap, .listingblock pre[class].nowrap { overflow-x: auto; white-space: pre; word-wrap: normal; }
@media only screen and (min-width: 768px) { .literalblock pre, .literalblock pre[class], .listingblock pre, .listingblock pre[class] { font-size: 0.90625em; } }
@media only screen and (min-width: 1280px) { .literalblock pre, .literalblock pre[class], .listingblock pre, .listingblock pre[class] { font-size: 1em; } }

.literalblock.output pre { color: #eeeeee; background-color: black; }

.listingblock pre.highlightjs { padding: 0; }
.listingblock pre.highlightjs > code { padding: 0.8em 0.8em 0.65em 0.8em; -webkit-border-radius: 0; border-radius: 0; }

.listingblock > .content { position: relative; }

.listingblock code[data-lang]:before { display: none; content: attr(data-lang); position: absolute; font-size: 0.75em; top: 0.425rem; right: 0.5rem; line-height: 1; text-transform: uppercase; color: #999; }

.listingblock:hover code[data-lang]:before { display: block; }

.listingblock.terminal pre .command:before { content: attr(data-prompt); padding-right: 0.5em; color: #999; }

.listingblock.terminal pre .command:not([data-prompt]):before { content: "$"; }

table.pyhltable { border-collapse: separate; border: 0; margin-bottom: 0; background: none; }

table.pyhltable td { vertical-align: top; padding-top: 0; padding-bottom: 0; }

table.pyhltable td.code { padding-left: .75em; padding-right: 0; }

pre.pygments .lineno, table.pyhltable td:not(.code) { color: #999; padding-left: 0; padding-right: .5em; border-right: 1px solid #dddddd; }

pre.pygments .lineno { display: inline-block; margin-right: .25em; }

table.pyhltable .linenodiv { background: none !important; padding-right: 0 !important; }

.quoteblock { margin: 0 1em 1.25em 1.5em; display: table; }
.quoteblock > .title { margin-left: -1.5em; margin-bottom: 0.75em; }
.quoteblock blockquote, .quoteblock blockquote p { color: #6f6f6f; font-size: 1.15rem; line-height: 1.75; word-spacing: 0.1em; letter-spacing: 0; font-style: italic; text-align: justify; }
.quoteblock blockquote { margin: 0; padding: 0; border: 0; }
.quoteblock blockquote:before { content: "\201c"; float: left; font-size: 2.75em; font-weight: bold; line-height: 0.6em; margin-left: -0.6em; color: #6f6f6f; text-shadow: 0 1px 2px rgba(0, 0, 0, 0.1); }
.quoteblock blockquote > .paragraph:last-child p { margin-bottom: 0; }
.quoteblock .attribution { margin-top: 0.5em; margin-right: 0.5ex; text-align: right; }
.quoteblock .quoteblock { margin-left: 0; margin-right: 0; padding: 0.5em 0; border-left: 3px solid #555555; }
.quoteblock .quoteblock blockquote { padding: 0 0 0 0.75em; }
.quoteblock .quoteblock blockquote:before { display: none; }

.verseblock { margin: 0 1em 1.25em 1em; }
.verseblock pre { font-family: "Open Sans", "DejaVu Sans", sans; font-size: 1.15rem; color: #6f6f6f; font-weight: 300; text-rendering: optimizeLegibility; }
.verseblock pre strong { font-weight: 400; }
.verseblock .attribution { margin-top: 1.25rem; margin-left: 0.5ex; }

.quoteblock .attribution, .verseblock .attribution { font-size: 0.8125em; line-height: 1.45; font-style: italic; }
.quoteblock .attribution br, .verseblock .attribution br { display: none; }
.quoteblock .attribution cite, .verseblock .attribution cite { display: block; letter-spacing: -0.05em; color: #555555; }

.quoteblock.abstract { margin: 0 0 1.25em 0; display: block; }
.quoteblock.abstract blockquote, .quoteblock.abstract blockquote p { text-align: left; word-spacing: 0; }
.quoteblock.abstract blockquote:before, .quoteblock.abstract blockquote p:first-of-type:before { display: none; }

table.tableblock { max-width: 100%; border-collapse: separate; }
table.tableblock td > .paragraph:last-child p > p:last-child, table.tableblock th > p:last-child, table.tableblock td > p:last-child { margin-bottom: 0; }

table.spread { width: 100%; }

table.tableblock, th.tableblock, td.tableblock { border: 0 solid #dddddd; }

table.grid-all th.tableblock, table.grid-all td.tableblock { border-width: 0 1px 1px 0; }

table.grid-all tfoot > tr > th.tableblock, table.grid-all tfoot > tr > td.tableblock { border-width: 1px 1px 0 0; }

table.grid-cols th.tableblock, table.grid-cols td.tableblock { border-width: 0 1px 0 0; }

table.grid-all * > tr > .tableblock:last-child, table.grid-cols * > tr > .tableblock:last-child { border-right-width: 0; }

table.grid-rows th.tableblock, table.grid-rows td.tableblock { border-width: 0 0 1px 0; }

table.grid-all tbody > tr:last-child > th.tableblock, table.grid-all tbody > tr:last-child > td.tableblock, table.grid-all thead:last-child > tr > th.tableblock, table.grid-rows tbody > tr:last-child > th.tableblock, table.grid-rows tbody > tr:last-child > td.tableblock, table.grid-rows thead:last-child > tr > th.tableblock { border-bottom-width: 0; }

table.grid-rows tfoot > tr > th.tableblock, table.grid-rows tfoot > tr > td.tableblock { border-width: 1px 0 0 0; }

table.frame-all { border-width: 1px; }

table.frame-sides { border-width: 0 1px; }

table.frame-topbot { border-width: 1px 0; }

th.halign-left, td.halign-left { text-align: left; }

th.halign-right, td.halign-right { text-align: right; }

th.halign-center, td.halign-center { text-align: center; }

th.valign-top, td.valign-top { vertical-align: top; }

th.valign-bottom, td.valign-bottom { vertical-align: bottom; }

th.valign-middle, td.valign-middle { vertical-align: middle; }

table thead th, table tfoot th { font-weight: bold; }

tbody tr th { display: table-cell; line-height: 1.4; background: whitesmoke; }

tbody tr th, tbody tr th p, tfoot tr th, tfoot tr th p { color: #222222; font-weight: bold; }

p.tableblock > code:only-child { background: none; padding: 0; }

p.tableblock { font-size: 1em; }

td > div.verse { white-space: pre; }

ol { margin-left: 2.5em; }

ul li ol { margin-left: 1.5em; }

dl dd { margin-left: 1.125em; }

dl dd:last-child, dl dd:last-child > :last-child { margin-bottom: 0; }

ol > li p, ul > li p, ul dd, ol dd, .olist .olist, .ulist .ulist, .ulist .olist, .olist .ulist { margin-bottom: 0.625em; }

ul.unstyled, ol.unnumbered, ul.checklist, ul.none { list-style-type: none; }

ul.unstyled, ol.unnumbered, ul.checklist { margin-left: 0.625em; }

ul.checklist li > p:first-child > .fa-check-square-o:first-child, ul.checklist li > p:first-child > input[type="checkbox"]:first-child { margin-right: 0.25em; }

ul.checklist li > p:first-child > input[type="checkbox"]:first-child { position: relative; top: 1px; }

ul.inline { margin: 0 auto 0.625em auto; margin-left: -1.375em; margin-right: 0; padding: 0; list-style: none; overflow: hidden; }
ul.inline > li { list-style: none; float: left; margin-left: 1.375em; display: block; }
ul.inline > li > * { display: block; }

.unstyled dl dt { font-weight: normal; font-style: normal; }

ol.arabic { list-style-type: decimal; }

ol.decimal { list-style-type: decimal-leading-zero; }

ol.loweralpha { list-style-type: lower-alpha; }

ol.upperalpha { list-style-type: upper-alpha; }

ol.lowerroman { list-style-type: lower-roman; }

ol.upperroman { list-style-type: upper-roman; }

ol.lowergreek { list-style-type: lower-greek; }

.hdlist > table, .colist > table { border: 0; background: none; }
.hdlist > table > tbody > tr, .colist > table > tbody > tr { background: none; }

td.hdlist1 { padding-right: .75em; font-weight: bold; }

td.hdlist1, td.hdlist2 { vertical-align: top; }

.literalblock + .colist, .listingblock + .colist { margin-top: -0.5em; }

.colist > table tr > td:first-of-type { padding: 0 0.75em; line-height: 1; }
.colist > table tr > td:last-of-type { padding: 0.25em 0; }

.thumb, .th { line-height: 0; display: inline-block; border: solid 4px white; -webkit-box-shadow: 0 0 0 1px #dddddd; box-shadow: 0 0 0 1px #dddddd; }

.imageblock.left, .imageblock[style*="float: left"] { margin: 0.25em 0.625em 1.25em 0; }
.imageblock.right, .imageblock[style*="float: right"] { margin: 0.25em 0 1.25em 0.625em; }
.imageblock > .title { margin-bottom: 0; }
.imageblock.thumb, .imageblock.th { border-width: 6px; }
.imageblock.thumb > .title, .imageblock.th > .title { padding: 0 0.125em; }

.image.left, .image.right { margin-top: 0.25em; margin-bottom: 0.25em; display: inline-block; line-height: 0; }
.image.left { margin-right: 0.625em; }
.image.right { margin-left: 0.625em; }

a.image { text-decoration: none; }

span.footnote, span.footnoteref { vertical-align: super; font-size: 0.875em; }
span.footnote a, span.footnoteref a { text-decoration: none; }
span.footnote a:active, span.footnoteref a:active { text-decoration: underline; }

#footnotes { padding-top: 0.75em; padding-bottom: 0.75em; margin-bottom: 0.625em; }
#footnotes hr { width: 20%; min-width: 6.25em; margin: -.25em 0 .75em 0; border-width: 1px 0 0 0; }
#footnotes .footnote { padding: 0 0.375em; line-height: 1.3; font-size: 0.875em; margin-left: 1.2em; text-indent: -1.2em; margin-bottom: .2em; }
#footnotes .footnote a:first-of-type { font-weight: bold; text-decoration: none; }
#footnotes .footnote:last-of-type { margin-bottom: 0; }

#content #footnotes { margin-top: -0.625em; margin-bottom: 0; padding: 0.75em 0; }

.gist .file-data > table { border: 0; background: #fff; width: 100%; margin-bottom: 0; }
.gist .file-data > table td.line-data { width: 99%; }

div.unbreakable { page-break-inside: avoid; }

.big { font-size: larger; }

.small { font-size: smaller; }

.underline { text-decoration: underline; }

.overline { text-decoration: overline; }

.line-through { text-decoration: line-through; }

.aqua { color: #00bfbf; }

.aqua-background { background-color: #00fafa; }

.black { color: black; }

.black-background { background-color: black; }

.blue { color: #0000bf; }

.blue-background { background-color: #0000fa; }

.fuchsia { color: #bf00bf; }

.fuchsia-background { background-color: #fa00fa; }

.gray { color: #606060; }

.gray-background { background-color: #7d7d7d; }

.green { color: #006000; }

.green-background { background-color: #007d00; }

.lime { color: #00bf00; }

.lime-background { background-color: #00fa00; }

.maroon { color: #600000; }

.maroon-background { background-color: #7d0000; }

.navy { color: #000060; }

.navy-background { background-color: #00007d; }

.olive { color: #606000; }

.olive-background { background-color: #7d7d00; }

.purple { color: #600060; }

.purple-background { background-color: #7d007d; }

.red { color: #bf0000; }

.red-background { background-color: #fa0000; }

.silver { color: #909090; }

.silver-background { background-color: #bcbcbc; }

.teal { color: #006060; }

.teal-background { background-color: #007d7d; }

.white { color: #bfbfbf; }

.white-background { background-color: #fafafa; }

.yellow { color: #bfbf00; }

.yellow-background { background-color: #fafa00; }

span.icon > .fa { cursor: default; }

.admonitionblock td.icon [class^="fa icon-"] { font-size: 2.5em; text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.5); cursor: default; }
.admonitionblock td.icon .icon-note:before { content: "\f05a"; color: #207c98; }
.admonitionblock td.icon .icon-tip:before { content: "\f0eb"; text-shadow: 1px 1px 2px rgba(155, 155, 0, 0.8); color: #111; }
.admonitionblock td.icon .icon-warning:before { content: "\f071"; color: #bf6900; }
.admonitionblock td.icon .icon-caution:before { content: "\f06d"; color: #bf3400; }
.admonitionblock td.icon .icon-important:before { content: "\f06a"; color: #bf0000; }

.conum[data-value] { display: inline-block; color: #fff !important; background-color: #222222; -webkit-border-radius: 100px; border-radius: 100px; text-align: center; font-size: 0.75em; width: 1.67em; height: 1.67em; line-height: 1.67em; font-family: "Open Sans", "DejaVu Sans", sans-serif; font-style: normal; font-weight: bold; }
.conum[data-value] * { color: #fff !important; }
.conum[data-value] + b { display: none; }
.conum[data-value]:after { content: attr(data-value); }
pre .conum[data-value] { position: relative; top: -0.125em; }

b.conum * { color: inherit !important; }

.conum:not([data-value]):empty { display: none; }

.literalblock pre, .listingblock pre { background: #eeeeee; }

</style>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.2.0/css/font-awesome.min.css">
<style>.listingblock .pygments .hll { background-color: #ffffcc }
.listingblock .pygments  { background: #f8f8f8; }
.listingblock .pygments .tok-c { color: #408080; font-style: italic } /* Comment */
.listingblock .pygments .tok-err { border: 1px solid #FF0000 } /* Error */
.listingblock .pygments .tok-k { color: #008000; font-weight: bold } /* Keyword */
.listingblock .pygments .tok-o { color: #666666 } /* Operator */
.listingblock .pygments .tok-cm { color: #408080; font-style: italic } /* Comment.Multiline */
.listingblock .pygments .tok-cp { color: #BC7A00 } /* Comment.Preproc */
.listingblock .pygments .tok-c1 { color: #408080; font-style: italic } /* Comment.Single */
.listingblock .pygments .tok-cs { color: #408080; font-style: italic } /* Comment.Special */
.listingblock .pygments .tok-gd { color: #A00000 } /* Generic.Deleted */
.listingblock .pygments .tok-ge { font-style: italic } /* Generic.Emph */
.listingblock .pygments .tok-gr { color: #FF0000 } /* Generic.Error */
.listingblock .pygments .tok-gh { color: #000080; font-weight: bold } /* Generic.Heading */
.listingblock .pygments .tok-gi { color: #00A000 } /* Generic.Inserted */
.listingblock .pygments .tok-go { color: #888888 } /* Generic.Output */
.listingblock .pygments .tok-gp { color: #000080; font-weight: bold } /* Generic.Prompt */
.listingblock .pygments .tok-gs { font-weight: bold } /* Generic.Strong */
.listingblock .pygments .tok-gu { color: #800080; font-weight: bold } /* Generic.Subheading */
.listingblock .pygments .tok-gt { color: #0044DD } /* Generic.Traceback */
.listingblock .pygments .tok-kc { color: #008000; font-weight: bold } /* Keyword.Constant */
.listingblock .pygments .tok-kd { color: #008000; font-weight: bold } /* Keyword.Declaration */
.listingblock .pygments .tok-kn { color: #008000; font-weight: bold } /* Keyword.Namespace */
.listingblock .pygments .tok-kp { color: #008000 } /* Keyword.Pseudo */
.listingblock .pygments .tok-kr { color: #008000; font-weight: bold } /* Keyword.Reserved */
.listingblock .pygments .tok-kt { color: #B00040 } /* Keyword.Type */
.listingblock .pygments .tok-m { color: #666666 } /* Literal.Number */
.listingblock .pygments .tok-s { color: #BA2121 } /* Literal.String */
.listingblock .pygments .tok-na { color: #7D9029 } /* Name.Attribute */
.listingblock .pygments .tok-nb { color: #008000 } /* Name.Builtin */
.listingblock .pygments .tok-nc { color: #0000FF; font-weight: bold } /* Name.Class */
.listingblock .pygments .tok-no { color: #880000 } /* Name.Constant */
.listingblock .pygments .tok-nd { color: #AA22FF } /* Name.Decorator */
.listingblock .pygments .tok-ni { color: #999999; font-weight: bold } /* Name.Entity */
.listingblock .pygments .tok-ne { color: #D2413A; font-weight: bold } /* Name.Exception */
.listingblock .pygments .tok-nf { color: #0000FF } /* Name.Function */
.listingblock .pygments .tok-nl { color: #A0A000 } /* Name.Label */
.listingblock .pygments .tok-nn { color: #0000FF; font-weight: bold } /* Name.Namespace */
.listingblock .pygments .tok-nt { color: #008000; font-weight: bold } /* Name.Tag */
.listingblock .pygments .tok-nv { color: #19177C } /* Name.Variable */
.listingblock .pygments .tok-ow { color: #AA22FF; font-weight: bold } /* Operator.Word */
.listingblock .pygments .tok-w { color: #bbbbbb } /* Text.Whitespace */
.listingblock .pygments .tok-mb { color: #666666 } /* Literal.Number.Bin */
.listingblock .pygments .tok-mf { color: #666666 } /* Literal.Number.Float */
.listingblock .pygments .tok-mh { color: #666666 } /* Literal.Number.Hex */
.listingblock .pygments .tok-mi { color: #666666 } /* Literal.Number.Integer */
.listingblock .pygments .tok-mo { color: #666666 } /* Literal.Number.Oct */
.listingblock .pygments .tok-sb { color: #BA2121 } /* Literal.String.Backtick */
.listingblock .pygments .tok-sc { color: #BA2121 } /* Literal.String.Char */
.listingblock .pygments .tok-sd { color: #BA2121; font-style: italic } /* Literal.String.Doc */
.listingblock .pygments .tok-s2 { color: #BA2121 } /* Literal.String.Double */
.listingblock .pygments .tok-se { color: #BB6622; font-weight: bold } /* Literal.String.Escape */
.listingblock .pygments .tok-sh { color: #BA2121 } /* Literal.String.Heredoc */
.listingblock .pygments .tok-si { color: #BB6688; font-weight: bold } /* Literal.String.Interpol */
.listingblock .pygments .tok-sx { color: #008000 } /* Literal.String.Other */
.listingblock .pygments .tok-sr { color: #BB6688 } /* Literal.String.Regex */
.listingblock .pygments .tok-s1 { color: #BA2121 } /* Literal.String.Single */
.listingblock .pygments .tok-ss { color: #19177C } /* Literal.String.Symbol */
.listingblock .pygments .tok-bp { color: #008000 } /* Name.Builtin.Pseudo */
.listingblock .pygments .tok-vc { color: #19177C } /* Name.Variable.Class */
.listingblock .pygments .tok-vg { color: #19177C } /* Name.Variable.Global */
.listingblock .pygments .tok-vi { color: #19177C } /* Name.Variable.Instance */
.listingblock .pygments .tok-il { color: #666666 } /* Literal.Number.Integer.Long */
</style>
</head>
<body class="article toc2 toc-left">
<div id="header">
<h1>Componentes Web</h1>
<div class="details">
<span id="author" class="author">Miguel Angel Lozano</span><br>
<span id="email" class="email"><a href="mailto:malozano@ua.es">malozano@ua.es</a></span><br>
</div>
<div id="toc" class="toc2">
<div id="toctitle">Índice de contenidos</div>
<ul class="sectlevel1">
<li><a href="#sesion02">2. Procesamiento de peticiones</a>
<ul class="sectlevel2">
<li><a href="#_petici%C3%B3n_y_respuesta_http">2.1. Petición y respuesta HTTP</a>
<ul class="sectlevel3">
<li><a href="#_peticiones_del_cliente">2.1.1. Peticiones del cliente</a></li>
<li><a href="#_respuestas_del_servidor">2.1.2. Respuestas del servidor</a></li>
<li><a href="#_cabeceras">2.1.3. Cabeceras</a></li>
<li><a href="#_c%C3%B3digos_de_estado">2.1.4. Códigos de estado</a></li>
<li><a href="#_peticiones_httpservletrequest">2.1.5. Peticiones: HttpServletRequest</a></li>
<li><a href="#_respuestas_httpservletresponse">2.1.6. Respuestas: HttpServletResponse</a></li>
</ul>
</li>
<li><a href="#_procesamiento_de_peticiones_get_y_post">2.2. Procesamiento de peticiones GET y POST</a>
<ul class="sectlevel3">
<li><a href="#_procesamiento_secuencial_de_peticiones">2.2.1. Procesamiento secuencial de peticiones</a></li>
<li><a href="#_manejo_de_formularios">2.2.2. Manejo de formularios</a></li>
<li><a href="#_ejemplo">2.2.3. Ejemplo</a></li>
</ul>
</li>
<li><a href="#_cabeceras_y_c%C3%B3digos">2.3. Cabeceras y códigos</a>
<ul class="sectlevel3">
<li><a href="#_cabeceras_de_petici%C3%B3n">2.3.1. Cabeceras de petición</a></li>
<li><a href="#_cabeceras_de_respuesta">2.3.2. Cabeceras de respuesta</a></li>
<li><a href="#_variables_cgi">2.3.3. Variables CGI</a></li>
<li><a href="#_c%C3%B3digos_de_estado_http">2.3.4. Códigos de estado HTTP</a></li>
</ul>
</li>
<li><a href="#_procesamiento_as%C3%ADncrono">2.4. Procesamiento asíncrono</a>
<ul class="sectlevel3">
<li><a href="#_procesamiento_de_operaciones_de_larga_duraci%C3%B3n">2.4.1. Procesamiento de operaciones de larga duración</a></li>
<li><a href="#_entrada_y_salida_no_bloqueante">2.4.2. Entrada y salida no bloqueante</a></li>
</ul>
</li>
<li><a href="#_ejemplos">2.5. Ejemplos</a>
<ul class="sectlevel3">
<li><a href="#_ejemplo_de_cabeceras_de_petici%C3%B3n">2.5.1. Ejemplo de cabeceras de petición</a></li>
<li><a href="#_ejemplo_de_cabeceras_de_respuesta">2.5.2. Ejemplo de cabeceras de respuesta</a></li>
<li><a href="#_ejemplo_de_autentificaci%C3%B3n">2.5.3. Ejemplo de autentificación</a></li>
</ul>
</li>
<li><a href="#_ejercicios">2.6. Ejercicios</a>
<ul class="sectlevel3">
<li><a href="#_recogida_de_par%C3%A1metros_del_usuario_0_3_puntos">2.6.1. Recogida de parámetros del usuario (0,3 puntos)</a></li>
<li><a href="#_trabajando_con_redirecciones_0_4_puntos">2.6.2. Trabajando con redirecciones (0,4 puntos)</a></li>
<li><a href="#_un_buscador_sencillo_0_4_puntos">2.6.3. Un buscador sencillo (0,4 puntos)</a></li>
<li><a href="#_distinguir_el_navegador_0_3_puntos">2.6.4. Distinguir el navegador (0,3 puntos)</a></li>
<li><a href="#_redirecciones_con_retardo_0_3_puntos">2.6.5. Redirecciones con retardo (0,3 puntos)</a></li>
<li><a href="#_loggear_variables_cgi_0_3_puntos">2.6.6. Loggear variables CGI (0,3 puntos)</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
</div>
<div id="content">
<div id="preamble">
<div class="sectionbody">
<div style="page-break-after: always;"></div>
</div>
</div>
<div class="sect1">
<h2 id="sesion02">2. Procesamiento de peticiones</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Un servlet maneja peticiones de los clientes a través de su método <strong><code>service</code></strong>. Con él se pueden manejar peticiones HTTP (entre otras), reenviando las peticiones a los métodos apropiados que las manejan. Por ejemplo, una petición GET puede redirigirse a un método <code>doGet</code>. Veremos ahora los elementos principales que intervienen en una interacción vía HTTP.</p>
</div>
<div class="sect2">
<h3 id="_petición_y_respuesta_http">2.1. Petición y respuesta HTTP</h3>
<div class="sect3">
<h4 id="_peticiones_del_cliente">2.1.1. Peticiones del cliente</h4>
<div class="paragraph">
<p>En el protocolo HTTP el cliente realiza una <strong>petición</strong> que se descompone en:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Un comando HTTP, seguido de una dirección de documento o URI (<em>Uniform Resource Identifier</em>), y un número de versión HTTP, de forma que se tiene una línea con el formato:</p>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code>Comando    URI    Protocolo</code></pre>
</div>
</div>
<div class="paragraph">
<p>Por ejemplo:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code>GET   /index.html  HTTP/1.1</code></pre>
</div>
</div>
</li>
<li>
<p>Tras la petición, el cliente puede enviar información adicional de <strong>cabeceras</strong> (<em>headers</em>) con las que se da al servidor más información sobre la petición (tipo de software que ejecuta el cliente, tipo de contenido (<code>content-type</code>) que entiende el cliente, etc). Esta información puede utilizarla el servidor para generar la respuesta apropiada. Las cabeceras se envían una por línea, donde cada una tiene el formato:</p>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code>Clave: Valor</code></pre>
</div>
</div>
<div class="paragraph">
<p>Por ejemplo:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="http"><span class="tok-err">Accept-Encoding: gzip, deflate</span>
<span class="tok-err">User-Agent: Mozilla/4.0 (compatible;MSIE5.0;Windows 98)</span></code></pre>
</div>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>Tras las cabeceras, el cliente envía una línea en blanco (<code>\r\n\r\n</code>) para indicar el final de la sección de cabeceras.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Finalmente, de forma opcional, se pueden enviar <strong>datos adicionales</strong> si el comando HTTP solicitado lo requiere (por ejemplo, el método POST que veremos a continuación).</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><strong>METODO GET</strong></p>
</div>
<div class="paragraph">
<p>El comando <code>GET</code> permitía al principio solicitar al servidor un documento estático, existente en su espacio de direcciones. Luego se vio que esto no era suficiente, y se introdujo la posibilidad de solicitar búsquedas al servidor, de forma que el documento no tuviera que ser necesariamente estático, sino que la búsqueda estuviera condicionada por unos determinados parámetros. Así, el comando <code>GET</code> tiene la forma:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code>GET   direccion ? parametros   version HTTP</code></pre>
</div>
</div>
<div class="paragraph">
<p>Por ejemplo:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code>GET   /cgi-bin/pagina.cgi?IDIOMA=C&amp;MODELO=a+b  HTTP/1.1</code></pre>
</div>
</div>
<div class="paragraph">
<p>Los parámetros se indican con pares <em>nombre=valor</em>, separados por <code>'&amp;'</code>, y reciben el nombre de <strong>datos de formulario</strong>. El URI no puede contener espacios ni algunos caracteres, por lo que se utilizan códigos especiales, como el <code>+</code> para indicar espacio en blanco, u otros códigos <code>%XX</code> para representar otros caracteres. Uno de los trabajos más duros de los programas CGI es procesar esta cadena de parámetros para extraer la información necesaria.</p>
</div>
<div class="paragraph">
<p><strong>OTROS METODOS</strong></p>
</div>
<div class="paragraph">
<p>En la versión 1.1 de HTTP se definen otros métodos además de <code>GET</code>:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>OPTIONS</code>: para consultar al servidor acerca de las funcionalidades que proporciona</p>
</li>
<li>
<p><code>HEAD</code>: el servidor responde de forma idéntica a un comando <code>GET</code>, pero no devuelve el cuerpo del documento respuesta, sólo las cabeceras. Suele emplearse para comprobar características del documento.</p>
</li>
<li>
<p><code>POST</code>: se emplea para enviar al servidor un bloque de datos en el cuerpo de la petición</p>
</li>
<li>
<p><code>PUT</code>: solicita que el cuerpo de la petición que envía se almacene en el espacio de direcciones del servidor, con el identificador URI solicitado (guarda un documento en el servidor)</p>
</li>
<li>
<p><code>DELETE</code>: solicita borrar un documento específico del servidor</p>
</li>
<li>
<p><code>TRACE</code>: se utiliza para seguir el camino de la petición por múltiples servidores y proxies (útil para depurar problemas de red).</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><strong>GET Y POST</strong></p>
</div>
<div class="paragraph">
<p>Los dos métodos más comúnmente usados son <code>GET</code> y <code>POST</code>. Veremos las diferencias entre uno y otro con un ejemplo:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Un ejemplo de petición <code>GET</code> es:</p>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code>GET  /dir/cargaPagina.php?id=21&amp;nombre=Pepe  HTTP/1.1
&lt;cabeceras&gt;</code></pre>
</div>
</div>
</li>
<li>
<p>Este ejemplo, convertido a petición <code>POST</code> es:</p>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code>POST  /dir/cargaPagina.php  HTTP/1.1
&lt;cabeceras&gt;

id=21&amp;nombre=Pepe</code></pre>
</div>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>Vemos que los parámetros se pasan en el cuerpo de la petición, fuera de la línea del comando.</p>
</div>
<div class="paragraph">
<p>Comúnmente existen 3 formas de enviar una petición <code>GET</code>:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Teclear la petición directamente en la barra del navegador:</p>
<div class="paragraph">
<p><a href="http://www.xx.com/pag.html?id=123&amp;nombre=pepe" class="bare">http://www.xx.com/pag.html?id=123&amp;nombre=pepe</a></p>
</div>
</li>
<li>
<p>Colocar la petición en un enlace y pinchar el enlace para realizarla:</p>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="html"><span class="tok-nt">&lt;a</span> <span class="tok-na">href=</span><span class="tok-s">&quot;http://www.xx.com/pag.html?id=123&amp;nombre=pepe&quot;</span><span class="tok-nt">&gt;</span>Pulsa Aqui<span class="tok-nt">&lt;/a&gt;</span></code></pre>
</div>
</div>
</li>
<li>
<p>Enviar la petición tras rellenar un formulario con <code>method="get"</code> (o sin <code>method</code>) con los dos parámetros a enviar:</p>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="html"><span class="tok-nt">&lt;html&gt;</span>
<span class="tok-nt">&lt;body&gt;</span>
  <span class="tok-nt">&lt;form</span> <span class="tok-na">action=</span><span class="tok-s">&quot;http://www.xx.com/pag.html&quot;</span><span class="tok-nt">&gt;</span>
    <span class="tok-nt">&lt;input</span> <span class="tok-na">type=</span><span class="tok-s">&quot;text&quot;</span> <span class="tok-na">name=</span><span class="tok-s">&quot;id&quot;</span> <span class="tok-na">value=</span><span class="tok-s">&quot;123&quot;</span><span class="tok-nt">&gt;</span>
    <span class="tok-nt">&lt;input</span> <span class="tok-na">type=</span><span class="tok-s">&quot;text&quot;</span> <span class="tok-na">name=</span><span class="tok-s">&quot;nombre&quot;</span> <span class="tok-na">value=</span><span class="tok-s">&quot;pepe&quot;</span><span class="tok-nt">&gt;</span>
    <span class="tok-nt">&lt;input</span> <span class="tok-na">type=</span><span class="tok-s">&quot;submit&quot;</span> <span class="tok-na">value=</span><span class="tok-s">&quot;Enviar&quot;</span><span class="tok-nt">&gt;</span>
  <span class="tok-nt">&lt;/form&gt;</span>
<span class="tok-nt">&lt;/body&gt;</span>
<span class="tok-nt">&lt;/html&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Para enviar una petición POST, normalmente se utiliza un formulario con <code>method="post"</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="html"><span class="tok-nt">&lt;html&gt;</span>
<span class="tok-nt">&lt;body&gt;</span>
  <span class="tok-nt">&lt;form</span> <span class="tok-na">action=</span><span class="tok-s">&quot;http://www.xx.com/pag.html&quot;</span> <span class="tok-na">METHOD=</span><span class="tok-s">POST</span><span class="tok-nt">&gt;</span>
    <span class="tok-nt">&lt;input</span> <span class="tok-na">type=</span><span class="tok-s">&quot;text&quot;</span> <span class="tok-na">name=</span><span class="tok-s">&quot;id&quot;</span> <span class="tok-na">value=</span><span class="tok-s">&quot;123&quot;</span><span class="tok-nt">&gt;</span>
    <span class="tok-nt">&lt;input</span> <span class="tok-na">type=</span><span class="tok-s">&quot;text&quot;</span> <span class="tok-na">name=</span><span class="tok-s">&quot;nombre&quot;</span> <span class="tok-na">value=</span><span class="tok-s">&quot;pepe&quot;</span><span class="tok-nt">&gt;</span>
    <span class="tok-nt">&lt;input</span> <span class="tok-na">type=</span><span class="tok-s">&quot;submit&quot;</span> <span class="tok-na">value=</span><span class="tok-s">&quot;Enviar&quot;</span><span class="tok-nt">&gt;</span>
  <span class="tok-nt">&lt;/form&gt;</span>
<span class="tok-nt">&lt;/body&gt;</span>
<span class="tok-nt">&lt;/html&gt;</span></code></pre>
</div>
</div>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_respuestas_del_servidor">2.1.2. Respuestas del servidor</h4>
<div class="paragraph">
<p>Las respuestas del servidor también tienen tres partes:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Una <strong>línea de estado</strong> con la versión del protocolo HTTP utilizado en el servidor, un código de estado y una breve descripción del mismo:</p>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code>HTTP/1.0  200  OK</code></pre>
</div>
</div>
</li>
<li>
<p>Información de <strong>cabeceras</strong>, donde se envía al cliente información sobre el servidor y sobre el documento solicitado. El formato de estas cabeceras es el mismo que el visto para las peticiones del cliente, terminando en una línea en blanco.</p>
</li>
<li>
<p>Finalmente, se envía el <strong>documento solicitado</strong>. Para marcar el final del mismo se envía también otra línea en blanco.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_cabeceras">2.1.3. Cabeceras</h4>
<div class="paragraph">
<p>Vamos a poder implementar programas que lean las cabeceras que envía un cliente (un navegador, por ejemplo) y que modifiquen el documento servido en función de dichas cabeceras (por ejemplo, enviar una página en función del idioma que se especifique). Por otra parte, podremos utilizar las cabeceras que envíe el servidor como respuesta para obligar al navegador a hacer determinadas acciones, como saltar a otra URL.
Veremos a continuación las cabeceras más comunes tanto en las peticiones de los clientes como en las respuestas de los servidores. La RFC donde se especifican estas cabeceras es la 2616.</p>
</div>
<div class="paragraph">
<p><strong>CABECERAS DE PETICION (HTTP/1.1)</strong></p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Accept</strong>: Tipos MIME que puede manejar el cliente</p>
</li>
<li>
<p><strong>Accept-Charset</strong>: Conjunto de caracteres que el cliente puede manejar</p>
</li>
<li>
<p><strong>Accept-Encoding</strong>: Define si el navegador puede aceptar datos codificados</p>
</li>
<li>
<p><strong>Accept-Language</strong>: Idiomas aceptados</p>
</li>
<li>
<p><strong>Authorization</strong>: Para identificarse cuando se accede a páginas protegidas</p>
</li>
<li>
<p><strong>Cache-Control</strong>: Opciones relacionadas con el servidor proxy. Esta cabecera se llamaba <em>Pragma</em> en HTTP 1.0</p>
</li>
<li>
<p><strong>Connection</strong>: Define si el cliente es capaz de realizar conexiones persistentes (<em>keep-alive</em>, valor por defecto), o no (<em>close</em>). Nueva en HTTP 1.1</p>
</li>
<li>
<p><strong>Content-Length</strong>: Longitud de los datos enviados. Aplicable a peticiones <code>POST</code></p>
</li>
<li>
<p><strong>Content-Type</strong>: Tipo MIME de los datos enviados. Aplicable a peticiones <code>POST</code></p>
</li>
<li>
<p><strong>Cookie</strong>: Para las cookies que se manejen</p>
</li>
<li>
<p><strong>From</strong>: Dirección de correo electrónico responsable de la petición</p>
</li>
<li>
<p><strong>Host</strong>: Unica cabecera requerida por HTTP 1.1. Indica el host y el puerto tal y como se especifica en la URL original.</p>
</li>
<li>
<p><strong>If-Modified-Since</strong>: El cliente sólo desea el documento si ha sido modificado después de la fecha indicada en esta cabecera.</p>
</li>
<li>
<p><strong>Referer</strong>: URL origen de la petición. Si estamos en la página 1 y pinchamos en un enlace a la página 2, la URL de la página 1 se incluye en esta cabecera cuando se realiza la petición de la página 2.</p>
</li>
<li>
<p><strong>User-Agent</strong>: Cliente que está realizando la petición (normalmente muestra datos del navegador, como nombre, etc).</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><strong>CABECERAS DE RESPUESTA</strong></p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Allow</strong>: Métodos disponibles (<code>GET</code>, <code>POST</code>, etc) a los que puede responder el recurso que se está solicitando</p>
</li>
<li>
<p><strong>Cache-Control</strong>: Dice al cliente en qué circunstancias puede hacer una caché del documento que está sirviendo:</p>
<div class="ulist">
<ul>
<li>
<p><code>public</code>: el documento puede almacenarse en una caché</p>
</li>
<li>
<p><code>private</code>: el documento es para un solo usuario y sólo puede almacenarse en una caché privada (no compartida)</p>
</li>
<li>
<p><code>no-cache</code>: el documento nunca debe ser almacenado en caché</p>
</li>
<li>
<p><code>no-store</code>: el documento no debe almacenarse en caché ni almacenarse localmente de forma temporal en el disco duro</p>
</li>
<li>
<p><code>must-revalidate</code>: el cliente debe revalidar la copia del documento con el servidor original, no con servidores proxy intermedios, cada vez que se use</p>
</li>
<li>
<p><code>max-age=xxx</code>: el documento debe considerarse caducado después de <em>xxx</em> segundos.</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>Esta cabecera se llamaba <code>Pragma</code> en HTTP 1.0</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Content-Encoding</strong>: Tipo de compresión (<em>gzip</em>, etc) en que se devuelve el documento solicitado</p>
</li>
<li>
<p><strong>Content-Language</strong>: Idioma en que está escrito el documento. En la RFC 1766 están los idiomas disponibles</p>
</li>
<li>
<p><strong>Content-Length</strong>: Número de bytes de la respuesta</p>
</li>
<li>
<p><strong>Content-MD5</strong>: Una forma de fijar el <em>checksum</em> (verificación de integridad) del documento enviado</p>
</li>
<li>
<p><strong>Content-Type</strong>: Tipo MIME de la respuesta</p>
</li>
<li>
<p><strong>Date</strong>: Hora y fecha, en formato GMT, en que la respuesta ha sido generada</p>
</li>
<li>
<p><strong>Expires</strong>: Hora y fecha, en formato GMT, en que la respuesta debe considerarse caducada</p>
</li>
<li>
<p><strong>Last-Modified</strong>: Fecha en que el documento servido se modificó por última vez. Con esto, el documento se sirve sólo si su <code>Last-Modified</code> es mayor que la fecha indicada en el <code>If-Modified-Since</code> de la cabecera del cliente.</p>
</li>
<li>
<p><strong>Location</strong>: Indica la nueva URL donde encontrar el documento. Debe usarse con un código de estado de tipo 300. El navegador se redirigirá automáticamente a la dirección indicada en esta cabecera.</p>
</li>
<li>
<p><strong>Refresh</strong>: Indica al cliente que debe recargar la página después de los segundos especificados. También puede indicarse la dirección de la página a cargar después de los segundos indicados:</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code>Refresh: 5; URL=http://www.unapagina.com</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Set-Cookie</strong>: Especifica una cookie asociada a la página</p>
</li>
<li>
<p><strong>WWW-Authenticate</strong>: Tipo de autorización y dominio que debería indicar el cliente en su cabecera <code>Authorization</code>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Para colocar estas cabeceras en un documento se tienen varios métodos, dependiendo de cómo estemos tratando las páginas (mediante servlets, HTML, etc). Por ejemplo, con HTML podemos enviar cabeceras mediante etiquetas <code>META</code> en la cabecera (<code>&lt;HEAD&gt;</code>) de la página HTML:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><span class="tok-nt">&lt;META</span> <span class="tok-na">HTTP-EQUIV=</span><span class="tok-s">&quot;Cabecera&quot;</span> <span class="tok-na">CONTENT=</span><span class="tok-s">&quot;Valor&quot;</span><span class="tok-nt">&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Por ejemplo:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><span class="tok-nt">&lt;META</span> <span class="tok-na">HTTP-EQUIV=</span><span class="tok-s">&quot;Location&quot;</span> <span class="tok-na">CONTENT=</span><span class="tok-s">&quot;http://www.unapagina.com&quot;</span><span class="tok-nt">&gt;</span></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_códigos_de_estado">2.1.4. Códigos de estado</h4>
<div class="paragraph">
<p>El código de estado que un servidor devuelve a un cliente en una petición indica el resultado de dicha petición. Se tiene una descripción completa de los mismos en el RFC 2616. Están agrupados en 5 categorías:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>100 - 199</strong>: códigos de información, indicando que el cliente debe responder con alguna otra acción.</p>
</li>
<li>
<p><strong>200 - 299</strong>: códigos de aceptación de petición. Por ejemplo:</p>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 16%;">
<col style="width: 33%;">
<col style="width: 50%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>200</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>OK</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Todo está bien</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>204</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>No Content</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No hay documento nuevo</p></td>
</tr>
</tbody>
</table>
</li>
<li>
<p><strong>300 - 399</strong>: códigos de redirección. Indican que el documento solicitado ha sido movido a otra URL. Por ejemplo:</p>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 16%;">
<col style="width: 33%;">
<col style="width: 50%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>301</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Moved Permanently</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">El documento está en otro lugar, indicado en la cabecera <em>Location</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>302</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Found</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Como el anterior, pero la nueva URL es temporal, no permanente.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>304</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Not Modified</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">El documento pedido no ha sufrido cambios con respecto al actual (para cabeceras <code>If-Modified-Since</code>)</p></td>
</tr>
</tbody>
</table>
</li>
<li>
<p><strong>400 - 499</strong>: códigos de error del cliente. Por ejemplo:</p>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 16%;">
<col style="width: 33%;">
<col style="width: 50%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>400</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Bad Request</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Mala sintaxis en la petición</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>401</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Unauthorized</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">El cliente no tiene permiso para acceder a la página. Se debería devolver una cabecera <code>WWW-Authenticate</code> para que el usuario introduzca login y password</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>403</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Forbidden</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">El recurso no está disponible</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>404</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Not Found</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No se pudo encontrar el recurso</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>408</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Request Timeout</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">El cliente tarda demasiado en enviar la petición</p></td>
</tr>
</tbody>
</table>
</li>
<li>
<p><strong>500 - 599</strong>: códigos de error del servidor. Por ejemplo:</p>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 16%;">
<col style="width: 33%;">
<col style="width: 50%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>500</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Internal Server Error</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Error en el servidor</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>501</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Not Implemented</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">El servidor no soporta la petición realizada</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>504</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Gateway Timeout</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Usado por servidores que actúan como proxies o gateways, indica que el servidor no obtuvo una respuesta a tiempo de un servidor remoto</p></td>
</tr>
</tbody>
</table>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_peticiones_httpservletrequest">2.1.5. Peticiones: HttpServletRequest</h4>
<div class="paragraph">
<p>Como hemos visto anteriormente, los objetos <strong><code>ServletRequest</code></strong> se emplean para obtener información sobre la petición de los clientes. Más en concreto, el subtipo <code>HttpServletRequest</code> se utiliza en las peticiones HTTP. Proporciona acceso a los datos de las cabeceras HTTP, cookies, parámetros pasados por el usuario, etc, sin tener que parsear nosotros a mano los datos de formulario de la petición.
La clase dispone de muchos métodos, pero destacamos los siguientes:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Para <strong>obtener los valores de los parámetros</strong> pasados por el cliente, se tienen los métodos:</p>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span class="tok-n">Enumeration</span> <span class="tok-nf">getParameterNames</span><span class="tok-o">()</span>
<span class="tok-n">String</span>      <span class="tok-nf">getParameter</span> <span class="tok-o">(</span><span class="tok-n">String</span> <span class="tok-n">nombre</span><span class="tok-o">)</span>
<span class="tok-n">String</span><span class="tok-o">[]</span>    <span class="tok-nf">getParameterValues</span> <span class="tok-o">(</span><span class="tok-n">String</span> <span class="tok-n">nombre</span><span class="tok-o">)</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Con <strong><code>getParameterNames()</code></strong> se obtiene una lista con los nombres de los parámetros enviados por el cliente. Con <strong><code>getParameter()</code></strong> se obtiene el valor del parámetro de nombre <code>nombre</code>. Si un parámetro tiene varios valores (por ejemplo, si tenemos un array de cuadros de texto con el mismo nombre en un formulario), se pueden obtener todos separados con <strong><code>getParameterValues()</code></strong>. Los nombres de los parámetros normalmente sí distinguen mayúsculas de minúsculas, deberemos tener cuidado al indicarlos.</p>
</div>
</li>
<li>
<p>Para <strong>obtener la cadena de una petición GET</strong>, se tiene el método:</p>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span class="tok-n">String</span> <span class="tok-nf">getQueryString</span><span class="tok-o">()</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>que devuelve todos los parámetros de la petición en una cadena, que deberemos parsear nosotros como nos convenga.</p>
</div>
</li>
<li>
<p>Para <strong>obtener datos de peticiones POST, PUT o DELETE</strong>, se tienen los métodos:</p>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span class="tok-n">BufferedReader</span>     <span class="tok-nf">getReader</span><span class="tok-o">()</span>
<span class="tok-n">ServletInputStream</span> <span class="tok-nf">getInputStream</span><span class="tok-o">()</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Con <strong><code>getReader()</code></strong> se obtiene un <code>BufferedReader</code> para peticiones donde esperemos recibir texto. Si esperamos recibir datos binarios, se debe emplear <strong><code>getInputStream()</code></strong>. Si lo que esperamos recibir son parámetros por POST igual que se haría por GET, es mejor utilizar los métodos <code>getParameterXXXX(&#8230;&#8203;)</code> vistos antes.</p>
</div>
</li>
<li>
<p>Para <strong>obtener información sobre la línea de petición</strong>, se tienen los métodos:</p>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span class="tok-n">String</span> <span class="tok-nf">getMethod</span><span class="tok-o">()</span>
<span class="tok-n">String</span> <span class="tok-nf">getRequestURI</span><span class="tok-o">()</span>
<span class="tok-n">String</span> <span class="tok-nf">getProtocol</span><span class="tok-o">()</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Con <strong><code>getMethod()</code></strong> obtenemos el comando HTTP solicitado (GET, POST, PUT, etc), con <strong><code>getRequestURI()</code></strong> obtenemos la parte de la URL de petición que está detrás del <code>host</code> y el puerto, pero antes de los datos del formulario. Con <strong><code>getProtocol()</code></strong> obtenemos el protocolo empleado (<code>HTTP/1.1</code>, <code>HTTP/1.0</code>, etc).</p>
</div>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_respuestas_httpservletresponse">2.1.6. Respuestas: HttpServletResponse</h4>
<div class="paragraph">
<p>Los objetos <code>ServletResponse</code> se emplean para enviar el resultado de procesar una petición a un cliente. El subtipo <code>HttpServletResponse</code> se utiliza en las peticiones HTTP. Proporciona acceso al canal de salida por donde enviar la respuesta al cliente.</p>
</div>
<div class="paragraph">
<p>La clase dispone de muchos métodos, pero destacamos:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span class="tok-n">Writer</span>              <span class="tok-nf">getWriter</span><span class="tok-o">()</span>
<span class="tok-n">ServletOutputStream</span> <span class="tok-nf">getOutputStream</span><span class="tok-o">()</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Con <strong><code>getWriter()</code></strong> se obtiene un <code>Writer</code> para enviar texto al cliente. Si queremos enviar datos binarios, se debe emplear <strong><code>getOutputStream()</code></strong>.
Si queremos especificar información de cabecera, debemos establecerla ANTES de obtener el <code>Writer</code> o el <code>ServletOutputStream</code>. Hemos visto en algún ejemplo el método <strong><code>setContentType()</code></strong> para indicar el tipo de contenido. Veremos las cabeceras con más detenimiento más adelante.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_procesamiento_de_peticiones_get_y_post">2.2. Procesamiento de peticiones GET y POST</h3>
<div class="paragraph">
<p>Como se ha visto anteriormente, el método <strong><code>doGet()</code></strong> se emplea para procesar peticiones GET. Para realizar nuestro propio procesamiento de petición, simplemente sobreescribimos este método en el servlet:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span class="tok-kd">public</span> <span class="tok-kt">void</span> <span class="tok-nf">doGet</span><span class="tok-o">(</span><span class="tok-n">HttpServletRequest</span> <span class="tok-n">request</span><span class="tok-o">,</span>
                  <span class="tok-n">HttpServletResponse</span> <span class="tok-n">response</span><span class="tok-o">)</span>
               <span class="tok-kd">throws</span> <span class="tok-n">ServletException</span><span class="tok-o">,</span> <span class="tok-n">IOException</span> <span class="tok-o">{</span>
  <span class="tok-c1">// ... codigo para una peticion GET</span>
<span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Podemos utilizar los métodos del objeto <code>HttpServletRequest</code> vistos antes. Así podremos, entre otras cosas:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Acceder a elementos de la petición, como valores de parámetros:</p>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span class="tok-n">String</span> <span class="tok-n">nombreUsuario</span> <span class="tok-o">=</span> <span class="tok-n">request</span><span class="tok-o">.</span><span class="tok-na">getParameter</span><span class="tok-o">(</span><span class="tok-s">&quot;nombre&quot;</span><span class="tok-o">);</span></code></pre>
</div>
</div>
</li>
<li>
<p>Acceder a los parámetros en la cadena de la petición y procesarlos como queramos:</p>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span class="tok-n">String</span> <span class="tok-n">query</span> <span class="tok-o">=</span> <span class="tok-n">request</span><span class="tok-o">.</span><span class="tok-na">getQueryString</span><span class="tok-o">();</span>
<span class="tok-o">...</span></code></pre>
</div>
</div>
</li>
<li>
<p>Obtener un canal de entrada (<code>Reader</code> o <code>InputStream</code>) con que leer los datos de la petición:</p>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span class="tok-n">BufferedReader</span> <span class="tok-n">r</span> <span class="tok-o">=</span> <span class="tok-n">request</span><span class="tok-o">.</span><span class="tok-na">getReader</span><span class="tok-o">();</span>
<span class="tok-o">...</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Esta, sin embargo, no es una buena idea para tomar parámetros de peticiones u otras cosas. Se suele emplear sobre todo para transferencias de ficheros, pero hay que tener en cuenta que si obtenemos un canal de entrada, luego no podremos obtener parámetros u otros valores con métodos <code>getParameter()</code> y similares.</p>
</div>
</li>
<li>
<p>etc.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>También podemos utilizar los métodos del objeto <code>HttpServletResponse</code> para, entre otras cosas:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Establecer valores de la cabecera (antes que cualquier otra acción sobre la respuesta):</p>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span class="tok-n">response</span><span class="tok-o">.</span><span class="tok-na">setContentType</span><span class="tok-o">(</span><span class="tok-s">&quot;text/html&quot;</span><span class="tok-o">);</span></code></pre>
</div>
</div>
</li>
<li>
<p>Obtener el canal de salida por el que enviar la respuesta:</p>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span class="tok-n">PrintWriter</span> <span class="tok-n">out</span> <span class="tok-o">=</span> <span class="tok-n">response</span><span class="tok-o">.</span><span class="tok-na">getWriter</span><span class="tok-o">();</span>
<span class="tok-n">out</span><span class="tok-o">.</span><span class="tok-na">println</span> <span class="tok-o">(</span><span class="tok-s">&quot;Enviando al cliente&quot;</span><span class="tok-o">);</span></code></pre>
</div>
</div>
</li>
<li>
<p>Redirigir a otra página:</p>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span class="tok-n">response</span><span class="tok-o">.</span><span class="tok-na">sendRedirect</span><span class="tok-o">(</span><span class="tok-s">&quot;http://localhost:8080/pag.html&quot;</span><span class="tok-o">);</span></code></pre>
</div>
</div>
</li>
<li>
<p>etc.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>De forma similar, el método <strong><code>doPost()</code></strong>, se emplea para procesar peticiones POST. Igual que antes, debemos sobreescribir este método para definir nuestro propio procesamiento de la petición:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span class="tok-kd">public</span> <span class="tok-kt">void</span> <span class="tok-nf">doPost</span><span class="tok-o">(</span><span class="tok-n">HttpServletRequest</span> <span class="tok-n">request</span><span class="tok-o">,</span>
                   <span class="tok-n">HttpServletResponse</span> <span class="tok-n">response</span><span class="tok-o">)</span>
               <span class="tok-kd">throws</span> <span class="tok-n">ServletException</span><span class="tok-o">,</span> <span class="tok-n">IOException</span> <span class="tok-o">{</span>
  <span class="tok-c1">// ... codigo para una peticion POST</span>
<span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Las posibilidades de los parámetros <code>HttpServletRequest</code> y <code>HttpServletResponse</code> son las mismas que para GET. Normalmente muchos servlets definen el mismo código para uno y otro método (hacen que <code>doPost()</code> llame a <code>doGet()</code> y definen allí el código, o al revés), pero conviene tenerlos separados para poder tratar independientemente uno y otro tipo de peticiones si se quiere.</p>
</div>
<div class="sect3">
<h4 id="_procesamiento_secuencial_de_peticiones">2.2.1. Procesamiento secuencial de peticiones</h4>
<div class="paragraph">
<p>Los servlets pueden gestionar múltiples peticiones de clientes concurrentemente. <strong>Por cada petición se crea un hilo</strong> que se ejecuta sobre el código del servlet al que se ha accedido. Si existen varias peticiones concurrentes tendremos varios hilos ejecutándose sobre un mismo objeto servlet. Esto podría ocasionar problemas de concurrencia por ejemplo si estuviésemos utilizando variables de instancia de la clase del servlet. Por este motivo deberemos evitar esta práctica cuando implementemos servlets.</p>
</div>
<div class="paragraph">
<p>Pero puede suceder que en determinado momento necesitemos acceder a cierto recurso compartido, y no nos interese que varios clientes accedan a dicho recurso simultáneamente. Para solucionar este problema, podemos definir bloques de código <code>synchronized</code>, o bien hacer que el servlet sólo atienda una petición cada vez.</p>
</div>
<div class="paragraph">
<p>Para esto último lo único que hay que hacer es que el servlet, además de heredar de <code>HttpServlet</code>, implemente la interfaz <code>SingleThreadModel</code>. Esto no supone definir más métodos, simplemente añadimos el <code>implements</code> necesario al definir la clase Servlet:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span class="tok-kd">public</span> <span class="tok-kd">class</span> <span class="tok-nc">MiServlet</span> <span class="tok-kd">extends</span> <span class="tok-n">HttpServlet</span>
                       <span class="tok-kd">implements</span> <span class="tok-n">SingleThreadModel</span> <span class="tok-o">{</span>
  <span class="tok-o">...</span>
<span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Esta es una práctica que deberemos evitar siempre que sea posible, ya que genera un cuello de botella en nuestra aplicación y no siempre evita los problemas de concurrencia (por ejemplo si accedemos a recursos compartidos por varios servlets). Por este motivo este mecanismo ha quedado <em>desaprobado</em> y en su lugar se recomienda evitar el uso de variables de instancia en servlets, y sincronizar los bloques concretos de código que pudiesen provocar problemas de concurrencia.</p>
</div>
<div class="paragraph">
<p>Lo más importante es ser consciente de que varios hilos ejecutarán de forma concurrente el código de nuestros servlets y tomar las precauciones oportunas.</p>
</div>
</div>
<div class="sect3">
<h4 id="_manejo_de_formularios">2.2.2. Manejo de formularios</h4>
<div class="paragraph">
<p>Los datos que se envían como parámetros en una petición (tras el interrogante si es una petición GET, o por otro lado si es POST) se llaman <strong>datos de formulario</strong>. Una vez enviados estos datos como petición, ¿cómo se extraen en el servidor?</p>
</div>
<div class="paragraph">
<p>Si trabajáramos con CGI, los datos se tomarían de forma distinta si fuese una petición GET o una POST. Para una GET, por ejemplo, tendríamos que tomar la cadena tras la interrogación, y parsearla convenientemente, separando los bloques entre <code>&amp;</code>, y luego separando el nombre del parámetro de su valor a partir del <code>=</code>. También hay que descodificar los valores: los alfanuméricos no cambian, pero los espacios se han convertido previamente en <code>+</code>, y otros caracteres se convierten en <code>%XX%</code>.</p>
</div>
<div class="paragraph">
<p>Con servlets todo este análisis se realiza de forma automática. La clase <code>HttpServletRequest</code> dispone de métodos que devuelven la información que nos interesa ya procesada, e independientemente de si es una petición GET o POST. Hemos visto antes los métodos:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span class="tok-n">Enumeration</span> <span class="tok-nf">getParameterNames</span><span class="tok-o">()</span>
<span class="tok-n">String</span>      <span class="tok-nf">getParameter</span> <span class="tok-o">(</span><span class="tok-n">String</span> <span class="tok-n">nombre</span><span class="tok-o">)</span>
<span class="tok-n">String</span><span class="tok-o">[]</span>    <span class="tok-nf">getParameterValues</span> <span class="tok-o">(</span><span class="tok-n">String</span> <span class="tok-n">nombre</span><span class="tok-o">)</span></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_ejemplo">2.2.3. Ejemplo</h4>
<div class="paragraph">
<p>Veamos un ejemplo, supongamos que tenemos este formulario:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><span class="tok-nt">&lt;html&gt;</span>
<span class="tok-nt">&lt;body&gt;</span>
<span class="tok-nt">&lt;form</span> <span class="tok-na">action=</span><span class="tok-s">&quot;/appforms/servlet/ejemplos.ServletForm&quot;</span><span class="tok-nt">&gt;</span>
  Valor 1: <span class="tok-nt">&lt;input</span> <span class="tok-na">type=</span><span class="tok-s">&quot;text&quot;</span> <span class="tok-na">name=</span><span class="tok-s">&quot;texto1&quot;</span><span class="tok-nt">&gt;</span>
  <span class="tok-nt">&lt;br&gt;</span>
  Valor2:
  <span class="tok-nt">&lt;select</span> <span class="tok-na">name=</span><span class="tok-s">&quot;lista&quot;</span><span class="tok-nt">&gt;</span>
  <span class="tok-nt">&lt;option</span> <span class="tok-na">name=</span><span class="tok-s">&quot;lista&quot;</span> <span class="tok-na">value=</span><span class="tok-s">&quot;Opcion 1&quot;</span><span class="tok-nt">&gt;</span>Opcion 1<span class="tok-nt">&lt;/option&gt;</span>
  <span class="tok-nt">&lt;option</span> <span class="tok-na">name=</span><span class="tok-s">&quot;lista&quot;</span> <span class="tok-na">value=</span><span class="tok-s">&quot;Opcion 2&quot;</span><span class="tok-nt">&gt;</span>Opcion 2<span class="tok-nt">&lt;/option&gt;</span>
  <span class="tok-nt">&lt;option</span> <span class="tok-na">name=</span><span class="tok-s">&quot;lista&quot;</span> <span class="tok-na">value=</span><span class="tok-s">&quot;Opcion 3&quot;</span><span class="tok-nt">&gt;</span>Opcion 3<span class="tok-nt">&lt;/option&gt;</span>
  <span class="tok-nt">&lt;/select&gt;</span>
  <span class="tok-nt">&lt;br&gt;</span>
  Valores 3:
  <span class="tok-nt">&lt;br&gt;</span>
  <span class="tok-nt">&lt;input</span> <span class="tok-na">type=</span><span class="tok-s">&quot;text&quot;</span> <span class="tok-na">name=</span><span class="tok-s">&quot;texto2&quot;</span><span class="tok-nt">&gt;</span>
  <span class="tok-nt">&lt;input</span> <span class="tok-na">type=</span><span class="tok-s">&quot;text&quot;</span> <span class="tok-na">name=</span><span class="tok-s">&quot;texto2&quot;</span><span class="tok-nt">&gt;</span>
  <span class="tok-nt">&lt;input</span> <span class="tok-na">type=</span><span class="tok-s">&quot;text&quot;</span> <span class="tok-na">name=</span><span class="tok-s">&quot;texto2&quot;</span><span class="tok-nt">&gt;</span>

  <span class="tok-nt">&lt;input</span> <span class="tok-na">type=</span><span class="tok-s">&quot;submit&quot;</span> <span class="tok-na">value=</span><span class="tok-s">&quot;Enviar&quot;</span><span class="tok-nt">&gt;</span>
<span class="tok-nt">&lt;/form&gt;</span>
<span class="tok-nt">&lt;/body&gt;</span>
<span class="tok-nt">&lt;/html&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Al validarlo se llama al servlet <code>ServletForm</code>, que muestra una página HTML con los valores introducidos en los parámetros del formulario:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span class="tok-kn">package</span> <span class="tok-n">ejemplos</span><span class="tok-o">;</span>

<span class="tok-kn">import</span> <span class="tok-nn">java.io.*</span><span class="tok-o">;</span>
<span class="tok-kn">import</span> <span class="tok-nn">javax.servlet.*</span><span class="tok-o">;</span>
<span class="tok-kn">import</span> <span class="tok-nn">javax.servlet.http.*</span><span class="tok-o">;</span>

<span class="tok-kd">public</span> <span class="tok-kd">class</span> <span class="tok-nc">ServletForm</span> <span class="tok-kd">extends</span> <span class="tok-n">HttpServlet</span>
<span class="tok-o">{</span>
  <span class="tok-c1">// Metodo para GET</span>

  <span class="tok-kd">public</span> <span class="tok-kt">void</span> <span class="tok-nf">doGet</span><span class="tok-o">(</span><span class="tok-n">HttpServletRequest</span> <span class="tok-n">request</span><span class="tok-o">,</span>
                    <span class="tok-n">HttpServletResponse</span> <span class="tok-n">response</span><span class="tok-o">)</span>
                 <span class="tok-kd">throws</span> <span class="tok-n">ServletException</span><span class="tok-o">,</span> <span class="tok-n">IOException</span> <span class="tok-o">{</span>
    <span class="tok-n">response</span><span class="tok-o">.</span><span class="tok-na">setContentType</span><span class="tok-o">(</span><span class="tok-s">&quot;text/html&quot;</span><span class="tok-o">);</span>

    <span class="tok-n">PrintWriter</span> <span class="tok-n">out</span> <span class="tok-o">=</span> <span class="tok-n">response</span><span class="tok-o">.</span><span class="tok-na">getWriter</span><span class="tok-o">();</span>

    <span class="tok-c1">// Mostramos los datos del formulario</span>

    <span class="tok-n">out</span><span class="tok-o">.</span><span class="tok-na">println</span> <span class="tok-o">(</span><span class="tok-s">&quot;&lt;HTML&gt;&quot;</span><span class="tok-o">);</span>
    <span class="tok-n">out</span><span class="tok-o">.</span><span class="tok-na">println</span> <span class="tok-o">(</span><span class="tok-s">&quot;&lt;BODY&gt;&quot;</span><span class="tok-o">);</span>
    <span class="tok-n">out</span><span class="tok-o">.</span><span class="tok-na">println</span> <span class="tok-o">(</span><span class="tok-s">&quot;&lt;H1&gt;Datos del formulario&lt;/H1&gt;&quot;</span><span class="tok-o">);</span>
    <span class="tok-n">out</span><span class="tok-o">.</span><span class="tok-na">println</span> <span class="tok-o">(</span><span class="tok-s">&quot;&lt;BR&gt;&quot;</span><span class="tok-o">);</span>

    <span class="tok-n">String</span> <span class="tok-n">valor1</span> <span class="tok-o">=</span>
      <span class="tok-n">request</span><span class="tok-o">.</span><span class="tok-na">getParameter</span><span class="tok-o">(</span><span class="tok-s">&quot;texto1&quot;</span><span class="tok-o">);</span>
    <span class="tok-n">String</span> <span class="tok-n">valor2</span> <span class="tok-o">=</span>
      <span class="tok-n">request</span><span class="tok-o">.</span><span class="tok-na">getParameter</span><span class="tok-o">(</span><span class="tok-s">&quot;lista&quot;</span><span class="tok-o">);</span>
    <span class="tok-n">String</span><span class="tok-o">[]</span> <span class="tok-n">valor3</span> <span class="tok-o">=</span>
      <span class="tok-n">request</span><span class="tok-o">.</span><span class="tok-na">getParameterValues</span><span class="tok-o">(</span><span class="tok-s">&quot;texto2&quot;</span><span class="tok-o">);</span>

    <span class="tok-n">out</span><span class="tok-o">.</span><span class="tok-na">println</span> <span class="tok-o">(</span><span class="tok-s">&quot;Valor 1:&quot;</span> <span class="tok-o">+</span> <span class="tok-n">valor1</span><span class="tok-o">);</span>
    <span class="tok-n">out</span><span class="tok-o">.</span><span class="tok-na">println</span> <span class="tok-o">(</span><span class="tok-s">&quot;&lt;BR&gt;&quot;</span><span class="tok-o">);</span>
    <span class="tok-n">out</span><span class="tok-o">.</span><span class="tok-na">println</span> <span class="tok-o">(</span><span class="tok-s">&quot;Valor 2:&quot;</span> <span class="tok-o">+</span> <span class="tok-n">valor2</span><span class="tok-o">);</span>
    <span class="tok-n">out</span><span class="tok-o">.</span><span class="tok-na">println</span> <span class="tok-o">(</span><span class="tok-s">&quot;&lt;BR&gt;&quot;</span><span class="tok-o">);</span>
    <span class="tok-n">out</span><span class="tok-o">.</span><span class="tok-na">println</span> <span class="tok-o">(</span><span class="tok-s">&quot;Valor 3:&quot;</span><span class="tok-o">);</span>
    <span class="tok-n">out</span><span class="tok-o">.</span><span class="tok-na">println</span> <span class="tok-o">(</span><span class="tok-s">&quot;&lt;BR&gt;&quot;</span><span class="tok-o">);</span>
    <span class="tok-k">if</span> <span class="tok-o">(</span><span class="tok-n">valor3</span> <span class="tok-o">!=</span> <span class="tok-kc">null</span><span class="tok-o">)</span>
      <span class="tok-k">for</span> <span class="tok-o">(</span><span class="tok-kt">int</span> <span class="tok-n">i</span> <span class="tok-o">=</span> <span class="tok-mi">0</span><span class="tok-o">;</span> <span class="tok-n">i</span> <span class="tok-o">&lt;</span> <span class="tok-n">valor3</span><span class="tok-o">.</span><span class="tok-na">length</span><span class="tok-o">;</span> <span class="tok-n">i</span><span class="tok-o">++)</span>
      <span class="tok-o">{</span>
        <span class="tok-n">out</span><span class="tok-o">.</span><span class="tok-na">println</span> <span class="tok-o">(</span><span class="tok-n">valor3</span><span class="tok-o">[</span><span class="tok-n">i</span><span class="tok-o">]);</span>
        <span class="tok-n">out</span><span class="tok-o">.</span><span class="tok-na">println</span> <span class="tok-o">(</span><span class="tok-s">&quot;&lt;BR&gt;&quot;</span><span class="tok-o">);</span>
      <span class="tok-o">}</span>

    <span class="tok-n">out</span><span class="tok-o">.</span><span class="tok-na">println</span> <span class="tok-o">(</span><span class="tok-s">&quot;&lt;/BODY&gt;&quot;</span><span class="tok-o">);</span>
    <span class="tok-n">out</span><span class="tok-o">.</span><span class="tok-na">println</span> <span class="tok-o">(</span><span class="tok-s">&quot;&lt;/HTML&gt;&quot;</span><span class="tok-o">);</span>
  <span class="tok-o">}</span>

  <span class="tok-c1">// Metodo para POST</span>

  <span class="tok-kd">public</span> <span class="tok-kt">void</span> <span class="tok-nf">doPost</span><span class="tok-o">(</span><span class="tok-n">HttpServletRequest</span> <span class="tok-n">request</span><span class="tok-o">,</span>
                     <span class="tok-n">HttpServletResponse</span> <span class="tok-n">response</span><span class="tok-o">)</span>
                  <span class="tok-kd">throws</span> <span class="tok-n">ServletException</span><span class="tok-o">,</span> <span class="tok-n">IOException</span> <span class="tok-o">{</span>
    <span class="tok-n">doGet</span><span class="tok-o">(</span><span class="tok-n">request</span><span class="tok-o">,</span> <span class="tok-n">response</span><span class="tok-o">);</span>
  <span class="tok-o">}</span>
<span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Para probar el ejemplo que viene en las plantillas, cargamos la URL:</p>
</div>
<div class="paragraph">
<p><a href="http://localhost:8080/appforms/index_form.html" class="bare">http://localhost:8080/appforms/index_form.html</a></p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_cabeceras_y_códigos">2.3. Cabeceras y códigos</h3>
<div class="paragraph">
<p>Veremos a continuación cómo tratar las cabeceras HTTP de una petición y de una respuesta, así como los códigos de estado que emite un servidor Web ante una petición, y las variables CGI a las que podemos acceder.</p>
</div>
<div class="sect3">
<h4 id="_cabeceras_de_petición">2.3.1. Cabeceras de petición</h4>
<div class="paragraph">
<p>Cuando se envía una petición HTTP, se pueden enviar, entre otras cosas, unas cabeceras con información sobre el navegador. Para leer estas cabeceras de una petición desde un servlet, se utiliza el método <strong><code>getHeader()</code></strong> del objeto <strong><code>HttpServletRequest</code></strong>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span class="tok-n">String</span> <span class="tok-nf">getHeader</span><span class="tok-o">(</span><span class="tok-n">String</span> <span class="tok-n">nombre</span><span class="tok-o">)</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>El parámetro indica el nombre de la cabecera cuyo valor se quiere obtener. Devuelve el valor de la cabecera, o <code>null</code> si la cabecera no ha sido enviada en la petición.
Se tienen otros métodos, como:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span class="tok-n">Enumeration</span> <span class="tok-nf">getHeaderNames</span><span class="tok-o">()</span>
<span class="tok-n">Enumeration</span> <span class="tok-nf">getHeaders</span><span class="tok-o">(</span><span class="tok-n">String</span> <span class="tok-n">nombre</span><span class="tok-o">)</span>
<span class="tok-kt">int</span> <span class="tok-nf">getIntHeader</span><span class="tok-o">(</span><span class="tok-n">String</span> <span class="tok-n">nombre</span><span class="tok-o">)</span>
<span class="tok-o">...</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Con <strong><code>getHeaderNames()</code></strong> obtendremos todos los nombres de las cabeceras enviadas. Con <strong><code>getHeaders()</code></strong> obtendremos todos los valores de la cabecera de nombre dado. También hay métodos como <strong><code>getIntHeader()</code></strong> que devuelve el valor de una cabecera con un tipo de dato específico (entero, en este caso). Los nombres de las cabeceras normalmente no distinguen mayúsculas de minúsculas.
Algunas cabeceras son de uso común, y tienen métodos específicos para obtener sus valores, como:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span class="tok-n">Cookie</span><span class="tok-o">[]</span> <span class="tok-nf">getCookies</span><span class="tok-o">()</span>
<span class="tok-n">String</span> <span class="tok-nf">getContentLength</span><span class="tok-o">()</span>
<span class="tok-n">String</span> <span class="tok-nf">getContentType</span><span class="tok-o">()</span>
<span class="tok-o">...</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Con <code>getCookies()</code> obtendremos todas las cookies de la petición (veremos las cookies con más detalle en otro tema). Con <code>getContentLength()</code> obtenemos el valor de la cabecera <code>Content-Length</code>, y con <code>getContentType()</code> el de la cabecera <code>Content-Type</code>.</p>
</div>
</div>
<div class="sect3">
<h4 id="_cabeceras_de_respuesta">2.3.2. Cabeceras de respuesta</h4>
<div class="paragraph">
<p>En la respuesta de un servidor web a una petición también pueden aparecer cabeceras que informan sobre el documento servido o sobre el propio servidor. Podemos definir cabeceras de respuesta para enviar cookies, indicar la fecha de modificación, etc. Estas cabeceras deben establecerse ANTES de enviar cualquier documento, o antes de obtener el <code>PrintWriter</code> si es el caso.
Para enviar cabeceras, el método más general es <strong><code>setHeader()</code></strong> del objeto <strong><code>HttpServletResponse</code></strong>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span class="tok-kt">void</span> <span class="tok-nf">setHeader</span><span class="tok-o">(</span><span class="tok-n">String</span> <span class="tok-n">nombre</span><span class="tok-o">,</span> <span class="tok-n">String</span> <span class="tok-n">valor</span><span class="tok-o">)</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Al que se le pasan el nombre de la cabecera y el valor. Hay otros métodos útiles:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span class="tok-kt">void</span> <span class="tok-nf">setIntHeader</span><span class="tok-o">(</span><span class="tok-n">String</span> <span class="tok-n">nombre</span><span class="tok-o">,</span> <span class="tok-kt">int</span> <span class="tok-n">valor</span><span class="tok-o">)</span>
<span class="tok-kt">void</span> <span class="tok-nf">addHeader</span><span class="tok-o">(</span><span class="tok-n">String</span> <span class="tok-n">nombre</span><span class="tok-o">,</span> <span class="tok-n">String</span> <span class="tok-n">valor</span><span class="tok-o">)</span>
<span class="tok-kt">void</span> <span class="tok-nf">addIntHeader</span><span class="tok-o">(</span><span class="tok-n">String</span> <span class="tok-n">nombre</span><span class="tok-o">,</span> <span class="tok-kt">int</span> <span class="tok-n">valor</span><span class="tok-o">)</span>
<span class="tok-o">...</span></code></pre>
</div>
</div>
<div class="paragraph">
<p><strong><code>setIntHeader()</code></strong> o <strong><code>setDateHeader()</code></strong> se utilizan para enviar cabeceras de tipo entero o fecha. Los métodos <strong><code>add&#8230;&#8203;()</code></strong> se emplean para añadir múltiples valores a una cabecera con el mismo nombre.</p>
</div>
<div class="paragraph">
<p>Algunas cabeceras tienen métodos específicos de envío, como:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span class="tok-kt">void</span> <span class="tok-nf">setContentType</span><span class="tok-o">(</span><span class="tok-n">String</span> <span class="tok-n">tipo</span><span class="tok-o">)</span>
<span class="tok-kt">void</span> <span class="tok-nf">setContentLength</span><span class="tok-o">(</span><span class="tok-kt">int</span> <span class="tok-n">tamaño</span><span class="tok-o">)</span>
<span class="tok-kt">void</span> <span class="tok-nf">sendRedirect</span><span class="tok-o">(</span><span class="tok-n">String</span> <span class="tok-n">url</span><span class="tok-o">)</span>
<span class="tok-kt">void</span> <span class="tok-nf">addCookie</span><span class="tok-o">(</span><span class="tok-n">Cookie</span> <span class="tok-n">cookie</span><span class="tok-o">)</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Con <strong><code>setContentType()</code></strong> se establece la cabecera <code>Content-Type</code> con el tipo MIME del documento. Con <strong><code>setContentLength()</code></strong> se indican los bytes enviados. Con <strong><code>sendRedirect()</code></strong> se selecciona la cabecera <code>Location</code>, y con ella se redirige a la página que le digamos. Finalmente, con <strong><code>addCookie()</code></strong> se establecen cookies (esto último ya lo veremos con más detalle en otro tema). Es recomendable utilizar estos métodos en lugar del método <code>setHeader()</code> para la cabecera en cuestión.</p>
</div>
</div>
<div class="sect3">
<h4 id="_variables_cgi">2.3.3. Variables CGI</h4>
<div class="paragraph">
<p>Las variables CGI son una forma de recoger información sobre una petición. Algunas se derivan de la línea de petición HTTP y de las cabeceras, otras del propio socket (como el nombre o la IP de quien solicita la petición), y otras de los parámetros de instalación del servidor (como el mapeo de URLs a los paths actuales).
Mostramos a continuación una tabla con las variables CGI, y cómo acceder a ellas desde servlets:</p>
</div>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 33%;">
<col style="width: 33%;">
<col style="width: 33%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">VARIABLE CGI</th>
<th class="tableblock halign-left valign-top">SIGNIFICADO</th>
<th class="tableblock halign-left valign-top">ACCESO DESDE SERVLETS</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">AUTH_TYPE</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Tipo de cabecera Authorization (basic o digest)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>request. getAuthType()</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">CONTENT_LENGTH</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Número de bytes enviados en peticiones POST</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>request. getContentLength()</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">CONTENT_TYPE</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Tipo MIME de los datos adjuntos</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>request. getContentType()</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">DOCUMENT_ROOT</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Path del directorio raíz del servidor web</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>getServletContext(). getRealPath("/")</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">HTTP_XXX_YYY</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Acceso a cabeceras arbitrarias HTTP</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>request. getHeader("Xxx-Yyy")</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">PATH_INFO</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Información de path adjunto a la URL</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>request. getPathInfo()</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">PATH_TRANSLATED</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Path mapeado al path real del servidor</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>request. getPathTranslated()</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">QUERY_STRING</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Datos adjuntos para peticiones GET</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>request. getQueryString()</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">REMOTE_ADDR</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">IP del cliente que hizo la petición</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>request. getRemoteAddr()</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">REMOTE_HOST</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Nombre del dominio del cliente que hizo la petición (o IP si no se puede determinar)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>request. getRemoteHost()</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">REMOTE_USER</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Parte del usuario en la cabecera Authorization (si se suministró)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>request. getRemoteUser()</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">REQUEST_METHOD</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Tipo de petición (GET, POST, PUT, DELETE, HEAD, OPTIONS, TRACE)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>request. getMethod()</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">SCRIPT_NAME</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Path del servlet</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>request. getServletPath()</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">SERVER_NAME</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Nombre del servidor web</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>request. getServerName()</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">SERVER_PORT</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Puerto por el que escucha el servidor</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>request. getServerPort()</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">SERVER_PROTOCOL</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Nombre y versión usada en la línea de petición (HTTP/1.0, HTTP/1.1 &#8230;&#8203;)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>request. getServerProtocol()</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">SERVER_SOFTWARE</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Información del servidor web</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>getServletContext(). getServerInfo()</code></p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><code>request</code> se asume que es un objeto de tipo <code>HttpServletRequest</code>. Para obtener cualquiera de las variables antes mencionadas, sólo hay que llamar al método apropiado desde <code>doGet()</code> o <code>doPost()</code>.</p>
</div>
</div>
<div class="sect3">
<h4 id="_códigos_de_estado_http">2.3.4. Códigos de estado HTTP</h4>
<div class="paragraph">
<p>Cuando un servidor web responde a una petición, en la respuesta aparece, entre otras cosas, un código de estado que indica el resultado de la petición, y un mensaje corto descriptivo de dicho código.
El envío de cabeceras de respuesta normalmente se planifica junto con el envío de códigos de estado, ya que muchos de los códigos de estado necesitan tener una cabecera definida. Podemos hacer varias cosas con los servlets manipulando las líneas de estado y las cabeceras de respuesta, como por ejemplo reenviar al usuario a otros lugares, indicar que se requiere un password para acceder a un determinado sitio web, etc.
Para enviar códigos de estado se emplea el método <strong><code>setStatus()</code></strong> de <strong><code>HttpServletResponse</code></strong>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span class="tok-kt">void</span> <span class="tok-nf">setStatus</span><span class="tok-o">(</span><span class="tok-kt">int</span> <span class="tok-n">estado</span><span class="tok-o">)</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Donde se le pasa como parámetro el código del estado. En la clase <code>HttpServletResponse</code> tenemos una serie de constantes para referenciar a cada código de estado. Por ejemplo, la constante:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span class="tok-n">HttpServletResponse</span><span class="tok-o">.</span><span class="tok-na">SC_NOT_FOUND</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>se corresponde con el código 404, e indica que el documento solicitado no se ha encontrado.
Existen otros métodos para gestión de mensajes de error:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span class="tok-kt">void</span> <span class="tok-nf">sendError</span><span class="tok-o">(</span><span class="tok-kt">int</span> <span class="tok-n">codigo</span><span class="tok-o">,</span> <span class="tok-n">String</span> <span class="tok-n">mensaje</span><span class="tok-o">)</span>
<span class="tok-kt">void</span> <span class="tok-nf">sendRedirect</span><span class="tok-o">(</span><span class="tok-n">String</span> <span class="tok-n">url</span><span class="tok-o">)</span></code></pre>
</div>
</div>
<div class="paragraph">
<p><strong><code>sendError()</code></strong> genera una página de error, con código de error igual a <code>codigo</code>, y con mensaje de error igual a <code>mensaje</code>. Se suele utilizar este método para códigos de error, y <code>setStatus()</code> para códigos normales.
<strong><code>sendRedirect()</code></strong> genera un error de tipo 302, envía una cabecera <code>Location</code> y redirige a la página indicada en <code>url</code>. Es mejor que enviar directamente el código, o hacer un <code>response.setHeader("Location", "http&#8230;&#8203;")</code>, porque es más cómodo, y porque el servlet genera así una página con el enlace a la nueva dirección, para navegadores que no soporten redirección automática
Si queremos enviar un código en la respuesta, se tiene que especificar antes de obtener el objeto <code>PrintWriter</code>.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_procesamiento_asíncrono">2.4. Procesamiento asíncrono</h3>
<div class="paragraph">
<p>Hemos visto anteriormente que por cada petición que se realiza a un servlet se crea un hilo de ejecución. Dado que los recursos del servidor son limitados, normalmente tenemos un número máximo de hilos que pueden atender a los clientes (tenemos un <em>pool</em> de hilos). Cuando los hilos se agoten no se podrán atender más peticiones.</p>
</div>
<div class="paragraph">
<p>Si realizamos operaciones de larga duración estos hilos quedarán ocupados durante más tiempo y será más fácil agotar los recursos disponibles. Podemos mejorar la escalabilidad del sistema utilizando procesamiento asíncrono. Este tipo de procesamiento nos permite liberar el hilo de la petición mientras se realiza una operación larga en segundo plano, de forma que otro cliente pueda utilizarlo mientras tanto. Estas operaciones podrían ser por ejemplo:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Consultas a base de datos</p>
</li>
<li>
<p>Acceso a servicios web remotos</p>
</li>
<li>
<p>Operaciones que dependan del suceso de algún evento o de la interacción del usuario</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Para habilitar el procesamiento asíncrono en un servlet debemos añadir el atributo <code>asyncSupported</code> a la anotación <code>WebServlet</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span class="tok-nd">@WebServlet</span><span class="tok-o">(</span><span class="tok-n">urlPatterns</span><span class="tok-o">={</span><span class="tok-s">&quot;/ServletAsincrono&quot;</span><span class="tok-o">},</span> <span class="tok-n">asyncSupported</span><span class="tok-o">=</span><span class="tok-kc">true</span><span class="tok-o">)</span>
<span class="tok-kd">public</span> <span class="tok-kd">class</span> <span class="tok-nc">AsincronoServlet</span> <span class="tok-kd">extends</span> <span class="tok-n">HttpServlet</span> <span class="tok-o">{</span>
    <span class="tok-o">...</span>
<span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>A continuación veremos como liberar el hilo de la petición del procesamiento de operaciones largas o del bloqueo de la entrada/salida utilizando el procesamiento asíncrono.</p>
</div>
<div class="sect3">
<h4 id="_procesamiento_de_operaciones_de_larga_duración">2.4.1. Procesamiento de operaciones de larga duración</h4>
<div class="paragraph">
<p>Una vez habilitado el soporte para procesamiento asíncrono, podremos poner la petición en modo de procesamiento asíncrono mediante el método <code>startAsync</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span class="tok-kd">public</span> <span class="tok-kt">void</span> <span class="tok-nf">doGet</span><span class="tok-o">(</span><span class="tok-n">HttpServletRequest</span> <span class="tok-n">request</span><span class="tok-o">,</span> <span class="tok-n">HttpServletResponse</span> <span class="tok-n">response</span><span class="tok-o">)</span> <span class="tok-o">{</span>
  <span class="tok-o">...</span>
  <span class="tok-kd">final</span> <span class="tok-n">AsyncContext</span> <span class="tok-n">ac</span> <span class="tok-o">=</span> <span class="tok-n">request</span><span class="tok-o">.</span><span class="tok-na">startAsync</span><span class="tok-o">();</span>
  <span class="tok-o">...</span>
<span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Al llamar a este método obtenemos un objeto <code>AsyncContext</code> que representa el contexto de ejecución asíncrono y que será necesario para procesar la petición una vez hemos pasado a este modo. Esto nos permitirá pasar el procesamiento de la operación a otro hilo, liberando así al hilo de la petición para que pueda atender a otro cliente.</p>
</div>
<div class="paragraph">
<p>El procesamiento asíncrono de la operación se realizará como se muestra a continuación:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span class="tok-n">ac</span><span class="tok-o">.</span><span class="tok-na">start</span><span class="tok-o">(</span><span class="tok-k">new</span> <span class="tok-nf">Runnable</span><span class="tok-o">()</span> <span class="tok-o">{</span> <i class="conum" data-value="1"></i><b>(1)</b>
  <span class="tok-kd">public</span> <span class="tok-kt">void</span> <span class="tok-nf">run</span><span class="tok-o">()</span> <span class="tok-o">{</span>
      <span class="tok-n">HttpServletRequest</span> <span class="tok-n">response</span> <span class="tok-o">=</span> <span class="tok-n">ac</span><span class="tok-o">.</span><span class="tok-na">getRequest</span><span class="tok-o">();</span> <i class="conum" data-value="2"></i><b>(2)</b>
      <span class="tok-c1">// Procesa la petición</span>
      <span class="tok-o">...</span>
      <span class="tok-n">HttpServletResponse</span> <span class="tok-n">response</span> <span class="tok-o">=</span> <span class="tok-n">ac</span><span class="tok-o">.</span><span class="tok-na">getResponse</span><span class="tok-o">();</span> <i class="conum" data-value="3"></i><b>(3)</b>
      <span class="tok-c1">// Escribe la respuesta</span>
      <span class="tok-o">...</span>
      <span class="tok-n">ac</span><span class="tok-o">.</span><span class="tok-na">complete</span><span class="tok-o">();</span> <i class="conum" data-value="4"></i><b>(4)</b>
  <span class="tok-o">}</span>
<span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Con <code>start</code> se crea un nuevo hilo dentro del cual realizaremos el procesamiento, liberando así el hilo de la petición.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Podemos obtener el objeto de la petición a partir del <code>AsyncContext</code>.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>También podemos obtener el objeto de la respuesta a partir del <code>AsyncContext</code>, con el cual podremos devolver el resultado al cliente una vez finalizado el procesamiento.</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Es importante llamar a <code>complete</code> para que termine la operación asíncrona, cierre la respuesta y se la envíe el cliente. Siempre deberemos llamar a este método tras escribir la respuesta.</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_entrada_y_salida_no_bloqueante">2.4.2. Entrada y salida no bloqueante</h4>
<div class="paragraph">
<p>En el apartado anterior hemos visto cómo realizar una operación de larga duración de forma asíncrona. Sin embargo, a veces gran parte del tiempo que se mantiene ocupado el hilo de la petición es debido a la entrada y salida, normalmente debido a mensajes de petición extensos.</p>
</div>
<div class="paragraph">
<p>Podemos utilizar el soporte asíncrono también para leer la petición fuera del hilo de la petición, y así evitar que quede bloqueado más tiempo del necesario. Para hacer esto definiremos un <code>ReadListener</code> sobre el <code>InputStream</code> de la petición, al que le irá llegando el mensaje conforme se reciba:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span class="tok-kd">final</span> <span class="tok-n">AsyncContext</span> <span class="tok-n">ac</span> <span class="tok-o">=</span> <span class="tok-n">request</span><span class="tok-o">.</span><span class="tok-na">startAsync</span><span class="tok-o">();</span>
<span class="tok-kd">final</span> <span class="tok-n">ServletInputStream</span> <span class="tok-n">sis</span> <span class="tok-o">=</span> <span class="tok-n">request</span><span class="tok-o">.</span><span class="tok-na">getInputStream</span><span class="tok-o">();</span>

<span class="tok-n">sis</span><span class="tok-o">.</span><span class="tok-na">setReadListener</span><span class="tok-o">(</span><span class="tok-k">new</span> <span class="tok-nf">ReadListener</span><span class="tok-o">()</span> <span class="tok-o">{</span> <i class="conum" data-value="1"></i><b>(1)</b>
  <span class="tok-kt">byte</span> <span class="tok-n">buffer</span><span class="tok-o">[]</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-kt">byte</span><span class="tok-o">[</span><span class="tok-mi">4</span><span class="tok-o">*</span><span class="tok-mi">1024</span><span class="tok-o">];</span>
  <span class="tok-n">StringBuilder</span> <span class="tok-n">sb</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-nf">StringBuilder</span><span class="tok-o">();</span>

  <span class="tok-nd">@Override</span>
  <span class="tok-kd">public</span> <span class="tok-kt">void</span> <span class="tok-nf">onDataAvailable</span><span class="tok-o">()</span> <span class="tok-o">{</span> <i class="conum" data-value="2"></i><b>(2)</b>
      <span class="tok-k">try</span> <span class="tok-o">{</span>
        <span class="tok-k">do</span> <span class="tok-o">{</span>
            <span class="tok-kt">int</span> <span class="tok-n">length</span> <span class="tok-o">=</span> <span class="tok-n">sis</span><span class="tok-o">.</span><span class="tok-na">read</span><span class="tok-o">(</span><span class="tok-n">buffer</span><span class="tok-o">);</span>
            <span class="tok-n">sb</span><span class="tok-o">.</span><span class="tok-na">append</span><span class="tok-o">(</span><span class="tok-k">new</span> <span class="tok-nf">String</span><span class="tok-o">(</span><span class="tok-n">buffer</span><span class="tok-o">,</span> <span class="tok-mi">0</span><span class="tok-o">,</span> <span class="tok-n">length</span><span class="tok-o">));</span>
        <span class="tok-o">}</span> <span class="tok-k">while</span><span class="tok-o">(</span><span class="tok-n">sis</span><span class="tok-o">.</span><span class="tok-na">isReady</span><span class="tok-o">());</span>
      <span class="tok-o">}</span> <span class="tok-k">catch</span> <span class="tok-o">(</span><span class="tok-n">IOException</span> <span class="tok-n">ex</span><span class="tok-o">)</span> <span class="tok-o">{</span>  <span class="tok-o">}</span>
  <span class="tok-o">}</span>

  <span class="tok-nd">@Override</span>
  <span class="tok-kd">public</span> <span class="tok-kt">void</span> <span class="tok-nf">onAllDataRead</span><span class="tok-o">()</span> <span class="tok-o">{</span> <i class="conum" data-value="3"></i><b>(3)</b>
      <span class="tok-k">try</span> <span class="tok-o">{</span>
        <span class="tok-c1">// Procesar peticion</span>
        <span class="tok-o">...</span>
        <span class="tok-n">PrintWriter</span> <span class="tok-n">pw</span> <span class="tok-o">=</span> <span class="tok-n">ac</span><span class="tok-o">.</span><span class="tok-na">getResponse</span><span class="tok-o">().</span><span class="tok-na">getWriter</span><span class="tok-o">();</span>
        <span class="tok-c1">// Escribir respuesta</span>
        <span class="tok-o">...</span>
      <span class="tok-o">}</span> <span class="tok-k">catch</span> <span class="tok-o">(</span><span class="tok-n">IOException</span> <span class="tok-n">ex</span><span class="tok-o">)</span> <span class="tok-o">{</span>  <span class="tok-o">}</span>
      <span class="tok-n">ac</span><span class="tok-o">.</span><span class="tok-na">complete</span><span class="tok-o">();</span>
  <span class="tok-o">}</span>

  <span class="tok-nd">@Override</span>
  <span class="tok-kd">public</span> <span class="tok-kt">void</span> <span class="tok-nf">onError</span><span class="tok-o">(</span><span class="tok-n">Throwable</span> <span class="tok-n">t</span><span class="tok-o">)</span> <span class="tok-o">{</span>  <span class="tok-o">}</span>
<span class="tok-o">});</span></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Definimos un objeto <code>ReadListener</code> y se lo asignamos al <code>InputStream</code> de la petición.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Cada vez que se reciba un fragmento del mensaje se llamará a <code>onDataAvailable</code>. Deberemos leer todos los datos disponibles hasta el momento, y cuando no hayan llegado más saldremos del método para evitar bloquear el hilo. Este método se volverá a llamar cuando haya un nuevo fragmento disponible.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Cuando todo el mensaje haya llegado se llama a <code>onAllDataRead</code>. Aquí podemos ya ver todo el contenido que hemos recibido con la petición, y podemos procesarlo y devolver una respuesta.</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_ejemplos">2.5. Ejemplos</h3>
<div class="sect3">
<h4 id="_ejemplo_de_cabeceras_de_petición">2.5.1. Ejemplo de cabeceras de petición</h4>
<div class="paragraph">
<p>El siguiente servlet muestra los valores de todas las cabeceras HTTP enviadas en la petición. Recorre las cabeceras enviadas y muestra su nombre y valor:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span class="tok-kn">package</span> <span class="tok-n">ejemplos</span><span class="tok-o">;</span>

<span class="tok-kn">import</span> <span class="tok-nn">java.io.*</span><span class="tok-o">;</span>
<span class="tok-kn">import</span> <span class="tok-nn">java.util.*</span><span class="tok-o">;</span>
<span class="tok-kn">import</span> <span class="tok-nn">javax.servlet.*</span><span class="tok-o">;</span>
<span class="tok-kn">import</span> <span class="tok-nn">javax.servlet.http.*</span><span class="tok-o">;</span>

<span class="tok-kd">public</span> <span class="tok-kd">class</span> <span class="tok-nc">ServletCabecerasPeticion</span> <span class="tok-kd">extends</span> <span class="tok-n">HttpServlet</span> <span class="tok-o">{</span>

    <span class="tok-c1">// Metodo para GET</span>
    <span class="tok-kd">public</span> <span class="tok-kt">void</span> <span class="tok-nf">doGet</span><span class="tok-o">(</span><span class="tok-n">HttpServletRequest</span> <span class="tok-n">request</span><span class="tok-o">,</span>
                     <span class="tok-n">HttpServletResponse</span> <span class="tok-n">response</span><span class="tok-o">)</span>
                   <span class="tok-kd">throws</span> <span class="tok-n">ServletException</span><span class="tok-o">,</span> <span class="tok-n">IOException</span> <span class="tok-o">{</span>
        <span class="tok-n">PrintWriter</span> <span class="tok-n">out</span> <span class="tok-o">=</span> <span class="tok-n">response</span><span class="tok-o">.</span><span class="tok-na">getWriter</span><span class="tok-o">();</span>

        <span class="tok-c1">// Mostramos las cabeceras enviadas</span>
        <span class="tok-c1">// en la peticion</span>

        <span class="tok-n">out</span><span class="tok-o">.</span><span class="tok-na">println</span> <span class="tok-o">(</span><span class="tok-s">&quot;&lt;HTML&gt;&quot;</span><span class="tok-o">);</span>
        <span class="tok-n">out</span><span class="tok-o">.</span><span class="tok-na">println</span> <span class="tok-o">(</span><span class="tok-s">&quot;&lt;BODY&gt;&quot;</span><span class="tok-o">);</span>
        <span class="tok-n">out</span><span class="tok-o">.</span><span class="tok-na">println</span> <span class="tok-o">(</span><span class="tok-s">&quot;&lt;H1&gt;Cabeceras&lt;/H1&gt;&quot;</span><span class="tok-o">);</span>
        <span class="tok-n">out</span><span class="tok-o">.</span><span class="tok-na">println</span> <span class="tok-o">(</span><span class="tok-s">&quot;&lt;BR&gt;&quot;</span><span class="tok-o">);</span>

        <span class="tok-n">Enumeration</span> <span class="tok-n">cabeceras</span> <span class="tok-o">=</span> <span class="tok-n">request</span><span class="tok-o">.</span><span class="tok-na">getHeaderNames</span><span class="tok-o">();</span>

        <span class="tok-k">while</span> <span class="tok-o">(</span><span class="tok-n">cabeceras</span><span class="tok-o">.</span><span class="tok-na">hasMoreElements</span><span class="tok-o">())</span>
        <span class="tok-o">{</span>
            <span class="tok-n">String</span> <span class="tok-n">nombre</span> <span class="tok-o">=</span> <span class="tok-o">(</span><span class="tok-n">String</span><span class="tok-o">)(</span><span class="tok-n">cabeceras</span><span class="tok-o">.</span><span class="tok-na">nextElement</span><span class="tok-o">());</span>
            <span class="tok-n">out</span><span class="tok-o">.</span><span class="tok-na">println</span> <span class="tok-o">(</span><span class="tok-s">&quot;Nombre: &quot;</span> <span class="tok-o">+</span> <span class="tok-n">nombre</span> <span class="tok-o">+</span>
               <span class="tok-s">&quot;, Valor: &quot;</span> <span class="tok-o">+</span> <span class="tok-n">request</span><span class="tok-o">.</span><span class="tok-na">getHeader</span><span class="tok-o">(</span><span class="tok-n">nombre</span><span class="tok-o">));</span>
            <span class="tok-n">out</span><span class="tok-o">.</span><span class="tok-na">println</span> <span class="tok-o">(</span><span class="tok-s">&quot;&lt;BR&gt;&lt;BR&gt;&quot;</span><span class="tok-o">);</span>
        <span class="tok-o">}</span>

        <span class="tok-n">out</span><span class="tok-o">.</span><span class="tok-na">println</span> <span class="tok-o">(</span><span class="tok-s">&quot;&lt;/BODY&gt;&quot;</span><span class="tok-o">);</span>
        <span class="tok-n">out</span><span class="tok-o">.</span><span class="tok-na">println</span> <span class="tok-o">(</span><span class="tok-s">&quot;&lt;/HTML&gt;&quot;</span><span class="tok-o">);</span>
    <span class="tok-o">}</span>

    <span class="tok-c1">// Metodo para POST</span>
    <span class="tok-kd">public</span> <span class="tok-kt">void</span> <span class="tok-nf">doPost</span><span class="tok-o">(</span><span class="tok-n">HttpServletRequest</span> <span class="tok-n">request</span><span class="tok-o">,</span>
                      <span class="tok-n">HttpServletResponse</span> <span class="tok-n">response</span><span class="tok-o">)</span>
                   <span class="tok-kd">throws</span> <span class="tok-n">ServletException</span><span class="tok-o">,</span> <span class="tok-n">IOException</span> <span class="tok-o">{</span>
        <span class="tok-n">doGet</span><span class="tok-o">(</span><span class="tok-n">request</span><span class="tok-o">,</span> <span class="tok-n">response</span><span class="tok-o">);</span>
    <span class="tok-o">}</span>
<span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Se puede probar con este formulario, pinchando el botón:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><span class="tok-nt">&lt;html&gt;</span>
<span class="tok-nt">&lt;body&gt;</span>
<span class="tok-nt">&lt;form</span> <span class="tok-na">action=</span>
 <span class="tok-s">&quot;/appcab/servlet/ejemplos.ServletCabecerasPeticion&quot;</span><span class="tok-nt">&gt;</span>
  <span class="tok-nt">&lt;input</span> <span class="tok-na">type=</span><span class="tok-s">&quot;submit&quot;</span> <span class="tok-na">value=</span><span class="tok-s">&quot;Pulsa aqui&quot;</span><span class="tok-nt">&gt;</span>
<span class="tok-nt">&lt;/form&gt;</span>
<span class="tok-nt">&lt;/body&gt;</span>
<span class="tok-nt">&lt;/html&gt;</span></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_ejemplo_de_cabeceras_de_respuesta">2.5.2. Ejemplo de cabeceras de respuesta</h4>
<div class="paragraph">
<p>El siguiente servlet espera un parámetro <code>accion</code> que puede tomar 4 valores:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>primos</strong>: El servlet tiene un hilo que está constantemente calculando números primos. Al elegir esta opción se envía una cabecera <code>Refresh</code> y recarga el servlet cada 10 segundos, mostrando el último número primo que ha encontrado.</p>
</li>
<li>
<p><strong>redirect</strong>: Utiliza un <code>sendRedirect()</code> para cargar la página que se indique como parámetro</p>
</li>
<li>
<p><strong>error</strong>: Utiliza un <code>sendError()</code> para mostrar una página de error, con un mensaje de error definido por el usuario, y un código de error a elegir de una lista.</p>
</li>
<li>
<p><strong>codigo</strong>: Envía un código de estado HTTP (con <code>setStatus()</code>), a elegir de entre una lista.</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span class="tok-kn">package</span> <span class="tok-n">ejemplos</span><span class="tok-o">;</span>

<span class="tok-kn">import</span> <span class="tok-nn">java.io.*</span><span class="tok-o">;</span>
<span class="tok-kn">import</span> <span class="tok-nn">javax.servlet.*</span><span class="tok-o">;</span>
<span class="tok-kn">import</span> <span class="tok-nn">javax.servlet.http.*</span><span class="tok-o">;</span>

<span class="tok-kd">public</span> <span class="tok-kd">class</span> <span class="tok-nc">ServletCabecerasRespuesta</span> <span class="tok-kd">extends</span> <span class="tok-n">HttpServlet</span>
                                       <span class="tok-kd">implements</span> <span class="tok-n">Runnable</span> <span class="tok-o">{</span>
    <span class="tok-c1">// Ultimo numero primo descubierto</span>
    <span class="tok-kt">long</span> <span class="tok-n">primo</span> <span class="tok-o">=</span> <span class="tok-mi">1</span><span class="tok-o">;</span>

    <span class="tok-c1">// Hilo para calcular numeros primos</span>
    <span class="tok-n">Thread</span> <span class="tok-n">t</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-nf">Thread</span><span class="tok-o">(</span><span class="tok-k">this</span><span class="tok-o">);</span>

    <span class="tok-c1">// Metodo de inicializacion</span>
    <span class="tok-kd">public</span> <span class="tok-kt">void</span> <span class="tok-nf">init</span><span class="tok-o">()</span>
    <span class="tok-o">{</span>
        <span class="tok-n">t</span><span class="tok-o">.</span><span class="tok-na">start</span><span class="tok-o">();</span>
    <span class="tok-o">}</span>

    <span class="tok-c1">// Metodo para GET</span>
    <span class="tok-kd">public</span> <span class="tok-kt">void</span> <span class="tok-nf">doGet</span><span class="tok-o">(</span><span class="tok-n">HttpServletRequest</span> <span class="tok-n">request</span><span class="tok-o">,</span>
                      <span class="tok-n">HttpServletResponse</span> <span class="tok-n">response</span><span class="tok-o">)</span>
                    <span class="tok-kd">throws</span> <span class="tok-n">ServletException</span><span class="tok-o">,</span> <span class="tok-n">IOException</span> <span class="tok-o">{</span>
        <span class="tok-n">String</span> <span class="tok-n">accion</span> <span class="tok-o">=</span> <span class="tok-n">request</span><span class="tok-o">.</span><span class="tok-na">getParameter</span><span class="tok-o">(</span><span class="tok-s">&quot;accion&quot;</span><span class="tok-o">);</span>

        <span class="tok-k">if</span> <span class="tok-o">(</span><span class="tok-n">accion</span><span class="tok-o">.</span><span class="tok-na">equals</span><span class="tok-o">(</span><span class="tok-s">&quot;primo&quot;</span><span class="tok-o">))</span>
        <span class="tok-o">{</span>
            <span class="tok-c1">// Buscar el ultimo numero</span>
            <span class="tok-c1">// primo y enviarlo</span>

            <span class="tok-n">response</span><span class="tok-o">.</span><span class="tok-na">setContentType</span><span class="tok-o">(</span><span class="tok-s">&quot;text/html&quot;</span><span class="tok-o">);</span>
            <span class="tok-n">response</span><span class="tok-o">.</span><span class="tok-na">setHeader</span><span class="tok-o">(</span><span class="tok-s">&quot;Refresh&quot;</span><span class="tok-o">,</span> <span class="tok-s">&quot;10&quot;</span><span class="tok-o">);</span>
            <span class="tok-n">PrintWriter</span> <span class="tok-n">out</span> <span class="tok-o">=</span> <span class="tok-n">response</span><span class="tok-o">.</span><span class="tok-na">getWriter</span><span class="tok-o">();</span>
            <span class="tok-n">out</span><span class="tok-o">.</span><span class="tok-na">println</span> <span class="tok-o">(</span><span class="tok-s">&quot;&lt;HTML&gt;&lt;BODY&gt;&quot;</span><span class="tok-o">);</span>
            <span class="tok-n">out</span><span class="tok-o">.</span><span class="tok-na">println</span> <span class="tok-o">(</span><span class="tok-s">&quot;Primo: &quot;</span> <span class="tok-o">+</span> <span class="tok-n">primo</span><span class="tok-o">);</span>
            <span class="tok-n">out</span><span class="tok-o">.</span><span class="tok-na">println</span> <span class="tok-o">(</span><span class="tok-s">&quot;&lt;/BODY&gt;&lt;/HTML&gt;&quot;</span><span class="tok-o">);</span>

        <span class="tok-o">}</span> <span class="tok-k">else</span> <span class="tok-nf">if</span> <span class="tok-o">(</span><span class="tok-n">accion</span><span class="tok-o">.</span><span class="tok-na">equals</span><span class="tok-o">(</span><span class="tok-s">&quot;redirect&quot;</span><span class="tok-o">))</span> <span class="tok-o">{</span>

            <span class="tok-c1">// Redirigir a otra pagina</span>

            <span class="tok-n">String</span> <span class="tok-n">url</span> <span class="tok-o">=</span> <span class="tok-n">request</span><span class="tok-o">.</span><span class="tok-na">getParameter</span><span class="tok-o">(</span><span class="tok-s">&quot;url&quot;</span><span class="tok-o">);</span>
            <span class="tok-k">if</span> <span class="tok-o">(</span><span class="tok-n">url</span> <span class="tok-o">==</span> <span class="tok-kc">null</span><span class="tok-o">)</span>
                <span class="tok-n">url</span> <span class="tok-o">=</span> <span class="tok-s">&quot;http://www.ua.es&quot;</span><span class="tok-o">;</span>
            <span class="tok-n">response</span><span class="tok-o">.</span><span class="tok-na">sendRedirect</span><span class="tok-o">(</span><span class="tok-n">url</span><span class="tok-o">);</span>

        <span class="tok-o">}</span> <span class="tok-k">else</span> <span class="tok-nf">if</span> <span class="tok-o">(</span><span class="tok-n">accion</span><span class="tok-o">.</span><span class="tok-na">equals</span><span class="tok-o">(</span><span class="tok-s">&quot;error&quot;</span><span class="tok-o">))</span> <span class="tok-o">{</span>

            <span class="tok-c1">// Enviar error con sendError()</span>

            <span class="tok-kt">int</span> <span class="tok-n">codigo</span> <span class="tok-o">=</span> <span class="tok-n">response</span><span class="tok-o">.</span><span class="tok-na">SC_NOT_FOUND</span><span class="tok-o">;</span>
            <span class="tok-k">try</span> <span class="tok-o">{</span>
                <span class="tok-n">codigo</span> <span class="tok-o">=</span> <span class="tok-n">Integer</span><span class="tok-o">.</span><span class="tok-na">parseInt</span>
               <span class="tok-o">(</span><span class="tok-n">request</span><span class="tok-o">.</span><span class="tok-na">getParameter</span><span class="tok-o">(</span><span class="tok-s">&quot;codigoMensaje&quot;</span><span class="tok-o">));</span>
            <span class="tok-o">}</span> <span class="tok-k">catch</span> <span class="tok-o">(</span><span class="tok-n">Exception</span> <span class="tok-n">ex</span><span class="tok-o">)</span> <span class="tok-o">{</span>
                <span class="tok-n">codigo</span> <span class="tok-o">=</span> <span class="tok-n">response</span><span class="tok-o">.</span><span class="tok-na">SC_NOT_FOUND</span><span class="tok-o">;</span>
            <span class="tok-o">}</span>

            <span class="tok-n">String</span> <span class="tok-n">mensaje</span> <span class="tok-o">=</span> <span class="tok-n">request</span><span class="tok-o">.</span><span class="tok-na">getParameter</span><span class="tok-o">(</span><span class="tok-s">&quot;mensaje&quot;</span><span class="tok-o">);</span>
            <span class="tok-k">if</span> <span class="tok-o">(</span><span class="tok-n">mensaje</span> <span class="tok-o">==</span> <span class="tok-kc">null</span><span class="tok-o">)</span>
                <span class="tok-n">mensaje</span> <span class="tok-o">=</span> <span class="tok-s">&quot;Error generado&quot;</span><span class="tok-o">;</span>
            <span class="tok-n">response</span><span class="tok-o">.</span><span class="tok-na">sendError</span><span class="tok-o">(</span><span class="tok-n">codigo</span><span class="tok-o">,</span> <span class="tok-n">mensaje</span><span class="tok-o">);</span>

        <span class="tok-o">}</span> <span class="tok-k">else</span> <span class="tok-nf">if</span> <span class="tok-o">(</span><span class="tok-n">accion</span><span class="tok-o">.</span><span class="tok-na">equals</span><span class="tok-o">(</span><span class="tok-s">&quot;codigo&quot;</span><span class="tok-o">))</span> <span class="tok-o">{</span>

            <span class="tok-c1">// Enviar un codigo de error</span>

            <span class="tok-kt">int</span> <span class="tok-n">codigo</span> <span class="tok-o">=</span> <span class="tok-n">response</span><span class="tok-o">.</span><span class="tok-na">SC_NOT_FOUND</span><span class="tok-o">;</span>
            <span class="tok-k">try</span> <span class="tok-o">{</span>
                <span class="tok-n">codigo</span> <span class="tok-o">=</span> <span class="tok-n">Integer</span><span class="tok-o">.</span><span class="tok-na">parseInt</span>
                  <span class="tok-o">(</span><span class="tok-n">request</span><span class="tok-o">.</span><span class="tok-na">getParameter</span><span class="tok-o">(</span><span class="tok-s">&quot;codigo&quot;</span><span class="tok-o">));</span>
            <span class="tok-o">}</span> <span class="tok-k">catch</span> <span class="tok-o">(</span><span class="tok-n">Exception</span> <span class="tok-n">ex</span><span class="tok-o">)</span> <span class="tok-o">{</span>
                <span class="tok-n">codigo</span> <span class="tok-o">=</span> <span class="tok-n">response</span><span class="tok-o">.</span><span class="tok-na">SC_NOT_FOUND</span><span class="tok-o">;</span>
            <span class="tok-o">}</span>

            <span class="tok-n">response</span><span class="tok-o">.</span><span class="tok-na">setStatus</span><span class="tok-o">(</span><span class="tok-n">codigo</span><span class="tok-o">);</span>
        <span class="tok-o">}</span>
    <span class="tok-o">}</span>

    <span class="tok-c1">// Metodo para POST</span>
    <span class="tok-kd">public</span> <span class="tok-kt">void</span> <span class="tok-nf">doPost</span><span class="tok-o">(</span><span class="tok-n">HttpServletRequest</span> <span class="tok-n">request</span><span class="tok-o">,</span>
                       <span class="tok-n">HttpServletResponse</span> <span class="tok-n">response</span><span class="tok-o">)</span>
                    <span class="tok-kd">throws</span> <span class="tok-n">ServletException</span><span class="tok-o">,</span> <span class="tok-n">IOException</span> <span class="tok-o">{</span>
        <span class="tok-n">doGet</span><span class="tok-o">(</span><span class="tok-n">request</span><span class="tok-o">,</span> <span class="tok-n">response</span><span class="tok-o">);</span>
    <span class="tok-o">}</span>

    <span class="tok-o">...</span> <span class="tok-n">el</span> <span class="tok-n">resto</span> <span class="tok-n">del</span> <span class="tok-n">codigo</span> <span class="tok-n">es</span> <span class="tok-n">para</span> <span class="tok-n">el</span> <span class="tok-n">hilo</span><span class="tok-o">,</span>
    <span class="tok-n">para</span> <span class="tok-n">calcular</span> <span class="tok-n">numeros</span> <span class="tok-n">primos</span>
    <span class="tok-n">Puede</span> <span class="tok-n">consultarse</span> <span class="tok-n">en</span> <span class="tok-n">el</span> <span class="tok-n">fichero</span> <span class="tok-n">fuente</span><span class="tok-o">,</span>
    <span class="tok-n">aqui</span> <span class="tok-n">se</span> <span class="tok-n">quita</span> <span class="tok-n">por</span> <span class="tok-n">simplificar</span>
<span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Se puede probar con este formulario, eligiendo la acción a realizar, introduciendo los parámetros necesarios en el formulario y pinchando el botón de Enviar Datos:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><span class="tok-nt">&lt;html&gt;</span>
<span class="tok-nt">&lt;body&gt;</span>
<span class="tok-nt">&lt;form</span> <span class="tok-na">action=</span>
<span class="tok-s">&quot;/appcab/servlet/ejemplos.ServletCabecerasRespuesta&quot;</span><span class="tok-nt">&gt;</span>

<span class="tok-nt">&lt;table</span> <span class="tok-na">border=</span><span class="tok-s">&quot;0&quot;</span><span class="tok-nt">&gt;</span>

<span class="tok-nt">&lt;tr&gt;</span>
<span class="tok-nt">&lt;td&gt;</span>
<span class="tok-nt">&lt;input</span> <span class="tok-na">type=</span><span class="tok-s">&quot;radio&quot;</span> <span class="tok-na">name=</span><span class="tok-s">&quot;accion&quot;</span> <span class="tok-na">value=</span><span class="tok-s">&quot;primo&quot;</span> <span class="tok-err">selected</span><span class="tok-nt">&gt;</span>
Obtener ultimo numero primo
<span class="tok-nt">&lt;/td&gt;</span>
<span class="tok-nt">&lt;td&gt;&lt;/td&gt;</span>
<span class="tok-nt">&lt;td&gt;&lt;/td&gt;</span>
<span class="tok-nt">&lt;/tr&gt;</span>

<span class="tok-nt">&lt;tr&gt;</span>
<span class="tok-nt">&lt;td&gt;</span>
<span class="tok-nt">&lt;input</span> <span class="tok-na">type=</span><span class="tok-s">&quot;radio&quot;</span> <span class="tok-na">name=</span><span class="tok-s">&quot;accion&quot;</span> <span class="tok-na">value=</span><span class="tok-s">&quot;redirect&quot;</span><span class="tok-nt">&gt;</span>
Redirigir a una pagina
<span class="tok-nt">&lt;/td&gt;</span>
<span class="tok-nt">&lt;td&gt;</span>
URL:
<span class="tok-nt">&lt;input</span> <span class="tok-na">type=</span><span class="tok-s">&quot;text&quot;</span> <span class="tok-na">name=</span><span class="tok-s">&quot;url&quot;</span> <span class="tok-na">value=</span><span class="tok-s">&quot;http://www.ua.es&quot;</span><span class="tok-nt">&gt;</span>
<span class="tok-nt">&lt;/td&gt;</span>
<span class="tok-nt">&lt;td&gt;&lt;/td&gt;</span>
<span class="tok-nt">&lt;/tr&gt;</span>

<span class="tok-nt">&lt;tr&gt;</span>
<span class="tok-nt">&lt;td&gt;</span>
<span class="tok-nt">&lt;input</span> <span class="tok-na">type=</span><span class="tok-s">&quot;radio&quot;</span> <span class="tok-na">name=</span><span class="tok-s">&quot;accion&quot;</span> <span class="tok-na">value=</span><span class="tok-s">&quot;error&quot;</span><span class="tok-nt">&gt;</span>
Mostrar pagina de error
<span class="tok-nt">&lt;/td&gt;</span>
<span class="tok-nt">&lt;td&gt;</span>
Mensaje:
<span class="tok-nt">&lt;input</span> <span class="tok-na">type=</span><span class="tok-s">&quot;text&quot;</span> <span class="tok-na">name=</span><span class="tok-s">&quot;mensaje&quot;</span>
<span class="tok-na">value=</span><span class="tok-s">&quot;Error generado por el usuario&quot;</span><span class="tok-nt">&gt;</span>
<span class="tok-nt">&lt;/td&gt;</span>
<span class="tok-nt">&lt;td&gt;</span>
Codigo:
<span class="tok-nt">&lt;select</span> <span class="tok-na">name=</span><span class="tok-s">&quot;codigoMensaje&quot;</span><span class="tok-nt">&gt;</span>
<span class="tok-nt">&lt;option</span> <span class="tok-na">name=</span><span class="tok-s">&quot;codigoMensaje&quot;</span> <span class="tok-na">value=</span><span class="tok-s">&quot;400&quot;</span><span class="tok-nt">&gt;</span>400<span class="tok-nt">&lt;/option&gt;</span>
<span class="tok-nt">&lt;option</span> <span class="tok-na">name=</span><span class="tok-s">&quot;codigoMensaje&quot;</span> <span class="tok-na">value=</span><span class="tok-s">&quot;401&quot;</span><span class="tok-nt">&gt;</span>401<span class="tok-nt">&lt;/option&gt;</span>
<span class="tok-nt">&lt;option</span> <span class="tok-na">name=</span><span class="tok-s">&quot;codigoMensaje&quot;</span> <span class="tok-na">value=</span><span class="tok-s">&quot;403&quot;</span><span class="tok-nt">&gt;</span>403<span class="tok-nt">&lt;/option&gt;</span>
<span class="tok-nt">&lt;option</span> <span class="tok-na">name=</span><span class="tok-s">&quot;codigoMensaje&quot;</span> <span class="tok-na">value=</span><span class="tok-s">&quot;404&quot;</span> <span class="tok-err">selected</span><span class="tok-nt">&gt;</span>404
<span class="tok-nt">&lt;/option&gt;</span>
<span class="tok-nt">&lt;/select&gt;</span>
<span class="tok-nt">&lt;/td&gt;</span>
<span class="tok-nt">&lt;/tr&gt;</span>

<span class="tok-nt">&lt;tr&gt;</span>
<span class="tok-nt">&lt;td&gt;</span>
<span class="tok-nt">&lt;input</span> <span class="tok-na">type=</span><span class="tok-s">&quot;radio&quot;</span> <span class="tok-na">name=</span><span class="tok-s">&quot;accion&quot;</span> <span class="tok-na">value=</span><span class="tok-s">&quot;codigo&quot;</span><span class="tok-nt">&gt;</span>
Enviar codigo de error
<span class="tok-nt">&lt;/td&gt;</span>
<span class="tok-nt">&lt;td&gt;</span>
Codigo:
<span class="tok-nt">&lt;select</span> <span class="tok-na">name=</span><span class="tok-s">&quot;codigo&quot;</span><span class="tok-nt">&gt;</span>
<span class="tok-nt">&lt;option</span> <span class="tok-na">name=</span><span class="tok-s">&quot;codigo&quot;</span> <span class="tok-na">value=</span><span class="tok-s">&quot;200&quot;</span><span class="tok-nt">&gt;</span>200<span class="tok-nt">&lt;/option&gt;</span>
<span class="tok-nt">&lt;option</span> <span class="tok-na">name=</span><span class="tok-s">&quot;codigo&quot;</span> <span class="tok-na">value=</span><span class="tok-s">&quot;204&quot;</span><span class="tok-nt">&gt;</span>204<span class="tok-nt">&lt;/option&gt;</span>
<span class="tok-nt">&lt;option</span> <span class="tok-na">name=</span><span class="tok-s">&quot;codigo&quot;</span> <span class="tok-na">value=</span><span class="tok-s">&quot;404&quot;</span> <span class="tok-err">selected</span><span class="tok-nt">&gt;</span>404<span class="tok-nt">&lt;/option&gt;</span>
<span class="tok-nt">&lt;/select&gt;</span>
<span class="tok-nt">&lt;/td&gt;</span>
<span class="tok-nt">&lt;td&gt;&lt;/td&gt;</span>
<span class="tok-nt">&lt;/tr&gt;</span>

<span class="tok-nt">&lt;/table&gt;</span>

<span class="tok-nt">&lt;input</span> <span class="tok-na">type=</span><span class="tok-s">&quot;submit&quot;</span> <span class="tok-na">value=</span><span class="tok-s">&quot;Enviar Datos&quot;</span><span class="tok-nt">&gt;</span>

<span class="tok-nt">&lt;/form&gt;</span>
<span class="tok-nt">&lt;/body&gt;</span>
<span class="tok-nt">&lt;/html&gt;</span></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_ejemplo_de_autentificación">2.5.3. Ejemplo de autentificación</h4>
<div class="paragraph">
<p>El siguiente servlet emplea las cabeceras de autentificación: envía una cabecera de autentificación si no ha recibido ninguna, o si la que ha recibido no está dentro de un conjunto de <code>Properties</code> predefinido, con logins y passwords válidos. En el caso de introducir un login o password válidos, muestra un mensaje de bienvenida.
Los logins y passwords están en un objeto <code>Properties</code>, definido en el método <code>init()</code>. Podríamos leer estos datos de un fichero, aunque por simplicidad aquí se definen como constantes de cadena.
Los datos de autentificación se envían codificados, y se emplea un objeto <code>sun.misc.BASE64Decoder</code> para descodificarlos y sacar el login y password.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span class="tok-kn">package</span> <span class="tok-n">ejemplos</span><span class="tok-o">;</span>

<span class="tok-kn">import</span> <span class="tok-nn">java.io.*</span><span class="tok-o">;</span>
<span class="tok-kn">import</span> <span class="tok-nn">java.util.*</span><span class="tok-o">;</span>
<span class="tok-kn">import</span> <span class="tok-nn">sun.misc.*</span><span class="tok-o">;</span>
<span class="tok-kn">import</span> <span class="tok-nn">javax.servlet.*</span><span class="tok-o">;</span>
<span class="tok-kn">import</span> <span class="tok-nn">javax.servlet.http.*</span><span class="tok-o">;</span>

<span class="tok-kd">public</span> <span class="tok-kd">class</span> <span class="tok-nc">ServletPassword</span> <span class="tok-kd">extends</span> <span class="tok-n">HttpServlet</span>
<span class="tok-o">{</span>
    <span class="tok-c1">// Conjunto de logins y passwords permitidos</span>
    <span class="tok-n">Properties</span> <span class="tok-n">datos</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-nf">Properties</span><span class="tok-o">();</span>

    <span class="tok-c1">// Metodo de inicializacion</span>

    <span class="tok-kd">public</span> <span class="tok-kt">void</span> <span class="tok-nf">init</span><span class="tok-o">()</span>
    <span class="tok-o">{</span>
        <span class="tok-n">datos</span><span class="tok-o">.</span><span class="tok-na">setProperty</span><span class="tok-o">(</span><span class="tok-s">&quot;usuario1&quot;</span><span class="tok-o">,</span> <span class="tok-s">&quot;password1&quot;</span><span class="tok-o">);</span>
        <span class="tok-n">datos</span><span class="tok-o">.</span><span class="tok-na">setProperty</span><span class="tok-o">(</span><span class="tok-s">&quot;usuario2&quot;</span><span class="tok-o">,</span> <span class="tok-s">&quot;password2&quot;</span><span class="tok-o">);</span>
    <span class="tok-o">}</span>

    <span class="tok-c1">// Metodo para GET</span>

    <span class="tok-kd">public</span> <span class="tok-kt">void</span> <span class="tok-nf">doGet</span><span class="tok-o">(</span><span class="tok-n">HttpServletRequest</span> <span class="tok-n">request</span><span class="tok-o">,</span>
                      <span class="tok-n">HttpServletResponse</span> <span class="tok-n">response</span><span class="tok-o">)</span>
                    <span class="tok-kd">throws</span> <span class="tok-n">ServletException</span><span class="tok-o">,</span> <span class="tok-n">IOException</span> <span class="tok-o">{</span>
        <span class="tok-n">response</span><span class="tok-o">.</span><span class="tok-na">setContentType</span><span class="tok-o">(</span><span class="tok-s">&quot;text/html&quot;</span><span class="tok-o">);</span>

        <span class="tok-c1">// Comprobamos si hay cabecera</span>
        <span class="tok-c1">// de autorizacion</span>

        <span class="tok-n">String</span> <span class="tok-n">autorizacion</span> <span class="tok-o">=</span> <span class="tok-n">request</span><span class="tok-o">.</span><span class="tok-na">getHeader</span><span class="tok-o">(</span><span class="tok-s">&quot;Authorization&quot;</span><span class="tok-o">);</span>

        <span class="tok-k">if</span> <span class="tok-o">(</span><span class="tok-n">autorizacion</span> <span class="tok-o">==</span> <span class="tok-kc">null</span><span class="tok-o">)</span> <span class="tok-o">{</span>
            <span class="tok-c1">// Enviamos el codigo 401 y</span>
            <span class="tok-c1">// la cabecera para autentificacion</span>

            <span class="tok-n">response</span><span class="tok-o">.</span><span class="tok-na">setStatus</span><span class="tok-o">(</span><span class="tok-n">response</span><span class="tok-o">.</span><span class="tok-na">SC_UNAUTHORIZED</span><span class="tok-o">);</span>
            <span class="tok-n">response</span><span class="tok-o">.</span><span class="tok-na">setHeader</span><span class="tok-o">(</span><span class="tok-s">&quot;WWW-Authenticate&quot;</span><span class="tok-o">,</span>
                               <span class="tok-s">&quot;BASIC realm=\&quot;privileged-few\&quot;&quot;</span><span class="tok-o">);</span>
        <span class="tok-o">}</span> <span class="tok-k">else</span> <span class="tok-o">{</span>
            <span class="tok-c1">// Obtenemos los datos del usuario</span>
            <span class="tok-c1">// y comparamos con los almacenados</span>

            <span class="tok-c1">// Quitamos los 6 primeros caracteres</span>
            <span class="tok-c1">// que indican tipo de autentificación</span>
            <span class="tok-c1">// (BASIC)</span>

            <span class="tok-n">String</span> <span class="tok-n">datosUsuario</span> <span class="tok-o">=</span>
                <span class="tok-n">autorizacion</span><span class="tok-o">.</span><span class="tok-na">substring</span><span class="tok-o">(</span><span class="tok-mi">6</span><span class="tok-o">).</span><span class="tok-na">trim</span><span class="tok-o">();</span>

            <span class="tok-n">BASE64Decoder</span> <span class="tok-n">dec</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-nf">BASE64Decoder</span><span class="tok-o">();</span>

            <span class="tok-n">String</span> <span class="tok-n">usuarioPassword</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-nf">String</span>
                <span class="tok-o">(</span><span class="tok-n">dec</span><span class="tok-o">.</span><span class="tok-na">decodeBuffer</span><span class="tok-o">(</span><span class="tok-n">datosUsuario</span><span class="tok-o">));</span>

            <span class="tok-kt">int</span> <span class="tok-n">indice</span> <span class="tok-o">=</span> <span class="tok-n">usuarioPassword</span><span class="tok-o">.</span><span class="tok-na">indexOf</span><span class="tok-o">(</span><span class="tok-s">&quot;:&quot;</span><span class="tok-o">);</span>

            <span class="tok-n">String</span> <span class="tok-n">usuario</span> <span class="tok-o">=</span>
                <span class="tok-n">usuarioPassword</span><span class="tok-o">.</span><span class="tok-na">substring</span><span class="tok-o">(</span><span class="tok-mi">0</span><span class="tok-o">,</span> <span class="tok-n">indice</span><span class="tok-o">);</span>

            <span class="tok-n">String</span> <span class="tok-n">password</span> <span class="tok-o">=</span>
                <span class="tok-n">usuarioPassword</span><span class="tok-o">.</span><span class="tok-na">substring</span><span class="tok-o">(</span><span class="tok-n">indice</span> <span class="tok-o">+</span> <span class="tok-mi">1</span><span class="tok-o">);</span>

            <span class="tok-n">String</span> <span class="tok-n">passwordReal</span> <span class="tok-o">=</span>
                <span class="tok-n">datos</span><span class="tok-o">.</span><span class="tok-na">getProperty</span><span class="tok-o">(</span><span class="tok-n">usuario</span><span class="tok-o">);</span>

            <span class="tok-k">if</span> <span class="tok-o">(</span><span class="tok-n">passwordReal</span> <span class="tok-o">!=</span> <span class="tok-kc">null</span> <span class="tok-o">&amp;&amp;</span>
                <span class="tok-n">passwordReal</span><span class="tok-o">.</span><span class="tok-na">equals</span><span class="tok-o">(</span><span class="tok-n">password</span><span class="tok-o">))</span> <span class="tok-o">{</span>

                <span class="tok-c1">// Mensaje de bienvenida</span>

                <span class="tok-n">PrintWriter</span> <span class="tok-n">out</span> <span class="tok-o">=</span> <span class="tok-n">response</span><span class="tok-o">.</span><span class="tok-na">getWriter</span><span class="tok-o">();</span>
                <span class="tok-n">out</span><span class="tok-o">.</span><span class="tok-na">println</span> <span class="tok-o">(</span><span class="tok-s">&quot;&lt;HTML&gt;&lt;BODY&gt;&quot;</span><span class="tok-o">);</span>
                <span class="tok-n">out</span><span class="tok-o">.</span><span class="tok-na">println</span> <span class="tok-o">(</span><span class="tok-s">&quot;OK&quot;</span><span class="tok-o">);</span>
                <span class="tok-n">out</span><span class="tok-o">.</span><span class="tok-na">println</span> <span class="tok-o">(</span><span class="tok-s">&quot;&lt;/BODY&gt;&lt;/HTML&gt;&quot;</span><span class="tok-o">);</span>
            <span class="tok-o">}</span> <span class="tok-k">else</span> <span class="tok-o">{</span>

                <span class="tok-c1">// Pedir autentificacion</span>

                <span class="tok-n">response</span><span class="tok-o">.</span><span class="tok-na">setStatus</span><span class="tok-o">(</span><span class="tok-n">response</span><span class="tok-o">.</span><span class="tok-na">SC_UNAUTHORIZED</span><span class="tok-o">);</span>
                <span class="tok-n">response</span><span class="tok-o">.</span><span class="tok-na">setHeader</span><span class="tok-o">(</span><span class="tok-s">&quot;WWW-Authenticate&quot;</span><span class="tok-o">,</span>
                           <span class="tok-s">&quot;BASIC realm=\&quot;privileged-few\&quot;&quot;</span><span class="tok-o">);</span>
            <span class="tok-o">}</span>
        <span class="tok-o">}</span>
    <span class="tok-o">}</span>

    <span class="tok-c1">// Metodo para POST</span>

    <span class="tok-kd">public</span> <span class="tok-kt">void</span> <span class="tok-nf">doPost</span><span class="tok-o">(</span><span class="tok-n">HttpServletRequest</span> <span class="tok-n">request</span><span class="tok-o">,</span>
                       <span class="tok-n">HttpServletResponse</span> <span class="tok-n">response</span><span class="tok-o">)</span>
                     <span class="tok-kd">throws</span> <span class="tok-n">ServletException</span><span class="tok-o">,</span> <span class="tok-n">IOException</span> <span class="tok-o">{</span>
        <span class="tok-n">doGet</span><span class="tok-o">(</span><span class="tok-n">request</span><span class="tok-o">,</span> <span class="tok-n">response</span><span class="tok-o">);</span>
    <span class="tok-o">}</span>
<span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Se puede probar cada ejemplo, respectivamente, con:</p>
</div>
<div class="paragraph">
<p><a href="http://localhost:8080/appcab/inicioCabecerasPeticion.html" class="bare">http://localhost:8080/appcab/inicioCabecerasPeticion.html</a></p>
</div>
<div class="paragraph">
<p><a href="http://localhost:8080/appcab/inicioCabecerasRespuesta.html" class="bare">http://localhost:8080/appcab/inicioCabecerasRespuesta.html</a></p>
</div>
<div class="paragraph">
<p><a href="http://localhost:8080/appcab/servlet/ejemplos.ServletPassword" class="bare">http://localhost:8080/appcab/servlet/ejemplos.ServletPassword</a></p>
</div>
<div class="paragraph">
<p>Un ejemplo de login y password válidos para el tercer ejemplo es: login=<code>usuario1</code>, password=<code>password1</code>.</p>
</div>
<div style="page-break-after: always;"></div>
</div>
</div>
<div class="sect2">
<h3 id="_ejercicios">2.6. Ejercicios</h3>
<div class="sect3">
<h4 id="_recogida_de_parámetros_del_usuario_0_3_puntos">2.6.1. Recogida de parámetros del usuario (0,3 puntos)</h4>
<div class="paragraph">
<p>La aplicación <code>cweb-peticiones</code> contiene un formulario <code>form_datos.html</code> con una serie de campos (tipo texto, listas, checkboxes&#8230;&#8203;). Se pide que dicho formulario, en su <em>action</em>, llame al servlet <code>org.expertojava.cweb.ejercicios.DatosServlet</code> que deberéis crear e implementar. El servlet recogerá todos los parámetros del formulario y los mostrará en una tabla de dos columnas (una con el nombre del parámetro y otra con el valor).</p>
</div>
</div>
<div class="sect3">
<h4 id="_trabajando_con_redirecciones_0_4_puntos">2.6.2. Trabajando con redirecciones (0,4 puntos)</h4>
<div class="paragraph">
<p>Sobre la aplicación anterior, tenemos otro formulario <code>form_datos2.html</code> idéntico al del ejercicio anterior, que deberá llamar al servlet <code>org.expertojava.cweb.ejercicios.DatosServlet2</code>. Crear este servlet y hacer que redirija a la página <code>bienvenida.html</code> con un mensaje de bienvenida, si los datos introducidos en el formulario son correctos, y a la misma página <code>form_datos2.html</code> si hay algún dato incorrecto. Entenderemos por dato incorrecto que alguno de los campos de texto se quede vacío. Utilizad el método <code>sendRedirect</code> de la respuesta para las redirecciones.</p>
</div>
</div>
<div class="sect3">
<h4 id="_un_buscador_sencillo_0_4_puntos">2.6.3. Un buscador sencillo (0,4 puntos)</h4>
<div class="paragraph">
<p>En el fichero <code>libros.txt</code> hay un listado de libros, indicando su ISBN, título y autor. Cread e implementad un servlet <code>org.expertojava.cweb.ejercicios.LibroServlet</code> que lea dicho fichero, guarde los libros en un <code>ArrayList</code>, y reciba un parámetro <code>cadena</code>. Como resultado, sacará todos los libros de la lista que contengan dicha cadena (en el título, en el autor, o en cualquier parte de la cadena). Podéis hacer también una página HTML <code>libros.html</code> con el formulario de búsqueda que llame al servlet, para poderlo probar.</p>
</div>
<div class="paragraph">
<p>Para leer los libros, en la inicialización del servlet podemos utilizar un código como el siguiente:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span class="tok-n">ArrayList</span><span class="tok-o">&lt;</span><span class="tok-n">String</span><span class="tok-o">&gt;</span> <span class="tok-n">libros</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">ArrayList</span><span class="tok-o">&lt;</span><span class="tok-n">String</span><span class="tok-o">&gt;();</span>
<span class="tok-o">...</span>
<span class="tok-n">InputStream</span> <span class="tok-n">is</span> <span class="tok-o">=</span> <span class="tok-n">getClass</span><span class="tok-o">().</span><span class="tok-na">getResourceAsStream</span><span class="tok-o">(</span><span class="tok-s">&quot;/libros.txt&quot;</span><span class="tok-o">);</span>
<span class="tok-n">BufferedReader</span> <span class="tok-n">br</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-nf">BufferedReader</span><span class="tok-o">(</span><span class="tok-k">new</span> <span class="tok-nf">InputStreamReader</span><span class="tok-o">(</span><span class="tok-n">is</span><span class="tok-o">));</span>
<span class="tok-n">String</span> <span class="tok-n">libro</span><span class="tok-o">;</span>
<span class="tok-k">try</span> <span class="tok-o">{</span>
  <span class="tok-k">while</span><span class="tok-o">(</span> <span class="tok-o">(</span><span class="tok-n">libro</span><span class="tok-o">=</span><span class="tok-n">br</span><span class="tok-o">.</span><span class="tok-na">readLine</span><span class="tok-o">())!=</span><span class="tok-kc">null</span> <span class="tok-o">)</span> <span class="tok-o">{</span>
    <span class="tok-n">libros</span><span class="tok-o">.</span><span class="tok-na">add</span><span class="tok-o">(</span><span class="tok-n">libro</span><span class="tok-o">);</span>
  <span class="tok-o">}</span>
<span class="tok-o">}</span> <span class="tok-k">catch</span> <span class="tok-o">(</span><span class="tok-n">IOException</span> <span class="tok-n">e</span><span class="tok-o">)</span> <span class="tok-o">{</span> <span class="tok-o">}</span></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_distinguir_el_navegador_0_3_puntos">2.6.4. Distinguir el navegador (0,3 puntos)</h4>
<div class="paragraph">
<p>Muchas veces, cuando escribamos una aplicación Web, nos va a interesar poder distinguir el tipo de navegador que está utilizando el cliente, porque en función
  del mismo se podrán hacer o no determinadas acciones. Por ejemplo, el código Javascript que se emplea en un navegador Internet Explorer es diferente a veces del
  que se emplea en uno Mozilla. Para probar a distinguir entre navegadores, vamos a crear el servlet <code>org.expertojava.cweb.ejercicios.NavServlet</code> para
  que identifique si el cliente accede desde un tipo de navegador u otro. Para ello leemos la cabecera <code>User-Agent</code> con el método <code>getHeader(&#8230;&#8203;)</code>
  de la petición, y comprobamos su valor. Mostrad la cadena en una página, y cargad dicha página desde dos o tres navegadores diferentes. Cada uno mostrará algún rasgo
  distintivo en dicha cadena, que lo identifique de los demás. Una vez tengáis una parte de texto que los diferencia (por ejemplo, en Firefox el
  <code>User-Agent</code> tiene la cadena "Firefox", y en el otro navegador (Mozilla, por ejemplo), no la tiene) haríamos con algo como:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span class="tok-kd">public</span> <span class="tok-kt">void</span> <span class="tok-nf">doGet</span><span class="tok-o">(</span><span class="tok-n">HttpServletRequest</span> <span class="tok-n">req</span><span class="tok-o">,</span> <span class="tok-o">...)</span> <span class="tok-kd">throws</span> <span class="tok-o">...</span>
<span class="tok-o">{</span>
  <span class="tok-n">String</span> <span class="tok-n">nav</span> <span class="tok-o">=</span> <span class="tok-n">req</span><span class="tok-o">.</span><span class="tok-na">getHeader</span><span class="tok-o">(</span><span class="tok-s">&quot;User-Agent&quot;</span><span class="tok-o">);</span>
  <span class="tok-c1">// Cambiar &quot;Firefox&quot; por el texto que sea</span>
  <span class="tok-k">if</span> <span class="tok-o">(</span><span class="tok-n">nav</span><span class="tok-o">.</span><span class="tok-na">indexOf</span><span class="tok-o">(</span><span class="tok-s">&quot;Firefox&quot;</span><span class="tok-o">)</span> <span class="tok-o">!=</span> <span class="tok-o">-</span><span class="tok-mi">1</span><span class="tok-o">)</span>
    <span class="tok-o">...</span> <span class="tok-c1">// Firefox</span>
  <span class="tok-k">else</span>
    <span class="tok-o">...</span> <span class="tok-c1">// Otro navegador (Mozilla)</span>
  <span class="tok-o">...</span>
<span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Una vez distinguido el navegador, ya se podría hacer algo que sólo sirviera para ese navegador. En este caso, por simplificar, vamos a cargar como imagen el logo
  del navegador que hayamos detectado. Tenéis en la plantilla las imágenes correspondientes diferentes navegadores (directorio <code>webapp/logos</code>). Colocad
  como imagen de la página la del navegador que hayáis detectado (con una etiqueta <code>&lt;img&gt;</code> de HTML).</p>
</div>
</div>
<div class="sect3">
<h4 id="_redirecciones_con_retardo_0_3_puntos">2.6.5. Redirecciones con retardo (0,3 puntos)</h4>
<div class="paragraph">
<p>El formulario <code>form_datos3.html</code> se envía al servlet <code>org.expertojava.cweb.ejercicios.CompruebaServlet</code>. Se pide crear e implementar dicho servlet para comprobar que los datos sean correctos (que no haya ningún campo de texto vacío). En el caso de que no haya errores el servlet simplemente mostrará un mensaje indicando que todo ha ido bien. Si hay algún error, el servlet debe redirigir al servlet <code>org.expertojava.cweb.ejercicios.ErrorCompruebaServlet</code>, que deberéis crear para que muestre un mensaje con el error producido (indicando qué campo está incompleto), y a los 5 segundos redirija al formulario anterior</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
Se puede utilizar la cabecera de respuesta <code>Refresh</code> con valor <code>5; url=form_datos3.html</code>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_loggear_variables_cgi_0_3_puntos">2.6.6. Loggear variables CGI (0,3 puntos)</h4>
<div class="paragraph">
<p>Sobre el servlet <code>org.expertojava.cweb.ejercicios.CompruebaServlet</code> anterior vamos a añadir mensajes de log de tipo INFO, para que:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Tras cada petición (por <code>doGet</code> o <code>doPost</code>), genere un mensaje de tipo INFO que indique la IP del cliente que solicitó la petición (variable CGI <code>REMOTE_ADDR</code>), el tipo de petición (variable CGI REQUEST_METHOD), y el tipo de navegador (cabecera <code>User-Agent</code>).</p>
</li>
<li>
<p>El mensaje en conjunto deberá tener el formato siguiente (se incluyen en las plantillas los ficheros de configuración para obtener este formato):</p>
<div class="paragraph">
<p><code>día/mes/año hora:minuto:segundo - texto del mensaje - nueva línea</code></p>
</div>
</li>
</ul>
</div>
</div>
</div>
</div>
</div>
</div>
<div id="footer">
<div id="footer-text">
Last updated 2015-10-06 12:16:54 CEST
</div>
</div>
</body>
</html>