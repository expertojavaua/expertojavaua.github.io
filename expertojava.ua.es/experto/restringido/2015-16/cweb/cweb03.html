<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<!--[if IE]><meta http-equiv="X-UA-Compatible" content="IE=edge"><![endif]-->
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 1.5.2">
<meta name="author" content="Miguel Angel Lozano">
<title>Componentes Web</title>
<style>/*! normalize.css v2.1.2 | MIT License | git.io/normalize */
/* ========================================================================== HTML5 display definitions ========================================================================== */
/** Correct `block` display not defined in IE 8/9. */
article, aside, details, figcaption, figure, footer, header, hgroup, main, nav, section, summary { display: block; }

/** Correct `inline-block` display not defined in IE 8/9. */
audio, canvas, video { display: inline-block; }

/** Prevent modern browsers from displaying `audio` without controls. Remove excess height in iOS 5 devices. */
audio:not([controls]) { display: none; height: 0; }

/** Address `[hidden]` styling not present in IE 8/9. Hide the `template` element in IE, Safari, and Firefox < 22. */
[hidden], template { display: none; }

script { display: none !important; }

/* ========================================================================== Base ========================================================================== */
/** 1. Set default font family to sans-serif. 2. Prevent iOS text size adjust after orientation change, without disabling user zoom. */
html { font-family: sans-serif; /* 1 */ -ms-text-size-adjust: 100%; /* 2 */ -webkit-text-size-adjust: 100%; /* 2 */ }

/** Remove default margin. */
body { margin: 0; }

/* ========================================================================== Links ========================================================================== */
/** Remove the gray background color from active links in IE 10. */
a { background: transparent; }

/** Address `outline` inconsistency between Chrome and other browsers. */
a:focus { outline: thin dotted; }

/** Improve readability when focused and also mouse hovered in all browsers. */
a:active, a:hover { outline: 0; }

/* ========================================================================== Typography ========================================================================== */
/** Address variable `h1` font-size and margin within `section` and `article` contexts in Firefox 4+, Safari 5, and Chrome. */
h1 { font-size: 2em; margin: 0.67em 0; }

/** Address styling not present in IE 8/9, Safari 5, and Chrome. */
abbr[title] { border-bottom: 1px dotted; }

/** Address style set to `bolder` in Firefox 4+, Safari 5, and Chrome. */
b, strong { font-weight: bold; }

/** Address styling not present in Safari 5 and Chrome. */
dfn { font-style: italic; }

/** Address differences between Firefox and other browsers. */
hr { -moz-box-sizing: content-box; box-sizing: content-box; height: 0; }

/** Address styling not present in IE 8/9. */
mark { background: #ff0; color: #000; }

/** Correct font family set oddly in Safari 5 and Chrome. */
code, kbd, pre, samp { font-family: monospace, serif; font-size: 1em; }

/** Improve readability of pre-formatted text in all browsers. */
pre { white-space: pre-wrap; }

/** Set consistent quote types. */
q { quotes: "\201C" "\201D" "\2018" "\2019"; }

/** Address inconsistent and variable font size in all browsers. */
small { font-size: 80%; }

/** Prevent `sub` and `sup` affecting `line-height` in all browsers. */
sub, sup { font-size: 75%; line-height: 0; position: relative; vertical-align: baseline; }

sup { top: -0.5em; }

sub { bottom: -0.25em; }

/* ========================================================================== Embedded content ========================================================================== */
/** Remove border when inside `a` element in IE 8/9. */
img { border: 0; }

/** Correct overflow displayed oddly in IE 9. */
svg:not(:root) { overflow: hidden; }

/* ========================================================================== Figures ========================================================================== */
/** Address margin not present in IE 8/9 and Safari 5. */
figure { margin: 0; }

/* ========================================================================== Forms ========================================================================== */
/** Define consistent border, margin, and padding. */
fieldset { border: 1px solid #c0c0c0; margin: 0 2px; padding: 0.35em 0.625em 0.75em; }

/** 1. Correct `color` not being inherited in IE 8/9. 2. Remove padding so people aren't caught out if they zero out fieldsets. */
legend { border: 0; /* 1 */ padding: 0; /* 2 */ }

/** 1. Correct font family not being inherited in all browsers. 2. Correct font size not being inherited in all browsers. 3. Address margins set differently in Firefox 4+, Safari 5, and Chrome. */
button, input, select, textarea { font-family: inherit; /* 1 */ font-size: 100%; /* 2 */ margin: 0; /* 3 */ }

/** Address Firefox 4+ setting `line-height` on `input` using `!important` in the UA stylesheet. */
button, input { line-height: normal; }

/** Address inconsistent `text-transform` inheritance for `button` and `select`. All other form control elements do not inherit `text-transform` values. Correct `button` style inheritance in Chrome, Safari 5+, and IE 8+. Correct `select` style inheritance in Firefox 4+ and Opera. */
button, select { text-transform: none; }

/** 1. Avoid the WebKit bug in Android 4.0.* where (2) destroys native `audio` and `video` controls. 2. Correct inability to style clickable `input` types in iOS. 3. Improve usability and consistency of cursor style between image-type `input` and others. */
button, html input[type="button"], input[type="reset"], input[type="submit"] { -webkit-appearance: button; /* 2 */ cursor: pointer; /* 3 */ }

/** Re-set default cursor for disabled elements. */
button[disabled], html input[disabled] { cursor: default; }

/** 1. Address box sizing set to `content-box` in IE 8/9. 2. Remove excess padding in IE 8/9. */
input[type="checkbox"], input[type="radio"] { box-sizing: border-box; /* 1 */ padding: 0; /* 2 */ }

/** 1. Address `appearance` set to `searchfield` in Safari 5 and Chrome. 2. Address `box-sizing` set to `border-box` in Safari 5 and Chrome (include `-moz` to future-proof). */
input[type="search"] { -webkit-appearance: textfield; /* 1 */ -moz-box-sizing: content-box; -webkit-box-sizing: content-box; /* 2 */ box-sizing: content-box; }

/** Remove inner padding and search cancel button in Safari 5 and Chrome on OS X. */
input[type="search"]::-webkit-search-cancel-button, input[type="search"]::-webkit-search-decoration { -webkit-appearance: none; }

/** Remove inner padding and border in Firefox 4+. */
button::-moz-focus-inner, input::-moz-focus-inner { border: 0; padding: 0; }

/** 1. Remove default vertical scrollbar in IE 8/9. 2. Improve readability and alignment in all browsers. */
textarea { overflow: auto; /* 1 */ vertical-align: top; /* 2 */ }

/* ========================================================================== Tables ========================================================================== */
/** Remove most spacing between table cells. */
table { border-collapse: collapse; border-spacing: 0; }

meta.foundation-mq-small { font-family: "only screen and (min-width: 768px)"; width: 768px; }

meta.foundation-mq-medium { font-family: "only screen and (min-width:1280px)"; width: 1280px; }

meta.foundation-mq-large { font-family: "only screen and (min-width:1440px)"; width: 1440px; }

*, *:before, *:after { -moz-box-sizing: border-box; -webkit-box-sizing: border-box; box-sizing: border-box; }

html, body { font-size: 97%; }

body { background: white; color: #222222; padding: 0; margin: 0; font-family: "Helvetica Neue", "Helvetica", Helvetica, Arial, sans-serif; font-weight: normal; font-style: normal; line-height: 1; position: relative; cursor: auto; }

a:hover { cursor: pointer; }

img, object, embed { max-width: 100%; height: auto; }

object, embed { height: 100%; }

img { -ms-interpolation-mode: bicubic; }

#map_canvas img, #map_canvas embed, #map_canvas object, .map_canvas img, .map_canvas embed, .map_canvas object { max-width: none !important; }

.left { float: left !important; }

.right { float: right !important; }

.text-left { text-align: left !important; }

.text-right { text-align: right !important; }

.text-center { text-align: center !important; }

.text-justify { text-align: justify !important; }

.hide { display: none; }

.antialiased, body { -webkit-font-smoothing: antialiased; }

img { display: inline-block; vertical-align: middle; }

textarea { height: auto; min-height: 50px; }

select { width: 100%; }

p.lead, .paragraph.lead > p, #preamble > .sectionbody > .paragraph:first-of-type p { font-size: 1.21875em; line-height: 1.6; }

.subheader, .admonitionblock td.content > .title, .audioblock > .title, .exampleblock > .title, .imageblock > .title, .listingblock > .title, .literalblock > .title, .stemblock > .title, .openblock > .title, .paragraph > .title, .quoteblock > .title, table.tableblock > .title, .verseblock > .title, .videoblock > .title, .dlist > .title, .olist > .title, .ulist > .title, .qlist > .title, .hdlist > .title { line-height: 1.4; color: #6f6f6f; font-weight: 300; margin-top: 0.2em; margin-bottom: 0.5em; }

/* Typography resets */
div, dl, dt, dd, ul, ol, li, h1, h2, h3, #toctitle, .sidebarblock > .content > .title, h4, h5, h6, pre, form, p, blockquote, th, td { margin: 0; padding: 0; direction: ltr; }

/* Default Link Styles */
a { color: #1164be; text-decoration: none; line-height: inherit; }
a img { border: none; }

/* Default paragraph styles */
p { font-family: inherit; font-weight: normal; font-size: 1em; line-height: 1.4; margin-bottom: 1em; text-rendering: optimizeLegibility; }
p aside { font-size: 0.875em; line-height: 1.35; font-style: italic; }

/* Default header styles */
h1, h2, h3, #toctitle, .sidebarblock > .content > .title, h4, h5, h6 { font-family: "Helvetica Neue", "Helvetica", Helvetica, Arial, sans-serif; font-weight: bold; font-style: normal; color: #1c355e; text-rendering: optimizeLegibility; margin-top: 1em; margin-bottom: 0.5em; line-height: 1.2125em; }
h1 small, h2 small, h3 small, #toctitle small, .sidebarblock > .content > .title small, h4 small, h5 small, h6 small { font-size: 60%; color: #6f6f6f; line-height: 0; }

h1 { font-size: 2.125em; }

h2 { font-size: 1.6875em; }

h3, #toctitle, .sidebarblock > .content > .title { font-size: 1.375em; }

h4 { font-size: 1.125em; }

h5 { font-size: 1.125em; }

h6 { font-size: 1em; }

hr { border: solid #dddddd; border-width: 1px 0 0; clear: both; margin: 1.25em 0 1.1875em; height: 0; }

/* Helpful Typography Defaults */
em, i { font-style: italic; line-height: inherit; }

strong, b { font-weight: bold; line-height: inherit; }

small { font-size: 60%; line-height: inherit; }

code { font-family: Consolas, "Liberation Mono", Courier, monospace; font-weight: bold; }

/* Lists */
ul, ol, dl { font-size: 1em; line-height: 1.4; margin-bottom: 1.25em; list-style-position: outside; font-family: inherit; }

ul, ol { margin-left: 2.5em; }
ul.no-bullet, ol.no-bullet { margin-left: 1.5em; }

/* Unordered Lists */
ul li ul, ul li ol { margin-left: 1.25em; margin-bottom: 0; font-size: 1em; /* Override nested font-size change */ }
ul.square li ul, ul.circle li ul, ul.disc li ul { list-style: inherit; }
ul.square { list-style-type: square; }
ul.circle { list-style-type: circle; }
ul.disc { list-style-type: disc; }
ul.no-bullet { list-style: none; }

/* Ordered Lists */
ol li ul, ol li ol { margin-left: 1.25em; margin-bottom: 0; }

/* Definition Lists */
dl dt { margin-bottom: 0.3125em; font-weight: bold; }
dl dd { margin-bottom: 1.25em; }

/* Abbreviations */
abbr, acronym { text-transform: uppercase; font-size: 90%; color: #222222; border-bottom: 1px dotted #dddddd; cursor: help; }

abbr { text-transform: none; }

/* Blockquotes */
blockquote { margin: 0 0 1.25em; padding: 0.5625em 1.25em 0 1.1875em; border-left: 1px solid #dddddd; }
blockquote cite { display: block; font-size: 0.8125em; color: #555555; }
blockquote cite:before { content: "\2014 \0020"; }
blockquote cite a, blockquote cite a:visited { color: #555555; }

blockquote, blockquote p { line-height: 1.6; color: #6f6f6f; }

/* Microformats */
.vcard { display: inline-block; margin: 0 0 1.25em 0; border: 1px solid #dddddd; padding: 0.625em 0.75em; }
.vcard li { margin: 0; display: block; }
.vcard .fn { font-weight: bold; font-size: 0.9375em; }

.vevent .summary { font-weight: bold; }
.vevent abbr { cursor: auto; text-decoration: none; font-weight: bold; border: none; padding: 0 0.0625em; }

/*@media only screen and (min-width: 768px) { h1, h2, h3, #toctitle, .sidebarblock > .content > .title, h4, h5, h6 { line-height: 1.4; }
  h1 { font-size: 2.75em; }
  h2 { font-size: 2.3125em; }
  h3, #toctitle, .sidebarblock > .content > .title { font-size: 1.6875em; }
  h4 { font-size: 1.4375em; } }*/
/* Tables */
table { background: white; margin-bottom: 1.25em; border: solid 1px #dddddd; }
table thead, table tfoot { background: whitesmoke; font-weight: bold; }
table thead tr th, table thead tr td, table tfoot tr th, table tfoot tr td { padding: 0.5em 0.625em 0.625em; font-size: inherit; color: #222222; text-align: left; }
table tr th, table tr td { padding: 0.5625em 0.625em; font-size: inherit; color: #222222; }
table tr.even, table tr.alt, table tr:nth-of-type(even) { background: #f9f9f9; }
table thead tr th, table tfoot tr th, table tbody tr td, table tr td, table tfoot tr td { display: table-cell; line-height: 1.4; }

h1, h2, h3, #toctitle, .sidebarblock > .content > .title, h4, h5, h6 { line-height: 1.4; border-bottom: 1px solid #dddddd }

.clearfix:before, .clearfix:after, .float-group:before, .float-group:after { content: " "; display: table; }
.clearfix:after, .float-group:after { clear: both; }

*:not(pre) > code { font-size: inherit; font-style: normal !important; letter-spacing: 0; padding: 3px 2px 1px 2px; background-color: #eeeeee; border: 1px solid #dddddd; -webkit-border-radius: 0; border-radius: 0; line-height: inherit; font-weight: normal; }

pre, pre > code { line-height: 1.4; color: black; font-family: monospace, serif; font-weight: normal; }

.keyseq { color: #555555; }

kbd { display: inline-block; color: #222222; font-size: 0.75em; line-height: 1.4; background-color: #f7f7f7; border: 1px solid #ccc; -webkit-border-radius: 3px; border-radius: 3px; -webkit-box-shadow: 0 1px 0 rgba(0, 0, 0, 0.2), 0 0 0 0.1em white inset; box-shadow: 0 1px 0 rgba(0, 0, 0, 0.2), 0 0 0 0.1em white inset; margin: -0.15em 0.15em 0 0.15em; padding: 0.2em 0.6em 0.2em 0.5em; vertical-align: middle; white-space: nowrap; }

.keyseq kbd:first-child { margin-left: 0; }

.keyseq kbd:last-child { margin-right: 0; }

.menuseq, .menu { color: #090909; }

b.button:before, b.button:after { position: relative; top: -1px; font-weight: normal; }

b.button:before { content: "["; padding: 0 3px 0 2px; }

b.button:after { content: "]"; padding: 0 2px 0 3px; }

#header, #content, #footnotes, #footer { width: 100%; margin-left: auto; margin-right: auto; margin-top: 0; margin-bottom: 0; max-width: 62.5em; *zoom: 1; position: relative; padding-left: 0.9375em; padding-right: 0.9375em; }
#header:before, #header:after, #content:before, #content:after, #footnotes:before, #footnotes:after, #footer:before, #footer:after { content: " "; display: table; }
#header:after, #content:after, #footnotes:after, #footer:after { clear: both; }

#content { margin-top: 1.25em; }

#content:before { content: none; }

#header > h1:first-child { color: black; margin-top: 2.25rem; margin-bottom: 0; }
#header > h1:first-child + #toc { margin-top: 8px; border-top: 1px solid #dddddd; }
#header > h1:only-child, body.toc2 #header > h1:nth-last-child(2) { border-bottom: 1px solid #dddddd; padding-bottom: 8px; }
#header .details { border-bottom: 1px solid #dddddd; line-height: 1.45; padding-top: 0.25em; padding-bottom: 0.25em; padding-left: 0.25em; color: #555555; display: -ms-flexbox; display: -webkit-flex; display: flex; -ms-flex-flow: row wrap; -webkit-flex-flow: row wrap; flex-flow: row wrap; }
#header .details span:first-child { margin-left: -0.125em; }
#header .details span.email a { color: #6f6f6f; }
#header .details br { display: none; }
#header .details br + span:before { content: "\00a0\2013\00a0"; }
#header .details br + span.author:before { content: "\00a0\22c5\00a0"; color: #6f6f6f; }
#header .details br + span#revremark:before { content: "\00a0|\00a0"; }
#header #revnumber { text-transform: capitalize; }
#header #revnumber:after { content: "\00a0"; }

#content > h1:first-child:not([class]) { color: black; border-bottom: 1px solid #dddddd; padding-bottom: 8px; margin-top: 0; padding-top: 1rem; margin-bottom: 1.25rem; }

#floating {
  position: fixed;
  z-index: 1000;
  padding: 0.5em;
  right: 0;
  top: 0;
  background: white;
  box-shadow: 0 0 1em #777777;
  -webkit-box-shadow: 0 0 1em #777777;
  -moz-box-shadow: 0 0 1em #777777;
  -webkit-border-bottom-left-radius: 5px;
  -moz-border-radius-bottomleft: 5px;
  max-height: 80%;
  overflow: auto;
}

#floating #full { display: none; } /* Hide the full TOC by default */

#floating:hover #full{
  display: block; /* Show it on hover */
}


#toc { border-bottom: 1px solid #dddddd; padding-bottom: 0.5em; }
#toc > ul { margin-left: 0.125em; }
#toc ul.sectlevel0 > li > a { font-style: italic; }
#toc ul.sectlevel0 ul.sectlevel1 { margin: 0.5em 0; }
#toc ul { font-family: "Helvetica Neue", "Helvetica", Helvetica, Arial, sans-serif; list-style-type: none; }
#toc a { text-decoration: none; }
#toc a:active { text-decoration: underline; }

#toctitle { color: #6f6f6f; font-size: 1.2em; }

@media only screen and (min-width: 768px) { #toctitle { font-size: 1.375em; }
  body.toc2 { padding-left: 15em; padding-right: 0; }
  #toc.toc2 { margin-top: 0 !important; background-color: #f2f2f2; position: fixed; width: 15em; left: 0; top: 0; border-right: 1px solid #dddddd; border-top-width: 0 !important; border-bottom-width: 0 !important; z-index: 1000; padding: 1.25em 1em; height: 100%; overflow: auto; }
  #toc.toc2 #toctitle { margin-top: 0; font-size: 1.2em; }
  #toc.toc2 > ul { font-size: 0.9em; margin-bottom: 0; }
  #toc.toc2 ul ul { margin-left: 0; padding-left: 1em; }
  #toc.toc2 ul.sectlevel0 ul.sectlevel1 { padding-left: 0; margin-top: 0.5em; margin-bottom: 0.5em; }
  body.toc2.toc-right { padding-left: 0; padding-right: 15em; }
  body.toc2.toc-right #toc.toc2 { border-right-width: 0; border-left: 1px solid #dddddd; left: auto; right: 0; } }
@media only screen and (min-width: 1280px) { body.toc2 { padding-left: 20em; padding-right: 0; }
  #toc.toc2 { width: 20em; }
  #toc.toc2 #toctitle { font-size: 1.375em; }
  #toc.toc2 > ul { font-size: 0.95em; }
  #toc.toc2 ul ul { padding-left: 1.25em; }
  body.toc2.toc-right { padding-left: 0; padding-right: 20em; } }
#content #toc { border-style: solid; border-width: 1px; border-color: #d9d9d9; margin-bottom: 1.25em; padding: 1.25em; background: #f2f2f2; -webkit-border-radius: 0; border-radius: 0; }
#content #toc > :first-child { margin-top: 0; }
#content #toc > :last-child { margin-bottom: 0; }

#footer { max-width: 100%; background-color: #222222; padding: 1.25em; }

#footer-text { color: #dddddd; line-height: 1.44; }

.sect1 { padding-bottom: 0.625em; }

@media only screen and (min-width: 768px) { .sect1 { padding-bottom: 1.25em; } }
.sect1 + .sect1 { border-top: 1px solid #dddddd; }

#content h1 > a.anchor, h2 > a.anchor, h3 > a.anchor, #toctitle > a.anchor, .sidebarblock > .content > .title > a.anchor, h4 > a.anchor, h5 > a.anchor, h6 > a.anchor { position: absolute; z-index: 1001; width: 1.5ex; margin-left: -1.5ex; display: block; text-decoration: none !important; visibility: hidden; text-align: center; font-weight: normal; }
#content h1 > a.anchor:before, h2 > a.anchor:before, h3 > a.anchor:before, #toctitle > a.anchor:before, .sidebarblock > .content > .title > a.anchor:before, h4 > a.anchor:before, h5 > a.anchor:before, h6 > a.anchor:before { content: "\00A7"; font-size: 0.85em; display: block; padding-top: 0.1em; }
#content h1:hover > a.anchor, #content h1 > a.anchor:hover, h2:hover > a.anchor, h2 > a.anchor:hover, h3:hover > a.anchor, #toctitle:hover > a.anchor, .sidebarblock > .content > .title:hover > a.anchor, h3 > a.anchor:hover, #toctitle > a.anchor:hover, .sidebarblock > .content > .title > a.anchor:hover, h4:hover > a.anchor, h4 > a.anchor:hover, h5:hover > a.anchor, h5 > a.anchor:hover, h6:hover > a.anchor, h6 > a.anchor:hover { visibility: visible; }
#content h1 > a.link, h2 > a.link, h3 > a.link, #toctitle > a.link, .sidebarblock > .content > .title > a.link, h4 > a.link, h5 > a.link, h6 > a.link { color: #222222; text-decoration: none; }
#content h1 > a.link:hover, h2 > a.link:hover, h3 > a.link:hover, #toctitle > a.link:hover, .sidebarblock > .content > .title > a.link:hover, h4 > a.link:hover, h5 > a.link:hover, h6 > a.link:hover { color: #151515; }

.audioblock, .imageblock, .literalblock, .listingblock, .stemblock, .videoblock { margin-bottom: 1.25em; }

.admonitionblock td.content > .title, .audioblock > .title, .exampleblock > .title, .imageblock > .title, .listingblock > .title, .literalblock > .title, .stemblock > .title, .openblock > .title, .paragraph > .title, .quoteblock > .title, table.tableblock > .title, .verseblock > .title, .videoblock > .title, .dlist > .title, .olist > .title, .ulist > .title, .qlist > .title, .hdlist > .title { text-rendering: optimizeLegibility; text-align: left; }

table.tableblock > caption.title { white-space: nowrap; overflow: visible; max-width: 0; }

.paragraph.lead > p, #preamble > .sectionbody > .paragraph:first-of-type p { color: black; }

table.tableblock #preamble > .sectionbody > .paragraph:first-of-type p { font-size: inherit; }

.admonitionblock > table { border-collapse: separate; border: 0; background: none; width: 100%; }
.admonitionblock > table td.icon { text-align: center; width: 80px; }
.admonitionblock > table td.icon img { max-width: none; }
.admonitionblock > table td.icon .title { font-weight: bold; font-family: "Helvetica Neue", "Helvetica", Helvetica, Arial, sans-serif; text-transform: uppercase; }
.admonitionblock > table td.content { padding-left: 1.125em; padding-right: 1.25em; border-left: 1px solid #dddddd; color: #555555; }
.admonitionblock > table td.content > :last-child > :last-child { margin-bottom: 0; }

.exampleblock > .content { border-style: solid; border-width: 1px; border-color: #e6e6e6; margin-bottom: 1.25em; padding: 1.25em; background: white; -webkit-border-radius: 0; border-radius: 0; }
.exampleblock > .content > :first-child { margin-top: 0; }
.exampleblock > .content > :last-child { margin-bottom: 0; }

.sidebarblock { border-style: solid; border-width: 1px; border-color: #d9d9d9; margin-bottom: 1.25em; padding: 1.25em; background: #f2f2f2; -webkit-border-radius: 0; border-radius: 0; }
.sidebarblock > :first-child { margin-top: 0; }
.sidebarblock > :last-child { margin-bottom: 0; }
.sidebarblock > .content > .title { color: #6f6f6f; margin-top: 0; }

.exampleblock > .content > :last-child > :last-child, .exampleblock > .content .olist > ol > li:last-child > :last-child, .exampleblock > .content .ulist > ul > li:last-child > :last-child, .exampleblock > .content .qlist > ol > li:last-child > :last-child, .sidebarblock > .content > :last-child > :last-child, .sidebarblock > .content .olist > ol > li:last-child > :last-child, .sidebarblock > .content .ulist > ul > li:last-child > :last-child, .sidebarblock > .content .qlist > ol > li:last-child > :last-child { margin-bottom: 0; }

.literalblock pre, .listingblock pre:not(.highlight), .listingblock pre[class="highlight"], .listingblock pre[class^="highlight "], .listingblock pre.CodeRay, .listingblock pre.prettyprint { background: #eeeeee; }
.sidebarblock .literalblock pre, .sidebarblock .listingblock pre:not(.highlight), .sidebarblock .listingblock pre[class="highlight"], .sidebarblock .listingblock pre[class^="highlight "], .sidebarblock .listingblock pre.CodeRay, .sidebarblock .listingblock pre.prettyprint { background: #f2f1f1; }

.literalblock pre, .literalblock pre[class], .listingblock pre, .listingblock pre[class] { border: 1px solid #cccccc; -webkit-border-radius: 0; border-radius: 0; word-wrap: break-word; padding: 0.8em 0.8em 0.65em 0.8em; font-size: 0.8125em; }
.literalblock pre.nowrap, .literalblock pre[class].nowrap, .listingblock pre.nowrap, .listingblock pre[class].nowrap { overflow-x: auto; white-space: pre; word-wrap: normal; }
@media only screen and (min-width: 768px) { .literalblock pre, .literalblock pre[class], .listingblock pre, .listingblock pre[class] { font-size: 0.90625em; } }
@media only screen and (min-width: 1280px) { .literalblock pre, .literalblock pre[class], .listingblock pre, .listingblock pre[class] { font-size: 1em; } }

.literalblock.output pre { color: #eeeeee; background-color: black; }

.listingblock pre.highlightjs { padding: 0; }
.listingblock pre.highlightjs > code { padding: 0.8em 0.8em 0.65em 0.8em; -webkit-border-radius: 0; border-radius: 0; }

.listingblock > .content { position: relative; }

.listingblock code[data-lang]:before { display: none; content: attr(data-lang); position: absolute; font-size: 0.75em; top: 0.425rem; right: 0.5rem; line-height: 1; text-transform: uppercase; color: #999; }

.listingblock:hover code[data-lang]:before { display: block; }

.listingblock.terminal pre .command:before { content: attr(data-prompt); padding-right: 0.5em; color: #999; }

.listingblock.terminal pre .command:not([data-prompt]):before { content: "$"; }

table.pyhltable { border-collapse: separate; border: 0; margin-bottom: 0; background: none; }

table.pyhltable td { vertical-align: top; padding-top: 0; padding-bottom: 0; }

table.pyhltable td.code { padding-left: .75em; padding-right: 0; }

pre.pygments .lineno, table.pyhltable td:not(.code) { color: #999; padding-left: 0; padding-right: .5em; border-right: 1px solid #dddddd; }

pre.pygments .lineno { display: inline-block; margin-right: .25em; }

table.pyhltable .linenodiv { background: none !important; padding-right: 0 !important; }

.quoteblock { margin: 0 1em 1.25em 1.5em; display: table; }
.quoteblock > .title { margin-left: -1.5em; margin-bottom: 0.75em; }
.quoteblock blockquote, .quoteblock blockquote p { color: #6f6f6f; font-size: 1.15rem; line-height: 1.75; word-spacing: 0.1em; letter-spacing: 0; font-style: italic; text-align: justify; }
.quoteblock blockquote { margin: 0; padding: 0; border: 0; }
.quoteblock blockquote:before { content: "\201c"; float: left; font-size: 2.75em; font-weight: bold; line-height: 0.6em; margin-left: -0.6em; color: #6f6f6f; text-shadow: 0 1px 2px rgba(0, 0, 0, 0.1); }
.quoteblock blockquote > .paragraph:last-child p { margin-bottom: 0; }
.quoteblock .attribution { margin-top: 0.5em; margin-right: 0.5ex; text-align: right; }
.quoteblock .quoteblock { margin-left: 0; margin-right: 0; padding: 0.5em 0; border-left: 3px solid #555555; }
.quoteblock .quoteblock blockquote { padding: 0 0 0 0.75em; }
.quoteblock .quoteblock blockquote:before { display: none; }

.verseblock { margin: 0 1em 1.25em 1em; }
.verseblock pre { font-family: "Open Sans", "DejaVu Sans", sans; font-size: 1.15rem; color: #6f6f6f; font-weight: 300; text-rendering: optimizeLegibility; }
.verseblock pre strong { font-weight: 400; }
.verseblock .attribution { margin-top: 1.25rem; margin-left: 0.5ex; }

.quoteblock .attribution, .verseblock .attribution { font-size: 0.8125em; line-height: 1.45; font-style: italic; }
.quoteblock .attribution br, .verseblock .attribution br { display: none; }
.quoteblock .attribution cite, .verseblock .attribution cite { display: block; letter-spacing: -0.05em; color: #555555; }

.quoteblock.abstract { margin: 0 0 1.25em 0; display: block; }
.quoteblock.abstract blockquote, .quoteblock.abstract blockquote p { text-align: left; word-spacing: 0; }
.quoteblock.abstract blockquote:before, .quoteblock.abstract blockquote p:first-of-type:before { display: none; }

table.tableblock { max-width: 100%; border-collapse: separate; }
table.tableblock td > .paragraph:last-child p > p:last-child, table.tableblock th > p:last-child, table.tableblock td > p:last-child { margin-bottom: 0; }

table.spread { width: 100%; }

table.tableblock, th.tableblock, td.tableblock { border: 0 solid #dddddd; }

table.grid-all th.tableblock, table.grid-all td.tableblock { border-width: 0 1px 1px 0; }

table.grid-all tfoot > tr > th.tableblock, table.grid-all tfoot > tr > td.tableblock { border-width: 1px 1px 0 0; }

table.grid-cols th.tableblock, table.grid-cols td.tableblock { border-width: 0 1px 0 0; }

table.grid-all * > tr > .tableblock:last-child, table.grid-cols * > tr > .tableblock:last-child { border-right-width: 0; }

table.grid-rows th.tableblock, table.grid-rows td.tableblock { border-width: 0 0 1px 0; }

table.grid-all tbody > tr:last-child > th.tableblock, table.grid-all tbody > tr:last-child > td.tableblock, table.grid-all thead:last-child > tr > th.tableblock, table.grid-rows tbody > tr:last-child > th.tableblock, table.grid-rows tbody > tr:last-child > td.tableblock, table.grid-rows thead:last-child > tr > th.tableblock { border-bottom-width: 0; }

table.grid-rows tfoot > tr > th.tableblock, table.grid-rows tfoot > tr > td.tableblock { border-width: 1px 0 0 0; }

table.frame-all { border-width: 1px; }

table.frame-sides { border-width: 0 1px; }

table.frame-topbot { border-width: 1px 0; }

th.halign-left, td.halign-left { text-align: left; }

th.halign-right, td.halign-right { text-align: right; }

th.halign-center, td.halign-center { text-align: center; }

th.valign-top, td.valign-top { vertical-align: top; }

th.valign-bottom, td.valign-bottom { vertical-align: bottom; }

th.valign-middle, td.valign-middle { vertical-align: middle; }

table thead th, table tfoot th { font-weight: bold; }

tbody tr th { display: table-cell; line-height: 1.4; background: whitesmoke; }

tbody tr th, tbody tr th p, tfoot tr th, tfoot tr th p { color: #222222; font-weight: bold; }

p.tableblock > code:only-child { background: none; padding: 0; }

p.tableblock { font-size: 1em; }

td > div.verse { white-space: pre; }

ol { margin-left: 2.5em; }

ul li ol { margin-left: 1.5em; }

dl dd { margin-left: 1.125em; }

dl dd:last-child, dl dd:last-child > :last-child { margin-bottom: 0; }

ol > li p, ul > li p, ul dd, ol dd, .olist .olist, .ulist .ulist, .ulist .olist, .olist .ulist { margin-bottom: 0.625em; }

ul.unstyled, ol.unnumbered, ul.checklist, ul.none { list-style-type: none; }

ul.unstyled, ol.unnumbered, ul.checklist { margin-left: 0.625em; }

ul.checklist li > p:first-child > .fa-check-square-o:first-child, ul.checklist li > p:first-child > input[type="checkbox"]:first-child { margin-right: 0.25em; }

ul.checklist li > p:first-child > input[type="checkbox"]:first-child { position: relative; top: 1px; }

ul.inline { margin: 0 auto 0.625em auto; margin-left: -1.375em; margin-right: 0; padding: 0; list-style: none; overflow: hidden; }
ul.inline > li { list-style: none; float: left; margin-left: 1.375em; display: block; }
ul.inline > li > * { display: block; }

.unstyled dl dt { font-weight: normal; font-style: normal; }

ol.arabic { list-style-type: decimal; }

ol.decimal { list-style-type: decimal-leading-zero; }

ol.loweralpha { list-style-type: lower-alpha; }

ol.upperalpha { list-style-type: upper-alpha; }

ol.lowerroman { list-style-type: lower-roman; }

ol.upperroman { list-style-type: upper-roman; }

ol.lowergreek { list-style-type: lower-greek; }

.hdlist > table, .colist > table { border: 0; background: none; }
.hdlist > table > tbody > tr, .colist > table > tbody > tr { background: none; }

td.hdlist1 { padding-right: .75em; font-weight: bold; }

td.hdlist1, td.hdlist2 { vertical-align: top; }

.literalblock + .colist, .listingblock + .colist { margin-top: -0.5em; }

.colist > table tr > td:first-of-type { padding: 0 0.75em; line-height: 1; }
.colist > table tr > td:last-of-type { padding: 0.25em 0; }

.thumb, .th { line-height: 0; display: inline-block; border: solid 4px white; -webkit-box-shadow: 0 0 0 1px #dddddd; box-shadow: 0 0 0 1px #dddddd; }

.imageblock.left, .imageblock[style*="float: left"] { margin: 0.25em 0.625em 1.25em 0; }
.imageblock.right, .imageblock[style*="float: right"] { margin: 0.25em 0 1.25em 0.625em; }
.imageblock > .title { margin-bottom: 0; }
.imageblock.thumb, .imageblock.th { border-width: 6px; }
.imageblock.thumb > .title, .imageblock.th > .title { padding: 0 0.125em; }

.image.left, .image.right { margin-top: 0.25em; margin-bottom: 0.25em; display: inline-block; line-height: 0; }
.image.left { margin-right: 0.625em; }
.image.right { margin-left: 0.625em; }

a.image { text-decoration: none; }

span.footnote, span.footnoteref { vertical-align: super; font-size: 0.875em; }
span.footnote a, span.footnoteref a { text-decoration: none; }
span.footnote a:active, span.footnoteref a:active { text-decoration: underline; }

#footnotes { padding-top: 0.75em; padding-bottom: 0.75em; margin-bottom: 0.625em; }
#footnotes hr { width: 20%; min-width: 6.25em; margin: -.25em 0 .75em 0; border-width: 1px 0 0 0; }
#footnotes .footnote { padding: 0 0.375em; line-height: 1.3; font-size: 0.875em; margin-left: 1.2em; text-indent: -1.2em; margin-bottom: .2em; }
#footnotes .footnote a:first-of-type { font-weight: bold; text-decoration: none; }
#footnotes .footnote:last-of-type { margin-bottom: 0; }

#content #footnotes { margin-top: -0.625em; margin-bottom: 0; padding: 0.75em 0; }

.gist .file-data > table { border: 0; background: #fff; width: 100%; margin-bottom: 0; }
.gist .file-data > table td.line-data { width: 99%; }

div.unbreakable { page-break-inside: avoid; }

.big { font-size: larger; }

.small { font-size: smaller; }

.underline { text-decoration: underline; }

.overline { text-decoration: overline; }

.line-through { text-decoration: line-through; }

.aqua { color: #00bfbf; }

.aqua-background { background-color: #00fafa; }

.black { color: black; }

.black-background { background-color: black; }

.blue { color: #0000bf; }

.blue-background { background-color: #0000fa; }

.fuchsia { color: #bf00bf; }

.fuchsia-background { background-color: #fa00fa; }

.gray { color: #606060; }

.gray-background { background-color: #7d7d7d; }

.green { color: #006000; }

.green-background { background-color: #007d00; }

.lime { color: #00bf00; }

.lime-background { background-color: #00fa00; }

.maroon { color: #600000; }

.maroon-background { background-color: #7d0000; }

.navy { color: #000060; }

.navy-background { background-color: #00007d; }

.olive { color: #606000; }

.olive-background { background-color: #7d7d00; }

.purple { color: #600060; }

.purple-background { background-color: #7d007d; }

.red { color: #bf0000; }

.red-background { background-color: #fa0000; }

.silver { color: #909090; }

.silver-background { background-color: #bcbcbc; }

.teal { color: #006060; }

.teal-background { background-color: #007d7d; }

.white { color: #bfbfbf; }

.white-background { background-color: #fafafa; }

.yellow { color: #bfbf00; }

.yellow-background { background-color: #fafa00; }

span.icon > .fa { cursor: default; }

.admonitionblock td.icon [class^="fa icon-"] { font-size: 2.5em; text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.5); cursor: default; }
.admonitionblock td.icon .icon-note:before { content: "\f05a"; color: #207c98; }
.admonitionblock td.icon .icon-tip:before { content: "\f0eb"; text-shadow: 1px 1px 2px rgba(155, 155, 0, 0.8); color: #111; }
.admonitionblock td.icon .icon-warning:before { content: "\f071"; color: #bf6900; }
.admonitionblock td.icon .icon-caution:before { content: "\f06d"; color: #bf3400; }
.admonitionblock td.icon .icon-important:before { content: "\f06a"; color: #bf0000; }

.conum[data-value] { display: inline-block; color: #fff !important; background-color: #222222; -webkit-border-radius: 100px; border-radius: 100px; text-align: center; font-size: 0.75em; width: 1.67em; height: 1.67em; line-height: 1.67em; font-family: "Open Sans", "DejaVu Sans", sans-serif; font-style: normal; font-weight: bold; }
.conum[data-value] * { color: #fff !important; }
.conum[data-value] + b { display: none; }
.conum[data-value]:after { content: attr(data-value); }
pre .conum[data-value] { position: relative; top: -0.125em; }

b.conum * { color: inherit !important; }

.conum:not([data-value]):empty { display: none; }

.literalblock pre, .listingblock pre { background: #eeeeee; }

</style>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.2.0/css/font-awesome.min.css">
<style>.listingblock .pygments .hll { background-color: #ffffcc }
.listingblock .pygments  { background: #f8f8f8; }
.listingblock .pygments .tok-c { color: #408080; font-style: italic } /* Comment */
.listingblock .pygments .tok-err { border: 1px solid #FF0000 } /* Error */
.listingblock .pygments .tok-k { color: #008000; font-weight: bold } /* Keyword */
.listingblock .pygments .tok-o { color: #666666 } /* Operator */
.listingblock .pygments .tok-cm { color: #408080; font-style: italic } /* Comment.Multiline */
.listingblock .pygments .tok-cp { color: #BC7A00 } /* Comment.Preproc */
.listingblock .pygments .tok-c1 { color: #408080; font-style: italic } /* Comment.Single */
.listingblock .pygments .tok-cs { color: #408080; font-style: italic } /* Comment.Special */
.listingblock .pygments .tok-gd { color: #A00000 } /* Generic.Deleted */
.listingblock .pygments .tok-ge { font-style: italic } /* Generic.Emph */
.listingblock .pygments .tok-gr { color: #FF0000 } /* Generic.Error */
.listingblock .pygments .tok-gh { color: #000080; font-weight: bold } /* Generic.Heading */
.listingblock .pygments .tok-gi { color: #00A000 } /* Generic.Inserted */
.listingblock .pygments .tok-go { color: #888888 } /* Generic.Output */
.listingblock .pygments .tok-gp { color: #000080; font-weight: bold } /* Generic.Prompt */
.listingblock .pygments .tok-gs { font-weight: bold } /* Generic.Strong */
.listingblock .pygments .tok-gu { color: #800080; font-weight: bold } /* Generic.Subheading */
.listingblock .pygments .tok-gt { color: #0044DD } /* Generic.Traceback */
.listingblock .pygments .tok-kc { color: #008000; font-weight: bold } /* Keyword.Constant */
.listingblock .pygments .tok-kd { color: #008000; font-weight: bold } /* Keyword.Declaration */
.listingblock .pygments .tok-kn { color: #008000; font-weight: bold } /* Keyword.Namespace */
.listingblock .pygments .tok-kp { color: #008000 } /* Keyword.Pseudo */
.listingblock .pygments .tok-kr { color: #008000; font-weight: bold } /* Keyword.Reserved */
.listingblock .pygments .tok-kt { color: #B00040 } /* Keyword.Type */
.listingblock .pygments .tok-m { color: #666666 } /* Literal.Number */
.listingblock .pygments .tok-s { color: #BA2121 } /* Literal.String */
.listingblock .pygments .tok-na { color: #7D9029 } /* Name.Attribute */
.listingblock .pygments .tok-nb { color: #008000 } /* Name.Builtin */
.listingblock .pygments .tok-nc { color: #0000FF; font-weight: bold } /* Name.Class */
.listingblock .pygments .tok-no { color: #880000 } /* Name.Constant */
.listingblock .pygments .tok-nd { color: #AA22FF } /* Name.Decorator */
.listingblock .pygments .tok-ni { color: #999999; font-weight: bold } /* Name.Entity */
.listingblock .pygments .tok-ne { color: #D2413A; font-weight: bold } /* Name.Exception */
.listingblock .pygments .tok-nf { color: #0000FF } /* Name.Function */
.listingblock .pygments .tok-nl { color: #A0A000 } /* Name.Label */
.listingblock .pygments .tok-nn { color: #0000FF; font-weight: bold } /* Name.Namespace */
.listingblock .pygments .tok-nt { color: #008000; font-weight: bold } /* Name.Tag */
.listingblock .pygments .tok-nv { color: #19177C } /* Name.Variable */
.listingblock .pygments .tok-ow { color: #AA22FF; font-weight: bold } /* Operator.Word */
.listingblock .pygments .tok-w { color: #bbbbbb } /* Text.Whitespace */
.listingblock .pygments .tok-mb { color: #666666 } /* Literal.Number.Bin */
.listingblock .pygments .tok-mf { color: #666666 } /* Literal.Number.Float */
.listingblock .pygments .tok-mh { color: #666666 } /* Literal.Number.Hex */
.listingblock .pygments .tok-mi { color: #666666 } /* Literal.Number.Integer */
.listingblock .pygments .tok-mo { color: #666666 } /* Literal.Number.Oct */
.listingblock .pygments .tok-sb { color: #BA2121 } /* Literal.String.Backtick */
.listingblock .pygments .tok-sc { color: #BA2121 } /* Literal.String.Char */
.listingblock .pygments .tok-sd { color: #BA2121; font-style: italic } /* Literal.String.Doc */
.listingblock .pygments .tok-s2 { color: #BA2121 } /* Literal.String.Double */
.listingblock .pygments .tok-se { color: #BB6622; font-weight: bold } /* Literal.String.Escape */
.listingblock .pygments .tok-sh { color: #BA2121 } /* Literal.String.Heredoc */
.listingblock .pygments .tok-si { color: #BB6688; font-weight: bold } /* Literal.String.Interpol */
.listingblock .pygments .tok-sx { color: #008000 } /* Literal.String.Other */
.listingblock .pygments .tok-sr { color: #BB6688 } /* Literal.String.Regex */
.listingblock .pygments .tok-s1 { color: #BA2121 } /* Literal.String.Single */
.listingblock .pygments .tok-ss { color: #19177C } /* Literal.String.Symbol */
.listingblock .pygments .tok-bp { color: #008000 } /* Name.Builtin.Pseudo */
.listingblock .pygments .tok-vc { color: #19177C } /* Name.Variable.Class */
.listingblock .pygments .tok-vg { color: #19177C } /* Name.Variable.Global */
.listingblock .pygments .tok-vi { color: #19177C } /* Name.Variable.Instance */
.listingblock .pygments .tok-il { color: #666666 } /* Literal.Number.Integer.Long */
</style>
</head>
<body class="article toc2 toc-left">
<div id="header">
<h1>Componentes Web</h1>
<div class="details">
<span id="author" class="author">Miguel Angel Lozano</span><br>
<span id="email" class="email"><a href="mailto:malozano@ua.es">malozano@ua.es</a></span><br>
</div>
<div id="toc" class="toc2">
<div id="toctitle">Índice de contenidos</div>
<ul class="sectlevel1">
<li><a href="#sesion03">3. Manejo de Cookies y Sesiones</a>
<ul class="sectlevel2">
<li><a href="#_cookies">3.1. Cookies</a>
<ul class="sectlevel3">
<li><a href="#_cookies_en_http">3.1.1. Cookies en HTTP</a></li>
<li><a href="#_enviar_una_cookie">3.1.2. Enviar una cookie</a></li>
<li><a href="#_obtener_una_cookie">3.1.3. Obtener una cookie</a></li>
<li><a href="#_ejemplo">3.1.4. Ejemplo</a></li>
</ul>
</li>
<li><a href="#_seguimiento_de_sesiones">3.2. Seguimiento de sesiones</a>
<ul class="sectlevel3">
<li><a href="#_obtener_una_sesi%C3%B3n">3.2.1. Obtener una sesión</a></li>
<li><a href="#_guardar_y_obtener_datos_de_la_sesi%C3%B3n">3.2.2. Guardar y obtener datos de la sesión</a></li>
<li><a href="#_invalidar_la_sesi%C3%B3n">3.2.3. Invalidar la sesión</a></li>
<li><a href="#_compatibilidad_con_los_navegadores">3.2.4. Compatibilidad con los navegadores</a></li>
<li><a href="#_oyentes">3.2.5. Oyentes</a></li>
<li><a href="#_ejemplos">3.2.6. Ejemplos</a></li>
</ul>
</li>
<li><a href="#_ejercicios">3.3. Ejercicios</a>
<ul class="sectlevel3">
<li><a href="#_personalizar_un_sitio_web_0_3_puntos">3.3.1. Personalizar un sitio web (0.3 puntos)</a></li>
<li><a href="#_carro_de_la_compra_0_5_puntos">3.3.2. Carro de la compra (0.5 puntos)</a></li>
<li><a href="#_mejoras_para_el_carro_de_la_compra_0_2_puntos">3.3.3. Mejoras para el carro de la compra (0.2 puntos)</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
</div>
<div id="content">
<div id="preamble">
<div class="sectionbody">
<div style="page-break-after: always;"></div>
</div>
</div>
<div class="sect1">
<h2 id="sesion03">3. Manejo de Cookies y Sesiones</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Veremos en este tema aspectos sobre el seguimiento de las acciones de los usuarios sobre un sitio web. Para ello veremos cómo trabajar con cookies en los servlets, y cómo manejar información sobre las sesiones de los usuarios.</p>
</div>
<div class="sect2">
<h3 id="_cookies">3.1. Cookies</h3>
<div class="sect3">
<h4 id="_cookies_en_http">3.1.1. Cookies en HTTP</h4>
<div class="paragraph">
<p>Las <strong>cookies</strong> son un mecanismo general mediante el que los programas de un servidor web pueden almacenar información en la parte del cliente de la conexión. Es una forma de añadir estado a las conexiones HTTP, aunque el manejo de cookies no es parte del protocolo HTTP, pero es soportado por la mayoría de los clientes.</p>
</div>
<div class="paragraph">
<p>Las cookies son objetos de tipo: <em>nombre = valor</em>, donde se asigna un <em>valor</em> determinado (una cadena de texto) a una variable del <em>nombre</em> indicado. Dicho objeto es almacenado y recordado por el servidor web y el navegador durante un período de tiempo (indicado como un parámetro interno de la propia <em>cookie</em>). Así, se puede tener una lista de <em>cookies</em> con distintas variables y distintos valores, para almacenar información relevante para cada usuario (se tienen listas de cookies independientes para cada usuario).</p>
</div>
<div class="paragraph">
<p>El funcionamiento es: el servidor, con la cabecera <code>Set-Cookie</code>, envía al cliente información de estado que éste almacenará. Entre la información se encuentra la descripción de los rangos de URLs para los que este estado es válido, de forma que para cualquier petición HTTP a alguna de esas URLs el cliente incluirá esa información de estado, utilizando la cabecera <code>Cookie</code>.</p>
</div>
<div class="paragraph">
<p>La sintaxis de la cabecera <code>Set-Cookie</code> es:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code>Set-Cookie: CLAVE1=VALOR1;...;CLAVEN=VALORN [OPCIONES]</code></pre>
</div>
</div>
<div class="paragraph">
<p>donde OPCIONES es una lista opcional con cualquiera de estos atributos:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code>expires=FECHA;path=PATH;domain=DOMINIO;secure</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Las parejas de <em>CLAVE</em> y <em>VALOR</em> representan la información almacenada en la cookie</p>
</li>
<li>
<p>Los atributos <code>domain</code> y <code>path</code> definen las URL en las que el navegador mostrará la cookie. <code>domain</code> es por defecto el <em>hostname</em> del servidor. El navegador mostrará la cookie cuando acceda a una URL que se empareje correctamente con ambos atributos. Por ejemplo, un atributo <code>domain="eps.ua.es"</code> hará que el navegador muestra la cookie cuando acceda a cualquier URL terminada en <code>"eps.ua.es"</code>. <code>path</code> funciona de forma similar, pero con la parte del path de la URL. Por ejemplo, el path <code>"/foo"</code> hará que el navegador muestre la cookie en todas las URLs que comiencen por <code>"/foo"</code>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><code>expires</code> define la fecha a partir de la cual la cookie caduca. La fecha se indica en formato GMT, separando los elementos de la fecha por guiones. Por ejemplo:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code>expires=Wed, 09-Nov-1999 23:12:40 GMT</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><code>secure</code> hará que la cookie sólo se transmita si el canal de comunicación es seguro (tipo de conexión HTTPS).</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Por otra parte, cuando el cliente solicita una URL que empareja con el dominio y path de alguna cookie, envía la cabecera:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code>Cookie: CLAVE1=VALOR1;CLAVE2=VALOR2;...;CLAVEN=VALORN</code></pre>
</div>
</div>
<div class="paragraph">
<p>El número máximo de cookies que está garantizado que acepte cualquier navegador es de 300, con un máximo de 20 por cada servidor o dominio (los servlets que se ejecutan en un mismo servidor comparten las cookies). El tamaño máximo de una cookie es de 4096 bytes.</p>
</div>
<div class="paragraph">
<p>En Javascript, por ejemplo, el objeto <code>document.cookie</code> contiene como valor una lista de la forma:</p>
</div>
<div class="paragraph">
<p><code>nombre1=valor1;nombre2=valor2;&#8230;&#8203;;nombreN=valorN</code></p>
</div>
<div class="paragraph">
<p>donde se almacenan así los valores de las cookies que se tengan definidas.</p>
</div>
<div class="paragraph">
<p>Se pueden emplear <code>cookies</code>, entre otras cosas, para:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Identificar a un usuario durante una o varias sesiones</strong>. Por ejemplo, a la hora de realizar compras a través de una tienda web, se almacena su identidad (login y password) como una cookie y se recuerda a lo largo de diferentes visitas qué es lo que lleva almacenado en su cesta de la compra cada usuario.</p>
</li>
<li>
<p><strong>Personalizar un sitio web de acuerdo a las preferencias de cada usuario</strong>: definir el contenido, apariencia, etc, que queremos que tenga una determinada página en función de las preferencias del usuario que la esté visitando.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>A la hora de trabajar con cookies, debemos tener en cuenta que nuestro sitio web no debe depender de ellas, puesto que muchos navegadores y usuarios las deshabilitan para evitar problemas de privacidad y otras cuestiones.</p>
</div>
<div class="paragraph">
<p>Veremos ahora cómo trabajar con cookies desde servlets.</p>
</div>
</div>
<div class="sect3">
<h4 id="_enviar_una_cookie">3.1.2. Enviar una cookie</h4>
<div class="paragraph">
<p>Para crear una nueva cookie y enviarla, se siguen los pasos:</p>
</div>
<div class="paragraph">
<p><strong>1. Crear la cookie</strong></p>
</div>
<div class="paragraph">
<p>Las cookies se manejan con la clase <strong><code>Cookie</code></strong>. Se tiene el constructor:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span class="tok-kd">public</span> <span class="tok-nf">Cookie</span> <span class="tok-o">(</span><span class="tok-n">String</span> <span class="tok-n">nombre</span><span class="tok-o">,</span> <span class="tok-n">String</span> <span class="tok-n">valor</span><span class="tok-o">)</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>que crea una cookie de nombre <code>nombre</code>, dándole el valor <code>valor</code>.</p>
</div>
<div class="paragraph">
<p><strong>2. Establecer los atributos de la cookie</strong></p>
</div>
<div class="paragraph">
<p>Una vez creada la cookie, podemos establecer los atributos que queramos, con los métodos de la clase <code>Cookie</code>. Por ejemplo, se tienen:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span class="tok-kd">public</span> <span class="tok-kt">void</span> <span class="tok-nf">setComment</span><span class="tok-o">(</span><span class="tok-n">String</span> <span class="tok-n">comentario</span><span class="tok-o">)</span>
<span class="tok-kd">public</span> <span class="tok-kt">void</span> <span class="tok-nf">setMaxAge</span><span class="tok-o">(</span><span class="tok-kt">int</span> <span class="tok-n">edad</span><span class="tok-o">)</span>
<span class="tok-o">...</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>El primero asigna una cadena descriptiva sobre la cookie. El segundo indica cuántos segundos de vida tiene. Si es un valor negativo, se borrará la cookie cuando se cierre el navegador. Si el valor es 0, se borra la cookie instantáneamente, y si es positivo, se borrará la cookie cuando pasen los segundos indicados (si cerramos y volvemos a abrir el navegador dentro de ese tiempo, la cookie todavía persistirá). Se tienen otros métodos para establecer atributos de la cookie.</p>
</div>
<div class="paragraph">
<p><strong>3. Enviar la cookie</strong></p>
</div>
<div class="paragraph">
<p>Las cookies se añaden a la cabecera de la respuesta, y se envían así al cliente, mediante el método de <code>HttpServletResponse</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span class="tok-kd">public</span> <span class="tok-kt">void</span> <span class="tok-nf">addCookie</span> <span class="tok-o">(</span><span class="tok-n">Cookie</span> <span class="tok-n">cookie</span><span class="tok-o">)</span></code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Ejemplo</strong></p>
</div>
<div class="paragraph">
<p>Vemos un ejemplo completo de envío de cookie:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span class="tok-kd">public</span> <span class="tok-kd">class</span> <span class="tok-nc">MiServlet</span> <span class="tok-kd">extends</span> <span class="tok-n">HttpServlet</span>
<span class="tok-o">{</span>
	<span class="tok-kd">public</span> <span class="tok-kt">void</span> <span class="tok-nf">doGet</span> <span class="tok-o">(</span><span class="tok-n">HttpServletRequest</span> <span class="tok-n">request</span><span class="tok-o">,</span>
	                   <span class="tok-n">HttpServletResponse</span> <span class="tok-n">response</span><span class="tok-o">)</span>
	                <span class="tok-kd">throws</span> <span class="tok-n">ServletException</span><span class="tok-o">,</span> <span class="tok-n">IOException</span> <span class="tok-o">{</span>
		<span class="tok-n">Cookie</span> <span class="tok-n">miCookie</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-nf">Cookie</span> <span class="tok-o">(</span><span class="tok-s">&quot;nombre&quot;</span><span class="tok-o">,</span> <span class="tok-s">&quot;Pepe&quot;</span><span class="tok-o">);</span>
		<span class="tok-n">miCookie</span><span class="tok-o">.</span><span class="tok-na">setMaxAge</span><span class="tok-o">(</span><span class="tok-mi">120</span><span class="tok-o">);</span>
		<span class="tok-n">response</span><span class="tok-o">.</span><span class="tok-na">addCookie</span><span class="tok-o">(</span><span class="tok-n">miCookie</span><span class="tok-o">);</span>
		<span class="tok-n">PrintWriter</span> <span class="tok-n">out</span> <span class="tok-o">=</span> <span class="tok-n">response</span><span class="tok-o">.</span><span class="tok-na">getWriter</span><span class="tok-o">();</span>
		<span class="tok-o">...</span>
	<span class="tok-o">}</span>
<span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Hay que tener en cuenta que las cookies son parte de la cabecera HTTP, con lo cual hay que enviarlas ANTES de escribir la respuesta (o antes de obtener el objeto <code>Writer</code> si lo queremos utilizar).</p>
</div>
</div>
<div class="sect3">
<h4 id="_obtener_una_cookie">3.1.3. Obtener una cookie</h4>
<div class="paragraph">
<p>Para obtener una cookie que envía el cliente se trabaja sobre la petición del cliente (<code>HttpServletRequest</code>), siguiendo los pasos:</p>
</div>
<div class="paragraph">
<p><strong>1. Obtener todas las cookies</strong></p>
</div>
<div class="paragraph">
<p>Obtenemos todas las cookies con el método <strong>getCookies()</strong> de la clase <code>HttpServletRequest</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span class="tok-kd">public</span> <span class="tok-n">Cookie</span><span class="tok-o">[]</span> <span class="tok-nf">getCookies</span><span class="tok-o">()</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Con esto se tiene un array con todas las cookies actuales para el usuario. Si no hay cookies el método devuelve <code>null</code>.</p>
</div>
<div class="paragraph">
<p><strong>2. Obtener el valor de una cookie</strong></p>
</div>
<div class="paragraph">
<p>Con lo anterior, para obtener el valor de una cookie simplemente recorremos el array de cookies buscando la que concuerde con el nombre que queramos. Pueden	ser útiles los métodos de <code>Cookie</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span class="tok-kd">public</span> <span class="tok-n">String</span> <span class="tok-nf">getName</span><span class="tok-o">()</span>
<span class="tok-kd">public</span> <span class="tok-n">String</span> <span class="tok-nf">getValue</span><span class="tok-o">()</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>El primero obtiene el nombre de la cookie, y el segundo el valor.</p>
</div>
<div class="paragraph">
<p><strong>Ejemplo</strong></p>
</div>
<div class="paragraph">
<p>Un ejemplo de uso, para obtener el nombre del usuario, guardado en la cookie <code>"nombre"</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span class="tok-kd">public</span> <span class="tok-kt">void</span> <span class="tok-nf">doGet</span> <span class="tok-o">(</span><span class="tok-n">HttpServletRequest</span> <span class="tok-n">request</span><span class="tok-o">,</span>
                   <span class="tok-n">HttpServletResponse</span> <span class="tok-n">response</span><span class="tok-o">)</span>
                <span class="tok-kd">throws</span> <span class="tok-n">ServletException</span><span class="tok-o">,</span> <span class="tok-n">IOException</span> <span class="tok-o">{</span>
	<span class="tok-n">Cookie</span><span class="tok-o">[]</span> <span class="tok-n">cookies</span> <span class="tok-o">=</span> <span class="tok-n">request</span><span class="tok-o">.</span><span class="tok-na">getCookies</span><span class="tok-o">();</span>
	<span class="tok-n">String</span> <span class="tok-n">nombre</span><span class="tok-o">;</span>
	<span class="tok-k">for</span> <span class="tok-o">(</span><span class="tok-kt">int</span> <span class="tok-n">i</span> <span class="tok-o">=</span> <span class="tok-mi">0</span><span class="tok-o">;</span> <span class="tok-n">i</span> <span class="tok-o">&lt;</span> <span class="tok-n">cookies</span><span class="tok-o">.</span><span class="tok-na">length</span><span class="tok-o">;</span> <span class="tok-n">i</span><span class="tok-o">++)</span>
		<span class="tok-k">if</span> <span class="tok-o">(</span><span class="tok-n">cookies</span><span class="tok-o">[</span><span class="tok-n">i</span><span class="tok-o">].</span><span class="tok-na">getName</span><span class="tok-o">().</span><span class="tok-na">equals</span><span class="tok-o">(</span><span class="tok-s">&quot;nombre&quot;</span><span class="tok-o">))</span>
			<span class="tok-n">nombre</span> <span class="tok-o">=</span> <span class="tok-n">cookies</span><span class="tok-o">[</span><span class="tok-n">i</span><span class="tok-o">].</span><span class="tok-na">getValue</span><span class="tok-o">();</span>
<span class="tok-o">}</span></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_ejemplo">3.1.4. Ejemplo</h4>
<div class="paragraph">
<p>Aquí tenéis un ejemplo de uso de cookies. El servlet <code>ServletCookies</code> cuenta el número de visitas a una página con una cookie que dura 3 minutos.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span class="tok-kn">package</span> <span class="tok-n">ejemplos</span><span class="tok-o">;</span>

<span class="tok-kn">import</span> <span class="tok-nn">java.io.*</span><span class="tok-o">;</span>
<span class="tok-kn">import</span> <span class="tok-nn">javax.servlet.*</span><span class="tok-o">;</span>
<span class="tok-kn">import</span> <span class="tok-nn">javax.servlet.http.*</span><span class="tok-o">;</span>

<span class="tok-kd">public</span> <span class="tok-kd">class</span> <span class="tok-nc">ServletCookies</span> <span class="tok-kd">extends</span> <span class="tok-n">HttpServlet</span>
<span class="tok-o">{</span>
   <span class="tok-c1">// Metodo para GET</span>

   <span class="tok-kd">public</span> <span class="tok-kt">void</span> <span class="tok-nf">doGet</span><span class="tok-o">(</span><span class="tok-n">HttpServletRequest</span> <span class="tok-n">request</span><span class="tok-o">,</span>
                     <span class="tok-n">HttpServletResponse</span> <span class="tok-n">response</span><span class="tok-o">)</span>
                  <span class="tok-kd">throws</span> <span class="tok-n">ServletException</span><span class="tok-o">,</span> <span class="tok-n">IOException</span> <span class="tok-o">{</span>
	<span class="tok-n">response</span><span class="tok-o">.</span><span class="tok-na">setContentType</span><span class="tok-o">(</span><span class="tok-s">&quot;text/html&quot;</span><span class="tok-o">);</span>
	<span class="tok-n">response</span><span class="tok-o">.</span><span class="tok-na">setHeader</span><span class="tok-o">(</span><span class="tok-s">&quot;Cache-Control&quot;</span><span class="tok-o">,</span> <span class="tok-s">&quot;no-cache&quot;</span><span class="tok-o">);</span>

	<span class="tok-n">Cookie</span><span class="tok-o">[]</span> <span class="tok-n">cookies</span> <span class="tok-o">=</span> <span class="tok-n">request</span><span class="tok-o">.</span><span class="tok-na">getCookies</span><span class="tok-o">();</span>
	<span class="tok-n">Cookie</span> <span class="tok-n">contador</span> <span class="tok-o">=</span> <span class="tok-n">buscaCookie</span><span class="tok-o">(</span><span class="tok-s">&quot;contador&quot;</span><span class="tok-o">,</span> <span class="tok-n">cookies</span><span class="tok-o">);</span>

	<span class="tok-k">if</span> <span class="tok-o">(</span><span class="tok-n">contador</span> <span class="tok-o">==</span> <span class="tok-kc">null</span><span class="tok-o">)</span>
	<span class="tok-o">{</span>
	   <span class="tok-c1">// Creamos la cookie con el contador</span>

	   <span class="tok-n">Cookie</span> <span class="tok-n">cookie</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-nf">Cookie</span> <span class="tok-o">(</span><span class="tok-s">&quot;contador&quot;</span><span class="tok-o">,</span> <span class="tok-s">&quot;1&quot;</span><span class="tok-o">);</span>
	   <span class="tok-n">cookie</span><span class="tok-o">.</span><span class="tok-na">setMaxAge</span><span class="tok-o">(</span><span class="tok-mi">180</span><span class="tok-o">);</span>
	   <span class="tok-n">response</span><span class="tok-o">.</span><span class="tok-na">addCookie</span><span class="tok-o">(</span><span class="tok-n">cookie</span><span class="tok-o">);</span>

	   <span class="tok-c1">// Mostramos el mensaje de primera visita</span>

	   <span class="tok-n">PrintWriter</span> <span class="tok-n">out</span> <span class="tok-o">=</span> <span class="tok-n">response</span><span class="tok-o">.</span><span class="tok-na">getWriter</span><span class="tok-o">();</span>
	   <span class="tok-n">out</span><span class="tok-o">.</span><span class="tok-na">println</span> <span class="tok-o">(</span><span class="tok-s">&quot;&lt;HTML&gt;&quot;</span><span class="tok-o">);</span>
	   <span class="tok-n">out</span><span class="tok-o">.</span><span class="tok-na">println</span> <span class="tok-o">(</span><span class="tok-s">&quot;&lt;BODY&gt;&quot;</span><span class="tok-o">);</span>
	   <span class="tok-n">out</span><span class="tok-o">.</span><span class="tok-na">println</span> <span class="tok-o">(</span><span class="tok-s">&quot;Primera visita&quot;</span><span class="tok-o">);</span>
	   <span class="tok-n">out</span><span class="tok-o">.</span><span class="tok-na">println</span> <span class="tok-o">(</span><span class="tok-s">&quot;&lt;BR&gt;&quot;</span><span class="tok-o">);</span>
	   <span class="tok-n">out</span><span class="tok-o">.</span><span class="tok-na">println</span> <span class="tok-o">(</span><span class="tok-s">&quot;&lt;/BODY&gt;&quot;</span><span class="tok-o">);</span>
	   <span class="tok-n">out</span><span class="tok-o">.</span><span class="tok-na">println</span> <span class="tok-o">(</span><span class="tok-s">&quot;&lt;/HTML&gt;&quot;</span><span class="tok-o">);</span>

	<span class="tok-o">}</span> <span class="tok-k">else</span> <span class="tok-o">{</span>

	   <span class="tok-c1">// Obtenemos el valor actual del contador</span>

	   <span class="tok-kt">int</span> <span class="tok-n">cont</span> <span class="tok-o">=</span> <span class="tok-n">Integer</span><span class="tok-o">.</span><span class="tok-na">parseInt</span><span class="tok-o">(</span><span class="tok-n">contador</span><span class="tok-o">.</span><span class="tok-na">getValue</span><span class="tok-o">());</span>
	   <span class="tok-n">cont</span><span class="tok-o">++;</span>

	   <span class="tok-c1">// Modificamos el valor de la cookie</span>
	   <span class="tok-c1">// incrementando el contador</span>

	   <span class="tok-n">Cookie</span> <span class="tok-n">cookie</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-nf">Cookie</span> <span class="tok-o">(</span><span class="tok-s">&quot;contador&quot;</span><span class="tok-o">,</span> <span class="tok-s">&quot;&quot;</span> <span class="tok-o">+</span> <span class="tok-n">cont</span><span class="tok-o">);</span>
	   <span class="tok-n">cookie</span><span class="tok-o">.</span><span class="tok-na">setMaxAge</span><span class="tok-o">(</span><span class="tok-mi">180</span><span class="tok-o">);</span>
	   <span class="tok-n">response</span><span class="tok-o">.</span><span class="tok-na">addCookie</span><span class="tok-o">(</span><span class="tok-n">cookie</span><span class="tok-o">);</span>

	   <span class="tok-c1">// Mostramos el numero de visitas</span>

	   <span class="tok-n">PrintWriter</span> <span class="tok-n">out</span> <span class="tok-o">=</span> <span class="tok-n">response</span><span class="tok-o">.</span><span class="tok-na">getWriter</span><span class="tok-o">();</span>
	   <span class="tok-n">out</span><span class="tok-o">.</span><span class="tok-na">println</span> <span class="tok-o">(</span><span class="tok-s">&quot;&lt;HTML&gt;&quot;</span><span class="tok-o">);</span>
	   <span class="tok-n">out</span><span class="tok-o">.</span><span class="tok-na">println</span> <span class="tok-o">(</span><span class="tok-s">&quot;&lt;BODY&gt;&quot;</span><span class="tok-o">);</span>
	   <span class="tok-n">out</span><span class="tok-o">.</span><span class="tok-na">println</span> <span class="tok-o">(</span><span class="tok-s">&quot;Visita numero &quot;</span> <span class="tok-o">+</span> <span class="tok-n">cont</span><span class="tok-o">);</span>
	   <span class="tok-n">out</span><span class="tok-o">.</span><span class="tok-na">println</span> <span class="tok-o">(</span><span class="tok-s">&quot;&lt;BR&gt;&quot;</span><span class="tok-o">);</span>
	   <span class="tok-n">out</span><span class="tok-o">.</span><span class="tok-na">println</span> <span class="tok-o">(</span><span class="tok-s">&quot;&lt;/BODY&gt;&quot;</span><span class="tok-o">);</span>
	   <span class="tok-n">out</span><span class="tok-o">.</span><span class="tok-na">println</span> <span class="tok-o">(</span><span class="tok-s">&quot;&lt;/HTML&gt;&quot;</span><span class="tok-o">);</span>
	<span class="tok-o">}</span>
   <span class="tok-o">}</span>

   <span class="tok-c1">// Busca la cookie &#39;nombre&#39;</span>
   <span class="tok-c1">// en el array de cookies indicado.</span>
   <span class="tok-c1">// Devuelve null si no esta</span>

   <span class="tok-kd">private</span> <span class="tok-n">Cookie</span> <span class="tok-nf">buscaCookie</span><span class="tok-o">(</span><span class="tok-n">String</span> <span class="tok-n">nombre</span><span class="tok-o">,</span>
                              <span class="tok-n">Cookie</span><span class="tok-o">[]</span> <span class="tok-n">cookies</span><span class="tok-o">)</span>
   <span class="tok-o">{</span>
	<span class="tok-k">if</span> <span class="tok-o">(</span><span class="tok-n">cookies</span> <span class="tok-o">==</span> <span class="tok-kc">null</span><span class="tok-o">)</span>
	   <span class="tok-k">return</span> <span class="tok-kc">null</span><span class="tok-o">;</span>

	<span class="tok-k">for</span> <span class="tok-o">(</span><span class="tok-kt">int</span> <span class="tok-n">i</span> <span class="tok-o">=</span> <span class="tok-mi">0</span><span class="tok-o">;</span> <span class="tok-n">i</span> <span class="tok-o">&lt;</span> <span class="tok-n">cookies</span><span class="tok-o">.</span><span class="tok-na">length</span><span class="tok-o">;</span> <span class="tok-n">i</span><span class="tok-o">++)</span>
	   <span class="tok-k">if</span> <span class="tok-o">(</span><span class="tok-n">cookies</span><span class="tok-o">[</span><span class="tok-n">i</span><span class="tok-o">].</span><span class="tok-na">getName</span><span class="tok-o">().</span><span class="tok-na">equals</span><span class="tok-o">(</span><span class="tok-n">nombre</span><span class="tok-o">))</span>
		<span class="tok-k">return</span> <span class="tok-n">cookies</span><span class="tok-o">[</span><span class="tok-n">i</span><span class="tok-o">];</span>

	<span class="tok-k">return</span> <span class="tok-kc">null</span><span class="tok-o">;</span>
   <span class="tok-o">}</span>
<span class="tok-o">}</span></code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_seguimiento_de_sesiones">3.2. Seguimiento de sesiones</h3>
<div class="paragraph">
<p>El seguimiento de sesiones es un mecanismo empleado por los servlets para gestionar un estado sobre las peticiones realizadas desde un mismo cliente (un mismo navegador) a lo largo de un período de tiempo determinado. Las sesiones se comparten por los servlets a los que accede un cliente (algo útil si queremos construir una aplicación basada en múltiples servlets).</p>
</div>
<div class="paragraph">
<p>Para utilizar el seguimiento de sesiones se tienen los pasos:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Utilizar una sesión (objeto <code>HttpSession</code>) para un usuario</p>
</li>
<li>
<p>Almacenar u obtener datos del objeto <code>HttpSession</code></p>
</li>
<li>
<p>Opcionalmente, invalidar la sesión</p>
</li>
</ul>
</div>
<div class="sect3">
<h4 id="_obtener_una_sesión">3.2.1. Obtener una sesión</h4>
<div class="paragraph">
<p>El método <strong><code>getSession()</code></strong> del objeto <strong><code>HttpServletRequest</code></strong> obtiene una sesión de usuario.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span class="tok-kd">public</span> <span class="tok-n">HttpSession</span> <span class="tok-nf">getSession</span><span class="tok-o">()</span>
<span class="tok-kd">public</span> <span class="tok-n">HttpSession</span> <span class="tok-nf">getSession</span><span class="tok-o">(</span><span class="tok-kt">boolean</span> <span class="tok-n">crear</span><span class="tok-o">)</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>El primer método obtiene la sesión actual, o crea una si no existe. Con el segundo método podemos establecer, mediante el flag booleano, si queremos crear una nueva si no existe (<code>true</code>) o no (<code>false</code>). Si la sesión es nueva, el método <code>isNew()</code> del <code>HttpSession</code> devuelve <code>true</code>, y la sesión no tiene ningún dato asociado. Deberemos ir añadiéndole datos tras crearla.</p>
</div>
<div class="paragraph">
<p>Para mantener la sesión de forma adecuada, debemos llamar a <code>getSession()</code> antes de que se escriba nada en la respuesta <code>HttpServletResponse</code> (y si utilizamos un <code>Writer</code>, debemos obtenerla antes de obtener el <code>Writer</code>, no antes de escribir datos).</p>
</div>
<div class="paragraph">
<p>Por ejemplo:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span class="tok-kd">public</span> <span class="tok-kd">class</span> <span class="tok-nc">MiServlet</span> <span class="tok-kd">extends</span> <span class="tok-n">HttpServlet</span>
<span class="tok-o">{</span>
	<span class="tok-kd">public</span> <span class="tok-kt">void</span> <span class="tok-nf">doGet</span> <span class="tok-o">(</span><span class="tok-n">HttpServletRequest</span> <span class="tok-n">request</span><span class="tok-o">,</span>
	                   <span class="tok-n">HttpServletResponse</span> <span class="tok-n">response</span><span class="tok-o">)</span>
	                <span class="tok-kd">throws</span> <span class="tok-n">ServletException</span><span class="tok-o">,</span> <span class="tok-n">IOException</span> <span class="tok-o">{</span>
		<span class="tok-n">HttpSession</span> <span class="tok-n">sesion</span> <span class="tok-o">=</span> <span class="tok-n">request</span><span class="tok-o">.</span><span class="tok-na">getSession</span><span class="tok-o">(</span><span class="tok-kc">true</span><span class="tok-o">);</span>
		<span class="tok-o">...</span>
		<span class="tok-n">PrintWriter</span> <span class="tok-n">out</span> <span class="tok-o">=</span> <span class="tok-n">response</span><span class="tok-o">.</span><span class="tok-na">getWriter</span><span class="tok-o">();</span>
		<span class="tok-o">...</span>
	<span class="tok-o">}</span>
<span class="tok-o">}</span></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_guardar_y_obtener_datos_de_la_sesión">3.2.2. Guardar y obtener datos de la sesión</h4>
<div class="paragraph">
<p>La interfaz <strong><code>HttpSession</code></strong> proporciona métodos que permiten almacenar y obtener:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Propiedades de la sesión, como por ejemplo su identificador:</p>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span class="tok-kd">public</span> <span class="tok-n">String</span> <span class="tok-nf">getId</span><span class="tok-o">()</span></code></pre>
</div>
</div>
</li>
<li>
<p>Datos de la aplicación, que se almacenan y obtienen como pares nombre-valor, donde el nombre es un <code>String</code> que identifica al dato, y el valor es un <code>Object</code> con el valor asociado. Tendremos que tener cuidado de no sobreescribir datos de un servlet desde otro accidentalmente. Se tienen los métodos:</p>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span class="tok-kd">public</span> <span class="tok-n">Object</span> <span class="tok-nf">getAttribute</span><span class="tok-o">(</span><span class="tok-n">String</span> <span class="tok-n">nombre</span><span class="tok-o">)</span>
<span class="tok-kd">public</span> <span class="tok-kt">void</span>   <span class="tok-nf">setAttribute</span><span class="tok-o">(</span><span class="tok-n">String</span> <span class="tok-n">nombre</span><span class="tok-o">,</span> <span class="tok-n">Object</span> <span class="tok-n">valor</span><span class="tok-o">)</span>
<span class="tok-kd">public</span> <span class="tok-kt">void</span>   <span class="tok-nf">removeAttribute</span><span class="tok-o">(</span><span class="tok-n">String</span> <span class="tok-n">nombre</span><span class="tok-o">)</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>que obtienen / establecen / eliminan, respectivamente, valores de atributos. Estos métodos eran <code>getValue()</code>, <code>putValue()</code>  y <code>removeValue()</code> hasta la versión 2.2 de servlets. Se tienen además métodos como <code>getAttributeNames()</code> para obtener los nombres de los atributos que se tienen almacenados para la sesión, y otros métodos de utilidad en la clase <code>HttpSession</code>.</p>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>Por ejemplo:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span class="tok-kd">public</span> <span class="tok-kd">class</span> <span class="tok-nc">MiServlet</span> <span class="tok-kd">extends</span> <span class="tok-n">HttpServlet</span>
<span class="tok-o">{</span>
	<span class="tok-kd">public</span> <span class="tok-kt">void</span> <span class="tok-nf">doGet</span> <span class="tok-o">(</span><span class="tok-n">HttpServletRequest</span> <span class="tok-n">request</span><span class="tok-o">,</span>
	                   <span class="tok-n">HttpServletResponse</span> <span class="tok-n">response</span><span class="tok-o">)</span>
	                <span class="tok-kd">throws</span> <span class="tok-n">ServletException</span><span class="tok-o">,</span> <span class="tok-n">IOException</span> <span class="tok-o">{</span>
		<span class="tok-n">HttpSession</span> <span class="tok-n">sesion</span> <span class="tok-o">=</span> <span class="tok-n">request</span><span class="tok-o">.</span><span class="tok-na">getSession</span><span class="tok-o">(</span><span class="tok-kc">true</span><span class="tok-o">);</span>
		<span class="tok-n">String</span> <span class="tok-n">nombreUsuario</span> <span class="tok-o">=</span>
		   <span class="tok-o">(</span><span class="tok-n">String</span><span class="tok-o">)(</span><span class="tok-n">sesion</span><span class="tok-o">.</span><span class="tok-na">getAttribute</span><span class="tok-o">(</span><span class="tok-s">&quot;nombre&quot;</span><span class="tok-o">));</span>
		<span class="tok-n">sesion</span><span class="tok-o">.</span><span class="tok-na">setAttribute</span><span class="tok-o">(</span><span class="tok-s">&quot;password&quot;</span><span class="tok-o">,</span> <span class="tok-s">&quot;secreto&quot;</span><span class="tok-o">);</span>
	<span class="tok-o">}</span>
<span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>El ejemplo lee el atributo "nombre" de la sesión, y establece el atributo "password" al valor "secreto".</p>
</div>
</div>
<div class="sect3">
<h4 id="_invalidar_la_sesión">3.2.3. Invalidar la sesión</h4>
<div class="paragraph">
<p>Una sesión de usuario puede invalidarse manualmente, o automáticamente (dependiendo de dónde esté ejecutando el servlet). Esto implica eliminar el objeto <code>HttpSession</code> y sus valores de la memoria. Se tienen los métodos de <code>HttpSession</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span class="tok-kd">public</span> <span class="tok-kt">int</span> <span class="tok-nf">getMaxInactiveInterval</span><span class="tok-o">()</span>
<span class="tok-kd">public</span> <span class="tok-kt">void</span> <span class="tok-nf">setMaxInactiveInterval</span><span class="tok-o">(</span><span class="tok-kt">int</span> <span class="tok-n">intervalo</span><span class="tok-o">)</span>
<span class="tok-kd">public</span> <span class="tok-kt">void</span> <span class="tok-nf">invalidate</span><span class="tok-o">()</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Para invalidarla automáticamente, la sesión expira cuando transcurre el tiempo indicado por el método <strong><code>getMaxInactiveInterval()</code></strong> entre dos accesos del cliente (en segundos). Se puede establecer dicho valor con <strong><code>setMaxInactiveInterval(&#8230;&#8203;)</code></strong>.</p>
</div>
<div class="paragraph">
<p>Para invalidar manualmente una sesión, se emplea el método <strong><code>invalidate()</code></strong> de la misma. Esto puede ser interesante por ejemplo en comercio electrónico: podemos mantener una sesión donde se vayan acumulando los productos que un usuario quiera comprar, e invalidar la sesión (borrarla) cuando el usuario compre los productos.</p>
</div>
<div class="paragraph">
<p>Por ejemplo:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span class="tok-kd">public</span> <span class="tok-kd">class</span> <span class="tok-nc">MiServlet</span> <span class="tok-kd">extends</span> <span class="tok-n">HttpServlet</span>
<span class="tok-o">{</span>
	<span class="tok-kd">public</span> <span class="tok-kt">void</span> <span class="tok-nf">doGet</span> <span class="tok-o">(</span><span class="tok-n">HttpServletRequest</span> <span class="tok-n">request</span><span class="tok-o">,</span>
	                   <span class="tok-n">HttpServletResponse</span> <span class="tok-n">response</span><span class="tok-o">)</span>
	                <span class="tok-kd">throws</span> <span class="tok-n">ServletException</span><span class="tok-o">,</span> <span class="tok-n">IOException</span> <span class="tok-o">{</span>
		<span class="tok-n">HttpSession</span> <span class="tok-n">sesion</span> <span class="tok-o">=</span> <span class="tok-n">request</span><span class="tok-o">.</span><span class="tok-na">getSession</span><span class="tok-o">(</span><span class="tok-kc">true</span><span class="tok-o">);</span>
		<span class="tok-o">...</span>
		<span class="tok-n">sesion</span><span class="tok-o">.</span><span class="tok-na">invalidate</span><span class="tok-o">();</span>
		<span class="tok-o">...</span>
	<span class="tok-o">}</span>
<span class="tok-o">}</span></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_compatibilidad_con_los_navegadores">3.2.4. Compatibilidad con los navegadores</h4>
<div class="paragraph">
<p>Una alternativa para el seguimiento de sesiones consiste en la <strong>reescritura de URLs</strong>. Con esta técnica, se añaden como parámetros de la URL los datos relativos a la sesión actual, de forma que se van conservando entre las páginas.</p>
</div>
<div class="paragraph">
<p>El seguimiento de sesiones por defecto emplea cookies para almacenar el identificador de una sesión. Para poder utilizar seguimiento de sesiones con usuarios que accedan desde navegadores que no utilicen cookies, los servlets aplican automáticamente la reescritura de URLs cuando no se utilizan cookies.</p>
</div>
<div class="paragraph">
<p>Para poder utilizar esto, debemos codificar todas las URLs que referenciemos. Para esto se emplean los métodos:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span class="tok-kd">public</span> <span class="tok-n">String</span> <span class="tok-nf">encodeURL</span><span class="tok-o">(</span><span class="tok-n">String</span> <span class="tok-n">url</span><span class="tok-o">)</span>
<span class="tok-kd">public</span> <span class="tok-n">String</span> <span class="tok-nf">encodeRedirectURL</span><span class="tok-o">(</span><span class="tok-n">String</span> <span class="tok-n">url</span><span class="tok-o">)</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>El primero se emplea para asociar identificadores con URLs, se utilizará cuando pongamos urls en el contenido de la página que generamos. El segundo se utiliza para asociar identificadores con redirecciones. Lo emplearemos cuando utilicemos métodos <code>sendRedirect()</code>, para codificar la URL que se le pasa. Ambos devuelven la URL sobreescrita si la sobreescritura ha sido necesaria, o la misma URL si no ha sido necesario sobreescribir.</p>
</div>
<div class="paragraph">
<p>Por ejemplo:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span class="tok-kd">public</span> <span class="tok-kd">class</span> <span class="tok-nc">MiServlet</span> <span class="tok-kd">extends</span> <span class="tok-n">HttpServlet</span>
<span class="tok-o">{</span>
	<span class="tok-kd">public</span> <span class="tok-kt">void</span> <span class="tok-nf">doGet</span> <span class="tok-o">(</span><span class="tok-n">HttpServletRequest</span> <span class="tok-n">request</span><span class="tok-o">,</span>
	                   <span class="tok-n">HttpServletResponse</span> <span class="tok-n">response</span><span class="tok-o">)</span>
	                <span class="tok-kd">throws</span> <span class="tok-n">ServletException</span><span class="tok-o">,</span> <span class="tok-n">IOException</span> <span class="tok-o">{</span>
		<span class="tok-o">...</span>
		<span class="tok-n">String</span> <span class="tok-n">url</span> <span class="tok-o">=</span> <span class="tok-n">response</span><span class="tok-o">.</span><span class="tok-na">encodeURL</span><span class="tok-o">(</span>
		   <span class="tok-s">&quot;http://localhost:8080/mipagina.html&quot;</span><span class="tok-o">);</span>
		<span class="tok-n">out</span><span class="tok-o">.</span><span class="tok-na">println</span> <span class="tok-o">(</span><span class="tok-s">&quot;&lt;a href=\&quot;&quot;</span> <span class="tok-o">+</span> <span class="tok-n">url</span> <span class="tok-o">+</span> <span class="tok-s">&quot;\&quot;&gt;...&lt;/a&gt;&quot;</span><span class="tok-o">);</span>
		<span class="tok-o">...</span>
		<span class="tok-n">String</span> <span class="tok-n">url2</span> <span class="tok-o">=</span> <span class="tok-n">response</span><span class="tok-o">.</span><span class="tok-na">encodeRedirectURL</span><span class="tok-o">(</span>
		   <span class="tok-s">&quot;http://otrapagina.com&quot;</span><span class="tok-o">);</span>
		<span class="tok-n">response</span><span class="tok-o">.</span><span class="tok-na">sendRedirect</span><span class="tok-o">(</span><span class="tok-n">url2</span><span class="tok-o">);</span>
	<span class="tok-o">}</span>
<span class="tok-o">}</span></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_oyentes">3.2.5. Oyentes</h4>
<div class="paragraph">
<p>Existen tres tipos de oyentes (<code>listeners</code>) que podemos utilizar en sesiones, para dar respuesta a eventos que produzcan las propias sesiones, o que desde fuera se provoquen sobre las mismas:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>HttpSessionListener</code> se emplea para eventos de crear la sesión y terminarla. Tiene los métodos:</p>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span class="tok-kd">public</span> <span class="tok-kt">void</span> <span class="tok-nf">sessionCreated</span><span class="tok-o">(</span><span class="tok-n">HttpSessionEvent</span> <span class="tok-n">e</span><span class="tok-o">)</span>
<span class="tok-kd">public</span> <span class="tok-kt">void</span> <span class="tok-nf">sessionDestroyed</span><span class="tok-o">(</span><span class="tok-n">HttpSessionEvent</span> <span class="tok-n">e</span><span class="tok-o">)</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>El objeto que implemente esta interfaz ejecutará el código de <code>sessionCreated()</code> cuando se inicie la sesión, y el de <code>sessionDestroyed()</code> cuando se termine. Las clases que implementen este oyente deben llevar la anotación <code>@WebListener</code> en caso de estar utilizando la API de Servlet 3.0, o bien configurarse en el fichero descriptor de la aplicación, mediante etiquetas <strong>&lt;listener&gt;</strong>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><span class="tok-nt">&lt;listener&gt;</span>
	<span class="tok-nt">&lt;listener-class&gt;</span>clase<span class="tok-nt">&lt;/listener-class&gt;</span>
<span class="tok-nt">&lt;/listener&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>donde en <strong>&lt;listener-class&gt;</strong> se pone el nombre (completo) de la clase que implementa el listener. Así, el listener se registra, y el servidor ya sabe que tiene que notificarle en los momentos oportunos.</p>
</div>
</li>
<li>
<p><code>HttpSessionBindingListener</code>: si un objeto asociado a una sesión implementa esta interfaz, la sesión se encarga de notificarle de cuándo son añadidos y eliminados de la sesión. Para ello la interfaz tiene los métodos:</p>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span class="tok-kd">public</span> <span class="tok-kt">void</span> <span class="tok-nf">valueBound</span><span class="tok-o">(</span><span class="tok-n">HttpSessionBindingEvent</span> <span class="tok-n">e</span><span class="tok-o">)</span>
<span class="tok-kd">public</span> <span class="tok-kt">void</span> <span class="tok-nf">valueUnbound</span><span class="tok-o">(</span><span class="tok-n">HttpSessionBindingEvent</span> <span class="tok-n">e</span><span class="tok-o">)</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>El objeto que implemente esta interfaz ejecutará el código de <code>valueBound()</code> cuando la sesión lo añada, y el método <code>valueUnbound()</code> cuando la sesión lo elimine.</p>
</div>
</li>
<li>
<p><code>HttpSessionActivationListener</code>: si un objeto asociado a una sesión implementa esta interfaz, la sesión se encarga de notificarles de cuándo el contenedor cambia la sesión entre máquinas virtuales distintas, para un sistema distribuido. Para ello tiene los métodos:</p>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span class="tok-kd">public</span> <span class="tok-kt">void</span> <span class="tok-nf">sessionDidActivate</span><span class="tok-o">(</span><span class="tok-n">HttpSessionEvent</span> <span class="tok-n">e</span><span class="tok-o">)</span>
<span class="tok-kd">public</span> <span class="tok-kt">void</span> <span class="tok-nf">sessionWillPassivate</span><span class="tok-o">(</span><span class="tok-n">HttpSessionEvent</span> <span class="tok-n">e</span><span class="tok-o">)</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>El objeto que implemente esta interfaz ejecutará el código de <code>sessionDidActivate()</code> cuando la sesión se active, y <code>sessionWillPassivate()</code> cuando se vuelva pasiva.</p>
</div>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_ejemplos">3.2.6. Ejemplos</h4>
<div class="paragraph">
<p>Aquí tenéis un ejemplo de uso de sesiones. El servlet <code>ServletSesiones</code> cuenta el número de visitas a una página en una sola sesión (en una sola ventana de navegador).</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span class="tok-kn">package</span> <span class="tok-n">ejemplos</span><span class="tok-o">;</span>

<span class="tok-kn">import</span> <span class="tok-nn">java.io.*</span><span class="tok-o">;</span>
<span class="tok-kn">import</span> <span class="tok-nn">javax.servlet.*</span><span class="tok-o">;</span>
<span class="tok-kn">import</span> <span class="tok-nn">javax.servlet.http.*</span><span class="tok-o">;</span>

<span class="tok-kd">public</span> <span class="tok-kd">class</span> <span class="tok-nc">ServletSesiones</span> <span class="tok-kd">extends</span> <span class="tok-n">HttpServlet</span> <span class="tok-o">{</span>

    <span class="tok-c1">// Metodo para GET</span>

    <span class="tok-kd">public</span> <span class="tok-kt">void</span> <span class="tok-nf">doGet</span><span class="tok-o">(</span><span class="tok-n">HttpServletRequest</span> <span class="tok-n">request</span><span class="tok-o">,</span>
                      <span class="tok-n">HttpServletResponse</span> <span class="tok-n">response</span><span class="tok-o">)</span>
                   <span class="tok-kd">throws</span> <span class="tok-n">ServletException</span><span class="tok-o">,</span> <span class="tok-n">IOException</span> <span class="tok-o">{</span>
        <span class="tok-n">response</span><span class="tok-o">.</span><span class="tok-na">setContentType</span><span class="tok-o">(</span><span class="tok-s">&quot;text/html&quot;</span><span class="tok-o">);</span>
        <span class="tok-n">response</span><span class="tok-o">.</span><span class="tok-na">setHeader</span><span class="tok-o">(</span><span class="tok-s">&quot;Cache-Control&quot;</span><span class="tok-o">,</span> <span class="tok-s">&quot;no-cache&quot;</span><span class="tok-o">);</span>

        <span class="tok-n">HttpSession</span> <span class="tok-n">sesion</span> <span class="tok-o">=</span> <span class="tok-n">request</span><span class="tok-o">.</span><span class="tok-na">getSession</span><span class="tok-o">();</span>
        <span class="tok-n">PrintWriter</span> <span class="tok-n">out</span> <span class="tok-o">=</span> <span class="tok-n">response</span><span class="tok-o">.</span><span class="tok-na">getWriter</span><span class="tok-o">();</span>

        <span class="tok-k">if</span> <span class="tok-o">(</span><span class="tok-n">sesion</span><span class="tok-o">.</span><span class="tok-na">isNew</span><span class="tok-o">())</span> <span class="tok-o">{</span>
            <span class="tok-c1">// Mostramos un mensaje de primera visita</span>

            <span class="tok-n">out</span><span class="tok-o">.</span><span class="tok-na">println</span> <span class="tok-o">(</span><span class="tok-s">&quot;&lt;HTML&gt;&quot;</span><span class="tok-o">);</span>
            <span class="tok-n">out</span><span class="tok-o">.</span><span class="tok-na">println</span> <span class="tok-o">(</span><span class="tok-s">&quot;&lt;BODY&gt;&quot;</span><span class="tok-o">);</span>
            <span class="tok-n">out</span><span class="tok-o">.</span><span class="tok-na">println</span> <span class="tok-o">(</span><span class="tok-s">&quot;Primera visita a la pagina&quot;</span><span class="tok-o">);</span>
            <span class="tok-n">out</span><span class="tok-o">.</span><span class="tok-na">println</span> <span class="tok-o">(</span><span class="tok-s">&quot;&lt;BR&gt;&quot;</span><span class="tok-o">);</span>
            <span class="tok-n">out</span><span class="tok-o">.</span><span class="tok-na">println</span> <span class="tok-o">(</span><span class="tok-s">&quot;&lt;/BODY&gt;&quot;</span><span class="tok-o">);</span>
            <span class="tok-n">out</span><span class="tok-o">.</span><span class="tok-na">println</span> <span class="tok-o">(</span><span class="tok-s">&quot;&lt;/HTML&gt;&quot;</span><span class="tok-o">);</span>

            <span class="tok-n">sesion</span><span class="tok-o">.</span><span class="tok-na">setAttribute</span><span class="tok-o">(</span><span class="tok-s">&quot;contador&quot;</span><span class="tok-o">,</span> <span class="tok-k">new</span> <span class="tok-nf">Integer</span><span class="tok-o">(</span><span class="tok-mi">1</span><span class="tok-o">));</span>

        <span class="tok-o">}</span> <span class="tok-k">else</span> <span class="tok-o">{</span>

            <span class="tok-c1">// Mostramos el numero de visitas</span>
            <span class="tok-c1">// y actualizamos el contador</span>

            <span class="tok-kt">int</span> <span class="tok-n">contador</span> <span class="tok-o">=</span> <span class="tok-o">((</span><span class="tok-n">Integer</span><span class="tok-o">)</span>
                <span class="tok-o">(</span><span class="tok-n">sesion</span><span class="tok-o">.</span><span class="tok-na">getAttribute</span><span class="tok-o">(</span><span class="tok-s">&quot;contador&quot;</span><span class="tok-o">))).</span><span class="tok-na">intValue</span><span class="tok-o">();</span>
            <span class="tok-n">contador</span><span class="tok-o">++;</span>

            <span class="tok-n">out</span><span class="tok-o">.</span><span class="tok-na">println</span> <span class="tok-o">(</span><span class="tok-s">&quot;&lt;HTML&gt;&quot;</span><span class="tok-o">);</span>
            <span class="tok-n">out</span><span class="tok-o">.</span><span class="tok-na">println</span> <span class="tok-o">(</span><span class="tok-s">&quot;&lt;BODY&gt;&quot;</span><span class="tok-o">);</span>
            <span class="tok-n">out</span><span class="tok-o">.</span><span class="tok-na">println</span> <span class="tok-o">(</span><span class="tok-s">&quot;Visita numero &quot;</span> <span class="tok-o">+</span>
                         <span class="tok-n">contador</span> <span class="tok-o">+</span>
                         <span class="tok-s">&quot; a la pagina en esta sesion&quot;</span><span class="tok-o">);</span>
            <span class="tok-n">out</span><span class="tok-o">.</span><span class="tok-na">println</span> <span class="tok-o">(</span><span class="tok-s">&quot;&lt;BR&gt;&quot;</span><span class="tok-o">);</span>
            <span class="tok-n">out</span><span class="tok-o">.</span><span class="tok-na">println</span> <span class="tok-o">(</span><span class="tok-s">&quot;&lt;/BODY&gt;&quot;</span><span class="tok-o">);</span>
            <span class="tok-n">out</span><span class="tok-o">.</span><span class="tok-na">println</span> <span class="tok-o">(</span><span class="tok-s">&quot;&lt;/HTML&gt;&quot;</span><span class="tok-o">);</span>

            <span class="tok-n">sesion</span><span class="tok-o">.</span><span class="tok-na">setAttribute</span><span class="tok-o">(</span><span class="tok-s">&quot;contador&quot;</span><span class="tok-o">,</span>
                                <span class="tok-k">new</span> <span class="tok-nf">Integer</span><span class="tok-o">(</span><span class="tok-n">contador</span><span class="tok-o">));</span>
	<span class="tok-o">}</span>
   <span class="tok-o">}</span>
<span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>El siguiente servlet utiliza como atributo de sesión una clase interna <code>ObjetoSesion</code>, que implementa la interfaz <code>HttpSessionBindingListener</code>. Dicho objeto tiene dentro un valor entero, y una cadena. Cada vez que el objeto se añade a la sesión se modifica un mensaje de texto, mostrando el valor entero actual del objeto:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span class="tok-kn">package</span> <span class="tok-n">ejemplos</span><span class="tok-o">;</span>

<span class="tok-kn">import</span> <span class="tok-nn">java.io.*</span><span class="tok-o">;</span>
<span class="tok-kn">import</span> <span class="tok-nn">javax.servlet.*</span><span class="tok-o">;</span>
<span class="tok-kn">import</span> <span class="tok-nn">javax.servlet.http.*</span><span class="tok-o">;</span>

<span class="tok-kd">public</span> <span class="tok-kd">class</span> <span class="tok-nc">EjemploServletListener</span> <span class="tok-kd">extends</span> <span class="tok-n">HttpServlet</span> <span class="tok-o">{</span>
    <span class="tok-kd">public</span> <span class="tok-kt">void</span> <span class="tok-nf">doGet</span><span class="tok-o">(</span><span class="tok-n">HttpServletRequest</span> <span class="tok-n">request</span><span class="tok-o">,</span>
                      <span class="tok-n">HttpServletResponse</span> <span class="tok-n">response</span><span class="tok-o">)</span>
                   <span class="tok-kd">throws</span> <span class="tok-n">ServletException</span><span class="tok-o">,</span> <span class="tok-n">IOException</span> <span class="tok-o">{</span>
        <span class="tok-n">response</span><span class="tok-o">.</span><span class="tok-na">setContentType</span><span class="tok-o">(</span><span class="tok-s">&quot;text/html&quot;</span><span class="tok-o">);</span>
        <span class="tok-n">response</span><span class="tok-o">.</span><span class="tok-na">setHeader</span><span class="tok-o">(</span><span class="tok-s">&quot;Cache-Control&quot;</span><span class="tok-o">,</span>
                           <span class="tok-s">&quot;no-cache&quot;</span><span class="tok-o">);</span>

        <span class="tok-n">HttpSession</span> <span class="tok-n">sesion</span> <span class="tok-o">=</span> <span class="tok-n">request</span><span class="tok-o">.</span><span class="tok-na">getSession</span><span class="tok-o">();</span>
        <span class="tok-n">PrintWriter</span> <span class="tok-n">out</span> <span class="tok-o">=</span> <span class="tok-n">response</span><span class="tok-o">.</span><span class="tok-na">getWriter</span><span class="tok-o">();</span>

        <span class="tok-k">if</span> <span class="tok-o">(</span><span class="tok-n">sesion</span><span class="tok-o">.</span><span class="tok-na">isNew</span><span class="tok-o">())</span> <span class="tok-o">{</span>
            <span class="tok-c1">// Mostramos mensaje de inicio</span>

            <span class="tok-n">out</span><span class="tok-o">.</span><span class="tok-na">println</span> <span class="tok-o">(</span><span class="tok-s">&quot;&lt;HTML&gt;&lt;BODY&gt;&quot;</span> <span class="tok-o">+</span>
                         <span class="tok-s">&quot;Mensaje de inicio&quot;</span> <span class="tok-o">+</span>
                         <span class="tok-s">&quot;&lt;/BODY&gt;&lt;/HTML&gt;&quot;</span><span class="tok-o">);</span>
            <span class="tok-n">sesion</span><span class="tok-o">.</span><span class="tok-na">setAttribute</span><span class="tok-o">(</span><span class="tok-s">&quot;contador&quot;</span><span class="tok-o">,</span>
                                <span class="tok-k">new</span> <span class="tok-nf">ObjetoSesion</span><span class="tok-o">(</span><span class="tok-mi">1</span><span class="tok-o">));</span>

        <span class="tok-o">}</span> <span class="tok-k">else</span> <span class="tok-o">{</span>

            <span class="tok-c1">// Mostramos el valor actual del</span>
            <span class="tok-c1">// objeto &quot;contador&quot;</span>

            <span class="tok-kt">int</span> <span class="tok-n">contador</span> <span class="tok-o">=</span> <span class="tok-o">((</span><span class="tok-n">ObjetoSesion</span><span class="tok-o">)</span>
                <span class="tok-o">(</span><span class="tok-n">sesion</span><span class="tok-o">.</span><span class="tok-na">getAttribute</span><span class="tok-o">(</span><span class="tok-s">&quot;contador&quot;</span><span class="tok-o">))).</span><span class="tok-na">getValor</span><span class="tok-o">();</span>
            <span class="tok-n">String</span> <span class="tok-n">mensaje</span> <span class="tok-o">=</span> <span class="tok-o">((</span><span class="tok-n">ObjetoSesion</span><span class="tok-o">)</span>
                <span class="tok-o">(</span><span class="tok-n">sesion</span><span class="tok-o">.</span><span class="tok-na">getAttribute</span><span class="tok-o">(</span><span class="tok-s">&quot;contador&quot;</span><span class="tok-o">))).</span><span class="tok-na">getEnlazado</span><span class="tok-o">();</span>

            <span class="tok-n">out</span><span class="tok-o">.</span><span class="tok-na">println</span> <span class="tok-o">(</span><span class="tok-s">&quot;&lt;HTML&gt;&lt;BODY&gt;&quot;</span><span class="tok-o">);</span>
            <span class="tok-n">out</span><span class="tok-o">.</span><span class="tok-na">println</span> <span class="tok-o">(</span><span class="tok-s">&quot;Valor: &quot;</span> <span class="tok-o">+</span> <span class="tok-n">contador</span> <span class="tok-o">+</span>
                         <span class="tok-s">&quot;&lt;br&gt;Enlazado: &quot;</span> <span class="tok-o">+</span> <span class="tok-n">mensaje</span><span class="tok-o">);</span>
            <span class="tok-n">out</span><span class="tok-o">.</span><span class="tok-na">println</span> <span class="tok-o">(</span><span class="tok-s">&quot;&lt;/BODY&gt;&lt;/HTML&gt;&quot;</span><span class="tok-o">);</span>

            <span class="tok-n">sesion</span><span class="tok-o">.</span><span class="tok-na">setAttribute</span><span class="tok-o">(</span><span class="tok-s">&quot;contador&quot;</span><span class="tok-o">,</span>
                                <span class="tok-k">new</span> <span class="tok-nf">ObjetoSesion</span><span class="tok-o">(</span><span class="tok-n">contador</span><span class="tok-o">+</span><span class="tok-mi">1</span><span class="tok-o">));</span>
        <span class="tok-o">}</span>
    <span class="tok-o">}</span>
<span class="tok-o">}</span>

<span class="tok-kd">class</span> <span class="tok-nc">ObjetoSesion</span> <span class="tok-kd">implements</span> <span class="tok-n">HttpSessionBindingListener</span>
<span class="tok-o">{</span>
    <span class="tok-kt">int</span> <span class="tok-n">valor</span><span class="tok-o">;</span>
    <span class="tok-n">String</span> <span class="tok-n">enlazado</span> <span class="tok-o">=</span> <span class="tok-s">&quot;NO&quot;</span><span class="tok-o">;</span>

    <span class="tok-kd">public</span> <span class="tok-nf">ObjetoSesion</span><span class="tok-o">(</span><span class="tok-kt">int</span> <span class="tok-n">valor</span><span class="tok-o">)</span> <span class="tok-o">{</span>
        <span class="tok-k">this</span><span class="tok-o">.</span><span class="tok-na">valor</span> <span class="tok-o">=</span> <span class="tok-n">valor</span><span class="tok-o">;</span>
    <span class="tok-o">}</span>

    <span class="tok-kd">public</span> <span class="tok-kt">void</span> <span class="tok-nf">valueBound</span><span class="tok-o">(</span><span class="tok-n">HttpSessionBindingEvent</span> <span class="tok-n">e</span><span class="tok-o">)</span> <span class="tok-o">{</span>
        <span class="tok-n">enlazado</span> <span class="tok-o">=</span> <span class="tok-s">&quot;Objeto enlazado a la sesion &quot;</span> <span class="tok-o">+</span>
                   <span class="tok-n">valor</span> <span class="tok-o">+</span> <span class="tok-s">&quot; veces&quot;</span><span class="tok-o">;</span>
    <span class="tok-o">}</span>

    <span class="tok-kd">public</span> <span class="tok-kt">void</span> <span class="tok-nf">valueUnbound</span><span class="tok-o">(</span><span class="tok-n">HttpSessionBindingEvent</span> <span class="tok-n">e</span><span class="tok-o">)</span> <span class="tok-o">{</span>
    <span class="tok-o">}</span>

    <span class="tok-kd">public</span> <span class="tok-n">String</span> <span class="tok-nf">getEnlazado</span><span class="tok-o">()</span> <span class="tok-o">{</span>
        <span class="tok-k">return</span> <span class="tok-n">enlazado</span><span class="tok-o">;</span>
    <span class="tok-o">}</span>

    <span class="tok-kd">public</span> <span class="tok-kt">int</span> <span class="tok-nf">getValor</span><span class="tok-o">()</span> <span class="tok-o">{</span>
        <span class="tok-k">return</span> <span class="tok-n">valor</span><span class="tok-o">;</span>
    <span class="tok-o">}</span>
<span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Si cargamos el servlet por primera vez en la sesión, muestra el mensaje:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code>Mensaje de bienvenida</code></pre>
</div>
</div>
<div class="paragraph">
<p>Luego, cada vez que recarguemos el servlet se entrará en el bloque <code>else</code>, y al llamar al método <code>setAttribute()</code> se disparará el método <code>valueBound()</code>, actualizando la cadena. Con esto, con cada recarga se mostrará el mensaje:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code>Valor: i
Enlazado: Objeto enlazado a la sesion i veces</code></pre>
</div>
</div>
<div class="paragraph">
<p>siendo <code>i</code> el número de veces que se ha enlazado (que coincide con el número de veces que se ha cargado el servlet, en este caso). Lo esencial aquí es que esta variable <code>enlazado</code> se modifica sólo desde el método <code>valueBound</code>, y éste es llamado sólo cuando el objeto se añade a la sesión.</p>
</div>
<div style="page-break-after: always;"></div>
</div>
</div>
<div class="sect2">
<h3 id="_ejercicios">3.3. Ejercicios</h3>
<div class="sect3">
<h4 id="_personalizar_un_sitio_web_0_3_puntos">3.3.1. Personalizar un sitio web (0.3 puntos)</h4>
<div class="paragraph">
<p>Una de las utilidades que se le dan a las cookies es la de personalizar sitios Web. La aplicación <code>cweb-sesiones</code> contiene un formulario <code>form_pers.html</code> que le indica al usuario que introduzca su nombre, y elija un color de fondo. Dicho formulario llama después al servlet <code>org.expertojava.cweb.ejercicios.PersonalizaServlet</code>. El formulario también tiene un enlace <em>Ir a página principal</em>, que internamente llama al servlet <code>org.expertojava.cweb.ejercicios.PrincipalServlet</code>. Se pide:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Que en el servlet <code>org.expertojava.cweb.ejercicios.PersonalizaServlet</code> se guarde en dos cookies el nombre del usuario y el valor del color seleccionado. Después, redirigirá a <code>form_pers.html</code> de nuevo.</p>
</li>
<li>
<p>Que el servlet <code>org.expertojava.cweb.ejercicios.PrincipalServlet</code>  (llamado desde el formulario anterior) tome las cookies que le envíe el usuario, y genere una página de bienvenida con el color de fondo que haya en la cookie con el color, y con un mensaje de saludo al nombre que haya en la cookie con el nombre. Para establecer el color de fondo, en el <em>body</em> podemos tener un atributo <em>bgcolor</em>, y ahí le colocaremos el valor que tenga la cookie.</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><span class="tok-nt">&lt;body</span> <span class="tok-na">bgcolor=</span><span class="tok-s">&quot;red&quot;</span><span class="tok-nt">&gt;</span>
...</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_carro_de_la_compra_0_5_puntos">3.3.2. Carro de la compra (0.5 puntos)</h4>
<div class="paragraph">
<p>La aplicación <code>cweb-sesiones</code> contiene también una página <code>form_carro.html</code> que tiene una lista de artículos para comprar. Para comprarlos, basta con pulsar el botón de "Añadir al carro" correspondiente. Dicho formulario llama al servlet <code>org.expertojava.cweb.ejercicios.CarroServlet</code>. Se pide que dicho servlet almacene como objetos de sesión los objetos que se vayan comprando, y genere una página dinámica con:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Cada uno de los objetos que se llevan comprados hasta ahora en la sesión.</p>
</li>
<li>
<p>Precio total de la compra</p>
</li>
<li>
<p>Un enlace al formulario <code>form_carro.html</code> para seguir comprando.</p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Para almacenar los objetos podemos utilizar cualquier estructura de datos que queramos
	(<code>ArrayList</code>, etc), y la guardaremos como un atributo de la sesión (es decir, dicha estructura ENTERA
	la guardaremos como UN UNICO atributo de sesión). Guardaremos, para cada artículo, su nombre y su precio
	unitario, para luego mostrar estos dos datos en la página que se genere. Para tomar el nombre del artículo
	y el precio, notar que cada artículo tiene asociado en la página un formulario con dos campos ocultos
	<em>articulo</em> y <em>precio</em>, con estos elementos.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Crear una clase interna en el propio <em>CarroServlet</em> (llamadla <em>ObjetoCarro</em>,
	por ejemplo), que tenga como campos los valores que hay que guardar de cada artículo:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span class="tok-kd">class</span> <span class="tok-nc">ObjetoCarro</span>
<span class="tok-o">{</span>
	<span class="tok-n">String</span> <span class="tok-n">articulo</span><span class="tok-o">;</span>
	<span class="tok-kt">int</span> <span class="tok-n">precio</span><span class="tok-o">;</span>

	<span class="tok-kd">public</span> <span class="tok-nf">ObjetoCarro</span><span class="tok-o">(</span><span class="tok-n">String</span> <span class="tok-n">articulo</span><span class="tok-o">,</span> <span class="tok-kt">int</span> <span class="tok-n">precio</span><span class="tok-o">)</span>
	<span class="tok-o">{</span>
		<span class="tok-k">this</span><span class="tok-o">.</span><span class="tok-na">articulo</span> <span class="tok-o">=</span> <span class="tok-n">articulo</span><span class="tok-o">;</span>
		<span class="tok-k">this</span><span class="tok-o">.</span><span class="tok-na">precio</span> <span class="tok-o">=</span> <span class="tok-n">precio</span><span class="tok-o">;</span>
	<span class="tok-o">}</span>

	<span class="tok-kd">public</span> <span class="tok-n">String</span> <span class="tok-nf">getArticulo</span><span class="tok-o">()</span>
	<span class="tok-o">{</span>
		<span class="tok-k">return</span> <span class="tok-n">articulo</span><span class="tok-o">;</span>
	<span class="tok-o">}</span>

	<span class="tok-kd">public</span> <span class="tok-kt">int</span> <span class="tok-nf">getPrecio</span><span class="tok-o">()</span>
	<span class="tok-o">{</span>
		<span class="tok-k">return</span> <span class="tok-n">precio</span><span class="tok-o">;</span>
	<span class="tok-o">}</span>
<span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Después, en el servlet <em>CarroServlet</em>, cada vez que el usuario compre un artículo, creáis un objeto de este tipo con los valores del artículo que haya enviado. Y lo añadís a la sesión, almacenando todos los objetos de tipo <em>ObjetoCarro</em> en una lista.</p>
</div>
</div>
<div class="sect3">
<h4 id="_mejoras_para_el_carro_de_la_compra_0_2_puntos">3.3.3. Mejoras para el carro de la compra (0.2 puntos)</h4>
<div class="paragraph">
<p>Sobre el ejercicio anterior:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Añadid un enlace u opción para invalidar la sesión al llamar a <code>org.expertojava.cweb.ejercicios.CarroServlet</code>. Comprobad que al pincharlo, y luego comprar un artículo, el carro aparecerá sólo con ese artículo.</p>
</li>
<li>
<p>Si quisiéramos aplicar reescritura de URLs en el ejercicio anterior para prevenir que las cookies estén deshabilitadas, ¿qué cambios tendríamos que hacer? Dejadlos reflejados en el código.</p>
</li>
</ul>
</div>
</div>
</div>
</div>
</div>
</div>
<div id="footer">
<div id="footer-text">
Last updated 2015-10-06 12:16:54 CEST
</div>
</div>
</body>
</html>