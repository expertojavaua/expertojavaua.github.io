<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<!--[if IE]><meta http-equiv="X-UA-Compatible" content="IE=edge"><![endif]-->
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 1.5.2">
<meta name="author" content="Domingo Gallardo">
<title>Componentes enterprise</title>
<style>/*! normalize.css v2.1.2 | MIT License | git.io/normalize */
/* ========================================================================== HTML5 display definitions ========================================================================== */
/** Correct `block` display not defined in IE 8/9. */
article, aside, details, figcaption, figure, footer, header, hgroup, main, nav, section, summary { display: block; }

/** Correct `inline-block` display not defined in IE 8/9. */
audio, canvas, video { display: inline-block; }

/** Prevent modern browsers from displaying `audio` without controls. Remove excess height in iOS 5 devices. */
audio:not([controls]) { display: none; height: 0; }

/** Address `[hidden]` styling not present in IE 8/9. Hide the `template` element in IE, Safari, and Firefox < 22. */
[hidden], template { display: none; }

script { display: none !important; }

/* ========================================================================== Base ========================================================================== */
/** 1. Set default font family to sans-serif. 2. Prevent iOS text size adjust after orientation change, without disabling user zoom. */
html { font-family: sans-serif; /* 1 */ -ms-text-size-adjust: 100%; /* 2 */ -webkit-text-size-adjust: 100%; /* 2 */ }

/** Remove default margin. */
body { margin: 0; }

/* ========================================================================== Links ========================================================================== */
/** Remove the gray background color from active links in IE 10. */
a { background: transparent; }

/** Address `outline` inconsistency between Chrome and other browsers. */
a:focus { outline: thin dotted; }

/** Improve readability when focused and also mouse hovered in all browsers. */
a:active, a:hover { outline: 0; }

/* ========================================================================== Typography ========================================================================== */
/** Address variable `h1` font-size and margin within `section` and `article` contexts in Firefox 4+, Safari 5, and Chrome. */
h1 { font-size: 2em; margin: 0.67em 0; }

/** Address styling not present in IE 8/9, Safari 5, and Chrome. */
abbr[title] { border-bottom: 1px dotted; }

/** Address style set to `bolder` in Firefox 4+, Safari 5, and Chrome. */
b, strong { font-weight: bold; }

/** Address styling not present in Safari 5 and Chrome. */
dfn { font-style: italic; }

/** Address differences between Firefox and other browsers. */
hr { -moz-box-sizing: content-box; box-sizing: content-box; height: 0; }

/** Address styling not present in IE 8/9. */
mark { background: #ff0; color: #000; }

/** Correct font family set oddly in Safari 5 and Chrome. */
code, kbd, pre, samp { font-family: monospace, serif; font-size: 1em; }

/** Improve readability of pre-formatted text in all browsers. */
pre { white-space: pre-wrap; }

/** Set consistent quote types. */
q { quotes: "\201C" "\201D" "\2018" "\2019"; }

/** Address inconsistent and variable font size in all browsers. */
small { font-size: 80%; }

/** Prevent `sub` and `sup` affecting `line-height` in all browsers. */
sub, sup { font-size: 75%; line-height: 0; position: relative; vertical-align: baseline; }

sup { top: -0.5em; }

sub { bottom: -0.25em; }

/* ========================================================================== Embedded content ========================================================================== */
/** Remove border when inside `a` element in IE 8/9. */
img { border: 0; }

/** Correct overflow displayed oddly in IE 9. */
svg:not(:root) { overflow: hidden; }

/* ========================================================================== Figures ========================================================================== */
/** Address margin not present in IE 8/9 and Safari 5. */
figure { margin: 0; }

/* ========================================================================== Forms ========================================================================== */
/** Define consistent border, margin, and padding. */
fieldset { border: 1px solid #c0c0c0; margin: 0 2px; padding: 0.35em 0.625em 0.75em; }

/** 1. Correct `color` not being inherited in IE 8/9. 2. Remove padding so people aren't caught out if they zero out fieldsets. */
legend { border: 0; /* 1 */ padding: 0; /* 2 */ }

/** 1. Correct font family not being inherited in all browsers. 2. Correct font size not being inherited in all browsers. 3. Address margins set differently in Firefox 4+, Safari 5, and Chrome. */
button, input, select, textarea { font-family: inherit; /* 1 */ font-size: 100%; /* 2 */ margin: 0; /* 3 */ }

/** Address Firefox 4+ setting `line-height` on `input` using `!important` in the UA stylesheet. */
button, input { line-height: normal; }

/** Address inconsistent `text-transform` inheritance for `button` and `select`. All other form control elements do not inherit `text-transform` values. Correct `button` style inheritance in Chrome, Safari 5+, and IE 8+. Correct `select` style inheritance in Firefox 4+ and Opera. */
button, select { text-transform: none; }

/** 1. Avoid the WebKit bug in Android 4.0.* where (2) destroys native `audio` and `video` controls. 2. Correct inability to style clickable `input` types in iOS. 3. Improve usability and consistency of cursor style between image-type `input` and others. */
button, html input[type="button"], input[type="reset"], input[type="submit"] { -webkit-appearance: button; /* 2 */ cursor: pointer; /* 3 */ }

/** Re-set default cursor for disabled elements. */
button[disabled], html input[disabled] { cursor: default; }

/** 1. Address box sizing set to `content-box` in IE 8/9. 2. Remove excess padding in IE 8/9. */
input[type="checkbox"], input[type="radio"] { box-sizing: border-box; /* 1 */ padding: 0; /* 2 */ }

/** 1. Address `appearance` set to `searchfield` in Safari 5 and Chrome. 2. Address `box-sizing` set to `border-box` in Safari 5 and Chrome (include `-moz` to future-proof). */
input[type="search"] { -webkit-appearance: textfield; /* 1 */ -moz-box-sizing: content-box; -webkit-box-sizing: content-box; /* 2 */ box-sizing: content-box; }

/** Remove inner padding and search cancel button in Safari 5 and Chrome on OS X. */
input[type="search"]::-webkit-search-cancel-button, input[type="search"]::-webkit-search-decoration { -webkit-appearance: none; }

/** Remove inner padding and border in Firefox 4+. */
button::-moz-focus-inner, input::-moz-focus-inner { border: 0; padding: 0; }

/** 1. Remove default vertical scrollbar in IE 8/9. 2. Improve readability and alignment in all browsers. */
textarea { overflow: auto; /* 1 */ vertical-align: top; /* 2 */ }

/* ========================================================================== Tables ========================================================================== */
/** Remove most spacing between table cells. */
table { border-collapse: collapse; border-spacing: 0; }

meta.foundation-mq-small { font-family: "only screen and (min-width: 768px)"; width: 768px; }

meta.foundation-mq-medium { font-family: "only screen and (min-width:1280px)"; width: 1280px; }

meta.foundation-mq-large { font-family: "only screen and (min-width:1440px)"; width: 1440px; }

*, *:before, *:after { -moz-box-sizing: border-box; -webkit-box-sizing: border-box; box-sizing: border-box; }

html, body { font-size: 97%; }

body { background: white; color: #222222; padding: 0; margin: 0; font-family: "Helvetica Neue", "Helvetica", Helvetica, Arial, sans-serif; font-weight: normal; font-style: normal; line-height: 1; position: relative; cursor: auto; }

a:hover { cursor: pointer; }

img, object, embed { max-width: 100%; height: auto; }

object, embed { height: 100%; }

img { -ms-interpolation-mode: bicubic; }

#map_canvas img, #map_canvas embed, #map_canvas object, .map_canvas img, .map_canvas embed, .map_canvas object { max-width: none !important; }

.left { float: left !important; }

.right { float: right !important; }

.text-left { text-align: left !important; }

.text-right { text-align: right !important; }

.text-center { text-align: center !important; }

.text-justify { text-align: justify !important; }

.hide { display: none; }

.antialiased, body { -webkit-font-smoothing: antialiased; }

img { display: inline-block; vertical-align: middle; }

textarea { height: auto; min-height: 50px; }

select { width: 100%; }

p.lead, .paragraph.lead > p, #preamble > .sectionbody > .paragraph:first-of-type p { font-size: 1.21875em; line-height: 1.6; }

.subheader, .admonitionblock td.content > .title, .audioblock > .title, .exampleblock > .title, .imageblock > .title, .listingblock > .title, .literalblock > .title, .stemblock > .title, .openblock > .title, .paragraph > .title, .quoteblock > .title, table.tableblock > .title, .verseblock > .title, .videoblock > .title, .dlist > .title, .olist > .title, .ulist > .title, .qlist > .title, .hdlist > .title { line-height: 1.4; color: #6f6f6f; font-weight: 300; margin-top: 0.2em; margin-bottom: 0.5em; }

/* Typography resets */
div, dl, dt, dd, ul, ol, li, h1, h2, h3, #toctitle, .sidebarblock > .content > .title, h4, h5, h6, pre, form, p, blockquote, th, td { margin: 0; padding: 0; direction: ltr; }

/* Default Link Styles */
a { color: #1164be; text-decoration: none; line-height: inherit; }
a img { border: none; }

/* Default paragraph styles */
p { font-family: inherit; font-weight: normal; font-size: 1em; line-height: 1.4; margin-bottom: 1em; text-rendering: optimizeLegibility; }
p aside { font-size: 0.875em; line-height: 1.35; font-style: italic; }

/* Default header styles */
h1, h2, h3, #toctitle, .sidebarblock > .content > .title, h4, h5, h6 { font-family: "Helvetica Neue", "Helvetica", Helvetica, Arial, sans-serif; font-weight: bold; font-style: normal; color: #1c355e; text-rendering: optimizeLegibility; margin-top: 1em; margin-bottom: 0.5em; line-height: 1.2125em; }
h1 small, h2 small, h3 small, #toctitle small, .sidebarblock > .content > .title small, h4 small, h5 small, h6 small { font-size: 60%; color: #6f6f6f; line-height: 0; }

h1 { font-size: 2.125em; }

h2 { font-size: 1.6875em; }

h3, #toctitle, .sidebarblock > .content > .title { font-size: 1.375em; }

h4 { font-size: 1.125em; }

h5 { font-size: 1.125em; }

h6 { font-size: 1em; }

hr { border: solid #dddddd; border-width: 1px 0 0; clear: both; margin: 1.25em 0 1.1875em; height: 0; }

/* Helpful Typography Defaults */
em, i { font-style: italic; line-height: inherit; }

strong, b { font-weight: bold; line-height: inherit; }

small { font-size: 60%; line-height: inherit; }

code { font-family: Consolas, "Liberation Mono", Courier, monospace; font-weight: bold; }

/* Lists */
ul, ol, dl { font-size: 1em; line-height: 1.4; margin-bottom: 1.25em; list-style-position: outside; font-family: inherit; }

ul, ol { margin-left: 2.5em; }
ul.no-bullet, ol.no-bullet { margin-left: 1.5em; }

/* Unordered Lists */
ul li ul, ul li ol { margin-left: 1.25em; margin-bottom: 0; font-size: 1em; /* Override nested font-size change */ }
ul.square li ul, ul.circle li ul, ul.disc li ul { list-style: inherit; }
ul.square { list-style-type: square; }
ul.circle { list-style-type: circle; }
ul.disc { list-style-type: disc; }
ul.no-bullet { list-style: none; }

/* Ordered Lists */
ol li ul, ol li ol { margin-left: 1.25em; margin-bottom: 0; }

/* Definition Lists */
dl dt { margin-bottom: 0.3125em; font-weight: bold; }
dl dd { margin-bottom: 1.25em; }

/* Abbreviations */
abbr, acronym { text-transform: uppercase; font-size: 90%; color: #222222; border-bottom: 1px dotted #dddddd; cursor: help; }

abbr { text-transform: none; }

/* Blockquotes */
blockquote { margin: 0 0 1.25em; padding: 0.5625em 1.25em 0 1.1875em; border-left: 1px solid #dddddd; }
blockquote cite { display: block; font-size: 0.8125em; color: #555555; }
blockquote cite:before { content: "\2014 \0020"; }
blockquote cite a, blockquote cite a:visited { color: #555555; }

blockquote, blockquote p { line-height: 1.6; color: #6f6f6f; }

/* Microformats */
.vcard { display: inline-block; margin: 0 0 1.25em 0; border: 1px solid #dddddd; padding: 0.625em 0.75em; }
.vcard li { margin: 0; display: block; }
.vcard .fn { font-weight: bold; font-size: 0.9375em; }

.vevent .summary { font-weight: bold; }
.vevent abbr { cursor: auto; text-decoration: none; font-weight: bold; border: none; padding: 0 0.0625em; }

/*@media only screen and (min-width: 768px) { h1, h2, h3, #toctitle, .sidebarblock > .content > .title, h4, h5, h6 { line-height: 1.4; }
  h1 { font-size: 2.75em; }
  h2 { font-size: 2.3125em; }
  h3, #toctitle, .sidebarblock > .content > .title { font-size: 1.6875em; }
  h4 { font-size: 1.4375em; } }*/
/* Tables */
table { background: white; margin-bottom: 1.25em; border: solid 1px #dddddd; }
table thead, table tfoot { background: whitesmoke; font-weight: bold; }
table thead tr th, table thead tr td, table tfoot tr th, table tfoot tr td { padding: 0.5em 0.625em 0.625em; font-size: inherit; color: #222222; text-align: left; }
table tr th, table tr td { padding: 0.5625em 0.625em; font-size: inherit; color: #222222; }
table tr.even, table tr.alt, table tr:nth-of-type(even) { background: #f9f9f9; }
table thead tr th, table tfoot tr th, table tbody tr td, table tr td, table tfoot tr td { display: table-cell; line-height: 1.4; }

h1, h2, h3, #toctitle, .sidebarblock > .content > .title, h4, h5, h6 { line-height: 1.4; border-bottom: 1px solid #dddddd }

.clearfix:before, .clearfix:after, .float-group:before, .float-group:after { content: " "; display: table; }
.clearfix:after, .float-group:after { clear: both; }

*:not(pre) > code { font-size: inherit; font-style: normal !important; letter-spacing: 0; padding: 3px 2px 1px 2px; background-color: #eeeeee; border: 1px solid #dddddd; -webkit-border-radius: 0; border-radius: 0; line-height: inherit; font-weight: normal; }

pre, pre > code { line-height: 1.4; color: black; font-family: monospace, serif; font-weight: normal; }

.keyseq { color: #555555; }

kbd { display: inline-block; color: #222222; font-size: 0.75em; line-height: 1.4; background-color: #f7f7f7; border: 1px solid #ccc; -webkit-border-radius: 3px; border-radius: 3px; -webkit-box-shadow: 0 1px 0 rgba(0, 0, 0, 0.2), 0 0 0 0.1em white inset; box-shadow: 0 1px 0 rgba(0, 0, 0, 0.2), 0 0 0 0.1em white inset; margin: -0.15em 0.15em 0 0.15em; padding: 0.2em 0.6em 0.2em 0.5em; vertical-align: middle; white-space: nowrap; }

.keyseq kbd:first-child { margin-left: 0; }

.keyseq kbd:last-child { margin-right: 0; }

.menuseq, .menu { color: #090909; }

b.button:before, b.button:after { position: relative; top: -1px; font-weight: normal; }

b.button:before { content: "["; padding: 0 3px 0 2px; }

b.button:after { content: "]"; padding: 0 2px 0 3px; }

#header, #content, #footnotes, #footer { width: 100%; margin-left: auto; margin-right: auto; margin-top: 0; margin-bottom: 0; max-width: 62.5em; *zoom: 1; position: relative; padding-left: 0.9375em; padding-right: 0.9375em; }
#header:before, #header:after, #content:before, #content:after, #footnotes:before, #footnotes:after, #footer:before, #footer:after { content: " "; display: table; }
#header:after, #content:after, #footnotes:after, #footer:after { clear: both; }

#content { margin-top: 1.25em; }

#content:before { content: none; }

#header > h1:first-child { color: black; margin-top: 2.25rem; margin-bottom: 0; }
#header > h1:first-child + #toc { margin-top: 8px; border-top: 1px solid #dddddd; }
#header > h1:only-child, body.toc2 #header > h1:nth-last-child(2) { border-bottom: 1px solid #dddddd; padding-bottom: 8px; }
#header .details { border-bottom: 1px solid #dddddd; line-height: 1.45; padding-top: 0.25em; padding-bottom: 0.25em; padding-left: 0.25em; color: #555555; display: -ms-flexbox; display: -webkit-flex; display: flex; -ms-flex-flow: row wrap; -webkit-flex-flow: row wrap; flex-flow: row wrap; }
#header .details span:first-child { margin-left: -0.125em; }
#header .details span.email a { color: #6f6f6f; }
#header .details br { display: none; }
#header .details br + span:before { content: "\00a0\2013\00a0"; }
#header .details br + span.author:before { content: "\00a0\22c5\00a0"; color: #6f6f6f; }
#header .details br + span#revremark:before { content: "\00a0|\00a0"; }
#header #revnumber { text-transform: capitalize; }
#header #revnumber:after { content: "\00a0"; }

#content > h1:first-child:not([class]) { color: black; border-bottom: 1px solid #dddddd; padding-bottom: 8px; margin-top: 0; padding-top: 1rem; margin-bottom: 1.25rem; }

#floating {
  position: fixed;
  z-index: 1000;
  padding: 0.5em;
  right: 0;
  top: 0;
  background: white;
  box-shadow: 0 0 1em #777777;
  -webkit-box-shadow: 0 0 1em #777777;
  -moz-box-shadow: 0 0 1em #777777;
  -webkit-border-bottom-left-radius: 5px;
  -moz-border-radius-bottomleft: 5px;
  max-height: 80%;
  overflow: auto;
}

#floating #full { display: none; } /* Hide the full TOC by default */

#floating:hover #full{
  display: block; /* Show it on hover */
}


#toc { border-bottom: 1px solid #dddddd; padding-bottom: 0.5em; }
#toc > ul { margin-left: 0.125em; }
#toc ul.sectlevel0 > li > a { font-style: italic; }
#toc ul.sectlevel0 ul.sectlevel1 { margin: 0.5em 0; }
#toc ul { font-family: "Helvetica Neue", "Helvetica", Helvetica, Arial, sans-serif; list-style-type: none; }
#toc a { text-decoration: none; }
#toc a:active { text-decoration: underline; }

#toctitle { color: #6f6f6f; font-size: 1.2em; }

@media only screen and (min-width: 768px) { #toctitle { font-size: 1.375em; }
  body.toc2 { padding-left: 15em; padding-right: 0; }
  #toc.toc2 { margin-top: 0 !important; background-color: #f2f2f2; position: fixed; width: 15em; left: 0; top: 0; border-right: 1px solid #dddddd; border-top-width: 0 !important; border-bottom-width: 0 !important; z-index: 1000; padding: 1.25em 1em; height: 100%; overflow: auto; }
  #toc.toc2 #toctitle { margin-top: 0; font-size: 1.2em; }
  #toc.toc2 > ul { font-size: 0.9em; margin-bottom: 0; }
  #toc.toc2 ul ul { margin-left: 0; padding-left: 1em; }
  #toc.toc2 ul.sectlevel0 ul.sectlevel1 { padding-left: 0; margin-top: 0.5em; margin-bottom: 0.5em; }
  body.toc2.toc-right { padding-left: 0; padding-right: 15em; }
  body.toc2.toc-right #toc.toc2 { border-right-width: 0; border-left: 1px solid #dddddd; left: auto; right: 0; } }
@media only screen and (min-width: 1280px) { body.toc2 { padding-left: 20em; padding-right: 0; }
  #toc.toc2 { width: 20em; }
  #toc.toc2 #toctitle { font-size: 1.375em; }
  #toc.toc2 > ul { font-size: 0.95em; }
  #toc.toc2 ul ul { padding-left: 1.25em; }
  body.toc2.toc-right { padding-left: 0; padding-right: 20em; } }
#content #toc { border-style: solid; border-width: 1px; border-color: #d9d9d9; margin-bottom: 1.25em; padding: 1.25em; background: #f2f2f2; -webkit-border-radius: 0; border-radius: 0; }
#content #toc > :first-child { margin-top: 0; }
#content #toc > :last-child { margin-bottom: 0; }

#footer { max-width: 100%; background-color: #222222; padding: 1.25em; }

#footer-text { color: #dddddd; line-height: 1.44; }

.sect1 { padding-bottom: 0.625em; }

@media only screen and (min-width: 768px) { .sect1 { padding-bottom: 1.25em; } }
.sect1 + .sect1 { border-top: 1px solid #dddddd; }

#content h1 > a.anchor, h2 > a.anchor, h3 > a.anchor, #toctitle > a.anchor, .sidebarblock > .content > .title > a.anchor, h4 > a.anchor, h5 > a.anchor, h6 > a.anchor { position: absolute; z-index: 1001; width: 1.5ex; margin-left: -1.5ex; display: block; text-decoration: none !important; visibility: hidden; text-align: center; font-weight: normal; }
#content h1 > a.anchor:before, h2 > a.anchor:before, h3 > a.anchor:before, #toctitle > a.anchor:before, .sidebarblock > .content > .title > a.anchor:before, h4 > a.anchor:before, h5 > a.anchor:before, h6 > a.anchor:before { content: "\00A7"; font-size: 0.85em; display: block; padding-top: 0.1em; }
#content h1:hover > a.anchor, #content h1 > a.anchor:hover, h2:hover > a.anchor, h2 > a.anchor:hover, h3:hover > a.anchor, #toctitle:hover > a.anchor, .sidebarblock > .content > .title:hover > a.anchor, h3 > a.anchor:hover, #toctitle > a.anchor:hover, .sidebarblock > .content > .title > a.anchor:hover, h4:hover > a.anchor, h4 > a.anchor:hover, h5:hover > a.anchor, h5 > a.anchor:hover, h6:hover > a.anchor, h6 > a.anchor:hover { visibility: visible; }
#content h1 > a.link, h2 > a.link, h3 > a.link, #toctitle > a.link, .sidebarblock > .content > .title > a.link, h4 > a.link, h5 > a.link, h6 > a.link { color: #222222; text-decoration: none; }
#content h1 > a.link:hover, h2 > a.link:hover, h3 > a.link:hover, #toctitle > a.link:hover, .sidebarblock > .content > .title > a.link:hover, h4 > a.link:hover, h5 > a.link:hover, h6 > a.link:hover { color: #151515; }

.audioblock, .imageblock, .literalblock, .listingblock, .stemblock, .videoblock { margin-bottom: 1.25em; }

.admonitionblock td.content > .title, .audioblock > .title, .exampleblock > .title, .imageblock > .title, .listingblock > .title, .literalblock > .title, .stemblock > .title, .openblock > .title, .paragraph > .title, .quoteblock > .title, table.tableblock > .title, .verseblock > .title, .videoblock > .title, .dlist > .title, .olist > .title, .ulist > .title, .qlist > .title, .hdlist > .title { text-rendering: optimizeLegibility; text-align: left; }

table.tableblock > caption.title { white-space: nowrap; overflow: visible; max-width: 0; }

.paragraph.lead > p, #preamble > .sectionbody > .paragraph:first-of-type p { color: black; }

table.tableblock #preamble > .sectionbody > .paragraph:first-of-type p { font-size: inherit; }

.admonitionblock > table { border-collapse: separate; border: 0; background: none; width: 100%; }
.admonitionblock > table td.icon { text-align: center; width: 80px; }
.admonitionblock > table td.icon img { max-width: none; }
.admonitionblock > table td.icon .title { font-weight: bold; font-family: "Helvetica Neue", "Helvetica", Helvetica, Arial, sans-serif; text-transform: uppercase; }
.admonitionblock > table td.content { padding-left: 1.125em; padding-right: 1.25em; border-left: 1px solid #dddddd; color: #555555; }
.admonitionblock > table td.content > :last-child > :last-child { margin-bottom: 0; }

.exampleblock > .content { border-style: solid; border-width: 1px; border-color: #e6e6e6; margin-bottom: 1.25em; padding: 1.25em; background: white; -webkit-border-radius: 0; border-radius: 0; }
.exampleblock > .content > :first-child { margin-top: 0; }
.exampleblock > .content > :last-child { margin-bottom: 0; }

.sidebarblock { border-style: solid; border-width: 1px; border-color: #d9d9d9; margin-bottom: 1.25em; padding: 1.25em; background: #f2f2f2; -webkit-border-radius: 0; border-radius: 0; }
.sidebarblock > :first-child { margin-top: 0; }
.sidebarblock > :last-child { margin-bottom: 0; }
.sidebarblock > .content > .title { color: #6f6f6f; margin-top: 0; }

.exampleblock > .content > :last-child > :last-child, .exampleblock > .content .olist > ol > li:last-child > :last-child, .exampleblock > .content .ulist > ul > li:last-child > :last-child, .exampleblock > .content .qlist > ol > li:last-child > :last-child, .sidebarblock > .content > :last-child > :last-child, .sidebarblock > .content .olist > ol > li:last-child > :last-child, .sidebarblock > .content .ulist > ul > li:last-child > :last-child, .sidebarblock > .content .qlist > ol > li:last-child > :last-child { margin-bottom: 0; }

.literalblock pre, .listingblock pre:not(.highlight), .listingblock pre[class="highlight"], .listingblock pre[class^="highlight "], .listingblock pre.CodeRay, .listingblock pre.prettyprint { background: #eeeeee; }
.sidebarblock .literalblock pre, .sidebarblock .listingblock pre:not(.highlight), .sidebarblock .listingblock pre[class="highlight"], .sidebarblock .listingblock pre[class^="highlight "], .sidebarblock .listingblock pre.CodeRay, .sidebarblock .listingblock pre.prettyprint { background: #f2f1f1; }

.literalblock pre, .literalblock pre[class], .listingblock pre, .listingblock pre[class] { border: 1px solid #cccccc; -webkit-border-radius: 0; border-radius: 0; word-wrap: break-word; padding: 0.8em 0.8em 0.65em 0.8em; font-size: 0.8125em; }
.literalblock pre.nowrap, .literalblock pre[class].nowrap, .listingblock pre.nowrap, .listingblock pre[class].nowrap { overflow-x: auto; white-space: pre; word-wrap: normal; }
@media only screen and (min-width: 768px) { .literalblock pre, .literalblock pre[class], .listingblock pre, .listingblock pre[class] { font-size: 0.90625em; } }
@media only screen and (min-width: 1280px) { .literalblock pre, .literalblock pre[class], .listingblock pre, .listingblock pre[class] { font-size: 1em; } }

.literalblock.output pre { color: #eeeeee; background-color: black; }

.listingblock pre.highlightjs { padding: 0; }
.listingblock pre.highlightjs > code { padding: 0.8em 0.8em 0.65em 0.8em; -webkit-border-radius: 0; border-radius: 0; }

.listingblock > .content { position: relative; }

.listingblock code[data-lang]:before { display: none; content: attr(data-lang); position: absolute; font-size: 0.75em; top: 0.425rem; right: 0.5rem; line-height: 1; text-transform: uppercase; color: #999; }

.listingblock:hover code[data-lang]:before { display: block; }

.listingblock.terminal pre .command:before { content: attr(data-prompt); padding-right: 0.5em; color: #999; }

.listingblock.terminal pre .command:not([data-prompt]):before { content: "$"; }

table.pyhltable { border-collapse: separate; border: 0; margin-bottom: 0; background: none; }

table.pyhltable td { vertical-align: top; padding-top: 0; padding-bottom: 0; }

table.pyhltable td.code { padding-left: .75em; padding-right: 0; }

pre.pygments .lineno, table.pyhltable td:not(.code) { color: #999; padding-left: 0; padding-right: .5em; border-right: 1px solid #dddddd; }

pre.pygments .lineno { display: inline-block; margin-right: .25em; }

table.pyhltable .linenodiv { background: none !important; padding-right: 0 !important; }

.quoteblock { margin: 0 1em 1.25em 1.5em; display: table; }
.quoteblock > .title { margin-left: -1.5em; margin-bottom: 0.75em; }
.quoteblock blockquote, .quoteblock blockquote p { color: #6f6f6f; font-size: 1.15rem; line-height: 1.75; word-spacing: 0.1em; letter-spacing: 0; font-style: italic; text-align: justify; }
.quoteblock blockquote { margin: 0; padding: 0; border: 0; }
.quoteblock blockquote:before { content: "\201c"; float: left; font-size: 2.75em; font-weight: bold; line-height: 0.6em; margin-left: -0.6em; color: #6f6f6f; text-shadow: 0 1px 2px rgba(0, 0, 0, 0.1); }
.quoteblock blockquote > .paragraph:last-child p { margin-bottom: 0; }
.quoteblock .attribution { margin-top: 0.5em; margin-right: 0.5ex; text-align: right; }
.quoteblock .quoteblock { margin-left: 0; margin-right: 0; padding: 0.5em 0; border-left: 3px solid #555555; }
.quoteblock .quoteblock blockquote { padding: 0 0 0 0.75em; }
.quoteblock .quoteblock blockquote:before { display: none; }

.verseblock { margin: 0 1em 1.25em 1em; }
.verseblock pre { font-family: "Open Sans", "DejaVu Sans", sans; font-size: 1.15rem; color: #6f6f6f; font-weight: 300; text-rendering: optimizeLegibility; }
.verseblock pre strong { font-weight: 400; }
.verseblock .attribution { margin-top: 1.25rem; margin-left: 0.5ex; }

.quoteblock .attribution, .verseblock .attribution { font-size: 0.8125em; line-height: 1.45; font-style: italic; }
.quoteblock .attribution br, .verseblock .attribution br { display: none; }
.quoteblock .attribution cite, .verseblock .attribution cite { display: block; letter-spacing: -0.05em; color: #555555; }

.quoteblock.abstract { margin: 0 0 1.25em 0; display: block; }
.quoteblock.abstract blockquote, .quoteblock.abstract blockquote p { text-align: left; word-spacing: 0; }
.quoteblock.abstract blockquote:before, .quoteblock.abstract blockquote p:first-of-type:before { display: none; }

table.tableblock { max-width: 100%; border-collapse: separate; }
table.tableblock td > .paragraph:last-child p > p:last-child, table.tableblock th > p:last-child, table.tableblock td > p:last-child { margin-bottom: 0; }

table.spread { width: 100%; }

table.tableblock, th.tableblock, td.tableblock { border: 0 solid #dddddd; }

table.grid-all th.tableblock, table.grid-all td.tableblock { border-width: 0 1px 1px 0; }

table.grid-all tfoot > tr > th.tableblock, table.grid-all tfoot > tr > td.tableblock { border-width: 1px 1px 0 0; }

table.grid-cols th.tableblock, table.grid-cols td.tableblock { border-width: 0 1px 0 0; }

table.grid-all * > tr > .tableblock:last-child, table.grid-cols * > tr > .tableblock:last-child { border-right-width: 0; }

table.grid-rows th.tableblock, table.grid-rows td.tableblock { border-width: 0 0 1px 0; }

table.grid-all tbody > tr:last-child > th.tableblock, table.grid-all tbody > tr:last-child > td.tableblock, table.grid-all thead:last-child > tr > th.tableblock, table.grid-rows tbody > tr:last-child > th.tableblock, table.grid-rows tbody > tr:last-child > td.tableblock, table.grid-rows thead:last-child > tr > th.tableblock { border-bottom-width: 0; }

table.grid-rows tfoot > tr > th.tableblock, table.grid-rows tfoot > tr > td.tableblock { border-width: 1px 0 0 0; }

table.frame-all { border-width: 1px; }

table.frame-sides { border-width: 0 1px; }

table.frame-topbot { border-width: 1px 0; }

th.halign-left, td.halign-left { text-align: left; }

th.halign-right, td.halign-right { text-align: right; }

th.halign-center, td.halign-center { text-align: center; }

th.valign-top, td.valign-top { vertical-align: top; }

th.valign-bottom, td.valign-bottom { vertical-align: bottom; }

th.valign-middle, td.valign-middle { vertical-align: middle; }

table thead th, table tfoot th { font-weight: bold; }

tbody tr th { display: table-cell; line-height: 1.4; background: whitesmoke; }

tbody tr th, tbody tr th p, tfoot tr th, tfoot tr th p { color: #222222; font-weight: bold; }

p.tableblock > code:only-child { background: none; padding: 0; }

p.tableblock { font-size: 1em; }

td > div.verse { white-space: pre; }

ol { margin-left: 2.5em; }

ul li ol { margin-left: 1.5em; }

dl dd { margin-left: 1.125em; }

dl dd:last-child, dl dd:last-child > :last-child { margin-bottom: 0; }

ol > li p, ul > li p, ul dd, ol dd, .olist .olist, .ulist .ulist, .ulist .olist, .olist .ulist { margin-bottom: 0.625em; }

ul.unstyled, ol.unnumbered, ul.checklist, ul.none { list-style-type: none; }

ul.unstyled, ol.unnumbered, ul.checklist { margin-left: 0.625em; }

ul.checklist li > p:first-child > .fa-check-square-o:first-child, ul.checklist li > p:first-child > input[type="checkbox"]:first-child { margin-right: 0.25em; }

ul.checklist li > p:first-child > input[type="checkbox"]:first-child { position: relative; top: 1px; }

ul.inline { margin: 0 auto 0.625em auto; margin-left: -1.375em; margin-right: 0; padding: 0; list-style: none; overflow: hidden; }
ul.inline > li { list-style: none; float: left; margin-left: 1.375em; display: block; }
ul.inline > li > * { display: block; }

.unstyled dl dt { font-weight: normal; font-style: normal; }

ol.arabic { list-style-type: decimal; }

ol.decimal { list-style-type: decimal-leading-zero; }

ol.loweralpha { list-style-type: lower-alpha; }

ol.upperalpha { list-style-type: upper-alpha; }

ol.lowerroman { list-style-type: lower-roman; }

ol.upperroman { list-style-type: upper-roman; }

ol.lowergreek { list-style-type: lower-greek; }

.hdlist > table, .colist > table { border: 0; background: none; }
.hdlist > table > tbody > tr, .colist > table > tbody > tr { background: none; }

td.hdlist1 { padding-right: .75em; font-weight: bold; }

td.hdlist1, td.hdlist2 { vertical-align: top; }

.literalblock + .colist, .listingblock + .colist { margin-top: -0.5em; }

.colist > table tr > td:first-of-type { padding: 0 0.75em; line-height: 1; }
.colist > table tr > td:last-of-type { padding: 0.25em 0; }

.thumb, .th { line-height: 0; display: inline-block; border: solid 4px white; -webkit-box-shadow: 0 0 0 1px #dddddd; box-shadow: 0 0 0 1px #dddddd; }

.imageblock.left, .imageblock[style*="float: left"] { margin: 0.25em 0.625em 1.25em 0; }
.imageblock.right, .imageblock[style*="float: right"] { margin: 0.25em 0 1.25em 0.625em; }
.imageblock > .title { margin-bottom: 0; }
.imageblock.thumb, .imageblock.th { border-width: 6px; }
.imageblock.thumb > .title, .imageblock.th > .title { padding: 0 0.125em; }

.image.left, .image.right { margin-top: 0.25em; margin-bottom: 0.25em; display: inline-block; line-height: 0; }
.image.left { margin-right: 0.625em; }
.image.right { margin-left: 0.625em; }

a.image { text-decoration: none; }

span.footnote, span.footnoteref { vertical-align: super; font-size: 0.875em; }
span.footnote a, span.footnoteref a { text-decoration: none; }
span.footnote a:active, span.footnoteref a:active { text-decoration: underline; }

#footnotes { padding-top: 0.75em; padding-bottom: 0.75em; margin-bottom: 0.625em; }
#footnotes hr { width: 20%; min-width: 6.25em; margin: -.25em 0 .75em 0; border-width: 1px 0 0 0; }
#footnotes .footnote { padding: 0 0.375em; line-height: 1.3; font-size: 0.875em; margin-left: 1.2em; text-indent: -1.2em; margin-bottom: .2em; }
#footnotes .footnote a:first-of-type { font-weight: bold; text-decoration: none; }
#footnotes .footnote:last-of-type { margin-bottom: 0; }

#content #footnotes { margin-top: -0.625em; margin-bottom: 0; padding: 0.75em 0; }

.gist .file-data > table { border: 0; background: #fff; width: 100%; margin-bottom: 0; }
.gist .file-data > table td.line-data { width: 99%; }

div.unbreakable { page-break-inside: avoid; }

.big { font-size: larger; }

.small { font-size: smaller; }

.underline { text-decoration: underline; }

.overline { text-decoration: overline; }

.line-through { text-decoration: line-through; }

.aqua { color: #00bfbf; }

.aqua-background { background-color: #00fafa; }

.black { color: black; }

.black-background { background-color: black; }

.blue { color: #0000bf; }

.blue-background { background-color: #0000fa; }

.fuchsia { color: #bf00bf; }

.fuchsia-background { background-color: #fa00fa; }

.gray { color: #606060; }

.gray-background { background-color: #7d7d7d; }

.green { color: #006000; }

.green-background { background-color: #007d00; }

.lime { color: #00bf00; }

.lime-background { background-color: #00fa00; }

.maroon { color: #600000; }

.maroon-background { background-color: #7d0000; }

.navy { color: #000060; }

.navy-background { background-color: #00007d; }

.olive { color: #606000; }

.olive-background { background-color: #7d7d00; }

.purple { color: #600060; }

.purple-background { background-color: #7d007d; }

.red { color: #bf0000; }

.red-background { background-color: #fa0000; }

.silver { color: #909090; }

.silver-background { background-color: #bcbcbc; }

.teal { color: #006060; }

.teal-background { background-color: #007d7d; }

.white { color: #bfbfbf; }

.white-background { background-color: #fafafa; }

.yellow { color: #bfbf00; }

.yellow-background { background-color: #fafa00; }

span.icon > .fa { cursor: default; }

.admonitionblock td.icon [class^="fa icon-"] { font-size: 2.5em; text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.5); cursor: default; }
.admonitionblock td.icon .icon-note:before { content: "\f05a"; color: #207c98; }
.admonitionblock td.icon .icon-tip:before { content: "\f0eb"; text-shadow: 1px 1px 2px rgba(155, 155, 0, 0.8); color: #111; }
.admonitionblock td.icon .icon-warning:before { content: "\f071"; color: #bf6900; }
.admonitionblock td.icon .icon-caution:before { content: "\f06d"; color: #bf3400; }
.admonitionblock td.icon .icon-important:before { content: "\f06a"; color: #bf0000; }

.conum[data-value] { display: inline-block; color: #fff !important; background-color: #222222; -webkit-border-radius: 100px; border-radius: 100px; text-align: center; font-size: 0.75em; width: 1.67em; height: 1.67em; line-height: 1.67em; font-family: "Open Sans", "DejaVu Sans", sans-serif; font-style: normal; font-weight: bold; }
.conum[data-value] * { color: #fff !important; }
.conum[data-value] + b { display: none; }
.conum[data-value]:after { content: attr(data-value); }
pre .conum[data-value] { position: relative; top: -0.125em; }

b.conum * { color: inherit !important; }

.conum:not([data-value]):empty { display: none; }

.literalblock pre, .listingblock pre { background: #eeeeee; }

</style>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.2.0/css/font-awesome.min.css">
<style>.listingblock .pygments .hll { background-color: #ffffcc }
.listingblock .pygments  { background: #f8f8f8; }
.listingblock .pygments .tok-c { color: #408080; font-style: italic } /* Comment */
.listingblock .pygments .tok-err { border: 1px solid #FF0000 } /* Error */
.listingblock .pygments .tok-k { color: #008000; font-weight: bold } /* Keyword */
.listingblock .pygments .tok-o { color: #666666 } /* Operator */
.listingblock .pygments .tok-cm { color: #408080; font-style: italic } /* Comment.Multiline */
.listingblock .pygments .tok-cp { color: #BC7A00 } /* Comment.Preproc */
.listingblock .pygments .tok-c1 { color: #408080; font-style: italic } /* Comment.Single */
.listingblock .pygments .tok-cs { color: #408080; font-style: italic } /* Comment.Special */
.listingblock .pygments .tok-gd { color: #A00000 } /* Generic.Deleted */
.listingblock .pygments .tok-ge { font-style: italic } /* Generic.Emph */
.listingblock .pygments .tok-gr { color: #FF0000 } /* Generic.Error */
.listingblock .pygments .tok-gh { color: #000080; font-weight: bold } /* Generic.Heading */
.listingblock .pygments .tok-gi { color: #00A000 } /* Generic.Inserted */
.listingblock .pygments .tok-go { color: #888888 } /* Generic.Output */
.listingblock .pygments .tok-gp { color: #000080; font-weight: bold } /* Generic.Prompt */
.listingblock .pygments .tok-gs { font-weight: bold } /* Generic.Strong */
.listingblock .pygments .tok-gu { color: #800080; font-weight: bold } /* Generic.Subheading */
.listingblock .pygments .tok-gt { color: #0044DD } /* Generic.Traceback */
.listingblock .pygments .tok-kc { color: #008000; font-weight: bold } /* Keyword.Constant */
.listingblock .pygments .tok-kd { color: #008000; font-weight: bold } /* Keyword.Declaration */
.listingblock .pygments .tok-kn { color: #008000; font-weight: bold } /* Keyword.Namespace */
.listingblock .pygments .tok-kp { color: #008000 } /* Keyword.Pseudo */
.listingblock .pygments .tok-kr { color: #008000; font-weight: bold } /* Keyword.Reserved */
.listingblock .pygments .tok-kt { color: #B00040 } /* Keyword.Type */
.listingblock .pygments .tok-m { color: #666666 } /* Literal.Number */
.listingblock .pygments .tok-s { color: #BA2121 } /* Literal.String */
.listingblock .pygments .tok-na { color: #7D9029 } /* Name.Attribute */
.listingblock .pygments .tok-nb { color: #008000 } /* Name.Builtin */
.listingblock .pygments .tok-nc { color: #0000FF; font-weight: bold } /* Name.Class */
.listingblock .pygments .tok-no { color: #880000 } /* Name.Constant */
.listingblock .pygments .tok-nd { color: #AA22FF } /* Name.Decorator */
.listingblock .pygments .tok-ni { color: #999999; font-weight: bold } /* Name.Entity */
.listingblock .pygments .tok-ne { color: #D2413A; font-weight: bold } /* Name.Exception */
.listingblock .pygments .tok-nf { color: #0000FF } /* Name.Function */
.listingblock .pygments .tok-nl { color: #A0A000 } /* Name.Label */
.listingblock .pygments .tok-nn { color: #0000FF; font-weight: bold } /* Name.Namespace */
.listingblock .pygments .tok-nt { color: #008000; font-weight: bold } /* Name.Tag */
.listingblock .pygments .tok-nv { color: #19177C } /* Name.Variable */
.listingblock .pygments .tok-ow { color: #AA22FF; font-weight: bold } /* Operator.Word */
.listingblock .pygments .tok-w { color: #bbbbbb } /* Text.Whitespace */
.listingblock .pygments .tok-mb { color: #666666 } /* Literal.Number.Bin */
.listingblock .pygments .tok-mf { color: #666666 } /* Literal.Number.Float */
.listingblock .pygments .tok-mh { color: #666666 } /* Literal.Number.Hex */
.listingblock .pygments .tok-mi { color: #666666 } /* Literal.Number.Integer */
.listingblock .pygments .tok-mo { color: #666666 } /* Literal.Number.Oct */
.listingblock .pygments .tok-sb { color: #BA2121 } /* Literal.String.Backtick */
.listingblock .pygments .tok-sc { color: #BA2121 } /* Literal.String.Char */
.listingblock .pygments .tok-sd { color: #BA2121; font-style: italic } /* Literal.String.Doc */
.listingblock .pygments .tok-s2 { color: #BA2121 } /* Literal.String.Double */
.listingblock .pygments .tok-se { color: #BB6622; font-weight: bold } /* Literal.String.Escape */
.listingblock .pygments .tok-sh { color: #BA2121 } /* Literal.String.Heredoc */
.listingblock .pygments .tok-si { color: #BB6688; font-weight: bold } /* Literal.String.Interpol */
.listingblock .pygments .tok-sx { color: #008000 } /* Literal.String.Other */
.listingblock .pygments .tok-sr { color: #BB6688 } /* Literal.String.Regex */
.listingblock .pygments .tok-s1 { color: #BA2121 } /* Literal.String.Single */
.listingblock .pygments .tok-ss { color: #19177C } /* Literal.String.Symbol */
.listingblock .pygments .tok-bp { color: #008000 } /* Name.Builtin.Pseudo */
.listingblock .pygments .tok-vc { color: #19177C } /* Name.Variable.Class */
.listingblock .pygments .tok-vg { color: #19177C } /* Name.Variable.Global */
.listingblock .pygments .tok-vi { color: #19177C } /* Name.Variable.Instance */
.listingblock .pygments .tok-il { color: #666666 } /* Literal.Number.Integer.Long */
</style>
</head>
<body class="article toc2 toc-left">
<div id="header">
<h1>Componentes enterprise</h1>
<div class="details">
<span id="author" class="author">Domingo Gallardo</span><br>
<span id="email" class="email"><a href="mailto:domingo.gallardo@ua.es">domingo.gallardo@ua.es</a></span><br>
</div>
<div id="toc" class="toc2">
<div id="toctitle">Índice de contenidos</div>
<ul class="sectlevel1">
<li><a href="#sesion02">2. Ciclo de vida de los enterprise beans y seguridad de acceso</a>
<ul class="sectlevel2">
<li><a href="#_ciclo_de_vida">2.1. Ciclo de vida</a>
<ul class="sectlevel3">
<li><a href="#_ciclo_de_vida_de_los_beans_de_sesi%C3%B3n_con_estado">2.1.1. Ciclo de vida de los beans de sesión con estado</a></li>
<li><a href="#_ciclo_de_vida_de_los_beans_de_sesi%C3%B3n_sin_estado">2.1.2. Ciclo de vida de los beans de sesión sin estado</a></li>
</ul>
</li>
<li><a href="#_acceso_concurrente_a_los_beans_singleton">2.2. Acceso concurrente a los beans singleton</a></li>
<li><a href="#_seguridad_en_la_arquitectura_ejb">2.3. Seguridad en la arquitectura EJB</a>
<ul class="sectlevel3">
<li><a href="#_introducci%C3%B3n_a_la_seguridad_en_ejb">2.3.1. Introducción a la seguridad en EJB</a></li>
<li><a href="#_realms_users_groups_y_roles">2.3.2. Realms, Users, Groups y Roles</a></li>
<li><a href="#_jaas_servicio_java_de_autentificaci%C3%B3n_y_autorizaci%C3%B3n">2.3.3. JAAS: Servicio Java de Autentificación y Autorización</a></li>
<li><a href="#_control_de_acceso_basado_en_roles">2.3.4. Control de acceso basado en roles</a></li>
<li><a href="#_la_identidad_de_seguridad_runas">2.3.5. La identidad de seguridad runAs</a></li>
<li><a href="#_gesti%C3%B3n_de_seguridad_programativa_en_el_enterprise_bean">2.3.6. Gestión de seguridad programativa en el enterprise bean</a></li>
</ul>
</li>
<li><a href="#_ejercicios">2.4. Ejercicios</a>
<ul class="sectlevel3">
<li><a href="#__0_75_puntos_ciclo_de_vidad_de_bean_con_estado">2.4.1. (0,75 puntos) Ciclo de vidad de bean con estado</a></li>
<li><a href="#__0_75_puntos_acceso_seguro_a_un_m%C3%A9todo">2.4.2. (0,75 puntos) Acceso seguro a un método</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
</div>
<div id="content">
<div id="preamble">
<div class="sectionbody">
<div style="page-break-after: always;"></div>
</div>
</div>
<div class="sect1">
<h2 id="sesion02">2. Ciclo de vida de los enterprise beans y seguridad de acceso</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Vamos a incluir en esta sesión dos apartados que no tiene mucha relación, pero que tienen una extensión adecuada para cubrirlos ambos en una única sesión. Son el ciclo de vida y las restricciones de seguridad en el uso de los enterprise beans.</p>
</div>
<div class="sect2">
<h3 id="_ciclo_de_vida">2.1. Ciclo de vida</h3>
<div class="paragraph">
<p>Hemos visto que los enterprise beans son objetos gestionados por el servidor de aplicaciones. Esto significa que nosotros no vamos a poder llamar a <code>new()</code> para sólo vamos a poder obtener referencias para su uso. Es el servidor de aplicaciones se encarga de crear las instancias de los enterprise beans, de inyectar sus referencias en las variables anotadas y de controlar sus distintas fases del ciclo de vida.</p>
</div>
<div class="paragraph">
<p>Empezamos con el ciclo de vida de los beans de sesión con estado, el más elaborado, y seguimos con el de los beans sin estado.</p>
</div>
<div class="sect3">
<h4 id="_ciclo_de_vida_de_los_beans_de_sesión_con_estado">2.1.1. Ciclo de vida de los beans de sesión con estado</h4>
<div class="paragraph">
<p>Recordemos un ejemplo de enterprise bean con estado:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span class="tok-nd">@Stateful</span>
<span class="tok-kd">public</span> <span class="tok-kd">class</span> <span class="tok-nc">SaludoConEstadoServicio</span> <span class="tok-o">{</span>
    <span class="tok-n">ArrayList</span><span class="tok-o">&lt;</span><span class="tok-n">String</span><span class="tok-o">&gt;</span> <span class="tok-n">saludos</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">ArrayList</span><span class="tok-o">&lt;</span><span class="tok-n">String</span><span class="tok-o">&gt;();</span> <i class="conum" data-value="1"></i><b>(1)</b>

    <span class="tok-nd">@EJB</span>
    <span class="tok-n">SaludoServicio</span> <span class="tok-n">saludoServicio</span><span class="tok-o">;</span> <i class="conum" data-value="2"></i><b>(2)</b>

    <span class="tok-kd">public</span> <span class="tok-n">String</span> <span class="tok-nf">saludo</span><span class="tok-o">(</span><span class="tok-n">String</span> <span class="tok-n">nombre</span><span class="tok-o">)</span> <span class="tok-o">{</span>
        <span class="tok-n">String</span> <span class="tok-n">saludo</span> <span class="tok-o">=</span> <span class="tok-n">saludoServicio</span><span class="tok-o">.</span><span class="tok-na">saludo</span><span class="tok-o">(</span><span class="tok-n">nombre</span><span class="tok-o">);</span> <i class="conum" data-value="3"></i><b>(3)</b>
        <span class="tok-n">saludos</span><span class="tok-o">.</span><span class="tok-na">add</span><span class="tok-o">(</span><span class="tok-n">saludo</span><span class="tok-o">);</span>
        <span class="tok-k">return</span> <span class="tok-n">saludo</span><span class="tok-o">;</span>
    <span class="tok-o">}</span>

    <span class="tok-kd">public</span> <span class="tok-n">ArrayList</span><span class="tok-o">&lt;</span><span class="tok-n">String</span><span class="tok-o">&gt;</span> <span class="tok-nf">saludos</span><span class="tok-o">()</span> <span class="tok-o">{</span>
        <span class="tok-k">return</span> <span class="tok-n">saludos</span><span class="tok-o">;</span>
    <span class="tok-o">}</span>
<span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Estado local definido por un <code>ArrayList</code> donde se guardan saludos</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Se obtiene una referencia al bean <code>SaludoServicio</code> para obtener el saludo</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Se obtiene un saludo invocando a <code>SaludoServicio</code> y se guarda en el array de saludos</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>En los beans con estado el servidor debe garantizar que el cliente se comunica siempre con la misma instancia del bean, ya que el cliente va modificando su estado. Todas las invocaciones a métodos del bean de un mismo cliente deben ser respondidas por la misma instancia, que es la que guarda el estado modificado. Cada cliente se conectará con una instancia distinta.</p>
</div>
<div class="paragraph">
<p>El ciclo de vida de los beans de sesión con estado debe por tanto garantizar esta característica. Se muestra en la siguiente figura:</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="imagenes/ejb/ciclo-vida-con-estado.png" alt="" width="50%">
</div>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>El contenedor crea una instancia usando el constructor por defecto cuando comienza una nueva sesión con un cliente.</p>
</li>
<li>
<p>Después de que el constructor se ha completado, el contenedor inyecta los recursos tales como contextos JPA, fuentes de datos y otros beans.</p>
</li>
<li>
<p>La instancia se almacena en memoria, esperando la invocación de alguno de sus métodos.</p>
</li>
<li>
<p>El cliente ejecuta un método de negocio y el contenedor lo invoca en el bean</p>
</li>
<li>
<p>Espera hasta que los siguientes métodos son invocados y los ejecuta.</p>
</li>
<li>
<p>Si el cliente permanece ocioso por un periodo de tiempo, el contenedor <em>pasiva</em> el bean, serializándolo y guardándolo en disco.</p>
</li>
<li>
<p>Si el cliente vuelve a invocar a un bean pasivado, éste se activa (el objeto es leído del disco) y se ejecuta el método</p>
</li>
<li>
<p>Si el cliente no invoca un método sobre el bean durante un cierto periodo de tiempo, el bean es destruido.</p>
</li>
<li>
<p>Si el cliente invoca algún método con el atributo <code>@Remove</code> el bean es destruido.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Es posible definir métodos de callback del ciclo de vida, a los que el contenedor llamará antes o después de cierto momento del ciclo de vida, con las siguientes anotaciones. Son muy útiles para gestionar la apertura y cierre de recursos inyectados y usados por el bean.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>@PostConstruct</code>: el método con esta anotación se invoca justo después de que se ha ejecutado el constructor por defecto y de que se han inyectado los recursos.</p>
</li>
<li>
<p><code>@PrePassivate</code>: invocado antes de que un bean sea pasivado.</p>
</li>
<li>
<p><code>@PostActivate</code>: invocado después de que el bean haya sido traído a memoria por el contenedor y antes de que se ejecute cualquier método de negocio invocado por el cliente</p>
</li>
<li>
<p><code>@PreDestroy</code>: invocado después de que haya expirado el tiempo de conexión o el cliente haya invocado a un método anotado con <code>@Remove</code>. Despés de invocar al método, la instancia del bean se elimina y se pasa al recolector de basura.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Las anotaciones <code>@PrePassivate</code> y <code>@PostActivate</code> tienen que ver con la actualización de recursos que no pueden ser serializados. Por ejemplo, un objeto <code>java.sql.Connection</code> no puede ser serializado y debe ser reiniciado cuando el bean se reactiva.</p>
</div>
</div>
<div class="sect3">
<h4 id="_ciclo_de_vida_de_los_beans_de_sesión_sin_estado">2.1.2. Ciclo de vida de los beans de sesión sin estado</h4>
<div class="paragraph">
<p>Los beans de sesión sin estado tienen un ciclo de vida muy sencillo. O existen o no existen. Una vez que el bean es creado, se coloca en un <em>pool</em> para servir las peticiones de los clientes. En algún momento el bean se destruye, o bien cuando se reduce la carga del servidor o cuando la aplicación se cierra. El contenedor hace lo siguiente:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Crea una instancia del bean usando el constructor por defecto.</p>
</li>
<li>
<p>Inyecta recursos como proveedores de JPA o conexiones de bases de datos y llama a los métoods etiquetados con <code>@PostConstruct</code>.</p>
</li>
<li>
<p>Coloca instancias del bean en un <em>pool</em>.</p>
</li>
<li>
<p>Saca del pool una instancia ociosa cuando recibe una petición de ejecución de un método por el cliente.</p>
</li>
<li>
<p>Ejecuta el método de negocio solicitado por el cliente.</p>
</li>
<li>
<p>Cuando el método se termina de ejecutar, el bean se vuelve a colocar en el <em>pool</em>.</p>
</li>
<li>
<p>Cuando el contenedor lo considera necesario elimina el bean del <em>pool</em> y llama a los métodos <code>@PreDestroy</code> antes de colocarlo en el recolector de basura.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Los beans de sesión sin estado también soportan las anotaciones <code>@PostConstruct</code> y <code>@PreDestroy</code>.</p>
</div>
<div class="paragraph">
<p>La siguiente figura refleja este ciclo de vida:</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="imagenes/ejb/ciclo-vida-sin-estado.png" alt="" width="50%">
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_acceso_concurrente_a_los_beans_singleton">2.2. Acceso concurrente a los beans singleton</h3>
<div class="paragraph">
<p>Es posible gestionar el acceso concurrente de los clientes usando la <em>concurrencia gestionada por el contenedor</em> o la <em>concurrencia gestionada por el bean</em>. Se definen para ello las anotaciones <code>@ConcurrencyManagement(ConcurrencyManagementType.BEAN)</code> y <code>@ConcurrencyManagement(ConcurrencyManagementType.CONTAINER)</code> que hay que definir a nivel de clase.</p>
</div>
<div class="paragraph">
<p>Esta última es la menos frecuente y deja en manos del desarrollador la gestión de la concurrencia usando construcciones de Java como <code>synchronized</code> o <code>volatile</code>.</p>
</div>
<div class="paragraph">
<p>En la concurrencia gestionada por el contenedor, el contenedor se encarga de gestionar el acceso concurrente de los clientes a los métodos del bean. El contenedor realiza un bloque a nivel de métodos, asignádoles un bloqueo de tipo <code>Read</code> (compartido) o <code>Write</code> (exclusivo). Un bloqueo <code>Read</code> en un método permite las invocaciones concurrentes del método. Un bloqueo <code>Write</code> espera al procesamiento de una invocación antes de comenzar la siguiente. Si no especificamos nada en un método, por defecto tiene el bloque <code>Write</code>.</p>
</div>
<div class="paragraph">
<p>Estos tipos de bloqueos se especifican con las anotaciones <code>@Lock(LockType.READ)</code> y <code>@Lock(LockType.WRITE)</code> que se pueden realizar a nivel de clase o de método de negocio. El valor especificado en un método sobreescribe el de la clase.</p>
</div>
<div class="paragraph">
<p>En el caso del bloqueo exclusivo es posible definir un time-out para que se genere una excepción si el bloqueo dura más de un determinado tiempo usando la anotación <code>AccessTimeout</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span class="tok-nd">@Singleton</span>
<span class="tok-kd">public</span> <span class="tok-kd">class</span> <span class="tok-nc">Foo</span> <span class="tok-o">{</span>
	<span class="tok-nd">@Lock</span><span class="tok-o">(</span><span class="tok-n">LockType</span><span class="tok-o">.</span><span class="tok-na">WRITE</span><span class="tok-o">)</span>
	<span class="tok-nd">@AccessTimeout</span><span class="tok-o">(</span><span class="tok-n">value</span><span class="tok-o">=</span><span class="tok-mi">1</span><span class="tok-o">,</span><span class="tok-n">unit</span><span class="tok-o">=</span><span class="tok-n">TimeUnit</span><span class="tok-o">.</span><span class="tok-na">MINUTES</span><span class="tok-o">)</span>
	<span class="tok-kd">public</span> <span class="tok-kt">void</span> <span class="tok-nf">TestMethod</span><span class="tok-o">()</span> <span class="tok-o">{</span>
	   <span class="tok-c1">//...</span>
	<span class="tok-o">}</span>
<span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Es posible especificar las unidades (por defecto son MILLISECONDS):</p>
</div>
<div class="ulist">
<ul>
<li>
<p>NANOSECONDS</p>
</li>
<li>
<p>MICROSECONDS</p>
</li>
<li>
<p>MILLISECONDS</p>
</li>
<li>
<p>SECONDS</p>
</li>
<li>
<p>MINUTES</p>
</li>
<li>
<p>HOURS</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_seguridad_en_la_arquitectura_ejb">2.3. Seguridad en la arquitectura EJB</h3>
<div class="sect3">
<h4 id="_introducción_a_la_seguridad_en_ejb">2.3.1. Introducción a la seguridad en EJB</h4>
<div class="paragraph">
<p>La seguridad es un aspecto fundamental de las aplicaciones empresariales. Cualquier aplicación interna o accesible via web va a intentar ser hackeada por extraños. Podemos analizar tres elementos fundamentales en la seguridad de una aplicación:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Autentificación</dt>
<dd>
<p>Dicho sencillamente, la autentificación valida la identidad del usuario. La forma más común de autentificación es una simple ventana de login que pide un nombre de usuario y una contraseña.  Una vez que los usuarios han pasado a través del sistema de autentificación, pueden usar el sistema libremente, hasta el nivel que les permita el control de acceso. La autentificación se puede basar también en tarjetas de identificación, certificados y en otros tipos de identificación.</p>
</dd>
<dt class="hdlist1">Control de acceso</dt>
<dd>
<p>El control de acceso (también conocido como autorización) aplica políticas de seguridad que regulan lo que un usuario específico puede y no puede hacer en el sistema. El control de acceso asegura que los usuarios accedan sólo a aquellos recursos y operaciones a los que se les ha dado permiso. El control de acceso puede restringir el acceso de un usuario a subistemas, datos, y objetos de negocio. Por ejemplo, a algunos usuarios se les puede dar permiso de modificar información, mientras que otros sólo tienen permiso de visualizarla.</p>
</dd>
<dt class="hdlist1">Comunicación segura</dt>
<dd>
<p>Los canales de comunicación entre un cliente y un servidor son un elemento muy importante en la seguridad del sistema. Un canal de comunicación puede hacerse seguro mediante aislamiento físico (por ejemplo, via una conexión de red dedicada) o por medio de la encriptación de la comunicación entre el cliente y el servidor. El aislamiento físico es caro, limita las posibilidades del sistema y es casi imposible en Internet, por lo que lo más usual es la encriptación. Cuando la comunicación se asegura mediante la encriptación, los mensajes se codifican de forma que no puedan ser leídos ni manipulados por individuos no autorizados. Esto se suele consigue mediante el intercambio de claves criptográficas entre el cliente y el servidor. Las claves permiten al receptor del mensaje decodificarlo y leerlo.</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>La seguridad debe aplicarse tanto a la vista como a la capa de negocio. El hecho de que un usuario no pueda acceder a una página no significa que un la lógica de negocio no pueda invocarse. Un  hacker puede conseguir acceder a los servicios web REST y hacer  peticiones no autorizadas. O un programador de la capa web puede cometer un error y llamar desde una página sin el nivel de autorización necesaria a una operación restringida de la lógica de negocio. La arquitectura EJB proporciona un modelo de seguridad flexible y elegante que permite garantizar la seguridad en el  acceso a los métodos de negocio de la aplicación enterprise.</p>
</div>
<div class="paragraph">
<p>La mayoría de los servidores EJB soportan la comunicación segura a través del protocolo SSL (Secure Socket Layer) y proporcionan algún mecanismo de autentificación, pero la especificación Enterprise JavaBeans sólo especifica el control de acceso a los enterprise beans.</p>
</div>
<div class="paragraph">
<p>En este apartado veremos qué mecanismos define la especificación EJB para el control de acceso a los enterprise beans. Veremos que es posible definir un control de acceso  declarativo y programativo a los métodos de los beans, de forma que sólo aquellos usuarios autorizados puedan ejecutar el código restringido. Antes de eso, revisemos brevemente cómo realizar la autentificación del usuario.</p>
</div>
</div>
<div class="sect3">
<h4 id="_realms_users_groups_y_roles">2.3.2. Realms, Users, Groups y Roles</h4>
<div class="paragraph">
<p>Uuarios, grupos y roles son tres conceptos relacionados que forman la base de la seguridad EJB.</p>
</div>
<div class="paragraph">
<p>El usuario es cualquier persona autentificada en el sistema. Normalmente es un nombre de usuario autentifcado mediante una contraseña.</p>
</div>
<div class="paragraph">
<p>El concepto de grupo es similar al de sistema de ficheros UNIX. Un grupo se define en el servidor de aplicaciones como un conjunto de usuarios. Por  ejemplo, podemos definir el grupo de "administrador" al que pertenecerán todos los usuarios que sean administradores de las aplicaciones desplegadas.</p>
</div>
<div class="paragraph">
<p>Los roles se definen en las aplicaciones y es la base de la autorización del acceso a los métodos de negocio. Sólo aquellos usuarios o grupos que tengan un determinado rol podrán acceder a determinados métodos del EJB. Se deberá mapear usuario y grupos con roles. La separación entre usuarios/grupos y roles permite que la aplicación se codifique de forma indenpendiente al entorno en el que se va a desplegar. Una aplicación puede tener un rol "Administrador" y en la compañía en la que se despliega podemos tener en el directorio LDAP un grupo "Gestor Aplicaciones" que sea equivalente. El mapeo entre grupos/usuarios y roles lo realiza el servidor de aplicaciones.</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="imagenes/ejb/roles.png" alt="" width="50%">
</div>
</div>
<div class="paragraph">
<p>Un <em>realm</em> se define en el servidor de aplicaciones como un conjunto de usuarios y grupos definidos mediante un determinado mecanismo.</p>
</div>
<div class="paragraph">
<p>Los dos realms que tenemos por defecto en WildFly son <code>ManagementRealm</code> y <code>ApplicationRealm</code>. <code>ManagementRealm</code> se utiliza para la aplicación de administración del servidor, por lo que sólo nos permite controlar la autentificación (no se indican roles porque el único rol que tienen los usuarios de este conjunto es el de administrar el servidor). Por otro lado, <code>ApplicationRealm</code> nos permite además controlar la autorización, mediante la asignación de roles a usuarios.</p>
</div>
<div class="paragraph">
<p>Como ya vimos en el módulo de Componentes Web, es posible añadir nuevos usuarios en estos realms con el script de WidlFly <code>addUser.sh</code> situado en <code>$WILDFLY_HOME/bin</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="bash session"><span class="tok-gp">$</span> ./addUser.sh</code></pre>
</div>
</div>
<div class="paragraph">
<p>Nos preguntará en primer lugar en cuál de los dos realms por defecto queremos introducir el usuario, y a continuación nos irá pidiendo los datos del nuevo usuario. El último de los datos que pide es la lista de roles permitidos separados por coma. En las aplicaciones que incorporen seguridad declarativa se nos permitirá entrar con cualquiera de los usuarios del <code>ApplicationRealm</code>. Las operaciones que nos permita hacer dependerán de los roles asignados.</p>
</div>
</div>
<div class="sect3">
<h4 id="_jaas_servicio_java_de_autentificación_y_autorización">2.3.3. JAAS: Servicio Java de Autentificación y Autorización</h4>
<div class="paragraph">
<p>La seguridad en Java EE está basada en el Servicio Java de Autentificación y Autorización (JAAS). Esta arquitectura se introdujo en la versión 1.4 de Java EE y desde entonces ha sido adoptado ampliamente por la industria Java comercial y open source. La versión más reciente es la <a href="https://www.jcp.org/en/jsr/detail?id=196">JSR 196</a> (Java Authentication Service Provider Interface for Containers), definida en Java EE 6. Las APIs más importantes son las definidas por los paquetes:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="https://docs.oracle.com/javase/7/docs/api/javax/security/auth/package-summary.html">javax.security.auth</a></p>
</li>
<li>
<p><a href="https://docs.oracle.com/javase/7/docs/api/java/security/package-summary.html">java.security</a></p>
</li>
<li>
<p><a href="https://docs.oracle.com/javaee/7/api/javax/annotation/security/package-summary.html">javax.annotation.security</a></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>JAAS separa el sistema de autentificación de la aplicación Jaava EE mediante el uso de un API bien definida que es implementada por el servidor de aplicaciones. La aplicación Java EE no se debe preocupar de detalles de bajo nivel como trabajar con los algoritmos de encriptación de contraseñas o comunicarse con servicios externos de autentificación como el Active Directory de Microsoft o el LDAP. El servidor de aplicaciones que contiene la aplicación Java EE se encarga de ello.</p>
</div>
<div class="paragraph">
<p>JAAS está diseñado para que la autentificación y autorización puede realizarse en cualquier capa Java EE, incluyendo la capa web y la capa EJB. En la realidad, sin embargo, la mayoría de aplicaciones Java EE son accesibles via web y  comparten un único sistema de autentificación a lo largo de todas las capas. JAAS permite propagar la autentificación realizada en la capa web a cualquier otra capa de Java EE. Una vez autentificado el usuario, el contexto de autentificación se pasa a todas las capas siempre que sea posible, en lugar de repetir los pasos de autentificación en cada una de ellas. El objeto Java <code>Principal</code> representa este usuario autentificado compartible entre capas. La siguiente figura representa este mecanismo:</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="imagenes/ejb/mecanismo-jaas.png" alt="" width="50%">
</div>
</div>
<div class="paragraph">
<p>Como se muestra en la figura, un usuario se logea en la aplicación a través de la capa web. La capa web obtiene la información de autenficiación del usuario (login y password normalmente) y los autentifica usando JAAS contra el <em>realm</em> definido en el servidor de aplicaciones. Si se valida la autentificación se obtiene un <code>Principal</code> que se asocia con uno o más roles de la aplicación. Para cada recurso restringido de la capa web o la capa EJB, el servidor de aplicaciones chequea si el principal/role esta autorizado para acceder al recurso. El <code>Principal</code> se pasa a de la capa web a la capa EJB cuando se realiza una invocación de un método de algún bean.</p>
</div>
<div class="sect4">
<h5 id="_autentificación_en_la_capa_web">Autentificación en la capa web</h5>
<div class="paragraph">
<p>En la asignatura <em>Componentes Web</em> ya estudiamos con detalle la autentificación en la capa web. Recordemos que hay que realizar la configuración de seguridad  en el fichero <code>web.xml</code>, y que podemos escoger entre tres tipos de autentificación: FORM, BASIC y CLIENT-CERT.  Con el método FORM podemos especificar una página HTML en la que se define un formulario que el usuario utilizará para logearse. En el  formulario se utilizarán los nombres estándar de parámetros <code>j_username</code> y <code>j_password</code> para guardar en ellos el usuario y su contraseña y se llamará a la acción estándar <code>j_security_check</code>.</p>
</div>
<div class="paragraph">
<p>El método BASIC proporciona un mecanismo de autentificación básico, basado en cabeceras de autentificación para solicitar datos del usuario (el servidor) y para enviar los datos del usuario (el cliente). Para la comunicación se debería utilizar el protocolo SSL y la contraseña se envía codificada con el método Base64. Será el que utilicemos en los ejemplos por ser el más sencillo.</p>
</div>
<div class="paragraph">
<p>Con el método CLIENT-CERT no es necesario pedir el usuario/contraseña sino que el cliente envía al servidor de aplicaciones un certificado de clave pública almacenado en el navegador utilizando SSL y el servidor autentifica el contenido del certificado. El proveedor JAAS valida a continuación las credenciales.</p>
</div>
<div class="paragraph">
<p>En el mismo fichero <code>web.xml</code> se definen los roles y las restricciones de acceso a recursos (URLs) definidos en los servlets o páginas JSP. Por ejemplo, el siguiente código declara una restricción de acceso a la URL <code>/holamundorestringido</code> a los usuarios con el rol <code>User</code>. Como el método de autentificación es BASIC, el navegador pedirá en una ventana de diálogo el usuario y la contraseña. Si utilizamos una ventana normal del navegador éste guardará la configuración de usuario y contraseña una vez introducida por primera vez. Para probar más de una vez podemos abrir una ventana de incógnito.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><span class="tok-cp">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
<span class="tok-nt">&lt;web-app</span> <span class="tok-na">xmlns=</span><span class="tok-s">&quot;http://xmlns.jcp.org/xml/ns/javaee&quot;</span>
         <span class="tok-na">xmlns:xsi=</span><span class="tok-s">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span>
         <span class="tok-na">xsi:schemaLocation=</span><span class="tok-s">&quot;http://xmlns.jcp.org/xml/ns/javaee http://xmlns.jcp.org/xml/ns/javaee/web-app_3_1.xsd&quot;</span>
         <span class="tok-na">version=</span><span class="tok-s">&quot;3.1&quot;</span><span class="tok-nt">&gt;</span>
    <span class="tok-nt">&lt;security-constraint&gt;</span> <i class="conum" data-value="1"></i><b>(1)</b>
        <span class="tok-nt">&lt;web-resource-collection&gt;</span>
            <span class="tok-nt">&lt;web-resource-name&gt;</span>holamundorestringido<span class="tok-nt">&lt;/web-resource-name&gt;</span>
            <span class="tok-nt">&lt;url-pattern&gt;</span>/holamundorestringido<span class="tok-nt">&lt;/url-pattern&gt;</span> <i class="conum" data-value="2"></i><b>(2)</b>
        <span class="tok-nt">&lt;/web-resource-collection&gt;</span>
        <span class="tok-nt">&lt;auth-constraint&gt;</span>
            <span class="tok-nt">&lt;role-name&gt;</span>usuario-saludo<span class="tok-nt">&lt;/role-name&gt;</span> <i class="conum" data-value="3"></i><b>(3)</b>
        <span class="tok-nt">&lt;/auth-constraint&gt;</span>
    <span class="tok-nt">&lt;/security-constraint&gt;</span>
    <span class="tok-nt">&lt;login-config&gt;</span>
        <span class="tok-nt">&lt;auth-method&gt;</span>BASIC<span class="tok-nt">&lt;/auth-method&gt;</span> <i class="conum" data-value="4"></i><b>(4)</b>
    <span class="tok-nt">&lt;/login-config&gt;</span>
    <span class="tok-nt">&lt;security-role&gt;</span> <i class="conum" data-value="5"></i><b>(5)</b>
        <span class="tok-nt">&lt;role-name&gt;</span>usuario-saludo<span class="tok-nt">&lt;/role-name&gt;</span>
    <span class="tok-nt">&lt;/security-role&gt;</span>
<span class="tok-nt">&lt;/web-app&gt;</span></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Declaración de restricción de seguridad</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>URL del recurso que se restringe</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Rol/grupo del usuario autorizado</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Tipo de autentificación <code>BASIC</code></td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>Declaración de todos los roles que se utilizan en las restricciones (en el caso en que haya más de un recurso autorizado a otros roles, aquí se deben listar todos</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>La autentificación <code>BASIC</code> hace que el navegador pregunta al usuario por un login y una contraseña. El navegador envía esa identidad al servidor de aplicaciones, que la valida contra la lista de usuarios. Si el usuario y la contraseña coinciden con la registrada en el servidor, la petición adquiere la identidad y sus roles.  Esta identidad se propaga en las llamadas que se realizan desde el servlet a otros componentes.</p>
</div>
<div class="paragraph">
<p>En este caso, al acceder a la URL <code>/holamundorestringido</code> se lanza la autenficación y se comprueba que el usuario tiene el rol <code>usuario-saludo</code> para permitirle el acceso al servlet.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_control_de_acceso_basado_en_roles">2.3.4. Control de acceso basado en roles</h4>
<div class="paragraph">
<p>En la arquitectura Enterprise JavaBeans, la identidad de seguridad se representa por un objeto <code>java.security.Principal</code>. Este objeto actúa como representante de usuarios, grupos, organizaciones, tarjetas inteligentes, etc. frente a la arquitectura de control de acceso de los enterprise beans.</p>
</div>
<div class="paragraph">
<p>Los descriptores del despliegue y las anotaciones en Java EE 5.0 incluyen elementos que declaran a qué roles lógicos se permite el acceso a los métodos de los enterprise beans. Estos roles se consideran lógicos porque no reflejan directamente usuarios, grupos o cualquier otra identidad de seguridad en un entorno operacional específico. Los roles se hacen corresponder con grupos de usuarios o usuarios del mundo real cuando el bean se despliega. Esto permite que el bean sea portable ya que cada vez que el bean se despliega en un nuevo sistema, los roles se asignan a usuarios y grupos específicos de ese entorno operacional.</p>
</div>
<div class="sect4">
<h5 id="_definición_de_roles_con_anotaciones">Definición de roles con anotaciones</h5>
<div class="paragraph">
<p>Para declarar los roles con permiso de acceso a los métodos de un bean primero se utiliza la anotación <code>@DeclareRoles</code> en la que se declaran todos los roles que accederán a distintos métodos del bean. Después podemos especificar para cada uno de los métodos qué roles están autorizados con la anotación <code>@RolesAllowed</code>. Si ponemos esta anotación a nivel de clase, se aplica a todos los métodos de la clase.</p>
</div>
<div class="paragraph">
<p>Por ejemplo, en el siguiente código se declaran los roles <code>Admin</code>, <code>Bibliotecario</code> y <code>Socio</code> y se definen los permisos de acceso a los métodos.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span class="tok-nd">@Stateless</span>
   <span class="tok-nd">@DeclareRoles</span><span class="tok-o">({</span><span class="tok-s">&quot;Admin&quot;</span><span class="tok-o">,</span><span class="tok-s">&quot;Bibliotecario&quot;</span><span class="tok-o">,</span><span class="tok-s">&quot;Socio&quot;</span><span class="tok-o">})</span>
   <span class="tok-kd">public</span> <span class="tok-kd">class</span> <span class="tok-nc">OperacionBOBean</span> <span class="tok-kd">implements</span> <span class="tok-n">OperacionBOLocal</span> <span class="tok-o">{</span>
   <span class="tok-c1">// ...</span>

   <span class="tok-nd">@RolesAllowed</span><span class="tok-o">(</span><span class="tok-s">&quot;Admin&quot;</span><span class="tok-o">)</span>
   <span class="tok-kd">public</span> <span class="tok-n">String</span> <span class="tok-nf">borraOperacion</span><span class="tok-o">(</span><span class="tok-n">String</span> <span class="tok-n">idOperacion</span><span class="tok-o">)</span> <span class="tok-o">{</span>
   <span class="tok-c1">// ...</span>
   <span class="tok-o">}</span>

   <span class="tok-nd">@RolesAllowed</span><span class="tok-o">({</span><span class="tok-s">&quot;Admin&quot;</span><span class="tok-o">,</span><span class="tok-s">&quot;Bibliotecario&quot;</span><span class="tok-o">})</span>
   <span class="tok-kd">public</span> <span class="tok-n">String</span> <span class="tok-nf">realizaReserva</span><span class="tok-o">(</span><span class="tok-n">String</span> <span class="tok-n">idUsuario</span><span class="tok-o">,</span> <span class="tok-n">String</span> <span class="tok-n">idLibro</span><span class="tok-o">)</span> <span class="tok-o">{</span>
   <span class="tok-c1">// ...</span>
   <span class="tok-o">}</span>

   <span class="tok-nd">@RolesAllowed</span><span class="tok-o">({</span><span class="tok-s">&quot;Admin&quot;</span><span class="tok-o">,</span><span class="tok-s">&quot;Bibliotecario&quot;</span><span class="tok-o">})</span>
   <span class="tok-kd">public</span> <span class="tok-n">String</span> <span class="tok-nf">realizaPrestamo</span><span class="tok-o">(</span><span class="tok-n">String</span> <span class="tok-n">login</span><span class="tok-o">,</span> <span class="tok-n">String</span> <span class="tok-n">isbn</span><span class="tok-o">)</span> <span class="tok-o">{</span>   <span class="tok-o">}</span>

   <span class="tok-c1">// ...</span>

   <span class="tok-nd">@PermitAll</span>
   <span class="tok-kd">public</span> <span class="tok-n">List</span><span class="tok-o">&lt;</span><span class="tok-n">OperacionTO</span><span class="tok-o">&gt;</span> <span class="tok-nf">listadoTodosLibros</span><span class="tok-o">()</span> <span class="tok-o">{</span>   <span class="tok-o">}</span>

<span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>La anotación <code>@PermitAll</code> declara que todos los roles tienen acceso al método.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_la_identidad_de_seguridad_runas">2.3.5. La identidad de seguridad runAs</h4>
<div class="paragraph">
<p>Mientras que las anotaciones <code>@RolesAllowed</code> y los elementos <code>method-permission</code> especifican qué roles tienen acceso a qué métodos del bean, la anotación <code>@RunAs</code> y el elemento <code>security-identity</code> especifica bajo qué rol se ejecuta el bean, usando el elemento <code>runAs</code>. En otras palabras, el objeto rol que se define en <code>runAs</code> se usa como la identidad del enterprise bean cuando éste intenta invocar métodos en otros beans. Esta identidad no tiene por qué ser la misma que la identidad que accede al bean por primera vez.</p>
</div>
<div class="paragraph">
<p>Por ejemplo, la siguiente anotación declara que todos los métodos del bean <code>EmployeeService</code> siempre se van a ejecutar con la identidad <code>admin</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span class="tok-nd">@RunAs</span><span class="tok-o">(</span><span class="tok-s">&quot;admin&quot;</span><span class="tok-o">)</span>
<span class="tok-nd">@Stateless</span> <span class="tok-kd">public</span> <span class="tok-kd">class</span> <span class="tok-nc">EmployeeServiceBean</span> <span class="tok-kd">implements</span> <span class="tok-n">EmployeeService</span> <span class="tok-o">{</span>
<span class="tok-o">...</span>
<span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Esta clase de configuración es útil cuando el enterprise bean o los recursos accedidos en el cuerpo del método requieren un rol distinto del que ha sido usado para obtener acceso al método. Por ejemplo, el método <code>create()</code> podría llamar a un método en el enterprise bean X que requiera la identidad de seguridad de <code>Administrador</code>.</p>
</div>
<div class="paragraph">
<p>Podemos entender la secuencia de cambio de identidades de la siguiente forma:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>El cliente invoca un método del bean con una identidad <code>Id1</code>.</p>
</li>
<li>
<p>El bean comprueba si la identidad <code>Id1</code> tiene permiso para ejecutar el método. La tiene.</p>
</li>
<li>
<p>El bean consulta el elemento <code>security-identity</code> y cambia la identidad a la que indica ese elemento. Supongamos que es la identidad <code>Id2</code>.</p>
</li>
<li>
<p>El bean realiza las llamadas dentro del método con la identidad <code>Id2</code>.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Es obligado resaltar que hay que usar con precaución esta funcionalidad, ya que con ella podemos atribuir cualquier rol a cualquier usuario.</p>
</div>
<div class="paragraph">
<p>Una limitación de la funcionalidad es que es obligado definir un único rol para todos los métodos.</p>
</div>
</div>
<div class="sect3">
<h4 id="_gestión_de_seguridad_programativa_en_el_enterprise_bean">2.3.6. Gestión de seguridad programativa en el enterprise bean</h4>
<div class="paragraph">
<p>En el código del enterprise bean es posible comprobar qué usuario o grupo ha realizado la llamada al bean y si tiene un determinado rol asociado. Para ello se usan los siguientes métodos del <code>SessionContext</code>:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>Principal getCallerPrincipal()</code>: devuelve el objeto <code>Principal</code> asociado al usuario o grupo que ha llamado al método.</p>
</li>
<li>
<p><code>Boolean isCallerInRole(String rol)</code>: devuelve <code>true</code> o <code>false</code> dependiendo de si el usuario o grupo que ha llamado al método pertenece al rol que se le pasa como parámetro.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>El objeto <code>SessionContext</code> se obtiene declarando el método <code>setSessionContext(SessionContext ctx)</code> del ciclo de vida del bean y guardando el contexto en una variable de instancia del bean. El contenedor EJB llamará a este método en el momento de creación del enterprise bean.</p>
</div>
<div class="paragraph">
<p>Un ejemplo de código en el que se utilizan estos métodos:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span class="tok-nd">@Stateless</span>
<span class="tok-kd">public</span> <span class="tok-kd">class</span> <span class="tok-nc">MiBean</span> <span class="tok-kd">implements</span> <span class="tok-n">SessionBean</span> <span class="tok-o">{</span>

   <span class="tok-nd">@Resource</span>
   <span class="tok-n">SessionContext</span> <span class="tok-n">ctx</span><span class="tok-o">;</span>

   <span class="tok-o">...</span>

   <span class="tok-kd">public</span> <span class="tok-kt">void</span> <span class="tok-nf">miMetodo</span><span class="tok-o">()</span> <span class="tok-o">{</span>
      <span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">out</span><span class="tok-o">.</span><span class="tok-na">println</span><span class="tok-o">(</span><span class="tok-n">ctx</span><span class="tok-o">.</span><span class="tok-na">getCallerPrincipal</span><span class="tok-o">().</span><span class="tok-na">getName</span><span class="tok-o">());</span>
      <span class="tok-k">if</span> <span class="tok-o">(</span><span class="tok-n">ctx</span><span class="tok-o">.</span><span class="tok-na">isCallerInRole</span><span class="tok-o">(</span><span class="tok-s">&quot;administrador&quot;</span><span class="tok-o">))</span> <span class="tok-o">{</span>
         <span class="tok-c1">//código ejecutado por administradores</span>
         <span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">out</span><span class="tok-o">.</span><span class="tok-na">println</span><span class="tok-o">(</span><span class="tok-s">&quot;Me llama un administrador&quot;</span><span class="tok-o">);</span>
      <span class="tok-o">}</span>
      <span class="tok-k">if</span> <span class="tok-o">(</span><span class="tok-n">ctx</span><span class="tok-o">.</span><span class="tok-na">isCallerInRole</span><span class="tok-o">(</span><span class="tok-s">&quot;bibliotecario&quot;</span><span class="tok-o">)){</span>
         <span class="tok-c1">//código ejecutado por bibliotecarios</span>
         <span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">out</span><span class="tok-o">.</span><span class="tok-na">println</span><span class="tok-o">(</span><span class="tok-s">&quot;Me llama un bibliotecario&quot;</span><span class="tok-o">);</span>
      <span class="tok-o">}</span>
   <span class="tok-o">}</span>
   <span class="tok-o">...</span></code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_ejercicios">2.4. Ejercicios</h3>
<div class="sect3">
<h4 id="__0_75_puntos_ciclo_de_vidad_de_bean_con_estado">2.4.1. (0,75 puntos) Ciclo de vidad de bean con estado</h4>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Comprueba el funcionamiento de un bean con estado creando una versión con estado del bean Calculadora llamada <code>CalculadoraConEstado</code>. Escribe un servlet que compruebe su uso accesible desde la página web principal y un test Arquillian.</p>
</li>
<li>
<p>Comprueba el funcionamiento del ciclo de vida del bean con estado añadiendo métodos con las anotaciones del ciclo de vida que escriban algún mensaje por la salida estándar. Comprueba que el funcionamiento del ciclo de vida es el indicado en los apuntes. Escribe la explicación en un fichero <code>respuestas.txt</code> en la raíz del repositorio.</p>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="__0_75_puntos_acceso_seguro_a_un_método">2.4.2. (0,75 puntos) Acceso seguro a un método</h4>
<div class="paragraph">
<p>En esta sesión debes probar el registro de usuarios para que puedan acceder al método seguro <code>SaludaRestringido</code> del enterprise bean <code>SaludoRestringidoServicio</code>.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Usando el comando <code>add-user.sh</code> añade en el servidor un usuario con el rol (grupo) <code>usuario-servicio</code>.</p>
</li>
<li>
<p>Configura correctamente la seguridad en el <code>web.xml</code> y en el bean para que el acceso al servlet <code>HolaMundoRestringidoServlet</code> y al bean esté limitado sólo a un usuario con este rol.</p>
</li>
<li>
<p>Escribe otro bean llamado <code>SaludoRestringidoProgServicio</code> en el que pruebes la seguridad programativa.</p>
</li>
<li>
<p>Comprueba el correcto funcionamiento y escribe los resultados en el fichero <code>respuestas.txt</code>.</p>
</li>
</ol>
</div>
</div>
</div>
</div>
</div>
</div>
<div id="footer">
<div id="footer-text">
Last updated 2015-11-25 16:18:06 CET
</div>
</div>
</body>
</html>