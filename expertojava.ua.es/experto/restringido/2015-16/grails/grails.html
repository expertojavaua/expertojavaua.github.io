<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<!--[if IE]><meta http-equiv="X-UA-Compatible" content="IE=edge"><![endif]-->
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 1.5.2">
<meta name="author" content="Fran GarcÃ­a">
<title>Grails</title>
<style>/*! normalize.css v2.1.2 | MIT License | git.io/normalize */
/* ========================================================================== HTML5 display definitions ========================================================================== */
/** Correct `block` display not defined in IE 8/9. */
article, aside, details, figcaption, figure, footer, header, hgroup, main, nav, section, summary { display: block; }

/** Correct `inline-block` display not defined in IE 8/9. */
audio, canvas, video { display: inline-block; }

/** Prevent modern browsers from displaying `audio` without controls. Remove excess height in iOS 5 devices. */
audio:not([controls]) { display: none; height: 0; }

/** Address `[hidden]` styling not present in IE 8/9. Hide the `template` element in IE, Safari, and Firefox < 22. */
[hidden], template { display: none; }

script { display: none !important; }

/* ========================================================================== Base ========================================================================== */
/** 1. Set default font family to sans-serif. 2. Prevent iOS text size adjust after orientation change, without disabling user zoom. */
html { font-family: sans-serif; /* 1 */ -ms-text-size-adjust: 100%; /* 2 */ -webkit-text-size-adjust: 100%; /* 2 */ }

/** Remove default margin. */
body { margin: 0; }

/* ========================================================================== Links ========================================================================== */
/** Remove the gray background color from active links in IE 10. */
a { background: transparent; }

/** Address `outline` inconsistency between Chrome and other browsers. */
a:focus { outline: thin dotted; }

/** Improve readability when focused and also mouse hovered in all browsers. */
a:active, a:hover { outline: 0; }

/* ========================================================================== Typography ========================================================================== */
/** Address variable `h1` font-size and margin within `section` and `article` contexts in Firefox 4+, Safari 5, and Chrome. */
h1 { font-size: 2em; margin: 0.67em 0; }

/** Address styling not present in IE 8/9, Safari 5, and Chrome. */
abbr[title] { border-bottom: 1px dotted; }

/** Address style set to `bolder` in Firefox 4+, Safari 5, and Chrome. */
b, strong { font-weight: bold; }

/** Address styling not present in Safari 5 and Chrome. */
dfn { font-style: italic; }

/** Address differences between Firefox and other browsers. */
hr { -moz-box-sizing: content-box; box-sizing: content-box; height: 0; }

/** Address styling not present in IE 8/9. */
mark { background: #ff0; color: #000; }

/** Correct font family set oddly in Safari 5 and Chrome. */
code, kbd, pre, samp { font-family: monospace, serif; font-size: 1em; }

/** Improve readability of pre-formatted text in all browsers. */
pre { white-space: pre-wrap; }

/** Set consistent quote types. */
q { quotes: "\201C" "\201D" "\2018" "\2019"; }

/** Address inconsistent and variable font size in all browsers. */
small { font-size: 80%; }

/** Prevent `sub` and `sup` affecting `line-height` in all browsers. */
sub, sup { font-size: 75%; line-height: 0; position: relative; vertical-align: baseline; }

sup { top: -0.5em; }

sub { bottom: -0.25em; }

/* ========================================================================== Embedded content ========================================================================== */
/** Remove border when inside `a` element in IE 8/9. */
img { border: 0; }

/** Correct overflow displayed oddly in IE 9. */
svg:not(:root) { overflow: hidden; }

/* ========================================================================== Figures ========================================================================== */
/** Address margin not present in IE 8/9 and Safari 5. */
figure { margin: 0; }

/* ========================================================================== Forms ========================================================================== */
/** Define consistent border, margin, and padding. */
fieldset { border: 1px solid #c0c0c0; margin: 0 2px; padding: 0.35em 0.625em 0.75em; }

/** 1. Correct `color` not being inherited in IE 8/9. 2. Remove padding so people aren't caught out if they zero out fieldsets. */
legend { border: 0; /* 1 */ padding: 0; /* 2 */ }

/** 1. Correct font family not being inherited in all browsers. 2. Correct font size not being inherited in all browsers. 3. Address margins set differently in Firefox 4+, Safari 5, and Chrome. */
button, input, select, textarea { font-family: inherit; /* 1 */ font-size: 100%; /* 2 */ margin: 0; /* 3 */ }

/** Address Firefox 4+ setting `line-height` on `input` using `!important` in the UA stylesheet. */
button, input { line-height: normal; }

/** Address inconsistent `text-transform` inheritance for `button` and `select`. All other form control elements do not inherit `text-transform` values. Correct `button` style inheritance in Chrome, Safari 5+, and IE 8+. Correct `select` style inheritance in Firefox 4+ and Opera. */
button, select { text-transform: none; }

/** 1. Avoid the WebKit bug in Android 4.0.* where (2) destroys native `audio` and `video` controls. 2. Correct inability to style clickable `input` types in iOS. 3. Improve usability and consistency of cursor style between image-type `input` and others. */
button, html input[type="button"], input[type="reset"], input[type="submit"] { -webkit-appearance: button; /* 2 */ cursor: pointer; /* 3 */ }

/** Re-set default cursor for disabled elements. */
button[disabled], html input[disabled] { cursor: default; }

/** 1. Address box sizing set to `content-box` in IE 8/9. 2. Remove excess padding in IE 8/9. */
input[type="checkbox"], input[type="radio"] { box-sizing: border-box; /* 1 */ padding: 0; /* 2 */ }

/** 1. Address `appearance` set to `searchfield` in Safari 5 and Chrome. 2. Address `box-sizing` set to `border-box` in Safari 5 and Chrome (include `-moz` to future-proof). */
input[type="search"] { -webkit-appearance: textfield; /* 1 */ -moz-box-sizing: content-box; -webkit-box-sizing: content-box; /* 2 */ box-sizing: content-box; }

/** Remove inner padding and search cancel button in Safari 5 and Chrome on OS X. */
input[type="search"]::-webkit-search-cancel-button, input[type="search"]::-webkit-search-decoration { -webkit-appearance: none; }

/** Remove inner padding and border in Firefox 4+. */
button::-moz-focus-inner, input::-moz-focus-inner { border: 0; padding: 0; }

/** 1. Remove default vertical scrollbar in IE 8/9. 2. Improve readability and alignment in all browsers. */
textarea { overflow: auto; /* 1 */ vertical-align: top; /* 2 */ }

/* ========================================================================== Tables ========================================================================== */
/** Remove most spacing between table cells. */
table { border-collapse: collapse; border-spacing: 0; }

meta.foundation-mq-small { font-family: "only screen and (min-width: 768px)"; width: 768px; }

meta.foundation-mq-medium { font-family: "only screen and (min-width:1280px)"; width: 1280px; }

meta.foundation-mq-large { font-family: "only screen and (min-width:1440px)"; width: 1440px; }

*, *:before, *:after { -moz-box-sizing: border-box; -webkit-box-sizing: border-box; box-sizing: border-box; }

html, body { font-size: 97%; }

body { background: white; color: #222222; padding: 0; margin: 0; font-family: "Helvetica Neue", "Helvetica", Helvetica, Arial, sans-serif; font-weight: normal; font-style: normal; line-height: 1; position: relative; cursor: auto; }

a:hover { cursor: pointer; }

img, object, embed { max-width: 100%; height: auto; }

object, embed { height: 100%; }

img { -ms-interpolation-mode: bicubic; }

#map_canvas img, #map_canvas embed, #map_canvas object, .map_canvas img, .map_canvas embed, .map_canvas object { max-width: none !important; }

.left { float: left !important; }

.right { float: right !important; }

.text-left { text-align: left !important; }

.text-right { text-align: right !important; }

.text-center { text-align: center !important; }

.text-justify { text-align: justify !important; }

.hide { display: none; }

.antialiased, body { -webkit-font-smoothing: antialiased; }

img { display: inline-block; vertical-align: middle; }

textarea { height: auto; min-height: 50px; }

select { width: 100%; }

p.lead, .paragraph.lead > p, #preamble > .sectionbody > .paragraph:first-of-type p { font-size: 1.21875em; line-height: 1.6; }

.subheader, .admonitionblock td.content > .title, .audioblock > .title, .exampleblock > .title, .imageblock > .title, .listingblock > .title, .literalblock > .title, .stemblock > .title, .openblock > .title, .paragraph > .title, .quoteblock > .title, table.tableblock > .title, .verseblock > .title, .videoblock > .title, .dlist > .title, .olist > .title, .ulist > .title, .qlist > .title, .hdlist > .title { line-height: 1.4; color: #6f6f6f; font-weight: 300; margin-top: 0.2em; margin-bottom: 0.5em; }

/* Typography resets */
div, dl, dt, dd, ul, ol, li, h1, h2, h3, #toctitle, .sidebarblock > .content > .title, h4, h5, h6, pre, form, p, blockquote, th, td { margin: 0; padding: 0; direction: ltr; }

/* Default Link Styles */
a { color: #1164be; text-decoration: none; line-height: inherit; }
a img { border: none; }

/* Default paragraph styles */
p { font-family: inherit; font-weight: normal; font-size: 1em; line-height: 1.4; margin-bottom: 1em; text-rendering: optimizeLegibility; }
p aside { font-size: 0.875em; line-height: 1.35; font-style: italic; }

/* Default header styles */
h1, h2, h3, #toctitle, .sidebarblock > .content > .title, h4, h5, h6 { font-family: "Helvetica Neue", "Helvetica", Helvetica, Arial, sans-serif; font-weight: bold; font-style: normal; color: #1c355e; text-rendering: optimizeLegibility; margin-top: 1em; margin-bottom: 0.5em; line-height: 1.2125em; }
h1 small, h2 small, h3 small, #toctitle small, .sidebarblock > .content > .title small, h4 small, h5 small, h6 small { font-size: 60%; color: #6f6f6f; line-height: 0; }

h1 { font-size: 2.125em; }

h2 { font-size: 1.6875em; }

h3, #toctitle, .sidebarblock > .content > .title { font-size: 1.375em; }

h4 { font-size: 1.125em; }

h5 { font-size: 1.125em; }

h6 { font-size: 1em; }

hr { border: solid #dddddd; border-width: 1px 0 0; clear: both; margin: 1.25em 0 1.1875em; height: 0; }

/* Helpful Typography Defaults */
em, i { font-style: italic; line-height: inherit; }

strong, b { font-weight: bold; line-height: inherit; }

small { font-size: 60%; line-height: inherit; }

code { font-family: Consolas, "Liberation Mono", Courier, monospace; font-weight: bold; }

/* Lists */
ul, ol, dl { font-size: 1em; line-height: 1.4; margin-bottom: 1.25em; list-style-position: outside; font-family: inherit; }

ul, ol { margin-left: 2.5em; }
ul.no-bullet, ol.no-bullet { margin-left: 1.5em; }

/* Unordered Lists */
ul li ul, ul li ol { margin-left: 1.25em; margin-bottom: 0; font-size: 1em; /* Override nested font-size change */ }
ul.square li ul, ul.circle li ul, ul.disc li ul { list-style: inherit; }
ul.square { list-style-type: square; }
ul.circle { list-style-type: circle; }
ul.disc { list-style-type: disc; }
ul.no-bullet { list-style: none; }

/* Ordered Lists */
ol li ul, ol li ol { margin-left: 1.25em; margin-bottom: 0; }

/* Definition Lists */
dl dt { margin-bottom: 0.3125em; font-weight: bold; }
dl dd { margin-bottom: 1.25em; }

/* Abbreviations */
abbr, acronym { text-transform: uppercase; font-size: 90%; color: #222222; border-bottom: 1px dotted #dddddd; cursor: help; }

abbr { text-transform: none; }

/* Blockquotes */
blockquote { margin: 0 0 1.25em; padding: 0.5625em 1.25em 0 1.1875em; border-left: 1px solid #dddddd; }
blockquote cite { display: block; font-size: 0.8125em; color: #555555; }
blockquote cite:before { content: "\2014 \0020"; }
blockquote cite a, blockquote cite a:visited { color: #555555; }

blockquote, blockquote p { line-height: 1.6; color: #6f6f6f; }

/* Microformats */
.vcard { display: inline-block; margin: 0 0 1.25em 0; border: 1px solid #dddddd; padding: 0.625em 0.75em; }
.vcard li { margin: 0; display: block; }
.vcard .fn { font-weight: bold; font-size: 0.9375em; }

.vevent .summary { font-weight: bold; }
.vevent abbr { cursor: auto; text-decoration: none; font-weight: bold; border: none; padding: 0 0.0625em; }

/*@media only screen and (min-width: 768px) { h1, h2, h3, #toctitle, .sidebarblock > .content > .title, h4, h5, h6 { line-height: 1.4; }
  h1 { font-size: 2.75em; }
  h2 { font-size: 2.3125em; }
  h3, #toctitle, .sidebarblock > .content > .title { font-size: 1.6875em; }
  h4 { font-size: 1.4375em; } }*/
/* Tables */
table { background: white; margin-bottom: 1.25em; border: solid 1px #dddddd; }
table thead, table tfoot { background: whitesmoke; font-weight: bold; }
table thead tr th, table thead tr td, table tfoot tr th, table tfoot tr td { padding: 0.5em 0.625em 0.625em; font-size: inherit; color: #222222; text-align: left; }
table tr th, table tr td { padding: 0.5625em 0.625em; font-size: inherit; color: #222222; }
table tr.even, table tr.alt, table tr:nth-of-type(even) { background: #f9f9f9; }
table thead tr th, table tfoot tr th, table tbody tr td, table tr td, table tfoot tr td { display: table-cell; line-height: 1.4; }

h1, h2, h3, #toctitle, .sidebarblock > .content > .title, h4, h5, h6 { line-height: 1.4; border-bottom: 1px solid #dddddd }

.clearfix:before, .clearfix:after, .float-group:before, .float-group:after { content: " "; display: table; }
.clearfix:after, .float-group:after { clear: both; }

*:not(pre) > code { font-size: inherit; font-style: normal !important; letter-spacing: 0; padding: 3px 2px 1px 2px; background-color: #eeeeee; border: 1px solid #dddddd; -webkit-border-radius: 0; border-radius: 0; line-height: inherit; font-weight: normal; }

pre, pre > code { line-height: 1.4; color: black; font-family: monospace, serif; font-weight: normal; }

.keyseq { color: #555555; }

kbd { display: inline-block; color: #222222; font-size: 0.75em; line-height: 1.4; background-color: #f7f7f7; border: 1px solid #ccc; -webkit-border-radius: 3px; border-radius: 3px; -webkit-box-shadow: 0 1px 0 rgba(0, 0, 0, 0.2), 0 0 0 0.1em white inset; box-shadow: 0 1px 0 rgba(0, 0, 0, 0.2), 0 0 0 0.1em white inset; margin: -0.15em 0.15em 0 0.15em; padding: 0.2em 0.6em 0.2em 0.5em; vertical-align: middle; white-space: nowrap; }

.keyseq kbd:first-child { margin-left: 0; }

.keyseq kbd:last-child { margin-right: 0; }

.menuseq, .menu { color: #090909; }

b.button:before, b.button:after { position: relative; top: -1px; font-weight: normal; }

b.button:before { content: "["; padding: 0 3px 0 2px; }

b.button:after { content: "]"; padding: 0 2px 0 3px; }

#header, #content, #footnotes, #footer { width: 100%; margin-left: auto; margin-right: auto; margin-top: 0; margin-bottom: 0; max-width: 62.5em; *zoom: 1; position: relative; padding-left: 0.9375em; padding-right: 0.9375em; }
#header:before, #header:after, #content:before, #content:after, #footnotes:before, #footnotes:after, #footer:before, #footer:after { content: " "; display: table; }
#header:after, #content:after, #footnotes:after, #footer:after { clear: both; }

#content { margin-top: 1.25em; }

#content:before { content: none; }

#header > h1:first-child { color: black; margin-top: 2.25rem; margin-bottom: 0; }
#header > h1:first-child + #toc { margin-top: 8px; border-top: 1px solid #dddddd; }
#header > h1:only-child, body.toc2 #header > h1:nth-last-child(2) { border-bottom: 1px solid #dddddd; padding-bottom: 8px; }
#header .details { border-bottom: 1px solid #dddddd; line-height: 1.45; padding-top: 0.25em; padding-bottom: 0.25em; padding-left: 0.25em; color: #555555; display: -ms-flexbox; display: -webkit-flex; display: flex; -ms-flex-flow: row wrap; -webkit-flex-flow: row wrap; flex-flow: row wrap; }
#header .details span:first-child { margin-left: -0.125em; }
#header .details span.email a { color: #6f6f6f; }
#header .details br { display: none; }
#header .details br + span:before { content: "\00a0\2013\00a0"; }
#header .details br + span.author:before { content: "\00a0\22c5\00a0"; color: #6f6f6f; }
#header .details br + span#revremark:before { content: "\00a0|\00a0"; }
#header #revnumber { text-transform: capitalize; }
#header #revnumber:after { content: "\00a0"; }

#content > h1:first-child:not([class]) { color: black; border-bottom: 1px solid #dddddd; padding-bottom: 8px; margin-top: 0; padding-top: 1rem; margin-bottom: 1.25rem; }

#floating {
  position: fixed;
  z-index: 1000;
  padding: 0.5em;
  right: 0;
  top: 0;
  background: white;
  box-shadow: 0 0 1em #777777;
  -webkit-box-shadow: 0 0 1em #777777;
  -moz-box-shadow: 0 0 1em #777777;
  -webkit-border-bottom-left-radius: 5px;
  -moz-border-radius-bottomleft: 5px;
  max-height: 80%;
  overflow: auto;
}

#floating #full { display: none; } /* Hide the full TOC by default */

#floating:hover #full{
  display: block; /* Show it on hover */
}


#toc { border-bottom: 1px solid #dddddd; padding-bottom: 0.5em; }
#toc > ul { margin-left: 0.125em; }
#toc ul.sectlevel0 > li > a { font-style: italic; }
#toc ul.sectlevel0 ul.sectlevel1 { margin: 0.5em 0; }
#toc ul { font-family: "Helvetica Neue", "Helvetica", Helvetica, Arial, sans-serif; list-style-type: none; }
#toc a { text-decoration: none; }
#toc a:active { text-decoration: underline; }

#toctitle { color: #6f6f6f; font-size: 1.2em; }

@media only screen and (min-width: 768px) { #toctitle { font-size: 1.375em; }
  body.toc2 { padding-left: 15em; padding-right: 0; }
  #toc.toc2 { margin-top: 0 !important; background-color: #f2f2f2; position: fixed; width: 15em; left: 0; top: 0; border-right: 1px solid #dddddd; border-top-width: 0 !important; border-bottom-width: 0 !important; z-index: 1000; padding: 1.25em 1em; height: 100%; overflow: auto; }
  #toc.toc2 #toctitle { margin-top: 0; font-size: 1.2em; }
  #toc.toc2 > ul { font-size: 0.9em; margin-bottom: 0; }
  #toc.toc2 ul ul { margin-left: 0; padding-left: 1em; }
  #toc.toc2 ul.sectlevel0 ul.sectlevel1 { padding-left: 0; margin-top: 0.5em; margin-bottom: 0.5em; }
  body.toc2.toc-right { padding-left: 0; padding-right: 15em; }
  body.toc2.toc-right #toc.toc2 { border-right-width: 0; border-left: 1px solid #dddddd; left: auto; right: 0; } }
@media only screen and (min-width: 1280px) { body.toc2 { padding-left: 20em; padding-right: 0; }
  #toc.toc2 { width: 20em; }
  #toc.toc2 #toctitle { font-size: 1.375em; }
  #toc.toc2 > ul { font-size: 0.95em; }
  #toc.toc2 ul ul { padding-left: 1.25em; }
  body.toc2.toc-right { padding-left: 0; padding-right: 20em; } }
#content #toc { border-style: solid; border-width: 1px; border-color: #d9d9d9; margin-bottom: 1.25em; padding: 1.25em; background: #f2f2f2; -webkit-border-radius: 0; border-radius: 0; }
#content #toc > :first-child { margin-top: 0; }
#content #toc > :last-child { margin-bottom: 0; }

#footer { max-width: 100%; background-color: #222222; padding: 1.25em; }

#footer-text { color: #dddddd; line-height: 1.44; }

.sect1 { padding-bottom: 0.625em; }

@media only screen and (min-width: 768px) { .sect1 { padding-bottom: 1.25em; } }
.sect1 + .sect1 { border-top: 1px solid #dddddd; }

#content h1 > a.anchor, h2 > a.anchor, h3 > a.anchor, #toctitle > a.anchor, .sidebarblock > .content > .title > a.anchor, h4 > a.anchor, h5 > a.anchor, h6 > a.anchor { position: absolute; z-index: 1001; width: 1.5ex; margin-left: -1.5ex; display: block; text-decoration: none !important; visibility: hidden; text-align: center; font-weight: normal; }
#content h1 > a.anchor:before, h2 > a.anchor:before, h3 > a.anchor:before, #toctitle > a.anchor:before, .sidebarblock > .content > .title > a.anchor:before, h4 > a.anchor:before, h5 > a.anchor:before, h6 > a.anchor:before { content: "\00A7"; font-size: 0.85em; display: block; padding-top: 0.1em; }
#content h1:hover > a.anchor, #content h1 > a.anchor:hover, h2:hover > a.anchor, h2 > a.anchor:hover, h3:hover > a.anchor, #toctitle:hover > a.anchor, .sidebarblock > .content > .title:hover > a.anchor, h3 > a.anchor:hover, #toctitle > a.anchor:hover, .sidebarblock > .content > .title > a.anchor:hover, h4:hover > a.anchor, h4 > a.anchor:hover, h5:hover > a.anchor, h5 > a.anchor:hover, h6:hover > a.anchor, h6 > a.anchor:hover { visibility: visible; }
#content h1 > a.link, h2 > a.link, h3 > a.link, #toctitle > a.link, .sidebarblock > .content > .title > a.link, h4 > a.link, h5 > a.link, h6 > a.link { color: #222222; text-decoration: none; }
#content h1 > a.link:hover, h2 > a.link:hover, h3 > a.link:hover, #toctitle > a.link:hover, .sidebarblock > .content > .title > a.link:hover, h4 > a.link:hover, h5 > a.link:hover, h6 > a.link:hover { color: #151515; }

.audioblock, .imageblock, .literalblock, .listingblock, .stemblock, .videoblock { margin-bottom: 1.25em; }

.admonitionblock td.content > .title, .audioblock > .title, .exampleblock > .title, .imageblock > .title, .listingblock > .title, .literalblock > .title, .stemblock > .title, .openblock > .title, .paragraph > .title, .quoteblock > .title, table.tableblock > .title, .verseblock > .title, .videoblock > .title, .dlist > .title, .olist > .title, .ulist > .title, .qlist > .title, .hdlist > .title { text-rendering: optimizeLegibility; text-align: left; }

table.tableblock > caption.title { white-space: nowrap; overflow: visible; max-width: 0; }

.paragraph.lead > p, #preamble > .sectionbody > .paragraph:first-of-type p { color: black; }

table.tableblock #preamble > .sectionbody > .paragraph:first-of-type p { font-size: inherit; }

.admonitionblock > table { border-collapse: separate; border: 0; background: none; width: 100%; }
.admonitionblock > table td.icon { text-align: center; width: 80px; }
.admonitionblock > table td.icon img { max-width: none; }
.admonitionblock > table td.icon .title { font-weight: bold; font-family: "Helvetica Neue", "Helvetica", Helvetica, Arial, sans-serif; text-transform: uppercase; }
.admonitionblock > table td.content { padding-left: 1.125em; padding-right: 1.25em; border-left: 1px solid #dddddd; color: #555555; }
.admonitionblock > table td.content > :last-child > :last-child { margin-bottom: 0; }

.exampleblock > .content { border-style: solid; border-width: 1px; border-color: #e6e6e6; margin-bottom: 1.25em; padding: 1.25em; background: white; -webkit-border-radius: 0; border-radius: 0; }
.exampleblock > .content > :first-child { margin-top: 0; }
.exampleblock > .content > :last-child { margin-bottom: 0; }

.sidebarblock { border-style: solid; border-width: 1px; border-color: #d9d9d9; margin-bottom: 1.25em; padding: 1.25em; background: #f2f2f2; -webkit-border-radius: 0; border-radius: 0; }
.sidebarblock > :first-child { margin-top: 0; }
.sidebarblock > :last-child { margin-bottom: 0; }
.sidebarblock > .content > .title { color: #6f6f6f; margin-top: 0; }

.exampleblock > .content > :last-child > :last-child, .exampleblock > .content .olist > ol > li:last-child > :last-child, .exampleblock > .content .ulist > ul > li:last-child > :last-child, .exampleblock > .content .qlist > ol > li:last-child > :last-child, .sidebarblock > .content > :last-child > :last-child, .sidebarblock > .content .olist > ol > li:last-child > :last-child, .sidebarblock > .content .ulist > ul > li:last-child > :last-child, .sidebarblock > .content .qlist > ol > li:last-child > :last-child { margin-bottom: 0; }

.literalblock pre, .listingblock pre:not(.highlight), .listingblock pre[class="highlight"], .listingblock pre[class^="highlight "], .listingblock pre.CodeRay, .listingblock pre.prettyprint { background: #eeeeee; }
.sidebarblock .literalblock pre, .sidebarblock .listingblock pre:not(.highlight), .sidebarblock .listingblock pre[class="highlight"], .sidebarblock .listingblock pre[class^="highlight "], .sidebarblock .listingblock pre.CodeRay, .sidebarblock .listingblock pre.prettyprint { background: #f2f1f1; }

.literalblock pre, .literalblock pre[class], .listingblock pre, .listingblock pre[class] { border: 1px solid #cccccc; -webkit-border-radius: 0; border-radius: 0; word-wrap: break-word; padding: 0.8em 0.8em 0.65em 0.8em; font-size: 0.8125em; }
.literalblock pre.nowrap, .literalblock pre[class].nowrap, .listingblock pre.nowrap, .listingblock pre[class].nowrap { overflow-x: auto; white-space: pre; word-wrap: normal; }
@media only screen and (min-width: 768px) { .literalblock pre, .literalblock pre[class], .listingblock pre, .listingblock pre[class] { font-size: 0.90625em; } }
@media only screen and (min-width: 1280px) { .literalblock pre, .literalblock pre[class], .listingblock pre, .listingblock pre[class] { font-size: 1em; } }

.literalblock.output pre { color: #eeeeee; background-color: black; }

.listingblock pre.highlightjs { padding: 0; }
.listingblock pre.highlightjs > code { padding: 0.8em 0.8em 0.65em 0.8em; -webkit-border-radius: 0; border-radius: 0; }

.listingblock > .content { position: relative; }

.listingblock code[data-lang]:before { display: none; content: attr(data-lang); position: absolute; font-size: 0.75em; top: 0.425rem; right: 0.5rem; line-height: 1; text-transform: uppercase; color: #999; }

.listingblock:hover code[data-lang]:before { display: block; }

.listingblock.terminal pre .command:before { content: attr(data-prompt); padding-right: 0.5em; color: #999; }

.listingblock.terminal pre .command:not([data-prompt]):before { content: "$"; }

table.pyhltable { border-collapse: separate; border: 0; margin-bottom: 0; background: none; }

table.pyhltable td { vertical-align: top; padding-top: 0; padding-bottom: 0; }

table.pyhltable td.code { padding-left: .75em; padding-right: 0; }

pre.pygments .lineno, table.pyhltable td:not(.code) { color: #999; padding-left: 0; padding-right: .5em; border-right: 1px solid #dddddd; }

pre.pygments .lineno { display: inline-block; margin-right: .25em; }

table.pyhltable .linenodiv { background: none !important; padding-right: 0 !important; }

.quoteblock { margin: 0 1em 1.25em 1.5em; display: table; }
.quoteblock > .title { margin-left: -1.5em; margin-bottom: 0.75em; }
.quoteblock blockquote, .quoteblock blockquote p { color: #6f6f6f; font-size: 1.15rem; line-height: 1.75; word-spacing: 0.1em; letter-spacing: 0; font-style: italic; text-align: justify; }
.quoteblock blockquote { margin: 0; padding: 0; border: 0; }
.quoteblock blockquote:before { content: "\201c"; float: left; font-size: 2.75em; font-weight: bold; line-height: 0.6em; margin-left: -0.6em; color: #6f6f6f; text-shadow: 0 1px 2px rgba(0, 0, 0, 0.1); }
.quoteblock blockquote > .paragraph:last-child p { margin-bottom: 0; }
.quoteblock .attribution { margin-top: 0.5em; margin-right: 0.5ex; text-align: right; }
.quoteblock .quoteblock { margin-left: 0; margin-right: 0; padding: 0.5em 0; border-left: 3px solid #555555; }
.quoteblock .quoteblock blockquote { padding: 0 0 0 0.75em; }
.quoteblock .quoteblock blockquote:before { display: none; }

.verseblock { margin: 0 1em 1.25em 1em; }
.verseblock pre { font-family: "Open Sans", "DejaVu Sans", sans; font-size: 1.15rem; color: #6f6f6f; font-weight: 300; text-rendering: optimizeLegibility; }
.verseblock pre strong { font-weight: 400; }
.verseblock .attribution { margin-top: 1.25rem; margin-left: 0.5ex; }

.quoteblock .attribution, .verseblock .attribution { font-size: 0.8125em; line-height: 1.45; font-style: italic; }
.quoteblock .attribution br, .verseblock .attribution br { display: none; }
.quoteblock .attribution cite, .verseblock .attribution cite { display: block; letter-spacing: -0.05em; color: #555555; }

.quoteblock.abstract { margin: 0 0 1.25em 0; display: block; }
.quoteblock.abstract blockquote, .quoteblock.abstract blockquote p { text-align: left; word-spacing: 0; }
.quoteblock.abstract blockquote:before, .quoteblock.abstract blockquote p:first-of-type:before { display: none; }

table.tableblock { max-width: 100%; border-collapse: separate; }
table.tableblock td > .paragraph:last-child p > p:last-child, table.tableblock th > p:last-child, table.tableblock td > p:last-child { margin-bottom: 0; }

table.spread { width: 100%; }

table.tableblock, th.tableblock, td.tableblock { border: 0 solid #dddddd; }

table.grid-all th.tableblock, table.grid-all td.tableblock { border-width: 0 1px 1px 0; }

table.grid-all tfoot > tr > th.tableblock, table.grid-all tfoot > tr > td.tableblock { border-width: 1px 1px 0 0; }

table.grid-cols th.tableblock, table.grid-cols td.tableblock { border-width: 0 1px 0 0; }

table.grid-all * > tr > .tableblock:last-child, table.grid-cols * > tr > .tableblock:last-child { border-right-width: 0; }

table.grid-rows th.tableblock, table.grid-rows td.tableblock { border-width: 0 0 1px 0; }

table.grid-all tbody > tr:last-child > th.tableblock, table.grid-all tbody > tr:last-child > td.tableblock, table.grid-all thead:last-child > tr > th.tableblock, table.grid-rows tbody > tr:last-child > th.tableblock, table.grid-rows tbody > tr:last-child > td.tableblock, table.grid-rows thead:last-child > tr > th.tableblock { border-bottom-width: 0; }

table.grid-rows tfoot > tr > th.tableblock, table.grid-rows tfoot > tr > td.tableblock { border-width: 1px 0 0 0; }

table.frame-all { border-width: 1px; }

table.frame-sides { border-width: 0 1px; }

table.frame-topbot { border-width: 1px 0; }

th.halign-left, td.halign-left { text-align: left; }

th.halign-right, td.halign-right { text-align: right; }

th.halign-center, td.halign-center { text-align: center; }

th.valign-top, td.valign-top { vertical-align: top; }

th.valign-bottom, td.valign-bottom { vertical-align: bottom; }

th.valign-middle, td.valign-middle { vertical-align: middle; }

table thead th, table tfoot th { font-weight: bold; }

tbody tr th { display: table-cell; line-height: 1.4; background: whitesmoke; }

tbody tr th, tbody tr th p, tfoot tr th, tfoot tr th p { color: #222222; font-weight: bold; }

p.tableblock > code:only-child { background: none; padding: 0; }

p.tableblock { font-size: 1em; }

td > div.verse { white-space: pre; }

ol { margin-left: 2.5em; }

ul li ol { margin-left: 1.5em; }

dl dd { margin-left: 1.125em; }

dl dd:last-child, dl dd:last-child > :last-child { margin-bottom: 0; }

ol > li p, ul > li p, ul dd, ol dd, .olist .olist, .ulist .ulist, .ulist .olist, .olist .ulist { margin-bottom: 0.625em; }

ul.unstyled, ol.unnumbered, ul.checklist, ul.none { list-style-type: none; }

ul.unstyled, ol.unnumbered, ul.checklist { margin-left: 0.625em; }

ul.checklist li > p:first-child > .fa-check-square-o:first-child, ul.checklist li > p:first-child > input[type="checkbox"]:first-child { margin-right: 0.25em; }

ul.checklist li > p:first-child > input[type="checkbox"]:first-child { position: relative; top: 1px; }

ul.inline { margin: 0 auto 0.625em auto; margin-left: -1.375em; margin-right: 0; padding: 0; list-style: none; overflow: hidden; }
ul.inline > li { list-style: none; float: left; margin-left: 1.375em; display: block; }
ul.inline > li > * { display: block; }

.unstyled dl dt { font-weight: normal; font-style: normal; }

ol.arabic { list-style-type: decimal; }

ol.decimal { list-style-type: decimal-leading-zero; }

ol.loweralpha { list-style-type: lower-alpha; }

ol.upperalpha { list-style-type: upper-alpha; }

ol.lowerroman { list-style-type: lower-roman; }

ol.upperroman { list-style-type: upper-roman; }

ol.lowergreek { list-style-type: lower-greek; }

.hdlist > table, .colist > table { border: 0; background: none; }
.hdlist > table > tbody > tr, .colist > table > tbody > tr { background: none; }

td.hdlist1 { padding-right: .75em; font-weight: bold; }

td.hdlist1, td.hdlist2 { vertical-align: top; }

.literalblock + .colist, .listingblock + .colist { margin-top: -0.5em; }

.colist > table tr > td:first-of-type { padding: 0 0.75em; line-height: 1; }
.colist > table tr > td:last-of-type { padding: 0.25em 0; }

.thumb, .th { line-height: 0; display: inline-block; border: solid 4px white; -webkit-box-shadow: 0 0 0 1px #dddddd; box-shadow: 0 0 0 1px #dddddd; }

.imageblock.left, .imageblock[style*="float: left"] { margin: 0.25em 0.625em 1.25em 0; }
.imageblock.right, .imageblock[style*="float: right"] { margin: 0.25em 0 1.25em 0.625em; }
.imageblock > .title { margin-bottom: 0; }
.imageblock.thumb, .imageblock.th { border-width: 6px; }
.imageblock.thumb > .title, .imageblock.th > .title { padding: 0 0.125em; }

.image.left, .image.right { margin-top: 0.25em; margin-bottom: 0.25em; display: inline-block; line-height: 0; }
.image.left { margin-right: 0.625em; }
.image.right { margin-left: 0.625em; }

a.image { text-decoration: none; }

span.footnote, span.footnoteref { vertical-align: super; font-size: 0.875em; }
span.footnote a, span.footnoteref a { text-decoration: none; }
span.footnote a:active, span.footnoteref a:active { text-decoration: underline; }

#footnotes { padding-top: 0.75em; padding-bottom: 0.75em; margin-bottom: 0.625em; }
#footnotes hr { width: 20%; min-width: 6.25em; margin: -.25em 0 .75em 0; border-width: 1px 0 0 0; }
#footnotes .footnote { padding: 0 0.375em; line-height: 1.3; font-size: 0.875em; margin-left: 1.2em; text-indent: -1.2em; margin-bottom: .2em; }
#footnotes .footnote a:first-of-type { font-weight: bold; text-decoration: none; }
#footnotes .footnote:last-of-type { margin-bottom: 0; }

#content #footnotes { margin-top: -0.625em; margin-bottom: 0; padding: 0.75em 0; }

.gist .file-data > table { border: 0; background: #fff; width: 100%; margin-bottom: 0; }
.gist .file-data > table td.line-data { width: 99%; }

div.unbreakable { page-break-inside: avoid; }

.big { font-size: larger; }

.small { font-size: smaller; }

.underline { text-decoration: underline; }

.overline { text-decoration: overline; }

.line-through { text-decoration: line-through; }

.aqua { color: #00bfbf; }

.aqua-background { background-color: #00fafa; }

.black { color: black; }

.black-background { background-color: black; }

.blue { color: #0000bf; }

.blue-background { background-color: #0000fa; }

.fuchsia { color: #bf00bf; }

.fuchsia-background { background-color: #fa00fa; }

.gray { color: #606060; }

.gray-background { background-color: #7d7d7d; }

.green { color: #006000; }

.green-background { background-color: #007d00; }

.lime { color: #00bf00; }

.lime-background { background-color: #00fa00; }

.maroon { color: #600000; }

.maroon-background { background-color: #7d0000; }

.navy { color: #000060; }

.navy-background { background-color: #00007d; }

.olive { color: #606000; }

.olive-background { background-color: #7d7d00; }

.purple { color: #600060; }

.purple-background { background-color: #7d007d; }

.red { color: #bf0000; }

.red-background { background-color: #fa0000; }

.silver { color: #909090; }

.silver-background { background-color: #bcbcbc; }

.teal { color: #006060; }

.teal-background { background-color: #007d7d; }

.white { color: #bfbfbf; }

.white-background { background-color: #fafafa; }

.yellow { color: #bfbf00; }

.yellow-background { background-color: #fafa00; }

span.icon > .fa { cursor: default; }

.admonitionblock td.icon [class^="fa icon-"] { font-size: 2.5em; text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.5); cursor: default; }
.admonitionblock td.icon .icon-note:before { content: "\f05a"; color: #207c98; }
.admonitionblock td.icon .icon-tip:before { content: "\f0eb"; text-shadow: 1px 1px 2px rgba(155, 155, 0, 0.8); color: #111; }
.admonitionblock td.icon .icon-warning:before { content: "\f071"; color: #bf6900; }
.admonitionblock td.icon .icon-caution:before { content: "\f06d"; color: #bf3400; }
.admonitionblock td.icon .icon-important:before { content: "\f06a"; color: #bf0000; }

.conum[data-value] { display: inline-block; color: #fff !important; background-color: #222222; -webkit-border-radius: 100px; border-radius: 100px; text-align: center; font-size: 0.75em; width: 1.67em; height: 1.67em; line-height: 1.67em; font-family: "Open Sans", "DejaVu Sans", sans-serif; font-style: normal; font-weight: bold; }
.conum[data-value] * { color: #fff !important; }
.conum[data-value] + b { display: none; }
.conum[data-value]:after { content: attr(data-value); }
pre .conum[data-value] { position: relative; top: -0.125em; }

b.conum * { color: inherit !important; }

.conum:not([data-value]):empty { display: none; }

.literalblock pre, .listingblock pre { background: #eeeeee; }

</style>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.2.0/css/font-awesome.min.css">
<style>.listingblock .pygments .hll { background-color: #ffffcc }
.listingblock .pygments  { background: #f8f8f8; }
.listingblock .pygments .tok-c { color: #408080; font-style: italic } /* Comment */
.listingblock .pygments .tok-err { border: 1px solid #FF0000 } /* Error */
.listingblock .pygments .tok-k { color: #008000; font-weight: bold } /* Keyword */
.listingblock .pygments .tok-o { color: #666666 } /* Operator */
.listingblock .pygments .tok-cm { color: #408080; font-style: italic } /* Comment.Multiline */
.listingblock .pygments .tok-cp { color: #BC7A00 } /* Comment.Preproc */
.listingblock .pygments .tok-c1 { color: #408080; font-style: italic } /* Comment.Single */
.listingblock .pygments .tok-cs { color: #408080; font-style: italic } /* Comment.Special */
.listingblock .pygments .tok-gd { color: #A00000 } /* Generic.Deleted */
.listingblock .pygments .tok-ge { font-style: italic } /* Generic.Emph */
.listingblock .pygments .tok-gr { color: #FF0000 } /* Generic.Error */
.listingblock .pygments .tok-gh { color: #000080; font-weight: bold } /* Generic.Heading */
.listingblock .pygments .tok-gi { color: #00A000 } /* Generic.Inserted */
.listingblock .pygments .tok-go { color: #888888 } /* Generic.Output */
.listingblock .pygments .tok-gp { color: #000080; font-weight: bold } /* Generic.Prompt */
.listingblock .pygments .tok-gs { font-weight: bold } /* Generic.Strong */
.listingblock .pygments .tok-gu { color: #800080; font-weight: bold } /* Generic.Subheading */
.listingblock .pygments .tok-gt { color: #0044DD } /* Generic.Traceback */
.listingblock .pygments .tok-kc { color: #008000; font-weight: bold } /* Keyword.Constant */
.listingblock .pygments .tok-kd { color: #008000; font-weight: bold } /* Keyword.Declaration */
.listingblock .pygments .tok-kn { color: #008000; font-weight: bold } /* Keyword.Namespace */
.listingblock .pygments .tok-kp { color: #008000 } /* Keyword.Pseudo */
.listingblock .pygments .tok-kr { color: #008000; font-weight: bold } /* Keyword.Reserved */
.listingblock .pygments .tok-kt { color: #B00040 } /* Keyword.Type */
.listingblock .pygments .tok-m { color: #666666 } /* Literal.Number */
.listingblock .pygments .tok-s { color: #BA2121 } /* Literal.String */
.listingblock .pygments .tok-na { color: #7D9029 } /* Name.Attribute */
.listingblock .pygments .tok-nb { color: #008000 } /* Name.Builtin */
.listingblock .pygments .tok-nc { color: #0000FF; font-weight: bold } /* Name.Class */
.listingblock .pygments .tok-no { color: #880000 } /* Name.Constant */
.listingblock .pygments .tok-nd { color: #AA22FF } /* Name.Decorator */
.listingblock .pygments .tok-ni { color: #999999; font-weight: bold } /* Name.Entity */
.listingblock .pygments .tok-ne { color: #D2413A; font-weight: bold } /* Name.Exception */
.listingblock .pygments .tok-nf { color: #0000FF } /* Name.Function */
.listingblock .pygments .tok-nl { color: #A0A000 } /* Name.Label */
.listingblock .pygments .tok-nn { color: #0000FF; font-weight: bold } /* Name.Namespace */
.listingblock .pygments .tok-nt { color: #008000; font-weight: bold } /* Name.Tag */
.listingblock .pygments .tok-nv { color: #19177C } /* Name.Variable */
.listingblock .pygments .tok-ow { color: #AA22FF; font-weight: bold } /* Operator.Word */
.listingblock .pygments .tok-w { color: #bbbbbb } /* Text.Whitespace */
.listingblock .pygments .tok-mb { color: #666666 } /* Literal.Number.Bin */
.listingblock .pygments .tok-mf { color: #666666 } /* Literal.Number.Float */
.listingblock .pygments .tok-mh { color: #666666 } /* Literal.Number.Hex */
.listingblock .pygments .tok-mi { color: #666666 } /* Literal.Number.Integer */
.listingblock .pygments .tok-mo { color: #666666 } /* Literal.Number.Oct */
.listingblock .pygments .tok-sb { color: #BA2121 } /* Literal.String.Backtick */
.listingblock .pygments .tok-sc { color: #BA2121 } /* Literal.String.Char */
.listingblock .pygments .tok-sd { color: #BA2121; font-style: italic } /* Literal.String.Doc */
.listingblock .pygments .tok-s2 { color: #BA2121 } /* Literal.String.Double */
.listingblock .pygments .tok-se { color: #BB6622; font-weight: bold } /* Literal.String.Escape */
.listingblock .pygments .tok-sh { color: #BA2121 } /* Literal.String.Heredoc */
.listingblock .pygments .tok-si { color: #BB6688; font-weight: bold } /* Literal.String.Interpol */
.listingblock .pygments .tok-sx { color: #008000 } /* Literal.String.Other */
.listingblock .pygments .tok-sr { color: #BB6688 } /* Literal.String.Regex */
.listingblock .pygments .tok-s1 { color: #BA2121 } /* Literal.String.Single */
.listingblock .pygments .tok-ss { color: #19177C } /* Literal.String.Symbol */
.listingblock .pygments .tok-bp { color: #008000 } /* Name.Builtin.Pseudo */
.listingblock .pygments .tok-vc { color: #19177C } /* Name.Variable.Class */
.listingblock .pygments .tok-vg { color: #19177C } /* Name.Variable.Global */
.listingblock .pygments .tok-vi { color: #19177C } /* Name.Variable.Instance */
.listingblock .pygments .tok-il { color: #666666 } /* Literal.Number.Integer.Long */
</style>
</head>
<body class="article toc2 toc-left">
<div id="header">
<h1>Grails</h1>
<div class="details">
<span id="author" class="author">Fran GarcÃ­a</span><br>
<span id="email" class="email">&lt;<a href="mailto:fgarciarico@gmail.com">fgarciarico@gmail.com</a>&gt;</span><br>
</div>
<div id="toc" class="toc2">
<div id="toctitle">Ãndice de contenidos</div>
<ul class="sectlevel1">
<li><a href="#sesion01">1. IntroducciÃ³n a Groovy</a>
<ul class="sectlevel2">
<li><a href="#__qu%C3%A9_es_groovy">1.1. Â¿QuÃ© es Groovy?</a></li>
<li><a href="#_instalaci%C3%B3n">1.2. InstalaciÃ³n</a></li>
<li><a href="#_hola_mundo">1.3. Hola Mundo</a></li>
<li><a href="#_caracter%C3%ADsticas">1.4. CaracterÃ­sticas</a></li>
<li><a href="#_tipos_de_datos_en_groovy">1.5. Tipos de datos en Groovy</a></li>
<li><a href="#_colecciones">1.6. Colecciones</a></li>
<li><a href="#_ejercicios">1.7. Ejercicios</a></li>
</ul>
</li>
<li><a href="#sesion02">2. Aspectos avanzados del Lenguaje Groovy. MetaprogramaciÃ³n.</a>
<ul class="sectlevel2">
<li><a href="#_closures">2.1. Closures</a></li>
<li><a href="#_groovy_como_lenguaje_orientado_a_objetos">2.2. Groovy como lenguaje orientado a objetos</a></li>
<li><a href="#_metaprogramaci%C3%B3n">2.3. MetaprogramaciÃ³n</a></li>
<li><a href="#_groovy_builders">2.4. Groovy Builders</a></li>
<li><a href="#_ejercicios_2">2.5. Ejercicios</a></li>
</ul>
</li>
<li><a href="#sesion03">3. IntroducciÃ³n a Grails. Scaffolding.</a>
<ul class="sectlevel2">
<li><a href="#__qu%C3%A9_es">3.1. Â¿QuÃ© es?</a></li>
<li><a href="#_caracter%C3%ADsticas_de_grails">3.2. CaracterÃ­sticas de Grails</a></li>
<li><a href="#_arquitectura">3.3. Arquitectura</a></li>
<li><a href="#_instalaci%C3%B3n_de_grails">3.4. InstalaciÃ³n de Grails</a></li>
<li><a href="#_scaffolding_2">3.5. Scaffolding</a></li>
<li><a href="#_ejercicios_3">3.6. Ejercicios</a></li>
</ul>
</li>
<li><a href="#sesion04">4. PatrÃ³n MVC: Vistas y controladores.</a>
<ul class="sectlevel2">
<li><a href="#_estructura_de_las_vistas_en_grails">4.1. Estructura de las vistas en Grails</a></li>
<li><a href="#_plantillas">4.2. Plantillas</a></li>
<li><a href="#_p%C3%A1ginas">4.3. PÃ¡ginas</a></li>
<li><a href="#_etiquetas">4.4. Etiquetas</a></li>
<li><a href="#_librer%C3%ADa_de_etiquetas">4.5. LibrerÃ­a de etiquetas</a></li>
<li><a href="#_controladores">4.6. Controladores</a></li>
<li><a href="#_filtros">4.7. Filtros</a></li>
<li><a href="#_ejercicios_4">4.8. Ejercicios</a></li>
</ul>
</li>
<li><a href="#sesion05">5. PatrÃ³n MVC: Dominios y servicios.</a>
<ul class="sectlevel2">
<li><a href="#_dominios">5.1. Dominios</a></li>
<li><a href="#_restricciones">5.2. Restricciones</a></li>
<li><a href="#_aspectos_avanzados_de_gorm">5.3. Aspectos avanzados de GORM</a></li>
<li><a href="#_interactuar_con_la_base_de_datos">5.4. Interactuar con la base de datos</a></li>
<li><a href="#_servicios">5.5. Servicios</a></li>
<li><a href="#_ejercicios_5">5.6. Ejercicios</a></li>
</ul>
</li>
<li><a href="#sesion06">6. Framework de test Spock.</a>
<ul class="sectlevel2">
<li><a href="#_introducci%C3%B3n_a_los_tests">6.1. IntroducciÃ³n a los tests</a></li>
<li><a href="#_framework_de_tests_spock">6.2. Framework de tests Spock</a></li>
<li><a href="#_spock_en_grails">6.3. Spock en Grails</a></li>
<li><a href="#_ejercicios_6">6.4. Ejercicios</a></li>
</ul>
</li>
<li><a href="#sesion07">7. Seguridad con Spring Security plugin.</a>
<ul class="sectlevel2">
<li><a href="#_instalaci%C3%B3n_del_plugin">7.1. InstalaciÃ³n del plugin</a></li>
<li><a href="#_configuraci%C3%B3n_del_plugin">7.2. ConfiguraciÃ³n del plugin</a></li>
<li><a href="#_clases_de_dominio">7.3. Clases de dominio</a></li>
<li><a href="#_asegurar_peticiones">7.4. Asegurar peticiones</a></li>
<li><a href="#_controladores_2">7.5. Controladores</a></li>
<li><a href="#_librer%C3%ADas_adicionales">7.6. LibrerÃ­as adicionales</a></li>
<li><a href="#_otros_aspectos_interesantes_de_spring_security">7.7. Otros aspectos interesantes de Spring Security</a></li>
<li><a href="#_ejercicios_7">7.8. Ejercicios</a></li>
</ul>
</li>
<li><a href="#sesion08">8. ConfiguraciÃ³n de aplicaciones. Plugins interesantes</a>
<ul class="sectlevel2">
<li><a href="#_configuraci%C3%B3n_de_aplicaciones">8.1. ConfiguraciÃ³n de aplicaciones</a></li>
<li><a href="#_empaquetamiento_de_aplicaciones">8.2. Empaquetamiento de aplicaciones</a></li>
<li><a href="#_otros_comandos_interesantes_de_grails">8.3. Otros comandos interesantes de Grails</a></li>
<li><a href="#_plugins_2">8.4. Plugins</a></li>
<li><a href="#_ejercicios_8">8.5. Ejercicios</a></li>
</ul>
</li>
</ul>
</div>
</div>
<div id="content">
<div id="preamble">
<div class="sectionbody">
<div style="page-break-after: always;"></div>
</div>
</div>
<div class="sect1">
<h2 id="sesion01">1. IntroducciÃ³n a Groovy</h2>
<div class="sectionbody">
<div class="paragraph">
<p>En esta primera sesiÃ³n del mÃ³dulo, empezaremos explicando quÃ© es el lenguaje de programaciÃ³n Groovy y, cÃ³mo, dÃ³nde y porquÃ© se creo para ponernos un poco en situaciÃ³n. Posteriormente, pasaremos a implementar nuestro primer ejemplo en Groovy, el tÃ­pico Hola Mundo y lo compararemos con lo que serÃ­a el mismo ejemplo en Java.</p>
</div>
<div class="paragraph">
<p>Seguidamente describiremos detalladamente algunos aspectos bÃ¡sicos de Groovy, tales como la sintaxis, los tipos de datos y el trabajo con colecciones.</p>
</div>
<div class="sect2">
<h3 id="__quÃ©_es_groovy">1.1. Â¿QuÃ© es Groovy?</h3>
<div class="paragraph">
<p>Groovy naciÃ³ con la intenciÃ³n de ser un lenguaje rico en caracterÃ­sticas tÃ­picas de lenguajes dinÃ¡micos, asÃ­ como para interactuar sin problemas en el entorno Java, para de esta forma, utilizar los beneficios de estos lenguajes dinÃ¡micos en una plataforma tan robusta como es Java y todo su entorno. Posiblemente, habrÃ¡ lenguajes que tengan mÃ¡s caracterÃ­sticas tÃ­picas de los lenguajes dinÃ¡micos que Groovy o que se integren mejor en la Plataforma Java, pero ninguno de estos, presenta una combinaciÃ³n de estos detalles (lenguaje dinÃ¡mico y entorno Java) tan eficiente como Groovy. Pero, <em>Â¿cÃ³mo podrÃ­amos definir exactamente Groovy?</em></p>
</div>
<div class="paragraph">
<p>Una buena definiciÃ³n de Groovy podrÃ­a ser la que se nos proporciona desde la propia pÃ¡gina web de Groovy (<a href="http://groovy.codehaus.org" class="bare">http://groovy.codehaus.org</a>):</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p><strong>DefiniciÃ³n</strong></p>
</div>
<div class="paragraph">
<p>Groovy es un lenguaje de programaciÃ³n Ã¡gil y dinÃ¡mico diseÃ±ado para la Plataforma Java con determinadas caracterÃ­sticas inspiradas en lenguajes como Python, Ruby o Smalltalk, poniÃ©ndolas a disposiciÃ³n de los programadores Java mediante una sintaxis tÃ­pica de Java. Groovy se integra sin ningÃºn problema con cualquier librerÃ­a Java y se compila directamente a cÃ³digo byte, con lo que Java y Groovy pueden convivir sin ningÃºn tipo de problemas.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>En ocasiones se tacha a Groovy de ser un lenguaje meramente de script, pero esto es un error, a pesar de que Groovy funciona realmente bien como lenguaje script. Groovy puede ser precompilado a Java bytecode, estar integrado en aplicaciones Java, construir robustas aplicaciones web e incluso ser la base de una aplicaciÃ³n completa por si solo.</p>
</div>
<div class="paragraph">
<p>Se puede afirmar rotundamente que Groovy estÃ¡ destinado a ser utilizado en la Plataforma Java, no en vano muchas partes de Groovy estÃ¡n desarrolladas en Java, asÃ­ que cuando decimos que <em>al programar en Groovy, estamos realmente programando en Java</em>, no estamos diciendo ninguna barbaridad. Todas las caracterÃ­sticas de Java estÃ¡n esperando a ser utilizadas en Groovy, incluido todo el conjunto de librerÃ­as de Java.</p>
</div>
<div class="sect3">
<h4 id="_integraciÃ³n_con_java">1.1.1. IntegraciÃ³n con Java</h4>
<div class="paragraph">
<p>Cuando hablamos de <em>integraciÃ³n con Java</em>, nos referimos a dos aspectos. Por un lado, de integraciÃ³n imperceptible, puesto que Groovy es simplemente una nueva forma de crear nuestras habituales clases Java. Al fin y al cabo, Groovy es Java con un archivo jar como dependencia. Por otro lado, la sintaxis de Groovy es mÃ¡s precisa y compacta que en Java y a pesar de eso, cualquier programador Java puede entender el funcionamiento de un fragmento de cÃ³digo escrito en Groovy.</p>
</div>
</div>
<div class="sect3">
<h4 id="__a_quiÃ©n_va_dirigido_groovy">1.1.2. Â¿A quiÃ©n va dirigido Groovy?</h4>
<div class="sect4">
<h5 id="_a_los_programadores_java">A los programadores Java</h5>
<div class="paragraph">
<p>Un programador Java con muchos aÃ±os de experiencia conocerÃ¡ todas las partes importantes del entorno Java y su API, asÃ­ como otros paquetes adicionales. Sin embargo, algo aparentemente tan sencillo como listar todos los archivos recursivamente que cuelgan de un directorio se hace demasiado pesado en Java y suponiendo que existiera la funciÃ³n <em>eachFileRecurse()</em> tendrÃ­amos algo similar a:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span class="tok-kd">public</span> <span class="tok-kd">class</span> <span class="tok-nc">ListFiles</span> <span class="tok-o">{</span>
	<span class="tok-kd">public</span> <span class="tok-kd">static</span> <span class="tok-kt">void</span> <span class="tok-nf">main</span><span class="tok-o">(</span><span class="tok-n">String</span><span class="tok-o">[]</span> <span class="tok-n">args</span><span class="tok-o">){</span>
		<span class="tok-k">new</span> <span class="tok-n">java</span><span class="tok-o">.</span><span class="tok-na">io</span><span class="tok-o">.</span><span class="tok-na">File</span><span class="tok-o">(</span><span class="tok-s">&quot;.&quot;</span><span class="tok-o">).</span><span class="tok-na">eachFileRecurse</span><span class="tok-o">(</span>
			<span class="tok-k">new</span> <span class="tok-nf">FileListener</span><span class="tok-o">()</span> <span class="tok-o">{</span>
				<span class="tok-kd">public</span> <span class="tok-kt">void</span> <span class="tok-nf">onFile</span> <span class="tok-o">(</span><span class="tok-n">File</span> <span class="tok-n">file</span><span class="tok-o">)</span> <span class="tok-o">{</span>
					<span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">out</span><span class="tok-o">.</span><span class="tok-na">println</span><span class="tok-o">(</span><span class="tok-n">file</span><span class="tok-o">.</span><span class="tok-na">toString</span><span class="tok-o">());</span>
				<span class="tok-o">}</span>
			<span class="tok-o">}</span>
		<span class="tok-o">);</span>
	<span class="tok-o">}</span>
<span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Mientras que con Groovy podrÃ­a quedar en una sola lÃ­nea que podrÃ­amos ejecutar incluso en lÃ­nea de comandos de la siguiente forma:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-n">groovy</span> <span class="tok-o">-</span><span class="tok-n">e</span> <span class="tok-s2">&quot;new File(&#39;.&#39;).eachFileRecurse { println it}&quot;</span></code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_a_los_programadores_de_scripts">A los programadores de scripts</h5>
<div class="paragraph">
<p>Groovy tambiÃ©n va dirigido a aquellos programadores que han pasado muchos aÃ±os trabajando con lenguajes de programaciÃ³n como Perl, Ruby, Python o PHP. En ocasiones, sobre todo en las grandes empresas, los clientes requieren obligatoriamente el uso de una Plataforma robusta como puede ser Java. Estos programadores deben reciclarse, ya que no es factible cualquier soluciÃ³n que pase por utilizar un lenguaje script como los mencionados anteriormente.</p>
</div>
<div class="paragraph">
<p>Continuamente este tipo de programadores afirman que se sienten frustrados por toda la verborrea que conlleva un lenguaje como Java y la frase <em>"con un lenguaje como Ruby, podrÃ­a escribir todo este mÃ©todo en una sola lÃ­nea"</em> es su pan de cada dÃ­a. Groovy puede darles lo que ellos piden y supone una vÃ­a de escape hacÃ­a adelante a este tipo de programadores.</p>
</div>
</div>
<div class="sect4">
<h5 id="_a_los_programadores_Ã¡giles_y_extremos">A los programadores Ã¡giles y extremos</h5>
<div class="paragraph">
<p>Este tipo de programadores estÃ¡n acostumbrados a trabajar con la prÃ³xima revisiÃ³n tan cercana, que pararse a pensar en utilizar un nuevo lenguaje de programaciÃ³n queda fuera de sus principales objetivos. Sin embargo, una de los aspectos mÃ¡s importantes para los programadores Ã¡giles, consiste en tener siempre a su disposiciÃ³n los mejores recursos y metodologÃ­as para llevar a cabo su trabajo.</p>
</div>
<div class="paragraph">
<p>Y ahÃ­ es donde Groovy les puede aportar mucho, ya que Groovy es un lenguaje perfecto para realizar esas tareas de automatizaciÃ³n tan habituales en sus proyectos. Estas tareas van desde la integraciÃ³n continua o la puesta en prÃ¡ctica de teorÃ­as como TDD (Test Driven Development).</p>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_instalaciÃ³n">1.2. InstalaciÃ³n</h3>
<div class="paragraph">
<p>Antes de avanzar en la sesiÃ³n, vamos a ver como se realizarÃ­a la instalaciÃ³n de Groovy en nuestro ordenador. Aunque podrÃ­amos descargarnos la Ãºltima versiÃ³n de Groovy desde la web oficial <a href="http://groovy.codehaus.org/Download" class="bare">http://groovy.codehaus.org/Download</a>, nosotros vamos a utilizar un gestor de paquetes conocido como <em>sdkman (<a href="http://sdkman.io" class="bare">http://sdkman.io</a>)</em> (antes conocido como <em>gvmtool</em> que nos permitirÃ¡ gestionar varias versiones de Groovy en una misma mÃ¡quina de forma muy sencilla. AdemÃ¡s, esta misma herramienta nos servirÃ¡ para instalar y gestionar Grails, entre otras interesantes librerÃ­as como Gradle o Vert.x.</p>
</div>
<div class="paragraph">
<p>Para instalar <em>sdkman</em> y <em>groovy</em> simplemente debemos en lÃ­nea de comandos:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="bash">curl -s get.sdkman.io <span class="tok-p">|</span> bash

<span class="tok-nb">source</span> <span class="tok-s2">&quot;$HOME/.sdkman/bin/sdkman-init.sh&quot;</span>

sdk list groovy

sdk install groovy 2.4.5</code></pre>
</div>
</div>
<div class="paragraph">
<p>Si necesitaramos alternar entre varias versiones de Groovy, simplemente deberÃ­as ejecutar:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="bash">sdk use groovy 1.8.0</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_hola_mundo">1.3. Hola Mundo</h3>
<div class="paragraph">
<p>Ahora que ya tenemos una primera idea de lo que es Groovy, vamos a pasar a desarrollar nuestro primer ejemplo y a realizar nuestras primeras pruebas de ejecuciÃ³n y compilaciÃ³n de archivos Groovy. Pero antes de eso, vamos a introducir las diferentes formas de ejecutar nuestros programas en Groovy.</p>
</div>
<div class="paragraph">
<p>Tras la instalaciÃ³n de Groovy con la herramienta <em>sdk</em>, vamos a disponer de tres comandos que son <em>groovysh</em>, <em>groovyConsole</em> y <em>groovy</em>, entre otros. Podemos utilizar cualquiera de estos tres archivos para empezar a realizar nuestras pruebas con cÃ³digo Groovy. Vamos a verlos uno a uno:</p>
</div>
<div class="sect3">
<h4 id="_groovysh">1.3.1. groovysh</h4>
<div class="paragraph">
<p>Permite ejecutar en lÃ­nea de comandos cÃ³digo Groovy de forma interactiva. MÃ¡s informaciÃ³n en <a href="http://groovy.codehaus.org/Groovy+Shell" class="bare">http://groovy.codehaus.org/Groovy+Shell</a>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="bash">groovy:000&gt; <span class="tok-s2">&quot;Hola Mundo!&quot;</span>

<span class="tok-o">====</span> &gt; Hola Mundo!</code></pre>
</div>
</div>
<div class="paragraph">
<p>Otro ejemplo podrÃ­a ser:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="bash">groovy:000&gt; <span class="tok-nv">saludo</span> <span class="tok-o">=</span> <span class="tok-s2">&quot;Hola&quot;</span>
<span class="tok-o">===</span>&gt; Hola
groovy:000&gt; <span class="tok-s2">&quot;${saludo} Mundo!&quot;</span>

<span class="tok-o">===</span>&gt; Hola Mundo!</code></pre>
</div>
</div>
<div class="paragraph">
<p>E incluso podemos definir funciones con parÃ¡metros:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="bash">groovy:000&gt; def hola<span class="tok-o">(</span>nombre<span class="tok-o">){</span>
groovy:001&gt; println <span class="tok-s2">&quot;Hola $nombre&quot;</span>
groovy:002&gt; <span class="tok-o">}</span>
<span class="tok-o">===</span>&gt; <span class="tok-nb">true</span>
groovy:000&gt; hola<span class="tok-o">(</span><span class="tok-s2">&quot;Fran&quot;</span><span class="tok-o">)</span>
Hola <span class="tok-nv">Fran</span>
<span class="tok-o">====</span> &gt; null</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_groovyconsole">1.3.2. groovyConsole</h4>
<div class="paragraph">
<p>Mediante una interfaz Swing, groovyConsole actua como intÃ©rprete de comandos Groovy. Tiene la posibilidad de cargar y salvar ficheros desde su menÃº File. MÃ¡s informaciÃ³n en <a href="http://groovy.codehaus.org/Groovy+Console" class="bare">http://groovy.codehaus.org/Groovy+Console</a></p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="images/grails01/groovyConsole.jpg" alt="Groovy Console" width="50%">
</div>
</div>
<div class="paragraph">
<p>Como podemos observar, en la parte superior podemos escribir nuestro cÃ³digo Groovy, mientras que la parte inferior nos muestra la salida del programa ejecutado.</p>
</div>
<div class="paragraph">
<p>AdemÃ¡s la groovyConsole nos permite tambiÃ©n indicarle archivos jar externos que serÃ¡n importados automÃ¡ticamente en el cÃ³digo de nuestros scripts.</p>
</div>
</div>
<div class="sect3">
<h4 id="_groovy">1.3.3. groovy</h4>
<div class="paragraph">
<p>El Ãºltimo mÃ©todo sirve para ejecutar archivos groovy y simplemente ejecutando en la lÃ­nea de comandos <em>groovy holamundo.groovy</em>, podemos ver la salida producida por el programa. En la siguiente imagen, puedes comprobar el funcionamiento de este mÃ©todo con un fichero de ejemplo que realiza el cÃ¡lculo de la sucesiÃ³n de Fibonacci.</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="images/grails01/groovy.jpg" alt="Groovy command" width="50%">
</div>
</div>
<div class="paragraph">
<p>QuizÃ¡s ya te hayas dado cuenta, pero a diferencia de en Java, Groovy puede ejecutar sus archivos sin necesidad de compilarlos previamente. Esta forma de utilizar Groovy se llama <strong>Modo directo</strong> y nuestro cÃ³digo es ejecutado sin necesidad de generar archivos ejecutables. Se puede decir que nuestros archivos son interpretados. Sin embargo, existe otra forma de ejecutar nuestros programas Groovy y se llama <strong>Modo precompilado</strong>. En el modo precompilado, en primer lugar se compila el programa groovy y posteriormente se ejecuta. El programa compilado es compatible con los archivos bytecode de Java.</p>
</div>
<div class="paragraph">
<p>Para compilar nuestros programas Groovy, utilizamos una sentencia en lÃ­nea de comandos llamada <strong>groovyc</strong> (tambiÃ©n disponible tras la instalaciÃ³n de Groovy). Si quisieramos compilar el anterior ejemplo (<em>fibonacci.groovy</em>), ejecutarÃ­amos <em>groovyc -d classes fibonacci.groovy</em>. Con el parÃ¡metro -d le hemos indicado que nos genere los archivos compilados en el directorio <em>classes</em>, y en el caso de que no existiera, lo crearÃ­a. Si observamos el contenido de este directorio, veremos que hay un par de ficheros .class. El nÃºmero de archivos dependerÃ¡ del propio script, de la misma forma que sucede cuando compilamos archivo en Java.</p>
</div>
<div class="paragraph">
<p>Una vez ya tenemos nuestro programa compilado, vamos a ver como podrÃ­amos ejecutarlo con Java. !SÃ­, con Java!, ya que para ejecutar un programa en Groovy debemos hacer exactamente lo mismo que hacemos en Java. Simplemente, debemos aÃ±adir al classpath el archivo jar de Groovy. Debemos hacer lo mismo con el directorio donde residen nuestros archivos compilados. QuedarÃ­a algo asÃ­:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="bash">java -cp <span class="tok-nv">$GROOVY_HOME</span>/embeddable/groovy-all-2.4.0.jar:classes fibonacci</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_caracterÃ­sticas">1.4. CaracterÃ­sticas</h3>
<div class="paragraph">
<p>En la siguiente secciÃ³n, vamos a introducir diferentes aspectos bÃ¡sicos del lenguaje Groovy, tales como la introducciÃ³n de comentarios, diferencias y similitudes con Java, la brevedad del cÃ³digo en Groovy y otros pequeÃ±os detalles del lenguaje.</p>
</div>
<div class="sect3">
<h4 id="_comentarios">1.4.1. Comentarios</h4>
<div class="paragraph">
<p>Los comentarios en Groovy siguen el mismo formato que en Java. Esto es:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>//, comentarios de una lÃ­nea</p>
</li>
<li>
<p>/* &#8230;&#8203;. */, comentarios multilÃ­nea</p>
</li>
<li>
<p>/** &#8230;&#8203;. */, comentarios del estilo Javadoc, que nos permitirÃ¡ documentar nuestros programas con <em>Groovydoc</em></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Sin embargo, tambiÃ©n podemos introducir en la primera lÃ­nea comentarios del estilo shebang con la combinaciÃ³n de caracteres <strong>#!</strong></p>
</div>
</div>
<div class="sect3">
<h4 id="_comparando_la_sintaxis_de_java_y_groovy">1.4.2. Comparando la sintaxis de Java y Groovy</h4>
<div class="paragraph">
<p>Es habitual leer que la sintaxis de Groovy es una superclase de Java y esto es debido a las grandes similitudes que hay entre ambos lenguajes. Sin embargo, no es correcto afirmar que un lenguaje es una superclase del otro. Existen pequeÃ±os detalles de programaciÃ³n en Java que no existen en Groovy, como puede ser que el operador <em>==</em> que en Groovy tiene unas connotaciones diferentes.</p>
</div>
<div class="paragraph">
<p>Pero aparte de algunas pequeÃ±as diferencias, podemos decir que gran parte de la sintaxis de Java es vÃ¡lida en Groovy. Estas similitudes son:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Mecanismo de paquetes</p>
</li>
<li>
<p>Sentencias</p>
</li>
<li>
<p>DefiniciÃ³n de clases y mÃ©todos</p>
</li>
<li>
<p>Estructuras de control</p>
</li>
<li>
<p>Operadores, asignaciones y expresiones</p>
</li>
<li>
<p>Manejo de excepciones</p>
</li>
<li>
<p>DeclaraciÃ³n de literales</p>
</li>
<li>
<p>InstanciaciÃ³n de objetos y llamadas a mÃ©todos</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>No obstante, Groovy posee un valor aÃ±adido gracias a:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>FÃ¡cil acceso a los objetos Java a travÃ©s de nuevas expresiones y operadores</p>
</li>
<li>
<p>Nuevas formas de declarar objetos</p>
</li>
<li>
<p>Nuevas estructuras de control</p>
</li>
<li>
<p>Nuevos tipos de datos con sus correspondientes operadores y expresiones</p>
</li>
<li>
<p>Todo se gestiona como un objeto</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Estas nuevas caracterÃ­sticas hacen que Groovy sea un lenguaje fÃ¡cil de leer y de entender.</p>
</div>
</div>
<div class="sect3">
<h4 id="_brevedad_del_lenguaje">1.4.3. Brevedad del lenguaje</h4>
<div class="paragraph">
<p>Groovy pretende evitar en todo momento toda la ceremonia que acompaÃ±a a Java en sus programas y nos permite obviar determinados aspectos obligatorios y centrarnos en nuestro objetivo. Para empezar, se elimina la obligatoriedad de utilizar los puntos y comas (;) al finalizar cada lÃ­nea. Si lo pensamos un poco es lÃ³gico, porque Â¿cuÃ¡ntos de nosotros escribimos mÃ¡s de una sentencia en la misma lÃ­nea del cÃ³digo fuente?. Esto no quiere decir que en Groovy no podamos escribir puntos y coma al final de cada lÃ­nea, simplemente no es obligatorio.</p>
</div>
<div class="paragraph">
<p>AdemÃ¡s, tambiÃ©n se elimina la obligatoriedad de utilizar parÃ©ntesis al pasar parÃ¡metros en la llamada a funciones.</p>
</div>
<div class="paragraph">
<p>Otro ejemplo de la brevedad del lenguaje que aporta Groovy es el siguiente ejemplo. Mientras que en Java tendrÃ­amos lo siguiente:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span class="tok-n">java</span><span class="tok-o">.</span><span class="tok-na">net</span><span class="tok-o">.</span><span class="tok-na">URLEncoder</span><span class="tok-o">.</span><span class="tok-na">encode</span> <span class="tok-o">(</span><span class="tok-s">&quot;a b&quot;</span><span class="tok-o">);</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>en Groovy tendrÃ­amos</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-n">URLEncoder</span><span class="tok-o">.</span><span class="tok-na">encode</span> <span class="tok-s1">&#39;a b&#39;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Esto no sÃ³lo significa que el cÃ³digo en Groovy va a ser mÃ¡s corto, sino tambiÃ©n mÃ¡s expresivo evitando toda la parafernalia que acompaÃ±a a Java en determinadas ocasiones.</p>
</div>
<div class="paragraph">
<p>Groovy ademÃ¡s importa automÃ¡ticamente los paquetes <em>groovy.lang.*</em>, <em>groovy.util.*</em>, <em>java.lang.*</em>, <em>java.util.*</em>, <em>java.net.*</em> y <em>java.io.*</em>, asÃ­ como las clases <em>java.Math.BigInteger</em> y <em>java.Math.BigDecimal</em>, asÃ­ que siempre vas a poder utilizar todas sus clases sin necesidad de que sean importados sus paquetes al inicio del programa. Esto tambiÃ©n es diferente a Java, donde sÃ³lo se importa automÃ¡ticamente el paquete <em>java.lang.*</em>.</p>
</div>
<div class="paragraph">
<p>Resumiendo. Groovy nos permite olvidarnos de los parÃ©ntesis, la declaraciÃ³n de paquetes, puntos y comas y centrarnos en la funcionalidad de nuestros programas y mÃ©todos.</p>
</div>
</div>
<div class="sect3">
<h4 id="_aserciones">1.4.4. Aserciones</h4>
<div class="paragraph">
<p>Las aserciones permiten desde Java 1.4 comprobar si nuestro programa funciona como deberÃ­a funcionar y Groovy no iba a ser menos, asÃ­ que tambiÃ©n las incluye. Las aserciones se insertan en medio de nuestro cÃ³digo y se utilizan, por ejemplo, para comprobar posibles incongruencias en las variables pasadas a un mÃ©todo. Fundamentalmente las aserciones se utilizarÃ¡n en los tests que desarrollemos para nuestra aplicaciÃ³n y que asegurarÃ¡n que las cosas funcionan correctamente. Algunos ejemplos de aserciones serÃ­an:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-k">assert</span><span class="tok-o">(</span><span class="tok-kc">true</span><span class="tok-o">)</span>
<span class="tok-k">assert</span> <span class="tok-mi">1</span> <span class="tok-o">==</span> <span class="tok-mi">1</span>
<span class="tok-kt">def</span> <span class="tok-n">x</span> <span class="tok-o">=</span> <span class="tok-mi">1</span>
<span class="tok-k">assert</span> <span class="tok-n">x</span> <span class="tok-o">==</span> <span class="tok-mi">1</span>
<span class="tok-kt">def</span> <span class="tok-n">y</span> <span class="tok-o">=</span> <span class="tok-mi">1</span><span class="tok-o">;</span> <span class="tok-k">assert</span> <span class="tok-n">y</span> <span class="tok-o">==</span> <span class="tok-mi">1</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Como se puede comprobar en los ejemplos las aserciones pueden tomar expresiones completas y no Ãºnicamente variables, como en el ejemplo <em>assert 1 == 1</em>. AdemÃ¡s las aserciones no sÃ³lo nos servirÃ¡n para comprobar el estado de nuestro programa, sino que tambiÃ©n podremos reemplazar determinados comentarios por aserciones, que ademÃ¡s de clarificar el cÃ³digo fuente de nuestro programa, nos sirve tambiÃ©n para pasar pequeÃ±as pruebas a nuestro cÃ³digo.</p>
</div>
<div class="paragraph">
<p>Cuando usamos aserciones, es una buena prÃ¡ctica incluir un mensaje que nos clarifique el error que se ha producido. Esto lo podemos hacer aÃ±adiendo despuÃ©s de la aserciÃ³n el mensaje de texto que queremos precedido de <em>:</em>, como en el siguiente ejemplo:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-k">assert</span> <span class="tok-mi">1</span><span class="tok-o">==</span><span class="tok-mi">2</span> <span class="tok-o">:</span> <span class="tok-s2">&quot;Desde cuando 1 es igual a 2&quot;</span>
<span class="tok-c1">//Obteniendo el siguiente mensaje</span>
<span class="tok-c1">//Exception thrown: Desde cuando 1 es igual a 2. Expression: (1 == 2)</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>AdemÃ¡s, en las Ãºltimas versiones de Groovy se ha mejorado el sistema de mensajes mostrados cuando fallan las aserciones fallan. Si por ejemplo, ejecutamos el siguiente fragmento de cÃ³digo:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-k">assert</span> <span class="tok-k">new</span> <span class="tok-nf">File</span><span class="tok-o">(</span><span class="tok-s1">&#39;foo.bar&#39;</span><span class="tok-o">)</span> <span class="tok-o">==</span> <span class="tok-k">new</span> <span class="tok-n">File</span><span class="tok-o">(</span><span class="tok-s1">&#39;example.txt&#39;</span><span class="tok-o">)</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Groovy nos mostrarÃ­a el siguiente mensaje de error</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-n">Exception</span> <span class="tok-n">thrown</span>

<span class="tok-n">Assertion</span> <span class="tok-nl">failed:</span>

<span class="tok-k">assert</span> <span class="tok-k">new</span> <span class="tok-nf">File</span><span class="tok-o">(</span><span class="tok-s1">&#39;foo.bar&#39;</span><span class="tok-o">)</span> <span class="tok-o">==</span> <span class="tok-k">new</span> <span class="tok-n">File</span><span class="tok-o">(</span><span class="tok-s1">&#39;example.txt&#39;</span><span class="tok-o">)</span>
       <span class="tok-o">|</span>                   <span class="tok-o">|</span>  <span class="tok-o">|</span>
       <span class="tok-n">foo</span><span class="tok-o">.</span><span class="tok-na">bar</span>             <span class="tok-o">|</span>  <span class="tok-n">example</span><span class="tok-o">.</span><span class="tok-na">txt</span>
                           <span class="tok-kc">false</span></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_un_primer_vistazo_al_cÃ³digo_en_groovy">1.4.5. Un primer vistazo al cÃ³digo en Groovy</h4>
<div class="paragraph">
<p>Antes de comenzar a ver las principales caracterÃ­sticas de Groovy, podÃ©is encontrar toda la documentaciÃ³n de sus clases y librerÃ­as en la direcciÃ³n <a href="http://groovy.codehaus.org/gapi" class="bare">http://groovy.codehaus.org/gapi</a>.</p>
</div>
<div class="sect4">
<h5 id="_declaraciÃ³n_de_clases">DeclaraciÃ³n de clases</h5>
<div class="paragraph">
<p>Las clases son la clave de cualquier lenguaje orientado a objetos y Groovy no iba a ser menos. El siguiente fragmento consiste en la declaraciÃ³n de la clase <em>Libro</em>, con una sola propiedad <em>Titulo</em>, el constructor de la clase y un mÃ©todo <em>getter</em> para obtener el tÃ­tulo del libro.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-kd">class</span> <span class="tok-nc">Libro</span> <span class="tok-o">{</span>
	<span class="tok-kd">private</span> <span class="tok-n">String</span> <span class="tok-n">titulo</span>

	<span class="tok-nf">Libro</span> <span class="tok-o">(</span><span class="tok-n">String</span> <span class="tok-n">elTitulo</span><span class="tok-o">){</span>
		<span class="tok-n">titulo</span> <span class="tok-o">=</span> <span class="tok-n">elTitulo</span>
	<span class="tok-o">}</span>
	<span class="tok-n">String</span> <span class="tok-nf">getTitulo</span><span class="tok-o">(){</span>
		<span class="tok-k">return</span> <span class="tok-n">titulo</span>
	<span class="tok-o">}</span>
<span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Se puede comprobar como el cÃ³digo es bastante similar a Java. Sin embargo, no hay la necesidad de emplear modificadores de acceso a los mÃ©todos, ya que por defecto siempre serÃ¡n pÃºblicos.</p>
</div>
</div>
<div class="sect4">
<h5 id="_scripts_en_groovy">Scripts en Groovy</h5>
<div class="paragraph">
<p>Los scripts en Groovy son archivos de texto plano con extensiÃ³n <em>.groovy</em> y que pueden ser ejecutados, tal y como comentÃ¡bamos en una secciÃ³n anterior mediante el comando <em>groovy miarchivo.groovy</em>. A diferencia de en Java, en Groovy no necesitamos compilar nuestros scripts, ya que son precompilados por nosotros al mismo tiempo que lo ejecutamos, asÃ­ que a simple vista, es como si pudiÃ©ramos ejecutar un archivo groovy.</p>
</div>
<div class="paragraph">
<p>En Groovy podemos tener sentencias fuera de la definiciÃ³n de las clases e incluso podemos aÃ±adir mÃ©todos a nuestros scripts que tambiÃ©n queden fuera de las definiciones de nuestras clases, si con ello conseguimos clarificar nuestro cÃ³digo, con lo que el mÃ©todo <em>main()</em> tÃ­pico de Java, no es necesario en Groovy y sÃ³lo lo necesitaremos en el caso de que nuestro script necesite parÃ¡metros pasados en lÃ­nea de comandos. Veamos un ejemplo:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-n">Libro</span> <span class="tok-n">cgg</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">Libro</span><span class="tok-o">(</span><span class="tok-s1">&#39;Curso GroovyGrails&#39;</span><span class="tok-o">)</span>

<span class="tok-k">assert</span> <span class="tok-n">cgg</span><span class="tok-o">.</span><span class="tok-na">getTitulo</span><span class="tok-o">()</span> <span class="tok-o">==</span> <span class="tok-s1">&#39;Curso GroovyGrails&#39;</span>
<span class="tok-k">assert</span> <span class="tok-nf">getTituloAlReves</span><span class="tok-o">(</span><span class="tok-n">cgg</span><span class="tok-o">)</span> <span class="tok-o">==</span> <span class="tok-s1">&#39;sliarGyvoorG osruC&#39;</span>

<span class="tok-n">String</span> <span class="tok-nf">getTituloAlReves</span><span class="tok-o">(</span><span class="tok-n">libro</span><span class="tok-o">)</span> <span class="tok-o">{</span>
	<span class="tok-n">titulo</span> <span class="tok-o">=</span> <span class="tok-n">libro</span><span class="tok-o">.</span><span class="tok-na">getTitulo</span><span class="tok-o">()</span>
	<span class="tok-k">return</span> <span class="tok-n">titulo</span><span class="tok-o">.</span><span class="tok-na">reverse</span><span class="tok-o">()</span>
<span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Podemos comprobar que llamamos al mÃ©todo <em>getTituloAlReves()</em> incluso antes de que Ã©ste sea declarado. Otro aspecto importante es que no necesitamos compilar nuestra clase <em>Libro</em>, ya que Groovy lo hace por nosotros. El Ãºnico requisito es que la clase Libro se encuentre en el <em>CLASSPATH</em>.</p>
</div>
</div>
<div class="sect4">
<h5 id="_groovybeans">GroovyBeans</h5>
<div class="paragraph">
<p>Fundamentalmente los JavaBeans son clases que definen propiedades. Por ejemplo, en nuestro ejemplo de la clase Libro, sus propiedades serÃ­an el tÃ­tulo, el autor, la editorial, etc. Estos JavaBeans tienen mÃ©todos para obtener los valores de estas propiedades (getters) y modificarlas (setters). Estos mÃ©todos deben ser definidos en cada JavaBean, con lo que esta tarea se vuelve algo repetitiva.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span class="tok-kd">class</span> <span class="tok-nc">Libro</span><span class="tok-o">{</span>
	<span class="tok-n">String</span> <span class="tok-n">titulo</span><span class="tok-o">;</span>

	<span class="tok-n">String</span> <span class="tok-nf">getTitulo</span><span class="tok-o">(){</span>
		<span class="tok-k">return</span> <span class="tok-k">this</span><span class="tok-o">.</span><span class="tok-na">titulo</span>
	<span class="tok-o">}</span>

	<span class="tok-kt">void</span> <span class="tok-nf">setTitulo</span><span class="tok-o">(</span><span class="tok-n">String</span> <span class="tok-n">str</span><span class="tok-o">){</span>
		<span class="tok-k">this</span><span class="tok-o">.</span><span class="tok-na">titulo</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-nf">String</span><span class="tok-o">(</span><span class="tok-n">str</span><span class="tok-o">)</span>
	<span class="tok-o">}</span>
<span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Sin embargo, Groovy gestiona esta definiciÃ³n de los mÃ©todos <em>get()</em> y <em>set()</em> por nosotros, con lo que ya no debemos preocuparnos. Con esto, el cÃ³digo anterior, en Groovy quedarÃ­a asÃ­:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-kd">class</span> <span class="tok-nc">Libro</span><span class="tok-o">{</span>
	<span class="tok-n">String</span> <span class="tok-n">titulo</span>
<span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>AdemÃ¡s, tenemos la gran ventaja de que podemos sobreescribir estos mÃ©todos en el caso de que queramos modificar su comportamiento bÃ¡sico.</p>
</div>
<div class="paragraph">
<p>En realidad, lo que hace Groovy es tratar de entender el comportamiento de las propiedades de un bean a partir de como estÃ¡n definidas. Con esto tenemos los siguientes casos:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Si una propiedad de una clase es declarada sin ningÃºn modificador, se genera un campo privado con sus correspondientes mÃ©todos pÃºblicos <em>getter()</em> y <em>setter()</em></p>
</li>
<li>
<p>Si una propiedad de una clase es declarada como final, dicha propiedad serÃ¡ privada y se definirÃ¡ tambiÃ©n su <em>getter()</em>, pero no su <em>setter()</em></p>
</li>
<li>
<p>Si necesitamos una propiedad de tipo privado o protegida debemos declarar sus mÃ©todos <em>getter()</em> y <em>setter()</em> de forma privada o protegida</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="_todo_son_objetos">Todo son objetos</h5>
<div class="paragraph">
<p>En Groovy, a diferencia que en Java, los nÃºmeros son tratados como objetos y no como tipos primitivos. En Java no podemos utilizar mÃ©todos de la clase Integer si el entero es de tipo primitivo y tampoco podemos hacer <em>y*2</em> si la variable <em>y</em> es un objeto. Esto tambiÃ©n es diferente en Groovy, ya que podemos utilizar operadores y mÃ©todos indiferentemente.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-kt">def</span> <span class="tok-n">x</span> <span class="tok-o">=</span> <span class="tok-mi">1</span>
<span class="tok-kt">def</span> <span class="tok-n">y</span> <span class="tok-o">=</span> <span class="tok-mi">2</span>
<span class="tok-k">assert</span> <span class="tok-n">x</span> <span class="tok-o">+</span> <span class="tok-n">y</span> <span class="tok-o">==</span> <span class="tok-mi">3</span>
<span class="tok-k">assert</span> <span class="tok-n">x</span><span class="tok-o">.</span><span class="tok-na">plus</span><span class="tok-o">(</span><span class="tok-n">y</span><span class="tok-o">)</span> <span class="tok-o">==</span> <span class="tok-mi">3</span>
<span class="tok-k">assert</span> <span class="tok-n">x</span> <span class="tok-k">instanceof</span> <span class="tok-n">Integer</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>En el ejemplo anterior se puede observar que hemos podido utilizar el operador + de los tipos primitivos y el mÃ©todo plus() de la clase Integer.</p>
</div>
<div class="paragraph">
<p>En realidad, en Groovy, todo es un objeto, con lo que aunque declaremos variables como tipos de datos primitivos en realidad Groovy los convierte a tipo de dato referencia, tal y como puedes ver en los siguientes ejemplos:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-kt">double</span> <span class="tok-n">d</span> <span class="tok-o">=</span> <span class="tok-mf">10.23</span>
<span class="tok-k">assert</span> <span class="tok-n">d</span> <span class="tok-k">instanceof</span> <span class="tok-n">Double</span>
<span class="tok-kt">char</span> <span class="tok-n">a</span> <span class="tok-o">=</span> <span class="tok-s1">&#39;a&#39;</span>
<span class="tok-k">assert</span> <span class="tok-n">a</span> <span class="tok-k">instanceof</span> <span class="tok-n">Character</span></code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_operador">Operador ==</h5>
<div class="paragraph">
<p>Es importante comentar tambiÃ©n que en Groovy el operador <em>==</em> tiene una connotaciÃ³n diferente a la que tiene en Java. En Java, este operador significa igualdad en variables primitivas mientras que en objetos significa objetos idÃ©nticos. En Groovy, el significado de este operador es el mismo que la funciÃ³n <em>equals()</em>. Si necesitamos comprobar la identidad de dos variables siempre podremos utilizar el mÃ©todo <em>is()</em> tal y como vemos en el siguiente ejemplo:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-k">if</span> <span class="tok-o">(</span><span class="tok-n">foo</span><span class="tok-o">.</span><span class="tok-na">is</span><span class="tok-o">(</span><span class="tok-n">bar</span><span class="tok-o">))</span>
	<span class="tok-n">println</span> <span class="tok-s2">&quot;foo y bar son el mismo objeto&quot;</span></code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_la_verdad_en_groovy">La verdad en Groovy</h5>
<div class="paragraph">
<p>Cabe aquÃ­ comentar lo que se conoce como <em>la verdad en Groovy</em> que es un tÃ©rmino que se refiere a que se considera como cierto en Groovy y que no. Veamos algunos ejemplos:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-kt">def</span> <span class="tok-n">a</span> <span class="tok-o">=</span> <span class="tok-kc">true</span>
<span class="tok-kt">def</span> <span class="tok-n">b</span> <span class="tok-o">=</span> <span class="tok-kc">true</span>
<span class="tok-kt">def</span> <span class="tok-n">c</span> <span class="tok-o">=</span> <span class="tok-kc">false</span>
<span class="tok-k">assert</span> <span class="tok-n">a</span>
<span class="tok-k">assert</span> <span class="tok-n">a</span> <span class="tok-o">&amp;&amp;</span> <span class="tok-n">b</span>
<span class="tok-k">assert</span> <span class="tok-n">a</span> <span class="tok-o">||</span> <span class="tok-n">c</span>
<span class="tok-k">assert</span> <span class="tok-o">!</span><span class="tok-n">c</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Hasta aquÃ­ ninguna novedad, pero Â¿quÃ© pasa si no estamos evaluando directamente un <em>booleano</em>?. Pues que Groovy aÃ±ade una serie de reglas para indicar si esa expresiÃ³n es cierta o no. Por ejemplo, en las colecciones (listas y mapas) se entenderÃ¡ que una variable de estos tipos serÃ¡ cierta cuando contenga al menos un elemento.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-kt">def</span> <span class="tok-n">numeros</span> <span class="tok-o">=</span> <span class="tok-o">[</span><span class="tok-mi">1</span><span class="tok-o">,</span><span class="tok-mi">2</span><span class="tok-o">,</span><span class="tok-mi">3</span><span class="tok-o">]</span>
<span class="tok-k">assert</span> <span class="tok-n">numeros</span> <span class="tok-c1">//cierto, ya que numeros no estÃ¡ vacÃ­a</span>
<span class="tok-n">numeros</span> <span class="tok-o">=</span> <span class="tok-o">[]</span> <span class="tok-c1">//vacÃ­amos la lista</span>
<span class="tok-k">assert</span> <span class="tok-o">!</span><span class="tok-n">numeros</span> <span class="tok-c1">//cierto, ya que ahora la lista estÃ¡ vacÃ­a</span>

<span class="tok-k">assert</span> <span class="tok-o">[</span><span class="tok-s1">&#39;one&#39;</span><span class="tok-o">:</span><span class="tok-mi">1</span><span class="tok-o">]</span> <span class="tok-c1">//este mapa contiene un elemento con lo que se evalÃºa a cierto</span>
<span class="tok-k">assert</span> <span class="tok-o">![:]</span> <span class="tok-c1">//este mapa estÃ¡ vacÃ­o</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>En lo que a las cadenas de texto se refiere, siempre que Ã©stas no sean la cadena vacÃ­a, se evaluarÃ¡n a cierto.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-c1">// Strings</span>
<span class="tok-k">assert</span> <span class="tok-s1">&#39;Esto es cierto&#39;</span>
<span class="tok-k">assert</span> <span class="tok-o">!</span><span class="tok-s1">&#39;&#39;</span>
<span class="tok-c1">//GStrings</span>
<span class="tok-kt">def</span> <span class="tok-n">s</span> <span class="tok-o">=</span> <span class="tok-s1">&#39;&#39;</span>
<span class="tok-k">assert</span> <span class="tok-o">!(</span><span class="tok-s2">&quot;$s&quot;</span><span class="tok-o">)</span>
<span class="tok-n">s</span> <span class="tok-o">=</span> <span class="tok-s1">&#39;x&#39;</span>
<span class="tok-k">assert</span> <span class="tok-o">(</span><span class="tok-s2">&quot;$s&quot;</span><span class="tok-o">)</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Si evalÃºamos un nÃºmero, siempre que Ã©ste no sea cero se evaluarÃ¡ a cierto.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-k">assert</span> <span class="tok-o">!</span><span class="tok-mi">0</span>
<span class="tok-k">assert</span> <span class="tok-mi">1</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Por Ãºltimo, siempre que un objeto no sea <em>null</em> Ã©ste se evaluarÃ¡ a cierto.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-k">assert</span> <span class="tok-k">new</span> <span class="tok-nf">Object</span><span class="tok-o">()</span>
<span class="tok-k">assert</span> <span class="tok-o">!</span><span class="tok-kc">null</span></code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_estructuras_de_control_en_groovy">Estructuras de control en Groovy</h5>
<div class="paragraph">
<p>Algunas estructuras de control en Groovy son tratadas de la misma forma que en Java. Estos bloques son <em>if-else</em>, <em>while</em>, <em>switch</em> y <em>try-catch-finally</em>, aunque es conveniente hacer algunas anotaciones. En los condicionales, <em>null</em> es tratado como <em>false</em>, mientras que <em>!null</em> serÃ¡ <em>true</em>.</p>
</div>
<div class="paragraph">
<p>Con respecto a la sentencia <em>if</em>, Groovy soporta la sentencia de forma anidada.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-k">if</span> <span class="tok-o">(</span> <span class="tok-o">...</span> <span class="tok-o">)</span> <span class="tok-o">{</span>
<span class="tok-o">...</span>
<span class="tok-o">}</span> <span class="tok-k">else</span> <span class="tok-k">if</span> <span class="tok-o">(...)</span> <span class="tok-o">{</span>
<span class="tok-o">...</span>
<span class="tok-o">}</span> <span class="tok-k">else</span> <span class="tok-o">{</span>
<span class="tok-o">...</span>
<span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>De igual forma, se introduce tambiÃ©n el operador ternario.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-kt">def</span> <span class="tok-n">y</span> <span class="tok-o">=</span> <span class="tok-mi">5</span>
<span class="tok-kt">def</span> <span class="tok-n">x</span> <span class="tok-o">=</span> <span class="tok-o">(</span><span class="tok-n">y</span> <span class="tok-o">&gt;</span> <span class="tok-mi">1</span><span class="tok-o">)</span> <span class="tok-o">?</span> <span class="tok-s2">&quot;funciona&quot;</span> <span class="tok-o">:</span> <span class="tok-s2">&quot;falla&quot;</span>
<span class="tok-k">assert</span> <span class="tok-n">x</span> <span class="tok-o">==</span> <span class="tok-s2">&quot;funciona&quot;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>AsÃ­ como el operador Elvis</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-kt">def</span> <span class="tok-n">usuario</span> <span class="tok-o">=</span> <span class="tok-o">[</span><span class="tok-nl">nombre:</span><span class="tok-s2">&quot;Fran&quot;</span><span class="tok-o">]</span>
<span class="tok-kt">def</span> <span class="tok-n">nombre</span> <span class="tok-o">=</span> <span class="tok-n">usuario</span><span class="tok-o">.</span><span class="tok-na">nombre</span> <span class="tok-o">?:</span> <span class="tok-s2">&quot;AnÃ³nimo&quot;</span>
<span class="tok-k">assert</span> <span class="tok-n">nombre</span> <span class="tok-o">==</span> <span class="tok-s2">&quot;Fran&quot;</span>
<span class="tok-n">usuario</span> <span class="tok-o">=</span> <span class="tok-o">[:]</span>
<span class="tok-n">nombre</span> <span class="tok-o">=</span> <span class="tok-n">usuario</span><span class="tok-o">.</span><span class="tok-na">nombre</span> <span class="tok-o">?:</span> <span class="tok-s2">&quot;AnÃ³nimo&quot;</span>
<span class="tok-k">assert</span> <span class="tok-n">nombre</span> <span class="tok-o">==</span> <span class="tok-s2">&quot;AnÃ³nimo&quot;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Con respecto a la estructura <em>switch</em>, la Ãºnica diferencia entre Groovy y Java es que en la condiciÃ³n se puede utilizar cualquier tipo de comprobaciÃ³n, tal y como vemos en el siguiente ejemplo:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-kt">def</span> <span class="tok-n">x</span> <span class="tok-o">=</span> <span class="tok-mf">1.23</span>
<span class="tok-kt">def</span> <span class="tok-n">result</span> <span class="tok-o">=</span> <span class="tok-s2">&quot;&quot;</span>

<span class="tok-k">switch</span> <span class="tok-o">(</span> <span class="tok-n">x</span> <span class="tok-o">)</span> <span class="tok-o">{</span>
    <span class="tok-k">case</span> <span class="tok-s2">&quot;foo&quot;</span><span class="tok-o">:</span>
        <span class="tok-n">result</span> <span class="tok-o">=</span> <span class="tok-s2">&quot;found foo&quot;</span>
        <span class="tok-c1">// lets fall through</span>

    <span class="tok-k">case</span> <span class="tok-s2">&quot;bar&quot;</span><span class="tok-o">:</span>
        <span class="tok-n">result</span> <span class="tok-o">+=</span> <span class="tok-s2">&quot;bar&quot;</span>

    <span class="tok-k">case</span> <span class="tok-o">[</span><span class="tok-mi">4</span><span class="tok-o">,</span> <span class="tok-mi">5</span><span class="tok-o">,</span> <span class="tok-mi">6</span><span class="tok-o">,</span> <span class="tok-s1">&#39;inList&#39;</span><span class="tok-o">]:</span>
        <span class="tok-n">result</span> <span class="tok-o">=</span> <span class="tok-s2">&quot;list&quot;</span>
        <span class="tok-k">break</span>

    <span class="tok-k">case</span> <span class="tok-mi">12</span><span class="tok-o">..</span><span class="tok-mi">30</span><span class="tok-o">:</span>
        <span class="tok-n">result</span> <span class="tok-o">=</span> <span class="tok-s2">&quot;range&quot;</span>
        <span class="tok-k">break</span>

    <span class="tok-k">case</span> <span class="tok-nl">Integer:</span>
        <span class="tok-n">result</span> <span class="tok-o">=</span> <span class="tok-s2">&quot;integer&quot;</span>
        <span class="tok-k">break</span>

    <span class="tok-k">case</span> <span class="tok-nl">Number:</span>
        <span class="tok-n">result</span> <span class="tok-o">=</span> <span class="tok-s2">&quot;number&quot;</span>
        <span class="tok-k">break</span>

    <span class="tok-k">default</span><span class="tok-o">:</span>
        <span class="tok-n">result</span> <span class="tok-o">=</span> <span class="tok-s2">&quot;default&quot;</span>
<span class="tok-o">}</span>

<span class="tok-k">assert</span> <span class="tok-n">result</span> <span class="tok-o">==</span> <span class="tok-s2">&quot;number&quot;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Groovy permite realizar las siguientes comprobaciones en una estructura <em>switch</em>:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Comparar la clase de una variable</p>
</li>
<li>
<p>Expresiones regulares</p>
</li>
<li>
<p>Comprobar si la variable estÃ¡ contenida en una colecciÃ³n</p>
</li>
<li>
<p>Y en Ãºltimo lugar, se comprueba la igualdad entre la variable evaluada y el caso en particular</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Los bloques de cÃ³digo del tipo <em>for</em> utilizan la notaciÃ³n <em>for(i in x){cuerpo}</em> donde <em>x</em> puede ser cualquier cosa que Groovy sepa como iterar (iteradores, enumeraciones, colecciones, mapas, rangos, etc.)</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-k">for</span><span class="tok-o">(</span><span class="tok-n">i</span> <span class="tok-k">in</span> <span class="tok-mi">1</span><span class="tok-o">..</span><span class="tok-mi">10</span><span class="tok-o">)</span>
	<span class="tok-n">println</span> <span class="tok-n">i</span>

<span class="tok-nf">for</span><span class="tok-o">(</span><span class="tok-n">i</span> <span class="tok-k">in</span> <span class="tok-o">[</span><span class="tok-mi">1</span><span class="tok-o">,</span><span class="tok-mi">2</span><span class="tok-o">,</span><span class="tok-mi">3</span><span class="tok-o">,</span><span class="tok-mi">4</span><span class="tok-o">,</span><span class="tok-mi">5</span><span class="tok-o">,</span><span class="tok-mi">6</span><span class="tok-o">,</span><span class="tok-mi">7</span><span class="tok-o">,</span><span class="tok-mi">8</span><span class="tok-o">,</span><span class="tok-mi">9</span><span class="tok-o">,</span><span class="tok-mi">10</span><span class="tok-o">])</span>
	<span class="tok-n">println</span> <span class="tok-n">i</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>En Groovy es una prÃ¡ctica habitual utilizar un closure para simular un bucle <em>for</em> como por ejemplo en el siguiente cÃ³digo</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-kt">def</span> <span class="tok-n">alumnos</span> <span class="tok-o">=</span> <span class="tok-o">[</span><span class="tok-s1">&#39;Pedro&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;Miguel&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;Alejandro&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;Elena&#39;</span><span class="tok-o">]</span>
<span class="tok-n">alumnos</span><span class="tok-o">.</span><span class="tok-na">each</span><span class="tok-o">{</span><span class="tok-n">nombre</span> <span class="tok-o">-&gt;</span> <span class="tok-n">println</span> <span class="tok-n">nombre</span><span class="tok-o">}</span></code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_tipos_de_datos_en_groovy">1.5. Tipos de datos en Groovy</h3>
<div class="sect3">
<h4 id="_tipos_primitivos_y_referencias">1.5.1. Tipos primitivos y referencias</h4>
<div class="paragraph">
<p>En Java, existen los tipos de datos primitivos (<em>int, double, float, char</em>, etc) y las referencias (<em>Object, String</em>, etc), Los tipos de datos primitivos son aquellos que tienen valor por si mismos, bien sea un entero, un carÃ¡cter o un nÃºmero en coma flotante y es imposible crear nuevos tipos de datos primitivos.</p>
</div>
<div class="paragraph">
<p>Mientras que las referencias son identificadores de instancias de clases Java y, como su nombre indica, simplemente es una referencia a un objeto. En los tipos de datos primitivos es imposible realizar llamadas a mÃ©todos y Ã©stos no pueden ser utilizados en aquellos lugares donde se espera la presencia de un tipo <em>java.lang.Object</em>. Esto hace que determinados fragmentos de cÃ³digo de nuestros programas, se compliquen demasiado, como puede ser el siguiente ejemplo que realiza la suma posiciÃ³n por posiciÃ³n de un par de vectores de enteros.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span class="tok-n">ArrayList</span> <span class="tok-n">resultados</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-nf">ArrayList</span><span class="tok-o">();</span>
<span class="tok-k">for</span> <span class="tok-o">(</span><span class="tok-kt">int</span> <span class="tok-n">i</span><span class="tok-o">=</span><span class="tok-mi">0</span><span class="tok-o">;</span> <span class="tok-n">i</span> <span class="tok-o">&lt;</span> <span class="tok-n">listaUno</span><span class="tok-o">.</span><span class="tok-na">size</span><span class="tok-o">();</span> <span class="tok-n">i</span><span class="tok-o">++){</span>
    <span class="tok-n">Integer</span> <span class="tok-n">primero</span> <span class="tok-o">=</span> <span class="tok-o">(</span><span class="tok-n">Integer</span><span class="tok-o">)</span><span class="tok-n">listaUno</span><span class="tok-o">.</span><span class="tok-na">get</span><span class="tok-o">(</span><span class="tok-n">i</span><span class="tok-o">);</span>
    <span class="tok-n">Integer</span> <span class="tok-n">segundo</span> <span class="tok-o">=</span> <span class="tok-o">(</span><span class="tok-n">Integer</span><span class="tok-o">)</span><span class="tok-n">listaDos</span><span class="tok-o">.</span><span class="tok-na">get</span><span class="tok-o">(</span><span class="tok-n">i</span><span class="tok-o">);</span>

    <span class="tok-kt">int</span> <span class="tok-n">suma</span> <span class="tok-o">=</span> <span class="tok-n">primero</span><span class="tok-o">.</span><span class="tok-na">intValue</span><span class="tok-o">()</span> <span class="tok-o">+</span> <span class="tok-n">segundo</span><span class="tok-o">.</span><span class="tok-na">intValue</span><span class="tok-o">();</span>
    <span class="tok-n">resultados</span><span class="tok-o">.</span><span class="tok-na">add</span><span class="tok-o">(</span><span class="tok-k">new</span> <span class="tok-nf">Integer</span><span class="tok-o">(</span><span class="tok-n">suma</span><span class="tok-o">));</span>
<span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>En Groovy, todo es un objeto y una soluciÃ³n al ejemplo anterior podrÃ­a ser utilizando el mÃ©todo <em>plus()</em> que Groovy aÃ±ade al tipo Integer: <em>resultados.add(primero.plus(segundo))</em>, con lo que nos podrÃ­amos ahorrar el paso de la conversiÃ³n de tipo de dato referencia a tipo de dato primitivo (<em>primero.intValue()</em>).</p>
</div>
<div class="paragraph">
<p>Sin embargo, esta soluciÃ³n tambiÃ©n se podrÃ­a conseguir en Java si se aÃ±adiera el mÃ©todo plus a la clase Integer. AsÃ­ que Groovy decide ir un poco mÃ¡s lejos y permite la utilizaciÃ³n de operadores entre objetos, con lo que la soluciÃ³n en Groovy serÃ­a <em>resultados.add (primero + segundo)</em>.</p>
</div>
<div class="paragraph">
<p>De esta forma, lo que en Groovy puede parecer una variable de tipo de dato primitivo, en realidad es una referencia a una clase Java, tal y como se muestra en la siguiente tabla.</p>
</div>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-center valign-middle">Tipo primitivo</th>
<th class="tableblock halign-left valign-top">Tipo referencia</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-center valign-middle"><p class="tableblock">byte</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">java.lang.Byte</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-middle"><p class="tableblock">short</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">java.lang.Short</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-middle"><p class="tableblock">int</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">java.lang.Integer</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-middle"><p class="tableblock">long</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">java.lang.Long</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-middle"><p class="tableblock">float</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">java.lang.Float</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-middle"><p class="tableblock">double</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">java.lang.Double</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-middle"><p class="tableblock">char</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">java.lang.Character</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-middle"><p class="tableblock">boolean</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">java.lang.Boolean</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>AsÃ­ que cada vez que utilices un tipo de datos primitivo en tus programas en Groovy, en realidad estÃ¡s utilizando la correspondiente clase indicada en la tabla anterior,  con lo que, puedes ahorrarte el uso de tipos primitivos en Groovy, porque por detrÃ¡s se estÃ¡ haciendo una conversiÃ³n a un tipo de dato referencia.</p>
</div>
</div>
<div class="sect3">
<h4 id="_boxing_unboxing_y_autoboxing">1.5.2. Boxing, unboxing y autoboxing</h4>
<div class="paragraph">
<p>La conversiÃ³n de un tipo de dato primitivo a un tipo de dato referencia se conoce en Java como <em>boxing</em>, mientras que la conversiÃ³n de un tipo de dato referencia a un tipo de dato primitivo se conoce <em>unboxing</em>. Groovy automatiza estas operaciones en lo que se conoce como <em>autoboxing</em>.</p>
</div>
<div class="paragraph">
<p>Pero, si Groovy convierte todo a un tipo de dato referencia, Â¿quÃ© pasa con aquellos mÃ©todos de Java que esperan un parÃ¡metro de tipo de dato primitivo?	No hay de que preocuparse, el autoboxing de Groovy se encarga de eso. Por ejemplo, en el mÃ©todo <em>indexOf</em> de la clase <em>java.lang.String</em> se espera como parÃ¡metro un entero (<em>int</em>) que indica el carÃ¡cter buscado en la cadena, devolviendo tambiÃ©n un entero indicando la posiciÃ³n en la que se ha encontrado el caracter. Si probamos el siguiente ejemplo, veremos como todo funciona correctamente, ya que Groovy se encarga de realizar el autoboxing allÃ­ donde considere oportuno, en este caso, en el paso del parÃ¡metro a la funciÃ³n <em>indexOf</em>. El siguiente cÃ³digo trata de obtener la posiciÃ³n de la primera 'o' de la cadena.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-k">assert</span> <span class="tok-s1">&#39;Hola Mundo&#39;</span><span class="tok-o">.</span><span class="tok-na">indexOf</span><span class="tok-o">(</span><span class="tok-mi">111</span><span class="tok-o">)</span> <span class="tok-o">==</span> <span class="tok-mi">1</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>En un principio Groovy, deberÃ­a convertir el tipo de datos <em>int</em> del valor 111 a <em>Integer</em>, sin embargo, la funciÃ³n <em>indexOf()</em> requiere un parÃ¡metro de tipo <em>int</em>, con lo que el autoboxing de Groovy funciona de tal forma para convertir el parÃ¡metro al tipo de dato requerido, en este caso, <em>int</em>.</p>
</div>
<div class="paragraph">
<p>Otro aspecto interesante del autoboxing de Groovy es que no siempre se ejecuta el autoboxing para la realizaciÃ³n de determinadas operaciones. Por ejemplo, en la operaciÃ³n <em>1 + 2</em>, podemos pensar que los valores 1 y 2 son del tipo referencia <em>Integer</em>, lo cual es cierto y que para poder realizarse la operaciÃ³n, Ã©stos deben ser convertidos a tipo <em>int</em>, lo cual no es cierto.</p>
</div>
<div class="paragraph">
<p>De Groovy se dice que es incluso mÃ¡s orientado a objetos que Java y se dice por cuestiones como esta. En la operaciÃ³n <em>1 + 2</em>, lo que Groovy estÃ¡ realmente ejecutando es <em>1.plus(2)</em>, con lo que no es necesaria ninguna conversiÃ³n para realizar esta operaciÃ³n.</p>
</div>
</div>
<div class="sect3">
<h4 id="_tipado_dinÃ¡mico">1.5.3. Tipado dinÃ¡mico</h4>
<div class="paragraph">
<p>Hasta el momento, en prÃ¡cticamente todos los ejemplos que hemos visto en Groovy, hemos obviado especificar los tipos de datos utilizados, dejando que Groovy lo haga por nosotros. Esto es lo que se conoce como tipado dinÃ¡mico y en este punto, vamos a ver los pros y los contras de su uso. La siguiente tabla, muestra un ejemplo con definiciones de variables y como actÃºa Groovy en cada caso.</p>
</div>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-center valign-middle">Sentencia</th>
<th class="tableblock halign-left valign-top">Tipo de variable</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-center valign-middle"><p class="tableblock">def a = 2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">java.lang.Integer</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-middle"><p class="tableblock">def b = 0.4f</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">java.lang.Float</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-middle"><p class="tableblock">def c = 'a'</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">java.lang.String</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-middle"><p class="tableblock">int d = 3</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">java.lang.Integer</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-middle"><p class="tableblock">float e = 4</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">java.lang.Float</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-middle"><p class="tableblock">char f = '1'</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">java.lang.Character</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-middle"><p class="tableblock">Integer g = 6</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">java.lang.Integer</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-middle"><p class="tableblock">String h = '1'</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">java.lang.String</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-middle"><p class="tableblock">Character i = 'a'</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">java.lang.Character</p></td>
</tr>
</tbody>
</table>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-kt">def</span> <span class="tok-n">a</span> <span class="tok-o">=</span> <span class="tok-mi">2</span>
<span class="tok-kt">def</span> <span class="tok-n">b</span> <span class="tok-o">=</span> <span class="tok-mf">0.4f</span>
<span class="tok-kt">def</span> <span class="tok-n">c</span> <span class="tok-o">=</span> <span class="tok-s1">&#39;a&#39;</span>
<span class="tok-kt">int</span> <span class="tok-n">d</span> <span class="tok-o">=</span> <span class="tok-mi">3</span>
<span class="tok-kt">float</span> <span class="tok-n">e</span> <span class="tok-o">=</span> <span class="tok-mi">4</span>
<span class="tok-kt">char</span> <span class="tok-n">f</span> <span class="tok-o">=</span> <span class="tok-s1">&#39;1&#39;</span>
<span class="tok-n">Integer</span> <span class="tok-n">g</span> <span class="tok-o">=</span> <span class="tok-mi">6</span>
<span class="tok-n">String</span> <span class="tok-n">h</span> <span class="tok-o">=</span> <span class="tok-s1">&#39;1&#39;</span>
<span class="tok-n">Character</span> <span class="tok-n">i</span> <span class="tok-o">=</span> <span class="tok-s1">&#39;a&#39;</span>

<span class="tok-k">assert</span> <span class="tok-n">a</span> <span class="tok-k">instanceof</span> <span class="tok-n">java</span><span class="tok-o">.</span><span class="tok-na">lang</span><span class="tok-o">.</span><span class="tok-na">Integer</span>
<span class="tok-k">assert</span> <span class="tok-n">b</span> <span class="tok-k">instanceof</span> <span class="tok-n">java</span><span class="tok-o">.</span><span class="tok-na">lang</span><span class="tok-o">.</span><span class="tok-na">Float</span>
<span class="tok-k">assert</span> <span class="tok-n">c</span> <span class="tok-k">instanceof</span> <span class="tok-n">java</span><span class="tok-o">.</span><span class="tok-na">lang</span><span class="tok-o">.</span><span class="tok-na">String</span>
<span class="tok-k">assert</span> <span class="tok-n">d</span> <span class="tok-k">instanceof</span> <span class="tok-n">java</span><span class="tok-o">.</span><span class="tok-na">lang</span><span class="tok-o">.</span><span class="tok-na">Integer</span>
<span class="tok-k">assert</span> <span class="tok-n">e</span> <span class="tok-k">instanceof</span> <span class="tok-n">java</span><span class="tok-o">.</span><span class="tok-na">lang</span><span class="tok-o">.</span><span class="tok-na">Float</span>
<span class="tok-k">assert</span> <span class="tok-n">f</span> <span class="tok-k">instanceof</span> <span class="tok-n">java</span><span class="tok-o">.</span><span class="tok-na">lang</span><span class="tok-o">.</span><span class="tok-na">Character</span>
<span class="tok-k">assert</span> <span class="tok-n">g</span> <span class="tok-k">instanceof</span> <span class="tok-n">java</span><span class="tok-o">.</span><span class="tok-na">lang</span><span class="tok-o">.</span><span class="tok-na">Integer</span>
<span class="tok-k">assert</span> <span class="tok-n">h</span> <span class="tok-k">instanceof</span> <span class="tok-n">java</span><span class="tok-o">.</span><span class="tok-na">lang</span><span class="tok-o">.</span><span class="tok-na">String</span>
<span class="tok-k">assert</span> <span class="tok-n">i</span> <span class="tok-k">instanceof</span> <span class="tok-n">java</span><span class="tok-o">.</span><span class="tok-na">lang</span><span class="tok-o">.</span><span class="tok-na">Character</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>La palabra reservada <em>def</em> se utiliza cuando no queremos especificar ningÃºn tipo de dato en especial y dejamos que Groovy decida por nosotros, tal y como aparece en los tres primeros ejemplos. En los tres ejemplos siguientes, podemos ver como independientemente de declarar una variable como tipo de dato primitivo, Ã©sta acabarÃ¡ siendo un tipo de dato referencia. Los tres Ãºltimos ejemplos, servirÃ¡n a la persona que estÃ© leyendo el cÃ³digo para entender que esa variable es un objeto.</p>
</div>
<div class="paragraph">
<p>AquÃ­ es importante resaltar que Groovy es un lenguaje de tipado dinÃ¡mico de datos seguro, lo que quiere decir, que Groovy no nos va a permitir realizar operaciones de una determinada clase a un objeto definido de forma diferente. Por ejemplo, en el trozo de cÃ³digo <em>String f = '1'</em>, la variable <em>f</em> nunca va a poder ser utilizada para realizar operaciones matemÃ¡ticas como si fuera de la clase <em>java.lang.Number</em> salvo que hagamos la correspondiente conversiÃ³n.</p>
</div>
<div class="paragraph">
<p>Poder elegir si utilizamos tipado dinÃ¡mico o estÃ¡tico, es una de las mejores cosas que tiene Groovy. En Internet existen muchos foros de discusiÃ³n creados a partir de este debate donde se exponen los pros y los contras de cada mÃ©todo. El <em>tipado estÃ¡tico</em> nos proporciona mÃ¡s informaciÃ³n para la optimizaciÃ³n de nuestros programas y revelan informaciÃ³n adicional sobre el significado de la variable o del parÃ¡metro utilizado en un mÃ©todo determinado.</p>
</div>
<div class="paragraph">
<p>Por otro lado, el <em>tipado dinÃ¡mico</em> no sÃ³lo es el mÃ©todo utilizado por los programadores vagos que no quieren estar definiendo los tipos de las variables, sino que tambiÃ©n se utiliza cuando la salida de un mÃ©todo es utilizado como entrada de otro sin tener que hacer ningÃºn trabajo extra por nuestra parte. De esta forma, el programador deja a Groovy que se encargue de la conversiÃ³n de los datos en caso de que sea necesario y factible.</p>
</div>
<div class="paragraph">
<p>Otro aspecto interesante del tipado dinÃ¡mico, es lo que se conoce como el <em>duck typing</em> (tipado de patos) y es que, si hay algo que camina como un pato y habla como un pato, lo mÃ¡s probable es que sea un pato. El tipado dinÃ¡mico es interesante utilizarlo cuando se desconoce a ciencia cierta el tipo de datos de una determinada variable o parÃ¡metro. Esto nos proporciona un gran nivel de reutilizaciÃ³n de nuestro cÃ³digo, asÃ­ como la posibilidad de implementar funciones genÃ©ricas.</p>
</div>
</div>
<div class="sect3">
<h4 id="_trabajo_con_cadenas">1.5.4. Trabajo con cadenas</h4>
<div class="paragraph">
<p>Groovy nos facilita el trabajo con las cadenas de texto en mayor medida que lo hace Java, aÃ±adiendo su propia librerÃ­a <em>groovy.lang.GString</em>, con lo que ademÃ¡s de los mÃ©todos ofrecidos por la clase <em>java.lang.String</em>, Groovy cuenta con mÃ¡s metodos ofrecidos por esta librerÃ­a. Una caracterÃ­stica de como trabaja Groovy con las cadenas de texto es que nos permite introducir variables en las cadenas sin tener que utilizar caracteres de escape como por ejemplo <em>"hola $minombre"</em>, donde en la misma cadena se introduce el valor de una variable. Esto es tÃ­pico de algunos lenguajes de programaciÃ³n como PHP y facilita la lectura de nuestro cÃ³digo ya que no tenemos que estar escapando constantemente.</p>
</div>
<div class="paragraph">
<p>La siguiente tabla muestra las diferentes formas que hay en Groovy para crear una cadena de texto:</p>
</div>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 33%;">
<col style="width: 33%;">
<col style="width: 33%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Caracteres utilizados</th>
<th class="tableblock halign-left valign-top">Ejemplo</th>
<th class="tableblock halign-left valign-top">Soporte GString</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Comillas simples</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">'hola Juan'</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Comillas dobles</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">"hola $nombre"</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">SÃ­</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">3 comillas simples</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">'''-------------&lt;br/&gt;Total:0.02&lt;br/&gt;-------------'''</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">3 comillas dobles</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">"""-------------&lt;br/&gt;Total:$total&lt;br/&gt;-------------"""</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">SÃ­</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">SÃ­mbolo /</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">/x(\d*)y/</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">SÃ­</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>La diferencia entre las comillas simples y las dobles es la posibilidad de incluir variables precedidas del sÃ­mbolo $ para mostrar su valor. Las cadenas introducidas con el sÃ­mbolo / son utilizadas con expresiones regulares, como veremos mÃ¡s adelante.</p>
</div>
<div class="sect4">
<h5 id="_la_librerÃ­a_gstring">La librerÃ­a GString</h5>
<div class="paragraph">
<p>La librerÃ­a GString (<em>groovy.lang.GString</em>) aÃ±ade determinados mÃ©todos para facilitarnos el trabajo con cadenas de texto, las cuales normalmente se crean utilizando comillas dobles. BÃ¡sicamente, una cadena de tipo GString nos va a permitir introducir variables precedidas del sÃ­mbolo $. TambiÃ©n es posible introducir expresiones entre llaves (<em>${expresion}</em>), tal y como si estuviÃ©ramos escribiendo un <em>closure</em>. Veamos algunos ejemplos:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-n">nombre</span> <span class="tok-o">=</span> <span class="tok-s1">&#39;Fran&#39;</span>
<span class="tok-n">apellidos</span> <span class="tok-o">=</span> <span class="tok-s1">&#39;GarcÃ­a&#39;</span>
<span class="tok-n">salida</span> <span class="tok-o">=</span> <span class="tok-s2">&quot;Apellidos, nombre: $apellidos, $nombre&quot;</span>

<span class="tok-n">fecha</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">Date</span><span class="tok-o">(</span><span class="tok-mi">0</span><span class="tok-o">)</span>
<span class="tok-n">salida</span> <span class="tok-o">=</span> <span class="tok-s2">&quot;AÃ±o $fecha.year, Mes $fecha.month, DÃ­a $fecha.date&quot;</span>

<span class="tok-n">salida</span> <span class="tok-o">=</span> <span class="tok-s2">&quot;La fecha es ${fecha.toGMTString()}&quot;</span>

<span class="tok-n">sentenciasql</span> <span class="tok-o">=</span> <span class="tok-s2">&quot;&quot;&quot;</span>
<span class="tok-s2">SELECT nombre, apellidos</span>
<span class="tok-s2">FROM usuarios</span>
<span class="tok-s2">WHERE anyo_nacimiento=$fecha.year</span>
<span class="tok-s2">&quot;&quot;&quot;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Ahora que ya podemos declarar variables de texto, vamos a ver algunos mÃ©todos que podemos utilizar en Groovy:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-n">saludo</span> <span class="tok-o">=</span> <span class="tok-s1">&#39;Hola Juan&#39;</span>

<span class="tok-k">assert</span> <span class="tok-n">saludo</span><span class="tok-o">.</span><span class="tok-na">startsWith</span><span class="tok-o">(</span><span class="tok-s1">&#39;Hola&#39;</span><span class="tok-o">)</span>

<span class="tok-k">assert</span> <span class="tok-n">saludo</span><span class="tok-o">.</span><span class="tok-na">getAt</span><span class="tok-o">(</span><span class="tok-mi">3</span><span class="tok-o">)</span> <span class="tok-o">==</span> <span class="tok-s1">&#39;a&#39;</span>
<span class="tok-k">assert</span> <span class="tok-n">saludo</span><span class="tok-o">[</span><span class="tok-mi">3</span><span class="tok-o">]</span> <span class="tok-o">==</span> <span class="tok-s1">&#39;a&#39;</span>

<span class="tok-k">assert</span> <span class="tok-n">saludo</span><span class="tok-o">.</span><span class="tok-na">indexOf</span><span class="tok-o">(</span><span class="tok-s1">&#39;Juan&#39;</span><span class="tok-o">)</span> <span class="tok-o">==</span> <span class="tok-mi">5</span>
<span class="tok-k">assert</span> <span class="tok-n">saludo</span><span class="tok-o">.</span><span class="tok-na">contains</span><span class="tok-o">(</span><span class="tok-s1">&#39;Juan&#39;</span><span class="tok-o">)</span>

<span class="tok-k">assert</span> <span class="tok-n">saludo</span><span class="tok-o">[</span><span class="tok-mi">5</span><span class="tok-o">..</span><span class="tok-mi">8</span><span class="tok-o">]</span> <span class="tok-o">==</span> <span class="tok-s1">&#39;Juan&#39;</span>

<span class="tok-k">assert</span> <span class="tok-s1">&#39;Buenos dÃ­as&#39;</span> <span class="tok-o">+</span> <span class="tok-n">saludo</span> <span class="tok-o">-</span> <span class="tok-s1">&#39;Hola&#39;</span> <span class="tok-o">==</span> <span class="tok-s1">&#39;Buenos dÃ­as Juan&#39;</span>

<span class="tok-k">assert</span> <span class="tok-n">saludo</span><span class="tok-o">.</span><span class="tok-na">count</span><span class="tok-o">(</span><span class="tok-s1">&#39;a&#39;</span><span class="tok-o">)</span> <span class="tok-o">==</span> <span class="tok-mi">2</span>

<span class="tok-k">assert</span> <span class="tok-s1">&#39;b&#39;</span><span class="tok-o">.</span><span class="tok-na">padLeft</span><span class="tok-o">(</span><span class="tok-mi">3</span><span class="tok-o">)</span> <span class="tok-o">==</span> <span class="tok-s1">&#39;  b&#39;</span>
<span class="tok-k">assert</span> <span class="tok-s1">&#39;b&#39;</span><span class="tok-o">.</span><span class="tok-na">padRight</span><span class="tok-o">(</span><span class="tok-mi">3</span><span class="tok-o">,</span><span class="tok-s1">&#39;_&#39;</span><span class="tok-o">)</span> <span class="tok-o">==</span> <span class="tok-s1">&#39;b__&#39;</span>
<span class="tok-k">assert</span> <span class="tok-s1">&#39;b&#39;</span><span class="tok-o">.</span><span class="tok-na">center</span><span class="tok-o">(</span><span class="tok-mi">3</span><span class="tok-o">)</span> <span class="tok-o">==</span> <span class="tok-s1">&#39; b &#39;</span>
<span class="tok-k">assert</span> <span class="tok-s1">&#39;b&#39;</span> <span class="tok-o">*</span> <span class="tok-mi">3</span> <span class="tok-o">==</span> <span class="tok-s1">&#39;bbb&#39;</span></code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_expresiones_regulares">Expresiones regulares</h5>
<div class="paragraph">
<p>Las expresiones regulares nos permiten especificar un patrÃ³n y buscar si Ã©ste aparece en un fragmento de texto determinado. Groovy deje que sea Java la encargada del tratamiento de las expresiones regulares, pero ademÃ¡s, aÃ±ade tres mÃ©todos para facilitarnos este trabajo:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>El operador =~: <em>find</em></p>
</li>
<li>
<p>El operador ==~: <em>match</em></p>
</li>
<li>
<p>El operador ~String: <em>pattern</em></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Con los patrones de las expresiones regulares, realmente estamos indicando que estamos buscando exactamente. Veamos algunos ejemplos:</p>
</div>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-center valign-middle">PatrÃ³n</th>
<th class="tableblock halign-left valign-top">Significado</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-center valign-middle"><p class="tableblock">algo de texto</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">simplemente encontrarÃ¡ la frase "algo de texto"</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-middle"><p class="tableblock">algo de\s+texto</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">encontrarÃ¡ frases que empiecen con "algo de", vayan seguidos por uno o mÃ¡s caracteres y terminen con la palabra texto</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-middle"><p class="tableblock">\d\d/\d\d/\d\d\d\d</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">detectarÃ¡ fechas como por ejemplo 28/06/2008</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>El punto clave de los patrones de las expresiones regulares, son los sÃ­mbolos, que los podemos sustituir por determinados fragmentos de texto. La siguiente tabla presenta estos sÃ­mbolos:</p>
</div>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-center valign-middle">SÃ­mbolo</th>
<th class="tableblock halign-left valign-top">Significado</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-center valign-middle"><p class="tableblock">.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Cualquier carÃ¡cter</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-middle"><p class="tableblock">^</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">El inicio de una lÃ­nea</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-middle"><p class="tableblock">$</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">El final de una lÃ­nea</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-middle"><p class="tableblock">\d</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Un dÃ­gito</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-middle"><p class="tableblock">\D</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Cualquier cosa excepto un dÃ­gito</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-middle"><p class="tableblock">\s</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Un espacio en blanco</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-middle"><p class="tableblock">\S</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Cualquier cosa excepto un espacio en blanco</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-middle"><p class="tableblock">\w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Un carÃ¡cter de texto</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-middle"><p class="tableblock">\W</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Cualquier carÃ¡cter excepto los de texto</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-middle"><p class="tableblock">\b</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">LÃ­mite de palabras</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-middle"><p class="tableblock">()</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">AgrupaciÃ³n</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-middle"><p class="tableblock">(x|y)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">O x o y</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-middle"><p class="tableblock">x*</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Cero o mÃ¡s ocurrencias de x</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-middle"><p class="tableblock">x+</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Una o mÃ¡s ocurrencias de x</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-middle"><p class="tableblock">x?</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Cero o una ocurrencia de x</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-middle"><p class="tableblock">x{m,n}</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Entre m y n ocurrencias de x</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-middle"><p class="tableblock">x{m}</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Exactamente m ocurrencias de x</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-middle"><p class="tableblock">[a-d]</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Incluye los caracteres a, b, c y d</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-middle"><p class="tableblock">[^a]</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Cualquier carÃ¡cter excepto la letra a</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Las expresiones regulares nos ayudarÃ¡n en Groovy a:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Indicarnos si un determinado patrÃ³n encaja completamente con un texto</p>
</li>
<li>
<p>Si existe alguna ocurrencia de un patrÃ³n en una cadena</p>
</li>
<li>
<p>Contar el nÃºmero de ocurrencias</p>
</li>
<li>
<p>Hacer algo con una determinada ocurrencia</p>
</li>
<li>
<p>Reemplazar todas las ocurrencias con un determinado texto</p>
</li>
<li>
<p>Separar una cadena en mÃºltiples cadenas a partir de las ocurrencias que aparezcan en la misma</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>El siguiente fragmento de cÃ³digo muestra el funcionamiento bÃ¡sico de las expresiones regulares.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-n">refran</span> <span class="tok-o">=</span> <span class="tok-s2">&quot;tres tristes tigres tigraban en un tigral&quot;</span>

<span class="tok-c1">//Compruebo que hay al menos un fragmento de cÃ³digo que empieza por t,</span>
<span class="tok-c1">//le siga cualquier caracter y posteriormente haya una g</span>
<span class="tok-k">assert</span> <span class="tok-n">refran</span> <span class="tok-o">=~</span> <span class="tok-s">/t.g/</span>

<span class="tok-c1">//Compruebo que el refrÃ¡n estÃ© compuesto sÃ³lo</span>
<span class="tok-c1">//por palabras seguidas de un espacio</span>
<span class="tok-k">assert</span> <span class="tok-n">refran</span> <span class="tok-o">==~</span> <span class="tok-s">/(\w+ \w+)*/</span>

<span class="tok-c1">//Compruebo que el valor de una operaciÃ³n de tipo match es un booleano</span>
<span class="tok-k">assert</span> <span class="tok-o">(</span><span class="tok-n">refran</span> <span class="tok-o">==~</span> <span class="tok-s">/(\w+ \w+)*/</span><span class="tok-o">)</span> <span class="tok-k">instanceof</span> <span class="tok-n">java</span><span class="tok-o">.</span><span class="tok-na">lang</span><span class="tok-o">.</span><span class="tok-na">Boolean</span>

<span class="tok-c1">//A diferencia que una operaciÃ³n de tipo find,</span>
<span class="tok-c1">//las operaciones match se evalÃºan por completo contra una cadena</span>
<span class="tok-k">assert</span> <span class="tok-o">(</span><span class="tok-n">refran</span> <span class="tok-o">==~</span> <span class="tok-s">/t.g/</span><span class="tok-o">)</span> <span class="tok-o">==</span> <span class="tok-kc">false</span>

<span class="tok-c1">//Sustituyo las palabras por el caracter x</span>
<span class="tok-k">assert</span> <span class="tok-o">(</span><span class="tok-n">refran</span><span class="tok-o">.</span><span class="tok-na">replaceAll</span><span class="tok-o">(</span><span class="tok-s">/\w+/</span><span class="tok-o">,</span><span class="tok-s1">&#39;x&#39;</span><span class="tok-o">))</span> <span class="tok-o">==</span> <span class="tok-s1">&#39;x x x x x x x&#39;</span>

<span class="tok-c1">//Devuelve un array con todas las palabras del refrÃ¡n</span>
<span class="tok-n">palabras</span> <span class="tok-o">=</span> <span class="tok-n">refran</span><span class="tok-o">.</span><span class="tok-na">split</span><span class="tok-o">(</span><span class="tok-s">/ /</span><span class="tok-o">)</span>
<span class="tok-k">assert</span> <span class="tok-n">palabras</span><span class="tok-o">.</span><span class="tok-na">size</span><span class="tok-o">()</span> <span class="tok-o">==</span> <span class="tok-mi">7</span>
<span class="tok-k">assert</span> <span class="tok-n">palabras</span><span class="tok-o">[</span><span class="tok-mi">2</span><span class="tok-o">]</span> <span class="tok-o">==</span> <span class="tok-s1">&#39;tigres&#39;</span>
<span class="tok-k">assert</span> <span class="tok-n">palabras</span><span class="tok-o">.</span><span class="tok-na">getAt</span><span class="tok-o">(</span><span class="tok-mi">3</span><span class="tok-o">)</span> <span class="tok-o">==</span> <span class="tok-s1">&#39;tigraban&#39;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Es importante resaltar la diferencia entre el operador <em>find</em> y el operador <em>match</em>. El operador <em>match</em> es mÃ¡s restrictivo puesto que intenta hacer coincidir un patrÃ³n con la cadena entera, mientras que el operador <em>find</em>, sÃ³lo pretende encontrar una ocurrencia del patrÃ³n en la cadena.</p>
</div>
<div class="paragraph">
<p>Ya sabemos como localizar fragmentos de texto en cadenas, pero Â¿y si queremos hacer algo con estas cadenas encontradas? Groovy nos vuelve a facilitar esta tarea y pone a nuestra disposiciÃ³n un par de formas para recorrer las ocurrencias encontradas: <em>each</em> y <em>eachMatch</em>. Por un lado, al mÃ©todo <em>eachMatch</em> se le pasa una cadena con un patrÃ³n de expresiÃ³n regular como parÃ¡metro: <em>String.eachMatch(patron)</em>, mientras que al mÃ©todo <em>each</em> se le pasa directamente el resultado de una operaciÃ³n de tipo <em>find()</em> o <em>match()</em>: <em>Matcher.each()</em>. VeÃ¡mos ambos mÃ©todos en funcionamiento.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-n">refran</span> <span class="tok-o">=</span> <span class="tok-s2">&quot;tres tristes tigres tigraban en un tigral&quot;</span>

<span class="tok-c1">//Busco todas las palabras que acaben en &#39;es&#39;</span>
<span class="tok-n">rima</span> <span class="tok-o">=</span> <span class="tok-o">~</span><span class="tok-s">/\b\w*es\b/</span>
<span class="tok-n">resultado</span> <span class="tok-o">=</span> <span class="tok-s1">&#39;&#39;</span>
<span class="tok-n">refran</span><span class="tok-o">.</span><span class="tok-na">eachMatch</span><span class="tok-o">(</span><span class="tok-n">rima</span><span class="tok-o">)</span> <span class="tok-o">{</span> <span class="tok-n">match</span> <span class="tok-o">-&gt;</span>
    <span class="tok-n">resultado</span> <span class="tok-o">+=</span> <span class="tok-n">match</span> <span class="tok-o">+</span> <span class="tok-s1">&#39; &#39;</span>
<span class="tok-o">}</span>

<span class="tok-k">assert</span> <span class="tok-n">resultado</span> <span class="tok-o">==</span> <span class="tok-s1">&#39;tres tristes tigres &#39;</span>

<span class="tok-c1">//Hago lo mismo con el mÃ©todo each</span>
<span class="tok-n">resultado</span> <span class="tok-o">=</span> <span class="tok-s1">&#39;&#39;</span>
<span class="tok-o">(</span><span class="tok-n">refran</span> <span class="tok-o">=~</span> <span class="tok-n">rima</span><span class="tok-o">).</span><span class="tok-na">each</span> <span class="tok-o">{</span> <span class="tok-n">match</span> <span class="tok-o">-&gt;</span>
    <span class="tok-n">resultado</span> <span class="tok-o">+=</span> <span class="tok-n">match</span> <span class="tok-o">+</span> <span class="tok-s1">&#39; &#39;</span>
<span class="tok-o">}</span>

<span class="tok-k">assert</span> <span class="tok-n">resultado</span> <span class="tok-o">==</span> <span class="tok-s1">&#39;tres tristes tigres &#39;</span>

<span class="tok-c1">//Sustituyo todas las rimas por guiones bajos</span>
<span class="tok-k">assert</span> <span class="tok-o">(</span><span class="tok-n">refran</span><span class="tok-o">.</span><span class="tok-na">replaceAll</span><span class="tok-o">(</span><span class="tok-n">rima</span><span class="tok-o">){</span> <span class="tok-n">it</span><span class="tok-o">-</span><span class="tok-s1">&#39;es&#39;</span><span class="tok-o">+</span><span class="tok-s1">&#39;__&#39;</span><span class="tok-o">}</span> <span class="tok-o">==</span> <span class="tok-s1">&#39;tr__ trist__ tigr__ tigraban en un tigral&#39;</span><span class="tok-o">)</span></code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_nÃºmeros">1.5.5. NÃºmeros</h4>
<div class="paragraph">
<p>El GDK de Groovy introduce algunos mÃ©todos interesantes en cuanto al tratamiento de nÃºmeros. Estos mÃ©todos funcionan como closures y nos servirÃ¡n como otras formas de realizar bucles. Estos mÃ©todos son:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><em>times()</em>, se utiliza para realizar repeticiones</p>
</li>
<li>
<p><em>upto()</em>, utilizado para realizar una secuencia de acciones de forma creciente</p>
</li>
<li>
<p><em>downto()</em>, igual que el anterior pero de forma decreciente</p>
</li>
<li>
<p><em>step()</em>, es el mÃ©todo general para realizar una secuencia paso a paso</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Pero como siempre, veamos varios ejemplos.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-kt">def</span> <span class="tok-n">cadena</span> <span class="tok-o">=</span> <span class="tok-s1">&#39;&#39;</span>
<span class="tok-mi">10</span><span class="tok-o">.</span><span class="tok-na">times</span> <span class="tok-o">{</span>
    <span class="tok-n">cadena</span> <span class="tok-o">+=</span> <span class="tok-s1">&#39;g&#39;</span>
<span class="tok-o">}</span>
<span class="tok-k">assert</span> <span class="tok-n">cadena</span> <span class="tok-o">==</span> <span class="tok-s1">&#39;gggggggggg&#39;</span>

<span class="tok-n">cadena</span> <span class="tok-o">=</span> <span class="tok-s1">&#39;&#39;</span>
<span class="tok-mi">1</span><span class="tok-o">.</span><span class="tok-na">upto</span><span class="tok-o">(</span><span class="tok-mi">5</span><span class="tok-o">)</span> <span class="tok-o">{</span> <span class="tok-n">numero</span> <span class="tok-o">-&gt;</span>
    <span class="tok-n">cadena</span> <span class="tok-o">+=</span> <span class="tok-n">numero</span>
<span class="tok-o">}</span>

<span class="tok-k">assert</span> <span class="tok-n">cadena</span> <span class="tok-o">==</span> <span class="tok-s1">&#39;12345&#39;</span>

<span class="tok-n">cadena</span> <span class="tok-o">=</span> <span class="tok-s1">&#39;&#39;</span>
<span class="tok-mi">2</span><span class="tok-o">.</span><span class="tok-na">downto</span><span class="tok-o">(-</span><span class="tok-mi">2</span><span class="tok-o">)</span> <span class="tok-o">{</span> <span class="tok-n">numero</span> <span class="tok-o">-&gt;</span>
    <span class="tok-n">cadena</span> <span class="tok-o">+=</span> <span class="tok-n">numero</span> <span class="tok-o">+</span> <span class="tok-s1">&#39; &#39;</span>
<span class="tok-o">}</span>

<span class="tok-k">assert</span> <span class="tok-n">cadena</span> <span class="tok-o">==</span> <span class="tok-s1">&#39;2 1 0 -1 -2 &#39;</span>

<span class="tok-n">cadena</span> <span class="tok-o">=</span> <span class="tok-s1">&#39;&#39;</span>
<span class="tok-mi">0</span><span class="tok-o">.</span><span class="tok-na">step</span><span class="tok-o">(</span><span class="tok-mf">0.5</span><span class="tok-o">,</span> <span class="tok-mf">0.1</span><span class="tok-o">)</span> <span class="tok-o">{</span> <span class="tok-n">numero</span> <span class="tok-o">-&gt;</span>
    <span class="tok-n">cadena</span> <span class="tok-o">+=</span> <span class="tok-n">numero</span> <span class="tok-o">+</span> <span class="tok-s1">&#39; &#39;</span>
<span class="tok-o">}</span>

<span class="tok-k">assert</span> <span class="tok-n">cadena</span> <span class="tok-o">==</span> <span class="tok-s1">&#39;0 0.1 0.2 0.3 0.4 &#39;</span></code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_colecciones">1.6. Colecciones</h3>
<div class="paragraph">
<p>Ahora que ya hemos introducido los tipos de datos simples, llega el turno de hablar de las colecciones presentes en Groovy. En este apartado vamos a ver tres tipos de datos. Por un lado, las <em>listas</em> y los <em>mapas</em>, que tienen prÃ¡cticamente las mismas connotaciones que en Java, con alguna nueva caracterÃ­stica que aÃ±ade Groovy, y por otro, los <em>rangos</em>, un concepto que no existe en Java.</p>
</div>
<div class="sect3">
<h4 id="_rangos">1.6.1. Rangos</h4>
<div class="paragraph">
<p>Empecemos por lo novedoso. Cuantas veces no nos habremos encontrado con un bloque de cÃ³digo similar al siguiente</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span class="tok-k">for</span> <span class="tok-o">(</span><span class="tok-kt">int</span> <span class="tok-n">i</span><span class="tok-o">=</span><span class="tok-mi">0</span><span class="tok-o">;</span><span class="tok-n">i</span><span class="tok-o">&lt;</span><span class="tok-mi">10</span><span class="tok-o">;</span><span class="tok-n">i</span><span class="tok-o">++){</span>
	<span class="tok-c1">//hacer algo con la variable i</span>
<span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>El anterior fragmento de cÃ³digo se ejecutarÃ¡ empezando en un lÃ­mite inferior (0) y terminarÃ¡ de ejecutarse cuando la variable <em>i</em> llegue al valor 10. Uno de los objetivos de Groovy consiste en facilitar al programador la lectura y la comprensiÃ³n del cÃ³digo, asÃ­ que los creadores de Groovy pensaron que serÃ­a Ãºtil introducir el concepto de rango, el cual tendrÃ­a por definiciÃ³n un lÃ­mite inferior y uno superior.</p>
</div>
<div class="paragraph">
<p>Para especificar un rango, simplemente se escribe el lÃ­mite inferior seguido de dos puntos y el lÃ­mite superior, <em>limiteInferior..limiteSuperior</em>. Este rango indicarÃ­a que ambos valores establecidos estÃ¡n dentro del rango, asÃ­ que si queremos indicarle que el lÃ­mite superior no estÃ¡ dentro del rango, debemos utilizar el operador ..&lt;, <em>limiteInferior..&lt;limiteSuperior</em>. TambiÃ©n existen los <em>rangos inversos</em>, en los que el lÃ­mite inferior es mayor que el lÃ­mite superior. Veamos algunos ejemplos:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-c1">//Rangos inclusivos</span>
<span class="tok-k">assert</span> <span class="tok-o">(</span><span class="tok-mi">0</span><span class="tok-o">..</span><span class="tok-mi">10</span><span class="tok-o">).</span><span class="tok-na">contains</span><span class="tok-o">(</span><span class="tok-mi">5</span><span class="tok-o">)</span>
<span class="tok-k">assert</span> <span class="tok-o">(</span><span class="tok-mi">0</span><span class="tok-o">..</span><span class="tok-mi">10</span><span class="tok-o">).</span><span class="tok-na">contains</span><span class="tok-o">(</span><span class="tok-mi">10</span><span class="tok-o">)</span>

<span class="tok-c1">//Rangos medio-exclusivos</span>
<span class="tok-k">assert</span> <span class="tok-o">(</span><span class="tok-mi">0</span><span class="tok-o">..&lt;</span><span class="tok-mi">10</span><span class="tok-o">).</span><span class="tok-na">contains</span><span class="tok-o">(</span><span class="tok-mi">9</span><span class="tok-o">)</span>
<span class="tok-k">assert</span> <span class="tok-o">(</span><span class="tok-mi">0</span><span class="tok-o">..&lt;</span><span class="tok-mi">10</span><span class="tok-o">).</span><span class="tok-na">contains</span><span class="tok-o">(</span><span class="tok-mi">10</span><span class="tok-o">)</span> <span class="tok-o">==</span> <span class="tok-kc">false</span>

<span class="tok-c1">//ComprobaciÃ³n de tipos</span>
<span class="tok-kt">def</span> <span class="tok-n">a</span> <span class="tok-o">=</span> <span class="tok-mi">0</span><span class="tok-o">..</span><span class="tok-mi">10</span>
<span class="tok-k">assert</span> <span class="tok-n">a</span> <span class="tok-k">instanceof</span> <span class="tok-n">Range</span>

<span class="tok-c1">//DefiniciÃ³n explÃ­cita</span>
<span class="tok-n">a</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">IntRange</span><span class="tok-o">(</span><span class="tok-mi">0</span><span class="tok-o">,</span><span class="tok-mi">10</span><span class="tok-o">)</span>
<span class="tok-k">assert</span> <span class="tok-n">a</span><span class="tok-o">.</span><span class="tok-na">contains</span><span class="tok-o">(</span><span class="tok-mi">4</span><span class="tok-o">)</span>

<span class="tok-c1">//Rangos para fechas</span>
<span class="tok-kt">def</span> <span class="tok-n">hoy</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">Date</span><span class="tok-o">()</span>
<span class="tok-kt">def</span> <span class="tok-n">ayer</span> <span class="tok-o">=</span> <span class="tok-n">hoy</span> <span class="tok-o">-</span> <span class="tok-mi">1</span>
<span class="tok-k">assert</span> <span class="tok-o">(</span><span class="tok-n">ayer</span><span class="tok-o">..</span><span class="tok-na">hoy</span><span class="tok-o">).</span><span class="tok-na">size</span><span class="tok-o">()</span> <span class="tok-o">==</span> <span class="tok-mi">2</span>

<span class="tok-c1">//Rangos para caracteres</span>
<span class="tok-k">assert</span> <span class="tok-o">(</span><span class="tok-s1">&#39;a&#39;</span><span class="tok-o">..</span><span class="tok-s1">&#39;f&#39;</span><span class="tok-o">).</span><span class="tok-na">contains</span><span class="tok-o">(</span><span class="tok-s1">&#39;e&#39;</span><span class="tok-o">)</span>

<span class="tok-c1">//El bucle for con rangos</span>
<span class="tok-kt">def</span> <span class="tok-n">salida</span> <span class="tok-o">=</span> <span class="tok-s1">&#39;&#39;</span>
<span class="tok-k">for</span> <span class="tok-o">(</span><span class="tok-n">elemento</span> <span class="tok-k">in</span> <span class="tok-mi">1</span><span class="tok-o">..</span><span class="tok-mi">5</span><span class="tok-o">){</span>
    <span class="tok-n">salida</span> <span class="tok-o">+=</span> <span class="tok-n">elemento</span>
<span class="tok-o">}</span>
<span class="tok-k">assert</span> <span class="tok-n">salida</span> <span class="tok-o">==</span> <span class="tok-s1">&#39;12345&#39;</span>

<span class="tok-c1">//El bucle for con rangos inversos</span>
<span class="tok-n">salida</span> <span class="tok-o">=</span> <span class="tok-s1">&#39;&#39;</span>
<span class="tok-k">for</span> <span class="tok-o">(</span><span class="tok-n">elemento</span> <span class="tok-k">in</span> <span class="tok-mi">5</span><span class="tok-o">..</span><span class="tok-mi">1</span><span class="tok-o">){</span>
    <span class="tok-n">salida</span> <span class="tok-o">+=</span> <span class="tok-n">elemento</span>
<span class="tok-o">}</span>
<span class="tok-k">assert</span> <span class="tok-n">salida</span> <span class="tok-o">==</span> <span class="tok-s1">&#39;54321&#39;</span>

<span class="tok-c1">//SimulaciÃ³n del bucle for con rangos inversos</span>
<span class="tok-c1">//y el mÃ©todo each con un closure</span>
<span class="tok-n">salida</span> <span class="tok-o">=</span> <span class="tok-s1">&#39;&#39;</span>
<span class="tok-o">(</span><span class="tok-mi">5</span><span class="tok-o">..&lt;</span><span class="tok-mi">1</span><span class="tok-o">).</span><span class="tok-na">each</span> <span class="tok-o">{</span> <span class="tok-n">elemento</span> <span class="tok-o">-&gt;</span>
    <span class="tok-n">salida</span> <span class="tok-o">+=</span> <span class="tok-n">elemento</span>
<span class="tok-o">}</span>
<span class="tok-k">assert</span> <span class="tok-n">salida</span> <span class="tok-o">==</span> <span class="tok-s1">&#39;5432&#39;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Los rangos son objetos y como tales, pueden ser pasados como parÃ¡metros a funciones o bien ejecutar sus propios mÃ©todos. Un uso interesante de los rangos es el filtrado de datos. TambiÃ©n es interesante verlos como clasificador de grupos y su utilidad se puede comprobar en los bloques de cÃ³digo <em>switch</em>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-c1">//Rangos como clasificador de grupos</span>
<span class="tok-n">edad</span> <span class="tok-o">=</span> <span class="tok-mi">31</span>
<span class="tok-k">switch</span> <span class="tok-o">(</span><span class="tok-n">edad</span><span class="tok-o">){</span>
    <span class="tok-k">case</span> <span class="tok-mi">16</span><span class="tok-o">..</span><span class="tok-mi">20</span><span class="tok-o">:</span> <span class="tok-n">interesAplicado</span> <span class="tok-o">=</span> <span class="tok-mf">0.25</span><span class="tok-o">;</span> <span class="tok-k">break</span>
    <span class="tok-k">case</span> <span class="tok-mi">21</span><span class="tok-o">..</span><span class="tok-mi">50</span><span class="tok-o">:</span> <span class="tok-n">interesAplicado</span> <span class="tok-o">=</span> <span class="tok-mf">0.30</span><span class="tok-o">;</span> <span class="tok-k">break</span>
    <span class="tok-k">case</span> <span class="tok-mi">51</span><span class="tok-o">..</span><span class="tok-mi">65</span><span class="tok-o">:</span> <span class="tok-n">interesAplicado</span> <span class="tok-o">=</span> <span class="tok-mf">0.35</span><span class="tok-o">;</span> <span class="tok-k">break</span>
<span class="tok-o">}</span>
<span class="tok-k">assert</span> <span class="tok-n">interesAplicado</span> <span class="tok-o">==</span> <span class="tok-mf">0.30</span>

<span class="tok-c1">//Rangos para el filtrado de datos</span>
<span class="tok-n">edades</span> <span class="tok-o">=</span> <span class="tok-o">[</span><span class="tok-mi">16</span><span class="tok-o">,</span><span class="tok-mi">29</span><span class="tok-o">,</span><span class="tok-mi">34</span><span class="tok-o">,</span><span class="tok-mi">42</span><span class="tok-o">,</span><span class="tok-mi">55</span><span class="tok-o">]</span>
<span class="tok-n">joven</span> <span class="tok-o">=</span> <span class="tok-mi">16</span><span class="tok-o">..</span><span class="tok-mi">30</span>
<span class="tok-k">assert</span> <span class="tok-n">edades</span><span class="tok-o">.</span><span class="tok-na">grep</span><span class="tok-o">(</span><span class="tok-n">joven</span><span class="tok-o">)</span> <span class="tok-o">==</span> <span class="tok-o">[</span><span class="tok-mi">16</span><span class="tok-o">,</span><span class="tok-mi">29</span><span class="tok-o">]</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Como se ha podido comprobar, podemos especificar rangos para fechas e incluso para cadenas. En realidad, cualquier tipo de dato puede ser utilizado en un rango, siempre que se cumplan una serie de condiciones:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>El tipo implemente los mÃ©todos <em>next()</em> y <em>previous()</em>, que sobrecargan los operadores <em>++</em> y <em>--</em></p>
</li>
<li>
<p>El tipo implemente <em>java.lang.Comparable</em>, implementando el mÃ©todo <em>compareTo()</em> que sobrecarga el operador <em>&lt;&#8658;</em></p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_listas">1.6.2. Listas</h4>
<div class="paragraph">
<p>En Java, agregar un nuevo elemento a un array no es algo trivial. Una soluciÃ³n es convertir el array a una lista del tipo <em>java.util.List</em>, aÃ±adir el nuevo elemento y volver a convertir la lista en un array. Otra soluciÃ³n pasa por construir un nuevo array del tamaÃ±o del array original mÃ¡s uno, copiar los viejos valores y el nuevo elemento. Eso es la parte negativa de los arrays en Java. La parte positiva es que nos permite trabajar con Ã­ndices en los arrays para recuperar su informaciÃ³n, asÃ­ como modificar su valor, como por ejemplo, <em>miarray[indice] = nuevoelemento</em>. Groovy se aprovecha de la parte positiva de Java en este sentido, y aÃ±ade nuevas caracterÃ­sticas para mejorar su parte negativa.</p>
</div>
<div class="paragraph">
<p>La definiciÃ³n de una lista en Groovy se consigue utilizando los corchetes [] y especificando los valores de la lista. Si no especificamos ningÃºn valor entre los corchetes, declararemos una lista vacÃ­a. Por defecto, las listas en Groovy son del tipo <em>java.util.ArrayList</em>. Podemos rellenar fÃ¡cilmente las listas a partir de otras con el mÃ©todo <em>addAll()</em>. TambiÃ©n se pueden definir listas a partir de otras con el constructor de la clase <em>LinkedList</em>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-n">miLista</span> <span class="tok-o">=</span> <span class="tok-o">[</span><span class="tok-mi">1</span><span class="tok-o">,</span><span class="tok-mi">2</span><span class="tok-o">,</span><span class="tok-mi">3</span><span class="tok-o">]</span>

<span class="tok-k">assert</span> <span class="tok-n">miLista</span><span class="tok-o">.</span><span class="tok-na">size</span><span class="tok-o">()</span> <span class="tok-o">==</span> <span class="tok-mi">3</span>
<span class="tok-k">assert</span> <span class="tok-n">miLista</span><span class="tok-o">[</span><span class="tok-mi">2</span><span class="tok-o">]</span> <span class="tok-o">==</span> <span class="tok-mi">3</span>
<span class="tok-k">assert</span> <span class="tok-n">miLista</span> <span class="tok-k">instanceof</span> <span class="tok-n">ArrayList</span>

<span class="tok-n">listaVacia</span> <span class="tok-o">=</span> <span class="tok-o">[]</span>
<span class="tok-k">assert</span> <span class="tok-n">listaVacia</span><span class="tok-o">.</span><span class="tok-na">size</span><span class="tok-o">()</span> <span class="tok-o">==</span> <span class="tok-mi">0</span>

<span class="tok-n">listaLarga</span> <span class="tok-o">=</span> <span class="tok-o">(</span><span class="tok-mi">0</span><span class="tok-o">..</span><span class="tok-mi">1000</span><span class="tok-o">).</span><span class="tok-na">toList</span><span class="tok-o">()</span>
<span class="tok-k">assert</span> <span class="tok-n">listaLarga</span><span class="tok-o">[</span><span class="tok-mi">324</span><span class="tok-o">]</span> <span class="tok-o">==</span> <span class="tok-mi">324</span>

<span class="tok-n">listaExplicita</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">ArrayList</span><span class="tok-o">()</span>
<span class="tok-n">listaExplicita</span><span class="tok-o">.</span><span class="tok-na">addAll</span><span class="tok-o">(</span><span class="tok-n">miLista</span><span class="tok-o">)</span>
<span class="tok-k">assert</span> <span class="tok-n">listaExplicita</span><span class="tok-o">.</span><span class="tok-na">size</span><span class="tok-o">()</span> <span class="tok-o">==</span> <span class="tok-mi">3</span>
<span class="tok-n">listaExplicita</span><span class="tok-o">[</span><span class="tok-mi">2</span><span class="tok-o">]</span> <span class="tok-o">=</span> <span class="tok-mi">4</span>
<span class="tok-k">assert</span> <span class="tok-n">listaExplicita</span><span class="tok-o">[</span><span class="tok-mi">2</span><span class="tok-o">]</span> <span class="tok-o">==</span> <span class="tok-mi">4</span>

<span class="tok-n">listaExplicita</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">LinkedList</span><span class="tok-o">(</span><span class="tok-n">miLista</span><span class="tok-o">)</span>
<span class="tok-k">assert</span> <span class="tok-n">listaExplicita</span><span class="tok-o">.</span><span class="tok-na">size</span><span class="tok-o">()</span> <span class="tok-o">==</span> <span class="tok-mi">3</span>
<span class="tok-n">listaExplicita</span><span class="tok-o">[</span><span class="tok-mi">2</span><span class="tok-o">]</span> <span class="tok-o">=</span> <span class="tok-mi">4</span>
<span class="tok-k">assert</span> <span class="tok-n">listaExplicita</span><span class="tok-o">[</span><span class="tok-mi">2</span><span class="tok-o">]</span> <span class="tok-o">==</span> <span class="tok-mi">4</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>En el fragmento de cÃ³digo anterior, hemos visto como se puede especificar un valor a un elemento de la lista. Pero, Â¿quÃ© pasa si queremos especificar un mismo valor a toda la lista o un trozo de la misma? Los creadores de Groovy ya han pensado en ese problema y podemos utilizar rangos y colecciones en las listas.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-n">miLista</span> <span class="tok-o">=</span> <span class="tok-o">[</span><span class="tok-s1">&#39;a&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;b&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;c&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;d&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;e&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;f&#39;</span><span class="tok-o">]</span>

<span class="tok-k">assert</span> <span class="tok-n">miLista</span><span class="tok-o">[</span><span class="tok-mi">0</span><span class="tok-o">..</span><span class="tok-mi">2</span><span class="tok-o">]</span> <span class="tok-o">==</span> <span class="tok-o">[</span><span class="tok-s1">&#39;a&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;b&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;c&#39;</span><span class="tok-o">]</span><span class="tok-c1">//Acceso con Rangos</span>
<span class="tok-k">assert</span> <span class="tok-n">miLista</span><span class="tok-o">[</span><span class="tok-mi">0</span><span class="tok-o">,</span><span class="tok-mi">2</span><span class="tok-o">,</span><span class="tok-mi">4</span><span class="tok-o">]</span> <span class="tok-o">==</span> <span class="tok-o">[</span><span class="tok-s1">&#39;a&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;c&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;e&#39;</span><span class="tok-o">]</span><span class="tok-c1">//Acceso con colecciÃ³n de Ã­ndices</span>

<span class="tok-c1">//Modificar elementos</span>
<span class="tok-n">miLista</span><span class="tok-o">[</span><span class="tok-mi">0</span><span class="tok-o">..</span><span class="tok-mi">2</span><span class="tok-o">]</span> <span class="tok-o">=</span> <span class="tok-o">[</span><span class="tok-s1">&#39;x&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;y&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;z&#39;</span><span class="tok-o">]</span>
<span class="tok-k">assert</span> <span class="tok-n">miLista</span> <span class="tok-o">==</span> <span class="tok-o">[</span><span class="tok-s1">&#39;x&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;y&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;z&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;d&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;e&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;f&#39;</span><span class="tok-o">]</span>

<span class="tok-c1">//Eliminar elementos de la lista</span>
<span class="tok-n">miLista</span><span class="tok-o">[</span><span class="tok-mi">3</span><span class="tok-o">..</span><span class="tok-mi">5</span><span class="tok-o">]</span> <span class="tok-o">=</span> <span class="tok-o">[]</span>
<span class="tok-k">assert</span> <span class="tok-n">miLista</span> <span class="tok-o">==</span> <span class="tok-o">[</span><span class="tok-s1">&#39;x&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;y&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;z&#39;</span><span class="tok-o">]</span>

<span class="tok-c1">//AÃ±adir elementos a la lista</span>
<span class="tok-n">miLista</span><span class="tok-o">[</span><span class="tok-mi">1</span><span class="tok-o">..</span><span class="tok-mi">1</span><span class="tok-o">]</span> <span class="tok-o">=</span> <span class="tok-o">[</span><span class="tok-s1">&#39;y&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;1&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;2&#39;</span><span class="tok-o">]</span>
<span class="tok-k">assert</span> <span class="tok-n">miLista</span> <span class="tok-o">==</span> <span class="tok-o">[</span><span class="tok-s1">&#39;x&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;y&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;1&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;2&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;z&#39;</span><span class="tok-o">]</span>

<span class="tok-n">miLista</span> <span class="tok-o">=</span> <span class="tok-o">[]</span>

<span class="tok-c1">//AÃ±ado objetos a la lista con el operador +</span>
<span class="tok-n">miLista</span> <span class="tok-o">+=</span> <span class="tok-s1">&#39;a&#39;</span>
<span class="tok-k">assert</span> <span class="tok-n">miLista</span> <span class="tok-o">==</span> <span class="tok-o">[</span><span class="tok-s1">&#39;a&#39;</span><span class="tok-o">]</span>

<span class="tok-c1">//AÃ±ado colecciones a la lista con el operador +</span>
<span class="tok-n">miLista</span> <span class="tok-o">+=</span> <span class="tok-o">[</span><span class="tok-s1">&#39;b&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;c&#39;</span><span class="tok-o">]</span>
<span class="tok-k">assert</span> <span class="tok-n">miLista</span> <span class="tok-o">==</span> <span class="tok-o">[</span><span class="tok-s1">&#39;a&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;b&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;c&#39;</span><span class="tok-o">]</span>

<span class="tok-n">miLista</span> <span class="tok-o">=</span> <span class="tok-o">[]</span>
<span class="tok-n">miLista</span> <span class="tok-o">&lt;&lt;</span> <span class="tok-s1">&#39;a&#39;</span> <span class="tok-o">&lt;&lt;</span> <span class="tok-s1">&#39;b&#39;</span>
<span class="tok-k">assert</span> <span class="tok-n">miLista</span> <span class="tok-o">==</span> <span class="tok-o">[</span><span class="tok-s1">&#39;a&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;b&#39;</span><span class="tok-o">]</span>

<span class="tok-k">assert</span> <span class="tok-n">miLista</span> <span class="tok-o">-</span> <span class="tok-o">[</span><span class="tok-s1">&#39;b&#39;</span><span class="tok-o">]</span> <span class="tok-o">==</span> <span class="tok-o">[</span><span class="tok-s1">&#39;a&#39;</span><span class="tok-o">]</span>

<span class="tok-k">assert</span> <span class="tok-n">miLista</span> <span class="tok-o">*</span> <span class="tok-mi">2</span> <span class="tok-o">==</span> <span class="tok-o">[</span><span class="tok-s1">&#39;a&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;b&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;a&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;b&#39;</span><span class="tok-o">]</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>En ocasiones las listas son utilizadas juntos a estructuras de control para controlar el flujo de nuestro programa.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-n">miLista</span> <span class="tok-o">=</span> <span class="tok-o">[</span><span class="tok-s1">&#39;a&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;b&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;c&#39;</span><span class="tok-o">]</span>

<span class="tok-c1">//Listas como clasificador de grupos</span>
<span class="tok-n">letra</span> <span class="tok-o">=</span> <span class="tok-s1">&#39;a&#39;</span>
<span class="tok-k">switch</span> <span class="tok-o">(</span><span class="tok-n">letra</span><span class="tok-o">){</span>
    <span class="tok-k">case</span> <span class="tok-nl">miLista:</span> <span class="tok-k">assert</span> <span class="tok-kc">true</span><span class="tok-o">;</span> <span class="tok-k">break</span><span class="tok-o">;</span>
    <span class="tok-k">default</span><span class="tok-o">:</span> <span class="tok-k">assert</span> <span class="tok-kc">false</span>
<span class="tok-o">}</span>

<span class="tok-c1">//Listas como filtrado de datos</span>
<span class="tok-k">assert</span> <span class="tok-o">[</span><span class="tok-s1">&#39;x&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;y&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;a&#39;</span><span class="tok-o">].</span><span class="tok-na">grep</span><span class="tok-o">(</span><span class="tok-n">miLista</span><span class="tok-o">)</span> <span class="tok-o">==</span> <span class="tok-o">[</span><span class="tok-s1">&#39;a&#39;</span><span class="tok-o">]</span>

<span class="tok-c1">//Bucle for con lista</span>
<span class="tok-n">salida</span> <span class="tok-o">=</span> <span class="tok-s1">&#39;&#39;</span>
<span class="tok-k">for</span> <span class="tok-o">(</span><span class="tok-n">i</span> <span class="tok-k">in</span> <span class="tok-n">miLista</span><span class="tok-o">){</span>
    <span class="tok-n">salida</span> <span class="tok-o">+=</span> <span class="tok-n">i</span>
<span class="tok-o">}</span>
<span class="tok-k">assert</span> <span class="tok-n">salida</span> <span class="tok-o">==</span> <span class="tok-s1">&#39;abc&#39;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Las listas tienen una larga lista de mÃ©todos disponibles en el API de Java en la interfaz <em>java.util.List</em> para por ejemplo ordenar, unir e intersectar listas.</p>
</div>
</div>
<div class="sect3">
<h4 id="_mapas">1.6.3. Mapas</h4>
<div class="paragraph">
<p>Un mapa es prÃ¡cticamente igual que una lista, con la salvedad de que los elementos estÃ¡n referenciados a partir de una clave Ãºnica (sin caracteres extraÃ±os ni palabras reservadas por Groovy), <em>miMapa['clave'] = valor</em>. Podemos especificar un mapa al igual que lo hacÃ­amos con las listas utilizando los corchetes, pero ahora debemos aÃ±adir la clave a cada valor introducido, como por ejemplo <em>miMapa = [a:1, b:2, c:3]</em>. Los mapas creados implÃ­citamente son del tipo <em>java.util.HashMap</em>. VeÃ¡moslo con ejemplos:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-kt">def</span> <span class="tok-n">miMapa</span> <span class="tok-o">=</span> <span class="tok-o">[</span><span class="tok-nl">a:</span><span class="tok-mi">1</span><span class="tok-o">,</span> <span class="tok-nl">b:</span><span class="tok-mi">2</span><span class="tok-o">,</span> <span class="tok-nl">c:</span><span class="tok-mi">3</span><span class="tok-o">]</span>

<span class="tok-k">assert</span> <span class="tok-n">miMapa</span> <span class="tok-k">instanceof</span> <span class="tok-n">HashMap</span>
<span class="tok-k">assert</span> <span class="tok-n">miMapa</span><span class="tok-o">.</span><span class="tok-na">size</span><span class="tok-o">()</span> <span class="tok-o">==</span> <span class="tok-mi">3</span>
<span class="tok-k">assert</span> <span class="tok-n">miMapa</span><span class="tok-o">[</span><span class="tok-s1">&#39;a&#39;</span><span class="tok-o">]</span> <span class="tok-o">==</span> <span class="tok-mi">1</span>

<span class="tok-c1">//Definimos un mapa vacio</span>
<span class="tok-kt">def</span> <span class="tok-n">mapaVacio</span> <span class="tok-o">=</span> <span class="tok-o">[:]</span>
<span class="tok-k">assert</span> <span class="tok-n">mapaVacio</span><span class="tok-o">.</span><span class="tok-na">size</span><span class="tok-o">()</span> <span class="tok-o">==</span> <span class="tok-mi">0</span>

<span class="tok-c1">//Definimos un mapa de la clase TreeMap</span>
<span class="tok-kt">def</span> <span class="tok-n">mapaExplicito</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">TreeMap</span><span class="tok-o">()</span>
<span class="tok-n">mapaExplicito</span><span class="tok-o">.</span><span class="tok-na">putAll</span><span class="tok-o">(</span><span class="tok-n">miMapa</span><span class="tok-o">)</span>
<span class="tok-k">assert</span> <span class="tok-n">mapaExplicito</span><span class="tok-o">[</span><span class="tok-s1">&#39;c&#39;</span><span class="tok-o">]</span> <span class="tok-o">==</span> <span class="tok-mi">3</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Las operaciones mÃ¡s comunes con los mapas se refieren a la recuperaciÃ³n y almacenamiento de datos a partir de la clave. Veamos algunos mÃ©todos de acceso y modificaciÃ³n de los elementos de un mapa:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-kt">def</span> <span class="tok-n">miMapa</span> <span class="tok-o">=</span> <span class="tok-o">[</span><span class="tok-nl">a:</span><span class="tok-mi">1</span><span class="tok-o">,</span> <span class="tok-nl">b:</span><span class="tok-mi">2</span><span class="tok-o">,</span> <span class="tok-nl">c:</span><span class="tok-mi">3</span><span class="tok-o">]</span>

<span class="tok-c1">//Varias formas de obtener los valores de un mapa</span>
<span class="tok-k">assert</span> <span class="tok-n">miMapa</span><span class="tok-o">[</span><span class="tok-s1">&#39;a&#39;</span><span class="tok-o">]</span> <span class="tok-o">==</span> <span class="tok-mi">1</span>
<span class="tok-k">assert</span> <span class="tok-n">miMapa</span><span class="tok-o">.</span><span class="tok-na">a</span> <span class="tok-o">==</span> <span class="tok-mi">1</span>
<span class="tok-k">assert</span> <span class="tok-n">miMapa</span><span class="tok-o">.</span><span class="tok-na">get</span><span class="tok-o">(</span><span class="tok-s1">&#39;a&#39;</span><span class="tok-o">)</span> <span class="tok-o">==</span> <span class="tok-mi">1</span>
<span class="tok-c1">//Si no existe la clave, devuelve un valor por defecto, en este caso 0</span>
<span class="tok-k">assert</span> <span class="tok-n">miMapa</span><span class="tok-o">.</span><span class="tok-na">get</span><span class="tok-o">(</span><span class="tok-s1">&#39;a&#39;</span><span class="tok-o">,</span><span class="tok-mi">0</span><span class="tok-o">)</span> <span class="tok-o">==</span> <span class="tok-mi">1</span>

<span class="tok-c1">//AsignaciÃ³n de valores</span>
<span class="tok-n">miMapa</span><span class="tok-o">[</span><span class="tok-s1">&#39;d&#39;</span><span class="tok-o">]</span> <span class="tok-o">=</span> <span class="tok-mi">4</span>
<span class="tok-k">assert</span> <span class="tok-n">miMapa</span><span class="tok-o">.</span><span class="tok-na">d</span> <span class="tok-o">==</span> <span class="tok-mi">4</span>
<span class="tok-n">miMapa</span><span class="tok-o">.</span><span class="tok-na">e</span> <span class="tok-o">=</span> <span class="tok-mi">5</span>
<span class="tok-k">assert</span> <span class="tok-n">miMapa</span><span class="tok-o">.</span><span class="tok-na">e</span> <span class="tok-o">==</span> <span class="tok-mi">5</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Los mapas en Groovy utilizan los mismos mÃ©todos que los mapas en Java y Ã©stos estÃ¡n en el API de Java referente a <em>java.util.Map</em>, pero ademÃ¡s, Groovy aÃ±ade un par de mÃ©todos llamados <em>any()</em> y <em>every()</em>, los cuales, utilizados como closures, permite evaluar si todos (every) o al menos uno (any) de los elementos del mapa cumplen una determinada condiciÃ³n. AdemÃ¡s, en el siguiente fragmento de cÃ³digo, vamos a ver como iterar sobre los mapas.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-kt">def</span> <span class="tok-n">miMapa</span> <span class="tok-o">=</span> <span class="tok-o">[</span><span class="tok-nl">a:</span><span class="tok-mi">1</span><span class="tok-o">,</span> <span class="tok-nl">b:</span><span class="tok-mi">2</span><span class="tok-o">,</span> <span class="tok-nl">c:</span><span class="tok-mi">3</span><span class="tok-o">]</span>

<span class="tok-kt">def</span> <span class="tok-n">resultado</span> <span class="tok-o">=</span> <span class="tok-s1">&#39;&#39;</span>
<span class="tok-n">miMapa</span><span class="tok-o">.</span><span class="tok-na">each</span> <span class="tok-o">{</span> <span class="tok-n">item</span> <span class="tok-o">-&gt;</span>
    <span class="tok-n">resultado</span> <span class="tok-o">+=</span> <span class="tok-n">item</span><span class="tok-o">.</span><span class="tok-na">key</span> <span class="tok-o">+</span> <span class="tok-s1">&#39;:&#39;</span>
    <span class="tok-n">resultado</span> <span class="tok-o">+=</span> <span class="tok-n">item</span><span class="tok-o">.</span><span class="tok-na">value</span> <span class="tok-o">+</span> <span class="tok-s1">&#39;, &#39;</span>
<span class="tok-o">}</span>
<span class="tok-k">assert</span> <span class="tok-n">resultado</span> <span class="tok-o">==</span> <span class="tok-s1">&#39;a:1, b:2, c:3, &#39;</span>

<span class="tok-n">resultado</span> <span class="tok-o">=</span> <span class="tok-s1">&#39;&#39;</span>
<span class="tok-n">miMapa</span><span class="tok-o">.</span><span class="tok-na">each</span> <span class="tok-o">{</span> <span class="tok-n">key</span><span class="tok-o">,</span> <span class="tok-n">value</span> <span class="tok-o">-&gt;</span>
    <span class="tok-n">resultado</span> <span class="tok-o">+=</span> <span class="tok-n">key</span> <span class="tok-o">+</span> <span class="tok-s1">&#39;:&#39;</span>
    <span class="tok-n">resultado</span> <span class="tok-o">+=</span> <span class="tok-n">value</span> <span class="tok-o">+</span> <span class="tok-s1">&#39;, &#39;</span>
<span class="tok-o">}</span>
<span class="tok-k">assert</span> <span class="tok-n">resultado</span> <span class="tok-o">==</span> <span class="tok-s1">&#39;a:1, b:2, c:3, &#39;</span>

<span class="tok-n">resultado</span> <span class="tok-o">=</span> <span class="tok-s1">&#39;&#39;</span>
<span class="tok-k">for</span> <span class="tok-o">(</span><span class="tok-n">key</span> <span class="tok-k">in</span> <span class="tok-n">miMapa</span><span class="tok-o">.</span><span class="tok-na">keySet</span><span class="tok-o">()){</span>
    <span class="tok-n">resultado</span> <span class="tok-o">+=</span> <span class="tok-n">key</span> <span class="tok-o">+</span> <span class="tok-s1">&#39;:&#39;</span>
    <span class="tok-n">resultado</span> <span class="tok-o">+=</span> <span class="tok-n">miMapa</span><span class="tok-o">[</span><span class="tok-n">key</span><span class="tok-o">]</span> <span class="tok-o">+</span> <span class="tok-s1">&#39;, &#39;</span>
<span class="tok-o">}</span>
<span class="tok-k">assert</span> <span class="tok-n">resultado</span> <span class="tok-o">==</span> <span class="tok-s1">&#39;a:1, b:2, c:3, &#39;</span>

<span class="tok-n">resultado</span> <span class="tok-o">=</span> <span class="tok-s1">&#39;&#39;</span>
<span class="tok-k">for</span> <span class="tok-o">(</span><span class="tok-n">value</span> <span class="tok-k">in</span> <span class="tok-n">miMapa</span><span class="tok-o">.</span><span class="tok-na">values</span><span class="tok-o">()){</span>
    <span class="tok-n">resultado</span> <span class="tok-o">+=</span> <span class="tok-n">value</span> <span class="tok-o">+</span> <span class="tok-s1">&#39; &#39;</span>
<span class="tok-o">}</span>
<span class="tok-k">assert</span> <span class="tok-n">resultado</span> <span class="tok-o">==</span> <span class="tok-s1">&#39;1 2 3 &#39;</span>

<span class="tok-kt">def</span> <span class="tok-n">valor1</span> <span class="tok-o">=</span> <span class="tok-o">[</span><span class="tok-mi">1</span><span class="tok-o">,</span> <span class="tok-mi">2</span><span class="tok-o">,</span> <span class="tok-mi">3</span><span class="tok-o">].</span><span class="tok-na">every</span> <span class="tok-o">{</span> <span class="tok-n">it</span> <span class="tok-o">&lt;</span> <span class="tok-mi">5</span> <span class="tok-o">}</span>
<span class="tok-k">assert</span> <span class="tok-n">valor1</span>

<span class="tok-kt">def</span> <span class="tok-n">valor2</span> <span class="tok-o">=</span> <span class="tok-o">[</span><span class="tok-mi">1</span><span class="tok-o">,</span> <span class="tok-mi">2</span><span class="tok-o">,</span> <span class="tok-mi">3</span><span class="tok-o">].</span><span class="tok-na">any</span> <span class="tok-o">{</span> <span class="tok-n">it</span> <span class="tok-o">&gt;</span> <span class="tok-mi">2</span> <span class="tok-o">}</span>
<span class="tok-k">assert</span> <span class="tok-n">valor2</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Y para terminar con los mapas, vamos a ver otros mÃ©todos aÃ±adidos por Groovy para el manejo de los mapas, que nos permitirÃ¡n:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Crear un submapa de un mapa dado a partir de algunas claves: <em>subMap()</em></p>
</li>
<li>
<p>Encontrar todos los elementos de un mapa que cumplen una determinada condiciÃ³n: <em>findAll()</em></p>
</li>
<li>
<p>Encontrar un elemento de un mapa que cumpla una determinada condiciÃ³n: <em>find()</em></p>
</li>
<li>
<p>Realizar operaciones sobre los elementos de un mapa: <em>collect()</em></p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-kt">def</span> <span class="tok-n">miMapa</span> <span class="tok-o">=</span> <span class="tok-o">[</span><span class="tok-nl">a:</span><span class="tok-mi">1</span><span class="tok-o">,</span> <span class="tok-nl">b:</span><span class="tok-mi">2</span><span class="tok-o">,</span> <span class="tok-nl">c:</span><span class="tok-mi">3</span><span class="tok-o">]</span>
<span class="tok-kt">def</span> <span class="tok-n">miSubmapa</span> <span class="tok-o">=</span> <span class="tok-n">miMapa</span><span class="tok-o">.</span><span class="tok-na">subMap</span><span class="tok-o">([</span><span class="tok-s1">&#39;a&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;b&#39;</span><span class="tok-o">])</span>
<span class="tok-k">assert</span> <span class="tok-n">miSubmapa</span><span class="tok-o">.</span><span class="tok-na">size</span><span class="tok-o">()</span> <span class="tok-o">==</span> <span class="tok-mi">2</span>

<span class="tok-kt">def</span> <span class="tok-n">miOtromapa</span> <span class="tok-o">=</span> <span class="tok-n">miMapa</span><span class="tok-o">.</span><span class="tok-na">findAll</span> <span class="tok-o">{</span> <span class="tok-n">entry</span> <span class="tok-o">-&gt;</span> <span class="tok-n">entry</span><span class="tok-o">.</span><span class="tok-na">value</span> <span class="tok-o">&gt;</span> <span class="tok-mi">1</span> <span class="tok-o">}</span>
<span class="tok-k">assert</span> <span class="tok-n">miOtromapa</span><span class="tok-o">.</span><span class="tok-na">size</span><span class="tok-o">()</span> <span class="tok-o">==</span> <span class="tok-mi">2</span>
<span class="tok-k">assert</span> <span class="tok-n">miOtromapa</span><span class="tok-o">.</span><span class="tok-na">c</span> <span class="tok-o">==</span> <span class="tok-mi">3</span>

<span class="tok-kt">def</span> <span class="tok-n">encontrado</span> <span class="tok-o">=</span> <span class="tok-n">miMapa</span><span class="tok-o">.</span><span class="tok-na">find</span> <span class="tok-o">{</span> <span class="tok-n">entry</span> <span class="tok-o">-&gt;</span> <span class="tok-n">entry</span><span class="tok-o">.</span><span class="tok-na">value</span> <span class="tok-o">&lt;</span> <span class="tok-mi">3</span><span class="tok-o">}</span>
<span class="tok-k">assert</span> <span class="tok-n">encontrado</span><span class="tok-o">.</span><span class="tok-na">key</span> <span class="tok-o">==</span> <span class="tok-s1">&#39;a&#39;</span>
<span class="tok-k">assert</span> <span class="tok-n">encontrado</span><span class="tok-o">.</span><span class="tok-na">value</span> <span class="tok-o">==</span> <span class="tok-mi">1</span>

<span class="tok-kt">def</span> <span class="tok-n">miMapaDoble</span> <span class="tok-o">=</span> <span class="tok-n">miMapa</span><span class="tok-o">.</span><span class="tok-na">collect</span> <span class="tok-o">{</span> <span class="tok-n">entry</span> <span class="tok-o">-&gt;</span> <span class="tok-n">entry</span><span class="tok-o">.</span><span class="tok-na">value</span> <span class="tok-o">*=</span> <span class="tok-mi">2</span><span class="tok-o">}</span>
<span class="tok-c1">//Todos los elementos son pares</span>
<span class="tok-k">assert</span> <span class="tok-n">miMapaDoble</span><span class="tok-o">.</span><span class="tok-na">every</span> <span class="tok-o">{</span> <span class="tok-n">item</span> <span class="tok-o">-&gt;</span> <span class="tok-n">item</span> <span class="tok-o">%</span> <span class="tok-mi">2</span> <span class="tok-o">==</span> <span class="tok-mi">0</span> <span class="tok-o">}</span></code></pre>
</div>
</div>
<div style="page-break-after: always;"></div>
</div>
</div>
<div class="sect2">
<h3 id="_ejercicios">1.7. Ejercicios</h3>
<div class="sect3">
<h4 id="_de_java_a_groovy_0_25_puntos">1.7.1. De Java a Groovy (0.25 puntos)</h4>
<div class="paragraph">
<p>Modificar la siguiente clase en Java para convertirla en una clase en Groovy y que quede lo mÃ¡s simplificada posible con la misma funcionalidad.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span class="tok-kn">import</span> <span class="tok-nn">java.util.List</span><span class="tok-o">;</span>
<span class="tok-kn">import</span> <span class="tok-nn">java.util.ArrayList</span><span class="tok-o">;</span>
<span class="tok-kn">import</span> <span class="tok-nn">java.util.Iterator</span><span class="tok-o">;</span>

<span class="tok-kd">public</span> <span class="tok-kd">class</span> <span class="tok-nc">Todo</span> <span class="tok-o">{</span>
    <span class="tok-kd">private</span> <span class="tok-n">String</span> <span class="tok-n">titulo</span><span class="tok-o">;</span>
    <span class="tok-kd">private</span> <span class="tok-n">String</span> <span class="tok-n">descripcion</span><span class="tok-o">;</span>

    <span class="tok-kd">public</span> <span class="tok-nf">Todo</span><span class="tok-o">()</span> <span class="tok-o">{}</span>

    <span class="tok-kd">public</span> <span class="tok-nf">Todo</span><span class="tok-o">(</span><span class="tok-n">String</span> <span class="tok-n">tit</span><span class="tok-o">,</span> <span class="tok-n">String</span> <span class="tok-n">des</span><span class="tok-o">)</span> <span class="tok-o">{</span>
        <span class="tok-k">this</span><span class="tok-o">.</span><span class="tok-na">titulo</span> <span class="tok-o">=</span> <span class="tok-n">tit</span><span class="tok-o">;</span>
        <span class="tok-k">this</span><span class="tok-o">.</span><span class="tok-na">descripcion</span> <span class="tok-o">=</span> <span class="tok-n">des</span><span class="tok-o">;</span>
    <span class="tok-o">}</span>

    <span class="tok-kd">public</span> <span class="tok-n">String</span> <span class="tok-nf">getTitulo</span><span class="tok-o">(){</span>
        <span class="tok-k">return</span> <span class="tok-n">titulo</span><span class="tok-o">;</span>
    <span class="tok-o">}</span>

    <span class="tok-kd">public</span> <span class="tok-kt">void</span> <span class="tok-nf">setTitulo</span><span class="tok-o">(</span><span class="tok-n">String</span> <span class="tok-n">tit</span><span class="tok-o">){</span>
        <span class="tok-k">this</span><span class="tok-o">.</span><span class="tok-na">titulo</span> <span class="tok-o">=</span> <span class="tok-n">tit</span><span class="tok-o">;</span>
    <span class="tok-o">}</span>

    <span class="tok-kd">public</span> <span class="tok-n">String</span> <span class="tok-nf">getDescripcion</span><span class="tok-o">(){</span>
        <span class="tok-k">return</span> <span class="tok-n">descripcion</span><span class="tok-o">;</span>
    <span class="tok-o">}</span>

    <span class="tok-kd">public</span> <span class="tok-kt">void</span> <span class="tok-nf">setDescripcion</span><span class="tok-o">(</span><span class="tok-n">String</span> <span class="tok-n">des</span><span class="tok-o">){</span>
        <span class="tok-k">this</span><span class="tok-o">.</span><span class="tok-na">descripcion</span> <span class="tok-o">=</span> <span class="tok-n">des</span><span class="tok-o">;</span>
    <span class="tok-o">}</span>

    <span class="tok-kd">public</span> <span class="tok-kd">static</span> <span class="tok-kt">void</span> <span class="tok-nf">main</span> <span class="tok-o">(</span><span class="tok-n">String</span><span class="tok-o">[]</span> <span class="tok-n">args</span><span class="tok-o">){</span>
        <span class="tok-n">List</span> <span class="tok-n">todos</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-nf">ArrayList</span><span class="tok-o">();</span>
        <span class="tok-n">todos</span><span class="tok-o">.</span><span class="tok-na">add</span><span class="tok-o">(</span><span class="tok-k">new</span> <span class="tok-nf">Todo</span><span class="tok-o">(</span><span class="tok-s">&quot;Lavadora&quot;</span><span class="tok-o">,</span><span class="tok-s">&quot;Poner lavadora&quot;</span><span class="tok-o">));</span>
        <span class="tok-n">todos</span><span class="tok-o">.</span><span class="tok-na">add</span><span class="tok-o">(</span><span class="tok-k">new</span> <span class="tok-nf">Todo</span><span class="tok-o">(</span><span class="tok-s">&quot;Impresora&quot;</span><span class="tok-o">,</span><span class="tok-s">&quot;Comprar cartuchos impresora&quot;</span><span class="tok-o">));</span>
        <span class="tok-n">todos</span><span class="tok-o">.</span><span class="tok-na">add</span><span class="tok-o">(</span><span class="tok-k">new</span> <span class="tok-nf">Todo</span><span class="tok-o">(</span><span class="tok-s">&quot;PelÃ­culas&quot;</span><span class="tok-o">,</span><span class="tok-s">&quot;Devolver pelÃ­culas videoclub&quot;</span><span class="tok-o">));</span>

        <span class="tok-k">for</span> <span class="tok-o">(</span><span class="tok-n">Iterator</span> <span class="tok-n">iter</span> <span class="tok-o">=</span> <span class="tok-n">todos</span><span class="tok-o">.</span><span class="tok-na">iterator</span><span class="tok-o">();</span><span class="tok-n">iter</span><span class="tok-o">.</span><span class="tok-na">hasNext</span><span class="tok-o">();)</span> <span class="tok-o">{</span>
            <span class="tok-n">Todo</span> <span class="tok-n">todo</span> <span class="tok-o">=</span> <span class="tok-o">(</span><span class="tok-n">Todo</span><span class="tok-o">)</span><span class="tok-n">iter</span><span class="tok-o">.</span><span class="tok-na">next</span><span class="tok-o">();</span>
            <span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">out</span><span class="tok-o">.</span><span class="tok-na">println</span><span class="tok-o">(</span><span class="tok-n">todo</span><span class="tok-o">.</span><span class="tok-na">getTitulo</span><span class="tok-o">()+</span><span class="tok-s">&quot; &quot;</span><span class="tok-o">+</span><span class="tok-n">todo</span><span class="tok-o">.</span><span class="tok-na">getDescripcion</span><span class="tok-o">());</span>
        <span class="tok-o">}</span>
    <span class="tok-o">}</span>
<span class="tok-o">}</span></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_groovybeans_0_50_puntos">1.7.2. GroovyBeans (0.50 puntos)</h4>
<div class="paragraph">
<p>Crear la clase <em>Libro</em> con las propiedades mÃ­nimas necesarias que lo describan. La informaciÃ³n a almacenar de estos libros serÃ¡ el <em>nombre</em> del libro, el <em>aÃ±o de ediciÃ³n</em> y el <em>autor</em> del mismo.</p>
</div>
<div class="paragraph">
<p>Simplemente crearemos un constructor de la clase <em>Libro</em> que permita especificar las tres propiedades de la clase (nombre, aÃ±o de ediciÃ³n y autor). Para comprobar que nuestra clase funciona correctamente, insertaremos los siguientes ejemplos de libros:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Nombre: La colmena, aÃ±o de ediciÃ³n: 1951, autor: Cela Trulock, Camilo JosÃ©</p>
</li>
<li>
<p>Nombre: La galatea, aÃ±o de ediciÃ³n: 1585, autor: de Cervantes Saavedra, Miguel</p>
</li>
<li>
<p>Nombre: La dorotea, aÃ±o de ediciÃ³n: 1632, autor: Lope de Vega y Carpio, FÃ©lix Arturo</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Posteriormente comprueba que se han insertado correctamente cada uno de los libros indicados anteriormente mediante el uso de sentencias <em>asserts</em> y las funciones tipo <em>getter()</em> generadas automÃ¡ticamente en Groovy</p>
</div>
<div class="paragraph">
<p>A continuaciÃ³n aÃ±ade una nueva propiedad a la clase <em>Libro</em> para almacenar la editorial de los libros. Sin modificar la inserciÃ³n de libros realizada anteriormente, inserta la editorial de cada uno de los libros utilizando los <em>setters()</em> definidos automÃ¡ticamente por Groovy. Comprueba que los cambios se han efectuado correctamente nuevamente mediante la utilizaciÃ³n de <em>asserts</em>.</p>
</div>
<div class="paragraph">
<p>Por Ãºltimo, modifica el comportamiento del &lt;em&gt;getter()&lt;/em&gt; correspondiente a la propiedad <em>autor</em> para que modifique su comportamiento por defecto y devuelva en su lugar el autor del libro con el formato nombre y apellidos.</p>
</div>
<div class="paragraph">
<p>Como siempre, comprueba que el nuevo mÃ©todo funciona correctamente mediante la utilizaciÃ³n de &lt;em&gt;assert&lt;/em&gt;.</p>
</div>
</div>
<div class="sect3">
<h4 id="_expresiones_regulares_0_5_puntos">1.7.3. Expresiones regulares (0.5 puntos)</h4>
<div class="paragraph">
<p>Crea un script en Groovy que permite agrupar las palabras que aparecen en un pÃ¡rrafo en funciÃ³n del nÃºmero de letras que contengan. Almacenaremos este catÃ¡logo de palabras en un mapa cuya clave serÃ¡ el tamaÃ±o y el valor serÃ¡ una lista con todas las palabras de ese mismo tamaÃ±o.</p>
</div>
<div class="paragraph">
<p>El pÃ¡rrafo a analizar serÃ¡ el inicio de <em>El Ingenioso Hidalgo Don Quijote de la Mancha</em>:</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>En un lugar de la Mancha, de cuyo nombre no quiero acordarme, no ha mucho tiempo que vivÃ­a un hidalgo de los de lanza en astillero, adarga antigua, rocÃ­n flaco y galgo corredor. Una olla de algo mÃ¡s vaca que carnero, salpicÃ³n las mÃ¡s noches, duelos y quebrantos los sÃ¡bados, lentejas los viernes, algÃºn palomino de aÃ±adidura los domingos, consumÃ­an las tres partes de su hacienda. El resto della concluÃ­an sayo de velarte, calzas de velludo para las fiestas con sus pantuflos de lo mismo, los dÃ­as de entre semana se honraba con su vellori de lo mÃ¡s fino. TenÃ­a en su casa una ama que pasaba de los cuarenta, y una sobrina que no llegaba a los veinte, y un mozo de campo y plaza, que asÃ­ ensillaba el rocÃ­n como tomaba la podadera. Frisaba la edad de nuestro hidalgo con los cincuenta aÃ±os, era de complexiÃ³n recia, seco de carnes, enjuto de rostro; gran madrugador y amigo de la caza. Quieren decir que tenÃ­a el sobrenombre de Quijada o Quesada (que en esto hay alguna diferencia en los autores que deste caso escriben), aunque por conjeturas verosÃ­miles se deja entender que se llama Quijana; pero esto importa poco a nuestro cuento; basta que en la narraciÃ³n dÃ©l no se salga un punto de la verdad.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Para comprobar si tu script funciona correctamente, puedes aÃ±adir estas lÃ­neas:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-k">assert</span> <span class="tok-n">palabras</span><span class="tok-o">[</span><span class="tok-mi">1</span><span class="tok-o">]</span> <span class="tok-o">==</span> <span class="tok-o">[</span><span class="tok-s1">&#39;y&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;a&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;o&#39;</span><span class="tok-o">]</span>
<span class="tok-k">assert</span> <span class="tok-n">palabras</span><span class="tok-o">[</span><span class="tok-mi">2</span><span class="tok-o">]</span> <span class="tok-o">==</span> <span class="tok-o">[</span><span class="tok-s1">&#39;en&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;un&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;de&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;la&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;no&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;ha&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;su&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;el&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;lo&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;se&#39;</span><span class="tok-o">]</span>
<span class="tok-k">assert</span> <span class="tok-n">palabras</span><span class="tok-o">[</span><span class="tok-mi">3</span><span class="tok-o">]</span> <span class="tok-o">==</span> <span class="tok-o">[</span><span class="tok-s1">&#39;que&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;los&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;una&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;mÃ¡s&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;las&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;con&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;sus&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;ama&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;asÃ­&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;era&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;hay&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;por&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;dÃ©l&#39;</span><span class="tok-o">]</span>
<span class="tok-k">assert</span> <span class="tok-n">palabras</span><span class="tok-o">[</span><span class="tok-mi">4</span><span class="tok-o">]</span> <span class="tok-o">==</span> <span class="tok-o">[</span><span class="tok-s1">&#39;cuyo&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;olla&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;algo&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;vaca&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;tres&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;sayo&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;para&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;dÃ­as&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;fino&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;casa&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;mozo&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;como&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;edad&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;aÃ±os&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;seco&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;gran&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;caza&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;esto&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;caso&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;deja&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;pero&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;poco&#39;</span><span class="tok-o">]</span>
<span class="tok-k">assert</span> <span class="tok-n">palabras</span><span class="tok-o">[</span><span class="tok-mi">5</span><span class="tok-o">]</span> <span class="tok-o">==</span> <span class="tok-o">[</span><span class="tok-s1">&#39;lugar&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;mucho&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;vivÃ­a&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;lanza&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;rocÃ­n&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;flaco&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;galgo&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;algÃºn&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;resto&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;della&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;mismo&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;entre&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;tenÃ­a&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;campo&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;plaza&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;recia&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;amigo&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;decir&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;deste&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;llama&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;basta&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;salga&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;punto&#39;</span><span class="tok-o">]</span>
<span class="tok-k">assert</span> <span class="tok-n">palabras</span><span class="tok-o">[</span><span class="tok-mi">6</span><span class="tok-o">]</span> <span class="tok-o">==</span> <span class="tok-o">[</span><span class="tok-s1">&#39;mancha&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;nombre&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;quiero&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;tiempo&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;adarga&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;noches&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;duelos&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;partes&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;calzas&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;semana&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;pasaba&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;veinte&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;tomaba&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;carnes&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;enjuto&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;rostro&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;alguna&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;aunque&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;cuento&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;verdad&#39;</span><span class="tok-o">]</span>
<span class="tok-k">assert</span> <span class="tok-n">palabras</span><span class="tok-o">[</span><span class="tok-mi">7</span><span class="tok-o">]</span> <span class="tok-o">==</span> <span class="tok-o">[</span><span class="tok-s1">&#39;hidalgo&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;antigua&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;carnero&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;sÃ¡bados&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;viernes&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;velarte&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;velludo&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;fiestas&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;honraba&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;vellori&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;sobrina&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;llegaba&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;frisaba&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;nuestro&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;quieren&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;quijada&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;quesada&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;autores&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;quijana&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;importa&#39;</span><span class="tok-o">]</span>
<span class="tok-k">assert</span> <span class="tok-n">palabras</span><span class="tok-o">[</span><span class="tok-mi">8</span><span class="tok-o">]</span> <span class="tok-o">==</span> <span class="tok-o">[</span><span class="tok-s1">&#39;corredor&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;salpicÃ³n&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;lentejas&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;palomino&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;domingos&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;hacienda&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;cuarenta&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;podadera&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;escriben&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;entender&#39;</span><span class="tok-o">]</span>
<span class="tok-k">assert</span> <span class="tok-n">palabras</span><span class="tok-o">[</span><span class="tok-mi">9</span><span class="tok-o">]</span> <span class="tok-o">==</span> <span class="tok-o">[</span><span class="tok-s1">&#39;acordarme&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;astillero&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;aÃ±adidura&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;consumÃ­an&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;concluÃ­an&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;pantuflos&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;ensillaba&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;cincuenta&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;narraciÃ³n&#39;</span><span class="tok-o">]</span>
<span class="tok-k">assert</span> <span class="tok-n">palabras</span><span class="tok-o">[</span><span class="tok-mi">10</span><span class="tok-o">]</span> <span class="tok-o">==</span> <span class="tok-o">[</span><span class="tok-s1">&#39;quebrantos&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;complexiÃ³n&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;madrugador&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;diferencia&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;conjeturas&#39;</span><span class="tok-o">]</span>
<span class="tok-k">assert</span> <span class="tok-n">palabras</span><span class="tok-o">[</span><span class="tok-mi">11</span><span class="tok-o">]</span> <span class="tok-o">==</span> <span class="tok-o">[</span><span class="tok-s1">&#39;sobrenombre&#39;</span><span class="tok-o">,</span> <span class="tok-s1">&#39;verosÃ­miles&#39;</span><span class="tok-o">]</span></code></pre>
</div>
</div>
<div style="page-break-after: always;"></div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="sesion02">2. Aspectos avanzados del Lenguaje Groovy. MetaprogramaciÃ³n.</h2>
<div class="sectionbody">
<div class="paragraph">
<p>En la sesiÃ³n anterior hacÃ­amos un repaso completo sobre los tipos de tipos de datos simples y algunas caracterÃ­sticas. Posteriormente hablÃ¡bamos sobre colecciones y comentÃ¡bamos las excelencias de los rangos, una tipo de datos propio de Groovy, ademÃ¡s de los anteriormente conocidos listas y mapas.</p>
</div>
<div class="paragraph">
<p>Por Ãºltimo, echÃ¡bamos un vistazo a las estructuras de control que podÃ­amos utilizar en Groovy y a la combinaciÃ³n de Ã©stas con los nuevos tipos de datos.</p>
</div>
<div class="paragraph">
<p>En esta sesiÃ³n, veremos a fondo un nuevo concepto llamado <em>closure</em>. Ya hemos comentado algo sobre ellos en la sesiÃ³n anterior, pero en esta veremos todas sus caracterÃ­sticas.</p>
</div>
<div class="paragraph">
<p>Una vez vistos los closures, pasaremos a hablar sobre las caracterÃ­sticas de Groovy como lenguaje orientado a objetos y terminaremos viendo un concepto conocido como <em>metaprogramaciÃ³n</em> que te permitirÃ¡ extender la funcionalidad del lenguaje Groovy de forma muy sencilla.</p>
</div>
<div class="sect2">
<h3 id="_closures">2.1. Closures</h3>
<div class="paragraph">
<p>Aunque en apartados anteriores ya hayamos visto algunos ejemplos de closures, es conveniente dedicarle mÃ¡s tiempo a su explicaciÃ³n, ya que son una de las partes mÃ¡s importantes del lenguaje Groovy y mÃ¡s utilizados en Grails, y al mismo tiempo, puede ser un concepto difÃ­cil de entender, ya que no aparece en otros lenguajes de programaciÃ³n. AsÃ­ que volveremos a ver lo que son los closures, como se declaran y como pueden ser posteriormente referenciados.</p>
</div>
<div class="paragraph">
<p>MÃ¡s adelante, pasaremos a ver otros mÃ©todos disponibles en los closures y el Ã¡mbito de aplicaciÃ³n de los mismos, es decir, quien puede acceder a los mismos. Finalmente, definiremos varias tareas comunes que pueden ser realizadas con los closures, que hasta ahora se hacen de otras formas.</p>
</div>
<div class="sect3">
<h4 id="_definiciÃ³n_de_closure">2.1.1. DefiniciÃ³n de closure</h4>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="title">DefiniciÃ³n</div>
<div class="paragraph">
<p>Un <em>closure</em> es un trozo de cÃ³digo empaquetado como un objeto y definido entre llaves. ActÃºa como un mÃ©todo, al cual se le pueden pasar parÃ¡metros y pueden devolver valores. Es un objeto normal y corriente al cual se pasa una referencia de la misma forma que se le pasa a cualquier otro objeto.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Posiblemente estÃ©s pensando, que de momento los closures no te aportan nada que no puedas hacer nada con cualquier otro lenguaje de programaciÃ³n y posiblemente sea cierto. Sin embargo, los closures nos aportan agilidad a la hora de programar, que es lo que en principio buscamos utilizando un lenguaje como Groovy.</p>
</div>
</div>
<div class="sect3">
<h4 id="_declarando_closures">2.1.2. Declarando closures</h4>
<div class="paragraph">
<p>Como comentÃ¡bamos anteriormente, los closures son bloques de cÃ³digo encerrado entre llaves {}. Y para entrar en calor, vamos a definir un closure para imprimir nuestro nombre.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-kt">def</span> <span class="tok-n">nombre</span> <span class="tok-o">=</span> <span class="tok-s1">&#39;Juan&#39;</span>
<span class="tok-kt">def</span> <span class="tok-n">imprimeNombre</span> <span class="tok-o">=</span> <span class="tok-o">{</span> <span class="tok-n">println</span> <span class="tok-s2">&quot;Mi nombre es $nombre&quot;</span><span class="tok-o">}</span>

<span class="tok-n">imprimeNombre</span><span class="tok-o">()</span>

<span class="tok-n">nombre</span> <span class="tok-o">=</span> <span class="tok-s2">&quot;Yolanda&quot;</span>
<span class="tok-n">imprimeNombre</span><span class="tok-o">()</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>En primer lugar, cabe destacar en el ejemplo el uso de una variable dentro del closure definido fuera del Ã¡mbito del mismo. Es lo que se conoce <em>free variable</em>.</p>
</div>
<div class="paragraph">
<p>AdemÃ¡s, te habrÃ¡s dado cuenta de que el closure que acabamos de crear no estÃ¡ parametrizado, con lo que si se cambiara el nombre de nuestra variable, el closure no se ejecutarÃ­a correctamente. Para definir parÃ¡metros en nuestros closures, podemos hacerlo al inicio del mismo introduciendo el nombre de nuestros parÃ¡metros (separados por comas si hay mÃ¡s de uno) seguido de los caracteres &#8594;. El ejemplo anterior parametrizado quedarÃ­a asÃ­:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-kt">def</span> <span class="tok-n">imprimeNombre</span> <span class="tok-o">=</span> <span class="tok-o">{</span> <span class="tok-n">nombre</span> <span class="tok-o">-&gt;</span> <span class="tok-n">println</span> <span class="tok-s2">&quot;Mi nombre es ${nombre}&quot;</span><span class="tok-o">}</span>

<span class="tok-n">imprimeNombre</span><span class="tok-o">(</span><span class="tok-s2">&quot;Juan&quot;</span><span class="tok-o">)</span>
<span class="tok-n">imprimeNombre</span> <span class="tok-s2">&quot;Yolanda&quot;</span> <span class="tok-c1">//Los parÃ©ntesis son opcionales</span>

<span class="tok-c1">//Con mÃºltiples parÃ¡metros</span>
<span class="tok-kt">def</span> <span class="tok-n">quintetoInicial</span> <span class="tok-o">=</span> <span class="tok-o">{</span> <span class="tok-n">base</span><span class="tok-o">,</span> <span class="tok-n">escolta</span><span class="tok-o">,</span> <span class="tok-n">alero</span><span class="tok-o">,</span> <span class="tok-n">alapivot</span><span class="tok-o">,</span> <span class="tok-n">pivot</span> <span class="tok-o">-&gt;</span> <span class="tok-n">println</span> <span class="tok-s2">&quot;Quinteto inicial compuesto por: $base, $escolta, $alero, $alapivot y $pivot&quot;</span><span class="tok-o">}</span>

<span class="tok-n">quintetoInicial</span> <span class="tok-s2">&quot;CalderÃ³n&quot;</span><span class="tok-o">,</span> <span class="tok-s2">&quot;Navarro&quot;</span><span class="tok-o">,</span> <span class="tok-s2">&quot;JimÃ©nez&quot;</span><span class="tok-o">,</span> <span class="tok-s2">&quot;Garbajosa&quot;</span><span class="tok-o">,</span> <span class="tok-s2">&quot;Pau Gasol&quot;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>En aquellos closures que sÃ³lo tienen un parÃ¡metro, es posible obviar su declaraciÃ³n al inicio del closure, puesto que Groovy pone a nuestra disposiciÃ³n la variable <em>it</em>. El siguiente ejemplo es idÃ©ntico al closure <em>imprimeNombre</em> anterior, pero sin declarar sus parÃ¡metros.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-kt">def</span> <span class="tok-n">imprimeNombre</span> <span class="tok-o">=</span> <span class="tok-o">{</span> <span class="tok-n">println</span> <span class="tok-s2">&quot;Mi nombre es $it&quot;</span> <span class="tok-o">}</span>

<span class="tok-n">imprimeNombre</span><span class="tok-o">(</span><span class="tok-s2">&quot;Juan&quot;</span><span class="tok-o">)</span>
<span class="tok-n">imprimeNombre</span> <span class="tok-s2">&quot;Yolanda&quot;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Por Ãºltimo, existe otra forma de declarar un closure y es aprovechando un mÃ©todo ya existente. Con el operador <em>referencia &amp;</em> podemos declarar un closure a partir de un mÃ©todo de una clase ya creada. El siguiente ejemplo, tenemos la clase MetodoClosureEjemplo, en la que existe un mÃ©todo para comprobar si la longitud de la cadena pasada por parÃ¡metro es superior a un lÃ­mite. A partir de este mÃ©todo, crearemos un closure sobre dos instancias de esta clase creadas con lÃ­mites diferentes. Se puede comprobar como ejecutando el mismo mÃ©todo, obtenemos resultado diferentes.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-kd">class</span> <span class="tok-nc">MetodoClosureEjemplo</span> <span class="tok-o">{</span>
    <span class="tok-kt">int</span> <span class="tok-n">limite</span>

    <span class="tok-nf">MetodoClosureEjemplo</span> <span class="tok-o">(</span><span class="tok-kt">int</span> <span class="tok-n">limite</span><span class="tok-o">){</span>
        <span class="tok-k">this</span><span class="tok-o">.</span><span class="tok-na">limite</span> <span class="tok-o">=</span> <span class="tok-n">limite</span>
    <span class="tok-o">}</span>

    <span class="tok-kt">boolean</span> <span class="tok-nf">validar</span> <span class="tok-o">(</span><span class="tok-n">String</span> <span class="tok-n">valor</span><span class="tok-o">){</span>
        <span class="tok-k">return</span> <span class="tok-n">valor</span><span class="tok-o">.</span><span class="tok-na">length</span><span class="tok-o">()</span> <span class="tok-o">&lt;=</span> <span class="tok-n">limite</span>
    <span class="tok-o">}</span>
<span class="tok-o">}</span>

<span class="tok-n">MetodoClosureEjemplo</span> <span class="tok-n">primero</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">MetodoClosureEjemplo</span><span class="tok-o">(</span><span class="tok-mi">8</span><span class="tok-o">)</span>
<span class="tok-n">MetodoClosureEjemplo</span> <span class="tok-n">segundo</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">MetodoClosureEjemplo</span><span class="tok-o">(</span><span class="tok-mi">5</span><span class="tok-o">)</span>

<span class="tok-n">Closure</span> <span class="tok-n">primerClosure</span> <span class="tok-o">=</span> <span class="tok-n">primero</span><span class="tok-o">.&amp;</span><span class="tok-n">validar</span>

<span class="tok-kt">def</span> <span class="tok-n">palabras</span> <span class="tok-o">=</span> <span class="tok-o">[</span><span class="tok-s2">&quot;cadena larga&quot;</span><span class="tok-o">,</span> <span class="tok-s2">&quot;mediana&quot;</span><span class="tok-o">,</span> <span class="tok-s2">&quot;corta&quot;</span><span class="tok-o">]</span>

<span class="tok-k">assert</span> <span class="tok-s2">&quot;mediana&quot;</span> <span class="tok-o">==</span> <span class="tok-n">palabras</span><span class="tok-o">.</span><span class="tok-na">find</span><span class="tok-o">(</span><span class="tok-n">primerClosure</span><span class="tok-o">)</span>
<span class="tok-k">assert</span> <span class="tok-s2">&quot;corta&quot;</span> <span class="tok-o">==</span> <span class="tok-n">palabras</span><span class="tok-o">.</span><span class="tok-na">find</span><span class="tok-o">(</span><span class="tok-n">segundo</span><span class="tok-o">.&amp;</span><span class="tok-n">validar</span><span class="tok-o">)</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Con la variable <em>primero</em> estamos creando una instancia de la clase <em>MetodoClosureEjemplo</em> que validarÃ¡ aquellas palabras que tengan como mucho 8 caracteres, mientras que la variable <em>segundo</em> validarÃ¡ aquellas palabras con 5 caracteres o menos. Posteriormente, el closure <em>primerClosure</em> devolverÃ¡ la primera palabra encontrada con 8 o menos caracteres y de la lista de palabras coincidirÃ­a con la palabra "mediana". En el segundo closure, el que valida la palabras de 5 o menos caracteres, la palabra devuelta serÃ­a "corta".</p>
</div>
<div class="paragraph">
<p>Otra caracterÃ­stica interesante de los closures se refiere a la posibilidad de ejecutar diferentes mÃ©todos en funciÃ³n de los parÃ¡metros pasados y se conoce como <em>multimÃ©todo</em>. La idea es crear una clase que sobrecarga un determinado mÃ©todo y posteriormente crear un closure a partir de ese mÃ©todo sobrecargado.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-kd">class</span> <span class="tok-nc">MultimetodoClosureEjemplo</span><span class="tok-o">{</span>

    <span class="tok-kt">int</span> <span class="tok-nf">metodoSobrecargado</span><span class="tok-o">(</span><span class="tok-n">String</span> <span class="tok-n">cadena</span><span class="tok-o">){</span>
        <span class="tok-k">return</span> <span class="tok-n">cadena</span><span class="tok-o">.</span><span class="tok-na">length</span><span class="tok-o">()</span>
    <span class="tok-o">}</span>

    <span class="tok-kt">int</span> <span class="tok-nf">metodoSobrecargado</span><span class="tok-o">(</span><span class="tok-n">List</span> <span class="tok-n">lista</span><span class="tok-o">){</span>
        <span class="tok-k">return</span> <span class="tok-n">lista</span><span class="tok-o">.</span><span class="tok-na">size</span><span class="tok-o">()</span>
    <span class="tok-o">}</span>

    <span class="tok-kt">int</span> <span class="tok-nf">metodoSobrecargado</span><span class="tok-o">(</span><span class="tok-kt">int</span> <span class="tok-n">x</span><span class="tok-o">,</span> <span class="tok-kt">int</span> <span class="tok-n">y</span><span class="tok-o">){</span>
        <span class="tok-k">return</span> <span class="tok-n">x</span> <span class="tok-o">*</span> <span class="tok-n">y</span>
    <span class="tok-o">}</span>
<span class="tok-o">}</span>

<span class="tok-n">MultimetodoClosureEjemplo</span> <span class="tok-n">instancia</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">MultimetodoClosureEjemplo</span><span class="tok-o">()</span>
<span class="tok-n">Closure</span> <span class="tok-n">multiclosure</span> <span class="tok-o">=</span> <span class="tok-n">instancia</span><span class="tok-o">.&amp;</span><span class="tok-n">metodoSobrecargado</span>

<span class="tok-k">assert</span> <span class="tok-mi">21</span> <span class="tok-o">==</span> <span class="tok-n">multiclosure</span><span class="tok-o">(</span><span class="tok-s2">&quot;una cadena cualquiera&quot;</span><span class="tok-o">)</span>
<span class="tok-k">assert</span> <span class="tok-mi">4</span> <span class="tok-o">==</span> <span class="tok-n">multiclosure</span><span class="tok-o">([</span><span class="tok-s1">&#39;una&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;lista&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;de&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;valores&#39;</span><span class="tok-o">])</span>
<span class="tok-k">assert</span> <span class="tok-mi">21</span> <span class="tok-o">==</span> <span class="tok-n">multiclosure</span><span class="tok-o">(</span><span class="tok-mi">7</span><span class="tok-o">,</span> <span class="tok-mi">3</span><span class="tok-o">)</span></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_los_closures_como_objetos">2.1.3. Los closures como objetos</h4>
<div class="paragraph">
<p>Anteriormente comentÃ¡bamos que los closures son objetos y que como tales, pueden ser pasados como parÃ¡metros a funciones. Un ejemplo de este caso que ya hemos visto con anterioridad es el mÃ©todo <em>each()</em> de las listas, al cual se le puede pasar un closure para realizar una determinada operaciÃ³n sobre cada elemento de la lista.</p>
</div>
<div class="paragraph">
<p>Si echamos un vistazo al API de Groovy, veremos que el mÃ©todo each recibe como parÃ¡metro un objecto de tipo <em>Closure</em> <a href="http://groovy.codehaus.org/api/org/codehaus/groovy/runtime/DefaultGroovyMethods.html" class="bare">http://groovy.codehaus.org/api/org/codehaus/groovy/runtime/DefaultGroovyMethods.html</a></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-kt">def</span> <span class="tok-n">quintetoInicial</span> <span class="tok-o">=</span> <span class="tok-o">[</span><span class="tok-s2">&quot;CalderÃ³n&quot;</span><span class="tok-o">,</span> <span class="tok-s2">&quot;Navarro&quot;</span><span class="tok-o">,</span> <span class="tok-s2">&quot;JimÃ©nez&quot;</span><span class="tok-o">,</span> <span class="tok-s2">&quot;Garbajosa&quot;</span><span class="tok-o">,</span> <span class="tok-s2">&quot;Pau Gasol&quot;</span><span class="tok-o">]</span>

<span class="tok-n">salida</span> <span class="tok-o">=</span> <span class="tok-s1">&#39;&#39;</span>
<span class="tok-n">quintetoInicial</span><span class="tok-o">.</span><span class="tok-na">each</span> <span class="tok-o">{</span>
    <span class="tok-n">salida</span> <span class="tok-o">+=</span> <span class="tok-n">it</span> <span class="tok-o">+</span><span class="tok-s1">&#39;, &#39;</span>
<span class="tok-o">}</span>
<span class="tok-k">assert</span> <span class="tok-n">salida</span><span class="tok-o">.</span><span class="tok-na">take</span><span class="tok-o">(</span><span class="tok-n">salida</span><span class="tok-o">.</span><span class="tok-na">size</span><span class="tok-o">()-</span><span class="tok-mi">2</span><span class="tok-o">)</span> <span class="tok-o">==</span> <span class="tok-s1">&#39;CalderÃ³n, Navarro, JimÃ©nez, Garbajosa, Pau Gasol&#39;</span></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_usos_de_los_closures">2.1.4. Usos de los closures</h4>
<div class="paragraph">
<p>Ahora que ya sabemos como declarar los closures, vamos a ver como utilizarlos y como podemos invocarlos. Si tenemos definido un <em>Closure x</em>  y queremos llamarlo podemos hacerlo de dos formas:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>x.call()</p>
</li>
<li>
<p>x()</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-kt">def</span> <span class="tok-n">suma</span> <span class="tok-o">=</span> <span class="tok-o">{</span> <span class="tok-n">x</span><span class="tok-o">,</span> <span class="tok-n">y</span> <span class="tok-o">-&gt;</span>
<span class="tok-n">x</span> <span class="tok-o">+</span> <span class="tok-n">y</span>
<span class="tok-o">}</span>
<span class="tok-k">assert</span> <span class="tok-mi">10</span> <span class="tok-o">==</span> <span class="tok-n">suma</span><span class="tok-o">(</span><span class="tok-mi">7</span><span class="tok-o">,</span><span class="tok-mi">3</span><span class="tok-o">)</span>
<span class="tok-k">assert</span> <span class="tok-mi">13</span> <span class="tok-o">==</span> <span class="tok-n">suma</span><span class="tok-o">.</span><span class="tok-na">call</span><span class="tok-o">(</span><span class="tok-mi">7</span><span class="tok-o">,</span><span class="tok-mi">6</span><span class="tok-o">)</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>A continuaciÃ³n, veremos un ejemplo sobre como pasar un closure como parÃ¡metro a un mÃ©todo. El ejemplo nos permitirÃ¡ tener un campo de pruebas para comprobar que cÃ³digo es mÃ¡s rÃ¡pido.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-kt">def</span> <span class="tok-nf">campodepruebas</span><span class="tok-o">(</span><span class="tok-n">repeticiones</span><span class="tok-o">,</span> <span class="tok-n">Closure</span> <span class="tok-n">proceso</span><span class="tok-o">){</span>
   <span class="tok-n">inicio</span> <span class="tok-o">=</span> <span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">currentTimeMillis</span><span class="tok-o">()</span>
   <span class="tok-n">repeticiones</span><span class="tok-o">.</span><span class="tok-na">times</span><span class="tok-o">{</span><span class="tok-n">proceso</span><span class="tok-o">(</span><span class="tok-n">it</span><span class="tok-o">)}</span>
   <span class="tok-n">fin</span> <span class="tok-o">=</span> <span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">currentTimeMillis</span><span class="tok-o">()</span>
   <span class="tok-k">return</span> <span class="tok-n">fin</span> <span class="tok-o">-</span> <span class="tok-n">inicio</span>
<span class="tok-o">}</span>

<span class="tok-n">lento</span> <span class="tok-o">=</span> <span class="tok-n">campodepruebas</span><span class="tok-o">(</span><span class="tok-mi">999999</span><span class="tok-o">)</span> <span class="tok-o">{</span> <span class="tok-o">(</span><span class="tok-kt">int</span><span class="tok-o">)</span> <span class="tok-n">it</span> <span class="tok-s">/ 2 }</span>
<span class="tok-s">rapido = campodepruebas(999999) { it.intdiv(2) }</span>

<span class="tok-s">/</span><span class="tok-o">/</span><span class="tok-n">El</span> <span class="tok-n">m</span><span class="tok-err">Ã©</span><span class="tok-n">todo</span> <span class="tok-n">lento</span> <span class="tok-n">es</span> <span class="tok-n">al</span> <span class="tok-n">menos</span> <span class="tok-mi">3</span> <span class="tok-n">m</span><span class="tok-err">Ã¡</span><span class="tok-n">s</span> <span class="tok-n">lento</span> <span class="tok-n">que</span> <span class="tok-n">el</span> <span class="tok-n">r</span><span class="tok-err">Ã¡</span><span class="tok-n">pido</span>
<span class="tok-k">assert</span> <span class="tok-n">rapido</span> <span class="tok-o">*</span> <span class="tok-mi">3</span> <span class="tok-o">&lt;</span> <span class="tok-n">lento</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Cuando ejecutamos <em>campodepruebas(999999)</em> le estamos pasando el primer parÃ¡metro, el que indica el nÃºmero de repeticiones del cÃ³digo a ejecutar, mientras que el cÃ³digo encerrado entre llaves se corresponde con el <em>Closure</em> pasado como segundo parÃ¡metro. Cuando definimos un mÃ©todo que recibe como parÃ¡metro un closure, es obligatorio que Ã©ste sea definido el Ãºltimo parÃ¡metro del mÃ©todo.</p>
</div>
</div>
<div class="sect3">
<h4 id="_valores_por_defecto">2.1.5. Valores por defecto</h4>
<div class="paragraph">
<p>Hasta el momento, siempre que hemos creado un closure con parÃ¡metros, le hemos pasado tantas variables como parÃ¡metros tenÃ­a el closure. Sin embargo, al igual que en los mÃ©todos, es posible establecer un valor por defecto para los parÃ¡metros de un closure de la siguiente forma:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-kt">def</span> <span class="tok-n">suma</span> <span class="tok-o">=</span> <span class="tok-o">{</span> <span class="tok-n">x</span><span class="tok-o">,</span> <span class="tok-n">y</span><span class="tok-o">=</span><span class="tok-mi">3</span> <span class="tok-o">-&gt;</span>
  <span class="tok-n">suma</span> <span class="tok-o">=</span> <span class="tok-n">x</span> <span class="tok-o">+</span> <span class="tok-n">y</span>
<span class="tok-o">}</span>
<span class="tok-k">assert</span> <span class="tok-mi">7</span> <span class="tok-o">==</span> <span class="tok-n">suma</span><span class="tok-o">(</span><span class="tok-mi">4</span><span class="tok-o">,</span><span class="tok-mi">3</span><span class="tok-o">)</span>
<span class="tok-k">assert</span> <span class="tok-mi">7</span> <span class="tok-o">==</span> <span class="tok-n">suma</span><span class="tok-o">(</span><span class="tok-mi">4</span><span class="tok-o">)</span></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_mÃ¡s_mÃ©todos_de_los_closures">2.1.6. MÃ¡s mÃ©todos de los closures</h4>
<div class="paragraph">
<p>La clase <em>groovy.lang.Closure</em> (<a href="http://groovy.codehaus.org/api/groovy/lang/Closure.html" class="bare">http://groovy.codehaus.org/api/groovy/lang/Closure.html</a>) es una clase como cualquier otra, aunque es cierto que con una potencia increÃ­ble. Hasta ahora, sÃ³lo hemos visto la existencia del mÃ©todo <em>call()</em>, pero existen muchos mÃ¡s, de los que vamos a ver los mÃ¡s importantes.</p>
</div>
<div class="paragraph">
<p>Es probable que en alguna ocasiÃ³n necesites conocer el nÃºmero de parÃ¡metros pasados a un closure para saber como actuar y para ello, los Closures disponen del mÃ©todo <em>getParameterTypes()</em>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-kt">def</span> <span class="tok-nf">llamador</span> <span class="tok-o">(</span><span class="tok-n">Closure</span> <span class="tok-n">closure</span><span class="tok-o">){</span>
    <span class="tok-n">closure</span><span class="tok-o">.</span><span class="tok-na">getParameterTypes</span><span class="tok-o">().</span><span class="tok-na">size</span><span class="tok-o">()</span>
<span class="tok-o">}</span>

<span class="tok-k">assert</span> <span class="tok-n">llamador</span> <span class="tok-o">{</span> <span class="tok-n">uno</span> <span class="tok-o">-&gt;</span> <span class="tok-o">}</span> <span class="tok-o">==</span> <span class="tok-mi">1</span>
<span class="tok-k">assert</span> <span class="tok-n">llamador</span> <span class="tok-o">{</span> <span class="tok-n">uno</span><span class="tok-o">,</span> <span class="tok-n">dos</span> <span class="tok-o">-&gt;</span> <span class="tok-o">}</span> <span class="tok-o">==</span> <span class="tok-mi">2</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Existe una tÃ©cnica en programaciÃ³n llamada <em>currying</em> en honor a su creador <em>Haskell Brooks Curry</em>, que consiste en transformar una funciÃ³n con mÃºltiples parÃ¡metros en otra con menos parÃ¡metros. Un ejemplo puede ser la funciÃ³n que suma dos valores. Si tenemos esta funciÃ³n con dos parÃ¡metros, y queremos crear otra que acepte un sÃ³lo parÃ¡metro, estÃ¡ claro que debe ser perdiendo el segundo parÃ¡metro, lo que conlleva a sumar siempre el mismo valor en esta nueva funciÃ³n. El mÃ©todo <em>curry()</em> devuelve un clon de la funciÃ³n principal, eliminando uno o mÃ¡s parÃ¡metros de la misma.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-kt">def</span> <span class="tok-n">suma</span> <span class="tok-o">=</span> <span class="tok-o">{</span> <span class="tok-n">x</span><span class="tok-o">,</span> <span class="tok-n">y</span> <span class="tok-o">-&gt;</span> <span class="tok-n">x</span> <span class="tok-o">+</span> <span class="tok-n">y</span> <span class="tok-o">}</span>
<span class="tok-kt">def</span> <span class="tok-n">sumaUno</span> <span class="tok-o">=</span> <span class="tok-n">suma</span><span class="tok-o">.</span><span class="tok-na">curry</span><span class="tok-o">(</span><span class="tok-mi">1</span><span class="tok-o">)</span>

<span class="tok-k">assert</span> <span class="tok-nf">suma</span><span class="tok-o">(</span><span class="tok-mi">4</span><span class="tok-o">,</span><span class="tok-mi">3</span><span class="tok-o">)</span> <span class="tok-o">==</span> <span class="tok-mi">7</span>
<span class="tok-k">assert</span> <span class="tok-nf">sumaUno</span><span class="tok-o">(</span><span class="tok-mi">5</span><span class="tok-o">)</span> <span class="tok-o">==</span> <span class="tok-mi">6</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>El nuevo closure <em>sumaUno</em> siempre toma como segundo parÃ¡metro el valor 1.</p>
</div>
</div>
<div class="sect3">
<h4 id="_valores_devueltos_en_los_closures">2.1.7. Valores devueltos en los closures</h4>
<div class="paragraph">
<p>Los <em>closures</em> tienen dos formas de devolver valores:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><em>De forma implÃ­cita</em>. El resultado de la Ãºltima expresiÃ³n evaluada por el closure, es lo que Ã©ste devuelve. Esto lo que hemos hecho hasta ahora.</p>
</li>
<li>
<p><em>De forma explÃ­cita</em>. La palabra reservada <em>return</em> tambiÃ©n nos servirÃ¡ en los closures para devolver valores</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>En el siguiente cÃ³digo de ejemplo, ambos closures tienen el mismo efecto, que es la duplicaciÃ³n de los valores de la lista.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-k">assert</span> <span class="tok-o">[</span><span class="tok-mi">2</span><span class="tok-o">,</span><span class="tok-mi">4</span><span class="tok-o">,</span><span class="tok-mi">6</span><span class="tok-o">]</span> <span class="tok-o">==</span> <span class="tok-o">[</span><span class="tok-mi">1</span><span class="tok-o">,</span><span class="tok-mi">2</span><span class="tok-o">,</span><span class="tok-mi">3</span><span class="tok-o">].</span><span class="tok-na">collect</span> <span class="tok-o">{</span> <span class="tok-n">it</span> <span class="tok-o">*</span> <span class="tok-mi">2</span> <span class="tok-o">}</span>
<span class="tok-k">assert</span> <span class="tok-o">[</span><span class="tok-mi">2</span><span class="tok-o">,</span><span class="tok-mi">4</span><span class="tok-o">,</span><span class="tok-mi">6</span><span class="tok-o">]</span> <span class="tok-o">==</span> <span class="tok-o">[</span><span class="tok-mi">1</span><span class="tok-o">,</span><span class="tok-mi">2</span><span class="tok-o">,</span><span class="tok-mi">3</span><span class="tok-o">].</span><span class="tok-na">collect</span> <span class="tok-o">{</span> <span class="tok-k">return</span> <span class="tok-n">it</span> <span class="tok-o">*</span> <span class="tok-mi">2</span> <span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Si queremos salir de un closure de forma prematura, tambiÃ©n podemos hacer uso del return. Por ejemplo, si en el ejemplo anterior sÃ³lo queremos duplicar aquellos valores impares, deberÃ­amos tener algo asÃ­.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-k">assert</span> <span class="tok-o">[</span><span class="tok-mi">2</span><span class="tok-o">,</span><span class="tok-mi">2</span><span class="tok-o">,</span> <span class="tok-mi">6</span><span class="tok-o">]</span> <span class="tok-o">==</span> <span class="tok-o">[</span><span class="tok-mi">1</span><span class="tok-o">,</span><span class="tok-mi">2</span><span class="tok-o">,</span><span class="tok-mi">3</span><span class="tok-o">].</span><span class="tok-na">collect</span> <span class="tok-o">{</span>
    <span class="tok-k">if</span> <span class="tok-o">(</span><span class="tok-n">it</span><span class="tok-o">%</span><span class="tok-mi">2</span><span class="tok-o">==</span><span class="tok-mi">1</span><span class="tok-o">)</span>
        <span class="tok-k">return</span> <span class="tok-n">it</span> <span class="tok-o">*</span> <span class="tok-mi">2</span>
    <span class="tok-k">return</span> <span class="tok-n">it</span>
<span class="tok-o">}</span></code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_groovy_como_lenguaje_orientado_a_objetos">2.2. Groovy como lenguaje orientado a objetos</h3>
<div class="paragraph">
<p>Un concepto errÃ³neo que se suele decir de los lenguajes scripts, debido a su dejadez con el tipado de datos y determinadas estructuras de control, es que son lenguajes destinados mÃ¡s a los hackers que a los programadores serios. Esta reputaciÃ³n viene de las primeras versiones del lenguaje Perl, donde la falta de encapsulaciÃ³n y la falta de otras caracterÃ­sticas tÃ­picas del modelo orientado a objetos, provocaba un mala gestiÃ³n del cÃ³digo, con frecuentes trozos de cÃ³digo duplicados e indescifrables fallos de programaciÃ³n.</p>
</div>
<div class="paragraph">
<p>Sin embargo, este panorama ha cambiado drÃ¡sticamente en los Ãºltimos aÃ±os, ya que lenguajes como el mismo Perl, Python y mÃ¡s recientemente, Ruby, han aÃ±adido caracterÃ­sticas del modelo orientado a objetos, que los hacen incluso mÃ¡s productivos que lenguajes como Java o C++. Groovy tambiÃ©n se ha subido al carro de estos lenguajes ofreciendo caracterÃ­sticas similares, con lo que ha pasado de ser un lenguaje de script basado en Java, a ser un lenguaje que nos ofrece nuevas caracterÃ­sticas del modelo orientado a objetos.</p>
</div>
<div class="paragraph">
<p>Hasta ahora hemos visto que Groovy nos ofrece tipos de datos referencia donde Java simplemente nos ofrecÃ­a tipos de datos simples, tenemos rangos y closures, y muchas estructuras de control para trabajar de forma muy Ã¡gil y sencilla con colecciones de objetos. Pero esto es sÃ³lo la punta del iceberg, y a partir de ahora veremos otras caracterÃ­sticas, que hacen de Groovy un lenguaje con mucho futuro. Empezaremos repasando las clases y los scripts en Groovy, seguiremos por la organizaciÃ³n de nuestras clases y terminaremos viendo caracterÃ­sticas avanzadas del modelo orientado a objetos en Groovy.</p>
</div>
<div class="sect3">
<h4 id="_clases_y_scripts">2.2.1. Clases y scripts</h4>
<div class="paragraph">
<p>La definiciÃ³n de clases en Groovy es prÃ¡cticamente idÃ©ntica a como se hace en Java. Las clases se declaran utilizando la palabra reservada <em>class</em> y una clase puede tener <em>campos</em>, <em>constructores</em> y <em>mÃ©todos</em>. Los mÃ©todos y los constructores pueden utilizar <em>variables locales</em>. Por otro lado tenemos los <em>scripts</em> que puede contener la definiciÃ³n de variables y mÃ©todos, asÃ­ como la declaraciÃ³n de clases.</p>
</div>
<div class="paragraph">
<p>La <strong>declaraciÃ³n de variables</strong> debe realizarse antes de que se utilicen. Declarar una variable supone indicar un nombre a la misma y un tipo, aunque en Groovy esto es opcional.</p>
</div>
<div class="paragraph">
<p>Groovy utiliza los mismos modificadores que Java, que son: <em>private</em>, <em>protected</em> y <em>public</em> para modificar la visibilidad de las variables; <em>final</em> para evitar la modificaciÃ³n de variables; y <em>static</em> para la declaraciÃ³n de las variables de la clase.</p>
</div>
<div class="paragraph">
<p>La definiciÃ³n del tipo de la variable es opcional en Groovy y cuando no se especifica, debemos introducir previamente al nombre de la variable, la palabra reserva <em>def</em>. Por Ãºltimo y aunque pueda resultar obvio, en Groovy es imposible asignar valores a variables que no coincidan en el tipo. Por ejemplo, un valor numÃ©rico no puede ser asignado a una variable definida de tipo <em>String</em>. Como vimos anteriormente, Groovy se encarga de hacer el llamado <em>autoboxing</em> siempre y cuando sea posible.</p>
</div>
<div class="paragraph">
<p>Otro aspecto interesante de Groovy es la asignaciÃ³n de valores a las propiedades de las clases. Si hemos definido un campo en una clase en Groovy, podemos acceder al valor del mismo de la forma habitual <em>objeto.campo</em> o bien <em>objeto['campo']</em>. Esto nos permite una mayor facilidad para acceder a los campos de las clases de forma dinÃ¡mica, tal y como se hace en el siguiente fragmento de cÃ³digo.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-kd">class</span> <span class="tok-nc">miClase</span> <span class="tok-o">{</span>
    <span class="tok-kd">public</span> <span class="tok-n">campo1</span><span class="tok-o">,</span> <span class="tok-n">campo2</span><span class="tok-o">,</span> <span class="tok-n">campo3</span><span class="tok-o">,</span> <span class="tok-n">campo4</span> <span class="tok-o">=</span> <span class="tok-mi">0</span>
<span class="tok-o">}</span>

<span class="tok-kt">def</span> <span class="tok-n">miobjeto</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">miClase</span><span class="tok-o">()</span>

<span class="tok-n">miobjeto</span><span class="tok-o">.</span><span class="tok-na">campo1</span> <span class="tok-o">=</span> <span class="tok-mi">2</span>
<span class="tok-k">assert</span> <span class="tok-n">miobjeto</span><span class="tok-o">.</span><span class="tok-na">campo1</span> <span class="tok-o">==</span> <span class="tok-mi">2</span>

<span class="tok-n">miobjeto</span><span class="tok-o">[</span><span class="tok-s1">&#39;campo2&#39;</span><span class="tok-o">]</span> <span class="tok-o">=</span> <span class="tok-mi">3</span>
<span class="tok-k">assert</span> <span class="tok-n">miobjeto</span><span class="tok-o">.</span><span class="tok-na">campo2</span> <span class="tok-o">==</span> <span class="tok-mi">3</span>

<span class="tok-k">for</span><span class="tok-o">(</span><span class="tok-n">i</span><span class="tok-o">=</span><span class="tok-mi">1</span><span class="tok-o">;</span><span class="tok-n">i</span><span class="tok-o">&lt;=</span><span class="tok-mi">4</span><span class="tok-o">;</span><span class="tok-n">i</span><span class="tok-o">++)</span>
    <span class="tok-n">miobjeto</span><span class="tok-o">[</span><span class="tok-s1">&#39;campo&#39;</span><span class="tok-o">+</span><span class="tok-n">i</span><span class="tok-o">]</span> <span class="tok-o">=</span> <span class="tok-n">i</span> <span class="tok-o">-</span> <span class="tok-mi">1</span>

<span class="tok-k">assert</span> <span class="tok-n">miobjeto</span><span class="tok-o">.</span><span class="tok-na">campo1</span> <span class="tok-o">==</span> <span class="tok-mi">0</span>
<span class="tok-k">assert</span> <span class="tok-n">miobjeto</span><span class="tok-o">[</span><span class="tok-s1">&#39;campo2&#39;</span><span class="tok-o">]</span> <span class="tok-o">==</span> <span class="tok-mi">1</span>
<span class="tok-k">assert</span> <span class="tok-n">miobjeto</span><span class="tok-o">.</span><span class="tok-na">campo3</span> <span class="tok-o">==</span> <span class="tok-mi">2</span>
<span class="tok-k">assert</span> <span class="tok-n">miobjeto</span><span class="tok-o">[</span><span class="tok-s1">&#39;campo4&#39;</span><span class="tok-o">]</span> <span class="tok-o">==</span> <span class="tok-mi">3</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>La <strong>declaraciÃ³n de los mÃ©todos</strong> sigue los mismos criterios que acabamos de ver con las variables. Se pueden utilizar los modificadores Java, es opcional devolver algo con la sentencia <em>return</em> y si no se utilizan modificadores ni queremos especificar el tipo de dato a devolver, debemos utilizar la palabra reservada <em>def</em> para declarar nuestros mÃ©todos. Por defecto, la visibilidad de los mÃ©todos en Groovy es <em>public</em>.</p>
</div>
<div class="paragraph">
<p>Veamos una clase ejemplo y con ella, algunas diferencias con la misma clase en Java.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-kd">class</span> <span class="tok-nc">MiClase</span><span class="tok-o">{</span>

       <span class="tok-kd">static</span> <span class="tok-nf">main</span><span class="tok-o">(</span><span class="tok-n">args</span><span class="tok-o">){</span>
           <span class="tok-kt">def</span> <span class="tok-n">algo</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">MiClase</span><span class="tok-o">()</span>
           <span class="tok-n">algo</span><span class="tok-o">.</span><span class="tok-na">metodoPublicoVacio</span><span class="tok-o">()</span>
           <span class="tok-k">assert</span> <span class="tok-s2">&quot;hola&quot;</span> <span class="tok-o">==</span> <span class="tok-n">algo</span><span class="tok-o">.</span><span class="tok-na">metodoNoTipado</span><span class="tok-o">()</span>
           <span class="tok-k">assert</span> <span class="tok-s1">&#39;adios&#39;</span> <span class="tok-o">==</span> <span class="tok-n">algo</span><span class="tok-o">.</span><span class="tok-na">metodoTipado</span><span class="tok-o">()</span>
           <span class="tok-n">metodoCombinado</span><span class="tok-o">()</span>
       <span class="tok-o">}</span>

       <span class="tok-kt">void</span> <span class="tok-nf">metodoPublicoVacio</span><span class="tok-o">(){</span>
           <span class="tok-o">;</span>
       <span class="tok-o">}</span>

       <span class="tok-kt">def</span> <span class="tok-nf">metodoNoTipado</span><span class="tok-o">(){</span>
           <span class="tok-k">return</span> <span class="tok-s1">&#39;hola&#39;</span>
       <span class="tok-o">}</span>

       <span class="tok-n">String</span> <span class="tok-nf">metodoTipado</span><span class="tok-o">(){</span>
           <span class="tok-k">return</span> <span class="tok-s1">&#39;adios&#39;</span>
       <span class="tok-o">}</span>

       <span class="tok-kd">protected</span> <span class="tok-kd">static</span> <span class="tok-kd">final</span> <span class="tok-kt">void</span> <span class="tok-nf">metodoCombinado</span><span class="tok-o">(){</span>

       <span class="tok-o">}</span>
<span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>En la primera sesiÃ³n comentÃ¡bamos que el mÃ©todo <em>main</em> tÃ­pico de Java y C, ya no era necesario en Groovy, puesto que podÃ­amos ejecutar nuestro cÃ³digo sin necesidad de incluirlo en dicho mÃ©todo. Sin embargo, si queremos introducir parÃ¡metros a nuestro programa, tendremos que utilizarlo, tal y como aparece en el ejemplo. No obstante, este mÃ©todo main es algo diferente al de Java, puesto que no es necesario indicarle que el mÃ©todo es pÃºblico, ya que, por defecto y salvo que se diga que lo contrario, todo mÃ©todo en Groovy es <em>public</em>. La segunda diferencia con Java es que los argumentos debÃ­an ser del tipo <em>String[]</em> mientras que en Groovy simplemente es un objeto y no es necesario especificarle el tipo. Puesto que en la funciÃ³n main no se va a devolver nada, es posible obviar la etiqueta <em>void</em> en la declaraciÃ³n del mÃ©todo. Resumiendo, mientras que en Java tendrÃ­amos esto <em>public static void main (String[] args)</em>, en Groovy quedarÃ­a algo asÃ­ <em>static main (args)</em>.</p>
</div>
<div class="paragraph">
<p>Groovy nos ahorra tambiÃ©n bastante trabajo en cuanto a la comprobaciÃ³n de errores. En este sentido, cuando intentamos llamar a un mÃ©todo o un objeto cuya referencia es <em>null</em>, obtendremos una excepciÃ³n del tipo <em>NullPointerException</em>, lo cual es muy Ãºtil para comprobar que nuestro cÃ³digo funciona tal y como debe funcionar. Veamos un ejemplo:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-kt">def</span> <span class="tok-n">mapa</span> <span class="tok-o">=</span> <span class="tok-o">[</span><span class="tok-nl">a:</span><span class="tok-o">[</span><span class="tok-nl">b:</span><span class="tok-o">[</span><span class="tok-nl">c:</span><span class="tok-mi">1</span><span class="tok-o">]]]</span>

<span class="tok-k">assert</span> <span class="tok-n">mapa</span><span class="tok-o">.</span><span class="tok-na">a</span><span class="tok-o">.</span><span class="tok-na">b</span><span class="tok-o">.</span><span class="tok-na">c</span> <span class="tok-o">==</span> <span class="tok-mi">1</span>

<span class="tok-c1">//ProtecciÃ³n con cortocircuito</span>
<span class="tok-k">if</span> <span class="tok-o">(</span><span class="tok-n">mapa</span> <span class="tok-o">&amp;&amp;</span> <span class="tok-n">mapa</span><span class="tok-o">.</span><span class="tok-na">a</span> <span class="tok-o">&amp;&amp;</span> <span class="tok-n">mapa</span><span class="tok-o">.</span><span class="tok-na">a</span><span class="tok-o">.</span><span class="tok-na">x</span><span class="tok-o">){</span>
    <span class="tok-k">assert</span> <span class="tok-n">mapa</span><span class="tok-o">.</span><span class="tok-na">a</span><span class="tok-o">.</span><span class="tok-na">x</span><span class="tok-o">.</span><span class="tok-na">c</span> <span class="tok-o">==</span> <span class="tok-kc">null</span>
<span class="tok-o">}</span>

<span class="tok-c1">//ProtecciÃ³n con un bloque try/catch</span>
<span class="tok-k">try</span><span class="tok-o">{</span>
    <span class="tok-k">assert</span> <span class="tok-n">mapa</span><span class="tok-o">.</span><span class="tok-na">a</span><span class="tok-o">.</span><span class="tok-na">x</span><span class="tok-o">.</span><span class="tok-na">c</span> <span class="tok-o">==</span> <span class="tok-kc">null</span>
<span class="tok-o">}</span> <span class="tok-k">catch</span> <span class="tok-o">(</span><span class="tok-n">NullPointerException</span> <span class="tok-n">npe</span><span class="tok-o">){}</span>

<span class="tok-c1">//ProtecciÃ³n con el operador ?.</span>
<span class="tok-k">assert</span> <span class="tok-n">mapa</span><span class="tok-o">?.</span><span class="tok-na">a</span><span class="tok-o">?.</span><span class="tok-na">x</span><span class="tok-o">?.</span><span class="tok-na">c</span> <span class="tok-o">==</span> <span class="tok-kc">null</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>En el ejemplo, estamos intentando acceder a una propiedad que no existe como es <em>mapa.a.x</em>. Antes de acceder a dicha propiedad, protegemos el acceso para comprobar que no sea <em>null</em> y en caso de que no lo sea, acceder a su valor. Aparecen tres tipos de protecciÃ³n de este tipo de errores. La comprobaciÃ³n en cortocircuito con un bloque <em>if</em>, es decir, que cuando se detecte una condiciÃ³n de la expresiÃ³n que sea falsa, nos salimos del if. En segundo lugar, intentamos proteger el acceso errÃ³neo con un bloque <em>try/catch</em>. Y por Ãºltimo, con el operador <em>?.</em>, el cual no es en sÃ­ una comprobaciÃ³n y es la opciÃ³n que menos cÃ³digo emplea.</p>
</div>
<div class="paragraph">
<p>Por Ãºltimo, es necesario mencionar algo sobre los constructores en Groovy. Los constructores tienen la funciÃ³n de inicializar los objetos de una determinada clase y en caso de que no se especifique ningÃºn constructor para la clase, Ã©stos son creados directamente por el compilador. Nada que no se haga ya en Java. Sin embargo, era extraÃ±o que la gente de Groovy no hiciera algo mÃ¡s y asÃ­ es, hay mÃ¡s.</p>
</div>
<div class="paragraph">
<p>Existen dos formas de llamar a los constructores de las clases creadas en Groovy. Por un lado, el mÃ©todo tradicional pasando parÃ¡metros de forma posicional, donde el primer parÃ¡metro significa una cosa, el segundo otra y asÃ­ sucesivamente. Y por otro lado, tenemos tambiÃ©n la posibilidad de pasar los parÃ¡metros a los constructores utilizando directamente los nombres de los campos. Esta caracterÃ­stica surge debido a que pasar parÃ¡metros segÃºn su posiciÃ³n tiene el inconveniente de aquellos constructores que tienen demasiados campos y no es sencillo recordar el orden de los mismos.</p>
</div>
<div class="paragraph">
<p>Cuando creamos un objeto de una clase mediante su constructor, podemos pasarle los parÃ¡metros de tres formas diferentes en Groovy:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Mediante la forma tradicional, pasando parÃ¡metros en orden</p>
</li>
<li>
<p>Mediante la palabra reservada <em>as</em> y una lista de parÃ¡metros</p>
</li>
<li>
<p>Mediante una lista de parÃ¡metros</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Veamos un ejemplo:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-kd">class</span> <span class="tok-nc">Libro</span><span class="tok-o">{</span>
    <span class="tok-n">String</span> <span class="tok-n">titulo</span><span class="tok-o">,</span> <span class="tok-n">autor</span>

    <span class="tok-n">Libro</span><span class="tok-o">(</span><span class="tok-n">titulo</span><span class="tok-o">,</span> <span class="tok-n">autor</span><span class="tok-o">){</span>
        <span class="tok-k">this</span><span class="tok-o">.</span><span class="tok-na">titulo</span> <span class="tok-o">=</span> <span class="tok-n">titulo</span>
        <span class="tok-k">this</span><span class="tok-o">.</span><span class="tok-na">autor</span> <span class="tok-o">=</span> <span class="tok-n">autor</span>
    <span class="tok-o">}</span>
<span class="tok-o">}</span>

<span class="tok-c1">//Forma tradicional</span>
<span class="tok-kt">def</span> <span class="tok-n">primero</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">Libro</span><span class="tok-o">(</span><span class="tok-s1">&#39;Groovy in action&#39;</span><span class="tok-o">,</span> <span class="tok-s1">&#39;Dierk KÃ¶nig&#39;</span><span class="tok-o">)</span>

<span class="tok-c1">//Mediante la palabra reservada as y una lista de parÃ¡metros</span>
<span class="tok-kt">def</span> <span class="tok-n">segundo</span> <span class="tok-o">=</span> <span class="tok-o">[</span><span class="tok-s1">&#39;Groovy in action&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;Dierk KÃ¶nig&#39;</span><span class="tok-o">]</span> <span class="tok-k">as</span> <span class="tok-n">Libro</span>

<span class="tok-c1">//Mediante una lista de parÃ¡metros</span>
<span class="tok-n">Libro</span> <span class="tok-n">tercero</span> <span class="tok-o">=</span> <span class="tok-o">[</span><span class="tok-s1">&#39;Groovy in action&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;Dierk KÃ¶nig&#39;</span><span class="tok-o">]</span>

<span class="tok-k">assert</span> <span class="tok-n">primero</span><span class="tok-o">.</span><span class="tok-na">getTitulo</span><span class="tok-o">()</span> <span class="tok-o">==</span> <span class="tok-s1">&#39;Groovy in action&#39;</span>
<span class="tok-k">assert</span> <span class="tok-n">segundo</span><span class="tok-o">.</span><span class="tok-na">getAutor</span><span class="tok-o">()</span> <span class="tok-o">==</span> <span class="tok-s1">&#39;Dierk KÃ¶nig&#39;</span>
<span class="tok-k">assert</span> <span class="tok-n">tercero</span><span class="tok-o">.</span><span class="tok-na">titulo</span> <span class="tok-o">==</span> <span class="tok-s1">&#39;Groovy in action&#39;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>AdemÃ¡s del motivo de tener que recordar el orden de los parÃ¡metros pasados al constructor de la clase, otra razÃ³n para utilizar este tipo de llamadas a los constructores es que podemos ahorrarnos la creaciÃ³n de varios constructores. Imagina el caso en que tengamos dos campos de la clase, y ambos sean opcionales. Esto supone crear cuatro constructores: sin parÃ¡metros, con uno de los campos, con el otro campo y con los dos campos. Si utilizamos este tipo de llamadas a los constructores nos ahorraremos la creaciÃ³n de estos cuatro constructores. Veamos el mismo caso que antes con la clase <em>Libro</em>. En el ejemplo, dejamos que Groovy cree por nosotros los constructores.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-kd">class</span> <span class="tok-nc">Libro</span> <span class="tok-o">{</span>
  <span class="tok-n">String</span> <span class="tok-n">titulo</span><span class="tok-o">,</span> <span class="tok-n">autor</span>
<span class="tok-o">}</span>

<span class="tok-kt">def</span> <span class="tok-n">primero</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">Libro</span><span class="tok-o">()</span>
<span class="tok-kt">def</span> <span class="tok-n">segundo</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">Libro</span><span class="tok-o">(</span><span class="tok-nl">titulo:</span> <span class="tok-s1">&#39;Groovy in action&#39;</span><span class="tok-o">)</span>
<span class="tok-kt">def</span> <span class="tok-n">tercero</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">Libro</span><span class="tok-o">(</span><span class="tok-nl">autor:</span> <span class="tok-s1">&#39;Dierk KÃ¶nig&#39;</span><span class="tok-o">)</span>
<span class="tok-kt">def</span> <span class="tok-n">cuarto</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">Libro</span><span class="tok-o">(</span><span class="tok-nl">titulo:</span> <span class="tok-s1">&#39;Groovy in action&#39;</span><span class="tok-o">,</span> <span class="tok-nl">autor:</span> <span class="tok-s1">&#39;Dierk KÃ¶nig&#39;</span><span class="tok-o">)</span>

<span class="tok-k">assert</span> <span class="tok-n">primero</span><span class="tok-o">.</span><span class="tok-na">getTitulo</span><span class="tok-o">()</span> <span class="tok-o">==</span> <span class="tok-kc">null</span>
<span class="tok-k">assert</span> <span class="tok-n">segundo</span><span class="tok-o">.</span><span class="tok-na">titulo</span> <span class="tok-o">==</span> <span class="tok-s1">&#39;Groovy in action&#39;</span>
<span class="tok-k">assert</span> <span class="tok-n">tercero</span><span class="tok-o">.</span><span class="tok-na">getAutor</span><span class="tok-o">()</span> <span class="tok-o">==</span> <span class="tok-s1">&#39;Dierk KÃ¶nig&#39;</span>
<span class="tok-k">assert</span> <span class="tok-n">cuarto</span><span class="tok-o">.</span><span class="tok-na">autor</span> <span class="tok-o">==</span> <span class="tok-s1">&#39;Dierk KÃ¶nig&#39;</span></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_organizando_nuestras_clases_y_scripts">2.2.2. Organizando nuestras clases y scripts</h4>
<div class="paragraph">
<p>En este apartado, vamos a ver como podemos organizar nuestras clases y ficheros de la aplicaciÃ³n, y la relaciÃ³n entre ellos. TambiÃ©n veremos la utilizaciÃ³n de paquetes (<em>packages</em>) y el alias de tipos. Comencemos por la relaciÃ³n entre las clases y los ficheros fuentes.</p>
</div>
<div class="paragraph">
<p>La relaciÃ³n entre los ficheros fuente y las clases en Groovy no es tan estricta como en Java y los ficheros fuente en Groovy pueden contener tantas definiciones de clases como queramos, siguiente una serie de reglas:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Si el fichero <em>.groovy</em> no tiene la declaraciÃ³n de ninguna clase, Ã©ste se trata como si fuera un <em>script</em> y automÃ¡ticamente se genera una clase de tipo <em>Script</em> con el mismo nombre que el fichero <em>.groovy</em>.</p>
</li>
<li>
<p>Si el fichero <em>.groovy</em> contiene una sola clase definida con el mismo nombre que el fichero, la relaciÃ³n es la misma que en Java, es decir, un fichero .class por cada fichero <em>.groovy</em></p>
</li>
<li>
<p>Si el fichero <em>.groovy</em> contiene mÃ¡s de una clase definida, el compilador de groovy, <em>groovyc</em>, crearÃ¡ tantos ficheros <em>.class</em> como sean necesarios para cada una de las clases definidas en el fichero <em>.groovy</em>. Si quisiÃ©ramos llamar a nuestros scripts directamente a travÃ©s de la lÃ­nea de comandos, deberÃ­amos aÃ±adir el mÃ©todo <em>main()</em> a la primera de las clases definidas en el fichero <em>.groovy</em>.</p>
</li>
<li>
<p>Un fichero Groovy puede mezclar la definiciÃ³n de clases con el cÃ³digo script. En este caso, el cÃ³digo script se convierte en la clase principal a ejecutar, con lo que no se puede declarar una clase con el mismo nombre que el fichero fuente.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Otro aspecto importante para la organizaciÃ³n de los ficheros de nuestros proyectos en Groovy es la <strong>organizaciÃ³n en paquetes</strong>. En este sentido, Groovy sigue el mismo convenio que Java y su organizaciÃ³n jerÃ¡rquica. De esta forma, la estructura de paquetes se corresponde con los ficheros <em>.class</em> de la estructura de directorios.</p>
</div>
<div class="paragraph">
<p>Sin embargo, como ya se ha comentado en la sesiÃ³n anterior, no es necesario compilar nuestros archivos <em>.groovy</em>, con lo que se aÃ±ade un problema a la hora de ejecutar dichos archivos. Si no existen los archivos compilados <em>.class</em>, Â¿dÃ³nde los va a buscar? Groovy soluciona este <em>problema</em>, buscando tambiÃ©n en los archivos <em>.groovy</em> aquellas clases necesarias. AsÃ­, que el <em>classpath</em> no sÃ³lo nos va a servir para indicar los directorios donde debe buscar los archivos <em>.class</em>, sino tambiÃ©n para decirle donde pueden estar los archivos <em>.groovy</em>, en caso de que los archivos <em>.class</em> no estÃ©n. En el caso de que Groovy encuentre en el classpath, tanto ambos archivos, <em>.groovy</em> y <em>.class</em>, se quedarÃ¡ con el mÃ¡s reciente, y asÃ­ se evitarÃ¡n los problemas producidos porque se nos haya olvidado compilar nuestro archivo <em>.groovy</em>.</p>
</div>
<div class="paragraph">
<p>Al igual que en Java, las clases Groovy deben especificar su pertenencia a un paquete antes de su declaraciÃ³n. El siguiente fragmento de cÃ³digo muestra un ejemplo de un archivo con dos clases definidas que forman parte de un mismo paquete.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-kn">package</span> <span class="tok-n">negocio</span>

<span class="tok-kd">class</span> <span class="tok-nc">Cliente</span> <span class="tok-o">{</span>
  <span class="tok-n">String</span> <span class="tok-n">nombre</span><span class="tok-o">,</span> <span class="tok-n">producto</span>
  <span class="tok-n">Direccion</span> <span class="tok-n">direccion</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">Direccion</span><span class="tok-o">()</span>
<span class="tok-o">}</span>

<span class="tok-kd">class</span> <span class="tok-nc">Direccion</span> <span class="tok-o">{</span>
  <span class="tok-n">String</span> <span class="tok-n">calle</span><span class="tok-o">,</span> <span class="tok-n">ciudad</span><span class="tok-o">,</span> <span class="tok-n">provincia</span><span class="tok-o">,</span> <span class="tok-n">pais</span><span class="tok-o">,</span> <span class="tok-n">codigopostal</span>
<span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Para poder utilizar las clases declaradas <em>Cliente</em> y <em>Direccion</em>, debemos <em>importar</em> el paquete correspondiente <em>negocio</em>, tal y como aparece en el siguiente ejemplo.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-kn">import</span> <span class="tok-nn">negocio.*</span>

<span class="tok-kt">def</span> <span class="tok-n">clienteua</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">Cliente</span><span class="tok-o">()</span>
<span class="tok-n">clienteua</span><span class="tok-o">.</span><span class="tok-na">nombre</span> <span class="tok-o">=</span> <span class="tok-s1">&#39;Universidad de Alicante&#39;</span>
<span class="tok-n">clienteua</span><span class="tok-o">.</span><span class="tok-na">producto</span> <span class="tok-o">=</span> <span class="tok-s1">&#39;Pizarras digitales&#39;</span>

<span class="tok-k">assert</span> <span class="tok-n">clienteua</span><span class="tok-o">.</span><span class="tok-na">getNombre</span><span class="tok-o">()</span> <span class="tok-o">==</span> <span class="tok-s1">&#39;Universidad de Alicante&#39;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>El Ãºltimo aspecto importante a comentar en cuanto a la organizaciÃ³n de las clases y los archivos de nuestras aplicaciones, se refiere a la posibilidad de establecer alias a los paquetes importados. Imaginad el caso de tener dos paquetes procedentes de terceras partes que contengan una clase con el mismo nombre. En Groovy podemos solucionar este conflicto de nomenclatura utilizando los alias. Veamos como:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-kn">import</span> <span class="tok-nn">agenteexterno1.OtraClase</span> <span class="tok-k">as</span> <span class="tok-n">OtraClase1</span>
<span class="tok-kn">import</span> <span class="tok-nn">agenteexterno2.OtraClase</span> <span class="tok-k">as</span> <span class="tok-n">OtraClase2</span>

<span class="tok-kt">def</span> <span class="tok-n">otraClase1</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">OtraClase1</span><span class="tok-o">()</span>
<span class="tok-kt">def</span> <span class="tok-n">otraClase2</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">OtraClase2</span><span class="tok-o">()</span></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_caracterÃ­sticas_avanzadas_del_modelo_orientado_a_objetos">2.2.3. CaracterÃ­sticas avanzadas del modelo orientado a objetos</h4>
<div class="paragraph">
<p>Ahora que ya tenemos unos conocimientos bÃ¡sicos de lo que Groovy nos permite en cuanto al modelo orientado a objetos, pasemos a ver conceptos algo mÃ¡s avanzados de los vistos hasta ahora, como son la <em>herencia</em>, los <em>interfaces</em> y los <em>multimÃ©todos</em>.</p>
</div>
<div class="paragraph">
<p>Cuando hablamos de <strong>herencia</strong> en el modelo orientado a objetos, nos referimos a la posibilidad de aÃ±adir campos y mÃ©todos a una clase a partir de una clase base. Groovy permite la herencia en los mismos tÃ©rminos que lo hace Java. Es mÃ¡s, una clase Groovy puede extender una clase Java y viceversa.</p>
</div>
<div class="paragraph">
<p>Groovy tambiÃ©n soporta el modelo de <em>interfaces</em> de Java. En Java, un interface es una clase especial en la que todos sus mÃ©todos son abstractos y pÃºblicos. Sin embargo, estos mÃ©todos no estÃ¡n implementados en la clase interface, sino que esa labor se deja para la clase que implemente esa interface. Los interfaces son lo mÃ¡s parecido a la herencia mÃºltiple, ya que una clase puede implementar mÃ¡s de un interface pero sÃ³lo puede extender una clase.</p>
</div>
<div class="paragraph">
<p>Por Ãºltimo, comentar que en Groovy el tipo de los datos se elige de manera dinÃ¡mica cuando Ã©stos son pasados como parÃ¡metros a los mÃ©todos de nuestras clases. Esta caracterÃ­stica de Groovy se le conoce como <em>multimÃ©todo</em> y lo mejor es que veamos un ejemplo.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-kt">def</span> <span class="tok-nf">multimetodo</span><span class="tok-o">(</span><span class="tok-n">Object</span> <span class="tok-n">o</span><span class="tok-o">)</span> <span class="tok-o">{</span> <span class="tok-k">return</span> <span class="tok-s1">&#39;objeto&#39;</span> <span class="tok-o">}</span>
<span class="tok-kt">def</span> <span class="tok-nf">multimetodo</span><span class="tok-o">(</span><span class="tok-n">String</span> <span class="tok-n">o</span><span class="tok-o">)</span> <span class="tok-o">{</span> <span class="tok-k">return</span> <span class="tok-s1">&#39;string&#39;</span> <span class="tok-o">}</span>

<span class="tok-n">Object</span> <span class="tok-n">x</span> <span class="tok-o">=</span> <span class="tok-mi">1</span>
<span class="tok-n">Object</span> <span class="tok-n">y</span> <span class="tok-o">=</span> <span class="tok-s1">&#39;foo&#39;</span>

<span class="tok-k">assert</span> <span class="tok-s1">&#39;objeto&#39;</span> <span class="tok-o">==</span> <span class="tok-n">multimetodo</span><span class="tok-o">(</span><span class="tok-n">x</span><span class="tok-o">)</span>
<span class="tok-k">assert</span> <span class="tok-s1">&#39;string&#39;</span> <span class="tok-o">==</span> <span class="tok-n">multimetodo</span><span class="tok-o">(</span><span class="tok-n">y</span><span class="tok-o">)</span><span class="tok-c1">//En Java, esta llamada hubiera devuelto la palabra &#39;objeto&#39;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>En el ejemplo anterior, el tipo de datos estÃ¡tico de la variable <em>x</em> es <em>Object</em> mientras que su tipo dinÃ¡mico es <em>Integer</em>, mientras que el tipo estÃ¡tico de <em>y</em> es <em>Object</em> mientras que su tipo dinÃ¡mico es <em>String</em>. Debido a que Groovy intenta utilizar el tipo dinÃ¡mico de las variables, en el segundo caso se ejecuta el mÃ©todo que tiene como parÃ¡metro una variable de tipo String.</p>
</div>
</div>
<div class="sect3">
<h4 id="_groovybeans_2">2.2.4. GroovyBeans</h4>
<div class="paragraph">
<p>En Java, los JavaBeans se introdujeron en su momento para definir un modelo de componentes para la construcciÃ³n de aplicaciones Java. BÃ¡sicamente el modelo consiste en una serie de convenciones en cuanto a los nombres que permiten a las clases Java comunicarse unas con otras. Groovy utiliza tambiÃ©n el concepto inherente a los JavaBeans, pero lo transforma para dar paso a los GroovyBeans, con unas mejoras particulares, como facilitar el acceso a los mÃ©todos. Vayamos paso a paso.</p>
</div>
<div class="paragraph">
<p>Empecemos por la declaraciÃ³n de los GroovyBeans. Imaginemos que tenemos de nuevo la clase Libro con tan solo la propiedad tÃ­tulo. En Java tendrÃ­amos el siguiente JavaBean:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span class="tok-kd">public</span> <span class="tok-kd">class</span> <span class="tok-nc">Libro</span> <span class="tok-kd">implements</span> <span class="tok-n">java</span><span class="tok-o">.</span><span class="tok-na">io</span><span class="tok-o">.</span><span class="tok-na">Serializable</span> <span class="tok-o">{</span>
    <span class="tok-kd">private</span> <span class="tok-n">String</span> <span class="tok-n">titulo</span><span class="tok-o">;</span>

    <span class="tok-kd">public</span> <span class="tok-n">String</span> <span class="tok-nf">getTitulo</span><span class="tok-o">(){</span>
        <span class="tok-k">return</span> <span class="tok-n">titulo</span><span class="tok-o">;</span>
    <span class="tok-o">}</span>

    <span class="tok-kd">public</span> <span class="tok-kt">void</span> <span class="tok-nf">setTitulo</span><span class="tok-o">(</span><span class="tok-n">String</span> <span class="tok-n">valor</span><span class="tok-o">){</span>
        <span class="tok-n">titulo</span> <span class="tok-o">=</span> <span class="tok-n">valor</span><span class="tok-o">;</span>
    <span class="tok-o">}</span>
<span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Mientras que en Groovy, simplemente necesitarÃ­amos tener esto otro:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-kd">class</span> <span class="tok-nc">Libro</span> <span class="tok-kd">implements</span> <span class="tok-n">java</span><span class="tok-o">.</span><span class="tok-na">io</span><span class="tok-o">.</span><span class="tok-na">Serializable</span> <span class="tok-o">{</span>
  <span class="tok-n">String</span> <span class="tok-n">titulo</span>
<span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Las diferencias son evidentes, Â¿no crees? Pero no sÃ³lo es una cuestiÃ³n de ahorro en cÃ³digo, sino tambiÃ©n de eficiencia. Imagina simplemente que por cualquier motivo, tuvieras que cambiar el nombre al campo <em>titulo</em>, ese simple cambio en Java supondrÃ­a cambiar el cÃ³digo en tres lugares diferentes, sin embargo, en Groovy, simplemente cambiando el nombre de la propiedad lo tendrÃ­amos todo. AdemÃ¡s, Groovy tambiÃ©n nos ahorra tener que escribir los mÃ©todos <em>setTitulo()</em> y <em>getTitulo()</em>. Esto lo hace Ãºnicamente cuando no se han especificado dichos mÃ©todos en el GroovyBean. AdemÃ¡s, Groovy sabe perfectamente cuando debe especificar un mÃ©todo <em>set</em> para acceder a una propiedad. Por ejemplo, si establecemos que una propiedad de nuestro GroovyBean es <em>final</em>, esta propiedad solamente serÃ¡ de lectura, asÃ­ que Groovy no implementa su correspondiente mÃ©todo <em>set</em>.</p>
</div>
<div class="paragraph">
<p>De igual forma, Groovy tambiÃ©n permite el acceso a las propiedades utilizando el operador ., como por ejemplo <em>libro.titulo = 'Groovy in action'</em>. Pero, como siempre, hay algo mÃ¡s. Observemos detenidamente el siguiente ejemplo.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-kd">class</span> <span class="tok-nc">Persona</span> <span class="tok-o">{</span>
    <span class="tok-n">String</span> <span class="tok-n">nombre</span><span class="tok-o">,</span> <span class="tok-n">apellidos</span>

    <span class="tok-n">String</span> <span class="tok-nf">getNombreCompleto</span><span class="tok-o">(){</span>
        <span class="tok-k">return</span> <span class="tok-s2">&quot;$nombre $apellidos&quot;</span>
    <span class="tok-o">}</span>
<span class="tok-o">}</span>

<span class="tok-kt">def</span> <span class="tok-n">juan</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">Persona</span><span class="tok-o">(</span><span class="tok-nl">nombre:</span><span class="tok-s2">&quot;Juan&quot;</span><span class="tok-o">)</span>
<span class="tok-n">juan</span><span class="tok-o">.</span><span class="tok-na">apellidos</span> <span class="tok-o">=</span> <span class="tok-s2">&quot;MartÃ­nez&quot;</span>

<span class="tok-k">assert</span> <span class="tok-n">juan</span><span class="tok-o">.</span><span class="tok-na">nombreCompleto</span> <span class="tok-o">==</span> <span class="tok-s2">&quot;Juan MartÃ­nez&quot;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Tenemos el mÃ©todo <em>getNombreCompleto()</em> para obtener el nombre completo de la persona en cuestiÃ³n. Pues Groovy ademÃ¡s, crea al vuelo una propiedad equivalente al mÃ©todo <em>get()</em>, en nuestro caso, <em>nombreCompleto</em>.</p>
</div>
<div class="paragraph">
<p>En ocasiones, los mÃ©todos <em>get()</em> no tienen porque devolver el valor concreto del campo en cuestiÃ³n, sino que es posible que hayan hecho algÃºn tratamiento sobre dicho campo para modificar el valor devuelto. Imaginemos una clase que duplique el valor de su Ãºnica propiedad cuando se invoca por los mÃ©todos tradicionales (bien mediante el mÃ©todo get o mediante el operador .).</p>
</div>
<div class="paragraph">
<p>AdemÃ¡s, Groovy tambiÃ©n nos ofrece la posibilidad de recuperar el valor original del campo sin pasar por su correspondiente getter con el operador <em>@</em>, tal y como aparece en la Ãºltima lÃ­nea de este ejemplo.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-kd">class</span> <span class="tok-nc">DobleValor</span> <span class="tok-o">{</span>
    <span class="tok-kt">def</span> <span class="tok-n">valor</span>

    <span class="tok-kt">void</span> <span class="tok-nf">setValor</span><span class="tok-o">(</span><span class="tok-n">valor</span><span class="tok-o">){</span>
        <span class="tok-k">this</span><span class="tok-o">.</span><span class="tok-na">valor</span> <span class="tok-o">=</span> <span class="tok-n">valor</span>
    <span class="tok-o">}</span>

    <span class="tok-kt">def</span> <span class="tok-nf">getValor</span><span class="tok-o">(){</span>
        <span class="tok-n">valor</span> <span class="tok-o">*</span> <span class="tok-mi">2</span>
    <span class="tok-o">}</span>
<span class="tok-o">}</span>

<span class="tok-kt">def</span> <span class="tok-n">doble</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">DobleValor</span><span class="tok-o">(</span><span class="tok-nl">valor:</span> <span class="tok-mi">300</span><span class="tok-o">)</span>

<span class="tok-k">assert</span> <span class="tok-mi">600</span> <span class="tok-o">==</span> <span class="tok-n">doble</span><span class="tok-o">.</span><span class="tok-na">getValor</span><span class="tok-o">()</span>
<span class="tok-k">assert</span> <span class="tok-mi">600</span> <span class="tok-o">==</span> <span class="tok-n">doble</span><span class="tok-o">.</span><span class="tok-na">valor</span>
<span class="tok-k">assert</span> <span class="tok-mi">300</span> <span class="tok-o">==</span> <span class="tok-n">doble</span><span class="tok-o">.</span><span class="tok-nd">@valor</span></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_operador_2">2.2.5. Operador *</h4>
<div class="paragraph">
<p>Groovy presenta ademÃ¡s, otra caracterÃ­stica conocida como el operador <em>spread *</em>. Este operador permite pasar una lista a un mÃ©todo que contiene una serie de parÃ¡metros. De esta forma, se consigue en cierta forma sobrecargar el mÃ©todo en cuestiÃ³n como si permitiese tambiÃ©n la introducciÃ³n de sus parÃ¡metros en forma de lista. Veamos un ejemplo. Imagina que tienes un mÃ©todo que devuelve una lista de resultados, los cuales deben pasados uno por uno a otro mÃ©todo.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-kt">def</span> <span class="tok-nf">getLista</span><span class="tok-o">(){</span>
    <span class="tok-k">return</span> <span class="tok-o">[</span><span class="tok-mi">1</span><span class="tok-o">,</span><span class="tok-mi">2</span><span class="tok-o">,</span><span class="tok-mi">3</span><span class="tok-o">,</span><span class="tok-mi">4</span><span class="tok-o">,</span><span class="tok-mi">5</span><span class="tok-o">]</span>
<span class="tok-o">}</span>

<span class="tok-kt">def</span> <span class="tok-nf">suma</span><span class="tok-o">(</span><span class="tok-n">a</span><span class="tok-o">,</span> <span class="tok-n">b</span><span class="tok-o">,</span> <span class="tok-n">c</span><span class="tok-o">,</span> <span class="tok-n">d</span><span class="tok-o">,</span> <span class="tok-n">e</span><span class="tok-o">){</span>
    <span class="tok-k">return</span> <span class="tok-n">a</span> <span class="tok-o">+</span> <span class="tok-n">b</span> <span class="tok-o">+</span> <span class="tok-n">c</span> <span class="tok-o">+</span> <span class="tok-n">d</span> <span class="tok-o">+</span> <span class="tok-n">e</span>
<span class="tok-o">}</span>

<span class="tok-k">assert</span> <span class="tok-mi">15</span> <span class="tok-o">==</span> <span class="tok-n">suma</span><span class="tok-o">(*</span><span class="tok-n">lista</span><span class="tok-o">)</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Sencillo, y sin tener que destripar la lista en varios parÃ¡metros.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_metaprogramaciÃ³n">2.3. MetaprogramaciÃ³n</h3>
<div class="sect3">
<h4 id="_definiciÃ³n_de_metaprogramaciÃ³n">2.3.1. DefiniciÃ³n de metaprogramaciÃ³n</h4>
<div class="paragraph">
<p>SegÃºn Wikipedia:</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p><strong>DefiniciÃ³n de MetaprogramaciÃ³n</strong></p>
</div>
<div class="paragraph">
<p>La metaprogramaciÃ³n consiste en escribir programas que escriben o manipulen otros programas (o a sÃ­ mismos) como datos, o que hacen en tiempo de compilaciÃ³n parte del trabajo que, de otra forma, se harÃ­a en tiempo de ejecuciÃ³n. Esto permite al programador ahorrar tiempo en la producciÃ³n de cÃ³digo.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>BÃ¡sicamente esto significa que en tiempo de ejecuciÃ³n nuestro programa podrÃ¡ cambiar su funcionamiento sin necesidad de ser compilado nuevamente.</p>
</div>
</div>
<div class="sect3">
<h4 id="_metaprogramaciÃ³n_en_groovy">2.3.2. MetaprogramaciÃ³n en Groovy</h4>
<div class="paragraph">
<p>Entre las mejores cualidades de Groovy como lenguaje de programaciÃ³n destaca las facilidades que presenta para realizar dicha metaprogramaciÃ³n. Â¿Y cuÃ¡les son estas caracterÃ­sticas?</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Todo mÃ©todo de cualquier objecto invocado desde Groovy pasa por un intermediario (MOP - MetaObjectProtocol)</p>
</li>
<li>
<p>Posibilidad de interceptar llamadas a mÃ©todos o acceso a propiedades</p>
</li>
<li>
<p>Crear y modificar mÃ©todos en tiempo de ejecuciÃ³n para por ejemplo extender directamente la clase <em>java.lang.String</em></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Pero veamos algÃºn ejemplo de lo que podemos hacer con metaprogramaciÃ³n en Groovy.</p>
</div>
</div>
<div class="sect3">
<h4 id="_clase_expando">2.3.3. Clase Expando</h4>
<div class="paragraph">
<p>Groovy dispone de una clase llamada <em>Expando (<a href="http://groovy.codehaus.org/api/groovy/util/Expando.html" class="bare">http://groovy.codehaus.org/api/groovy/util/Expando.html</a>)</em>. Esta es una clase especial de Groovy que nos permitirÃ¡ aÃ±adir mÃ©todos, constructores, propiedades y mÃ©todos estÃ¡ticos utilizando una sintaxis basada en closures, tal y como demuestra el siguiente ejemplo.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-kt">def</span> <span class="tok-n">miExpando</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">Expando</span><span class="tok-o">()</span>

<span class="tok-n">miExpando</span><span class="tok-o">.</span><span class="tok-na">factor</span> <span class="tok-o">=</span> <span class="tok-mi">5</span>

<span class="tok-n">miExpando</span><span class="tok-o">.</span><span class="tok-na">multiplica</span> <span class="tok-o">=</span> <span class="tok-o">{</span> <span class="tok-n">a</span> <span class="tok-o">-&gt;</span> <span class="tok-n">factor</span> <span class="tok-o">*</span> <span class="tok-n">a</span> <span class="tok-o">}</span>

<span class="tok-k">assert</span> <span class="tok-n">miExpando</span><span class="tok-o">.</span><span class="tok-na">multiplica</span><span class="tok-o">(</span><span class="tok-mi">4</span><span class="tok-o">)</span> <span class="tok-o">==</span> <span class="tok-mi">20</span>

<span class="tok-k">assert</span> <span class="tok-n">miExpando</span><span class="tok-o">.</span><span class="tok-na">resto</span> <span class="tok-o">==</span> <span class="tok-kc">null</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Â¿MÃ¡gia? Por supuesto que no. Esto es lo que realmente estÃ¡ pasando.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-n">miExpando</span><span class="tok-o">.</span><span class="tok-na">factor</span> <span class="tok-o">=</span> <span class="tok-mi">5</span>
<span class="tok-c1">//Realmente...</span>
<span class="tok-n">miExpando</span><span class="tok-o">.</span><span class="tok-na">setProperty</span><span class="tok-o">(</span><span class="tok-s1">&#39;factor&#39;</span><span class="tok-o">,</span><span class="tok-mi">5</span><span class="tok-o">)</span>

<span class="tok-n">miExpando</span><span class="tok-o">.</span><span class="tok-na">factor</span>
<span class="tok-c1">//Realmente...</span>
<span class="tok-n">miExpando</span><span class="tok-o">.</span><span class="tok-na">getProperty</span><span class="tok-o">(</span><span class="tok-s1">&#39;factor&#39;</span><span class="tok-o">)</span>

<span class="tok-n">miExpando</span><span class="tok-o">.</span><span class="tok-na">multiplica</span><span class="tok-o">(</span><span class="tok-mi">4</span><span class="tok-o">)</span>
<span class="tok-c1">//Realmente...</span>
<span class="tok-n">miExpando</span><span class="tok-o">.</span><span class="tok-na">invokeMethod</span><span class="tok-o">(</span><span class="tok-s1">&#39;multiplica&#39;</span><span class="tok-o">,</span> <span class="tok-o">[</span><span class="tok-mi">4</span><span class="tok-o">]</span> <span class="tok-k">as</span> <span class="tok-n">Object</span><span class="tok-o">[])</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Veamos otro ejemplo de lo que supone la metaprogramaciÃ³n en Groovy:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-kd">class</span> <span class="tok-nc">MiExpando</span> <span class="tok-o">{</span>
    <span class="tok-kd">private</span> <span class="tok-n">dynamicProperties</span> <span class="tok-o">=</span> <span class="tok-o">[:]</span>

    <span class="tok-kt">void</span> <span class="tok-nf">setProperty</span><span class="tok-o">(</span><span class="tok-n">String</span> <span class="tok-n">propName</span><span class="tok-o">,</span> <span class="tok-n">val</span><span class="tok-o">){</span>
        <span class="tok-n">dynamicProperties</span><span class="tok-o">[</span><span class="tok-n">propName</span><span class="tok-o">]</span> <span class="tok-o">=</span> <span class="tok-n">val</span>
    <span class="tok-o">}</span>

    <span class="tok-kt">def</span> <span class="tok-nf">getProperty</span><span class="tok-o">(</span><span class="tok-n">String</span> <span class="tok-n">propName</span><span class="tok-o">)</span> <span class="tok-o">{</span>
        <span class="tok-n">dynamicProperties</span><span class="tok-o">[</span><span class="tok-n">propName</span><span class="tok-o">]</span>
    <span class="tok-o">}</span>

    <span class="tok-kt">def</span> <span class="tok-nf">methodMissing</span><span class="tok-o">(</span><span class="tok-n">String</span> <span class="tok-n">methodName</span><span class="tok-o">,</span> <span class="tok-n">args</span><span class="tok-o">){</span>
        <span class="tok-kt">def</span> <span class="tok-n">prop</span> <span class="tok-o">=</span> <span class="tok-n">dynamicProperties</span><span class="tok-o">[</span><span class="tok-n">methodName</span><span class="tok-o">]</span>
        <span class="tok-k">if</span> <span class="tok-o">(</span><span class="tok-n">prop</span> <span class="tok-k">instanceof</span> <span class="tok-n">Closure</span><span class="tok-o">)</span> <span class="tok-o">{</span>
            <span class="tok-k">return</span> <span class="tok-nf">prop</span><span class="tok-o">(*</span><span class="tok-n">args</span><span class="tok-o">)</span>
        <span class="tok-o">}</span>
    <span class="tok-o">}</span>
<span class="tok-o">}</span>

<span class="tok-kt">def</span> <span class="tok-n">miExpando</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">MiExpando</span><span class="tok-o">()</span>
<span class="tok-n">miExpando</span><span class="tok-o">.</span><span class="tok-na">a</span> <span class="tok-o">=</span> <span class="tok-mi">4</span>
<span class="tok-n">miExpando</span><span class="tok-o">.</span><span class="tok-na">b</span> <span class="tok-o">=</span> <span class="tok-mi">5</span>
<span class="tok-n">miExpando</span><span class="tok-o">.</span><span class="tok-na">suma</span> <span class="tok-o">=</span> <span class="tok-o">{</span> <span class="tok-n">x</span><span class="tok-o">,</span> <span class="tok-n">y</span> <span class="tok-o">-&gt;</span> <span class="tok-n">x</span> <span class="tok-o">+</span> <span class="tok-n">y</span> <span class="tok-o">}</span>

<span class="tok-k">assert</span> <span class="tok-n">miExpando</span><span class="tok-o">.</span><span class="tok-na">a</span> <span class="tok-o">==</span> <span class="tok-mi">4</span>
<span class="tok-k">assert</span> <span class="tok-n">miExpando</span><span class="tok-o">.</span><span class="tok-na">b</span> <span class="tok-o">==</span> <span class="tok-mi">5</span>
<span class="tok-k">assert</span> <span class="tok-n">miExpando</span><span class="tok-o">.</span><span class="tok-na">suma</span><span class="tok-o">(</span><span class="tok-mi">4</span><span class="tok-o">,</span><span class="tok-mi">5</span><span class="tok-o">)</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Como podrÃ¡s imaginar, la nueva clase <em>MiExpando</em> que acabamos de crear tiene la misma funcionalidad que la clase de Groovy <em>Expando</em>. Por supuesto, la magia reside en los mÃ©todos <em>setProperty(String, Object)</em>, <em>getProperty(String)</em> y <em>methodMissing(String, Object[])</em>. Cuando en Groovy se realiza una llamada a un mÃ©todo que no existe, se intenta llamar al mÃ©todo <em>methodMissing(String, Object[])</em> con lo que si sobrecargamos ese mÃ©todo vamos a poder hacer cualquier cosa, como por ejemplo invocar un closure o bien escribir un log indicando que alguien ha llamada a un mÃ©todo que no existe.</p>
</div>
</div>
<div class="sect3">
<h4 id="_objeto_delegate">2.3.4. Objeto delegate</h4>
<div class="paragraph">
<p>Todo closure tiene asociado un objeto conocido como <em>delegate</em> que puede ser cualquier tipo de objeto y es la forma de tener un objeto que responda a determinadas llamadas a mÃ©todos y propiedades.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-kt">def</span> <span class="tok-n">miclosure</span> <span class="tok-o">=</span> <span class="tok-o">{</span>
    <span class="tok-n">concat</span> <span class="tok-s2">&quot; Mundo!&quot;</span>
<span class="tok-o">}</span>

<span class="tok-kt">def</span> <span class="tok-n">s</span> <span class="tok-o">=</span> <span class="tok-s2">&quot;Hola&quot;</span>
<span class="tok-n">miclosure</span><span class="tok-o">.</span><span class="tok-na">delegate</span> <span class="tok-o">=</span> <span class="tok-n">s</span>
<span class="tok-k">assert</span> <span class="tok-n">miclosure</span><span class="tok-o">.</span><span class="tok-na">call</span><span class="tok-o">()</span> <span class="tok-o">==</span> <span class="tok-s2">&quot;Hola Mundo!&quot;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Pero, Â¿quÃ© pasarÃ­a si tuviÃ©ramos un mÃ©todo <em>concat(String)</em>? Â¿CuÃ¡l de los dos mÃ©todos se ejecutarÃ­a al realizar la llamada desde el closure?</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-kt">def</span> <span class="tok-nf">concat</span><span class="tok-o">(</span><span class="tok-n">String</span> <span class="tok-n">arg</span><span class="tok-o">)</span> <span class="tok-o">{</span>
    <span class="tok-k">return</span> <span class="tok-s2">&quot;Concat llamado con arg = $arg&quot;</span>
<span class="tok-o">}</span>

<span class="tok-kt">def</span> <span class="tok-n">miclosure</span> <span class="tok-o">=</span> <span class="tok-o">{</span>
    <span class="tok-n">concat</span> <span class="tok-s2">&quot; Mundo!&quot;</span>
<span class="tok-o">}</span>

<span class="tok-kt">def</span> <span class="tok-n">s</span> <span class="tok-o">=</span> <span class="tok-s2">&quot;Hola&quot;</span>
<span class="tok-n">miclosure</span><span class="tok-o">.</span><span class="tok-na">delegate</span> <span class="tok-o">=</span> <span class="tok-n">s</span>
<span class="tok-k">assert</span> <span class="tok-n">miclosure</span><span class="tok-o">.</span><span class="tok-na">call</span><span class="tok-o">()</span> <span class="tok-o">==</span> <span class="tok-s2">&quot;Concat llamado con arg =  Mundo!&quot;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Como vÃ©is, el mÃ©todo invocado ha sido el que hemos creado con lo que el objeto <em>delegate</em> no ha sido contemplado dentro del closure a la hora de invocar el mÃ©todo <em>concat(String)</em>. AquÃ­ es donde surge el concepto de la estrategia que tienen los closures para resolver las llamadas a mÃ©todos y tenemos cuatro estrategÃ­as diferentes: <em>OWNER_FIRST</em>, <em>DELEGATE_FIRST</em>, <em>OWNER_ONLY</em> y <em>DELEGATE_ONLY</em> y en funciÃ³n de que estrategÃ­a se utilice, la llamada al mÃ©todo concat se resolverÃ¡ de una forma u otra. Por defecto, la estrategia seguida si no se indica otra es <em>OWNER_FIRST</em>. Comentar tambiÃ©n que cada closure tiene un <em>owner (propietario)</em> y que siempre es aquel objeto o clase que cree el closure.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-kt">def</span> <span class="tok-nf">concat</span><span class="tok-o">(</span><span class="tok-n">String</span> <span class="tok-n">arg</span><span class="tok-o">)</span> <span class="tok-o">{</span>
    <span class="tok-k">return</span> <span class="tok-s2">&quot;Concat llamado con arg = $arg&quot;</span>
<span class="tok-o">}</span>

<span class="tok-kt">def</span> <span class="tok-n">miclosure</span> <span class="tok-o">=</span> <span class="tok-o">{</span>
    <span class="tok-n">concat</span> <span class="tok-s2">&quot; Mundo!&quot;</span>
<span class="tok-o">}</span>

<span class="tok-kt">def</span> <span class="tok-n">s</span> <span class="tok-o">=</span> <span class="tok-s2">&quot;Hola&quot;</span>
<span class="tok-n">miclosure</span><span class="tok-o">.</span><span class="tok-na">delegate</span> <span class="tok-o">=</span> <span class="tok-n">s</span>

<span class="tok-k">assert</span> <span class="tok-n">miclosure</span><span class="tok-o">.</span><span class="tok-na">resolveStrategy</span> <span class="tok-o">==</span> <span class="tok-n">Closure</span><span class="tok-o">.</span><span class="tok-na">OWNER_FIRST</span>
<span class="tok-k">assert</span> <span class="tok-n">miclosure</span><span class="tok-o">.</span><span class="tok-na">call</span><span class="tok-o">()</span> <span class="tok-o">==</span> <span class="tok-s2">&quot;Concat llamado con arg =  Mundo!&quot;</span>

<span class="tok-n">miclosure</span><span class="tok-o">.</span><span class="tok-na">resolveStrategy</span> <span class="tok-o">=</span> <span class="tok-n">Closure</span><span class="tok-o">.</span><span class="tok-na">OWNER_FIRST</span>
<span class="tok-k">assert</span> <span class="tok-n">miclosure</span><span class="tok-o">.</span><span class="tok-na">call</span><span class="tok-o">()</span> <span class="tok-o">==</span> <span class="tok-s2">&quot;Concat llamado con arg =  Mundo!&quot;</span>

<span class="tok-n">miclosure</span><span class="tok-o">.</span><span class="tok-na">resolveStrategy</span> <span class="tok-o">=</span> <span class="tok-n">Closure</span><span class="tok-o">.</span><span class="tok-na">DELEGATE_FIRST</span>
<span class="tok-k">assert</span> <span class="tok-n">miclosure</span><span class="tok-o">.</span><span class="tok-na">call</span><span class="tok-o">()</span> <span class="tok-o">==</span> <span class="tok-s2">&quot;Hola Mundo!&quot;</span>

<span class="tok-n">miclosure</span><span class="tok-o">.</span><span class="tok-na">resolveStrategy</span> <span class="tok-o">=</span> <span class="tok-n">Closure</span><span class="tok-o">.</span><span class="tok-na">OWNER_ONLY</span>
<span class="tok-k">assert</span> <span class="tok-n">miclosure</span><span class="tok-o">.</span><span class="tok-na">call</span><span class="tok-o">()</span> <span class="tok-o">==</span> <span class="tok-s2">&quot;Concat llamado con arg =  Mundo!&quot;</span>

<span class="tok-n">miclosure</span><span class="tok-o">.</span><span class="tok-na">resolveStrategy</span> <span class="tok-o">=</span> <span class="tok-n">Closure</span><span class="tok-o">.</span><span class="tok-na">DELEGATE_ONLY</span>
<span class="tok-k">assert</span> <span class="tok-n">miclosure</span><span class="tok-o">.</span><span class="tok-na">call</span><span class="tok-o">()</span> <span class="tok-o">==</span> <span class="tok-s2">&quot;Hola Mundo!&quot;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Comentar por Ãºltimo que, el object <em>delegate</em> por defecto de cualquier closure siempre serÃ¡ el propietario del closure.</p>
</div>
</div>
<div class="sect3">
<h4 id="_metaclass">2.3.5. Metaclass</h4>
<div class="paragraph">
<p>Toda clase creada en Groovy tiene un objeto asociado conocido como <em>metaClass</em>. Este objeto es del tipo <em>MetaClassImpl (<a href="http://groovy.codehaus.org/gapi/groovy/lang/MetaClassImpl.html" class="bare">http://groovy.codehaus.org/gapi/groovy/lang/MetaClassImpl.html</a>)</em> y gracias a Ã©l vamos a poder por ejemplo extender en tiempo de ejecuciÃ³n cualquier clase, como por ejemplo <em>java.lang.String</em>.</p>
</div>
<div class="paragraph">
<p>Habitualmente, en cualquier proyecto con Groovy tendremos una clase llamada StringUtils donde solemos meter todo tipo de mÃ©todos estÃ¡ticos para realizar operaciones sobre las cadenas de caracteres. Sin embargo, con Groovy vamos a poder extender la clase <em>java.lang.String</em> sin necesidad de crear una nueva clase extendida. Para ello utilizaremos el objeto <em>metaClass</em> que, recordad, tienen todos las clases creadas en Groovy.</p>
</div>
<div class="paragraph">
<p>En el siguiente ejemplo vamos a modificar en tiempo de ejecuciÃ³n la clase <em>java.lang.String</em> para aÃ±adir un nuevo mÃ©todo que corte aquellas cadenas de caracteres a los primeros 140 caracteres.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-kt">def</span> <span class="tok-n">textoLargo</span> <span class="tok-o">=</span> <span class="tok-s2">&quot;&quot;&quot;La metaprogramaciÃ³n consiste en escribir programas que escriben o manipulan otros programas</span>
<span class="tok-s2">(o a sÃ­ mismos) como datos, o que hacen en tiempo de compilaciÃ³n parte del trabajo que, de</span>
<span class="tok-s2">otra forma, se harÃ­a en tiempo de ejecuciÃ³n. Esto permite al programador ahorrar tiempo en</span>
<span class="tok-s2">la producciÃ³n de cÃ³digo.&quot;&quot;&quot;</span>

<span class="tok-kt">def</span> <span class="tok-n">textoCorto</span> <span class="tok-o">=</span> <span class="tok-s2">&quot;La metaprogramaciÃ³n consiste en escribir programas que escriben o manipulan otros programas&quot;</span>

<span class="tok-k">assert</span> <span class="tok-n">textoLargo</span> <span class="tok-k">instanceof</span> <span class="tok-n">java</span><span class="tok-o">.</span><span class="tok-na">lang</span><span class="tok-o">.</span><span class="tok-na">String</span>
<span class="tok-k">assert</span> <span class="tok-n">textoCorto</span> <span class="tok-k">instanceof</span> <span class="tok-n">java</span><span class="tok-o">.</span><span class="tok-na">lang</span><span class="tok-o">.</span><span class="tok-na">String</span>


<span class="tok-n">String</span><span class="tok-o">.</span><span class="tok-na">metaClass</span><span class="tok-o">.</span><span class="tok-na">cortaLosPrimeros140Caracteres</span> <span class="tok-o">=</span> <span class="tok-o">{</span>
    <span class="tok-n">delegate</span><span class="tok-o">.</span><span class="tok-na">size</span><span class="tok-o">()</span> <span class="tok-o">&gt;=</span> <span class="tok-mi">140</span> <span class="tok-o">?</span> <span class="tok-s2">&quot;${delegate.take(137)}...&quot;</span> <span class="tok-o">:</span> <span class="tok-n">delegate</span>
<span class="tok-o">}</span>

<span class="tok-n">println</span> <span class="tok-n">textoLargo</span><span class="tok-o">.</span><span class="tok-na">cortaLosPrimeros140Caracteres</span><span class="tok-o">()</span>
<span class="tok-n">println</span> <span class="tok-n">textoCorto</span><span class="tok-o">.</span><span class="tok-na">cortaLosPrimeros140Caracteres</span><span class="tok-o">()</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>AdemÃ¡s de las clases, las objetos creados en Groovy tambiÃ©n tienen el objeto <em>metaClass</em> con lo que en ocasiones es posible que nos interese simplemente modificar el comportamiento de un sÃ³lo objeto y no de todos los objetos de una determinada clase. Esto nos serÃ¡ de gran utilidad cuando veamos la parte de los tests unitarios en Grails.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-kt">def</span> <span class="tok-n">texto1</span> <span class="tok-o">=</span> <span class="tok-s2">&quot;texto 1&quot;</span>
<span class="tok-kt">def</span> <span class="tok-n">texto2</span> <span class="tok-o">=</span> <span class="tok-s2">&quot;texto 2&quot;</span>

<span class="tok-n">texto1</span><span class="tok-o">.</span><span class="tok-na">metaClass</span><span class="tok-o">.</span><span class="tok-na">foo</span> <span class="tok-o">=</span> <span class="tok-o">{</span>
    <span class="tok-s2">&quot;${delegate}foo&quot;</span>
<span class="tok-o">}</span>

<span class="tok-k">assert</span> <span class="tok-n">texto1</span><span class="tok-o">.</span><span class="tok-na">foo</span><span class="tok-o">()</span> <span class="tok-o">==</span> <span class="tok-s2">&quot;texto 1foo&quot;</span>

<span class="tok-k">try</span> <span class="tok-o">{</span>
    <span class="tok-k">assert</span> <span class="tok-n">texto2</span><span class="tok-o">.</span><span class="tok-na">foo</span><span class="tok-o">()</span> <span class="tok-o">==</span> <span class="tok-s2">&quot;texto 2foo&quot;</span>
<span class="tok-o">}</span> <span class="tok-k">catch</span> <span class="tok-o">(</span><span class="tok-n">MissingMethodException</span> <span class="tok-n">mme</span><span class="tok-o">)</span> <span class="tok-o">{</span>
    <span class="tok-n">println</span> <span class="tok-s2">&quot;El mÃ©todo foo no existe&quot;</span>
<span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Es importante saber, que cuando no necesitemos los mÃ©todos especifados en el objeto <em>metaClass</em> debemos referenciar dicho objeto a <em>null</em> para evitar problemas.</p>
</div>
<div class="paragraph">
<p>AdemÃ¡s de poder crear nuevo mÃ©todos, tambiÃ©n vamos a poder sobreescribir aquellos ya existentes en la propia clase por nuestra propia implementaciÃ³n. En el siguiente ejemplo vamos a modificar el comportamiento del mÃ©todo <em>substring(int beginIndex)</em> de la clase <em>java.lang.String</em> para que el Ã­ndice pasado por parÃ¡metro empiece por el nÃºmero 1.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-kt">def</span> <span class="tok-n">texto</span> <span class="tok-o">=</span> <span class="tok-s2">&quot;En Groovy podemos sobreescribir mÃ©todos ya existentes&quot;</span>

<span class="tok-kt">def</span> <span class="tok-n">textoZeroBased</span> <span class="tok-o">=</span> <span class="tok-n">texto</span><span class="tok-o">.</span><span class="tok-na">substring</span><span class="tok-o">(</span><span class="tok-mi">0</span><span class="tok-o">)</span>

<span class="tok-n">String</span><span class="tok-o">.</span><span class="tok-na">metaClass</span><span class="tok-o">.</span><span class="tok-na">substring</span> <span class="tok-o">=</span> <span class="tok-o">{</span> <span class="tok-kt">int</span> <span class="tok-n">beginIndex</span> <span class="tok-o">-&gt;</span>
      <span class="tok-n">delegate</span><span class="tok-o">[</span><span class="tok-n">beginIndex</span><span class="tok-o">-</span><span class="tok-mi">1</span><span class="tok-o">..</span><span class="tok-na">delegate</span><span class="tok-o">.</span><span class="tok-na">size</span><span class="tok-o">()-</span><span class="tok-mi">1</span><span class="tok-o">]</span>
<span class="tok-o">}</span>

<span class="tok-kt">def</span> <span class="tok-n">textoOneBased</span> <span class="tok-o">=</span> <span class="tok-n">texto</span><span class="tok-o">.</span><span class="tok-na">substring</span><span class="tok-o">(</span><span class="tok-mi">1</span><span class="tok-o">)</span>

<span class="tok-k">assert</span> <span class="tok-n">textoOneBased</span> <span class="tok-o">==</span> <span class="tok-n">textoZeroBased</span>

<span class="tok-n">String</span><span class="tok-o">.</span><span class="tok-na">metaClass</span> <span class="tok-o">=</span> <span class="tok-kc">null</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Si lo que estamos sobrecargando es un mÃ©todo estÃ¡tico, debemos hacer referencia a la metaclase de la siguiente forma:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-n">String</span><span class="tok-o">.</span><span class="tok-na">metaClass</span><span class="tok-o">.</span><span class="tok-s1">&#39;static&#39;</span><span class="tok-o">.</span><span class="tok-na">valueOf</span> <span class="tok-o">=</span> <span class="tok-o">{</span> <span class="tok-n">Boolean</span> <span class="tok-n">b</span> <span class="tok-o">-&gt;</span>
    <span class="tok-n">b</span> <span class="tok-o">?</span> <span class="tok-s2">&quot;false&quot;</span> <span class="tok-o">:</span> <span class="tok-s2">&quot;true&quot;</span>
<span class="tok-o">}</span>

<span class="tok-k">assert</span> <span class="tok-s2">&quot;false&quot;</span> <span class="tok-o">==</span> <span class="tok-n">String</span><span class="tok-o">.</span><span class="tok-na">valueOf</span><span class="tok-o">(</span><span class="tok-kc">true</span><span class="tok-o">)</span>
<span class="tok-k">assert</span> <span class="tok-s2">&quot;true&quot;</span> <span class="tok-o">==</span> <span class="tok-n">String</span><span class="tok-o">.</span><span class="tok-na">valueOf</span><span class="tok-o">(</span><span class="tok-kc">false</span><span class="tok-o">)</span></code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_groovy_builders">2.4. Groovy Builders</h3>
<div class="paragraph">
<p>Los <em>Builders</em> en Groovy se utilizan para hacer que determinadas tareas complejas se conviertan en un juego de niÃ±os. Con ellos veremos que la construcciÃ³n de archivos XML, la automatizaciÃ³n de tareas con Ant o el diseÃ±o de interfaces grÃ¡ficas se facilita muchÃ­simo. Veremos como generar archivo XML y JSON gracias a estos builders.</p>
</div>
<div class="sect3">
<h4 id="_markupbuilder">2.4.1. MarkupBuilder</h4>
<div class="paragraph">
<p>Los archivos XML son un tipo de archivo ampliamente extendido para el intercambio de informaciÃ³n entre aplicaciones, asÃ­ que Groovy quiere ayudarnos en esa labor, tratando que escribamos el cÃ³digo para construir esos archivos XML de la forma mÃ¡s sencilla y clara posible y el <em>builder</em> encargado de esa labor es <em>MarkupBuilder</em>, el cual nos ayudarÃ¡ a escribir tanto archivos XML como HTML.</p>
</div>
<div class="paragraph">
<p>El ejemplo que vamos a ver consiste en crear un archivo XML referido a facturas de una empresa. Cada factura contendrÃ¡ una serie de Ã­tems, cada uno con un producto.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-kt">def</span> <span class="tok-n">builder</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">groovy</span><span class="tok-o">.</span><span class="tok-na">xml</span><span class="tok-o">.</span><span class="tok-na">MarkupBuilder</span><span class="tok-o">()</span>
<span class="tok-kt">def</span> <span class="tok-n">facturas</span> <span class="tok-o">=</span> <span class="tok-n">builder</span><span class="tok-o">.</span><span class="tok-na">facturas</span> <span class="tok-o">{</span>
    <span class="tok-k">for</span> <span class="tok-o">(</span><span class="tok-n">dia</span> <span class="tok-k">in</span> <span class="tok-mi">1</span><span class="tok-o">..</span><span class="tok-mi">3</span><span class="tok-o">)</span> <span class="tok-o">{</span>
        <span class="tok-n">factura</span><span class="tok-o">(</span><span class="tok-nl">fecha:</span> <span class="tok-k">new</span> <span class="tok-n">Date</span><span class="tok-o">()</span> <span class="tok-o">-</span> <span class="tok-n">dia</span><span class="tok-o">)</span> <span class="tok-o">{</span>
            <span class="tok-n">item</span><span class="tok-o">(</span><span class="tok-nl">id:</span><span class="tok-n">dia</span><span class="tok-o">){</span>
                <span class="tok-n">producto</span><span class="tok-o">(</span><span class="tok-nl">nombre:</span> <span class="tok-s1">&#39;Teclado&#39;</span><span class="tok-o">,</span> <span class="tok-nl">euros:</span><span class="tok-mi">876</span><span class="tok-o">)</span>
            <span class="tok-o">}</span>
        <span class="tok-o">}</span>
    <span class="tok-o">}</span>
<span class="tok-o">}</span>

<span class="tok-n">facturas</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Lo que producirÃ­a el siguiente archivo XML.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-o">&lt;</span><span class="tok-n">facturas</span><span class="tok-o">&gt;</span>
  <span class="tok-o">&lt;</span><span class="tok-n">factura</span> <span class="tok-n">fecha</span><span class="tok-o">=</span><span class="tok-s1">&#39;Sun Jan 03 00:00:00 CET 2014&#39;</span><span class="tok-o">&gt;</span>
    <span class="tok-o">&lt;</span><span class="tok-n">item</span> <span class="tok-n">id</span><span class="tok-o">=</span><span class="tok-s1">&#39;1&#39;</span><span class="tok-o">&gt;</span>
      <span class="tok-o">&lt;</span><span class="tok-n">producto</span> <span class="tok-n">nombre</span><span class="tok-o">=</span><span class="tok-s1">&#39;Teclado&#39;</span> <span class="tok-n">euros</span><span class="tok-o">=</span><span class="tok-s1">&#39;876&#39;</span> <span class="tok-s">/&gt;</span>
<span class="tok-s">    &lt;/</span><span class="tok-n">item</span><span class="tok-o">&gt;</span>
  <span class="tok-o">&lt;</span><span class="tok-s">/factura&gt;</span>
<span class="tok-s">  &lt;factura fecha=&#39;Mon Jan 02 00:00:00 CET 2014&#39;&gt;</span>
<span class="tok-s">    &lt;item id=&#39;2&#39;&gt;</span>
<span class="tok-s">      &lt;producto nombre=&#39;Teclado&#39; euros=&#39;876&#39; /</span><span class="tok-o">&gt;</span>
    <span class="tok-o">&lt;</span><span class="tok-s">/item&gt;</span>
<span class="tok-s">  &lt;/</span><span class="tok-n">factura</span><span class="tok-o">&gt;</span>
  <span class="tok-o">&lt;</span><span class="tok-n">factura</span> <span class="tok-n">fecha</span><span class="tok-o">=</span><span class="tok-s1">&#39;Tue Jan 01 00:00:00 CET 2014&#39;</span><span class="tok-o">&gt;</span>
    <span class="tok-o">&lt;</span><span class="tok-n">item</span> <span class="tok-n">id</span><span class="tok-o">=</span><span class="tok-s1">&#39;3&#39;</span><span class="tok-o">&gt;</span>
      <span class="tok-o">&lt;</span><span class="tok-n">producto</span> <span class="tok-n">nombre</span><span class="tok-o">=</span><span class="tok-s1">&#39;Teclado&#39;</span> <span class="tok-n">euros</span><span class="tok-o">=</span><span class="tok-s1">&#39;876&#39;</span> <span class="tok-s">/&gt;</span>
<span class="tok-s">    &lt;/</span><span class="tok-n">item</span><span class="tok-o">&gt;</span>
  <span class="tok-o">&lt;</span><span class="tok-s">/factura&gt;</span>
<span class="tok-s">&lt;/</span><span class="tok-n">facturas</span><span class="tok-o">&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Se puede comprobar la limpieza del cÃ³digo utilizado para generar el archivo XML y prÃ¡cticamente, el cÃ³digo sigue el mismo tabulado que el posterior archivo XML, con lo que la lectura del cÃ³digo por terceras personas se facilita muchÃ­simo.</p>
</div>
<div class="paragraph">
<p>Pero <em>MarkupBuilder</em> no sÃ³lo nos va a servir para generar archivos XML, sino tambiÃ©n archivos HTML. No es raro, puesto que HTML es en el fondo XML. Veamos como construir el mismo ejemplo anterior para que se vea como una pÃ¡gina web. Un ejemplo de pÃ¡gina web podrÃ­a ser el siguiente:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-o">&lt;</span><span class="tok-n">html</span><span class="tok-o">&gt;</span>
  <span class="tok-o">&lt;</span><span class="tok-n">head</span><span class="tok-o">&gt;</span>
    <span class="tok-o">&lt;</span><span class="tok-n">title</span><span class="tok-o">&gt;</span><span class="tok-n">Facturas</span><span class="tok-o">&lt;</span><span class="tok-s">/title&gt;</span>
<span class="tok-s">  &lt;/</span><span class="tok-n">head</span><span class="tok-o">&gt;</span>
  <span class="tok-o">&lt;</span><span class="tok-n">body</span><span class="tok-o">&gt;</span>
    <span class="tok-o">&lt;</span><span class="tok-n">h1</span><span class="tok-o">&gt;</span><span class="tok-n">Facturas</span><span class="tok-o">&lt;</span><span class="tok-s">/h1&gt;</span>
<span class="tok-s">    &lt;ul&gt;</span>
<span class="tok-s">      &lt;li&gt;Sun Jan 03 00:00:00 CET 2015&lt;/</span><span class="tok-n">li</span><span class="tok-o">&gt;</span>
      <span class="tok-o">&lt;</span><span class="tok-n">ul</span><span class="tok-o">&gt;</span>
        <span class="tok-o">&lt;</span><span class="tok-n">li</span><span class="tok-o">&gt;</span><span class="tok-mi">1</span><span class="tok-o">.-</span> <span class="tok-n">Teclado</span> <span class="tok-o">=&gt;</span> <span class="tok-mi">876</span><span class="tok-n">euros</span><span class="tok-o">&lt;</span><span class="tok-s">/li&gt;</span>
<span class="tok-s">      &lt;/</span><span class="tok-n">ul</span><span class="tok-o">&gt;</span>
    <span class="tok-o">&lt;</span><span class="tok-s">/ul&gt;</span>
<span class="tok-s">    &lt;ul&gt;</span>
<span class="tok-s">      &lt;li&gt;Sun Jan 02 00:00:00 CET 2015&lt;/</span><span class="tok-n">li</span><span class="tok-o">&gt;</span>
      <span class="tok-o">&lt;</span><span class="tok-n">ul</span><span class="tok-o">&gt;</span>
        <span class="tok-o">&lt;</span><span class="tok-n">li</span><span class="tok-o">&gt;</span><span class="tok-mi">2</span><span class="tok-o">.-</span> <span class="tok-n">Teclado</span> <span class="tok-o">=&gt;</span> <span class="tok-mi">876</span><span class="tok-n">euros</span><span class="tok-o">&lt;</span><span class="tok-s">/li&gt;</span>
<span class="tok-s">      &lt;/</span><span class="tok-n">ul</span><span class="tok-o">&gt;</span>
    <span class="tok-o">&lt;</span><span class="tok-s">/ul&gt;</span>
<span class="tok-s">    &lt;ul&gt;</span>
<span class="tok-s">      &lt;li&gt;Sun Jan 01 00:00:00 CET 2015&lt;/</span><span class="tok-n">li</span><span class="tok-o">&gt;</span>
      <span class="tok-o">&lt;</span><span class="tok-n">ul</span><span class="tok-o">&gt;</span>
        <span class="tok-o">&lt;</span><span class="tok-n">li</span><span class="tok-o">&gt;</span><span class="tok-mi">3</span><span class="tok-o">.-</span> <span class="tok-n">Teclado</span> <span class="tok-o">=&gt;</span> <span class="tok-mi">876</span><span class="tok-n">euros</span><span class="tok-o">&lt;</span><span class="tok-s">/li&gt;</span>
<span class="tok-s">      &lt;/</span><span class="tok-n">ul</span><span class="tok-o">&gt;</span>
    <span class="tok-o">&lt;</span><span class="tok-s">/ul&gt;</span>
<span class="tok-s">  &lt;/</span><span class="tok-n">body</span><span class="tok-o">&gt;</span>
<span class="tok-o">&lt;/</span><span class="tok-n">html</span><span class="tok-o">&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Este ejemplo de HTML se podrÃ­a construir con el siguiente cÃ³digo, haciendo uso de MarkupBuilder.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-kt">def</span> <span class="tok-n">builder</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">groovy</span><span class="tok-o">.</span><span class="tok-na">xml</span><span class="tok-o">.</span><span class="tok-na">MarkupBuilder</span><span class="tok-o">()</span>

<span class="tok-n">builder</span><span class="tok-o">.</span><span class="tok-na">html</span> <span class="tok-o">{</span>
    <span class="tok-n">head</span> <span class="tok-o">{</span>
        <span class="tok-n">title</span> <span class="tok-s1">&#39;Facturas&#39;</span>
    <span class="tok-o">}</span>

    <span class="tok-n">body</span> <span class="tok-o">{</span>
        <span class="tok-n">h1</span> <span class="tok-s1">&#39;Facturas&#39;</span>

        <span class="tok-k">for</span> <span class="tok-o">(</span><span class="tok-n">dia</span> <span class="tok-k">in</span> <span class="tok-mi">1</span><span class="tok-o">..</span><span class="tok-mi">3</span><span class="tok-o">){</span>
            <span class="tok-n">ul</span><span class="tok-o">{</span>
                <span class="tok-n">li</span> <span class="tok-o">(</span><span class="tok-k">new</span> <span class="tok-n">Date</span><span class="tok-o">()</span> <span class="tok-o">-</span> <span class="tok-n">dia</span><span class="tok-o">).</span><span class="tok-na">toString</span><span class="tok-o">()</span>
                <span class="tok-n">ul</span> <span class="tok-o">{</span>
                    <span class="tok-n">li</span> <span class="tok-s2">&quot;$dia.- Teclado =&gt; 876euros&quot;</span>
                <span class="tok-o">}</span>
            <span class="tok-o">}</span>
        <span class="tok-o">}</span>
    <span class="tok-o">}</span>
<span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>El cÃ³digo HTML generado por MarkupBuilder serÃ¡ compatible con los estÃ¡ndares y no tendremos incluso que preocuparnos por la conversiÃ³n de determinados caracteres como el sÃ­mbolo &lt; (&amp;lt;), ya que Ã©l mismo serÃ¡ el encargado de realizar dicha conversiÃ³n.</p>
</div>
</div>
<div class="sect3">
<h4 id="_jsonbuilder">2.4.2. JsonBuilder</h4>
<div class="paragraph">
<p>Si en lugar de generar XML queremos generar JSON, Groovy tambiÃ©n dispone de otro builder que nos permite generar estos JSON de forma muy sencilla y de forma muy similar a como veiamos con el generador de XML. Veamos un ejemplo:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-kt">def</span> <span class="tok-n">builder</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">groovy</span><span class="tok-o">.</span><span class="tok-na">json</span><span class="tok-o">.</span><span class="tok-na">JsonBuilder</span><span class="tok-o">()</span>
<span class="tok-kt">def</span> <span class="tok-n">root</span> <span class="tok-o">=</span> <span class="tok-n">builder</span><span class="tok-o">.</span><span class="tok-na">teachers</span> <span class="tok-o">{</span>
   <span class="tok-n">professor</span> <span class="tok-o">{</span>
       <span class="tok-n">firstName</span> <span class="tok-s1">&#39;Fran&#39;</span>
       <span class="tok-n">lastName</span> <span class="tok-s1">&#39;Garcia&#39;</span>
       <span class="tok-n">address</span><span class="tok-o">(</span>
               <span class="tok-nl">city:</span> <span class="tok-s1">&#39;Oxford&#39;</span><span class="tok-o">,</span>
               <span class="tok-nl">country:</span> <span class="tok-s1">&#39;UK&#39;</span><span class="tok-o">,</span>
               <span class="tok-nl">zip:</span> <span class="tok-mi">12345</span><span class="tok-o">,</span>
       <span class="tok-o">)</span>
       <span class="tok-n">married</span> <span class="tok-kc">true</span>
       <span class="tok-n">modules</span> <span class="tok-s1">&#39;Groovy&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;Grails&#39;</span>
   <span class="tok-o">}</span>
<span class="tok-o">}</span>

<span class="tok-k">assert</span> <span class="tok-n">root</span> <span class="tok-k">instanceof</span> <span class="tok-n">Map</span>

<span class="tok-k">assert</span> <span class="tok-n">builder</span><span class="tok-o">.</span><span class="tok-na">toString</span><span class="tok-o">()</span> <span class="tok-o">==</span> <span class="tok-s1">&#39;{&quot;teachers&quot;:{&quot;professor&quot;:{&quot;firstName&quot;:&quot;Fran&quot;,&quot;lastName&quot;:&quot;Garcia&quot;,&quot;address&quot;:{&quot;city&quot;:&quot;Oxford&quot;,&quot;country&quot;:&quot;UK&quot;,&quot;zip&quot;:12345},&quot;married&quot;:true,&quot;modules&quot;:[&quot;Groovy&quot;,&quot;Grails&quot;]}}}&#39;</span></code></pre>
</div>
</div>
<div style="page-break-after: always;"></div>
</div>
</div>
<div class="sect2">
<h3 id="_ejercicios_2">2.5. Ejercicios</h3>
<div class="sect3">
<h4 id="_closures_sobre_colecciones_0_25_puntos">2.5.1. Closures sobre colecciones (0.25 puntos)</h4>
<div class="paragraph">
<p>Implementar un closure que realice la operaciÃ³n matemÃ¡tica factorial del nÃºmero pasado como parÃ¡metro.</p>
</div>
<div class="paragraph">
<p>A continuaciÃ³n crear una lista o un mapa de nÃºmeros enteros y utilizar algunos de los mÃ©todos vistos para recorrer la lista o el mapa, generar el nÃºmero factorial de cada uno de sus elementos con el closure que hemos creado acabamos de crear y mostrarlo por pantalla.</p>
</div>
<div class="paragraph">
<p>Por Ãºltimo, crear dos closures llamados ayer y maÃ±ana que devuelvan las fechas correspondientes a los dÃ­as anterior y posterior a la fecha pasada. Podemos crear fechas mediante la sentencia <em>new Date().parse("d/M/yyyy H:m:s","28/6/2008 00:30:20")</em>.</p>
</div>
<div class="paragraph">
<p>Posteriormente, crear una lista de fechas y utilizar los closures reciÃ©n creados para obtener las fechas del dÃ­a anterior y posterior a todos los elementos de la lista.</p>
</div>
</div>
<div class="sect3">
<h4 id="_clase_completa_en_groovy_0_5_puntos">2.5.2. Clase completa en Groovy (0.5 puntos)</h4>
<div class="paragraph">
<p>Crear una clase llamada <em>Calculadora</em> que permita la realizaciÃ³n de cÃ¡lculos matemÃ¡ticos con dos nÃºmero enteros. Estos cÃ¡lculos serÃ¡n la suma, resta, multiplicaciÃ³n y divisiÃ³n.</p>
</div>
<div class="paragraph">
<p>Los parÃ¡metros serÃ¡n solicitados como entrada a la aplicaciÃ³n. Para leer parÃ¡metros por lÃ­nea de comandos se pueda utilizar el siguiente closure:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">in</span><span class="tok-o">.</span><span class="tok-na">withReader</span> <span class="tok-o">{</span>
  <span class="tok-n">print</span> <span class="tok-s1">&#39;Introduzca operador: &#39;</span>
  <span class="tok-n">op1</span> <span class="tok-o">=</span> <span class="tok-n">it</span><span class="tok-o">.</span><span class="tok-na">readLine</span><span class="tok-o">()</span>
  <span class="tok-n">println</span><span class="tok-o">(</span><span class="tok-n">op1</span><span class="tok-o">)</span>
<span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>El sistema nos debe pedir que introduzcamos los operandos asÃ­ como el tipo de operaciÃ³n que queremos realizar y mostrarÃ¡ por pantalla el resultado de la operaciÃ³n.</p>
</div>
</div>
<div class="sect3">
<h4 id="_metaprogramaciÃ³n_0_5_puntos">2.5.3. MetaprogramaciÃ³n (0.5 puntos)</h4>
<div class="paragraph">
<p>Utilizando los conceptos sobre metaprogramaciÃ³n vistos en la parte teÃ³rica, aÃ±ade un mÃ©todo llamado <em>moneda(String)</em> que recibirÃ¡ por parÃ¡metro una cadena que representa un determinado <em>locale</em> y en funciÃ³n de este <em>locale</em> imprimirÃ¡ un sÃ­mbolo u otro. Para simplificar, vamos a limitar el nÃºmero de posibles <em>locales</em> a tres: es_ES, en_EN y en_US. Para comprobar si tu mÃ©todo funciona correctamente, puedes pasarle las siguientes aserciones tras modificar adecuadamente la clase correspondiente:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-k">assert</span> <span class="tok-mf">10.2</span><span class="tok-o">.</span><span class="tok-na">moneda</span><span class="tok-o">(</span><span class="tok-s2">&quot;en_EN&quot;</span><span class="tok-o">)</span> <span class="tok-o">==</span>  <span class="tok-s2">&quot;Â£10.2&quot;</span>
<span class="tok-k">assert</span> <span class="tok-mf">10.2</span><span class="tok-o">.</span><span class="tok-na">moneda</span><span class="tok-o">(</span><span class="tok-s2">&quot;en_US&quot;</span><span class="tok-o">)</span> <span class="tok-o">==</span>  <span class="tok-s2">&quot;\$10.2&quot;</span>
<span class="tok-k">assert</span> <span class="tok-mf">10.2</span><span class="tok-o">.</span><span class="tok-na">moneda</span><span class="tok-o">(</span><span class="tok-s2">&quot;es_ES&quot;</span><span class="tok-o">)</span> <span class="tok-o">==</span>  <span class="tok-s2">&quot;10.2â¬&quot;</span>

<span class="tok-k">assert</span> <span class="tok-mi">10</span><span class="tok-o">.</span><span class="tok-na">moneda</span><span class="tok-o">(</span><span class="tok-s2">&quot;en_EN&quot;</span><span class="tok-o">)</span> <span class="tok-o">==</span>  <span class="tok-s2">&quot;Â£10&quot;</span>
<span class="tok-k">assert</span> <span class="tok-mi">10</span><span class="tok-o">.</span><span class="tok-na">moneda</span><span class="tok-o">(</span><span class="tok-s2">&quot;en_US&quot;</span><span class="tok-o">)</span> <span class="tok-o">==</span>  <span class="tok-s2">&quot;\$10&quot;</span>
<span class="tok-k">assert</span> <span class="tok-mi">10</span><span class="tok-o">.</span><span class="tok-na">moneda</span><span class="tok-o">(</span><span class="tok-s2">&quot;es_ES&quot;</span><span class="tok-o">)</span> <span class="tok-o">==</span>  <span class="tok-s2">&quot;10â¬&quot;</span>

<span class="tok-k">assert</span> <span class="tok-k">new</span> <span class="tok-nf">Float</span><span class="tok-o">(</span><span class="tok-mf">10.2</span><span class="tok-o">).</span><span class="tok-na">moneda</span><span class="tok-o">(</span><span class="tok-s2">&quot;en_EN&quot;</span><span class="tok-o">)</span> <span class="tok-o">==</span>  <span class="tok-s2">&quot;Â£10.2&quot;</span>
<span class="tok-k">assert</span> <span class="tok-k">new</span> <span class="tok-nf">Float</span><span class="tok-o">(</span><span class="tok-mf">10.2</span><span class="tok-o">).</span><span class="tok-na">moneda</span><span class="tok-o">(</span><span class="tok-s2">&quot;en_US&quot;</span><span class="tok-o">)</span> <span class="tok-o">==</span>  <span class="tok-s2">&quot;\$10.2&quot;</span>
<span class="tok-k">assert</span> <span class="tok-k">new</span> <span class="tok-nf">Float</span><span class="tok-o">(</span><span class="tok-mf">10.2</span><span class="tok-o">).</span><span class="tok-na">moneda</span><span class="tok-o">(</span><span class="tok-s2">&quot;es_ES&quot;</span><span class="tok-o">)</span> <span class="tok-o">==</span>  <span class="tok-s2">&quot;10.2â¬&quot;</span>

<span class="tok-k">assert</span> <span class="tok-k">new</span> <span class="tok-nf">Double</span><span class="tok-o">(</span><span class="tok-mf">10.2</span><span class="tok-o">).</span><span class="tok-na">moneda</span><span class="tok-o">(</span><span class="tok-s2">&quot;en_EN&quot;</span><span class="tok-o">)</span> <span class="tok-o">==</span>  <span class="tok-s2">&quot;Â£10.2&quot;</span>
<span class="tok-k">assert</span> <span class="tok-k">new</span> <span class="tok-nf">Double</span><span class="tok-o">(</span><span class="tok-mf">10.2</span><span class="tok-o">).</span><span class="tok-na">moneda</span><span class="tok-o">(</span><span class="tok-s2">&quot;en_US&quot;</span><span class="tok-o">)</span> <span class="tok-o">==</span>  <span class="tok-s2">&quot;\$10.2&quot;</span>
<span class="tok-k">assert</span> <span class="tok-k">new</span> <span class="tok-nf">Double</span><span class="tok-o">(</span><span class="tok-mf">10.2</span><span class="tok-o">).</span><span class="tok-na">moneda</span><span class="tok-o">(</span><span class="tok-s2">&quot;es_ES&quot;</span><span class="tok-o">)</span> <span class="tok-o">==</span>  <span class="tok-s2">&quot;10.2â¬&quot;</span></code></pre>
</div>
</div>
<div style="page-break-after: always;"></div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="sesion03">3. IntroducciÃ³n a Grails. Scaffolding.</h2>
<div class="sectionbody">
<div class="paragraph">
<p>En esta primera sesiÃ³n de Grails, comenzaremos, como no puede ser de otra forma, viendo una descripciÃ³n de lo que es Grails, sus caracterÃ­sticas y las ventajas que conlleva su uso como entorno para el desarrollo rÃ¡pido de aplicaciones. Seguiremos analizando su arquitectura y las herramientas de cÃ³digo abierto que aÃºna Grails y terminaremos desarrollando nuestra primera aplicaciÃ³n en Grails aprovechÃ¡ndonos del <em>scaffolding</em>.</p>
</div>
<div class="sect2">
<h3 id="__quÃ©_es">3.1. Â¿QuÃ© es?</h3>
<div class="paragraph">
<p>Grails es un framework para el desarrollo de aplicaciones web basado en el lenguaje de programaciÃ³n Groovy, que a su vez se basa en la Plataforma Java. Grails estÃ¡ basado en los paradigmas <em>convenciÃ³n sobre configuraciÃ³n</em> y <em>DRY (don&#8217;t repite yourself)</em> o no te repitas, los cuales permiten al programador olvidarse en gran parte de los detalles de configuraciÃ³n de mÃ¡s bajo nivel.</p>
</div>
<div class="paragraph">
<p>Como la mayorÃ­a de los framework de desarrollo web, Grails estÃ¡ basado en el patrÃ³n <em>Modelo Vista Controlador (MVC)</em>. En Grails los <em>modelos</em> se conocen como <em>clases de dominio</em> que permiten a la aplicaciÃ³n mostrar los datos utilizando la <em>vista</em>. A diferencia de otros frameworks, en Grails las clases de dominio de Grails son automÃ¡ticamente persistidas y es incluso posible generar el esquema de la base de datos. Los <em>controladores</em> por su parte, permiten gestionar las peticiones a la aplicaciÃ³n y organizar los servicios proporcionados. Por Ãºltimo, la <em>vista</em> en Grails son las conocidas como <em>Groovy Server Pages (GSP)</em> (anÃ¡logamente a las Java Server Pages -JSP-) y habitualmente se encargan de generar el contenido de nuestra aplicaciÃ³n en formato HTML.</p>
</div>
<div class="paragraph">
<p>Como comentÃ¡bamos anteriormente, Grails permite al programador olvidarse de gran parte de la configuraciÃ³n tÃ­pica que incluyen los frameworks MVC. AdemÃ¡s Grails se aprovecha de un lenguaje dinÃ¡mico como Groovy para acortar los tiempos de desarrollo y que el equipo de desarrolladores puedan centrarse simplemente en escribir cÃ³digo, actualizar, testear y depurar fallos. Esto hace que el desarrollo de la aplicaciÃ³n sea mucho mÃ¡s Ã¡gil que con otros frameworks MVC.</p>
</div>
<div class="paragraph">
<p>Habitualmente cuando hablamos de framework, se entiende como un marco de los programadores pueden utilizar las tÃ©cnicas del Modelo Vista Controlador para el desarrollo rÃ¡pido de sus aplicaciones. Pero, Â¿quÃ© pasa con el resto de elementos necesarios para el desarrollo de una aplicaciÃ³n como pueden ser los servidores web o los gestores de bases de datos?. En este sentido, Grails no es simplemente un framework de desarrollo de aplicaciones sino que es mÃ¡s una plataforma completa, puesto que incluye tambiÃ©n un contenedor web, bases de datos, sistemas de empaquetado de la aplicaciÃ³n y un completo sistema para la realizaciÃ³n de tests. De esta forma, no debemos perder el tiempo buscando y descargando un servidor web para nuestra futura aplicaciÃ³n o un gestor de base de datos. Ni tan siquiera serÃ¡ necesario escribir complicados scripts de configuraciÃ³n para el empaquetado de la aplicaciÃ³n. Todo esto se convierte en una tarea tan sencilla como instalar Grails.</p>
</div>
<div class="sect3">
<h4 id="__quÃ©_empresas_utilizan_grails">3.1.1. Â¿QuÃ© empresas utilizan Grails?</h4>
<div class="paragraph">
<p>Desde los inicios de Grails, muchas han sido las empresas que apostaron por este framework y que a dÃ­a de hoy siguen utilizÃ¡ndolo para desarrollar sus aplicaciones.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Netflix, <a href="http://www.netflix.com" class="bare">http://www.netflix.com</a></p>
</li>
<li>
<p>Sky, <a href="http://www.sky.com" class="bare">http://www.sky.com</a></p>
</li>
<li>
<p>Secret Escapes, <a href="http://www.secretescapes.com" class="bare">http://www.secretescapes.com</a></p>
</li>
<li>
<p>Engage Sciences, <a href="http://www.engagesciences.com" class="bare">http://www.engagesciences.com</a></p>
</li>
<li>
<p>Odobo, <a href="http://www.odobo.com" class="bare">http://www.odobo.com</a></p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_caracterÃ­sticas_de_grails">3.2. CaracterÃ­sticas de Grails</h3>
<div class="paragraph">
<p>Algunas de las caracterÃ­sticas mÃ¡s importantes que presenta Grails son las siguientes:</p>
</div>
<div class="sect3">
<h4 id="_convenciÃ³n_sobre_configuraciÃ³n">3.2.1. ConvenciÃ³n sobre configuraciÃ³n</h4>
<div class="paragraph">
<p>En lugar de tener que escribir interminables archivos de configuraciÃ³n en formato XML, Grails se basa en una serie de convenciones para que el desarrollo de la aplicaciÃ³n sea mucho mÃ¡s rÃ¡pido y productivo. AdemÃ¡s, gracias al uso de convenciones, se refuerza el otro principio del que hablÃ¡bamos anteriormente, <em>DRY (don&#8217;t repite yourself)</em> o no te repitas.</p>
</div>
</div>
<div class="sect3">
<h4 id="_tests">3.2.2. Tests</h4>
<div class="paragraph">
<p>Una de las partes mÃ¡s importantes en el desarrollo de software se refiere a los tests implementados que garantizan un software de calidad y el fÃ¡cil mantenimiento de una aplicaciÃ³n. Gracias a estos tests, es muy sencillo detectar y solucionar fallos provocados por cambios en el cÃ³digo. Cada vez que se genera en Grails una clase de dominio o un controlador, paralelamente es generado tambiÃ©n un test para comprobar la nueva clase o controlador, que por supuesto nosotros deberemos completar (Grails es muy bueno, pero no lo hace todo).</p>
</div>
<div class="paragraph">
<p>Grails distingue entre tests unitarios y tests de integraciÃ³n. Los tests unitarios son tests sin dependencias de ningÃºn tipo, salvo algÃºn que otro objeto <em>mock</em>. Por otro lado, los tests de integraciÃ³n tienen acceso completo al entorno de Grails, incluyendo la base de datos. AdemÃ¡s, Grails permite tambiÃ©n la creaciÃ³n de tests funcionales para comprobar la funcionalidad de nuestra aplicaciÃ³n web a nivel de interacciÃ³n con el usuario.</p>
</div>
</div>
<div class="sect3">
<h4 id="_scaffolding">3.2.3. Scaffolding</h4>
<div class="paragraph">
<p>El scaffolding es una caracterÃ­stica de determinados frameworks que permite la generaciÃ³n automÃ¡tica de cÃ³digo para las cuatro operaciones bÃ¡sicas de cualquier aplicaciÃ³n, que son la <em>creaciÃ³n</em>, <em>lectura</em>, <em>ediciÃ³n</em> y <em>borrado</em>, lo que en inglÃ©s se conoce como <em>CRUD (create, read, update and delete)</em>.</p>
</div>
<div class="paragraph">
<p>Grails permite tambiÃ©n utilizar scaffolding en nuestras aplicaciones a travÃ©s de un plugin que viene instalado por defecto. En versiones anteriores, el scaffolding venÃ­a como parte del <em>core</em> de Grails, sin embargo en las Ãºltimas versiones esta caracterÃ­stica ha sido movida a un plugin. El scaffolding en Grails se consigue escribiendo muy pocas lÃ­neas de cÃ³digo, con lo que podemos centrarnos en especificar las propiedades, comportamientos y restricciones de nuestras clases de dominio.</p>
</div>
<div class="paragraph">
<p>Una gran cantidad de aplicaciones consisten en simplemente ofrecer la posibilidad a los usuarios de realizar esas cuatro operaciones bÃ¡sicas que comentÃ¡bamos anteriormente sobre algunas entidades o clases de dominio con lo que en ocasiones este scaffolding nos ahorrarÃ¡ mucho tiempo.</p>
</div>
</div>
<div class="sect3">
<h4 id="_mapeo_objeto_relacional">3.2.4. Mapeo objeto-relacional</h4>
<div class="paragraph">
<p>Grails incluye un potente framework para el mapeo objeto-relacional conocido como <em>GORM (Grails Object Relational Mapping)</em>. Como cualquier framework de persistencia, GORM permite mapear objetos contra bases de datos relacionales y representar relaciones entre dichos objetos del tipo <em>uno-a-uno</em>, <em>uno-a-muchos</em> y <em>muchos-a-muchos</em>.</p>
</div>
<div class="paragraph">
<p>Por defecto, Grails utiliza Hibernate por debajo para realizar este mapeo, con lo que no debemos preocuparnos de que tipo de base de datos vamos a utilizar en nuestra aplicaciÃ³n (MySQL, Oracle, SQL Server, etc) porque Grails se encargarÃ¡ por nosotros de esta parte. AdemÃ¡s, en los Ãºltimos tiempo estÃ¡n proliferando lo que se conoce como las bases de datos <em>noSQL</em> como MongoDB, Redis, Neo4j, etc. Aunque Ã©stos tipos de bases de datos todavÃ­a no estÃ¡n soportadas en el nÃºcleo de Grails, si estÃ¡n apareciendo al mismo tiempo diversos plugins para la utilizaciÃ³n de Ã©stas sin apenas modificar nada en nuestra aplicaciÃ³n.</p>
</div>
</div>
<div class="sect3">
<h4 id="_plugins">3.2.5. Plugins</h4>
<div class="paragraph">
<p>Sin embargo, Grails no siempre es la soluciÃ³n a cualquier problema que se nos pueda plantear en el desarrollo de aplicaciones web. Para ayudarnos, Grails dispone de una arquitectura de plugins con una comunidad de usuarios detrÃ¡s (cada vez mÃ¡s grande) que ofrecen plugins para seguridad, AJAX, testeo, bÃºsqueda, informes, servicios web, etc. Este sistema de plugins hace que aÃ±adir complejas funcionalidades a nuestra aplicaciÃ³n se convierte en algo muy sencillo. En la actualidad hay alrededor de 1200 plugins desarrollados para Grails.</p>
</div>
</div>
<div class="sect3">
<h4 id="_internacionalizaciÃ³n_i18n">3.2.6. InternacionalizaciÃ³n (i18n)</h4>
<div class="paragraph">
<p>Cuando creamos un proyecto en Grails, automÃ¡ticamente se crea toda la estructura de datos necesaria para la internacionalizaciÃ³n de la aplicaciÃ³n sin ningÃºn problema.</p>
</div>
</div>
<div class="sect3">
<h4 id="_software_de_cÃ³digo_abierto">3.2.7. Software de cÃ³digo abierto</h4>
<div class="paragraph">
<p>Por suerte, Grails no sufre del sÃ­ndrome <em><a href="http://en.wikipedia.org/wiki/Not_Invented_Here">Not Invented Here (NIH)</a></em> y lo hace integrando en su arquitectura las mejores soluciones de software libre del mercado para crear un framework robusto. Veamos cuales son estas soluciones.</p>
</div>
<div class="sect4">
<h5 id="_groovy_2">Groovy</h5>
<div class="paragraph">
<p><a href="http://groovy.codehaus.org/">Groovy</a> es la parte fundamental en la que se basa Grails. Como vimos en las dos primeras sesiones, Groovy es un potente y flexible lenguaje de programaciÃ³n. Su integraciÃ³n con Java, las caracterÃ­sticas como lenguaje dinÃ¡mico y su sintaxis sencilla, hacen de este lenguaje de programaciÃ³n el compaÃ±ero perfecto para Grails.</p>
</div>
</div>
<div class="sect4">
<h5 id="_framework_spring">Framework Spring</h5>
<div class="paragraph">
<p>El framework <a href="http://www.springsource.org">Spring</a> ofrece un alto nivel de abstracciÃ³n al programador que en lugar de tratar directamente con las transacciones, proporciona una forma para declarar dichas transacciones utilizando los <em>POJOs (Plain Old Java Objects)</em>, con lo que el programador se puede centrar en la implementaciÃ³n de la lÃ³gica de negocio.</p>
</div>
</div>
<div class="sect4">
<h5 id="_hibernate">Hibernate</h5>
<div class="paragraph">
<p><a href="https://www.hibernate.org">Hibernate</a> es un framework de persistencia objeto-relacional y constituye la base de GORM. Es capaz de mapear complejas clases de dominio contra las tablas de una base de datos, asÃ­ como establecer las relaciones entre las distintas tablas.</p>
</div>
</div>
<div class="sect4">
<h5 id="_sitemesh">SiteMesh</h5>
<div class="paragraph">
<p><a href="http://www.opensymphony.com/sitemesh">SiteMesh</a> es un framework web para el renderizado de documentos HTML que implementa el patrÃ³n de diseÃ±o <a href="http://es.wikipedia.org/wiki/Decorator_(patr%C3%B3n_de_dise%C3%B1o)">Decorator</a> con componentes como cabeceras, pies de pÃ¡ginas y sistemas de navegaciÃ³n.</p>
</div>
</div>
<div class="sect4">
<h5 id="_tomcat_y_jetty">Tomcat y Jetty</h5>
<div class="paragraph">
<p>Como comentÃ¡bamos anteriormente, Grails es una plataforma completa, y esto es en parte gracias a la inclusiÃ³n de un servidor web como <a href="http://www.mortbay.org/jetty">Jetty</a> o <a href="http://tomcat.apache.org">Tomcat</a>. Esto no significa que Grails solo funcione con estos dos servidores de aplicaciones sino que en nuestra instalaciÃ³n local de Grails podremos utilizar cualquiera de ellos.</p>
</div>
</div>
<div class="sect4">
<h5 id="_h2">H2</h5>
<div class="paragraph">
<p>Grails tambiÃ©n incluye un gestor de bases de datos relacionales como <a href="http://www.h2database.com">H2</a>. H2 es un gestor de base de datos en memorÃ­a de tamaÃ±o muy reducido y que en la mayorÃ­a de los casos nos servirÃ¡ para nuestra fase de desarrollo (nunca para producciÃ³n). Esto tampoco quiere decir que nuestras aplicaciones desarrolladas en Grails sÃ³lo funcionen con H2, sino que para desarrollar nuestra aplicaciÃ³n no vamos a necesitar ningÃºn gestor de base de datos externo.</p>
</div>
</div>
<div class="sect4">
<h5 id="_spock">Spock</h5>
<div class="paragraph">
<p>En las primeras versiones de Grails, se utilizaba como framework para el desarrollo de tests el ampliamente aceptado JUnit, pero en las Ãºltimas versiones se ha decidido utilizar otro framework que ha tenido gran aceptaciÃ³n por parte de la comunidad llamado <a href="http://spock-framework.readthedocs.org">Spock</a>. Spock nos permitirÃ¡ realizar tests unitarios, de integraciÃ³n y funcionales, tal y como veremos en la sesiÃ³n 6.</p>
</div>
</div>
<div class="sect4">
<h5 id="_gant">Gant</h5>
<div class="paragraph">
<p><a href="http://gant.codehaus.org">Gant</a> es un entorno en lÃ­nea de comandos que envuelve el archiconocido sistema de automatizaciÃ³n de tareas <a href="http://ant.apache.org">Apache Ant</a>. Con Gant vamos a poder realizar todo tipo de tareas en un proyecto Grails, como la creaciÃ³n de todo tipo de artefactos en la aplicaciÃ³n, la generaciÃ³n del cÃ³digo de scaffolding necesario, la realizaciÃ³n de las pruebas unitarias y de integraciÃ³n y el empaqueta de la aplicaciÃ³n, entre otras cosas.</p>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_arquitectura">3.3. Arquitectura</h3>
<div class="paragraph">
<p>Ahora que ya tenemos una idea de lo que es Grails y las ventajas que nos puede aportar a la hora de desarrollar nuestros proyectos web, veamos grÃ¡ficamente su arquitectura.</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="images/grails03/arquitectura.jpg" alt="Arquitectura Grails" width="50%">
</div>
</div>
<div class="paragraph">
<p>Podemos decir que la arquitectura de Grails estÃ¡ formada por cuatro capas claramente diferenciadas. La base de la arquitectura de Grails es la mÃ¡quina virtual de Java. Por encima de Ã©sta se encuentran los lenguajes de programaciÃ³n en lo que estÃ¡ basado Grails, Java y Groovy. En la tercera capa tenemos el propio framework Grails, al cual le acompaÃ±an todos los frameworks de los que hablÃ¡bamos en la secciÃ³n anterior, SiteMesh, Spring, GORM, etc. En esta capa tambiÃ©n se ha aÃ±adido una opciÃ³n abierta como es la posibilidad de incluir otras librerÃ­as externas que no estÃ¡n incluidas en Grails. La Ãºltima capa estÃ¡ formada por la aplicaciÃ³n en si, siguiendo el patrÃ³n modelo vista controlador.</p>
</div>
<div class="paragraph">
<p>AdemÃ¡s, envolviendo a todo el proyecto Grails aparece Gant, la herramienta en lÃ­nea de comandos que nos permitirÃ¡ una gran variedad de acciones sobre el mismo.</p>
</div>
<div class="paragraph">
<p>Desde el punto de vista de la ejecuciÃ³n de un proyecto Grails, se podrÃ­a esquematizar de la siguiente forma:</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="images/grails03/grails_runtime.jpg" alt="Grails runtime" width="50%">
</div>
</div>
<div class="paragraph">
<p>De la imagen podemos concluir que una pÃ¡gina web realiza una peticiÃ³n al servidor web. Esta peticiÃ³n se pasa a un controlador, el cual podrÃ¡ utilizar o no una clase de dominio (modelo). Esta clase de dominio puede ser a su vez estar persistida en una base de datos gracias a GORM. Una vez el controlador termina, pasa la peticiÃ³n al correspondiente GSP para que renderice la vista y sea enviada de nuevo al navegador en forma de pÃ¡gina HTML.</p>
</div>
</div>
<div class="sect2">
<h3 id="_instalaciÃ³n_de_grails">3.4. InstalaciÃ³n de Grails</h3>
<div class="paragraph">
<p>Si tenemos en cuenta lo que decÃ­amos anteriormente de que Grails es un completo framework con un servidor web, un gestor de base de datos y el resto de caracterÃ­sticas ya comentadas, podrÃ­amos pensar que su instalaciÃ³n puede ser muy complicada. Sin embargo, la instalaciÃ³n de Grails se convierte en un juego de niÃ±os, ya que nos olvidamos de tener que buscar soluciones externas para cada uno de los aspectos relacionados con el desarrollo de una aplicaciÃ³n web.</p>
</div>
<div class="paragraph">
<p>AquÃ­ vamos a configurar Grails para poder utilizarlo tanto desde lÃ­nea de comandos como desde el entorno de desarrollo IntelliJ IDEA.</p>
</div>
<div class="sect3">
<h4 id="_instalaciÃ³n_de_grails_en_lÃ­nea_de_comandos">3.4.1. InstalaciÃ³n de Grails en lÃ­nea de comandos</h4>
<div class="paragraph">
<p>Tal y como hacÃ­amos en la instalaciÃ³n de Groovy, vamos a utilizar el gestor de paquetes <em>sdkman (<a href="http://sdkman.io/" class="bare">http://sdkman.io/</a>)</em>. Estos son los pasos para instalar Grails en nuestro ordenador:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="bash">curl -s get.sdkman.io <span class="tok-p">|</span> bash

<span class="tok-nb">source</span> <span class="tok-s2">&quot;$HOME/.sdkman/bin/sdkman-init.sh&quot;</span>

sdk list grails

sdk install grails 2.5.2</code></pre>
</div>
</div>
<div class="paragraph">
<p>Si necesitaramos alternar entre varias versiones de Grails, simplemente deberÃ­as ejecutar:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="bash">sdk use grails 2.1.0</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_instalaciÃ³n_en_intellij_idea">3.4.2. InstalaciÃ³n en IntelliJ IDEA</h4>
<div class="paragraph">
<p>En principio IntelliJ IDEA ofrece automÃ¡ticamente la posibilidad de crear proyectos Grails gracias al plugin instalado por defecto. Puedes comprobarlo en las preferencias de <em>IntelliJ IDEA &gt; IDE Settings &gt; Plugins</em> y ahÃ­ buscar el plugin de Grails. Cuando intentemos crear un nuevo proyecto en Grails, IntelliJ nos pedirÃ¡ que le indiquemos donde se encuentra el framework instalado.</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="images/grails03/creategrailsproject.png" alt="Crear proyecto Grails" width="100%">
</div>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="images/grails03/selectgrailsversion.png" alt="Seleccionar la versiÃ³n de Grails desde la instalaciÃ³n de sdk" width="100%">
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_scaffolding_2">3.5. Scaffolding</h3>
<div class="paragraph">
<p>Una vez ya tenemos configurado nuestro entorno de desarrollo, pasemos a la acciÃ³n desarrollando con Grails una sencilla aplicaciÃ³n. En este mÃ³dulo, vamos a desarrollar un ejemplo de lo que serÃ­a el completo desarrollo de una aplicaciÃ³n web que nos permita manejar una lista de tareas. Empezaremos desarrollando este ejemplo de aplicaciÃ³n para explicar como Grails implementa el scaffolding. Pero, Â¿quÃ© es el scaffolding?</p>
</div>
<div class="paragraph">
<p>El scaffolding es un tÃ©rmino utilizado en programaciÃ³n para designar la construcciÃ³n automÃ¡tica de aplicaciones a partir del esquema de la base de datos. EstÃ¡ soportado por varios frameworks MVC y Grails no podÃ­a ser menos y el equipo de desarrollo decidiÃ³ incluirlo entre sus caracterÃ­sticas mÃ¡s importantes. La idea del scaffolding es, partiendo del esquema de la base de datos, generar el cÃ³digo necesario para implementar las cuatro operaciones bÃ¡sicas en cualquier aplicaciÃ³n, que son: creaciÃ³n, lectura, actualizaciÃ³n y borrado. Este tipo de aplicaciones se las conoce como <em>CRUD (create, read, update y delete)</em>.</p>
</div>
<div class="paragraph">
<p>Grails ademÃ¡s nos ofrece dos tipos de scaffolding, el <em>dinÃ¡mico</em>, en el cual Grails genera por nosotros al vuelo el cÃ³digo referente a las vistas y a los controladores y por otro lado el <em>scaffolding estÃ¡tico</em> en el que Grails generarÃ¡ de forma estÃ¡tica el cÃ³digo de controladores y vistas.</p>
</div>
<div class="paragraph">
<p>Como comentabamos anteriormente, vamos a ver un ejemplo de lo que es el scaffolding, desarrollando la tÃ­pica aplicaciÃ³n <em>todo</em>, aplicaciÃ³n que iremos mejorando durante todo este mÃ³dulo.</p>
</div>
<div class="sect3">
<h4 id="_descripciÃ³n_de_la_aplicaciÃ³n_ejemplo">3.5.1. DescripciÃ³n de la aplicaciÃ³n ejemplo</h4>
<div class="paragraph">
<p>BÃ¡sicamente el funcionamiento de la aplicaciÃ³n debe permitir la creaciÃ³n y mantenimiento de tareas asÃ­ como la posibilidad de categorizarlas. Para simplificar la aplicaciÃ³n, una tarea sÃ³lo podrÃ¡ pertenecer como mucho a una categorÃ­a mientras que una categorÃ­a podrÃ¡ tener por supuesto muchas tareas.</p>
</div>
<div class="paragraph">
<p>AdemÃ¡s, tambiÃ©n vamos a permitir la posibilidad etiquetar dichas tareas, con lo que una tarea puede tener varias etiquetas y una etiqueta estar asignada a varias tareas.</p>
</div>
<div class="paragraph">
<p>Por el momento, no nos vamos a preocupar de la gestiÃ³n de usuarios, ya que lo haremos en la sesiÃ³n 7 utilizando un plugin que se encargarÃ¡ por nosotros de todo el tema de seguridad de nuestra aplicaciÃ³n.</p>
</div>
</div>
<div class="sect3">
<h4 id="_creaciÃ³n_del_proyecto_grails">3.5.2. CreaciÃ³n del proyecto Grails</h4>
<div class="paragraph">
<p>Si todo ha ido bien en la instalaciÃ³n de Grails, podremos crear nuestra primera aplicaciÃ³n en Grails gracias al comando <em>grails</em>. Este serÃ¡ el comando que utilizaremos a lo largo de todo el curso para crear todas las partes de nuestra aplicaciÃ³n. Para ver un listado completo de las opciones del comando <em>grails</em>, podemos ejecutar <em>grails help</em>. Si echamos un primer vistazo a esta listado, descubriremos la opciÃ³n <em>create-app</em>, la cual nos servirÃ¡ para crear la estructura de directorios de la aplicaciÃ³n. Ejecutamos <em>grails create-app todo</em> y se nos generarÃ¡ el directorio <em>todo</em> con una serie de subdirectorios que comentaremos en breve.</p>
</div>
<div class="paragraph">
<p>Esta estructura de directorios generada automÃ¡ticamente por Grails viene como consecuencia de lo que comentÃ¡bamos anteriormente como uno de los paradigmas en que se basa Grails, <em>convenciÃ³n sobre configuraciÃ³n</em>. De esta forma, Grails nos genera la estructura de directorios que albergarÃ¡ todo nuestro proyecto para que nosotros lo vayamos <em>completando</em>. Veamos para que sirven los directorios mÃ¡s importantes generados dentro de nuestro proyecto <em>todo</em>.</p>
</div>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-center valign-middle">Directorio</th>
<th class="tableblock halign-left valign-top">DescripciÃ³n</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-center valign-middle"><p class="tableblock">grails-app/conf</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Ficheros de configuraciÃ³n de la aplicaciÃ³n</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-middle"><p class="tableblock">grails-app/conf/hibernate</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Archivos de mapeado de Hibernate</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-middle"><p class="tableblock">grails-app/conf/spring</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Archivos de mapeado de Spring</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-middle"><p class="tableblock">grails-app/controllers</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Controladores de la aplicaciÃ³n que gestionan las peticiones</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-middle"><p class="tableblock">grails-app/domain</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Clases de dominio del modelo</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-middle"><p class="tableblock">grails-app/i18n</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Mensajes para la internacionalizaciÃ³n de la aplicaciÃ³n</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-middle"><p class="tableblock">grails-app/services</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Servicios</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-middle"><p class="tableblock">grails-app/taglib</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">LibrerÃ­as de etiquetas dinÃ¡micas</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-middle"><p class="tableblock">grails-app/utils</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Utilidades especÃ­ficas de Grails</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-middle"><p class="tableblock">grails-app/views</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Archivos GSP</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-middle"><p class="tableblock">grails-app/views/layout</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Archivos de diseÃ±o de las pÃ¡ginas web</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-middle"><p class="tableblock">grails-app/assets/images</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ImÃ¡genes utilizadas por la aplicaciÃ³n en el entorno del plugin pipeline</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-middle"><p class="tableblock">grails-app/assets/javascripts</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Archivos javascript utilizados por la aplicaciÃ³n en el entorno del plugin pipeline</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-middle"><p class="tableblock">grails-app/assets/stylesheets</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Hojas de estilo utilizadas por la aplicaciÃ³n en el entorno del plugin pipeline</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-middle"><p class="tableblock">lib</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Archivos JAR de terceras partes, tales como controladores de bases de datos</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-middle"><p class="tableblock">scripts</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Scripts <em>GANT</em> para el automatizado de tareas</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-middle"><p class="tableblock">src/java</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Archivos fuente adicionales en Java</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-middle"><p class="tableblock">src/groovy</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Archivos fuente adicionales en Groovy</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-middle"><p class="tableblock">test/integration</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Tests de integraciÃ³n</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-middle"><p class="tableblock">test/unit</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Tests unitarios</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-middle"><p class="tableblock">web-app</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Artefactos web que finalmente serÃ¡n comprimidos a un <em>WAR (Web Application Archive)</em></p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-middle"><p class="tableblock">web-app/css</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Hojas de estilo</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-middle"><p class="tableblock">web-app/images</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ImÃ¡genes de la aplicaciÃ³n</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-middle"><p class="tableblock">web-app/js</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Javascript</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-middle"><p class="tableblock">web-app/WEB-INF</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Archivos de configuraciÃ³n para Spring o SiteMesh</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Ahora que ya tenemos una primera idea de lo que significa cada uno de los directorios generados por Grails al crear un proyecto, vamos a abrirlo con el editor IntelliJ IDEA. Grails es capaz de crear tambiÃ©n los archivos de configuraciÃ³n necesarios para que podamos editar el proyecto con diferentes editores como Eclipse, Textmate y NetBeans, con lo que simplemente abrimos el editor y localizamos el proyecto <em>todo</em> y lo abrimos como un nuevo proyecto. Como vemos en la imagen, IDEA ha cambiado la estructura de directorios por una mÃ¡s clara para el desarrollador, aunque siempre podemos ver la estructura real de directorios si accedemos a la vista <em>Project</em>.</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="images/grails03/intellijgrailsapp.png" alt="AplicaciÃ³n Grails con IntelliJ Idea" width="50%">
</div>
</div>
<div class="paragraph">
<p>Nuestro proyecto ya estÃ¡ listo para ser ejecutado, aunque imaginarÃ¡s que por el momento no harÃ¡ nada. Para ver la primera versiÃ³n del proyecto <em>todo</em> podemos ejecutar el comando <em>grails run-app</em>, que nos generarÃ¡ una aplicaciÃ³n en la direcciÃ³n <a href="http://localhost:8080/todo" class="bare">http://localhost:8080/todo</a>. El comando <em>grails run-app</em> lo que ha hecho es crear una instancia del servidor web Tomcat en el puerto 8080 y cargar en Ã©l la aplicaciÃ³n <em>todo</em>. Por ahora esta aplicaciÃ³n hace mÃ¡s bien poco y simplemente nos muestra un mensaje de bienvenida, pero vamos a ver lo sencillo que es generar su contenido.</p>
</div>
</div>
<div class="sect3">
<h4 id="_creaciÃ³n_de_clases_de_dominio">3.5.3. CreaciÃ³n de clases de dominio</h4>
<div class="paragraph">
<p>Al desarrollar una aplicaciÃ³n de este tipo, lo habitual es crear en primer lugar las clases de dominio necesarias para despuÃ©s pasar a generar los controladores, asÃ­ que vamos a empezar creando la clase de dominio referente a los <em>todos</em>. En Grails tenemos el comando <em>grails create-domain-class</em> para generar una determinada clase de dominio, con lo que si ejecutamos <em>grails create-domain-class es.ua.expertojava.todo.todo</em>, Grails nos crearÃ¡ la estructura necesaria para las tareas de nuestra aplicaciÃ³n. En caso de no indicar el nombre de la clase, el sistema nos preguntarÃ¡ por Ã©l.</p>
</div>
<div class="paragraph">
<p>Como podemos comprobar en nuestro proyecto con IDEA, se nos ha creado una clase de dominio llamada <em>Todo</em>, que como ves empieza por mayÃºscula a pesar de que nosotros introdujimos el nombre de la clase de dominio en minÃºsculas. Esto es debido a que Grails sigue una serie de convenios para el nombre de las clases. El contenido de <em>Todo.groovy</em> es el siguiente:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-kn">package</span> <span class="tok-n">es</span><span class="tok-o">.</span><span class="tok-na">ua</span><span class="tok-o">.</span><span class="tok-na">expertojava</span><span class="tok-o">.</span><span class="tok-na">todo</span>

<span class="tok-kd">class</span> <span class="tok-nc">Todo</span> <span class="tok-o">{</span>

    <span class="tok-kd">static</span> <span class="tok-n">constraints</span> <span class="tok-o">=</span> <span class="tok-o">{</span>
    <span class="tok-o">}</span>
<span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>AdemÃ¡s, tambiÃ©n se crea un test unitario llamado <em>es.ua.expertojava.todo.TodoSpec</em>, que de momento dejaremos tal cual estÃ¡ pero que volveremos a Ã©l en la sesiÃ³n 6 en la que hablaremos de los tests unitarios.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-kn">package</span> <span class="tok-n">es</span><span class="tok-o">.</span><span class="tok-na">ua</span><span class="tok-o">.</span><span class="tok-na">expertojava</span><span class="tok-o">.</span><span class="tok-na">todo</span>

<span class="tok-kn">import</span> <span class="tok-nn">grails.test.mixin.TestFor</span>
<span class="tok-kn">import</span> <span class="tok-nn">spock.lang.Specification</span>

<span class="tok-cm">/**</span>
<span class="tok-cm"> * See the API for {@link grails.test.mixin.domain.DomainClassUnitTestMixin} for usage instructions</span>
<span class="tok-cm"> */</span>
<span class="tok-nd">@TestFor</span><span class="tok-o">(</span><span class="tok-n">Todo</span><span class="tok-o">)</span>
<span class="tok-kd">class</span> <span class="tok-nc">TodoSpec</span> <span class="tok-kd">extends</span> <span class="tok-n">Specification</span> <span class="tok-o">{</span>

    <span class="tok-kt">def</span> <span class="tok-nf">setup</span><span class="tok-o">()</span> <span class="tok-o">{</span>
    <span class="tok-o">}</span>

    <span class="tok-kt">def</span> <span class="tok-nf">cleanup</span><span class="tok-o">()</span> <span class="tok-o">{</span>
    <span class="tok-o">}</span>

    <span class="tok-kt">void</span> <span class="tok-s2">&quot;test something&quot;</span><span class="tok-o">()</span> <span class="tok-o">{</span>
    <span class="tok-o">}</span>
<span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>La clase de dominio <em>Todo</em> estÃ¡ preparada para que le aÃ±adamos los campos necesarios, tales como tÃ­tulo, descripciÃ³n, fecha, etc. La informaciÃ³n referente a las tareas serÃ¡n <em>tÃ­tulo</em>, <em>descripciÃ³n</em>, <em>fecha</em>, <em>fechaRecordatorio</em> y <em>url</em>. Con estos datos, la clase de dominio <em>Todo</em> quedarÃ­a asÃ­:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-kn">package</span> <span class="tok-n">es</span><span class="tok-o">.</span><span class="tok-na">ua</span><span class="tok-o">.</span><span class="tok-na">expertojava</span><span class="tok-o">.</span><span class="tok-na">todo</span>

<span class="tok-kd">class</span> <span class="tok-nc">Todo</span> <span class="tok-o">{</span>
    <span class="tok-n">String</span> <span class="tok-n">title</span>
    <span class="tok-n">String</span> <span class="tok-n">description</span>
    <span class="tok-n">Date</span> <span class="tok-n">date</span>
    <span class="tok-n">Date</span> <span class="tok-n">reminderDate</span>
    <span class="tok-n">String</span> <span class="tok-n">url</span>

    <span class="tok-kd">static</span> <span class="tok-n">constraints</span> <span class="tok-o">=</span> <span class="tok-o">{</span>
        <span class="tok-n">title</span><span class="tok-o">(</span><span class="tok-nl">blank:</span><span class="tok-kc">false</span><span class="tok-o">)</span>
        <span class="tok-n">description</span><span class="tok-o">(</span><span class="tok-nl">blank:</span><span class="tok-kc">true</span><span class="tok-o">,</span> <span class="tok-nl">nullable:</span><span class="tok-kc">true</span><span class="tok-o">,</span> <span class="tok-nl">maxSize:</span><span class="tok-mi">1000</span><span class="tok-o">)</span>
        <span class="tok-n">date</span><span class="tok-o">(</span><span class="tok-nl">nullable:</span><span class="tok-kc">false</span><span class="tok-o">)</span>
        <span class="tok-n">reminderDate</span><span class="tok-o">(</span><span class="tok-nl">nullable:</span><span class="tok-kc">true</span><span class="tok-o">)</span>
        <span class="tok-n">url</span><span class="tok-o">(</span><span class="tok-nl">nullable:</span><span class="tok-kc">true</span><span class="tok-o">,</span> <span class="tok-nl">url:</span><span class="tok-kc">true</span><span class="tok-o">)</span>
    <span class="tok-o">}</span>

    <span class="tok-n">String</span> <span class="tok-nf">toString</span><span class="tok-o">(){</span>
        <span class="tok-n">title</span>
    <span class="tok-o">}</span>
<span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Como puedes comprobar, en ningÃºn momento se ha indicado ninguna propiedad como clave primaria y esto es debido a que Grails aÃ±ade siempre las propiedades <em>id</em> y <em>version</em>, los cuales sirven respectivamente como clave primaria de la tabla en cuestiÃ³n y para garantizar la integridad de los datos. La propiedad <em>version</em> es un mecanismo utilizado en <em>Hibernate</em> para el bloqueo de las tablas y que evita que se produzcan inconsistencias en los datos.</p>
</div>
<div class="paragraph">
<p>Por otro lado, la clase <em>Todo</em> no sÃ³lo contiene propiedades sino que tambiÃ©n se han aÃ±adido una serie de restricciones (<em>constraints</em>) que deben cumplir dichas propiedades para que una tarea se pueda insertar en la base de datos. Por ejemplo, la propiedad <em>title</em> no puede dejarse en blanco, la propiedad <em>date</em> no puede ser <em>null</em>, mientras que las propiedades <em>description</em>, <em>reminderDate</em> y <em>url</em> pueden tener un valor <em>null</em> y ademÃ¡s Ã©sta Ãºltima, en caso de contener valor, debe ser una direcciÃ³n url bien formada. AdemÃ¡s, observa tambiÃ©n como la descripciÃ³n no puede exceder de 1000 caracteres.</p>
</div>
</div>
<div class="sect3">
<h4 id="_creaciÃ³n_de_controladores">3.5.4. CreaciÃ³n de controladores</h4>
<div class="paragraph">
<p>Ahora que tenemos nuestra primera clase de dominio creada, necesitamos un controlador que gestione todas las peticiones que le lleguen a esta clase de dominio. El controlador es el encargado de gestionar la interacciÃ³n entre la vista y las clases de dominio, con lo que podemos decir sin gÃ©nero de dudas que es la parte mÃ¡s ardua del sistema. Sin embargo, gracias a que Grails nos permite utilizar <em>scaffolding</em> esto se convierte de nuevo en un juego para niÃ±os.</p>
</div>
<div class="paragraph">
<p>Para crear un controlador en Grails, debemos ejecutar el comando <em>grails create-controller</em> y se generarÃ¡ un nuevo controlador en el directorio <em>grails-app/controllers</em>, asÃ­ como un test unitario en el directorio <em>test/unit/&lt;paquete&gt;</em>. Antes de seguir vamos a crear el controlador de la clase <em>Todo</em> ejecutando <em>grails create-controller es.ua.expertojava.todo.todo</em>, el cual crearÃ¡ el archivo <em>grails-app/controllers/es/ua/expertojava/todo/TodoController.groovy</em> con el siguiente contenido</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-kn">package</span> <span class="tok-n">es</span><span class="tok-o">.</span><span class="tok-na">ua</span><span class="tok-o">.</span><span class="tok-na">expertojava</span><span class="tok-o">.</span><span class="tok-na">todo</span>

<span class="tok-kd">class</span> <span class="tok-nc">TodoController</span> <span class="tok-o">{</span>

    <span class="tok-kt">def</span> <span class="tok-nf">index</span><span class="tok-o">()</span> <span class="tok-o">{</span> <span class="tok-o">}</span>
<span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>AdemÃ¡s, tal y como pasaba cuando creÃ¡bamos la clase de dominio, Grails crea por nosotros un test unitario llamado <em>es.ua.expertojava.todo.TodoControllerSpec</em> que nos permitirÃ¡ mÃ¡s adelante testear el controlador.</p>
</div>
<div class="paragraph">
<p>Para poder utilizar <em>scaffolding</em> de la clase <em>Todo</em> simplemente debemos cambiar la lÃ­nea</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-kt">def</span> <span class="tok-n">index</span> <span class="tok-o">=</span> <span class="tok-o">{}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>por el siguiente cÃ³digo</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-kt">def</span> <span class="tok-n">scaffold</span> <span class="tok-o">=</span> <span class="tok-n">Todo</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>o bien por</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-kt">def</span> <span class="tok-n">scaffold</span> <span class="tok-o">=</span> <span class="tok-kc">true</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Si actualizamos la web de la aplicaciÃ³n veremos como nos aparece un nuevo enlace en el que podremos controlar las tareas de nuestra aplicaciÃ³n. El scaffolding de Grails ha creado por nosotros los cuatro mÃ©todos necesarios para la gestiÃ³n de las tareas <em>creaciÃ³n</em>, <em>lectura</em>, <em>ediciÃ³n</em> y <em>borrado</em>. En la siguiente imagen podemos ver el formulario para aÃ±adir una nueva tarea.</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="images/grails03/addtodo.png" alt="AÃ±adir una tarea" width="50%">
</div>
</div>
<div class="paragraph">
<p>Si nos fijamos bien, observaremos que el orden para el formulario de creaciÃ³n de una nueva tarea sigue el mismo orden en el que aparecen definidas las restricciones para la validaciÃ³n de los datos. TambiÃ©n es interesante ver como para la propiedad <em>description</em> ha creado un <em>textarea</em> en lugar de un campo <em>text</em> como ha hecho con el resto de propiedades de tipo <em>String</em>. Esto es porque para el campo <em>description</em> hemos establecido la restricciÃ³n del tamaÃ±o mÃ¡ximo.</p>
</div>
<div class="paragraph">
<p>Probemos ahora a insertar tareas que no cumplan alguna de las restricciones que le impusimos en la definiciÃ³n de la clase de dominio. Si por ejemplo intentamos insertar una nueva tarea sin especificar su <em>tÃ­tulo</em> el sistema nos proporcionarÃ¡ un error indicando que el campo en cuestiÃ³n no puede estar vacÃ­o. AdemÃ¡s, el campo de texto aparece remarcado en rojo para que el usuario sepa que ahÃ­ estÃ¡ pasando algo no permitido.</p>
</div>
<div class="paragraph">
<p>Si solucionamos este problema con el <em>tÃ­tulo</em>, se insertarÃ¡ una nueva tarea en la base de datos de nuestra aplicaciÃ³n, que posteriormente podremos visualizar, editar y eliminar.</p>
</div>
<div class="paragraph">
<p>ContinÃºemos con nuestro pequeÃ±o ejemplo de scaffolding, y para ello vamos a definir tambiÃ©n la clase de dominio y el controlador para las <em>categorÃ­as</em> de las <em>tareas</em>. Empecemos creando las clases de dominio necesarias y empecemos por las <em>categorÃ­as</em> de las tareas. Para ello ejecutamos el comando <em>grails create-domain-class es.ua.expertojava.todo.category</em>. De estas categorÃ­as necesitamos conocer su <em>nombre</em> y una <em>descripciÃ³n</em>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-kn">package</span> <span class="tok-n">es</span><span class="tok-o">.</span><span class="tok-na">ua</span><span class="tok-o">.</span><span class="tok-na">expertojava</span><span class="tok-o">.</span><span class="tok-na">todo</span>

<span class="tok-kd">class</span> <span class="tok-nc">Category</span> <span class="tok-o">{</span>

    <span class="tok-n">String</span> <span class="tok-n">name</span>
    <span class="tok-n">String</span> <span class="tok-n">description</span>

    <span class="tok-kd">static</span> <span class="tok-n">hasMany</span> <span class="tok-o">=</span> <span class="tok-o">[</span><span class="tok-nl">todos:</span><span class="tok-n">Todo</span><span class="tok-o">]</span>

    <span class="tok-kd">static</span> <span class="tok-n">constraints</span> <span class="tok-o">=</span> <span class="tok-o">{</span>
        <span class="tok-n">name</span><span class="tok-o">(</span><span class="tok-nl">blank:</span><span class="tok-kc">false</span><span class="tok-o">)</span>
        <span class="tok-n">description</span><span class="tok-o">(</span><span class="tok-nl">blank:</span><span class="tok-kc">true</span><span class="tok-o">,</span> <span class="tok-nl">nullable:</span><span class="tok-kc">true</span><span class="tok-o">,</span> <span class="tok-nl">maxSize:</span><span class="tok-mi">1000</span><span class="tok-o">)</span>
    <span class="tok-o">}</span>

    <span class="tok-n">String</span> <span class="tok-nf">toString</span><span class="tok-o">(){</span>
        <span class="tok-n">name</span>
    <span class="tok-o">}</span>
<span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Lo novedoso en la declaraciÃ³n de la clase <em>Category</em> es la apariciÃ³n de la especificaciÃ³n de la relaciÃ³n entre Ã©sta y la clase <em>Todo</em>. Si pensamos en la relaciÃ³n existente entre las tareas y las categorÃ­as, estÃ¡ claro que esta relaciÃ³n es del tipo uno a muchos, es decir, que una categorÃ­a puede tener muchas tareas y que una tarea sÃ³lo pertenecerÃ¡ por simplicidad a una categorÃ­a. Teniendo esto en cuenta, debemos especificar en la clase de dominio <em>Todo</em> la otra parte de la relaciÃ³n. Esto lo vamos a hacer aÃ±adiendo una nueva propiedad estÃ¡tica en la case de dominio del siguiente modo:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-kn">package</span> <span class="tok-n">es</span><span class="tok-o">.</span><span class="tok-na">ua</span><span class="tok-o">.</span><span class="tok-na">expertojava</span><span class="tok-o">.</span><span class="tok-na">todo</span>

<span class="tok-kd">class</span> <span class="tok-nc">Todo</span> <span class="tok-o">{</span>
    <span class="tok-n">String</span> <span class="tok-n">title</span>
    <span class="tok-n">String</span> <span class="tok-n">description</span>
    <span class="tok-n">Date</span> <span class="tok-n">date</span>
    <span class="tok-n">Date</span> <span class="tok-n">reminderDate</span>
    <span class="tok-n">String</span> <span class="tok-n">url</span>
    <span class="tok-n">Category</span> <span class="tok-n">category</span>

    <span class="tok-kd">static</span> <span class="tok-n">constraints</span> <span class="tok-o">=</span> <span class="tok-o">{</span>
        <span class="tok-n">title</span><span class="tok-o">(</span><span class="tok-nl">blank:</span><span class="tok-kc">false</span><span class="tok-o">)</span>
        <span class="tok-n">description</span><span class="tok-o">(</span><span class="tok-nl">blank:</span><span class="tok-kc">true</span><span class="tok-o">,</span> <span class="tok-nl">nullable:</span><span class="tok-kc">true</span><span class="tok-o">,</span> <span class="tok-nl">maxSize:</span><span class="tok-mi">1000</span><span class="tok-o">)</span>
        <span class="tok-n">date</span><span class="tok-o">(</span><span class="tok-nl">nullable:</span><span class="tok-kc">false</span><span class="tok-o">)</span>
        <span class="tok-n">reminderDate</span><span class="tok-o">(</span><span class="tok-nl">nullable:</span><span class="tok-kc">true</span><span class="tok-o">)</span>
        <span class="tok-n">url</span><span class="tok-o">(</span><span class="tok-nl">nullable:</span><span class="tok-kc">true</span><span class="tok-o">,</span> <span class="tok-nl">url:</span><span class="tok-kc">true</span><span class="tok-o">)</span>
        <span class="tok-n">category</span><span class="tok-o">(</span><span class="tok-nl">nullable:</span><span class="tok-kc">true</span><span class="tok-o">)</span>
    <span class="tok-o">}</span>

    <span class="tok-n">String</span> <span class="tok-nf">toString</span><span class="tok-o">(){</span>
        <span class="tok-s2">&quot;title&quot;</span>
    <span class="tok-o">}</span>
<span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Una vez ya tenemos definidas la clase de dominio <em>Category</em>, podemos crear el controlador e indicarle que queremos utilizar el scaffolding para gestionar su informaciÃ³n. Para ello ejecutamos <em>grails create-controller es.ua.expertojava.todo.category</em>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-kn">package</span> <span class="tok-n">es</span><span class="tok-o">.</span><span class="tok-na">ua</span><span class="tok-o">.</span><span class="tok-na">expertojava</span><span class="tok-o">.</span><span class="tok-na">todo</span>

<span class="tok-kd">class</span> <span class="tok-nc">CategoryController</span> <span class="tok-o">{</span>

    <span class="tok-kt">def</span> <span class="tok-n">scaffold</span> <span class="tok-o">=</span> <span class="tok-n">Category</span>
<span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Por Ãºltimo, vamos a aÃ±adir la clase de dominio referente a las etiquetas que vamos a poder asignar a las tareas. Ejecutamos <em>grails create-domain-class es.ua.expertojava.todo.tag</em>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-kn">package</span> <span class="tok-n">es</span><span class="tok-o">.</span><span class="tok-na">ua</span><span class="tok-o">.</span><span class="tok-na">expertojava</span><span class="tok-o">.</span><span class="tok-na">todo</span>

<span class="tok-kd">class</span> <span class="tok-nc">Tag</span> <span class="tok-o">{</span>

    <span class="tok-n">String</span> <span class="tok-n">name</span>

    <span class="tok-kd">static</span> <span class="tok-n">hasMany</span> <span class="tok-o">=</span> <span class="tok-o">[</span><span class="tok-nl">todos:</span><span class="tok-n">Todo</span><span class="tok-o">]</span>

    <span class="tok-kd">static</span> <span class="tok-n">constraints</span> <span class="tok-o">=</span> <span class="tok-o">{</span>
        <span class="tok-n">name</span><span class="tok-o">(</span><span class="tok-nl">blank:</span><span class="tok-kc">false</span><span class="tok-o">,</span> <span class="tok-nl">nullable:</span><span class="tok-kc">true</span><span class="tok-o">,</span> <span class="tok-nl">unique:</span><span class="tok-kc">true</span><span class="tok-o">)</span>
    <span class="tok-o">}</span>

    <span class="tok-n">String</span> <span class="tok-nf">toString</span><span class="tok-o">(){</span>
    	<span class="tok-n">name</span>
    <span class="tok-o">}</span>
<span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Como puedes observar, una etiqueta puede estar asignada a muchas tareas. De igual forma, una tarea podrÃ¡ tener muchas etiquetas. MÃ¡s adelante veremos a fondo como se deben establecer este tipo de relaciones.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-kn">package</span> <span class="tok-n">es</span><span class="tok-o">.</span><span class="tok-na">ua</span><span class="tok-o">.</span><span class="tok-na">expertojava</span><span class="tok-o">.</span><span class="tok-na">todo</span>

<span class="tok-kd">class</span> <span class="tok-nc">Todo</span> <span class="tok-o">{</span>
    <span class="tok-n">String</span> <span class="tok-n">title</span>
    <span class="tok-n">String</span> <span class="tok-n">description</span>
    <span class="tok-n">Date</span> <span class="tok-n">date</span>
    <span class="tok-n">Date</span> <span class="tok-n">reminderDate</span>
    <span class="tok-n">String</span> <span class="tok-n">url</span>
    <span class="tok-n">Category</span> <span class="tok-n">category</span>

    <span class="tok-kd">static</span> <span class="tok-n">hasMany</span> <span class="tok-o">=</span> <span class="tok-o">[</span><span class="tok-nl">tags:</span><span class="tok-n">Tag</span><span class="tok-o">]</span>
    <span class="tok-kd">static</span> <span class="tok-n">belongsTo</span> <span class="tok-o">=</span> <span class="tok-o">[</span><span class="tok-n">Tag</span><span class="tok-o">]</span>

    <span class="tok-kd">static</span> <span class="tok-n">constraints</span> <span class="tok-o">=</span> <span class="tok-o">{</span>
        <span class="tok-n">title</span><span class="tok-o">(</span><span class="tok-nl">blank:</span><span class="tok-kc">false</span><span class="tok-o">)</span>
        <span class="tok-n">description</span><span class="tok-o">(</span><span class="tok-nl">blank:</span><span class="tok-kc">true</span><span class="tok-o">,</span> <span class="tok-nl">nullable:</span><span class="tok-kc">true</span><span class="tok-o">,</span> <span class="tok-nl">maxSize:</span><span class="tok-mi">1000</span><span class="tok-o">)</span>
        <span class="tok-n">date</span><span class="tok-o">(</span><span class="tok-nl">nullable:</span><span class="tok-kc">false</span><span class="tok-o">)</span>
        <span class="tok-n">reminderDate</span><span class="tok-o">(</span><span class="tok-nl">nullable:</span><span class="tok-kc">true</span><span class="tok-o">)</span>
        <span class="tok-n">url</span><span class="tok-o">(</span><span class="tok-nl">nullable:</span><span class="tok-kc">true</span><span class="tok-o">,</span> <span class="tok-nl">url:</span><span class="tok-kc">true</span><span class="tok-o">)</span>
        <span class="tok-n">category</span><span class="tok-o">(</span><span class="tok-nl">nullable:</span><span class="tok-kc">true</span><span class="tok-o">)</span>
    <span class="tok-o">}</span>

    <span class="tok-n">String</span> <span class="tok-nf">toString</span><span class="tok-o">(){</span>
        <span class="tok-s2">&quot;title&quot;</span>
    <span class="tok-o">}</span>
<span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Como siempre, no olvidemos crear el controlador que se encargarÃ¡ de gestionar las etiquetas:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-kn">package</span> <span class="tok-n">es</span><span class="tok-o">.</span><span class="tok-na">ua</span><span class="tok-o">.</span><span class="tok-na">expertojava</span><span class="tok-o">.</span><span class="tok-na">todo</span>

<span class="tok-kd">class</span> <span class="tok-nc">TagController</span> <span class="tok-o">{</span>

    <span class="tok-kt">def</span> <span class="tok-n">scaffold</span> <span class="tok-o">=</span> <span class="tok-n">Tag</span>
<span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Ahora sÃ­, nuestra aplicaciÃ³n empieza a tomar forma de como debe ser la aplicaciÃ³n final, aunque por supuesto todavÃ­a quedan muchas cosas que iremos viendo a lo largo del mÃ³dulo. Ahora mismo, podemos empezar a probar la aplicaciÃ³n insertando datos en cada una de las clases y comprobar que todo funciona correctamente. Sin embargo, la labor de introducciÃ³n de los datos a mano en la aplicaciÃ³n es algo muy repetitivo y aburrido, asÃ­ que vamos a ver como podemos convertir esta tarea en algo mÃ¡s sencillo y no tener que repetirla cada vez que probamos la aplicaciÃ³n (recuerda que ahora mismo la base de datos estÃ¡ en memoria con lo que se destruye cada vez que reiniciamos la aplicaciÃ³n).</p>
</div>
<div class="paragraph">
<p>En el directorio de configuraciÃ³n de nuestra aplicaciÃ³n (<em>grails-app/conf</em>) tenemos un archivo llamado <em>BootStrap.groovy</em> cuya funcionalidad es posibilitar la realizaciÃ³n de acciones al arrancar y al finalizar nuestra aplicaciÃ³n. Como ya estarÃ©is imaginando, vamos a aprovechar este fichero para introducir algunos datos en nuestra aplicaciÃ³n para tener algo de informaciÃ³n ya introducida en nuestra aplicaciÃ³n. El siguiente ejemplo, inserta tareas, categorÃ­as y etiquetas en nuestra aplicaciÃ³n.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-kn">import</span> <span class="tok-nn">es.ua.expertojava.todo.*</span>

<span class="tok-kd">class</span> <span class="tok-nc">BootStrap</span> <span class="tok-o">{</span>

    <span class="tok-kt">def</span> <span class="tok-n">init</span> <span class="tok-o">=</span> <span class="tok-o">{</span> <span class="tok-n">servletContext</span> <span class="tok-o">-&gt;</span>
        <span class="tok-kt">def</span> <span class="tok-n">categoryHome</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">Category</span><span class="tok-o">(</span><span class="tok-nl">name:</span><span class="tok-s2">&quot;Hogar&quot;</span><span class="tok-o">).</span><span class="tok-na">save</span><span class="tok-o">()</span>
        <span class="tok-kt">def</span> <span class="tok-n">categoryJob</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">Category</span><span class="tok-o">(</span><span class="tok-nl">name:</span><span class="tok-s2">&quot;Trabajo&quot;</span><span class="tok-o">).</span><span class="tok-na">save</span><span class="tok-o">()</span>

        <span class="tok-kt">def</span> <span class="tok-n">tagEasy</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">Tag</span><span class="tok-o">(</span><span class="tok-nl">name:</span><span class="tok-s2">&quot;FÃ¡cil&quot;</span><span class="tok-o">).</span><span class="tok-na">save</span><span class="tok-o">()</span>
        <span class="tok-kt">def</span> <span class="tok-n">tagDifficult</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">Tag</span><span class="tok-o">(</span><span class="tok-nl">name:</span><span class="tok-s2">&quot;DifÃ­cil&quot;</span><span class="tok-o">).</span><span class="tok-na">save</span><span class="tok-o">()</span>
        <span class="tok-kt">def</span> <span class="tok-n">tagArt</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">Tag</span><span class="tok-o">(</span><span class="tok-nl">name:</span><span class="tok-s2">&quot;Arte&quot;</span><span class="tok-o">).</span><span class="tok-na">save</span><span class="tok-o">()</span>
        <span class="tok-kt">def</span> <span class="tok-n">tagRoutine</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">Tag</span><span class="tok-o">(</span><span class="tok-nl">name:</span><span class="tok-s2">&quot;Rutina&quot;</span><span class="tok-o">).</span><span class="tok-na">save</span><span class="tok-o">()</span>
        <span class="tok-kt">def</span> <span class="tok-n">tagKitchen</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">Tag</span><span class="tok-o">(</span><span class="tok-nl">name:</span><span class="tok-s2">&quot;Cocina&quot;</span><span class="tok-o">).</span><span class="tok-na">save</span><span class="tok-o">()</span>

        <span class="tok-kt">def</span> <span class="tok-n">todoPaintKitchen</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">Todo</span><span class="tok-o">(</span><span class="tok-nl">title:</span><span class="tok-s2">&quot;Pintar cocina&quot;</span><span class="tok-o">,</span> <span class="tok-nl">date:</span><span class="tok-k">new</span> <span class="tok-n">Date</span><span class="tok-o">()+</span><span class="tok-mi">1</span><span class="tok-o">)</span>
        <span class="tok-kt">def</span> <span class="tok-n">todoCollectPost</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">Todo</span><span class="tok-o">(</span><span class="tok-nl">title:</span><span class="tok-s2">&quot;Recoger correo postal&quot;</span><span class="tok-o">,</span> <span class="tok-nl">date:</span><span class="tok-k">new</span> <span class="tok-n">Date</span><span class="tok-o">()+</span><span class="tok-mi">2</span><span class="tok-o">)</span>
        <span class="tok-kt">def</span> <span class="tok-n">todoBakeCake</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">Todo</span><span class="tok-o">(</span><span class="tok-nl">title:</span><span class="tok-s2">&quot;Cocinar pastel&quot;</span><span class="tok-o">,</span> <span class="tok-nl">date:</span><span class="tok-k">new</span> <span class="tok-n">Date</span><span class="tok-o">()+</span><span class="tok-mi">4</span><span class="tok-o">)</span>
        <span class="tok-kt">def</span> <span class="tok-n">todoWriteUnitTests</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">Todo</span><span class="tok-o">(</span><span class="tok-nl">title:</span><span class="tok-s2">&quot;Escribir tests unitarios&quot;</span><span class="tok-o">,</span> <span class="tok-nl">date:</span><span class="tok-k">new</span> <span class="tok-n">Date</span><span class="tok-o">())</span>

        <span class="tok-n">todoPaintKitchen</span><span class="tok-o">.</span><span class="tok-na">addToTags</span><span class="tok-o">(</span><span class="tok-n">tagDifficult</span><span class="tok-o">)</span>
        <span class="tok-n">todoPaintKitchen</span><span class="tok-o">.</span><span class="tok-na">addToTags</span><span class="tok-o">(</span><span class="tok-n">tagArt</span><span class="tok-o">)</span>
        <span class="tok-n">todoPaintKitchen</span><span class="tok-o">.</span><span class="tok-na">addToTags</span><span class="tok-o">(</span><span class="tok-n">tagKitchen</span><span class="tok-o">)</span>
        <span class="tok-n">todoPaintKitchen</span><span class="tok-o">.</span><span class="tok-na">category</span> <span class="tok-o">=</span> <span class="tok-n">categoryHome</span>
        <span class="tok-n">todoPaintKitchen</span><span class="tok-o">.</span><span class="tok-na">save</span><span class="tok-o">()</span>

        <span class="tok-n">todoCollectPost</span><span class="tok-o">.</span><span class="tok-na">addToTags</span><span class="tok-o">(</span><span class="tok-n">tagRoutine</span><span class="tok-o">)</span>
        <span class="tok-n">todoCollectPost</span><span class="tok-o">.</span><span class="tok-na">category</span> <span class="tok-o">=</span> <span class="tok-n">categoryJob</span>
        <span class="tok-n">todoCollectPost</span><span class="tok-o">.</span><span class="tok-na">save</span><span class="tok-o">()</span>

        <span class="tok-n">todoBakeCake</span><span class="tok-o">.</span><span class="tok-na">addToTags</span><span class="tok-o">(</span><span class="tok-n">tagEasy</span><span class="tok-o">)</span>
        <span class="tok-n">todoBakeCake</span><span class="tok-o">.</span><span class="tok-na">addToTags</span><span class="tok-o">(</span><span class="tok-n">tagKitchen</span><span class="tok-o">)</span>
        <span class="tok-n">todoBakeCake</span><span class="tok-o">.</span><span class="tok-na">category</span> <span class="tok-o">=</span> <span class="tok-n">categoryHome</span>
        <span class="tok-n">todoBakeCake</span><span class="tok-o">.</span><span class="tok-na">save</span><span class="tok-o">()</span>

        <span class="tok-n">todoWriteUnitTests</span><span class="tok-o">.</span><span class="tok-na">addToTags</span><span class="tok-o">(</span><span class="tok-n">tagEasy</span><span class="tok-o">)</span>
        <span class="tok-n">todoWriteUnitTests</span><span class="tok-o">.</span><span class="tok-na">category</span> <span class="tok-o">=</span> <span class="tok-n">categoryJob</span>
        <span class="tok-n">todoWriteUnitTests</span><span class="tok-o">.</span><span class="tok-na">save</span><span class="tok-o">()</span>
    <span class="tok-o">}</span>
    <span class="tok-kt">def</span> <span class="tok-n">destroy</span> <span class="tok-o">=</span> <span class="tok-o">{</span> <span class="tok-o">}</span>
<span class="tok-o">}</span></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_scaffolding_estÃ¡tico">3.5.5. Scaffolding estÃ¡tico</h4>
<div class="paragraph">
<p>Una vez hemos visto lo rÃ¡pido que hemos desarrollado la base de nuestra aplicaciÃ³n, vamos a ver como podemos llegar algo mÃ¡s lejos con nuestras aplicaciones gracias al scaffolding estÃ¡tico. Hasta el momento, el cÃ³digo de nuestros controladores y vistas se genera al vuelo y no podemos realizar ni siquiera una pequeÃ±a modificaciÃ³n a estos artefactos.</p>
</div>
<div class="paragraph">
<p>Para pasar de scaffolding dinÃ¡mico a estÃ¡tico, Grails dispone de tres comandos para realizar esta tarea:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>generate-controller</p>
</li>
<li>
<p>generate-views</p>
</li>
<li>
<p>generate-all</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Los tres comandos esperan como parÃ¡metro una clase de dominio para la cual generar el cÃ³digo necesario. Veamos un ejemplo sobre las clases de dominio de la aplicaciÃ³n.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="bash">grails generate-all es.ua.expertojava.todo.Todo</code></pre>
</div>
</div>
<div class="paragraph">
<p>Tras ejecutar este comando, si echamos un vistazo a nuestro proyecto en IntelliJ IDEA, veremos como el controlador <em>es.ua.expertojava.todo.TodoController</em> y el directorio de las vistas <em>views/todo</em> han cambiado considerablemente.</p>
</div>
<div class="paragraph">
<p>Por un lado, el controlador ahora tiene todo el contenido necesario de forma estÃ¡tica de forma que vamos a poder modificarlo segÃºn nuestras necesidades. AdemÃ¡s, en el directorio de las vistas correspondientes a la clase de dominio <em>todo</em> podemos ver los archivos necesarios para poder completar el CRUD de la clase <em>Todo</em>.</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="images/grails03/projectaftergenerateall.png" alt="Proyecto tras generar todo" width="50%">
</div>
</div>
<div class="paragraph">
<p>Los otros dos comandos comentados anteriormente van a realizar en conjunto las mismas acciones que el comando <em>generate-all</em>. Veamos un ejemplo con la clase de dominio <em>Tag</em>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="bash">grails generate-controller es.ua.expertojava.todo.Tag
grails generate-views es.ua.expertojava.todo.Tag</code></pre>
</div>
</div>
<div class="paragraph">
<p>Como podrÃ¡s comprobar en el proyecto, el controlador <em>es.ua.expertojava.todo.TagController</em> se ha definido de forma estÃ¡tica y las vistas han sido generadas para poder ser modificadas mÃ¡s fÃ¡cilmente.</p>
</div>
<div style="page-break-after: always;"></div>
</div>
</div>
<div class="sect2">
<h3 id="_ejercicios_3">3.6. Ejercicios</h3>
<div class="sect3">
<h4 id="_marcar_como_realizada_una_tarea_0_25_puntos">3.6.1. Marcar como realizada una tarea (0.25 puntos)</h4>
<div class="paragraph">
<p>En la definiciÃ³n de la aplicaciÃ³n <em>todo</em> hemos pasado por alto algo fundamental y es que una tarea puede haber sido realizada o no. AÃ±ade la informaciÃ³n necesaria a nuestras clases de dominio para saber si una tarea ha sido ya completada.</p>
</div>
<div class="paragraph">
<p>No olvides aÃ±adir el valor deseado en el archivo <em>Bootstrap.groovy</em> para la nueva propiedad aÃ±adida.</p>
</div>
</div>
<div class="sect3">
<h4 id="_modificaciÃ³n_pantalla_inicial_0_25_puntos">3.6.2. ModificaciÃ³n pantalla inicial (0.25 puntos)</h4>
<div class="paragraph">
<p>Vamos a modificar la pantalla de bienvenida a la aplicaciÃ³n con las siguientes indicaciones:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Eliminar el logo de Grails de la parte superior para indicar el nombre la aplicaciÃ³n</p>
</li>
<li>
<p>Indicar nuestro nombre, apellidos y DNI</p>
</li>
<li>
<p>AÃ±adir una imagen de vuestro perfil (puede valer la misma que tenÃ©is en el campus virtual)</p>
</li>
<li>
<p>Eliminar el bloque de la izquierda donde aparece toda la informaciÃ³n relativa a nuestra aplicaciÃ³n</p>
</li>
<li>
<p>AÃ±adir una descripciÃ³n apropiada de la aplicaciÃ³n</p>
</li>
<li>
<p>AÃ±adir los enlaces correspondientes a las acciones que podemos realizar por el momento en nuestra aplicaciÃ³n</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>PodrÃ­a quedar algo asÃ­:</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="images/grails03/ejemplopantallainicial.png" alt="Ejemplo pantalla inicial aplicaciÃ³n TODO" width="50%">
</div>
</div>
</div>
<div class="sect3">
<h4 id="_scaffolding_estÃ¡tico_sobre_la_clase_categorÃ­a_0_75_puntos">3.6.3. Scaffolding estÃ¡tico sobre la clase CategorÃ­a (0.75 puntos)</h4>
<div class="paragraph">
<p>La Ãºnica clase de dominio que nos queda por definir de forma estÃ¡tica es la referente a las categorÃ­as. Utilicemos tambiÃ©n scaffolding estÃ¡tico para esta clase. AdemÃ¡s, vamos a realizar las siguientes modificaciones sobre las vistas de las categorÃ­as:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Cuando creamos una categorÃ­a, Grails nos ofrece un enlace para crear <em>tareas</em> que por el momento vamos a eliminar.</p>
</li>
</ul>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="images/grails03/createcategory.png" alt="Crear una categorÃ­a" width="50%">
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>En el listado de categorÃ­as, vamos a eliminar el campo descripciÃ³n porque en ocasiones esa descripciÃ³n puede ser demasiado extensa.</p>
</li>
<li>
<p>Cuando creamos una categorÃ­a utilizando la aplicaciÃ³n, el mensaje que aparece indica que la categorÃ­a con identificado <em>X</em> ha sido creada correctamente. Realiza los cambios necesarios en el controlador para que en lugar de indicar el identificador, aparezca el nombre de la nueva categorÃ­a creada.</p>
</li>
</ul>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="images/grails03/categorycreatedwithid.png" alt="Indicando el identificador de la categorÃ­a" width="50%">
</div>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="images/grails03/categorycreatedwithname.png" alt="Indicando el nombre de la categorÃ­a" width="50%">
</div>
</div>
<div style="page-break-after: always;"></div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="sesion04">4. PatrÃ³n MVC: Vistas y controladores.</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Tras una primera sesiÃ³n introductoria a Grails en la que ya hemos visto como crear una sencilla aplicaciÃ³n utilizando el scaffolding que nos ofrece Grails. Aunque en esta primera sesiÃ³n no hemos comentado nada sobre las vistas, ya podemos suponer como Grails las organiza siguiendo el principio de <em>convenciÃ³n sobre configuraciÃ³n</em>.</p>
</div>
<div class="paragraph">
<p>En esta sesiÃ³n profundizaremos en mÃ¡s aspectos relativos a las vistas, tales como creaciÃ³n de plantillas o etiquetas. TambiÃ©n aprovecharemos para hablar mÃ¡s detalladamente sobre los controladores en Grails.</p>
</div>
<div class="sect2">
<h3 id="_estructura_de_las_vistas_en_grails">4.1. Estructura de las vistas en Grails</h3>
<div class="paragraph">
<p>Lo primero que hay que comentar es que en Grails los archivos de las vistas de nuestras aplicaciones tienen extensiÃ³n <em>GSP</em>. AdemÃ¡s, y siguiendo con el paradigma de <em>convenciÃ³n sobre configuraciÃ³n</em>, Grails aconseja que las vistas utilizadas en nuestra aplicaciÃ³n se alojen en el directorio <em>grails-app/views</em>. Dentro de este directorio, al crear nuestro proyecto se ha creado tambiÃ©n el subdirectorio <em>layouts</em>. Este directorio viene por defecto con un archivo <em>main.gsp</em>, que podrÃ­amos decir que es el encargado de pintar la apariencia de toda la aplicaciÃ³n en Grails.</p>
</div>
<div class="paragraph">
<p>Como comentÃ¡bamos en la sesiÃ³n de introducciÃ³n a Grails, Ã©ste utiliza el framework Sitemesh para renderizar una aplicaciÃ³n en Grails y una de las caracterÃ­sticas de Sitemesh es que utiliza lo que podrÃ­amos llamar un archivo padre (layout) y dentro de este archivo padre se pintarÃ¡n todas las vistas de la aplicaciÃ³n. Veamos ahora el contenido del Ãºnico archivo (<em>/grails-app/views/layouts/main.gsp</em>) que aparece por el momento en el directorio <em>layouts</em>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="html"><span class="tok-cp">&lt;!DOCTYPE html&gt;</span>
<span class="tok-c">&lt;!--[if lt IE 7 ]&gt; &lt;html lang=&quot;en&quot; class=&quot;no-js ie6&quot;&gt; &lt;![endif]--&gt;</span>
<span class="tok-c">&lt;!--[if IE 7 ]&gt;    &lt;html lang=&quot;en&quot; class=&quot;no-js ie7&quot;&gt; &lt;![endif]--&gt;</span>
<span class="tok-c">&lt;!--[if IE 8 ]&gt;    &lt;html lang=&quot;en&quot; class=&quot;no-js ie8&quot;&gt; &lt;![endif]--&gt;</span>
<span class="tok-c">&lt;!--[if IE 9 ]&gt;    &lt;html lang=&quot;en&quot; class=&quot;no-js ie9&quot;&gt; &lt;![endif]--&gt;</span>
<span class="tok-c">&lt;!--[if (gt IE 9)|!(IE)]&gt;&lt;!--&gt;</span>
<span class="tok-nt">&lt;html</span> <span class="tok-na">lang=</span><span class="tok-s">&quot;en&quot;</span> <span class="tok-na">class=</span><span class="tok-s">&quot;no-js&quot;</span><span class="tok-nt">&gt;</span><span class="tok-c">&lt;!--&lt;![endif]--&gt;</span>
    <span class="tok-nt">&lt;head&gt;</span>
        <span class="tok-nt">&lt;meta</span> <span class="tok-na">http-equiv=</span><span class="tok-s">&quot;Content-Type&quot;</span> <span class="tok-na">content=</span><span class="tok-s">&quot;text/html; charset=UTF-8&quot;</span><span class="tok-nt">&gt;</span>
        <span class="tok-nt">&lt;meta</span> <span class="tok-na">http-equiv=</span><span class="tok-s">&quot;X-UA-Compatible&quot;</span> <span class="tok-na">content=</span><span class="tok-s">&quot;IE=edge,chrome=1&quot;</span><span class="tok-nt">&gt;</span>
        <span class="tok-nt">&lt;title&gt;&lt;g:layoutTitle</span> <span class="tok-na">default=</span><span class="tok-s">&quot;Grails&quot;</span><span class="tok-nt">/&gt;&lt;/title&gt;</span>
        <span class="tok-nt">&lt;meta</span> <span class="tok-na">name=</span><span class="tok-s">&quot;viewport&quot;</span> <span class="tok-na">content=</span><span class="tok-s">&quot;width=device-width, initial-scale=1.0&quot;</span><span class="tok-nt">&gt;</span>
        <span class="tok-nt">&lt;link</span> <span class="tok-na">rel=</span><span class="tok-s">&quot;shortcut icon&quot;</span> <span class="tok-na">href=</span><span class="tok-s">&quot;${assetPath(src: &#39;favicon.ico&#39;)}&quot;</span> <span class="tok-na">type=</span><span class="tok-s">&quot;image/x-icon&quot;</span><span class="tok-nt">&gt;</span>
        <span class="tok-nt">&lt;link</span> <span class="tok-na">rel=</span><span class="tok-s">&quot;apple-touch-icon&quot;</span> <span class="tok-na">href=</span><span class="tok-s">&quot;${assetPath(src: &#39;apple-touch-icon.png&#39;)}&quot;</span><span class="tok-nt">&gt;</span>
        <span class="tok-nt">&lt;link</span> <span class="tok-na">rel=</span><span class="tok-s">&quot;apple-touch-icon&quot;</span> <span class="tok-na">sizes=</span><span class="tok-s">&quot;114x114&quot;</span> <span class="tok-na">href=</span><span class="tok-s">&quot;${assetPath(src: &#39;apple-touch-icon-retina.png&#39;)}&quot;</span><span class="tok-nt">&gt;</span>
        <span class="tok-nt">&lt;asset:stylesheet</span> <span class="tok-na">src=</span><span class="tok-s">&quot;application.css&quot;</span><span class="tok-nt">/&gt;</span>
        <span class="tok-nt">&lt;asset:javascript</span> <span class="tok-na">src=</span><span class="tok-s">&quot;application.js&quot;</span><span class="tok-nt">/&gt;</span>
        <span class="tok-nt">&lt;g:layoutHead/&gt;</span>
    <span class="tok-nt">&lt;/head&gt;</span>
    <span class="tok-nt">&lt;body&gt;</span>
        <span class="tok-nt">&lt;div</span> <span class="tok-na">id=</span><span class="tok-s">&quot;grailsLogo&quot;</span> <span class="tok-na">role=</span><span class="tok-s">&quot;banner&quot;</span><span class="tok-nt">&gt;&lt;a</span> <span class="tok-na">href=</span><span class="tok-s">&quot;http://grails.org&quot;</span><span class="tok-nt">&gt;&lt;asset:image</span> <span class="tok-na">src=</span><span class="tok-s">&quot;grails_logo.png&quot;</span> <span class="tok-na">alt=</span><span class="tok-s">&quot;Grails&quot;</span><span class="tok-nt">/&gt;&lt;/a&gt;&lt;/div&gt;</span>
        <span class="tok-nt">&lt;g:layoutBody/&gt;</span>
        <span class="tok-nt">&lt;div</span> <span class="tok-na">class=</span><span class="tok-s">&quot;footer&quot;</span> <span class="tok-na">role=</span><span class="tok-s">&quot;contentinfo&quot;</span><span class="tok-nt">&gt;&lt;/div&gt;</span>
        <span class="tok-nt">&lt;div</span> <span class="tok-na">id=</span><span class="tok-s">&quot;spinner&quot;</span> <span class="tok-na">class=</span><span class="tok-s">&quot;spinner&quot;</span> <span class="tok-na">style=</span><span class="tok-s">&quot;display:none;&quot;</span><span class="tok-nt">&gt;&lt;g:message</span> <span class="tok-na">code=</span><span class="tok-s">&quot;spinner.alt&quot;</span> <span class="tok-na">default=</span><span class="tok-s">&quot;Loading&amp;hellip;&quot;</span><span class="tok-nt">/&gt;&lt;/div&gt;</span>
    <span class="tok-nt">&lt;/body&gt;</span>
<span class="tok-nt">&lt;/html&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Si analizamos un poco el cÃ³digo fuente de este archivo <em>main.gsp</em>, comprobaremos la existencia de una serie de etiqueta que veremos posteriormente cuyo espacio de nombres es <em>g</em>, como por ejemplo <em>&lt;g:layoutTitle default="Grails"/&gt;</em>, <em>&lt;g:layoutHead/&gt;</em> o <em>&lt;g:layoutBody/&gt;</em>. Estas tres etiquetas estÃ¡n indicando a Grails que deben ser sustituidas por el tÃ­tulo, la cabecera y el contenido de las pÃ¡ginas que estemos renderizando.</p>
</div>
<div class="paragraph">
<p>Por ejemplo, otro archivo que ha creado Grails automÃ¡ticamente es el archivo que se encuentra en la raiz del directorio <em>views</em> llamado <em>error.gsp</em>. El contenido de este archivo es el siguiente</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="html"><span class="tok-cp">&lt;!DOCTYPE html&gt;</span>
<span class="tok-nt">&lt;html&gt;</span>
    <span class="tok-nt">&lt;head&gt;</span>
        <span class="tok-nt">&lt;title&gt;</span>
            <span class="tok-nt">&lt;g:if</span> <span class="tok-na">env=</span><span class="tok-s">&quot;development&quot;</span><span class="tok-nt">&gt;</span>Grails Runtime Exception<span class="tok-nt">&lt;/g:if&gt;&lt;g:else&gt;</span>Error<span class="tok-nt">&lt;/g:else&gt;</span>
        <span class="tok-nt">&lt;/title&gt;</span>
        <span class="tok-nt">&lt;meta</span> <span class="tok-na">name=</span><span class="tok-s">&quot;layout&quot;</span> <span class="tok-na">content=</span><span class="tok-s">&quot;main&quot;</span><span class="tok-nt">&gt;</span>
        <span class="tok-nt">&lt;g:if</span> <span class="tok-na">env=</span><span class="tok-s">&quot;development&quot;</span><span class="tok-nt">&gt;&lt;asset:stylesheet</span> <span class="tok-na">src=</span><span class="tok-s">&quot;errors.css&quot;</span><span class="tok-nt">/&gt;&lt;/g:if&gt;</span>
    <span class="tok-nt">&lt;/head&gt;</span>
    <span class="tok-nt">&lt;body&gt;</span>
        <span class="tok-nt">&lt;g:if</span> <span class="tok-na">env=</span><span class="tok-s">&quot;development&quot;</span><span class="tok-nt">&gt;</span>
            <span class="tok-nt">&lt;g:renderException</span> <span class="tok-na">exception=</span><span class="tok-s">&quot;${exception}&quot;</span> <span class="tok-nt">/&gt;</span>
        <span class="tok-nt">&lt;/g:if&gt;</span>
        <span class="tok-nt">&lt;g:else&gt;</span>
            <span class="tok-nt">&lt;ul</span> <span class="tok-na">class=</span><span class="tok-s">&quot;errors&quot;</span><span class="tok-nt">&gt;</span>
                <span class="tok-nt">&lt;li&gt;</span>An error has occurred<span class="tok-nt">&lt;/li&gt;</span>
            <span class="tok-nt">&lt;/ul&gt;</span>
        <span class="tok-nt">&lt;/g:else&gt;</span>
    <span class="tok-nt">&lt;/body&gt;</span>
<span class="tok-nt">&lt;/html&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Â¿CÃ³mo actuarÃ­a Grails cuando quiera pintar este archivo <em>error.gsp</em>? En primer lugar, detecta que este archivo se tiene que pintar envuelto en el layout <em>main</em> puesto que tenemos la etiqueta <em>&lt;meta name="layout" content="main"&gt;</em>. Una vez Grails ya sabe que esa pÃ¡gina debe ser pintada utilizando un envoltorio (layout), realizarÃ¡ las sustituciones correspondientes en las etiquetas de dicho envoltorio <em>&lt;g:layoutTitle default="Grails"/&gt;</em> (sustituida por el texto Grails Runtime Exception), <em>&lt;g:layoutHead/&gt;</em> (sustituido por todo lo que estÃ© dentro de la cabecera de <em>error.gsp</em>, que en este caso es Ãºnicamente la referencia a los estilos <em>&lt;g:layoutHead/&gt;</em>) y <em>&lt;g:layoutBody/&gt;</em>, que serÃ¡ sustituido por la salida que produzca la etiqueta <em>&lt;g:renderException exception="${exception}" /&gt;</em> en caso de que estemos en el entorno de desarrollo o bien por un texto indicando <em>"An error has ocurred"</em>.</p>
</div>
<div class="paragraph">
<p>Una vez tenemos claro como se organizan las vistas en un proyecto desarrollado en Grails, Â¿cÃ³mo podemos organizar estas vistas de forma lÃ³gica? En Grails vamos a distinguir dos tipos de vistas: las plantillas y las vistas. BÃ¡sicamente las primeras serÃ¡n fragmentos de cÃ³digo que podremos utilizar en varias partes de nuestra aplicaciÃ³n mientras que las vistas se corresponderÃ¡n con pÃ¡ginas renderizadas gracias a una llamada de un controlador.</p>
</div>
</div>
<div class="sect2">
<h3 id="_plantillas">4.2. Plantillas</h3>
<div class="paragraph">
<p>En Grails las plantillas se diferencian de las vistas porque en las primeras su nombre siempre empieza por un subrayado bajo. Otra diferencia notable entre las vistas y las plantillas, es su utilidad y es que las plantillas normalmente las utilizaremos insertadas en vistas y nos facilitarÃ¡ la labor en aquellas partes de las interfaz de usuario que aparezca en varias pÃ¡ginas. Un buen ejemplo de una plantilla podrÃ­a ser el menÃº con todas las opciones de nuestra aplicaciÃ³n.</p>
</div>
<div class="paragraph">
<p>Las buenas prÃ¡cticas de Grails indican que cualquier plantilla relacionada con una clase de dominio deben estar alojadas todas en un directorio, como por ejemplo <em>grails-app/views/todo/_mytemplate.gsp</em>. De igual forma, aquellas plantillas que vayan a ser utilizadas de una forma mÃ¡s genÃ©rica en varias clases de dominio, deben alojarse en un lugar comÃºn, por ejemplo en <em>grails-app/views/common</em>. Las plantillas tendrÃ¡n extensiÃ³n GSP que son las siglas de <em>Groovy Server Pages</em>.</p>
</div>
<div class="sect3">
<h4 id="_plantilla_de_pie_de_pÃ¡gina">4.2.1. Plantilla de pie de pÃ¡gina</h4>
<div class="paragraph">
<p>Para comprobar el funcionamiento de las plantillas en Grails, vamos a crear una que nos permita mostrar un pie de pÃ¡gina en toda nuestra aplicaciÃ³n que sustituirÃ¡ al que Grails ha creado por nosotros. Como es una plantilla comÃºn a toda la aplicaciÃ³n, la almacenaremos en el directorio <em>grails-app/views/common</em> y la vamos a llamar <em>_footer.gsp</em> y su contenido serÃ¡ algo parecido a esto:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-o">&lt;</span><span class="tok-n">div</span> <span class="tok-n">class</span><span class="tok-o">=</span><span class="tok-s2">&quot;footer&quot;</span> <span class="tok-n">role</span><span class="tok-o">=</span><span class="tok-s2">&quot;contentinfo&quot;</span><span class="tok-o">&gt;</span>
    <span class="tok-o">&amp;</span><span class="tok-n">copy</span><span class="tok-o">;</span> <span class="tok-mi">2015</span> <span class="tok-n">Experto</span> <span class="tok-n">en</span> <span class="tok-n">Desarrollo</span> <span class="tok-n">de</span> <span class="tok-n">Aplicaciones</span> <span class="tok-n">Web</span> <span class="tok-n">con</span> <span class="tok-n">JavaEE</span> <span class="tok-n">y</span> <span class="tok-n">Javascript</span><span class="tok-o">&lt;</span><span class="tok-n">br</span><span class="tok-s">/&gt;</span>
<span class="tok-s">    AplicaciÃ³n Todo creada por Francisco JosÃ© GarcÃ­a Rico (21.542.334F)</span>
<span class="tok-s">&lt;/</span><span class="tok-n">div</span><span class="tok-o">&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Una vez creada la plantilla, necesitamos poder incrustarla en nuestro proyecto. Para ello, vamos a modificar el layout <em>main.gsp</em> para incluir la llamada correspondiente a esta plantilla. Nosotros vamos a aÃ±adir esta plantilla justo despuÃ©s de la etiqueta <em>&lt;g:layoutBody/&gt;</em>, quedando de esta forma:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-o">...</span>
<span class="tok-o">&lt;</span><span class="tok-nl">g:</span><span class="tok-n">layoutBody</span><span class="tok-s">/&gt;</span>
<span class="tok-s">&lt;g:render template=&quot;/</span><span class="tok-n">common</span><span class="tok-s">/footer&quot;/</span><span class="tok-o">&gt;</span>
<span class="tok-o">&lt;</span><span class="tok-n">div</span> <span class="tok-n">id</span><span class="tok-o">=</span><span class="tok-s2">&quot;spinner&quot;</span><span class="tok-o">...</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Para pintar la plantilla correspondiente hemos utilizado la etiqueta de Grails <em>g:render</em> y como habrÃ¡s podido comprobar, no es necesario poner ni el subrayado bajo ni la extensiÃ³n gsp en el parÃ¡metro <em>template</em>, puesto que Grails ya lo hace por nosotros.</p>
</div>
<div class="paragraph">
<p>Nuestra aplicaciÃ³n ya dispone de un pie de pÃ¡gina con la informaciÃ³n sobre los creadores de la aplicaciÃ³n. Pero, Â¿quÃ© pasa si queremos modificar la apariencia de como se muestra este pie de pÃ¡gina para por ejemplo centrar el texto? Esto lo conseguiremos editando la informaciÃ³n relativa a los estilos de la pÃ¡gina (CSS). Las hojas de estilos de las aplicaciones en Grails se encuentran en el directorio <em>grails-app/assets/stylesheets/</em>, y concretamente tenemos un archivo llamado <em>main.css</em>. Lo que vamos a hacer a continuaciÃ³n es modificar la clase correspondiente al pie de pÃ¡gina (<em>.footer</em>). Abrimos la hoja de estilos <em>main.css</em> y localizamos la clase <em>.footer</em> para dejarla de la siguiente forma.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="css"><span class="tok-nc">.footer</span> <span class="tok-p">{</span>
    <span class="tok-k">background</span><span class="tok-o">:</span> <span class="tok-m">#abbf78</span><span class="tok-p">;</span>
    <span class="tok-k">color</span><span class="tok-o">:</span> <span class="tok-m">#000</span><span class="tok-p">;</span>
    <span class="tok-k">clear</span><span class="tok-o">:</span> <span class="tok-k">both</span><span class="tok-p">;</span>
    <span class="tok-k">font-size</span><span class="tok-o">:</span> <span class="tok-m">0.8em</span><span class="tok-p">;</span>
    <span class="tok-k">margin-top</span><span class="tok-o">:</span> <span class="tok-m">1.5em</span><span class="tok-p">;</span>
    <span class="tok-k">padding</span><span class="tok-o">:</span> <span class="tok-m">1em</span><span class="tok-p">;</span>
    <span class="tok-k">min-height</span><span class="tok-o">:</span> <span class="tok-m">1em</span><span class="tok-p">;</span>
    <span class="tok-k">text-align</span><span class="tok-o">:</span><span class="tok-k">center</span><span class="tok-p">;</span>
<span class="tok-p">}</span></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_plantilla_de_encabezado">4.2.2. Plantilla de encabezado</h4>
<div class="paragraph">
<p>La primera plantilla que hemos creado no nos ha supuesto mucha complicaciÃ³n y era muy sencilla de implementar, pero al menos nos ha servido como introducciÃ³n al sistema de plantillas de Grails y a comprender como se renderizan estas plantillas en el sistema. La segunda plantilla que vamos a implementar nos va a complicar algo mÃ¡s la vida.</p>
</div>
<div class="paragraph">
<p>Aunque nuestra aplicaciÃ³n todavÃ­a no tiene el concepto de usuario (es algo que aÃ±adiremos en la sesiÃ³n 7), esta plantilla serÃ¡ la encargada de mostrar un enlace indicando la palabra <em>login</em> para que cuando los futuros usuarios hagan clic sobre ella, aparezca un formulario donde el usuario podrÃ¡ identificarse en el sistema. Ahora bien, Â¿quÃ© pasa si el usuario ya se ha identificado? Pues lo que se hace habitualmente es modificar esa primera lÃ­nea para que en lugar de mostrar un enlace con la palabra <em>login</em>, se muestre una lÃ­nea con el nombre completo del usuario en cuestiÃ³n y un enlace para que abandone el sistema de forma segura. Eso es lo que vamos a hacer con esta segunda plantilla.</p>
</div>
<div class="paragraph">
<p>En primer lugar, vamos a modificar el archivo <em>grails-app/views/layout/main.gsp</em> para que en la parte superior de la aplicaciÃ³n, aparezca un encabezado que definiremos posteriormente. El archivo <em>main.gsp</em> quedarÃ­a asÃ­:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="html">...
<span class="tok-nt">&lt;body&gt;</span>
<span class="tok-nt">&lt;g:render</span> <span class="tok-na">template=</span><span class="tok-s">&quot;/common/header&quot;</span><span class="tok-nt">/&gt;</span>
<span class="tok-nt">&lt;div</span> <span class="tok-na">id=</span><span class="tok-s">&quot;grailsLogo&quot;</span> <span class="tok-na">role=</span><span class="tok-s">&quot;banner&quot;</span><span class="tok-nt">&gt;</span>
    <span class="tok-nt">&lt;a</span> <span class="tok-na">href=</span><span class="tok-s">&quot;http://grails.org&quot;</span><span class="tok-nt">&gt;</span>
        <span class="tok-nt">&lt;img</span> <span class="tok-na">src=</span><span class="tok-s">&quot;${resource(dir: &#39;images&#39;, file: &#39;grails_logo.png&#39;)}&quot;</span> <span class="tok-na">alt=</span><span class="tok-s">&quot;Grails&quot;</span><span class="tok-nt">/&gt;</span>
    <span class="tok-nt">&lt;/a&gt;</span>
<span class="tok-nt">&lt;/div&gt;</span>
<span class="tok-nt">&lt;g:layoutBody/&gt;</span>
<span class="tok-nt">&lt;g:render</span> <span class="tok-na">template=</span><span class="tok-s">&quot;/common/footer&quot;</span><span class="tok-nt">/&gt;</span>
...</code></pre>
</div>
</div>
<div class="paragraph">
<p>Si intentas actualizar ahora la aplicaciÃ³n, verÃ¡s como Grails nos devuelve un error y esto es debido a que todavÃ­a no hemos creado la correspondiente plantilla <em>_header.gsp</em>, asÃ­ que antes de continuar vamos a crearla en el directorio <em>grails-app/views/common/</em>, puesto que es una plantilla que se utilizarÃ¡ a lo largo de toda la aplicaciÃ³n independientemente de la clase que estemos utilizando en cada momento. Vamos a ver el contenido de esta nueva plantilla y luego lo comentamos mÃ¡s ampliamente.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="html"><span class="tok-nt">&lt;div</span> <span class="tok-na">id=</span><span class="tok-s">&quot;menu&quot;</span><span class="tok-nt">&gt;</span>
    <span class="tok-nt">&lt;nobr&gt;</span>
        <span class="tok-nt">&lt;g:if</span> <span class="tok-na">test=</span><span class="tok-s">&quot;${isUserLoggedIn}&quot;</span><span class="tok-nt">&gt;</span>
            <span class="tok-nt">&lt;b&gt;</span>${userInstance?.name} ${userInstance?.surnames}<span class="tok-nt">&lt;/b&gt;</span> |
            <span class="tok-nt">&lt;g:link</span> <span class="tok-na">controller=</span><span class="tok-s">&quot;user&quot;</span> <span class="tok-na">action=</span><span class="tok-s">&quot;logout&quot;</span><span class="tok-nt">&gt;</span>Logout<span class="tok-nt">&lt;/g:link&gt;</span>
        <span class="tok-nt">&lt;/g:if&gt;</span>
        <span class="tok-nt">&lt;g:else&gt;</span>
            <span class="tok-nt">&lt;g:link</span> <span class="tok-na">controller=</span><span class="tok-s">&quot;user&quot;</span> <span class="tok-na">action=</span><span class="tok-s">&quot;login&quot;</span><span class="tok-nt">&gt;</span>Login<span class="tok-nt">&lt;/g:link&gt;</span>
        <span class="tok-nt">&lt;/g:else&gt;</span>
    <span class="tok-nt">&lt;/nobr&gt;</span>
<span class="tok-nt">&lt;/div&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Si actualizamos ahora la aplicaciÃ³n en el navegador, veremos como el enlace con la palabra <em>Login</em> queda a la izquierda, lo que no es lo habitual en las aplicaciones web, donde suele aparecer casi siempre en la parte superior derecha de la pantalla. Para solucionar esto, volvemos a editar los estilos de nuestra aplicaciÃ³n y le aÃ±adimos las siguientes entradas:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="css"><span class="tok-nf">#header</span> <span class="tok-p">{</span>
    <span class="tok-k">text-align</span><span class="tok-o">:</span><span class="tok-k">left</span><span class="tok-p">;</span>
    <span class="tok-k">margin</span><span class="tok-o">:</span> <span class="tok-m">0px</span><span class="tok-p">;</span>
    <span class="tok-k">padding</span><span class="tok-o">:</span> <span class="tok-m">0</span><span class="tok-p">;</span>
<span class="tok-p">}</span>

<span class="tok-nf">#header</span> <span class="tok-nf">#menu</span><span class="tok-p">{</span>
    <span class="tok-k">float</span><span class="tok-o">:</span> <span class="tok-k">right</span><span class="tok-p">;</span>
    <span class="tok-k">width</span><span class="tok-o">:</span> <span class="tok-m">240px</span><span class="tok-p">;</span>
    <span class="tok-k">text-align</span><span class="tok-o">:</span><span class="tok-k">right</span><span class="tok-p">;</span>
    <span class="tok-k">font-size</span><span class="tok-o">:</span><span class="tok-m">12px</span><span class="tok-p">;</span>
    <span class="tok-k">padding</span><span class="tok-o">:</span><span class="tok-m">4px</span><span class="tok-p">;</span>
<span class="tok-p">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Ya tenemos alineado a la derecha el texto con la palabra <em>Login</em>, que ademÃ¡s, aparecerÃ¡ en cualquier pÃ¡gina de la aplicaciÃ³n. Antes de continuar, vamos a explicar el contenido del archivo <em>grails-app/views/common/_header.gsp</em>. Podemos comprobar como se hace una comprobaciÃ³n para saber si el usuario actual se ha identificado o no en nuestro sistema. Para realizar esta comprobaciÃ³n utilizamos la etiqueta <em>&lt;g:if&gt;</em>, a la que se le pasa el parÃ¡metro <em>test</em> con la variable <em>${isUserLoggedIn}</em> (variable que todavÃ­a no existe). En caso de que esta variable estÃ© ya definida (el usuario ya se ha identificado en el sistema), se mostrarÃ¡ su nombre y apellidos seguido de un enlace para que abandone la aplicaciÃ³n de forma segura. En caso contrario, se le mostrarÃ¡ un enlace con la palabra <em>Login</em> para que se identifique. En ambos casos, se utiliza la etiqueta <em>&lt;g:link&gt;</em> que permite crear enlaces que apunten a una determinada acciÃ³n de un controlador, tal y como veremos mÃ¡s adelante.</p>
</div>
<div class="paragraph">
<p>Si ahora hacemos clic sobre <em>Login</em>, veremos como Grails nos devuelve un error del tipo 404, puesto que no hemos definido nada para que la aplicaciÃ³n actÃºe en consecuencia. Lo dejaremos asÃ­ hasta que nuestra aplicaciÃ³n soporte usuarios que veremos en la sesiÃ³n de Spring Security.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_pÃ¡ginas">4.3. PÃ¡ginas</h3>
<div class="paragraph">
<p>Las pÃ¡ginas en Grails podemos definirlas como aquellos archivos de la interfaz de usuario que se pintarÃ¡n a partir de una llamada realizada desde un controlador. Por ejemplo, si nuestra aplicaciÃ³n necesita una secciÃ³n con las preguntas mÃ¡s frecuentes de la aplicaciÃ³n, podrÃ­amos crear una vista llamada <em>faqs.gsp</em> que se encargue de esto. AdemÃ¡s, como esta vista no va a pertenecer a ninguna clase de dominio en cuestiÃ³n sino que serÃ¡ comÃºn a toda la aplicaciÃ³n, la ubicaremos en el directorio <em>/grails-app/views/common</em>. MÃ¡s adelante crearemos un controlador que se encargarÃ¡ de pintar las preguntas mÃ¡s frecuentes de nuestra aplicaciÃ³n.</p>
</div>
<div class="paragraph">
<p>Aunque ya te habrÃ¡s dado cuenta, a diferencia de las plantillas, las vistas no deben utilizar un subrayado bajo al inicio del nombre pero tambiÃ©n deben tener extensiÃ³n GSP.</p>
</div>
<div class="sect3">
<h4 id="_variables_y_alcance_de_las_mismas_en_pÃ¡ginas">4.3.1. Variables y alcance de las mismas en pÃ¡ginas</h4>
<div class="paragraph">
<p>En GSP podemos utilizar podemos utilizar los sÃ­mbolos <em>&lt;%  %&gt;</em> de la siguiente forma</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-o">&lt;%</span> <span class="tok-n">now</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">Date</span><span class="tok-o">()</span> <span class="tok-o">%&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Y de forma similar podemos acceder a esa variables con</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-o">&lt;%=</span> <span class="tok-n">now</span> <span class="tok-o">%&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Dentro del alcance de una pÃ¡gina GSP, tendremos a nuestra disposiciÃ³n una serie de variables predefinidas, que son:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>application - Instancia de <a href="http://docs.oracle.com/javaee/7/api/javax/servlet/ServletContext.html">javax.servlet.ServletContext</a></p>
</li>
<li>
<p>applicationContext - Instancia de Spring ApplicationContext</p>
</li>
<li>
<p>flash - El objecto flash que veremos mÃ¡s adelante en la secciÃ³n de los controladores</p>
</li>
<li>
<p>grailsApplication - Instancia de GrailsApplication</p>
</li>
<li>
<p>out - Un response writer para escribir la salida</p>
</li>
<li>
<p>params - Los parÃ¡metros pasados en la peticiÃ³n</p>
</li>
<li>
<p>request - Instnaica de <a href="http://docs.oracle.com/javaee/7/api/javax/servlet/http/HttpServletRequest.html">HttpServletRequest</a></p>
</li>
<li>
<p>response - Instancia de <a href="http://docs.oracle.com/javaee/7/api/javax/servlet/http/HttpServletResponse.html">HttpServletResponse</a></p>
</li>
<li>
<p>session - Instancia de <a href="http://docs.oracle.com/javaee/7/api/javax/servlet/http/HttpSession.html">HttpSession</a></p>
</li>
<li>
<p>webRequest - Instancia de <a href="http://grails.org/doc/latest/api/org/codehaus/groovy/grails/web/servlet/mvc/GrailsWebRequest.html">GrailsWebRequest</a></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Utilizando los sÃ­mbolos &lt;% y %&gt; vamos a poder realizar bucles:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-o">&lt;</span><span class="tok-n">html</span><span class="tok-o">&gt;</span>
   <span class="tok-o">&lt;</span><span class="tok-n">body</span><span class="tok-o">&gt;</span>
      <span class="tok-o">&lt;%</span> <span class="tok-o">[</span><span class="tok-mi">1</span><span class="tok-o">,</span><span class="tok-mi">2</span><span class="tok-o">,</span><span class="tok-mi">3</span><span class="tok-o">,</span><span class="tok-mi">4</span><span class="tok-o">].</span><span class="tok-na">each</span> <span class="tok-o">{</span> <span class="tok-n">num</span> <span class="tok-o">-&gt;</span> <span class="tok-o">%&gt;</span>
         <span class="tok-o">&lt;</span><span class="tok-n">p</span><span class="tok-o">&gt;&lt;%=</span><span class="tok-s2">&quot;Hello ${num}!&quot;</span> <span class="tok-o">%&gt;&lt;</span><span class="tok-s">/p&gt;</span>
<span class="tok-s">      &lt;%}%&gt;</span>
<span class="tok-s">   &lt;/</span><span class="tok-n">body</span><span class="tok-o">&gt;</span>
<span class="tok-o">&lt;/</span><span class="tok-n">html</span><span class="tok-o">&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>asÃ­ como comprobaciÃ³nes lÃ³gicas:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-o">&lt;</span><span class="tok-n">html</span><span class="tok-o">&gt;</span>
   <span class="tok-o">&lt;</span><span class="tok-n">body</span><span class="tok-o">&gt;</span>
      <span class="tok-o">&lt;%</span> <span class="tok-k">if</span> <span class="tok-o">(</span><span class="tok-n">params</span><span class="tok-o">.</span><span class="tok-na">hello</span> <span class="tok-o">==</span> <span class="tok-s1">&#39;true&#39;</span><span class="tok-o">)%&gt;</span>
      <span class="tok-o">&lt;%=</span><span class="tok-s2">&quot;Hello!&quot;</span><span class="tok-o">%&gt;</span>
      <span class="tok-o">&lt;%</span> <span class="tok-k">else</span> <span class="tok-o">%&gt;</span>
      <span class="tok-o">&lt;%=</span><span class="tok-s2">&quot;Goodbye!&quot;</span><span class="tok-o">%&gt;</span>
   <span class="tok-o">&lt;</span><span class="tok-s">/body&gt;</span>
<span class="tok-s">&lt;/</span><span class="tok-n">html</span><span class="tok-o">&gt;</span></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_directivas_de_pÃ¡ginas">4.3.2. Directivas de pÃ¡ginas</h4>
<div class="paragraph">
<p>Las pÃ¡ginas GSP soportan ademÃ¡s algunas directivas tÃ­picas de las JSP tales como <em>importar clases</em>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-o">&lt;%</span><span class="tok-err">@</span> <span class="tok-n">page</span> <span class="tok-n">import</span><span class="tok-o">=</span><span class="tok-s2">&quot;java.awt.*&quot;</span> <span class="tok-o">%&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>o incluso las directivas para especificar el tipo de contenido de la pÃ¡gina visualizada:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-o">&lt;%</span><span class="tok-err">@</span> <span class="tok-n">page</span> <span class="tok-n">contentType</span><span class="tok-o">=</span><span class="tok-s2">&quot;text/json&quot;</span> <span class="tok-o">%&gt;</span></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_expresiones">4.3.3. Expresiones</h4>
<div class="paragraph">
<p>La sintaxis vista en el punto anterior que utiliza los sÃ­mbolos &lt;% y %&gt; sin embargo no es tan utilizada debido a la existencia de las expresiones GSP, que son similares a las expresiones JSP EL y tienen la forma <em>${expresion}</em>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-o">&lt;</span><span class="tok-n">html</span><span class="tok-o">&gt;</span>
  <span class="tok-o">&lt;</span><span class="tok-n">body</span><span class="tok-o">&gt;</span>
    <span class="tok-n">Hello</span> <span class="tok-n">$</span><span class="tok-o">{</span><span class="tok-n">params</span><span class="tok-o">.</span><span class="tok-na">name</span><span class="tok-o">}</span>
  <span class="tok-o">&lt;</span><span class="tok-s">/body&gt;</span>
<span class="tok-s">&lt;/</span><span class="tok-n">html</span><span class="tok-o">&gt;</span></code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_etiquetas">4.4. Etiquetas</h3>
<div class="paragraph">
<p>En los ejemplos que hemos visto hasta el momento, han aparecido algunas de las etiquetas mÃ¡s utilizadas en Grails. Sin embargo, son muchas mÃ¡s las disponibles y a continuaciÃ³n vamos a ver algunas de ellas. El nÃºmero de etiquetas de Grails crece continuamente gracias al aporte de la cada vez mayor comunidad de usuarios con sus plugins. A continuaciÃ³n vamos a ver aquellas etiquetas que vienen con el <em>core</em> de Grails.</p>
</div>
<div class="sect3">
<h4 id="_etiquetas_lÃ³gicas">4.4.1. Etiquetas lÃ³gicas</h4>
<div class="paragraph">
<p>Estas etiquetas nos permitirÃ¡n realizar comprobaciones del tipo <em>si-entonces-sino</em>.</p>
</div>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 33%;">
<col style="width: 33%;">
<col style="width: 33%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Etiqueta</th>
<th class="tableblock halign-left valign-top">DescripciÃ³n</th>
<th class="tableblock halign-left valign-top">API</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">&lt;g:if&gt;</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">EvalÃºa una expresiÃ³n y actÃºa en consecuencia</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="http://www.grails.org/doc/latest/ref/Tags/if.html" class="bare">http://www.grails.org/doc/latest/ref/Tags/if.html</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">&lt;g:else&gt;</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">La parte <em>else</em> del bloque <em>if</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="http://www.grails.org/doc/latest/ref/Tags/else.html" class="bare">http://www.grails.org/doc/latest/ref/Tags/else.html</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">&lt;g:elseif&gt;</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">La parte <em>elseif</em> del bloque <em>if</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="http://www.grails.org/doc/latest/ref/Tags/elseif.html" class="bare">http://www.grails.org/doc/latest/ref/Tags/elseif.html</a></p></td>
</tr>
</tbody>
</table>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="html"><span class="tok-nt">&lt;g:if</span> <span class="tok-na">test=</span><span class="tok-s">&quot;${userInstance?.type == &#39;admin&#39;}&quot;</span><span class="tok-nt">&gt;</span>
   <span class="tok-err">&lt;</span>%-- mostrar funciones de administrador --%&gt;
<span class="tok-nt">&lt;/g:if&gt;</span>
<span class="tok-nt">&lt;g:else&gt;</span>
   <span class="tok-err">&lt;</span>%-- mostrar funciones bÃ¡sicas --%&gt;
<span class="tok-nt">&lt;/g:else&gt;</span></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_etiquetas_de_iteraciÃ³n">4.4.2. Etiquetas de iteraciÃ³n</h4>
<div class="paragraph">
<p>Son utilizadas para iterar a travÃ©s de colecciones de datos o hasta que una determinada condiciÃ³n se evalÃºe a falso.</p>
</div>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 33%;">
<col style="width: 33%;">
<col style="width: 33%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Etiqueta</th>
<th class="tableblock halign-left valign-top">DescripciÃ³n</th>
<th class="tableblock halign-left valign-top">API</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">&lt;g:while&gt;</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Ejecuta un bloque de cÃ³digo mientras una condiciÃ³n se evalÃºe a cierto</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="http://www.grails.org/doc/latest/ref/Tags/while.html" class="bare">http://www.grails.org/doc/latest/ref/Tags/while.html</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">&lt;g:each&gt;</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Itera sobre una colecciÃ³n de objetos</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="http://www.grails.org/doc/latest/ref/Tags/each.html" class="bare">http://www.grails.org/doc/latest/ref/Tags/each.html</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">&lt;g:collect&gt;</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Itera sobre una colecciÃ³n y transforma los resultados tal y como se defina en el parÃ¡metro <em>expr</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="http://www.grails.org/doc/latest/ref/Tags/collect.html" class="bare">http://www.grails.org/doc/latest/ref/Tags/collect.html</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">&lt;g:findAll&gt;</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Itera sobre una colecciÃ³n donde los elementos se corresponden con la expresiÃ³n GPath definida en el parÃ¡metro <em>expr</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="http://www.grails.org/doc/latest/ref/Tags/findAll.html" class="bare">http://www.grails.org/doc/latest/ref/Tags/findAll.html</a></p></td>
</tr>
</tbody>
</table>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-o">&lt;</span><span class="tok-nl">g:</span><span class="tok-n">set</span> <span class="tok-n">var</span><span class="tok-o">=</span><span class="tok-s2">&quot;num&quot;</span> <span class="tok-n">value</span><span class="tok-o">=</span><span class="tok-s2">&quot;${1}&quot;</span> <span class="tok-s">/&gt;</span>
<span class="tok-s">&lt;g:while test=&quot;${num &lt; 5 }&quot;&gt;</span>
<span class="tok-s">    &lt;p&gt;Number ${num++}</span>
<span class="tok-s">&lt;/</span><span class="tok-nl">g:</span><span class="tok-k">while</span><span class="tok-o">&gt;</span>

<span class="tok-cm">/*************************************/</span>

<span class="tok-o">&lt;</span><span class="tok-nl">g:</span><span class="tok-n">each</span> <span class="tok-k">in</span><span class="tok-o">=</span><span class="tok-s2">&quot;${[1,2,3]}&quot;</span> <span class="tok-n">var</span><span class="tok-o">=</span><span class="tok-s2">&quot;num&quot;</span><span class="tok-o">&gt;</span>
   <span class="tok-o">&lt;</span><span class="tok-n">p</span><span class="tok-o">&gt;</span><span class="tok-n">Number</span> <span class="tok-n">$</span><span class="tok-o">{</span><span class="tok-n">num</span><span class="tok-o">}&lt;</span><span class="tok-s">/p&gt;</span>
<span class="tok-s">&lt;/</span><span class="tok-nl">g:</span><span class="tok-n">each</span><span class="tok-o">&gt;</span>

<span class="tok-cm">/*************************************/</span>
<span class="tok-n">Stephen</span> <span class="tok-n">King</span><span class="tok-s1">&#39;s Books:</span>
<span class="tok-s1">&lt;g:findAll in=&quot;${books}&quot; expr=&quot;it.author == &#39;</span><span class="tok-n">Stephen</span> <span class="tok-n">King</span><span class="tok-err">&#39;&quot;</span><span class="tok-o">&gt;</span>
     <span class="tok-o">&lt;</span><span class="tok-n">p</span><span class="tok-o">&gt;</span><span class="tok-nl">Title:</span> <span class="tok-n">$</span><span class="tok-o">{</span><span class="tok-n">it</span><span class="tok-o">.</span><span class="tok-na">title</span><span class="tok-o">}</span>
<span class="tok-o">&lt;/</span><span class="tok-nl">g:</span><span class="tok-n">findAll</span><span class="tok-o">&gt;</span></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_etiquetas_de_asignaciÃ³n">4.4.3. Etiquetas de asignaciÃ³n</h4>
<div class="paragraph">
<p>Nos servirÃ¡n para asignar valores a variables.</p>
</div>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 33%;">
<col style="width: 33%;">
<col style="width: 33%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Etiqueta</th>
<th class="tableblock halign-left valign-top">DescripciÃ³n</th>
<th class="tableblock halign-left valign-top">API</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">&lt;g:set&gt;</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Define y establece el valor de una variable utilizada en una pÃ¡gina GSP</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="http://www.grails.org/doc/latest/ref/Tags/set.html" class="bare">http://www.grails.org/doc/latest/ref/Tags/set.html</a></p></td>
</tr>
</tbody>
</table>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-o">&lt;</span><span class="tok-nl">g:</span><span class="tok-n">set</span> <span class="tok-n">var</span><span class="tok-o">=</span><span class="tok-s2">&quot;now&quot;</span> <span class="tok-n">value</span><span class="tok-o">=</span><span class="tok-s2">&quot;${new Date()}&quot;</span> <span class="tok-s">/&gt;</span>

<span class="tok-s">/</span><span class="tok-o">*************************************</span><span class="tok-s">/</span>
<span class="tok-s">&lt;g:set var=&quot;myHTML&quot;&gt;</span>
<span class="tok-s">   Some re-usable code on: ${new Date()}</span>
<span class="tok-s">&lt;/</span><span class="tok-nl">g:</span><span class="tok-n">set</span><span class="tok-o">&gt;</span>

<span class="tok-cm">/*************************************/</span>
<span class="tok-o">&lt;</span><span class="tok-nl">g:</span><span class="tok-n">set</span> <span class="tok-n">var</span><span class="tok-o">=</span><span class="tok-s2">&quot;now&quot;</span> <span class="tok-n">value</span><span class="tok-o">=</span><span class="tok-s2">&quot;${new Date()}&quot;</span> <span class="tok-n">scope</span><span class="tok-o">=</span><span class="tok-s2">&quot;request&quot;</span> <span class="tok-o">/&gt;</span></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_etiquetas_de_enlaces">4.4.4. Etiquetas de enlaces</h4>
<div class="paragraph">
<p>Crean enlaces a partir de los parÃ¡metros pasados.</p>
</div>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 33%;">
<col style="width: 33%;">
<col style="width: 33%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Etiqueta</th>
<th class="tableblock halign-left valign-top">DescripciÃ³n</th>
<th class="tableblock halign-left valign-top">API</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">&lt;g:link&gt;</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Crea un enlace HTML utilizando los parÃ¡metros pasados</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="http://www.grails.org/doc/latest/ref/Tags/link.html" class="bare">http://www.grails.org/doc/latest/ref/Tags/link.html</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">&lt;g:createLink&gt;</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Crea un enlace HTML que puede ser utilizado dentro de otras etiquetas</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="http://www.grails.org/doc/latest/ref/Tags/createLink.html" class="bare">http://www.grails.org/doc/latest/ref/Tags/createLink.html</a></p></td>
</tr>
</tbody>
</table>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="html"><span class="tok-nt">&lt;g:link</span> <span class="tok-na">action=</span><span class="tok-s">&quot;show&quot;</span> <span class="tok-na">id=</span><span class="tok-s">&quot;1&quot;</span><span class="tok-nt">&gt;</span>Book 1<span class="tok-nt">&lt;/g:link&gt;</span>
<span class="tok-nt">&lt;g:link</span> <span class="tok-na">action=</span><span class="tok-s">&quot;show&quot;</span> <span class="tok-na">id=</span><span class="tok-s">&quot;${currentBook.id}&quot;</span><span class="tok-nt">&gt;</span>${currentBook.name}<span class="tok-nt">&lt;/g:link&gt;</span>
<span class="tok-nt">&lt;g:link</span> <span class="tok-na">controller=</span><span class="tok-s">&quot;book&quot;</span><span class="tok-nt">&gt;</span>Book Home<span class="tok-nt">&lt;/g:link&gt;</span>
<span class="tok-nt">&lt;g:link</span> <span class="tok-na">controller=</span><span class="tok-s">&quot;book&quot;</span> <span class="tok-na">action=</span><span class="tok-s">&quot;list&quot;</span><span class="tok-nt">&gt;</span>Book List<span class="tok-nt">&lt;/g:link&gt;</span>
<span class="tok-nt">&lt;g:link</span> <span class="tok-na">url=</span><span class="tok-s">&quot;[action: &#39;list&#39;, controller: &#39;book&#39;]&quot;</span><span class="tok-nt">&gt;</span>Book List<span class="tok-nt">&lt;/g:link&gt;</span>
<span class="tok-nt">&lt;g:link</span> <span class="tok-na">params=</span><span class="tok-s">&quot;[sort: &#39;title&#39;, order: &#39;asc&#39;, author: currentBook.author]&quot;</span> <span class="tok-na">action=</span><span class="tok-s">&quot;list&quot;</span><span class="tok-nt">&gt;</span>
    Book List
<span class="tok-nt">&lt;/g:link&gt;</span></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_etiquetas_de_formularios">4.4.5. Etiquetas de formularios</h4>
<div class="paragraph">
<p>Las utilizaremos para crear nuestros propios formularios HTML.</p>
</div>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 33%;">
<col style="width: 33%;">
<col style="width: 33%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Etiqueta</th>
<th class="tableblock halign-left valign-top">DescripciÃ³n</th>
<th class="tableblock halign-left valign-top">API</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">&lt;g:actionSubmit&gt;</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Crea un botÃ³n de tipo <em>submit</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="http://www.grails.org/doc/latest/ref/Tags/actionSubmit.html" class="bare">http://www.grails.org/doc/latest/ref/Tags/actionSubmit.html</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">&lt;g:actionSubmitImage&gt;</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Crea un botÃ³n de tipo <em>submit</em> con una imagen</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="http://www.grails.org/doc/latest/ref/Tags/actionSubmitImage.html" class="bare">http://www.grails.org/doc/latest/ref/Tags/actionSubmitImage.html</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">&lt;g:checkBox&gt;</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Crea un elemento de formulario de tipo checkbox</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="http://www.grails.org/doc/latest/ref/Tags/checkBox.html" class="bare">http://www.grails.org/doc/latest/ref/Tags/checkBox.html</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">&lt;g:currencySelect&gt;</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Crea un campo de tipo <em>select</em> con un listado de monedas</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="http://www.grails.org/doc/latest/ref/Tags/currencySelect.html" class="bare">http://www.grails.org/doc/latest/ref/Tags/currencySelect.html</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">&lt;g:datePicker&gt;</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Crea un elemento de formulario para seleccionar una fecha con dÃ­a, mes, aÃ±o, hora, minutos y segundos</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="http://www.grails.org/doc/latest/ref/Tags/datePicker.html" class="bare">http://www.grails.org/doc/latest/ref/Tags/datePicker.html</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">&lt;g:form&gt;</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Crea un formulario</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="http://www.grails.org/doc/latest/ref/Tags/form.html" class="bare">http://www.grails.org/doc/latest/ref/Tags/form.html</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">&lt;g:hiddenField&gt;</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Crea un campo oculto</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="http://www.grails.org/doc/latest/ref/Tags/hiddenField.html" class="bare">http://www.grails.org/doc/latest/ref/Tags/hiddenField.html</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">&lt;g:localeSelect&gt;</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Crea un elemento de formulario de tipo <em>select</em> con un listado de posibles localizaciones</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="http://www.grails.org/doc/latest/ref/Tags/localeSelect.html" class="bare">http://www.grails.org/doc/latest/ref/Tags/localeSelect.html</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">&lt;g:radio&gt;</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Crea un elemento de formulario de tipo radio</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="http://www.grails.org/doc/latest/ref/Tags/radio.html" class="bare">http://www.grails.org/doc/latest/ref/Tags/radio.html</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">&lt;g:radioGroup&gt;</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Crea un grupo de elementos de formulario de tipo radio</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="http://www.grails.org/doc/latest/ref/Tags/radioGroup.html" class="bare">http://www.grails.org/doc/latest/ref/Tags/radioGroup.html</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">&lt;g:select&gt;</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Crea un elemento de formulario de tipo <em>select combo box</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="http://www.grails.org/doc/latest/ref/Tags/select.html" class="bare">http://www.grails.org/doc/latest/ref/Tags/select.html</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">&lt;g:textField&gt;</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Crea un elemento de formulario de tipo <em>text</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="http://www.grails.org/doc/latest/ref/Tags/textField.html" class="bare">http://www.grails.org/doc/latest/ref/Tags/textField.html</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">&lt;g:passwordField&gt;</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Crea un elemento de formulario de tipo <em>password</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="http://www.grails.org/doc/latest/ref/Tags/passwordField.html" class="bare">http://www.grails.org/doc/latest/ref/Tags/passwordField.html</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">&lt;g:textArea&gt;</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Crea un elemento de formulario de tipo <em>textarea</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="http://www.grails.org/doc/latest/ref/Tags/textArea.html" class="bare">http://www.grails.org/doc/latest/ref/Tags/textArea.html</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">&lt;g:timeZoneSelect&gt;</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Crea un elemento de formulario de tipo <em>select</em> con un listado de zonas horarias</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="http://www.grails.org/doc/latest/ref/Tags/timeZoneSelect.html" class="bare">http://www.grails.org/doc/latest/ref/Tags/timeZoneSelect.html</a></p></td>
</tr>
</tbody>
</table>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-o">&lt;</span><span class="tok-nl">g:</span><span class="tok-n">form</span> <span class="tok-n">name</span><span class="tok-o">=</span><span class="tok-s2">&quot;myForm&quot;</span> <span class="tok-n">url</span><span class="tok-o">=</span><span class="tok-s2">&quot;[controller:&#39;book&#39;,action:&#39;list&#39;]&quot;</span><span class="tok-o">&gt;...&lt;</span><span class="tok-s">/g:form&gt;</span>

<span class="tok-s">/</span><span class="tok-o">*************************************</span><span class="tok-s">/</span>
<span class="tok-s">&lt;g:textField name=&quot;myField&quot; value=&quot;${myValue}&quot; /</span><span class="tok-o">&gt;</span>

<span class="tok-cm">/*************************************/</span>
<span class="tok-o">&lt;</span><span class="tok-nl">g:</span><span class="tok-n">actionSubmit</span> <span class="tok-n">value</span><span class="tok-o">=</span><span class="tok-s2">&quot;Some update label&quot;</span> <span class="tok-n">action</span><span class="tok-o">=</span><span class="tok-s2">&quot;update&quot;</span> <span class="tok-o">/&gt;</span></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_etiquetas_de_renderizado">4.4.6. Etiquetas de renderizado</h4>
<div class="paragraph">
<p>Permite renderizar las pÃ¡ginas web de nuestras aplicaciones utilizando las plantillas.</p>
</div>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 33%;">
<col style="width: 33%;">
<col style="width: 33%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Etiqueta</th>
<th class="tableblock halign-left valign-top">DescripciÃ³n</th>
<th class="tableblock halign-left valign-top">API</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">&lt;g:applyLayout&gt;</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Aplica un determinado diseÃ±o a una pÃ¡gina o una plantilla</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="http://www.grails.org/doc/latest/ref/Tags/applyLayout.html" class="bare">http://www.grails.org/doc/latest/ref/Tags/applyLayout.html</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">&lt;g:formatDate&gt;</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Aplica el formato <em>SimpleDateFormat</em> a una fecha</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="http://www.grails.org/doc/latest/ref/Tags/formatDate.html" class="bare">http://www.grails.org/doc/latest/ref/Tags/formatDate.html</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">&lt;g:formatNumber&gt;</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Aplica el formato <em>DecimalFormat</em> a un nÃºmero</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="http://www.grails.org/doc/latest/ref/Tags/formatNumber.html" class="bare">http://www.grails.org/doc/latest/ref/Tags/formatNumber.html</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">&lt;g:layoutHead&gt;</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Muestra una determinada cabecera para una pÃ¡gina</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="http://www.grails.org/doc/latest/ref/Tags/layoutHead.html" class="bare">http://www.grails.org/doc/latest/ref/Tags/layoutHead.html</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">&lt;g:layoutBody&gt;</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Muestra un determinado contenido para una pÃ¡gina</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="http://www.grails.org/doc/latest/ref/Tags/layoutBody.html" class="bare">http://www.grails.org/doc/latest/ref/Tags/layoutBody.html</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">&lt;g:layoutTitle&gt;</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Muestra un determinado tÃ­tulo para una pÃ¡gina</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="http://www.grails.org/doc/latest/ref/Tags/layoutTitle.html" class="bare">http://www.grails.org/doc/latest/ref/Tags/layoutTitle.html</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">&lt;g:meta&gt;</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Muestra las propiedades del archivo <em>application.properties</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="http://www.grails.org/doc/latest/ref/Tags/meta.html" class="bare">http://www.grails.org/doc/latest/ref/Tags/meta.html</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">&lt;g:render&gt;</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Muestra un modelo utilizando una plantilla</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="http://www.grails.org/doc/latest/ref/Tags/render.html" class="bare">http://www.grails.org/doc/latest/ref/Tags/render.html</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">&lt;g:renderErrors&gt;</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Muestra los errores producidos en una pÃ¡gina</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="http://www.grails.org/doc/latest/ref/Tags/renderErrors.html" class="bare">http://www.grails.org/doc/latest/ref/Tags/renderErrors.html</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">&lt;g:pageProperty&gt;</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Muestra una propiedad de una pÃ¡gina</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="http://www.grails.org/doc/latest/ref/Tags/pageProperty.html" class="bare">http://www.grails.org/doc/latest/ref/Tags/pageProperty.html</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">&lt;g:paginate&gt;</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Muestra los tÃ­picos botones <em>Anterior</em> y <em>Siguiente</em> y las <em>migas de pan</em> cuando se devuelven muchos resultados</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="http://www.grails.org/doc/latest/ref/Tags/paginate.html" class="bare">http://www.grails.org/doc/latest/ref/Tags/paginate.html</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">&lt;g:sortableColumn&gt;</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Muestra una columna de una tabla con la posibilidad de ordenarla</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="http://www.grails.org/doc/latest/ref/Tags/sortableColumn.html" class="bare">http://www.grails.org/doc/latest/ref/Tags/sortableColumn.html</a></p></td>
</tr>
</tbody>
</table>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-o">&lt;</span><span class="tok-nl">g:</span><span class="tok-n">render</span> <span class="tok-n">template</span><span class="tok-o">=</span><span class="tok-s2">&quot;bookTemplate&quot;</span> <span class="tok-n">model</span><span class="tok-o">=</span><span class="tok-s2">&quot;[book: myBook]&quot;</span> <span class="tok-s">/&gt;</span>

<span class="tok-s">/</span><span class="tok-o">*************************************</span><span class="tok-s">/</span>
<span class="tok-s">&lt;g:render template=&quot;bookTemplate&quot; var=&quot;book&quot; collection=&quot;${bookList}&quot; /</span><span class="tok-o">&gt;</span>

<span class="tok-cm">/*************************************/</span>
<span class="tok-o">&lt;</span><span class="tok-n">img</span> <span class="tok-n">src</span><span class="tok-o">=</span><span class="tok-s2">&quot;&lt;g:createLinkTo dir=&quot;</span><span class="tok-n">images</span><span class="tok-s2">&quot; file=&quot;</span><span class="tok-n">logo</span><span class="tok-o">.</span><span class="tok-na">jpg</span><span class="tok-s2">&quot; /&gt;&quot;</span> <span class="tok-o">/&gt;</span></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_etiquetas_de_validaciÃ³n">4.4.7. Etiquetas de validaciÃ³n</h4>
<div class="paragraph">
<p>Se utilizan para mostrar errores y mensajes de advertencia.</p>
</div>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 33%;">
<col style="width: 33%;">
<col style="width: 33%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Etiqueta</th>
<th class="tableblock halign-left valign-top">DescripciÃ³n</th>
<th class="tableblock halign-left valign-top">API</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">&lt;g:eachError&gt;</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Itera a travÃ©s de los errores producidos en un bean o un modelo</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="http://www.grails.org/doc/latest/ref/Tags/eachError.html" class="bare">http://www.grails.org/doc/latest/ref/Tags/eachError.html</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">&lt;g:hasErrors&gt;</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Comprueba si se ha producido algÃºn error en un bean o un modelo</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="http://www.grails.org/doc/latest/ref/Tags/hasErrors.html" class="bare">http://www.grails.org/doc/latest/ref/Tags/hasErrors.html</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">&lt;g:message&gt;</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Muestra un mensaje a partir de la propiedad pasada por parÃ¡metro</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="http://www.grails.org/doc/latest/ref/Tags/message.html" class="bare">http://www.grails.org/doc/latest/ref/Tags/message.html</a></p></td>
</tr>
</tbody>
</table>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-o">&lt;</span><span class="tok-nl">g:</span><span class="tok-n">eachError</span> <span class="tok-n">bean</span><span class="tok-o">=</span><span class="tok-s2">&quot;${book}&quot;</span><span class="tok-o">&gt;</span>
    <span class="tok-o">&lt;</span><span class="tok-n">li</span><span class="tok-o">&gt;</span><span class="tok-n">$</span><span class="tok-o">{</span><span class="tok-n">it</span><span class="tok-o">}&lt;</span><span class="tok-s">/li&gt;</span>
<span class="tok-s">&lt;/</span><span class="tok-nl">g:</span><span class="tok-n">eachError</span><span class="tok-o">&gt;</span>

<span class="tok-cm">/*************************************/</span>
<span class="tok-o">&lt;</span><span class="tok-nl">g:</span><span class="tok-n">message</span> <span class="tok-n">code</span><span class="tok-o">=</span><span class="tok-s2">&quot;my.message.code&quot;</span> <span class="tok-o">/&gt;</span></code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_librerÃ­a_de_etiquetas">4.5. LibrerÃ­a de etiquetas</h3>
<div class="paragraph">
<p>Como acabamos de ver, Grails nos ofrece la posibilidad de utilizar un amplio rango de etiquetas tanto JSP como GSP, pero en ocasiones, es probable que necesitemos crear nuestras propias etiquetas. Estas etiquetas nos van a permitir realizar tareas repetitivas de forma rÃ¡pida y sencilla.</p>
</div>
<div class="paragraph">
<p>Las librerÃ­as de etiquetas no requieren ninguna tarea de configuraciÃ³n y, como casi siempre, se recargan automÃ¡ticamente sin reiniciar el servidor.</p>
</div>
<div class="paragraph">
<p>En Grails tenemos dos mÃ©todos para crear etiquetas. Por un lado mediante el comando <em>grails create-tag-lib</em> y por otro creando una nueva clase en el directorio <em>grails-app/taglib</em> cuyo nombre termine en <em>TagLib</em>. Nosotros utilizaremos como hasta ahora el comando <em>grails create-tag-lib es.ua.expertojava.todo.Todo</em>.</p>
</div>
<div class="paragraph">
<p>Este serÃ¡ el resultado de la nueva librerÃ­a de etiquetas creada:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-kn">package</span> <span class="tok-n">es</span><span class="tok-o">.</span><span class="tok-na">ua</span><span class="tok-o">.</span><span class="tok-na">expertojava</span><span class="tok-o">.</span><span class="tok-na">todo</span>

<span class="tok-kd">class</span> <span class="tok-nc">TodoTagLib</span> <span class="tok-o">{</span>
    <span class="tok-kd">static</span> <span class="tok-n">defaultEncodeAs</span> <span class="tok-o">=</span> <span class="tok-o">[</span><span class="tok-nl">taglib:</span><span class="tok-s1">&#39;html&#39;</span><span class="tok-o">]</span>
    <span class="tok-c1">//static encodeAsForTags = [tagName: [taglib:&#39;html&#39;], otherTagName: [taglib:&#39;none&#39;]]</span>
<span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Las dos propiedades estÃ¡ticas creadas nos servirÃ¡n para indicar de forma global o por etiqueta como queremos renderizarlas. Por ejemplo, con <em>static defaultEncodeAs = [taglib:'html']</em> estamos indicando que cuando la etiqueta imprima el sÃ­mbolo <em>&lt;</em> o <em>&gt;</em> lo harÃ¡ por su correspondiente entidad, Ã©sto es, &amp;lt; o &amp;gt;.</p>
</div>
<div class="paragraph">
<p>AdemÃ¡s de definirlo de forma global, tambiÃ©n vamos a poder especificarlo por etiqueta utilizando la variable <em>encodeAsForTags</em> y por supuesto modificando las claves utilizadas en el ejemplo por los nombres de nuestras etiquetas.</p>
</div>
<div class="paragraph">
<p>En nuestros ejemplos, vamos a tener que modificar la variable <em>defaultEncodeAs</em> por el siguiente valor: <em>[taglib:'html']</em>.</p>
</div>
<div class="sect3">
<h4 id="_etiquetas_simples">4.5.1. Etiquetas simples</h4>
<div class="paragraph">
<p>El primer ejemplo de etiqueta que vamos a crear serÃ¡ una etiqueta que permita la inclusiÃ³n de archivos de funciones javascript en el cÃ³digo de nuestras pÃ¡ginas GSPs. Para ello definimos un mÃ©todo en la nueva clase <em>TodoTagLib</em> con el siguiente contenido:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-kt">def</span> <span class="tok-n">includeJs</span> <span class="tok-o">=</span> <span class="tok-o">{</span><span class="tok-n">attrs</span> <span class="tok-o">-&gt;</span>
    <span class="tok-n">out</span> <span class="tok-o">&lt;&lt;</span> <span class="tok-s2">&quot;&lt;script src=&#39;scripts/${attrs[&#39;script&#39;]}.js&#39; &gt;&lt;/script&gt;&quot;</span>
<span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>La creaciÃ³n de la etiqueta necesita como parÃ¡metro los atributos de la misma. En este primer ejemplo, sÃ³lo vamos a utilizar un atributo que serÃ¡ el nombre del archivo javascript que queremos invocar en nuestra pÃ¡gina GSP.</p>
</div>
<div class="paragraph">
<p>Una vez creada la etiqueta, para realizar la invocaciÃ³n de la misma en las pÃ¡ginas GSP utilizaremos el siguiente cÃ³digo.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-o">&lt;</span><span class="tok-nl">g:</span><span class="tok-n">includeJs</span> <span class="tok-n">script</span><span class="tok-o">=</span><span class="tok-s2">&quot;miscript&quot;</span><span class="tok-o">/&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Para invocar la nueva librerÃ­a creada se utiliza el <em>namespace</em> genÃ©rico <em>&lt;g&gt;</em>. Sin embargo, Grails nos permite crear nuestro propio espacio de nombres para que el cÃ³digo generado sea sencillo de leer. El espacio de nombres que vamos a utilizar serÃ¡ <em>me</em>, acrÃ³nimo de <em>mis etiquetas</em>. Para ello debemos definir una variable estÃ¡tica al inicio de la clase <em>TodoTagLib</em> llamada <em>namespace</em> e indicÃ¡ndole el valor del nuevo espacio de nombres, tal y como aparece en el siguiente fragmento de cÃ³digo.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-kn">package</span> <span class="tok-n">es</span><span class="tok-o">.</span><span class="tok-na">ua</span><span class="tok-o">.</span><span class="tok-na">expertojava</span><span class="tok-o">.</span><span class="tok-na">todo</span>

<span class="tok-kd">class</span> <span class="tok-nc">TodoTagLib</span> <span class="tok-o">{</span>

    <span class="tok-kd">static</span> <span class="tok-n">defaultEncodeAs</span> <span class="tok-o">=</span> <span class="tok-o">[</span><span class="tok-nl">taglib:</span><span class="tok-s1">&#39;html&#39;</span><span class="tok-o">]</span>
    <span class="tok-c1">//static encodeAsForTags = [tagName: [taglib:&#39;html&#39;], otherTagName: [taglib:&#39;none&#39;]]</span>

    <span class="tok-kd">static</span> <span class="tok-n">namespace</span> <span class="tok-o">=</span> <span class="tok-s1">&#39;me&#39;</span>

    <span class="tok-kt">def</span> <span class="tok-n">includeJs</span> <span class="tok-o">=</span> <span class="tok-o">{</span><span class="tok-n">attrs</span> <span class="tok-o">-&gt;</span>
        <span class="tok-n">out</span> <span class="tok-o">&lt;&lt;</span> <span class="tok-s2">&quot;&lt;script src=&#39;scripts/${attrs[&#39;script&#39;]}.js&#39;/&gt;&quot;</span>
    <span class="tok-o">}</span>
<span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>De esta forma, en nuestras pÃ¡ginas GSP ya no tendrÃ­amos que utilizar <em>&lt;g:includeJs script="miscript"/&gt;</em> sino que podrÃ­amos emplear <em>&lt;me:includeJs script="miscript"/&gt;</em>, con lo que la persona que lea el cÃ³digo podrÃ¡ detectar que esa etiqueta es una etiqueta propia de la aplicaciÃ³n.</p>
</div>
<div class="paragraph">
<p>En ocasiones, es posible que sea necesario referenciar a nuestras etiquetas desde controladores o desde otras etiquetas y no nos va a ser posible referenciar a estas etiqueta de la forma habitual. En este caso deberÃ­amos llamar a la etiqueta de la siguiente forma:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-kt">def</span> <span class="tok-n">renderImage</span> <span class="tok-o">=</span> <span class="tok-o">{</span> <span class="tok-n">attrs</span> <span class="tok-o">-&gt;</span>
    <span class="tok-n">println</span> <span class="tok-s2">&quot;Rendering the image ${attrs.image}&quot;</span>
    <span class="tok-n">asset</span><span class="tok-o">.</span><span class="tok-na">image</span><span class="tok-o">(</span><span class="tok-nl">src:</span><span class="tok-n">attrs</span><span class="tok-o">.</span><span class="tok-na">image</span><span class="tok-o">)</span>
<span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>En este ejemplo, en primer lugar imprimimos un log para saber que estamos renderizando una image y despuÃ©s utilizamos una librerÃ­a de etiquetas disponible en el plugin <em>asset-pipeline</em> que nos permite renderizar imÃ¡genes de forma optimizada en todos los entornos.</p>
</div>
</div>
<div class="sect3">
<h4 id="_etiquetas_lÃ³gicas_2">4.5.2. Etiquetas lÃ³gicas</h4>
<div class="paragraph">
<p>Con Grails tambiÃ©n es posible crear etiquetas lÃ³gicas que evalÃºen una cierta condiciÃ³n y actÃºen en consecuencia en funciÃ³n de dicha evaluaciÃ³n. El siguiente ejemplo es una etiqueta que comprueba si el usuario autenticado es un administrador. El siguiente mÃ©todo realiza esta comprobaciÃ³n y en caso de ser cierto, se mostrarÃ­a el contenido encerrado entre la etiqueta.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-kt">def</span> <span class="tok-n">esAdmin</span> <span class="tok-o">=</span> <span class="tok-o">{</span> <span class="tok-n">attrs</span><span class="tok-o">,</span> <span class="tok-n">body</span> <span class="tok-o">-&gt;</span>
    <span class="tok-kt">def</span> <span class="tok-n">usuario</span> <span class="tok-o">=</span> <span class="tok-n">attrs</span><span class="tok-o">[</span><span class="tok-s1">&#39;usuario&#39;</span><span class="tok-o">]</span>
    <span class="tok-k">if</span><span class="tok-o">(</span><span class="tok-n">usuario</span> <span class="tok-o">!=</span> <span class="tok-kc">null</span> <span class="tok-o">&amp;&amp;</span> <span class="tok-n">usuario</span><span class="tok-o">.</span><span class="tok-na">tipo</span><span class="tok-o">==</span><span class="tok-s2">&quot;administrador&quot;</span><span class="tok-o">)</span> <span class="tok-o">{</span>
        <span class="tok-n">out</span> <span class="tok-o">&lt;&lt;</span> <span class="tok-n">body</span><span class="tok-o">()</span>
    <span class="tok-o">}</span>
<span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>En esta ocasiÃ³n, la nueva etiqueta no sÃ³lo recibe el atributo <em>attrs</em> sino que tambiÃ©n necesita del atributo <em>body</em>, que se refiere a aquello que estÃ© encerrado entre la apertura y el cierre de la etiqueta. El mÃ©todo comprueba si el usuario pasado por parÃ¡metro es un administrador. En la pÃ¡gina GSP correspondiente deberÃ­amos indicar el siguiente cÃ³digo.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-o">&lt;</span><span class="tok-nl">me:</span><span class="tok-n">esAdmin</span> <span class="tok-n">usuario</span><span class="tok-o">=</span><span class="tok-s2">&quot;${session.usuario}&quot;</span><span class="tok-o">&gt;</span>
    <span class="tok-n">Dar</span> <span class="tok-n">de</span> <span class="tok-n">baja</span> <span class="tok-n">a</span> <span class="tok-n">usuario</span>
<span class="tok-o">&lt;/</span><span class="tok-nl">me:</span><span class="tok-n">esAdmin</span><span class="tok-o">&gt;</span></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_generador_de_cÃ³digo_hmtl">4.5.3. Generador de cÃ³digo HMTL</h4>
<div class="paragraph">
<p>Grails ofrece la posibilidad de generar cÃ³digo HTML de forma muy sencilla gracias a un Builder conocido como <em>MarkupBuilder</em>. Para comprobar el funcionamiento de este Builder, vamos a crear una nueva etiqueta que imprima un enlace cuyo atributo <em>href</em> coincida con el tÃ­tulo. Por ejemplo, para imprimir un enlace a la pÃ¡gina de Google, normalmente debemos incluir el cÃ³digo &lt;a href="http://www.google.com"&gt;<a href="http://www.google.com" class="bare">http://www.google.com</a>&lt;/a&gt;. Con esta etiqueta que vamos a crear nos ahorraremos escribir la direcciÃ³n url dos veces.</p>
</div>
<div class="paragraph">
<p>En primer lugar creamos un nuevo mÃ©todo en el archivo <em>TodoTagLib.groovy</em> y lo llamaremos <em>printLink()</em>. Este mÃ©todo utilizarÃ¡ el <em>MarkupBuilder</em> e imprimirÃ¡ un enlace con el valor del atributo <em>href</em> igual al contenido.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-kt">def</span> <span class="tok-n">printLink</span> <span class="tok-o">=</span> <span class="tok-o">{</span> <span class="tok-n">attrs</span><span class="tok-o">,</span> <span class="tok-n">body</span> <span class="tok-o">-&gt;</span>
    <span class="tok-kt">def</span> <span class="tok-n">mkp</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">groovy</span><span class="tok-o">.</span><span class="tok-na">xml</span><span class="tok-o">.</span><span class="tok-na">MarkupBuilder</span><span class="tok-o">(</span><span class="tok-n">out</span><span class="tok-o">)</span>
    <span class="tok-n">mkp</span><span class="tok-o">.</span><span class="tok-na">a</span><span class="tok-o">(</span><span class="tok-nl">href:</span><span class="tok-n">body</span><span class="tok-o">(),</span><span class="tok-n">body</span><span class="tok-o">())</span>
<span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Ahora en la vista podemos aÃ±adir una etiqueta como <em>&lt;me:printLink&gt;<a href="http://www.google.com" class="bare">http://www.google.com</a>&lt;/me:printLink&gt;</em>, la cual serÃ¡ traducida al cÃ³digo HTML <em>&lt;a href="http://www.google.com"&gt;<a href="http://www.google.com" class="bare">http://www.google.com</a>&lt;/a&gt;</em>.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_controladores">4.6. Controladores</h3>
<div class="paragraph">
<p>Una vez visto a fondo todo lo relativo a las vistas en las aplicaciones en Grails, vamos a analizar los controladores. En la sesiÃ³n anterior generÃ¡bamos el scaffolding de forma estÃ¡tica de tal forma que ahora vamos a analizar con mÃ¡s detalle todos los aspectos relativos a los controladores.</p>
</div>
<div class="sect3">
<h4 id="_acciones_en_los_controladores">4.6.1. Acciones en los controladores</h4>
<div class="paragraph">
<p>Como veÃ­amos anteriormente, los controladores en Grails se ubican en el directorio <em>grails-app/controllers</em>. Si recordamos la imagen donde se explicaba el proceso tÃ­pico de una aplicaciÃ³n que utiliza el patrÃ³n MÃ³delo Vista Controlador, los controladores se encargan bÃ¡sicamente de dirigir las llamadas a nuestra aplicaciÃ³n y de ponerse en contacto tanto con las clases de dominio, las vistas y los servicios para ponerlos de acuerdo.</p>
</div>
<div class="paragraph">
<p>Para analizar el formato de los controladores en Grails, veamos uno cualquiera de los generados en la sesiÃ³n anterior, como por ejemplo <em>TodoController.groovy</em>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-kn">package</span> <span class="tok-n">es</span><span class="tok-o">.</span><span class="tok-na">ua</span><span class="tok-o">.</span><span class="tok-na">expertojava</span><span class="tok-o">.</span><span class="tok-na">todo</span>

<span class="tok-kn">import</span> <span class="tok-nn">static</span> <span class="tok-n">org</span><span class="tok-o">.</span><span class="tok-na">springframework</span><span class="tok-o">.</span><span class="tok-na">http</span><span class="tok-o">.</span><span class="tok-na">HttpStatus</span><span class="tok-o">.*</span>
<span class="tok-kn">import</span> <span class="tok-nn">grails.transaction.Transactional</span>

<span class="tok-nd">@Transactional</span><span class="tok-o">(</span><span class="tok-n">readOnly</span> <span class="tok-o">=</span> <span class="tok-kc">true</span><span class="tok-o">)</span>
<span class="tok-kd">class</span> <span class="tok-nc">TodoController</span> <span class="tok-o">{</span>

    <span class="tok-kd">static</span> <span class="tok-n">allowedMethods</span> <span class="tok-o">=</span> <span class="tok-o">[</span><span class="tok-nl">save:</span> <span class="tok-s2">&quot;POST&quot;</span><span class="tok-o">,</span> <span class="tok-nl">update:</span> <span class="tok-s2">&quot;PUT&quot;</span><span class="tok-o">,</span> <span class="tok-nl">delete:</span> <span class="tok-s2">&quot;DELETE&quot;</span><span class="tok-o">]</span>

    <span class="tok-kt">def</span> <span class="tok-nf">index</span><span class="tok-o">(</span><span class="tok-n">Integer</span> <span class="tok-n">max</span><span class="tok-o">)</span> <span class="tok-o">{</span>
        <span class="tok-n">params</span><span class="tok-o">.</span><span class="tok-na">max</span> <span class="tok-o">=</span> <span class="tok-n">Math</span><span class="tok-o">.</span><span class="tok-na">min</span><span class="tok-o">(</span><span class="tok-n">max</span> <span class="tok-o">?:</span> <span class="tok-mi">10</span><span class="tok-o">,</span> <span class="tok-mi">100</span><span class="tok-o">)</span>
        <span class="tok-n">respond</span> <span class="tok-n">Todo</span><span class="tok-o">.</span><span class="tok-na">list</span><span class="tok-o">(</span><span class="tok-n">params</span><span class="tok-o">),</span> <span class="tok-nl">model:</span><span class="tok-o">[</span><span class="tok-nl">todoInstanceCount:</span> <span class="tok-n">Todo</span><span class="tok-o">.</span><span class="tok-na">count</span><span class="tok-o">()]</span>
    <span class="tok-o">}</span>

    <span class="tok-o">....</span>

<span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>En primer lugar vemos que se especifica mediante la anotaciÃ³n <em>@Transactional</em> la transaccionalidad de todos los mÃ©todos del controlador. En la siguiente sesiÃ³n aprovecharemos para hablar sobre los diferentes niveles de transaccionalidad cuando veamos los servicios en Grails.</p>
</div>
<div class="paragraph">
<p>La variable estÃ¡tica <em>allowedMethods</em> nos permite especificar para determinados mÃ©todos de nuestros controladores, el tipo de peticiÃ³n aceptada. En el caso del controlador generado vemos como el mÃ©todo <em>save()</em> sÃ³lo puede ser procesado por una peticiÃ³n de tipo <em>POST</em>, las actualizaciones por peticiones de tipo <em>PUT</em> y por Ãºltimo los borrados sÃ³lo serÃ¡n vÃ¡lidos cuando se hagan mediante una peticiÃ³n de tipo <em>DELETE</em>.</p>
</div>
<div class="paragraph">
<p>Los parÃ¡metros pasados a los mÃ©todos serÃ¡n mapeados directamente por Grails a partir de los parÃ¡metros pasados en la peticiÃ³n. Por ejemplo, si efectuamos la peticiÃ³n <em><a href="http://localhost:8080/todo/todo/index?max=20" class="bare">http://localhost:8080/todo/todo/index?max=20</a></em>, el parÃ¡metro max de la peticiÃ³n con valor 20 serÃ¡ pasado como parÃ¡metro al mÃ©todo index.</p>
</div>
<div class="paragraph">
<p>Como has podido comprobar en el ejemplo anterior, no es necesario especificar lo que van a devolver los mÃ©todo de los controladores con lo que podemos dejar que sea Grails quien se encargue de definirlo especificando la palabra reservada <em>def</em>.</p>
</div>
<div class="paragraph">
<p>Comentar tambiÃ©n que en la Ãºltimas versiones de Grails se ha aÃ±adido el mÃ©todo <em>respond</em> que provocarÃ¡ una salida diferente en funciÃ³n de la peticiÃ³n HTTP efectuada. Por ejemplo, si abrimos un terminal y ejecutamos:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-n">curl</span> <span class="tok-o">-</span><span class="tok-n">v</span> <span class="tok-o">-</span><span class="tok-n">H</span> <span class="tok-s2">&quot;Accept: application/json&quot;</span> <span class="tok-o">-</span><span class="tok-n">H</span> <span class="tok-s2">&quot;Content-type: application/json&quot;</span> <span class="tok-o">-</span><span class="tok-n">X</span> <span class="tok-n">GET</span>  <span class="tok-nl">http:</span><span class="tok-c1">//localhost:8080/todo/todo/index</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>veremos que la salida del mÃ©todo serÃ¡ en formato json, mientras que si ejecutamos</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-n">curl</span> <span class="tok-o">-</span><span class="tok-n">v</span> <span class="tok-o">-</span><span class="tok-n">H</span> <span class="tok-s2">&quot;Accept: text/xml&quot;</span> <span class="tok-o">-</span><span class="tok-n">H</span> <span class="tok-s2">&quot;Content-type: text/xml&quot;</span> <span class="tok-o">-</span><span class="tok-n">X</span> <span class="tok-n">GET</span>  <span class="tok-nl">http:</span><span class="tok-c1">//localhost:8080/todo/todo/index</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>veremos que la salida del mÃ©todo serÃ¡ en formato xml, mientras que si desde un navegador vamos a la direcciÃ³n <em><a href="http://localhost:8080/todo/todo/index" class="bare">http://localhost:8080/todo/todo/index</a></em>, Grails renderizarÃ¡ una pÃ¡gina html siguiendo una serie de convenios que veremos a continuaciÃ³n.</p>
</div>
<div class="paragraph">
<p>AdemÃ¡s, cada controlador en Grails tiene un mÃ©todo por defecto que sigue las siguientes reglas:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Si sÃ³lo hay un mÃ©todo, por supuesto ese serÃ¡ el mÃ©todo por defecto</p>
</li>
<li>
<p>Si hay un mÃ©todo con el nombre <em>index()</em>, ese serÃ¡ el mÃ©todo por defecto</p>
</li>
<li>
<p>Si la clase define la propiedad <em>defaultAction</em>, el mÃ©todo especificado serÃ¡ el escogido por defecto</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-kd">static</span> <span class="tok-n">defaultAction</span> <span class="tok-o">=</span> <span class="tok-s2">&quot;list&quot;</span></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_Ãmbitos_de_los_controladores">4.6.2. Ãmbitos de los controladores</h4>
<div class="paragraph">
<p>Los Ã¡mbitos (<em>scopes</em>) son una serie de objetos que nos permitirÃ¡n almacenar variables en una aplicaciÃ³n en Grails. Tenemos los siguientes Ã¡mbitos:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><em>servletContext</em>: tambiÃ©n conocido con el Ã¡mbito <em>aplicaciÃ³n</em> y que nos servirÃ¡ para compartir variables a travÃ©s de cualquier artefacto de la aplicaciÃ³n. Hablaremos de Ã©l cuando veamos como configurar una aplicaciÃ³n en Grails.</p>
</li>
<li>
<p><em>session</em>: es utilizada para controlar el estado de un determinado usuario de nuestra aplicaciÃ³n. Habitualmente, se utilizan cookies para asociar la <em>session</em> con el usuario.</p>
</li>
<li>
<p><em>request</em>: contendrÃ¡ toda la informaciÃ³n de la peticiÃ³n.</p>
</li>
<li>
<p><em>params</em>: es un mapa con la informaciÃ³n pasada a la peticiÃ³n en forma de parÃ¡metro <em>GET</em> o <em>POST</em>.</p>
</li>
<li>
<p><em>flash</em>: es una variable <em>efÃ­mera</em> de tal forma que sÃ³lo dura una peticiÃ³n y la siguiente, con lo que no es necesario destruirla a mano. Un ejemplo de su uso es el paso de mensajes de error a las vistas.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_relaciÃ³n_entre_vistas_y_controladores">4.6.3. RelaciÃ³n entre vistas y controladores</h4>
<div class="paragraph">
<p>Las vistas serÃ¡n las encargadas de mostrar al usuario aquello que el controlador quiera mostrar. Si echamos un vistazo a los mÃ©todos del controlador <em>TodoController</em> nos costarÃ¡ entender esa relaciÃ³n pues apenas se hace menciÃ³n a ninguna vista en este controlador. Esto es debido a que cuando no se especifica de forma explÃ­cita que vista renderizar, Grails utiliza lo que comentÃ¡bamos en la sesiÃ³n anterior al respecto de "convenciÃ³n sobre configuraciÃ³n" y directamente trata de renderizar una vista que coincida con el patrÃ³n <em>nombre-del-controlador/nombre-del-mÃ©todo.gsp</em>, con lo que por ejemplo, en el mÃ©todo</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-kt">def</span> <span class="tok-nf">show</span><span class="tok-o">(</span><span class="tok-n">Todo</span> <span class="tok-n">todoInstance</span><span class="tok-o">)</span> <span class="tok-o">{</span>
    <span class="tok-n">respond</span> <span class="tok-n">todoInstance</span>
<span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>al no haber indicado ninguna vista en el mÃ©todo <em>respond()</em>, Grails renderizarÃ¡ la vista ubicada en el directorio <em>grails-app/todo/show.gsp</em>. Como comentÃ¡bamos anteriormente, el mÃ©todo <em>respond()</em> se encarga de decidir como renderizar la salida pero si tiene que renderizar una vista en HTML, bien buscarÃ¡ una siguiendo el patrÃ³n mencionado o bien le podemos pasar una de forma de implÃ­cita, como por ejemplo vemos en el mÃ©todo <em>save()</em> del controlador <em>TodoController</em></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy">    <span class="tok-o">...</span>
    <span class="tok-k">if</span> <span class="tok-o">(</span><span class="tok-n">todoInstance</span><span class="tok-o">.</span><span class="tok-na">hasErrors</span><span class="tok-o">())</span> <span class="tok-o">{</span>
        <span class="tok-n">respond</span> <span class="tok-n">todoInstance</span><span class="tok-o">.</span><span class="tok-na">errors</span><span class="tok-o">,</span> <span class="tok-nl">view:</span><span class="tok-s1">&#39;create&#39;</span>
        <span class="tok-k">return</span>
    <span class="tok-o">}</span>
    <span class="tok-o">...</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Sigamos con la relaciÃ³n entre vistas y controladores. Si vemos las vistas y los mÃ©todos del controlador <em>TodoController</em> generados automÃ¡ticamente por el scaffolding estÃ¡tico nos daremos cuenta rÃ¡pidamente que cuatro de esos mÃ©todos tienen vistas asociadas (index, create, edit y show) mientras que otros tres no tienen ninguna vista asociada (save, update y delete). Esto es debido a que estos tres Ãºltimos mÃ©todos serÃ¡n los encargados Ãºnicamente de crear, actualizar o eliminar una tarea y serÃ¡n los otros mÃ©todos los encargados de renderizar las vistas correspondientes.</p>
</div>
<div class="paragraph">
<p>Si abrimos la vista <em>todo/create.gsp</em> veremos que el formulario se debe procesar con la acciÃ³n <em>save()</em></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-o">&lt;</span><span class="tok-nl">g:</span><span class="tok-n">form</span> <span class="tok-n">url</span><span class="tok-o">=</span><span class="tok-s2">&quot;[resource:todoInstance, action:&#39;save&#39;]&quot;</span> <span class="tok-o">&gt;</span>
    <span class="tok-o">&lt;</span><span class="tok-n">fieldset</span> <span class="tok-n">class</span><span class="tok-o">=</span><span class="tok-s2">&quot;form&quot;</span><span class="tok-o">&gt;</span>
        <span class="tok-o">&lt;</span><span class="tok-nl">g:</span><span class="tok-n">render</span> <span class="tok-n">template</span><span class="tok-o">=</span><span class="tok-s2">&quot;form&quot;</span><span class="tok-s">/&gt;</span>
<span class="tok-s">    &lt;/</span><span class="tok-n">fieldset</span><span class="tok-o">&gt;</span>
    <span class="tok-o">&lt;</span><span class="tok-n">fieldset</span> <span class="tok-n">class</span><span class="tok-o">=</span><span class="tok-s2">&quot;buttons&quot;</span><span class="tok-o">&gt;</span>
        <span class="tok-o">&lt;</span><span class="tok-nl">g:</span><span class="tok-n">submitButton</span> <span class="tok-n">name</span><span class="tok-o">=</span><span class="tok-s2">&quot;create&quot;</span> <span class="tok-n">class</span><span class="tok-o">=</span><span class="tok-s2">&quot;save&quot;</span> <span class="tok-n">value</span><span class="tok-o">=</span><span class="tok-s2">&quot;${message(code: &#39;default.button.create.label&#39;, default: &#39;Create&#39;)}&quot;</span> <span class="tok-s">/&gt;</span>
<span class="tok-s">    &lt;/</span><span class="tok-n">fieldset</span><span class="tok-o">&gt;</span>
<span class="tok-o">&lt;/</span><span class="tok-nl">g:</span><span class="tok-n">form</span><span class="tok-o">&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>con esto conseguimos que al enviar el formulario, el encargado de procesarlo sea el mÃ©todo <em>save()</em>.</p>
</div>
<div class="paragraph">
<p>Veamos ahora todo el proceso de creaciÃ³n de una tarea. Si arrancamos nuestra aplicaciÃ³n y accedemos en el navegador a la direcciÃ³n <em><a href="http://localhost:8080/todo/todo/create" class="bare">http://localhost:8080/todo/todo/create</a></em>, el mÃ©todo que sale al rescate es <em>TodoController.create()</em>. Este mÃ©todo con una sÃ³la lÃ­nea de cÃ³digo es capaz de renderizar una vista con una tarea asociada, que en principio tendrÃ¡ todos sus campos vacios.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-kt">def</span> <span class="tok-nf">create</span><span class="tok-o">()</span> <span class="tok-o">{</span>
    <span class="tok-n">respond</span> <span class="tok-k">new</span> <span class="tok-nf">Todo</span><span class="tok-o">(</span><span class="tok-n">params</span><span class="tok-o">)</span>
<span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Este mÃ©todo renderizarÃ¡ la vista <em>todo/create.gsp</em> y le pasarÃ¡ una variable llamada <em>todoInstance</em> que contendrÃ¡ una tarea con sus campos vacios.</p>
</div>
<div class="paragraph">
<p>Si abrimos ahora la vista <em>todo/create.gsp</em> vemos como esa vista Ãºnicamente llama a la plantilla <em>todo/_form.gsp</em> que es la que contiene los elementos de formulario necesarios para crear una tarea.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-o">&lt;</span><span class="tok-nl">g:</span><span class="tok-n">form</span> <span class="tok-n">url</span><span class="tok-o">=</span><span class="tok-s2">&quot;[resource:todoInstance, action:&#39;save&#39;]&quot;</span> <span class="tok-o">&gt;</span>
    <span class="tok-o">&lt;</span><span class="tok-n">fieldset</span> <span class="tok-n">class</span><span class="tok-o">=</span><span class="tok-s2">&quot;form&quot;</span><span class="tok-o">&gt;</span>
        <span class="tok-o">&lt;</span><span class="tok-nl">g:</span><span class="tok-n">render</span> <span class="tok-n">template</span><span class="tok-o">=</span><span class="tok-s2">&quot;form&quot;</span><span class="tok-s">/&gt;</span>
<span class="tok-s">    &lt;/</span><span class="tok-n">fieldset</span><span class="tok-o">&gt;</span>
    <span class="tok-o">&lt;</span><span class="tok-n">fieldset</span> <span class="tok-n">class</span><span class="tok-o">=</span><span class="tok-s2">&quot;buttons&quot;</span><span class="tok-o">&gt;</span>
        <span class="tok-o">&lt;</span><span class="tok-nl">g:</span><span class="tok-n">submitButton</span> <span class="tok-n">name</span><span class="tok-o">=</span><span class="tok-s2">&quot;create&quot;</span> <span class="tok-n">class</span><span class="tok-o">=</span><span class="tok-s2">&quot;save&quot;</span> <span class="tok-n">value</span><span class="tok-o">=</span><span class="tok-s2">&quot;${message(code: &#39;default.button.create.label&#39;, default: &#39;Create&#39;)}&quot;</span> <span class="tok-s">/&gt;</span>
<span class="tok-s">    &lt;/</span><span class="tok-n">fieldset</span><span class="tok-o">&gt;</span>
<span class="tok-o">&lt;/</span><span class="tok-nl">g:</span><span class="tok-n">form</span><span class="tok-o">&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Una vez el usuario envÃ­a la informaciÃ³n, el mÃ©todo encargado de procesar esa peticiÃ³n serÃ¡ <em>TodoController.save()</em></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-nd">@Transactional</span>
<span class="tok-kt">def</span> <span class="tok-nf">save</span><span class="tok-o">(</span><span class="tok-n">Todo</span> <span class="tok-n">todoInstance</span><span class="tok-o">)</span> <span class="tok-o">{</span>
    <span class="tok-k">if</span> <span class="tok-o">(</span><span class="tok-n">todoInstance</span> <span class="tok-o">==</span> <span class="tok-kc">null</span><span class="tok-o">)</span> <span class="tok-o">{</span>
        <span class="tok-n">notFound</span><span class="tok-o">()</span>
        <span class="tok-k">return</span>
    <span class="tok-o">}</span>

    <span class="tok-k">if</span> <span class="tok-o">(</span><span class="tok-n">todoInstance</span><span class="tok-o">.</span><span class="tok-na">hasErrors</span><span class="tok-o">())</span> <span class="tok-o">{</span>
        <span class="tok-n">respond</span> <span class="tok-n">todoInstance</span><span class="tok-o">.</span><span class="tok-na">errors</span><span class="tok-o">,</span> <span class="tok-nl">view:</span><span class="tok-s1">&#39;create&#39;</span>
        <span class="tok-k">return</span>
    <span class="tok-o">}</span>

    <span class="tok-n">todoInstance</span><span class="tok-o">.</span><span class="tok-na">save</span> <span class="tok-nl">flush:</span><span class="tok-kc">true</span>

    <span class="tok-n">request</span><span class="tok-o">.</span><span class="tok-na">withFormat</span> <span class="tok-o">{</span>
        <span class="tok-n">form</span> <span class="tok-n">multipartForm</span> <span class="tok-o">{</span>
            <span class="tok-n">flash</span><span class="tok-o">.</span><span class="tok-na">message</span> <span class="tok-o">=</span> <span class="tok-n">message</span><span class="tok-o">(</span><span class="tok-nl">code:</span> <span class="tok-s1">&#39;default.created.message&#39;</span><span class="tok-o">,</span> <span class="tok-nl">args:</span> <span class="tok-o">[</span><span class="tok-n">message</span><span class="tok-o">(</span><span class="tok-nl">code:</span> <span class="tok-s1">&#39;todo.label&#39;</span><span class="tok-o">,</span> <span class="tok-k">default</span><span class="tok-o">:</span> <span class="tok-s1">&#39;Todo&#39;</span><span class="tok-o">),</span> <span class="tok-n">todoInstance</span><span class="tok-o">.</span><span class="tok-na">id</span><span class="tok-o">])</span>
            <span class="tok-n">redirect</span> <span class="tok-n">todoInstance</span>
        <span class="tok-o">}</span>
        <span class="tok-s1">&#39;*&#39;</span> <span class="tok-o">{</span> <span class="tok-n">respond</span> <span class="tok-n">todoInstance</span><span class="tok-o">,</span> <span class="tok-o">[</span><span class="tok-nl">status:</span> <span class="tok-n">CREATED</span><span class="tok-o">]</span> <span class="tok-o">}</span>
    <span class="tok-o">}</span>
<span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>PongÃ¡monos en el caso en que no hayamos completado correctamente todos los campos requeridos. Si Ã©sto sucede, el mÃ©todo volverÃ¡ a renderizar la vista <em>todo/create.gsp</em> con los errores que se hayan producido.</p>
</div>
<div class="paragraph">
<p>En caso de que todo vaya bien, se almacena la nueva tarea</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-n">todoInstance</span><span class="tok-o">.</span><span class="tok-na">save</span> <span class="tok-nl">flush:</span><span class="tok-kc">true</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>y se trata de renderizar el resultado en funciÃ³n del tipo de peticiÃ³n realizada. En caso de que hayamos envÃ­ado un formulario se redirige la aplicaciÃ³n para mostrar esa tarea recien creada con una variable de tipo flash para mostrar un mensaje indicando que la tarea se ha creado correctamente.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-n">flash</span><span class="tok-o">.</span><span class="tok-na">message</span> <span class="tok-o">=</span> <span class="tok-n">message</span><span class="tok-o">(</span><span class="tok-nl">code:</span> <span class="tok-s1">&#39;default.created.message&#39;</span><span class="tok-o">,</span> <span class="tok-nl">args:</span> <span class="tok-o">[</span><span class="tok-n">message</span><span class="tok-o">(</span><span class="tok-nl">code:</span> <span class="tok-s1">&#39;todo.label&#39;</span><span class="tok-o">,</span> <span class="tok-k">default</span><span class="tok-o">:</span> <span class="tok-s1">&#39;Todo&#39;</span><span class="tok-o">),</span> <span class="tok-n">todoInstance</span><span class="tok-o">.</span><span class="tok-na">id</span><span class="tok-o">])</span>
<span class="tok-n">redirect</span> <span class="tok-n">todoInstance</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Cuando hacemos esta redirecciÃ³n Grails buscarÃ¡ el mÃ©todo <em>show()</em> y lo renderizarÃ¡. Este mÃ©todo pintarÃ¡ en el navegador la vista <em>todo/show.gsp</em>. Esta vista, como prÃ¡cticamente cualquier vista, tiene un fragmento de cÃ³digo que comprueba la presencia de una variable de tipo <em>flash</em> para actuar en consecuencia. En este caso simplemente mostrarÃ¡ el mensaje que hemos completado en el mÃ©todo <em>save()</em> del <em>TodoController</em>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-o">&lt;</span><span class="tok-nl">g:</span><span class="tok-k">if</span> <span class="tok-n">test</span><span class="tok-o">=</span><span class="tok-s2">&quot;${flash.message}&quot;</span><span class="tok-o">&gt;</span>
    <span class="tok-o">&lt;</span><span class="tok-n">div</span> <span class="tok-n">class</span><span class="tok-o">=</span><span class="tok-s2">&quot;message&quot;</span> <span class="tok-n">role</span><span class="tok-o">=</span><span class="tok-s2">&quot;status&quot;</span><span class="tok-o">&gt;</span><span class="tok-n">$</span><span class="tok-o">{</span><span class="tok-n">flash</span><span class="tok-o">.</span><span class="tok-na">message</span><span class="tok-o">}&lt;</span><span class="tok-s">/div&gt;</span>
<span class="tok-s">&lt;/</span><span class="tok-nl">g:</span><span class="tok-k">if</span><span class="tok-o">&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Si en lugar de haber envÃ­ado un formulario a travÃ©s de una pÃ¡gina HTML, la peticiÃ³n es de cualquier otro tipo, se trata de renderizar una salida acorde al tipo de peticiÃ³n.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-s1">&#39;*&#39;</span> <span class="tok-o">{</span> <span class="tok-n">respond</span> <span class="tok-n">todoInstance</span><span class="tok-o">,</span> <span class="tok-o">[</span><span class="tok-nl">status:</span> <span class="tok-n">CREATED</span><span class="tok-o">]</span> <span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Si por ejemplo lanzamos desde la terminal el siguiente comando</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-n">curl</span> <span class="tok-o">-</span><span class="tok-n">v</span> <span class="tok-o">-</span><span class="tok-n">H</span> <span class="tok-s2">&quot;Accept: application/json&quot;</span> <span class="tok-o">-</span><span class="tok-n">H</span> <span class="tok-s2">&quot;Content-type: application/json&quot;</span> <span class="tok-o">-</span><span class="tok-n">X</span> <span class="tok-n">POST</span> <span class="tok-o">-</span><span class="tok-n">d</span> <span class="tok-s2">&quot;{&#39;title&#39;:&#39;Hacer los ejercicios de Groovy&#39;,&#39;date_day&#39;:25,&#39;date_month&#39;:3,&#39;date_year&#39;:2015,&#39;date&#39;:&#39;date.struct&#39;}&quot;</span> <span class="tok-nl">http:</span><span class="tok-c1">//localhost:8080/todo/todo/save</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>la aplicaciÃ³n nos crearÃ¡ una nueva tarea y nos devolverÃ¡ el resultado en formato json. Si por el contrario ejecutamos</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-n">curl</span> <span class="tok-o">-</span><span class="tok-n">v</span> <span class="tok-o">-</span><span class="tok-n">H</span> <span class="tok-s2">&quot;Accept: text/xml&quot;</span> <span class="tok-o">-</span><span class="tok-n">H</span> <span class="tok-s2">&quot;Content-type: application/json&quot;</span> <span class="tok-o">-</span><span class="tok-n">X</span> <span class="tok-n">POST</span> <span class="tok-o">-</span><span class="tok-n">d</span> <span class="tok-s2">&quot;{&#39;title&#39;:&#39;Hacer los ejercicios de Grails&#39;,&#39;date_day&#39;:26,&#39;date_month&#39;:3,&#39;date_year&#39;:2015,&#39;date&#39;:&#39;date.struct&#39;}&quot;</span> <span class="tok-nl">http:</span><span class="tok-c1">//localhost:8080/todo/todo/save</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Con esto hemos podido comprobar como Grails con muy pocas lÃ­neas de cÃ³digo es capaz de generar una aplicaciÃ³n que serÃ¡ capaz de responder al cliente de varias formas con lo que podemos tener una aplicaciÃ³n multiplataforma todo integrado en el mismo cÃ³digo fuente.</p>
</div>
<div class="sect4">
<h5 id="_renderizando_vistas">Renderizando vistas</h5>
<div class="paragraph">
<p>En ocasiones, sobre todo cuando realicemos aplicaciones web, tendremos que simplemente renderizar vistas o fragmentos de texto. Para ello Grails dispone del mÃ©todo <em>render()</em> que puede renderizar desde un trozo de texto hasta una plantilla.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-n">render</span> <span class="tok-s2">&quot;Hello World!&quot;</span>

<span class="tok-n">render</span> <span class="tok-o">{</span>
   <span class="tok-mi">10</span><span class="tok-o">.</span><span class="tok-na">times</span> <span class="tok-o">{</span>
      <span class="tok-n">div</span><span class="tok-o">(</span><span class="tok-nl">id:</span> <span class="tok-n">it</span><span class="tok-o">,</span> <span class="tok-s2">&quot;Div ${it}&quot;</span><span class="tok-o">)</span>
   <span class="tok-o">}</span>
<span class="tok-o">}</span>

<span class="tok-n">render</span><span class="tok-o">(</span><span class="tok-nl">view:</span> <span class="tok-s1">&#39;show&#39;</span><span class="tok-o">)</span>

<span class="tok-n">render</span><span class="tok-o">(</span><span class="tok-nl">template:</span> <span class="tok-s1">&#39;book_template&#39;</span><span class="tok-o">,</span> <span class="tok-nl">collection:</span> <span class="tok-n">Book</span><span class="tok-o">.</span><span class="tok-na">list</span><span class="tok-o">())</span>

<span class="tok-n">render</span><span class="tok-o">(</span><span class="tok-nl">text:</span> <span class="tok-s2">&quot;&lt;xml&gt;some xml&lt;/xml&gt;&quot;</span><span class="tok-o">,</span> <span class="tok-nl">contentType:</span> <span class="tok-s2">&quot;text/xml&quot;</span><span class="tok-o">,</span> <span class="tok-nl">encoding:</span> <span class="tok-s2">&quot;UTF-8&quot;</span><span class="tok-o">)</span></code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_redirecciones_y_encadenamientos">Redirecciones y encadenamientos</h5>
<div class="paragraph">
<p>Tal y como veÃ­amos anteriormente, en ocasiones necesitaremos redireccionar nuestra aplicaciÃ³n a otros mÃ©todos. Para ello, disponemos del mÃ©todo <em>redirect()</em> que acepta varios parÃ¡metros, como en los siguientes ejemplos:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-c1">//RedirecciÃ³n que se hace dentro del mismo controlador</span>
<span class="tok-n">redirect</span><span class="tok-o">(</span><span class="tok-nl">action:</span> <span class="tok-n">login</span><span class="tok-o">)</span>

<span class="tok-c1">//RedirecciÃ³n que se hace a otro controlador</span>
<span class="tok-n">redirect</span><span class="tok-o">(</span><span class="tok-nl">controller:</span> <span class="tok-s1">&#39;home&#39;</span><span class="tok-o">,</span> <span class="tok-nl">action:</span> <span class="tok-s1">&#39;index&#39;</span><span class="tok-o">)</span>

<span class="tok-c1">//RedirecciÃ³n a una uri explÃ­citamente</span>
<span class="tok-n">redirect</span><span class="tok-o">(</span><span class="tok-nl">uri:</span> <span class="tok-s2">&quot;/login.html&quot;</span><span class="tok-o">)</span>

<span class="tok-c1">//RedirecciÃ³n a una url absoluta</span>
<span class="tok-n">redirect</span><span class="tok-o">(</span><span class="tok-nl">url:</span> <span class="tok-s2">&quot;http://grails.org&quot;</span><span class="tok-o">)</span>

<span class="tok-c1">//RedirecciÃ³n pasando parÃ¡metros</span>
<span class="tok-n">redirect</span><span class="tok-o">(</span><span class="tok-nl">action:</span> <span class="tok-s1">&#39;myaction&#39;</span><span class="tok-o">,</span> <span class="tok-nl">params:</span> <span class="tok-o">[</span><span class="tok-nl">myparam:</span> <span class="tok-s2">&quot;myvalue&quot;</span><span class="tok-o">])</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>AdemÃ¡s, Grails tambiÃ©n ofrece la posibilidad de encadenar acciones. El beneficio de encadenar acciones en lugar de redirigir es que el modelo se pasa de una acciÃ³n a la siguiente:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-kd">class</span> <span class="tok-nc">ExampleChainController</span> <span class="tok-o">{</span>
    <span class="tok-kt">def</span> <span class="tok-nf">first</span><span class="tok-o">()</span> <span class="tok-o">{</span>
        <span class="tok-n">chain</span><span class="tok-o">(</span><span class="tok-nl">action:</span> <span class="tok-n">second</span><span class="tok-o">,</span> <span class="tok-nl">model:</span> <span class="tok-o">[</span><span class="tok-nl">one:</span> <span class="tok-mi">1</span><span class="tok-o">])</span>
    <span class="tok-o">}</span>

    <span class="tok-kt">def</span> <span class="tok-nf">second</span> <span class="tok-o">()</span> <span class="tok-o">{</span>
        <span class="tok-n">chain</span><span class="tok-o">(</span><span class="tok-nl">action:</span> <span class="tok-n">third</span><span class="tok-o">,</span> <span class="tok-nl">model:</span> <span class="tok-o">[</span><span class="tok-nl">two:</span> <span class="tok-mi">2</span><span class="tok-o">])</span>
    <span class="tok-o">}</span>

    <span class="tok-kt">def</span> <span class="tok-nf">third</span><span class="tok-o">()</span> <span class="tok-o">{</span>
        <span class="tok-o">[</span><span class="tok-nl">three:</span> <span class="tok-mi">3</span><span class="tok-o">])</span>
    <span class="tok-o">}</span>
<span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Esta cadena de acciones terminarÃ­a con el mÃ©todo <em>third()</em> recibiendo los modelos</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-o">[</span><span class="tok-nl">one:</span> <span class="tok-mi">1</span><span class="tok-o">,</span> <span class="tok-nl">two:</span> <span class="tok-mi">2</span><span class="tok-o">,</span> <span class="tok-nl">three:</span> <span class="tok-mi">3</span><span class="tok-o">]</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Si necesitamos acceder a los modelos dentro de una cadena, podemos utilizar la variable dinÃ¡mica <em>chainModel</em> que es un mapa con todos los modelos generados en la cadena.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-kd">class</span> <span class="tok-nc">ChainController</span> <span class="tok-o">{</span>
    <span class="tok-kt">def</span> <span class="tok-nf">nextInChain</span><span class="tok-o">()</span> <span class="tok-o">{</span>
        <span class="tok-kt">def</span> <span class="tok-n">model</span> <span class="tok-o">=</span> <span class="tok-n">chainModel</span><span class="tok-o">.</span><span class="tok-na">myModel</span>
        <span class="tok-err">â¦</span>
    <span class="tok-o">}</span>
<span class="tok-o">}</span></code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_filtros">4.7. Filtros</h3>
<div class="paragraph">
<p>Los filtros en una aplicaciÃ³n Grails permiten ejecutar acciones antes y despuÃ©s de que los mÃ©todos de los controladores sean invocados. El tÃ­pico ejemplo de uso de los filtros es el de asegurar las peticiones a nuestra aplicaciÃ³n para comprobar si el usuario tiene acceso a un determinado recurso.</p>
</div>
<div class="paragraph">
<p>Otro ejemplo util de los filtros puede ser el de mantener un log cada vez que se ejecuta una peticiÃ³n en nuestra aplicaciÃ³n, es decir, que cada vez que llamemos a un mÃ©todo de un controlador, imprimimos algo por pantalla.</p>
</div>
<div class="paragraph">
<p>Por supuesto que podrÃ­amos hacerlo directamente en cada mÃ©todo de los controladores, pero sin duda es algo poco mantenible y no es una buena prÃ¡ctica, con lo que vamos a utilizar los filtros.</p>
</div>
<div class="paragraph">
<p>En Grails, los filtros se generan creando una nueva clase que termine con la palabra <em>Filters</em> o bien mediante el comando <em>grails create-filters</em> para que sea Grails quien lo haga por nosotros y nos cree ademÃ¡s un esqueleto de la clase en cuestiÃ³n. Estas nuevas clases se deben crear en el directorio <em>grails-app/conf</em>. Cada filtro implementa la lÃ³gica a ejecutar antes y despuÃ©s de las acciones asÃ­ como sobre que acciones se debe hacer. En nuestro caso, debemos crear un filtro ejecutando el comando <em>grails create-filters log</em> que se ubicarÃ¡ en el directorio <em>grails-app/conf/todo</em> y se llamarÃ¡ <em>LogFilters.groovy</em>. El esqueleto que Grails ha creado para este filtro es el siguiente:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-kn">package</span> <span class="tok-n">todo</span>

<span class="tok-kd">class</span> <span class="tok-nc">LogFilters</span> <span class="tok-o">{</span>

    <span class="tok-kt">def</span> <span class="tok-n">filters</span> <span class="tok-o">=</span> <span class="tok-o">{</span>
        <span class="tok-n">all</span><span class="tok-o">(</span><span class="tok-nl">controller:</span><span class="tok-s1">&#39;*&#39;</span><span class="tok-o">,</span> <span class="tok-nl">action:</span><span class="tok-s1">&#39;*&#39;</span><span class="tok-o">)</span> <span class="tok-o">{</span>
            <span class="tok-n">before</span> <span class="tok-o">=</span> <span class="tok-o">{</span>

            <span class="tok-o">}</span>
            <span class="tok-n">after</span> <span class="tok-o">=</span> <span class="tok-o">{</span> <span class="tok-n">Map</span> <span class="tok-n">model</span> <span class="tok-o">-&gt;</span>

            <span class="tok-o">}</span>
            <span class="tok-n">afterView</span> <span class="tok-o">=</span> <span class="tok-o">{</span> <span class="tok-n">Exception</span> <span class="tok-n">e</span> <span class="tok-o">-&gt;</span>

            <span class="tok-o">}</span>
        <span class="tok-o">}</span>
    <span class="tok-o">}</span>
<span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Tal y como vemos en el cÃ³digo del esqueleto generado por Grails, podemos ejecutar el filtro antes (<em>before</em>) o despuÃ©s (<em>after</em>) de que se ejecute el mÃ©todo correspondiente del controlador o bien hacerlo despuÃ©s de que se genere la vista. AdemÃ¡s, tambiÃ©n podemos especificar sobre que controladores queremos aplicar estos filtros.</p>
</div>
<div class="paragraph">
<p>Nuestro filtro se aplicarÃ¡ a todos los controladores de nuestra aplicaciÃ³n pero sÃ³lo a aquellas acciones que traten de renderizar una vista, que serÃ¡n <em>index, create, edit y show</em> con lo que podrÃ­amos tener algo asÃ­:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-kn">package</span> <span class="tok-n">todo</span>

<span class="tok-kd">class</span> <span class="tok-nc">LogFilters</span> <span class="tok-o">{</span>

    <span class="tok-kt">def</span> <span class="tok-n">filters</span> <span class="tok-o">=</span> <span class="tok-o">{</span>
        <span class="tok-n">all</span><span class="tok-o">(</span><span class="tok-nl">controller:</span><span class="tok-s1">&#39;todo|category|tag&#39;</span><span class="tok-o">,</span> <span class="tok-nl">action:</span><span class="tok-s1">&#39;create|edit|index|show&#39;</span><span class="tok-o">)</span> <span class="tok-o">{</span>
            <span class="tok-n">before</span> <span class="tok-o">=</span> <span class="tok-o">{</span>

            <span class="tok-o">}</span>
            <span class="tok-n">after</span> <span class="tok-o">=</span> <span class="tok-o">{</span> <span class="tok-n">Map</span> <span class="tok-n">model</span> <span class="tok-o">-&gt;</span>
                <span class="tok-n">println</span> <span class="tok-s2">&quot;Controlador ${controllerName} - Accion ${actionName} - Modelo ${model}&quot;</span>
            <span class="tok-o">}</span>
            <span class="tok-n">afterView</span> <span class="tok-o">=</span> <span class="tok-o">{</span> <span class="tok-n">Exception</span> <span class="tok-n">e</span> <span class="tok-o">-&gt;</span>

            <span class="tok-o">}</span>
        <span class="tok-o">}</span>
    <span class="tok-o">}</span>
<span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>La clase LogFilters Ãºnicamente dispone de un filtro, el denominado <em>all()</em>, pero una misma clase puede tener tantos filtros como queramos.</p>
</div>
<div style="page-break-after: always;"></div>
</div>
<div class="sect2">
<h3 id="_ejercicios_4">4.8. Ejercicios</h3>
<div class="sect3">
<h4 id="_modificando_las_vistas_0_25_puntos">4.8.1. Modificando las vistas (0.25 puntos)</h4>
<div class="paragraph">
<p>Si hacemos un rÃ¡pido test de usabilidad en nuestra aplicaciÃ³n veremos que cada vez que necesitamos editar o eliminar una tarea, tenemos que hacer dos clicks sobre la misma, uno para ver la tarea y otro para editarla. Vamos a solucionar este problema de usabilidad modificando el listado de las tareas para aÃ±adir una nueva columna a la izquierda de cada tarea para mostrar dos opciones, una para editar y otra para eliminar una tarea.</p>
</div>
<div class="paragraph">
<p>Aprovecharemos tambiÃ©n para eliminar las columnas <em>Description</em> y <em>Reminder Date</em> del listado de las tareas.</p>
</div>
</div>
<div class="sect3">
<h4 id="_etiqueta_para_valores_booleanos_0_50_puntos">4.8.2. Etiqueta para valores booleanos (0.50 puntos)</h4>
<div class="paragraph">
<p>Vamos a crear una etiqueta que nos permita, a partir de un valor booleano, imprimir un icono u otro. La etiqueta se llamara <em>printIconFromBoolean</em> y Ãºnicamente recibirÃ¡ como parÃ¡metro el atributo <em>value</em>. Modifica tambiÃ©n el namespace de la librerÃ­a creada para que podamos a ella a travÃ©s del namespace <em>todo</em> con lo que para llamar a nuestra etiqueta tendrÃ­amos que ejecutar algo como:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-o">&lt;</span><span class="tok-nl">todo:</span><span class="tok-n">printIconFromBoolean</span> <span class="tok-n">value</span><span class="tok-o">=</span><span class="tok-n">$</span><span class="tok-o">{</span><span class="tok-n">todoInstance</span><span class="tok-o">.</span><span class="tok-na">done</span><span class="tok-o">}/&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Y deberÃ­amos imprimir algo parecido a esto:</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="images/grails04/listadoejercicio2.png" alt="Icono desde un booleano" width="50%">
</div>
</div>
<div class="paragraph">
<p>SerÃ­a aconsejable que utilizaras el mÃ©todo <em>image()</em> de la librerÃ­a de etiquetas del plugin <em>asset pipeline</em>. AquÃ­ tienes un ejemplo:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-n">asset</span><span class="tok-o">.</span><span class="tok-na">image</span><span class="tok-o">(</span><span class="tok-nl">src:</span><span class="tok-s2">&quot;icon.png&quot;</span><span class="tok-o">)</span></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_pÃ¡gina_de_confirmaciÃ³n_de_eliminaciÃ³n_de_etiquetas_0_50_puntos">4.8.3. PÃ¡gina de confirmaciÃ³n de eliminaciÃ³n de etiquetas (0.50 puntos)</h4>
<div class="paragraph">
<p>Cuando deseamos eliminar una etiqueta, al hacer click sobre el botÃ³n eliminar se nos muestra un mensaje en Javascript para confirmar si realmente queremos eliminar esta etiqueta. Vamos a modificar este sistema para que en lugar de mostrar un mensaje en Javascript, nos muestre una nueva pÃ¡gina para pedir confirmaciÃ³n. Esto nos permitirÃ¡ aÃ±adir algo mÃ¡s de seguridad en lo que el usuario estÃ¡ realizando ya que podemos mostrar un mensaje de alerta mÃ¡s evidente, como por ejemplo Ã©ste:</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="images/grails04/screenshotejercicio3.png" alt="Mensaje confirmaciÃ³n eliminaciÃ³n de etiquetas" width="50%">
</div>
</div>
<div style="page-break-after: always;"></div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="sesion05">5. PatrÃ³n MVC: Dominios y servicios.</h2>
<div class="sectionbody">
<div class="paragraph">
<p>En esta tercera sesiÃ³n sobre Grails veremos como Grails hace uso de GORM para mapear objetos contra la base de datos de la aplicaciÃ³n. Recordar que GORM es una capa superior a Hibernate con lo que gran parte de lo aprendido en mÃ³dulos anteriores sobre Hibernate serÃ¡n totalmente vÃ¡lidos para trabajar con Grails.</p>
</div>
<div class="paragraph">
<p>Por Ãºltimo, veremos lo sencillo que es en Grails implementar servicios que se encarguen de la lÃ³gica de negocio de nuestra aplicaciÃ³n creando un sencillo ejemplo.</p>
</div>
<div class="sect2">
<h3 id="_dominios">5.1. Dominios</h3>
<div class="sect3">
<h4 id="_creaciÃ³n_de_dominios">5.1.1. CreaciÃ³n de dominios</h4>
<div class="paragraph">
<p>Como puedes imaginar, lo primero que se debe hacer con una clase de dominio es crearla. Como ya vimos en sesiones anteriores, el comando utilizado para generar una nueva clase de dominio es <em>grails create-domain-class</em> seguido del nombre de la nueva clase que queremos crear. Pero, Â¿quÃ© pasa en la base de datos cuando generamos nuestras clases de dominio? Para ver exactamente que es lo que pasa en la base de datos cuando creamos una nueva clase de dominio, vamos a tomar como ejemplo la clase <em>Todo</em>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-kn">package</span> <span class="tok-n">es</span><span class="tok-o">.</span><span class="tok-na">ua</span><span class="tok-o">.</span><span class="tok-na">expertojava</span><span class="tok-o">.</span><span class="tok-na">todo</span>

<span class="tok-kd">class</span> <span class="tok-nc">Todo</span> <span class="tok-o">{</span>
    <span class="tok-n">String</span> <span class="tok-n">title</span>
    <span class="tok-n">String</span> <span class="tok-n">description</span>
    <span class="tok-n">Date</span> <span class="tok-n">date</span>
    <span class="tok-n">Date</span> <span class="tok-n">reminderDate</span>
    <span class="tok-n">String</span> <span class="tok-n">url</span>
    <span class="tok-n">Boolean</span> <span class="tok-n">done</span> <span class="tok-o">=</span> <span class="tok-kc">false</span>
    <span class="tok-n">Category</span> <span class="tok-n">category</span>

    <span class="tok-kd">static</span> <span class="tok-n">hasMany</span> <span class="tok-o">=</span> <span class="tok-o">[</span><span class="tok-nl">tags:</span><span class="tok-n">Tag</span><span class="tok-o">]</span>
    <span class="tok-kd">static</span> <span class="tok-n">belongsTo</span> <span class="tok-o">=</span> <span class="tok-o">[</span><span class="tok-n">Tag</span><span class="tok-o">]</span>

    <span class="tok-kd">static</span> <span class="tok-n">constraints</span> <span class="tok-o">=</span> <span class="tok-o">{</span>
        <span class="tok-n">title</span><span class="tok-o">(</span><span class="tok-nl">blank:</span><span class="tok-kc">false</span><span class="tok-o">)</span>
        <span class="tok-n">description</span><span class="tok-o">(</span><span class="tok-nl">blank:</span><span class="tok-kc">true</span><span class="tok-o">,</span> <span class="tok-nl">nullable:</span><span class="tok-kc">true</span><span class="tok-o">,</span> <span class="tok-nl">maxSize:</span><span class="tok-mi">1000</span><span class="tok-o">)</span>
        <span class="tok-n">date</span><span class="tok-o">(</span><span class="tok-nl">nullable:</span><span class="tok-kc">false</span><span class="tok-o">)</span>
        <span class="tok-n">reminderDate</span><span class="tok-o">(</span><span class="tok-nl">nullable:</span><span class="tok-kc">true</span><span class="tok-o">)</span>
        <span class="tok-n">url</span><span class="tok-o">(</span><span class="tok-nl">nullable:</span><span class="tok-kc">true</span><span class="tok-o">,</span> <span class="tok-nl">url:</span><span class="tok-kc">true</span><span class="tok-o">)</span>
        <span class="tok-n">done</span><span class="tok-o">(</span><span class="tok-nl">nullable:</span><span class="tok-kc">false</span><span class="tok-o">)</span>
        <span class="tok-n">category</span><span class="tok-o">(</span><span class="tok-nl">nullable:</span><span class="tok-kc">true</span><span class="tok-o">)</span>
    <span class="tok-o">}</span>

    <span class="tok-n">String</span> <span class="tok-nf">toString</span><span class="tok-o">(){</span>
        <span class="tok-n">title</span>
    <span class="tok-o">}</span>
<span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Pasemos a ver que tabla nos ha creado nuestra aplicaciÃ³n en la base de datos. Para esto, vamos a ver una de las caracterÃ­sticas aÃ±adidas en las Ãºltimas versiones de Grails que es la posibilidad de utilizar una consola web para acceder a la estructura de la base de datos creada. Esta consola se puede acceder desde la direcciÃ³n <em><a href="http://localhost:8080/todo/dbconsole" class="bare">http://localhost:8080/todo/dbconsole</a></em>. Hay que tener en cuenta que como parÃ¡metro JDBC URL debemos introducir la misma url que tengamos configurada en el archivo <em>DataSource.groovy</em>, que por defecto serÃ¡ <em>jdbc:h2:mem:devDb</em>.</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="images/grails05/dbconsole.png" alt="ConexiÃ³n con DbConsole" width="50%">
</div>
</div>
<div class="paragraph">
<p>Una vez dentro de la consola de H2, podemos ejecutar el comando <em>SHOW COLUMNS FROM TODO</em> para ver el esquema de la tabla <em>TODO</em> y compararla de eta forma con la clase de dominio que nosotros hemos creado para encontrar las siguientes diferencias.</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="images/grails05/tabletodo.png" alt="Table Todo" width="100%">
</div>
</div>
<div class="paragraph">
<p><strong>Nuevas columnas</strong></p>
</div>
<div class="paragraph">
<p>La primera diferencia que encontramos es la existencia de dos nuevas columnas en la tabla correspondiente de la base de datos. La primera de ellas es la columna <em>id</em> que ademÃ¡s es la clave primaria de la tabla y autoincremental. Esto puede parecer que es algo en contra de Grails ya que no vamos a poder establecer la clave primaria que nosotros queremos, pero en la prÃ¡ctica se ha demostrado que es la mejor forma a la hora de interactuar con la base de datos. La otra nueva columna que se ha generado en la tabla es el campo <em>version</em> y servirÃ¡ para garantizar la integridad transaccional y el bloqueo eficiente de las tablas cuando se realizan operaciones de entrada.</p>
</div>
<div class="paragraph">
<p><strong>Nombre de las columnas</strong></p>
</div>
<div class="paragraph">
<p>El nombre de las propiedades que en la clase de dominio seguÃ­an el convenio <em>CamelCase</em> (palabras sin espacios en blanco y con la primera letra de cada una de ellas en mayÃºscula), en la tabla se convierten por defecto al formato <em>snake_case</em> (todas las palabras en minÃºsculas y separadas por un subrayado bajo _), a pesar de que en la consola de H2 nos aparezca todo en mayÃºsculas. Si lo comprobÃ¡ramos con una base de datos MySQL verÃ­amos este cambio de nombre de las propiedades.</p>
</div>
<div class="paragraph">
<p><strong>Claves ajenas</strong></p>
</div>
<div class="paragraph">
<p>GORM representa las claves ajenas en la tabla con el nombre de la clase/tabla referencia en minÃºsculas seguido de <em>_id</em>. En nuestro caso tenemos la columna <em>category_id</em> que identifica la relaciÃ³n entre las tareas y categorÃ­as, con lo que cada tarea sÃ³lo puede pertenecer a una categorÃ­a.</p>
</div>
<div class="paragraph">
<p><strong>Tipos de datos</strong></p>
</div>
<div class="paragraph">
<p>Dependiendo de la base de datos utilizada (en nuestro caso H2), GORM transformarÃ¡ los tipos de datos de las propiedades de la clase de dominio en otros tipos de datos en la tabla. Por ejemplo, el tipo de dato <em>String</em> se sustituye en la base de datos por <em>varchar()</em>, mientras que el tipo de dato <em>Date</em> es reemplazado por <em>timestamp</em>. Todo esto dependerÃ¡ de la base de datos utilizada y es posible que varÃ­e entre ellas.</p>
</div>
</div>
<div class="sect3">
<h4 id="_relaciones_entre_clases_de_dominio">5.1.2. Relaciones entre clases de dominio</h4>
<div class="paragraph">
<p>Cualquier aplicaciÃ³n que vayamos a desarrollar, presentarÃ¡ relaciones entre sus clases de dominio. En nuestro ejemplo de scaffolding ya definimos algunas relaciones entre ellas y ahora vamos a ver mÃ¡s en detalle esas relaciones. Las posibles relaciones entre las clases de dominio de una aplicaciÃ³n son:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Uno a uno</p>
</li>
<li>
<p>Uno a muchos</p>
</li>
<li>
<p>Muchos a muchos</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Si hacemos algo de memoria de la definiciÃ³n de nuestras clases de dominio, recordaremos que utilizÃ¡bamos la palabra reservada <em>hasMany</em> y <em>belongsTo</em> para establecer la relaciÃ³n entre las tareas y las etiquetas. TambiÃ©n existen la palabra reservada <em>hasOne</em>. A continuaciÃ³n veremos en detalle cada una de las posibles relaciones y como especificarlas.</p>
</div>
<div class="sect4">
<h5 id="_uno_a_uno">Uno a uno</h5>
<div class="paragraph">
<p>Una relaciÃ³n uno-a-uno se da cuando un objeto de la clase A estÃ¡ Ãºnicamente relacionado con un objeto de la clase B y viceversa. Por ejemplo, imaginad la aplicaciÃ³n <em>Biblioteca</em> en donde un <em>libro</em> sÃ³lo puede tener una <em>operaciÃ³n activa</em>. Esto se representarÃ­a con una relaciÃ³n <em>uno-a-uno</em> y podrÃ­amos hacerlo de tres formas diferentes.</p>
</div>
<div class="paragraph">
<p><em>Primera forma de establecer una relaciÃ³n uno a uno</em></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-kd">class</span> <span class="tok-nc">Book</span><span class="tok-o">{</span>
<span class="tok-o">}</span>

<span class="tok-kd">class</span> <span class="tok-nc">ActiveOperation</span><span class="tok-o">{</span>
    <span class="tok-o">....</span>
    <span class="tok-n">Book</span> <span class="tok-n">book</span>
    <span class="tok-o">....</span>
<span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>AquÃ­ estamos representando una relaciÃ³n unidireccional desde las operaciones activas hasta los libros. Si necesitamos especificar una relaciÃ³n bidireccional podemos utilizar cualquiera de las siguientes formas.</p>
</div>
<div class="paragraph">
<p><em>Segunda forma de establecer una relaciÃ³n uno a uno</em></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-kd">class</span> <span class="tok-nc">Book</span><span class="tok-o">{</span>
    <span class="tok-o">....</span>
    <span class="tok-n">ActiveOperation</span> <span class="tok-n">actoper</span>
    <span class="tok-o">....</span>
<span class="tok-o">}</span>

<span class="tok-kd">class</span> <span class="tok-nc">ActiveOperation</span><span class="tok-o">{</span>
    <span class="tok-o">....</span>
    <span class="tok-kd">static</span> <span class="tok-n">belongsTo</span> <span class="tok-o">=</span> <span class="tok-o">[</span><span class="tok-nl">book:</span><span class="tok-n">Book</span><span class="tok-o">]</span>
    <span class="tok-o">....</span>
<span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>En este caso, las inserciones y los borrados se realizan en cascada. Si por ejemplo hacemos <em>new Book(actoper:new ActiveOperation()).save()</em> en primer lugar se crearÃ¡ una operaciÃ³n activa y posteriormente se crearÃ¡ el libro. De igual forma, si eliminamos el libro asociado a la operaciÃ³n activa, Ã©sta se eliminarÃ¡ tambiÃ©n de la base de datos.</p>
</div>
<div class="paragraph">
<p><em>Tercera forma de establecer una relaciÃ³n uno a uno</em></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-kd">class</span> <span class="tok-nc">Book</span><span class="tok-o">{</span>
    <span class="tok-o">....</span>
    <span class="tok-kd">static</span> <span class="tok-n">hasOne</span> <span class="tok-o">=</span> <span class="tok-o">[</span><span class="tok-nl">actoper:</span><span class="tok-n">ActiveOperation</span><span class="tok-o">]</span>

    <span class="tok-kd">static</span> <span class="tok-n">constraints</span> <span class="tok-o">=</span> <span class="tok-o">{</span>
        <span class="tok-n">actoper</span> <span class="tok-nl">unique:</span><span class="tok-kc">true</span>
    <span class="tok-o">}</span>
    <span class="tok-o">....</span>
<span class="tok-o">}</span>

<span class="tok-kd">class</span> <span class="tok-nc">ActiveOperation</span><span class="tok-o">{</span>
    <span class="tok-o">....</span>
    <span class="tok-n">Book</span> <span class="tok-n">book</span>
    <span class="tok-o">....</span>
<span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>En esta ocasiÃ³n, se crearÃ¡ una relaciÃ³n bidireccional de uno a uno entre los libros y las operaciones activas y se crearÃ¡ una columna de clave ajena en la tabla <em>active_operation</em> llamada <em>book_id</em>.</p>
</div>
<div class="paragraph">
<p>En estos casos, desde la documentaciÃ³n de Grails se aconseja que especifiquemos tambiÃ©n una restricciÃ³n indicando que la propiedad serÃ¡ Ãºnica.</p>
</div>
</div>
<div class="sect4">
<h5 id="_uno_a_muchos">Uno a muchos</h5>
<div class="paragraph">
<p>Una relaciÃ³n uno-a-muchos se da cuando un registro de la tabla A puede referenciar muchos registros de la tabla B, pero todos los registros de la tabla B sÃ³lo pueden referenciar un registro de la tabla A. Por ejemplo, en nuestra aplicaciÃ³n de ejemplo, una tarea sÃ³lo puede estar relacionada con una categorÃ­a, pero una categorÃ­a puede tener muchas tareas. Esto se representa de la siguiente forma en la definiciÃ³n de las clases de dominio.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-kd">class</span> <span class="tok-nc">Category</span> <span class="tok-o">{</span>
    <span class="tok-o">....</span>
    <span class="tok-kd">static</span> <span class="tok-n">hasMany</span> <span class="tok-o">=</span> <span class="tok-o">[</span><span class="tok-nl">todos:</span><span class="tok-n">Todo</span><span class="tok-o">]</span>
    <span class="tok-o">....</span>
<span class="tok-o">}</span>

<span class="tok-kd">class</span> <span class="tok-nc">Todo</span> <span class="tok-o">{</span>
    <span class="tok-o">....</span>
    <span class="tok-n">Category</span> <span class="tok-n">category</span>
    <span class="tok-o">....</span>
<span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Con esta definiciÃ³n de las clases de dominio, las actualizaciones y los almacenamientos se realizan en cascada mientras que los borrados sÃ³lo se realizarÃ¡n en cascada si especificamos la otra parte de la relaciÃ³n con un <em>belongsTo</em>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-kd">class</span> <span class="tok-nc">Category</span> <span class="tok-o">{</span>
    <span class="tok-o">....</span>
    <span class="tok-kd">static</span> <span class="tok-n">hasMany</span> <span class="tok-o">=</span> <span class="tok-o">[</span><span class="tok-nl">todos:</span><span class="tok-n">Todo</span><span class="tok-o">]</span>
    <span class="tok-o">....</span>
<span class="tok-o">}</span>

<span class="tok-kd">class</span> <span class="tok-nc">Todo</span> <span class="tok-o">{</span>
    <span class="tok-o">....</span>
    <span class="tok-kd">static</span> <span class="tok-n">belongsTo</span> <span class="tok-o">=</span> <span class="tok-o">[</span><span class="tok-nl">category:</span><span class="tok-n">Category</span><span class="tok-o">]</span>
    <span class="tok-o">....</span>
<span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Estas propiedades que representan la relaciÃ³n de uno a muchos son consideradas como colecciones de datos y para insertar o eliminar datos de las mismas Ãºnicamente debemos utilizar un par de mÃ©todos de GORM que son <em>addTo()</em> y <em>removeFrom()</em>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-c1">//Ejemplo para insertar datos en relaciones</span>
<span class="tok-kt">def</span> <span class="tok-n">todo</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">Todo</span><span class="tok-o">(</span><span class="tok-nl">title:</span><span class="tok-s2">&quot;Limpiar cocina&quot;</span><span class="tok-o">,</span> <span class="tok-nl">description:</span><span class="tok-s2">&quot;Limpiar la cocina a fondo&quot;</span><span class="tok-o">,</span> <span class="tok-o">...)</span>

<span class="tok-kt">def</span> <span class="tok-n">category</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">Category</span><span class="tok-o">(</span><span class="tok-nl">name:</span><span class="tok-s2">&quot;Hogar&quot;</span><span class="tok-o">)</span>

<span class="tok-n">category</span><span class="tok-o">.</span><span class="tok-na">addToTodos</span><span class="tok-o">(</span><span class="tok-n">todo</span><span class="tok-o">)</span>
<span class="tok-n">category</span><span class="tok-o">.</span><span class="tok-na">save</span><span class="tok-o">()</span>

<span class="tok-c1">//Ejemplo para eliminar datos de relaciones</span>
<span class="tok-n">category</span><span class="tok-o">.</span><span class="tok-na">removeFromTodos</span><span class="tok-o">(</span><span class="tok-n">todo</span><span class="tok-o">)</span>
<span class="tok-n">category</span><span class="tok-o">.</span><span class="tok-na">save</span><span class="tok-o">()</span>

<span class="tok-c1">//Ejemplo para buscar tareas dentro de una categorÃ­a</span>
<span class="tok-kt">def</span> <span class="tok-n">todosfound</span> <span class="tok-o">=</span> <span class="tok-n">category</span><span class="tok-o">.</span><span class="tok-na">todos</span><span class="tok-o">.</span><span class="tok-na">find</span> <span class="tok-o">{</span><span class="tok-n">it</span><span class="tok-o">.</span><span class="tok-na">title</span> <span class="tok-o">=</span> <span class="tok-s2">&quot;Limpiar cocina&quot;</span><span class="tok-o">}</span></code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_muchos_a_muchos">Muchos a muchos</h5>
<div class="paragraph">
<p>En una relaciÃ³n muchos-a-muchos un registro de la tabla A puede referenciar muchos registros de la tabla B y un registro de la tabla B referenciar igualmente muchos registros de la tabla A. En nuestra aplicaciÃ³n ejemplo  disponemos de la relaciÃ³n entre tareas y etiquetas en la que una tarea puede estar relacionada con muchas etiquetas y viceversa. Esto se representa con una relaciÃ³n muchos-a-muchos de la siguiente forma.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-kd">class</span> <span class="tok-nc">Tag</span><span class="tok-o">{</span>
    <span class="tok-o">....</span>
    <span class="tok-kd">static</span> <span class="tok-n">hasMany</span> <span class="tok-o">=</span> <span class="tok-o">[</span><span class="tok-nl">todos:</span><span class="tok-n">Todo</span><span class="tok-o">]</span>
    <span class="tok-o">....</span>
<span class="tok-o">}</span>

<span class="tok-kd">class</span> <span class="tok-nc">Todo</span><span class="tok-o">{</span>
    <span class="tok-o">....</span>
    <span class="tok-kd">static</span> <span class="tok-n">hasMany</span> <span class="tok-o">=</span> <span class="tok-o">[</span><span class="tok-nl">tags:</span><span class="tok-n">Tag</span><span class="tok-o">]</span>
    <span class="tok-kd">static</span> <span class="tok-n">belongsTo</span> <span class="tok-o">=</span> <span class="tok-n">Tag</span>
    <span class="tok-o">....</span>
<span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>En GORM, una relaciÃ³n muchos-a-muchos se representa indicando en ambas clases la propiedad <em>hasMany</em> y en al menos una de ellas la propiedad <em>belongsTo</em>.</p>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_restricciones">5.2. Restricciones</h3>
<div class="paragraph">
<p>El siguiente punto que vamos a ver trata a fondo las definiciones de restricciones en las clases de dominios.</p>
</div>
<div class="sect3">
<h4 id="_restricciones_predefinidas_en_gorm">5.2.1. Restricciones predefinidas en GORM</h4>
<div class="paragraph">
<p>Para controlar estas restricciones, GORM dispone de una serie de funciones comunes predefinidas para establecerlas. AdemÃ¡s, tambiÃ©n nos permitirÃ¡ crear nuestras propias restricciones. Hasta ahora, ya hemos visto algunas de estas restricciones como pueden ser <em>size</em>, <em>unique</em> o <em>blank</em> entre otras. Recordamos que para establecer las restricciones de una clase de dominio debemos establecer la propiedad estÃ¡tica <em>constraints</em> como en el siguiente ejemplo.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-kn">package</span> <span class="tok-n">es</span><span class="tok-o">.</span><span class="tok-na">ua</span><span class="tok-o">.</span><span class="tok-na">expertojava</span><span class="tok-o">.</span><span class="tok-na">todo</span>

<span class="tok-kd">class</span> <span class="tok-nc">Todo</span> <span class="tok-o">{</span>
    <span class="tok-n">String</span> <span class="tok-n">title</span>
    <span class="tok-n">String</span> <span class="tok-n">description</span>
    <span class="tok-n">Date</span> <span class="tok-n">date</span>
    <span class="tok-n">Date</span> <span class="tok-n">reminderDate</span>
    <span class="tok-n">String</span> <span class="tok-n">url</span>
    <span class="tok-n">Boolean</span> <span class="tok-n">done</span> <span class="tok-o">=</span> <span class="tok-kc">false</span>
    <span class="tok-n">Category</span> <span class="tok-n">category</span>

    <span class="tok-kd">static</span> <span class="tok-n">hasMany</span> <span class="tok-o">=</span> <span class="tok-o">[</span><span class="tok-nl">tags:</span><span class="tok-n">Tag</span><span class="tok-o">]</span>
    <span class="tok-kd">static</span> <span class="tok-n">belongsTo</span> <span class="tok-o">=</span> <span class="tok-o">[</span><span class="tok-n">Tag</span><span class="tok-o">]</span>

    <span class="tok-kd">static</span> <span class="tok-n">constraints</span> <span class="tok-o">=</span> <span class="tok-o">{</span>
        <span class="tok-n">title</span><span class="tok-o">(</span><span class="tok-nl">blank:</span><span class="tok-kc">false</span><span class="tok-o">)</span>
        <span class="tok-n">description</span><span class="tok-o">(</span><span class="tok-nl">blank:</span><span class="tok-kc">true</span><span class="tok-o">,</span> <span class="tok-nl">nullable:</span><span class="tok-kc">true</span><span class="tok-o">,</span> <span class="tok-nl">maxSize:</span><span class="tok-mi">1000</span><span class="tok-o">)</span>
        <span class="tok-n">date</span><span class="tok-o">(</span><span class="tok-nl">nullable:</span><span class="tok-kc">false</span><span class="tok-o">)</span>
        <span class="tok-n">reminderDate</span><span class="tok-o">(</span><span class="tok-nl">nullable:</span><span class="tok-kc">true</span><span class="tok-o">)</span>
        <span class="tok-n">url</span><span class="tok-o">(</span><span class="tok-nl">nullable:</span><span class="tok-kc">true</span><span class="tok-o">,</span> <span class="tok-nl">url:</span><span class="tok-kc">true</span><span class="tok-o">)</span>
        <span class="tok-n">done</span><span class="tok-o">(</span><span class="tok-nl">nullable:</span><span class="tok-kc">false</span><span class="tok-o">)</span>
        <span class="tok-n">category</span><span class="tok-o">(</span><span class="tok-nl">nullable:</span><span class="tok-kc">true</span><span class="tok-o">)</span>
    <span class="tok-o">}</span>

    <span class="tok-n">String</span> <span class="tok-nf">toString</span><span class="tok-o">(){</span>
        <span class="tok-n">title</span>
    <span class="tok-o">}</span>
<span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>A continuaciÃ³n, vamos veremos las restricciones que podemos utilizar directamente con GORM.</p>
</div>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 33%;">
<col style="width: 33%;">
<col style="width: 33%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Nombre</th>
<th class="tableblock halign-left valign-top">DescripciÃ³n</th>
<th class="tableblock halign-left valign-top">Ejemplo</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">blank</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Valida si la cadena puede quedar o no vacÃ­a</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">login(blank:false)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">creditCard</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Valida si la cadena introducida es un nÃºmero de tarjeta correcto</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">tarjetaCredito(creditCard:true)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">email</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Valida si la cadena introducida es un correo electrÃ³nico correcto</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">correoElectronico(email:true)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">password</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indica si la propiedad es una contraseÃ±a, con lo que al introducirla no se mostrarÃ¡ directamente</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">contrasenya(password:true)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">inList</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Valida que la propiedad contenga cualquiera de los valores pasados por parÃ¡metro</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">tipo(inList:["administrador", "bibliotecario", "profesor", "socio"])</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">matches</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Valida la cadena introducida contra una expresiÃ³n regular pasada por parÃ¡metro</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">login(matches:"[a-zA-Z]+")</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">max</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Valida que el nÃºmero introducido no sea mayor que el nÃºmero pasado por parÃ¡metro</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">price(max:999F)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">min</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Valida que el nÃºmero introducido no sea menor que el nÃºmero pasado por parÃ¡metro</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">price(min:0F)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">minSize</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Valida que la longitud de la cadena introducida sea superior al nÃºmero pasado por parÃ¡metro</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">hijos(minSize:5)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">maxSize</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Valida que la longitud de la cadena introducida sea inferior al nÃºmero pasado por parÃ¡metro</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">hijos(maxSize:15)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">notEqual</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Valida que el objeto asignado a la propiedad no sea igual que el objeto pasado por parÃ¡metro</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">login(notEqual:"admin")</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">nullable</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Valida si el objeto puede ser <em>null</em> o no</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">edad(nullable:true)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">range</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Valida que el objeto estÃ© dentro del rango pasado por parÃ¡metro</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">edad(range:0..99)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">scale</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indica el nÃºmero de decimales de la propiedad</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">salario(scale:2)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">size</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Valida que la longitud de la cadena estÃ© dentro del rango pasado por parÃ¡metro</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">login(size:5..15)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">unique</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Especifica que la propiedad debe ser Ãºnica y no se puede repetir ningÃºn objeto</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">login(unique:true)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">url</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Valida que la cadena introducida sea una direcciÃ³n URL correcta</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">website(url:true)</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Pero ademÃ¡s de estas restricciones, Grails tambiÃ©n tiene otras mÃ¡s que suponen una serie de cambios en la interfaz de usuario generado y aunque no es muy recomendable mezclar este tipo de informaciÃ³n en las clases de dominio, cuando usamos el scaffolding en gran parte de nuestro proyecto, es muy cÃ³modo indicarle algunas particularidades a nuestro proyecto para facilitarle su renderizado. Estas restricciones son las siguientes:</p>
</div>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 33%;">
<col style="width: 33%;">
<col style="width: 33%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Nombre</th>
<th class="tableblock halign-left valign-top">DescripciÃ³n</th>
<th class="tableblock halign-left valign-top">Ejemplo</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">display</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indica si la propiedad debe mostrare o no en las vistas generadas por el scaffolding. El valor por defecto es <em>true</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">password(display:false)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">editable</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indica si la propiedad es editable o no. Se suele utilizar en aquellas propiedades de solo lectura</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">username(editable:false)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">format</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Especifica el formato aceptado en aquellos tipos que lo acepten, como pueden ser las fechas</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">dateOfBirth(format:'yyyy-MM-dd')</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">password</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indica si la propiedad es una contraseÃ±a, con lo que al introducirla no se mostrarÃ¡ directamente</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">password(password:true)</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="_construir_tus_propias_restricciones">5.2.2. Construir tus propias restricciones</h4>
<div class="paragraph">
<p>Pero serÃ­amos un tanto ilusos si pensÃ¡ramos que el equipo de desarrollo de Grails ha sido capaz de crear todas las posibles restricciones existentes en cualquier aplicaciÃ³n. Ellos no lo han hecho, pero si han dejado la posibilidad de crear nuestras propias restricciones de una forma rÃ¡pida y sencilla.</p>
</div>
<div class="paragraph">
<p>Si echamos un vistazo a la clase de dominio <em>Todo</em>, podemos detectar que una posible restricciÃ³n que nos falta por aÃ±adir serÃ­a la comprobaciÃ³n de que la <em>fecha</em> sea posterior a la fecha actual. Para esta restricciÃ³n, Grails se ha olvidado de nosotros ya que si repasamos la lista de restricciones predefinidas, no encontramos ninguna que satisfaga dicha restricciÃ³n. Para crear nuevas restricciones, tenemos el closure <em>validator</em>. Veamos como quedarÃ­a esta restricciÃ³n:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-n">date</span><span class="tok-o">(</span><span class="tok-nl">nullable:</span><span class="tok-kc">true</span><span class="tok-o">,</span>
    <span class="tok-nl">validator:</span> <span class="tok-o">{</span>
        <span class="tok-k">if</span> <span class="tok-o">(</span><span class="tok-n">it</span><span class="tok-o">)</span> <span class="tok-o">{</span>
            <span class="tok-k">return</span> <span class="tok-n">it</span><span class="tok-o">?.</span><span class="tok-na">after</span><span class="tok-o">(</span><span class="tok-k">new</span> <span class="tok-n">Date</span><span class="tok-o">())</span>
        <span class="tok-o">}</span>
        <span class="tok-k">return</span> <span class="tok-kc">true</span>
    <span class="tok-o">}</span>
<span class="tok-o">)</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>El closure <em>validator</em> debe devolver <em>true</em> en caso de que la validaciÃ³n se pase correctamente y <em>false</em> en caso contrario. Gracias a la variable <em>it</em> podemos acceder al valor introducido para analizarlo y comprobar que cumple los requisitos, en este caso, que la fecha no sea anterior a la actual.</p>
</div>
<div class="paragraph">
<p>Este closure <em>validator</em> tambiÃ©n puede recibir un par de parÃ¡metros que nos permitirÃ¡ evaluar el valor proporcionado a una propiedad con respecto a cualquier otra propiedad del objeto. El siguiente ejemplo de restricciÃ³n nos permitirÃ¡ comprobar que la fecha de recordatorio sea siempre anterior a la fecha de la propia tarea:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-n">reminderDate</span><span class="tok-o">(</span><span class="tok-nl">nullable:</span><span class="tok-kc">true</span><span class="tok-o">,</span>
    <span class="tok-nl">validator:</span> <span class="tok-o">{</span> <span class="tok-n">val</span><span class="tok-o">,</span> <span class="tok-n">obj</span> <span class="tok-o">-&gt;</span>
        <span class="tok-k">if</span> <span class="tok-o">(</span><span class="tok-n">val</span> <span class="tok-o">&amp;&amp;</span> <span class="tok-n">obj</span><span class="tok-o">.</span><span class="tok-na">date</span><span class="tok-o">)</span> <span class="tok-o">{</span>
            <span class="tok-k">return</span> <span class="tok-n">val</span><span class="tok-o">.</span><span class="tok-na">before</span><span class="tok-o">(</span><span class="tok-n">obj</span><span class="tok-o">?.</span><span class="tok-na">date</span><span class="tok-o">)</span>
        <span class="tok-o">}</span>
        <span class="tok-k">return</span> <span class="tok-kc">true</span>
    <span class="tok-o">}</span>
<span class="tok-o">)</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>En ocasiones es conveniente reutilizar el cÃ³digo de una restricciÃ³n en diferentes propiedades de diferentes clases de dominio. Para ello en lugar de definir la restricciÃ³n en la clase de dominio la definiremos en el archivo de configuraciÃ³n <em>Config.groovy</em> de la siguiente forma:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-n">grails</span><span class="tok-o">.</span><span class="tok-na">gorm</span><span class="tok-o">.</span><span class="tok-na">default</span><span class="tok-o">.</span><span class="tok-na">constraints</span> <span class="tok-o">=</span> <span class="tok-o">{</span>
    <span class="tok-n">max20chars</span><span class="tok-o">(</span><span class="tok-nl">nullable:</span> <span class="tok-kc">false</span><span class="tok-o">,</span> <span class="tok-nl">blank:</span> <span class="tok-kc">false</span><span class="tok-o">,</span> <span class="tok-nl">maxSize:</span><span class="tok-mi">20</span><span class="tok-o">)</span>
<span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Posteriormente en la propiedad que necesites utilizar esta restricciÃ³n, debes referenciarla de esta forma:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-kd">class</span> <span class="tok-nc">User</span> <span class="tok-o">{</span>
    <span class="tok-o">...</span>
    <span class="tok-kd">static</span> <span class="tok-n">constraints</span> <span class="tok-o">=</span> <span class="tok-o">{</span>
        <span class="tok-n">password</span> <span class="tok-nl">shared:</span> <span class="tok-s2">&quot;max20chars&quot;</span>
    <span class="tok-o">}</span>
<span class="tok-o">}</span></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_mensajes_de_error_de_las_restricciones">5.2.3. Mensajes de error de las restricciones</h4>
<div class="paragraph">
<p>Sin lugar a dudas, los mensajes que se generan cuando se produce un error en las restricciones de una clase de dominio, no son lo mÃ¡s deseable para un usuario final, asÃ­ que es necesario que entendamos el mecanismo que utiliza Grails para devolver estos mensajes cuando se producen estos errores.</p>
</div>
<div class="paragraph">
<p>Si recordamos la clase de dominio <em>Todo</em>, tenemos que el tÃ­tulo no puede dejarse vacÃ­o. Esto lo hacÃ­amos utilizando la restricciÃ³n <em>blank:false</em>. Al intentar crear una tarea sin escribir su tÃ­tulo, recibiremos un mensaje de error como el siguiente <em>La propiedad [title] de la clase [class Todo] no puede ser vacÃ­a</em>. Pero, Â¿cÃ³mo se encarga Grails de mostrar estos mensajes de error?</p>
</div>
<div class="paragraph">
<p>Grails implementa un sistema jerÃ¡rquico para los mensajes de error basado en diferentes aspectos como puede ser el nombre de la clase de dominio, la propiedad o el tipo de validaciÃ³n. Para el caso del error producido al saltarnos la restricciÃ³n de no dejar en blanco el campo <em>title</em> de la clase de dominio <em>Todo</em>, dicha jerarquÃ­a serÃ­a la siguiente.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-n">todo</span><span class="tok-o">.</span><span class="tok-na">title</span><span class="tok-o">.</span><span class="tok-na">blank</span><span class="tok-o">.</span><span class="tok-na">error</span><span class="tok-o">.</span><span class="tok-na">title</span>
<span class="tok-n">todo</span><span class="tok-o">.</span><span class="tok-na">title</span><span class="tok-o">.</span><span class="tok-na">blank</span><span class="tok-o">.</span><span class="tok-na">error</span><span class="tok-o">.</span><span class="tok-na">java</span><span class="tok-o">.</span><span class="tok-na">lang</span><span class="tok-o">.</span><span class="tok-na">String</span>
<span class="tok-n">todo</span><span class="tok-o">.</span><span class="tok-na">title</span><span class="tok-o">.</span><span class="tok-na">blank</span><span class="tok-o">.</span><span class="tok-na">error</span>
<span class="tok-n">todo</span><span class="tok-o">.</span><span class="tok-na">title</span><span class="tok-o">.</span><span class="tok-na">blank</span><span class="tok-o">.</span><span class="tok-na">title</span>
<span class="tok-n">todo</span><span class="tok-o">.</span><span class="tok-na">title</span><span class="tok-o">.</span><span class="tok-na">blank</span><span class="tok-o">.</span><span class="tok-na">java</span><span class="tok-o">.</span><span class="tok-na">lang</span><span class="tok-o">.</span><span class="tok-na">String</span>
<span class="tok-n">todo</span><span class="tok-o">.</span><span class="tok-na">title</span><span class="tok-o">.</span><span class="tok-na">blank</span>
<span class="tok-n">blank</span><span class="tok-o">.</span><span class="tok-na">title</span>
<span class="tok-n">blank</span><span class="tok-o">.</span><span class="tok-na">java</span><span class="tok-o">.</span><span class="tok-na">lang</span><span class="tok-o">.</span><span class="tok-na">String</span>
<span class="tok-n">blank</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Este serÃ­a el orden en el que Grails buscarÃ­a en nuestro archivo <em>message.properties</em> hasta encontrar cualquier propiedad y mostrar su mensaje. En caso de no encontrar ninguna de estas propiedades, se mostrarÃ­a la cadena asociado a la propiedad <em>default.blank.message</em>, que es la que encontramos por defecto en el archivo <em>message.properties</em>.</p>
</div>
<div class="paragraph">
<p>De esta forma, ya podemos personalizar los mensajes de error generados al incumplir las restricciones de nuestras clases de dominio. Simplemente comentar que para las restricciones creadas por nosotros mismos, la jerarquÃ­a de los mensajes en el validador introducido en la clase de dominio <em>Todo</em> empezarÃ­a por <em>todo.date.validator.error.date</em> y asÃ­ sucesivamente tal y como hemos visto anteriormente.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_aspectos_avanzados_de_gorm">5.3. Aspectos avanzados de GORM</h3>
<div class="paragraph">
<p>Ahora que ya hemos visto la parte bÃ¡sica a la hora de crear una clase de dominio (establecer sus propiedades, las restricciones y las relaciones entre ellas), vayamos un paso mÃ¡s adelante y veamos aspectos algo mÃ¡s avanzados de GORM</p>
</div>
<div class="sect3">
<h4 id="_ajustes_de_mapeado">5.3.1. Ajustes de mapeado</h4>
<div class="paragraph">
<p>Hay ocasiones en que los administradores de las bases de datos quieren, por cualquier motivo, que las columnas de las tablas de <em>sus</em> bases de datos sean nombradas siguiendo un determinado patrÃ³n. Estos motivos pueden ir desde cuestiones de facilidad en la lectura de los campos hasta argumentos como <em>"asÃ­ se ha hecho toda la vida y no se va a cambiar"</em>. El tema estÃ¡ en que hay que conformarse con sus ordenes y acatarlas y encontrar la mejor forma para adaptarse a ellas.</p>
</div>
<div class="paragraph">
<p>Para solucionar este posible problema que se nos puede plantear en cualquier organizaciÃ³n, GORM dispone de una forma rÃ¡pida y sencilla para ajustar estos nombres de las columnas de las tablas relacionadas. Para ello, GORM emplea una sintaxis de tipo DSL y exige crear un nuevo closure estÃ¡tico llamado <em>mapping</em> de la siguiente forma <em>static mapping = {//Todo el mapeado de la tabla aquÃ­}</em>. Veamos los posibles cambios que podemos hacer con GORM.</p>
</div>
<div class="sect4">
<h5 id="_nombres_de_las_tablas_y_las_columnas">Nombres de las tablas y las columnas</h5>
<div class="paragraph">
<p>Si necesitÃ¡ramos cambiar por ejemplo el nombre de la tabla <em>todo</em> por <em>tbl_todo</em>, deberÃ­amos escribir dentro del closure <em>mapping</em> el siguiente cÃ³digo <em>table 'tbl_todo'</em>. Si ahora quisiÃ©ramos cambiar el nombre de la columna <em>description</em> por <em>desc</em>, podrÃ­amos hacer lo siguiente:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-kd">class</span> <span class="tok-nc">Todo</span> <span class="tok-o">{</span>
    <span class="tok-o">....</span>
    <span class="tok-kd">static</span> <span class="tok-n">mapping</span> <span class="tok-o">=</span> <span class="tok-o">{</span>
        <span class="tok-n">table</span> <span class="tok-s1">&#39;tbl_todo&#39;</span>
        <span class="tok-n">description</span> <span class="tok-nl">column:</span><span class="tok-s1">&#39;desc&#39;</span>
    <span class="tok-o">}</span>
<span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Con esto, ya tendrÃ­amos cambiados los nombres de las tablas y de las columnas para adaptarlos al convenio que nosotros queramos seguir.</p>
</div>
</div>
<div class="sect4">
<h5 id="_deshabilitar_el_campo_version">Deshabilitar el campo version</h5>
<div class="paragraph">
<p>Por defecto, GORM utiliza un campo llamado <em>version</em> para garantizar la integridad de los datos y estÃ¡ demostrado que es un buen mÃ©todo. Sin embargo, por cualquier motivo es posible que no queramos tener este campo en nuestra tabla y para ello, simplemente debemos especificar en el mapeado de la clase lo siguiente: <em>version false</em>.</p>
</div>
</div>
<div class="sect4">
<h5 id="_carga_perezosa_de_los_datos">Carga perezosa de los datos</h5>
<div class="paragraph">
<p>Por defecto, Grails realiza una carga perezosa de los datos de las propiedades. Esto es que no se cargarÃ¡n en memoria hasta que no sean solicitados por la operaciÃ³n, lo cual nos previene de posibles pÃ©rdidas de rendimiento al cargar demasiados datos innecesarios. Sin embargo, si queremos cambiar este comportamiento por defecto de Grails, podemos hacerlo de dos formas:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-kd">class</span> <span class="tok-nc">Person</span> <span class="tok-o">{</span>

    <span class="tok-n">String</span> <span class="tok-n">firstName</span> <span class="tok-n">Pet</span> <span class="tok-n">pet</span>

    <span class="tok-kd">static</span> <span class="tok-n">hasMany</span> <span class="tok-o">=</span> <span class="tok-o">[</span><span class="tok-nl">addresses:</span> <span class="tok-n">Address</span><span class="tok-o">]</span>

    <span class="tok-kd">static</span> <span class="tok-n">mapping</span> <span class="tok-o">=</span> <span class="tok-o">{</span>
        <span class="tok-n">addresses</span> <span class="tok-nl">lazy:</span> <span class="tok-kc">false</span>
        <span class="tok-n">pet</span> <span class="tok-nl">fetch:</span> <span class="tok-s1">&#39;join&#39;</span>
    <span class="tok-o">}</span>
<span class="tok-o">}</span>


<span class="tok-kd">class</span> <span class="tok-nc">Address</span> <span class="tok-o">{</span>
    <span class="tok-n">String</span> <span class="tok-n">street</span>
    <span class="tok-n">String</span> <span class="tok-n">postCode</span>
<span class="tok-o">}</span>


<span class="tok-kd">class</span> <span class="tok-nc">Pet</span> <span class="tok-o">{</span>
    <span class="tok-n">String</span> <span class="tok-n">name</span>
<span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Indicando <em>addresses lazy: false</em> nos aseguramos que cuando los datos de una persona se carguen en nuestra aplicaciÃ³n, sus direcciones serÃ¡n cargadas al mismo tiempo. Por otro lado, con la opciÃ³n <em>pet fetch:'join'</em> hacemos bÃ¡sicamente lo mismo salvo que en lugar de hacerlo con un <em>SELECT</em> como se estarÃ­a haciendo con la opciÃ³n anterior lo estarÃ­amos haciendo con una operaciÃ³n de tipo <em>JOIN</em>. Si queremos reducir el nÃºmero de queries y mejorar el rendimiento de la operaciÃ³n, deberÃ­amos utilizar la segunda opciÃ³n. Sin embargo, hay que tener cuidado con estas opciones ya que podemos cargar demasiados datos innecesarios.</p>
</div>
</div>
<div class="sect4">
<h5 id="_sistema_cachÃ©">Sistema cachÃ©</h5>
<div class="paragraph">
<p>Uno de las grandes ventajas de Hibernate es la posibilidad de utilizar una cachÃ© de segundo nivel, que almacena los datos asociados a una clase de dominio. Para configurar esta cachÃ© de segundo nivel, en primer lugar debemos modificar el archivo de configuraciÃ³n <em>grails-app/conf/DataSource.groovy</em> para indicarle quien se encargarÃ¡ de gestionar esta cachÃ©.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-n">hibernate</span> <span class="tok-o">{</span>
    <span class="tok-n">cache</span><span class="tok-o">.</span><span class="tok-na">use_second_level_cache</span> <span class="tok-o">=</span> <span class="tok-kc">true</span>
    <span class="tok-n">cache</span><span class="tok-o">.</span><span class="tok-na">use_query_cache</span> <span class="tok-o">=</span> <span class="tok-kc">true</span>
    <span class="tok-n">cache</span><span class="tok-o">.</span><span class="tok-na">region</span><span class="tok-o">.</span><span class="tok-na">factory_class</span> <span class="tok-o">=</span> <span class="tok-s1">&#39;net.sf.ehcache.hibernate.EhCacheRegionFactory&#39;</span>
    <span class="tok-n">singleSession</span> <span class="tok-o">=</span> <span class="tok-kc">true</span>
    <span class="tok-n">flush</span><span class="tok-o">.</span><span class="tok-na">mode</span> <span class="tok-o">=</span> <span class="tok-s1">&#39;manual&#39;</span>
<span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Posteriormente, para utilizar este sistema de cachÃ©, podemos especificarlo en la propia clase de dominio de la siguiente forma:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-kd">class</span> <span class="tok-nc">User</span> <span class="tok-o">{</span>
    <span class="tok-o">...</span>
    <span class="tok-kd">static</span> <span class="tok-n">mapping</span> <span class="tok-o">=</span> <span class="tok-o">{</span>
        <span class="tok-n">table</span> <span class="tok-s1">&#39;tbl_users&#39;</span>
        <span class="tok-n">cache</span> <span class="tok-kc">true</span>
    <span class="tok-o">}</span>
<span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Esta cachÃ© serÃ­a de tipo <em>lectura-escritura</em> e incluirÃ­a todas las propiedades, tanto las perezosas como las no perezosas. Pero tambiÃ©n es posible ser un poco mÃ¡s especÃ­fico e indicarle como queremos que se configure la cachÃ© de una determinada clase de dominio.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-kd">class</span> <span class="tok-nc">User</span> <span class="tok-o">{</span>
    <span class="tok-o">...</span>
    <span class="tok-kd">static</span> <span class="tok-n">mapping</span> <span class="tok-o">=</span> <span class="tok-o">{</span>
        <span class="tok-n">table</span> <span class="tok-s1">&#39;tbl_users&#39;</span>
        <span class="tok-n">cache</span> <span class="tok-nl">usage:</span> <span class="tok-s1">&#39;read-only&#39;</span><span class="tok-o">,</span> <span class="tok-nl">include:</span> <span class="tok-s1">&#39;non-lazy&#39;</span>
    <span class="tok-o">}</span>
<span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Incluso tambiÃ©n podemos especificar la cachÃ© para una asociaciÃ³n de la siguiente forma:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-kd">class</span> <span class="tok-nc">Person</span> <span class="tok-o">{</span>

    <span class="tok-n">String</span> <span class="tok-n">firstName</span>

    <span class="tok-kd">static</span> <span class="tok-n">hasMany</span> <span class="tok-o">=</span> <span class="tok-o">[</span><span class="tok-nl">addresses:</span> <span class="tok-n">Address</span><span class="tok-o">]</span>

    <span class="tok-kd">static</span> <span class="tok-n">mapping</span> <span class="tok-o">=</span> <span class="tok-o">{</span>
        <span class="tok-n">table</span> <span class="tok-s1">&#39;people&#39;</span>
        <span class="tok-n">version</span> <span class="tok-kc">false</span>
        <span class="tok-n">addresses</span> <span class="tok-nl">column:</span> <span class="tok-s1">&#39;Address&#39;</span><span class="tok-o">,</span> <span class="tok-nl">cache:</span> <span class="tok-kc">true</span>
    <span class="tok-o">}</span>
<span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>De esta forma, sÃ³lo estarÃ­amos cacheando la propiedad <em>addresses</em> de la clase <em>Person</em>.</p>
</div>
</div>
<div class="sect4">
<h5 id="_modificar_la_clave_primaria">Modificar la clave primaria</h5>
<div class="paragraph">
<p>En ocasiones podemos necesitar modificar el sistema de clave primaria que utiliza Grails por defecto en el que se aÃ±ade una propiedad llamada <em>id</em> autonumÃ©rico. PodrÃ­amos por ejemplo establecer como clave primaria de la tabla de las tareas la composiciÃ³n del tÃ­tulo y la categorÃ­a de la siguiente forma:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-kd">static</span> <span class="tok-n">mapping</span> <span class="tok-o">=</span> <span class="tok-o">{</span>
    <span class="tok-n">id</span> <span class="tok-nl">composite:</span> <span class="tok-o">[</span><span class="tok-s1">&#39;title&#39;</span><span class="tok-o">,</span> <span class="tok-s1">&#39;category&#39;</span><span class="tok-o">]</span>
<span class="tok-o">}</span></code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_herencia_de_clases">5.3.2. Herencia de clases</h4>
<div class="paragraph">
<p>La herencia de clases es algo muy comÃºn y GORM lo implementa de forma tan sencilla como <em>extendiendo</em> la clase. Por ejemplo, imagina el caso de una clase de dominio Usuario que a su vez puede tener 3 tipos distintos. PodrÃ­amos tener algo asÃ­:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-kd">class</span> <span class="tok-nc">User</span><span class="tok-o">{</span>
    <span class="tok-o">....</span>
<span class="tok-o">}</span>

<span class="tok-kd">class</span> <span class="tok-nc">Administrator</span> <span class="tok-kd">extends</span> <span class="tok-n">User</span><span class="tok-o">{</span>
    <span class="tok-o">....</span>
<span class="tok-o">}</span>

<span class="tok-kd">class</span> <span class="tok-nc">Registered</span> <span class="tok-kd">extends</span> <span class="tok-n">User</span><span class="tok-o">{</span>
    <span class="tok-o">....</span>
<span class="tok-o">}</span>

<span class="tok-kd">class</span> <span class="tok-nc">Guest</span> <span class="tok-kd">extends</span> <span class="tok-n">User</span><span class="tok-o">{</span>
    <span class="tok-o">....</span>
<span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Pero, Â¿cÃ³mo se transformarÃ­a esto en la base de datos? GORM habrÃ­a almacenado todos los datos en una Ãºnica tabla y ademÃ¡s, hubiera aÃ±adido un campo llamado <em>class</em> que permitirÃ­a distinguir el tipo de instancia creada. No obstante, si optÃ¡semos por tener una tabla por cada tipo de usuario, podrÃ­amos tener lo siguiente:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-kd">class</span> <span class="tok-nc">User</span><span class="tok-o">{</span>
    <span class="tok-o">....</span>
<span class="tok-o">}</span>

<span class="tok-kd">class</span> <span class="tok-nc">Administrator</span> <span class="tok-kd">extends</span> <span class="tok-n">User</span><span class="tok-o">{</span>
    <span class="tok-kd">static</span> <span class="tok-n">mapping</span> <span class="tok-o">=</span> <span class="tok-o">{</span>
        <span class="tok-n">table</span> <span class="tok-o">=</span> <span class="tok-s1">&#39;administrator&#39;</span>
    <span class="tok-o">}</span>
<span class="tok-o">}</span>

<span class="tok-kd">class</span> <span class="tok-nc">Registered</span> <span class="tok-kd">extends</span> <span class="tok-n">User</span><span class="tok-o">{</span>
    <span class="tok-kd">static</span> <span class="tok-n">mapping</span> <span class="tok-o">=</span> <span class="tok-o">{</span>
        <span class="tok-n">table</span> <span class="tok-o">=</span> <span class="tok-s1">&#39;registered&#39;</span>
    <span class="tok-o">}</span>
<span class="tok-o">}</span>

<span class="tok-kd">class</span> <span class="tok-nc">Guest</span> <span class="tok-kd">extends</span> <span class="tok-n">User</span><span class="tok-o">{</span>
    <span class="tok-kd">static</span> <span class="tok-n">mapping</span> <span class="tok-o">=</span> <span class="tok-o">{</span>
        <span class="tok-n">table</span> <span class="tok-o">=</span> <span class="tok-s1">&#39;guest&#39;</span>
    <span class="tok-o">}</span>
<span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Otra opciÃ³n serÃ­a especificar en la clase padre la propiedad <em>tablePerHierarchy</em> a falso de la siguiente forma:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-kd">class</span> <span class="tok-nc">User</span><span class="tok-o">{</span>
    <span class="tok-o">.....</span>
    <span class="tok-kd">static</span> <span class="tok-n">mapping</span> <span class="tok-o">=</span> <span class="tok-o">{</span>
        <span class="tok-n">tablePerHierarchy</span> <span class="tok-kc">false</span>
    <span class="tok-o">}</span>
<span class="tok-o">}</span></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_propiedades_transitorias">5.3.3. Propiedades transitorias</h4>
<div class="paragraph">
<p>Por defecto, con GORM todas las propiedades definidas en una clase de dominio son persistidas en la base de datos. Sin embargo, en ocasiones es posible que tengamos determinadas propiedades que no deseamos que sean almacenadas en la base de datos, tales como por ejemplo la confirmaciÃ³n de una contraseÃ±a por parte de un usuario. Para ello, podemos aÃ±adir una nueva propiedad llamada <em>transients</em> a la clase de dominio correspondiente con la propiedad que no deseamos persistir en la base de datos.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-kd">class</span> <span class="tok-nc">User</span> <span class="tok-o">{</span>
    <span class="tok-kd">static</span> <span class="tok-n">transients</span> <span class="tok-o">=</span> <span class="tok-o">[</span><span class="tok-s2">&quot;confirmPassword&quot;</span><span class="tok-o">]</span>

    <span class="tok-n">String</span> <span class="tok-n">username</span>
    <span class="tok-n">String</span> <span class="tok-n">password</span>
    <span class="tok-n">String</span> <span class="tok-n">confirmPassword</span>
    <span class="tok-n">String</span> <span class="tok-n">name</span>
    <span class="tok-n">String</span> <span class="tok-n">surnames</span>
<span class="tok-o">}</span></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_eventos_gorm">5.3.4. Eventos GORM</h4>
<div class="paragraph">
<p>GORM dispone de dos mÃ©todos que se llaman automÃ¡ticamente antes y despuÃ©s de insertar y actualizar las tablas de la base de datos. Estos mÃ©todos son <em>beforeInsert()</em> y <em>beforeUpdate()</em>. Gracias a estos mÃ©todos, vamos a poder realizar determinadas operaciones siempre antes de insertar o actualizar datos de nuestros registros. Por ejemplo, imagina el caso en el que tuviÃ©ramos que almacenar quien creÃ³ una tarea y quien fue la Ãºltima persona en actualizarla. NecesitarÃ­amos por ejemplo un par de propiedades llamadas <em>createdBy</em> y <em>lastModifiedBy</em>. Para automÃ¡ticamente actualizar esta informaciÃ³n en nuestra clase de dominio, podrÃ­amos utilizar los mÃ©todos <em>beforeInsert()</em> y <em>beforeUpdate()</em> de la siguiente forma:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-kd">class</span> <span class="tok-nc">Todo</span> <span class="tok-o">{</span>
    <span class="tok-o">....</span>
    <span class="tok-n">User</span> <span class="tok-n">createdBy</span>
    <span class="tok-n">User</span> <span class="tok-n">lastModifiedBy</span>

    <span class="tok-kt">def</span> <span class="tok-n">beforeInsert</span> <span class="tok-o">=</span> <span class="tok-o">{</span>
        <span class="tok-n">createdBy</span> <span class="tok-o">=</span> <span class="tok-n">session</span><span class="tok-o">?.</span><span class="tok-na">user</span>
        <span class="tok-n">lastModifiedBy</span> <span class="tok-o">=</span> <span class="tok-n">session</span><span class="tok-o">?.</span><span class="tok-na">user</span>
    <span class="tok-o">}</span>

    <span class="tok-kt">def</span> <span class="tok-n">beforeUpdate</span> <span class="tok-o">=</span> <span class="tok-o">{</span>
        <span class="tok-n">lastModifiedBy</span> <span class="tok-o">=</span> <span class="tok-n">session</span><span class="tok-o">?.</span><span class="tok-na">user</span>
    <span class="tok-o">}</span>
<span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>AdemÃ¡s de estos dos mÃ©todos comentados, GORM tambiÃ©n dispone de los mÃ©todos <em>beforeDelete()</em>, <em>beforeValidate()</em>, <em>afterInsert()</em>, <em>afterUpdate()</em>, <em>afterDelete()</em> y <em>onLoad()</em>.</p>
</div>
</div>
<div class="sect3">
<h4 id="_fechas_automÃ¡ticas">5.3.5. Fechas automÃ¡ticas</h4>
<div class="paragraph">
<p>Grails ademÃ¡s presenta una caracterÃ­stica conocida como <em>automatic timestamping</em>. Con esta caracterÃ­stica si queremos saber de una instancia de una determinada clase cuando se creo y cuando se modificÃ³ por Ãºltima vez, simplemente debemos crear dos propiedades de tipo <em>Date</em> en la clase de dominio llamadas <em>dateCreated</em> y <em>lastUpdated</em> y Grails se encargarÃ¡ automÃ¡ticamente de rellenar esta informaciÃ³n por nosotros.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-kd">class</span> <span class="tok-nc">Todo</span> <span class="tok-o">{</span>
    <span class="tok-o">....</span>
    <span class="tok-n">Date</span> <span class="tok-n">dateCreated</span>
    <span class="tok-n">Date</span> <span class="tok-n">lastUpdated</span>
<span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Si por cualquier motivo, deseamos tener estas dos propiedades pero desactivar el <em>automatic timestamping</em>, podemos hacerlo de la siguiente forma:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-kd">static</span> <span class="tok-n">mapping</span> <span class="tok-o">=</span> <span class="tok-o">{</span>
    <span class="tok-n">autoTimestamp</span> <span class="tok-kc">false</span>
<span class="tok-o">}</span></code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_interactuar_con_la_base_de_datos">5.4. Interactuar con la base de datos</h3>
<div class="paragraph">
<p>Cuando interactuamos con una base de datos, lo primero que debemos conocer es como realizar las operaciones bÃ¡sicas en cualquier aplicaciÃ³n (CRUD). Si echamos un vistazo al cÃ³digo del controlador de la clase de dominio <em>Todo</em>, detectaremos la presencia de los mÃ©todos <em>delete()</em> y <em>save()</em>. TambiÃ©n podemos comprobar como no existe ninguno de estos dos mÃ©todos implementados en la clase de dominio <em>Todo</em>. Entonces, Â¿cÃ³mo es capaz Grails de persistir la informaciÃ³n en la base de datos si ninguno de estos dos mÃ©todos existen?</p>
</div>
<div class="paragraph">
<p>En Grails tenemos varias formas de realizar consultas a la base de datos que son:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Consultas dinÃ¡micas de GORM</p>
</li>
<li>
<p>Consultas HQL de Hibernate</p>
</li>
<li>
<p>Consultas Criteria de Hibernate</p>
</li>
</ul>
</div>
<div class="sect3">
<h4 id="_consultas_dinÃ¡micas_de_gorm">5.4.1. Consultas dinÃ¡micas de GORM</h4>
<div class="paragraph">
<p>BÃ¡sicamente, la consultas dinÃ¡micas de GORM son muy similares a los mÃ©todos que habÃ©is visto en el mÃ³dulo de JPA con lo que Ãºnicamente veremos un resumen de las mismas.</p>
</div>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 14%;">
<col style="width: 42%;">
<col style="width: 42%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">MÃ©todo</th>
<th class="tableblock halign-left valign-top">DescripciÃ³n</th>
<th class="tableblock halign-left valign-top">Ejemplo</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>count()</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Devuelve el nÃºmero total de registros de una determinada clase de dominio</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>Todo.count()</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>countBy()</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Devuelve el nÃºmero total de registros de una determinada clase de dominio que cumplan una serie de requisitos encadenados tras el nombre del mÃ©todo</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>Todo.countByTitle('Pintar cocina')</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>findBy()</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Devuelve el primer registro encontrado de una determinada clase de dominio que cumpla una serie de requisitos encadenados tras el nombre del mÃ©todo</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>Todo.findByTitle('Pintar cocina')</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>findWhere()</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Devuelve el primer registro encontrado de una determinada clase de dominio que cumpla una serie de requisitos pasados por parÃ¡metro en forma de mapa</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>Todo.findWhere(["title":"Pintar cocina"])</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>findAllBy()</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Devuelve todos los registros encontrados de una determinada clase de dominio que cumplan una serie de requisitos encadenados tras el nombre del mÃ©todo</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>Todo.findAllByTitleIlike('%cocina%')</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>findAllWhere()</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Devuelve todos los registros encontrados de una determinada clase de dominio que cumplan una serie de requisitos pasados por parÃ¡metro en forma de mapa</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>Todo.findAllWhere(["title":"Pintar cocina"])</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>get()</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Devuelve el registro de una determinada clase de dominio cuyo identificador coincida con el pasado como parÃ¡metro</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>Todo.get(1)</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>getAll()</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Devuelve todos los registros de una determinada clase de dominio cuyo identificador coincida con cualquier de los pasados parÃ¡metro en forma de lista</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>Todo.getAll([1,3])</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>list()</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Devuelve todos los registros de una determinada clase de dominio. Acepta los parÃ¡metros <em>max</em>, <em>offset</em>, <em>sort</em> y <em>order</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>Todo.list(["max":10, "offset":0, "sort":"title", "order":"asc"])</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>listOrderBy()</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Devuelve todos los registros de una determinada clase de dominio ordenador por un criterio. Acepta los parÃ¡metros <em>max</em>, <em>offset</em> y <em>order</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>Todo.listOrderByName(["max":10, "offset":0, "order":"asc"])</em></p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Podemos ademÃ¡s encadenar varias propiedades junto con el operador utilizado, como por ejemplo:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-n">Todo</span><span class="tok-o">.</span><span class="tok-na">findAllByTitleAndDescriptionAndDone</span><span class="tok-o">(</span><span class="tok-s1">&#39;Pintar cocina&#39;</span><span class="tok-o">,</span><span class="tok-kc">null</span><span class="tok-o">,</span> <span class="tok-kc">false</span><span class="tok-o">)</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Seguido de la propiedad podemos indicar el mÃ©todo a seguir en la comparaciÃ³n de registros. En la siguiente tabla se muestra una tabla resumen de esos mÃ©todos que podemos utilizar en las comparaciones.</p>
</div>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 14%;">
<col style="width: 42%;">
<col style="width: 42%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">MÃ©todo</th>
<th class="tableblock halign-left valign-top">DescripciÃ³n</th>
<th class="tableblock halign-left valign-top">Ejemplo</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">InList</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Devuelve aquellos registros en los que el valor de la propiedad dada coincida con cualquiera de los elementos de la lista pasada por parÃ¡metro</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Category.findAllByNameInList(["Hogar","Trabajo"])</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">LessThan</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Devuelve aquellos registros en los que el valor de la propiedad dada sea menor que el valor pasado por parÃ¡metro</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">House.findAllByPriceLessThan(150000)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">LessThanEquals</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Devuelve aquellos registros en los que el valor de la propiedad dada sea menor o igual que el valor pasado por parÃ¡metro</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">House.findAllByPriceLessThanEquals(150000)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">GreaterThan</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Devuelve aquellos registros en los que el valor de la propiedad dada sea mayor que el valor pasado por parÃ¡metro</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Car.findAllByPriceGreaterThan(25000)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">GreaterThanEquals</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Devuelve aquellos registros en los que el valor de la propiedad dada sea mayor o igual que el valor pasado por parÃ¡metro</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Car.findAllByPriceGreaterThanEquals(25000)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Like</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Es equivalente a una expresiÃ³n <em>LIKE</em> en una sentencia SQL</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Todo.findAllByTitleLike('%cocina%')</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ILike</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Similar al mÃ©todo <em>Like</em> salvo que en esta ocasiÃ³n <em>case insensitive</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Todo.findAllByTitleIlike('%cocina%')</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">NotEqual</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Devuelve aquellos registros en los que el valor de la propiedad dada no sea igual al valor pasado por parÃ¡metro</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Todo.findAllByDoneNotEqual(true)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Between</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Devuelve aquellos registros en los que el valor de la propiedad dada se encuentre entre los dos valores pasados por parÃ¡metro. Necesita de dos parÃ¡metros.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Car.findAllByPriceBetween(10000,20000)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">IsNotNull</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Devuelve aquellos registros en los que el valor de la propiedad dada no sea nula. No se necesita ningÃºn argumento.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">User.findAllByDateOfBirthIsNotNull()</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">IsNull</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Devuelve aquellos registros en los que el valor de la propiedad dada sea nula</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">User.findAllByDateOfBirthIsNull()</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="_consultas_hql_de_hibernate">5.4.2. Consultas HQL de Hibernate</h4>
<div class="paragraph">
<p>Otra forma de realizar consultas sobre la base de datos es mediante el lenguaje de consulta propio de Hibernate, HQL (Hibernate Query Language). Con los mÃ©todos dinÃ¡micos de GORM vimos que tenÃ­amos la posibilidad de ejecutar llamadas a mÃ©todos para obtener un registro o un conjunto. Con HQL vamos a tener tambiÃ©n esta capacidad con los mÃ©todos <em>find()</em> y <em>findAll()</em> mÃ¡s uno nuevo llamado <em>executeQuery()</em>.</p>
</div>
<div class="paragraph">
<p>Con el mÃ©todo <em>find()</em> vamos a poder obtener el primer registro devuelto de la consulta HQL pasada por parÃ¡metro. El siguiente ejemplo, devuelve la primera tarea que encuentre en la clase de dominio <em>Todo</em>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-kt">def</span> <span class="tok-n">sentenciaHQL1</span> <span class="tok-o">=</span> <span class="tok-n">Todo</span><span class="tok-o">.</span><span class="tok-na">find</span><span class="tok-o">(</span><span class="tok-s2">&quot;From Todo as t&quot;</span><span class="tok-o">)</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Pero lo habitual no es simplemente obtener el primer registro sino que normalmente necesitaremos obtener todos los registros que cumplan una serie de condiciones para posteriormente, actuar en consecuencia. Al igual que con los mÃ©todos dinÃ¡micos de GORM, HQL dispone tambiÃ©n del mÃ©todo <em>findAll()</em> al cual debemos pasarle por parÃ¡metro la sentencia HQL correspondiente. En el siguiente ejemplo, vamos a ver tres formas diferentes de obtener determinadas tareas de nuestra aplicaciÃ³n.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-kt">def</span> <span class="tok-n">hqlsentence2</span> <span class="tok-o">=</span> <span class="tok-n">Todo</span><span class="tok-o">.</span><span class="tok-na">findAll</span><span class="tok-o">(</span><span class="tok-s2">&quot;from Todo as t where t.title=&#39;Pintar cocina&#39;&quot;</span><span class="tok-o">)</span>

<span class="tok-kt">def</span> <span class="tok-n">hqlsentence3</span> <span class="tok-o">=</span> <span class="tok-n">Todo</span><span class="tok-o">.</span><span class="tok-na">findAll</span><span class="tok-o">(</span><span class="tok-s2">&quot;from Todo as t where t.title=?&quot;</span><span class="tok-o">,</span> <span class="tok-o">[</span><span class="tok-s2">&quot;Escribir tests unitarios&quot;</span><span class="tok-o">])</span>

<span class="tok-kt">def</span> <span class="tok-n">hqlsentence4</span> <span class="tok-o">=</span> <span class="tok-n">Todo</span><span class="tok-o">.</span><span class="tok-na">findAll</span><span class="tok-o">(</span><span class="tok-s2">&quot;from Todo as t where t.title=:title&quot;</span><span class="tok-o">,</span> <span class="tok-o">[</span><span class="tok-nl">title:</span><span class="tok-s2">&quot;Cocinar pastel&quot;</span><span class="tok-o">])</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>En la primera de ellas, la sentencia HQL se pasa como parÃ¡metro al mÃ©todo <em>findAll()</em> tal cual y sin utilizar ningÃºn parÃ¡metro. TambiÃ©n es posible pasar parÃ¡metros a la sentencia HQL tal y como se ha hecho en la segunda forma. Utilizando el caracter <em>?</em> le especificamos que es valor se pasarÃ¡ en forma de parÃ¡metro posicional, es decir, el primer caracter <em>?</em> encontrado en la sentencia HQL se referirÃ¡ al primer parÃ¡metro pasado, el segundo <em>?</em> al segundo parÃ¡metro y asÃ­ sucesivamente.</p>
</div>
<div class="paragraph">
<p>Otra forma posible de implementar sentencias HQL es pasando un mapa con las variables introducidas en la sentencia HQL. Para introducir una variable en una sentencia HQL basta con escribir el carÃ¡cter <em>:</em> seguido del nombre de la variable que deseemos crear. En el ejemplo hemos creado la variable <em>title</em>, que posteriormente se rellenarÃ¡ en el mapa pasado como parÃ¡metro.</p>
</div>
<div class="paragraph">
<p>De igual forma que veÃ­amos anteriormente con los mÃ©todos <em>list()</em> y <em>listOrderBy()</em>, HQL permite utilizar los parÃ¡metros <em>max</em>, <em>offset</em>, <em>sort</em> y <em>order</em> para afinar aÃºn mÃ¡s la bÃºsqueda.</p>
</div>
<div class="paragraph">
<p>Por Ãºltimo, el mÃ©todo <em>executeQuery()</em> es algo diferente a los mÃ©todos <em>find()</em> y <em>findAll()</em>. En estos dos mÃ©todos se devolvÃ­an todas las columnas de la tabla en cuestiÃ³n, cosa que no siempre puede ser necesaria. El mÃ©todo <em>executeQuery()</em> permite seleccionar que columnas vamos a devolver. El siguiente ejemplo devuelve sÃ³lo la <em>fecha</em> de la tarea cuyo tÃ­tulo sea "Pintar cocina".</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-n">Todo</span><span class="tok-o">.</span><span class="tok-na">executeQuery</span><span class="tok-o">(</span><span class="tok-s2">&quot;select date from Todo t where t.title=&#39;Pintar cocina&#39;&quot;</span><span class="tok-o">)</span></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_consultas_criteria_de_hibernate">5.4.3. Consultas Criteria de Hibernate</h4>
<div class="paragraph">
<p>El Ãºltimo mÃ©todo para realizar consultas a la base de datos se refiere a la utilizaciÃ³n de <em>Criteria</em>, un API de Hibernate diseÃ±ado especÃ­ficamente para la realizaciÃ³n de consultas complejas. En Grails, Criteria estÃ¡ basado en un <em>Builder de Groovy</em> y el cÃ³digo mostrado a continuaciÃ³n es un ejemplo de utilizaciÃ³n de Ã©ste. En este ejemplo vamos a ver como podrÃ­amos obtener un listado de las siguientes 15 tareas a realizar en los prÃ³ximos 10 dÃ­as ordenadas ascendentemente.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-kt">void</span> <span class="tok-nf">nextTodos</span><span class="tok-o">()</span> <span class="tok-o">{</span>
    <span class="tok-kt">def</span> <span class="tok-n">c</span> <span class="tok-o">=</span> <span class="tok-n">Todo</span><span class="tok-o">.</span><span class="tok-na">createCriteria</span><span class="tok-o">()</span>
    <span class="tok-kt">def</span> <span class="tok-n">result</span> <span class="tok-o">=</span> <span class="tok-n">c</span><span class="tok-o">{</span>
        <span class="tok-n">between</span><span class="tok-o">(</span><span class="tok-s2">&quot;date&quot;</span><span class="tok-o">,</span><span class="tok-k">new</span> <span class="tok-n">Date</span><span class="tok-o">(),</span><span class="tok-k">new</span> <span class="tok-n">Date</span><span class="tok-o">()+</span><span class="tok-mi">10</span><span class="tok-o">)</span>
        <span class="tok-n">maxResults</span><span class="tok-o">(</span><span class="tok-mi">15</span><span class="tok-o">)</span>
        <span class="tok-n">order</span><span class="tok-o">(</span><span class="tok-s2">&quot;date&quot;</span><span class="tok-o">,</span><span class="tok-s2">&quot;asc&quot;</span><span class="tok-o">)</span>
    <span class="tok-o">}</span>
<span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Criteria dispone de una serie de <em>criterios</em> disponibles para ser utilizados en este tipo de consultas. En el ejemplo hemos utilizado <em>between</em>, <em>maxResults</em> y <em>order</em>, pero existen muchos mÃ¡s que vamos a ver en la siguiente tabla.</p>
</div>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 14%;">
<col style="width: 42%;">
<col style="width: 42%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Criterio</th>
<th class="tableblock halign-left valign-top">DescripciÃ³n</th>
<th class="tableblock halign-left valign-top">Ejemplo</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">between</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Cuando el valor de la propiedad se encuentra entre dos valores</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>between("date",new Date()-10, new Date())</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">eq</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Cuando el valor de una propiedad es igual al valor pasado por parÃ¡metro</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>eq("make","volkswagen")</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">eqProperty</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Cuando dos propiedades tienen el mismo valor</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>eqProperty("startDate","endDate")</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">gt</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Cuando el valor de una propiedad es mayor que el valor pasado por parÃ¡metro</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>gt("date",new Date()-5)</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">gtProperty</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Cuando el valor de una propiedad es mayor que el valor de la propiedad pasada por parÃ¡metro</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>gtProperty("startDate","endDate")</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ge</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Cuando el valor de una propiedad es mayor o igual que el valor pasado por parÃ¡metro</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>ge("date", new Date()-5)</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">geProperty</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Cuando el valor de una propiedad es mayor o igual que el valor de la propiedad pasada por parÃ¡metro</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>geProperty("startDate", "endDate")</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">idEq</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Cuando el identificador de un objeto es igual al valor pasado por parÃ¡metro</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>idEq(1)</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ilike</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">La sentencia SQL like, pero en modo <em>case insensitive</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>ilike("name", "fran%")</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">in</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Cuando el valor de la propiedad es cualquiera de los valores pasados por parÃ¡metro. In es una palabra reservada en Groovy, asÃ­ que debemos utilizar las comillas simples</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>'in'("age",[18..65])</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">isEmpty</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Cuando la propiedad se encuentra vacÃ­a</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>isEmpty("description")</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">isNotEmpty</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Cuando la propiedad no se encuentra vacÃ­a</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>isNotEmpty("description")</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">isNull</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Cuando el valor de la propiedad es <em>null</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>isNull("description")</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">isNotNull</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Cuando el valor de la propiedad no es <em>null</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>isNotNull("description")</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">lt</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Cuando el valor de una propiedad es menor que el valor pasado por parÃ¡metro</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>lt("startDate",new Date()-5)</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ltProperty</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Cuando el valor de una propiedad es menor que el valor de la propiedad pasada por parÃ¡metro</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>ltProperty("startDate","endDate")</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">le</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Cuando el valor de una propiedad es menor o igual que el valor pasado por parÃ¡metro</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>le("startDate",new Date()-5)</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">leProperty</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Cuando el valor de una propiedad es menor o igual que el valor de la propiedad pasada por parÃ¡metro</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>leProperty("startDate","endDate")</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">like</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">La sentencia SQL like</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>like("name","Fran%")</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ne</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Cuando el valor de una propiedad no es igual al valor pasado por parÃ¡metro</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>ne("model","volkswagen")</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">neProperty</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Cuando el valor de una propiedad no es igual al valor de la propiedad pasada por parÃ¡metro</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>neProperty("startDate","endDate")</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">order</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Ordena los resultados por la propiedad pasada por parÃ¡metro y en el orden especificado (asc o desc)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>order("name","asc")</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">rlike</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Similar a la sentencia SQL like, pero utilizando expresiones regulares. SÃ³lo estÃ¡ disponible para Oracle y MySQL</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>rlike("name",/Fran.+/)</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">sizeEq</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Cuando el tamaÃ±o del valor de una determinada propiedad es igual al pasado por parÃ¡metro</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>sizeEq("name",10)</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">sizeGt</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Cuando el tamaÃ±o del valor de una determinada propiedad es mayor al pasado por parÃ¡metro</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>sizeGt("name",10)</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">sizeGe</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Cuando el tamaÃ±o del valor de una determinada propiedad es mayor o igual al pasado por parÃ¡metro</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>sizeGe("name",10)</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">sizeLt</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Cuando el tamaÃ±o del valor de una determinada propiedad es menor al pasado por parÃ¡metro</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>sizeLt("name",10)</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">sizeLe</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Cuando el tamaÃ±o del valor de una determinada propiedad es menor o igual al pasado por parÃ¡metro</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>sizeLe("name",10)</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">sizeNe</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Cuando el tamaÃ±o del valor de una determinada propiedad no es igual al pasado por parÃ¡metro</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>sizeNe("name",10)</em></p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Los criterios de bÃºsqueda se pueden incluso agrupar en bloques lÃ³gicos. Estos bloques lÃ³gicos serÃ¡n del tipo <em>AND</em>, <em>OR</em> y <em>NOT</em>. Veamos algunos ejemplos.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-n">and</span> <span class="tok-o">{</span>
    <span class="tok-n">between</span><span class="tok-o">(</span><span class="tok-s2">&quot;date&quot;</span><span class="tok-o">,</span> <span class="tok-k">new</span> <span class="tok-n">Date</span><span class="tok-o">()-</span><span class="tok-mi">10</span><span class="tok-o">,</span> <span class="tok-k">new</span> <span class="tok-n">Date</span><span class="tok-o">())</span>
    <span class="tok-n">ilike</span><span class="tok-o">(</span><span class="tok-s2">&quot;content&quot;</span><span class="tok-o">,</span> <span class="tok-s2">&quot;%texto%&quot;</span><span class="tok-o">)</span>
<span class="tok-o">}</span>

<span class="tok-n">or</span> <span class="tok-o">{</span>
    <span class="tok-n">between</span><span class="tok-o">(</span><span class="tok-s2">&quot;date&quot;</span><span class="tok-o">,</span> <span class="tok-k">new</span> <span class="tok-n">Date</span><span class="tok-o">()-</span><span class="tok-mi">10</span><span class="tok-o">,</span> <span class="tok-k">new</span> <span class="tok-n">Date</span><span class="tok-o">())</span>
    <span class="tok-n">ilike</span><span class="tok-o">(</span><span class="tok-s2">&quot;content&quot;</span><span class="tok-o">,</span> <span class="tok-s2">&quot;%texto%&quot;</span><span class="tok-o">)</span>
<span class="tok-o">}</span>

<span class="tok-n">not</span> <span class="tok-o">{</span>
    <span class="tok-n">between</span><span class="tok-o">(</span><span class="tok-s2">&quot;date&quot;</span><span class="tok-o">,</span> <span class="tok-k">new</span> <span class="tok-n">Date</span><span class="tok-o">()-</span><span class="tok-mi">10</span><span class="tok-o">,</span> <span class="tok-k">new</span> <span class="tok-n">Date</span><span class="tok-o">())</span>
    <span class="tok-n">ilike</span><span class="tok-o">(</span><span class="tok-s2">&quot;content&quot;</span><span class="tok-o">,</span> <span class="tok-s2">&quot;%texto%&quot;</span><span class="tok-o">)</span>
<span class="tok-o">}</span></code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_servicios">5.5. Servicios</h3>
<div class="paragraph">
<p>En cualquier aplicaciÃ³n que utilice el patrÃ³n Modelo Vista Controlador, la capa de servicios debe ser la responsable de la lÃ³gica de negocio de nuestra aplicaciÃ³n. Si conseguimos esto, nuestra aplicaciÃ³n serÃ¡ fÃ¡cil de mantener y evolucionarÃ¡ de forma sencilla y eficiente.</p>
</div>
<div class="paragraph">
<p>Cuando implementamos una aplicaciÃ³n siguiendo el patrÃ³n MVC, el principal error que se comete es acumular demasiado cÃ³digo en la capa de control. Si en lugar de hacer esto, implementÃ¡semos servicios encargados de esta tarea, nuestra aplicaciÃ³n serÃ­a mÃ¡s fÃ¡cil de mantener. Pero, Â¿quÃ© son los servicios en Grails?.</p>
</div>
<div class="paragraph">
<p>Siguiendo el paradigma de <em>convenciÃ³n sobre configuraciÃ³n</em>, los servicios no son mÃ¡s que clases cuyo nombre termina en <em>Service</em> y que se ubican en el directorio <em>grails-app/services</em>.</p>
</div>
<div class="paragraph">
<p>En la aplicaciÃ³n que estamos desarrollando como ejemplo, vamos a crear un mÃ©todo en un servicio que devuelva aquellas tareas que estÃ©n planeadas para los prÃ³ximas X dÃ­as. Para ello, en primer lugar debemos crear el esqueleto del servicio con el comando <em>grails create-service es.ua.expertojava.todo.todo</em>. Este comando, ademÃ¡s del servicio, tambiÃ©n crearÃ¡ un test unitario. La clase de servicio que hemos creado tiene la siguiente estructura:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-kn">package</span> <span class="tok-n">es</span><span class="tok-o">.</span><span class="tok-na">ua</span><span class="tok-o">.</span><span class="tok-na">expertojava</span><span class="tok-o">.</span><span class="tok-na">todo</span>

<span class="tok-kn">import</span> <span class="tok-nn">grails.transaction.Transactional</span>

<span class="tok-nd">@Transactional</span>
<span class="tok-kd">class</span> <span class="tok-nc">TodoService</span> <span class="tok-o">{</span>

    <span class="tok-kt">def</span> <span class="tok-nf">serviceMethod</span><span class="tok-o">()</span> <span class="tok-o">{</span>

    <span class="tok-o">}</span>
<span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Como vemos, la clase creada especifica la anotaciÃ³n <em>@Transactional</em> que indica que la clase completa con todos los mÃ©todos que aÃ±adamos serÃ¡n transaccionales. Esto significa que si en algÃºn mÃ©todo se produce algÃºn error, las operaciones realizadas hasta el momento del error serÃ¡n desechadas. Sin embargo, existe una forma de ser algo mÃ¡s selectivo e indicar que mÃ©todos serÃ¡n transaccionales y cuales no. Esto se hace tambiÃ©n con anotaciones y este es un ejemplo de lo que podrÃ­amos tener:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-kn">import</span> <span class="tok-nn">grails.transaction.Transactional</span>

<span class="tok-kd">class</span> <span class="tok-nc">BookService</span> <span class="tok-o">{</span>

    <span class="tok-nd">@Transactional</span><span class="tok-o">(</span><span class="tok-n">readOnly</span> <span class="tok-o">=</span> <span class="tok-kc">true</span><span class="tok-o">)</span>
    <span class="tok-kt">def</span> <span class="tok-nf">listBooks</span><span class="tok-o">()</span> <span class="tok-o">{</span>
        <span class="tok-n">Book</span><span class="tok-o">.</span><span class="tok-na">list</span><span class="tok-o">()</span>
    <span class="tok-o">}</span>

    <span class="tok-nd">@Transactional</span>
    <span class="tok-kt">def</span> <span class="tok-nf">updateBook</span><span class="tok-o">()</span> <span class="tok-o">{</span>
        <span class="tok-c1">// ...</span>
    <span class="tok-o">}</span>

    <span class="tok-kt">def</span> <span class="tok-nf">deleteBook</span><span class="tok-o">()</span> <span class="tok-o">{</span>
        <span class="tok-c1">// ...</span>
    <span class="tok-o">}</span>
<span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>En el mÃ©todo <em>listBooks()</em>, le estamos especificando que el mÃ©todo serÃ¡ transaccional de solo lectura. Por otro lado, el mÃ©todo <em>updateBook()</em> serÃ¡ transaccional de lectura-escritura y por Ãºltimo, y que sirva Ãºnicamente como ejemplo, tenemos el mÃ©todo <em>deleteBook()</em> que al no indicarle nada, le estamos diciendo a Grails que no es transaccional (por supuesto, esta operaciÃ³n deberÃ­a ser transaccional. TÃ³malo Ãºnicamente como un ejemplo).</p>
</div>
<div class="paragraph">
<p>Cuando creÃ¡bamos el servicio <em>TodoService</em>, Grails generaba automÃ¡ticamente un mÃ©todo vacÃ­o llamado <em>serviceMethod()</em> que ahora vamos a sustituir por uno propio que devuelva una serie de tareas comprendidas entre un par de fechas. El mÃ©todo recibirÃ¡ una fecha inicio y fin y ademÃ¡s, un mapa con una serie de parÃ¡metros que utilizaremos para paginar en caso de que sea necesario. El mÃ©todo devolverÃ¡ una colecciÃ³n de instancias de la clase <em>Todo</em>. TambiÃ©n crearemos un mÃ©todo que devuelva un contador de cuantas tareas coinciden con ese criterio.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-kn">package</span> <span class="tok-n">es</span><span class="tok-o">.</span><span class="tok-na">ua</span><span class="tok-o">.</span><span class="tok-na">expertojava</span><span class="tok-o">.</span><span class="tok-na">todo</span>

<span class="tok-kn">import</span> <span class="tok-nn">grails.transaction.Transactional</span>

<span class="tok-kd">class</span> <span class="tok-nc">TodoService</span> <span class="tok-o">{</span>

    <span class="tok-kt">def</span> <span class="tok-nf">getNextTodos</span><span class="tok-o">(</span><span class="tok-n">Integer</span> <span class="tok-n">days</span><span class="tok-o">,</span> <span class="tok-n">params</span><span class="tok-o">)</span> <span class="tok-o">{</span>
        <span class="tok-n">Date</span> <span class="tok-n">now</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">Date</span><span class="tok-o">(</span><span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">currentTimeMillis</span><span class="tok-o">())</span>
        <span class="tok-n">Date</span> <span class="tok-n">to</span> <span class="tok-o">=</span> <span class="tok-n">now</span> <span class="tok-o">+</span> <span class="tok-n">days</span>
        <span class="tok-n">Todo</span><span class="tok-o">.</span><span class="tok-na">findAllByDateBetween</span><span class="tok-o">(</span><span class="tok-n">now</span><span class="tok-o">,</span> <span class="tok-n">to</span><span class="tok-o">,</span> <span class="tok-n">params</span><span class="tok-o">)</span>
    <span class="tok-o">}</span>

    <span class="tok-kt">def</span> <span class="tok-nf">countNextTodos</span><span class="tok-o">(</span><span class="tok-n">Integer</span> <span class="tok-n">days</span><span class="tok-o">)</span> <span class="tok-o">{</span>
        <span class="tok-n">Date</span> <span class="tok-n">now</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">Date</span><span class="tok-o">(</span><span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">currentTimeMillis</span><span class="tok-o">())</span>
        <span class="tok-n">Date</span> <span class="tok-n">to</span> <span class="tok-o">=</span> <span class="tok-n">now</span> <span class="tok-o">+</span> <span class="tok-n">days</span>
        <span class="tok-n">Todo</span><span class="tok-o">.</span><span class="tok-na">countByDateBetween</span><span class="tok-o">(</span><span class="tok-n">now</span><span class="tok-o">,</span> <span class="tok-n">to</span><span class="tok-o">)</span>
    <span class="tok-o">}</span>
<span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>El siguiente paso, serÃ¡ modificar el controlador de la clase de dominio <em>Todo</em> para crear un nuevo mÃ©todo que utilice este servicio recien creado. El mÃ©todo lo vamos a llamar <em>listNextTodos()</em>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-kd">class</span> <span class="tok-nc">TodoController</span> <span class="tok-o">{</span>
    <span class="tok-kt">def</span> <span class="tok-n">todoService</span>

    <span class="tok-o">....</span>

    <span class="tok-kt">def</span> <span class="tok-nf">listNextTodos</span><span class="tok-o">(</span><span class="tok-n">Integer</span> <span class="tok-n">days</span><span class="tok-o">)</span> <span class="tok-o">{</span>
        <span class="tok-n">respond</span> <span class="tok-n">todoService</span><span class="tok-o">.</span><span class="tok-na">getNextTodos</span><span class="tok-o">(</span><span class="tok-n">days</span><span class="tok-o">,</span> <span class="tok-n">params</span><span class="tok-o">),</span>
                <span class="tok-nl">model:</span><span class="tok-o">[</span><span class="tok-nl">todoInstanceCount:</span> <span class="tok-n">todoService</span><span class="tok-o">.</span><span class="tok-na">countNextTodos</span><span class="tok-o">(</span><span class="tok-n">days</span><span class="tok-o">)],</span>
                <span class="tok-nl">view:</span><span class="tok-s2">&quot;index&quot;</span>
    <span class="tok-o">}</span>

    <span class="tok-o">....</span>
<span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Al inicio del controlador debemos crear tambiÃ©n la variable <em>def todoService</em> para poder utilizar sus servicios. La convenciÃ³n es que esta variable debe llamarse igual que el servicio salvo que la primera letra serÃ¡ minÃºscula. De esta forma, una instancia del servicio correspondiente se inyectarÃ¡ convenientemente en nuestro controlador, con lo que no debemos preocuparnos por su ciclo de vida.</p>
</div>
<div class="paragraph">
<p>El mÃ©todo es muy similar al mÃ©todo <em>index()</em> con la excepciÃ³n de que ahora le pasaremos el parÃ¡metro <em>view:"index"</em> para que cuando la peticiÃ³n se realice desde una aplicaciÃ³n web, esta sea renderizada en una pÃ¡gina HTML.</p>
</div>
<div class="paragraph">
<p>Con esto tenemos que si accedemos a travÃ©s del navegador a la url <em><a href="http://localhost:8080/todo/todo/listNextTodos?days=2" class="bare">http://localhost:8080/todo/todo/listNextTodos?days=2</a></em> la aplicaciÃ³n nos mostrarÃ¡ las tareas que tengamos que hacer en los prÃ³ximos dos dÃ­as. Si por otro lado ejecutamos desde la lÃ­nea de comandos:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="bash">curl -v -H <span class="tok-s2">&quot;Accept: text/xml&quot;</span> -H <span class="tok-s2">&quot;Content-type: text/xml&quot;</span> -X GET  http://localhost:8080/todo/todo/listNextTodos?days<span class="tok-o">=</span>2</code></pre>
</div>
</div>
<div class="paragraph">
<p>el resultado serÃ¡ un xml con el contenido de las prÃ³ximas tareas. En el caso en que necesitemos el resultado en formato JSON:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="bash">curl -v -H <span class="tok-s2">&quot;Accept: application/json&quot;</span> -H <span class="tok-s2">&quot;Content-type: application/json&quot;</span> -X GET  http://localhost:8080/todo/todo/listNextTodos?days<span class="tok-o">=</span>2</code></pre>
</div>
</div>
<div class="sect3">
<h4 id="_Ãmbito_de_los_servicios">5.5.1. Ãmbito de los servicios</h4>
<div class="paragraph">
<p>Por defecto, todos los servicios en Grails son de tipo <em>singleton</em>, es decir, sÃ³lo existe una instancia de la clase que se inyecta en todos los artefactos que declaren la variable correspondiente. Esto puede servirnos para la mayorÃ­a de las situaciones, pero tiene un inconveniente y es que no es posible guardar informaciÃ³n <em>privada</em> de una peticiÃ³n en el propio servicio puesto que todos los controladores verÃ­an la misma instancia y por lo tanto, el mismo valor. Para solucionar esto, podemos declarar una variable <em>scope</em> con cualquiera de los siguiente valores:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><em>prototype</em>: cada vez que se inyecta el servicio en otro artefacto se crea una nueva instancia</p>
</li>
<li>
<p><em>request</em>: se crea una nueva instancia para cada solicitud HTTP</p>
</li>
<li>
<p><em>flash</em>: cada instancia estarÃ¡ accesible para la solicitud HTTP actual y para la siguiente</p>
</li>
<li>
<p><em>flow</em>: cuando declaramos el servicio en un web flow, se crearÃ¡ una instancia nueva en cada flujo</p>
</li>
<li>
<p><em>conversation</em>: cuando declaramos el servicio en un web flow, la instancia serÃ¡ visible para el flujo actual y todos sus sub-flujos (conversaciÃ³n)</p>
</li>
<li>
<p><em>session</em>: se crearÃ¡ una instancia nueva del servicio para cada sesiÃ³n de usuario</p>
</li>
<li>
<p><em>singleton</em>: sÃ³lo existe una instancia del servicio</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Por lo tanto, si queremos modificar el Ã¡mbito del servicio para que cada sesiÃ³n de usuario tenga su propia instancia del servicio, debemos declararlos asÃ­:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-kd">class</span> <span class="tok-nc">TodoService</span><span class="tok-o">{</span>
    <span class="tok-kd">static</span> <span class="tok-n">scope</span> <span class="tok-o">=</span> <span class="tok-s1">&#39;session&#39;</span>
    <span class="tok-o">...</span>
<span class="tok-o">}</span></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_servicios_rest">5.5.2. Servicios REST</h4>
<div class="paragraph">
<p>Ya hemos visto durante las sesiones anteriores que es muy sencillo generar en Grails una aplicaciÃ³n que sepa responder a las distintas peticiones de una aplicaciÃ³n web, bien sea a travÃ©s de una pÃ¡gina web o bien desde una aplicaciÃ³n nativa utilizando REST. Pero, Â¿quÃ© es exactamente REST?</p>
</div>
<div class="paragraph">
<p>Los servicios web REST son algo mÃ¡s que devolver datos en formato XML o JSON sino que consiste en una forma de trabajar que en funciÃ³n del mÃ©todo HTTP utilizado en la peticiÃ³n se debe procesar mediante una acciÃ³n u otra, tal y como se representa en la siguiente tabla.</p>
</div>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">MÃ©todo</th>
<th class="tableblock halign-left valign-top">AcciÃ³n</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">GET</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">show()</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">PUT</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">update()</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">POST</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">save()</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">DELETE</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">delete()</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>A partir de esta tabla, sÃ³lo necesitarÃ­amos una url para poder realizar todas las operaciones sobre nuestras clases de dominio. Imagina por ejemplo las operaciones de tipo CRUD sobre los usuarios. Con REST, sÃ³lo deberÃ­amos tener una posible url que serÃ­a <em><a href="http://localhost:8080/todo/todo/id_todo" class="bare">http://localhost:8080/todo/todo/id_todo</a></em>, donde el identificador de la tarea serÃ­a optativo.
Veamos en otra tabla como quedarÃ­an todas las posibles peticiones para realizar las operaciones del usuario.</p>
</div>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 33%;">
<col style="width: 33%;">
<col style="width: 33%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">URL</th>
<th class="tableblock halign-left valign-top">MÃ©todo HTTP</th>
<th class="tableblock halign-left valign-top">AcciÃ³n</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="http://localhost:8080/todo/todos" class="bare">http://localhost:8080/todo/todos</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">GET</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>show()</em>,  deberÃ­a mostrar un listado de las tareas</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="http://localhost:8080/todo/todos/4" class="bare">http://localhost:8080/todo/todos/4</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">GET</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>show()</em>, deberÃ­a mostrar los datos de la tarea con <em>id = 4</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="http://localhost:8080/todo/todos/4" class="bare">http://localhost:8080/todo/todos/4</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">PUT</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>update()</em>, deberÃ­a actualizar los datos de la tarea con <em>id = 4</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="http://localhost:8080/todo/todos" class="bare">http://localhost:8080/todo/todos</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">POST</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>save()</em>, deberÃ­a crear una nueva tarea con los datos pasados en el formulario</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="http://localhost:8080/todo/todos/4" class="bare">http://localhost:8080/todo/todos/4</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">DELETE</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>delete()</em>, deberÃ­a eliminar la tarea con <em>id = 4</em></p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>En Grails la forma mÃ¡s sencilla de exponer clases de dominio como servicios REST es mediante entradas en el archivo de configuraciÃ³n /conf/UrlMappings.groovy, que veremos mÃ¡s adelante en profundidad.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-kd">class</span> <span class="tok-nc">UrlMappings</span> <span class="tok-o">{</span>

    <span class="tok-kd">static</span> <span class="tok-n">mappings</span> <span class="tok-o">=</span> <span class="tok-o">{</span>
        <span class="tok-s2">&quot;/$controller/$action?/$id?(.$format)?&quot;</span><span class="tok-o">{</span>
            <span class="tok-n">constraints</span> <span class="tok-o">{</span>
                <span class="tok-c1">// apply constraints here</span>
            <span class="tok-o">}</span>
        <span class="tok-o">}</span>

        <span class="tok-s2">&quot;/api/todos&quot;</span><span class="tok-o">(</span><span class="tok-nl">resources:</span><span class="tok-s2">&quot;todo&quot;</span><span class="tok-o">)</span>
        <span class="tok-s2">&quot;/api/tags&quot;</span><span class="tok-o">(</span><span class="tok-nl">resources:</span><span class="tok-s2">&quot;tag&quot;</span><span class="tok-o">)</span>
        <span class="tok-s2">&quot;/api/categories&quot;</span><span class="tok-o">(</span><span class="tok-nl">resources:</span><span class="tok-s2">&quot;category&quot;</span><span class="tok-o">)</span>

        <span class="tok-s2">&quot;/&quot;</span><span class="tok-o">(</span><span class="tok-nl">view:</span><span class="tok-s2">&quot;/index&quot;</span><span class="tok-o">)</span>
        <span class="tok-s2">&quot;500&quot;</span><span class="tok-o">(</span><span class="tok-nl">view:</span><span class="tok-s1">&#39;/error&#39;</span><span class="tok-o">)</span>
    <span class="tok-o">}</span>
<span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>De esta forma estaremos exponiendo nuestras clases de dominio como recursos REST que podrÃ¡n ser accedidos de la siguiente forma:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><em><a href="http://localhost:8080/api/todos.json" class="bare">http://localhost:8080/api/todos.json</a></em></p>
</li>
<li>
<p><em><a href="http://localhost:8080/api/tags/1.json" class="bare">http://localhost:8080/api/tags/1.json</a></em></p>
</li>
<li>
<p><em><a href="http://localhost:8080/api/categories/3.json" class="bare">http://localhost:8080/api/categories/3.json</a></em></p>
</li>
</ul>
</div>
<div style="page-break-after: always;"></div>
<div style="page-break-after: always;"></div>
</div>
</div>
<div class="sect2">
<h3 id="_ejercicios_5">5.6. Ejercicios</h3>
<div class="sect3">
<h4 id="_construye_tus_propias_restricciones_0_25_puntos">5.6.1. Construye tus propias restricciones (0.25 puntos)</h4>
<div class="paragraph">
<p>En la clase de dominio de las tareas tenemos tanto una fecha para la tarea como una fecha de recuerdo. Vamos a imponer como restricciÃ³n que la fecha para recordar la tarea deba ser siempre anterior a la fecha de realizaciÃ³n de la misma. Crea para ello una restricciÃ³n que nos permita conseguir esto.</p>
</div>
<div class="paragraph">
<p>Crea tambiÃ©n una nueva propiedad en las etiquetas para especificar un color. Este color vendrÃ¡ en formato RGB, que te recuerdo estÃ¡ especificado por el carÃ¡cter <em>#</em> seguido de 6 caracteres hexadecimales, como por ejemplo #23FA8F. Define esta restricciÃ³n globalmente con el nombre <em>rgbcolor</em> para que pueda ser reutilizada en cualquier otra propiedad de nuestra aplicaciÃ³n.</p>
</div>
</div>
<div class="sect3">
<h4 id="_asegurar_los_borrados_de_las_categorÃ­as_y_las_tareas_0_25_puntos">5.6.2. Asegurar los borrados de las categorÃ­as y las tareas (0.25 puntos)</h4>
<div class="paragraph">
<p>En la aplicaciÃ³n actualmente tenemos un problema que nos impide eliminar categorÃ­as por la relaciÃ³n con las tareas y la clave ajena que se genera a nivel de base de datos con lo que antes de proceder al borrado de la categorÃ­a, debemos asegurarnos que Ã©sta no estÃ© asignada a ninguna tarea.</p>
</div>
<div class="paragraph">
<p>Crea el servicio <em>CategoryService.groovy</em> y mueve el eliminado que ahora mismo se estÃ¡ realizando en el controlador <em>CategoryController.groovy</em> para que asigne a null todas las tareas de la categorÃ­a a eliminar.</p>
</div>
<div class="paragraph">
<p>Soluciona al mismo tiempo el problema existente a la hora de eliminar tareas por la relaciÃ³n existente entre ellas y las etiquetas. Mueve el borrado de las tareas a un mÃ©todo en el servicio adecuado.</p>
</div>
</div>
<div class="sect3">
<h4 id="_consultas_a_base_de_datos_0_25_puntos">5.6.3. Consultas a base de datos (0.25 puntos)</h4>
<div class="paragraph">
<p>Vamos a crear un nuevo informe en nuestra aplicaciÃ³n que nos permita listar todas las tareas ordenadas por fecha y cuya categorÃ­a coincida con las pasadas por parÃ¡metro. Necesitaremos crear una vista y su correspondiente mÃ©todo (<em>listByCategory()</em>) en el controlador <em>TodoController()</em> para poder seleccionar aquellas categorÃ­as de las que queramos listar sus tareas.</p>
</div>
<div class="paragraph">
<p>A continuaciÃ³n, deberÃ¡s implementar un nuevo mÃ©todo en el controlador <em>TodoController()</em> que devuelva todas las tareas cuya categorÃ­a coincidan con aquellas que el usuario haya seleccionado en el paso anterior. En esta vista puedes mostrar todas las categorÃ­as junto a un checkbox para que el usuario pueda seleccionar varios al mismo tiempo.</p>
</div>
<div class="paragraph">
<p>Por Ãºltimo, edita los menÃºs de navegaciÃ³n de la aplicaciÃ³n para aÃ±adir el nuevo informe que acabamos de generar en todas pÃ¡ginas relativas a las tareas.</p>
</div>
</div>
<div class="sect3">
<h4 id="__cuÃ¡ndo_han_sido_realizadas_las_tareas_0_50_puntos">5.6.4. Â¿CuÃ¡ndo han sido realizadas las tareas? (0.50 puntos)</h4>
<div class="paragraph">
<p>El autotimestamp es una caracterÃ­stica de Grails que se suele utilizar para saber cuando se crean y actualizan las instancias de nuestras clases de dominio. En primer lugar vamos a aÃ±adir esta caracterÃ­stica de Grails a las tareas.</p>
</div>
<div class="paragraph">
<p>A continuaciÃ³n, vamos a crear una nueva propiedad en las tareas que nos permite saber cuando se han realizado las tareas y llama a esta propiedad <em>dateDone</em>. Para rellenar esta propiedad vamos a crear un servicio que se encargue de esta lÃ³gica y a su vez, mover el guardado que se estÃ¡ realizando actualmente en el controlador.</p>
</div>
<div class="paragraph">
<p>Para ello aÃ±adiremos en el servicio <em>TodoService</em>  un nuevo mÃ©todo llamado <em>saveTodo(Todo todoInstance)</em> de tal forma que cuando la propiedad <em>done</em> sea cierta, completaremos con la fecha actual la nueva propiedad <em>dateDone</em>. Este mÃ©todo deberÃ¡ ser utilizado tanto cuando se crea como cuando se actualiza una tarea.</p>
</div>
<div class="paragraph">
<p>A continuaciÃ³n, crearemos un nuevo mÃ©todo en el servicio <em>TodoService()</em> llamado <em>lastTodosDone(Integer hours)</em> que nos permitirÃ¡ pasar como parÃ¡metro un nÃºmero de horas y nos devuelva todas las Ãºltimas tareas realizadas en ese intervalo de tiempo, es decir, desde el momento actual hasta hace <em>hours</em> horas.</p>
</div>
<div style="page-break-after: always;"></div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="sesion06">6. Framework de test Spock.</h2>
<div class="sectionbody">
<div class="paragraph">
<p>En esta sesiÃ³n veremos en profundidad como comprobar que nuestra aplicaciÃ³n desarrollada en Grails funciona tal y como esperamos y para ello utilizaremos un framework para la realizaciÃ³n de tests llamado Spock. Empezaremos viendo conceptos generales tanto de tests como de Spock y terminaremos viendo su aplicaciÃ³n en una aplicaciÃ³n en Grails.</p>
</div>
<div class="sect2">
<h3 id="_introducciÃ³n_a_los_tests">6.1. IntroducciÃ³n a los tests</h3>
<div class="sect3">
<h4 id="__quÃ©_son_los_tests">6.1.1. Â¿QuÃ© son los tests?</h4>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="title">DefiniciÃ³n</div>
<div class="paragraph">
<p>Los tests de software se pueden definir como el proceso empleado para comprobar la correcciÃ³n de un programa informÃ¡tico y se puede considerar como una parte mÃ¡s en el proceso del control de calidad.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_tipos_de_tests_de_software">6.1.2. Tipos de tests de software</h4>
<div class="paragraph">
<p>BÃ¡sicamente existen tres tipos de tests de software:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><em>Tests unitarios</em>, que consisten en comprobar el funcionamiento de un determinado mÃ³dulo sin tener en cuenta a los demÃ¡s. En este tipo de pruebas tampoco se tiene acceso a recursos como bases de datos, sistemas de ficheros o recursos de red.</p>
</li>
<li>
<p><em>Tests de integraciÃ³n</em>, suponen un nivel por encima a los tests unitarios y en ellos se aÃ±aden recursos como bases de datos, sistemas de ficheros o recursos de red.</p>
</li>
<li>
<p><em>Tests funcionales</em>, consiste en comprobar que la funcionalidad de nuestra aplicaciÃ³n es la esperada. BÃ¡sicamente este tipo de pruebas se basan en automatizar las tÃ­picas pruebas de rellenar datos en formularios, hacer clicks en botones y analizar la respuesta obtenida.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_otros_frameworks_de_tests">6.1.3. Otros frameworks de tests</h4>
<div class="paragraph">
<p>En Java disponemos de varias alternativas para el desarrollo de los tests, pero bÃ¡sicamente disponemos de dos que son las mÃ¡s conocidas y utilizadas:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>JUnit (<a href="http://junit.org" class="bare">http://junit.org</a>), posiblemente sea el framework mÃ¡s extendido entre la comunidad Java.</p>
</li>
<li>
<p>TestNG (<a href="http://testng.org" class="bare">http://testng.org</a>), es un framework que permite testear nuestra aplicaciÃ³n con pruebas unitarias, de integraciÃ³n y funcionales.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Sin embargo, en la comunidad Groovy cada vez se estÃ¡ extendiendo mÃ¡s el uso de un framework conocido como Spock (<a href="https://code.google.com/p/spock/" class="bare">https://code.google.com/p/spock/</a>). Spock surgiÃ³ en el aÃ±o 2009 y su creador es Peter Niederwieser (<a href="https://twitter.com/pniederw">@pniederw</a>) y sin duda alguna destaca entre el resto de frameworks por la expresividad de su lenguaje y su integraciÃ³n con Groovy y Java. Estas son algunas de las razones por las que vamos a utilizar Spock:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>FÃ¡cil de aprender</p>
</li>
<li>
<p>IntegraciÃ³n con Groovy</p>
</li>
<li>
<p>EliminaciÃ³n aserciones innecesarias</p>
</li>
<li>
<p>InformaciÃ³n detallada en las salidas de los tests</p>
</li>
<li>
<p>DiseÃ±ado desde el punto de vista del usuario</p>
</li>
<li>
<p>Independientemente de la teoria que sigas para desarrollar tus tests (TDD, BDD, etc), Spock se adaptarÃ¡ a tus necesidades</p>
</li>
<li>
<p>Lenguaje altamente expresivo</p>
</li>
<li>
<p>Compatible con JUnit</p>
</li>
<li>
<p>Combina lo mejor de otros conocidos frameworks como JUnit o jMock</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_framework_de_tests_spock">6.2. Framework de tests Spock</h3>
<div class="sect3">
<h4 id="_instalaciÃ³n_en_grails">6.2.1. InstalaciÃ³n en Grails</h4>
<div class="paragraph">
<p>Spock en Grails viene como un plugin con lo que Ãºnicamente tendremos que aÃ±adir el plugin en el archivo de configuraciÃ³n <em>BuildConfig.groovy</em>, tal y como se explica en la pÃ¡gina del plugin (<a href="http://grails.org/plugin/spock" class="bare">http://grails.org/plugin/spock</a>) para versiones superiores a Grails 2.2</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-n">grails</span><span class="tok-o">.</span><span class="tok-na">project</span><span class="tok-o">.</span><span class="tok-na">dependency</span><span class="tok-o">.</span><span class="tok-na">resolution</span> <span class="tok-o">=</span> <span class="tok-o">{</span>
  <span class="tok-n">repositories</span> <span class="tok-o">{</span>
    <span class="tok-n">grailsCentral</span><span class="tok-o">()</span>
    <span class="tok-n">mavenCentral</span><span class="tok-o">()</span>
  <span class="tok-o">}</span>
  <span class="tok-n">dependencies</span> <span class="tok-o">{</span>
    <span class="tok-n">test</span> <span class="tok-s2">&quot;org.spockframework:spock-grails-support:0.7-groovy-2.0&quot;</span>
  <span class="tok-o">}</span>
  <span class="tok-n">plugins</span> <span class="tok-o">{</span>
    <span class="tok-n">test</span><span class="tok-o">(</span><span class="tok-s2">&quot;:spock:0.7&quot;</span><span class="tok-o">)</span> <span class="tok-o">{</span>
      <span class="tok-n">exclude</span> <span class="tok-s2">&quot;spock-grails-support&quot;</span>
    <span class="tok-o">}</span>
  <span class="tok-o">}</span>
<span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Para que el plugin sea instalado y el IDE reconozca las nuevas clases, necesitaremos lanzar algÃºn <em>target</em> de Grails, como por ejemplo <em>grails test-app</em>. Una vez instalado el plugin, ya podremos empezar a desarrollar nuestros primeros tests.</p>
</div>
</div>
<div class="sect3">
<h4 id="_tests_en_spock">6.2.2. Tests en Spock</h4>
<div class="paragraph">
<p>Por defecto en Spock, todas las clases que creemos para nuestros tests deben extender la clase <em>spock.lang.Specification</em>, que inyectarÃ¡ una serie de mÃ©todos y utilidades en nuestra clase extendida.</p>
</div>
<div class="paragraph">
<p>A diferencia de otros frameworks de tests, Spock presenta una sintaxis muy sencilla de leer que se basa en la utilizaciÃ³n de bloques de cÃ³digo. Este serÃ­a un ejemplo bÃ¡sico de test con Spock:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-kn">package</span> <span class="tok-n">es</span><span class="tok-o">.</span><span class="tok-na">ua</span><span class="tok-o">.</span><span class="tok-na">expertojava</span><span class="tok-o">.</span><span class="tok-na">todo</span>

<span class="tok-kn">import</span> <span class="tok-nn">spock.lang.Specification</span>

<span class="tok-kd">class</span> <span class="tok-nc">MyFirstTest</span> <span class="tok-kd">extends</span> <span class="tok-n">Specification</span> <span class="tok-o">{</span>

    <span class="tok-kt">def</span> <span class="tok-s2">&quot;El operador suma funciona correctamente&quot;</span><span class="tok-o">()</span> <span class="tok-o">{</span>
        <span class="tok-nl">expect:</span>
            <span class="tok-mi">10</span> <span class="tok-o">==</span> <span class="tok-mi">2</span> <span class="tok-o">+</span> <span class="tok-mi">8</span>
        <span class="tok-nl">and:</span>
            <span class="tok-mi">10</span> <span class="tok-o">==</span> <span class="tok-mi">0</span> <span class="tok-o">+</span> <span class="tok-mi">10</span>
        <span class="tok-nl">and:</span>
            <span class="tok-mi">10</span> <span class="tok-o">==</span> <span class="tok-mi">10</span> <span class="tok-o">+</span> <span class="tok-mi">0</span>
    <span class="tok-o">}</span>
<span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Este formato de test en Spock podrÃ­amos decir que es el mÃ¡s sencillo de los que podemos encontrar y como puedes observar la sintaxis es muy sencilla de entender. Lo primero que cabe destacar aunque probablemente ya te hayas dado cuenta es el nombre de los mÃ©todos que estÃ¡n entrecomillados y podemos llamarlo como queramos y utilizar espacios o caracteres especiales (no ingleses) como acentos.</p>
</div>
<div class="paragraph">
<p>Destacar tambiÃ©n que no es necesario utilizar aserciones dentro del bloque <em>expect</em>. Pero veamos otro ejemplo un poco mÃ¡s elaborado y que nos introducirÃ¡ un nuevo formato de test en Spock.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-kt">def</span> <span class="tok-s2">&quot;El mÃ©todo plus de los nÃºmeros funciona correctamente&quot;</span><span class="tok-o">()</span> <span class="tok-o">{</span>
    <span class="tok-nl">when:</span>
        <span class="tok-kt">def</span> <span class="tok-n">result</span> <span class="tok-o">=</span> <span class="tok-mi">10</span><span class="tok-o">.</span><span class="tok-na">plus</span><span class="tok-o">(</span><span class="tok-mi">2</span><span class="tok-o">)</span>
    <span class="tok-nl">then:</span>
        <span class="tok-n">result</span> <span class="tok-o">==</span> <span class="tok-mi">12</span>
<span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Este formato de spock sea posiblemente el mÃ¡s comÃºn en Spock y en Ã©l vemos un bloque <em>when</em> y un bloque <em>then</em>. El bloque <em>when</em> se utiliza habitualmente para lanzar el mÃ©todo a probar y en este caso tambiÃ©n para almacenar el resultado, mientras que el bloque <em>then</em> se utiliza para comprobar que la respuesta proporcionada por el mÃ©todo es la correcta. De nuevo, en el bloque <em>then</em> no es necesario utilizar aserciones.</p>
</div>
<div class="paragraph">
<p>Pero, Â¿quÃ© pasa si queremos probar varios casos en la misma sentencia? Para este caso, Spock introduce el bloque <em>where</em> en donde con una sintaxis muy sencilla de entender en forma de tabla, vamos a poder comprobar varios al mismo tiempo. Veamos el anterior ejemplo mejorado:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-nd">@Unroll</span>
<span class="tok-kt">def</span> <span class="tok-s2">&quot;El mÃ©todo plus funciona con el sumador #sumador y el sumando #sumando&quot;</span><span class="tok-o">()</span> <span class="tok-o">{</span>
    <span class="tok-nl">when:</span>
        <span class="tok-kt">def</span> <span class="tok-n">result</span> <span class="tok-o">=</span> <span class="tok-n">sumador</span><span class="tok-o">.</span><span class="tok-na">plus</span><span class="tok-o">(</span><span class="tok-n">sumando</span><span class="tok-o">)</span>
    <span class="tok-nl">then:</span>
        <span class="tok-n">result</span> <span class="tok-o">==</span> <span class="tok-n">resultadoEsperado</span>
    <span class="tok-nl">where:</span>
        <span class="tok-n">sumador</span> <span class="tok-o">|</span>   <span class="tok-n">sumando</span>     <span class="tok-o">|</span>   <span class="tok-n">resultadoEsperado</span>
        <span class="tok-mi">0</span>       <span class="tok-o">|</span>   <span class="tok-mi">0</span>           <span class="tok-o">|</span>   <span class="tok-mi">0</span>
        <span class="tok-mi">0</span>       <span class="tok-o">|</span>   <span class="tok-mi">1</span>           <span class="tok-o">|</span>   <span class="tok-mi">1</span>
        <span class="tok-mi">1</span>       <span class="tok-o">|</span>   <span class="tok-mi">1</span>           <span class="tok-o">|</span>   <span class="tok-mi">2</span>
        <span class="tok-o">-</span><span class="tok-mi">1</span>      <span class="tok-o">|</span>   <span class="tok-mi">0</span>           <span class="tok-o">|</span>   <span class="tok-o">-</span><span class="tok-mi">1</span>
        <span class="tok-mi">0</span>       <span class="tok-o">|</span>   <span class="tok-o">-</span><span class="tok-mi">1</span>          <span class="tok-o">|</span>   <span class="tok-o">-</span><span class="tok-mi">1</span>
        <span class="tok-o">-</span><span class="tok-mi">1</span>      <span class="tok-o">|</span>   <span class="tok-o">-</span><span class="tok-mi">1</span>          <span class="tok-o">|</span>   <span class="tok-o">-</span><span class="tok-mi">2</span>
        <span class="tok-mi">2</span>       <span class="tok-o">|</span>   <span class="tok-mi">1</span>           <span class="tok-o">|</span>   <span class="tok-mi">3</span>
<span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>En este ejemplo vemos la forma en la que Spock crea variables dentro del bloque <em>where</em> sin definir su tipo o ni tan siquiera con la palabra reservada <em>def</em>. De esta forma, en un Ãºnico test hemos podido comprobar el mÃ©todo <em>plus()</em> con varios valores en una Ãºnica sentencia.</p>
</div>
<div class="paragraph">
<p>Por otro lado, vemos tambiÃ©n como el nombre del test introduce los valores de las variables definidas dentro del bloque where de tal forma que cuando ejecutemos este test, si alguno falla veremos rÃ¡pidamente que caso es el problemÃ¡tico.</p>
</div>
<div class="paragraph">
<p>AdemÃ¡s, la anotaciÃ³n <em>@Unroll</em> nos permite que cada uno de los casos en el bloque where se despliegue como un nuevo test, lo cual de nuevo, facilita la detecciÃ³n rÃ¡pida de los errores. Esta serÃ­a la salida producida en nuestro editor sin la anotaciÃ³n <em>@Unroll</em>:</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="images/grails06/resultadotestsconbloquewheresinunroll.png" alt="Resultado de los tests sin la anotaciÃ³n @Unroll" width="50%">
</div>
</div>
<div class="paragraph">
<p>y esta es la producida con la anotaciÃ³n <em>@Unroll</em>:</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="images/grails06/resultadotestsconbloquewhereconunroll.png" alt="Resultado de los tests con la anotaciÃ³n @Unroll" width="50%">
</div>
</div>
<div class="paragraph">
<p>Como puedes observar, la anotaciÃ³n <em>@Unroll</em> nos proporciona mÃ¡s informaciÃ³n del resultado de los tests.</p>
</div>
<div class="paragraph">
<p>El siguiente ejemplo es idÃ©ntico al anterior pero en lugar de utilizar una tabla utilizamos listas con valores:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-nd">@Unroll</span>
<span class="tok-kt">def</span> <span class="tok-s2">&quot;El mÃ©todo plus funciona con el sumador #sumador y el sumando #sumando utilizando listas&quot;</span><span class="tok-o">()</span> <span class="tok-o">{</span>
    <span class="tok-nl">when:</span>
        <span class="tok-kt">def</span> <span class="tok-n">result</span> <span class="tok-o">=</span> <span class="tok-n">sumador</span><span class="tok-o">.</span><span class="tok-na">plus</span><span class="tok-o">(</span><span class="tok-n">sumando</span><span class="tok-o">)</span>
    <span class="tok-nl">then:</span>
        <span class="tok-n">result</span> <span class="tok-o">==</span> <span class="tok-n">resultadoEsperado</span>
    <span class="tok-nl">where:</span>
        <span class="tok-n">sumador</span> <span class="tok-o">&lt;&lt;</span> <span class="tok-o">[</span><span class="tok-mi">0</span><span class="tok-o">,</span><span class="tok-mi">0</span><span class="tok-o">,</span><span class="tok-mi">1</span><span class="tok-o">,-</span><span class="tok-mi">1</span><span class="tok-o">,</span><span class="tok-mi">0</span><span class="tok-o">,-</span><span class="tok-mi">1</span><span class="tok-o">,</span><span class="tok-mi">2</span><span class="tok-o">]</span>
        <span class="tok-n">sumando</span> <span class="tok-o">&lt;&lt;</span> <span class="tok-o">[</span><span class="tok-mi">0</span><span class="tok-o">,</span><span class="tok-mi">1</span><span class="tok-o">,</span><span class="tok-mi">1</span><span class="tok-o">,</span><span class="tok-mi">0</span><span class="tok-o">,-</span><span class="tok-mi">1</span><span class="tok-o">,-</span><span class="tok-mi">1</span><span class="tok-o">,</span><span class="tok-mi">1</span><span class="tok-o">]</span>
        <span class="tok-n">resultadoEsperado</span> <span class="tok-o">&lt;&lt;</span> <span class="tok-o">[</span><span class="tok-mi">0</span><span class="tok-o">,</span><span class="tok-mi">1</span><span class="tok-o">,</span><span class="tok-mi">2</span><span class="tok-o">,-</span><span class="tok-mi">1</span><span class="tok-o">,-</span><span class="tok-mi">1</span><span class="tok-o">,-</span><span class="tok-mi">2</span><span class="tok-o">,</span><span class="tok-mi">3</span><span class="tok-o">]</span>
<span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>El Ãºltimo bloque de un test Spock que nos queda por ver es el primero de todos, el bloque <em>given</em>, que nos servirÃ¡ para realizar todo lo necesario antes de ejecutar el mÃ©todo a testear. Este podrÃ­a ser un ejemplo:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-kt">def</span> <span class="tok-s2">&quot;El mÃ©todo para concatenar cadenas aÃ±ade un signo + entre las cadenas concatenadas&quot;</span><span class="tok-o">()</span> <span class="tok-o">{</span>
    <span class="tok-nl">given:</span>
        <span class="tok-n">String</span><span class="tok-o">.</span><span class="tok-na">metaClass</span><span class="tok-o">.</span><span class="tok-na">concat</span> <span class="tok-o">=</span> <span class="tok-o">{</span> <span class="tok-n">String</span> <span class="tok-n">c</span> <span class="tok-o">-&gt;</span>
            <span class="tok-s2">&quot;${delegate}+${c}&quot;</span>
        <span class="tok-o">}</span>
    <span class="tok-nl">expect:</span>
        <span class="tok-s2">&quot;cadena1&quot;</span><span class="tok-o">.</span><span class="tok-na">concat</span><span class="tok-o">(</span><span class="tok-s2">&quot;cadena2&quot;</span><span class="tok-o">)</span> <span class="tok-o">==</span> <span class="tok-s2">&quot;cadena1+cadena2&quot;</span>
    <span class="tok-nl">cleanup:</span>
        <span class="tok-n">String</span><span class="tok-o">.</span><span class="tok-na">metaClass</span> <span class="tok-o">=</span> <span class="tok-kc">null</span>
<span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Y como siempre, no olvides devolver la clase metaprogramada con <em>String.metaClass = null</em>.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_spock_en_grails">6.3. Spock en Grails</h3>
<div class="paragraph">
<p>Una vez hemos visto los primeros ejemplos de tests con Spock en Groovy, vamos a ver ejemplos de como testear los diferentes artefactos en las aplicaciones desarrolladas con Grails. Pero antes de continuar, hay que comentar que en Spock disponemos de unos mÃ©todos que se ejecutan antes y despuÃ©s de cada tests o de cada clase Spock. Estos mÃ©todos son:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><em>setupSpec()</em>: se ejecuta <strong>antes del primer test</strong> de una determinada clase de tests con Spock</p>
</li>
<li>
<p><em>cleanupSpec()</em>: se ejecuta <strong>despuÃ©s del Ãºltimo test</strong> de una determinada clase de tests con Spock</p>
</li>
<li>
<p><em>setup()</em>: se ejecuta <strong>antes de cada test</strong> de una determinada clase de tests con Spock</p>
</li>
<li>
<p><em>setupSpec()</em>: se ejecuta <strong>despuÃ©s de cada test</strong> de una determinada clase de tests con Spock</p>
</li>
</ul>
</div>
<div class="sect3">
<h4 id="_tests_con_spock_sobre_clases_de_dominio_en_grails">6.3.1. Tests con Spock sobre clases de dominio en Grails</h4>
<div class="paragraph">
<p>Empecemos pues con los tests sobre los artefactos de una aplicaciÃ³n Grails y lo haremos sobre las clases de dominio y mÃ¡s concretamente sobre las restricciones.</p>
</div>
<div class="paragraph">
<p>Partiendo de nuestra clase de dominio <em>Category</em>,</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-kn">package</span> <span class="tok-n">es</span><span class="tok-o">.</span><span class="tok-na">ua</span><span class="tok-o">.</span><span class="tok-na">expertojava</span><span class="tok-o">.</span><span class="tok-na">todo</span>

<span class="tok-kd">class</span> <span class="tok-nc">Category</span> <span class="tok-o">{</span>

    <span class="tok-n">String</span> <span class="tok-n">name</span>
    <span class="tok-n">String</span> <span class="tok-n">description</span>

    <span class="tok-kd">static</span> <span class="tok-n">hasMany</span> <span class="tok-o">=</span> <span class="tok-o">[</span><span class="tok-nl">todos:</span><span class="tok-n">Todo</span><span class="tok-o">]</span>

    <span class="tok-kd">static</span> <span class="tok-n">constraints</span> <span class="tok-o">=</span> <span class="tok-o">{</span>
        <span class="tok-n">name</span><span class="tok-o">(</span><span class="tok-nl">blank:</span><span class="tok-kc">false</span><span class="tok-o">)</span>
        <span class="tok-n">description</span><span class="tok-o">(</span><span class="tok-nl">blank:</span><span class="tok-kc">true</span><span class="tok-o">,</span> <span class="tok-nl">nullable:</span><span class="tok-kc">true</span><span class="tok-o">,</span> <span class="tok-nl">maxSize:</span><span class="tok-mi">1000</span><span class="tok-o">)</span>
    <span class="tok-o">}</span>

    <span class="tok-n">String</span> <span class="tok-nf">toString</span><span class="tok-o">(){</span>
        <span class="tok-n">name</span>
    <span class="tok-o">}</span>
<span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Vamos a comprobar que las restricciones impuestas sobre las propiedades <em>name</em> y <em>description</em> se cumplen. Para ello, vamos a reutilizar un test unitario creado cuando generÃ¡bamos las clases de dominio llamado <em>CategorySpec.groovy</em> dentro del paquete <em>es.ua.expertojava.todo</em>.</p>
</div>
<div class="paragraph">
<p>Lo ideal es que cada test unitario compruebe Ãºnicamente un aspecto, asÃ­ que vamos a seguir este consejo y crearemos los siguientes tests:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-kn">package</span> <span class="tok-n">es</span><span class="tok-o">.</span><span class="tok-na">ua</span><span class="tok-o">.</span><span class="tok-na">expertojava</span><span class="tok-o">.</span><span class="tok-na">todo</span>

<span class="tok-kn">import</span> <span class="tok-nn">grails.test.mixin.TestFor</span>
<span class="tok-kn">import</span> <span class="tok-nn">spock.lang.Specification</span>
<span class="tok-kn">import</span> <span class="tok-nn">spock.lang.Unroll</span>

<span class="tok-cm">/**</span>
<span class="tok-cm"> * See the API for {@link grails.test.mixin.domain.DomainClassUnitTestMixin} for usage instructions</span>
<span class="tok-cm"> */</span>
<span class="tok-nd">@TestFor</span><span class="tok-o">(</span><span class="tok-n">Category</span><span class="tok-o">)</span>
<span class="tok-kd">class</span> <span class="tok-nc">CategorySpec</span> <span class="tok-kd">extends</span> <span class="tok-n">Specification</span> <span class="tok-o">{</span>

    <span class="tok-kt">def</span> <span class="tok-nf">setup</span><span class="tok-o">()</span> <span class="tok-o">{</span>
    <span class="tok-o">}</span>

    <span class="tok-kt">def</span> <span class="tok-nf">cleanup</span><span class="tok-o">()</span> <span class="tok-o">{</span>
    <span class="tok-o">}</span>

    <span class="tok-kt">def</span> <span class="tok-s2">&quot;El nombre de la categorÃ­a no puede ser la cadena vacÃ­a&quot;</span><span class="tok-o">()</span> <span class="tok-o">{</span>
        <span class="tok-nl">given:</span>
            <span class="tok-kt">def</span> <span class="tok-n">c1</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">Category</span><span class="tok-o">(</span><span class="tok-nl">name:</span><span class="tok-s2">&quot;&quot;</span><span class="tok-o">)</span>
        <span class="tok-nl">when:</span>
            <span class="tok-n">c1</span><span class="tok-o">.</span><span class="tok-na">validate</span><span class="tok-o">()</span>
        <span class="tok-nl">then:</span>
            <span class="tok-n">c1</span><span class="tok-o">?.</span><span class="tok-na">errors</span><span class="tok-o">[</span><span class="tok-s1">&#39;name&#39;</span><span class="tok-o">]</span>
    <span class="tok-o">}</span>

    <span class="tok-kt">def</span> <span class="tok-s2">&quot;Si el nombre no es la cadena vacÃ­a, este campo no darÃ¡ problemas&quot;</span><span class="tok-o">()</span> <span class="tok-o">{</span>
        <span class="tok-nl">given:</span>
            <span class="tok-kt">def</span> <span class="tok-n">c1</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">Category</span><span class="tok-o">(</span><span class="tok-nl">name:</span><span class="tok-s2">&quot;algo&quot;</span><span class="tok-o">)</span>
        <span class="tok-nl">when:</span>
            <span class="tok-n">c1</span><span class="tok-o">.</span><span class="tok-na">validate</span><span class="tok-o">()</span>
        <span class="tok-nl">then:</span>
            <span class="tok-o">!</span><span class="tok-n">c1</span><span class="tok-o">?.</span><span class="tok-na">errors</span><span class="tok-o">[</span><span class="tok-s1">&#39;name&#39;</span><span class="tok-o">]</span>
    <span class="tok-o">}</span>

    <span class="tok-kt">def</span> <span class="tok-s2">&quot;La descripciÃ³n de la categorÃ­a puede ser la cadena vacÃ­a&quot;</span><span class="tok-o">()</span> <span class="tok-o">{</span>
        <span class="tok-nl">given:</span>
            <span class="tok-kt">def</span> <span class="tok-n">c1</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">Category</span><span class="tok-o">(</span><span class="tok-nl">description:</span> <span class="tok-s2">&quot;&quot;</span><span class="tok-o">)</span>
        <span class="tok-nl">when:</span>
            <span class="tok-n">c1</span><span class="tok-o">.</span><span class="tok-na">validate</span><span class="tok-o">()</span>
        <span class="tok-nl">then:</span>
            <span class="tok-o">!</span><span class="tok-n">c1</span><span class="tok-o">?.</span><span class="tok-na">errors</span><span class="tok-o">[</span><span class="tok-s1">&#39;description&#39;</span><span class="tok-o">]</span>
    <span class="tok-o">}</span>

    <span class="tok-kt">def</span> <span class="tok-s2">&quot;Si la descripciÃ³n es la cadena vacÃ­a, este campo no darÃ¡ problemas&quot;</span><span class="tok-o">()</span> <span class="tok-o">{</span>
        <span class="tok-nl">given:</span>
            <span class="tok-kt">def</span> <span class="tok-n">c1</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">Category</span><span class="tok-o">(</span><span class="tok-nl">description:</span><span class="tok-s2">&quot;&quot;</span><span class="tok-o">)</span>
        <span class="tok-nl">when:</span>
            <span class="tok-n">c1</span><span class="tok-o">.</span><span class="tok-na">validate</span><span class="tok-o">()</span>
        <span class="tok-nl">then:</span>
            <span class="tok-o">!</span><span class="tok-n">c1</span><span class="tok-o">?.</span><span class="tok-na">errors</span><span class="tok-o">[</span><span class="tok-s1">&#39;description&#39;</span><span class="tok-o">]</span>
    <span class="tok-o">}</span>

    <span class="tok-kt">def</span> <span class="tok-s2">&quot;La descripciÃ³n de la categorÃ­a puede ser null&quot;</span><span class="tok-o">()</span> <span class="tok-o">{</span>
        <span class="tok-nl">given:</span>
            <span class="tok-kt">def</span> <span class="tok-n">c1</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">Category</span><span class="tok-o">(</span><span class="tok-nl">description:</span> <span class="tok-kc">null</span><span class="tok-o">)</span>
        <span class="tok-nl">when:</span>
            <span class="tok-n">c1</span><span class="tok-o">.</span><span class="tok-na">validate</span><span class="tok-o">()</span>
        <span class="tok-nl">then:</span>
            <span class="tok-o">!</span><span class="tok-n">c1</span><span class="tok-o">?.</span><span class="tok-na">errors</span><span class="tok-o">[</span><span class="tok-s1">&#39;description&#39;</span><span class="tok-o">]</span>
    <span class="tok-o">}</span>

    <span class="tok-nd">@Unroll</span>
    <span class="tok-kt">def</span> <span class="tok-s2">&quot;Si la descripciÃ³n tiene menos de 1001 caracteres, no darÃ¡ problemas&quot;</span><span class="tok-o">()</span> <span class="tok-o">{</span>
        <span class="tok-nl">given:</span>
            <span class="tok-kt">def</span> <span class="tok-n">c1</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">Category</span><span class="tok-o">(</span><span class="tok-nl">description:</span> <span class="tok-s2">&quot;a&quot;</span><span class="tok-o">*</span><span class="tok-n">characters</span><span class="tok-o">)</span>
        <span class="tok-nl">when:</span>
            <span class="tok-n">c1</span><span class="tok-o">.</span><span class="tok-na">validate</span><span class="tok-o">()</span>
        <span class="tok-nl">then:</span>
            <span class="tok-o">!</span><span class="tok-n">c1</span><span class="tok-o">?.</span><span class="tok-na">errors</span><span class="tok-o">[</span><span class="tok-s1">&#39;description&#39;</span><span class="tok-o">]</span>
        <span class="tok-nl">where:</span>
            <span class="tok-n">characters</span> <span class="tok-o">&lt;&lt;</span> <span class="tok-o">[</span><span class="tok-mi">0</span><span class="tok-o">,</span><span class="tok-mi">1</span><span class="tok-o">,</span><span class="tok-mi">999</span><span class="tok-o">,</span><span class="tok-mi">1000</span><span class="tok-o">]</span>
    <span class="tok-o">}</span>

    <span class="tok-nd">@Unroll</span>
    <span class="tok-kt">def</span> <span class="tok-s2">&quot;Si la descripciÃ³n tiene mÃ¡s 1000 caracteres, darÃ¡ problemas&quot;</span><span class="tok-o">()</span> <span class="tok-o">{</span>
        <span class="tok-nl">given:</span>
            <span class="tok-kt">def</span> <span class="tok-n">c1</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">Category</span><span class="tok-o">(</span><span class="tok-nl">description:</span> <span class="tok-s2">&quot;a&quot;</span><span class="tok-o">*</span><span class="tok-n">characters</span><span class="tok-o">)</span>
        <span class="tok-nl">when:</span>
            <span class="tok-n">c1</span><span class="tok-o">.</span><span class="tok-na">validate</span><span class="tok-o">()</span>
        <span class="tok-nl">then:</span>
            <span class="tok-n">c1</span><span class="tok-o">?.</span><span class="tok-na">errors</span><span class="tok-o">[</span><span class="tok-s1">&#39;description&#39;</span><span class="tok-o">]</span>
        <span class="tok-nl">where:</span>
            <span class="tok-n">characters</span> <span class="tok-o">&lt;&lt;</span> <span class="tok-o">[</span><span class="tok-mi">1001</span><span class="tok-o">,</span><span class="tok-mi">1002</span><span class="tok-o">]</span>
    <span class="tok-o">}</span>
<span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Con esta baterÃ­a de tests nos aseguraremos de que las instancias creadas para la clase de dominio CategorÃ­a cumplen los requisitos definidos en las restricciones. De igual forma, vamos a realizar un Ãºltimo test para comprobar que cuando se crea una instancia de CategorÃ­a correctamente, el valor devuelto por Ã©sta coincide con la sobrecarga del mÃ©todo <em>toString()</em> que hayamos hecho en la clase de dominio.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-o">...</span>
    <span class="tok-kt">def</span> <span class="tok-s2">&quot;La instancia de CategorÃ­a devuelve su nombre por defecto&quot;</span><span class="tok-o">()</span> <span class="tok-o">{</span>
        <span class="tok-nl">expect:</span>
            <span class="tok-k">new</span> <span class="tok-nf">Category</span><span class="tok-o">(</span><span class="tok-nl">name:</span><span class="tok-s2">&quot;The category name&quot;</span><span class="tok-o">).</span><span class="tok-na">toString</span><span class="tok-o">()</span> <span class="tok-o">==</span> <span class="tok-s2">&quot;The category name&quot;</span>
    <span class="tok-o">}</span>
<span class="tok-o">...</span></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_tests_con_spock_sobre_controladores_en_grails">6.3.2. Tests con Spock sobre controladores en Grails</h4>
<div class="paragraph">
<p>Una vez hemos visto como podemos testear nuestras clases de dominio, vamos a ver como podemos hacer lo mismo con los controladores y para ello vamos a basarnos en el cÃ³digo generado para el controlador <em>CategoryController.groovy</em>. Cuando creÃ¡bamos este controlador, al mismo tiempo se creaba un test <em>CategoryControllerSpec.groovy</em> con cÃ³digo tambiÃ©n generado, pero que nosotros necesitaremos completar, en este caso, con la informaciÃ³n necesaria procedente de la clase de dominio <em>Category</em>.</p>
</div>
<div class="paragraph">
<p>Si abrimos el archivo <em>CategoryControllerSpec.groovy</em> con nuestro editor veremos como en la parte superior hay definido un mÃ©todo con un comentario de tipo <em>TODO</em> para avisarnos de que hay algo que debemos completar, que bÃ¡sicamente serÃ¡ la informaciÃ³n necesaria para crear una instancia de tipo <em>Tag</em> de forma correcta.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-kn">package</span> <span class="tok-n">es</span><span class="tok-o">.</span><span class="tok-na">ua</span><span class="tok-o">.</span><span class="tok-na">expertojava</span><span class="tok-o">.</span><span class="tok-na">todo</span>

<span class="tok-kn">import</span> <span class="tok-nn">grails.test.mixin.*</span>
<span class="tok-kn">import</span> <span class="tok-nn">spock.lang.*</span>

<span class="tok-nd">@TestFor</span><span class="tok-o">(</span><span class="tok-n">CategoryController</span><span class="tok-o">)</span>
<span class="tok-nd">@Mock</span><span class="tok-o">(</span><span class="tok-n">Category</span><span class="tok-o">)</span>
<span class="tok-kd">class</span> <span class="tok-nc">CategoryControllerSpec</span> <span class="tok-kd">extends</span> <span class="tok-n">Specification</span> <span class="tok-o">{</span>

    <span class="tok-kt">def</span> <span class="tok-nf">populateValidParams</span><span class="tok-o">(</span><span class="tok-n">params</span><span class="tok-o">)</span> <span class="tok-o">{</span>
        <span class="tok-k">assert</span> <span class="tok-n">params</span> <span class="tok-o">!=</span> <span class="tok-kc">null</span>
        <span class="tok-c1">// TODO: Populate valid properties like...</span>
        <span class="tok-c1">//params[&quot;name&quot;] = &#39;someValidName&#39;</span>
    <span class="tok-o">}</span>
<span class="tok-o">...</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>En nuestro caso, sÃ³lo serÃ¡ necesario aÃ±adir la informaciÃ³n referente al nombre, para que los tests se ejecuten de forma satisfactoria, con lo que podrÃ­amos tener algo asÃ­:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-kt">def</span> <span class="tok-nf">populateValidParams</span><span class="tok-o">(</span><span class="tok-n">params</span><span class="tok-o">)</span> <span class="tok-o">{</span>
    <span class="tok-k">assert</span> <span class="tok-n">params</span> <span class="tok-o">!=</span> <span class="tok-kc">null</span>
    <span class="tok-n">params</span><span class="tok-o">[</span><span class="tok-s2">&quot;name&quot;</span><span class="tok-o">]</span> <span class="tok-o">=</span> <span class="tok-s1">&#39;Category name&#39;</span>
<span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Si ahora ejecutamos en lÃ­nea de comandos</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="bash">grails <span class="tok-nb">test</span>-app CategoryControllerSpec unit:</code></pre>
</div>
</div>
<div class="paragraph">
<p>comprobaremos como todos los tests se han ejecutado correctamente. Veamos como quedarÃ­a el cÃ³digo del test:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-kn">package</span> <span class="tok-n">es</span><span class="tok-o">.</span><span class="tok-na">ua</span><span class="tok-o">.</span><span class="tok-na">expertojava</span><span class="tok-o">.</span><span class="tok-na">todo</span>

<span class="tok-kn">import</span> <span class="tok-nn">grails.test.mixin.*</span>
<span class="tok-kn">import</span> <span class="tok-nn">spock.lang.*</span>

<span class="tok-nd">@TestFor</span><span class="tok-o">(</span><span class="tok-n">CategoryController</span><span class="tok-o">)</span>
<span class="tok-nd">@Mock</span><span class="tok-o">(</span><span class="tok-n">Category</span><span class="tok-o">)</span>
<span class="tok-kd">class</span> <span class="tok-nc">CategoryControllerSpec</span> <span class="tok-kd">extends</span> <span class="tok-n">Specification</span> <span class="tok-o">{</span>

    <span class="tok-kt">def</span> <span class="tok-nf">populateValidParams</span><span class="tok-o">(</span><span class="tok-n">params</span><span class="tok-o">)</span> <span class="tok-o">{</span>
        <span class="tok-k">assert</span> <span class="tok-n">params</span> <span class="tok-o">!=</span> <span class="tok-kc">null</span>
        <span class="tok-n">params</span><span class="tok-o">[</span><span class="tok-s2">&quot;name&quot;</span><span class="tok-o">]</span> <span class="tok-o">=</span> <span class="tok-s1">&#39;Category name&#39;</span>
    <span class="tok-o">}</span>

    <span class="tok-kt">void</span> <span class="tok-s2">&quot;Test the index action returns the correct model&quot;</span><span class="tok-o">()</span> <span class="tok-o">{</span>

        <span class="tok-nl">when:</span><span class="tok-s2">&quot;The index action is executed&quot;</span>
            <span class="tok-n">controller</span><span class="tok-o">.</span><span class="tok-na">index</span><span class="tok-o">()</span>

        <span class="tok-nl">then:</span><span class="tok-s2">&quot;The model is correct&quot;</span>
            <span class="tok-o">!</span><span class="tok-n">model</span><span class="tok-o">.</span><span class="tok-na">categoryInstanceList</span>
            <span class="tok-n">model</span><span class="tok-o">.</span><span class="tok-na">categoryInstanceCount</span> <span class="tok-o">==</span> <span class="tok-mi">0</span>
    <span class="tok-o">}</span>

    <span class="tok-kt">void</span> <span class="tok-s2">&quot;Test the create action returns the correct model&quot;</span><span class="tok-o">()</span> <span class="tok-o">{</span>
        <span class="tok-nl">when:</span><span class="tok-s2">&quot;The create action is executed&quot;</span>
            <span class="tok-n">controller</span><span class="tok-o">.</span><span class="tok-na">create</span><span class="tok-o">()</span>

        <span class="tok-nl">then:</span><span class="tok-s2">&quot;The model is correctly created&quot;</span>
            <span class="tok-n">model</span><span class="tok-o">.</span><span class="tok-na">categoryInstance</span><span class="tok-o">!=</span> <span class="tok-kc">null</span>
    <span class="tok-o">}</span>

    <span class="tok-kt">void</span> <span class="tok-s2">&quot;Test the save action correctly persists an instance&quot;</span><span class="tok-o">()</span> <span class="tok-o">{</span>

        <span class="tok-nl">when:</span><span class="tok-s2">&quot;The save action is executed with an invalid instance&quot;</span>
            <span class="tok-n">request</span><span class="tok-o">.</span><span class="tok-na">contentType</span> <span class="tok-o">=</span> <span class="tok-n">FORM_CONTENT_TYPE</span>
            <span class="tok-n">request</span><span class="tok-o">.</span><span class="tok-na">method</span> <span class="tok-o">=</span> <span class="tok-s1">&#39;POST&#39;</span>
            <span class="tok-kt">def</span> <span class="tok-n">category</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">Category</span><span class="tok-o">()</span>
            <span class="tok-n">category</span><span class="tok-o">.</span><span class="tok-na">validate</span><span class="tok-o">()</span>
            <span class="tok-n">controller</span><span class="tok-o">.</span><span class="tok-na">save</span><span class="tok-o">(</span><span class="tok-n">category</span><span class="tok-o">)</span>

        <span class="tok-nl">then:</span><span class="tok-s2">&quot;The create view is rendered again with the correct model&quot;</span>
            <span class="tok-n">model</span><span class="tok-o">.</span><span class="tok-na">categoryInstance</span><span class="tok-o">!=</span> <span class="tok-kc">null</span>
            <span class="tok-n">view</span> <span class="tok-o">==</span> <span class="tok-s1">&#39;create&#39;</span>

        <span class="tok-nl">when:</span><span class="tok-s2">&quot;The save action is executed with a valid instance&quot;</span>
            <span class="tok-n">response</span><span class="tok-o">.</span><span class="tok-na">reset</span><span class="tok-o">()</span>
            <span class="tok-n">populateValidParams</span><span class="tok-o">(</span><span class="tok-n">params</span><span class="tok-o">)</span>
            <span class="tok-n">category</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">Category</span><span class="tok-o">(</span><span class="tok-n">params</span><span class="tok-o">)</span>

            <span class="tok-n">controller</span><span class="tok-o">.</span><span class="tok-na">save</span><span class="tok-o">(</span><span class="tok-n">category</span><span class="tok-o">)</span>

        <span class="tok-nl">then:</span><span class="tok-s2">&quot;A redirect is issued to the show action&quot;</span>
            <span class="tok-n">response</span><span class="tok-o">.</span><span class="tok-na">redirectedUrl</span> <span class="tok-o">==</span> <span class="tok-s1">&#39;/category/show/1&#39;</span>
            <span class="tok-n">controller</span><span class="tok-o">.</span><span class="tok-na">flash</span><span class="tok-o">.</span><span class="tok-na">message</span> <span class="tok-o">!=</span> <span class="tok-kc">null</span>
            <span class="tok-n">Category</span><span class="tok-o">.</span><span class="tok-na">count</span><span class="tok-o">()</span> <span class="tok-o">==</span> <span class="tok-mi">1</span>
    <span class="tok-o">}</span>

    <span class="tok-kt">void</span> <span class="tok-s2">&quot;Test that the show action returns the correct model&quot;</span><span class="tok-o">()</span> <span class="tok-o">{</span>
        <span class="tok-nl">when:</span><span class="tok-s2">&quot;The show action is executed with a null domain&quot;</span>
            <span class="tok-n">controller</span><span class="tok-o">.</span><span class="tok-na">show</span><span class="tok-o">(</span><span class="tok-kc">null</span><span class="tok-o">)</span>

        <span class="tok-nl">then:</span><span class="tok-s2">&quot;A 404 error is returned&quot;</span>
            <span class="tok-n">response</span><span class="tok-o">.</span><span class="tok-na">status</span> <span class="tok-o">==</span> <span class="tok-mi">404</span>

        <span class="tok-nl">when:</span><span class="tok-s2">&quot;A domain instance is passed to the show action&quot;</span>
            <span class="tok-n">populateValidParams</span><span class="tok-o">(</span><span class="tok-n">params</span><span class="tok-o">)</span>
            <span class="tok-kt">def</span> <span class="tok-n">category</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">Category</span><span class="tok-o">(</span><span class="tok-n">params</span><span class="tok-o">)</span>
            <span class="tok-n">controller</span><span class="tok-o">.</span><span class="tok-na">show</span><span class="tok-o">(</span><span class="tok-n">category</span><span class="tok-o">)</span>

        <span class="tok-nl">then:</span><span class="tok-s2">&quot;A model is populated containing the domain instance&quot;</span>
            <span class="tok-n">model</span><span class="tok-o">.</span><span class="tok-na">categoryInstance</span> <span class="tok-o">==</span> <span class="tok-n">category</span>
    <span class="tok-o">}</span>

    <span class="tok-kt">void</span> <span class="tok-s2">&quot;Test that the edit action returns the correct model&quot;</span><span class="tok-o">()</span> <span class="tok-o">{</span>
        <span class="tok-nl">when:</span><span class="tok-s2">&quot;The edit action is executed with a null domain&quot;</span>
            <span class="tok-n">controller</span><span class="tok-o">.</span><span class="tok-na">edit</span><span class="tok-o">(</span><span class="tok-kc">null</span><span class="tok-o">)</span>

        <span class="tok-nl">then:</span><span class="tok-s2">&quot;A 404 error is returned&quot;</span>
            <span class="tok-n">response</span><span class="tok-o">.</span><span class="tok-na">status</span> <span class="tok-o">==</span> <span class="tok-mi">404</span>

        <span class="tok-nl">when:</span><span class="tok-s2">&quot;A domain instance is passed to the edit action&quot;</span>
            <span class="tok-n">populateValidParams</span><span class="tok-o">(</span><span class="tok-n">params</span><span class="tok-o">)</span>
            <span class="tok-kt">def</span> <span class="tok-n">category</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">Category</span><span class="tok-o">(</span><span class="tok-n">params</span><span class="tok-o">)</span>
            <span class="tok-n">controller</span><span class="tok-o">.</span><span class="tok-na">edit</span><span class="tok-o">(</span><span class="tok-n">category</span><span class="tok-o">)</span>

        <span class="tok-nl">then:</span><span class="tok-s2">&quot;A model is populated containing the domain instance&quot;</span>
            <span class="tok-n">model</span><span class="tok-o">.</span><span class="tok-na">categoryInstance</span> <span class="tok-o">==</span> <span class="tok-n">category</span>
    <span class="tok-o">}</span>

    <span class="tok-kt">void</span> <span class="tok-s2">&quot;Test the update action performs an update on a valid domain instance&quot;</span><span class="tok-o">()</span> <span class="tok-o">{</span>
        <span class="tok-nl">when:</span><span class="tok-s2">&quot;Update is called for a domain instance that doesn&#39;t exist&quot;</span>
            <span class="tok-n">request</span><span class="tok-o">.</span><span class="tok-na">contentType</span> <span class="tok-o">=</span> <span class="tok-n">FORM_CONTENT_TYPE</span>
            <span class="tok-n">request</span><span class="tok-o">.</span><span class="tok-na">method</span> <span class="tok-o">=</span> <span class="tok-s1">&#39;PUT&#39;</span>
            <span class="tok-n">controller</span><span class="tok-o">.</span><span class="tok-na">update</span><span class="tok-o">(</span><span class="tok-kc">null</span><span class="tok-o">)</span>

        <span class="tok-nl">then:</span><span class="tok-s2">&quot;A 404 error is returned&quot;</span>
            <span class="tok-n">response</span><span class="tok-o">.</span><span class="tok-na">redirectedUrl</span> <span class="tok-o">==</span> <span class="tok-s1">&#39;/category/index&#39;</span>
            <span class="tok-n">flash</span><span class="tok-o">.</span><span class="tok-na">message</span> <span class="tok-o">!=</span> <span class="tok-kc">null</span>


        <span class="tok-nl">when:</span><span class="tok-s2">&quot;An invalid domain instance is passed to the update action&quot;</span>
            <span class="tok-n">response</span><span class="tok-o">.</span><span class="tok-na">reset</span><span class="tok-o">()</span>
            <span class="tok-kt">def</span> <span class="tok-n">category</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">Category</span><span class="tok-o">()</span>
            <span class="tok-n">category</span><span class="tok-o">.</span><span class="tok-na">validate</span><span class="tok-o">()</span>
            <span class="tok-n">controller</span><span class="tok-o">.</span><span class="tok-na">update</span><span class="tok-o">(</span><span class="tok-n">category</span><span class="tok-o">)</span>

        <span class="tok-nl">then:</span><span class="tok-s2">&quot;The edit view is rendered again with the invalid instance&quot;</span>
            <span class="tok-n">view</span> <span class="tok-o">==</span> <span class="tok-s1">&#39;edit&#39;</span>
            <span class="tok-n">model</span><span class="tok-o">.</span><span class="tok-na">categoryInstance</span> <span class="tok-o">==</span> <span class="tok-n">category</span>

        <span class="tok-nl">when:</span><span class="tok-s2">&quot;A valid domain instance is passed to the update action&quot;</span>
            <span class="tok-n">response</span><span class="tok-o">.</span><span class="tok-na">reset</span><span class="tok-o">()</span>
            <span class="tok-n">populateValidParams</span><span class="tok-o">(</span><span class="tok-n">params</span><span class="tok-o">)</span>
            <span class="tok-n">category</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">Category</span><span class="tok-o">(</span><span class="tok-n">params</span><span class="tok-o">).</span><span class="tok-na">save</span><span class="tok-o">(</span><span class="tok-nl">flush:</span> <span class="tok-kc">true</span><span class="tok-o">)</span>
            <span class="tok-n">controller</span><span class="tok-o">.</span><span class="tok-na">update</span><span class="tok-o">(</span><span class="tok-n">category</span><span class="tok-o">)</span>

        <span class="tok-nl">then:</span><span class="tok-s2">&quot;A redirect is issues to the show action&quot;</span>
            <span class="tok-n">response</span><span class="tok-o">.</span><span class="tok-na">redirectedUrl</span> <span class="tok-o">==</span> <span class="tok-s2">&quot;/category/show/$category.id&quot;</span>
            <span class="tok-n">flash</span><span class="tok-o">.</span><span class="tok-na">message</span> <span class="tok-o">!=</span> <span class="tok-kc">null</span>
    <span class="tok-o">}</span>

    <span class="tok-kt">void</span> <span class="tok-s2">&quot;Test that the delete action deletes an instance if it exists&quot;</span><span class="tok-o">()</span> <span class="tok-o">{</span>
        <span class="tok-nl">when:</span><span class="tok-s2">&quot;The delete action is called for a null instance&quot;</span>
            <span class="tok-n">request</span><span class="tok-o">.</span><span class="tok-na">contentType</span> <span class="tok-o">=</span> <span class="tok-n">FORM_CONTENT_TYPE</span>
            <span class="tok-n">request</span><span class="tok-o">.</span><span class="tok-na">method</span> <span class="tok-o">=</span> <span class="tok-s1">&#39;DELETE&#39;</span>
            <span class="tok-n">controller</span><span class="tok-o">.</span><span class="tok-na">delete</span><span class="tok-o">(</span><span class="tok-kc">null</span><span class="tok-o">)</span>

        <span class="tok-nl">then:</span><span class="tok-s2">&quot;A 404 is returned&quot;</span>
            <span class="tok-n">response</span><span class="tok-o">.</span><span class="tok-na">redirectedUrl</span> <span class="tok-o">==</span> <span class="tok-s1">&#39;/category/index&#39;</span>
            <span class="tok-n">flash</span><span class="tok-o">.</span><span class="tok-na">message</span> <span class="tok-o">!=</span> <span class="tok-kc">null</span>

        <span class="tok-nl">when:</span><span class="tok-s2">&quot;A domain instance is created&quot;</span>
            <span class="tok-n">response</span><span class="tok-o">.</span><span class="tok-na">reset</span><span class="tok-o">()</span>
            <span class="tok-n">populateValidParams</span><span class="tok-o">(</span><span class="tok-n">params</span><span class="tok-o">)</span>
            <span class="tok-kt">def</span> <span class="tok-n">category</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">Category</span><span class="tok-o">(</span><span class="tok-n">params</span><span class="tok-o">).</span><span class="tok-na">save</span><span class="tok-o">(</span><span class="tok-nl">flush:</span> <span class="tok-kc">true</span><span class="tok-o">)</span>

        <span class="tok-nl">then:</span><span class="tok-s2">&quot;It exists&quot;</span>
            <span class="tok-n">Category</span><span class="tok-o">.</span><span class="tok-na">count</span><span class="tok-o">()</span> <span class="tok-o">==</span> <span class="tok-mi">1</span>

        <span class="tok-nl">when:</span><span class="tok-s2">&quot;The domain instance is passed to the delete action&quot;</span>
            <span class="tok-n">controller</span><span class="tok-o">.</span><span class="tok-na">delete</span><span class="tok-o">(</span><span class="tok-n">category</span><span class="tok-o">)</span>

        <span class="tok-nl">then:</span><span class="tok-s2">&quot;The instance is deleted&quot;</span>
            <span class="tok-n">Category</span><span class="tok-o">.</span><span class="tok-na">count</span><span class="tok-o">()</span> <span class="tok-o">==</span> <span class="tok-mi">0</span>
            <span class="tok-n">response</span><span class="tok-o">.</span><span class="tok-na">redirectedUrl</span> <span class="tok-o">==</span> <span class="tok-s1">&#39;/category/index&#39;</span>
            <span class="tok-n">flash</span><span class="tok-o">.</span><span class="tok-na">message</span> <span class="tok-o">!=</span> <span class="tok-kc">null</span>
    <span class="tok-o">}</span>
<span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Â¿QuÃ© podemos extraer de estos tests generados?</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Una serie de variables han sido automÃ¡ticamente inyectadas en nuestro test como son <em>controller</em>, <em>model</em>, <em>view</em>, <em>response</em>, <em>request</em> y <em>flash</em>.</p>
</li>
<li>
<p>Se utiliza la anotaciÃ³n <em>@Mock()</em> para mockear el comportamiento de la clase de dominio pasada por parÃ¡metro. De esta forma se simula su almacenamiento.</p>
</li>
<li>
<p>Para invocar un mÃ©todo cualquiera del controlador simplemente debemos ejecutar <em>controller.method()</em></p>
</li>
<li>
<p>La variable <em>model</em> nos permitirÃ¡ comprobar si el modelo que devolvemos es el esperado</p>
</li>
<li>
<p>Las redirecciones se pueden comprobar con la variable <em>response.redirectedUrl</em></p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_tests_con_spock_sobre_librerÃ­as_de_etiquetas_vistas_y_plantillas_en_grails">6.3.3. Tests con Spock sobre librerÃ­as de etiquetas, vistas y plantillas en Grails</h4>
<div class="paragraph">
<p>Como siempre, cuando creÃ¡bamos la librerÃ­a de etiquetas <em>TodoTagLib.groovy</em>, se creaba automÃ¡ticamente un esqueleto de test unitario:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-kn">package</span> <span class="tok-n">es</span><span class="tok-o">.</span><span class="tok-na">ua</span><span class="tok-o">.</span><span class="tok-na">expertojava</span><span class="tok-o">.</span><span class="tok-na">todo</span>

<span class="tok-kn">import</span> <span class="tok-nn">grails.test.mixin.TestFor</span>
<span class="tok-kn">import</span> <span class="tok-nn">spock.lang.Specification</span>

<span class="tok-cm">/**</span>
<span class="tok-cm"> * See the API for {@link grails.test.mixin.web.GroovyPageUnitTestMixin} for usage instructions</span>
<span class="tok-cm"> */</span>
<span class="tok-nd">@TestFor</span><span class="tok-o">(</span><span class="tok-n">TodoTagLib</span><span class="tok-o">)</span>
<span class="tok-kd">class</span> <span class="tok-nc">TodoTagLibSpec</span> <span class="tok-kd">extends</span> <span class="tok-n">Specification</span> <span class="tok-o">{</span>

    <span class="tok-kt">def</span> <span class="tok-nf">setup</span><span class="tok-o">()</span> <span class="tok-o">{</span>
    <span class="tok-o">}</span>

    <span class="tok-kt">def</span> <span class="tok-nf">cleanup</span><span class="tok-o">()</span> <span class="tok-o">{</span>
    <span class="tok-o">}</span>

    <span class="tok-kt">void</span> <span class="tok-s2">&quot;test something&quot;</span><span class="tok-o">()</span> <span class="tok-o">{</span>
    <span class="tok-o">}</span>
<span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Mediante la anotaciÃ³n <em>@TestFor(TodoTagLib)</em> la variable <em>tagLib</em> se inyecta automÃ¡ticamente en nuestros tests. Si hacemos memoria, cuando hablÃ¡bamos de las librerÃ­as de etiquetas ponÃ­amos como ejemplo</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-kt">def</span> <span class="tok-n">includeJs</span> <span class="tok-o">=</span> <span class="tok-o">{</span><span class="tok-n">attrs</span> <span class="tok-o">-&gt;</span>
    <span class="tok-n">out</span> <span class="tok-o">&lt;&lt;</span> <span class="tok-s2">&quot;&lt;script src=&#39;scripts/${attrs[&#39;script&#39;]}.js&#39;&gt;&lt;/script&gt;&quot;</span>
<span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Vamos a ver a continuaciÃ³n como podemos comprobar que esta etiqueta devuelve lo que pensamos.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-kt">void</span> <span class="tok-s2">&quot;La etiqueta includeJs devuelve una referencia a la librerÃ­a javascript pasada por parÃ¡metro&quot;</span><span class="tok-o">()</span> <span class="tok-o">{</span>
    <span class="tok-nl">expect:</span>
        <span class="tok-n">applyTemplate</span><span class="tok-o">(</span><span class="tok-s1">&#39;&lt;todo:includeJs script=&quot;&quot; /&gt;&#39;</span><span class="tok-o">)</span> <span class="tok-o">==</span> <span class="tok-s2">&quot;&lt;script src=&#39;scripts/.js&#39;&gt;&lt;/script&gt;&quot;</span>
        <span class="tok-n">applyTemplate</span><span class="tok-o">(</span><span class="tok-s1">&#39;&lt;todo:includeJs script=&quot;myfile&quot; /&gt;&#39;</span><span class="tok-o">)</span> <span class="tok-o">==</span> <span class="tok-s2">&quot;&lt;script src=&#39;scripts/myfile.js&#39;&gt;&lt;/script&gt;&quot;</span>
<span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>AdemÃ¡s de testear las librerÃ­as de etiquetas, vamos a comprobar que las vistas y las plantillas devuelven lo que deben devolver. Si recordamos en la sesiÃ³n de vistas y plantillas, creÃ¡bamos una plantilla para pintar el pie de pÃ¡gina. Vamos a poder comprobar que esta plantilla devuelve lo correcto mediante un test unitario:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-kt">void</span> <span class="tok-s2">&quot;El pie de pÃ¡gina se renderiza correctamente&quot;</span><span class="tok-o">()</span> <span class="tok-o">{</span>
    <span class="tok-nl">when:</span>
        <span class="tok-kt">def</span> <span class="tok-n">result</span> <span class="tok-o">=</span> <span class="tok-n">render</span><span class="tok-o">(</span><span class="tok-nl">template:</span> <span class="tok-s1">&#39;/common/footer&#39;</span><span class="tok-o">)</span>

    <span class="tok-nl">then:</span>
        <span class="tok-n">result</span> <span class="tok-o">==</span> <span class="tok-s2">&quot;&lt;div class=\&quot;footer\&quot; role=\&quot;contentinfo\&quot;&gt;\n&quot;</span> <span class="tok-o">+</span>
            <span class="tok-s2">&quot;    &amp;copy; 2015 Experto en Desarrollo de Aplicaciones Web con JavaEE y Javascript&lt;br/&gt;\n&quot;</span> <span class="tok-o">+</span>
            <span class="tok-s2">&quot;    AplicaciÃ³n Todo creada por Francisco JosÃ© GarcÃ­a Rico (21.542.334F)\n&quot;</span> <span class="tok-o">+</span>
            <span class="tok-s2">&quot;&lt;/div&gt;&quot;</span>
<span class="tok-o">}</span></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_tests_con_spock_sobre_servicios_en_grails">6.3.4. Tests con Spock sobre servicios en Grails</h4>
<div class="paragraph">
<p>Tal y como sucede con el resto de artefactos de una aplicaciÃ³n en Grails, cuando creamos un servicio nuevo automÃ¡ticamente se genera tambiÃ©n un test unitario que nos permitirÃ¡ testear los mÃ©todos del servicio.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-kn">package</span> <span class="tok-n">es</span><span class="tok-o">.</span><span class="tok-na">ua</span><span class="tok-o">.</span><span class="tok-na">expertojava</span><span class="tok-o">.</span><span class="tok-na">todo</span>

<span class="tok-kn">import</span> <span class="tok-nn">grails.test.mixin.TestFor</span>
<span class="tok-kn">import</span> <span class="tok-nn">spock.lang.Specification</span>

<span class="tok-cm">/**</span>
<span class="tok-cm"> * See the API for {@link grails.test.mixin.services.ServiceUnitTestMixin} for usage instructions</span>
<span class="tok-cm"> */</span>
<span class="tok-nd">@TestFor</span><span class="tok-o">(</span><span class="tok-n">TodoService</span><span class="tok-o">)</span>
<span class="tok-kd">class</span> <span class="tok-nc">TodoServiceSpec</span> <span class="tok-kd">extends</span> <span class="tok-n">Specification</span> <span class="tok-o">{</span>

    <span class="tok-kt">def</span> <span class="tok-nf">setup</span><span class="tok-o">()</span> <span class="tok-o">{</span>
    <span class="tok-o">}</span>

    <span class="tok-kt">def</span> <span class="tok-nf">cleanup</span><span class="tok-o">()</span> <span class="tok-o">{</span>
    <span class="tok-o">}</span>

    <span class="tok-kt">void</span> <span class="tok-s2">&quot;test something&quot;</span><span class="tok-o">()</span> <span class="tok-o">{</span>
    <span class="tok-o">}</span>
<span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>En su momento creÃ¡bamos un mÃ©todo llamado <em>getNextTodos()</em> que nos devolvÃ­a las tareas programadas para los prÃ³ximos dÃ­as. Para poder testear este mÃ©todo, vamos a necesitar crear una serie de instancias de la clase de dominio <em>Todo</em>. Si recordamos el mÃ©todo en cuestiÃ³n</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-kt">def</span> <span class="tok-nf">getNextTodos</span><span class="tok-o">(</span><span class="tok-n">Integer</span> <span class="tok-n">days</span><span class="tok-o">,</span> <span class="tok-n">params</span><span class="tok-o">)</span> <span class="tok-o">{</span>
    <span class="tok-n">Date</span> <span class="tok-n">now</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">Date</span><span class="tok-o">(</span><span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">currentTimeMillis</span><span class="tok-o">())</span>
    <span class="tok-n">Date</span> <span class="tok-n">to</span> <span class="tok-o">=</span> <span class="tok-n">now</span> <span class="tok-o">+</span> <span class="tok-n">days</span>
    <span class="tok-n">Todo</span><span class="tok-o">.</span><span class="tok-na">findAllByDateBetween</span><span class="tok-o">(</span><span class="tok-n">now</span><span class="tok-o">,</span> <span class="tok-n">to</span><span class="tok-o">,</span> <span class="tok-n">params</span><span class="tok-o">)</span>
<span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>vemos que se utiliza una llamada a un mÃ©todo dinÃ¡mico de GORM, con lo que se se realizarÃ¡ una consulta a la base de datos. Pero, si recordamos la definiciÃ³n de tests unitarios que veÃ­amos al inicio de esta sesiÃ³n, se hacÃ­a menciÃ³n a que los tests unitarios no tienen acceso a recursos externos tales como la base de datos, con lo que, Â¿cÃ³mo vamos a poder solucionar este problema?</p>
</div>
<div class="paragraph">
<p>PodrÃ­amos optar por dos soluciones. Bien crear un test de integraciÃ³n para tener acceso a la base de datos o bien, <em>mockear</em> la creaciÃ³n de las clases de dominio necesarias. Nosotros optamos por la segunda soluciÃ³n, ya que en tÃ©rminos de velocidad de ejecuciÃ³n de los tests, los tests de integraciÃ³n son considerablemente mÃ¡s lentos que los tests unitarios.</p>
</div>
<div class="paragraph">
<p>Para <em>mockear</em> la creaciÃ³n de una serie de instancias de una determinada clase de dominio, vamos a utilizar el mÃ©todo llamado <em>mockDomain</em> al cual le podemos pasar que clase de domino queremos mockear y cuales son esas instancias. Con esto podrÃ­amos tener un test como Ã©ste para comprobar el mÃ©todo <em>getNextTodos()</em>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-kt">void</span> <span class="tok-s2">&quot;El mÃ©todo getNextTodos devuelve los siguientes todos de los dÃ­as pasado por parÃ¡metro&quot;</span><span class="tok-o">()</span> <span class="tok-o">{</span>
    <span class="tok-nl">given:</span>
        <span class="tok-kt">def</span> <span class="tok-n">todoDayBeforeYesterday</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">Todo</span><span class="tok-o">(</span><span class="tok-nl">title:</span><span class="tok-s2">&quot;Todo day before yesterday&quot;</span><span class="tok-o">,</span> <span class="tok-nl">date:</span> <span class="tok-k">new</span> <span class="tok-n">Date</span><span class="tok-o">()</span> <span class="tok-o">-</span> <span class="tok-mi">2</span> <span class="tok-o">)</span>
        <span class="tok-kt">def</span> <span class="tok-n">todoYesterday</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">Todo</span><span class="tok-o">(</span><span class="tok-nl">title:</span><span class="tok-s2">&quot;Todo yesterday&quot;</span><span class="tok-o">,</span> <span class="tok-nl">date:</span> <span class="tok-k">new</span> <span class="tok-n">Date</span><span class="tok-o">()</span> <span class="tok-o">-</span> <span class="tok-mi">1</span> <span class="tok-o">)</span>
        <span class="tok-kt">def</span> <span class="tok-n">todoToday</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">Todo</span><span class="tok-o">(</span><span class="tok-nl">title:</span><span class="tok-s2">&quot;Todo today&quot;</span><span class="tok-o">,</span> <span class="tok-nl">date:</span> <span class="tok-k">new</span> <span class="tok-n">Date</span><span class="tok-o">())</span>
        <span class="tok-kt">def</span> <span class="tok-n">todoTomorrow</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">Todo</span><span class="tok-o">(</span><span class="tok-nl">title:</span><span class="tok-s2">&quot;Todo tomorrow&quot;</span><span class="tok-o">,</span> <span class="tok-nl">date:</span> <span class="tok-k">new</span> <span class="tok-n">Date</span><span class="tok-o">()</span> <span class="tok-o">+</span> <span class="tok-mi">1</span> <span class="tok-o">)</span>
        <span class="tok-kt">def</span> <span class="tok-n">todoDayAfterTomorrow</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">Todo</span><span class="tok-o">(</span><span class="tok-nl">title:</span><span class="tok-s2">&quot;Todo day after tomorrow&quot;</span><span class="tok-o">,</span> <span class="tok-nl">date:</span> <span class="tok-k">new</span> <span class="tok-n">Date</span><span class="tok-o">()</span> <span class="tok-o">+</span> <span class="tok-mi">2</span> <span class="tok-o">)</span>
        <span class="tok-kt">def</span> <span class="tok-n">todoDayAfterDayAfterTomorrow</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">Todo</span><span class="tok-o">(</span><span class="tok-nl">title:</span><span class="tok-s2">&quot;Todo day after tomorrow&quot;</span><span class="tok-o">,</span> <span class="tok-nl">date:</span> <span class="tok-k">new</span> <span class="tok-n">Date</span><span class="tok-o">()</span> <span class="tok-o">+</span> <span class="tok-mi">3</span> <span class="tok-o">)</span>
    <span class="tok-nl">and:</span>
        <span class="tok-n">mockDomain</span><span class="tok-o">(</span><span class="tok-n">Todo</span><span class="tok-o">,[</span><span class="tok-n">todoDayBeforeYesterday</span><span class="tok-o">,</span> <span class="tok-n">todoYesterday</span><span class="tok-o">,</span> <span class="tok-n">todoToday</span><span class="tok-o">,</span> <span class="tok-n">todoTomorrow</span><span class="tok-o">,</span> <span class="tok-n">todoDayAfterTomorrow</span><span class="tok-o">,</span> <span class="tok-n">todoDayAfterDayAfterTomorrow</span><span class="tok-o">])</span>
    <span class="tok-nl">and:</span>
        <span class="tok-kt">def</span> <span class="tok-n">nextTodos</span> <span class="tok-o">=</span> <span class="tok-n">service</span><span class="tok-o">.</span><span class="tok-na">getNextTodos</span><span class="tok-o">(</span><span class="tok-mi">2</span><span class="tok-o">,[:])</span>
    <span class="tok-nl">expect:</span>
        <span class="tok-n">Todo</span><span class="tok-o">.</span><span class="tok-na">count</span><span class="tok-o">()</span> <span class="tok-o">==</span> <span class="tok-mi">6</span>
    <span class="tok-nl">and:</span>
        <span class="tok-n">nextTodos</span><span class="tok-o">.</span><span class="tok-na">containsAll</span><span class="tok-o">([</span><span class="tok-n">todoTomorrow</span><span class="tok-o">,</span> <span class="tok-n">todoDayAfterTomorrow</span><span class="tok-o">])</span>
        <span class="tok-n">nextTodos</span><span class="tok-o">.</span><span class="tok-na">size</span><span class="tok-o">()</span> <span class="tok-o">==</span> <span class="tok-mi">2</span>
    <span class="tok-nl">and:</span>
        <span class="tok-o">!</span><span class="tok-n">nextTodos</span><span class="tok-o">.</span><span class="tok-na">contains</span><span class="tok-o">(</span><span class="tok-n">todoDayBeforeYesterday</span><span class="tok-o">)</span>
        <span class="tok-o">!</span><span class="tok-n">nextTodos</span><span class="tok-o">.</span><span class="tok-na">contains</span><span class="tok-o">(</span><span class="tok-n">todoToday</span><span class="tok-o">)</span>
        <span class="tok-o">!</span><span class="tok-n">nextTodos</span><span class="tok-o">.</span><span class="tok-na">contains</span><span class="tok-o">(</span><span class="tok-n">todoYesterday</span><span class="tok-o">)</span>
        <span class="tok-o">!</span><span class="tok-n">nextTodos</span><span class="tok-o">.</span><span class="tok-na">contains</span><span class="tok-o">(</span><span class="tok-n">todoDayAfterDayAfterTomorrow</span><span class="tok-o">)</span>
<span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>En el test, en primer lugar creamos todas las instancias de la clase de dominio <em>Todo</em> que vamos a utilizar para realizar las comprobaciones. La primera comprobaciÃ³n que realizamos es comprobar que el contador de instancias de la clase <em>Todo</em> es igual al nÃºmero de elementos creados.</p>
</div>
<div class="paragraph">
<p>A continuaciÃ³n, ya comprobamos el mÃ©todo <em>getNextTodos()</em> para comprobar que sÃ³lo devuelve aquellas instancias creadas que coincidan con el criterio de que sean tareas a realizar en el futuro. Esto significa que sÃ³lo las instancias <em>todoTomorrow</em> y <em>todoDayAfterTomorrow</em> serÃ¡n devueltas.</p>
</div>
</div>
<div class="sect3">
<h4 id="_tests_con_spock_mockeando_objetos">6.3.5. Tests con Spock mockeando objetos</h4>
<div class="paragraph">
<p>Los tests unitarios se pueden complicar mucho cuando entran en funcionamiento otros objetos en el mÃ©todo que queremos probar. Por ejemplo, en la sesiÃ³n sobre vistas y etiquetas planteÃ¡bamos un ejercicio para escribir una etiqueta que nos imprimiera por pantalla un icono diferente en funciÃ³n de si el valor pasado por parÃ¡metro era cierto o falso. Esa etiqueta se aconsejaba utilizar a su vez la etiqueta <em>asset.image()</em> procedente del plugin <em>asset pipeline</em>.</p>
</div>
<div class="paragraph">
<p>Si pensamos en que test podrÃ­amos utilizar para comprobar el funcionamiento de la etiqueta <em>printIconFromBoolean</em>, podrÃ­amos pensar algo asÃ­:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-nd">@Unroll</span>
<span class="tok-kt">void</span> <span class="tok-s2">&quot;El mÃ©todo printIconFromBoolean devuelve una ruta a una imagen&quot;</span><span class="tok-o">()</span> <span class="tok-o">{</span>
    <span class="tok-nl">when:</span>
        <span class="tok-kt">def</span> <span class="tok-n">output</span> <span class="tok-o">=</span> <span class="tok-n">applyTemplate</span><span class="tok-o">(</span><span class="tok-s1">&#39;&lt;todo:printIconFromBoolean value=&quot;${value}&quot; /&gt;&#39;</span><span class="tok-o">,</span> <span class="tok-o">[</span><span class="tok-nl">value:</span><span class="tok-n">value</span><span class="tok-o">])</span>
    <span class="tok-nl">then:</span>
        <span class="tok-n">output</span> <span class="tok-o">==</span> <span class="tok-n">expectedOutput</span>
    <span class="tok-nl">where:</span>
        <span class="tok-n">value</span>   <span class="tok-o">|</span>   <span class="tok-n">expectedOutput</span>
        <span class="tok-kc">true</span>    <span class="tok-o">|</span>   <span class="tok-s2">&quot;icontrue.png&quot;</span>
        <span class="tok-kc">false</span>   <span class="tok-o">|</span>   <span class="tok-s2">&quot;iconfalse.png&quot;</span>
<span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Sin embargo, si ejecutamos este test, veremos como el test no se ejecuta correctamente debido a que no sabe como ejecutar un mÃ©todo llamado <em>assetPath</em>. Â¿assetPath? Â¿De dÃ³nde viene la llamada a ese mÃ©todo?</p>
</div>
<div class="paragraph">
<p>Si analizamos el cÃ³digo del mÃ©todo <em>image</em> de la librerÃ­a de etiquetas <em>AssetsTagLib</em> veremos como se realiza una llamada al mÃ©todo <em>assetPath</em> que queda fuera del contexto de nuestro test unitario con lo que no podemos acceder directamente a Ã©l. Para solucionar este problema, debemos <em>mockear</em> la llamada que nuestra etiqueta <em>printIconFromBoolean</em> realiza al mÃ©todo <em>image()</em> de la librerÃ­a de etiquetas del plugin <em>asset pipeline</em>. De esta forma, podemos aislar nuestra prueba unitaria de las llamadas realizadas por otros objetos colaboradores y nos centraremos en la lÃ³gica de nuestro mÃ©todo.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-nd">@Unroll</span>
<span class="tok-kt">void</span> <span class="tok-s2">&quot;El mÃ©todo printIconFromBoolean devuelve una ruta a una imagen&quot;</span><span class="tok-o">()</span> <span class="tok-o">{</span>
    <span class="tok-nl">given:</span>
        <span class="tok-kt">def</span> <span class="tok-n">assetsTagLib</span> <span class="tok-o">=</span> <span class="tok-n">Mock</span><span class="tok-o">(</span><span class="tok-n">AssetsTagLib</span><span class="tok-o">)</span>
        <span class="tok-n">tagLib</span><span class="tok-o">.</span><span class="tok-na">metaClass</span><span class="tok-o">.</span><span class="tok-na">asset</span> <span class="tok-o">=</span> <span class="tok-n">assetsTagLib</span>
    <span class="tok-nl">when:</span>
        <span class="tok-kt">def</span> <span class="tok-n">output</span> <span class="tok-o">=</span> <span class="tok-n">applyTemplate</span><span class="tok-o">(</span><span class="tok-s1">&#39;&lt;todo:printIconFromBoolean value=&quot;${value}&quot; /&gt;&#39;</span><span class="tok-o">,</span> <span class="tok-o">[</span><span class="tok-nl">value:</span><span class="tok-n">value</span><span class="tok-o">])</span>
    <span class="tok-nl">then:</span>
        <span class="tok-n">output</span> <span class="tok-o">==</span> <span class="tok-n">expectedOutput</span>
    <span class="tok-nl">and:</span>
        <span class="tok-mi">1</span> <span class="tok-o">*</span> <span class="tok-n">assetsTagLib</span><span class="tok-o">.</span><span class="tok-na">image</span><span class="tok-o">(</span><span class="tok-n">_</span><span class="tok-o">)</span> <span class="tok-o">&gt;&gt;</span> <span class="tok-o">{</span> <span class="tok-n">value</span> <span class="tok-o">?</span> <span class="tok-s2">&quot;icontrue.png&quot;</span> <span class="tok-o">:</span> <span class="tok-s2">&quot;iconfalse.png&quot;</span> <span class="tok-o">}</span>
    <span class="tok-nl">where:</span>
        <span class="tok-n">value</span>   <span class="tok-o">|</span>   <span class="tok-n">expectedOutput</span>
        <span class="tok-kc">true</span>    <span class="tok-o">|</span>   <span class="tok-s2">&quot;icontrue.png&quot;</span>
        <span class="tok-kc">false</span>   <span class="tok-o">|</span>   <span class="tok-s2">&quot;iconfalse.png&quot;</span>
<span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>En primer lugar, debemos mockear la librerÃ­a <em>AssetsTagLib</em> para poder devolver lo que nosotros queramos y que no sea necesario invocar al mÃ©todo <em>assetPath</em>. AdemÃ¡s, debemos indicar una referencia al <em>namespace</em> asset que nuestra librerÃ­a <em>TodoTagLib</em> va a utilizar como colaborador. Esto lo hacemos con algo de metaprogramaciÃ³n</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-n">tagLib</span><span class="tok-o">.</span><span class="tok-na">metaClass</span><span class="tok-o">.</span><span class="tok-na">asset</span> <span class="tok-o">=</span> <span class="tok-n">assetTagLib</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>y bÃ¡sicamente estamos creando una referencia entre el objeto <em>asset</em> en el contexto de la librerÃ­a de etiquetas <em>TodoTagLib</em> y nuestro objecto mockeado con la librerÃ­a <em>AssetsTagLib</em>. De esta forma, lo Ãºnico que nos queda por hacer es sobrecargar el mÃ©todo <em>image()</em>.</p>
</div>
<div class="paragraph">
<p>Para sobrecargar este mÃ©todo utilizamos una tÃ©cnica que nos permite incluso saber cuantas veces un mÃ©todo ha sido invocado y con que parÃ¡metros. Esta tÃ©cnica se conoce como <em>Tests basados en interacciones</em>.</p>
</div>
<div class="paragraph">
<p>Para ello lo primero que hemos hecho ha sido generar ese objecto mockeado con</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-kt">def</span> <span class="tok-n">assetsTagLib</span> <span class="tok-o">=</span> <span class="tok-n">Mock</span><span class="tok-o">(</span><span class="tok-n">AssetsTagLib</span><span class="tok-o">)</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Por Ãºltimo, debemos indicar cuantas interacciones vamos a realizar con el mÃ©todo del objeto mockeado y cual va a ser su salida.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-mi">1</span> <span class="tok-o">*</span> <span class="tok-n">assetsTagLib</span><span class="tok-o">.</span><span class="tok-na">image</span><span class="tok-o">(</span><span class="tok-n">_</span><span class="tok-o">)</span> <span class="tok-o">&gt;&gt;</span> <span class="tok-o">{</span> <span class="tok-n">value</span> <span class="tok-o">?</span> <span class="tok-s2">&quot;icontrue.png&quot;</span> <span class="tok-o">:</span> <span class="tok-s2">&quot;iconfalse.png&quot;</span> <span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Con esto estamos indicando que sÃ³lo se va a producir una llamada al mÃ©todo <em>image()</em> de la librerÃ­a de etiquetas <em>AssetsTagLib</em> y que ademÃ¡s, esta llamada se puede realizar con cualquier valor como primer (y Ãºnico) parÃ¡metro (esto lo conseguimos utilizando el <em>placeholder _)</em>. Si quisiÃ©ramos asegurarnos de que los parÃ¡metros pasados son los correctos podrÃ­amos tener algo asÃ­:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-mi">1</span> <span class="tok-o">*</span> <span class="tok-n">assetsTagLib</span><span class="tok-o">.</span><span class="tok-na">image</span><span class="tok-o">([</span><span class="tok-nl">src:</span><span class="tok-n">expectedOutput</span><span class="tok-o">])</span> <span class="tok-o">&gt;&gt;</span> <span class="tok-o">{</span> <span class="tok-n">value</span> <span class="tok-o">?</span> <span class="tok-s2">&quot;icontrue.png&quot;</span> <span class="tok-o">:</span> <span class="tok-s2">&quot;iconfalse.png&quot;</span> <span class="tok-o">}</span></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_algunas_anotaciones_interesantes">6.3.6. Algunas anotaciones interesantes</h4>
<div class="paragraph">
<p>Spock presenta una serie de anotaciones que nos servirÃ¡n de apoyo para realizar nuestros tests.</p>
</div>
<div class="sect4">
<h5 id="_ignore">Ignore</h5>
<div class="paragraph">
<p>Esta anotaciÃ³n se puede utilizar a nivel de mÃ©todo o a nivel de clase y como su nombre indica sirve para indicar al proceso que ejecuta los tests que el mÃ©todo en cuestiÃ³n o la clase no deben ser ejecutados.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-nd">@Ignore</span>
<span class="tok-kt">def</span> <span class="tok-s2">&quot;my feature&quot;</span><span class="tok-o">()</span> <span class="tok-o">{</span> <span class="tok-o">...</span> <span class="tok-o">}</span>

<span class="tok-nd">@Ignore</span>
<span class="tok-kd">class</span> <span class="tok-nc">MySpec</span> <span class="tok-kd">extends</span> <span class="tok-n">Specification</span> <span class="tok-o">{</span> <span class="tok-o">...</span> <span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Incluso podemos pasar como parÃ¡metro a la anotaciÃ³n un motivo por el cual este test no va a ser ejecutado.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-nd">@Ignore</span><span class="tok-o">(</span><span class="tok-n">reason</span> <span class="tok-o">=</span> <span class="tok-s2">&quot;TODO&quot;</span><span class="tok-o">)</span>
<span class="tok-kt">def</span> <span class="tok-s2">&quot;my feature&quot;</span><span class="tok-o">()</span> <span class="tok-o">{</span> <span class="tok-o">...</span> <span class="tok-o">}</span></code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_ignorerest">IgnoreRest</h5>
<div class="paragraph">
<p>Esta anotaciÃ³n sÃ³lo se puede especificar a nivel de mÃ©todo y le indicarÃ¡ al proceso encargado de ejecutar los tests que sÃ³lo los mÃ©todos que proporcionen esta anotaciÃ³n deben ser ejecutados.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-kt">def</span> <span class="tok-s2">&quot;I&#39;ll be ignored&quot;</span><span class="tok-o">()</span> <span class="tok-o">{</span> <span class="tok-o">...</span> <span class="tok-o">}</span>

<span class="tok-nd">@IgnoreRest</span>
<span class="tok-kt">def</span> <span class="tok-s2">&quot;I&#39;ll run&quot;</span><span class="tok-o">()</span> <span class="tok-o">{</span> <span class="tok-o">...</span> <span class="tok-o">}</span>

<span class="tok-kt">def</span> <span class="tok-s2">&quot;I&#39;ll also be ignored&quot;</span><span class="tok-o">()</span> <span class="tok-o">{</span> <span class="tok-o">...</span> <span class="tok-o">}</span></code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_ignoreif">IgnoreIf</h5>
<div class="paragraph">
<p>Esta anotaciÃ³n indica que el mÃ©todo anotado sÃ³lo se ejecutarÃ¡ si se cumplen una serie de condiciones.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-nd">@IgnoreIf</span><span class="tok-o">({</span> <span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">getProperty</span><span class="tok-o">(</span><span class="tok-s2">&quot;os.name&quot;</span><span class="tok-o">).</span><span class="tok-na">contains</span><span class="tok-o">(</span><span class="tok-s2">&quot;windows&quot;</span><span class="tok-o">)</span> <span class="tok-o">})</span>
<span class="tok-kt">def</span> <span class="tok-s2">&quot;I&#39;ll run everywhere but on Windows&quot;</span><span class="tok-o">()</span> <span class="tok-o">{</span> <span class="tok-o">...</span> <span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Para facilitar la comprensiÃ³n de la condiciÃ³n existen una serie de propiedades disponibles dentro del closure:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><em>sys</em> Un mapa con todas las propiedades del sistema</p>
</li>
<li>
<p><em>env</em> Un mapa con todas las variables de entorno</p>
</li>
<li>
<p><em>os</em> InformaciÃ³n acerca del sistema operativo (ver spock.util.environment.OperatingSystem)</p>
</li>
<li>
<p><em>jvm</em> InformaciÃ³n sobre la mÃ¡quina virtual de Java (ver spock.util.environment.Jvm)</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Con lo que el ejemplo anterior puede ser reescrito de la siguiente forma:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-nd">@IgnoreIf</span><span class="tok-o">({</span> <span class="tok-n">os</span><span class="tok-o">.</span><span class="tok-na">windows</span> <span class="tok-o">})</span>
<span class="tok-kt">def</span> <span class="tok-s2">&quot;I&#39;ll run everywhere but on Windows&quot;</span><span class="tok-o">()</span> <span class="tok-o">{</span> <span class="tok-o">...</span> <span class="tok-o">}</span></code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_requires">Requires</h5>
<div class="paragraph">
<p>Es la anotaciÃ³n contraria a <em>@IgnoreIf</em>. Los mÃ©todos anotados con esta anotaciÃ³n sÃ³lo se ejecutarÃ¡n bajo ciertas condiciones.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-nd">@Requires</span><span class="tok-o">({</span> <span class="tok-n">os</span><span class="tok-o">.</span><span class="tok-na">windows</span> <span class="tok-o">})</span>
<span class="tok-kt">def</span> <span class="tok-s2">&quot;I&#39;ll only run on Windows&quot;</span><span class="tok-o">()</span> <span class="tok-o">{</span> <span class="tok-o">...</span> <span class="tok-o">}</span></code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_stepwise">Stepwise</h5>
<div class="paragraph">
<p>Es conveniente que los tests no dependan unos de otros para su correcta ejecuciÃ³n, pero en ocasiones por rapidez, necesitaremos ejecutar los tests en un determinado orden. Esto lo podemos conseguir con la anotaciÃ³n <em>@Stepwise</em> que se utiliza a nivel de clase.</p>
</div>
<div class="paragraph">
<p>Imagina por ejemplo un test funcional con el que pretendemos comprobar que las 4 operaciones bÃ¡sicas sobre las tareas (creaciÃ³n, eliminaciÃ³n, actualizaciÃ³n y borrado) se ejecutan correctamente. Lo ideal serÃ­a crear 4 tests distintos, uno para cada operaciÃ³n, pero, Â¿quÃ© pasarÃ­a si pretendemos eliminar una tarea que todavÃ­a ni siquiera ha sido creada? En este ejemplo, es necesario que todos los tests se ejecuten en un determinado orden.</p>
</div>
</div>
<div class="sect4">
<h5 id="_timeout">Timeout</h5>
<div class="paragraph">
<p>La anotaciÃ³n <em>@Timeout</em> se puede aplicar a nivel de clase o a nivel de mÃ©todo y nos permitirÃ¡ especificar un tiempo mÃ¡ximo de ejecuciÃ³n de un test o de una clase de tests. La unidad por defecto serÃ¡ en segundos, pero vamos a poder modificar esta unidad.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-nd">@Timeout</span><span class="tok-o">(</span><span class="tok-mi">5</span><span class="tok-o">)</span>
<span class="tok-kt">def</span> <span class="tok-s2">&quot;I fail if I run for more than five seconds&quot;</span><span class="tok-o">()</span> <span class="tok-o">{</span> <span class="tok-o">...</span> <span class="tok-o">}</span>

<span class="tok-nd">@Timeout</span><span class="tok-o">(</span><span class="tok-n">value</span> <span class="tok-o">=</span> <span class="tok-mi">100</span><span class="tok-o">,</span> <span class="tok-n">unit</span> <span class="tok-o">=</span> <span class="tok-n">TimeUnit</span><span class="tok-o">.</span><span class="tok-na">MILLISECONDS</span><span class="tok-o">)</span>
<span class="tok-kt">def</span> <span class="tok-s2">&quot;I better be quick&quot;</span> <span class="tok-o">{</span> <span class="tok-o">...</span> <span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Si utilizamos la anotaciÃ³n a nivel de clase y a nivel de mÃ©todo, el mÃ©todo siempre sobreescribirÃ¡ a lo especificado a nivel de clase.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-nd">@Timeout</span><span class="tok-o">(</span><span class="tok-mi">10</span><span class="tok-o">)</span>
<span class="tok-kd">class</span> <span class="tok-nc">TimedSpec</span> <span class="tok-kd">extends</span> <span class="tok-n">Specification</span> <span class="tok-o">{</span>
  <span class="tok-kt">def</span> <span class="tok-s2">&quot;I fail after ten seconds&quot;</span><span class="tok-o">()</span> <span class="tok-o">{</span> <span class="tok-o">...</span> <span class="tok-o">}</span>
  <span class="tok-kt">def</span> <span class="tok-s2">&quot;Me too&quot;</span><span class="tok-o">()</span> <span class="tok-o">{</span> <span class="tok-o">...</span> <span class="tok-o">}</span>

  <span class="tok-nd">@Timeout</span><span class="tok-o">(</span><span class="tok-n">value</span> <span class="tok-o">=</span> <span class="tok-mi">250</span><span class="tok-o">,</span> <span class="tok-n">unit</span> <span class="tok-o">=</span> <span class="tok-n">MILLISECONDS</span><span class="tok-o">)</span>
  <span class="tok-kt">def</span> <span class="tok-s2">&quot;I fail much faster&quot;</span><span class="tok-o">()</span> <span class="tok-o">{</span> <span class="tok-o">...</span> <span class="tok-o">}</span>
<span class="tok-o">}</span></code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_confinemetaclasschanges">ConfineMetaClassChanges</h5>
<div class="paragraph">
<p>Utilizar metaprogramaciÃ³n puede ser muy beneficioso en nuestros tests pero al mismo tiempo, puede llegar a ser algo peligroso, ya que necesitamos asegurarnos que las clases que han sido metaprogramadas no conservan esa metaprogramaciÃ³n mÃ¡s allÃ¡ de donde sea imprescindible.</p>
</div>
<div class="paragraph">
<p>Para ello, bien asegurar de dejar la metaclase sin ninguna modificaciÃ³n con</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-n">Class</span><span class="tok-o">.</span><span class="tok-na">metaClass</span> <span class="tok-o">=</span> <span class="tok-kc">null</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>o bien, en los casos de los tests con Spock podemos utilizar la anotaciÃ³n <em>@ConfineMetaClassChanges</em>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-nd">@Stepwise</span>
<span class="tok-kd">class</span> <span class="tok-nc">FooSpec</span> <span class="tok-kd">extends</span> <span class="tok-n">Specification</span> <span class="tok-o">{</span>
  <span class="tok-nd">@ConfineMetaClassChanges</span>
  <span class="tok-kt">def</span> <span class="tok-s2">&quot;I run first&quot;</span><span class="tok-o">()</span> <span class="tok-o">{</span>
    <span class="tok-nl">when:</span>
    <span class="tok-n">String</span><span class="tok-o">.</span><span class="tok-na">metaClass</span><span class="tok-o">.</span><span class="tok-na">someMethod</span> <span class="tok-o">=</span> <span class="tok-o">{</span> <span class="tok-n">delegate</span> <span class="tok-o">}</span>

    <span class="tok-nl">then:</span>
    <span class="tok-n">String</span><span class="tok-o">.</span><span class="tok-na">metaClass</span><span class="tok-o">.</span><span class="tok-na">hasMetaMethod</span><span class="tok-o">(</span><span class="tok-s1">&#39;someMethod&#39;</span><span class="tok-o">)</span>
  <span class="tok-o">}</span>

  <span class="tok-kt">def</span> <span class="tok-s2">&quot;I run second&quot;</span><span class="tok-o">()</span> <span class="tok-o">{</span>
    <span class="tok-nl">when:</span>
    <span class="tok-s2">&quot;Foo&quot;</span><span class="tok-o">.</span><span class="tok-na">someMethod</span><span class="tok-o">()</span>

    <span class="tok-nl">then:</span>
    <span class="tok-n">thrown</span><span class="tok-o">(</span><span class="tok-n">MissingMethodException</span><span class="tok-o">)</span>
  <span class="tok-o">}</span>
<span class="tok-o">}</span></code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_title_y_narrative">Title y Narrative</h5>
<div class="paragraph">
<p>Podemos especificar lenguaje natural al nombre de nuestras clases con las anotaciones <em>@Title</em></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-nd">@Title</span><span class="tok-o">(</span><span class="tok-s2">&quot;This is easy to read&quot;</span><span class="tok-o">)</span>
<span class="tok-kd">class</span> <span class="tok-nc">ThisIsHarderToReadSpec</span> <span class="tok-kd">extends</span> <span class="tok-n">Specification</span> <span class="tok-o">{</span>
  <span class="tok-o">...</span>
<span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>y <em>@Narrative</em>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-nd">@Narrative</span><span class="tok-o">(</span><span class="tok-s2">&quot;&quot;&quot;&quot;</span>
<span class="tok-n">As</span> <span class="tok-n">a</span> <span class="tok-n">user</span>
<span class="tok-n">I</span> <span class="tok-n">want</span> <span class="tok-n">foo</span>
<span class="tok-n">So</span> <span class="tok-n">that</span> <span class="tok-n">bar</span>
<span class="tok-s2">&quot;&quot;</span><span class="tok-err">&quot;</span><span class="tok-o">)</span>
<span class="tok-kd">class</span> <span class="tok-nf">GiveTheUserFooSpec</span><span class="tok-o">()</span> <span class="tok-o">{</span> <span class="tok-o">...</span> <span class="tok-o">}</span></code></pre>
</div>
</div>
<div style="page-break-after: always;"></div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_ejercicios_6">6.4. Ejercicios</h3>
<div class="sect3">
<h4 id="_testeando_nuestra_propia_restricciÃ³n_0_25_puntos">6.4.1. Testeando nuestra propia restricciÃ³n (0.25 puntos)</h4>
<div class="paragraph">
<p>Realiza los tests necesarios para comprobar el correcto funcionamiento de la restricciÃ³n que creaste en sesiones anteriores para que la fecha de recordatorio nunca pueda ser posterior a la fecha de la propia tarea.</p>
</div>
<div class="paragraph">
<p>Este test o tests los vamos a escribir en la clase <em>TodoSpec.groovy</em>.</p>
</div>
</div>
<div class="sect3">
<h4 id="_testeando_la_clase_todocontroller_0_50_puntos">6.4.2. Testeando la clase TodoController (0.50 puntos)</h4>
<div class="paragraph">
<p>Escribe las modificaciones necesarias a la clase <em>TodoControllerSpec</em> para pasar los tests unitarios para la parte de scaffolding. Recuerda que estamos utilizando el servicio <em>todoService</em> en el controlador con lo que tendrÃ¡s que inyectar el servicio en concreto en el controlador.</p>
</div>
<div class="paragraph">
<p>AdemÃ¡s, realiza los tests unitarios necesarios para comprobar tambiÃ©n el funcionamiento de los mÃ©todos <em>listNextTodos(Integer days)</em> y <em>showListByCategory()</em> (la vista que nos permite que categorÃ­as queremos filtrar en el listado de las tareas).</p>
</div>
<div class="paragraph">
<p>Estos tests los vamos a escribir en la clase <em>TodoControllerSpec.groovy</em>.</p>
</div>
</div>
<div class="sect3">
<h4 id="_testeando_la_clase_todoservice_0_50_puntos">6.4.3. Testeando la clase TodoService (0.50 puntos)</h4>
<div class="paragraph">
<p>Para terminar con los tests, vamos a implementar un par de tests para testear el servicio <em>TodoService</em>. Estos dos mÃ©todos serÃ¡n <em>countNextTodos()</em> y <em>saveTodo()</em> (que creamos en la sesiÃ³n anterior).</p>
</div>
<div class="paragraph">
<p>El mÃ©todo <em>saveTodo()</em> se encarga de almacenar la nueva instancia pero ademÃ¡s os recuerdo que debÃ­a almacenar la fecha de realizaciÃ³n de la tarea si esta habÃ­a sido realizada.</p>
</div>
<div class="paragraph">
<p>Estos tests los vamos a escribir en la clase <em>TodoServiceSpec.groovy</em>.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="title">Importante</div>
<div class="paragraph">
<p>Es absolutamente necesario que cuando presenteis el proyecto todos los tests se pasen correctamente. AsÃ­ que antes de entregar el proyecto final, recuerda ejecutar el comando <em>grails test-app unit:</em> para comprobar que tus tests se ejecutan correctamente. Es decir, asÃ­ deberÃ­a terminar vuestro proyecto antes de ser entregado.</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="images/grails06/allgreentests.png" alt="Todos los tests en verde" width="50%">
</div>
</div>
</td>
</tr>
</table>
</div>
<div style="page-break-after: always;"></div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="sesion07">7. Seguridad con Spring Security plugin.</h2>
<div class="sectionbody">
<div class="paragraph">
<p>En esta sÃ©ptima sesiÃ³n del mÃ³dulo de Groovy&amp;Grails veremos como podemos utilizar un plugin de Grails que nos permitirÃ¡ descargar toda la implementaciÃ³n de la seguridad de nuestra aplicaciÃ³n en Spring Security.</p>
</div>
<div class="paragraph">
<p>Mediante este plugin podremos asignar determinados roles a usuarios y posteriormente crear algunos permisos que podrÃ¡n ser asignados tanto a usuarios como a roles.</p>
</div>
<div class="sect2">
<h3 id="_instalaciÃ³n_del_plugin">7.1. InstalaciÃ³n del plugin</h3>
<div class="paragraph">
<p>En la introducciÃ³n a Grails decÃ­amos que, aquello que no estÃ¡ implementado en el nÃºcleo de Grails, es muy probable que lo podamos encontrar entre los plugins, realizados tanto por la comunidad de usuarios como por la gente de Spring Source.</p>
</div>
<div class="paragraph">
<p>En este caso, el plugin es mantenido directamente por la gente de Spring Source, algo que nos garantiza su durabilidad y mantenimiento. Este plugin se llama <em>spring-security-core</em> y podemos encontrar toda la informaciÃ³n relativa al mismo en la direcciÃ³n <a href="http://grails.org/plugin/spring-security-core" class="bare">http://grails.org/plugin/spring-security-core</a>.</p>
</div>
<div class="paragraph">
<p>Tal y como se explica en la pÃ¡gina del plugin, Ã©ste tiene una serie de plugins adicionales que permiten la autenticaciÃ³n mediante OpenID, LDAP o Kerberos (entre otras). AdemÃ¡s, a esta lista se han aÃ±adido recientemente otros plugins que permiten la autenticaciÃ³n utilizando Facebook o Twitter.</p>
</div>
<div class="paragraph">
<p>El plugin de spring-security-core es uno de los mejor documentados de todos los desarrollados y podrÃ¡s encontrar esta documentaciÃ³n en la direcciÃ³n <a href="http://grails-plugins.github.io/grails-spring-security-core/guide/index.html" class="bare">http://grails-plugins.github.io/grails-spring-security-core/guide/index.html</a> y su autor, Burt Beckwith (<a href="https://www.twitter.com/burtbeckwith">@burtbeckwith</a>) uno de los <em>commiters</em> mÃ¡s activos de la comunidad.</p>
</div>
<div class="paragraph">
<p>En Grails, para instalar cualquier plugin tenemos el comando <em>grails install-plugin</em> con lo que para instalar el plugin de spring-security-core Ãºnicamente deberÃ­amos ejecutar el comando <em>grails install-plugin spring-security-core</em>. Pero ademÃ¡s, podemos editar el archivo <em>BuildConfig.groovy</em> y aÃ±adir una nueva lÃ­nea en la parte dedicada a los plugins:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-n">plugins</span> <span class="tok-o">{</span>
	<span class="tok-o">...</span>
	<span class="tok-n">compile</span> <span class="tok-s2">&quot;:spring-security-core:2.0-RC6&quot;</span>
<span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Nosotros vamos a optar por esta segunda opciÃ³n puesto que quedarÃ¡n contemplados todos los plugins que instalemos en nuestra aplicaciÃ³n en un Ãºnico archivo que luego vamos a poder compartir con el resto de desarrolladores de la aplicaciÃ³n.</p>
</div>
<div class="paragraph">
<p>Durante la instalaciÃ³n del plugin se realizarÃ¡ automÃ¡ticamente la descarga de todas las dependencias del plugin. En algunos casos, la instalaciÃ³n de plugins supone la creaciÃ³n de nuevos comandos en Grails y Ã©ste es el caso de spring-security-core, en el que, tal y como nos indican una vez finalizada la instalaciÃ³n nos indica que podemos ejecutar el comando <em>grails s2-quickstart</em> que nos servirÃ¡ para inicializar el plugin y crear las clases de dominio necesarias.</p>
</div>
<div class="paragraph">
<p>El nuevo comando instalado <em>s2-quickstart</em> necesita de una serie de parÃ¡metros que serÃ¡n los siguientes</p>
</div>
<div class="ulist">
<ul>
<li>
<p><em>paquete</em> donde queremos crear las clases de dominio a generar</p>
</li>
<li>
<p><em>clase de dominio para los usuarios</em> que habitualmente se llamarÃ¡ User o Person</p>
</li>
<li>
<p><em>clase de dominio para los roles</em> que habitualmente se llamarÃ¡ Role o Authority</p>
</li>
<li>
<p><em>clase de dominio para el mapeo de peticiones</em> que habitualmente se llamarÃ¡ RequestMap. Este parÃ¡metro es opcional puesto que este mapeo podemos hacerlo directamente en el archivo de configuraciÃ³n <em>Config.groovy</em></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Nosotros ejecutaremos el comando <em>grails s2-quickstart es.ua.expertojava.todo Person Role RequestMap</em> que crearÃ¡ cuatro nuevas clases de dominio en nuestra aplicaciÃ³n en el paquete <em>es.ua.expertojava.todo</em> que son las siguientes:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Person</p>
</li>
<li>
<p>PersonRole</p>
</li>
<li>
<p>Role</p>
</li>
<li>
<p>RequestMap</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_configuraciÃ³n_del_plugin">7.2. ConfiguraciÃ³n del plugin</h3>
<div class="paragraph">
<p>Toda la configuraciÃ³n del plugin se aÃ±ade automÃ¡ticamente en el archivo de configuraciÃ³n Config.groovy y bÃ¡sicamente lo que se indica en esta configuraciÃ³n es el nombre de cada una de las clases necesarias para el plugin asÃ­ como el tipo de seguridad implementada.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-c1">// Added by the Spring Security Core plugin:</span>
<span class="tok-n">grails</span><span class="tok-o">.</span><span class="tok-na">plugin</span><span class="tok-o">.</span><span class="tok-na">springsecurity</span><span class="tok-o">.</span><span class="tok-na">userLookup</span><span class="tok-o">.</span><span class="tok-na">userDomainClassName</span> <span class="tok-o">=</span> <span class="tok-s1">&#39;es.ua.expertojava.todo.Person&#39;</span>
<span class="tok-n">grails</span><span class="tok-o">.</span><span class="tok-na">plugin</span><span class="tok-o">.</span><span class="tok-na">springsecurity</span><span class="tok-o">.</span><span class="tok-na">userLookup</span><span class="tok-o">.</span><span class="tok-na">authorityJoinClassName</span> <span class="tok-o">=</span> <span class="tok-s1">&#39;es.ua.expertojava.todo.PersonRole&#39;</span>
<span class="tok-n">grails</span><span class="tok-o">.</span><span class="tok-na">plugin</span><span class="tok-o">.</span><span class="tok-na">springsecurity</span><span class="tok-o">.</span><span class="tok-na">authority</span><span class="tok-o">.</span><span class="tok-na">className</span> <span class="tok-o">=</span> <span class="tok-s1">&#39;es.ua.expertojava.todo.Role&#39;</span>
<span class="tok-n">grails</span><span class="tok-o">.</span><span class="tok-na">plugin</span><span class="tok-o">.</span><span class="tok-na">springsecurity</span><span class="tok-o">.</span><span class="tok-na">requestMap</span><span class="tok-o">.</span><span class="tok-na">className</span> <span class="tok-o">=</span> <span class="tok-s1">&#39;es.ua.expertojava.todo.RequestMap&#39;</span>
<span class="tok-n">grails</span><span class="tok-o">.</span><span class="tok-na">plugin</span><span class="tok-o">.</span><span class="tok-na">springsecurity</span><span class="tok-o">.</span><span class="tok-na">securityConfigType</span> <span class="tok-o">=</span> <span class="tok-s1">&#39;Requestmap&#39;</span>
<span class="tok-n">grails</span><span class="tok-o">.</span><span class="tok-na">plugin</span><span class="tok-o">.</span><span class="tok-na">springsecurity</span><span class="tok-o">.</span><span class="tok-na">controllerAnnotations</span><span class="tok-o">.</span><span class="tok-na">staticRules</span> <span class="tok-o">=</span> <span class="tok-o">[</span>
	<span class="tok-s1">&#39;/&#39;</span><span class="tok-o">:</span>                              <span class="tok-o">[</span><span class="tok-s1">&#39;permitAll&#39;</span><span class="tok-o">],</span>
	<span class="tok-s1">&#39;/index&#39;</span><span class="tok-o">:</span>                         <span class="tok-o">[</span><span class="tok-s1">&#39;permitAll&#39;</span><span class="tok-o">],</span>
	<span class="tok-s1">&#39;/index.gsp&#39;</span><span class="tok-o">:</span>                     <span class="tok-o">[</span><span class="tok-s1">&#39;permitAll&#39;</span><span class="tok-o">],</span>
	<span class="tok-s1">&#39;/assets/**&#39;</span><span class="tok-o">:</span>                     <span class="tok-o">[</span><span class="tok-s1">&#39;permitAll&#39;</span><span class="tok-o">],</span>
	<span class="tok-s1">&#39;/**/js/**&#39;</span><span class="tok-o">:</span>                      <span class="tok-o">[</span><span class="tok-s1">&#39;permitAll&#39;</span><span class="tok-o">],</span>
	<span class="tok-s1">&#39;/**/css/**&#39;</span><span class="tok-o">:</span>                     <span class="tok-o">[</span><span class="tok-s1">&#39;permitAll&#39;</span><span class="tok-o">],</span>
	<span class="tok-s1">&#39;/**/images/**&#39;</span><span class="tok-o">:</span>                  <span class="tok-o">[</span><span class="tok-s1">&#39;permitAll&#39;</span><span class="tok-o">],</span>
	<span class="tok-s1">&#39;/**/favicon.ico&#39;</span><span class="tok-o">:</span>                <span class="tok-o">[</span><span class="tok-s1">&#39;permitAll&#39;</span><span class="tok-o">]</span>
<span class="tok-o">]</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Como te habrÃ¡s dado cuenta, todos los parÃ¡metros de configuraciÃ³n empiezan por <em>grails.plugin.springsecurity</em>. De esta forma podemos especificar por ejemplo que tipo de algoritmo queremos para encriptar la contraseÃ±a de los usuarios de la siguiente forma</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-n">grails</span><span class="tok-o">.</span><span class="tok-na">plugin</span><span class="tok-o">.</span><span class="tok-na">springsecurity</span><span class="tok-o">.</span><span class="tok-na">password</span><span class="tok-o">.</span><span class="tok-na">algorithm</span><span class="tok-o">=</span><span class="tok-s1">&#39;SHA-512&#39;</span></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_clases_de_dominio">7.3. Clases de dominio</h3>
<div class="paragraph">
<p>Como comentÃ¡bamos anteriormente, cuatro son las clases que se han creado al ejecutar el comando <em>grails s2-quickstart</em>, tres obligatorias (Person, Role y PersonRole) y una opcional (RequestMap). La clase PersonRole es una clase que relaciona que implementa la relaciÃ³n muchos-a-muchos entre la clase Person y la clase Role. Veamos cada una de estas clases en detalle:</p>
</div>
<div class="sect3">
<h4 id="_clase_de_dominio_person">7.3.1. Clase de dominio Person</h4>
<div class="paragraph">
<p>La clase de dominio Person es la clase encargada de almacenar los datos de todos los usuarios de la aplicaciÃ³n. Estos datos son los tÃ­picos que desearÃ­amos almacenar de un usuario como son el nombre de usuario y la contraseÃ±a. AdemÃ¡s, tambiÃ©n tiene una serie de propiedades que nos indicarÃ¡ si el usuario estÃ¡ activo o no, si la cuenta ha expirado, si la cuenta estÃ¡ bloqueada o si la contraseÃ±a ha expirado.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-kn">package</span> <span class="tok-n">es</span><span class="tok-o">.</span><span class="tok-na">ua</span><span class="tok-o">.</span><span class="tok-na">expertojava</span><span class="tok-o">.</span><span class="tok-na">todo</span>

<span class="tok-kd">class</span> <span class="tok-nc">Person</span> <span class="tok-o">{</span>

	<span class="tok-kd">transient</span> <span class="tok-n">springSecurityService</span>

	<span class="tok-n">String</span> <span class="tok-n">username</span>
	<span class="tok-n">String</span> <span class="tok-n">password</span>
	<span class="tok-kt">boolean</span> <span class="tok-n">enabled</span> <span class="tok-o">=</span> <span class="tok-kc">true</span>
	<span class="tok-kt">boolean</span> <span class="tok-n">accountExpired</span>
	<span class="tok-kt">boolean</span> <span class="tok-n">accountLocked</span>
	<span class="tok-kt">boolean</span> <span class="tok-n">passwordExpired</span>

	<span class="tok-kd">static</span> <span class="tok-n">transients</span> <span class="tok-o">=</span> <span class="tok-o">[</span><span class="tok-s1">&#39;springSecurityService&#39;</span><span class="tok-o">]</span>

	<span class="tok-kd">static</span> <span class="tok-n">constraints</span> <span class="tok-o">=</span> <span class="tok-o">{</span>
		<span class="tok-n">username</span> <span class="tok-nl">blank:</span> <span class="tok-kc">false</span><span class="tok-o">,</span> <span class="tok-nl">unique:</span> <span class="tok-kc">true</span>
		<span class="tok-n">password</span> <span class="tok-nl">blank:</span> <span class="tok-kc">false</span>
	<span class="tok-o">}</span>

	<span class="tok-kd">static</span> <span class="tok-n">mapping</span> <span class="tok-o">=</span> <span class="tok-o">{</span>
		<span class="tok-n">password</span> <span class="tok-nl">column:</span> <span class="tok-s1">&#39;`password`&#39;</span>
	<span class="tok-o">}</span>

	<span class="tok-n">Set</span><span class="tok-o">&lt;</span><span class="tok-n">Role</span><span class="tok-o">&gt;</span> <span class="tok-n">getAuthorities</span><span class="tok-o">()</span> <span class="tok-o">{</span>
		<span class="tok-n">PersonRole</span><span class="tok-o">.</span><span class="tok-na">findAllByPerson</span><span class="tok-o">(</span><span class="tok-k">this</span><span class="tok-o">).</span><span class="tok-na">collect</span> <span class="tok-o">{</span> <span class="tok-n">it</span><span class="tok-o">.</span><span class="tok-na">role</span> <span class="tok-o">}</span>
	<span class="tok-o">}</span>

	<span class="tok-kt">def</span> <span class="tok-nf">beforeInsert</span><span class="tok-o">()</span> <span class="tok-o">{</span>
		<span class="tok-n">encodePassword</span><span class="tok-o">()</span>
	<span class="tok-o">}</span>

	<span class="tok-kt">def</span> <span class="tok-nf">beforeUpdate</span><span class="tok-o">()</span> <span class="tok-o">{</span>
		<span class="tok-k">if</span> <span class="tok-o">(</span><span class="tok-n">isDirty</span><span class="tok-o">(</span><span class="tok-s1">&#39;password&#39;</span><span class="tok-o">))</span> <span class="tok-o">{</span>
			<span class="tok-n">encodePassword</span><span class="tok-o">()</span>
		<span class="tok-o">}</span>
	<span class="tok-o">}</span>

	<span class="tok-kd">protected</span> <span class="tok-kt">void</span> <span class="tok-nf">encodePassword</span><span class="tok-o">()</span> <span class="tok-o">{</span>
		<span class="tok-n">password</span> <span class="tok-o">=</span> <span class="tok-n">springSecurityService</span><span class="tok-o">?.</span><span class="tok-na">passwordEncoder</span> <span class="tok-o">?</span> <span class="tok-n">springSecurityService</span><span class="tok-o">.</span><span class="tok-na">encodePassword</span><span class="tok-o">(</span><span class="tok-n">password</span><span class="tok-o">)</span> <span class="tok-o">:</span> <span class="tok-n">password</span>
	<span class="tok-o">}</span>
<span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>AdemÃ¡s, tambiÃ©n se implementa un mÃ©todo llamado <em>getAuthorities()</em> que nos devolverÃ¡ todos los roles que el usuario tenga asignados. Este mÃ©todo podÃ­amos decir que es anÃ¡logo a la definiciÃ³n <em>static hasMany = [authorities: Authority]</em> de la forma tradicional.</p>
</div>
<div class="paragraph">
<p>Esta clase podrÃ¡ ser modificada a nuestro gusto para aÃ±adirle tantas propiedades como necesitemos, como por ejemplo, nombre, apellidos o email. Sin embargo, es mÃ¡s conveniente dejar esta clase tal cual estÃ¡ y extenderla utilizando una clase llamada por ejemplo <em>User</em>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-kn">package</span> <span class="tok-n">es</span><span class="tok-o">.</span><span class="tok-na">ua</span><span class="tok-o">.</span><span class="tok-na">expertojava</span><span class="tok-o">.</span><span class="tok-na">todo</span>

<span class="tok-kd">class</span> <span class="tok-nc">User</span> <span class="tok-kd">extends</span> <span class="tok-n">Person</span><span class="tok-o">{</span>
	<span class="tok-n">String</span> <span class="tok-n">name</span>
	<span class="tok-n">String</span> <span class="tok-n">surnames</span>
	<span class="tok-n">String</span> <span class="tok-n">confirmPassword</span>
	<span class="tok-n">String</span> <span class="tok-n">email</span>
	<span class="tok-n">Date</span> <span class="tok-n">dateOfBirth</span>
	<span class="tok-n">String</span> <span class="tok-n">description</span>

	<span class="tok-kd">static</span> <span class="tok-n">hasMany</span> <span class="tok-o">=</span> <span class="tok-o">[</span><span class="tok-nl">todos:</span><span class="tok-n">Todo</span><span class="tok-o">]</span>

	<span class="tok-kd">static</span> <span class="tok-n">constraints</span> <span class="tok-o">=</span> <span class="tok-o">{</span>
		<span class="tok-n">name</span><span class="tok-o">(</span><span class="tok-nl">blank:</span><span class="tok-kc">false</span><span class="tok-o">)</span>
		<span class="tok-n">surnames</span><span class="tok-o">(</span><span class="tok-nl">blank:</span><span class="tok-kc">false</span><span class="tok-o">)</span>
		<span class="tok-n">confirmPassword</span><span class="tok-o">(</span><span class="tok-nl">blank:</span><span class="tok-kc">false</span><span class="tok-o">,</span> <span class="tok-nl">password:</span><span class="tok-kc">true</span><span class="tok-o">)</span>
		<span class="tok-n">email</span><span class="tok-o">(</span><span class="tok-nl">blank:</span><span class="tok-kc">false</span><span class="tok-o">,</span> <span class="tok-nl">email:</span><span class="tok-kc">true</span><span class="tok-o">)</span>
		<span class="tok-n">dateOfBirth</span><span class="tok-o">(</span><span class="tok-nl">nullable:</span><span class="tok-kc">true</span><span class="tok-o">,</span> <span class="tok-nl">validator:</span> <span class="tok-o">{</span>
			<span class="tok-k">if</span> <span class="tok-o">(</span><span class="tok-n">it</span><span class="tok-o">?.</span><span class="tok-na">compareTo</span><span class="tok-o">(</span><span class="tok-k">new</span> <span class="tok-n">Date</span><span class="tok-o">())</span> <span class="tok-o">&lt;</span> <span class="tok-mi">0</span><span class="tok-o">)</span>
				<span class="tok-k">return</span> <span class="tok-kc">true</span>
			<span class="tok-k">return</span> <span class="tok-kc">false</span>
		<span class="tok-o">})</span>
		<span class="tok-n">description</span><span class="tok-o">(</span><span class="tok-nl">maxSize:</span><span class="tok-mi">1000</span><span class="tok-o">,</span><span class="tok-nl">nullable:</span><span class="tok-kc">true</span><span class="tok-o">)</span>
	<span class="tok-o">}</span>

	<span class="tok-kd">static</span> <span class="tok-n">transients</span> <span class="tok-o">=</span> <span class="tok-o">[</span><span class="tok-s2">&quot;confirmPassword&quot;</span><span class="tok-o">]</span>

	<span class="tok-n">String</span> <span class="tok-nf">toString</span><span class="tok-o">(){</span>
		<span class="tok-s2">&quot;@${username}&quot;</span>
	<span class="tok-o">}</span>
<span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Date cuenta de la relaciÃ³n que hemos establecido entre los usuarios y las tareas con <em>static hasMany = [todos:Todo]</em> con lo que habrÃ¡ tambiÃ©n que modificar la clase de domninio <em>Todo</em> para establecer la otra parte de la relaciÃ³n.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-kn">package</span> <span class="tok-n">es</span><span class="tok-o">.</span><span class="tok-na">ua</span><span class="tok-o">.</span><span class="tok-na">expertojava</span><span class="tok-o">.</span><span class="tok-na">todo</span>

<span class="tok-kd">class</span> <span class="tok-nc">Todo</span> <span class="tok-o">{</span>
	<span class="tok-o">...</span>

	<span class="tok-n">User</span> <span class="tok-n">user</span>

	<span class="tok-o">...</span>
<span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Para facilitar la generaciÃ³n de usuarios desde la propia aplicaciÃ³n, vamos a generar las vistas y los controladores referentes a los usuarios con</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-n">grails</span> <span class="tok-n">generate</span><span class="tok-o">-</span><span class="tok-n">all</span> <span class="tok-n">es</span><span class="tok-o">.</span><span class="tok-na">ua</span><span class="tok-o">.</span><span class="tok-na">expertojava</span><span class="tok-o">.</span><span class="tok-na">todo</span><span class="tok-o">.</span><span class="tok-na">User</span></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_clase_de_dominio_role">7.3.2. Clase de dominio Role</h4>
<div class="paragraph">
<p>El plugin spring-security-core necesita de una clase que implemente los diferentes roles que pueden coexistir en nuestra aplicaciÃ³n. Habitualmente, esta clase se encarga de restringir el acceso a determinadas URLs a aquellos usuarios que tengan los permisos adecuados. Un usuario puede tener varios roles asignados que indiquen diferentes niveles de acceso a la aplicaciÃ³n y por lo normal, cada usuario deberÃ­a tener al menos un rol asignado.</p>
</div>
<div class="paragraph">
<p>TambiÃ©n es posible que un usuario no tenga ningÃºn rol asignado (aunque no es muy habitual). En estos casos, cuando un usuario sin ningÃºn rol asignado se identifica en la aplicaciÃ³n, automÃ¡ticamente se le asigna un rol <em>virtual</em> llamado <em>ROLE_NO_ROLES</em>. Este usuario, sÃ³lo podrÃ¡ acceder a aquellos recursos que no estÃ©n <em>asegurados</em>.</p>
</div>
<div class="paragraph">
<p>La clase Role tiene una Ãºnica propiedad llamada <em>authority</em> de tipo <em>String</em> que serÃ¡ el nombre dado al rol. Esta propiedad debe ser Ãºnica, tal y como vemos en las restricciones de la clase.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-kn">package</span> <span class="tok-n">es</span><span class="tok-o">.</span><span class="tok-na">ua</span><span class="tok-o">.</span><span class="tok-na">expertojava</span><span class="tok-o">.</span><span class="tok-na">todo</span>

<span class="tok-kd">class</span> <span class="tok-nc">Role</span> <span class="tok-o">{</span>

	<span class="tok-n">String</span> <span class="tok-n">authority</span>

	<span class="tok-kd">static</span> <span class="tok-n">mapping</span> <span class="tok-o">=</span> <span class="tok-o">{</span>
		<span class="tok-n">cache</span> <span class="tok-kc">true</span>
	<span class="tok-o">}</span>

	<span class="tok-kd">static</span> <span class="tok-n">constraints</span> <span class="tok-o">=</span> <span class="tok-o">{</span>
		<span class="tok-n">authority</span> <span class="tok-nl">blank:</span> <span class="tok-kc">false</span><span class="tok-o">,</span> <span class="tok-nl">unique:</span> <span class="tok-kc">true</span>
	<span class="tok-o">}</span>
<span class="tok-o">}</span></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_clase_de_dominio_personrole">7.3.3. Clase de dominio PersonRole</h4>
<div class="paragraph">
<p>Para especificar la relaciÃ³n de muchos-a-muchos entre las clases de dominio Person y Role utilizamos una nueva clase llamada PersonRole. Esta clase tiene Ãºnicamente dos propiedades que serÃ¡n las referidas a la clase de dominio Person y a la clase de dominio Role. AdemÃ¡s, le especificaremos que la clave primaria de la clase serÃ¡ la composiciÃ³n de ambas propiedades y que no necesitamos almacenar la versiÃ³n actual del objeto.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-kn">package</span> <span class="tok-n">es</span><span class="tok-o">.</span><span class="tok-na">ua</span><span class="tok-o">.</span><span class="tok-na">expertojava</span><span class="tok-o">.</span><span class="tok-na">todo</span>

<span class="tok-kn">import</span> <span class="tok-nn">org.apache.commons.lang.builder.HashCodeBuilder</span>

<span class="tok-kd">class</span> <span class="tok-nc">PersonRole</span> <span class="tok-kd">implements</span> <span class="tok-n">Serializable</span> <span class="tok-o">{</span>

	<span class="tok-kd">private</span> <span class="tok-kd">static</span> <span class="tok-kd">final</span> <span class="tok-kt">long</span> <span class="tok-n">serialVersionUID</span> <span class="tok-o">=</span> <span class="tok-mi">1</span>

	<span class="tok-n">Person</span> <span class="tok-n">person</span>
	<span class="tok-n">Role</span> <span class="tok-n">role</span>

	<span class="tok-kt">boolean</span> <span class="tok-nf">equals</span><span class="tok-o">(</span><span class="tok-n">other</span><span class="tok-o">)</span> <span class="tok-o">{</span>
		<span class="tok-k">if</span> <span class="tok-o">(!(</span><span class="tok-n">other</span> <span class="tok-k">instanceof</span> <span class="tok-n">PersonRole</span><span class="tok-o">))</span> <span class="tok-o">{</span>
			<span class="tok-k">return</span> <span class="tok-kc">false</span>
		<span class="tok-o">}</span>

		<span class="tok-n">other</span><span class="tok-o">.</span><span class="tok-na">person</span><span class="tok-o">?.</span><span class="tok-na">id</span> <span class="tok-o">==</span> <span class="tok-n">person</span><span class="tok-o">?.</span><span class="tok-na">id</span> <span class="tok-o">&amp;&amp;</span>
		<span class="tok-n">other</span><span class="tok-o">.</span><span class="tok-na">role</span><span class="tok-o">?.</span><span class="tok-na">id</span> <span class="tok-o">==</span> <span class="tok-n">role</span><span class="tok-o">?.</span><span class="tok-na">id</span>
	<span class="tok-o">}</span>

	<span class="tok-kt">int</span> <span class="tok-nf">hashCode</span><span class="tok-o">()</span> <span class="tok-o">{</span>
		<span class="tok-kt">def</span> <span class="tok-n">builder</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">HashCodeBuilder</span><span class="tok-o">()</span>
		<span class="tok-k">if</span> <span class="tok-o">(</span><span class="tok-n">person</span><span class="tok-o">)</span> <span class="tok-n">builder</span><span class="tok-o">.</span><span class="tok-na">append</span><span class="tok-o">(</span><span class="tok-n">person</span><span class="tok-o">.</span><span class="tok-na">id</span><span class="tok-o">)</span>
		<span class="tok-k">if</span> <span class="tok-o">(</span><span class="tok-n">role</span><span class="tok-o">)</span> <span class="tok-n">builder</span><span class="tok-o">.</span><span class="tok-na">append</span><span class="tok-o">(</span><span class="tok-n">role</span><span class="tok-o">.</span><span class="tok-na">id</span><span class="tok-o">)</span>
		<span class="tok-n">builder</span><span class="tok-o">.</span><span class="tok-na">toHashCode</span><span class="tok-o">()</span>
	<span class="tok-o">}</span>

	<span class="tok-kd">static</span> <span class="tok-n">PersonRole</span> <span class="tok-nf">get</span><span class="tok-o">(</span><span class="tok-kt">long</span> <span class="tok-n">personId</span><span class="tok-o">,</span> <span class="tok-kt">long</span> <span class="tok-n">roleId</span><span class="tok-o">)</span> <span class="tok-o">{</span>
		<span class="tok-n">PersonRole</span><span class="tok-o">.</span><span class="tok-na">where</span> <span class="tok-o">{</span>
			<span class="tok-n">person</span> <span class="tok-o">==</span> <span class="tok-n">Person</span><span class="tok-o">.</span><span class="tok-na">load</span><span class="tok-o">(</span><span class="tok-n">personId</span><span class="tok-o">)</span> <span class="tok-o">&amp;&amp;</span>
			<span class="tok-n">role</span> <span class="tok-o">==</span> <span class="tok-n">Role</span><span class="tok-o">.</span><span class="tok-na">load</span><span class="tok-o">(</span><span class="tok-n">roleId</span><span class="tok-o">)</span>
		<span class="tok-o">}.</span><span class="tok-na">get</span><span class="tok-o">()</span>
	<span class="tok-o">}</span>

	<span class="tok-kd">static</span> <span class="tok-kt">boolean</span> <span class="tok-nf">exists</span><span class="tok-o">(</span><span class="tok-kt">long</span> <span class="tok-n">personId</span><span class="tok-o">,</span> <span class="tok-kt">long</span> <span class="tok-n">roleId</span><span class="tok-o">)</span> <span class="tok-o">{</span>
		<span class="tok-n">PersonRole</span><span class="tok-o">.</span><span class="tok-na">where</span> <span class="tok-o">{</span>
			<span class="tok-n">person</span> <span class="tok-o">==</span> <span class="tok-n">Person</span><span class="tok-o">.</span><span class="tok-na">load</span><span class="tok-o">(</span><span class="tok-n">personId</span><span class="tok-o">)</span> <span class="tok-o">&amp;&amp;</span>
			<span class="tok-n">role</span> <span class="tok-o">==</span> <span class="tok-n">Role</span><span class="tok-o">.</span><span class="tok-na">load</span><span class="tok-o">(</span><span class="tok-n">roleId</span><span class="tok-o">)</span>
		<span class="tok-o">}.</span><span class="tok-na">count</span><span class="tok-o">()</span> <span class="tok-o">&gt;</span> <span class="tok-mi">0</span>
	<span class="tok-o">}</span>

	<span class="tok-kd">static</span> <span class="tok-n">PersonRole</span> <span class="tok-nf">create</span><span class="tok-o">(</span><span class="tok-n">Person</span> <span class="tok-n">person</span><span class="tok-o">,</span> <span class="tok-n">Role</span> <span class="tok-n">role</span><span class="tok-o">,</span> <span class="tok-kt">boolean</span> <span class="tok-n">flush</span> <span class="tok-o">=</span> <span class="tok-kc">false</span><span class="tok-o">)</span> <span class="tok-o">{</span>
		<span class="tok-kt">def</span> <span class="tok-n">instance</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">PersonRole</span><span class="tok-o">(</span><span class="tok-nl">person:</span> <span class="tok-n">person</span><span class="tok-o">,</span> <span class="tok-nl">role:</span> <span class="tok-n">role</span><span class="tok-o">)</span>
		<span class="tok-n">instance</span><span class="tok-o">.</span><span class="tok-na">save</span><span class="tok-o">(</span><span class="tok-nl">flush:</span> <span class="tok-n">flush</span><span class="tok-o">,</span> <span class="tok-nl">insert:</span> <span class="tok-kc">true</span><span class="tok-o">)</span>
		<span class="tok-n">instance</span>
	<span class="tok-o">}</span>

	<span class="tok-kd">static</span> <span class="tok-kt">boolean</span> <span class="tok-nf">remove</span><span class="tok-o">(</span><span class="tok-n">Person</span> <span class="tok-n">u</span><span class="tok-o">,</span> <span class="tok-n">Role</span> <span class="tok-n">r</span><span class="tok-o">,</span> <span class="tok-kt">boolean</span> <span class="tok-n">flush</span> <span class="tok-o">=</span> <span class="tok-kc">false</span><span class="tok-o">)</span> <span class="tok-o">{</span>
		<span class="tok-k">if</span> <span class="tok-o">(</span><span class="tok-n">u</span> <span class="tok-o">==</span> <span class="tok-kc">null</span> <span class="tok-o">||</span> <span class="tok-n">r</span> <span class="tok-o">==</span> <span class="tok-kc">null</span><span class="tok-o">)</span> <span class="tok-k">return</span> <span class="tok-kc">false</span>

		<span class="tok-kt">int</span> <span class="tok-n">rowCount</span> <span class="tok-o">=</span> <span class="tok-n">PersonRole</span><span class="tok-o">.</span><span class="tok-na">where</span> <span class="tok-o">{</span>
			<span class="tok-n">person</span> <span class="tok-o">==</span> <span class="tok-n">Person</span><span class="tok-o">.</span><span class="tok-na">load</span><span class="tok-o">(</span><span class="tok-n">u</span><span class="tok-o">.</span><span class="tok-na">id</span><span class="tok-o">)</span> <span class="tok-o">&amp;&amp;</span>
			<span class="tok-n">role</span> <span class="tok-o">==</span> <span class="tok-n">Role</span><span class="tok-o">.</span><span class="tok-na">load</span><span class="tok-o">(</span><span class="tok-n">r</span><span class="tok-o">.</span><span class="tok-na">id</span><span class="tok-o">)</span>
		<span class="tok-o">}.</span><span class="tok-na">deleteAll</span><span class="tok-o">()</span>

		<span class="tok-k">if</span> <span class="tok-o">(</span><span class="tok-n">flush</span><span class="tok-o">)</span> <span class="tok-o">{</span> <span class="tok-n">PersonRole</span><span class="tok-o">.</span><span class="tok-na">withSession</span> <span class="tok-o">{</span> <span class="tok-n">it</span><span class="tok-o">.</span><span class="tok-na">flush</span><span class="tok-o">()</span> <span class="tok-o">}</span> <span class="tok-o">}</span>

		<span class="tok-n">rowCount</span> <span class="tok-o">&gt;</span> <span class="tok-mi">0</span>
	<span class="tok-o">}</span>

	<span class="tok-kd">static</span> <span class="tok-kt">void</span> <span class="tok-nf">removeAll</span><span class="tok-o">(</span><span class="tok-n">Person</span> <span class="tok-n">u</span><span class="tok-o">,</span> <span class="tok-kt">boolean</span> <span class="tok-n">flush</span> <span class="tok-o">=</span> <span class="tok-kc">false</span><span class="tok-o">)</span> <span class="tok-o">{</span>
		<span class="tok-k">if</span> <span class="tok-o">(</span><span class="tok-n">u</span> <span class="tok-o">==</span> <span class="tok-kc">null</span><span class="tok-o">)</span> <span class="tok-k">return</span>

		<span class="tok-n">PersonRole</span><span class="tok-o">.</span><span class="tok-na">where</span> <span class="tok-o">{</span>
			<span class="tok-n">person</span> <span class="tok-o">==</span> <span class="tok-n">Person</span><span class="tok-o">.</span><span class="tok-na">load</span><span class="tok-o">(</span><span class="tok-n">u</span><span class="tok-o">.</span><span class="tok-na">id</span><span class="tok-o">)</span>
		<span class="tok-o">}.</span><span class="tok-na">deleteAll</span><span class="tok-o">()</span>

		<span class="tok-k">if</span> <span class="tok-o">(</span><span class="tok-n">flush</span><span class="tok-o">)</span> <span class="tok-o">{</span> <span class="tok-n">PersonRole</span><span class="tok-o">.</span><span class="tok-na">withSession</span> <span class="tok-o">{</span> <span class="tok-n">it</span><span class="tok-o">.</span><span class="tok-na">flush</span><span class="tok-o">()</span> <span class="tok-o">}</span> <span class="tok-o">}</span>
	<span class="tok-o">}</span>

	<span class="tok-kd">static</span> <span class="tok-kt">void</span> <span class="tok-nf">removeAll</span><span class="tok-o">(</span><span class="tok-n">Role</span> <span class="tok-n">r</span><span class="tok-o">,</span> <span class="tok-kt">boolean</span> <span class="tok-n">flush</span> <span class="tok-o">=</span> <span class="tok-kc">false</span><span class="tok-o">)</span> <span class="tok-o">{</span>
		<span class="tok-k">if</span> <span class="tok-o">(</span><span class="tok-n">r</span> <span class="tok-o">==</span> <span class="tok-kc">null</span><span class="tok-o">)</span> <span class="tok-k">return</span>

		<span class="tok-n">PersonRole</span><span class="tok-o">.</span><span class="tok-na">where</span> <span class="tok-o">{</span>
			<span class="tok-n">role</span> <span class="tok-o">==</span> <span class="tok-n">Role</span><span class="tok-o">.</span><span class="tok-na">load</span><span class="tok-o">(</span><span class="tok-n">r</span><span class="tok-o">.</span><span class="tok-na">id</span><span class="tok-o">)</span>
		<span class="tok-o">}.</span><span class="tok-na">deleteAll</span><span class="tok-o">()</span>

		<span class="tok-k">if</span> <span class="tok-o">(</span><span class="tok-n">flush</span><span class="tok-o">)</span> <span class="tok-o">{</span> <span class="tok-n">PersonRole</span><span class="tok-o">.</span><span class="tok-na">withSession</span> <span class="tok-o">{</span> <span class="tok-n">it</span><span class="tok-o">.</span><span class="tok-na">flush</span><span class="tok-o">()</span> <span class="tok-o">}</span> <span class="tok-o">}</span>
	<span class="tok-o">}</span>

	<span class="tok-kd">static</span> <span class="tok-n">constraints</span> <span class="tok-o">=</span> <span class="tok-o">{</span>
		<span class="tok-n">role</span> <span class="tok-nl">validator:</span> <span class="tok-o">{</span> <span class="tok-n">Role</span> <span class="tok-n">r</span><span class="tok-o">,</span> <span class="tok-n">PersonRole</span> <span class="tok-n">ur</span> <span class="tok-o">-&gt;</span>
			<span class="tok-k">if</span> <span class="tok-o">(</span><span class="tok-n">ur</span><span class="tok-o">.</span><span class="tok-na">person</span> <span class="tok-o">==</span> <span class="tok-kc">null</span><span class="tok-o">)</span> <span class="tok-k">return</span>
			<span class="tok-kt">boolean</span> <span class="tok-n">existing</span> <span class="tok-o">=</span> <span class="tok-kc">false</span>
			<span class="tok-n">PersonRole</span><span class="tok-o">.</span><span class="tok-na">withNewSession</span> <span class="tok-o">{</span>
				<span class="tok-n">existing</span> <span class="tok-o">=</span> <span class="tok-n">PersonRole</span><span class="tok-o">.</span><span class="tok-na">exists</span><span class="tok-o">(</span><span class="tok-n">ur</span><span class="tok-o">.</span><span class="tok-na">person</span><span class="tok-o">.</span><span class="tok-na">id</span><span class="tok-o">,</span> <span class="tok-n">r</span><span class="tok-o">.</span><span class="tok-na">id</span><span class="tok-o">)</span>
			<span class="tok-o">}</span>
			<span class="tok-k">if</span> <span class="tok-o">(</span><span class="tok-n">existing</span><span class="tok-o">)</span> <span class="tok-o">{</span>
				<span class="tok-k">return</span> <span class="tok-s1">&#39;userRole.exists&#39;</span>
			<span class="tok-o">}</span>
		<span class="tok-o">}</span>
	<span class="tok-o">}</span>

	<span class="tok-kd">static</span> <span class="tok-n">mapping</span> <span class="tok-o">=</span> <span class="tok-o">{</span>
		<span class="tok-n">id</span> <span class="tok-nl">composite:</span> <span class="tok-o">[</span><span class="tok-s1">&#39;role&#39;</span><span class="tok-o">,</span> <span class="tok-s1">&#39;person&#39;</span><span class="tok-o">]</span>
		<span class="tok-n">version</span> <span class="tok-kc">false</span>
	<span class="tok-o">}</span>
<span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>TambiÃ©n se han creado una serie de mÃ©todos que facilitan la asignaciÃ³n de roles a usuario asÃ­ como la revocaciÃ³n. Con esto, suponiendo que ya tenemos creados un rol y un usuario, podemos asignar o revocar un rol a un usuario de la siguiente forma:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-n">User</span> <span class="tok-n">user</span> <span class="tok-o">=</span> <span class="tok-o">...</span>
<span class="tok-n">Role</span> <span class="tok-n">role</span> <span class="tok-o">=</span> <span class="tok-o">...</span>
<span class="tok-c1">//AsignaciÃ³n de rol a un usuario</span>
<span class="tok-n">UserRole</span><span class="tok-o">.</span><span class="tok-na">create</span> <span class="tok-n">user</span><span class="tok-o">,</span> <span class="tok-n">role</span>
<span class="tok-c1">//AsignaciÃ³n de rol a un usuario indicÃ¡ndole el atributo flush</span>
<span class="tok-n">UserRole</span><span class="tok-o">.</span><span class="tok-na">create</span> <span class="tok-n">user</span><span class="tok-o">,</span> <span class="tok-n">role</span><span class="tok-o">,</span> <span class="tok-kc">true</span>

<span class="tok-c1">//RevocaciÃ³n de un rol a un usuario</span>
<span class="tok-n">User</span> <span class="tok-n">user</span> <span class="tok-o">=</span> <span class="tok-o">...</span>
<span class="tok-n">Role</span> <span class="tok-n">role</span> <span class="tok-o">=</span> <span class="tok-o">...</span>
<span class="tok-n">UserRole</span><span class="tok-o">.</span><span class="tok-na">remove</span> <span class="tok-n">user</span><span class="tok-o">,</span> <span class="tok-n">role</span>
<span class="tok-c1">//RevocaciÃ³n de un rol a un usuario indicÃ¡ndole el atributo flush</span>
<span class="tok-n">UserRole</span><span class="tok-o">.</span><span class="tok-na">remove</span> <span class="tok-n">user</span><span class="tok-o">,</span> <span class="tok-n">role</span><span class="tok-o">,</span> <span class="tok-kc">true</span></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_clase_de_dominio_requestmap">7.3.4. Clase de dominio RequestMap</h4>
<div class="paragraph">
<p>La clase de dominio <em>RequestMap</em> es una clase opcional que nos permite registrar que peticiones queremos asegurar introduciÃ©ndolas en la base de datos en lugar de tener que especificarlo en el archivo de configuraciÃ³n <em>Config.groovy</em> o mediante anotaciones (lo veremos a continuaciÃ³n).</p>
</div>
<div class="paragraph">
<p>Esta opciÃ³n nos permite configurar estas entradas en tiempo de ejecuciÃ³n y podremos aÃ±adir, modificar o eliminar entradas sin tener que reiniciar la aplicaciÃ³n. Esta es la clase generada:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-kn">package</span> <span class="tok-n">es</span><span class="tok-o">.</span><span class="tok-na">ua</span><span class="tok-o">.</span><span class="tok-na">expertojava</span><span class="tok-o">.</span><span class="tok-na">todo</span>

<span class="tok-kn">import</span> <span class="tok-nn">org.springframework.http.HttpMethod</span>

<span class="tok-kd">class</span> <span class="tok-nc">RequestMap</span> <span class="tok-o">{</span>

	<span class="tok-n">String</span> <span class="tok-n">url</span>
	<span class="tok-n">String</span> <span class="tok-n">configAttribute</span>
	<span class="tok-n">HttpMethod</span> <span class="tok-n">httpMethod</span>

	<span class="tok-kd">static</span> <span class="tok-n">mapping</span> <span class="tok-o">=</span> <span class="tok-o">{</span>
		<span class="tok-n">cache</span> <span class="tok-kc">true</span>
	<span class="tok-o">}</span>

	<span class="tok-kd">static</span> <span class="tok-n">constraints</span> <span class="tok-o">=</span> <span class="tok-o">{</span>
		<span class="tok-n">url</span> <span class="tok-nl">blank:</span> <span class="tok-kc">false</span><span class="tok-o">,</span> <span class="tok-nl">unique:</span> <span class="tok-s1">&#39;httpMethod&#39;</span>
		<span class="tok-n">configAttribute</span> <span class="tok-nl">blank:</span> <span class="tok-kc">false</span>
		<span class="tok-n">httpMethod</span> <span class="tok-nl">nullable:</span> <span class="tok-kc">true</span>
	<span class="tok-o">}</span>
<span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>El campo <em>url</em> serÃ¡ la direcciÃ³n accedida a asegurar mientras que el campo <em>configAttributeField</em> indicarÃ¡ los roles permitidos para acceder a esa direcciÃ³n url. TambiÃ©n podemos especificar que mÃ©todo HTTP vamos a permitir. Si no lo asignamos, significarÃ¡ que podemos utilizar cualquier mÃ©todo.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_asegurar_peticiones">7.4. Asegurar peticiones</h3>
<div class="paragraph">
<p>En esta secciÃ³n vamos a ver las diversas formas que nos permite el plugin de Spring Security para configurar las diferentes peticiones que necesitemos asegurar en nuestra aplicaciÃ³n. BÃ¡sicamente, tenemos cuatro formas de hacer esto, de las cuales debemos elegir sÃ³lo una para espeficar que direcciones queremos asegurar en nuestra aplicaciÃ³n:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Anotaciones</p>
</li>
<li>
<p>Archivo de configuraciÃ³n Config.groovy</p>
</li>
<li>
<p>Instancias de la clase RequestMap</p>
</li>
<li>
<p>Expresiones especÃ­ficas</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Pero antes de ver cada una de estas formas, veamos unos cuantos aspectos interesantes. Habitualmente, las aplicaciones web son pÃºblicas con algunas pÃ¡ginas privadas que son las que aseguraremos. Sin embargo, si la mayor parte de nuestra aplicaciÃ³n es privada, podemos usar la aproximaciÃ³n pesimista para denegar el acceso a todas las urls que no tengan una regla configurada. Esto lo podemos hacer especificando en el archivo de configuraciÃ³n <em>Config.groovy</em> el siguiente valor:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-n">grails</span><span class="tok-o">.</span><span class="tok-na">plugin</span><span class="tok-o">.</span><span class="tok-na">springsecurity</span><span class="tok-o">.</span><span class="tok-na">rejectIfNoRule</span> <span class="tok-o">=</span> <span class="tok-kc">true</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>De esta forma, cualquier url que no tenga una regla especificada, serÃ¡ denegada para cualquier usuario.</p>
</div>
<div class="paragraph">
<p>Cualquier direcciÃ³n que necesitemos asegurar debe tener especificada una regla. Por ejemplo, podremos proteger la url <em>/todo/tag/**</em> para que sÃ³lo los usuarios con el rol <em>ROLE_ADMIN</em> puedan crear etiquetas. Pero ademÃ¡s, estas entradas podemos combinarlas con una serie de tokens predefinidos:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><em>IS_AUTHENTICATED_ANONYMOUSLY</em>, indica que cualquier usuario podrÃ­a acceder a esa url.</p>
</li>
<li>
<p><em>IS_AUTHENTICATED_REMEMBERED</em>, indica que el usuario se ha autenticado en la aplicaciÃ³n con la opciÃ³n de <em>remember me</em>.</p>
</li>
<li>
<p><em>IS_AUTHENTICATED_FULLY</em>, indica que el usuario se ha identificado completando el formulario de autenticaciÃ³n.</p>
</li>
</ul>
</div>
<div class="sect3">
<h4 id="_anotaciones">7.4.1. Anotaciones</h4>
<div class="paragraph">
<p>Si queremos utilizar este mÃ©todo en nuestra aplicaciÃ³n, debemos especificar el siguiente parÃ¡metro en el archivo de configuraciÃ³n <em>Config.groovy</em></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-n">grails</span><span class="tok-o">.</span><span class="tok-na">plugin</span><span class="tok-o">.</span><span class="tok-na">springsecurity</span><span class="tok-o">.</span><span class="tok-na">securityConfigType</span> <span class="tok-o">=</span> <span class="tok-s2">&quot;Annotation&quot;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Podemos especificar anotaciones tanto a nivel de clase como a nivel de mÃ©todo. En caso de que se especifiquen reglas tanto a nivel de clase como a nivel de mÃ©todo, serÃ¡n estas Ãºltimas las que se apliquen.</p>
</div>
<div class="paragraph">
<p>En el siguiente ejemplo especificamos la seguridad a nivel de mÃ©todo:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-kn">package</span> <span class="tok-n">com</span><span class="tok-o">.</span><span class="tok-na">mycompany</span><span class="tok-o">.</span><span class="tok-na">myapp</span>
<span class="tok-kn">import</span> <span class="tok-nn">grails.plugin.springsecurity.annotation.Secured</span>

<span class="tok-kd">class</span> <span class="tok-nc">SecureAnnotatedController</span> <span class="tok-o">{</span>

   <span class="tok-nd">@Secured</span><span class="tok-o">([</span><span class="tok-s1">&#39;ROLE_ADMIN&#39;</span><span class="tok-o">])</span>
   <span class="tok-kt">def</span> <span class="tok-nf">index</span><span class="tok-o">()</span> <span class="tok-o">{</span>
      <span class="tok-n">render</span> <span class="tok-s1">&#39;you have ROLE_ADMIN&#39;</span>
   <span class="tok-o">}</span>

   <span class="tok-nd">@Secured</span><span class="tok-o">([</span><span class="tok-s1">&#39;ROLE_ADMIN&#39;</span><span class="tok-o">,</span> <span class="tok-s1">&#39;ROLE_SUPERUSER&#39;</span><span class="tok-o">])</span>
   <span class="tok-kt">def</span> <span class="tok-nf">adminEither</span><span class="tok-o">()</span> <span class="tok-o">{</span>
      <span class="tok-n">render</span> <span class="tok-s1">&#39;you have ROLE_ADMIN or SUPERUSER&#39;</span>
   <span class="tok-o">}</span>

   <span class="tok-kt">def</span> <span class="tok-nf">anybody</span><span class="tok-o">()</span> <span class="tok-o">{</span>
      <span class="tok-n">render</span> <span class="tok-s1">&#39;anyone can see this&#39;</span>
   <span class="tok-o">}</span>
<span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Pero tambiÃ©n podemos especificarlo a nivel de clase:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-kn">package</span> <span class="tok-n">com</span><span class="tok-o">.</span><span class="tok-na">mycompany</span><span class="tok-o">.</span><span class="tok-na">myapp</span>
<span class="tok-kn">import</span> <span class="tok-nn">grails.plugin.springsecurity.annotation.Secured</span>

<span class="tok-nd">@Secured</span><span class="tok-o">([</span><span class="tok-s1">&#39;ROLE_ADMIN&#39;</span><span class="tok-o">])</span>
<span class="tok-kd">class</span> <span class="tok-nc">SecureClassAnnotatedController</span> <span class="tok-o">{</span>

   <span class="tok-kt">def</span> <span class="tok-nf">index</span><span class="tok-o">()</span> <span class="tok-o">{</span>
      <span class="tok-n">render</span> <span class="tok-s1">&#39;index: you have ROLE_ADMIN&#39;</span>
   <span class="tok-o">}</span>

   <span class="tok-kt">def</span> <span class="tok-nf">otherAction</span><span class="tok-o">()</span> <span class="tok-o">{</span>
      <span class="tok-n">render</span> <span class="tok-s1">&#39;otherAction: you have ROLE_ADMIN&#39;</span>
   <span class="tok-o">}</span>

   <span class="tok-nd">@Secured</span><span class="tok-o">([</span><span class="tok-s1">&#39;ROLE_SUPERUSER&#39;</span><span class="tok-o">])</span>
   <span class="tok-kt">def</span> <span class="tok-nf">super</span><span class="tok-o">()</span> <span class="tok-o">{</span>
      <span class="tok-n">render</span> <span class="tok-s1">&#39;super: you have ROLE_SUPERUSER&#39;</span>
   <span class="tok-o">}</span>
<span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>En ocasiones, necesitaremos incluso definir reglas para proteger el acceso a determinados directorios, como por ejemplo, los directorios de imÃ¡genes o los archivos javascript. Para esto, debemos especificar reglas estÃ¡ticas en el archivo de configuraciÃ³n <em>Config.groovy</em>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-n">grails</span><span class="tok-o">.</span><span class="tok-na">plugin</span><span class="tok-o">.</span><span class="tok-na">springsecurity</span><span class="tok-o">.</span><span class="tok-na">controllerAnnotations</span><span class="tok-o">.</span><span class="tok-na">staticRules</span> <span class="tok-o">=</span> <span class="tok-o">[</span>
   <span class="tok-s1">&#39;/js/admin/**&#39;</span><span class="tok-o">:</span> <span class="tok-o">[</span><span class="tok-s1">&#39;ROLE_ADMIN&#39;</span><span class="tok-o">],</span>
   <span class="tok-s1">&#39;/images/**&#39;</span><span class="tok-o">:</span> <span class="tok-o">[</span><span class="tok-s1">&#39;ROLE_ADMIN&#39;</span><span class="tok-o">]</span>
<span class="tok-o">]</span></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_archivo_de_configuraciÃ³n_config_groovy">7.4.2. Archivo de configuraciÃ³n Config.groovy</h4>
<div class="paragraph">
<p>Para poder utilizar este mÃ©todo, debemos especificar en el archivo de configuraciÃ³n <em>Config.groovy</em> el siguiente parÃ¡metro:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-n">grails</span><span class="tok-o">.</span><span class="tok-na">plugin</span><span class="tok-o">.</span><span class="tok-na">springsecurity</span><span class="tok-o">.</span><span class="tok-na">securityConfigType</span> <span class="tok-o">=</span> <span class="tok-s2">&quot;InterceptUrlMap&quot;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Posteriormente, lo Ãºnico que debemos hacer es especificar en el archivo <em>Config.groovy</em> todas las reglas que necesitemos de la siguiente forma:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-n">grails</span><span class="tok-o">.</span><span class="tok-na">plugin</span><span class="tok-o">.</span><span class="tok-na">springsecurity</span><span class="tok-o">.</span><span class="tok-na">interceptUrlMap</span> <span class="tok-o">=</span> <span class="tok-o">[</span>
   <span class="tok-s1">&#39;/&#39;</span><span class="tok-o">:</span>                  <span class="tok-o">[</span><span class="tok-s1">&#39;permitAll&#39;</span><span class="tok-o">],</span>
   <span class="tok-s1">&#39;/index&#39;</span><span class="tok-o">:</span>             <span class="tok-o">[</span><span class="tok-s1">&#39;permitAll&#39;</span><span class="tok-o">],</span>
   <span class="tok-s1">&#39;/index.gsp&#39;</span><span class="tok-o">:</span>         <span class="tok-o">[</span><span class="tok-s1">&#39;permitAll&#39;</span><span class="tok-o">],</span>
   <span class="tok-s1">&#39;/assets/**&#39;</span><span class="tok-o">:</span>         <span class="tok-o">[</span><span class="tok-s1">&#39;permitAll&#39;</span><span class="tok-o">],</span>
   <span class="tok-s1">&#39;/**/js/**&#39;</span><span class="tok-o">:</span>          <span class="tok-o">[</span><span class="tok-s1">&#39;permitAll&#39;</span><span class="tok-o">],</span>
   <span class="tok-s1">&#39;/**/css/**&#39;</span><span class="tok-o">:</span>         <span class="tok-o">[</span><span class="tok-s1">&#39;permitAll&#39;</span><span class="tok-o">],</span>
   <span class="tok-s1">&#39;/**/images/**&#39;</span><span class="tok-o">:</span>      <span class="tok-o">[</span><span class="tok-s1">&#39;permitAll&#39;</span><span class="tok-o">],</span>
   <span class="tok-s1">&#39;/**/favicon.ico&#39;</span><span class="tok-o">:</span>    <span class="tok-o">[</span><span class="tok-s1">&#39;permitAll&#39;</span><span class="tok-o">],</span>
   <span class="tok-s1">&#39;/login/**&#39;</span><span class="tok-o">:</span>          <span class="tok-o">[</span><span class="tok-s1">&#39;permitAll&#39;</span><span class="tok-o">],</span>
   <span class="tok-s1">&#39;/logout/**&#39;</span><span class="tok-o">:</span>         <span class="tok-o">[</span><span class="tok-s1">&#39;permitAll&#39;</span><span class="tok-o">],</span>
   <span class="tok-s1">&#39;/secure/**&#39;</span><span class="tok-o">:</span>         <span class="tok-o">[</span><span class="tok-s1">&#39;ROLE_ADMIN&#39;</span><span class="tok-o">],</span>
   <span class="tok-s1">&#39;/finance/**&#39;</span><span class="tok-o">:</span>        <span class="tok-o">[</span><span class="tok-s1">&#39;ROLE_FINANCE&#39;</span><span class="tok-o">,</span> <span class="tok-s1">&#39;isFullyAuthenticated()&#39;</span><span class="tok-o">],</span>
<span class="tok-o">]</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>En este listado, es importante que especifiquemos las reglas en el orden correcto y esto se consigue siendo mÃ¡s especÃ­fico para pasar posteriormente a ser mÃ¡s general. El siguiente ejemplo serÃ­a incorrecto, puesto que estarÃ­amos dando permisos a los usuarios de tipo ROLE_ADMIN a las direcciones <em>/secure/reallysecure/**</em>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-s1">&#39;/secure/**&#39;</span><span class="tok-o">:</span>              <span class="tok-o">[</span><span class="tok-s1">&#39;ROLE_ADMIN&#39;</span><span class="tok-o">,</span> <span class="tok-s1">&#39;ROLE_SUPERUSER&#39;</span><span class="tok-o">],</span>
<span class="tok-s1">&#39;/secure/reallysecure/**&#39;</span><span class="tok-o">:</span> <span class="tok-o">[</span><span class="tok-s1">&#39;ROLE_SUPERUSER&#39;</span><span class="tok-o">]</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Si un usuario de tipo ROLE_ADMIN intentase acceder a la direcciÃ³n <em>/secure/reallysecure/list</em> se le darÃ­a acceso sin ningÃºn problema puesto que casarÃ­a con la primera regla encontrada. La soluciÃ³n correcta serÃ­a la siguiente:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-s1">&#39;/secure/reallysecure/**&#39;</span><span class="tok-o">:</span> <span class="tok-o">[</span><span class="tok-s1">&#39;ROLE_SUPERUSER&#39;</span><span class="tok-o">]</span>
<span class="tok-s1">&#39;/secure/**&#39;</span><span class="tok-o">:</span>              <span class="tok-o">[</span><span class="tok-s1">&#39;ROLE_ADMIN&#39;</span><span class="tok-o">,</span> <span class="tok-s1">&#39;ROLE_SUPERUSER&#39;</span><span class="tok-o">]</span></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_instancias_de_la_clase_requestmap">7.4.3. Instancias de la clase RequestMap</h4>
<div class="paragraph">
<p>Con esta forma, almacenaremos en la base de datos todas las urls que queremos proteger junto con la regla que debe cumplir, de forma muy similar a como hemos visto en el anterior apartado.</p>
</div>
<div class="paragraph">
<p>Lo primero que debemos hacer es especificar que utilizaremos este mÃ©todo en el archivo de configuraciÃ³n <em>Config.groovy</em>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-n">grails</span><span class="tok-o">.</span><span class="tok-na">plugin</span><span class="tok-o">.</span><span class="tok-na">springsecurity</span><span class="tok-o">.</span><span class="tok-na">securityConfigType</span> <span class="tok-o">=</span> <span class="tok-s2">&quot;Requestmap&quot;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Posteriormente, podemos especificar estas urls junto con sus reglas en el archivo <em>BootStrap.groovy</em>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-k">for</span> <span class="tok-o">(</span><span class="tok-n">String</span> <span class="tok-n">url</span> <span class="tok-k">in</span> <span class="tok-o">[</span>
      <span class="tok-s1">&#39;/&#39;</span><span class="tok-o">,</span> <span class="tok-s1">&#39;/index&#39;</span><span class="tok-o">,</span> <span class="tok-s1">&#39;/index.gsp&#39;</span><span class="tok-o">,</span> <span class="tok-s1">&#39;/**/favicon.ico&#39;</span><span class="tok-o">,</span>
      <span class="tok-s1">&#39;/assets/**&#39;</span><span class="tok-o">,</span> <span class="tok-s1">&#39;/**/js/**&#39;</span><span class="tok-o">,</span> <span class="tok-s1">&#39;/**/css/**&#39;</span><span class="tok-o">,</span> <span class="tok-s1">&#39;/**/images/**&#39;</span><span class="tok-o">,</span>
      <span class="tok-s1">&#39;/login&#39;</span><span class="tok-o">,</span> <span class="tok-s1">&#39;/login.*&#39;</span><span class="tok-o">,</span> <span class="tok-s1">&#39;/login/*&#39;</span><span class="tok-o">,</span>
      <span class="tok-s1">&#39;/logout&#39;</span><span class="tok-o">,</span> <span class="tok-s1">&#39;/logout.*&#39;</span><span class="tok-o">,</span> <span class="tok-s1">&#39;/logout/*&#39;</span><span class="tok-o">])</span> <span class="tok-o">{</span>
   <span class="tok-k">new</span> <span class="tok-nf">Requestmap</span><span class="tok-o">(</span><span class="tok-nl">url:</span> <span class="tok-n">url</span><span class="tok-o">,</span> <span class="tok-nl">configAttribute:</span> <span class="tok-s1">&#39;permitAll&#39;</span><span class="tok-o">).</span><span class="tok-na">save</span><span class="tok-o">()</span>
<span class="tok-o">}</span>
<span class="tok-k">new</span> <span class="tok-nf">Requestmap</span><span class="tok-o">(</span><span class="tok-nl">url:</span> <span class="tok-s1">&#39;/profile/**&#39;</span><span class="tok-o">,</span>    <span class="tok-nl">configAttribute:</span> <span class="tok-s1">&#39;ROLE_USER&#39;</span><span class="tok-o">).</span><span class="tok-na">save</span><span class="tok-o">()</span>
<span class="tok-k">new</span> <span class="tok-nf">Requestmap</span><span class="tok-o">(</span><span class="tok-nl">url:</span> <span class="tok-s1">&#39;/admin/**&#39;</span><span class="tok-o">,</span>      <span class="tok-nl">configAttribute:</span> <span class="tok-s1">&#39;ROLE_ADMIN&#39;</span><span class="tok-o">).</span><span class="tok-na">save</span><span class="tok-o">()</span>
<span class="tok-k">new</span> <span class="tok-nf">Requestmap</span><span class="tok-o">(</span><span class="tok-nl">url:</span> <span class="tok-s1">&#39;/admin/role/**&#39;</span><span class="tok-o">,</span> <span class="tok-nl">configAttribute:</span> <span class="tok-s1">&#39;ROLE_SUPERVISOR&#39;</span><span class="tok-o">).</span><span class="tok-na">save</span><span class="tok-o">()</span>
<span class="tok-k">new</span> <span class="tok-nf">Requestmap</span><span class="tok-o">(</span><span class="tok-nl">url:</span> <span class="tok-s1">&#39;/admin/user/**&#39;</span><span class="tok-o">,</span> <span class="tok-nl">configAttribute:</span> <span class="tok-s1">&#39;ROLE_ADMIN,ROLE_SUPERVISOR&#39;</span><span class="tok-o">).</span><span class="tok-na">save</span><span class="tok-o">()</span>
<span class="tok-k">new</span> <span class="tok-nf">Requestmap</span><span class="tok-o">(</span><span class="tok-nl">url:</span> <span class="tok-s1">&#39;/j_spring_security_switch_user&#39;</span><span class="tok-o">,</span>
               <span class="tok-nl">configAttribute:</span> <span class="tok-s1">&#39;ROLE_SWITCH_USER,isFullyAuthenticated()&#39;</span><span class="tok-o">).</span><span class="tok-na">save</span><span class="tok-o">()</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>A diferencia del mÃ©todo anterior, en esta ocasiÃ³n no es necesario que tengamos en cuenta el orden de las reglas, ya que serÃ¡ el propio plugin quien se encargue de calcular que regla es la mÃ¡s especÃ­fica.</p>
</div>
<div class="paragraph">
<p>Por defecto, las reglas especificadas de esta forma son cacheadas en la aplicaciÃ³n, con lo que debemos tener en cuenta que cuando creemos, modifiquemos o eliminemos una regla, deberemos actualizar la cachÃ© para que se tengan en cuenta los cambios introducidos. Esto lo podemos hacer con el mÃ©todo <em>clearCachedRequestmaps()</em> del servicio <em>springSecurityService</em>, tal y como vemos en el siguiente ejemplo.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-kd">class</span> <span class="tok-nc">RequestmapController</span> <span class="tok-o">{</span>
   <span class="tok-kt">def</span> <span class="tok-n">springSecurityService</span>

   <span class="tok-o">...</span>

   <span class="tok-kt">def</span> <span class="tok-nf">save</span><span class="tok-o">()</span> <span class="tok-o">{</span>
      <span class="tok-kt">def</span> <span class="tok-n">requestmapInstance</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">Requestmap</span><span class="tok-o">(</span><span class="tok-n">params</span><span class="tok-o">)</span>
      <span class="tok-k">if</span> <span class="tok-o">(!</span><span class="tok-n">requestmapInstance</span><span class="tok-o">.</span><span class="tok-na">save</span><span class="tok-o">(</span><span class="tok-nl">flush:</span> <span class="tok-kc">true</span><span class="tok-o">))</span> <span class="tok-o">{</span>
         <span class="tok-n">render</span> <span class="tok-nl">view:</span> <span class="tok-s1">&#39;create&#39;</span><span class="tok-o">,</span> <span class="tok-nl">model:</span> <span class="tok-o">[</span><span class="tok-nl">requestmapInstance:</span> <span class="tok-n">requestmapInstance</span><span class="tok-o">]</span>
         <span class="tok-k">return</span>
      <span class="tok-o">}</span>

      <span class="tok-n">springSecurityService</span><span class="tok-o">.</span><span class="tok-na">clearCachedRequestmaps</span><span class="tok-o">()</span>

      <span class="tok-n">flash</span><span class="tok-o">.</span><span class="tok-na">message</span> <span class="tok-o">=</span> <span class="tok-s2">&quot;${message(code: &#39;default.created.message&#39;, args: [message(code: &#39;requestmap.label&#39;, default: &#39;Requestmap&#39;), requestmapInstance.id])}&quot;</span>
      <span class="tok-n">redirect</span> <span class="tok-nl">action:</span> <span class="tok-s1">&#39;show&#39;</span><span class="tok-o">,</span> <span class="tok-nl">id:</span> <span class="tok-n">requestmapInstance</span><span class="tok-o">.</span><span class="tok-na">id</span>
   <span class="tok-o">}</span>
<span class="tok-o">}</span></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_expresiones_especÃ­ficas">7.4.4. Expresiones especÃ­ficas</h4>
<div class="paragraph">
<p>En Spring Security podemos utilizar tambiÃ©n <em>Spring Expression Language (SpEL)</em> para especificar las reglas de acceso a determinadas partes de nuestra aplicaciÃ³n. Mediante este lenguaje, vamos a poder ser algo mÃ¡s especÃ­ficos. Veamos el mismo ejemplo utilizando cualquiera de los mÃ©todos que acabamos de ver. Empecemos por las anotaciones:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-kn">package</span> <span class="tok-n">com</span><span class="tok-o">.</span><span class="tok-na">yourcompany</span><span class="tok-o">.</span><span class="tok-na">yourapp</span>
<span class="tok-kn">import</span> <span class="tok-nn">grails.plugin.springsecurity.annotation.Secured</span>

<span class="tok-kd">class</span> <span class="tok-nc">SecureController</span> <span class="tok-o">{</span>

   <span class="tok-nd">@Secured</span><span class="tok-o">([</span><span class="tok-s2">&quot;hasRole(&#39;ROLE_ADMIN&#39;)&quot;</span><span class="tok-o">])</span>
   <span class="tok-kt">def</span> <span class="tok-nf">someAction</span><span class="tok-o">()</span> <span class="tok-o">{</span>
      <span class="tok-o">...</span>
   <span class="tok-o">}</span>

   <span class="tok-nd">@Secured</span><span class="tok-o">([</span><span class="tok-s2">&quot;authentication.name == &#39;ralph&#39;&quot;</span><span class="tok-o">])</span>
   <span class="tok-kt">def</span> <span class="tok-nf">someOtherAction</span><span class="tok-o">()</span> <span class="tok-o">{</span>
      <span class="tok-o">...</span>
   <span class="tok-o">}</span>
<span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Sigamos con el mÃ©todo de almacenamiento de instancias de la clase RequestMap.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-k">new</span> <span class="tok-nf">Requestmap</span><span class="tok-o">(</span><span class="tok-nl">url:</span> <span class="tok-s2">&quot;/secure/someAction&quot;</span><span class="tok-o">,</span>
               <span class="tok-nl">configAttribute:</span> <span class="tok-s2">&quot;hasRole(&#39;ROLE_ADMIN&#39;)&quot;</span><span class="tok-o">).</span><span class="tok-na">save</span><span class="tok-o">()</span>
<span class="tok-k">new</span> <span class="tok-nf">Requestmap</span><span class="tok-o">(</span><span class="tok-nl">url:</span> <span class="tok-s2">&quot;/secure/someOtherAction&quot;</span><span class="tok-o">,</span>
               <span class="tok-nl">configAttribute:</span> <span class="tok-s2">&quot;authentication.name == &#39;ralph&#39;&quot;</span><span class="tok-o">).</span><span class="tok-na">save</span><span class="tok-o">()</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Terminemos por la modificaciÃ³n del archivo de configuraciÃ³n <em>Config.groovy</em>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-n">grails</span><span class="tok-o">.</span><span class="tok-na">plugin</span><span class="tok-o">.</span><span class="tok-na">springsecurity</span><span class="tok-o">.</span><span class="tok-na">interceptUrlMap</span> <span class="tok-o">=</span> <span class="tok-o">[</span>
   <span class="tok-s1">&#39;/secure/someAction&#39;</span><span class="tok-o">:</span>      <span class="tok-o">[</span><span class="tok-s2">&quot;hasRole(&#39;ROLE_ADMIN&#39;)&quot;</span><span class="tok-o">],</span>
   <span class="tok-s1">&#39;/secure/someOtherAction&#39;</span><span class="tok-o">:</span> <span class="tok-o">[</span><span class="tok-s2">&quot;authentication.name == &#39;ralph&#39;&quot;</span><span class="tok-o">]</span>
<span class="tok-o">]</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>AquÃ­ tienes una tabla con las expresiones que podemos utilizar:</p>
</div>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-center valign-middle">ExpresiÃ³n</th>
<th class="tableblock halign-left valign-top">DescripciÃ³n</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-center valign-middle"><p class="tableblock">hasRole(role)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Devuelve cierto si el usuario tiene asignado este rol</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-middle"><p class="tableblock">hasAnyRole([role1,role2])</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Devuelve cierto si el usuario tiene asignado cualquiera de los roles pasados por parÃ¡metro</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-middle"><p class="tableblock">principal</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Devuelve los datos del usuario registrado</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-middle"><p class="tableblock">authentication</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Devuelve todos los datos relativos a la autenticaciÃ³n</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-middle"><p class="tableblock">permitAll</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Siempre devuelve cierto</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-middle"><p class="tableblock">denyAll</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Siempre devuelve falso</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-middle"><p class="tableblock">isAnonymous()</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Devuelve cierto si el usuario actual es anÃ³nimo</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-middle"><p class="tableblock">isRememberMe()</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Devuelve cierto si el usuario ha entrado con la opciÃ³n <em>remember me</em></p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-middle"><p class="tableblock">isAuthenticated()</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Devuelve cierto si el usuario no es anÃ³nimo</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-middle"><p class="tableblock">isFullyAuthenticated()</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Devuelve cierto si el usuario no es anÃ³nimo o no ha entrado con la opciÃ³n <em>remember me</em></p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-middle"><p class="tableblock">request</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">La peticiÃ³n HTTP, permitiendo expresiones como <em>isFullyAuthenticated() &amp;&amp; request.getMethod().equals('OPTIONS')</em></p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>La siguiente tabla muestra las equivalencias si lo hacemos de forma tradicional o mediante las expresiones <em>SpEL</em>.</p>
</div>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-center valign-middle">Modo tradicional</th>
<th class="tableblock halign-left valign-top">ExpresiÃ³n</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-center valign-middle"><p class="tableblock">ROLE_ADMIN</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">hasRole('ROLE_ADMIN')</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-middle"><p class="tableblock">ROLE_USER, ROLE_ADMIN</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">hasAnyRole('ROLE_USER','ROLE_ADMIN')</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-middle"><p class="tableblock">ROLE_ADMIN, IS_AUTHENTICATED_FULLY</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">hasRole('ROLE_ADMIN') and isFullyAuthenticated()</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-middle"><p class="tableblock">IS_AUTHENTICATED_ANONYMOUSLY</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">permitAll</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-middle"><p class="tableblock">IS_AUTHENTICATED_REMEMBERED</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">isAnonymous() or isRememberMe()</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-middle"><p class="tableblock">IS_AUTHENTICATED_FULLY</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">isFullyAuthenticated()</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="_aspectos_importantes">7.4.5. Aspectos importantes</h4>
<div class="paragraph">
<p>Como veremos mÃ¡s adelante, el plugin utiliza dos controladores para gestionar el proceso de <em>login</em> y <em>logout</em> del sistema. Estos controladores se llaman <em>LoginController</em> y <em>LogoutController</em>. Cualquier mÃ©todo de estos dos controladores debe ser accesible por cualquer usuario. AdemÃ¡s, tambiÃ©n debemos de dar acceso global a determinados recursos de nuestra aplicaciÃ³n.</p>
</div>
<div class="paragraph">
<p>Teniendo esto en cuenta, en funciÃ³n del mÃ©todo escogido para proteger nuestra aplicaciÃ³n, deberemos aÃ±adir una serie de reglas en nuestro archivo de configuraciÃ³n <em>Config.groovy</em>.</p>
</div>
<div class="sect4">
<h5 id="_mediante_anotaciones">Mediante anotaciones</h5>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-n">grails</span><span class="tok-o">.</span><span class="tok-na">plugin</span><span class="tok-o">.</span><span class="tok-na">springsecurity</span><span class="tok-o">.</span><span class="tok-na">securityConfigType</span> <span class="tok-o">=</span> <span class="tok-s1">&#39;Annotation&#39;</span>
<span class="tok-n">grails</span><span class="tok-o">.</span><span class="tok-na">plugin</span><span class="tok-o">.</span><span class="tok-na">springsecurity</span><span class="tok-o">.</span><span class="tok-na">controllerAnnotations</span><span class="tok-o">.</span><span class="tok-na">staticRules</span> <span class="tok-o">=</span> <span class="tok-o">[</span>
	<span class="tok-s1">&#39;/&#39;</span><span class="tok-o">:</span>                              	<span class="tok-o">[</span><span class="tok-s1">&#39;permitAll&#39;</span><span class="tok-o">],</span>
	<span class="tok-s1">&#39;/index&#39;</span><span class="tok-o">:</span>                         	<span class="tok-o">[</span><span class="tok-s1">&#39;permitAll&#39;</span><span class="tok-o">],</span>
	<span class="tok-s1">&#39;/index.gsp&#39;</span><span class="tok-o">:</span>                     	<span class="tok-o">[</span><span class="tok-s1">&#39;permitAll&#39;</span><span class="tok-o">],</span>
	<span class="tok-s1">&#39;/assets/**&#39;</span><span class="tok-o">:</span>                     	<span class="tok-o">[</span><span class="tok-s1">&#39;permitAll&#39;</span><span class="tok-o">],</span>
	<span class="tok-s1">&#39;/**/js/**&#39;</span><span class="tok-o">:</span>                      	<span class="tok-o">[</span><span class="tok-s1">&#39;permitAll&#39;</span><span class="tok-o">],</span>
	<span class="tok-s1">&#39;/**/css/**&#39;</span><span class="tok-o">:</span>                     	<span class="tok-o">[</span><span class="tok-s1">&#39;permitAll&#39;</span><span class="tok-o">],</span>
	<span class="tok-s1">&#39;/**/images/**&#39;</span><span class="tok-o">:</span>                  	<span class="tok-o">[</span><span class="tok-s1">&#39;permitAll&#39;</span><span class="tok-o">],</span>
	<span class="tok-s1">&#39;/**/favicon.ico&#39;</span><span class="tok-o">:</span>                	<span class="tok-o">[</span><span class="tok-s1">&#39;permitAll&#39;</span><span class="tok-o">],</span>
	<span class="tok-s1">&#39;/login/**&#39;</span><span class="tok-o">:</span>						<span class="tok-o">[</span><span class="tok-s1">&#39;permitAll&#39;</span><span class="tok-o">],</span>
	<span class="tok-s1">&#39;/logout/**&#39;</span><span class="tok-o">:</span>                		<span class="tok-o">[</span><span class="tok-s1">&#39;permitAll&#39;</span><span class="tok-o">],</span>
	<span class="tok-s1">&#39;/dbconsole/**&#39;</span><span class="tok-o">:</span>               		<span class="tok-o">[</span><span class="tok-s1">&#39;permitAll&#39;</span><span class="tok-o">]</span>
<span class="tok-o">]</span></code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_mediante_instancias_de_la_clase_de_dominio_requestmap">Mediante instancias de la clase de dominio RequestMap</h5>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-n">grails</span><span class="tok-o">.</span><span class="tok-na">plugin</span><span class="tok-o">.</span><span class="tok-na">springsecurity</span><span class="tok-o">.</span><span class="tok-na">securityConfigType</span> <span class="tok-o">=</span> <span class="tok-s1">&#39;Requestmap&#39;</span>

<span class="tok-cm">/* Esto debe ir en el archivo BootStrap.groovy */</span>
<span class="tok-k">for</span> <span class="tok-o">(</span><span class="tok-n">String</span> <span class="tok-n">url</span> <span class="tok-k">in</span> <span class="tok-o">[</span>
      <span class="tok-s1">&#39;/&#39;</span><span class="tok-o">,</span> <span class="tok-s1">&#39;/index&#39;</span><span class="tok-o">,</span> <span class="tok-s1">&#39;/index.gsp&#39;</span><span class="tok-o">,</span> <span class="tok-s1">&#39;/assets/**&#39;</span><span class="tok-o">,</span>
      <span class="tok-s1">&#39;/**/js/**&#39;</span><span class="tok-o">,</span> <span class="tok-s1">&#39;/**/css/**&#39;</span><span class="tok-o">,</span> <span class="tok-s1">&#39;/**/images/**&#39;</span><span class="tok-o">,</span>
      <span class="tok-s1">&#39;/**/favicon.ico&#39;</span><span class="tok-o">,</span> <span class="tok-s1">&#39;/login/**&#39;</span><span class="tok-o">,</span> <span class="tok-s1">&#39;/logout/**&#39;</span><span class="tok-o">,</span> <span class="tok-s1">&#39;/dbconsole/**&#39;</span><span class="tok-o">])</span> <span class="tok-o">{</span>
   <span class="tok-k">new</span> <span class="tok-nf">RequestMap</span><span class="tok-o">(</span><span class="tok-nl">url:</span> <span class="tok-n">url</span><span class="tok-o">,</span> <span class="tok-nl">configAttribute:</span> <span class="tok-s1">&#39;permitAll&#39;</span><span class="tok-o">).</span><span class="tok-na">save</span><span class="tok-o">()</span>
<span class="tok-o">}</span></code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_mediante_reglas_en_el_archivo_config_groovy_con_intercepturlmap">Mediante reglas en el archivo Config.groovy con InterceptUrlMap</h5>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-n">grails</span><span class="tok-o">.</span><span class="tok-na">plugin</span><span class="tok-o">.</span><span class="tok-na">springsecurity</span><span class="tok-o">.</span><span class="tok-na">securityConfigType</span> <span class="tok-o">=</span> <span class="tok-s1">&#39;InterceptUrlMap&#39;</span>
<span class="tok-n">grails</span><span class="tok-o">.</span><span class="tok-na">plugin</span><span class="tok-o">.</span><span class="tok-na">springsecurity</span><span class="tok-o">.</span><span class="tok-na">interceptUrlMap</span> <span class="tok-o">=</span> <span class="tok-o">[</span>
   <span class="tok-s1">&#39;/&#39;</span><span class="tok-o">:</span>                  <span class="tok-o">[</span><span class="tok-s1">&#39;permitAll&#39;</span><span class="tok-o">],</span>
   <span class="tok-s1">&#39;/index&#39;</span><span class="tok-o">:</span>             <span class="tok-o">[</span><span class="tok-s1">&#39;permitAll&#39;</span><span class="tok-o">],</span>
   <span class="tok-s1">&#39;/index.gsp&#39;</span><span class="tok-o">:</span>         <span class="tok-o">[</span><span class="tok-s1">&#39;permitAll&#39;</span><span class="tok-o">],</span>
   <span class="tok-s1">&#39;/assets/**&#39;</span><span class="tok-o">:</span>         <span class="tok-o">[</span><span class="tok-s1">&#39;permitAll&#39;</span><span class="tok-o">],</span>
   <span class="tok-s1">&#39;/**/js/**&#39;</span><span class="tok-o">:</span>          <span class="tok-o">[</span><span class="tok-s1">&#39;permitAll&#39;</span><span class="tok-o">],</span>
   <span class="tok-s1">&#39;/**/css/**&#39;</span><span class="tok-o">:</span>         <span class="tok-o">[</span><span class="tok-s1">&#39;permitAll&#39;</span><span class="tok-o">],</span>
   <span class="tok-s1">&#39;/**/images/**&#39;</span><span class="tok-o">:</span>      <span class="tok-o">[</span><span class="tok-s1">&#39;permitAll&#39;</span><span class="tok-o">],</span>
   <span class="tok-s1">&#39;/**/favicon.ico&#39;</span><span class="tok-o">:</span>    <span class="tok-o">[</span><span class="tok-s1">&#39;permitAll&#39;</span><span class="tok-o">],</span>
   <span class="tok-s1">&#39;/login/**&#39;</span><span class="tok-o">:</span>          <span class="tok-o">[</span><span class="tok-s1">&#39;permitAll&#39;</span><span class="tok-o">],</span>
   <span class="tok-s1">&#39;/logout/**&#39;</span><span class="tok-o">:</span>         <span class="tok-o">[</span><span class="tok-s1">&#39;permitAll&#39;</span><span class="tok-o">],</span>
   <span class="tok-s1">&#39;/dbconsole/**&#39;</span><span class="tok-o">:</span>      <span class="tok-o">[</span><span class="tok-s1">&#39;permitAll&#39;</span><span class="tok-o">]</span>
<span class="tok-o">]</span></code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_controladores_2">7.5. Controladores</h3>
<div class="paragraph">
<p>Con el plugin de Grails tendremos acceso a un par de controladores, que aunque en un principio no vamos a tener que modificar, estÃ¡ bien que conozcamos de su existencia. Estos dos controladores son <em>LoginController</em> y <em>LogoutController</em> y este es su contenido:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-kn">package</span> <span class="tok-n">grails</span><span class="tok-o">.</span><span class="tok-na">plugin</span><span class="tok-o">.</span><span class="tok-na">springsecurity</span>

<span class="tok-kn">import</span> <span class="tok-nn">grails.converters.JSON</span>

<span class="tok-kn">import</span> <span class="tok-nn">javax.servlet.http.HttpServletResponse</span>

<span class="tok-kn">import</span> <span class="tok-nn">org.springframework.security.access.annotation.Secured</span>
<span class="tok-kn">import</span> <span class="tok-nn">org.springframework.security.authentication.AccountExpiredException</span>
<span class="tok-kn">import</span> <span class="tok-nn">org.springframework.security.authentication.CredentialsExpiredException</span>
<span class="tok-kn">import</span> <span class="tok-nn">org.springframework.security.authentication.DisabledException</span>
<span class="tok-kn">import</span> <span class="tok-nn">org.springframework.security.authentication.LockedException</span>
<span class="tok-kn">import</span> <span class="tok-nn">org.springframework.security.core.context.SecurityContextHolder</span> <span class="tok-k">as</span> <span class="tok-n">SCH</span>
<span class="tok-kn">import</span> <span class="tok-nn">org.springframework.security.web.WebAttributes</span>

<span class="tok-nd">@Secured</span><span class="tok-o">(</span><span class="tok-s1">&#39;permitAll&#39;</span><span class="tok-o">)</span>
<span class="tok-kd">class</span> <span class="tok-nc">LoginController</span> <span class="tok-o">{</span>

	<span class="tok-cm">/**</span>
<span class="tok-cm">	 * Dependency injection for the authenticationTrustResolver.</span>
<span class="tok-cm">	 */</span>
	<span class="tok-kt">def</span> <span class="tok-n">authenticationTrustResolver</span>

	<span class="tok-cm">/**</span>
<span class="tok-cm">	 * Dependency injection for the springSecurityService.</span>
<span class="tok-cm">	 */</span>
	<span class="tok-kt">def</span> <span class="tok-n">springSecurityService</span>

	<span class="tok-cm">/**</span>
<span class="tok-cm">	 * Default action; redirects to &#39;defaultTargetUrl&#39; if logged in, /login/auth otherwise.</span>
<span class="tok-cm">	 */</span>
	<span class="tok-kt">def</span> <span class="tok-nf">index</span><span class="tok-o">()</span> <span class="tok-o">{</span>
		<span class="tok-k">if</span> <span class="tok-o">(</span><span class="tok-n">springSecurityService</span><span class="tok-o">.</span><span class="tok-na">isLoggedIn</span><span class="tok-o">())</span> <span class="tok-o">{</span>
			<span class="tok-n">redirect</span> <span class="tok-nl">uri:</span> <span class="tok-n">SpringSecurityUtils</span><span class="tok-o">.</span><span class="tok-na">securityConfig</span><span class="tok-o">.</span><span class="tok-na">successHandler</span><span class="tok-o">.</span><span class="tok-na">defaultTargetUrl</span>
		<span class="tok-o">}</span>
		<span class="tok-k">else</span> <span class="tok-o">{</span>
			<span class="tok-n">redirect</span> <span class="tok-nl">action:</span> <span class="tok-s1">&#39;auth&#39;</span><span class="tok-o">,</span> <span class="tok-nl">params:</span> <span class="tok-n">params</span>
		<span class="tok-o">}</span>
	<span class="tok-o">}</span>

	<span class="tok-cm">/**</span>
<span class="tok-cm">	 * Show the login page.</span>
<span class="tok-cm">	 */</span>
	<span class="tok-kt">def</span> <span class="tok-nf">auth</span><span class="tok-o">()</span> <span class="tok-o">{</span>

		<span class="tok-kt">def</span> <span class="tok-n">config</span> <span class="tok-o">=</span> <span class="tok-n">SpringSecurityUtils</span><span class="tok-o">.</span><span class="tok-na">securityConfig</span>

		<span class="tok-k">if</span> <span class="tok-o">(</span><span class="tok-n">springSecurityService</span><span class="tok-o">.</span><span class="tok-na">isLoggedIn</span><span class="tok-o">())</span> <span class="tok-o">{</span>
			<span class="tok-n">redirect</span> <span class="tok-nl">uri:</span> <span class="tok-n">config</span><span class="tok-o">.</span><span class="tok-na">successHandler</span><span class="tok-o">.</span><span class="tok-na">defaultTargetUrl</span>
			<span class="tok-k">return</span>
		<span class="tok-o">}</span>

		<span class="tok-n">String</span> <span class="tok-n">view</span> <span class="tok-o">=</span> <span class="tok-s1">&#39;auth&#39;</span>
		<span class="tok-n">String</span> <span class="tok-n">postUrl</span> <span class="tok-o">=</span> <span class="tok-s2">&quot;${request.contextPath}${config.apf.filterProcessesUrl}&quot;</span>
		<span class="tok-n">render</span> <span class="tok-nl">view:</span> <span class="tok-n">view</span><span class="tok-o">,</span> <span class="tok-nl">model:</span> <span class="tok-o">[</span><span class="tok-nl">postUrl:</span> <span class="tok-n">postUrl</span><span class="tok-o">,</span>
		                           <span class="tok-nl">rememberMeParameter:</span> <span class="tok-n">config</span><span class="tok-o">.</span><span class="tok-na">rememberMe</span><span class="tok-o">.</span><span class="tok-na">parameter</span><span class="tok-o">]</span>
	<span class="tok-o">}</span>

	<span class="tok-cm">/**</span>
<span class="tok-cm">	 * The redirect action for Ajax requests.</span>
<span class="tok-cm">	 */</span>
	<span class="tok-kt">def</span> <span class="tok-nf">authAjax</span><span class="tok-o">()</span> <span class="tok-o">{</span>
		<span class="tok-n">response</span><span class="tok-o">.</span><span class="tok-na">setHeader</span> <span class="tok-s1">&#39;Location&#39;</span><span class="tok-o">,</span> <span class="tok-n">SpringSecurityUtils</span><span class="tok-o">.</span><span class="tok-na">securityConfig</span><span class="tok-o">.</span><span class="tok-na">auth</span><span class="tok-o">.</span><span class="tok-na">ajaxLoginFormUrl</span>
		<span class="tok-n">response</span><span class="tok-o">.</span><span class="tok-na">sendError</span> <span class="tok-n">HttpServletResponse</span><span class="tok-o">.</span><span class="tok-na">SC_UNAUTHORIZED</span>
	<span class="tok-o">}</span>

	<span class="tok-cm">/**</span>
<span class="tok-cm">	 * Show denied page.</span>
<span class="tok-cm">	 */</span>
	<span class="tok-kt">def</span> <span class="tok-nf">denied</span><span class="tok-o">()</span> <span class="tok-o">{</span>
		<span class="tok-k">if</span> <span class="tok-o">(</span><span class="tok-n">springSecurityService</span><span class="tok-o">.</span><span class="tok-na">isLoggedIn</span><span class="tok-o">()</span> <span class="tok-o">&amp;&amp;</span>
				<span class="tok-n">authenticationTrustResolver</span><span class="tok-o">.</span><span class="tok-na">isRememberMe</span><span class="tok-o">(</span><span class="tok-n">SCH</span><span class="tok-o">.</span><span class="tok-na">context</span><span class="tok-o">?.</span><span class="tok-na">authentication</span><span class="tok-o">))</span> <span class="tok-o">{</span>
			<span class="tok-c1">// have cookie but the page is guarded with IS_AUTHENTICATED_FULLY</span>
			<span class="tok-n">redirect</span> <span class="tok-nl">action:</span> <span class="tok-s1">&#39;full&#39;</span><span class="tok-o">,</span> <span class="tok-nl">params:</span> <span class="tok-n">params</span>
		<span class="tok-o">}</span>
	<span class="tok-o">}</span>

	<span class="tok-cm">/**</span>
<span class="tok-cm">	 * Login page for users with a remember-me cookie but accessing a IS_AUTHENTICATED_FULLY page.</span>
<span class="tok-cm">	 */</span>
	<span class="tok-kt">def</span> <span class="tok-nf">full</span><span class="tok-o">()</span> <span class="tok-o">{</span>
		<span class="tok-kt">def</span> <span class="tok-n">config</span> <span class="tok-o">=</span> <span class="tok-n">SpringSecurityUtils</span><span class="tok-o">.</span><span class="tok-na">securityConfig</span>
		<span class="tok-n">render</span> <span class="tok-nl">view:</span> <span class="tok-s1">&#39;auth&#39;</span><span class="tok-o">,</span> <span class="tok-nl">params:</span> <span class="tok-n">params</span><span class="tok-o">,</span>
			<span class="tok-nl">model:</span> <span class="tok-o">[</span><span class="tok-nl">hasCookie:</span> <span class="tok-n">authenticationTrustResolver</span><span class="tok-o">.</span><span class="tok-na">isRememberMe</span><span class="tok-o">(</span><span class="tok-n">SCH</span><span class="tok-o">.</span><span class="tok-na">context</span><span class="tok-o">?.</span><span class="tok-na">authentication</span><span class="tok-o">),</span>
			        <span class="tok-nl">postUrl:</span> <span class="tok-s2">&quot;${request.contextPath}${config.apf.filterProcessesUrl}&quot;</span><span class="tok-o">]</span>
	<span class="tok-o">}</span>

	<span class="tok-cm">/**</span>
<span class="tok-cm">	 * Callback after a failed login. Redirects to the auth page with a warning message.</span>
<span class="tok-cm">	 */</span>
	<span class="tok-kt">def</span> <span class="tok-nf">authfail</span><span class="tok-o">()</span> <span class="tok-o">{</span>

		<span class="tok-n">String</span> <span class="tok-n">msg</span> <span class="tok-o">=</span> <span class="tok-s1">&#39;&#39;</span>
		<span class="tok-kt">def</span> <span class="tok-n">exception</span> <span class="tok-o">=</span> <span class="tok-n">session</span><span class="tok-o">[</span><span class="tok-n">WebAttributes</span><span class="tok-o">.</span><span class="tok-na">AUTHENTICATION_EXCEPTION</span><span class="tok-o">]</span>
		<span class="tok-k">if</span> <span class="tok-o">(</span><span class="tok-n">exception</span><span class="tok-o">)</span> <span class="tok-o">{</span>
			<span class="tok-k">if</span> <span class="tok-o">(</span><span class="tok-n">exception</span> <span class="tok-k">instanceof</span> <span class="tok-n">AccountExpiredException</span><span class="tok-o">)</span> <span class="tok-o">{</span>
				<span class="tok-n">msg</span> <span class="tok-o">=</span> <span class="tok-n">g</span><span class="tok-o">.</span><span class="tok-na">message</span><span class="tok-o">(</span><span class="tok-nl">code:</span> <span class="tok-s2">&quot;springSecurity.errors.login.expired&quot;</span><span class="tok-o">)</span>
			<span class="tok-o">}</span>
			<span class="tok-k">else</span> <span class="tok-nf">if</span> <span class="tok-o">(</span><span class="tok-n">exception</span> <span class="tok-k">instanceof</span> <span class="tok-n">CredentialsExpiredException</span><span class="tok-o">)</span> <span class="tok-o">{</span>
				<span class="tok-n">msg</span> <span class="tok-o">=</span> <span class="tok-n">g</span><span class="tok-o">.</span><span class="tok-na">message</span><span class="tok-o">(</span><span class="tok-nl">code:</span> <span class="tok-s2">&quot;springSecurity.errors.login.passwordExpired&quot;</span><span class="tok-o">)</span>
			<span class="tok-o">}</span>
			<span class="tok-k">else</span> <span class="tok-nf">if</span> <span class="tok-o">(</span><span class="tok-n">exception</span> <span class="tok-k">instanceof</span> <span class="tok-n">DisabledException</span><span class="tok-o">)</span> <span class="tok-o">{</span>
				<span class="tok-n">msg</span> <span class="tok-o">=</span> <span class="tok-n">g</span><span class="tok-o">.</span><span class="tok-na">message</span><span class="tok-o">(</span><span class="tok-nl">code:</span> <span class="tok-s2">&quot;springSecurity.errors.login.disabled&quot;</span><span class="tok-o">)</span>
			<span class="tok-o">}</span>
			<span class="tok-k">else</span> <span class="tok-nf">if</span> <span class="tok-o">(</span><span class="tok-n">exception</span> <span class="tok-k">instanceof</span> <span class="tok-n">LockedException</span><span class="tok-o">)</span> <span class="tok-o">{</span>
				<span class="tok-n">msg</span> <span class="tok-o">=</span> <span class="tok-n">g</span><span class="tok-o">.</span><span class="tok-na">message</span><span class="tok-o">(</span><span class="tok-nl">code:</span> <span class="tok-s2">&quot;springSecurity.errors.login.locked&quot;</span><span class="tok-o">)</span>
			<span class="tok-o">}</span>
			<span class="tok-k">else</span> <span class="tok-o">{</span>
				<span class="tok-n">msg</span> <span class="tok-o">=</span> <span class="tok-n">g</span><span class="tok-o">.</span><span class="tok-na">message</span><span class="tok-o">(</span><span class="tok-nl">code:</span> <span class="tok-s2">&quot;springSecurity.errors.login.fail&quot;</span><span class="tok-o">)</span>
			<span class="tok-o">}</span>
		<span class="tok-o">}</span>

		<span class="tok-k">if</span> <span class="tok-o">(</span><span class="tok-n">springSecurityService</span><span class="tok-o">.</span><span class="tok-na">isAjax</span><span class="tok-o">(</span><span class="tok-n">request</span><span class="tok-o">))</span> <span class="tok-o">{</span>
			<span class="tok-n">render</span><span class="tok-o">([</span><span class="tok-nl">error:</span> <span class="tok-n">msg</span><span class="tok-o">]</span> <span class="tok-k">as</span> <span class="tok-n">JSON</span><span class="tok-o">)</span>
		<span class="tok-o">}</span>
		<span class="tok-k">else</span> <span class="tok-o">{</span>
			<span class="tok-n">flash</span><span class="tok-o">.</span><span class="tok-na">message</span> <span class="tok-o">=</span> <span class="tok-n">msg</span>
			<span class="tok-n">redirect</span> <span class="tok-nl">action:</span> <span class="tok-s1">&#39;auth&#39;</span><span class="tok-o">,</span> <span class="tok-nl">params:</span> <span class="tok-n">params</span>
		<span class="tok-o">}</span>
	<span class="tok-o">}</span>

	<span class="tok-cm">/**</span>
<span class="tok-cm">	 * The Ajax success redirect url.</span>
<span class="tok-cm">	 */</span>
	<span class="tok-kt">def</span> <span class="tok-nf">ajaxSuccess</span><span class="tok-o">()</span> <span class="tok-o">{</span>
		<span class="tok-n">render</span><span class="tok-o">([</span><span class="tok-nl">success:</span> <span class="tok-kc">true</span><span class="tok-o">,</span> <span class="tok-nl">username:</span> <span class="tok-n">springSecurityService</span><span class="tok-o">.</span><span class="tok-na">authentication</span><span class="tok-o">.</span><span class="tok-na">name</span><span class="tok-o">]</span> <span class="tok-k">as</span> <span class="tok-n">JSON</span><span class="tok-o">)</span>
	<span class="tok-o">}</span>

	<span class="tok-cm">/**</span>
<span class="tok-cm">	 * The Ajax denied redirect url.</span>
<span class="tok-cm">	 */</span>
	<span class="tok-kt">def</span> <span class="tok-nf">ajaxDenied</span><span class="tok-o">()</span> <span class="tok-o">{</span>
		<span class="tok-n">render</span><span class="tok-o">([</span><span class="tok-nl">error:</span> <span class="tok-s1">&#39;access denied&#39;</span><span class="tok-o">]</span> <span class="tok-k">as</span> <span class="tok-n">JSON</span><span class="tok-o">)</span>
	<span class="tok-o">}</span>
<span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-kn">package</span> <span class="tok-n">grails</span><span class="tok-o">.</span><span class="tok-na">plugin</span><span class="tok-o">.</span><span class="tok-na">springsecurity</span>

<span class="tok-kn">import</span> <span class="tok-nn">javax.servlet.http.HttpServletResponse</span>

<span class="tok-kn">import</span> <span class="tok-nn">org.springframework.security.access.annotation.Secured</span>

<span class="tok-nd">@Secured</span><span class="tok-o">(</span><span class="tok-s1">&#39;permitAll&#39;</span><span class="tok-o">)</span>
<span class="tok-kd">class</span> <span class="tok-nc">LogoutController</span> <span class="tok-o">{</span>

	<span class="tok-cm">/**</span>
<span class="tok-cm">	 * Index action. Redirects to the Spring security logout uri.</span>
<span class="tok-cm">	 */</span>
	<span class="tok-kt">def</span> <span class="tok-nf">index</span><span class="tok-o">()</span> <span class="tok-o">{</span>

		<span class="tok-k">if</span> <span class="tok-o">(!</span><span class="tok-n">request</span><span class="tok-o">.</span><span class="tok-na">post</span> <span class="tok-o">&amp;&amp;</span> <span class="tok-n">SpringSecurityUtils</span><span class="tok-o">.</span><span class="tok-na">getSecurityConfig</span><span class="tok-o">().</span><span class="tok-na">logout</span><span class="tok-o">.</span><span class="tok-na">postOnly</span><span class="tok-o">)</span> <span class="tok-o">{</span>
			<span class="tok-n">response</span><span class="tok-o">.</span><span class="tok-na">sendError</span> <span class="tok-n">HttpServletResponse</span><span class="tok-o">.</span><span class="tok-na">SC_METHOD_NOT_ALLOWED</span> <span class="tok-c1">// 405</span>
			<span class="tok-k">return</span>
		<span class="tok-o">}</span>

		<span class="tok-c1">// TODO put any pre-logout code here</span>
		<span class="tok-n">redirect</span> <span class="tok-nl">uri:</span> <span class="tok-n">SpringSecurityUtils</span><span class="tok-o">.</span><span class="tok-na">securityConfig</span><span class="tok-o">.</span><span class="tok-na">logout</span><span class="tok-o">.</span><span class="tok-na">filterProcessesUrl</span> <span class="tok-c1">// &#39;/j_spring_security_logout&#39;</span>
	<span class="tok-o">}</span>
<span class="tok-o">}</span></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_librerÃ­as_adicionales">7.6. LibrerÃ­as adicionales</h3>
<div class="paragraph">
<p>El plugin de Spring Security viene ademÃ¡s con una serie de librerÃ­as accesibles en forma de etiquetas o servicio. Veamos cada uno de ellos.</p>
</div>
<div class="sect3">
<h4 id="_librerÃ­a_de_etiquetas_securitytaglib">7.6.1. LibrerÃ­a de etiquetas: SecurityTagLib</h4>
<div class="paragraph">
<p>Con esta librerÃ­a podremos insertar en nuestros archivos GSPs comprobaciones del tipo, Â¿el usuario estÃ¡ identificado? o Â¿tiene los permisos necesarios para ver esto?</p>
</div>
<div class="sect4">
<h5 id="_ifloggedin">ifLoggedIn</h5>
<div class="paragraph">
<p>Muestra el contenido del cuerpo que pongamos dentro de esta etiqueta siempre que el usuario estÃ© autenticado en el sistema.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-o">&lt;</span><span class="tok-nl">sec:</span><span class="tok-n">ifLoggedIn</span><span class="tok-o">&gt;</span>
	<span class="tok-n">Welcome</span> <span class="tok-n">Back</span><span class="tok-o">!</span>
<span class="tok-o">&lt;/</span><span class="tok-nl">sec:</span><span class="tok-n">ifLoggedIn</span><span class="tok-o">&gt;</span></code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_ifnotloggedin">ifNotLoggedIn</h5>
<div class="paragraph">
<p>Muestra el contenido del cuerpo que pongamos dentro de esta etiqueta siempre que el usuario no estÃ© autenticado en el sistema.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-o">&lt;</span><span class="tok-nl">sec:</span><span class="tok-n">ifNotLoggedIn</span><span class="tok-o">&gt;</span>
	<span class="tok-o">&lt;</span><span class="tok-nl">g:</span><span class="tok-n">link</span> <span class="tok-n">controller</span><span class="tok-o">=</span><span class="tok-s1">&#39;login&#39;</span> <span class="tok-n">action</span><span class="tok-o">=</span><span class="tok-s1">&#39;auth&#39;</span><span class="tok-o">&gt;</span>
		<span class="tok-n">Login</span>
	<span class="tok-o">&lt;</span><span class="tok-s">/g:link&gt;</span>
<span class="tok-s">&lt;/</span><span class="tok-nl">sec:</span><span class="tok-n">ifNotLoggedIn</span><span class="tok-o">&gt;</span></code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_ifallgranted">ifAllGranted</h5>
<div class="paragraph">
<p>Muestra el contenido del cuerpo que pongamos dentro de esta etiqueta siempre que el usuario tenga todos los roles pasados por parÃ¡metro.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-o">&lt;</span><span class="tok-nl">sec:</span><span class="tok-n">ifAllGranted</span> <span class="tok-n">roles</span><span class="tok-o">=</span><span class="tok-s2">&quot;ROLE_ADMIN,ROLE_SUPERVISOR&quot;</span><span class="tok-o">&gt;</span><span class="tok-n">secure</span> <span class="tok-n">stuff</span> <span class="tok-n">here</span><span class="tok-o">&lt;/</span><span class="tok-nl">sec:</span><span class="tok-n">ifAllGranted</span><span class="tok-o">&gt;</span></code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_ifanygranted">ifAnyGranted</h5>
<div class="paragraph">
<p>Muestra el contenido del cuerpo que pongamos dentro de esta etiqueta siempre que el usuario tenga al menos uno de los roles pasados por parÃ¡metro.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-o">&lt;</span><span class="tok-nl">sec:</span><span class="tok-n">ifAnyGranted</span> <span class="tok-n">roles</span><span class="tok-o">=</span><span class="tok-s2">&quot;ROLE_ADMIN,ROLE_SUPERVISOR&quot;</span><span class="tok-o">&gt;</span><span class="tok-n">secure</span> <span class="tok-n">stuff</span> <span class="tok-n">here</span><span class="tok-o">&lt;/</span><span class="tok-nl">sec:</span><span class="tok-n">ifAnyGranted</span><span class="tok-o">&gt;</span></code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_ifnotgranted">ifNotGranted</h5>
<div class="paragraph">
<p>Muestra el contenido del cuerpo que pongamos dentro de esta etiqueta siempre que el usuario no tenga asignado ninguno de los roles pasados por parÃ¡metro.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-o">&lt;</span><span class="tok-nl">sec:</span><span class="tok-n">ifNotGranted</span> <span class="tok-n">roles</span><span class="tok-o">=</span><span class="tok-s2">&quot;ROLE_USER&quot;</span><span class="tok-o">&gt;</span><span class="tok-n">non</span><span class="tok-o">-</span><span class="tok-n">user</span> <span class="tok-n">stuff</span> <span class="tok-n">here</span><span class="tok-o">&lt;/</span><span class="tok-nl">sec:</span><span class="tok-n">ifNotGranted</span><span class="tok-o">&gt;</span></code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_loggedinuserinfo">loggedInUserInfo</h5>
<div class="paragraph">
<p>Muestra el valor del campo especificado por parÃ¡metro del usuario identificado en el sistema.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-o">&lt;</span><span class="tok-nl">sec:</span><span class="tok-n">loggedInUserInfo</span> <span class="tok-n">field</span><span class="tok-o">=</span><span class="tok-s2">&quot;username&quot;</span><span class="tok-o">/&gt;</span></code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_username">username</h5>
<div class="paragraph">
<p>Muestra el nombre de usuario del usuario autenticado en el sistema</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-o">&lt;</span><span class="tok-nl">sec:</span><span class="tok-n">ifLoggedIn</span><span class="tok-o">&gt;</span>
	<span class="tok-n">Welcome</span> <span class="tok-n">Back</span> <span class="tok-o">&lt;</span><span class="tok-nl">sec:</span><span class="tok-n">username</span><span class="tok-s">/&gt;!</span>
<span class="tok-s">&lt;/</span><span class="tok-nl">sec:</span><span class="tok-n">ifLoggedIn</span><span class="tok-o">&gt;</span>
<span class="tok-o">&lt;</span><span class="tok-nl">sec:</span><span class="tok-n">ifNotLoggedIn</span><span class="tok-o">&gt;</span>
	<span class="tok-o">&lt;</span><span class="tok-nl">g:</span><span class="tok-n">link</span> <span class="tok-n">controller</span><span class="tok-o">=</span><span class="tok-s1">&#39;login&#39;</span> <span class="tok-n">action</span><span class="tok-o">=</span><span class="tok-s1">&#39;auth&#39;</span><span class="tok-o">&gt;</span><span class="tok-n">Login</span><span class="tok-o">&lt;</span><span class="tok-s">/g:link&gt;</span>
<span class="tok-s">&lt;/</span><span class="tok-nl">sec:</span><span class="tok-n">ifNotLoggedIn</span><span class="tok-o">&gt;</span></code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_access">access</h5>
<div class="paragraph">
<p>Muestra el contenido del cuerpo que pongamos dentro de esta etiqueta siempre que la expresiÃ³n se evalÃºe a cierto o el usuario tenga acceso a la url pasada por parÃ¡metro.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-o">&lt;</span><span class="tok-nl">sec:</span><span class="tok-n">access</span> <span class="tok-n">expression</span><span class="tok-o">=</span><span class="tok-s2">&quot;hasRole(&#39;ROLE_USER&#39;)&quot;</span><span class="tok-o">&gt;</span>
	<span class="tok-n">You</span><span class="tok-s1">&#39;re a user</span>
<span class="tok-s1">&lt;/sec:access&gt;</span>

<span class="tok-s1">&lt;sec:access url=&quot;/admin/user&quot;&gt;</span>
<span class="tok-s1">	&lt;g:link controller=&#39;</span><span class="tok-n">admin</span><span class="tok-s1">&#39; action=&#39;</span><span class="tok-n">user</span><span class="tok-err">&#39;</span><span class="tok-o">&gt;</span><span class="tok-n">Manage</span> <span class="tok-n">Users</span><span class="tok-o">&lt;</span><span class="tok-s">/g:link&gt;</span>
<span class="tok-s">&lt;/</span><span class="tok-nl">sec:</span><span class="tok-n">access</span><span class="tok-o">&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Incluso podemos especificar el controlador y la acciÃ³n que queremos referenciar:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-o">&lt;</span><span class="tok-nl">sec:</span><span class="tok-n">access</span> <span class="tok-n">controller</span><span class="tok-o">=</span><span class="tok-s1">&#39;admin&#39;</span> <span class="tok-n">action</span><span class="tok-o">=</span><span class="tok-s1">&#39;user&#39;</span><span class="tok-o">&gt;</span>
	<span class="tok-o">&lt;</span><span class="tok-nl">g:</span><span class="tok-n">link</span> <span class="tok-n">controller</span><span class="tok-o">=</span><span class="tok-s1">&#39;admin&#39;</span> <span class="tok-n">action</span><span class="tok-o">=</span><span class="tok-s1">&#39;user&#39;</span><span class="tok-o">&gt;</span>
		<span class="tok-n">Manage</span> <span class="tok-n">Users</span>
	<span class="tok-o">&lt;</span><span class="tok-s">/g:link&gt;</span>
<span class="tok-s">&lt;/</span><span class="tok-nl">sec:</span><span class="tok-n">access</span><span class="tok-o">&gt;</span></code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_noaccess">noAccess</h5>
<div class="paragraph">
<p>Muestra el contenido del cuerpo que pongamos dentro de esta etiqueta siempre que la expresiÃ³n se evalÃºe a falso o el usuario no tenga acceso a la url pasada por parÃ¡metro.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-o">&lt;</span><span class="tok-nl">sec:</span><span class="tok-n">noAccess</span> <span class="tok-n">expression</span><span class="tok-o">=</span><span class="tok-s2">&quot;hasRole(&#39;ROLE_USER&#39;)&quot;</span><span class="tok-o">&gt;</span>
	<span class="tok-n">You</span><span class="tok-err">&#39;</span><span class="tok-n">re</span> <span class="tok-n">not</span> <span class="tok-n">a</span> <span class="tok-n">user</span>
<span class="tok-o">&lt;/</span><span class="tok-nl">sec:</span><span class="tok-n">noAccess</span><span class="tok-o">&gt;</span></code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_servicio_springsecurityservice">7.6.2. Servicio: SpringSecurityService</h4>
<div class="paragraph">
<p>El servicio <em>grails.plugin.springsecurity.SpringSecurityService</em> ofrece algunos mÃ©todos que podremos utilizar en los controladores u otros servicios simplemente inyectÃ¡ndolos debidamente.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-kt">def</span> <span class="tok-n">springSecurityService</span></code></pre>
</div>
</div>
<div class="sect4">
<h5 id="_getcurrentuser">getCurrentUser()</h5>
<div class="paragraph">
<p>Obtiene una instancia de las clase de dominio correspondiente al usuario autenticado en el sistema.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-kd">class</span> <span class="tok-nc">SomeController</span> <span class="tok-o">{</span>
   <span class="tok-kt">def</span> <span class="tok-n">springSecurityService</span>

   <span class="tok-kt">def</span> <span class="tok-nf">someAction</span><span class="tok-o">()</span> <span class="tok-o">{</span>
      <span class="tok-kt">def</span> <span class="tok-n">user</span> <span class="tok-o">=</span> <span class="tok-n">springSecurityService</span><span class="tok-o">.</span><span class="tok-na">currentUser</span>
      <span class="tok-o">...</span>
   <span class="tok-o">}</span>
<span class="tok-o">}</span></code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_isloggedin">isLoggedIn()</h5>
<div class="paragraph">
<p>Comprueba si el usuario estÃ¡ autenticado en el sistema</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-kd">class</span> <span class="tok-nc">SomeController</span> <span class="tok-o">{</span>
   <span class="tok-kt">def</span> <span class="tok-n">springSecurityService</span>

   <span class="tok-kt">def</span> <span class="tok-nf">someAction</span><span class="tok-o">()</span> <span class="tok-o">{</span>
      <span class="tok-k">if</span> <span class="tok-o">(</span><span class="tok-n">springSecurityService</span><span class="tok-o">.</span><span class="tok-na">isLoggedIn</span><span class="tok-o">())</span> <span class="tok-o">{</span>
         <span class="tok-o">...</span>
      <span class="tok-o">}</span>
      <span class="tok-k">else</span> <span class="tok-o">{</span>
         <span class="tok-o">...</span>
      <span class="tok-o">}</span>
   <span class="tok-o">}</span>
<span class="tok-o">}</span></code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_getauthentication">getAuthentication()</h5>
<div class="paragraph">
<p>Obtiene los datos del usuario autenticado en el sistema</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-kd">class</span> <span class="tok-nc">SomeController</span> <span class="tok-o">{</span>
   <span class="tok-kt">def</span> <span class="tok-n">springSecurityService</span>

   <span class="tok-kt">def</span> <span class="tok-nf">someAction</span><span class="tok-o">()</span> <span class="tok-o">{</span>
      <span class="tok-kt">def</span> <span class="tok-n">auth</span> <span class="tok-o">=</span> <span class="tok-n">springSecurityService</span><span class="tok-o">.</span><span class="tok-na">authentication</span>
      <span class="tok-n">String</span> <span class="tok-n">username</span> <span class="tok-o">=</span> <span class="tok-n">auth</span><span class="tok-o">.</span><span class="tok-na">username</span>
      <span class="tok-kt">def</span> <span class="tok-n">authorities</span> <span class="tok-o">=</span> <span class="tok-n">auth</span><span class="tok-o">.</span><span class="tok-na">authorities</span> <span class="tok-c1">// a Collection of GrantedAuthority</span>
      <span class="tok-kt">boolean</span> <span class="tok-n">authenticated</span> <span class="tok-o">=</span> <span class="tok-n">auth</span><span class="tok-o">.</span><span class="tok-na">authenticated</span>
      <span class="tok-o">...</span>
   <span class="tok-o">}</span>
<span class="tok-o">}</span></code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_getprincipal">getPrincipal()</h5>
<div class="paragraph">
<p>Obtiene los datos del usuario autenticado en el sistema</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-kd">class</span> <span class="tok-nc">SomeController</span> <span class="tok-o">{</span>
   <span class="tok-kt">def</span> <span class="tok-n">springSecurityService</span>

   <span class="tok-kt">def</span> <span class="tok-nf">someAction</span><span class="tok-o">()</span> <span class="tok-o">{</span>
      <span class="tok-kt">def</span> <span class="tok-n">principal</span> <span class="tok-o">=</span> <span class="tok-n">springSecurityService</span><span class="tok-o">.</span><span class="tok-na">principal</span>
      <span class="tok-n">String</span> <span class="tok-n">username</span> <span class="tok-o">=</span> <span class="tok-n">principal</span><span class="tok-o">.</span><span class="tok-na">username</span>
      <span class="tok-kt">def</span> <span class="tok-n">authorities</span> <span class="tok-o">=</span> <span class="tok-n">principal</span><span class="tok-o">.</span><span class="tok-na">authorities</span> <span class="tok-c1">// a Collection of GrantedAuthority</span>
      <span class="tok-kt">boolean</span> <span class="tok-n">enabled</span> <span class="tok-o">=</span> <span class="tok-n">principal</span><span class="tok-o">.</span><span class="tok-na">enabled</span>
      <span class="tok-err">â¦</span>
   <span class="tok-o">}</span>
<span class="tok-o">}</span></code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_encodepassword">encodePassword()</h5>
<div class="paragraph">
<p>Codifica la contraseÃ±a a partir del esquema de encriptaciÃ³n configurado. Por defecto, se utiliza el mÃ©todo SHA-256, pero Ã©ste se puede modificar en el archivo de configuraciÃ³n <em>Config.groovy</em> especificando el parÃ¡metro <em>grails.plugin.springsecurity.password.algorithm</em>, pudiendo utilizar cualquiera de los valores comentados en esta pÃ¡gina de Java: <a href="http://docs.oracle.com/javase/7/docs/technotes/guides/security/crypto/CryptoSpec.html#Architecture" class="bare">http://docs.oracle.com/javase/7/docs/technotes/guides/security/crypto/CryptoSpec.html#Architecture</a>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-kd">class</span> <span class="tok-nc">PersonController</span> <span class="tok-o">{</span>
   <span class="tok-kt">def</span> <span class="tok-n">springSecurityService</span>

   <span class="tok-kt">def</span> <span class="tok-nf">updateAction</span><span class="tok-o">()</span> <span class="tok-o">{</span>
      <span class="tok-kt">def</span> <span class="tok-n">person</span> <span class="tok-o">=</span> <span class="tok-n">Person</span><span class="tok-o">.</span><span class="tok-na">get</span><span class="tok-o">(</span><span class="tok-n">params</span><span class="tok-o">.</span><span class="tok-na">id</span><span class="tok-o">)</span>

      <span class="tok-n">params</span><span class="tok-o">.</span><span class="tok-na">salt</span> <span class="tok-o">=</span> <span class="tok-n">person</span><span class="tok-o">.</span><span class="tok-na">salt</span>
      <span class="tok-k">if</span> <span class="tok-o">(</span><span class="tok-n">person</span><span class="tok-o">.</span><span class="tok-na">password</span> <span class="tok-o">!=</span> <span class="tok-n">params</span><span class="tok-o">.</span><span class="tok-na">password</span><span class="tok-o">)</span> <span class="tok-o">{</span>
         <span class="tok-n">params</span><span class="tok-o">.</span><span class="tok-na">password</span> <span class="tok-o">=</span> <span class="tok-n">springSecurityService</span><span class="tok-o">.</span><span class="tok-na">encodePassword</span><span class="tok-o">(</span><span class="tok-n">password</span><span class="tok-o">,</span> <span class="tok-n">salt</span><span class="tok-o">)</span>
         <span class="tok-kt">def</span> <span class="tok-n">salt</span> <span class="tok-o">=</span> <span class="tok-err">â¦</span> <span class="tok-c1">// e.g. randomly generated using some utility method</span>
         <span class="tok-n">params</span><span class="tok-o">.</span><span class="tok-na">salt</span> <span class="tok-o">=</span> <span class="tok-n">salt</span>
      <span class="tok-o">}</span>
      <span class="tok-n">person</span><span class="tok-o">.</span><span class="tok-na">properties</span> <span class="tok-o">=</span> <span class="tok-n">params</span>
      <span class="tok-k">if</span> <span class="tok-o">(!</span><span class="tok-n">person</span><span class="tok-o">.</span><span class="tok-na">save</span><span class="tok-o">(</span><span class="tok-nl">flush:</span> <span class="tok-kc">true</span><span class="tok-o">))</span> <span class="tok-o">{</span>
         <span class="tok-n">render</span> <span class="tok-nl">view:</span> <span class="tok-s1">&#39;edit&#39;</span><span class="tok-o">,</span> <span class="tok-nl">model:</span> <span class="tok-o">[</span><span class="tok-nl">person:</span> <span class="tok-n">person</span><span class="tok-o">]</span>
         <span class="tok-k">return</span>
      <span class="tok-o">}</span>
      <span class="tok-n">redirect</span> <span class="tok-nl">action:</span> <span class="tok-s1">&#39;show&#39;</span><span class="tok-o">,</span> <span class="tok-nl">id:</span> <span class="tok-n">person</span><span class="tok-o">.</span><span class="tok-na">id</span>
   <span class="tok-o">}</span>
<span class="tok-o">}</span></code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_updaterole">updateRole()</h5>
<div class="paragraph">
<p>Actualiza un rol, y en caso de que estemos utilizando el mÃ©todo <em>RequestMap</em>, tambiÃ©n actualizarÃ¡ el nombre del rol en todas las instancias de la base de datos.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-kd">class</span> <span class="tok-nc">RoleController</span> <span class="tok-o">{</span>
   <span class="tok-kt">def</span> <span class="tok-n">springSecurityService</span>

   <span class="tok-kt">def</span> <span class="tok-nf">update</span><span class="tok-o">()</span> <span class="tok-o">{</span>
      <span class="tok-kt">def</span> <span class="tok-n">roleInstance</span> <span class="tok-o">=</span> <span class="tok-n">Role</span><span class="tok-o">.</span><span class="tok-na">get</span><span class="tok-o">(</span><span class="tok-n">params</span><span class="tok-o">.</span><span class="tok-na">id</span><span class="tok-o">)</span>
      <span class="tok-k">if</span> <span class="tok-o">(!</span><span class="tok-n">springSecurityService</span><span class="tok-o">.</span><span class="tok-na">updateRole</span><span class="tok-o">(</span><span class="tok-n">roleInstance</span><span class="tok-o">,</span> <span class="tok-n">params</span><span class="tok-o">))</span> <span class="tok-o">{</span>
         <span class="tok-n">render</span> <span class="tok-nl">view:</span> <span class="tok-s1">&#39;edit&#39;</span><span class="tok-o">,</span> <span class="tok-nl">model:</span> <span class="tok-o">[</span><span class="tok-nl">roleInstance:</span> <span class="tok-n">roleInstance</span><span class="tok-o">]</span>
         <span class="tok-k">return</span>
      <span class="tok-o">}</span>

      <span class="tok-n">flash</span><span class="tok-o">.</span><span class="tok-na">message</span> <span class="tok-o">=</span> <span class="tok-s2">&quot;The role was updated&quot;</span>
      <span class="tok-n">redirect</span> <span class="tok-nl">action:</span> <span class="tok-n">show</span><span class="tok-o">,</span> <span class="tok-nl">id:</span> <span class="tok-n">roleInstance</span><span class="tok-o">.</span><span class="tok-na">id</span>
   <span class="tok-o">}</span>
<span class="tok-o">}</span></code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_deleterole">deleteRole()</h5>
<div class="paragraph">
<p>Elimina un rol, y en caso de que estemos utilizando el mÃ©todo <em>Requestmap</em>, tambiÃ©n lo eliminarÃ¡ de aquellas instancias donde estuviera especificado.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-kd">class</span> <span class="tok-nc">RoleController</span> <span class="tok-o">{</span>
   <span class="tok-kt">def</span> <span class="tok-n">springSecurityService</span>

   <span class="tok-kt">def</span> <span class="tok-nf">delete</span><span class="tok-o">()</span> <span class="tok-o">{</span>
      <span class="tok-kt">def</span> <span class="tok-n">roleInstance</span> <span class="tok-o">=</span> <span class="tok-n">Role</span><span class="tok-o">.</span><span class="tok-na">get</span><span class="tok-o">(</span><span class="tok-n">params</span><span class="tok-o">.</span><span class="tok-na">id</span><span class="tok-o">)</span>
      <span class="tok-k">try</span> <span class="tok-o">{</span>
         <span class="tok-n">springSecurityService</span><span class="tok-o">.</span><span class="tok-na">deleteRole</span> <span class="tok-o">(</span><span class="tok-n">roleInstance</span>
         <span class="tok-n">flash</span><span class="tok-o">.</span><span class="tok-na">message</span> <span class="tok-o">=</span> <span class="tok-s2">&quot;The role was deleted&quot;</span>
         <span class="tok-n">redirect</span> <span class="tok-nl">action:</span> <span class="tok-n">list</span>
      <span class="tok-o">}</span>
      <span class="tok-k">catch</span> <span class="tok-o">(</span><span class="tok-n">DataIntegrityViolationException</span> <span class="tok-n">e</span><span class="tok-o">)</span> <span class="tok-o">{</span>
         <span class="tok-n">flash</span><span class="tok-o">.</span><span class="tok-na">message</span> <span class="tok-o">=</span> <span class="tok-s2">&quot;Unable to delete the role&quot;</span>
         <span class="tok-n">redirect</span> <span class="tok-nl">action:</span> <span class="tok-n">show</span><span class="tok-o">,</span> <span class="tok-nl">id:</span> <span class="tok-n">params</span><span class="tok-o">.</span><span class="tok-na">id</span>
      <span class="tok-o">}</span>
   <span class="tok-o">}</span>
<span class="tok-o">}</span></code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_clearcachedrequestmaps">clearCachedRequestmaps()</h5>
<div class="paragraph">
<p>Este mÃ©todo fuerza una actualizaciÃ³n de toda la cachÃ© referente al sistema de autenticaciÃ³n de nuestra aplicaciÃ³n. Siempre que creemos, modifiquemos o eliminemos una instancia de la clase <em>RequestMap</em> debemos invocar este mÃ©todo. En los mÃ©todos <em>updateRole()</em> y <em>deleteRole()</em> ya se llama automÃ¡ticamente al mÃ©todo <em>clearCachedRequestmaps()</em> para que nosotros no tengamos que preocuparnos.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-kd">class</span> <span class="tok-nc">RequestmapController</span> <span class="tok-o">{</span>
   <span class="tok-kt">def</span> <span class="tok-n">springSecurityService</span>

   <span class="tok-kt">def</span> <span class="tok-nf">save</span><span class="tok-o">()</span> <span class="tok-o">{</span>
      <span class="tok-kt">def</span> <span class="tok-n">requestmapInstance</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">Requestmap</span><span class="tok-o">(</span><span class="tok-n">params</span><span class="tok-o">)</span>
      <span class="tok-k">if</span> <span class="tok-o">(!</span><span class="tok-n">requestmapInstance</span><span class="tok-o">.</span><span class="tok-na">save</span><span class="tok-o">(</span><span class="tok-nl">flush:</span> <span class="tok-kc">true</span><span class="tok-o">))</span> <span class="tok-o">{</span>
         <span class="tok-n">render</span> <span class="tok-nl">view:</span> <span class="tok-s1">&#39;create&#39;</span><span class="tok-o">,</span> <span class="tok-nl">model:</span> <span class="tok-o">[</span><span class="tok-nl">requestmapInstance:</span> <span class="tok-n">requestmapInstance</span><span class="tok-o">]</span>
         <span class="tok-k">return</span>
      <span class="tok-o">}</span>

      <span class="tok-n">springSecurityService</span><span class="tok-o">.</span><span class="tok-na">clearCachedRequestmaps</span><span class="tok-o">()</span>
      <span class="tok-n">flash</span><span class="tok-o">.</span><span class="tok-na">message</span> <span class="tok-o">=</span> <span class="tok-s2">&quot;Requestmap created&quot;</span>
      <span class="tok-n">redirect</span> <span class="tok-nl">action:</span> <span class="tok-n">show</span><span class="tok-o">,</span> <span class="tok-nl">id:</span> <span class="tok-n">requestmapInstance</span><span class="tok-o">.</span><span class="tok-na">id</span>
   <span class="tok-o">}</span>
<span class="tok-o">}</span></code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_reauthenticate">reauthenticate()</h5>
<div class="paragraph">
<p>Este mÃ©todo renueva los datos de la autenticaciÃ³n del usuario. Esto se debe hacer despuÃ©s de que se actualicen los roles de un usuario.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-kd">class</span> <span class="tok-nc">UserController</span> <span class="tok-o">{</span>
   <span class="tok-kt">def</span> <span class="tok-n">springSecurityService</span>

   <span class="tok-kt">def</span> <span class="tok-nf">update</span><span class="tok-o">()</span> <span class="tok-o">{</span>
      <span class="tok-kt">def</span> <span class="tok-n">userInstance</span> <span class="tok-o">=</span> <span class="tok-n">User</span><span class="tok-o">.</span><span class="tok-na">get</span><span class="tok-o">(</span><span class="tok-n">params</span><span class="tok-o">.</span><span class="tok-na">id</span><span class="tok-o">)</span>

      <span class="tok-n">params</span><span class="tok-o">.</span><span class="tok-na">salt</span> <span class="tok-o">=</span> <span class="tok-n">person</span><span class="tok-o">.</span><span class="tok-na">salt</span>
      <span class="tok-k">if</span> <span class="tok-o">(</span><span class="tok-n">params</span><span class="tok-o">.</span><span class="tok-na">password</span><span class="tok-o">)</span> <span class="tok-o">{</span>
         <span class="tok-n">params</span><span class="tok-o">.</span><span class="tok-na">password</span> <span class="tok-o">=</span> <span class="tok-n">springSecurityService</span><span class="tok-o">.</span><span class="tok-na">encodePassword</span><span class="tok-o">(</span><span class="tok-n">params</span><span class="tok-o">.</span><span class="tok-na">password</span><span class="tok-o">,</span> <span class="tok-n">salt</span><span class="tok-o">)</span>
         <span class="tok-kt">def</span> <span class="tok-n">salt</span> <span class="tok-o">=</span> <span class="tok-err">â¦</span> <span class="tok-c1">// e.g. randomly generated using some utility method</span>
         <span class="tok-n">params</span><span class="tok-o">.</span><span class="tok-na">salt</span> <span class="tok-o">=</span> <span class="tok-n">salt</span>
      <span class="tok-o">}</span>
      <span class="tok-n">userInstance</span><span class="tok-o">.</span><span class="tok-na">properties</span> <span class="tok-o">=</span> <span class="tok-n">params</span>
      <span class="tok-k">if</span> <span class="tok-o">(!</span><span class="tok-n">userInstance</span><span class="tok-o">.</span><span class="tok-na">save</span><span class="tok-o">(</span><span class="tok-nl">flush:</span> <span class="tok-kc">true</span><span class="tok-o">))</span> <span class="tok-o">{</span>
         <span class="tok-n">render</span> <span class="tok-nl">view:</span> <span class="tok-s1">&#39;edit&#39;</span><span class="tok-o">,</span> <span class="tok-nl">model:</span> <span class="tok-o">[</span><span class="tok-nl">userInstance:</span> <span class="tok-n">userInstance</span><span class="tok-o">]</span>
         <span class="tok-k">return</span>
      <span class="tok-o">}</span>

      <span class="tok-k">if</span> <span class="tok-o">(</span><span class="tok-n">springSecurityService</span><span class="tok-o">.</span><span class="tok-na">loggedIn</span> <span class="tok-o">&amp;&amp;</span>
             <span class="tok-n">springSecurityService</span><span class="tok-o">.</span><span class="tok-na">principal</span><span class="tok-o">.</span><span class="tok-na">username</span> <span class="tok-o">==</span> <span class="tok-n">userInstance</span><span class="tok-o">.</span><span class="tok-na">username</span><span class="tok-o">)</span> <span class="tok-o">{</span>
         <span class="tok-n">springSecurityService</span><span class="tok-o">.</span><span class="tok-na">reauthenticate</span> <span class="tok-n">userInstance</span><span class="tok-o">.</span><span class="tok-na">username</span>
      <span class="tok-o">}</span>

      <span class="tok-n">flash</span><span class="tok-o">.</span><span class="tok-na">message</span> <span class="tok-o">=</span> <span class="tok-s2">&quot;The user was updated&quot;</span>
      <span class="tok-n">redirect</span> <span class="tok-nl">action:</span> <span class="tok-n">show</span><span class="tok-o">,</span> <span class="tok-nl">id:</span> <span class="tok-n">userInstance</span><span class="tok-o">.</span><span class="tok-na">id</span>
   <span class="tok-o">}</span>
<span class="tok-o">}</span></code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_otros_aspectos_interesantes_de_spring_security">7.7. Otros aspectos interesantes de Spring Security</h3>
<div class="paragraph">
<p>El plugin de Spring Security es sin duda uno de los mÃ¡s completos de Grails y en la documentaciÃ³n oficial encontrarÃ¡s otros detalles del mismo. Sin embargo, aquÃ­ vamos a resaltar un par de ellos como son las restricciones por IP o la internacionalizaciÃ³n del plugin.</p>
</div>
<div class="sect3">
<h4 id="_restricciones_por_ip">7.7.1. Restricciones por IP</h4>
<div class="paragraph">
<p>En ocasiones nos puede interesar proporcionar una serie de restricciones por IP de tal forma que Ãºnicamente las peticiones que vengan de esta IP podrÃ¡n acceder al recurso. Esto lo debemos hacer en el archivo <em>Config.groovy</em> y este serÃ­a un ejemplo:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-n">grails</span><span class="tok-o">.</span><span class="tok-na">plugin</span><span class="tok-o">.</span><span class="tok-na">springsecurity</span><span class="tok-o">.</span><span class="tok-na">ipRestrictions</span> <span class="tok-o">=</span> <span class="tok-o">[</span>
   <span class="tok-s1">&#39;/pattern1/**&#39;</span><span class="tok-o">:</span> <span class="tok-s1">&#39;123.234.345.456&#39;</span><span class="tok-o">,</span>
   <span class="tok-s1">&#39;/pattern2/**&#39;</span><span class="tok-o">:</span> <span class="tok-s1">&#39;10.0.0.0/8&#39;</span><span class="tok-o">,</span>
   <span class="tok-s1">&#39;/pattern3/**&#39;</span><span class="tok-o">:</span> <span class="tok-o">[</span><span class="tok-s1">&#39;10.10.200.42&#39;</span><span class="tok-o">,</span> <span class="tok-s1">&#39;10.10.200.63&#39;</span><span class="tok-o">]</span>
<span class="tok-o">]</span></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_internacionalizaciÃ³n">7.7.2. InternacionalizaciÃ³n</h4>
<div class="paragraph">
<p>El plugin de Spring Security viene traducido al inglÃ©s y al francÃ©s (entre otros idiomas), asÃ­ que si necesitamos traducirlo al castellano por ejemplo, debemos crear las siguientes propiedades en el archivo de literales correspondiente:</p>
</div>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-center valign-middle">Propiedad</th>
<th class="tableblock halign-left valign-top">Valor por defecto en inglÃ©s</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-center valign-middle"><p class="tableblock">springSecurity.errors.login.expired</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Sorry, your account has expired</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-middle"><p class="tableblock">springSecurity.errors.login.passwordExpired</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Sorry, your password has expired.</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-middle"><p class="tableblock">springSecurity.errors.login.disabled</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Sorry, your password is disabled.</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-middle"><p class="tableblock">springSecurity.errors.login.locked</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Sorry, your account is locked.</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-middle"><p class="tableblock">springSecurity.errors.login.fail</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Sorry, we were not able to find a user with that username and password.</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-middle"><p class="tableblock">springSecurity.login.title</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Login</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-middle"><p class="tableblock">springSecurity.login.header</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Please Login..</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-middle"><p class="tableblock">springSecurity.login.button</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Login</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-middle"><p class="tableblock">springSecurity.login.username.label</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Username</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-middle"><p class="tableblock">springSecurity.login.password.label</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Password</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-middle"><p class="tableblock">springSecurity.login.remember.me.label</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Remember me</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-middle"><p class="tableblock">springSecurity.denied.title</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Denied</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-middle"><p class="tableblock">springSecurity.denied.message</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Sorry, you&#8217;re not authorized to view this page.</p></td>
</tr>
</tbody>
</table>
<div style="page-break-after: always;"></div>
</div>
</div>
<div class="sect2">
<h3 id="_ejercicios_7">7.8. Ejercicios</h3>
<div class="sect3">
<h4 id="_roles_y_usuarios_0_50_puntos">7.8.1. Roles y usuarios (0.50 puntos)</h4>
<div class="paragraph">
<p>En nuestra aplicaciÃ³n vamos a introducir dos tipos de usuarios: los administradores y los usuarios bÃ¡sicos. Los administradores serÃ¡n capaces de crear nuevos usuarios, etiquetas y categorÃ­as mientras que los usuarios bÃ¡sicos simplemente podrÃ¡n gestionar sus propias tareas.</p>
</div>
<div class="paragraph">
<p>Para ello introduce en el <em>Bootstrap.groovy</em> la creaciÃ³n de:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Dos roles (ROLE_ADMIN, ROLE_BASIC)</p>
</li>
<li>
<p>Un usuario administrador con nombre de usuario y contraseÃ±a "admin"</p>
</li>
<li>
<p>Un par de usuarios bÃ¡sicos con nombres de usuario y contraseÃ±as "usuario1" y "usuario2"</p>
</li>
<li>
<p>Asigna varias tareas a ambos usuarios bÃ¡sicos</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_modificar_plantillas_y_vistas_0_25_puntos">7.8.2. Modificar plantillas y vistas (0.25 puntos)</h4>
<div class="paragraph">
<p>En su momento creÃ¡bamos una plantilla llamada <em>header.gsp</em> que se renderiza en la parte superior de la aplicaciÃ³n y que bÃ¡sicamente <em>pinta</em> un enlace para que el usuario se pueda identificar en el sistema.</p>
</div>
<div class="paragraph">
<p>En este ejercicio vamos a modificar esta plantilla para especificar los enlaces correctos <em>/login/auth</em> para identificarse en el sistema y <em>/logout/index</em> para abandonar el mismo. Una cosa que debes tener en cuenta es que para abandonar el sistema, el plugin Spring Security sÃ³lo acepta el mÃ©todo POST, con lo que tendrÃ¡s que crear un botÃ³n dentro de un formulario para enviar esta peticiÃ³n utilizando el mÃ©todo adecuado. No olvides tambiÃ©n imprimir en la cabecera el nombre de usuario de la persona identificada en el sistema.</p>
</div>
<div class="paragraph">
<p>Por otro lado, vamos a modificar la pantalla inicial de la aplicaciÃ³n para mostrar el contenido de la misma en funciÃ³n del tipo de usuario identificado, es decir, los administradores verÃ¡n varios enlaces para mantener usuarios, etiquetas y categorÃ­as mientras que los usuarios bÃ¡sicos sÃ³lo podrÃ¡n mantener sus tareas.</p>
</div>
</div>
<div class="sect3">
<h4 id="_diferente_rol_diferentes_reglas_0_25_punto">7.8.3. Diferente rol, diferentes reglas (0.25 punto)</h4>
<div class="paragraph">
<p>Por Ãºltimo, ahora que la aplicaciÃ³n soporta varios roles, deberemos distinguir que rol tiene acceso a que partes de la aplicaciÃ³n. Como comentÃ¡bamos en el primer ejercicio, los administradores serÃ¡n los encargados de gestionar usuarios, etiquetas y categorÃ­as, mientras que los usuarios bÃ¡sicos sÃ³lo podrÃ¡n acceder a sus tareas. No olvides aÃ±adir reglas para los endpoints que aÃ±adÃ­amos cuando hablamos sobre servicios REST.</p>
</div>
<div class="paragraph">
<p>Tendremos que realizar una serie de cambios en nuestra aplicaciÃ³n para que al crear una tarea, Ã©sta sea asignada automÃ¡ticamente al usuario identificado en el sistema. Deberemos proceder de la misma forma con el listado de las tareas para que sÃ³lo se muestren al usuario sus propias tareas.</p>
</div>
<div class="paragraph">
<p>AdemÃ¡s, deberemos eliminar cualquier enlace presente en la aplicaciÃ³n que enlace a alguna parte que el usuario no deba tener acceso, como por ejemplo, la posibilidad de crear etiquetas desde la pÃ¡gina de creaciÃ³n de tareas.</p>
</div>
</div>
<div class="sect3">
<h4 id="_modificar_los_tests_unitarios_0_25_puntos">7.8.4. Modificar los tests unitarios (0.25 puntos)</h4>
<div class="paragraph">
<p>Si volvemos a ejecutar los tests unitarios, nos daremos cuenta de que acabamos de romper aquellos que creaban tareas y Ã©sto ha sido provocado por la introducciÃ³n de la relaciÃ³n entre las tareas y los usuarios.</p>
</div>
<div class="paragraph">
<p>Soluciona estos problemas en los tests <em>TodoSpec.groovy</em>, <em>TodoServiceSpec.groovy</em> y <em>TodoControllerSpec.groovy</em>.</p>
</div>
<div style="page-break-after: always;"></div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="sesion08">8. ConfiguraciÃ³n de aplicaciones. Plugins interesantes</h2>
<div class="sectionbody">
<div class="paragraph">
<p>En esta Ãºltima sesiÃ³n de Grails analizaremos los diferentes aspectos de configuraciÃ³n de nuestra aplicaciÃ³n y posteriormente instalaremos algunos plugins interesantes desarrollados por la comunidad de usuarios de Grails.</p>
</div>
<div class="sect2">
<h3 id="_configuraciÃ³n_de_aplicaciones">8.1. ConfiguraciÃ³n de aplicaciones</h3>
<div class="sect3">
<h4 id="_el_archivo_config_groovy">8.1.1. El archivo Config.groovy</h4>
<div class="paragraph">
<p>El archivo <em>grails-app/conf/Config.groovy</em> contiene los parÃ¡metros de configuraciÃ³n general de nuestra aplicaciÃ³n. En este archivo se pueden declarar variables que estarÃ¡n disponibles en cualquier artefacto de nuestra aplicaciÃ³n a travÃ©s del objeto global <em>grailsApplication.config</em>. Por ejemplo si definimos la siguiente variable <em>es.ua.expertojava.todo.miParametro = "dato"</em>, Ã©sta va a ser accesible desde cualquier controlador, vista, servicio, etc. mediante la expresiÃ³n <em>grailsApplication.config.es.ua.expertojava.todo.miParametro</em>.</p>
</div>
<div class="paragraph">
<p>AdemÃ¡s de poder declarar nuevas variables globales, el archivo <em>Config.groovy</em> utiliza una serie de variables definidas que tienen el siguiente significado:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><em>grails.config.locations</em>: ubicaciones donde encontrar otros archivos de configuraciÃ³n que se fundirÃ¡n con el principal <em>Config.groovy</em>. Esta variable estÃ¡ comentada por defecto con lo que sÃ³lo se tendrÃ¡ en cuenta el archivo <em>Config.groovy</em>.</p>
</li>
<li>
<p><em>grails.project.groupId</em>: nombre por defecto del paquete en el que se crean todos los artefactos de la aplicaciÃ³n. Por defecto tenemos que este paquete coincidirÃ¡ con el nombre de la aplicaciÃ³n. Lo podrÃ­amos modificar por ejemplo a "es.ua.expertojava.todo" para no ahorrarnos tener que especificar el paquete cada vez que creamos un nuevo artefacto.</p>
</li>
<li>
<p><em>grails.views.default.codec</em>: especifica el formato por defecto de nuestras pÃ¡ginas GSPs. Puede tomar el valor 'none', 'html', o 'base64'. Por defecto se utiliza el valor html.</p>
</li>
<li>
<p><em>grails.controllers.defaultScope</em>: el <em>scope</em> por defecto de los controladores, en principio <em>singleton</em>.</p>
</li>
<li>
<p><em>grails.views.gsp</em>: un mapa de configuraciÃ³n de como se van a renderizar nuestras pÃ¡ginas GSP.</p>
</li>
<li>
<p><em>grails.converters.encoding</em>: codificaciÃ³n de los convertidores</p>
</li>
<li>
<p><em>grails.scaffolding.templates.domainSuffix</em>: el sufijo aÃ±adido a las instancias de nuestras clases de dominio en el plugin <em>scaffolding</em>.</p>
</li>
<li>
<p><em>grails.mime.types</em>: indica un mapa con los posibles tipos mime soportados en nuestra aplicaciÃ³n</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_sistema_de_logs">8.1.2. Sistema de logs</h4>
<div class="paragraph">
<p>Grails utiliza la librerÃ­a <em>log4j</em> para implementar todo el sistema de logs. Podemos configurar estos logs de nuestras aplicaciones en el propio archivo <em>Config.groovy</em>. AquÃ­ encontraremos una variable llamada <em>log4j</em> que ya viene con algunas reglas.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-n">log4j</span><span class="tok-o">.</span><span class="tok-na">main</span> <span class="tok-o">=</span> <span class="tok-o">{</span>
    <span class="tok-n">error</span>  <span class="tok-s1">&#39;org.codehaus.groovy.grails.web.servlet&#39;</span><span class="tok-o">,</span>  <span class="tok-c1">//  controllers</span>
           <span class="tok-s1">&#39;org.codehaus.groovy.grails.web.pages&#39;</span><span class="tok-o">,</span> <span class="tok-c1">//  GSP</span>
           <span class="tok-s1">&#39;org.codehaus.groovy.grails.web.sitemesh&#39;</span><span class="tok-o">,</span> <span class="tok-c1">//  layouts</span>
           <span class="tok-s1">&#39;org.codehaus.groovy.grails.web.mapping.filter&#39;</span><span class="tok-o">,</span> <span class="tok-c1">// URL mapping</span>
           <span class="tok-s1">&#39;org.codehaus.groovy.grails.web.mapping&#39;</span><span class="tok-o">,</span> <span class="tok-c1">// URL mapping</span>
           <span class="tok-s1">&#39;org.codehaus.groovy.grails.commons&#39;</span><span class="tok-o">,</span> <span class="tok-c1">// core / classloading</span>
           <span class="tok-s1">&#39;org.codehaus.groovy.grails.plugins&#39;</span><span class="tok-o">,</span> <span class="tok-c1">// plugins</span>
           <span class="tok-s1">&#39;org.codehaus.groovy.grails.orm.hibernate&#39;</span><span class="tok-o">,</span> <span class="tok-c1">// hibernate integration</span>
           <span class="tok-s1">&#39;org.springframework&#39;</span><span class="tok-o">,</span>
           <span class="tok-s1">&#39;org.hibernate&#39;</span><span class="tok-o">,</span>
           <span class="tok-s1">&#39;net.sf.ehcache.hibernate&#39;</span>
<span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>En esta configuraciÃ³n se especifica que aquellos problemas surgidos a nivel <em>error</em> serÃ¡n aÃ±adidos al archivo de logs. Habitualmente tenemos ocho niveles estÃ¡ndar de logs.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>off</p>
</li>
<li>
<p>fatal</p>
</li>
<li>
<p>error</p>
</li>
<li>
<p>warn</p>
</li>
<li>
<p>info</p>
</li>
<li>
<p>debug</p>
</li>
<li>
<p>trace</p>
</li>
<li>
<p>all</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Esto significa que si por ejemplo especificamos <em>warn 'org.example.domain'</em>, todos los problemas surgidos de tipo <em>warn</em>, <em>error</em> o <em>fatal</em> serÃ¡n impresos en el archivo. Los otros niveles serÃ¡n ignorados.</p>
</div>
<div class="paragraph">
<p>Lo habitual es que necesitemos generar logs en controladores, servicios y otros artefactos. Estos artefactos se encuentran en el paquete <em>grails.app.&lt;tipo_de_artefacto&gt;.&lt;nombre_de_clase&gt;</em>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-n">log4j</span><span class="tok-o">.</span><span class="tok-na">main</span> <span class="tok-o">=</span> <span class="tok-o">{</span>
  <span class="tok-c1">// Establecemos el nivel info para todos los artefactos de la aplicaciÃ³n</span>
  <span class="tok-n">info</span> <span class="tok-s2">&quot;grails.app&quot;</span>

  <span class="tok-c1">// Especificamos el nivel debug para el controlador de la clase Tag</span>
  <span class="tok-n">debug</span> <span class="tok-s2">&quot;grails.app.controllers.es.ua.expertojava.todo.TagController&quot;</span>

  <span class="tok-c1">// Especificamos el nivel error para el servicio de la clase Todo</span>
  <span class="tok-n">error</span> <span class="tok-s2">&quot;grails.app.services.es.ua.expertojava.todo.TodoService&quot;</span>

  <span class="tok-c1">// Especificamos el nivel para todas las librerÃ­as de etiquetas</span>
  <span class="tok-n">info</span> <span class="tok-s2">&quot;grails.app.taglib&quot;</span>
<span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Los tipos de artefactos pueden ser los siguientes:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><em>conf</em>: para todo lo que estÃ© en el directorio de configuraciÃ³n <em>grails-app/con</em></p>
</li>
<li>
<p><em>filters</em>: para los filtros</p>
</li>
<li>
<p><em>taglib</em>: para las librerÃ­as de etiquetas</p>
</li>
<li>
<p><em>services</em>: para los servicios</p>
</li>
<li>
<p><em>controllers</em>: para los controladores</p>
</li>
<li>
<p><em>domain</em>: para las clases de dominio</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Vamos a implementar un pequeÃ±o ejemplo en nuestra aplicaciÃ³n. En primer lugar, vamos a crear un appender, que no es mÃ¡s que un objeto en el cual especificamos como y donde queremos escribir los mensajes de log. En nuestro caso lo haremos escribiendo en un archivo de logs, aunque tambiÃ©n podrÃ­amos haber optado por enviarlo a un correo electrÃ³nico o bien almacenarlo en una base de datos.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-n">log4j</span><span class="tok-o">.</span><span class="tok-na">main</span> <span class="tok-o">=</span> <span class="tok-o">{</span>
  <span class="tok-n">appenders</span> <span class="tok-o">{</span>
    <span class="tok-n">file</span> <span class="tok-nl">name:</span><span class="tok-s1">&#39;file&#39;</span><span class="tok-o">,</span> <span class="tok-nl">file:</span><span class="tok-s1">&#39;mylog.log&#39;</span>
  <span class="tok-o">}</span>
<span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>A continuaciÃ³n, vamos a indicarle a nuestra aplicaciÃ³n que queremos utilizar este appender en el controlador de la clase <em>Category</em>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-n">trace</span> <span class="tok-nl">file:</span> <span class="tok-s2">&quot;grails.app.controllers.es.ua.expertojava.todo.CategoryController&quot;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Por Ãºltimo, aÃ±adiremos una lÃ­nea en el mÃ©todo <em>index()</em> del controlador <em>CategoryController</em> para escribir un mensaje de prueba.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-kt">def</span> <span class="tok-nf">index</span><span class="tok-o">()</span> <span class="tok-o">{</span>
  <span class="tok-n">log</span><span class="tok-o">.</span><span class="tok-na">trace</span><span class="tok-o">(</span><span class="tok-s2">&quot;MÃ©todo index del controlador CategoryController&quot;</span><span class="tok-o">)</span>
  <span class="tok-n">params</span><span class="tok-o">.</span><span class="tok-na">max</span> <span class="tok-o">=</span> <span class="tok-n">Math</span><span class="tok-o">.</span><span class="tok-na">min</span><span class="tok-o">(</span><span class="tok-n">max</span> <span class="tok-o">?:</span> <span class="tok-mi">10</span><span class="tok-o">,</span> <span class="tok-mi">100</span><span class="tok-o">)</span>
  <span class="tok-n">respond</span> <span class="tok-n">Category</span><span class="tok-o">.</span><span class="tok-na">list</span><span class="tok-o">(</span><span class="tok-n">params</span><span class="tok-o">),</span> <span class="tok-nl">model:</span><span class="tok-o">[</span><span class="tok-nl">categoryInstanceCount:</span> <span class="tok-n">Category</span><span class="tok-o">.</span><span class="tok-na">count</span><span class="tok-o">()]</span>
<span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Si todo ha ido bien, tendremos un archivo en la raÃ­z de nuestra aplicaciÃ³n llamado <em>mylog.log</em> y que aÃ±adirÃ¡ el mensaje que hemos creado cada vez que se muestre el listado de usuarios.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-mi">2015</span><span class="tok-o">-</span><span class="tok-mi">03</span><span class="tok-o">-</span><span class="tok-mi">28</span> <span class="tok-mi">12</span><span class="tok-o">:</span><span class="tok-mi">05</span><span class="tok-o">:</span><span class="tok-mi">08</span><span class="tok-o">,</span><span class="tok-mi">549</span> <span class="tok-o">[</span><span class="tok-s2">&quot;http-bio-8080&quot;</span><span class="tok-o">-</span><span class="tok-n">exec</span><span class="tok-o">-</span><span class="tok-mi">1</span><span class="tok-o">]</span> <span class="tok-n">TRACE</span> <span class="tok-n">es</span><span class="tok-o">.</span><span class="tok-na">ua</span><span class="tok-o">.</span><span class="tok-na">expertojava</span><span class="tok-o">.</span><span class="tok-na">todo</span><span class="tok-o">.</span><span class="tok-na">CategoryController</span>  <span class="tok-o">-</span>
<span class="tok-n">M</span><span class="tok-err">Ã©</span><span class="tok-n">todo</span> <span class="tok-n">index</span> <span class="tok-n">del</span> <span class="tok-n">controlador</span> <span class="tok-n">CategoryController</span></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_el_archivo_buildconfig_groovy">8.1.3. El archivo BuildConfig.groovy</h4>
<div class="paragraph">
<p>AdemÃ¡s del archivo <em>Config.groovy</em>, todos los aspectos relativos a la configuraciÃ³n de la generaciÃ³n del proyecto se encuentran en el archivo <em>conf/BuildConfig.groovy</em>. En este archivo podemos encontrar las siguientes variables definidas:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><em>grails.servlet.version</em>: indicamos la especificaciÃ³n de Servlets. Por defecto utilizaremos la versiÃ³n 3.0.</p>
</li>
<li>
<p><em>grails.project.class.dir</em>: especificamos el directorio donde se alojarÃ¡n todos los archivos compilados del proyecto. Por defecto se alojarÃ¡n en el directorio <em>target/classes</em></p>
</li>
<li>
<p><em>grails.project.test.class.dir</em>: especificamos el directorio donde se compilarÃ¡n los tests de nuestros proyectos. Por defecto se alojarÃ¡n en el directorio <em>target/test-classes</em></p>
</li>
<li>
<p><em>grails.project.test.reports.dir</em>: especificamos el directorio donde se alojarÃ¡n los informes de las ejecuciones de los tests. Por defecto los tendremos en <em>target/test-reports</em></p>
</li>
<li>
<p><em>grails.project.target.level</em>: especificamos la versiÃ³n de la mÃ¡quina virtual de java. Por defecto serÃ¡ la 1.6</p>
</li>
<li>
<p><em>grails.project.war.file</em>: especificamos el nombre y la ubicaciÃ³n del archivo war que se generarÃ¡. Por defecto, se alojarÃ¡n en el directorio <em>target</em> y se llamarÃ¡ con el nombre de la aplicaciÃ³n seguido de la versiÃ³n, empezando por la <em>0.1</em></p>
</li>
<li>
<p><em>grails.project.fork</em>: parÃ¡metros de configuraciÃ³n de la mÃ¡quina virtual de Java utilizada en cada entorno de ejecuciÃ³n.</p>
</li>
<li>
<p><em>grails.project.dependency.resolution</em>: especificamos como se resuelven las dependencias de los archivos JAR de nuestros proyectos.</p>
</li>
<li>
<p><em>grails.project.dependency.resolution.plugins</em>: un listado de los plugins utilizados en nuestra aplicaciÃ³n.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_el_archivo_datasource_groovy">8.1.4. El archivo DataSource.groovy</h4>
<div class="paragraph">
<p>Muchas empresas disponen de varios entornos que las aplicaciones deben superar para finalmente pasar a disposiciÃ³n de los usuarios finales. Los entornos mÃ¡s habituales son el <em>entorno de desarrollo</em> que se refiere al entorno propio del desarrollador, con su propio servidor local instalado en su ordenador, el <em>entorno de tests</em> en el que otras personas se encargan de comprobar que la aplicaciÃ³n funciona tal y como se espera de ella y por Ãºltimo, el <em>entorno de producciÃ³n</em>, que es donde aparecen en escena los usuarios finales, que son quienes realmente "probarÃ¡n" el buen funcionamiento de la aplicaciÃ³n.</p>
</div>
<div class="paragraph">
<p>En cada uno de estos entornos, lo habitual es tener una configuraciÃ³n de base de datos diferente para cada uno, puesto que los requerimientos serÃ¡n distintos. Por ejemplo, en un entorno de desarrollo posiblemente nos sea suficiente utilizar una base de datos en memoria como H2, pero este tipo de base de datos serÃ¡ insuficiente para los entornos de test y producciÃ³n con lo que deberemos utilizar un servidor de base de datos como por ejemplo MySQL.</p>
</div>
<div class="paragraph">
<p>Como no podÃ­a ser menos, Grails lo tiene todo preparado para realizar esta diferenciaciÃ³n sin problemas. El archivo <em>grails-app/conf/DataSource.groovy</em> se encarga de todo mediante la creaciÃ³n por defecto de tres entornos de desarrollo: <em>desarrollo, test y producciÃ³n</em>, tal y como puedes comprobar en el siguiente ejemplo.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-n">dataSource</span> <span class="tok-o">{</span>
    <span class="tok-n">pooled</span> <span class="tok-o">=</span> <span class="tok-kc">true</span>
    <span class="tok-n">jmxExport</span> <span class="tok-o">=</span> <span class="tok-kc">true</span>
    <span class="tok-n">driverClassName</span> <span class="tok-o">=</span> <span class="tok-s2">&quot;org.h2.Driver&quot;</span>
    <span class="tok-n">username</span> <span class="tok-o">=</span> <span class="tok-s2">&quot;sa&quot;</span>
    <span class="tok-n">password</span> <span class="tok-o">=</span> <span class="tok-s2">&quot;&quot;</span>
<span class="tok-o">}</span>
<span class="tok-n">hibernate</span> <span class="tok-o">{</span>
    <span class="tok-n">cache</span><span class="tok-o">.</span><span class="tok-na">use_second_level_cache</span> <span class="tok-o">=</span> <span class="tok-kc">true</span>
    <span class="tok-n">cache</span><span class="tok-o">.</span><span class="tok-na">use_query_cache</span> <span class="tok-o">=</span> <span class="tok-kc">false</span>
<span class="tok-c1">//    cache.region.factory_class = &#39;net.sf.ehcache.hibernate.EhCacheRegionFactory&#39; // Hibernate 3</span>
    <span class="tok-n">cache</span><span class="tok-o">.</span><span class="tok-na">region</span><span class="tok-o">.</span><span class="tok-na">factory_class</span> <span class="tok-o">=</span> <span class="tok-s1">&#39;org.hibernate.cache.ehcache.EhCacheRegionFactory&#39;</span> <span class="tok-c1">// Hibernate 4</span>
    <span class="tok-n">singleSession</span> <span class="tok-o">=</span> <span class="tok-kc">true</span> <span class="tok-c1">// configure OSIV singleSession mode</span>
    <span class="tok-n">flush</span><span class="tok-o">.</span><span class="tok-na">mode</span> <span class="tok-o">=</span> <span class="tok-s1">&#39;manual&#39;</span> <span class="tok-c1">// OSIV session flush mode outside of transactional context</span>
<span class="tok-o">}</span>

<span class="tok-c1">// environment specific settings</span>
<span class="tok-n">environments</span> <span class="tok-o">{</span>
    <span class="tok-n">development</span> <span class="tok-o">{</span>
        <span class="tok-n">dataSource</span> <span class="tok-o">{</span>
            <span class="tok-n">dbCreate</span> <span class="tok-o">=</span> <span class="tok-s2">&quot;create-drop&quot;</span> <span class="tok-c1">// one of &#39;create&#39;, &#39;create-drop&#39;, &#39;update&#39;, &#39;validate&#39;, &#39;&#39;</span>
            <span class="tok-n">url</span> <span class="tok-o">=</span> <span class="tok-s2">&quot;jdbc:h2:mem:devDb;MVCC=TRUE;LOCK_TIMEOUT=10000;DB_CLOSE_ON_EXIT=FALSE&quot;</span>
        <span class="tok-o">}</span>
    <span class="tok-o">}</span>
    <span class="tok-n">test</span> <span class="tok-o">{</span>
        <span class="tok-n">dataSource</span> <span class="tok-o">{</span>
            <span class="tok-n">dbCreate</span> <span class="tok-o">=</span> <span class="tok-s2">&quot;update&quot;</span>
            <span class="tok-n">url</span> <span class="tok-o">=</span> <span class="tok-s2">&quot;jdbc:h2:mem:testDb;MVCC=TRUE;LOCK_TIMEOUT=10000;DB_CLOSE_ON_EXIT=FALSE&quot;</span>
        <span class="tok-o">}</span>
    <span class="tok-o">}</span>
    <span class="tok-n">production</span> <span class="tok-o">{</span>
        <span class="tok-n">dataSource</span> <span class="tok-o">{</span>
            <span class="tok-n">dbCreate</span> <span class="tok-o">=</span> <span class="tok-s2">&quot;update&quot;</span>
            <span class="tok-n">url</span> <span class="tok-o">=</span> <span class="tok-s2">&quot;jdbc:h2:prodDb;MVCC=TRUE;LOCK_TIMEOUT=10000;DB_CLOSE_ON_EXIT=FALSE&quot;</span>
            <span class="tok-n">properties</span> <span class="tok-o">{</span>
               <span class="tok-c1">// See http://grails.org/doc/latest/guide/conf.html#dataSource for documentation</span>
               <span class="tok-n">jmxEnabled</span> <span class="tok-o">=</span> <span class="tok-kc">true</span>
               <span class="tok-n">initialSize</span> <span class="tok-o">=</span> <span class="tok-mi">5</span>
               <span class="tok-n">maxActive</span> <span class="tok-o">=</span> <span class="tok-mi">50</span>
               <span class="tok-n">minIdle</span> <span class="tok-o">=</span> <span class="tok-mi">5</span>
               <span class="tok-n">maxIdle</span> <span class="tok-o">=</span> <span class="tok-mi">25</span>
               <span class="tok-n">maxWait</span> <span class="tok-o">=</span> <span class="tok-mi">10000</span>
               <span class="tok-n">maxAge</span> <span class="tok-o">=</span> <span class="tok-mi">10</span> <span class="tok-o">*</span> <span class="tok-mi">60000</span>
               <span class="tok-n">timeBetweenEvictionRunsMillis</span> <span class="tok-o">=</span> <span class="tok-mi">5000</span>
               <span class="tok-n">minEvictableIdleTimeMillis</span> <span class="tok-o">=</span> <span class="tok-mi">60000</span>
               <span class="tok-n">validationQuery</span> <span class="tok-o">=</span> <span class="tok-s2">&quot;SELECT 1&quot;</span>
               <span class="tok-n">validationQueryTimeout</span> <span class="tok-o">=</span> <span class="tok-mi">3</span>
               <span class="tok-n">validationInterval</span> <span class="tok-o">=</span> <span class="tok-mi">15000</span>
               <span class="tok-n">testOnBorrow</span> <span class="tok-o">=</span> <span class="tok-kc">true</span>
               <span class="tok-n">testWhileIdle</span> <span class="tok-o">=</span> <span class="tok-kc">true</span>
               <span class="tok-n">testOnReturn</span> <span class="tok-o">=</span> <span class="tok-kc">false</span>
               <span class="tok-n">jdbcInterceptors</span> <span class="tok-o">=</span> <span class="tok-s2">&quot;ConnectionState&quot;</span>
               <span class="tok-n">defaultTransactionIsolation</span> <span class="tok-o">=</span> <span class="tok-n">java</span><span class="tok-o">.</span><span class="tok-na">sql</span><span class="tok-o">.</span><span class="tok-na">Connection</span><span class="tok-o">.</span><span class="tok-na">TRANSACTION_READ_COMMITTED</span>
            <span class="tok-o">}</span>
        <span class="tok-o">}</span>
    <span class="tok-o">}</span>
<span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>En el primer bloque <em>dataSource</em> se definen una serie de valores genÃ©ricos, que posteriormente podremos sobreescribir en cada uno de los entornos. El bloque <em>hibernate</em> se refiere a parÃ¡metros de configuraciÃ³n del propio hibernate, mientras que el Ãºltimo bloque de <em>environments</em> es el que nos va a permitir diferenciar cada uno de los entornos.</p>
</div>
<div class="paragraph">
<p>Por defecto Grails crea los tres entornos de los que hablÃ¡bamos anteriormente. Con el comando <em>grails run-app</em> que hemos utilizado hasta ahora, la aplicaciÃ³n se ejecuta en el entorno de desarrollo, que es el utilizado por defecto, pero si quisiÃ©ramos utilizar otro entorno podrÃ­amos ejecutar los comandos de la siguiente tabla:</p>
</div>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-center valign-middle">Entorno</th>
<th class="tableblock halign-left valign-top">Comando</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-center valign-middle"><p class="tableblock">Desarrollo</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>grails dev run-app</em> o <em>grails run-app</em></p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-middle"><p class="tableblock">Test</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>grails test run-app</em></p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-middle"><p class="tableblock">ProducciÃ³n</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>grails prod run-app</em></p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>En el fichero <em>DataSource.groovy</em> se puede comprobar las tres configuraciones para cada uno de los entornos. Para los entornos de desarrollo y test se va a utilizar una base de datos en memoria como H2, eso si, diferente para cada uno de ellos (<em>devDB</em> y <em>testDb</em>).</p>
</div>
<div class="paragraph">
<p>Para el entorno de producciÃ³n deberÃ­amos utilizar una base de datos mÃ¡s robusta y propia de entornos de producciÃ³n como es MySQL. Para ello le especificamos la URI de la base de datos, asÃ­ como el controlador, el nombre de usuario y la contraseÃ±a de acceso a la misma.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-n">production</span> <span class="tok-o">{</span>
        <span class="tok-n">dataSource</span> <span class="tok-o">{</span>
            <span class="tok-n">dbCreate</span> <span class="tok-o">=</span> <span class="tok-s2">&quot;update&quot;</span>
            <span class="tok-n">url</span> <span class="tok-o">=</span> <span class="tok-s2">&quot;jdbc:mysql://localhost:3306/todo?useUnicode=true&amp;characterEncoding=UTF-8&quot;</span>
            <span class="tok-n">username</span> <span class="tok-o">=</span> <span class="tok-s2">&quot;userprod&quot;</span>
            <span class="tok-n">password</span> <span class="tok-o">=</span> <span class="tok-s2">&quot;pwdprod&quot;</span>
            <span class="tok-n">properties</span> <span class="tok-o">{</span>
               <span class="tok-c1">// See http://grails.org/doc/latest/guide/conf.html#dataSource for documentation</span>
               <span class="tok-n">jmxEnabled</span> <span class="tok-o">=</span> <span class="tok-kc">true</span>
               <span class="tok-n">initialSize</span> <span class="tok-o">=</span> <span class="tok-mi">5</span>
               <span class="tok-n">maxActive</span> <span class="tok-o">=</span> <span class="tok-mi">50</span>
               <span class="tok-n">minIdle</span> <span class="tok-o">=</span> <span class="tok-mi">5</span>
               <span class="tok-n">maxIdle</span> <span class="tok-o">=</span> <span class="tok-mi">25</span>
               <span class="tok-n">maxWait</span> <span class="tok-o">=</span> <span class="tok-mi">10000</span>
               <span class="tok-n">maxAge</span> <span class="tok-o">=</span> <span class="tok-mi">10</span> <span class="tok-o">*</span> <span class="tok-mi">60000</span>
               <span class="tok-n">timeBetweenEvictionRunsMillis</span> <span class="tok-o">=</span> <span class="tok-mi">5000</span>
               <span class="tok-n">minEvictableIdleTimeMillis</span> <span class="tok-o">=</span> <span class="tok-mi">60000</span>
               <span class="tok-n">validationQuery</span> <span class="tok-o">=</span> <span class="tok-s2">&quot;SELECT 1&quot;</span>
               <span class="tok-n">validationQueryTimeout</span> <span class="tok-o">=</span> <span class="tok-mi">3</span>
               <span class="tok-n">validationInterval</span> <span class="tok-o">=</span> <span class="tok-mi">15000</span>
               <span class="tok-n">testOnBorrow</span> <span class="tok-o">=</span> <span class="tok-kc">true</span>
               <span class="tok-n">testWhileIdle</span> <span class="tok-o">=</span> <span class="tok-kc">true</span>
               <span class="tok-n">testOnReturn</span> <span class="tok-o">=</span> <span class="tok-kc">false</span>
               <span class="tok-n">jdbcInterceptors</span> <span class="tok-o">=</span> <span class="tok-s2">&quot;ConnectionState&quot;</span>
               <span class="tok-n">defaultTransactionIsolation</span> <span class="tok-o">=</span> <span class="tok-n">java</span><span class="tok-o">.</span><span class="tok-na">sql</span><span class="tok-o">.</span><span class="tok-na">Connection</span><span class="tok-o">.</span><span class="tok-na">TRANSACTION_READ_COMMITTED</span>
            <span class="tok-o">}</span>
        <span class="tok-o">}</span>
    <span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>AdemÃ¡s, deberÃ­amos disponer del driver correspondiente de MySQL (<a href="http://www.mysql.com/downloads/connector/j/" class="bare">http://www.mysql.com/downloads/connector/j/</a>) y copiarlo en el directorio <em>lib</em> de la aplicaciÃ³n o bien especificarlo en las dependencias en el archivo <em>BuildConfig.groovy</em>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-n">grails</span><span class="tok-o">.</span><span class="tok-na">project</span><span class="tok-o">.</span><span class="tok-na">dependency</span><span class="tok-o">.</span><span class="tok-na">resolution</span> <span class="tok-o">=</span> <span class="tok-o">{</span>
  <span class="tok-o">...</span>

  <span class="tok-n">dependencies</span> <span class="tok-o">{</span>
    <span class="tok-n">runtime</span> <span class="tok-s1">&#39;mysql:mysql-connector-java:5.1.34&#39;</span>
  <span class="tok-o">}</span>
  <span class="tok-o">....</span>
<span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>AdemÃ¡s, mediante el parÃ¡metro <em>dbCreate</em> podemos especificar la forma en la que Grails debe generar el esquema de la base de datos a partir de la definiciÃ³n de las clases de dominio. Este parÃ¡metro puede tomar tres valores diferentes:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><em>create-drop</em>. El esquema de la base de datos se crearÃ¡ cada vez que arranquemos la aplicaciÃ³n en el entorno dado, y serÃ¡ destruido al interrumpir su ejecuciÃ³n.</p>
</li>
<li>
<p><em>create</em>. Crea el esquema de la base de datos, en caso de que el Ã©ste no exista, pero no modifica el esquema existente, aunque si borrarÃ¡ todos los datos almacenados en la misma.</p>
</li>
<li>
<p><em>update</em>. Crea la base de datos si no existe, y actualiza las tablas si detecta que se han aÃ±adido entidades nuevas o campos a los ya existentes. Estas modificaciones no incluirÃ¡n la eliminaciÃ³n o modificaciÃ³n de nada en la base de datos, con lo que hay que tener cuidado con este tipo de cambios en las clases de dominio y que luego no se ven reflejados automÃ¡ticamente en la base de datos.</p>
</li>
<li>
<p><em>validate</em>. Simplemente compara nuestro esquema actual con la base de datos especificada para enviarnos algÃºn que otro aviso de diferencia.</p>
</li>
<li>
<p><em>cualquier otro valor</em>. Si especificamos cualquier otro valor, Grails no harÃ¡ nada por nosotros. No debemos especificar ningÃºn valor a la variable <em>dbCreate</em> si nos encargaremos de la base de datos nosotros mismos mediante una herramienta externa.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_el_archivo_bootstrap_groovy">8.1.5. El archivo BootStrap.groovy</h4>
<div class="paragraph">
<p>A lo largo de las sesiones relativas a Grails, hemos utilizado el archivo de configuraciÃ³n <em>BootStrap.groovy</em> para insertar ciertos datos de ejemplo en nuestra aplicaciÃ³n que nos han servido para comprobar su funcionamiento.</p>
</div>
<div class="paragraph">
<p>El archivo define dos closures, <em>init</em> y <em>destroy</em>. El primero de ellos se ejecutarÃ¡ cada vez que ejecutemos la aplicaciÃ³n mediante el comando <em>grails run-app</em> en cualquiera de los entornos de ejecuciÃ³n recientemente comentados. Mientras que el closure <em>destroy</em> se ejecutarÃ¡ cuando paremos la ejecuciÃ³n de la aplicaciÃ³n.</p>
</div>
<div class="paragraph">
<p>Hasta el momento, cuando hemos insertado los datos en la base de datos, lo hacÃ­amos independientemente del entorno de ejecuciÃ³n en el que estuviÃ©ramos, algo que no serÃ¡ lo habitual, puesto que para los entornos de test y producciÃ³n, es mÃ¡s que probable que los datos ya estÃ©n almacenados en la base de datos o bien se inserten mediante una baterÃ­a de pruebas en el caso del entorno de tests.</p>
</div>
<div class="paragraph">
<p>Teniendo en cuesta esto, necesitaremos diferenciar en cada momento el entorno de ejecuciÃ³n de nuestra aplicaciÃ³n para insertar datos o no. Para ello, Grails dispone de la clase <em>grails.util.Environment</em> y la variable <em>current</em> que nos indica cual es el entorno de ejecuciÃ³n actual. El siguiente cÃ³digo de ejemplo, muestra como realizar esta distinciÃ³n a la hora de insertar datos en diferentes entornos.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-kn">import</span> <span class="tok-nn">grails.util.Environment</span>

<span class="tok-kd">class</span> <span class="tok-nc">BootStrap</span> <span class="tok-o">{</span>
  <span class="tok-kt">def</span> <span class="tok-n">init</span> <span class="tok-o">=</span> <span class="tok-o">{</span> <span class="tok-n">servletContext</span> <span class="tok-o">-&gt;</span>
    <span class="tok-k">switch</span> <span class="tok-o">(</span><span class="tok-n">Environment</span><span class="tok-o">.</span><span class="tok-na">current</span><span class="tok-o">)</span> <span class="tok-o">{</span>
      <span class="tok-k">case</span> <span class="tok-n">Environment</span><span class="tok-o">.</span><span class="tok-na">DEVELOPMENT</span><span class="tok-o">:</span>
        <span class="tok-n">configuracionDesarrollo</span><span class="tok-o">()</span>
        <span class="tok-k">break</span>
      <span class="tok-k">case</span> <span class="tok-n">Environment</span><span class="tok-o">.</span><span class="tok-na">PRODUCTION</span><span class="tok-o">:</span>
        <span class="tok-n">configuracionProduccion</span><span class="tok-o">()</span>
        <span class="tok-k">break</span>
      <span class="tok-k">case</span> <span class="tok-n">Environment</span><span class="tok-o">.</span><span class="tok-na">TEST</span><span class="tok-o">:</span>
        <span class="tok-n">configuracionTest</span><span class="tok-o">()</span>
        <span class="tok-k">break</span>
    <span class="tok-o">}</span>
  <span class="tok-o">}</span>
  <span class="tok-kt">def</span> <span class="tok-n">destroy</span> <span class="tok-o">=</span> <span class="tok-o">{</span>
    <span class="tok-k">switch</span> <span class="tok-o">(</span><span class="tok-n">Environment</span><span class="tok-o">.</span><span class="tok-na">current</span><span class="tok-o">)</span> <span class="tok-o">{</span>
      <span class="tok-k">case</span> <span class="tok-n">Environment</span><span class="tok-o">.</span><span class="tok-na">DEVELOPMENT</span><span class="tok-o">:</span>
        <span class="tok-n">salirDesarrollo</span><span class="tok-o">()</span>
        <span class="tok-k">break</span>
      <span class="tok-k">case</span> <span class="tok-n">Environment</span><span class="tok-o">.</span><span class="tok-na">PRODUCTION</span><span class="tok-o">:</span>
        <span class="tok-n">salirProduccion</span><span class="tok-o">()</span>
        <span class="tok-k">break</span>
      <span class="tok-k">case</span> <span class="tok-n">Environment</span><span class="tok-o">.</span><span class="tok-na">TEST</span><span class="tok-o">:</span>
        <span class="tok-n">salirTest</span><span class="tok-o">()</span>
        <span class="tok-k">break</span>
    <span class="tok-o">}</span>
  <span class="tok-o">}</span>
<span class="tok-o">}</span></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_el_archivo_urlmappings_groovy">8.1.6. El archivo UrlMappings.groovy</h4>
<div class="paragraph">
<p>Otro de los archivos interesantes en la configuraciÃ³n de una aplicaciÃ³n Grails es <em>UrlMappings.groovy</em>. Gracias a este archivo vamos a poder definir nuevas relaciones entre las URLs y los controladores.</p>
</div>
<div class="paragraph">
<p>Por defecto, este archivo indica que el primer parÃ¡metro que sigue al nombre de la aplicaciÃ³n se refiere al controlador, el segundo a la acciÃ³n y el tercero al identificador de la instancia de la clase de dominio que estamos tratando. AdemÃ¡s, en reciente versiones de Grails se ha aÃ±adido un nuevo parÃ¡metro que indica el formato de la peticiÃ³n, por ejemplo, json o xml.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-kd">class</span> <span class="tok-nc">UrlMappings</span> <span class="tok-o">{</span>

  <span class="tok-kd">static</span> <span class="tok-n">mappings</span> <span class="tok-o">=</span> <span class="tok-o">{</span>
        <span class="tok-s2">&quot;/$controller/$action?/$id?(.$format)?&quot;</span><span class="tok-o">{</span>
            <span class="tok-n">constraints</span> <span class="tok-o">{</span>
                <span class="tok-c1">// apply constraints here</span>
            <span class="tok-o">}</span>
        <span class="tok-o">}</span>

        <span class="tok-s2">&quot;/&quot;</span><span class="tok-o">(</span><span class="tok-nl">view:</span><span class="tok-s2">&quot;/index&quot;</span><span class="tok-o">)</span>
        <span class="tok-s2">&quot;500&quot;</span><span class="tok-o">(</span><span class="tok-nl">view:</span><span class="tok-s1">&#39;/error&#39;</span><span class="tok-o">)</span>
  <span class="tok-o">}</span>
<span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Un ejemplo tÃ­pico del uso del mapeo de URLs es modificar este comportamiento para permitir otras URLs mÃ¡s limpias. Por ejemplo, como administradores de la aplicaciÃ³n estarÃ­a bien poder ver las tareas de los usuarios a partir de su nombre de usuario, algo como <a href="http://localhost:8080/todo/usuario1" class="bare">http://localhost:8080/todo/usuario1</a>.</p>
</div>
<div class="paragraph">
<p>Para ello, podemos introducir una nueva regla en el archivo <em>UrlMappings.groovy</em> para que la aplicaciÃ³n sepa como actuar cuando le llegue una peticiÃ³n con una URL del estilo de la comentada. La siguiente regla se encargarÃ­a de este redireccionamiento encubierto.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-s2">&quot;/todos/$username&quot;</span><span class="tok-o">(</span><span class="tok-nl">controller:</span><span class="tok-s2">&quot;todo&quot;</span><span class="tok-o">,</span><span class="tok-nl">action:</span><span class="tok-s2">&quot;showTodosByUser&quot;</span><span class="tok-o">)</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>O bien podemos optar por una sintaxis diferente.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-s2">&quot;/$username&quot;</span><span class="tok-o">{</span>
      <span class="tok-n">controller</span> <span class="tok-o">=</span> <span class="tok-s2">&quot;todo&quot;</span>
      <span class="tok-n">action</span> <span class="tok-o">=</span> <span class="tok-s2">&quot;showtodosbyuser&quot;</span>
<span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>En primer lugar le especificamos la parte de la URL a partir del nombre de la aplicaciÃ³n que necesitamos que concuerde y despuÃ©s definimos que controlador y que acciÃ³n se deben encargar de procesar esta peticiÃ³n. En ambas opciones tendremos acceso al valor del nombre de usuario a travÃ©s de la variable <em>params.username</em>.</p>
</div>
<div class="paragraph">
<p>Posteriormente, deberÃ­amos implementar un mÃ©todo en el controlador <em>TodoController</em> llamado <em>showTodosByUser()</em> que nos devolviera aquellos tareas que pertenezcan al usuario cuyo nombre de usuario coincida con el pasado en la url.</p>
</div>
<div class="paragraph">
<p>Otra posible utilidad del mapeo de URLs es la internacionalizaciÃ³n de las URLs. Por ejemplo, en nuestra aplicaciÃ³n hemos definido las clases de dominio en inglÃ©s y por lo tanto las URLs se muestran tambiÃ©n en inglÃ©s. Si deseamos que estas URLs se muestren tambiÃ©n en castellano, podemos crear una serie de reglas en el archivo <em>UrlMappings.groovy</em>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-s2">&quot;/tarea/$action?/$id?(.$format)?&quot;</span><span class="tok-o">{</span>
      <span class="tok-n">controller</span> <span class="tok-o">=</span> <span class="tok-s2">&quot;tarea&quot;</span>
<span class="tok-o">}</span>

<span class="tok-s2">&quot;/usuario/$action?/$id?(.$format)?&quot;</span><span class="tok-o">{</span>
      <span class="tok-n">controller</span> <span class="tok-o">=</span> <span class="tok-s2">&quot;user&quot;</span>
<span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Las reglas de mapeo tambiÃ©n permiten la introducciÃ³n de restricciones que deben cumplir las partes de la URL. Por ejemplo, si quisiÃ©ramos obtener un listado con todos las tareas creadas un determinado dÃ­a podrÃ­amos tener la siguiente url <a href="http://localhost:8080/todo/2015/03/28" class="bare">http://localhost:8080/todo/2015/03/28</a>. Las restricciones que debe cumplir la URL son que el aÃ±o debe ser una cifra de cuatro dÃ­gitos mientras que el mes debe estar compuesta por dos nÃºmeros y el dÃ­a por otras dos. Para que la aplicaciÃ³n supiera que hacer con este tipo de direcciones debemos introducir la siguiente regla de mapeo.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-s2">&quot;/$year/$month/$day&quot;</span> <span class="tok-o">{</span>
  <span class="tok-n">controller</span> <span class="tok-o">=</span> <span class="tok-s2">&quot;todo&quot;</span>
  <span class="tok-n">action</span> <span class="tok-o">=</span> <span class="tok-s2">&quot;showtodosbyday&quot;</span>
  <span class="tok-n">constraints</span> <span class="tok-o">{</span>
    <span class="tok-n">year</span><span class="tok-o">(</span><span class="tok-nl">matches:</span><span class="tok-s">/\d{4}/</span><span class="tok-o">)</span>
    <span class="tok-n">month</span><span class="tok-o">(</span><span class="tok-nl">matches:</span><span class="tok-s">/\d{2}/</span><span class="tok-o">)</span>
    <span class="tok-n">day</span><span class="tok-o">(</span><span class="tok-nl">matches:</span><span class="tok-s">/\d{2}/</span><span class="tok-o">)</span>
  <span class="tok-o">}</span>
<span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Otro aspecto interesante del mapeo de URLs puede ser la captura de los cÃ³digos de error que se producen en el acceso a una aplicaciÃ³n web, como por ejemplo el tÃ­pico error 404 cuando la pÃ¡gina solicitada no existe. En este tipo de casos, estarÃ­a bien modificar la tÃ­pica pantalla de este tipo de errores, por otra en que se mostrarÃ¡ informaciÃ³n sobre nuestra aplicaciÃ³n, como por ejemplo un mapa de todas las opciones de la aplicaciÃ³n.</p>
</div>
<div class="paragraph">
<p>Para controlar la informaciÃ³n mostrada al producirse estos errores, podemos aÃ±adir lo siguiente en el archivo <em>UrlMapping.groovy</em></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-s2">&quot;404&quot;</span><span class="tok-o">(</span><span class="tok-nl">view:</span><span class="tok-s1">&#39;/error&#39;</span><span class="tok-o">)</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>para que sea una pÃ¡gina GSP quien se encargue de esta gestiÃ³n o bien</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-s2">&quot;404&quot;</span><span class="tok-o">(</span><span class="tok-nl">controller:</span><span class="tok-s1">&#39;error&#39;</span><span class="tok-o">,</span> <span class="tok-nl">action:</span><span class="tok-s1">&#39;notFound&#39;</span><span class="tok-o">)</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>para que sea un controlador quien haga este trabajo.</p>
</div>
<div class="paragraph">
<p>Por Ãºltimo, tambiÃ©n es muy interesante ver como Grails es capaz de reescribir los enlaces que generamos en nuestra aplicaciÃ³n. Imagina por ejemplo que tenemos la siguiente regla en nuestro archivo <em>UrlMappings.groovy</em></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-kd">static</span> <span class="tok-n">mappings</span> <span class="tok-o">=</span> <span class="tok-o">{</span>
   <span class="tok-s2">&quot;/$blog/$year?/$month?/$day?/$id?&quot;</span><span class="tok-o">(</span><span class="tok-nl">controller:</span><span class="tok-s2">&quot;blog&quot;</span><span class="tok-o">,</span> <span class="tok-nl">action:</span><span class="tok-s2">&quot;show&quot;</span><span class="tok-o">)</span>
<span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Y que en una pÃ¡gina GSP tenemos el siguiente cÃ³digo</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-o">&lt;</span><span class="tok-nl">g:</span><span class="tok-n">link</span> <span class="tok-n">controller</span><span class="tok-o">=</span><span class="tok-s2">&quot;blog&quot;</span> <span class="tok-n">action</span><span class="tok-o">=</span><span class="tok-s2">&quot;show&quot;</span> <span class="tok-n">params</span><span class="tok-o">=</span><span class="tok-s2">&quot;[blog:&#39;fred&#39;, year:2014]&quot;</span><span class="tok-o">&gt;</span>
    <span class="tok-n">My</span> <span class="tok-n">Blog</span>
<span class="tok-o">&lt;</span><span class="tok-s">/g:link&gt;</span>

<span class="tok-s">&lt;g:link controller=&quot;blog&quot; action=&quot;show&quot; params=&quot;[blog:&#39;fred&#39;, year:2014, month:10]&quot;&gt;</span>
<span class="tok-s">My Blog - October 2014 Posts</span>
<span class="tok-s">&lt;/</span><span class="tok-nl">g:</span><span class="tok-n">link</span><span class="tok-o">&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Lo que Grails convertirÃ­a en lo siguiente</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-o">&lt;</span><span class="tok-n">a</span> <span class="tok-n">href</span><span class="tok-o">=</span><span class="tok-s2">&quot;/fred/2014&quot;</span><span class="tok-o">&gt;</span><span class="tok-n">My</span> <span class="tok-n">Blog</span><span class="tok-o">&lt;</span><span class="tok-s">/a&gt;</span>
<span class="tok-s">&lt;a href=&quot;/</span><span class="tok-n">fred</span><span class="tok-s">/2014/</span><span class="tok-mi">10</span><span class="tok-err">&quot;</span><span class="tok-o">&gt;</span><span class="tok-n">My</span> <span class="tok-n">Blog</span> <span class="tok-o">-</span> <span class="tok-n">October</span> <span class="tok-mi">2014</span> <span class="tok-n">Posts</span><span class="tok-o">&lt;/</span><span class="tok-n">a</span><span class="tok-o">&gt;</span></code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_empaquetamiento_de_aplicaciones">8.2. Empaquetamiento de aplicaciones</h3>
<div class="paragraph">
<p>Al terminar una nueva funcionalidad de una aplicaciÃ³n o una nueva versiÃ³n de la misma, necesitamos generar el paquete <em>WAR</em> correspondiente a la nueva versiÃ³n para desplegarla en el servidor de destino.</p>
</div>
<div class="paragraph">
<p>La generaciÃ³n del archivo <em>WAR</em> se realiza simplemente ejecutando el comando <em>grails war</em>, el cual nos generarÃ¡ un archivo con extensiÃ³n <em>.war</em> con el nombre de la aplicaciÃ³n, en nuestro caso <em>todo</em>, seguido de la versiÃ³n de la aplicaciÃ³n. En nuestro caso, la primera vez que ejecutemos el comando <em>grails war</em> el fichero generado se llamarÃ¡ <em>todo-0.1.war</em>.</p>
</div>
<div class="paragraph">
<p>Esto serÃ­a lo mÃ¡s bÃ¡sico para generar el archivo <em>WAR</em> de la aplicaciÃ³n, sin embargo, lo habitual es hacer alguna cosa mÃ¡s, tal y como se muestra en el siguiente listado.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Actualizar el cÃ³digo fuente del repositorio de control de versiones para asegurarse de que todas las partes del proyecto estÃ¡n actualizadas.</p>
</li>
<li>
<p>Ejecutar los tests de integraciÃ³n, unitarios y funcionales que hayamos implementado para comprobar que todo funciona tal y como esperamos.</p>
</li>
<li>
<p>Incrementar la variable <em>app.version</em> del archivo <em>application.properties</em> manualmente o bien mediante el comando <em>grails set-version 0.2</em>.</p>
</li>
<li>
<p>Limpiar el proyecto de archivos temporales mediante el comando <em>grails clean</em>.</p>
</li>
<li>
<p>Generar el archivo <em>WAR</em> indicÃ¡ndole el entorno donde queremos desplegar este <em>WAR</em>. Por ejemplo, el comando <em>grails prod war</em> crearÃ­a un archivo <em>WAR</em> para ser desplegado en nuestro entorno de producciÃ³n.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Una aplicaciÃ³n Grails empaquetada como un archivo <em>WAR</em> puede ser desplegada en servidores de aplicaciones JAVA EE tales como JBoss (<a href="http://www.jboss.org/" class="bare">http://www.jboss.org/</a>), GlassFish (<a href="https://glassfish.dev.java.net/" class="bare">https://glassfish.dev.java.net/</a>), Apache Geronimo (<a href="http://geronimo.apache.org" class="bare">http://geronimo.apache.org</a>), BEA WebLogic (<a href="http://www.bea.com" class="bare">http://www.bea.com</a>) o IBM WebSphere (<a href="http://www.ibm.com/software/websphere" class="bare">http://www.ibm.com/software/websphere</a>) o incluso en un contenedor web como Apache Tomcat (<a href="http://tomcat.apache.org" class="bare">http://tomcat.apache.org</a>) o Jetty (<a href="http://www.mortbay.com" class="bare">http://www.mortbay.com</a>).</p>
</div>
<div class="paragraph">
<p>Cada uno de estos servidores o contenedores tendrÃ¡n su propia especificaciÃ³n y forma de desplegar los archivos <em>WAR</em> generados. Unos mediante unos directorios especiales donde copiar los <em>WAR</em>, otros mediante una consola basada en web, otros por lÃ­nea de comandos e incluso mediante tareas de tipo Ant. En la secciÃ³n Deployment (<a href="http://www.grails.org/Deployment" class="bare">http://www.grails.org/Deployment</a>) de la web oficial de Grails puedes encontrar informaciÃ³n sobre como desplegar los archivos <em>WAR</em> en varios servidores.</p>
</div>
</div>
<div class="sect2">
<h3 id="_otros_comandos_interesantes_de_grails">8.3. Otros comandos interesantes de Grails</h3>
<div class="paragraph">
<p>Durante este mÃ³dulo dedicado a Grails, han ido apareciendo varios de los comandos mÃ¡s habituales que utilizaremos cuando creemos aplicaciones con Grails. Sin embargo, los comandos vistos hasta ahora no son los Ãºnicos y es ahora cuando veremos algunos de ellos. Ten en cuenta tambiÃ©n que cuando instalamos plugins, es posible que tambiÃ©n se aÃ±adan nuevos comandos.</p>
</div>
<div class="paragraph">
<p>Si ejecutamos el comando <em>grails help</em> veremos un listado con todos los posibles comandos que tenemos disponibles en nuestra instalaciÃ³n de Grails. La siguiente tabla muestra los comandos mÃ¡s interesantes que no hemos visto hasta ahora.</p>
</div>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-center valign-middle">Comando</th>
<th class="tableblock halign-left valign-top">DescripciÃ³n</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-center valign-middle"><p class="tableblock"><em>grails bug-report</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Genera un archivo comprimido en ZIP con los archivos fuente de nuestro proyecto para el caso de que queramos informar de un bug</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-middle"><p class="tableblock"><em>grails clean</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Limpia el directorio <em>tmp</em> de nuestra aplicaciÃ³n. Este comando puede ser combinado con otros comandos como por ejemplo <em>grails clean run-app</em></p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-middle"><p class="tableblock"><em>grails console</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Nos muestra la consola de Groovy que veÃ­amos en la parte del mÃ³dulo dedicada a este lenguaje de programaciÃ³n.</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-middle"><p class="tableblock"><em>grails doc</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Genera la documentaciÃ³n completa de nuestro proyecto.</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-middle"><p class="tableblock"><em>grails help</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Muestra un listado de comandos disponibles en Grails. Si le pasamos como parÃ¡metro uno de esos posibles comandos, nos mostrarÃ¡ informaciÃ³n adicional sobre el comando dado. Por ejemplo <em>grails help doc</em></p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-middle"><p class="tableblock"><em>grails list-plugins</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Muestra un listado completo tanto de los plugins disponibles como de los ya instalados en la aplicaciÃ³n.</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-middle"><p class="tableblock"><em>grails plugin-info</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Muestra la informaciÃ³n completa del plugin pasado como parÃ¡metro al comando.</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-middle"><p class="tableblock"><em>grails run-app -https</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Ejecuta el comando <em>grails run-app</em> utilizando como servidor Tomcat pero sobre un servidor seguro <em>https</em>. El puerto por defecto es 8443 y puede ser modificado aÃ±adiendo al comando <em>-Dserver.port.https=&lt;numero_puerto&gt;</em></p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-middle"><p class="tableblock"><em>grails schema-export</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Genera un fichero con las sentencias SQL necesarias para exportar la base de datos.</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-middle"><p class="tableblock"><em>grails set-version</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Establece la versiÃ³n de la aplicaciÃ³n. Por ejemplo <em>grails set-version 1.0.4</em></p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-middle"><p class="tableblock"><em>grails stats</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Nos muestra una serie de datos referentes a nuestro proyecto, con respecto al nÃºmero de controladores, clases de dominio, servicios, librerÃ­as de etiquetas, tests de integraciÃ³n, etc. y al nÃºmero de lÃ­neas totales en cada apartado.</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-middle"><p class="tableblock"><em>grails uninstall-plugin</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Desinstala el plugin pasado como parÃ¡metro de la aplicaciÃ³n.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="_plugins_2">8.4. Plugins</h3>
<div class="paragraph">
<p>La comunidad de usuarios de Grails es cada vez mayor y eso hace que, cuando una caracterÃ­stica no ha sido desarrollada en el nÃºcleo de Grails, sean los propios usuarios quienes se encarguen de desarrollarla como un plugin externo. En el momento en que se escribieron estos apuntes eran casi 1200 los plugins desarrollados por la comunidad (<a href="http://www.grails.org/plugins/" class="bare">http://www.grails.org/plugins/</a>).</p>
</div>
<div class="paragraph">
<p>Estos plugins abarcan aspectos tan diversos como la seguridad como el plugin de Spring Security (<a href="http://www.grails.org/plugin/spring-security-core" class="bare">http://www.grails.org/plugin/spring-security-core</a>), el desarrollo de interfaces grÃ¡ficas ricas como Rich UI (<a href="http://www.grails.org/plugin/richui" class="bare">http://www.grails.org/plugin/richui</a>) o la exportaciÃ³n de datos a otros formatos con el plugin Export (<a href="http://www.grails.org/plugin/export" class="bare">http://www.grails.org/plugin/export</a>).</p>
</div>
<div class="paragraph">
<p>Para ver el funcionamiento de los plugins en Grails, nosotros vamos a utilizar un plugin que nos permitirÃ¡ buscar contenido en las clases de dominio de nuestra aplicaciÃ³n sin prÃ¡cticamente esfuerzo alguno. TambiÃ©n utilizaremos el plugin export para exportar la informaciÃ³n de nuestras clases de dominio a otros formatos. Pero para empezar, veamos un plugin que nos permitirÃ¡ utilizar una consola a travÃ©s de nuestra aplicaciÃ³n para poder realizar todo tipo de operaciones.</p>
</div>
<div class="sect3">
<h4 id="_plugin_console">8.4.1. Plugin console</h4>
<div class="paragraph">
<p>El plugin console no es mÃ¡s un plugin que permite la ejecuciÃ³n en lÃ­nea de comandos. Desde esta consola tendremos acceso a determinados contextos como pueden ser la propia aplicaciÃ³n o las clases de dominio. Es muy Ãºtil cuando queremos realizar operaciones sobre las clases de dominio y no podemos o no queremos tocar la aplicaciÃ³n para esto.</p>
</div>
<div class="paragraph">
<p>La instalaciÃ³n del plugin se realiza con el comando <em>grails install-plugin console</em> o bien editando el archivo de configuraciÃ³n <em>BuildConfig.groovy</em> para aÃ±adir el plugin correspondiente:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-n">grails</span><span class="tok-o">.</span><span class="tok-na">project</span><span class="tok-o">.</span><span class="tok-na">dependency</span><span class="tok-o">.</span><span class="tok-na">resolution</span> <span class="tok-o">{</span>
  <span class="tok-o">...</span>
  <span class="tok-n">plugins</span> <span class="tok-o">{</span>
    <span class="tok-o">...</span>
    <span class="tok-n">compile</span> <span class="tok-s2">&quot;:console:1.5.6&quot;</span>
  <span class="tok-o">}</span>
<span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Una vez instalado el plugin y con la aplicaciÃ³n en funcionamiento, podremos acceder a esta consola desde la direcciÃ³n <em><a href="http://localhost:8080/todo/console" class="bare">http://localhost:8080/todo/console</a></em>.</p>
</div>
<div class="paragraph">
<p>Sin embargo, es probable que, debido a la configuraciÃ³n segura de nuestra aplicaciÃ³n, necesites actualizar las reglas de seguridad para que por ejemplo permita el acceso a esta url a los administradores de la misma.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-n">grails</span><span class="tok-o">.</span><span class="tok-na">plugin</span><span class="tok-o">.</span><span class="tok-na">springsecurity</span><span class="tok-o">.</span><span class="tok-na">controllerAnnotations</span><span class="tok-o">.</span><span class="tok-na">staticRules</span> <span class="tok-o">=</span> <span class="tok-o">[</span>
    <span class="tok-s2">&quot;/console/**&quot;</span><span class="tok-o">:</span>          <span class="tok-o">[</span><span class="tok-s1">&#39;ROLE_ADMIN&#39;</span><span class="tok-o">],</span>
    <span class="tok-s2">&quot;/plugins/console*/**&quot;</span><span class="tok-o">:</span> <span class="tok-o">[</span><span class="tok-s1">&#39;ROLE_ADMIN&#39;</span><span class="tok-o">]</span>
<span class="tok-o">]</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Ten en cuenta que este ejemplo considera que estamos utilizando el mÃ©todo de Spring Security <em>Annotation</em>.</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="images/grails08/console.png" alt="Plugin Console" width="100%">
</div>
</div>
<div class="paragraph">
<p>Con el ejemplo mostrado en la imagen podrÃ­amos obtener todos las tareas de nuestra aplicaciÃ³n e imprimirlos por pantalla. Pero ademÃ¡s podemos acceder a cualquier artefacto de nuestra aplicaciÃ³n incluidos los servicios, tal y como si estuviÃ©ramos ejecutando este cÃ³digo dentro de nuestra aplicaciÃ³n.</p>
</div>
<div class="paragraph">
<p>Las siguientes variables son accesible desde esta consola:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>ctx - el contexto de la aplicaciÃ³n Spring</p>
</li>
<li>
<p>grailsApplication - la instancia de la aplicaciÃ³n Grails</p>
</li>
<li>
<p>config - la configuraciÃ³n Grails</p>
</li>
<li>
<p>request - la peticiÃ³n HTTP actual</p>
</li>
<li>
<p>session - la sesiÃ³n HTTP actual</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>El objeto <em>ctx</em> sin duda es el mÃ¡s interesante puesto que nos va a permitir acceder al contexto de la aplicaciÃ³n y por consiguiente a varios artefactos como pueden ser los servicios de forma muy sencilla y por ejemplo eliminar tareas directamente.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-n">Todo</span> <span class="tok-n">todo</span> <span class="tok-o">=</span> <span class="tok-n">es</span><span class="tok-o">.</span><span class="tok-na">ua</span><span class="tok-o">.</span><span class="tok-na">expertojava</span><span class="tok-o">.</span><span class="tok-na">todo</span><span class="tok-o">.</span><span class="tok-na">Todo</span><span class="tok-o">.</span><span class="tok-na">get</span><span class="tok-o">(</span><span class="tok-mi">1</span><span class="tok-o">)</span>

<span class="tok-n">ctx</span><span class="tok-o">.</span><span class="tok-na">todoService</span><span class="tok-o">.</span><span class="tok-na">deleteTodo</span><span class="tok-o">(</span><span class="tok-n">todo</span><span class="tok-o">)</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Este plugin es una forma rÃ¡pida de probar determinadas funcionalidades de nuestra aplicaciÃ³n.</p>
</div>
</div>
<div class="sect3">
<h4 id="_plugin_para_la_bÃºsqueda_de_contenido_searchable">8.4.2. Plugin para la bÃºsqueda de contenido: Searchable</h4>
<div class="paragraph">
<p>Para esta tarea de bÃºsqueda, Grails cuenta con un plugin llamado <em>Searchable</em> que nos va a facilitar muchÃ­simo esta labor. Este plugin ademÃ¡s, estÃ¡ basado en el framework OpenSymphony Compass Search Engine (<a href="http://www.opensymphony.com/compass/" class="bare">http://www.opensymphony.com/compass/</a>) y que tiene por detrÃ¡s a Apache Lucene, con lo que el plugin cuenta con mucho respaldo.</p>
</div>
<div class="paragraph">
<p>Para la instalaciÃ³n de plugin en Grails, debemos modificar el archivo de configuraciÃ³n de configuraciÃ³n <em>BuildConfig.groovy</em> y seguir las instrucciones que vienen en la pÃ¡gina del plugin <em><a href="http://grails.org/plugin/searchable" class="bare">http://grails.org/plugin/searchable</a></em>.</p>
</div>
<div class="paragraph">
<p>Estas instrucciones pasan por aÃ±adir un nuevo repositorio maven y aÃ±adir el plugin en cuestiÃ³n.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-n">grails</span><span class="tok-o">.</span><span class="tok-na">project</span><span class="tok-o">.</span><span class="tok-na">dependency</span><span class="tok-o">.</span><span class="tok-na">resolution</span> <span class="tok-o">=</span> <span class="tok-o">{</span>
  <span class="tok-o">...</span>

  <span class="tok-n">repositories</span> <span class="tok-o">{</span>
    <span class="tok-o">...</span>
    <span class="tok-n">mavenRepo</span> <span class="tok-s2">&quot;http://repo.grails.org/grails/core&quot;</span>
  <span class="tok-o">}</span>

  <span class="tok-n">plugins</span> <span class="tok-o">{</span>
    <span class="tok-o">...</span>
    <span class="tok-n">compile</span> <span class="tok-s2">&quot;:searchable:0.6.9&quot;</span>
  <span class="tok-o">}</span>
<span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Una vez instalado, podemos comprobar que en la direcciÃ³n <a href="http://localhost:8080/todo/searchable" class="bare">http://localhost:8080/todo/searchable</a> (habrÃ¡ que aÃ±adir tambiÃ©n esta direcciÃ³n en la configuraciÃ³n segura de nuestra aplicaciÃ³n), tenemos un buscador que se ha generado automÃ¡ticamente. Sin embargo, si probamos a hacer alguna bÃºsqueda, el buscador nos dirÃ¡ que no ha encontrada nada. Esto es porque todavÃ­a no le hemos dicho al plugin donde debe buscar la informaciÃ³n.</p>
</div>
<div class="paragraph">
<p>Si pensamos donde podemos aÃ±adir un buscador en nuestra aplicaciÃ³n encontraremos que los usuarios de nuestro aplicaciÃ³n querrÃ¡n buscar tareas, con lo que debemos indicar en la clases de dominio <em>Todo</em> que necesitamos que nuestro plugin searchable sea capaz de buscar en ella.</p>
</div>
<div class="paragraph">
<p>Para que el plugin <em>searchable</em> sea capaz de encontrar tareas que contengan un determinado texto, necesitamos modificar la clase de dominio <em>Todo</em> y aÃ±adirle una nueva propiedad llamada <em>searchable</em>. Esta propiedad es <em>static</em> y debe contener un valor booleano indicando si permitimos la bÃºsqueda o no, con lo que la clase de dominio <em>Todo</em> quedarÃ­an asÃ­:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-kn">package</span> <span class="tok-n">es</span><span class="tok-o">.</span><span class="tok-na">ua</span><span class="tok-o">.</span><span class="tok-na">expertojava</span><span class="tok-o">.</span><span class="tok-na">todo</span>

<span class="tok-kd">class</span> <span class="tok-nc">Todo</span> <span class="tok-o">{</span>
    <span class="tok-n">String</span> <span class="tok-n">title</span>
    <span class="tok-n">String</span> <span class="tok-n">description</span>
    <span class="tok-n">Date</span> <span class="tok-n">date</span>
    <span class="tok-n">Date</span> <span class="tok-n">reminderDate</span>
    <span class="tok-n">String</span> <span class="tok-n">url</span>
    <span class="tok-n">Boolean</span> <span class="tok-n">done</span> <span class="tok-o">=</span> <span class="tok-kc">false</span>
    <span class="tok-n">Category</span> <span class="tok-n">category</span>

    <span class="tok-n">Date</span> <span class="tok-n">dateCreated</span>
    <span class="tok-n">Date</span> <span class="tok-n">lastUpdated</span>

    <span class="tok-n">Date</span> <span class="tok-n">dateDone</span>

    <span class="tok-n">User</span> <span class="tok-n">user</span>

    <span class="tok-kd">static</span> <span class="tok-n">searchable</span> <span class="tok-o">=</span> <span class="tok-kc">true</span>

    <span class="tok-o">...</span>
<span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Si ahora realizamos alguna bÃºsqueda de prueba, Searchable nos devolverÃ¡ los resultados encontrados en todas las propiedades de las clases de dominio <em>Todo</em>. Ahora bien, estamos permitiendo que se busque el tÃ©rmino de bÃºsqueda en todas las propiedades de las clases de dominio implicadas, algo que no siempre serÃ¡ lo deseado. Para ello, el plugin permite la utilizaciÃ³n de dos variables con las que le indicaremos al sistema donde puede buscar o donde no.</p>
</div>
<div class="paragraph">
<p>Estas dos variables son <em>only</em> y <em>except</em> y podemos definirlas de la siguiente forma:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-kd">static</span> <span class="tok-n">searchable</span> <span class="tok-o">=</span> <span class="tok-o">[</span><span class="tok-nl">only:</span> <span class="tok-o">[</span><span class="tok-s1">&#39;title&#39;</span><span class="tok-o">,</span> <span class="tok-s1">&#39;description&#39;</span><span class="tok-o">]]</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>para indicarle que debe buscar en las propiedades <em>title</em> y <em>description</em> o bien mediante:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-kd">static</span> <span class="tok-n">searchable</span> <span class="tok-o">=</span> <span class="tok-o">[</span><span class="tok-nl">except:</span> <span class="tok-s1">&#39;date&#39;</span><span class="tok-o">,</span> <span class="tok-s1">&#39;reminderDate&#39;</span><span class="tok-o">]</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>si lo que queremos es indicarle sÃ³lo aquellas propiedades en las que no debemos realizar la bÃºsqueda. En este Ãºltimo caso, buscaremos en todas las propiedades de la clase de dominio <em>Todo</em> excepto en <em>date</em> y <em>reminderDate</em>.</p>
</div>
<div class="paragraph">
<p>En el momento de escribir estos apuntes el plugin tenÃ­a un problema para funcionar con Hibernate 4 con lo que vamos a tener que actualizar un par de ficheros para utilizar en su lugar Hibernate 3. Si abrimos el archivo de configuraciÃ³n <em>BuildConfig.groovy</em> veremos como hay una lÃ­nea indicando</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-n">runtime</span> <span class="tok-s2">&quot;:hibernate4:4.3.10&quot;</span> <span class="tok-c1">// or &quot;:hibernate:3.6.10.18&quot;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>que vamos a tener que modificar para utilizar Hibernate 3. AdemÃ¡s, en el archivo de configuraciÃ³n <em>DataSource.groovy</em> encontraremos</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-c1">//cache.region.factory_class = &#39;org.hibernate.cache.SingletonEhCacheRegionFactory&#39; // Hibernate 3</span>
<span class="tok-n">cache</span><span class="tok-o">.</span><span class="tok-na">region</span><span class="tok-o">.</span><span class="tok-na">factory_class</span> <span class="tok-o">=</span> <span class="tok-s1">&#39;org.hibernate.cache.ehcache.SingletonEhCacheRegionFactory&#39;</span> <span class="tok-c1">// Hibernate 4</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>y de igual forma, vamos a tener que modificar para utilizar Hibernate 3 en lugar de Hibernate 4.</p>
</div>
<div class="paragraph">
<p>Con estas modificaciones, si ahora intentamos de nuevo realizar una bÃºsqueda en <em><a href="http://localhost:8080/todo/searchable" class="bare">http://localhost:8080/todo/searchable</a></em> veremos como ya empieza a buscar en los campos <em>title</em> y <em>description</em> de la clase de dominio <em>Todo</em>.</p>
</div>
<div class="paragraph">
<p>Pero si esto se nos queda corto (y posiblemente sea asÃ­), podemos utilizar el servicio <em>SearchableService</em>. AdemÃ¡s, los mÃ©todos de este servicio tambiÃ©n estÃ¡n disponibles en las clases de dominio "anotadas" con la variable <em>searchable</em>. Estos son los mÃ©todos de los que disponemos:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="https://grails.org/Searchable+Plugin+-+Methods+-+search"><em>search</em></a>: encuentra objetos que cumplen una determinada consulta.</p>
</li>
<li>
<p><a href="https://grails.org/Searchable+Plugin+-+Methods+-+countHits"><em>countHits</em></a>: encuentra el nÃºmero de objetos que cumplen una determinada consulta.</p>
</li>
<li>
<p><a href="https://grails.org/Searchable+Plugin+-+Methods+-+moreLikeThis"><em>moreLikeThis</em></a>: encuentra objetos similares a la instancia pasada por parÃ¡metro.</p>
</li>
<li>
<p><a href="https://grails.org/Searchable+Plugin+-+Methods+-+suggestQuery"><em>suggestQuery</em></a>: sugiere una nueva consulta a partir de la consultada pasada por parÃ¡metro.</p>
</li>
<li>
<p><a href="https://grails.org/Searchable+Plugin+-+Methods+-+termFreqs"><em>termsFreqs</em></a>: devuelve la frecuencia para los tÃ©rminos en el Ã­ndice.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Un ejemplo para buscar en las tareas de nuestra aplicaciÃ³n podrÃ­a ser el siguiente:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-kt">def</span> <span class="tok-n">searchResult</span> <span class="tok-o">=</span> <span class="tok-n">searchableService</span><span class="tok-o">.</span><span class="tok-na">search</span><span class="tok-o">(</span>
    <span class="tok-s2">&quot;Tests&quot;</span><span class="tok-o">,</span>
    <span class="tok-o">[</span><span class="tok-nl">offset:</span> <span class="tok-mi">0</span><span class="tok-o">,</span> <span class="tok-nl">max:</span> <span class="tok-mi">20</span><span class="tok-o">]</span>
<span class="tok-o">)</span>
<span class="tok-n">println</span> <span class="tok-s2">&quot;${searchResult.total} hits:&quot;</span>
<span class="tok-k">for</span> <span class="tok-o">(</span><span class="tok-n">i</span> <span class="tok-k">in</span> <span class="tok-mi">0</span><span class="tok-o">..&lt;</span><span class="tok-n">searchResult</span><span class="tok-o">.</span><span class="tok-na">results</span><span class="tok-o">.</span><span class="tok-na">size</span><span class="tok-o">())</span> <span class="tok-o">{</span>
    <span class="tok-n">println</span> <span class="tok-s2">&quot;${searchResult.offset + i + 1}: &quot;</span> <span class="tok-o">+</span>
        <span class="tok-s2">&quot;${searchResult.results[i].toString()} &quot;</span> <span class="tok-o">+</span>
        <span class="tok-s2">&quot;(score ${searchResult.scores[i]})&quot;</span>
<span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>o bien, tambiÃ©n podemos buscar directamente en la clase de dominio en cuestiÃ³n.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-c1">//Devuelve un Ãºnico objeto de tipo Todo</span>
<span class="tok-c1">//que coincidan con la bÃºsqueda realizada</span>
<span class="tok-kt">def</span> <span class="tok-n">todo</span> <span class="tok-o">=</span> <span class="tok-n">Todo</span><span class="tok-o">.</span><span class="tok-na">search</span><span class="tok-o">(</span>
    <span class="tok-s2">&quot;Tests&quot;</span><span class="tok-o">,</span>
    <span class="tok-o">[</span><span class="tok-nl">result:</span> <span class="tok-s1">&#39;top&#39;</span><span class="tok-o">]</span>
<span class="tok-o">)</span>
<span class="tok-k">assert</span> <span class="tok-n">todo</span> <span class="tok-k">instanceof</span> <span class="tok-n">Todo</span>

<span class="tok-c1">//Devuelve todos los objetos de tipo Todo</span>
<span class="tok-c1">//que coincidan con la bÃºsqueda realizada</span>
<span class="tok-kt">def</span> <span class="tok-n">todos</span> <span class="tok-o">=</span> <span class="tok-n">Todo</span><span class="tok-o">.</span><span class="tok-na">search</span><span class="tok-o">(</span>
    <span class="tok-s2">&quot;Tests&quot;</span><span class="tok-o">,</span>
    <span class="tok-o">[</span><span class="tok-nl">reload:</span> <span class="tok-kc">true</span><span class="tok-o">,</span> <span class="tok-nl">result:</span> <span class="tok-s1">&#39;every&#39;</span><span class="tok-o">]</span>
<span class="tok-o">)</span>
<span class="tok-k">assert</span> <span class="tok-n">todos</span><span class="tok-o">.</span><span class="tok-na">each</span> <span class="tok-o">{</span> <span class="tok-n">it</span> <span class="tok-k">instanceof</span> <span class="tok-n">Todo</span> <span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Podemos comprobar estos ejemplos directamente en la consola vista en el plugin anterior.</p>
</div>
<div class="paragraph">
<p>En ocasiones es probable que necesitemos filtrar los resultados de una bÃºsqueda por un determinado parÃ¡metro. Por ejemplo, en nuestra aplicaciÃ³n si quisiÃ©ramos buscar aquellas tareas que pertenezcan a la categorÃ­a "Hogar", deberÃ­amos tener algo asÃ­:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-kt">def</span> <span class="tok-n">todos</span> <span class="tok-o">=</span> <span class="tok-n">Todo</span><span class="tok-o">.</span><span class="tok-na">search</span><span class="tok-o">([</span><span class="tok-nl">result:</span><span class="tok-s1">&#39;every&#39;</span><span class="tok-o">])</span> <span class="tok-o">{</span>
    <span class="tok-n">must</span><span class="tok-o">(</span><span class="tok-n">queryString</span><span class="tok-o">(</span><span class="tok-n">params</span><span class="tok-o">.</span><span class="tok-na">q</span><span class="tok-o">))</span>
    <span class="tok-n">must</span><span class="tok-o">(</span><span class="tok-n">term</span><span class="tok-o">(</span><span class="tok-s1">&#39;$/Todo/category/id&#39;</span><span class="tok-o">,</span><span class="tok-n">Category</span><span class="tok-o">.</span><span class="tok-na">findByName</span><span class="tok-o">(</span><span class="tok-s2">&quot;Hogar&quot;</span><span class="tok-o">)?.</span><span class="tok-na">id</span><span class="tok-o">))</span>
<span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Debemos tambiÃ©n especificar que entre las propiedades a buscar en la clase de dominio Todo se encuentra la propiedad <em>category</em> y la clase <em>Category</em> tambiÃ©n tendrÃ¡ la propiedad estÃ¡tica <em>searchable</em> a cierto para que nos permitan buscar en las instancias de esta clase.</p>
</div>
</div>
<div class="sect3">
<h4 id="_plugin_para_exportar_a_otros_formatos_export">8.4.3. Plugin para exportar a otros formatos: Export</h4>
<div class="paragraph">
<p>Hoy en dÃ­a, cualquier aplicaciÃ³n que se precie debe ser capaz de exportar sus datos a otros formatos para que el usuario tenga la comodidad de elegir como quiere utilizar los datos. Los formatos mÃ¡s comunes a exportar la informaciÃ³n de nuestra aplicaciÃ³n serÃ¡ <em>pdf</em>, <em>hojas de cÃ¡lculo excel</em>, <em>csv (datos separados por comas)</em> u <em>ods (la hoja de cÃ¡lculo de OpenOffice)</em>.</p>
</div>
<div class="paragraph">
<p>Esta tarea que en otros sistemas se vuelve complicada y pesada, en Grails podemos solucionarla utilizando un plugin disponible llamado <em>export</em>. Como siempre, lo primero que vamos a hacer es instalarlo aÃ±adiendo la siguiente lÃ­nea a nuestro archivo <em>BuildConfig.groovy</em>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-n">grails</span><span class="tok-o">.</span><span class="tok-na">project</span><span class="tok-o">.</span><span class="tok-na">dependency</span><span class="tok-o">.</span><span class="tok-na">resolution</span> <span class="tok-o">=</span> <span class="tok-o">{</span>
  <span class="tok-o">...</span>

  <span class="tok-n">repositories</span> <span class="tok-o">{</span>
    <span class="tok-o">...</span>
    <span class="tok-n">mavenRepo</span> <span class="tok-s2">&quot;http://repo.grails.org/grails/core&quot;</span>
  <span class="tok-o">}</span>

  <span class="tok-n">dependencies</span> <span class="tok-o">{</span>
    <span class="tok-o">...</span>
    <span class="tok-n">compile</span> <span class="tok-s1">&#39;commons-beanutils:commons-beanutils:1.8.3&#39;</span>
  <span class="tok-o">}</span>
  <span class="tok-n">plugins</span> <span class="tok-o">{</span>
    <span class="tok-o">...</span>
    <span class="tok-n">compile</span> <span class="tok-s2">&quot;:export:1.7-SNAPSHOT&quot;</span>
  <span class="tok-o">}</span>
<span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Una vez instalado el plugin <em>export</em> debemos aÃ±adir algunos <em>mime types</em> en la variable <em>grails.mime.types</em> del archivo <em>Config.groovy</em>. Los nuevos <em>mime types</em> serÃ¡n los relativos a <em>csv</em>, <em>excel</em>, <em>pdf</em> y <em>ods</em>. La variable <em>grails.mime.types</em> quedarÃ­a asÃ­:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-n">grails</span><span class="tok-o">.</span><span class="tok-na">mime</span><span class="tok-o">.</span><span class="tok-na">types</span> <span class="tok-o">=</span> <span class="tok-o">[</span>
    <span class="tok-nl">all:</span>           <span class="tok-s1">&#39;*/*&#39;</span><span class="tok-o">,</span>
    <span class="tok-nl">atom:</span>          <span class="tok-s1">&#39;application/atom+xml&#39;</span><span class="tok-o">,</span>
    <span class="tok-nl">css:</span>           <span class="tok-s1">&#39;text/css&#39;</span><span class="tok-o">,</span>
    <span class="tok-nl">csv:</span>           <span class="tok-s1">&#39;text/csv&#39;</span><span class="tok-o">,</span>
    <span class="tok-nl">pdf:</span>           <span class="tok-s1">&#39;application/pdf&#39;</span><span class="tok-o">,</span>
    <span class="tok-nl">excel:</span>         <span class="tok-s1">&#39;application/vnd.ms-excel&#39;</span><span class="tok-o">,</span>
    <span class="tok-nl">ods:</span>           <span class="tok-s1">&#39;application/vnd.oasis.opendocument.spreadsheet&#39;</span><span class="tok-o">,</span>
    <span class="tok-nl">form:</span>          <span class="tok-s1">&#39;application/x-www-form-urlencoded&#39;</span><span class="tok-o">,</span>
    <span class="tok-nl">html:</span>          <span class="tok-o">[</span><span class="tok-s1">&#39;text/html&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;application/xhtml+xml&#39;</span><span class="tok-o">],</span>
    <span class="tok-nl">js:</span>            <span class="tok-s1">&#39;text/javascript&#39;</span><span class="tok-o">,</span>
    <span class="tok-nl">json:</span>          <span class="tok-o">[</span><span class="tok-s1">&#39;application/json&#39;</span><span class="tok-o">,</span> <span class="tok-s1">&#39;text/json&#39;</span><span class="tok-o">],</span>
    <span class="tok-nl">multipartForm:</span> <span class="tok-s1">&#39;multipart/form-data&#39;</span><span class="tok-o">,</span>
    <span class="tok-nl">rss:</span>           <span class="tok-s1">&#39;application/rss+xml&#39;</span><span class="tok-o">,</span>
    <span class="tok-nl">text:</span>          <span class="tok-s1">&#39;text/plain&#39;</span><span class="tok-o">,</span>
    <span class="tok-nl">hal:</span>           <span class="tok-o">[</span><span class="tok-s1">&#39;application/hal+json&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;application/hal+xml&#39;</span><span class="tok-o">],</span>
    <span class="tok-nl">xml:</span>           <span class="tok-o">[</span><span class="tok-s1">&#39;text/xml&#39;</span><span class="tok-o">,</span> <span class="tok-s1">&#39;application/xml&#39;</span><span class="tok-o">]</span>
<span class="tok-o">]</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Para empezar a utilizar el plugin, debemos incluir la etiqueta <em>&lt;export:resource/&gt;</em> en la cabecera del archivo GSP donde queramos incluir las opciones para exportar. Esto incluirÃ¡ los archivos CSS necesarios para crear una barra de herramientas con las opciones para exportar la pÃ¡gina actual.</p>
</div>
<div class="paragraph">
<p>El siguiente paso consistirÃ¡ en incluir la barra de herramientas necesaria para exportar la pÃ¡gina HTML generada a algÃºn formato de los ya comentados. Para esto el plugin pone a nuestra disposiciÃ³n una nueva etiqueta <em>&lt;export:formats /&gt;</em>, la cual acepta como parÃ¡metro un listado de los formatos a los que queremos exportar la pÃ¡gina, como por ejemplo <em>&lt;export:formats formats="['csv','excel','ods','pdf','xml']"/&gt;</em>.</p>
</div>
<div class="paragraph">
<p>Si queremos aÃ±adir por ejemplo en la pÃ¡gina que contiene el listado de las tareas una barra para exportar dicho listado, podrÃ­amos tener algo asÃ­ en la pÃ¡gina <em>grails-app/views/todo/index.gsp</em>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-o">&lt;</span><span class="tok-n">html</span><span class="tok-o">&gt;</span>
  <span class="tok-o">&lt;</span><span class="tok-n">head</span><span class="tok-o">&gt;</span>
    <span class="tok-o">...</span>
    <span class="tok-o">&lt;</span><span class="tok-nl">export:</span><span class="tok-n">resource</span><span class="tok-s">/&gt;</span>
<span class="tok-s">  &lt;/</span><span class="tok-n">head</span><span class="tok-o">&gt;</span>
  <span class="tok-o">&lt;</span><span class="tok-n">body</span><span class="tok-o">&gt;</span>
    <span class="tok-o">...</span>
      <span class="tok-o">&lt;</span><span class="tok-n">h1</span><span class="tok-o">&gt;&lt;</span><span class="tok-nl">g:</span><span class="tok-n">message</span> <span class="tok-n">code</span><span class="tok-o">=</span><span class="tok-s2">&quot;default.list.label&quot;</span> <span class="tok-n">args</span><span class="tok-o">=</span><span class="tok-s2">&quot;[entityName]&quot;</span> <span class="tok-s">/&gt;&lt;/</span><span class="tok-n">h1</span><span class="tok-o">&gt;</span>
      <span class="tok-o">&lt;</span><span class="tok-nl">g:</span><span class="tok-k">if</span> <span class="tok-n">test</span><span class="tok-o">=</span><span class="tok-s2">&quot;${flash.message}&quot;</span><span class="tok-o">&gt;</span>
        <span class="tok-o">&lt;</span><span class="tok-n">div</span> <span class="tok-n">class</span><span class="tok-o">=</span><span class="tok-s2">&quot;message&quot;</span> <span class="tok-n">role</span><span class="tok-o">=</span><span class="tok-s2">&quot;status&quot;</span><span class="tok-o">&gt;</span><span class="tok-n">$</span><span class="tok-o">{</span><span class="tok-n">flash</span><span class="tok-o">.</span><span class="tok-na">message</span><span class="tok-o">}&lt;</span><span class="tok-s">/div&gt;</span>
<span class="tok-s">      &lt;/</span><span class="tok-nl">g:</span><span class="tok-k">if</span><span class="tok-o">&gt;</span>
      <span class="tok-o">&lt;</span><span class="tok-nl">export:</span><span class="tok-n">formats</span> <span class="tok-n">formats</span><span class="tok-o">=</span><span class="tok-s2">&quot;[&#39;csv&#39;, &#39;excel&#39;, &#39;ods&#39;, &#39;pdf&#39;, &#39;xml&#39;]&quot;</span> <span class="tok-s">/&gt;</span>
<span class="tok-s">    ...</span>
<span class="tok-s">  &lt;/</span><span class="tok-n">body</span><span class="tok-o">&gt;</span>
<span class="tok-o">&lt;/</span><span class="tok-n">html</span><span class="tok-o">&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Si echamos un vistazo al listado de tareas comprobaremos como en la parte superior de los mismos aparecerÃ¡ una barra con los formatos a los que podamos exportar dicho listado.</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="images/grails08/exportbar.png" alt="Barra para exportar a varios formatos" width="50%">
</div>
</div>
<div class="paragraph">
<p>Sin embargo, si intentamos exportar el listado a cualquier de los formatos utilizados, veremos como no sucede nada nuevo y la aplicaciÃ³n vuelve a mostrarnos el listado tal y como ha aparecido siempre, es decir, en formato HTML. Para que la aplicaciÃ³n pueda exportar a los nuevos formatos, debemos modificar el controlador de la clase de dominio <em>Todo</em> y mÃ¡s en concreto el mÃ©todo <em>index()</em> para que acepte los nuevos formatos.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-kn">package</span> <span class="tok-n">es</span><span class="tok-o">.</span><span class="tok-na">ua</span><span class="tok-o">.</span><span class="tok-na">expertojava</span><span class="tok-o">.</span><span class="tok-na">todo</span>



<span class="tok-kn">import</span> <span class="tok-nn">static</span> <span class="tok-n">org</span><span class="tok-o">.</span><span class="tok-na">springframework</span><span class="tok-o">.</span><span class="tok-na">http</span><span class="tok-o">.</span><span class="tok-na">HttpStatus</span><span class="tok-o">.*</span>
<span class="tok-kn">import</span> <span class="tok-nn">grails.transaction.Transactional</span>

<span class="tok-nd">@Transactional</span><span class="tok-o">(</span><span class="tok-n">readOnly</span> <span class="tok-o">=</span> <span class="tok-kc">true</span><span class="tok-o">)</span>
<span class="tok-kd">class</span> <span class="tok-nc">TodoController</span> <span class="tok-o">{</span>

    <span class="tok-kt">def</span> <span class="tok-n">todoService</span>
    <span class="tok-kt">def</span> <span class="tok-n">springSecurityService</span>
    <span class="tok-kt">def</span> <span class="tok-n">exportService</span>

    <span class="tok-kd">static</span> <span class="tok-n">allowedMethods</span> <span class="tok-o">=</span> <span class="tok-o">[</span><span class="tok-nl">save:</span> <span class="tok-s2">&quot;POST&quot;</span><span class="tok-o">,</span> <span class="tok-nl">update:</span> <span class="tok-s2">&quot;PUT&quot;</span><span class="tok-o">,</span> <span class="tok-nl">delete:</span> <span class="tok-s2">&quot;DELETE&quot;</span><span class="tok-o">]</span>

    <span class="tok-kt">def</span> <span class="tok-nf">index</span><span class="tok-o">(</span><span class="tok-n">Integer</span> <span class="tok-n">max</span><span class="tok-o">)</span> <span class="tok-o">{</span>
        <span class="tok-n">params</span><span class="tok-o">.</span><span class="tok-na">max</span> <span class="tok-o">=</span> <span class="tok-n">Math</span><span class="tok-o">.</span><span class="tok-na">min</span><span class="tok-o">(</span><span class="tok-n">max</span> <span class="tok-o">?:</span> <span class="tok-mi">10</span><span class="tok-o">,</span> <span class="tok-mi">100</span><span class="tok-o">)</span>
        <span class="tok-k">if</span><span class="tok-o">(</span><span class="tok-n">params</span><span class="tok-o">?.</span><span class="tok-na">f</span> <span class="tok-o">&amp;&amp;</span> <span class="tok-n">params</span><span class="tok-o">.</span><span class="tok-na">f</span> <span class="tok-o">!=</span> <span class="tok-s2">&quot;html&quot;</span><span class="tok-o">){</span>
            <span class="tok-n">response</span><span class="tok-o">.</span><span class="tok-na">contentType</span> <span class="tok-o">=</span> <span class="tok-n">grailsApplication</span><span class="tok-o">.</span><span class="tok-na">config</span><span class="tok-o">.</span><span class="tok-na">grails</span><span class="tok-o">.</span><span class="tok-na">mime</span><span class="tok-o">.</span><span class="tok-na">types</span><span class="tok-o">[</span><span class="tok-n">params</span><span class="tok-o">.</span><span class="tok-na">f</span><span class="tok-o">]</span>
            <span class="tok-n">response</span><span class="tok-o">.</span><span class="tok-na">setHeader</span><span class="tok-o">(</span><span class="tok-s2">&quot;Content-disposition&quot;</span><span class="tok-o">,</span> <span class="tok-s2">&quot;attachment; filename=todos.${params.extension}&quot;</span><span class="tok-o">)</span>
            <span class="tok-n">exportService</span><span class="tok-o">.</span><span class="tok-na">export</span><span class="tok-o">(</span><span class="tok-n">params</span><span class="tok-o">.</span><span class="tok-na">f</span><span class="tok-o">,</span> <span class="tok-n">response</span><span class="tok-o">.</span><span class="tok-na">outputStream</span><span class="tok-o">,</span> <span class="tok-n">Todo</span><span class="tok-o">.</span><span class="tok-na">findAllByUser</span><span class="tok-o">(</span><span class="tok-n">springSecurityService</span><span class="tok-o">.</span><span class="tok-na">currentUser</span><span class="tok-o">,</span> <span class="tok-n">params</span><span class="tok-o">),</span> <span class="tok-o">[:],</span> <span class="tok-o">[:])</span>
        <span class="tok-o">}</span>
        <span class="tok-n">respond</span> <span class="tok-n">Todo</span><span class="tok-o">.</span><span class="tok-na">findAllByUser</span><span class="tok-o">(</span><span class="tok-n">springSecurityService</span><span class="tok-o">.</span><span class="tok-na">currentUser</span><span class="tok-o">,</span> <span class="tok-n">params</span><span class="tok-o">),</span> <span class="tok-nl">model:</span><span class="tok-o">[</span><span class="tok-nl">todoInstanceCount:</span> <span class="tok-n">Todo</span><span class="tok-o">.</span><span class="tok-na">countByUser</span><span class="tok-o">(</span><span class="tok-n">springSecurityService</span><span class="tok-o">.</span><span class="tok-na">currentUser</span><span class="tok-o">)]</span>
    <span class="tok-o">}</span>
  <span class="tok-o">...</span>
<span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Ahora nuestra aplicaciÃ³n sÃ­ va a ser capaz de exportar a otros formatos para que el usuario final elija cual de ellos utilizar en cada ocasiÃ³n. Sin embargo, si echamos un vistazo por ejemplo al formato en PDF, comprobaremos como el listado que aparece muestra todas las propiedades de la clase <em>Todo</em>, a excepciÃ³n de la propiedad <em>version</em>, lo cual no va a ser aconsejable.</p>
</div>
<div class="paragraph">
<p>Para mejorar esto, el plugin permite especificar que propiedades queremos mostrar e incluso la etiqueta que queremos que aparezca en la fila de encabezados de la tabla. Para conseguir esto, necesitamos completar los dos Ãºltimos parÃ¡metros del mÃ©todo <em>export()</em> que anteriormente dejÃ¡bamos vacÃ­os. AdemÃ¡s, tambiÃ©n necesitaremos indicarle el formato de como deseamos las propiedades de los usuarios y un mapa de parÃ¡metros para el fichero exportado. AsÃ­ quedarÃ­a el mÃ©todo <em>index()</em>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-kt">def</span> <span class="tok-nf">index</span><span class="tok-o">(</span><span class="tok-n">Integer</span> <span class="tok-n">max</span><span class="tok-o">)</span> <span class="tok-o">{</span>
    <span class="tok-n">params</span><span class="tok-o">.</span><span class="tok-na">max</span> <span class="tok-o">=</span> <span class="tok-n">Math</span><span class="tok-o">.</span><span class="tok-na">min</span><span class="tok-o">(</span><span class="tok-n">max</span> <span class="tok-o">?:</span> <span class="tok-mi">10</span><span class="tok-o">,</span> <span class="tok-mi">100</span><span class="tok-o">)</span>
    <span class="tok-k">if</span><span class="tok-o">(</span><span class="tok-n">params</span><span class="tok-o">?.</span><span class="tok-na">f</span> <span class="tok-o">&amp;&amp;</span> <span class="tok-n">params</span><span class="tok-o">.</span><span class="tok-na">f</span> <span class="tok-o">!=</span> <span class="tok-s2">&quot;html&quot;</span><span class="tok-o">){</span>
        <span class="tok-n">response</span><span class="tok-o">.</span><span class="tok-na">contentType</span> <span class="tok-o">=</span> <span class="tok-n">grailsApplication</span><span class="tok-o">.</span><span class="tok-na">config</span><span class="tok-o">.</span><span class="tok-na">grails</span><span class="tok-o">.</span><span class="tok-na">mime</span><span class="tok-o">.</span><span class="tok-na">types</span><span class="tok-o">[</span><span class="tok-n">params</span><span class="tok-o">.</span><span class="tok-na">f</span><span class="tok-o">]</span>
        <span class="tok-n">response</span><span class="tok-o">.</span><span class="tok-na">setHeader</span><span class="tok-o">(</span><span class="tok-s2">&quot;Content-disposition&quot;</span><span class="tok-o">,</span> <span class="tok-s2">&quot;attachment; filename=todos.${params.extension}&quot;</span><span class="tok-o">)</span>

        <span class="tok-n">List</span> <span class="tok-n">props</span> <span class="tok-o">=</span> <span class="tok-o">[</span><span class="tok-s2">&quot;title&quot;</span><span class="tok-o">,</span> <span class="tok-s2">&quot;description&quot;</span><span class="tok-o">,</span> <span class="tok-s2">&quot;date&quot;</span><span class="tok-o">,</span> <span class="tok-s2">&quot;url&quot;</span><span class="tok-o">,</span> <span class="tok-s2">&quot;done&quot;</span><span class="tok-o">]</span>
        <span class="tok-n">Map</span> <span class="tok-n">tags</span> <span class="tok-o">=</span> <span class="tok-o">[</span><span class="tok-s2">&quot;title&quot;</span><span class="tok-o">:</span><span class="tok-s2">&quot;TÃ­tulo&quot;</span><span class="tok-o">,</span>
                     <span class="tok-s2">&quot;description&quot;</span><span class="tok-o">:</span><span class="tok-s2">&quot;DescripciÃ³n&quot;</span><span class="tok-o">,</span>
                     <span class="tok-s2">&quot;date&quot;</span><span class="tok-o">:</span><span class="tok-s2">&quot;Fecha&quot;</span><span class="tok-o">,</span>
                     <span class="tok-s2">&quot;url&quot;</span><span class="tok-o">:</span><span class="tok-s2">&quot;URL&quot;</span><span class="tok-o">,</span>
                     <span class="tok-s2">&quot;done&quot;</span><span class="tok-o">:</span><span class="tok-s2">&quot;Hecho&quot;</span><span class="tok-o">]</span>

        <span class="tok-c1">// Closure formateador</span>
        <span class="tok-kt">def</span> <span class="tok-n">uppercase</span> <span class="tok-o">=</span> <span class="tok-o">{</span> <span class="tok-n">domain</span><span class="tok-o">,</span> <span class="tok-n">value</span> <span class="tok-o">-&gt;</span>  <span class="tok-k">return</span> <span class="tok-n">value</span><span class="tok-o">.</span><span class="tok-na">toUpperCase</span><span class="tok-o">()</span> <span class="tok-o">}</span>

        <span class="tok-n">Map</span> <span class="tok-n">formatters</span> <span class="tok-o">=</span> <span class="tok-o">[</span><span class="tok-nl">title:</span> <span class="tok-n">uppercase</span><span class="tok-o">]</span>
        <span class="tok-n">Map</span> <span class="tok-n">parameters</span> <span class="tok-o">=</span> <span class="tok-o">[</span><span class="tok-nl">title:</span> <span class="tok-s2">&quot;LISTADO DE USUARIOS&quot;</span><span class="tok-o">]</span>

        <span class="tok-n">exportService</span><span class="tok-o">.</span><span class="tok-na">export</span><span class="tok-o">(</span><span class="tok-n">params</span><span class="tok-o">.</span><span class="tok-na">f</span><span class="tok-o">,</span> <span class="tok-n">response</span><span class="tok-o">.</span><span class="tok-na">outputStream</span><span class="tok-o">,</span>
            <span class="tok-n">Todo</span><span class="tok-o">.</span><span class="tok-na">findAllByUser</span><span class="tok-o">(</span><span class="tok-n">springSecurityService</span><span class="tok-o">.</span><span class="tok-na">currentUser</span><span class="tok-o">,</span> <span class="tok-n">params</span><span class="tok-o">),</span> <span class="tok-n">props</span><span class="tok-o">,</span> <span class="tok-n">tags</span><span class="tok-o">,</span>
            <span class="tok-n">formatters</span><span class="tok-o">,</span> <span class="tok-n">parameters</span><span class="tok-o">)</span>
    <span class="tok-o">}</span>
    <span class="tok-n">respond</span> <span class="tok-n">Todo</span><span class="tok-o">.</span><span class="tok-na">findAllByUser</span><span class="tok-o">(</span><span class="tok-n">springSecurityService</span><span class="tok-o">.</span><span class="tok-na">currentUser</span><span class="tok-o">,</span> <span class="tok-n">params</span><span class="tok-o">),</span> <span class="tok-nl">model:</span><span class="tok-o">[</span><span class="tok-nl">todoInstanceCount:</span> <span class="tok-n">Todo</span><span class="tok-o">.</span><span class="tok-na">countByUser</span><span class="tok-o">(</span><span class="tok-n">springSecurityService</span><span class="tok-o">.</span><span class="tok-na">currentUser</span><span class="tok-o">)]</span>
<span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Por Ãºltimo, comentar tambiÃ©n que podemos cambiar los textos asociados a cada uno de los formatos que aparecen en la barra para exportar. Simplemente debemos crear nuevas entradas en el archivo <em>grails-app/i18n/messages.properties</em> correspondientes, tal y como aparece en el siguiente fragmento de cÃ³digo.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-k">default</span><span class="tok-o">.</span><span class="tok-na">csv</span> <span class="tok-o">=</span> <span class="tok-n">CSV</span>
<span class="tok-k">default</span><span class="tok-o">.</span><span class="tok-na">excel</span> <span class="tok-o">=</span> <span class="tok-n">EXCEL</span>
<span class="tok-k">default</span><span class="tok-o">.</span><span class="tok-na">pdf</span> <span class="tok-o">=</span> <span class="tok-n">PDF</span>
<span class="tok-k">default</span><span class="tok-o">.</span><span class="tok-na">xml</span> <span class="tok-o">=</span> <span class="tok-n">XML</span>
<span class="tok-k">default</span><span class="tok-o">.</span><span class="tok-na">ods</span> <span class="tok-o">=</span> <span class="tok-n">ODS</span></code></pre>
</div>
</div>
<div style="page-break-after: always;"></div>
</div>
</div>
<div class="sect2">
<h3 id="_ejercicios_8">8.5. Ejercicios</h3>
<div class="sect3">
<h4 id="_log_de_acceso_a_controladores_0_25_puntos">8.5.1. Log de acceso a controladores (0.25 puntos)</h4>
<div class="paragraph">
<p>Con lo visto en esta sesiÃ³n sobre la configuraciÃ³n de los logs y lo visto en la sesiÃ³n 4 de los filtros que se pueden crear en los controladores, genera logs de tipo <em>trace</em> en todos los mÃ©todos de los controladores de nuestra aplicaciÃ³n (sin incluir los controladores <em>login</em> y <em>logout</em> del plugin spring security) para saber el usuario, controlador, mÃ©todo y modelo utilizados en la peticiÃ³n.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="bash">2015-03-28 11:13:15,863 <span class="tok-o">[</span>http-bio-8080-exec-9<span class="tok-o">]</span> TRACE todo.LogFilters  - User admin - Controlador category - Accion index - Modelo <span class="tok-o">[</span>categoryInstanceCount:2, categoryInstanceList:<span class="tok-o">[</span>Hogar, Trabajo<span class="tok-o">]]</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Estos logs deberÃ¡n ser almacenados en un archivo llamados <em>logs/filters.log</em>.</p>
</div>
</div>
<div class="sect3">
<h4 id="_url_limpia_y_pÃºblica_para_las_tareas_de_los_usuarios_0_50_puntos">8.5.2. URL limpia y pÃºblica para las tareas de los usuarios (0.50 puntos)</h4>
<div class="paragraph">
<p>Crea una url del tipo <em>/todos/$username</em> como la vista en la parte de teorÃ­a que muestre todas las tareas del usuario pasado por parÃ¡metro en la URL. Este listado de tareas sÃ³lo podrÃ¡ ser accesible por los usuarios de tipo administrador.</p>
</div>
<div class="paragraph">
<p>Modifica tambiÃ©n el listado de usuarios que pueden ver los administradores para mostrar un enlace en cada usuario para que les permita ver este listado de tareas. AdemÃ¡s, este enlace sÃ³lo debe ser mostrado para los usuarios que puedan tener tareas, no para los administradores.</p>
</div>
</div>
<div class="sect3">
<h4 id="_buscador_de_tareas_integrado_0_50_puntos">8.5.3. Buscador de tareas integrado (0.50 puntos)</h4>
<div class="paragraph">
<p>El listado de tareas pide a gritos un buscador integrado. ImplemÃ©ntalo utilizando el plugin <em>searchable</em> y muÃ©stralo en la parte superior del listado de las tareas. Date cuenta que las tareas estÃ¡n ahora asignadas a un usuario y que por lo tanto, el buscador sÃ³lo deberÃ¡ buscar aquellas tareas que pertenezcan al usuario autenticado.</p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Estoy seguro que no hace falta que te lo recuerde, pero antes de entregar el proyecto ejecuta <em>grails test-app unit:</em> para comprobar que no hayas <em>roto</em> tus tests haciendo otras tareas.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
</div>
</div>
</div>
<div id="footer">
<div id="footer-text">
Last updated 2015-01-16 20:36:35 CET
</div>
</div>
</body>
</html>