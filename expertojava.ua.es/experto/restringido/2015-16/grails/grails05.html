<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<!--[if IE]><meta http-equiv="X-UA-Compatible" content="IE=edge"><![endif]-->
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 1.5.2">
<meta name="author" content="Fran García">
<title>Grails</title>
<style>/*! normalize.css v2.1.2 | MIT License | git.io/normalize */
/* ========================================================================== HTML5 display definitions ========================================================================== */
/** Correct `block` display not defined in IE 8/9. */
article, aside, details, figcaption, figure, footer, header, hgroup, main, nav, section, summary { display: block; }

/** Correct `inline-block` display not defined in IE 8/9. */
audio, canvas, video { display: inline-block; }

/** Prevent modern browsers from displaying `audio` without controls. Remove excess height in iOS 5 devices. */
audio:not([controls]) { display: none; height: 0; }

/** Address `[hidden]` styling not present in IE 8/9. Hide the `template` element in IE, Safari, and Firefox < 22. */
[hidden], template { display: none; }

script { display: none !important; }

/* ========================================================================== Base ========================================================================== */
/** 1. Set default font family to sans-serif. 2. Prevent iOS text size adjust after orientation change, without disabling user zoom. */
html { font-family: sans-serif; /* 1 */ -ms-text-size-adjust: 100%; /* 2 */ -webkit-text-size-adjust: 100%; /* 2 */ }

/** Remove default margin. */
body { margin: 0; }

/* ========================================================================== Links ========================================================================== */
/** Remove the gray background color from active links in IE 10. */
a { background: transparent; }

/** Address `outline` inconsistency between Chrome and other browsers. */
a:focus { outline: thin dotted; }

/** Improve readability when focused and also mouse hovered in all browsers. */
a:active, a:hover { outline: 0; }

/* ========================================================================== Typography ========================================================================== */
/** Address variable `h1` font-size and margin within `section` and `article` contexts in Firefox 4+, Safari 5, and Chrome. */
h1 { font-size: 2em; margin: 0.67em 0; }

/** Address styling not present in IE 8/9, Safari 5, and Chrome. */
abbr[title] { border-bottom: 1px dotted; }

/** Address style set to `bolder` in Firefox 4+, Safari 5, and Chrome. */
b, strong { font-weight: bold; }

/** Address styling not present in Safari 5 and Chrome. */
dfn { font-style: italic; }

/** Address differences between Firefox and other browsers. */
hr { -moz-box-sizing: content-box; box-sizing: content-box; height: 0; }

/** Address styling not present in IE 8/9. */
mark { background: #ff0; color: #000; }

/** Correct font family set oddly in Safari 5 and Chrome. */
code, kbd, pre, samp { font-family: monospace, serif; font-size: 1em; }

/** Improve readability of pre-formatted text in all browsers. */
pre { white-space: pre-wrap; }

/** Set consistent quote types. */
q { quotes: "\201C" "\201D" "\2018" "\2019"; }

/** Address inconsistent and variable font size in all browsers. */
small { font-size: 80%; }

/** Prevent `sub` and `sup` affecting `line-height` in all browsers. */
sub, sup { font-size: 75%; line-height: 0; position: relative; vertical-align: baseline; }

sup { top: -0.5em; }

sub { bottom: -0.25em; }

/* ========================================================================== Embedded content ========================================================================== */
/** Remove border when inside `a` element in IE 8/9. */
img { border: 0; }

/** Correct overflow displayed oddly in IE 9. */
svg:not(:root) { overflow: hidden; }

/* ========================================================================== Figures ========================================================================== */
/** Address margin not present in IE 8/9 and Safari 5. */
figure { margin: 0; }

/* ========================================================================== Forms ========================================================================== */
/** Define consistent border, margin, and padding. */
fieldset { border: 1px solid #c0c0c0; margin: 0 2px; padding: 0.35em 0.625em 0.75em; }

/** 1. Correct `color` not being inherited in IE 8/9. 2. Remove padding so people aren't caught out if they zero out fieldsets. */
legend { border: 0; /* 1 */ padding: 0; /* 2 */ }

/** 1. Correct font family not being inherited in all browsers. 2. Correct font size not being inherited in all browsers. 3. Address margins set differently in Firefox 4+, Safari 5, and Chrome. */
button, input, select, textarea { font-family: inherit; /* 1 */ font-size: 100%; /* 2 */ margin: 0; /* 3 */ }

/** Address Firefox 4+ setting `line-height` on `input` using `!important` in the UA stylesheet. */
button, input { line-height: normal; }

/** Address inconsistent `text-transform` inheritance for `button` and `select`. All other form control elements do not inherit `text-transform` values. Correct `button` style inheritance in Chrome, Safari 5+, and IE 8+. Correct `select` style inheritance in Firefox 4+ and Opera. */
button, select { text-transform: none; }

/** 1. Avoid the WebKit bug in Android 4.0.* where (2) destroys native `audio` and `video` controls. 2. Correct inability to style clickable `input` types in iOS. 3. Improve usability and consistency of cursor style between image-type `input` and others. */
button, html input[type="button"], input[type="reset"], input[type="submit"] { -webkit-appearance: button; /* 2 */ cursor: pointer; /* 3 */ }

/** Re-set default cursor for disabled elements. */
button[disabled], html input[disabled] { cursor: default; }

/** 1. Address box sizing set to `content-box` in IE 8/9. 2. Remove excess padding in IE 8/9. */
input[type="checkbox"], input[type="radio"] { box-sizing: border-box; /* 1 */ padding: 0; /* 2 */ }

/** 1. Address `appearance` set to `searchfield` in Safari 5 and Chrome. 2. Address `box-sizing` set to `border-box` in Safari 5 and Chrome (include `-moz` to future-proof). */
input[type="search"] { -webkit-appearance: textfield; /* 1 */ -moz-box-sizing: content-box; -webkit-box-sizing: content-box; /* 2 */ box-sizing: content-box; }

/** Remove inner padding and search cancel button in Safari 5 and Chrome on OS X. */
input[type="search"]::-webkit-search-cancel-button, input[type="search"]::-webkit-search-decoration { -webkit-appearance: none; }

/** Remove inner padding and border in Firefox 4+. */
button::-moz-focus-inner, input::-moz-focus-inner { border: 0; padding: 0; }

/** 1. Remove default vertical scrollbar in IE 8/9. 2. Improve readability and alignment in all browsers. */
textarea { overflow: auto; /* 1 */ vertical-align: top; /* 2 */ }

/* ========================================================================== Tables ========================================================================== */
/** Remove most spacing between table cells. */
table { border-collapse: collapse; border-spacing: 0; }

meta.foundation-mq-small { font-family: "only screen and (min-width: 768px)"; width: 768px; }

meta.foundation-mq-medium { font-family: "only screen and (min-width:1280px)"; width: 1280px; }

meta.foundation-mq-large { font-family: "only screen and (min-width:1440px)"; width: 1440px; }

*, *:before, *:after { -moz-box-sizing: border-box; -webkit-box-sizing: border-box; box-sizing: border-box; }

html, body { font-size: 97%; }

body { background: white; color: #222222; padding: 0; margin: 0; font-family: "Helvetica Neue", "Helvetica", Helvetica, Arial, sans-serif; font-weight: normal; font-style: normal; line-height: 1; position: relative; cursor: auto; }

a:hover { cursor: pointer; }

img, object, embed { max-width: 100%; height: auto; }

object, embed { height: 100%; }

img { -ms-interpolation-mode: bicubic; }

#map_canvas img, #map_canvas embed, #map_canvas object, .map_canvas img, .map_canvas embed, .map_canvas object { max-width: none !important; }

.left { float: left !important; }

.right { float: right !important; }

.text-left { text-align: left !important; }

.text-right { text-align: right !important; }

.text-center { text-align: center !important; }

.text-justify { text-align: justify !important; }

.hide { display: none; }

.antialiased, body { -webkit-font-smoothing: antialiased; }

img { display: inline-block; vertical-align: middle; }

textarea { height: auto; min-height: 50px; }

select { width: 100%; }

p.lead, .paragraph.lead > p, #preamble > .sectionbody > .paragraph:first-of-type p { font-size: 1.21875em; line-height: 1.6; }

.subheader, .admonitionblock td.content > .title, .audioblock > .title, .exampleblock > .title, .imageblock > .title, .listingblock > .title, .literalblock > .title, .stemblock > .title, .openblock > .title, .paragraph > .title, .quoteblock > .title, table.tableblock > .title, .verseblock > .title, .videoblock > .title, .dlist > .title, .olist > .title, .ulist > .title, .qlist > .title, .hdlist > .title { line-height: 1.4; color: #6f6f6f; font-weight: 300; margin-top: 0.2em; margin-bottom: 0.5em; }

/* Typography resets */
div, dl, dt, dd, ul, ol, li, h1, h2, h3, #toctitle, .sidebarblock > .content > .title, h4, h5, h6, pre, form, p, blockquote, th, td { margin: 0; padding: 0; direction: ltr; }

/* Default Link Styles */
a { color: #1164be; text-decoration: none; line-height: inherit; }
a img { border: none; }

/* Default paragraph styles */
p { font-family: inherit; font-weight: normal; font-size: 1em; line-height: 1.4; margin-bottom: 1em; text-rendering: optimizeLegibility; }
p aside { font-size: 0.875em; line-height: 1.35; font-style: italic; }

/* Default header styles */
h1, h2, h3, #toctitle, .sidebarblock > .content > .title, h4, h5, h6 { font-family: "Helvetica Neue", "Helvetica", Helvetica, Arial, sans-serif; font-weight: bold; font-style: normal; color: #1c355e; text-rendering: optimizeLegibility; margin-top: 1em; margin-bottom: 0.5em; line-height: 1.2125em; }
h1 small, h2 small, h3 small, #toctitle small, .sidebarblock > .content > .title small, h4 small, h5 small, h6 small { font-size: 60%; color: #6f6f6f; line-height: 0; }

h1 { font-size: 2.125em; }

h2 { font-size: 1.6875em; }

h3, #toctitle, .sidebarblock > .content > .title { font-size: 1.375em; }

h4 { font-size: 1.125em; }

h5 { font-size: 1.125em; }

h6 { font-size: 1em; }

hr { border: solid #dddddd; border-width: 1px 0 0; clear: both; margin: 1.25em 0 1.1875em; height: 0; }

/* Helpful Typography Defaults */
em, i { font-style: italic; line-height: inherit; }

strong, b { font-weight: bold; line-height: inherit; }

small { font-size: 60%; line-height: inherit; }

code { font-family: Consolas, "Liberation Mono", Courier, monospace; font-weight: bold; }

/* Lists */
ul, ol, dl { font-size: 1em; line-height: 1.4; margin-bottom: 1.25em; list-style-position: outside; font-family: inherit; }

ul, ol { margin-left: 2.5em; }
ul.no-bullet, ol.no-bullet { margin-left: 1.5em; }

/* Unordered Lists */
ul li ul, ul li ol { margin-left: 1.25em; margin-bottom: 0; font-size: 1em; /* Override nested font-size change */ }
ul.square li ul, ul.circle li ul, ul.disc li ul { list-style: inherit; }
ul.square { list-style-type: square; }
ul.circle { list-style-type: circle; }
ul.disc { list-style-type: disc; }
ul.no-bullet { list-style: none; }

/* Ordered Lists */
ol li ul, ol li ol { margin-left: 1.25em; margin-bottom: 0; }

/* Definition Lists */
dl dt { margin-bottom: 0.3125em; font-weight: bold; }
dl dd { margin-bottom: 1.25em; }

/* Abbreviations */
abbr, acronym { text-transform: uppercase; font-size: 90%; color: #222222; border-bottom: 1px dotted #dddddd; cursor: help; }

abbr { text-transform: none; }

/* Blockquotes */
blockquote { margin: 0 0 1.25em; padding: 0.5625em 1.25em 0 1.1875em; border-left: 1px solid #dddddd; }
blockquote cite { display: block; font-size: 0.8125em; color: #555555; }
blockquote cite:before { content: "\2014 \0020"; }
blockquote cite a, blockquote cite a:visited { color: #555555; }

blockquote, blockquote p { line-height: 1.6; color: #6f6f6f; }

/* Microformats */
.vcard { display: inline-block; margin: 0 0 1.25em 0; border: 1px solid #dddddd; padding: 0.625em 0.75em; }
.vcard li { margin: 0; display: block; }
.vcard .fn { font-weight: bold; font-size: 0.9375em; }

.vevent .summary { font-weight: bold; }
.vevent abbr { cursor: auto; text-decoration: none; font-weight: bold; border: none; padding: 0 0.0625em; }

/*@media only screen and (min-width: 768px) { h1, h2, h3, #toctitle, .sidebarblock > .content > .title, h4, h5, h6 { line-height: 1.4; }
  h1 { font-size: 2.75em; }
  h2 { font-size: 2.3125em; }
  h3, #toctitle, .sidebarblock > .content > .title { font-size: 1.6875em; }
  h4 { font-size: 1.4375em; } }*/
/* Tables */
table { background: white; margin-bottom: 1.25em; border: solid 1px #dddddd; }
table thead, table tfoot { background: whitesmoke; font-weight: bold; }
table thead tr th, table thead tr td, table tfoot tr th, table tfoot tr td { padding: 0.5em 0.625em 0.625em; font-size: inherit; color: #222222; text-align: left; }
table tr th, table tr td { padding: 0.5625em 0.625em; font-size: inherit; color: #222222; }
table tr.even, table tr.alt, table tr:nth-of-type(even) { background: #f9f9f9; }
table thead tr th, table tfoot tr th, table tbody tr td, table tr td, table tfoot tr td { display: table-cell; line-height: 1.4; }

h1, h2, h3, #toctitle, .sidebarblock > .content > .title, h4, h5, h6 { line-height: 1.4; border-bottom: 1px solid #dddddd }

.clearfix:before, .clearfix:after, .float-group:before, .float-group:after { content: " "; display: table; }
.clearfix:after, .float-group:after { clear: both; }

*:not(pre) > code { font-size: inherit; font-style: normal !important; letter-spacing: 0; padding: 3px 2px 1px 2px; background-color: #eeeeee; border: 1px solid #dddddd; -webkit-border-radius: 0; border-radius: 0; line-height: inherit; font-weight: normal; }

pre, pre > code { line-height: 1.4; color: black; font-family: monospace, serif; font-weight: normal; }

.keyseq { color: #555555; }

kbd { display: inline-block; color: #222222; font-size: 0.75em; line-height: 1.4; background-color: #f7f7f7; border: 1px solid #ccc; -webkit-border-radius: 3px; border-radius: 3px; -webkit-box-shadow: 0 1px 0 rgba(0, 0, 0, 0.2), 0 0 0 0.1em white inset; box-shadow: 0 1px 0 rgba(0, 0, 0, 0.2), 0 0 0 0.1em white inset; margin: -0.15em 0.15em 0 0.15em; padding: 0.2em 0.6em 0.2em 0.5em; vertical-align: middle; white-space: nowrap; }

.keyseq kbd:first-child { margin-left: 0; }

.keyseq kbd:last-child { margin-right: 0; }

.menuseq, .menu { color: #090909; }

b.button:before, b.button:after { position: relative; top: -1px; font-weight: normal; }

b.button:before { content: "["; padding: 0 3px 0 2px; }

b.button:after { content: "]"; padding: 0 2px 0 3px; }

#header, #content, #footnotes, #footer { width: 100%; margin-left: auto; margin-right: auto; margin-top: 0; margin-bottom: 0; max-width: 62.5em; *zoom: 1; position: relative; padding-left: 0.9375em; padding-right: 0.9375em; }
#header:before, #header:after, #content:before, #content:after, #footnotes:before, #footnotes:after, #footer:before, #footer:after { content: " "; display: table; }
#header:after, #content:after, #footnotes:after, #footer:after { clear: both; }

#content { margin-top: 1.25em; }

#content:before { content: none; }

#header > h1:first-child { color: black; margin-top: 2.25rem; margin-bottom: 0; }
#header > h1:first-child + #toc { margin-top: 8px; border-top: 1px solid #dddddd; }
#header > h1:only-child, body.toc2 #header > h1:nth-last-child(2) { border-bottom: 1px solid #dddddd; padding-bottom: 8px; }
#header .details { border-bottom: 1px solid #dddddd; line-height: 1.45; padding-top: 0.25em; padding-bottom: 0.25em; padding-left: 0.25em; color: #555555; display: -ms-flexbox; display: -webkit-flex; display: flex; -ms-flex-flow: row wrap; -webkit-flex-flow: row wrap; flex-flow: row wrap; }
#header .details span:first-child { margin-left: -0.125em; }
#header .details span.email a { color: #6f6f6f; }
#header .details br { display: none; }
#header .details br + span:before { content: "\00a0\2013\00a0"; }
#header .details br + span.author:before { content: "\00a0\22c5\00a0"; color: #6f6f6f; }
#header .details br + span#revremark:before { content: "\00a0|\00a0"; }
#header #revnumber { text-transform: capitalize; }
#header #revnumber:after { content: "\00a0"; }

#content > h1:first-child:not([class]) { color: black; border-bottom: 1px solid #dddddd; padding-bottom: 8px; margin-top: 0; padding-top: 1rem; margin-bottom: 1.25rem; }

#floating {
  position: fixed;
  z-index: 1000;
  padding: 0.5em;
  right: 0;
  top: 0;
  background: white;
  box-shadow: 0 0 1em #777777;
  -webkit-box-shadow: 0 0 1em #777777;
  -moz-box-shadow: 0 0 1em #777777;
  -webkit-border-bottom-left-radius: 5px;
  -moz-border-radius-bottomleft: 5px;
  max-height: 80%;
  overflow: auto;
}

#floating #full { display: none; } /* Hide the full TOC by default */

#floating:hover #full{
  display: block; /* Show it on hover */
}


#toc { border-bottom: 1px solid #dddddd; padding-bottom: 0.5em; }
#toc > ul { margin-left: 0.125em; }
#toc ul.sectlevel0 > li > a { font-style: italic; }
#toc ul.sectlevel0 ul.sectlevel1 { margin: 0.5em 0; }
#toc ul { font-family: "Helvetica Neue", "Helvetica", Helvetica, Arial, sans-serif; list-style-type: none; }
#toc a { text-decoration: none; }
#toc a:active { text-decoration: underline; }

#toctitle { color: #6f6f6f; font-size: 1.2em; }

@media only screen and (min-width: 768px) { #toctitle { font-size: 1.375em; }
  body.toc2 { padding-left: 15em; padding-right: 0; }
  #toc.toc2 { margin-top: 0 !important; background-color: #f2f2f2; position: fixed; width: 15em; left: 0; top: 0; border-right: 1px solid #dddddd; border-top-width: 0 !important; border-bottom-width: 0 !important; z-index: 1000; padding: 1.25em 1em; height: 100%; overflow: auto; }
  #toc.toc2 #toctitle { margin-top: 0; font-size: 1.2em; }
  #toc.toc2 > ul { font-size: 0.9em; margin-bottom: 0; }
  #toc.toc2 ul ul { margin-left: 0; padding-left: 1em; }
  #toc.toc2 ul.sectlevel0 ul.sectlevel1 { padding-left: 0; margin-top: 0.5em; margin-bottom: 0.5em; }
  body.toc2.toc-right { padding-left: 0; padding-right: 15em; }
  body.toc2.toc-right #toc.toc2 { border-right-width: 0; border-left: 1px solid #dddddd; left: auto; right: 0; } }
@media only screen and (min-width: 1280px) { body.toc2 { padding-left: 20em; padding-right: 0; }
  #toc.toc2 { width: 20em; }
  #toc.toc2 #toctitle { font-size: 1.375em; }
  #toc.toc2 > ul { font-size: 0.95em; }
  #toc.toc2 ul ul { padding-left: 1.25em; }
  body.toc2.toc-right { padding-left: 0; padding-right: 20em; } }
#content #toc { border-style: solid; border-width: 1px; border-color: #d9d9d9; margin-bottom: 1.25em; padding: 1.25em; background: #f2f2f2; -webkit-border-radius: 0; border-radius: 0; }
#content #toc > :first-child { margin-top: 0; }
#content #toc > :last-child { margin-bottom: 0; }

#footer { max-width: 100%; background-color: #222222; padding: 1.25em; }

#footer-text { color: #dddddd; line-height: 1.44; }

.sect1 { padding-bottom: 0.625em; }

@media only screen and (min-width: 768px) { .sect1 { padding-bottom: 1.25em; } }
.sect1 + .sect1 { border-top: 1px solid #dddddd; }

#content h1 > a.anchor, h2 > a.anchor, h3 > a.anchor, #toctitle > a.anchor, .sidebarblock > .content > .title > a.anchor, h4 > a.anchor, h5 > a.anchor, h6 > a.anchor { position: absolute; z-index: 1001; width: 1.5ex; margin-left: -1.5ex; display: block; text-decoration: none !important; visibility: hidden; text-align: center; font-weight: normal; }
#content h1 > a.anchor:before, h2 > a.anchor:before, h3 > a.anchor:before, #toctitle > a.anchor:before, .sidebarblock > .content > .title > a.anchor:before, h4 > a.anchor:before, h5 > a.anchor:before, h6 > a.anchor:before { content: "\00A7"; font-size: 0.85em; display: block; padding-top: 0.1em; }
#content h1:hover > a.anchor, #content h1 > a.anchor:hover, h2:hover > a.anchor, h2 > a.anchor:hover, h3:hover > a.anchor, #toctitle:hover > a.anchor, .sidebarblock > .content > .title:hover > a.anchor, h3 > a.anchor:hover, #toctitle > a.anchor:hover, .sidebarblock > .content > .title > a.anchor:hover, h4:hover > a.anchor, h4 > a.anchor:hover, h5:hover > a.anchor, h5 > a.anchor:hover, h6:hover > a.anchor, h6 > a.anchor:hover { visibility: visible; }
#content h1 > a.link, h2 > a.link, h3 > a.link, #toctitle > a.link, .sidebarblock > .content > .title > a.link, h4 > a.link, h5 > a.link, h6 > a.link { color: #222222; text-decoration: none; }
#content h1 > a.link:hover, h2 > a.link:hover, h3 > a.link:hover, #toctitle > a.link:hover, .sidebarblock > .content > .title > a.link:hover, h4 > a.link:hover, h5 > a.link:hover, h6 > a.link:hover { color: #151515; }

.audioblock, .imageblock, .literalblock, .listingblock, .stemblock, .videoblock { margin-bottom: 1.25em; }

.admonitionblock td.content > .title, .audioblock > .title, .exampleblock > .title, .imageblock > .title, .listingblock > .title, .literalblock > .title, .stemblock > .title, .openblock > .title, .paragraph > .title, .quoteblock > .title, table.tableblock > .title, .verseblock > .title, .videoblock > .title, .dlist > .title, .olist > .title, .ulist > .title, .qlist > .title, .hdlist > .title { text-rendering: optimizeLegibility; text-align: left; }

table.tableblock > caption.title { white-space: nowrap; overflow: visible; max-width: 0; }

.paragraph.lead > p, #preamble > .sectionbody > .paragraph:first-of-type p { color: black; }

table.tableblock #preamble > .sectionbody > .paragraph:first-of-type p { font-size: inherit; }

.admonitionblock > table { border-collapse: separate; border: 0; background: none; width: 100%; }
.admonitionblock > table td.icon { text-align: center; width: 80px; }
.admonitionblock > table td.icon img { max-width: none; }
.admonitionblock > table td.icon .title { font-weight: bold; font-family: "Helvetica Neue", "Helvetica", Helvetica, Arial, sans-serif; text-transform: uppercase; }
.admonitionblock > table td.content { padding-left: 1.125em; padding-right: 1.25em; border-left: 1px solid #dddddd; color: #555555; }
.admonitionblock > table td.content > :last-child > :last-child { margin-bottom: 0; }

.exampleblock > .content { border-style: solid; border-width: 1px; border-color: #e6e6e6; margin-bottom: 1.25em; padding: 1.25em; background: white; -webkit-border-radius: 0; border-radius: 0; }
.exampleblock > .content > :first-child { margin-top: 0; }
.exampleblock > .content > :last-child { margin-bottom: 0; }

.sidebarblock { border-style: solid; border-width: 1px; border-color: #d9d9d9; margin-bottom: 1.25em; padding: 1.25em; background: #f2f2f2; -webkit-border-radius: 0; border-radius: 0; }
.sidebarblock > :first-child { margin-top: 0; }
.sidebarblock > :last-child { margin-bottom: 0; }
.sidebarblock > .content > .title { color: #6f6f6f; margin-top: 0; }

.exampleblock > .content > :last-child > :last-child, .exampleblock > .content .olist > ol > li:last-child > :last-child, .exampleblock > .content .ulist > ul > li:last-child > :last-child, .exampleblock > .content .qlist > ol > li:last-child > :last-child, .sidebarblock > .content > :last-child > :last-child, .sidebarblock > .content .olist > ol > li:last-child > :last-child, .sidebarblock > .content .ulist > ul > li:last-child > :last-child, .sidebarblock > .content .qlist > ol > li:last-child > :last-child { margin-bottom: 0; }

.literalblock pre, .listingblock pre:not(.highlight), .listingblock pre[class="highlight"], .listingblock pre[class^="highlight "], .listingblock pre.CodeRay, .listingblock pre.prettyprint { background: #eeeeee; }
.sidebarblock .literalblock pre, .sidebarblock .listingblock pre:not(.highlight), .sidebarblock .listingblock pre[class="highlight"], .sidebarblock .listingblock pre[class^="highlight "], .sidebarblock .listingblock pre.CodeRay, .sidebarblock .listingblock pre.prettyprint { background: #f2f1f1; }

.literalblock pre, .literalblock pre[class], .listingblock pre, .listingblock pre[class] { border: 1px solid #cccccc; -webkit-border-radius: 0; border-radius: 0; word-wrap: break-word; padding: 0.8em 0.8em 0.65em 0.8em; font-size: 0.8125em; }
.literalblock pre.nowrap, .literalblock pre[class].nowrap, .listingblock pre.nowrap, .listingblock pre[class].nowrap { overflow-x: auto; white-space: pre; word-wrap: normal; }
@media only screen and (min-width: 768px) { .literalblock pre, .literalblock pre[class], .listingblock pre, .listingblock pre[class] { font-size: 0.90625em; } }
@media only screen and (min-width: 1280px) { .literalblock pre, .literalblock pre[class], .listingblock pre, .listingblock pre[class] { font-size: 1em; } }

.literalblock.output pre { color: #eeeeee; background-color: black; }

.listingblock pre.highlightjs { padding: 0; }
.listingblock pre.highlightjs > code { padding: 0.8em 0.8em 0.65em 0.8em; -webkit-border-radius: 0; border-radius: 0; }

.listingblock > .content { position: relative; }

.listingblock code[data-lang]:before { display: none; content: attr(data-lang); position: absolute; font-size: 0.75em; top: 0.425rem; right: 0.5rem; line-height: 1; text-transform: uppercase; color: #999; }

.listingblock:hover code[data-lang]:before { display: block; }

.listingblock.terminal pre .command:before { content: attr(data-prompt); padding-right: 0.5em; color: #999; }

.listingblock.terminal pre .command:not([data-prompt]):before { content: "$"; }

table.pyhltable { border-collapse: separate; border: 0; margin-bottom: 0; background: none; }

table.pyhltable td { vertical-align: top; padding-top: 0; padding-bottom: 0; }

table.pyhltable td.code { padding-left: .75em; padding-right: 0; }

pre.pygments .lineno, table.pyhltable td:not(.code) { color: #999; padding-left: 0; padding-right: .5em; border-right: 1px solid #dddddd; }

pre.pygments .lineno { display: inline-block; margin-right: .25em; }

table.pyhltable .linenodiv { background: none !important; padding-right: 0 !important; }

.quoteblock { margin: 0 1em 1.25em 1.5em; display: table; }
.quoteblock > .title { margin-left: -1.5em; margin-bottom: 0.75em; }
.quoteblock blockquote, .quoteblock blockquote p { color: #6f6f6f; font-size: 1.15rem; line-height: 1.75; word-spacing: 0.1em; letter-spacing: 0; font-style: italic; text-align: justify; }
.quoteblock blockquote { margin: 0; padding: 0; border: 0; }
.quoteblock blockquote:before { content: "\201c"; float: left; font-size: 2.75em; font-weight: bold; line-height: 0.6em; margin-left: -0.6em; color: #6f6f6f; text-shadow: 0 1px 2px rgba(0, 0, 0, 0.1); }
.quoteblock blockquote > .paragraph:last-child p { margin-bottom: 0; }
.quoteblock .attribution { margin-top: 0.5em; margin-right: 0.5ex; text-align: right; }
.quoteblock .quoteblock { margin-left: 0; margin-right: 0; padding: 0.5em 0; border-left: 3px solid #555555; }
.quoteblock .quoteblock blockquote { padding: 0 0 0 0.75em; }
.quoteblock .quoteblock blockquote:before { display: none; }

.verseblock { margin: 0 1em 1.25em 1em; }
.verseblock pre { font-family: "Open Sans", "DejaVu Sans", sans; font-size: 1.15rem; color: #6f6f6f; font-weight: 300; text-rendering: optimizeLegibility; }
.verseblock pre strong { font-weight: 400; }
.verseblock .attribution { margin-top: 1.25rem; margin-left: 0.5ex; }

.quoteblock .attribution, .verseblock .attribution { font-size: 0.8125em; line-height: 1.45; font-style: italic; }
.quoteblock .attribution br, .verseblock .attribution br { display: none; }
.quoteblock .attribution cite, .verseblock .attribution cite { display: block; letter-spacing: -0.05em; color: #555555; }

.quoteblock.abstract { margin: 0 0 1.25em 0; display: block; }
.quoteblock.abstract blockquote, .quoteblock.abstract blockquote p { text-align: left; word-spacing: 0; }
.quoteblock.abstract blockquote:before, .quoteblock.abstract blockquote p:first-of-type:before { display: none; }

table.tableblock { max-width: 100%; border-collapse: separate; }
table.tableblock td > .paragraph:last-child p > p:last-child, table.tableblock th > p:last-child, table.tableblock td > p:last-child { margin-bottom: 0; }

table.spread { width: 100%; }

table.tableblock, th.tableblock, td.tableblock { border: 0 solid #dddddd; }

table.grid-all th.tableblock, table.grid-all td.tableblock { border-width: 0 1px 1px 0; }

table.grid-all tfoot > tr > th.tableblock, table.grid-all tfoot > tr > td.tableblock { border-width: 1px 1px 0 0; }

table.grid-cols th.tableblock, table.grid-cols td.tableblock { border-width: 0 1px 0 0; }

table.grid-all * > tr > .tableblock:last-child, table.grid-cols * > tr > .tableblock:last-child { border-right-width: 0; }

table.grid-rows th.tableblock, table.grid-rows td.tableblock { border-width: 0 0 1px 0; }

table.grid-all tbody > tr:last-child > th.tableblock, table.grid-all tbody > tr:last-child > td.tableblock, table.grid-all thead:last-child > tr > th.tableblock, table.grid-rows tbody > tr:last-child > th.tableblock, table.grid-rows tbody > tr:last-child > td.tableblock, table.grid-rows thead:last-child > tr > th.tableblock { border-bottom-width: 0; }

table.grid-rows tfoot > tr > th.tableblock, table.grid-rows tfoot > tr > td.tableblock { border-width: 1px 0 0 0; }

table.frame-all { border-width: 1px; }

table.frame-sides { border-width: 0 1px; }

table.frame-topbot { border-width: 1px 0; }

th.halign-left, td.halign-left { text-align: left; }

th.halign-right, td.halign-right { text-align: right; }

th.halign-center, td.halign-center { text-align: center; }

th.valign-top, td.valign-top { vertical-align: top; }

th.valign-bottom, td.valign-bottom { vertical-align: bottom; }

th.valign-middle, td.valign-middle { vertical-align: middle; }

table thead th, table tfoot th { font-weight: bold; }

tbody tr th { display: table-cell; line-height: 1.4; background: whitesmoke; }

tbody tr th, tbody tr th p, tfoot tr th, tfoot tr th p { color: #222222; font-weight: bold; }

p.tableblock > code:only-child { background: none; padding: 0; }

p.tableblock { font-size: 1em; }

td > div.verse { white-space: pre; }

ol { margin-left: 2.5em; }

ul li ol { margin-left: 1.5em; }

dl dd { margin-left: 1.125em; }

dl dd:last-child, dl dd:last-child > :last-child { margin-bottom: 0; }

ol > li p, ul > li p, ul dd, ol dd, .olist .olist, .ulist .ulist, .ulist .olist, .olist .ulist { margin-bottom: 0.625em; }

ul.unstyled, ol.unnumbered, ul.checklist, ul.none { list-style-type: none; }

ul.unstyled, ol.unnumbered, ul.checklist { margin-left: 0.625em; }

ul.checklist li > p:first-child > .fa-check-square-o:first-child, ul.checklist li > p:first-child > input[type="checkbox"]:first-child { margin-right: 0.25em; }

ul.checklist li > p:first-child > input[type="checkbox"]:first-child { position: relative; top: 1px; }

ul.inline { margin: 0 auto 0.625em auto; margin-left: -1.375em; margin-right: 0; padding: 0; list-style: none; overflow: hidden; }
ul.inline > li { list-style: none; float: left; margin-left: 1.375em; display: block; }
ul.inline > li > * { display: block; }

.unstyled dl dt { font-weight: normal; font-style: normal; }

ol.arabic { list-style-type: decimal; }

ol.decimal { list-style-type: decimal-leading-zero; }

ol.loweralpha { list-style-type: lower-alpha; }

ol.upperalpha { list-style-type: upper-alpha; }

ol.lowerroman { list-style-type: lower-roman; }

ol.upperroman { list-style-type: upper-roman; }

ol.lowergreek { list-style-type: lower-greek; }

.hdlist > table, .colist > table { border: 0; background: none; }
.hdlist > table > tbody > tr, .colist > table > tbody > tr { background: none; }

td.hdlist1 { padding-right: .75em; font-weight: bold; }

td.hdlist1, td.hdlist2 { vertical-align: top; }

.literalblock + .colist, .listingblock + .colist { margin-top: -0.5em; }

.colist > table tr > td:first-of-type { padding: 0 0.75em; line-height: 1; }
.colist > table tr > td:last-of-type { padding: 0.25em 0; }

.thumb, .th { line-height: 0; display: inline-block; border: solid 4px white; -webkit-box-shadow: 0 0 0 1px #dddddd; box-shadow: 0 0 0 1px #dddddd; }

.imageblock.left, .imageblock[style*="float: left"] { margin: 0.25em 0.625em 1.25em 0; }
.imageblock.right, .imageblock[style*="float: right"] { margin: 0.25em 0 1.25em 0.625em; }
.imageblock > .title { margin-bottom: 0; }
.imageblock.thumb, .imageblock.th { border-width: 6px; }
.imageblock.thumb > .title, .imageblock.th > .title { padding: 0 0.125em; }

.image.left, .image.right { margin-top: 0.25em; margin-bottom: 0.25em; display: inline-block; line-height: 0; }
.image.left { margin-right: 0.625em; }
.image.right { margin-left: 0.625em; }

a.image { text-decoration: none; }

span.footnote, span.footnoteref { vertical-align: super; font-size: 0.875em; }
span.footnote a, span.footnoteref a { text-decoration: none; }
span.footnote a:active, span.footnoteref a:active { text-decoration: underline; }

#footnotes { padding-top: 0.75em; padding-bottom: 0.75em; margin-bottom: 0.625em; }
#footnotes hr { width: 20%; min-width: 6.25em; margin: -.25em 0 .75em 0; border-width: 1px 0 0 0; }
#footnotes .footnote { padding: 0 0.375em; line-height: 1.3; font-size: 0.875em; margin-left: 1.2em; text-indent: -1.2em; margin-bottom: .2em; }
#footnotes .footnote a:first-of-type { font-weight: bold; text-decoration: none; }
#footnotes .footnote:last-of-type { margin-bottom: 0; }

#content #footnotes { margin-top: -0.625em; margin-bottom: 0; padding: 0.75em 0; }

.gist .file-data > table { border: 0; background: #fff; width: 100%; margin-bottom: 0; }
.gist .file-data > table td.line-data { width: 99%; }

div.unbreakable { page-break-inside: avoid; }

.big { font-size: larger; }

.small { font-size: smaller; }

.underline { text-decoration: underline; }

.overline { text-decoration: overline; }

.line-through { text-decoration: line-through; }

.aqua { color: #00bfbf; }

.aqua-background { background-color: #00fafa; }

.black { color: black; }

.black-background { background-color: black; }

.blue { color: #0000bf; }

.blue-background { background-color: #0000fa; }

.fuchsia { color: #bf00bf; }

.fuchsia-background { background-color: #fa00fa; }

.gray { color: #606060; }

.gray-background { background-color: #7d7d7d; }

.green { color: #006000; }

.green-background { background-color: #007d00; }

.lime { color: #00bf00; }

.lime-background { background-color: #00fa00; }

.maroon { color: #600000; }

.maroon-background { background-color: #7d0000; }

.navy { color: #000060; }

.navy-background { background-color: #00007d; }

.olive { color: #606000; }

.olive-background { background-color: #7d7d00; }

.purple { color: #600060; }

.purple-background { background-color: #7d007d; }

.red { color: #bf0000; }

.red-background { background-color: #fa0000; }

.silver { color: #909090; }

.silver-background { background-color: #bcbcbc; }

.teal { color: #006060; }

.teal-background { background-color: #007d7d; }

.white { color: #bfbfbf; }

.white-background { background-color: #fafafa; }

.yellow { color: #bfbf00; }

.yellow-background { background-color: #fafa00; }

span.icon > .fa { cursor: default; }

.admonitionblock td.icon [class^="fa icon-"] { font-size: 2.5em; text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.5); cursor: default; }
.admonitionblock td.icon .icon-note:before { content: "\f05a"; color: #207c98; }
.admonitionblock td.icon .icon-tip:before { content: "\f0eb"; text-shadow: 1px 1px 2px rgba(155, 155, 0, 0.8); color: #111; }
.admonitionblock td.icon .icon-warning:before { content: "\f071"; color: #bf6900; }
.admonitionblock td.icon .icon-caution:before { content: "\f06d"; color: #bf3400; }
.admonitionblock td.icon .icon-important:before { content: "\f06a"; color: #bf0000; }

.conum[data-value] { display: inline-block; color: #fff !important; background-color: #222222; -webkit-border-radius: 100px; border-radius: 100px; text-align: center; font-size: 0.75em; width: 1.67em; height: 1.67em; line-height: 1.67em; font-family: "Open Sans", "DejaVu Sans", sans-serif; font-style: normal; font-weight: bold; }
.conum[data-value] * { color: #fff !important; }
.conum[data-value] + b { display: none; }
.conum[data-value]:after { content: attr(data-value); }
pre .conum[data-value] { position: relative; top: -0.125em; }

b.conum * { color: inherit !important; }

.conum:not([data-value]):empty { display: none; }

.literalblock pre, .listingblock pre { background: #eeeeee; }

</style>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.2.0/css/font-awesome.min.css">
<style>.listingblock .pygments .hll { background-color: #ffffcc }
.listingblock .pygments  { background: #f8f8f8; }
.listingblock .pygments .tok-c { color: #408080; font-style: italic } /* Comment */
.listingblock .pygments .tok-err { border: 1px solid #FF0000 } /* Error */
.listingblock .pygments .tok-k { color: #008000; font-weight: bold } /* Keyword */
.listingblock .pygments .tok-o { color: #666666 } /* Operator */
.listingblock .pygments .tok-cm { color: #408080; font-style: italic } /* Comment.Multiline */
.listingblock .pygments .tok-cp { color: #BC7A00 } /* Comment.Preproc */
.listingblock .pygments .tok-c1 { color: #408080; font-style: italic } /* Comment.Single */
.listingblock .pygments .tok-cs { color: #408080; font-style: italic } /* Comment.Special */
.listingblock .pygments .tok-gd { color: #A00000 } /* Generic.Deleted */
.listingblock .pygments .tok-ge { font-style: italic } /* Generic.Emph */
.listingblock .pygments .tok-gr { color: #FF0000 } /* Generic.Error */
.listingblock .pygments .tok-gh { color: #000080; font-weight: bold } /* Generic.Heading */
.listingblock .pygments .tok-gi { color: #00A000 } /* Generic.Inserted */
.listingblock .pygments .tok-go { color: #888888 } /* Generic.Output */
.listingblock .pygments .tok-gp { color: #000080; font-weight: bold } /* Generic.Prompt */
.listingblock .pygments .tok-gs { font-weight: bold } /* Generic.Strong */
.listingblock .pygments .tok-gu { color: #800080; font-weight: bold } /* Generic.Subheading */
.listingblock .pygments .tok-gt { color: #0044DD } /* Generic.Traceback */
.listingblock .pygments .tok-kc { color: #008000; font-weight: bold } /* Keyword.Constant */
.listingblock .pygments .tok-kd { color: #008000; font-weight: bold } /* Keyword.Declaration */
.listingblock .pygments .tok-kn { color: #008000; font-weight: bold } /* Keyword.Namespace */
.listingblock .pygments .tok-kp { color: #008000 } /* Keyword.Pseudo */
.listingblock .pygments .tok-kr { color: #008000; font-weight: bold } /* Keyword.Reserved */
.listingblock .pygments .tok-kt { color: #B00040 } /* Keyword.Type */
.listingblock .pygments .tok-m { color: #666666 } /* Literal.Number */
.listingblock .pygments .tok-s { color: #BA2121 } /* Literal.String */
.listingblock .pygments .tok-na { color: #7D9029 } /* Name.Attribute */
.listingblock .pygments .tok-nb { color: #008000 } /* Name.Builtin */
.listingblock .pygments .tok-nc { color: #0000FF; font-weight: bold } /* Name.Class */
.listingblock .pygments .tok-no { color: #880000 } /* Name.Constant */
.listingblock .pygments .tok-nd { color: #AA22FF } /* Name.Decorator */
.listingblock .pygments .tok-ni { color: #999999; font-weight: bold } /* Name.Entity */
.listingblock .pygments .tok-ne { color: #D2413A; font-weight: bold } /* Name.Exception */
.listingblock .pygments .tok-nf { color: #0000FF } /* Name.Function */
.listingblock .pygments .tok-nl { color: #A0A000 } /* Name.Label */
.listingblock .pygments .tok-nn { color: #0000FF; font-weight: bold } /* Name.Namespace */
.listingblock .pygments .tok-nt { color: #008000; font-weight: bold } /* Name.Tag */
.listingblock .pygments .tok-nv { color: #19177C } /* Name.Variable */
.listingblock .pygments .tok-ow { color: #AA22FF; font-weight: bold } /* Operator.Word */
.listingblock .pygments .tok-w { color: #bbbbbb } /* Text.Whitespace */
.listingblock .pygments .tok-mb { color: #666666 } /* Literal.Number.Bin */
.listingblock .pygments .tok-mf { color: #666666 } /* Literal.Number.Float */
.listingblock .pygments .tok-mh { color: #666666 } /* Literal.Number.Hex */
.listingblock .pygments .tok-mi { color: #666666 } /* Literal.Number.Integer */
.listingblock .pygments .tok-mo { color: #666666 } /* Literal.Number.Oct */
.listingblock .pygments .tok-sb { color: #BA2121 } /* Literal.String.Backtick */
.listingblock .pygments .tok-sc { color: #BA2121 } /* Literal.String.Char */
.listingblock .pygments .tok-sd { color: #BA2121; font-style: italic } /* Literal.String.Doc */
.listingblock .pygments .tok-s2 { color: #BA2121 } /* Literal.String.Double */
.listingblock .pygments .tok-se { color: #BB6622; font-weight: bold } /* Literal.String.Escape */
.listingblock .pygments .tok-sh { color: #BA2121 } /* Literal.String.Heredoc */
.listingblock .pygments .tok-si { color: #BB6688; font-weight: bold } /* Literal.String.Interpol */
.listingblock .pygments .tok-sx { color: #008000 } /* Literal.String.Other */
.listingblock .pygments .tok-sr { color: #BB6688 } /* Literal.String.Regex */
.listingblock .pygments .tok-s1 { color: #BA2121 } /* Literal.String.Single */
.listingblock .pygments .tok-ss { color: #19177C } /* Literal.String.Symbol */
.listingblock .pygments .tok-bp { color: #008000 } /* Name.Builtin.Pseudo */
.listingblock .pygments .tok-vc { color: #19177C } /* Name.Variable.Class */
.listingblock .pygments .tok-vg { color: #19177C } /* Name.Variable.Global */
.listingblock .pygments .tok-vi { color: #19177C } /* Name.Variable.Instance */
.listingblock .pygments .tok-il { color: #666666 } /* Literal.Number.Integer.Long */
</style>
</head>
<body class="article toc2 toc-left">
<div id="header">
<h1>Grails</h1>
<div class="details">
<span id="author" class="author">Fran García</span><br>
<span id="email" class="email">&lt;<a href="mailto:fgarciarico@gmail.com">fgarciarico@gmail.com</a>&gt;</span><br>
</div>
<div id="toc" class="toc2">
<div id="toctitle">Índice de contenidos</div>
<ul class="sectlevel1">
<li><a href="#sesion05">5. Patrón MVC: Dominios y servicios.</a>
<ul class="sectlevel2">
<li><a href="#_dominios">5.1. Dominios</a></li>
<li><a href="#_restricciones">5.2. Restricciones</a></li>
<li><a href="#_aspectos_avanzados_de_gorm">5.3. Aspectos avanzados de GORM</a></li>
<li><a href="#_interactuar_con_la_base_de_datos">5.4. Interactuar con la base de datos</a></li>
<li><a href="#_servicios">5.5. Servicios</a></li>
<li><a href="#_ejercicios">5.6. Ejercicios</a></li>
</ul>
</li>
</ul>
</div>
</div>
<div id="content">
<div id="preamble">
<div class="sectionbody">
<div style="page-break-after: always;"></div>
</div>
</div>
<div class="sect1">
<h2 id="sesion05">5. Patrón MVC: Dominios y servicios.</h2>
<div class="sectionbody">
<div class="paragraph">
<p>En esta tercera sesión sobre Grails veremos como Grails hace uso de GORM para mapear objetos contra la base de datos de la aplicación. Recordar que GORM es una capa superior a Hibernate con lo que gran parte de lo aprendido en módulos anteriores sobre Hibernate serán totalmente válidos para trabajar con Grails.</p>
</div>
<div class="paragraph">
<p>Por último, veremos lo sencillo que es en Grails implementar servicios que se encarguen de la lógica de negocio de nuestra aplicación creando un sencillo ejemplo.</p>
</div>
<div class="sect2">
<h3 id="_dominios">5.1. Dominios</h3>
<div class="sect3">
<h4 id="_creación_de_dominios">5.1.1. Creación de dominios</h4>
<div class="paragraph">
<p>Como puedes imaginar, lo primero que se debe hacer con una clase de dominio es crearla. Como ya vimos en sesiones anteriores, el comando utilizado para generar una nueva clase de dominio es <em>grails create-domain-class</em> seguido del nombre de la nueva clase que queremos crear. Pero, ¿qué pasa en la base de datos cuando generamos nuestras clases de dominio? Para ver exactamente que es lo que pasa en la base de datos cuando creamos una nueva clase de dominio, vamos a tomar como ejemplo la clase <em>Todo</em>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-kn">package</span> <span class="tok-n">es</span><span class="tok-o">.</span><span class="tok-na">ua</span><span class="tok-o">.</span><span class="tok-na">expertojava</span><span class="tok-o">.</span><span class="tok-na">todo</span>

<span class="tok-kd">class</span> <span class="tok-nc">Todo</span> <span class="tok-o">{</span>
    <span class="tok-n">String</span> <span class="tok-n">title</span>
    <span class="tok-n">String</span> <span class="tok-n">description</span>
    <span class="tok-n">Date</span> <span class="tok-n">date</span>
    <span class="tok-n">Date</span> <span class="tok-n">reminderDate</span>
    <span class="tok-n">String</span> <span class="tok-n">url</span>
    <span class="tok-n">Boolean</span> <span class="tok-n">done</span> <span class="tok-o">=</span> <span class="tok-kc">false</span>
    <span class="tok-n">Category</span> <span class="tok-n">category</span>

    <span class="tok-kd">static</span> <span class="tok-n">hasMany</span> <span class="tok-o">=</span> <span class="tok-o">[</span><span class="tok-nl">tags:</span><span class="tok-n">Tag</span><span class="tok-o">]</span>
    <span class="tok-kd">static</span> <span class="tok-n">belongsTo</span> <span class="tok-o">=</span> <span class="tok-o">[</span><span class="tok-n">Tag</span><span class="tok-o">]</span>

    <span class="tok-kd">static</span> <span class="tok-n">constraints</span> <span class="tok-o">=</span> <span class="tok-o">{</span>
        <span class="tok-n">title</span><span class="tok-o">(</span><span class="tok-nl">blank:</span><span class="tok-kc">false</span><span class="tok-o">)</span>
        <span class="tok-n">description</span><span class="tok-o">(</span><span class="tok-nl">blank:</span><span class="tok-kc">true</span><span class="tok-o">,</span> <span class="tok-nl">nullable:</span><span class="tok-kc">true</span><span class="tok-o">,</span> <span class="tok-nl">maxSize:</span><span class="tok-mi">1000</span><span class="tok-o">)</span>
        <span class="tok-n">date</span><span class="tok-o">(</span><span class="tok-nl">nullable:</span><span class="tok-kc">false</span><span class="tok-o">)</span>
        <span class="tok-n">reminderDate</span><span class="tok-o">(</span><span class="tok-nl">nullable:</span><span class="tok-kc">true</span><span class="tok-o">)</span>
        <span class="tok-n">url</span><span class="tok-o">(</span><span class="tok-nl">nullable:</span><span class="tok-kc">true</span><span class="tok-o">,</span> <span class="tok-nl">url:</span><span class="tok-kc">true</span><span class="tok-o">)</span>
        <span class="tok-n">done</span><span class="tok-o">(</span><span class="tok-nl">nullable:</span><span class="tok-kc">false</span><span class="tok-o">)</span>
        <span class="tok-n">category</span><span class="tok-o">(</span><span class="tok-nl">nullable:</span><span class="tok-kc">true</span><span class="tok-o">)</span>
    <span class="tok-o">}</span>

    <span class="tok-n">String</span> <span class="tok-nf">toString</span><span class="tok-o">(){</span>
        <span class="tok-n">title</span>
    <span class="tok-o">}</span>
<span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Pasemos a ver que tabla nos ha creado nuestra aplicación en la base de datos. Para esto, vamos a ver una de las características añadidas en las últimas versiones de Grails que es la posibilidad de utilizar una consola web para acceder a la estructura de la base de datos creada. Esta consola se puede acceder desde la dirección <em><a href="http://localhost:8080/todo/dbconsole" class="bare">http://localhost:8080/todo/dbconsole</a></em>. Hay que tener en cuenta que como parámetro JDBC URL debemos introducir la misma url que tengamos configurada en el archivo <em>DataSource.groovy</em>, que por defecto será <em>jdbc:h2:mem:devDb</em>.</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="images/grails05/dbconsole.png" alt="Conexión con DbConsole" width="50%">
</div>
</div>
<div class="paragraph">
<p>Una vez dentro de la consola de H2, podemos ejecutar el comando <em>SHOW COLUMNS FROM TODO</em> para ver el esquema de la tabla <em>TODO</em> y compararla de eta forma con la clase de dominio que nosotros hemos creado para encontrar las siguientes diferencias.</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="images/grails05/tabletodo.png" alt="Table Todo" width="100%">
</div>
</div>
<div class="paragraph">
<p><strong>Nuevas columnas</strong></p>
</div>
<div class="paragraph">
<p>La primera diferencia que encontramos es la existencia de dos nuevas columnas en la tabla correspondiente de la base de datos. La primera de ellas es la columna <em>id</em> que además es la clave primaria de la tabla y autoincremental. Esto puede parecer que es algo en contra de Grails ya que no vamos a poder establecer la clave primaria que nosotros queremos, pero en la práctica se ha demostrado que es la mejor forma a la hora de interactuar con la base de datos. La otra nueva columna que se ha generado en la tabla es el campo <em>version</em> y servirá para garantizar la integridad transaccional y el bloqueo eficiente de las tablas cuando se realizan operaciones de entrada.</p>
</div>
<div class="paragraph">
<p><strong>Nombre de las columnas</strong></p>
</div>
<div class="paragraph">
<p>El nombre de las propiedades que en la clase de dominio seguían el convenio <em>CamelCase</em> (palabras sin espacios en blanco y con la primera letra de cada una de ellas en mayúscula), en la tabla se convierten por defecto al formato <em>snake_case</em> (todas las palabras en minúsculas y separadas por un subrayado bajo _), a pesar de que en la consola de H2 nos aparezca todo en mayúsculas. Si lo comprobáramos con una base de datos MySQL veríamos este cambio de nombre de las propiedades.</p>
</div>
<div class="paragraph">
<p><strong>Claves ajenas</strong></p>
</div>
<div class="paragraph">
<p>GORM representa las claves ajenas en la tabla con el nombre de la clase/tabla referencia en minúsculas seguido de <em>_id</em>. En nuestro caso tenemos la columna <em>category_id</em> que identifica la relación entre las tareas y categorías, con lo que cada tarea sólo puede pertenecer a una categoría.</p>
</div>
<div class="paragraph">
<p><strong>Tipos de datos</strong></p>
</div>
<div class="paragraph">
<p>Dependiendo de la base de datos utilizada (en nuestro caso H2), GORM transformará los tipos de datos de las propiedades de la clase de dominio en otros tipos de datos en la tabla. Por ejemplo, el tipo de dato <em>String</em> se sustituye en la base de datos por <em>varchar()</em>, mientras que el tipo de dato <em>Date</em> es reemplazado por <em>timestamp</em>. Todo esto dependerá de la base de datos utilizada y es posible que varíe entre ellas.</p>
</div>
</div>
<div class="sect3">
<h4 id="_relaciones_entre_clases_de_dominio">5.1.2. Relaciones entre clases de dominio</h4>
<div class="paragraph">
<p>Cualquier aplicación que vayamos a desarrollar, presentará relaciones entre sus clases de dominio. En nuestro ejemplo de scaffolding ya definimos algunas relaciones entre ellas y ahora vamos a ver más en detalle esas relaciones. Las posibles relaciones entre las clases de dominio de una aplicación son:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Uno a uno</p>
</li>
<li>
<p>Uno a muchos</p>
</li>
<li>
<p>Muchos a muchos</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Si hacemos algo de memoria de la definición de nuestras clases de dominio, recordaremos que utilizábamos la palabra reservada <em>hasMany</em> y <em>belongsTo</em> para establecer la relación entre las tareas y las etiquetas. También existen la palabra reservada <em>hasOne</em>. A continuación veremos en detalle cada una de las posibles relaciones y como especificarlas.</p>
</div>
<div class="sect4">
<h5 id="_uno_a_uno">Uno a uno</h5>
<div class="paragraph">
<p>Una relación uno-a-uno se da cuando un objeto de la clase A está únicamente relacionado con un objeto de la clase B y viceversa. Por ejemplo, imaginad la aplicación <em>Biblioteca</em> en donde un <em>libro</em> sólo puede tener una <em>operación activa</em>. Esto se representaría con una relación <em>uno-a-uno</em> y podríamos hacerlo de tres formas diferentes.</p>
</div>
<div class="paragraph">
<p><em>Primera forma de establecer una relación uno a uno</em></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-kd">class</span> <span class="tok-nc">Book</span><span class="tok-o">{</span>
<span class="tok-o">}</span>

<span class="tok-kd">class</span> <span class="tok-nc">ActiveOperation</span><span class="tok-o">{</span>
    <span class="tok-o">....</span>
    <span class="tok-n">Book</span> <span class="tok-n">book</span>
    <span class="tok-o">....</span>
<span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Aquí estamos representando una relación unidireccional desde las operaciones activas hasta los libros. Si necesitamos especificar una relación bidireccional podemos utilizar cualquiera de las siguientes formas.</p>
</div>
<div class="paragraph">
<p><em>Segunda forma de establecer una relación uno a uno</em></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-kd">class</span> <span class="tok-nc">Book</span><span class="tok-o">{</span>
    <span class="tok-o">....</span>
    <span class="tok-n">ActiveOperation</span> <span class="tok-n">actoper</span>
    <span class="tok-o">....</span>
<span class="tok-o">}</span>

<span class="tok-kd">class</span> <span class="tok-nc">ActiveOperation</span><span class="tok-o">{</span>
    <span class="tok-o">....</span>
    <span class="tok-kd">static</span> <span class="tok-n">belongsTo</span> <span class="tok-o">=</span> <span class="tok-o">[</span><span class="tok-nl">book:</span><span class="tok-n">Book</span><span class="tok-o">]</span>
    <span class="tok-o">....</span>
<span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>En este caso, las inserciones y los borrados se realizan en cascada. Si por ejemplo hacemos <em>new Book(actoper:new ActiveOperation()).save()</em> en primer lugar se creará una operación activa y posteriormente se creará el libro. De igual forma, si eliminamos el libro asociado a la operación activa, ésta se eliminará también de la base de datos.</p>
</div>
<div class="paragraph">
<p><em>Tercera forma de establecer una relación uno a uno</em></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-kd">class</span> <span class="tok-nc">Book</span><span class="tok-o">{</span>
    <span class="tok-o">....</span>
    <span class="tok-kd">static</span> <span class="tok-n">hasOne</span> <span class="tok-o">=</span> <span class="tok-o">[</span><span class="tok-nl">actoper:</span><span class="tok-n">ActiveOperation</span><span class="tok-o">]</span>

    <span class="tok-kd">static</span> <span class="tok-n">constraints</span> <span class="tok-o">=</span> <span class="tok-o">{</span>
        <span class="tok-n">actoper</span> <span class="tok-nl">unique:</span><span class="tok-kc">true</span>
    <span class="tok-o">}</span>
    <span class="tok-o">....</span>
<span class="tok-o">}</span>

<span class="tok-kd">class</span> <span class="tok-nc">ActiveOperation</span><span class="tok-o">{</span>
    <span class="tok-o">....</span>
    <span class="tok-n">Book</span> <span class="tok-n">book</span>
    <span class="tok-o">....</span>
<span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>En esta ocasión, se creará una relación bidireccional de uno a uno entre los libros y las operaciones activas y se creará una columna de clave ajena en la tabla <em>active_operation</em> llamada <em>book_id</em>.</p>
</div>
<div class="paragraph">
<p>En estos casos, desde la documentación de Grails se aconseja que especifiquemos también una restricción indicando que la propiedad será única.</p>
</div>
</div>
<div class="sect4">
<h5 id="_uno_a_muchos">Uno a muchos</h5>
<div class="paragraph">
<p>Una relación uno-a-muchos se da cuando un registro de la tabla A puede referenciar muchos registros de la tabla B, pero todos los registros de la tabla B sólo pueden referenciar un registro de la tabla A. Por ejemplo, en nuestra aplicación de ejemplo, una tarea sólo puede estar relacionada con una categoría, pero una categoría puede tener muchas tareas. Esto se representa de la siguiente forma en la definición de las clases de dominio.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-kd">class</span> <span class="tok-nc">Category</span> <span class="tok-o">{</span>
    <span class="tok-o">....</span>
    <span class="tok-kd">static</span> <span class="tok-n">hasMany</span> <span class="tok-o">=</span> <span class="tok-o">[</span><span class="tok-nl">todos:</span><span class="tok-n">Todo</span><span class="tok-o">]</span>
    <span class="tok-o">....</span>
<span class="tok-o">}</span>

<span class="tok-kd">class</span> <span class="tok-nc">Todo</span> <span class="tok-o">{</span>
    <span class="tok-o">....</span>
    <span class="tok-n">Category</span> <span class="tok-n">category</span>
    <span class="tok-o">....</span>
<span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Con esta definición de las clases de dominio, las actualizaciones y los almacenamientos se realizan en cascada mientras que los borrados sólo se realizarán en cascada si especificamos la otra parte de la relación con un <em>belongsTo</em>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-kd">class</span> <span class="tok-nc">Category</span> <span class="tok-o">{</span>
    <span class="tok-o">....</span>
    <span class="tok-kd">static</span> <span class="tok-n">hasMany</span> <span class="tok-o">=</span> <span class="tok-o">[</span><span class="tok-nl">todos:</span><span class="tok-n">Todo</span><span class="tok-o">]</span>
    <span class="tok-o">....</span>
<span class="tok-o">}</span>

<span class="tok-kd">class</span> <span class="tok-nc">Todo</span> <span class="tok-o">{</span>
    <span class="tok-o">....</span>
    <span class="tok-kd">static</span> <span class="tok-n">belongsTo</span> <span class="tok-o">=</span> <span class="tok-o">[</span><span class="tok-nl">category:</span><span class="tok-n">Category</span><span class="tok-o">]</span>
    <span class="tok-o">....</span>
<span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Estas propiedades que representan la relación de uno a muchos son consideradas como colecciones de datos y para insertar o eliminar datos de las mismas únicamente debemos utilizar un par de métodos de GORM que son <em>addTo()</em> y <em>removeFrom()</em>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-c1">//Ejemplo para insertar datos en relaciones</span>
<span class="tok-kt">def</span> <span class="tok-n">todo</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">Todo</span><span class="tok-o">(</span><span class="tok-nl">title:</span><span class="tok-s2">&quot;Limpiar cocina&quot;</span><span class="tok-o">,</span> <span class="tok-nl">description:</span><span class="tok-s2">&quot;Limpiar la cocina a fondo&quot;</span><span class="tok-o">,</span> <span class="tok-o">...)</span>

<span class="tok-kt">def</span> <span class="tok-n">category</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">Category</span><span class="tok-o">(</span><span class="tok-nl">name:</span><span class="tok-s2">&quot;Hogar&quot;</span><span class="tok-o">)</span>

<span class="tok-n">category</span><span class="tok-o">.</span><span class="tok-na">addToTodos</span><span class="tok-o">(</span><span class="tok-n">todo</span><span class="tok-o">)</span>
<span class="tok-n">category</span><span class="tok-o">.</span><span class="tok-na">save</span><span class="tok-o">()</span>

<span class="tok-c1">//Ejemplo para eliminar datos de relaciones</span>
<span class="tok-n">category</span><span class="tok-o">.</span><span class="tok-na">removeFromTodos</span><span class="tok-o">(</span><span class="tok-n">todo</span><span class="tok-o">)</span>
<span class="tok-n">category</span><span class="tok-o">.</span><span class="tok-na">save</span><span class="tok-o">()</span>

<span class="tok-c1">//Ejemplo para buscar tareas dentro de una categoría</span>
<span class="tok-kt">def</span> <span class="tok-n">todosfound</span> <span class="tok-o">=</span> <span class="tok-n">category</span><span class="tok-o">.</span><span class="tok-na">todos</span><span class="tok-o">.</span><span class="tok-na">find</span> <span class="tok-o">{</span><span class="tok-n">it</span><span class="tok-o">.</span><span class="tok-na">title</span> <span class="tok-o">=</span> <span class="tok-s2">&quot;Limpiar cocina&quot;</span><span class="tok-o">}</span></code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_muchos_a_muchos">Muchos a muchos</h5>
<div class="paragraph">
<p>En una relación muchos-a-muchos un registro de la tabla A puede referenciar muchos registros de la tabla B y un registro de la tabla B referenciar igualmente muchos registros de la tabla A. En nuestra aplicación ejemplo  disponemos de la relación entre tareas y etiquetas en la que una tarea puede estar relacionada con muchas etiquetas y viceversa. Esto se representa con una relación muchos-a-muchos de la siguiente forma.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-kd">class</span> <span class="tok-nc">Tag</span><span class="tok-o">{</span>
    <span class="tok-o">....</span>
    <span class="tok-kd">static</span> <span class="tok-n">hasMany</span> <span class="tok-o">=</span> <span class="tok-o">[</span><span class="tok-nl">todos:</span><span class="tok-n">Todo</span><span class="tok-o">]</span>
    <span class="tok-o">....</span>
<span class="tok-o">}</span>

<span class="tok-kd">class</span> <span class="tok-nc">Todo</span><span class="tok-o">{</span>
    <span class="tok-o">....</span>
    <span class="tok-kd">static</span> <span class="tok-n">hasMany</span> <span class="tok-o">=</span> <span class="tok-o">[</span><span class="tok-nl">tags:</span><span class="tok-n">Tag</span><span class="tok-o">]</span>
    <span class="tok-kd">static</span> <span class="tok-n">belongsTo</span> <span class="tok-o">=</span> <span class="tok-n">Tag</span>
    <span class="tok-o">....</span>
<span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>En GORM, una relación muchos-a-muchos se representa indicando en ambas clases la propiedad <em>hasMany</em> y en al menos una de ellas la propiedad <em>belongsTo</em>.</p>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_restricciones">5.2. Restricciones</h3>
<div class="paragraph">
<p>El siguiente punto que vamos a ver trata a fondo las definiciones de restricciones en las clases de dominios.</p>
</div>
<div class="sect3">
<h4 id="_restricciones_predefinidas_en_gorm">5.2.1. Restricciones predefinidas en GORM</h4>
<div class="paragraph">
<p>Para controlar estas restricciones, GORM dispone de una serie de funciones comunes predefinidas para establecerlas. Además, también nos permitirá crear nuestras propias restricciones. Hasta ahora, ya hemos visto algunas de estas restricciones como pueden ser <em>size</em>, <em>unique</em> o <em>blank</em> entre otras. Recordamos que para establecer las restricciones de una clase de dominio debemos establecer la propiedad estática <em>constraints</em> como en el siguiente ejemplo.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-kn">package</span> <span class="tok-n">es</span><span class="tok-o">.</span><span class="tok-na">ua</span><span class="tok-o">.</span><span class="tok-na">expertojava</span><span class="tok-o">.</span><span class="tok-na">todo</span>

<span class="tok-kd">class</span> <span class="tok-nc">Todo</span> <span class="tok-o">{</span>
    <span class="tok-n">String</span> <span class="tok-n">title</span>
    <span class="tok-n">String</span> <span class="tok-n">description</span>
    <span class="tok-n">Date</span> <span class="tok-n">date</span>
    <span class="tok-n">Date</span> <span class="tok-n">reminderDate</span>
    <span class="tok-n">String</span> <span class="tok-n">url</span>
    <span class="tok-n">Boolean</span> <span class="tok-n">done</span> <span class="tok-o">=</span> <span class="tok-kc">false</span>
    <span class="tok-n">Category</span> <span class="tok-n">category</span>

    <span class="tok-kd">static</span> <span class="tok-n">hasMany</span> <span class="tok-o">=</span> <span class="tok-o">[</span><span class="tok-nl">tags:</span><span class="tok-n">Tag</span><span class="tok-o">]</span>
    <span class="tok-kd">static</span> <span class="tok-n">belongsTo</span> <span class="tok-o">=</span> <span class="tok-o">[</span><span class="tok-n">Tag</span><span class="tok-o">]</span>

    <span class="tok-kd">static</span> <span class="tok-n">constraints</span> <span class="tok-o">=</span> <span class="tok-o">{</span>
        <span class="tok-n">title</span><span class="tok-o">(</span><span class="tok-nl">blank:</span><span class="tok-kc">false</span><span class="tok-o">)</span>
        <span class="tok-n">description</span><span class="tok-o">(</span><span class="tok-nl">blank:</span><span class="tok-kc">true</span><span class="tok-o">,</span> <span class="tok-nl">nullable:</span><span class="tok-kc">true</span><span class="tok-o">,</span> <span class="tok-nl">maxSize:</span><span class="tok-mi">1000</span><span class="tok-o">)</span>
        <span class="tok-n">date</span><span class="tok-o">(</span><span class="tok-nl">nullable:</span><span class="tok-kc">false</span><span class="tok-o">)</span>
        <span class="tok-n">reminderDate</span><span class="tok-o">(</span><span class="tok-nl">nullable:</span><span class="tok-kc">true</span><span class="tok-o">)</span>
        <span class="tok-n">url</span><span class="tok-o">(</span><span class="tok-nl">nullable:</span><span class="tok-kc">true</span><span class="tok-o">,</span> <span class="tok-nl">url:</span><span class="tok-kc">true</span><span class="tok-o">)</span>
        <span class="tok-n">done</span><span class="tok-o">(</span><span class="tok-nl">nullable:</span><span class="tok-kc">false</span><span class="tok-o">)</span>
        <span class="tok-n">category</span><span class="tok-o">(</span><span class="tok-nl">nullable:</span><span class="tok-kc">true</span><span class="tok-o">)</span>
    <span class="tok-o">}</span>

    <span class="tok-n">String</span> <span class="tok-nf">toString</span><span class="tok-o">(){</span>
        <span class="tok-n">title</span>
    <span class="tok-o">}</span>
<span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>A continuación, vamos veremos las restricciones que podemos utilizar directamente con GORM.</p>
</div>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 33%;">
<col style="width: 33%;">
<col style="width: 33%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Nombre</th>
<th class="tableblock halign-left valign-top">Descripción</th>
<th class="tableblock halign-left valign-top">Ejemplo</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">blank</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Valida si la cadena puede quedar o no vacía</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">login(blank:false)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">creditCard</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Valida si la cadena introducida es un número de tarjeta correcto</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">tarjetaCredito(creditCard:true)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">email</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Valida si la cadena introducida es un correo electrónico correcto</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">correoElectronico(email:true)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">password</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indica si la propiedad es una contraseña, con lo que al introducirla no se mostrará directamente</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">contrasenya(password:true)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">inList</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Valida que la propiedad contenga cualquiera de los valores pasados por parámetro</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">tipo(inList:["administrador", "bibliotecario", "profesor", "socio"])</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">matches</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Valida la cadena introducida contra una expresión regular pasada por parámetro</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">login(matches:"[a-zA-Z]+")</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">max</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Valida que el número introducido no sea mayor que el número pasado por parámetro</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">price(max:999F)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">min</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Valida que el número introducido no sea menor que el número pasado por parámetro</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">price(min:0F)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">minSize</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Valida que la longitud de la cadena introducida sea superior al número pasado por parámetro</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">hijos(minSize:5)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">maxSize</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Valida que la longitud de la cadena introducida sea inferior al número pasado por parámetro</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">hijos(maxSize:15)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">notEqual</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Valida que el objeto asignado a la propiedad no sea igual que el objeto pasado por parámetro</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">login(notEqual:"admin")</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">nullable</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Valida si el objeto puede ser <em>null</em> o no</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">edad(nullable:true)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">range</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Valida que el objeto esté dentro del rango pasado por parámetro</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">edad(range:0..99)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">scale</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indica el número de decimales de la propiedad</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">salario(scale:2)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">size</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Valida que la longitud de la cadena esté dentro del rango pasado por parámetro</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">login(size:5..15)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">unique</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Especifica que la propiedad debe ser única y no se puede repetir ningún objeto</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">login(unique:true)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">url</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Valida que la cadena introducida sea una dirección URL correcta</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">website(url:true)</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Pero además de estas restricciones, Grails también tiene otras más que suponen una serie de cambios en la interfaz de usuario generado y aunque no es muy recomendable mezclar este tipo de información en las clases de dominio, cuando usamos el scaffolding en gran parte de nuestro proyecto, es muy cómodo indicarle algunas particularidades a nuestro proyecto para facilitarle su renderizado. Estas restricciones son las siguientes:</p>
</div>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 33%;">
<col style="width: 33%;">
<col style="width: 33%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Nombre</th>
<th class="tableblock halign-left valign-top">Descripción</th>
<th class="tableblock halign-left valign-top">Ejemplo</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">display</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indica si la propiedad debe mostrare o no en las vistas generadas por el scaffolding. El valor por defecto es <em>true</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">password(display:false)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">editable</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indica si la propiedad es editable o no. Se suele utilizar en aquellas propiedades de solo lectura</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">username(editable:false)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">format</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Especifica el formato aceptado en aquellos tipos que lo acepten, como pueden ser las fechas</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">dateOfBirth(format:'yyyy-MM-dd')</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">password</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indica si la propiedad es una contraseña, con lo que al introducirla no se mostrará directamente</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">password(password:true)</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="_construir_tus_propias_restricciones">5.2.2. Construir tus propias restricciones</h4>
<div class="paragraph">
<p>Pero seríamos un tanto ilusos si pensáramos que el equipo de desarrollo de Grails ha sido capaz de crear todas las posibles restricciones existentes en cualquier aplicación. Ellos no lo han hecho, pero si han dejado la posibilidad de crear nuestras propias restricciones de una forma rápida y sencilla.</p>
</div>
<div class="paragraph">
<p>Si echamos un vistazo a la clase de dominio <em>Todo</em>, podemos detectar que una posible restricción que nos falta por añadir sería la comprobación de que la <em>fecha</em> sea posterior a la fecha actual. Para esta restricción, Grails se ha olvidado de nosotros ya que si repasamos la lista de restricciones predefinidas, no encontramos ninguna que satisfaga dicha restricción. Para crear nuevas restricciones, tenemos el closure <em>validator</em>. Veamos como quedaría esta restricción:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-n">date</span><span class="tok-o">(</span><span class="tok-nl">nullable:</span><span class="tok-kc">true</span><span class="tok-o">,</span>
    <span class="tok-nl">validator:</span> <span class="tok-o">{</span>
        <span class="tok-k">if</span> <span class="tok-o">(</span><span class="tok-n">it</span><span class="tok-o">)</span> <span class="tok-o">{</span>
            <span class="tok-k">return</span> <span class="tok-n">it</span><span class="tok-o">?.</span><span class="tok-na">after</span><span class="tok-o">(</span><span class="tok-k">new</span> <span class="tok-n">Date</span><span class="tok-o">())</span>
        <span class="tok-o">}</span>
        <span class="tok-k">return</span> <span class="tok-kc">true</span>
    <span class="tok-o">}</span>
<span class="tok-o">)</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>El closure <em>validator</em> debe devolver <em>true</em> en caso de que la validación se pase correctamente y <em>false</em> en caso contrario. Gracias a la variable <em>it</em> podemos acceder al valor introducido para analizarlo y comprobar que cumple los requisitos, en este caso, que la fecha no sea anterior a la actual.</p>
</div>
<div class="paragraph">
<p>Este closure <em>validator</em> también puede recibir un par de parámetros que nos permitirá evaluar el valor proporcionado a una propiedad con respecto a cualquier otra propiedad del objeto. El siguiente ejemplo de restricción nos permitirá comprobar que la fecha de recordatorio sea siempre anterior a la fecha de la propia tarea:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-n">reminderDate</span><span class="tok-o">(</span><span class="tok-nl">nullable:</span><span class="tok-kc">true</span><span class="tok-o">,</span>
    <span class="tok-nl">validator:</span> <span class="tok-o">{</span> <span class="tok-n">val</span><span class="tok-o">,</span> <span class="tok-n">obj</span> <span class="tok-o">-&gt;</span>
        <span class="tok-k">if</span> <span class="tok-o">(</span><span class="tok-n">val</span> <span class="tok-o">&amp;&amp;</span> <span class="tok-n">obj</span><span class="tok-o">.</span><span class="tok-na">date</span><span class="tok-o">)</span> <span class="tok-o">{</span>
            <span class="tok-k">return</span> <span class="tok-n">val</span><span class="tok-o">.</span><span class="tok-na">before</span><span class="tok-o">(</span><span class="tok-n">obj</span><span class="tok-o">?.</span><span class="tok-na">date</span><span class="tok-o">)</span>
        <span class="tok-o">}</span>
        <span class="tok-k">return</span> <span class="tok-kc">true</span>
    <span class="tok-o">}</span>
<span class="tok-o">)</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>En ocasiones es conveniente reutilizar el código de una restricción en diferentes propiedades de diferentes clases de dominio. Para ello en lugar de definir la restricción en la clase de dominio la definiremos en el archivo de configuración <em>Config.groovy</em> de la siguiente forma:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-n">grails</span><span class="tok-o">.</span><span class="tok-na">gorm</span><span class="tok-o">.</span><span class="tok-na">default</span><span class="tok-o">.</span><span class="tok-na">constraints</span> <span class="tok-o">=</span> <span class="tok-o">{</span>
    <span class="tok-n">max20chars</span><span class="tok-o">(</span><span class="tok-nl">nullable:</span> <span class="tok-kc">false</span><span class="tok-o">,</span> <span class="tok-nl">blank:</span> <span class="tok-kc">false</span><span class="tok-o">,</span> <span class="tok-nl">maxSize:</span><span class="tok-mi">20</span><span class="tok-o">)</span>
<span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Posteriormente en la propiedad que necesites utilizar esta restricción, debes referenciarla de esta forma:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-kd">class</span> <span class="tok-nc">User</span> <span class="tok-o">{</span>
    <span class="tok-o">...</span>
    <span class="tok-kd">static</span> <span class="tok-n">constraints</span> <span class="tok-o">=</span> <span class="tok-o">{</span>
        <span class="tok-n">password</span> <span class="tok-nl">shared:</span> <span class="tok-s2">&quot;max20chars&quot;</span>
    <span class="tok-o">}</span>
<span class="tok-o">}</span></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_mensajes_de_error_de_las_restricciones">5.2.3. Mensajes de error de las restricciones</h4>
<div class="paragraph">
<p>Sin lugar a dudas, los mensajes que se generan cuando se produce un error en las restricciones de una clase de dominio, no son lo más deseable para un usuario final, así que es necesario que entendamos el mecanismo que utiliza Grails para devolver estos mensajes cuando se producen estos errores.</p>
</div>
<div class="paragraph">
<p>Si recordamos la clase de dominio <em>Todo</em>, tenemos que el título no puede dejarse vacío. Esto lo hacíamos utilizando la restricción <em>blank:false</em>. Al intentar crear una tarea sin escribir su título, recibiremos un mensaje de error como el siguiente <em>La propiedad [title] de la clase [class Todo] no puede ser vacía</em>. Pero, ¿cómo se encarga Grails de mostrar estos mensajes de error?</p>
</div>
<div class="paragraph">
<p>Grails implementa un sistema jerárquico para los mensajes de error basado en diferentes aspectos como puede ser el nombre de la clase de dominio, la propiedad o el tipo de validación. Para el caso del error producido al saltarnos la restricción de no dejar en blanco el campo <em>title</em> de la clase de dominio <em>Todo</em>, dicha jerarquía sería la siguiente.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-n">todo</span><span class="tok-o">.</span><span class="tok-na">title</span><span class="tok-o">.</span><span class="tok-na">blank</span><span class="tok-o">.</span><span class="tok-na">error</span><span class="tok-o">.</span><span class="tok-na">title</span>
<span class="tok-n">todo</span><span class="tok-o">.</span><span class="tok-na">title</span><span class="tok-o">.</span><span class="tok-na">blank</span><span class="tok-o">.</span><span class="tok-na">error</span><span class="tok-o">.</span><span class="tok-na">java</span><span class="tok-o">.</span><span class="tok-na">lang</span><span class="tok-o">.</span><span class="tok-na">String</span>
<span class="tok-n">todo</span><span class="tok-o">.</span><span class="tok-na">title</span><span class="tok-o">.</span><span class="tok-na">blank</span><span class="tok-o">.</span><span class="tok-na">error</span>
<span class="tok-n">todo</span><span class="tok-o">.</span><span class="tok-na">title</span><span class="tok-o">.</span><span class="tok-na">blank</span><span class="tok-o">.</span><span class="tok-na">title</span>
<span class="tok-n">todo</span><span class="tok-o">.</span><span class="tok-na">title</span><span class="tok-o">.</span><span class="tok-na">blank</span><span class="tok-o">.</span><span class="tok-na">java</span><span class="tok-o">.</span><span class="tok-na">lang</span><span class="tok-o">.</span><span class="tok-na">String</span>
<span class="tok-n">todo</span><span class="tok-o">.</span><span class="tok-na">title</span><span class="tok-o">.</span><span class="tok-na">blank</span>
<span class="tok-n">blank</span><span class="tok-o">.</span><span class="tok-na">title</span>
<span class="tok-n">blank</span><span class="tok-o">.</span><span class="tok-na">java</span><span class="tok-o">.</span><span class="tok-na">lang</span><span class="tok-o">.</span><span class="tok-na">String</span>
<span class="tok-n">blank</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Este sería el orden en el que Grails buscaría en nuestro archivo <em>message.properties</em> hasta encontrar cualquier propiedad y mostrar su mensaje. En caso de no encontrar ninguna de estas propiedades, se mostraría la cadena asociado a la propiedad <em>default.blank.message</em>, que es la que encontramos por defecto en el archivo <em>message.properties</em>.</p>
</div>
<div class="paragraph">
<p>De esta forma, ya podemos personalizar los mensajes de error generados al incumplir las restricciones de nuestras clases de dominio. Simplemente comentar que para las restricciones creadas por nosotros mismos, la jerarquía de los mensajes en el validador introducido en la clase de dominio <em>Todo</em> empezaría por <em>todo.date.validator.error.date</em> y así sucesivamente tal y como hemos visto anteriormente.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_aspectos_avanzados_de_gorm">5.3. Aspectos avanzados de GORM</h3>
<div class="paragraph">
<p>Ahora que ya hemos visto la parte básica a la hora de crear una clase de dominio (establecer sus propiedades, las restricciones y las relaciones entre ellas), vayamos un paso más adelante y veamos aspectos algo más avanzados de GORM</p>
</div>
<div class="sect3">
<h4 id="_ajustes_de_mapeado">5.3.1. Ajustes de mapeado</h4>
<div class="paragraph">
<p>Hay ocasiones en que los administradores de las bases de datos quieren, por cualquier motivo, que las columnas de las tablas de <em>sus</em> bases de datos sean nombradas siguiendo un determinado patrón. Estos motivos pueden ir desde cuestiones de facilidad en la lectura de los campos hasta argumentos como <em>"así se ha hecho toda la vida y no se va a cambiar"</em>. El tema está en que hay que conformarse con sus ordenes y acatarlas y encontrar la mejor forma para adaptarse a ellas.</p>
</div>
<div class="paragraph">
<p>Para solucionar este posible problema que se nos puede plantear en cualquier organización, GORM dispone de una forma rápida y sencilla para ajustar estos nombres de las columnas de las tablas relacionadas. Para ello, GORM emplea una sintaxis de tipo DSL y exige crear un nuevo closure estático llamado <em>mapping</em> de la siguiente forma <em>static mapping = {//Todo el mapeado de la tabla aquí}</em>. Veamos los posibles cambios que podemos hacer con GORM.</p>
</div>
<div class="sect4">
<h5 id="_nombres_de_las_tablas_y_las_columnas">Nombres de las tablas y las columnas</h5>
<div class="paragraph">
<p>Si necesitáramos cambiar por ejemplo el nombre de la tabla <em>todo</em> por <em>tbl_todo</em>, deberíamos escribir dentro del closure <em>mapping</em> el siguiente código <em>table 'tbl_todo'</em>. Si ahora quisiéramos cambiar el nombre de la columna <em>description</em> por <em>desc</em>, podríamos hacer lo siguiente:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-kd">class</span> <span class="tok-nc">Todo</span> <span class="tok-o">{</span>
    <span class="tok-o">....</span>
    <span class="tok-kd">static</span> <span class="tok-n">mapping</span> <span class="tok-o">=</span> <span class="tok-o">{</span>
        <span class="tok-n">table</span> <span class="tok-s1">&#39;tbl_todo&#39;</span>
        <span class="tok-n">description</span> <span class="tok-nl">column:</span><span class="tok-s1">&#39;desc&#39;</span>
    <span class="tok-o">}</span>
<span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Con esto, ya tendríamos cambiados los nombres de las tablas y de las columnas para adaptarlos al convenio que nosotros queramos seguir.</p>
</div>
</div>
<div class="sect4">
<h5 id="_deshabilitar_el_campo_version">Deshabilitar el campo version</h5>
<div class="paragraph">
<p>Por defecto, GORM utiliza un campo llamado <em>version</em> para garantizar la integridad de los datos y está demostrado que es un buen método. Sin embargo, por cualquier motivo es posible que no queramos tener este campo en nuestra tabla y para ello, simplemente debemos especificar en el mapeado de la clase lo siguiente: <em>version false</em>.</p>
</div>
</div>
<div class="sect4">
<h5 id="_carga_perezosa_de_los_datos">Carga perezosa de los datos</h5>
<div class="paragraph">
<p>Por defecto, Grails realiza una carga perezosa de los datos de las propiedades. Esto es que no se cargarán en memoria hasta que no sean solicitados por la operación, lo cual nos previene de posibles pérdidas de rendimiento al cargar demasiados datos innecesarios. Sin embargo, si queremos cambiar este comportamiento por defecto de Grails, podemos hacerlo de dos formas:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-kd">class</span> <span class="tok-nc">Person</span> <span class="tok-o">{</span>

    <span class="tok-n">String</span> <span class="tok-n">firstName</span> <span class="tok-n">Pet</span> <span class="tok-n">pet</span>

    <span class="tok-kd">static</span> <span class="tok-n">hasMany</span> <span class="tok-o">=</span> <span class="tok-o">[</span><span class="tok-nl">addresses:</span> <span class="tok-n">Address</span><span class="tok-o">]</span>

    <span class="tok-kd">static</span> <span class="tok-n">mapping</span> <span class="tok-o">=</span> <span class="tok-o">{</span>
        <span class="tok-n">addresses</span> <span class="tok-nl">lazy:</span> <span class="tok-kc">false</span>
        <span class="tok-n">pet</span> <span class="tok-nl">fetch:</span> <span class="tok-s1">&#39;join&#39;</span>
    <span class="tok-o">}</span>
<span class="tok-o">}</span>


<span class="tok-kd">class</span> <span class="tok-nc">Address</span> <span class="tok-o">{</span>
    <span class="tok-n">String</span> <span class="tok-n">street</span>
    <span class="tok-n">String</span> <span class="tok-n">postCode</span>
<span class="tok-o">}</span>


<span class="tok-kd">class</span> <span class="tok-nc">Pet</span> <span class="tok-o">{</span>
    <span class="tok-n">String</span> <span class="tok-n">name</span>
<span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Indicando <em>addresses lazy: false</em> nos aseguramos que cuando los datos de una persona se carguen en nuestra aplicación, sus direcciones serán cargadas al mismo tiempo. Por otro lado, con la opción <em>pet fetch:'join'</em> hacemos básicamente lo mismo salvo que en lugar de hacerlo con un <em>SELECT</em> como se estaría haciendo con la opción anterior lo estaríamos haciendo con una operación de tipo <em>JOIN</em>. Si queremos reducir el número de queries y mejorar el rendimiento de la operación, deberíamos utilizar la segunda opción. Sin embargo, hay que tener cuidado con estas opciones ya que podemos cargar demasiados datos innecesarios.</p>
</div>
</div>
<div class="sect4">
<h5 id="_sistema_caché">Sistema caché</h5>
<div class="paragraph">
<p>Uno de las grandes ventajas de Hibernate es la posibilidad de utilizar una caché de segundo nivel, que almacena los datos asociados a una clase de dominio. Para configurar esta caché de segundo nivel, en primer lugar debemos modificar el archivo de configuración <em>grails-app/conf/DataSource.groovy</em> para indicarle quien se encargará de gestionar esta caché.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-n">hibernate</span> <span class="tok-o">{</span>
    <span class="tok-n">cache</span><span class="tok-o">.</span><span class="tok-na">use_second_level_cache</span> <span class="tok-o">=</span> <span class="tok-kc">true</span>
    <span class="tok-n">cache</span><span class="tok-o">.</span><span class="tok-na">use_query_cache</span> <span class="tok-o">=</span> <span class="tok-kc">true</span>
    <span class="tok-n">cache</span><span class="tok-o">.</span><span class="tok-na">region</span><span class="tok-o">.</span><span class="tok-na">factory_class</span> <span class="tok-o">=</span> <span class="tok-s1">&#39;net.sf.ehcache.hibernate.EhCacheRegionFactory&#39;</span>
    <span class="tok-n">singleSession</span> <span class="tok-o">=</span> <span class="tok-kc">true</span>
    <span class="tok-n">flush</span><span class="tok-o">.</span><span class="tok-na">mode</span> <span class="tok-o">=</span> <span class="tok-s1">&#39;manual&#39;</span>
<span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Posteriormente, para utilizar este sistema de caché, podemos especificarlo en la propia clase de dominio de la siguiente forma:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-kd">class</span> <span class="tok-nc">User</span> <span class="tok-o">{</span>
    <span class="tok-o">...</span>
    <span class="tok-kd">static</span> <span class="tok-n">mapping</span> <span class="tok-o">=</span> <span class="tok-o">{</span>
        <span class="tok-n">table</span> <span class="tok-s1">&#39;tbl_users&#39;</span>
        <span class="tok-n">cache</span> <span class="tok-kc">true</span>
    <span class="tok-o">}</span>
<span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Esta caché sería de tipo <em>lectura-escritura</em> e incluiría todas las propiedades, tanto las perezosas como las no perezosas. Pero también es posible ser un poco más específico e indicarle como queremos que se configure la caché de una determinada clase de dominio.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-kd">class</span> <span class="tok-nc">User</span> <span class="tok-o">{</span>
    <span class="tok-o">...</span>
    <span class="tok-kd">static</span> <span class="tok-n">mapping</span> <span class="tok-o">=</span> <span class="tok-o">{</span>
        <span class="tok-n">table</span> <span class="tok-s1">&#39;tbl_users&#39;</span>
        <span class="tok-n">cache</span> <span class="tok-nl">usage:</span> <span class="tok-s1">&#39;read-only&#39;</span><span class="tok-o">,</span> <span class="tok-nl">include:</span> <span class="tok-s1">&#39;non-lazy&#39;</span>
    <span class="tok-o">}</span>
<span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Incluso también podemos especificar la caché para una asociación de la siguiente forma:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-kd">class</span> <span class="tok-nc">Person</span> <span class="tok-o">{</span>

    <span class="tok-n">String</span> <span class="tok-n">firstName</span>

    <span class="tok-kd">static</span> <span class="tok-n">hasMany</span> <span class="tok-o">=</span> <span class="tok-o">[</span><span class="tok-nl">addresses:</span> <span class="tok-n">Address</span><span class="tok-o">]</span>

    <span class="tok-kd">static</span> <span class="tok-n">mapping</span> <span class="tok-o">=</span> <span class="tok-o">{</span>
        <span class="tok-n">table</span> <span class="tok-s1">&#39;people&#39;</span>
        <span class="tok-n">version</span> <span class="tok-kc">false</span>
        <span class="tok-n">addresses</span> <span class="tok-nl">column:</span> <span class="tok-s1">&#39;Address&#39;</span><span class="tok-o">,</span> <span class="tok-nl">cache:</span> <span class="tok-kc">true</span>
    <span class="tok-o">}</span>
<span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>De esta forma, sólo estaríamos cacheando la propiedad <em>addresses</em> de la clase <em>Person</em>.</p>
</div>
</div>
<div class="sect4">
<h5 id="_modificar_la_clave_primaria">Modificar la clave primaria</h5>
<div class="paragraph">
<p>En ocasiones podemos necesitar modificar el sistema de clave primaria que utiliza Grails por defecto en el que se añade una propiedad llamada <em>id</em> autonumérico. Podríamos por ejemplo establecer como clave primaria de la tabla de las tareas la composición del título y la categoría de la siguiente forma:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-kd">static</span> <span class="tok-n">mapping</span> <span class="tok-o">=</span> <span class="tok-o">{</span>
    <span class="tok-n">id</span> <span class="tok-nl">composite:</span> <span class="tok-o">[</span><span class="tok-s1">&#39;title&#39;</span><span class="tok-o">,</span> <span class="tok-s1">&#39;category&#39;</span><span class="tok-o">]</span>
<span class="tok-o">}</span></code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_herencia_de_clases">5.3.2. Herencia de clases</h4>
<div class="paragraph">
<p>La herencia de clases es algo muy común y GORM lo implementa de forma tan sencilla como <em>extendiendo</em> la clase. Por ejemplo, imagina el caso de una clase de dominio Usuario que a su vez puede tener 3 tipos distintos. Podríamos tener algo así:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-kd">class</span> <span class="tok-nc">User</span><span class="tok-o">{</span>
    <span class="tok-o">....</span>
<span class="tok-o">}</span>

<span class="tok-kd">class</span> <span class="tok-nc">Administrator</span> <span class="tok-kd">extends</span> <span class="tok-n">User</span><span class="tok-o">{</span>
    <span class="tok-o">....</span>
<span class="tok-o">}</span>

<span class="tok-kd">class</span> <span class="tok-nc">Registered</span> <span class="tok-kd">extends</span> <span class="tok-n">User</span><span class="tok-o">{</span>
    <span class="tok-o">....</span>
<span class="tok-o">}</span>

<span class="tok-kd">class</span> <span class="tok-nc">Guest</span> <span class="tok-kd">extends</span> <span class="tok-n">User</span><span class="tok-o">{</span>
    <span class="tok-o">....</span>
<span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Pero, ¿cómo se transformaría esto en la base de datos? GORM habría almacenado todos los datos en una única tabla y además, hubiera añadido un campo llamado <em>class</em> que permitiría distinguir el tipo de instancia creada. No obstante, si optásemos por tener una tabla por cada tipo de usuario, podríamos tener lo siguiente:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-kd">class</span> <span class="tok-nc">User</span><span class="tok-o">{</span>
    <span class="tok-o">....</span>
<span class="tok-o">}</span>

<span class="tok-kd">class</span> <span class="tok-nc">Administrator</span> <span class="tok-kd">extends</span> <span class="tok-n">User</span><span class="tok-o">{</span>
    <span class="tok-kd">static</span> <span class="tok-n">mapping</span> <span class="tok-o">=</span> <span class="tok-o">{</span>
        <span class="tok-n">table</span> <span class="tok-o">=</span> <span class="tok-s1">&#39;administrator&#39;</span>
    <span class="tok-o">}</span>
<span class="tok-o">}</span>

<span class="tok-kd">class</span> <span class="tok-nc">Registered</span> <span class="tok-kd">extends</span> <span class="tok-n">User</span><span class="tok-o">{</span>
    <span class="tok-kd">static</span> <span class="tok-n">mapping</span> <span class="tok-o">=</span> <span class="tok-o">{</span>
        <span class="tok-n">table</span> <span class="tok-o">=</span> <span class="tok-s1">&#39;registered&#39;</span>
    <span class="tok-o">}</span>
<span class="tok-o">}</span>

<span class="tok-kd">class</span> <span class="tok-nc">Guest</span> <span class="tok-kd">extends</span> <span class="tok-n">User</span><span class="tok-o">{</span>
    <span class="tok-kd">static</span> <span class="tok-n">mapping</span> <span class="tok-o">=</span> <span class="tok-o">{</span>
        <span class="tok-n">table</span> <span class="tok-o">=</span> <span class="tok-s1">&#39;guest&#39;</span>
    <span class="tok-o">}</span>
<span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Otra opción sería especificar en la clase padre la propiedad <em>tablePerHierarchy</em> a falso de la siguiente forma:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-kd">class</span> <span class="tok-nc">User</span><span class="tok-o">{</span>
    <span class="tok-o">.....</span>
    <span class="tok-kd">static</span> <span class="tok-n">mapping</span> <span class="tok-o">=</span> <span class="tok-o">{</span>
        <span class="tok-n">tablePerHierarchy</span> <span class="tok-kc">false</span>
    <span class="tok-o">}</span>
<span class="tok-o">}</span></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_propiedades_transitorias">5.3.3. Propiedades transitorias</h4>
<div class="paragraph">
<p>Por defecto, con GORM todas las propiedades definidas en una clase de dominio son persistidas en la base de datos. Sin embargo, en ocasiones es posible que tengamos determinadas propiedades que no deseamos que sean almacenadas en la base de datos, tales como por ejemplo la confirmación de una contraseña por parte de un usuario. Para ello, podemos añadir una nueva propiedad llamada <em>transients</em> a la clase de dominio correspondiente con la propiedad que no deseamos persistir en la base de datos.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-kd">class</span> <span class="tok-nc">User</span> <span class="tok-o">{</span>
    <span class="tok-kd">static</span> <span class="tok-n">transients</span> <span class="tok-o">=</span> <span class="tok-o">[</span><span class="tok-s2">&quot;confirmPassword&quot;</span><span class="tok-o">]</span>

    <span class="tok-n">String</span> <span class="tok-n">username</span>
    <span class="tok-n">String</span> <span class="tok-n">password</span>
    <span class="tok-n">String</span> <span class="tok-n">confirmPassword</span>
    <span class="tok-n">String</span> <span class="tok-n">name</span>
    <span class="tok-n">String</span> <span class="tok-n">surnames</span>
<span class="tok-o">}</span></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_eventos_gorm">5.3.4. Eventos GORM</h4>
<div class="paragraph">
<p>GORM dispone de dos métodos que se llaman automáticamente antes y después de insertar y actualizar las tablas de la base de datos. Estos métodos son <em>beforeInsert()</em> y <em>beforeUpdate()</em>. Gracias a estos métodos, vamos a poder realizar determinadas operaciones siempre antes de insertar o actualizar datos de nuestros registros. Por ejemplo, imagina el caso en el que tuviéramos que almacenar quien creó una tarea y quien fue la última persona en actualizarla. Necesitaríamos por ejemplo un par de propiedades llamadas <em>createdBy</em> y <em>lastModifiedBy</em>. Para automáticamente actualizar esta información en nuestra clase de dominio, podríamos utilizar los métodos <em>beforeInsert()</em> y <em>beforeUpdate()</em> de la siguiente forma:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-kd">class</span> <span class="tok-nc">Todo</span> <span class="tok-o">{</span>
    <span class="tok-o">....</span>
    <span class="tok-n">User</span> <span class="tok-n">createdBy</span>
    <span class="tok-n">User</span> <span class="tok-n">lastModifiedBy</span>

    <span class="tok-kt">def</span> <span class="tok-n">beforeInsert</span> <span class="tok-o">=</span> <span class="tok-o">{</span>
        <span class="tok-n">createdBy</span> <span class="tok-o">=</span> <span class="tok-n">session</span><span class="tok-o">?.</span><span class="tok-na">user</span>
        <span class="tok-n">lastModifiedBy</span> <span class="tok-o">=</span> <span class="tok-n">session</span><span class="tok-o">?.</span><span class="tok-na">user</span>
    <span class="tok-o">}</span>

    <span class="tok-kt">def</span> <span class="tok-n">beforeUpdate</span> <span class="tok-o">=</span> <span class="tok-o">{</span>
        <span class="tok-n">lastModifiedBy</span> <span class="tok-o">=</span> <span class="tok-n">session</span><span class="tok-o">?.</span><span class="tok-na">user</span>
    <span class="tok-o">}</span>
<span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Además de estos dos métodos comentados, GORM también dispone de los métodos <em>beforeDelete()</em>, <em>beforeValidate()</em>, <em>afterInsert()</em>, <em>afterUpdate()</em>, <em>afterDelete()</em> y <em>onLoad()</em>.</p>
</div>
</div>
<div class="sect3">
<h4 id="_fechas_automáticas">5.3.5. Fechas automáticas</h4>
<div class="paragraph">
<p>Grails además presenta una característica conocida como <em>automatic timestamping</em>. Con esta característica si queremos saber de una instancia de una determinada clase cuando se creo y cuando se modificó por última vez, simplemente debemos crear dos propiedades de tipo <em>Date</em> en la clase de dominio llamadas <em>dateCreated</em> y <em>lastUpdated</em> y Grails se encargará automáticamente de rellenar esta información por nosotros.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-kd">class</span> <span class="tok-nc">Todo</span> <span class="tok-o">{</span>
    <span class="tok-o">....</span>
    <span class="tok-n">Date</span> <span class="tok-n">dateCreated</span>
    <span class="tok-n">Date</span> <span class="tok-n">lastUpdated</span>
<span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Si por cualquier motivo, deseamos tener estas dos propiedades pero desactivar el <em>automatic timestamping</em>, podemos hacerlo de la siguiente forma:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-kd">static</span> <span class="tok-n">mapping</span> <span class="tok-o">=</span> <span class="tok-o">{</span>
    <span class="tok-n">autoTimestamp</span> <span class="tok-kc">false</span>
<span class="tok-o">}</span></code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_interactuar_con_la_base_de_datos">5.4. Interactuar con la base de datos</h3>
<div class="paragraph">
<p>Cuando interactuamos con una base de datos, lo primero que debemos conocer es como realizar las operaciones básicas en cualquier aplicación (CRUD). Si echamos un vistazo al código del controlador de la clase de dominio <em>Todo</em>, detectaremos la presencia de los métodos <em>delete()</em> y <em>save()</em>. También podemos comprobar como no existe ninguno de estos dos métodos implementados en la clase de dominio <em>Todo</em>. Entonces, ¿cómo es capaz Grails de persistir la información en la base de datos si ninguno de estos dos métodos existen?</p>
</div>
<div class="paragraph">
<p>En Grails tenemos varias formas de realizar consultas a la base de datos que son:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Consultas dinámicas de GORM</p>
</li>
<li>
<p>Consultas HQL de Hibernate</p>
</li>
<li>
<p>Consultas Criteria de Hibernate</p>
</li>
</ul>
</div>
<div class="sect3">
<h4 id="_consultas_dinámicas_de_gorm">5.4.1. Consultas dinámicas de GORM</h4>
<div class="paragraph">
<p>Básicamente, la consultas dinámicas de GORM son muy similares a los métodos que habéis visto en el módulo de JPA con lo que únicamente veremos un resumen de las mismas.</p>
</div>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 14%;">
<col style="width: 42%;">
<col style="width: 42%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Método</th>
<th class="tableblock halign-left valign-top">Descripción</th>
<th class="tableblock halign-left valign-top">Ejemplo</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>count()</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Devuelve el número total de registros de una determinada clase de dominio</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>Todo.count()</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>countBy()</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Devuelve el número total de registros de una determinada clase de dominio que cumplan una serie de requisitos encadenados tras el nombre del método</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>Todo.countByTitle('Pintar cocina')</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>findBy()</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Devuelve el primer registro encontrado de una determinada clase de dominio que cumpla una serie de requisitos encadenados tras el nombre del método</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>Todo.findByTitle('Pintar cocina')</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>findWhere()</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Devuelve el primer registro encontrado de una determinada clase de dominio que cumpla una serie de requisitos pasados por parámetro en forma de mapa</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>Todo.findWhere(["title":"Pintar cocina"])</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>findAllBy()</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Devuelve todos los registros encontrados de una determinada clase de dominio que cumplan una serie de requisitos encadenados tras el nombre del método</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>Todo.findAllByTitleIlike('%cocina%')</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>findAllWhere()</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Devuelve todos los registros encontrados de una determinada clase de dominio que cumplan una serie de requisitos pasados por parámetro en forma de mapa</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>Todo.findAllWhere(["title":"Pintar cocina"])</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>get()</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Devuelve el registro de una determinada clase de dominio cuyo identificador coincida con el pasado como parámetro</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>Todo.get(1)</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>getAll()</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Devuelve todos los registros de una determinada clase de dominio cuyo identificador coincida con cualquier de los pasados parámetro en forma de lista</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>Todo.getAll([1,3])</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>list()</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Devuelve todos los registros de una determinada clase de dominio. Acepta los parámetros <em>max</em>, <em>offset</em>, <em>sort</em> y <em>order</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>Todo.list(["max":10, "offset":0, "sort":"title", "order":"asc"])</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>listOrderBy()</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Devuelve todos los registros de una determinada clase de dominio ordenador por un criterio. Acepta los parámetros <em>max</em>, <em>offset</em> y <em>order</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>Todo.listOrderByName(["max":10, "offset":0, "order":"asc"])</em></p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Podemos además encadenar varias propiedades junto con el operador utilizado, como por ejemplo:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-n">Todo</span><span class="tok-o">.</span><span class="tok-na">findAllByTitleAndDescriptionAndDone</span><span class="tok-o">(</span><span class="tok-s1">&#39;Pintar cocina&#39;</span><span class="tok-o">,</span><span class="tok-kc">null</span><span class="tok-o">,</span> <span class="tok-kc">false</span><span class="tok-o">)</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Seguido de la propiedad podemos indicar el método a seguir en la comparación de registros. En la siguiente tabla se muestra una tabla resumen de esos métodos que podemos utilizar en las comparaciones.</p>
</div>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 14%;">
<col style="width: 42%;">
<col style="width: 42%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Método</th>
<th class="tableblock halign-left valign-top">Descripción</th>
<th class="tableblock halign-left valign-top">Ejemplo</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">InList</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Devuelve aquellos registros en los que el valor de la propiedad dada coincida con cualquiera de los elementos de la lista pasada por parámetro</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Category.findAllByNameInList(["Hogar","Trabajo"])</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">LessThan</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Devuelve aquellos registros en los que el valor de la propiedad dada sea menor que el valor pasado por parámetro</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">House.findAllByPriceLessThan(150000)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">LessThanEquals</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Devuelve aquellos registros en los que el valor de la propiedad dada sea menor o igual que el valor pasado por parámetro</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">House.findAllByPriceLessThanEquals(150000)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">GreaterThan</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Devuelve aquellos registros en los que el valor de la propiedad dada sea mayor que el valor pasado por parámetro</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Car.findAllByPriceGreaterThan(25000)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">GreaterThanEquals</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Devuelve aquellos registros en los que el valor de la propiedad dada sea mayor o igual que el valor pasado por parámetro</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Car.findAllByPriceGreaterThanEquals(25000)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Like</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Es equivalente a una expresión <em>LIKE</em> en una sentencia SQL</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Todo.findAllByTitleLike('%cocina%')</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ILike</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Similar al método <em>Like</em> salvo que en esta ocasión <em>case insensitive</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Todo.findAllByTitleIlike('%cocina%')</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">NotEqual</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Devuelve aquellos registros en los que el valor de la propiedad dada no sea igual al valor pasado por parámetro</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Todo.findAllByDoneNotEqual(true)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Between</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Devuelve aquellos registros en los que el valor de la propiedad dada se encuentre entre los dos valores pasados por parámetro. Necesita de dos parámetros.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Car.findAllByPriceBetween(10000,20000)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">IsNotNull</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Devuelve aquellos registros en los que el valor de la propiedad dada no sea nula. No se necesita ningún argumento.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">User.findAllByDateOfBirthIsNotNull()</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">IsNull</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Devuelve aquellos registros en los que el valor de la propiedad dada sea nula</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">User.findAllByDateOfBirthIsNull()</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="_consultas_hql_de_hibernate">5.4.2. Consultas HQL de Hibernate</h4>
<div class="paragraph">
<p>Otra forma de realizar consultas sobre la base de datos es mediante el lenguaje de consulta propio de Hibernate, HQL (Hibernate Query Language). Con los métodos dinámicos de GORM vimos que teníamos la posibilidad de ejecutar llamadas a métodos para obtener un registro o un conjunto. Con HQL vamos a tener también esta capacidad con los métodos <em>find()</em> y <em>findAll()</em> más uno nuevo llamado <em>executeQuery()</em>.</p>
</div>
<div class="paragraph">
<p>Con el método <em>find()</em> vamos a poder obtener el primer registro devuelto de la consulta HQL pasada por parámetro. El siguiente ejemplo, devuelve la primera tarea que encuentre en la clase de dominio <em>Todo</em>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-kt">def</span> <span class="tok-n">sentenciaHQL1</span> <span class="tok-o">=</span> <span class="tok-n">Todo</span><span class="tok-o">.</span><span class="tok-na">find</span><span class="tok-o">(</span><span class="tok-s2">&quot;From Todo as t&quot;</span><span class="tok-o">)</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Pero lo habitual no es simplemente obtener el primer registro sino que normalmente necesitaremos obtener todos los registros que cumplan una serie de condiciones para posteriormente, actuar en consecuencia. Al igual que con los métodos dinámicos de GORM, HQL dispone también del método <em>findAll()</em> al cual debemos pasarle por parámetro la sentencia HQL correspondiente. En el siguiente ejemplo, vamos a ver tres formas diferentes de obtener determinadas tareas de nuestra aplicación.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-kt">def</span> <span class="tok-n">hqlsentence2</span> <span class="tok-o">=</span> <span class="tok-n">Todo</span><span class="tok-o">.</span><span class="tok-na">findAll</span><span class="tok-o">(</span><span class="tok-s2">&quot;from Todo as t where t.title=&#39;Pintar cocina&#39;&quot;</span><span class="tok-o">)</span>

<span class="tok-kt">def</span> <span class="tok-n">hqlsentence3</span> <span class="tok-o">=</span> <span class="tok-n">Todo</span><span class="tok-o">.</span><span class="tok-na">findAll</span><span class="tok-o">(</span><span class="tok-s2">&quot;from Todo as t where t.title=?&quot;</span><span class="tok-o">,</span> <span class="tok-o">[</span><span class="tok-s2">&quot;Escribir tests unitarios&quot;</span><span class="tok-o">])</span>

<span class="tok-kt">def</span> <span class="tok-n">hqlsentence4</span> <span class="tok-o">=</span> <span class="tok-n">Todo</span><span class="tok-o">.</span><span class="tok-na">findAll</span><span class="tok-o">(</span><span class="tok-s2">&quot;from Todo as t where t.title=:title&quot;</span><span class="tok-o">,</span> <span class="tok-o">[</span><span class="tok-nl">title:</span><span class="tok-s2">&quot;Cocinar pastel&quot;</span><span class="tok-o">])</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>En la primera de ellas, la sentencia HQL se pasa como parámetro al método <em>findAll()</em> tal cual y sin utilizar ningún parámetro. También es posible pasar parámetros a la sentencia HQL tal y como se ha hecho en la segunda forma. Utilizando el caracter <em>?</em> le especificamos que es valor se pasará en forma de parámetro posicional, es decir, el primer caracter <em>?</em> encontrado en la sentencia HQL se referirá al primer parámetro pasado, el segundo <em>?</em> al segundo parámetro y así sucesivamente.</p>
</div>
<div class="paragraph">
<p>Otra forma posible de implementar sentencias HQL es pasando un mapa con las variables introducidas en la sentencia HQL. Para introducir una variable en una sentencia HQL basta con escribir el carácter <em>:</em> seguido del nombre de la variable que deseemos crear. En el ejemplo hemos creado la variable <em>title</em>, que posteriormente se rellenará en el mapa pasado como parámetro.</p>
</div>
<div class="paragraph">
<p>De igual forma que veíamos anteriormente con los métodos <em>list()</em> y <em>listOrderBy()</em>, HQL permite utilizar los parámetros <em>max</em>, <em>offset</em>, <em>sort</em> y <em>order</em> para afinar aún más la búsqueda.</p>
</div>
<div class="paragraph">
<p>Por último, el método <em>executeQuery()</em> es algo diferente a los métodos <em>find()</em> y <em>findAll()</em>. En estos dos métodos se devolvían todas las columnas de la tabla en cuestión, cosa que no siempre puede ser necesaria. El método <em>executeQuery()</em> permite seleccionar que columnas vamos a devolver. El siguiente ejemplo devuelve sólo la <em>fecha</em> de la tarea cuyo título sea "Pintar cocina".</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-n">Todo</span><span class="tok-o">.</span><span class="tok-na">executeQuery</span><span class="tok-o">(</span><span class="tok-s2">&quot;select date from Todo t where t.title=&#39;Pintar cocina&#39;&quot;</span><span class="tok-o">)</span></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_consultas_criteria_de_hibernate">5.4.3. Consultas Criteria de Hibernate</h4>
<div class="paragraph">
<p>El último método para realizar consultas a la base de datos se refiere a la utilización de <em>Criteria</em>, un API de Hibernate diseñado específicamente para la realización de consultas complejas. En Grails, Criteria está basado en un <em>Builder de Groovy</em> y el código mostrado a continuación es un ejemplo de utilización de éste. En este ejemplo vamos a ver como podríamos obtener un listado de las siguientes 15 tareas a realizar en los próximos 10 días ordenadas ascendentemente.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-kt">void</span> <span class="tok-nf">nextTodos</span><span class="tok-o">()</span> <span class="tok-o">{</span>
    <span class="tok-kt">def</span> <span class="tok-n">c</span> <span class="tok-o">=</span> <span class="tok-n">Todo</span><span class="tok-o">.</span><span class="tok-na">createCriteria</span><span class="tok-o">()</span>
    <span class="tok-kt">def</span> <span class="tok-n">result</span> <span class="tok-o">=</span> <span class="tok-n">c</span><span class="tok-o">{</span>
        <span class="tok-n">between</span><span class="tok-o">(</span><span class="tok-s2">&quot;date&quot;</span><span class="tok-o">,</span><span class="tok-k">new</span> <span class="tok-n">Date</span><span class="tok-o">(),</span><span class="tok-k">new</span> <span class="tok-n">Date</span><span class="tok-o">()+</span><span class="tok-mi">10</span><span class="tok-o">)</span>
        <span class="tok-n">maxResults</span><span class="tok-o">(</span><span class="tok-mi">15</span><span class="tok-o">)</span>
        <span class="tok-n">order</span><span class="tok-o">(</span><span class="tok-s2">&quot;date&quot;</span><span class="tok-o">,</span><span class="tok-s2">&quot;asc&quot;</span><span class="tok-o">)</span>
    <span class="tok-o">}</span>
<span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Criteria dispone de una serie de <em>criterios</em> disponibles para ser utilizados en este tipo de consultas. En el ejemplo hemos utilizado <em>between</em>, <em>maxResults</em> y <em>order</em>, pero existen muchos más que vamos a ver en la siguiente tabla.</p>
</div>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 14%;">
<col style="width: 42%;">
<col style="width: 42%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Criterio</th>
<th class="tableblock halign-left valign-top">Descripción</th>
<th class="tableblock halign-left valign-top">Ejemplo</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">between</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Cuando el valor de la propiedad se encuentra entre dos valores</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>between("date",new Date()-10, new Date())</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">eq</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Cuando el valor de una propiedad es igual al valor pasado por parámetro</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>eq("make","volkswagen")</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">eqProperty</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Cuando dos propiedades tienen el mismo valor</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>eqProperty("startDate","endDate")</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">gt</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Cuando el valor de una propiedad es mayor que el valor pasado por parámetro</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>gt("date",new Date()-5)</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">gtProperty</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Cuando el valor de una propiedad es mayor que el valor de la propiedad pasada por parámetro</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>gtProperty("startDate","endDate")</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ge</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Cuando el valor de una propiedad es mayor o igual que el valor pasado por parámetro</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>ge("date", new Date()-5)</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">geProperty</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Cuando el valor de una propiedad es mayor o igual que el valor de la propiedad pasada por parámetro</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>geProperty("startDate", "endDate")</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">idEq</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Cuando el identificador de un objeto es igual al valor pasado por parámetro</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>idEq(1)</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ilike</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">La sentencia SQL like, pero en modo <em>case insensitive</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>ilike("name", "fran%")</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">in</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Cuando el valor de la propiedad es cualquiera de los valores pasados por parámetro. In es una palabra reservada en Groovy, así que debemos utilizar las comillas simples</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>'in'("age",[18..65])</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">isEmpty</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Cuando la propiedad se encuentra vacía</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>isEmpty("description")</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">isNotEmpty</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Cuando la propiedad no se encuentra vacía</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>isNotEmpty("description")</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">isNull</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Cuando el valor de la propiedad es <em>null</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>isNull("description")</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">isNotNull</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Cuando el valor de la propiedad no es <em>null</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>isNotNull("description")</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">lt</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Cuando el valor de una propiedad es menor que el valor pasado por parámetro</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>lt("startDate",new Date()-5)</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ltProperty</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Cuando el valor de una propiedad es menor que el valor de la propiedad pasada por parámetro</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>ltProperty("startDate","endDate")</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">le</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Cuando el valor de una propiedad es menor o igual que el valor pasado por parámetro</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>le("startDate",new Date()-5)</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">leProperty</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Cuando el valor de una propiedad es menor o igual que el valor de la propiedad pasada por parámetro</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>leProperty("startDate","endDate")</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">like</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">La sentencia SQL like</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>like("name","Fran%")</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ne</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Cuando el valor de una propiedad no es igual al valor pasado por parámetro</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>ne("model","volkswagen")</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">neProperty</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Cuando el valor de una propiedad no es igual al valor de la propiedad pasada por parámetro</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>neProperty("startDate","endDate")</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">order</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Ordena los resultados por la propiedad pasada por parámetro y en el orden especificado (asc o desc)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>order("name","asc")</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">rlike</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Similar a la sentencia SQL like, pero utilizando expresiones regulares. Sólo está disponible para Oracle y MySQL</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>rlike("name",/Fran.+/)</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">sizeEq</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Cuando el tamaño del valor de una determinada propiedad es igual al pasado por parámetro</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>sizeEq("name",10)</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">sizeGt</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Cuando el tamaño del valor de una determinada propiedad es mayor al pasado por parámetro</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>sizeGt("name",10)</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">sizeGe</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Cuando el tamaño del valor de una determinada propiedad es mayor o igual al pasado por parámetro</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>sizeGe("name",10)</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">sizeLt</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Cuando el tamaño del valor de una determinada propiedad es menor al pasado por parámetro</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>sizeLt("name",10)</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">sizeLe</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Cuando el tamaño del valor de una determinada propiedad es menor o igual al pasado por parámetro</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>sizeLe("name",10)</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">sizeNe</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Cuando el tamaño del valor de una determinada propiedad no es igual al pasado por parámetro</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>sizeNe("name",10)</em></p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Los criterios de búsqueda se pueden incluso agrupar en bloques lógicos. Estos bloques lógicos serán del tipo <em>AND</em>, <em>OR</em> y <em>NOT</em>. Veamos algunos ejemplos.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-n">and</span> <span class="tok-o">{</span>
    <span class="tok-n">between</span><span class="tok-o">(</span><span class="tok-s2">&quot;date&quot;</span><span class="tok-o">,</span> <span class="tok-k">new</span> <span class="tok-n">Date</span><span class="tok-o">()-</span><span class="tok-mi">10</span><span class="tok-o">,</span> <span class="tok-k">new</span> <span class="tok-n">Date</span><span class="tok-o">())</span>
    <span class="tok-n">ilike</span><span class="tok-o">(</span><span class="tok-s2">&quot;content&quot;</span><span class="tok-o">,</span> <span class="tok-s2">&quot;%texto%&quot;</span><span class="tok-o">)</span>
<span class="tok-o">}</span>

<span class="tok-n">or</span> <span class="tok-o">{</span>
    <span class="tok-n">between</span><span class="tok-o">(</span><span class="tok-s2">&quot;date&quot;</span><span class="tok-o">,</span> <span class="tok-k">new</span> <span class="tok-n">Date</span><span class="tok-o">()-</span><span class="tok-mi">10</span><span class="tok-o">,</span> <span class="tok-k">new</span> <span class="tok-n">Date</span><span class="tok-o">())</span>
    <span class="tok-n">ilike</span><span class="tok-o">(</span><span class="tok-s2">&quot;content&quot;</span><span class="tok-o">,</span> <span class="tok-s2">&quot;%texto%&quot;</span><span class="tok-o">)</span>
<span class="tok-o">}</span>

<span class="tok-n">not</span> <span class="tok-o">{</span>
    <span class="tok-n">between</span><span class="tok-o">(</span><span class="tok-s2">&quot;date&quot;</span><span class="tok-o">,</span> <span class="tok-k">new</span> <span class="tok-n">Date</span><span class="tok-o">()-</span><span class="tok-mi">10</span><span class="tok-o">,</span> <span class="tok-k">new</span> <span class="tok-n">Date</span><span class="tok-o">())</span>
    <span class="tok-n">ilike</span><span class="tok-o">(</span><span class="tok-s2">&quot;content&quot;</span><span class="tok-o">,</span> <span class="tok-s2">&quot;%texto%&quot;</span><span class="tok-o">)</span>
<span class="tok-o">}</span></code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_servicios">5.5. Servicios</h3>
<div class="paragraph">
<p>En cualquier aplicación que utilice el patrón Modelo Vista Controlador, la capa de servicios debe ser la responsable de la lógica de negocio de nuestra aplicación. Si conseguimos esto, nuestra aplicación será fácil de mantener y evolucionará de forma sencilla y eficiente.</p>
</div>
<div class="paragraph">
<p>Cuando implementamos una aplicación siguiendo el patrón MVC, el principal error que se comete es acumular demasiado código en la capa de control. Si en lugar de hacer esto, implementásemos servicios encargados de esta tarea, nuestra aplicación sería más fácil de mantener. Pero, ¿qué son los servicios en Grails?.</p>
</div>
<div class="paragraph">
<p>Siguiendo el paradigma de <em>convención sobre configuración</em>, los servicios no son más que clases cuyo nombre termina en <em>Service</em> y que se ubican en el directorio <em>grails-app/services</em>.</p>
</div>
<div class="paragraph">
<p>En la aplicación que estamos desarrollando como ejemplo, vamos a crear un método en un servicio que devuelva aquellas tareas que estén planeadas para los próximas X días. Para ello, en primer lugar debemos crear el esqueleto del servicio con el comando <em>grails create-service es.ua.expertojava.todo.todo</em>. Este comando, además del servicio, también creará un test unitario. La clase de servicio que hemos creado tiene la siguiente estructura:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-kn">package</span> <span class="tok-n">es</span><span class="tok-o">.</span><span class="tok-na">ua</span><span class="tok-o">.</span><span class="tok-na">expertojava</span><span class="tok-o">.</span><span class="tok-na">todo</span>

<span class="tok-kn">import</span> <span class="tok-nn">grails.transaction.Transactional</span>

<span class="tok-nd">@Transactional</span>
<span class="tok-kd">class</span> <span class="tok-nc">TodoService</span> <span class="tok-o">{</span>

    <span class="tok-kt">def</span> <span class="tok-nf">serviceMethod</span><span class="tok-o">()</span> <span class="tok-o">{</span>

    <span class="tok-o">}</span>
<span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Como vemos, la clase creada especifica la anotación <em>@Transactional</em> que indica que la clase completa con todos los métodos que añadamos serán transaccionales. Esto significa que si en algún método se produce algún error, las operaciones realizadas hasta el momento del error serán desechadas. Sin embargo, existe una forma de ser algo más selectivo e indicar que métodos serán transaccionales y cuales no. Esto se hace también con anotaciones y este es un ejemplo de lo que podríamos tener:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-kn">import</span> <span class="tok-nn">grails.transaction.Transactional</span>

<span class="tok-kd">class</span> <span class="tok-nc">BookService</span> <span class="tok-o">{</span>

    <span class="tok-nd">@Transactional</span><span class="tok-o">(</span><span class="tok-n">readOnly</span> <span class="tok-o">=</span> <span class="tok-kc">true</span><span class="tok-o">)</span>
    <span class="tok-kt">def</span> <span class="tok-nf">listBooks</span><span class="tok-o">()</span> <span class="tok-o">{</span>
        <span class="tok-n">Book</span><span class="tok-o">.</span><span class="tok-na">list</span><span class="tok-o">()</span>
    <span class="tok-o">}</span>

    <span class="tok-nd">@Transactional</span>
    <span class="tok-kt">def</span> <span class="tok-nf">updateBook</span><span class="tok-o">()</span> <span class="tok-o">{</span>
        <span class="tok-c1">// ...</span>
    <span class="tok-o">}</span>

    <span class="tok-kt">def</span> <span class="tok-nf">deleteBook</span><span class="tok-o">()</span> <span class="tok-o">{</span>
        <span class="tok-c1">// ...</span>
    <span class="tok-o">}</span>
<span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>En el método <em>listBooks()</em>, le estamos especificando que el método será transaccional de solo lectura. Por otro lado, el método <em>updateBook()</em> será transaccional de lectura-escritura y por último, y que sirva únicamente como ejemplo, tenemos el método <em>deleteBook()</em> que al no indicarle nada, le estamos diciendo a Grails que no es transaccional (por supuesto, esta operación debería ser transaccional. Tómalo únicamente como un ejemplo).</p>
</div>
<div class="paragraph">
<p>Cuando creábamos el servicio <em>TodoService</em>, Grails generaba automáticamente un método vacío llamado <em>serviceMethod()</em> que ahora vamos a sustituir por uno propio que devuelva una serie de tareas comprendidas entre un par de fechas. El método recibirá una fecha inicio y fin y además, un mapa con una serie de parámetros que utilizaremos para paginar en caso de que sea necesario. El método devolverá una colección de instancias de la clase <em>Todo</em>. También crearemos un método que devuelva un contador de cuantas tareas coinciden con ese criterio.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-kn">package</span> <span class="tok-n">es</span><span class="tok-o">.</span><span class="tok-na">ua</span><span class="tok-o">.</span><span class="tok-na">expertojava</span><span class="tok-o">.</span><span class="tok-na">todo</span>

<span class="tok-kn">import</span> <span class="tok-nn">grails.transaction.Transactional</span>

<span class="tok-kd">class</span> <span class="tok-nc">TodoService</span> <span class="tok-o">{</span>

    <span class="tok-kt">def</span> <span class="tok-nf">getNextTodos</span><span class="tok-o">(</span><span class="tok-n">Integer</span> <span class="tok-n">days</span><span class="tok-o">,</span> <span class="tok-n">params</span><span class="tok-o">)</span> <span class="tok-o">{</span>
        <span class="tok-n">Date</span> <span class="tok-n">now</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">Date</span><span class="tok-o">(</span><span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">currentTimeMillis</span><span class="tok-o">())</span>
        <span class="tok-n">Date</span> <span class="tok-n">to</span> <span class="tok-o">=</span> <span class="tok-n">now</span> <span class="tok-o">+</span> <span class="tok-n">days</span>
        <span class="tok-n">Todo</span><span class="tok-o">.</span><span class="tok-na">findAllByDateBetween</span><span class="tok-o">(</span><span class="tok-n">now</span><span class="tok-o">,</span> <span class="tok-n">to</span><span class="tok-o">,</span> <span class="tok-n">params</span><span class="tok-o">)</span>
    <span class="tok-o">}</span>

    <span class="tok-kt">def</span> <span class="tok-nf">countNextTodos</span><span class="tok-o">(</span><span class="tok-n">Integer</span> <span class="tok-n">days</span><span class="tok-o">)</span> <span class="tok-o">{</span>
        <span class="tok-n">Date</span> <span class="tok-n">now</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">Date</span><span class="tok-o">(</span><span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">currentTimeMillis</span><span class="tok-o">())</span>
        <span class="tok-n">Date</span> <span class="tok-n">to</span> <span class="tok-o">=</span> <span class="tok-n">now</span> <span class="tok-o">+</span> <span class="tok-n">days</span>
        <span class="tok-n">Todo</span><span class="tok-o">.</span><span class="tok-na">countByDateBetween</span><span class="tok-o">(</span><span class="tok-n">now</span><span class="tok-o">,</span> <span class="tok-n">to</span><span class="tok-o">)</span>
    <span class="tok-o">}</span>
<span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>El siguiente paso, será modificar el controlador de la clase de dominio <em>Todo</em> para crear un nuevo método que utilice este servicio recien creado. El método lo vamos a llamar <em>listNextTodos()</em>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-kd">class</span> <span class="tok-nc">TodoController</span> <span class="tok-o">{</span>
    <span class="tok-kt">def</span> <span class="tok-n">todoService</span>

    <span class="tok-o">....</span>

    <span class="tok-kt">def</span> <span class="tok-nf">listNextTodos</span><span class="tok-o">(</span><span class="tok-n">Integer</span> <span class="tok-n">days</span><span class="tok-o">)</span> <span class="tok-o">{</span>
        <span class="tok-n">respond</span> <span class="tok-n">todoService</span><span class="tok-o">.</span><span class="tok-na">getNextTodos</span><span class="tok-o">(</span><span class="tok-n">days</span><span class="tok-o">,</span> <span class="tok-n">params</span><span class="tok-o">),</span>
                <span class="tok-nl">model:</span><span class="tok-o">[</span><span class="tok-nl">todoInstanceCount:</span> <span class="tok-n">todoService</span><span class="tok-o">.</span><span class="tok-na">countNextTodos</span><span class="tok-o">(</span><span class="tok-n">days</span><span class="tok-o">)],</span>
                <span class="tok-nl">view:</span><span class="tok-s2">&quot;index&quot;</span>
    <span class="tok-o">}</span>

    <span class="tok-o">....</span>
<span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Al inicio del controlador debemos crear también la variable <em>def todoService</em> para poder utilizar sus servicios. La convención es que esta variable debe llamarse igual que el servicio salvo que la primera letra será minúscula. De esta forma, una instancia del servicio correspondiente se inyectará convenientemente en nuestro controlador, con lo que no debemos preocuparnos por su ciclo de vida.</p>
</div>
<div class="paragraph">
<p>El método es muy similar al método <em>index()</em> con la excepción de que ahora le pasaremos el parámetro <em>view:"index"</em> para que cuando la petición se realice desde una aplicación web, esta sea renderizada en una página HTML.</p>
</div>
<div class="paragraph">
<p>Con esto tenemos que si accedemos a través del navegador a la url <em><a href="http://localhost:8080/todo/todo/listNextTodos?days=2" class="bare">http://localhost:8080/todo/todo/listNextTodos?days=2</a></em> la aplicación nos mostrará las tareas que tengamos que hacer en los próximos dos días. Si por otro lado ejecutamos desde la línea de comandos:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="bash">curl -v -H <span class="tok-s2">&quot;Accept: text/xml&quot;</span> -H <span class="tok-s2">&quot;Content-type: text/xml&quot;</span> -X GET  http://localhost:8080/todo/todo/listNextTodos?days<span class="tok-o">=</span>2</code></pre>
</div>
</div>
<div class="paragraph">
<p>el resultado será un xml con el contenido de las próximas tareas. En el caso en que necesitemos el resultado en formato JSON:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="bash">curl -v -H <span class="tok-s2">&quot;Accept: application/json&quot;</span> -H <span class="tok-s2">&quot;Content-type: application/json&quot;</span> -X GET  http://localhost:8080/todo/todo/listNextTodos?days<span class="tok-o">=</span>2</code></pre>
</div>
</div>
<div class="sect3">
<h4 id="_Ámbito_de_los_servicios">5.5.1. Ámbito de los servicios</h4>
<div class="paragraph">
<p>Por defecto, todos los servicios en Grails son de tipo <em>singleton</em>, es decir, sólo existe una instancia de la clase que se inyecta en todos los artefactos que declaren la variable correspondiente. Esto puede servirnos para la mayoría de las situaciones, pero tiene un inconveniente y es que no es posible guardar información <em>privada</em> de una petición en el propio servicio puesto que todos los controladores verían la misma instancia y por lo tanto, el mismo valor. Para solucionar esto, podemos declarar una variable <em>scope</em> con cualquiera de los siguiente valores:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><em>prototype</em>: cada vez que se inyecta el servicio en otro artefacto se crea una nueva instancia</p>
</li>
<li>
<p><em>request</em>: se crea una nueva instancia para cada solicitud HTTP</p>
</li>
<li>
<p><em>flash</em>: cada instancia estará accesible para la solicitud HTTP actual y para la siguiente</p>
</li>
<li>
<p><em>flow</em>: cuando declaramos el servicio en un web flow, se creará una instancia nueva en cada flujo</p>
</li>
<li>
<p><em>conversation</em>: cuando declaramos el servicio en un web flow, la instancia será visible para el flujo actual y todos sus sub-flujos (conversación)</p>
</li>
<li>
<p><em>session</em>: se creará una instancia nueva del servicio para cada sesión de usuario</p>
</li>
<li>
<p><em>singleton</em>: sólo existe una instancia del servicio</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Por lo tanto, si queremos modificar el ámbito del servicio para que cada sesión de usuario tenga su propia instancia del servicio, debemos declararlos así:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-kd">class</span> <span class="tok-nc">TodoService</span><span class="tok-o">{</span>
    <span class="tok-kd">static</span> <span class="tok-n">scope</span> <span class="tok-o">=</span> <span class="tok-s1">&#39;session&#39;</span>
    <span class="tok-o">...</span>
<span class="tok-o">}</span></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_servicios_rest">5.5.2. Servicios REST</h4>
<div class="paragraph">
<p>Ya hemos visto durante las sesiones anteriores que es muy sencillo generar en Grails una aplicación que sepa responder a las distintas peticiones de una aplicación web, bien sea a través de una página web o bien desde una aplicación nativa utilizando REST. Pero, ¿qué es exactamente REST?</p>
</div>
<div class="paragraph">
<p>Los servicios web REST son algo más que devolver datos en formato XML o JSON sino que consiste en una forma de trabajar que en función del método HTTP utilizado en la petición se debe procesar mediante una acción u otra, tal y como se representa en la siguiente tabla.</p>
</div>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Método</th>
<th class="tableblock halign-left valign-top">Acción</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">GET</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">show()</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">PUT</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">update()</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">POST</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">save()</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">DELETE</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">delete()</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>A partir de esta tabla, sólo necesitaríamos una url para poder realizar todas las operaciones sobre nuestras clases de dominio. Imagina por ejemplo las operaciones de tipo CRUD sobre los usuarios. Con REST, sólo deberíamos tener una posible url que sería <em><a href="http://localhost:8080/todo/todo/id_todo" class="bare">http://localhost:8080/todo/todo/id_todo</a></em>, donde el identificador de la tarea sería optativo.
Veamos en otra tabla como quedarían todas las posibles peticiones para realizar las operaciones del usuario.</p>
</div>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 33%;">
<col style="width: 33%;">
<col style="width: 33%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">URL</th>
<th class="tableblock halign-left valign-top">Método HTTP</th>
<th class="tableblock halign-left valign-top">Acción</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="http://localhost:8080/todo/todos" class="bare">http://localhost:8080/todo/todos</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">GET</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>show()</em>,  debería mostrar un listado de las tareas</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="http://localhost:8080/todo/todos/4" class="bare">http://localhost:8080/todo/todos/4</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">GET</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>show()</em>, debería mostrar los datos de la tarea con <em>id = 4</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="http://localhost:8080/todo/todos/4" class="bare">http://localhost:8080/todo/todos/4</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">PUT</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>update()</em>, debería actualizar los datos de la tarea con <em>id = 4</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="http://localhost:8080/todo/todos" class="bare">http://localhost:8080/todo/todos</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">POST</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>save()</em>, debería crear una nueva tarea con los datos pasados en el formulario</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="http://localhost:8080/todo/todos/4" class="bare">http://localhost:8080/todo/todos/4</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">DELETE</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>delete()</em>, debería eliminar la tarea con <em>id = 4</em></p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>En Grails la forma más sencilla de exponer clases de dominio como servicios REST es mediante entradas en el archivo de configuración /conf/UrlMappings.groovy, que veremos más adelante en profundidad.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-kd">class</span> <span class="tok-nc">UrlMappings</span> <span class="tok-o">{</span>

    <span class="tok-kd">static</span> <span class="tok-n">mappings</span> <span class="tok-o">=</span> <span class="tok-o">{</span>
        <span class="tok-s2">&quot;/$controller/$action?/$id?(.$format)?&quot;</span><span class="tok-o">{</span>
            <span class="tok-n">constraints</span> <span class="tok-o">{</span>
                <span class="tok-c1">// apply constraints here</span>
            <span class="tok-o">}</span>
        <span class="tok-o">}</span>

        <span class="tok-s2">&quot;/api/todos&quot;</span><span class="tok-o">(</span><span class="tok-nl">resources:</span><span class="tok-s2">&quot;todo&quot;</span><span class="tok-o">)</span>
        <span class="tok-s2">&quot;/api/tags&quot;</span><span class="tok-o">(</span><span class="tok-nl">resources:</span><span class="tok-s2">&quot;tag&quot;</span><span class="tok-o">)</span>
        <span class="tok-s2">&quot;/api/categories&quot;</span><span class="tok-o">(</span><span class="tok-nl">resources:</span><span class="tok-s2">&quot;category&quot;</span><span class="tok-o">)</span>

        <span class="tok-s2">&quot;/&quot;</span><span class="tok-o">(</span><span class="tok-nl">view:</span><span class="tok-s2">&quot;/index&quot;</span><span class="tok-o">)</span>
        <span class="tok-s2">&quot;500&quot;</span><span class="tok-o">(</span><span class="tok-nl">view:</span><span class="tok-s1">&#39;/error&#39;</span><span class="tok-o">)</span>
    <span class="tok-o">}</span>
<span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>De esta forma estaremos exponiendo nuestras clases de dominio como recursos REST que podrán ser accedidos de la siguiente forma:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><em><a href="http://localhost:8080/api/todos.json" class="bare">http://localhost:8080/api/todos.json</a></em></p>
</li>
<li>
<p><em><a href="http://localhost:8080/api/tags/1.json" class="bare">http://localhost:8080/api/tags/1.json</a></em></p>
</li>
<li>
<p><em><a href="http://localhost:8080/api/categories/3.json" class="bare">http://localhost:8080/api/categories/3.json</a></em></p>
</li>
</ul>
</div>
<div style="page-break-after: always;"></div>
<div style="page-break-after: always;"></div>
</div>
</div>
<div class="sect2">
<h3 id="_ejercicios">5.6. Ejercicios</h3>
<div class="sect3">
<h4 id="_construye_tus_propias_restricciones_0_25_puntos">5.6.1. Construye tus propias restricciones (0.25 puntos)</h4>
<div class="paragraph">
<p>En la clase de dominio de las tareas tenemos tanto una fecha para la tarea como una fecha de recuerdo. Vamos a imponer como restricción que la fecha para recordar la tarea deba ser siempre anterior a la fecha de realización de la misma. Crea para ello una restricción que nos permita conseguir esto.</p>
</div>
<div class="paragraph">
<p>Crea también una nueva propiedad en las etiquetas para especificar un color. Este color vendrá en formato RGB, que te recuerdo está especificado por el carácter <em>#</em> seguido de 6 caracteres hexadecimales, como por ejemplo #23FA8F. Define esta restricción globalmente con el nombre <em>rgbcolor</em> para que pueda ser reutilizada en cualquier otra propiedad de nuestra aplicación.</p>
</div>
</div>
<div class="sect3">
<h4 id="_asegurar_los_borrados_de_las_categorías_y_las_tareas_0_25_puntos">5.6.2. Asegurar los borrados de las categorías y las tareas (0.25 puntos)</h4>
<div class="paragraph">
<p>En la aplicación actualmente tenemos un problema que nos impide eliminar categorías por la relación con las tareas y la clave ajena que se genera a nivel de base de datos con lo que antes de proceder al borrado de la categoría, debemos asegurarnos que ésta no esté asignada a ninguna tarea.</p>
</div>
<div class="paragraph">
<p>Crea el servicio <em>CategoryService.groovy</em> y mueve el eliminado que ahora mismo se está realizando en el controlador <em>CategoryController.groovy</em> para que asigne a null todas las tareas de la categoría a eliminar.</p>
</div>
<div class="paragraph">
<p>Soluciona al mismo tiempo el problema existente a la hora de eliminar tareas por la relación existente entre ellas y las etiquetas. Mueve el borrado de las tareas a un método en el servicio adecuado.</p>
</div>
</div>
<div class="sect3">
<h4 id="_consultas_a_base_de_datos_0_25_puntos">5.6.3. Consultas a base de datos (0.25 puntos)</h4>
<div class="paragraph">
<p>Vamos a crear un nuevo informe en nuestra aplicación que nos permita listar todas las tareas ordenadas por fecha y cuya categoría coincida con las pasadas por parámetro. Necesitaremos crear una vista y su correspondiente método (<em>listByCategory()</em>) en el controlador <em>TodoController()</em> para poder seleccionar aquellas categorías de las que queramos listar sus tareas.</p>
</div>
<div class="paragraph">
<p>A continuación, deberás implementar un nuevo método en el controlador <em>TodoController()</em> que devuelva todas las tareas cuya categoría coincidan con aquellas que el usuario haya seleccionado en el paso anterior. En esta vista puedes mostrar todas las categorías junto a un checkbox para que el usuario pueda seleccionar varios al mismo tiempo.</p>
</div>
<div class="paragraph">
<p>Por último, edita los menús de navegación de la aplicación para añadir el nuevo informe que acabamos de generar en todas páginas relativas a las tareas.</p>
</div>
</div>
<div class="sect3">
<h4 id="__cuándo_han_sido_realizadas_las_tareas_0_50_puntos">5.6.4. ¿Cuándo han sido realizadas las tareas? (0.50 puntos)</h4>
<div class="paragraph">
<p>El autotimestamp es una característica de Grails que se suele utilizar para saber cuando se crean y actualizan las instancias de nuestras clases de dominio. En primer lugar vamos a añadir esta característica de Grails a las tareas.</p>
</div>
<div class="paragraph">
<p>A continuación, vamos a crear una nueva propiedad en las tareas que nos permite saber cuando se han realizado las tareas y llama a esta propiedad <em>dateDone</em>. Para rellenar esta propiedad vamos a crear un servicio que se encargue de esta lógica y a su vez, mover el guardado que se está realizando actualmente en el controlador.</p>
</div>
<div class="paragraph">
<p>Para ello añadiremos en el servicio <em>TodoService</em>  un nuevo método llamado <em>saveTodo(Todo todoInstance)</em> de tal forma que cuando la propiedad <em>done</em> sea cierta, completaremos con la fecha actual la nueva propiedad <em>dateDone</em>. Este método deberá ser utilizado tanto cuando se crea como cuando se actualiza una tarea.</p>
</div>
<div class="paragraph">
<p>A continuación, crearemos un nuevo método en el servicio <em>TodoService()</em> llamado <em>lastTodosDone(Integer hours)</em> que nos permitirá pasar como parámetro un número de horas y nos devuelva todas las últimas tareas realizadas en ese intervalo de tiempo, es decir, desde el momento actual hasta hace <em>hours</em> horas.</p>
</div>
</div>
</div>
</div>
</div>
</div>
<div id="footer">
<div id="footer-text">
Last updated 2015-10-05 20:14:58 CEST
</div>
</div>
</body>
</html>