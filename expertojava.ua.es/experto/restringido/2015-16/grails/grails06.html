<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<!--[if IE]><meta http-equiv="X-UA-Compatible" content="IE=edge"><![endif]-->
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 1.5.2">
<meta name="author" content="Fran GarcÃ­a">
<title>Grails</title>
<style>/*! normalize.css v2.1.2 | MIT License | git.io/normalize */
/* ========================================================================== HTML5 display definitions ========================================================================== */
/** Correct `block` display not defined in IE 8/9. */
article, aside, details, figcaption, figure, footer, header, hgroup, main, nav, section, summary { display: block; }

/** Correct `inline-block` display not defined in IE 8/9. */
audio, canvas, video { display: inline-block; }

/** Prevent modern browsers from displaying `audio` without controls. Remove excess height in iOS 5 devices. */
audio:not([controls]) { display: none; height: 0; }

/** Address `[hidden]` styling not present in IE 8/9. Hide the `template` element in IE, Safari, and Firefox < 22. */
[hidden], template { display: none; }

script { display: none !important; }

/* ========================================================================== Base ========================================================================== */
/** 1. Set default font family to sans-serif. 2. Prevent iOS text size adjust after orientation change, without disabling user zoom. */
html { font-family: sans-serif; /* 1 */ -ms-text-size-adjust: 100%; /* 2 */ -webkit-text-size-adjust: 100%; /* 2 */ }

/** Remove default margin. */
body { margin: 0; }

/* ========================================================================== Links ========================================================================== */
/** Remove the gray background color from active links in IE 10. */
a { background: transparent; }

/** Address `outline` inconsistency between Chrome and other browsers. */
a:focus { outline: thin dotted; }

/** Improve readability when focused and also mouse hovered in all browsers. */
a:active, a:hover { outline: 0; }

/* ========================================================================== Typography ========================================================================== */
/** Address variable `h1` font-size and margin within `section` and `article` contexts in Firefox 4+, Safari 5, and Chrome. */
h1 { font-size: 2em; margin: 0.67em 0; }

/** Address styling not present in IE 8/9, Safari 5, and Chrome. */
abbr[title] { border-bottom: 1px dotted; }

/** Address style set to `bolder` in Firefox 4+, Safari 5, and Chrome. */
b, strong { font-weight: bold; }

/** Address styling not present in Safari 5 and Chrome. */
dfn { font-style: italic; }

/** Address differences between Firefox and other browsers. */
hr { -moz-box-sizing: content-box; box-sizing: content-box; height: 0; }

/** Address styling not present in IE 8/9. */
mark { background: #ff0; color: #000; }

/** Correct font family set oddly in Safari 5 and Chrome. */
code, kbd, pre, samp { font-family: monospace, serif; font-size: 1em; }

/** Improve readability of pre-formatted text in all browsers. */
pre { white-space: pre-wrap; }

/** Set consistent quote types. */
q { quotes: "\201C" "\201D" "\2018" "\2019"; }

/** Address inconsistent and variable font size in all browsers. */
small { font-size: 80%; }

/** Prevent `sub` and `sup` affecting `line-height` in all browsers. */
sub, sup { font-size: 75%; line-height: 0; position: relative; vertical-align: baseline; }

sup { top: -0.5em; }

sub { bottom: -0.25em; }

/* ========================================================================== Embedded content ========================================================================== */
/** Remove border when inside `a` element in IE 8/9. */
img { border: 0; }

/** Correct overflow displayed oddly in IE 9. */
svg:not(:root) { overflow: hidden; }

/* ========================================================================== Figures ========================================================================== */
/** Address margin not present in IE 8/9 and Safari 5. */
figure { margin: 0; }

/* ========================================================================== Forms ========================================================================== */
/** Define consistent border, margin, and padding. */
fieldset { border: 1px solid #c0c0c0; margin: 0 2px; padding: 0.35em 0.625em 0.75em; }

/** 1. Correct `color` not being inherited in IE 8/9. 2. Remove padding so people aren't caught out if they zero out fieldsets. */
legend { border: 0; /* 1 */ padding: 0; /* 2 */ }

/** 1. Correct font family not being inherited in all browsers. 2. Correct font size not being inherited in all browsers. 3. Address margins set differently in Firefox 4+, Safari 5, and Chrome. */
button, input, select, textarea { font-family: inherit; /* 1 */ font-size: 100%; /* 2 */ margin: 0; /* 3 */ }

/** Address Firefox 4+ setting `line-height` on `input` using `!important` in the UA stylesheet. */
button, input { line-height: normal; }

/** Address inconsistent `text-transform` inheritance for `button` and `select`. All other form control elements do not inherit `text-transform` values. Correct `button` style inheritance in Chrome, Safari 5+, and IE 8+. Correct `select` style inheritance in Firefox 4+ and Opera. */
button, select { text-transform: none; }

/** 1. Avoid the WebKit bug in Android 4.0.* where (2) destroys native `audio` and `video` controls. 2. Correct inability to style clickable `input` types in iOS. 3. Improve usability and consistency of cursor style between image-type `input` and others. */
button, html input[type="button"], input[type="reset"], input[type="submit"] { -webkit-appearance: button; /* 2 */ cursor: pointer; /* 3 */ }

/** Re-set default cursor for disabled elements. */
button[disabled], html input[disabled] { cursor: default; }

/** 1. Address box sizing set to `content-box` in IE 8/9. 2. Remove excess padding in IE 8/9. */
input[type="checkbox"], input[type="radio"] { box-sizing: border-box; /* 1 */ padding: 0; /* 2 */ }

/** 1. Address `appearance` set to `searchfield` in Safari 5 and Chrome. 2. Address `box-sizing` set to `border-box` in Safari 5 and Chrome (include `-moz` to future-proof). */
input[type="search"] { -webkit-appearance: textfield; /* 1 */ -moz-box-sizing: content-box; -webkit-box-sizing: content-box; /* 2 */ box-sizing: content-box; }

/** Remove inner padding and search cancel button in Safari 5 and Chrome on OS X. */
input[type="search"]::-webkit-search-cancel-button, input[type="search"]::-webkit-search-decoration { -webkit-appearance: none; }

/** Remove inner padding and border in Firefox 4+. */
button::-moz-focus-inner, input::-moz-focus-inner { border: 0; padding: 0; }

/** 1. Remove default vertical scrollbar in IE 8/9. 2. Improve readability and alignment in all browsers. */
textarea { overflow: auto; /* 1 */ vertical-align: top; /* 2 */ }

/* ========================================================================== Tables ========================================================================== */
/** Remove most spacing between table cells. */
table { border-collapse: collapse; border-spacing: 0; }

meta.foundation-mq-small { font-family: "only screen and (min-width: 768px)"; width: 768px; }

meta.foundation-mq-medium { font-family: "only screen and (min-width:1280px)"; width: 1280px; }

meta.foundation-mq-large { font-family: "only screen and (min-width:1440px)"; width: 1440px; }

*, *:before, *:after { -moz-box-sizing: border-box; -webkit-box-sizing: border-box; box-sizing: border-box; }

html, body { font-size: 97%; }

body { background: white; color: #222222; padding: 0; margin: 0; font-family: "Helvetica Neue", "Helvetica", Helvetica, Arial, sans-serif; font-weight: normal; font-style: normal; line-height: 1; position: relative; cursor: auto; }

a:hover { cursor: pointer; }

img, object, embed { max-width: 100%; height: auto; }

object, embed { height: 100%; }

img { -ms-interpolation-mode: bicubic; }

#map_canvas img, #map_canvas embed, #map_canvas object, .map_canvas img, .map_canvas embed, .map_canvas object { max-width: none !important; }

.left { float: left !important; }

.right { float: right !important; }

.text-left { text-align: left !important; }

.text-right { text-align: right !important; }

.text-center { text-align: center !important; }

.text-justify { text-align: justify !important; }

.hide { display: none; }

.antialiased, body { -webkit-font-smoothing: antialiased; }

img { display: inline-block; vertical-align: middle; }

textarea { height: auto; min-height: 50px; }

select { width: 100%; }

p.lead, .paragraph.lead > p, #preamble > .sectionbody > .paragraph:first-of-type p { font-size: 1.21875em; line-height: 1.6; }

.subheader, .admonitionblock td.content > .title, .audioblock > .title, .exampleblock > .title, .imageblock > .title, .listingblock > .title, .literalblock > .title, .stemblock > .title, .openblock > .title, .paragraph > .title, .quoteblock > .title, table.tableblock > .title, .verseblock > .title, .videoblock > .title, .dlist > .title, .olist > .title, .ulist > .title, .qlist > .title, .hdlist > .title { line-height: 1.4; color: #6f6f6f; font-weight: 300; margin-top: 0.2em; margin-bottom: 0.5em; }

/* Typography resets */
div, dl, dt, dd, ul, ol, li, h1, h2, h3, #toctitle, .sidebarblock > .content > .title, h4, h5, h6, pre, form, p, blockquote, th, td { margin: 0; padding: 0; direction: ltr; }

/* Default Link Styles */
a { color: #1164be; text-decoration: none; line-height: inherit; }
a img { border: none; }

/* Default paragraph styles */
p { font-family: inherit; font-weight: normal; font-size: 1em; line-height: 1.4; margin-bottom: 1em; text-rendering: optimizeLegibility; }
p aside { font-size: 0.875em; line-height: 1.35; font-style: italic; }

/* Default header styles */
h1, h2, h3, #toctitle, .sidebarblock > .content > .title, h4, h5, h6 { font-family: "Helvetica Neue", "Helvetica", Helvetica, Arial, sans-serif; font-weight: bold; font-style: normal; color: #1c355e; text-rendering: optimizeLegibility; margin-top: 1em; margin-bottom: 0.5em; line-height: 1.2125em; }
h1 small, h2 small, h3 small, #toctitle small, .sidebarblock > .content > .title small, h4 small, h5 small, h6 small { font-size: 60%; color: #6f6f6f; line-height: 0; }

h1 { font-size: 2.125em; }

h2 { font-size: 1.6875em; }

h3, #toctitle, .sidebarblock > .content > .title { font-size: 1.375em; }

h4 { font-size: 1.125em; }

h5 { font-size: 1.125em; }

h6 { font-size: 1em; }

hr { border: solid #dddddd; border-width: 1px 0 0; clear: both; margin: 1.25em 0 1.1875em; height: 0; }

/* Helpful Typography Defaults */
em, i { font-style: italic; line-height: inherit; }

strong, b { font-weight: bold; line-height: inherit; }

small { font-size: 60%; line-height: inherit; }

code { font-family: Consolas, "Liberation Mono", Courier, monospace; font-weight: bold; }

/* Lists */
ul, ol, dl { font-size: 1em; line-height: 1.4; margin-bottom: 1.25em; list-style-position: outside; font-family: inherit; }

ul, ol { margin-left: 2.5em; }
ul.no-bullet, ol.no-bullet { margin-left: 1.5em; }

/* Unordered Lists */
ul li ul, ul li ol { margin-left: 1.25em; margin-bottom: 0; font-size: 1em; /* Override nested font-size change */ }
ul.square li ul, ul.circle li ul, ul.disc li ul { list-style: inherit; }
ul.square { list-style-type: square; }
ul.circle { list-style-type: circle; }
ul.disc { list-style-type: disc; }
ul.no-bullet { list-style: none; }

/* Ordered Lists */
ol li ul, ol li ol { margin-left: 1.25em; margin-bottom: 0; }

/* Definition Lists */
dl dt { margin-bottom: 0.3125em; font-weight: bold; }
dl dd { margin-bottom: 1.25em; }

/* Abbreviations */
abbr, acronym { text-transform: uppercase; font-size: 90%; color: #222222; border-bottom: 1px dotted #dddddd; cursor: help; }

abbr { text-transform: none; }

/* Blockquotes */
blockquote { margin: 0 0 1.25em; padding: 0.5625em 1.25em 0 1.1875em; border-left: 1px solid #dddddd; }
blockquote cite { display: block; font-size: 0.8125em; color: #555555; }
blockquote cite:before { content: "\2014 \0020"; }
blockquote cite a, blockquote cite a:visited { color: #555555; }

blockquote, blockquote p { line-height: 1.6; color: #6f6f6f; }

/* Microformats */
.vcard { display: inline-block; margin: 0 0 1.25em 0; border: 1px solid #dddddd; padding: 0.625em 0.75em; }
.vcard li { margin: 0; display: block; }
.vcard .fn { font-weight: bold; font-size: 0.9375em; }

.vevent .summary { font-weight: bold; }
.vevent abbr { cursor: auto; text-decoration: none; font-weight: bold; border: none; padding: 0 0.0625em; }

/*@media only screen and (min-width: 768px) { h1, h2, h3, #toctitle, .sidebarblock > .content > .title, h4, h5, h6 { line-height: 1.4; }
  h1 { font-size: 2.75em; }
  h2 { font-size: 2.3125em; }
  h3, #toctitle, .sidebarblock > .content > .title { font-size: 1.6875em; }
  h4 { font-size: 1.4375em; } }*/
/* Tables */
table { background: white; margin-bottom: 1.25em; border: solid 1px #dddddd; }
table thead, table tfoot { background: whitesmoke; font-weight: bold; }
table thead tr th, table thead tr td, table tfoot tr th, table tfoot tr td { padding: 0.5em 0.625em 0.625em; font-size: inherit; color: #222222; text-align: left; }
table tr th, table tr td { padding: 0.5625em 0.625em; font-size: inherit; color: #222222; }
table tr.even, table tr.alt, table tr:nth-of-type(even) { background: #f9f9f9; }
table thead tr th, table tfoot tr th, table tbody tr td, table tr td, table tfoot tr td { display: table-cell; line-height: 1.4; }

h1, h2, h3, #toctitle, .sidebarblock > .content > .title, h4, h5, h6 { line-height: 1.4; border-bottom: 1px solid #dddddd }

.clearfix:before, .clearfix:after, .float-group:before, .float-group:after { content: " "; display: table; }
.clearfix:after, .float-group:after { clear: both; }

*:not(pre) > code { font-size: inherit; font-style: normal !important; letter-spacing: 0; padding: 3px 2px 1px 2px; background-color: #eeeeee; border: 1px solid #dddddd; -webkit-border-radius: 0; border-radius: 0; line-height: inherit; font-weight: normal; }

pre, pre > code { line-height: 1.4; color: black; font-family: monospace, serif; font-weight: normal; }

.keyseq { color: #555555; }

kbd { display: inline-block; color: #222222; font-size: 0.75em; line-height: 1.4; background-color: #f7f7f7; border: 1px solid #ccc; -webkit-border-radius: 3px; border-radius: 3px; -webkit-box-shadow: 0 1px 0 rgba(0, 0, 0, 0.2), 0 0 0 0.1em white inset; box-shadow: 0 1px 0 rgba(0, 0, 0, 0.2), 0 0 0 0.1em white inset; margin: -0.15em 0.15em 0 0.15em; padding: 0.2em 0.6em 0.2em 0.5em; vertical-align: middle; white-space: nowrap; }

.keyseq kbd:first-child { margin-left: 0; }

.keyseq kbd:last-child { margin-right: 0; }

.menuseq, .menu { color: #090909; }

b.button:before, b.button:after { position: relative; top: -1px; font-weight: normal; }

b.button:before { content: "["; padding: 0 3px 0 2px; }

b.button:after { content: "]"; padding: 0 2px 0 3px; }

#header, #content, #footnotes, #footer { width: 100%; margin-left: auto; margin-right: auto; margin-top: 0; margin-bottom: 0; max-width: 62.5em; *zoom: 1; position: relative; padding-left: 0.9375em; padding-right: 0.9375em; }
#header:before, #header:after, #content:before, #content:after, #footnotes:before, #footnotes:after, #footer:before, #footer:after { content: " "; display: table; }
#header:after, #content:after, #footnotes:after, #footer:after { clear: both; }

#content { margin-top: 1.25em; }

#content:before { content: none; }

#header > h1:first-child { color: black; margin-top: 2.25rem; margin-bottom: 0; }
#header > h1:first-child + #toc { margin-top: 8px; border-top: 1px solid #dddddd; }
#header > h1:only-child, body.toc2 #header > h1:nth-last-child(2) { border-bottom: 1px solid #dddddd; padding-bottom: 8px; }
#header .details { border-bottom: 1px solid #dddddd; line-height: 1.45; padding-top: 0.25em; padding-bottom: 0.25em; padding-left: 0.25em; color: #555555; display: -ms-flexbox; display: -webkit-flex; display: flex; -ms-flex-flow: row wrap; -webkit-flex-flow: row wrap; flex-flow: row wrap; }
#header .details span:first-child { margin-left: -0.125em; }
#header .details span.email a { color: #6f6f6f; }
#header .details br { display: none; }
#header .details br + span:before { content: "\00a0\2013\00a0"; }
#header .details br + span.author:before { content: "\00a0\22c5\00a0"; color: #6f6f6f; }
#header .details br + span#revremark:before { content: "\00a0|\00a0"; }
#header #revnumber { text-transform: capitalize; }
#header #revnumber:after { content: "\00a0"; }

#content > h1:first-child:not([class]) { color: black; border-bottom: 1px solid #dddddd; padding-bottom: 8px; margin-top: 0; padding-top: 1rem; margin-bottom: 1.25rem; }

#floating {
  position: fixed;
  z-index: 1000;
  padding: 0.5em;
  right: 0;
  top: 0;
  background: white;
  box-shadow: 0 0 1em #777777;
  -webkit-box-shadow: 0 0 1em #777777;
  -moz-box-shadow: 0 0 1em #777777;
  -webkit-border-bottom-left-radius: 5px;
  -moz-border-radius-bottomleft: 5px;
  max-height: 80%;
  overflow: auto;
}

#floating #full { display: none; } /* Hide the full TOC by default */

#floating:hover #full{
  display: block; /* Show it on hover */
}


#toc { border-bottom: 1px solid #dddddd; padding-bottom: 0.5em; }
#toc > ul { margin-left: 0.125em; }
#toc ul.sectlevel0 > li > a { font-style: italic; }
#toc ul.sectlevel0 ul.sectlevel1 { margin: 0.5em 0; }
#toc ul { font-family: "Helvetica Neue", "Helvetica", Helvetica, Arial, sans-serif; list-style-type: none; }
#toc a { text-decoration: none; }
#toc a:active { text-decoration: underline; }

#toctitle { color: #6f6f6f; font-size: 1.2em; }

@media only screen and (min-width: 768px) { #toctitle { font-size: 1.375em; }
  body.toc2 { padding-left: 15em; padding-right: 0; }
  #toc.toc2 { margin-top: 0 !important; background-color: #f2f2f2; position: fixed; width: 15em; left: 0; top: 0; border-right: 1px solid #dddddd; border-top-width: 0 !important; border-bottom-width: 0 !important; z-index: 1000; padding: 1.25em 1em; height: 100%; overflow: auto; }
  #toc.toc2 #toctitle { margin-top: 0; font-size: 1.2em; }
  #toc.toc2 > ul { font-size: 0.9em; margin-bottom: 0; }
  #toc.toc2 ul ul { margin-left: 0; padding-left: 1em; }
  #toc.toc2 ul.sectlevel0 ul.sectlevel1 { padding-left: 0; margin-top: 0.5em; margin-bottom: 0.5em; }
  body.toc2.toc-right { padding-left: 0; padding-right: 15em; }
  body.toc2.toc-right #toc.toc2 { border-right-width: 0; border-left: 1px solid #dddddd; left: auto; right: 0; } }
@media only screen and (min-width: 1280px) { body.toc2 { padding-left: 20em; padding-right: 0; }
  #toc.toc2 { width: 20em; }
  #toc.toc2 #toctitle { font-size: 1.375em; }
  #toc.toc2 > ul { font-size: 0.95em; }
  #toc.toc2 ul ul { padding-left: 1.25em; }
  body.toc2.toc-right { padding-left: 0; padding-right: 20em; } }
#content #toc { border-style: solid; border-width: 1px; border-color: #d9d9d9; margin-bottom: 1.25em; padding: 1.25em; background: #f2f2f2; -webkit-border-radius: 0; border-radius: 0; }
#content #toc > :first-child { margin-top: 0; }
#content #toc > :last-child { margin-bottom: 0; }

#footer { max-width: 100%; background-color: #222222; padding: 1.25em; }

#footer-text { color: #dddddd; line-height: 1.44; }

.sect1 { padding-bottom: 0.625em; }

@media only screen and (min-width: 768px) { .sect1 { padding-bottom: 1.25em; } }
.sect1 + .sect1 { border-top: 1px solid #dddddd; }

#content h1 > a.anchor, h2 > a.anchor, h3 > a.anchor, #toctitle > a.anchor, .sidebarblock > .content > .title > a.anchor, h4 > a.anchor, h5 > a.anchor, h6 > a.anchor { position: absolute; z-index: 1001; width: 1.5ex; margin-left: -1.5ex; display: block; text-decoration: none !important; visibility: hidden; text-align: center; font-weight: normal; }
#content h1 > a.anchor:before, h2 > a.anchor:before, h3 > a.anchor:before, #toctitle > a.anchor:before, .sidebarblock > .content > .title > a.anchor:before, h4 > a.anchor:before, h5 > a.anchor:before, h6 > a.anchor:before { content: "\00A7"; font-size: 0.85em; display: block; padding-top: 0.1em; }
#content h1:hover > a.anchor, #content h1 > a.anchor:hover, h2:hover > a.anchor, h2 > a.anchor:hover, h3:hover > a.anchor, #toctitle:hover > a.anchor, .sidebarblock > .content > .title:hover > a.anchor, h3 > a.anchor:hover, #toctitle > a.anchor:hover, .sidebarblock > .content > .title > a.anchor:hover, h4:hover > a.anchor, h4 > a.anchor:hover, h5:hover > a.anchor, h5 > a.anchor:hover, h6:hover > a.anchor, h6 > a.anchor:hover { visibility: visible; }
#content h1 > a.link, h2 > a.link, h3 > a.link, #toctitle > a.link, .sidebarblock > .content > .title > a.link, h4 > a.link, h5 > a.link, h6 > a.link { color: #222222; text-decoration: none; }
#content h1 > a.link:hover, h2 > a.link:hover, h3 > a.link:hover, #toctitle > a.link:hover, .sidebarblock > .content > .title > a.link:hover, h4 > a.link:hover, h5 > a.link:hover, h6 > a.link:hover { color: #151515; }

.audioblock, .imageblock, .literalblock, .listingblock, .stemblock, .videoblock { margin-bottom: 1.25em; }

.admonitionblock td.content > .title, .audioblock > .title, .exampleblock > .title, .imageblock > .title, .listingblock > .title, .literalblock > .title, .stemblock > .title, .openblock > .title, .paragraph > .title, .quoteblock > .title, table.tableblock > .title, .verseblock > .title, .videoblock > .title, .dlist > .title, .olist > .title, .ulist > .title, .qlist > .title, .hdlist > .title { text-rendering: optimizeLegibility; text-align: left; }

table.tableblock > caption.title { white-space: nowrap; overflow: visible; max-width: 0; }

.paragraph.lead > p, #preamble > .sectionbody > .paragraph:first-of-type p { color: black; }

table.tableblock #preamble > .sectionbody > .paragraph:first-of-type p { font-size: inherit; }

.admonitionblock > table { border-collapse: separate; border: 0; background: none; width: 100%; }
.admonitionblock > table td.icon { text-align: center; width: 80px; }
.admonitionblock > table td.icon img { max-width: none; }
.admonitionblock > table td.icon .title { font-weight: bold; font-family: "Helvetica Neue", "Helvetica", Helvetica, Arial, sans-serif; text-transform: uppercase; }
.admonitionblock > table td.content { padding-left: 1.125em; padding-right: 1.25em; border-left: 1px solid #dddddd; color: #555555; }
.admonitionblock > table td.content > :last-child > :last-child { margin-bottom: 0; }

.exampleblock > .content { border-style: solid; border-width: 1px; border-color: #e6e6e6; margin-bottom: 1.25em; padding: 1.25em; background: white; -webkit-border-radius: 0; border-radius: 0; }
.exampleblock > .content > :first-child { margin-top: 0; }
.exampleblock > .content > :last-child { margin-bottom: 0; }

.sidebarblock { border-style: solid; border-width: 1px; border-color: #d9d9d9; margin-bottom: 1.25em; padding: 1.25em; background: #f2f2f2; -webkit-border-radius: 0; border-radius: 0; }
.sidebarblock > :first-child { margin-top: 0; }
.sidebarblock > :last-child { margin-bottom: 0; }
.sidebarblock > .content > .title { color: #6f6f6f; margin-top: 0; }

.exampleblock > .content > :last-child > :last-child, .exampleblock > .content .olist > ol > li:last-child > :last-child, .exampleblock > .content .ulist > ul > li:last-child > :last-child, .exampleblock > .content .qlist > ol > li:last-child > :last-child, .sidebarblock > .content > :last-child > :last-child, .sidebarblock > .content .olist > ol > li:last-child > :last-child, .sidebarblock > .content .ulist > ul > li:last-child > :last-child, .sidebarblock > .content .qlist > ol > li:last-child > :last-child { margin-bottom: 0; }

.literalblock pre, .listingblock pre:not(.highlight), .listingblock pre[class="highlight"], .listingblock pre[class^="highlight "], .listingblock pre.CodeRay, .listingblock pre.prettyprint { background: #eeeeee; }
.sidebarblock .literalblock pre, .sidebarblock .listingblock pre:not(.highlight), .sidebarblock .listingblock pre[class="highlight"], .sidebarblock .listingblock pre[class^="highlight "], .sidebarblock .listingblock pre.CodeRay, .sidebarblock .listingblock pre.prettyprint { background: #f2f1f1; }

.literalblock pre, .literalblock pre[class], .listingblock pre, .listingblock pre[class] { border: 1px solid #cccccc; -webkit-border-radius: 0; border-radius: 0; word-wrap: break-word; padding: 0.8em 0.8em 0.65em 0.8em; font-size: 0.8125em; }
.literalblock pre.nowrap, .literalblock pre[class].nowrap, .listingblock pre.nowrap, .listingblock pre[class].nowrap { overflow-x: auto; white-space: pre; word-wrap: normal; }
@media only screen and (min-width: 768px) { .literalblock pre, .literalblock pre[class], .listingblock pre, .listingblock pre[class] { font-size: 0.90625em; } }
@media only screen and (min-width: 1280px) { .literalblock pre, .literalblock pre[class], .listingblock pre, .listingblock pre[class] { font-size: 1em; } }

.literalblock.output pre { color: #eeeeee; background-color: black; }

.listingblock pre.highlightjs { padding: 0; }
.listingblock pre.highlightjs > code { padding: 0.8em 0.8em 0.65em 0.8em; -webkit-border-radius: 0; border-radius: 0; }

.listingblock > .content { position: relative; }

.listingblock code[data-lang]:before { display: none; content: attr(data-lang); position: absolute; font-size: 0.75em; top: 0.425rem; right: 0.5rem; line-height: 1; text-transform: uppercase; color: #999; }

.listingblock:hover code[data-lang]:before { display: block; }

.listingblock.terminal pre .command:before { content: attr(data-prompt); padding-right: 0.5em; color: #999; }

.listingblock.terminal pre .command:not([data-prompt]):before { content: "$"; }

table.pyhltable { border-collapse: separate; border: 0; margin-bottom: 0; background: none; }

table.pyhltable td { vertical-align: top; padding-top: 0; padding-bottom: 0; }

table.pyhltable td.code { padding-left: .75em; padding-right: 0; }

pre.pygments .lineno, table.pyhltable td:not(.code) { color: #999; padding-left: 0; padding-right: .5em; border-right: 1px solid #dddddd; }

pre.pygments .lineno { display: inline-block; margin-right: .25em; }

table.pyhltable .linenodiv { background: none !important; padding-right: 0 !important; }

.quoteblock { margin: 0 1em 1.25em 1.5em; display: table; }
.quoteblock > .title { margin-left: -1.5em; margin-bottom: 0.75em; }
.quoteblock blockquote, .quoteblock blockquote p { color: #6f6f6f; font-size: 1.15rem; line-height: 1.75; word-spacing: 0.1em; letter-spacing: 0; font-style: italic; text-align: justify; }
.quoteblock blockquote { margin: 0; padding: 0; border: 0; }
.quoteblock blockquote:before { content: "\201c"; float: left; font-size: 2.75em; font-weight: bold; line-height: 0.6em; margin-left: -0.6em; color: #6f6f6f; text-shadow: 0 1px 2px rgba(0, 0, 0, 0.1); }
.quoteblock blockquote > .paragraph:last-child p { margin-bottom: 0; }
.quoteblock .attribution { margin-top: 0.5em; margin-right: 0.5ex; text-align: right; }
.quoteblock .quoteblock { margin-left: 0; margin-right: 0; padding: 0.5em 0; border-left: 3px solid #555555; }
.quoteblock .quoteblock blockquote { padding: 0 0 0 0.75em; }
.quoteblock .quoteblock blockquote:before { display: none; }

.verseblock { margin: 0 1em 1.25em 1em; }
.verseblock pre { font-family: "Open Sans", "DejaVu Sans", sans; font-size: 1.15rem; color: #6f6f6f; font-weight: 300; text-rendering: optimizeLegibility; }
.verseblock pre strong { font-weight: 400; }
.verseblock .attribution { margin-top: 1.25rem; margin-left: 0.5ex; }

.quoteblock .attribution, .verseblock .attribution { font-size: 0.8125em; line-height: 1.45; font-style: italic; }
.quoteblock .attribution br, .verseblock .attribution br { display: none; }
.quoteblock .attribution cite, .verseblock .attribution cite { display: block; letter-spacing: -0.05em; color: #555555; }

.quoteblock.abstract { margin: 0 0 1.25em 0; display: block; }
.quoteblock.abstract blockquote, .quoteblock.abstract blockquote p { text-align: left; word-spacing: 0; }
.quoteblock.abstract blockquote:before, .quoteblock.abstract blockquote p:first-of-type:before { display: none; }

table.tableblock { max-width: 100%; border-collapse: separate; }
table.tableblock td > .paragraph:last-child p > p:last-child, table.tableblock th > p:last-child, table.tableblock td > p:last-child { margin-bottom: 0; }

table.spread { width: 100%; }

table.tableblock, th.tableblock, td.tableblock { border: 0 solid #dddddd; }

table.grid-all th.tableblock, table.grid-all td.tableblock { border-width: 0 1px 1px 0; }

table.grid-all tfoot > tr > th.tableblock, table.grid-all tfoot > tr > td.tableblock { border-width: 1px 1px 0 0; }

table.grid-cols th.tableblock, table.grid-cols td.tableblock { border-width: 0 1px 0 0; }

table.grid-all * > tr > .tableblock:last-child, table.grid-cols * > tr > .tableblock:last-child { border-right-width: 0; }

table.grid-rows th.tableblock, table.grid-rows td.tableblock { border-width: 0 0 1px 0; }

table.grid-all tbody > tr:last-child > th.tableblock, table.grid-all tbody > tr:last-child > td.tableblock, table.grid-all thead:last-child > tr > th.tableblock, table.grid-rows tbody > tr:last-child > th.tableblock, table.grid-rows tbody > tr:last-child > td.tableblock, table.grid-rows thead:last-child > tr > th.tableblock { border-bottom-width: 0; }

table.grid-rows tfoot > tr > th.tableblock, table.grid-rows tfoot > tr > td.tableblock { border-width: 1px 0 0 0; }

table.frame-all { border-width: 1px; }

table.frame-sides { border-width: 0 1px; }

table.frame-topbot { border-width: 1px 0; }

th.halign-left, td.halign-left { text-align: left; }

th.halign-right, td.halign-right { text-align: right; }

th.halign-center, td.halign-center { text-align: center; }

th.valign-top, td.valign-top { vertical-align: top; }

th.valign-bottom, td.valign-bottom { vertical-align: bottom; }

th.valign-middle, td.valign-middle { vertical-align: middle; }

table thead th, table tfoot th { font-weight: bold; }

tbody tr th { display: table-cell; line-height: 1.4; background: whitesmoke; }

tbody tr th, tbody tr th p, tfoot tr th, tfoot tr th p { color: #222222; font-weight: bold; }

p.tableblock > code:only-child { background: none; padding: 0; }

p.tableblock { font-size: 1em; }

td > div.verse { white-space: pre; }

ol { margin-left: 2.5em; }

ul li ol { margin-left: 1.5em; }

dl dd { margin-left: 1.125em; }

dl dd:last-child, dl dd:last-child > :last-child { margin-bottom: 0; }

ol > li p, ul > li p, ul dd, ol dd, .olist .olist, .ulist .ulist, .ulist .olist, .olist .ulist { margin-bottom: 0.625em; }

ul.unstyled, ol.unnumbered, ul.checklist, ul.none { list-style-type: none; }

ul.unstyled, ol.unnumbered, ul.checklist { margin-left: 0.625em; }

ul.checklist li > p:first-child > .fa-check-square-o:first-child, ul.checklist li > p:first-child > input[type="checkbox"]:first-child { margin-right: 0.25em; }

ul.checklist li > p:first-child > input[type="checkbox"]:first-child { position: relative; top: 1px; }

ul.inline { margin: 0 auto 0.625em auto; margin-left: -1.375em; margin-right: 0; padding: 0; list-style: none; overflow: hidden; }
ul.inline > li { list-style: none; float: left; margin-left: 1.375em; display: block; }
ul.inline > li > * { display: block; }

.unstyled dl dt { font-weight: normal; font-style: normal; }

ol.arabic { list-style-type: decimal; }

ol.decimal { list-style-type: decimal-leading-zero; }

ol.loweralpha { list-style-type: lower-alpha; }

ol.upperalpha { list-style-type: upper-alpha; }

ol.lowerroman { list-style-type: lower-roman; }

ol.upperroman { list-style-type: upper-roman; }

ol.lowergreek { list-style-type: lower-greek; }

.hdlist > table, .colist > table { border: 0; background: none; }
.hdlist > table > tbody > tr, .colist > table > tbody > tr { background: none; }

td.hdlist1 { padding-right: .75em; font-weight: bold; }

td.hdlist1, td.hdlist2 { vertical-align: top; }

.literalblock + .colist, .listingblock + .colist { margin-top: -0.5em; }

.colist > table tr > td:first-of-type { padding: 0 0.75em; line-height: 1; }
.colist > table tr > td:last-of-type { padding: 0.25em 0; }

.thumb, .th { line-height: 0; display: inline-block; border: solid 4px white; -webkit-box-shadow: 0 0 0 1px #dddddd; box-shadow: 0 0 0 1px #dddddd; }

.imageblock.left, .imageblock[style*="float: left"] { margin: 0.25em 0.625em 1.25em 0; }
.imageblock.right, .imageblock[style*="float: right"] { margin: 0.25em 0 1.25em 0.625em; }
.imageblock > .title { margin-bottom: 0; }
.imageblock.thumb, .imageblock.th { border-width: 6px; }
.imageblock.thumb > .title, .imageblock.th > .title { padding: 0 0.125em; }

.image.left, .image.right { margin-top: 0.25em; margin-bottom: 0.25em; display: inline-block; line-height: 0; }
.image.left { margin-right: 0.625em; }
.image.right { margin-left: 0.625em; }

a.image { text-decoration: none; }

span.footnote, span.footnoteref { vertical-align: super; font-size: 0.875em; }
span.footnote a, span.footnoteref a { text-decoration: none; }
span.footnote a:active, span.footnoteref a:active { text-decoration: underline; }

#footnotes { padding-top: 0.75em; padding-bottom: 0.75em; margin-bottom: 0.625em; }
#footnotes hr { width: 20%; min-width: 6.25em; margin: -.25em 0 .75em 0; border-width: 1px 0 0 0; }
#footnotes .footnote { padding: 0 0.375em; line-height: 1.3; font-size: 0.875em; margin-left: 1.2em; text-indent: -1.2em; margin-bottom: .2em; }
#footnotes .footnote a:first-of-type { font-weight: bold; text-decoration: none; }
#footnotes .footnote:last-of-type { margin-bottom: 0; }

#content #footnotes { margin-top: -0.625em; margin-bottom: 0; padding: 0.75em 0; }

.gist .file-data > table { border: 0; background: #fff; width: 100%; margin-bottom: 0; }
.gist .file-data > table td.line-data { width: 99%; }

div.unbreakable { page-break-inside: avoid; }

.big { font-size: larger; }

.small { font-size: smaller; }

.underline { text-decoration: underline; }

.overline { text-decoration: overline; }

.line-through { text-decoration: line-through; }

.aqua { color: #00bfbf; }

.aqua-background { background-color: #00fafa; }

.black { color: black; }

.black-background { background-color: black; }

.blue { color: #0000bf; }

.blue-background { background-color: #0000fa; }

.fuchsia { color: #bf00bf; }

.fuchsia-background { background-color: #fa00fa; }

.gray { color: #606060; }

.gray-background { background-color: #7d7d7d; }

.green { color: #006000; }

.green-background { background-color: #007d00; }

.lime { color: #00bf00; }

.lime-background { background-color: #00fa00; }

.maroon { color: #600000; }

.maroon-background { background-color: #7d0000; }

.navy { color: #000060; }

.navy-background { background-color: #00007d; }

.olive { color: #606000; }

.olive-background { background-color: #7d7d00; }

.purple { color: #600060; }

.purple-background { background-color: #7d007d; }

.red { color: #bf0000; }

.red-background { background-color: #fa0000; }

.silver { color: #909090; }

.silver-background { background-color: #bcbcbc; }

.teal { color: #006060; }

.teal-background { background-color: #007d7d; }

.white { color: #bfbfbf; }

.white-background { background-color: #fafafa; }

.yellow { color: #bfbf00; }

.yellow-background { background-color: #fafa00; }

span.icon > .fa { cursor: default; }

.admonitionblock td.icon [class^="fa icon-"] { font-size: 2.5em; text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.5); cursor: default; }
.admonitionblock td.icon .icon-note:before { content: "\f05a"; color: #207c98; }
.admonitionblock td.icon .icon-tip:before { content: "\f0eb"; text-shadow: 1px 1px 2px rgba(155, 155, 0, 0.8); color: #111; }
.admonitionblock td.icon .icon-warning:before { content: "\f071"; color: #bf6900; }
.admonitionblock td.icon .icon-caution:before { content: "\f06d"; color: #bf3400; }
.admonitionblock td.icon .icon-important:before { content: "\f06a"; color: #bf0000; }

.conum[data-value] { display: inline-block; color: #fff !important; background-color: #222222; -webkit-border-radius: 100px; border-radius: 100px; text-align: center; font-size: 0.75em; width: 1.67em; height: 1.67em; line-height: 1.67em; font-family: "Open Sans", "DejaVu Sans", sans-serif; font-style: normal; font-weight: bold; }
.conum[data-value] * { color: #fff !important; }
.conum[data-value] + b { display: none; }
.conum[data-value]:after { content: attr(data-value); }
pre .conum[data-value] { position: relative; top: -0.125em; }

b.conum * { color: inherit !important; }

.conum:not([data-value]):empty { display: none; }

.literalblock pre, .listingblock pre { background: #eeeeee; }

</style>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.2.0/css/font-awesome.min.css">
<style>.listingblock .pygments .hll { background-color: #ffffcc }
.listingblock .pygments  { background: #f8f8f8; }
.listingblock .pygments .tok-c { color: #408080; font-style: italic } /* Comment */
.listingblock .pygments .tok-err { border: 1px solid #FF0000 } /* Error */
.listingblock .pygments .tok-k { color: #008000; font-weight: bold } /* Keyword */
.listingblock .pygments .tok-o { color: #666666 } /* Operator */
.listingblock .pygments .tok-cm { color: #408080; font-style: italic } /* Comment.Multiline */
.listingblock .pygments .tok-cp { color: #BC7A00 } /* Comment.Preproc */
.listingblock .pygments .tok-c1 { color: #408080; font-style: italic } /* Comment.Single */
.listingblock .pygments .tok-cs { color: #408080; font-style: italic } /* Comment.Special */
.listingblock .pygments .tok-gd { color: #A00000 } /* Generic.Deleted */
.listingblock .pygments .tok-ge { font-style: italic } /* Generic.Emph */
.listingblock .pygments .tok-gr { color: #FF0000 } /* Generic.Error */
.listingblock .pygments .tok-gh { color: #000080; font-weight: bold } /* Generic.Heading */
.listingblock .pygments .tok-gi { color: #00A000 } /* Generic.Inserted */
.listingblock .pygments .tok-go { color: #888888 } /* Generic.Output */
.listingblock .pygments .tok-gp { color: #000080; font-weight: bold } /* Generic.Prompt */
.listingblock .pygments .tok-gs { font-weight: bold } /* Generic.Strong */
.listingblock .pygments .tok-gu { color: #800080; font-weight: bold } /* Generic.Subheading */
.listingblock .pygments .tok-gt { color: #0044DD } /* Generic.Traceback */
.listingblock .pygments .tok-kc { color: #008000; font-weight: bold } /* Keyword.Constant */
.listingblock .pygments .tok-kd { color: #008000; font-weight: bold } /* Keyword.Declaration */
.listingblock .pygments .tok-kn { color: #008000; font-weight: bold } /* Keyword.Namespace */
.listingblock .pygments .tok-kp { color: #008000 } /* Keyword.Pseudo */
.listingblock .pygments .tok-kr { color: #008000; font-weight: bold } /* Keyword.Reserved */
.listingblock .pygments .tok-kt { color: #B00040 } /* Keyword.Type */
.listingblock .pygments .tok-m { color: #666666 } /* Literal.Number */
.listingblock .pygments .tok-s { color: #BA2121 } /* Literal.String */
.listingblock .pygments .tok-na { color: #7D9029 } /* Name.Attribute */
.listingblock .pygments .tok-nb { color: #008000 } /* Name.Builtin */
.listingblock .pygments .tok-nc { color: #0000FF; font-weight: bold } /* Name.Class */
.listingblock .pygments .tok-no { color: #880000 } /* Name.Constant */
.listingblock .pygments .tok-nd { color: #AA22FF } /* Name.Decorator */
.listingblock .pygments .tok-ni { color: #999999; font-weight: bold } /* Name.Entity */
.listingblock .pygments .tok-ne { color: #D2413A; font-weight: bold } /* Name.Exception */
.listingblock .pygments .tok-nf { color: #0000FF } /* Name.Function */
.listingblock .pygments .tok-nl { color: #A0A000 } /* Name.Label */
.listingblock .pygments .tok-nn { color: #0000FF; font-weight: bold } /* Name.Namespace */
.listingblock .pygments .tok-nt { color: #008000; font-weight: bold } /* Name.Tag */
.listingblock .pygments .tok-nv { color: #19177C } /* Name.Variable */
.listingblock .pygments .tok-ow { color: #AA22FF; font-weight: bold } /* Operator.Word */
.listingblock .pygments .tok-w { color: #bbbbbb } /* Text.Whitespace */
.listingblock .pygments .tok-mb { color: #666666 } /* Literal.Number.Bin */
.listingblock .pygments .tok-mf { color: #666666 } /* Literal.Number.Float */
.listingblock .pygments .tok-mh { color: #666666 } /* Literal.Number.Hex */
.listingblock .pygments .tok-mi { color: #666666 } /* Literal.Number.Integer */
.listingblock .pygments .tok-mo { color: #666666 } /* Literal.Number.Oct */
.listingblock .pygments .tok-sb { color: #BA2121 } /* Literal.String.Backtick */
.listingblock .pygments .tok-sc { color: #BA2121 } /* Literal.String.Char */
.listingblock .pygments .tok-sd { color: #BA2121; font-style: italic } /* Literal.String.Doc */
.listingblock .pygments .tok-s2 { color: #BA2121 } /* Literal.String.Double */
.listingblock .pygments .tok-se { color: #BB6622; font-weight: bold } /* Literal.String.Escape */
.listingblock .pygments .tok-sh { color: #BA2121 } /* Literal.String.Heredoc */
.listingblock .pygments .tok-si { color: #BB6688; font-weight: bold } /* Literal.String.Interpol */
.listingblock .pygments .tok-sx { color: #008000 } /* Literal.String.Other */
.listingblock .pygments .tok-sr { color: #BB6688 } /* Literal.String.Regex */
.listingblock .pygments .tok-s1 { color: #BA2121 } /* Literal.String.Single */
.listingblock .pygments .tok-ss { color: #19177C } /* Literal.String.Symbol */
.listingblock .pygments .tok-bp { color: #008000 } /* Name.Builtin.Pseudo */
.listingblock .pygments .tok-vc { color: #19177C } /* Name.Variable.Class */
.listingblock .pygments .tok-vg { color: #19177C } /* Name.Variable.Global */
.listingblock .pygments .tok-vi { color: #19177C } /* Name.Variable.Instance */
.listingblock .pygments .tok-il { color: #666666 } /* Literal.Number.Integer.Long */
</style>
</head>
<body class="article toc2 toc-left">
<div id="header">
<h1>Grails</h1>
<div class="details">
<span id="author" class="author">Fran GarcÃ­a</span><br>
<span id="email" class="email">&lt;<a href="mailto:fgarciarico@gmail.com">fgarciarico@gmail.com</a>&gt;</span><br>
</div>
<div id="toc" class="toc2">
<div id="toctitle">Ãndice de contenidos</div>
<ul class="sectlevel1">
<li><a href="#sesion06">6. Framework de test Spock.</a>
<ul class="sectlevel2">
<li><a href="#_introducci%C3%B3n_a_los_tests">6.1. IntroducciÃ³n a los tests</a></li>
<li><a href="#_framework_de_tests_spock">6.2. Framework de tests Spock</a></li>
<li><a href="#_spock_en_grails">6.3. Spock en Grails</a></li>
<li><a href="#_ejercicios">6.4. Ejercicios</a></li>
</ul>
</li>
</ul>
</div>
</div>
<div id="content">
<div id="preamble">
<div class="sectionbody">
<div style="page-break-after: always;"></div>
</div>
</div>
<div class="sect1">
<h2 id="sesion06">6. Framework de test Spock.</h2>
<div class="sectionbody">
<div class="paragraph">
<p>En esta sesiÃ³n veremos en profundidad como comprobar que nuestra aplicaciÃ³n desarrollada en Grails funciona tal y como esperamos y para ello utilizaremos un framework para la realizaciÃ³n de tests llamado Spock. Empezaremos viendo conceptos generales tanto de tests como de Spock y terminaremos viendo su aplicaciÃ³n en una aplicaciÃ³n en Grails.</p>
</div>
<div class="sect2">
<h3 id="_introducciÃ³n_a_los_tests">6.1. IntroducciÃ³n a los tests</h3>
<div class="sect3">
<h4 id="__quÃ©_son_los_tests">6.1.1. Â¿QuÃ© son los tests?</h4>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="title">DefiniciÃ³n</div>
<div class="paragraph">
<p>Los tests de software se pueden definir como el proceso empleado para comprobar la correcciÃ³n de un programa informÃ¡tico y se puede considerar como una parte mÃ¡s en el proceso del control de calidad.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_tipos_de_tests_de_software">6.1.2. Tipos de tests de software</h4>
<div class="paragraph">
<p>BÃ¡sicamente existen tres tipos de tests de software:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><em>Tests unitarios</em>, que consisten en comprobar el funcionamiento de un determinado mÃ³dulo sin tener en cuenta a los demÃ¡s. En este tipo de pruebas tampoco se tiene acceso a recursos como bases de datos, sistemas de ficheros o recursos de red.</p>
</li>
<li>
<p><em>Tests de integraciÃ³n</em>, suponen un nivel por encima a los tests unitarios y en ellos se aÃ±aden recursos como bases de datos, sistemas de ficheros o recursos de red.</p>
</li>
<li>
<p><em>Tests funcionales</em>, consiste en comprobar que la funcionalidad de nuestra aplicaciÃ³n es la esperada. BÃ¡sicamente este tipo de pruebas se basan en automatizar las tÃ­picas pruebas de rellenar datos en formularios, hacer clicks en botones y analizar la respuesta obtenida.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_otros_frameworks_de_tests">6.1.3. Otros frameworks de tests</h4>
<div class="paragraph">
<p>En Java disponemos de varias alternativas para el desarrollo de los tests, pero bÃ¡sicamente disponemos de dos que son las mÃ¡s conocidas y utilizadas:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>JUnit (<a href="http://junit.org" class="bare">http://junit.org</a>), posiblemente sea el framework mÃ¡s extendido entre la comunidad Java.</p>
</li>
<li>
<p>TestNG (<a href="http://testng.org" class="bare">http://testng.org</a>), es un framework que permite testear nuestra aplicaciÃ³n con pruebas unitarias, de integraciÃ³n y funcionales.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Sin embargo, en la comunidad Groovy cada vez se estÃ¡ extendiendo mÃ¡s el uso de un framework conocido como Spock (<a href="https://code.google.com/p/spock/" class="bare">https://code.google.com/p/spock/</a>). Spock surgiÃ³ en el aÃ±o 2009 y su creador es Peter Niederwieser (<a href="https://twitter.com/pniederw">@pniederw</a>) y sin duda alguna destaca entre el resto de frameworks por la expresividad de su lenguaje y su integraciÃ³n con Groovy y Java. Estas son algunas de las razones por las que vamos a utilizar Spock:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>FÃ¡cil de aprender</p>
</li>
<li>
<p>IntegraciÃ³n con Groovy</p>
</li>
<li>
<p>EliminaciÃ³n aserciones innecesarias</p>
</li>
<li>
<p>InformaciÃ³n detallada en las salidas de los tests</p>
</li>
<li>
<p>DiseÃ±ado desde el punto de vista del usuario</p>
</li>
<li>
<p>Independientemente de la teoria que sigas para desarrollar tus tests (TDD, BDD, etc), Spock se adaptarÃ¡ a tus necesidades</p>
</li>
<li>
<p>Lenguaje altamente expresivo</p>
</li>
<li>
<p>Compatible con JUnit</p>
</li>
<li>
<p>Combina lo mejor de otros conocidos frameworks como JUnit o jMock</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_framework_de_tests_spock">6.2. Framework de tests Spock</h3>
<div class="sect3">
<h4 id="_instalaciÃ³n_en_grails">6.2.1. InstalaciÃ³n en Grails</h4>
<div class="paragraph">
<p>Spock en Grails viene como un plugin con lo que Ãºnicamente tendremos que aÃ±adir el plugin en el archivo de configuraciÃ³n <em>BuildConfig.groovy</em>, tal y como se explica en la pÃ¡gina del plugin (<a href="http://grails.org/plugin/spock" class="bare">http://grails.org/plugin/spock</a>) para versiones superiores a Grails 2.2</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-n">grails</span><span class="tok-o">.</span><span class="tok-na">project</span><span class="tok-o">.</span><span class="tok-na">dependency</span><span class="tok-o">.</span><span class="tok-na">resolution</span> <span class="tok-o">=</span> <span class="tok-o">{</span>
  <span class="tok-n">repositories</span> <span class="tok-o">{</span>
    <span class="tok-n">grailsCentral</span><span class="tok-o">()</span>
    <span class="tok-n">mavenCentral</span><span class="tok-o">()</span>
  <span class="tok-o">}</span>
  <span class="tok-n">dependencies</span> <span class="tok-o">{</span>
    <span class="tok-n">test</span> <span class="tok-s2">&quot;org.spockframework:spock-grails-support:0.7-groovy-2.0&quot;</span>
  <span class="tok-o">}</span>
  <span class="tok-n">plugins</span> <span class="tok-o">{</span>
    <span class="tok-n">test</span><span class="tok-o">(</span><span class="tok-s2">&quot;:spock:0.7&quot;</span><span class="tok-o">)</span> <span class="tok-o">{</span>
      <span class="tok-n">exclude</span> <span class="tok-s2">&quot;spock-grails-support&quot;</span>
    <span class="tok-o">}</span>
  <span class="tok-o">}</span>
<span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Para que el plugin sea instalado y el IDE reconozca las nuevas clases, necesitaremos lanzar algÃºn <em>target</em> de Grails, como por ejemplo <em>grails test-app</em>. Una vez instalado el plugin, ya podremos empezar a desarrollar nuestros primeros tests.</p>
</div>
</div>
<div class="sect3">
<h4 id="_tests_en_spock">6.2.2. Tests en Spock</h4>
<div class="paragraph">
<p>Por defecto en Spock, todas las clases que creemos para nuestros tests deben extender la clase <em>spock.lang.Specification</em>, que inyectarÃ¡ una serie de mÃ©todos y utilidades en nuestra clase extendida.</p>
</div>
<div class="paragraph">
<p>A diferencia de otros frameworks de tests, Spock presenta una sintaxis muy sencilla de leer que se basa en la utilizaciÃ³n de bloques de cÃ³digo. Este serÃ­a un ejemplo bÃ¡sico de test con Spock:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-kn">package</span> <span class="tok-n">es</span><span class="tok-o">.</span><span class="tok-na">ua</span><span class="tok-o">.</span><span class="tok-na">expertojava</span><span class="tok-o">.</span><span class="tok-na">todo</span>

<span class="tok-kn">import</span> <span class="tok-nn">spock.lang.Specification</span>

<span class="tok-kd">class</span> <span class="tok-nc">MyFirstTest</span> <span class="tok-kd">extends</span> <span class="tok-n">Specification</span> <span class="tok-o">{</span>

    <span class="tok-kt">def</span> <span class="tok-s2">&quot;El operador suma funciona correctamente&quot;</span><span class="tok-o">()</span> <span class="tok-o">{</span>
        <span class="tok-nl">expect:</span>
            <span class="tok-mi">10</span> <span class="tok-o">==</span> <span class="tok-mi">2</span> <span class="tok-o">+</span> <span class="tok-mi">8</span>
        <span class="tok-nl">and:</span>
            <span class="tok-mi">10</span> <span class="tok-o">==</span> <span class="tok-mi">0</span> <span class="tok-o">+</span> <span class="tok-mi">10</span>
        <span class="tok-nl">and:</span>
            <span class="tok-mi">10</span> <span class="tok-o">==</span> <span class="tok-mi">10</span> <span class="tok-o">+</span> <span class="tok-mi">0</span>
    <span class="tok-o">}</span>
<span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Este formato de test en Spock podrÃ­amos decir que es el mÃ¡s sencillo de los que podemos encontrar y como puedes observar la sintaxis es muy sencilla de entender. Lo primero que cabe destacar aunque probablemente ya te hayas dado cuenta es el nombre de los mÃ©todos que estÃ¡n entrecomillados y podemos llamarlo como queramos y utilizar espacios o caracteres especiales (no ingleses) como acentos.</p>
</div>
<div class="paragraph">
<p>Destacar tambiÃ©n que no es necesario utilizar aserciones dentro del bloque <em>expect</em>. Pero veamos otro ejemplo un poco mÃ¡s elaborado y que nos introducirÃ¡ un nuevo formato de test en Spock.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-kt">def</span> <span class="tok-s2">&quot;El mÃ©todo plus de los nÃºmeros funciona correctamente&quot;</span><span class="tok-o">()</span> <span class="tok-o">{</span>
    <span class="tok-nl">when:</span>
        <span class="tok-kt">def</span> <span class="tok-n">result</span> <span class="tok-o">=</span> <span class="tok-mi">10</span><span class="tok-o">.</span><span class="tok-na">plus</span><span class="tok-o">(</span><span class="tok-mi">2</span><span class="tok-o">)</span>
    <span class="tok-nl">then:</span>
        <span class="tok-n">result</span> <span class="tok-o">==</span> <span class="tok-mi">12</span>
<span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Este formato de spock sea posiblemente el mÃ¡s comÃºn en Spock y en Ã©l vemos un bloque <em>when</em> y un bloque <em>then</em>. El bloque <em>when</em> se utiliza habitualmente para lanzar el mÃ©todo a probar y en este caso tambiÃ©n para almacenar el resultado, mientras que el bloque <em>then</em> se utiliza para comprobar que la respuesta proporcionada por el mÃ©todo es la correcta. De nuevo, en el bloque <em>then</em> no es necesario utilizar aserciones.</p>
</div>
<div class="paragraph">
<p>Pero, Â¿quÃ© pasa si queremos probar varios casos en la misma sentencia? Para este caso, Spock introduce el bloque <em>where</em> en donde con una sintaxis muy sencilla de entender en forma de tabla, vamos a poder comprobar varios al mismo tiempo. Veamos el anterior ejemplo mejorado:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-nd">@Unroll</span>
<span class="tok-kt">def</span> <span class="tok-s2">&quot;El mÃ©todo plus funciona con el sumador #sumador y el sumando #sumando&quot;</span><span class="tok-o">()</span> <span class="tok-o">{</span>
    <span class="tok-nl">when:</span>
        <span class="tok-kt">def</span> <span class="tok-n">result</span> <span class="tok-o">=</span> <span class="tok-n">sumador</span><span class="tok-o">.</span><span class="tok-na">plus</span><span class="tok-o">(</span><span class="tok-n">sumando</span><span class="tok-o">)</span>
    <span class="tok-nl">then:</span>
        <span class="tok-n">result</span> <span class="tok-o">==</span> <span class="tok-n">resultadoEsperado</span>
    <span class="tok-nl">where:</span>
        <span class="tok-n">sumador</span> <span class="tok-o">|</span>   <span class="tok-n">sumando</span>     <span class="tok-o">|</span>   <span class="tok-n">resultadoEsperado</span>
        <span class="tok-mi">0</span>       <span class="tok-o">|</span>   <span class="tok-mi">0</span>           <span class="tok-o">|</span>   <span class="tok-mi">0</span>
        <span class="tok-mi">0</span>       <span class="tok-o">|</span>   <span class="tok-mi">1</span>           <span class="tok-o">|</span>   <span class="tok-mi">1</span>
        <span class="tok-mi">1</span>       <span class="tok-o">|</span>   <span class="tok-mi">1</span>           <span class="tok-o">|</span>   <span class="tok-mi">2</span>
        <span class="tok-o">-</span><span class="tok-mi">1</span>      <span class="tok-o">|</span>   <span class="tok-mi">0</span>           <span class="tok-o">|</span>   <span class="tok-o">-</span><span class="tok-mi">1</span>
        <span class="tok-mi">0</span>       <span class="tok-o">|</span>   <span class="tok-o">-</span><span class="tok-mi">1</span>          <span class="tok-o">|</span>   <span class="tok-o">-</span><span class="tok-mi">1</span>
        <span class="tok-o">-</span><span class="tok-mi">1</span>      <span class="tok-o">|</span>   <span class="tok-o">-</span><span class="tok-mi">1</span>          <span class="tok-o">|</span>   <span class="tok-o">-</span><span class="tok-mi">2</span>
        <span class="tok-mi">2</span>       <span class="tok-o">|</span>   <span class="tok-mi">1</span>           <span class="tok-o">|</span>   <span class="tok-mi">3</span>
<span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>En este ejemplo vemos la forma en la que Spock crea variables dentro del bloque <em>where</em> sin definir su tipo o ni tan siquiera con la palabra reservada <em>def</em>. De esta forma, en un Ãºnico test hemos podido comprobar el mÃ©todo <em>plus()</em> con varios valores en una Ãºnica sentencia.</p>
</div>
<div class="paragraph">
<p>Por otro lado, vemos tambiÃ©n como el nombre del test introduce los valores de las variables definidas dentro del bloque where de tal forma que cuando ejecutemos este test, si alguno falla veremos rÃ¡pidamente que caso es el problemÃ¡tico.</p>
</div>
<div class="paragraph">
<p>AdemÃ¡s, la anotaciÃ³n <em>@Unroll</em> nos permite que cada uno de los casos en el bloque where se despliegue como un nuevo test, lo cual de nuevo, facilita la detecciÃ³n rÃ¡pida de los errores. Esta serÃ­a la salida producida en nuestro editor sin la anotaciÃ³n <em>@Unroll</em>:</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="images/grails06/resultadotestsconbloquewheresinunroll.png" alt="Resultado de los tests sin la anotaciÃ³n @Unroll" width="50%">
</div>
</div>
<div class="paragraph">
<p>y esta es la producida con la anotaciÃ³n <em>@Unroll</em>:</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="images/grails06/resultadotestsconbloquewhereconunroll.png" alt="Resultado de los tests con la anotaciÃ³n @Unroll" width="50%">
</div>
</div>
<div class="paragraph">
<p>Como puedes observar, la anotaciÃ³n <em>@Unroll</em> nos proporciona mÃ¡s informaciÃ³n del resultado de los tests.</p>
</div>
<div class="paragraph">
<p>El siguiente ejemplo es idÃ©ntico al anterior pero en lugar de utilizar una tabla utilizamos listas con valores:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-nd">@Unroll</span>
<span class="tok-kt">def</span> <span class="tok-s2">&quot;El mÃ©todo plus funciona con el sumador #sumador y el sumando #sumando utilizando listas&quot;</span><span class="tok-o">()</span> <span class="tok-o">{</span>
    <span class="tok-nl">when:</span>
        <span class="tok-kt">def</span> <span class="tok-n">result</span> <span class="tok-o">=</span> <span class="tok-n">sumador</span><span class="tok-o">.</span><span class="tok-na">plus</span><span class="tok-o">(</span><span class="tok-n">sumando</span><span class="tok-o">)</span>
    <span class="tok-nl">then:</span>
        <span class="tok-n">result</span> <span class="tok-o">==</span> <span class="tok-n">resultadoEsperado</span>
    <span class="tok-nl">where:</span>
        <span class="tok-n">sumador</span> <span class="tok-o">&lt;&lt;</span> <span class="tok-o">[</span><span class="tok-mi">0</span><span class="tok-o">,</span><span class="tok-mi">0</span><span class="tok-o">,</span><span class="tok-mi">1</span><span class="tok-o">,-</span><span class="tok-mi">1</span><span class="tok-o">,</span><span class="tok-mi">0</span><span class="tok-o">,-</span><span class="tok-mi">1</span><span class="tok-o">,</span><span class="tok-mi">2</span><span class="tok-o">]</span>
        <span class="tok-n">sumando</span> <span class="tok-o">&lt;&lt;</span> <span class="tok-o">[</span><span class="tok-mi">0</span><span class="tok-o">,</span><span class="tok-mi">1</span><span class="tok-o">,</span><span class="tok-mi">1</span><span class="tok-o">,</span><span class="tok-mi">0</span><span class="tok-o">,-</span><span class="tok-mi">1</span><span class="tok-o">,-</span><span class="tok-mi">1</span><span class="tok-o">,</span><span class="tok-mi">1</span><span class="tok-o">]</span>
        <span class="tok-n">resultadoEsperado</span> <span class="tok-o">&lt;&lt;</span> <span class="tok-o">[</span><span class="tok-mi">0</span><span class="tok-o">,</span><span class="tok-mi">1</span><span class="tok-o">,</span><span class="tok-mi">2</span><span class="tok-o">,-</span><span class="tok-mi">1</span><span class="tok-o">,-</span><span class="tok-mi">1</span><span class="tok-o">,-</span><span class="tok-mi">2</span><span class="tok-o">,</span><span class="tok-mi">3</span><span class="tok-o">]</span>
<span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>El Ãºltimo bloque de un test Spock que nos queda por ver es el primero de todos, el bloque <em>given</em>, que nos servirÃ¡ para realizar todo lo necesario antes de ejecutar el mÃ©todo a testear. Este podrÃ­a ser un ejemplo:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-kt">def</span> <span class="tok-s2">&quot;El mÃ©todo para concatenar cadenas aÃ±ade un signo + entre las cadenas concatenadas&quot;</span><span class="tok-o">()</span> <span class="tok-o">{</span>
    <span class="tok-nl">given:</span>
        <span class="tok-n">String</span><span class="tok-o">.</span><span class="tok-na">metaClass</span><span class="tok-o">.</span><span class="tok-na">concat</span> <span class="tok-o">=</span> <span class="tok-o">{</span> <span class="tok-n">String</span> <span class="tok-n">c</span> <span class="tok-o">-&gt;</span>
            <span class="tok-s2">&quot;${delegate}+${c}&quot;</span>
        <span class="tok-o">}</span>
    <span class="tok-nl">expect:</span>
        <span class="tok-s2">&quot;cadena1&quot;</span><span class="tok-o">.</span><span class="tok-na">concat</span><span class="tok-o">(</span><span class="tok-s2">&quot;cadena2&quot;</span><span class="tok-o">)</span> <span class="tok-o">==</span> <span class="tok-s2">&quot;cadena1+cadena2&quot;</span>
    <span class="tok-nl">cleanup:</span>
        <span class="tok-n">String</span><span class="tok-o">.</span><span class="tok-na">metaClass</span> <span class="tok-o">=</span> <span class="tok-kc">null</span>
<span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Y como siempre, no olvides devolver la clase metaprogramada con <em>String.metaClass = null</em>.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_spock_en_grails">6.3. Spock en Grails</h3>
<div class="paragraph">
<p>Una vez hemos visto los primeros ejemplos de tests con Spock en Groovy, vamos a ver ejemplos de como testear los diferentes artefactos en las aplicaciones desarrolladas con Grails. Pero antes de continuar, hay que comentar que en Spock disponemos de unos mÃ©todos que se ejecutan antes y despuÃ©s de cada tests o de cada clase Spock. Estos mÃ©todos son:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><em>setupSpec()</em>: se ejecuta <strong>antes del primer test</strong> de una determinada clase de tests con Spock</p>
</li>
<li>
<p><em>cleanupSpec()</em>: se ejecuta <strong>despuÃ©s del Ãºltimo test</strong> de una determinada clase de tests con Spock</p>
</li>
<li>
<p><em>setup()</em>: se ejecuta <strong>antes de cada test</strong> de una determinada clase de tests con Spock</p>
</li>
<li>
<p><em>setupSpec()</em>: se ejecuta <strong>despuÃ©s de cada test</strong> de una determinada clase de tests con Spock</p>
</li>
</ul>
</div>
<div class="sect3">
<h4 id="_tests_con_spock_sobre_clases_de_dominio_en_grails">6.3.1. Tests con Spock sobre clases de dominio en Grails</h4>
<div class="paragraph">
<p>Empecemos pues con los tests sobre los artefactos de una aplicaciÃ³n Grails y lo haremos sobre las clases de dominio y mÃ¡s concretamente sobre las restricciones.</p>
</div>
<div class="paragraph">
<p>Partiendo de nuestra clase de dominio <em>Category</em>,</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-kn">package</span> <span class="tok-n">es</span><span class="tok-o">.</span><span class="tok-na">ua</span><span class="tok-o">.</span><span class="tok-na">expertojava</span><span class="tok-o">.</span><span class="tok-na">todo</span>

<span class="tok-kd">class</span> <span class="tok-nc">Category</span> <span class="tok-o">{</span>

    <span class="tok-n">String</span> <span class="tok-n">name</span>
    <span class="tok-n">String</span> <span class="tok-n">description</span>

    <span class="tok-kd">static</span> <span class="tok-n">hasMany</span> <span class="tok-o">=</span> <span class="tok-o">[</span><span class="tok-nl">todos:</span><span class="tok-n">Todo</span><span class="tok-o">]</span>

    <span class="tok-kd">static</span> <span class="tok-n">constraints</span> <span class="tok-o">=</span> <span class="tok-o">{</span>
        <span class="tok-n">name</span><span class="tok-o">(</span><span class="tok-nl">blank:</span><span class="tok-kc">false</span><span class="tok-o">)</span>
        <span class="tok-n">description</span><span class="tok-o">(</span><span class="tok-nl">blank:</span><span class="tok-kc">true</span><span class="tok-o">,</span> <span class="tok-nl">nullable:</span><span class="tok-kc">true</span><span class="tok-o">,</span> <span class="tok-nl">maxSize:</span><span class="tok-mi">1000</span><span class="tok-o">)</span>
    <span class="tok-o">}</span>

    <span class="tok-n">String</span> <span class="tok-nf">toString</span><span class="tok-o">(){</span>
        <span class="tok-n">name</span>
    <span class="tok-o">}</span>
<span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Vamos a comprobar que las restricciones impuestas sobre las propiedades <em>name</em> y <em>description</em> se cumplen. Para ello, vamos a reutilizar un test unitario creado cuando generÃ¡bamos las clases de dominio llamado <em>CategorySpec.groovy</em> dentro del paquete <em>es.ua.expertojava.todo</em>.</p>
</div>
<div class="paragraph">
<p>Lo ideal es que cada test unitario compruebe Ãºnicamente un aspecto, asÃ­ que vamos a seguir este consejo y crearemos los siguientes tests:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-kn">package</span> <span class="tok-n">es</span><span class="tok-o">.</span><span class="tok-na">ua</span><span class="tok-o">.</span><span class="tok-na">expertojava</span><span class="tok-o">.</span><span class="tok-na">todo</span>

<span class="tok-kn">import</span> <span class="tok-nn">grails.test.mixin.TestFor</span>
<span class="tok-kn">import</span> <span class="tok-nn">spock.lang.Specification</span>
<span class="tok-kn">import</span> <span class="tok-nn">spock.lang.Unroll</span>

<span class="tok-cm">/**</span>
<span class="tok-cm"> * See the API for {@link grails.test.mixin.domain.DomainClassUnitTestMixin} for usage instructions</span>
<span class="tok-cm"> */</span>
<span class="tok-nd">@TestFor</span><span class="tok-o">(</span><span class="tok-n">Category</span><span class="tok-o">)</span>
<span class="tok-kd">class</span> <span class="tok-nc">CategorySpec</span> <span class="tok-kd">extends</span> <span class="tok-n">Specification</span> <span class="tok-o">{</span>

    <span class="tok-kt">def</span> <span class="tok-nf">setup</span><span class="tok-o">()</span> <span class="tok-o">{</span>
    <span class="tok-o">}</span>

    <span class="tok-kt">def</span> <span class="tok-nf">cleanup</span><span class="tok-o">()</span> <span class="tok-o">{</span>
    <span class="tok-o">}</span>

    <span class="tok-kt">def</span> <span class="tok-s2">&quot;El nombre de la categorÃ­a no puede ser la cadena vacÃ­a&quot;</span><span class="tok-o">()</span> <span class="tok-o">{</span>
        <span class="tok-nl">given:</span>
            <span class="tok-kt">def</span> <span class="tok-n">c1</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">Category</span><span class="tok-o">(</span><span class="tok-nl">name:</span><span class="tok-s2">&quot;&quot;</span><span class="tok-o">)</span>
        <span class="tok-nl">when:</span>
            <span class="tok-n">c1</span><span class="tok-o">.</span><span class="tok-na">validate</span><span class="tok-o">()</span>
        <span class="tok-nl">then:</span>
            <span class="tok-n">c1</span><span class="tok-o">?.</span><span class="tok-na">errors</span><span class="tok-o">[</span><span class="tok-s1">&#39;name&#39;</span><span class="tok-o">]</span>
    <span class="tok-o">}</span>

    <span class="tok-kt">def</span> <span class="tok-s2">&quot;Si el nombre no es la cadena vacÃ­a, este campo no darÃ¡ problemas&quot;</span><span class="tok-o">()</span> <span class="tok-o">{</span>
        <span class="tok-nl">given:</span>
            <span class="tok-kt">def</span> <span class="tok-n">c1</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">Category</span><span class="tok-o">(</span><span class="tok-nl">name:</span><span class="tok-s2">&quot;algo&quot;</span><span class="tok-o">)</span>
        <span class="tok-nl">when:</span>
            <span class="tok-n">c1</span><span class="tok-o">.</span><span class="tok-na">validate</span><span class="tok-o">()</span>
        <span class="tok-nl">then:</span>
            <span class="tok-o">!</span><span class="tok-n">c1</span><span class="tok-o">?.</span><span class="tok-na">errors</span><span class="tok-o">[</span><span class="tok-s1">&#39;name&#39;</span><span class="tok-o">]</span>
    <span class="tok-o">}</span>

    <span class="tok-kt">def</span> <span class="tok-s2">&quot;La descripciÃ³n de la categorÃ­a puede ser la cadena vacÃ­a&quot;</span><span class="tok-o">()</span> <span class="tok-o">{</span>
        <span class="tok-nl">given:</span>
            <span class="tok-kt">def</span> <span class="tok-n">c1</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">Category</span><span class="tok-o">(</span><span class="tok-nl">description:</span> <span class="tok-s2">&quot;&quot;</span><span class="tok-o">)</span>
        <span class="tok-nl">when:</span>
            <span class="tok-n">c1</span><span class="tok-o">.</span><span class="tok-na">validate</span><span class="tok-o">()</span>
        <span class="tok-nl">then:</span>
            <span class="tok-o">!</span><span class="tok-n">c1</span><span class="tok-o">?.</span><span class="tok-na">errors</span><span class="tok-o">[</span><span class="tok-s1">&#39;description&#39;</span><span class="tok-o">]</span>
    <span class="tok-o">}</span>

    <span class="tok-kt">def</span> <span class="tok-s2">&quot;Si la descripciÃ³n es la cadena vacÃ­a, este campo no darÃ¡ problemas&quot;</span><span class="tok-o">()</span> <span class="tok-o">{</span>
        <span class="tok-nl">given:</span>
            <span class="tok-kt">def</span> <span class="tok-n">c1</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">Category</span><span class="tok-o">(</span><span class="tok-nl">description:</span><span class="tok-s2">&quot;&quot;</span><span class="tok-o">)</span>
        <span class="tok-nl">when:</span>
            <span class="tok-n">c1</span><span class="tok-o">.</span><span class="tok-na">validate</span><span class="tok-o">()</span>
        <span class="tok-nl">then:</span>
            <span class="tok-o">!</span><span class="tok-n">c1</span><span class="tok-o">?.</span><span class="tok-na">errors</span><span class="tok-o">[</span><span class="tok-s1">&#39;description&#39;</span><span class="tok-o">]</span>
    <span class="tok-o">}</span>

    <span class="tok-kt">def</span> <span class="tok-s2">&quot;La descripciÃ³n de la categorÃ­a puede ser null&quot;</span><span class="tok-o">()</span> <span class="tok-o">{</span>
        <span class="tok-nl">given:</span>
            <span class="tok-kt">def</span> <span class="tok-n">c1</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">Category</span><span class="tok-o">(</span><span class="tok-nl">description:</span> <span class="tok-kc">null</span><span class="tok-o">)</span>
        <span class="tok-nl">when:</span>
            <span class="tok-n">c1</span><span class="tok-o">.</span><span class="tok-na">validate</span><span class="tok-o">()</span>
        <span class="tok-nl">then:</span>
            <span class="tok-o">!</span><span class="tok-n">c1</span><span class="tok-o">?.</span><span class="tok-na">errors</span><span class="tok-o">[</span><span class="tok-s1">&#39;description&#39;</span><span class="tok-o">]</span>
    <span class="tok-o">}</span>

    <span class="tok-nd">@Unroll</span>
    <span class="tok-kt">def</span> <span class="tok-s2">&quot;Si la descripciÃ³n tiene menos de 1001 caracteres, no darÃ¡ problemas&quot;</span><span class="tok-o">()</span> <span class="tok-o">{</span>
        <span class="tok-nl">given:</span>
            <span class="tok-kt">def</span> <span class="tok-n">c1</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">Category</span><span class="tok-o">(</span><span class="tok-nl">description:</span> <span class="tok-s2">&quot;a&quot;</span><span class="tok-o">*</span><span class="tok-n">characters</span><span class="tok-o">)</span>
        <span class="tok-nl">when:</span>
            <span class="tok-n">c1</span><span class="tok-o">.</span><span class="tok-na">validate</span><span class="tok-o">()</span>
        <span class="tok-nl">then:</span>
            <span class="tok-o">!</span><span class="tok-n">c1</span><span class="tok-o">?.</span><span class="tok-na">errors</span><span class="tok-o">[</span><span class="tok-s1">&#39;description&#39;</span><span class="tok-o">]</span>
        <span class="tok-nl">where:</span>
            <span class="tok-n">characters</span> <span class="tok-o">&lt;&lt;</span> <span class="tok-o">[</span><span class="tok-mi">0</span><span class="tok-o">,</span><span class="tok-mi">1</span><span class="tok-o">,</span><span class="tok-mi">999</span><span class="tok-o">,</span><span class="tok-mi">1000</span><span class="tok-o">]</span>
    <span class="tok-o">}</span>

    <span class="tok-nd">@Unroll</span>
    <span class="tok-kt">def</span> <span class="tok-s2">&quot;Si la descripciÃ³n tiene mÃ¡s 1000 caracteres, darÃ¡ problemas&quot;</span><span class="tok-o">()</span> <span class="tok-o">{</span>
        <span class="tok-nl">given:</span>
            <span class="tok-kt">def</span> <span class="tok-n">c1</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">Category</span><span class="tok-o">(</span><span class="tok-nl">description:</span> <span class="tok-s2">&quot;a&quot;</span><span class="tok-o">*</span><span class="tok-n">characters</span><span class="tok-o">)</span>
        <span class="tok-nl">when:</span>
            <span class="tok-n">c1</span><span class="tok-o">.</span><span class="tok-na">validate</span><span class="tok-o">()</span>
        <span class="tok-nl">then:</span>
            <span class="tok-n">c1</span><span class="tok-o">?.</span><span class="tok-na">errors</span><span class="tok-o">[</span><span class="tok-s1">&#39;description&#39;</span><span class="tok-o">]</span>
        <span class="tok-nl">where:</span>
            <span class="tok-n">characters</span> <span class="tok-o">&lt;&lt;</span> <span class="tok-o">[</span><span class="tok-mi">1001</span><span class="tok-o">,</span><span class="tok-mi">1002</span><span class="tok-o">]</span>
    <span class="tok-o">}</span>
<span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Con esta baterÃ­a de tests nos aseguraremos de que las instancias creadas para la clase de dominio CategorÃ­a cumplen los requisitos definidos en las restricciones. De igual forma, vamos a realizar un Ãºltimo test para comprobar que cuando se crea una instancia de CategorÃ­a correctamente, el valor devuelto por Ã©sta coincide con la sobrecarga del mÃ©todo <em>toString()</em> que hayamos hecho en la clase de dominio.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-o">...</span>
    <span class="tok-kt">def</span> <span class="tok-s2">&quot;La instancia de CategorÃ­a devuelve su nombre por defecto&quot;</span><span class="tok-o">()</span> <span class="tok-o">{</span>
        <span class="tok-nl">expect:</span>
            <span class="tok-k">new</span> <span class="tok-nf">Category</span><span class="tok-o">(</span><span class="tok-nl">name:</span><span class="tok-s2">&quot;The category name&quot;</span><span class="tok-o">).</span><span class="tok-na">toString</span><span class="tok-o">()</span> <span class="tok-o">==</span> <span class="tok-s2">&quot;The category name&quot;</span>
    <span class="tok-o">}</span>
<span class="tok-o">...</span></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_tests_con_spock_sobre_controladores_en_grails">6.3.2. Tests con Spock sobre controladores en Grails</h4>
<div class="paragraph">
<p>Una vez hemos visto como podemos testear nuestras clases de dominio, vamos a ver como podemos hacer lo mismo con los controladores y para ello vamos a basarnos en el cÃ³digo generado para el controlador <em>CategoryController.groovy</em>. Cuando creÃ¡bamos este controlador, al mismo tiempo se creaba un test <em>CategoryControllerSpec.groovy</em> con cÃ³digo tambiÃ©n generado, pero que nosotros necesitaremos completar, en este caso, con la informaciÃ³n necesaria procedente de la clase de dominio <em>Category</em>.</p>
</div>
<div class="paragraph">
<p>Si abrimos el archivo <em>CategoryControllerSpec.groovy</em> con nuestro editor veremos como en la parte superior hay definido un mÃ©todo con un comentario de tipo <em>TODO</em> para avisarnos de que hay algo que debemos completar, que bÃ¡sicamente serÃ¡ la informaciÃ³n necesaria para crear una instancia de tipo <em>Tag</em> de forma correcta.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-kn">package</span> <span class="tok-n">es</span><span class="tok-o">.</span><span class="tok-na">ua</span><span class="tok-o">.</span><span class="tok-na">expertojava</span><span class="tok-o">.</span><span class="tok-na">todo</span>

<span class="tok-kn">import</span> <span class="tok-nn">grails.test.mixin.*</span>
<span class="tok-kn">import</span> <span class="tok-nn">spock.lang.*</span>

<span class="tok-nd">@TestFor</span><span class="tok-o">(</span><span class="tok-n">CategoryController</span><span class="tok-o">)</span>
<span class="tok-nd">@Mock</span><span class="tok-o">(</span><span class="tok-n">Category</span><span class="tok-o">)</span>
<span class="tok-kd">class</span> <span class="tok-nc">CategoryControllerSpec</span> <span class="tok-kd">extends</span> <span class="tok-n">Specification</span> <span class="tok-o">{</span>

    <span class="tok-kt">def</span> <span class="tok-nf">populateValidParams</span><span class="tok-o">(</span><span class="tok-n">params</span><span class="tok-o">)</span> <span class="tok-o">{</span>
        <span class="tok-k">assert</span> <span class="tok-n">params</span> <span class="tok-o">!=</span> <span class="tok-kc">null</span>
        <span class="tok-c1">// TODO: Populate valid properties like...</span>
        <span class="tok-c1">//params[&quot;name&quot;] = &#39;someValidName&#39;</span>
    <span class="tok-o">}</span>
<span class="tok-o">...</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>En nuestro caso, sÃ³lo serÃ¡ necesario aÃ±adir la informaciÃ³n referente al nombre, para que los tests se ejecuten de forma satisfactoria, con lo que podrÃ­amos tener algo asÃ­:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-kt">def</span> <span class="tok-nf">populateValidParams</span><span class="tok-o">(</span><span class="tok-n">params</span><span class="tok-o">)</span> <span class="tok-o">{</span>
    <span class="tok-k">assert</span> <span class="tok-n">params</span> <span class="tok-o">!=</span> <span class="tok-kc">null</span>
    <span class="tok-n">params</span><span class="tok-o">[</span><span class="tok-s2">&quot;name&quot;</span><span class="tok-o">]</span> <span class="tok-o">=</span> <span class="tok-s1">&#39;Category name&#39;</span>
<span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Si ahora ejecutamos en lÃ­nea de comandos</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="bash">grails <span class="tok-nb">test</span>-app CategoryControllerSpec unit:</code></pre>
</div>
</div>
<div class="paragraph">
<p>comprobaremos como todos los tests se han ejecutado correctamente. Veamos como quedarÃ­a el cÃ³digo del test:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-kn">package</span> <span class="tok-n">es</span><span class="tok-o">.</span><span class="tok-na">ua</span><span class="tok-o">.</span><span class="tok-na">expertojava</span><span class="tok-o">.</span><span class="tok-na">todo</span>

<span class="tok-kn">import</span> <span class="tok-nn">grails.test.mixin.*</span>
<span class="tok-kn">import</span> <span class="tok-nn">spock.lang.*</span>

<span class="tok-nd">@TestFor</span><span class="tok-o">(</span><span class="tok-n">CategoryController</span><span class="tok-o">)</span>
<span class="tok-nd">@Mock</span><span class="tok-o">(</span><span class="tok-n">Category</span><span class="tok-o">)</span>
<span class="tok-kd">class</span> <span class="tok-nc">CategoryControllerSpec</span> <span class="tok-kd">extends</span> <span class="tok-n">Specification</span> <span class="tok-o">{</span>

    <span class="tok-kt">def</span> <span class="tok-nf">populateValidParams</span><span class="tok-o">(</span><span class="tok-n">params</span><span class="tok-o">)</span> <span class="tok-o">{</span>
        <span class="tok-k">assert</span> <span class="tok-n">params</span> <span class="tok-o">!=</span> <span class="tok-kc">null</span>
        <span class="tok-n">params</span><span class="tok-o">[</span><span class="tok-s2">&quot;name&quot;</span><span class="tok-o">]</span> <span class="tok-o">=</span> <span class="tok-s1">&#39;Category name&#39;</span>
    <span class="tok-o">}</span>

    <span class="tok-kt">void</span> <span class="tok-s2">&quot;Test the index action returns the correct model&quot;</span><span class="tok-o">()</span> <span class="tok-o">{</span>

        <span class="tok-nl">when:</span><span class="tok-s2">&quot;The index action is executed&quot;</span>
            <span class="tok-n">controller</span><span class="tok-o">.</span><span class="tok-na">index</span><span class="tok-o">()</span>

        <span class="tok-nl">then:</span><span class="tok-s2">&quot;The model is correct&quot;</span>
            <span class="tok-o">!</span><span class="tok-n">model</span><span class="tok-o">.</span><span class="tok-na">categoryInstanceList</span>
            <span class="tok-n">model</span><span class="tok-o">.</span><span class="tok-na">categoryInstanceCount</span> <span class="tok-o">==</span> <span class="tok-mi">0</span>
    <span class="tok-o">}</span>

    <span class="tok-kt">void</span> <span class="tok-s2">&quot;Test the create action returns the correct model&quot;</span><span class="tok-o">()</span> <span class="tok-o">{</span>
        <span class="tok-nl">when:</span><span class="tok-s2">&quot;The create action is executed&quot;</span>
            <span class="tok-n">controller</span><span class="tok-o">.</span><span class="tok-na">create</span><span class="tok-o">()</span>

        <span class="tok-nl">then:</span><span class="tok-s2">&quot;The model is correctly created&quot;</span>
            <span class="tok-n">model</span><span class="tok-o">.</span><span class="tok-na">categoryInstance</span><span class="tok-o">!=</span> <span class="tok-kc">null</span>
    <span class="tok-o">}</span>

    <span class="tok-kt">void</span> <span class="tok-s2">&quot;Test the save action correctly persists an instance&quot;</span><span class="tok-o">()</span> <span class="tok-o">{</span>

        <span class="tok-nl">when:</span><span class="tok-s2">&quot;The save action is executed with an invalid instance&quot;</span>
            <span class="tok-n">request</span><span class="tok-o">.</span><span class="tok-na">contentType</span> <span class="tok-o">=</span> <span class="tok-n">FORM_CONTENT_TYPE</span>
            <span class="tok-n">request</span><span class="tok-o">.</span><span class="tok-na">method</span> <span class="tok-o">=</span> <span class="tok-s1">&#39;POST&#39;</span>
            <span class="tok-kt">def</span> <span class="tok-n">category</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">Category</span><span class="tok-o">()</span>
            <span class="tok-n">category</span><span class="tok-o">.</span><span class="tok-na">validate</span><span class="tok-o">()</span>
            <span class="tok-n">controller</span><span class="tok-o">.</span><span class="tok-na">save</span><span class="tok-o">(</span><span class="tok-n">category</span><span class="tok-o">)</span>

        <span class="tok-nl">then:</span><span class="tok-s2">&quot;The create view is rendered again with the correct model&quot;</span>
            <span class="tok-n">model</span><span class="tok-o">.</span><span class="tok-na">categoryInstance</span><span class="tok-o">!=</span> <span class="tok-kc">null</span>
            <span class="tok-n">view</span> <span class="tok-o">==</span> <span class="tok-s1">&#39;create&#39;</span>

        <span class="tok-nl">when:</span><span class="tok-s2">&quot;The save action is executed with a valid instance&quot;</span>
            <span class="tok-n">response</span><span class="tok-o">.</span><span class="tok-na">reset</span><span class="tok-o">()</span>
            <span class="tok-n">populateValidParams</span><span class="tok-o">(</span><span class="tok-n">params</span><span class="tok-o">)</span>
            <span class="tok-n">category</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">Category</span><span class="tok-o">(</span><span class="tok-n">params</span><span class="tok-o">)</span>

            <span class="tok-n">controller</span><span class="tok-o">.</span><span class="tok-na">save</span><span class="tok-o">(</span><span class="tok-n">category</span><span class="tok-o">)</span>

        <span class="tok-nl">then:</span><span class="tok-s2">&quot;A redirect is issued to the show action&quot;</span>
            <span class="tok-n">response</span><span class="tok-o">.</span><span class="tok-na">redirectedUrl</span> <span class="tok-o">==</span> <span class="tok-s1">&#39;/category/show/1&#39;</span>
            <span class="tok-n">controller</span><span class="tok-o">.</span><span class="tok-na">flash</span><span class="tok-o">.</span><span class="tok-na">message</span> <span class="tok-o">!=</span> <span class="tok-kc">null</span>
            <span class="tok-n">Category</span><span class="tok-o">.</span><span class="tok-na">count</span><span class="tok-o">()</span> <span class="tok-o">==</span> <span class="tok-mi">1</span>
    <span class="tok-o">}</span>

    <span class="tok-kt">void</span> <span class="tok-s2">&quot;Test that the show action returns the correct model&quot;</span><span class="tok-o">()</span> <span class="tok-o">{</span>
        <span class="tok-nl">when:</span><span class="tok-s2">&quot;The show action is executed with a null domain&quot;</span>
            <span class="tok-n">controller</span><span class="tok-o">.</span><span class="tok-na">show</span><span class="tok-o">(</span><span class="tok-kc">null</span><span class="tok-o">)</span>

        <span class="tok-nl">then:</span><span class="tok-s2">&quot;A 404 error is returned&quot;</span>
            <span class="tok-n">response</span><span class="tok-o">.</span><span class="tok-na">status</span> <span class="tok-o">==</span> <span class="tok-mi">404</span>

        <span class="tok-nl">when:</span><span class="tok-s2">&quot;A domain instance is passed to the show action&quot;</span>
            <span class="tok-n">populateValidParams</span><span class="tok-o">(</span><span class="tok-n">params</span><span class="tok-o">)</span>
            <span class="tok-kt">def</span> <span class="tok-n">category</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">Category</span><span class="tok-o">(</span><span class="tok-n">params</span><span class="tok-o">)</span>
            <span class="tok-n">controller</span><span class="tok-o">.</span><span class="tok-na">show</span><span class="tok-o">(</span><span class="tok-n">category</span><span class="tok-o">)</span>

        <span class="tok-nl">then:</span><span class="tok-s2">&quot;A model is populated containing the domain instance&quot;</span>
            <span class="tok-n">model</span><span class="tok-o">.</span><span class="tok-na">categoryInstance</span> <span class="tok-o">==</span> <span class="tok-n">category</span>
    <span class="tok-o">}</span>

    <span class="tok-kt">void</span> <span class="tok-s2">&quot;Test that the edit action returns the correct model&quot;</span><span class="tok-o">()</span> <span class="tok-o">{</span>
        <span class="tok-nl">when:</span><span class="tok-s2">&quot;The edit action is executed with a null domain&quot;</span>
            <span class="tok-n">controller</span><span class="tok-o">.</span><span class="tok-na">edit</span><span class="tok-o">(</span><span class="tok-kc">null</span><span class="tok-o">)</span>

        <span class="tok-nl">then:</span><span class="tok-s2">&quot;A 404 error is returned&quot;</span>
            <span class="tok-n">response</span><span class="tok-o">.</span><span class="tok-na">status</span> <span class="tok-o">==</span> <span class="tok-mi">404</span>

        <span class="tok-nl">when:</span><span class="tok-s2">&quot;A domain instance is passed to the edit action&quot;</span>
            <span class="tok-n">populateValidParams</span><span class="tok-o">(</span><span class="tok-n">params</span><span class="tok-o">)</span>
            <span class="tok-kt">def</span> <span class="tok-n">category</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">Category</span><span class="tok-o">(</span><span class="tok-n">params</span><span class="tok-o">)</span>
            <span class="tok-n">controller</span><span class="tok-o">.</span><span class="tok-na">edit</span><span class="tok-o">(</span><span class="tok-n">category</span><span class="tok-o">)</span>

        <span class="tok-nl">then:</span><span class="tok-s2">&quot;A model is populated containing the domain instance&quot;</span>
            <span class="tok-n">model</span><span class="tok-o">.</span><span class="tok-na">categoryInstance</span> <span class="tok-o">==</span> <span class="tok-n">category</span>
    <span class="tok-o">}</span>

    <span class="tok-kt">void</span> <span class="tok-s2">&quot;Test the update action performs an update on a valid domain instance&quot;</span><span class="tok-o">()</span> <span class="tok-o">{</span>
        <span class="tok-nl">when:</span><span class="tok-s2">&quot;Update is called for a domain instance that doesn&#39;t exist&quot;</span>
            <span class="tok-n">request</span><span class="tok-o">.</span><span class="tok-na">contentType</span> <span class="tok-o">=</span> <span class="tok-n">FORM_CONTENT_TYPE</span>
            <span class="tok-n">request</span><span class="tok-o">.</span><span class="tok-na">method</span> <span class="tok-o">=</span> <span class="tok-s1">&#39;PUT&#39;</span>
            <span class="tok-n">controller</span><span class="tok-o">.</span><span class="tok-na">update</span><span class="tok-o">(</span><span class="tok-kc">null</span><span class="tok-o">)</span>

        <span class="tok-nl">then:</span><span class="tok-s2">&quot;A 404 error is returned&quot;</span>
            <span class="tok-n">response</span><span class="tok-o">.</span><span class="tok-na">redirectedUrl</span> <span class="tok-o">==</span> <span class="tok-s1">&#39;/category/index&#39;</span>
            <span class="tok-n">flash</span><span class="tok-o">.</span><span class="tok-na">message</span> <span class="tok-o">!=</span> <span class="tok-kc">null</span>


        <span class="tok-nl">when:</span><span class="tok-s2">&quot;An invalid domain instance is passed to the update action&quot;</span>
            <span class="tok-n">response</span><span class="tok-o">.</span><span class="tok-na">reset</span><span class="tok-o">()</span>
            <span class="tok-kt">def</span> <span class="tok-n">category</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">Category</span><span class="tok-o">()</span>
            <span class="tok-n">category</span><span class="tok-o">.</span><span class="tok-na">validate</span><span class="tok-o">()</span>
            <span class="tok-n">controller</span><span class="tok-o">.</span><span class="tok-na">update</span><span class="tok-o">(</span><span class="tok-n">category</span><span class="tok-o">)</span>

        <span class="tok-nl">then:</span><span class="tok-s2">&quot;The edit view is rendered again with the invalid instance&quot;</span>
            <span class="tok-n">view</span> <span class="tok-o">==</span> <span class="tok-s1">&#39;edit&#39;</span>
            <span class="tok-n">model</span><span class="tok-o">.</span><span class="tok-na">categoryInstance</span> <span class="tok-o">==</span> <span class="tok-n">category</span>

        <span class="tok-nl">when:</span><span class="tok-s2">&quot;A valid domain instance is passed to the update action&quot;</span>
            <span class="tok-n">response</span><span class="tok-o">.</span><span class="tok-na">reset</span><span class="tok-o">()</span>
            <span class="tok-n">populateValidParams</span><span class="tok-o">(</span><span class="tok-n">params</span><span class="tok-o">)</span>
            <span class="tok-n">category</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">Category</span><span class="tok-o">(</span><span class="tok-n">params</span><span class="tok-o">).</span><span class="tok-na">save</span><span class="tok-o">(</span><span class="tok-nl">flush:</span> <span class="tok-kc">true</span><span class="tok-o">)</span>
            <span class="tok-n">controller</span><span class="tok-o">.</span><span class="tok-na">update</span><span class="tok-o">(</span><span class="tok-n">category</span><span class="tok-o">)</span>

        <span class="tok-nl">then:</span><span class="tok-s2">&quot;A redirect is issues to the show action&quot;</span>
            <span class="tok-n">response</span><span class="tok-o">.</span><span class="tok-na">redirectedUrl</span> <span class="tok-o">==</span> <span class="tok-s2">&quot;/category/show/$category.id&quot;</span>
            <span class="tok-n">flash</span><span class="tok-o">.</span><span class="tok-na">message</span> <span class="tok-o">!=</span> <span class="tok-kc">null</span>
    <span class="tok-o">}</span>

    <span class="tok-kt">void</span> <span class="tok-s2">&quot;Test that the delete action deletes an instance if it exists&quot;</span><span class="tok-o">()</span> <span class="tok-o">{</span>
        <span class="tok-nl">when:</span><span class="tok-s2">&quot;The delete action is called for a null instance&quot;</span>
            <span class="tok-n">request</span><span class="tok-o">.</span><span class="tok-na">contentType</span> <span class="tok-o">=</span> <span class="tok-n">FORM_CONTENT_TYPE</span>
            <span class="tok-n">request</span><span class="tok-o">.</span><span class="tok-na">method</span> <span class="tok-o">=</span> <span class="tok-s1">&#39;DELETE&#39;</span>
            <span class="tok-n">controller</span><span class="tok-o">.</span><span class="tok-na">delete</span><span class="tok-o">(</span><span class="tok-kc">null</span><span class="tok-o">)</span>

        <span class="tok-nl">then:</span><span class="tok-s2">&quot;A 404 is returned&quot;</span>
            <span class="tok-n">response</span><span class="tok-o">.</span><span class="tok-na">redirectedUrl</span> <span class="tok-o">==</span> <span class="tok-s1">&#39;/category/index&#39;</span>
            <span class="tok-n">flash</span><span class="tok-o">.</span><span class="tok-na">message</span> <span class="tok-o">!=</span> <span class="tok-kc">null</span>

        <span class="tok-nl">when:</span><span class="tok-s2">&quot;A domain instance is created&quot;</span>
            <span class="tok-n">response</span><span class="tok-o">.</span><span class="tok-na">reset</span><span class="tok-o">()</span>
            <span class="tok-n">populateValidParams</span><span class="tok-o">(</span><span class="tok-n">params</span><span class="tok-o">)</span>
            <span class="tok-kt">def</span> <span class="tok-n">category</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">Category</span><span class="tok-o">(</span><span class="tok-n">params</span><span class="tok-o">).</span><span class="tok-na">save</span><span class="tok-o">(</span><span class="tok-nl">flush:</span> <span class="tok-kc">true</span><span class="tok-o">)</span>

        <span class="tok-nl">then:</span><span class="tok-s2">&quot;It exists&quot;</span>
            <span class="tok-n">Category</span><span class="tok-o">.</span><span class="tok-na">count</span><span class="tok-o">()</span> <span class="tok-o">==</span> <span class="tok-mi">1</span>

        <span class="tok-nl">when:</span><span class="tok-s2">&quot;The domain instance is passed to the delete action&quot;</span>
            <span class="tok-n">controller</span><span class="tok-o">.</span><span class="tok-na">delete</span><span class="tok-o">(</span><span class="tok-n">category</span><span class="tok-o">)</span>

        <span class="tok-nl">then:</span><span class="tok-s2">&quot;The instance is deleted&quot;</span>
            <span class="tok-n">Category</span><span class="tok-o">.</span><span class="tok-na">count</span><span class="tok-o">()</span> <span class="tok-o">==</span> <span class="tok-mi">0</span>
            <span class="tok-n">response</span><span class="tok-o">.</span><span class="tok-na">redirectedUrl</span> <span class="tok-o">==</span> <span class="tok-s1">&#39;/category/index&#39;</span>
            <span class="tok-n">flash</span><span class="tok-o">.</span><span class="tok-na">message</span> <span class="tok-o">!=</span> <span class="tok-kc">null</span>
    <span class="tok-o">}</span>
<span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Â¿QuÃ© podemos extraer de estos tests generados?</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Una serie de variables han sido automÃ¡ticamente inyectadas en nuestro test como son <em>controller</em>, <em>model</em>, <em>view</em>, <em>response</em>, <em>request</em> y <em>flash</em>.</p>
</li>
<li>
<p>Se utiliza la anotaciÃ³n <em>@Mock()</em> para mockear el comportamiento de la clase de dominio pasada por parÃ¡metro. De esta forma se simula su almacenamiento.</p>
</li>
<li>
<p>Para invocar un mÃ©todo cualquiera del controlador simplemente debemos ejecutar <em>controller.method()</em></p>
</li>
<li>
<p>La variable <em>model</em> nos permitirÃ¡ comprobar si el modelo que devolvemos es el esperado</p>
</li>
<li>
<p>Las redirecciones se pueden comprobar con la variable <em>response.redirectedUrl</em></p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_tests_con_spock_sobre_librerÃ­as_de_etiquetas_vistas_y_plantillas_en_grails">6.3.3. Tests con Spock sobre librerÃ­as de etiquetas, vistas y plantillas en Grails</h4>
<div class="paragraph">
<p>Como siempre, cuando creÃ¡bamos la librerÃ­a de etiquetas <em>TodoTagLib.groovy</em>, se creaba automÃ¡ticamente un esqueleto de test unitario:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-kn">package</span> <span class="tok-n">es</span><span class="tok-o">.</span><span class="tok-na">ua</span><span class="tok-o">.</span><span class="tok-na">expertojava</span><span class="tok-o">.</span><span class="tok-na">todo</span>

<span class="tok-kn">import</span> <span class="tok-nn">grails.test.mixin.TestFor</span>
<span class="tok-kn">import</span> <span class="tok-nn">spock.lang.Specification</span>

<span class="tok-cm">/**</span>
<span class="tok-cm"> * See the API for {@link grails.test.mixin.web.GroovyPageUnitTestMixin} for usage instructions</span>
<span class="tok-cm"> */</span>
<span class="tok-nd">@TestFor</span><span class="tok-o">(</span><span class="tok-n">TodoTagLib</span><span class="tok-o">)</span>
<span class="tok-kd">class</span> <span class="tok-nc">TodoTagLibSpec</span> <span class="tok-kd">extends</span> <span class="tok-n">Specification</span> <span class="tok-o">{</span>

    <span class="tok-kt">def</span> <span class="tok-nf">setup</span><span class="tok-o">()</span> <span class="tok-o">{</span>
    <span class="tok-o">}</span>

    <span class="tok-kt">def</span> <span class="tok-nf">cleanup</span><span class="tok-o">()</span> <span class="tok-o">{</span>
    <span class="tok-o">}</span>

    <span class="tok-kt">void</span> <span class="tok-s2">&quot;test something&quot;</span><span class="tok-o">()</span> <span class="tok-o">{</span>
    <span class="tok-o">}</span>
<span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Mediante la anotaciÃ³n <em>@TestFor(TodoTagLib)</em> la variable <em>tagLib</em> se inyecta automÃ¡ticamente en nuestros tests. Si hacemos memoria, cuando hablÃ¡bamos de las librerÃ­as de etiquetas ponÃ­amos como ejemplo</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-kt">def</span> <span class="tok-n">includeJs</span> <span class="tok-o">=</span> <span class="tok-o">{</span><span class="tok-n">attrs</span> <span class="tok-o">-&gt;</span>
    <span class="tok-n">out</span> <span class="tok-o">&lt;&lt;</span> <span class="tok-s2">&quot;&lt;script src=&#39;scripts/${attrs[&#39;script&#39;]}.js&#39;&gt;&lt;/script&gt;&quot;</span>
<span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Vamos a ver a continuaciÃ³n como podemos comprobar que esta etiqueta devuelve lo que pensamos.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-kt">void</span> <span class="tok-s2">&quot;La etiqueta includeJs devuelve una referencia a la librerÃ­a javascript pasada por parÃ¡metro&quot;</span><span class="tok-o">()</span> <span class="tok-o">{</span>
    <span class="tok-nl">expect:</span>
        <span class="tok-n">applyTemplate</span><span class="tok-o">(</span><span class="tok-s1">&#39;&lt;todo:includeJs script=&quot;&quot; /&gt;&#39;</span><span class="tok-o">)</span> <span class="tok-o">==</span> <span class="tok-s2">&quot;&lt;script src=&#39;scripts/.js&#39;&gt;&lt;/script&gt;&quot;</span>
        <span class="tok-n">applyTemplate</span><span class="tok-o">(</span><span class="tok-s1">&#39;&lt;todo:includeJs script=&quot;myfile&quot; /&gt;&#39;</span><span class="tok-o">)</span> <span class="tok-o">==</span> <span class="tok-s2">&quot;&lt;script src=&#39;scripts/myfile.js&#39;&gt;&lt;/script&gt;&quot;</span>
<span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>AdemÃ¡s de testear las librerÃ­as de etiquetas, vamos a comprobar que las vistas y las plantillas devuelven lo que deben devolver. Si recordamos en la sesiÃ³n de vistas y plantillas, creÃ¡bamos una plantilla para pintar el pie de pÃ¡gina. Vamos a poder comprobar que esta plantilla devuelve lo correcto mediante un test unitario:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-kt">void</span> <span class="tok-s2">&quot;El pie de pÃ¡gina se renderiza correctamente&quot;</span><span class="tok-o">()</span> <span class="tok-o">{</span>
    <span class="tok-nl">when:</span>
        <span class="tok-kt">def</span> <span class="tok-n">result</span> <span class="tok-o">=</span> <span class="tok-n">render</span><span class="tok-o">(</span><span class="tok-nl">template:</span> <span class="tok-s1">&#39;/common/footer&#39;</span><span class="tok-o">)</span>

    <span class="tok-nl">then:</span>
        <span class="tok-n">result</span> <span class="tok-o">==</span> <span class="tok-s2">&quot;&lt;div class=\&quot;footer\&quot; role=\&quot;contentinfo\&quot;&gt;\n&quot;</span> <span class="tok-o">+</span>
            <span class="tok-s2">&quot;    &amp;copy; 2015 Experto en Desarrollo de Aplicaciones Web con JavaEE y Javascript&lt;br/&gt;\n&quot;</span> <span class="tok-o">+</span>
            <span class="tok-s2">&quot;    AplicaciÃ³n Todo creada por Francisco JosÃ© GarcÃ­a Rico (21.542.334F)\n&quot;</span> <span class="tok-o">+</span>
            <span class="tok-s2">&quot;&lt;/div&gt;&quot;</span>
<span class="tok-o">}</span></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_tests_con_spock_sobre_servicios_en_grails">6.3.4. Tests con Spock sobre servicios en Grails</h4>
<div class="paragraph">
<p>Tal y como sucede con el resto de artefactos de una aplicaciÃ³n en Grails, cuando creamos un servicio nuevo automÃ¡ticamente se genera tambiÃ©n un test unitario que nos permitirÃ¡ testear los mÃ©todos del servicio.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-kn">package</span> <span class="tok-n">es</span><span class="tok-o">.</span><span class="tok-na">ua</span><span class="tok-o">.</span><span class="tok-na">expertojava</span><span class="tok-o">.</span><span class="tok-na">todo</span>

<span class="tok-kn">import</span> <span class="tok-nn">grails.test.mixin.TestFor</span>
<span class="tok-kn">import</span> <span class="tok-nn">spock.lang.Specification</span>

<span class="tok-cm">/**</span>
<span class="tok-cm"> * See the API for {@link grails.test.mixin.services.ServiceUnitTestMixin} for usage instructions</span>
<span class="tok-cm"> */</span>
<span class="tok-nd">@TestFor</span><span class="tok-o">(</span><span class="tok-n">TodoService</span><span class="tok-o">)</span>
<span class="tok-kd">class</span> <span class="tok-nc">TodoServiceSpec</span> <span class="tok-kd">extends</span> <span class="tok-n">Specification</span> <span class="tok-o">{</span>

    <span class="tok-kt">def</span> <span class="tok-nf">setup</span><span class="tok-o">()</span> <span class="tok-o">{</span>
    <span class="tok-o">}</span>

    <span class="tok-kt">def</span> <span class="tok-nf">cleanup</span><span class="tok-o">()</span> <span class="tok-o">{</span>
    <span class="tok-o">}</span>

    <span class="tok-kt">void</span> <span class="tok-s2">&quot;test something&quot;</span><span class="tok-o">()</span> <span class="tok-o">{</span>
    <span class="tok-o">}</span>
<span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>En su momento creÃ¡bamos un mÃ©todo llamado <em>getNextTodos()</em> que nos devolvÃ­a las tareas programadas para los prÃ³ximos dÃ­as. Para poder testear este mÃ©todo, vamos a necesitar crear una serie de instancias de la clase de dominio <em>Todo</em>. Si recordamos el mÃ©todo en cuestiÃ³n</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-kt">def</span> <span class="tok-nf">getNextTodos</span><span class="tok-o">(</span><span class="tok-n">Integer</span> <span class="tok-n">days</span><span class="tok-o">,</span> <span class="tok-n">params</span><span class="tok-o">)</span> <span class="tok-o">{</span>
    <span class="tok-n">Date</span> <span class="tok-n">now</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">Date</span><span class="tok-o">(</span><span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">currentTimeMillis</span><span class="tok-o">())</span>
    <span class="tok-n">Date</span> <span class="tok-n">to</span> <span class="tok-o">=</span> <span class="tok-n">now</span> <span class="tok-o">+</span> <span class="tok-n">days</span>
    <span class="tok-n">Todo</span><span class="tok-o">.</span><span class="tok-na">findAllByDateBetween</span><span class="tok-o">(</span><span class="tok-n">now</span><span class="tok-o">,</span> <span class="tok-n">to</span><span class="tok-o">,</span> <span class="tok-n">params</span><span class="tok-o">)</span>
<span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>vemos que se utiliza una llamada a un mÃ©todo dinÃ¡mico de GORM, con lo que se se realizarÃ¡ una consulta a la base de datos. Pero, si recordamos la definiciÃ³n de tests unitarios que veÃ­amos al inicio de esta sesiÃ³n, se hacÃ­a menciÃ³n a que los tests unitarios no tienen acceso a recursos externos tales como la base de datos, con lo que, Â¿cÃ³mo vamos a poder solucionar este problema?</p>
</div>
<div class="paragraph">
<p>PodrÃ­amos optar por dos soluciones. Bien crear un test de integraciÃ³n para tener acceso a la base de datos o bien, <em>mockear</em> la creaciÃ³n de las clases de dominio necesarias. Nosotros optamos por la segunda soluciÃ³n, ya que en tÃ©rminos de velocidad de ejecuciÃ³n de los tests, los tests de integraciÃ³n son considerablemente mÃ¡s lentos que los tests unitarios.</p>
</div>
<div class="paragraph">
<p>Para <em>mockear</em> la creaciÃ³n de una serie de instancias de una determinada clase de dominio, vamos a utilizar el mÃ©todo llamado <em>mockDomain</em> al cual le podemos pasar que clase de domino queremos mockear y cuales son esas instancias. Con esto podrÃ­amos tener un test como Ã©ste para comprobar el mÃ©todo <em>getNextTodos()</em>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-kt">void</span> <span class="tok-s2">&quot;El mÃ©todo getNextTodos devuelve los siguientes todos de los dÃ­as pasado por parÃ¡metro&quot;</span><span class="tok-o">()</span> <span class="tok-o">{</span>
    <span class="tok-nl">given:</span>
        <span class="tok-kt">def</span> <span class="tok-n">todoDayBeforeYesterday</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">Todo</span><span class="tok-o">(</span><span class="tok-nl">title:</span><span class="tok-s2">&quot;Todo day before yesterday&quot;</span><span class="tok-o">,</span> <span class="tok-nl">date:</span> <span class="tok-k">new</span> <span class="tok-n">Date</span><span class="tok-o">()</span> <span class="tok-o">-</span> <span class="tok-mi">2</span> <span class="tok-o">)</span>
        <span class="tok-kt">def</span> <span class="tok-n">todoYesterday</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">Todo</span><span class="tok-o">(</span><span class="tok-nl">title:</span><span class="tok-s2">&quot;Todo yesterday&quot;</span><span class="tok-o">,</span> <span class="tok-nl">date:</span> <span class="tok-k">new</span> <span class="tok-n">Date</span><span class="tok-o">()</span> <span class="tok-o">-</span> <span class="tok-mi">1</span> <span class="tok-o">)</span>
        <span class="tok-kt">def</span> <span class="tok-n">todoToday</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">Todo</span><span class="tok-o">(</span><span class="tok-nl">title:</span><span class="tok-s2">&quot;Todo today&quot;</span><span class="tok-o">,</span> <span class="tok-nl">date:</span> <span class="tok-k">new</span> <span class="tok-n">Date</span><span class="tok-o">())</span>
        <span class="tok-kt">def</span> <span class="tok-n">todoTomorrow</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">Todo</span><span class="tok-o">(</span><span class="tok-nl">title:</span><span class="tok-s2">&quot;Todo tomorrow&quot;</span><span class="tok-o">,</span> <span class="tok-nl">date:</span> <span class="tok-k">new</span> <span class="tok-n">Date</span><span class="tok-o">()</span> <span class="tok-o">+</span> <span class="tok-mi">1</span> <span class="tok-o">)</span>
        <span class="tok-kt">def</span> <span class="tok-n">todoDayAfterTomorrow</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">Todo</span><span class="tok-o">(</span><span class="tok-nl">title:</span><span class="tok-s2">&quot;Todo day after tomorrow&quot;</span><span class="tok-o">,</span> <span class="tok-nl">date:</span> <span class="tok-k">new</span> <span class="tok-n">Date</span><span class="tok-o">()</span> <span class="tok-o">+</span> <span class="tok-mi">2</span> <span class="tok-o">)</span>
        <span class="tok-kt">def</span> <span class="tok-n">todoDayAfterDayAfterTomorrow</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">Todo</span><span class="tok-o">(</span><span class="tok-nl">title:</span><span class="tok-s2">&quot;Todo day after tomorrow&quot;</span><span class="tok-o">,</span> <span class="tok-nl">date:</span> <span class="tok-k">new</span> <span class="tok-n">Date</span><span class="tok-o">()</span> <span class="tok-o">+</span> <span class="tok-mi">3</span> <span class="tok-o">)</span>
    <span class="tok-nl">and:</span>
        <span class="tok-n">mockDomain</span><span class="tok-o">(</span><span class="tok-n">Todo</span><span class="tok-o">,[</span><span class="tok-n">todoDayBeforeYesterday</span><span class="tok-o">,</span> <span class="tok-n">todoYesterday</span><span class="tok-o">,</span> <span class="tok-n">todoToday</span><span class="tok-o">,</span> <span class="tok-n">todoTomorrow</span><span class="tok-o">,</span> <span class="tok-n">todoDayAfterTomorrow</span><span class="tok-o">,</span> <span class="tok-n">todoDayAfterDayAfterTomorrow</span><span class="tok-o">])</span>
    <span class="tok-nl">and:</span>
        <span class="tok-kt">def</span> <span class="tok-n">nextTodos</span> <span class="tok-o">=</span> <span class="tok-n">service</span><span class="tok-o">.</span><span class="tok-na">getNextTodos</span><span class="tok-o">(</span><span class="tok-mi">2</span><span class="tok-o">,[:])</span>
    <span class="tok-nl">expect:</span>
        <span class="tok-n">Todo</span><span class="tok-o">.</span><span class="tok-na">count</span><span class="tok-o">()</span> <span class="tok-o">==</span> <span class="tok-mi">6</span>
    <span class="tok-nl">and:</span>
        <span class="tok-n">nextTodos</span><span class="tok-o">.</span><span class="tok-na">containsAll</span><span class="tok-o">([</span><span class="tok-n">todoTomorrow</span><span class="tok-o">,</span> <span class="tok-n">todoDayAfterTomorrow</span><span class="tok-o">])</span>
        <span class="tok-n">nextTodos</span><span class="tok-o">.</span><span class="tok-na">size</span><span class="tok-o">()</span> <span class="tok-o">==</span> <span class="tok-mi">2</span>
    <span class="tok-nl">and:</span>
        <span class="tok-o">!</span><span class="tok-n">nextTodos</span><span class="tok-o">.</span><span class="tok-na">contains</span><span class="tok-o">(</span><span class="tok-n">todoDayBeforeYesterday</span><span class="tok-o">)</span>
        <span class="tok-o">!</span><span class="tok-n">nextTodos</span><span class="tok-o">.</span><span class="tok-na">contains</span><span class="tok-o">(</span><span class="tok-n">todoToday</span><span class="tok-o">)</span>
        <span class="tok-o">!</span><span class="tok-n">nextTodos</span><span class="tok-o">.</span><span class="tok-na">contains</span><span class="tok-o">(</span><span class="tok-n">todoYesterday</span><span class="tok-o">)</span>
        <span class="tok-o">!</span><span class="tok-n">nextTodos</span><span class="tok-o">.</span><span class="tok-na">contains</span><span class="tok-o">(</span><span class="tok-n">todoDayAfterDayAfterTomorrow</span><span class="tok-o">)</span>
<span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>En el test, en primer lugar creamos todas las instancias de la clase de dominio <em>Todo</em> que vamos a utilizar para realizar las comprobaciones. La primera comprobaciÃ³n que realizamos es comprobar que el contador de instancias de la clase <em>Todo</em> es igual al nÃºmero de elementos creados.</p>
</div>
<div class="paragraph">
<p>A continuaciÃ³n, ya comprobamos el mÃ©todo <em>getNextTodos()</em> para comprobar que sÃ³lo devuelve aquellas instancias creadas que coincidan con el criterio de que sean tareas a realizar en el futuro. Esto significa que sÃ³lo las instancias <em>todoTomorrow</em> y <em>todoDayAfterTomorrow</em> serÃ¡n devueltas.</p>
</div>
</div>
<div class="sect3">
<h4 id="_tests_con_spock_mockeando_objetos">6.3.5. Tests con Spock mockeando objetos</h4>
<div class="paragraph">
<p>Los tests unitarios se pueden complicar mucho cuando entran en funcionamiento otros objetos en el mÃ©todo que queremos probar. Por ejemplo, en la sesiÃ³n sobre vistas y etiquetas planteÃ¡bamos un ejercicio para escribir una etiqueta que nos imprimiera por pantalla un icono diferente en funciÃ³n de si el valor pasado por parÃ¡metro era cierto o falso. Esa etiqueta se aconsejaba utilizar a su vez la etiqueta <em>asset.image()</em> procedente del plugin <em>asset pipeline</em>.</p>
</div>
<div class="paragraph">
<p>Si pensamos en que test podrÃ­amos utilizar para comprobar el funcionamiento de la etiqueta <em>printIconFromBoolean</em>, podrÃ­amos pensar algo asÃ­:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-nd">@Unroll</span>
<span class="tok-kt">void</span> <span class="tok-s2">&quot;El mÃ©todo printIconFromBoolean devuelve una ruta a una imagen&quot;</span><span class="tok-o">()</span> <span class="tok-o">{</span>
    <span class="tok-nl">when:</span>
        <span class="tok-kt">def</span> <span class="tok-n">output</span> <span class="tok-o">=</span> <span class="tok-n">applyTemplate</span><span class="tok-o">(</span><span class="tok-s1">&#39;&lt;todo:printIconFromBoolean value=&quot;${value}&quot; /&gt;&#39;</span><span class="tok-o">,</span> <span class="tok-o">[</span><span class="tok-nl">value:</span><span class="tok-n">value</span><span class="tok-o">])</span>
    <span class="tok-nl">then:</span>
        <span class="tok-n">output</span> <span class="tok-o">==</span> <span class="tok-n">expectedOutput</span>
    <span class="tok-nl">where:</span>
        <span class="tok-n">value</span>   <span class="tok-o">|</span>   <span class="tok-n">expectedOutput</span>
        <span class="tok-kc">true</span>    <span class="tok-o">|</span>   <span class="tok-s2">&quot;icontrue.png&quot;</span>
        <span class="tok-kc">false</span>   <span class="tok-o">|</span>   <span class="tok-s2">&quot;iconfalse.png&quot;</span>
<span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Sin embargo, si ejecutamos este test, veremos como el test no se ejecuta correctamente debido a que no sabe como ejecutar un mÃ©todo llamado <em>assetPath</em>. Â¿assetPath? Â¿De dÃ³nde viene la llamada a ese mÃ©todo?</p>
</div>
<div class="paragraph">
<p>Si analizamos el cÃ³digo del mÃ©todo <em>image</em> de la librerÃ­a de etiquetas <em>AssetsTagLib</em> veremos como se realiza una llamada al mÃ©todo <em>assetPath</em> que queda fuera del contexto de nuestro test unitario con lo que no podemos acceder directamente a Ã©l. Para solucionar este problema, debemos <em>mockear</em> la llamada que nuestra etiqueta <em>printIconFromBoolean</em> realiza al mÃ©todo <em>image()</em> de la librerÃ­a de etiquetas del plugin <em>asset pipeline</em>. De esta forma, podemos aislar nuestra prueba unitaria de las llamadas realizadas por otros objetos colaboradores y nos centraremos en la lÃ³gica de nuestro mÃ©todo.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-nd">@Unroll</span>
<span class="tok-kt">void</span> <span class="tok-s2">&quot;El mÃ©todo printIconFromBoolean devuelve una ruta a una imagen&quot;</span><span class="tok-o">()</span> <span class="tok-o">{</span>
    <span class="tok-nl">given:</span>
        <span class="tok-kt">def</span> <span class="tok-n">assetsTagLib</span> <span class="tok-o">=</span> <span class="tok-n">Mock</span><span class="tok-o">(</span><span class="tok-n">AssetsTagLib</span><span class="tok-o">)</span>
        <span class="tok-n">tagLib</span><span class="tok-o">.</span><span class="tok-na">metaClass</span><span class="tok-o">.</span><span class="tok-na">asset</span> <span class="tok-o">=</span> <span class="tok-n">assetsTagLib</span>
    <span class="tok-nl">when:</span>
        <span class="tok-kt">def</span> <span class="tok-n">output</span> <span class="tok-o">=</span> <span class="tok-n">applyTemplate</span><span class="tok-o">(</span><span class="tok-s1">&#39;&lt;todo:printIconFromBoolean value=&quot;${value}&quot; /&gt;&#39;</span><span class="tok-o">,</span> <span class="tok-o">[</span><span class="tok-nl">value:</span><span class="tok-n">value</span><span class="tok-o">])</span>
    <span class="tok-nl">then:</span>
        <span class="tok-n">output</span> <span class="tok-o">==</span> <span class="tok-n">expectedOutput</span>
    <span class="tok-nl">and:</span>
        <span class="tok-mi">1</span> <span class="tok-o">*</span> <span class="tok-n">assetsTagLib</span><span class="tok-o">.</span><span class="tok-na">image</span><span class="tok-o">(</span><span class="tok-n">_</span><span class="tok-o">)</span> <span class="tok-o">&gt;&gt;</span> <span class="tok-o">{</span> <span class="tok-n">value</span> <span class="tok-o">?</span> <span class="tok-s2">&quot;icontrue.png&quot;</span> <span class="tok-o">:</span> <span class="tok-s2">&quot;iconfalse.png&quot;</span> <span class="tok-o">}</span>
    <span class="tok-nl">where:</span>
        <span class="tok-n">value</span>   <span class="tok-o">|</span>   <span class="tok-n">expectedOutput</span>
        <span class="tok-kc">true</span>    <span class="tok-o">|</span>   <span class="tok-s2">&quot;icontrue.png&quot;</span>
        <span class="tok-kc">false</span>   <span class="tok-o">|</span>   <span class="tok-s2">&quot;iconfalse.png&quot;</span>
<span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>En primer lugar, debemos mockear la librerÃ­a <em>AssetsTagLib</em> para poder devolver lo que nosotros queramos y que no sea necesario invocar al mÃ©todo <em>assetPath</em>. AdemÃ¡s, debemos indicar una referencia al <em>namespace</em> asset que nuestra librerÃ­a <em>TodoTagLib</em> va a utilizar como colaborador. Esto lo hacemos con algo de metaprogramaciÃ³n</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-n">tagLib</span><span class="tok-o">.</span><span class="tok-na">metaClass</span><span class="tok-o">.</span><span class="tok-na">asset</span> <span class="tok-o">=</span> <span class="tok-n">assetTagLib</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>y bÃ¡sicamente estamos creando una referencia entre el objeto <em>asset</em> en el contexto de la librerÃ­a de etiquetas <em>TodoTagLib</em> y nuestro objecto mockeado con la librerÃ­a <em>AssetsTagLib</em>. De esta forma, lo Ãºnico que nos queda por hacer es sobrecargar el mÃ©todo <em>image()</em>.</p>
</div>
<div class="paragraph">
<p>Para sobrecargar este mÃ©todo utilizamos una tÃ©cnica que nos permite incluso saber cuantas veces un mÃ©todo ha sido invocado y con que parÃ¡metros. Esta tÃ©cnica se conoce como <em>Tests basados en interacciones</em>.</p>
</div>
<div class="paragraph">
<p>Para ello lo primero que hemos hecho ha sido generar ese objecto mockeado con</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-kt">def</span> <span class="tok-n">assetsTagLib</span> <span class="tok-o">=</span> <span class="tok-n">Mock</span><span class="tok-o">(</span><span class="tok-n">AssetsTagLib</span><span class="tok-o">)</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Por Ãºltimo, debemos indicar cuantas interacciones vamos a realizar con el mÃ©todo del objeto mockeado y cual va a ser su salida.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-mi">1</span> <span class="tok-o">*</span> <span class="tok-n">assetsTagLib</span><span class="tok-o">.</span><span class="tok-na">image</span><span class="tok-o">(</span><span class="tok-n">_</span><span class="tok-o">)</span> <span class="tok-o">&gt;&gt;</span> <span class="tok-o">{</span> <span class="tok-n">value</span> <span class="tok-o">?</span> <span class="tok-s2">&quot;icontrue.png&quot;</span> <span class="tok-o">:</span> <span class="tok-s2">&quot;iconfalse.png&quot;</span> <span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Con esto estamos indicando que sÃ³lo se va a producir una llamada al mÃ©todo <em>image()</em> de la librerÃ­a de etiquetas <em>AssetsTagLib</em> y que ademÃ¡s, esta llamada se puede realizar con cualquier valor como primer (y Ãºnico) parÃ¡metro (esto lo conseguimos utilizando el <em>placeholder _)</em>. Si quisiÃ©ramos asegurarnos de que los parÃ¡metros pasados son los correctos podrÃ­amos tener algo asÃ­:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-mi">1</span> <span class="tok-o">*</span> <span class="tok-n">assetsTagLib</span><span class="tok-o">.</span><span class="tok-na">image</span><span class="tok-o">([</span><span class="tok-nl">src:</span><span class="tok-n">expectedOutput</span><span class="tok-o">])</span> <span class="tok-o">&gt;&gt;</span> <span class="tok-o">{</span> <span class="tok-n">value</span> <span class="tok-o">?</span> <span class="tok-s2">&quot;icontrue.png&quot;</span> <span class="tok-o">:</span> <span class="tok-s2">&quot;iconfalse.png&quot;</span> <span class="tok-o">}</span></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_algunas_anotaciones_interesantes">6.3.6. Algunas anotaciones interesantes</h4>
<div class="paragraph">
<p>Spock presenta una serie de anotaciones que nos servirÃ¡n de apoyo para realizar nuestros tests.</p>
</div>
<div class="sect4">
<h5 id="_ignore">Ignore</h5>
<div class="paragraph">
<p>Esta anotaciÃ³n se puede utilizar a nivel de mÃ©todo o a nivel de clase y como su nombre indica sirve para indicar al proceso que ejecuta los tests que el mÃ©todo en cuestiÃ³n o la clase no deben ser ejecutados.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-nd">@Ignore</span>
<span class="tok-kt">def</span> <span class="tok-s2">&quot;my feature&quot;</span><span class="tok-o">()</span> <span class="tok-o">{</span> <span class="tok-o">...</span> <span class="tok-o">}</span>

<span class="tok-nd">@Ignore</span>
<span class="tok-kd">class</span> <span class="tok-nc">MySpec</span> <span class="tok-kd">extends</span> <span class="tok-n">Specification</span> <span class="tok-o">{</span> <span class="tok-o">...</span> <span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Incluso podemos pasar como parÃ¡metro a la anotaciÃ³n un motivo por el cual este test no va a ser ejecutado.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-nd">@Ignore</span><span class="tok-o">(</span><span class="tok-n">reason</span> <span class="tok-o">=</span> <span class="tok-s2">&quot;TODO&quot;</span><span class="tok-o">)</span>
<span class="tok-kt">def</span> <span class="tok-s2">&quot;my feature&quot;</span><span class="tok-o">()</span> <span class="tok-o">{</span> <span class="tok-o">...</span> <span class="tok-o">}</span></code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_ignorerest">IgnoreRest</h5>
<div class="paragraph">
<p>Esta anotaciÃ³n sÃ³lo se puede especificar a nivel de mÃ©todo y le indicarÃ¡ al proceso encargado de ejecutar los tests que sÃ³lo los mÃ©todos que proporcionen esta anotaciÃ³n deben ser ejecutados.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-kt">def</span> <span class="tok-s2">&quot;I&#39;ll be ignored&quot;</span><span class="tok-o">()</span> <span class="tok-o">{</span> <span class="tok-o">...</span> <span class="tok-o">}</span>

<span class="tok-nd">@IgnoreRest</span>
<span class="tok-kt">def</span> <span class="tok-s2">&quot;I&#39;ll run&quot;</span><span class="tok-o">()</span> <span class="tok-o">{</span> <span class="tok-o">...</span> <span class="tok-o">}</span>

<span class="tok-kt">def</span> <span class="tok-s2">&quot;I&#39;ll also be ignored&quot;</span><span class="tok-o">()</span> <span class="tok-o">{</span> <span class="tok-o">...</span> <span class="tok-o">}</span></code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_ignoreif">IgnoreIf</h5>
<div class="paragraph">
<p>Esta anotaciÃ³n indica que el mÃ©todo anotado sÃ³lo se ejecutarÃ¡ si se cumplen una serie de condiciones.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-nd">@IgnoreIf</span><span class="tok-o">({</span> <span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">getProperty</span><span class="tok-o">(</span><span class="tok-s2">&quot;os.name&quot;</span><span class="tok-o">).</span><span class="tok-na">contains</span><span class="tok-o">(</span><span class="tok-s2">&quot;windows&quot;</span><span class="tok-o">)</span> <span class="tok-o">})</span>
<span class="tok-kt">def</span> <span class="tok-s2">&quot;I&#39;ll run everywhere but on Windows&quot;</span><span class="tok-o">()</span> <span class="tok-o">{</span> <span class="tok-o">...</span> <span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Para facilitar la comprensiÃ³n de la condiciÃ³n existen una serie de propiedades disponibles dentro del closure:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><em>sys</em> Un mapa con todas las propiedades del sistema</p>
</li>
<li>
<p><em>env</em> Un mapa con todas las variables de entorno</p>
</li>
<li>
<p><em>os</em> InformaciÃ³n acerca del sistema operativo (ver spock.util.environment.OperatingSystem)</p>
</li>
<li>
<p><em>jvm</em> InformaciÃ³n sobre la mÃ¡quina virtual de Java (ver spock.util.environment.Jvm)</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Con lo que el ejemplo anterior puede ser reescrito de la siguiente forma:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-nd">@IgnoreIf</span><span class="tok-o">({</span> <span class="tok-n">os</span><span class="tok-o">.</span><span class="tok-na">windows</span> <span class="tok-o">})</span>
<span class="tok-kt">def</span> <span class="tok-s2">&quot;I&#39;ll run everywhere but on Windows&quot;</span><span class="tok-o">()</span> <span class="tok-o">{</span> <span class="tok-o">...</span> <span class="tok-o">}</span></code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_requires">Requires</h5>
<div class="paragraph">
<p>Es la anotaciÃ³n contraria a <em>@IgnoreIf</em>. Los mÃ©todos anotados con esta anotaciÃ³n sÃ³lo se ejecutarÃ¡n bajo ciertas condiciones.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-nd">@Requires</span><span class="tok-o">({</span> <span class="tok-n">os</span><span class="tok-o">.</span><span class="tok-na">windows</span> <span class="tok-o">})</span>
<span class="tok-kt">def</span> <span class="tok-s2">&quot;I&#39;ll only run on Windows&quot;</span><span class="tok-o">()</span> <span class="tok-o">{</span> <span class="tok-o">...</span> <span class="tok-o">}</span></code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_stepwise">Stepwise</h5>
<div class="paragraph">
<p>Es conveniente que los tests no dependan unos de otros para su correcta ejecuciÃ³n, pero en ocasiones por rapidez, necesitaremos ejecutar los tests en un determinado orden. Esto lo podemos conseguir con la anotaciÃ³n <em>@Stepwise</em> que se utiliza a nivel de clase.</p>
</div>
<div class="paragraph">
<p>Imagina por ejemplo un test funcional con el que pretendemos comprobar que las 4 operaciones bÃ¡sicas sobre las tareas (creaciÃ³n, eliminaciÃ³n, actualizaciÃ³n y borrado) se ejecutan correctamente. Lo ideal serÃ­a crear 4 tests distintos, uno para cada operaciÃ³n, pero, Â¿quÃ© pasarÃ­a si pretendemos eliminar una tarea que todavÃ­a ni siquiera ha sido creada? En este ejemplo, es necesario que todos los tests se ejecuten en un determinado orden.</p>
</div>
</div>
<div class="sect4">
<h5 id="_timeout">Timeout</h5>
<div class="paragraph">
<p>La anotaciÃ³n <em>@Timeout</em> se puede aplicar a nivel de clase o a nivel de mÃ©todo y nos permitirÃ¡ especificar un tiempo mÃ¡ximo de ejecuciÃ³n de un test o de una clase de tests. La unidad por defecto serÃ¡ en segundos, pero vamos a poder modificar esta unidad.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-nd">@Timeout</span><span class="tok-o">(</span><span class="tok-mi">5</span><span class="tok-o">)</span>
<span class="tok-kt">def</span> <span class="tok-s2">&quot;I fail if I run for more than five seconds&quot;</span><span class="tok-o">()</span> <span class="tok-o">{</span> <span class="tok-o">...</span> <span class="tok-o">}</span>

<span class="tok-nd">@Timeout</span><span class="tok-o">(</span><span class="tok-n">value</span> <span class="tok-o">=</span> <span class="tok-mi">100</span><span class="tok-o">,</span> <span class="tok-n">unit</span> <span class="tok-o">=</span> <span class="tok-n">TimeUnit</span><span class="tok-o">.</span><span class="tok-na">MILLISECONDS</span><span class="tok-o">)</span>
<span class="tok-kt">def</span> <span class="tok-s2">&quot;I better be quick&quot;</span> <span class="tok-o">{</span> <span class="tok-o">...</span> <span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Si utilizamos la anotaciÃ³n a nivel de clase y a nivel de mÃ©todo, el mÃ©todo siempre sobreescribirÃ¡ a lo especificado a nivel de clase.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-nd">@Timeout</span><span class="tok-o">(</span><span class="tok-mi">10</span><span class="tok-o">)</span>
<span class="tok-kd">class</span> <span class="tok-nc">TimedSpec</span> <span class="tok-kd">extends</span> <span class="tok-n">Specification</span> <span class="tok-o">{</span>
  <span class="tok-kt">def</span> <span class="tok-s2">&quot;I fail after ten seconds&quot;</span><span class="tok-o">()</span> <span class="tok-o">{</span> <span class="tok-o">...</span> <span class="tok-o">}</span>
  <span class="tok-kt">def</span> <span class="tok-s2">&quot;Me too&quot;</span><span class="tok-o">()</span> <span class="tok-o">{</span> <span class="tok-o">...</span> <span class="tok-o">}</span>

  <span class="tok-nd">@Timeout</span><span class="tok-o">(</span><span class="tok-n">value</span> <span class="tok-o">=</span> <span class="tok-mi">250</span><span class="tok-o">,</span> <span class="tok-n">unit</span> <span class="tok-o">=</span> <span class="tok-n">MILLISECONDS</span><span class="tok-o">)</span>
  <span class="tok-kt">def</span> <span class="tok-s2">&quot;I fail much faster&quot;</span><span class="tok-o">()</span> <span class="tok-o">{</span> <span class="tok-o">...</span> <span class="tok-o">}</span>
<span class="tok-o">}</span></code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_confinemetaclasschanges">ConfineMetaClassChanges</h5>
<div class="paragraph">
<p>Utilizar metaprogramaciÃ³n puede ser muy beneficioso en nuestros tests pero al mismo tiempo, puede llegar a ser algo peligroso, ya que necesitamos asegurarnos que las clases que han sido metaprogramadas no conservan esa metaprogramaciÃ³n mÃ¡s allÃ¡ de donde sea imprescindible.</p>
</div>
<div class="paragraph">
<p>Para ello, bien asegurar de dejar la metaclase sin ninguna modificaciÃ³n con</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-n">Class</span><span class="tok-o">.</span><span class="tok-na">metaClass</span> <span class="tok-o">=</span> <span class="tok-kc">null</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>o bien, en los casos de los tests con Spock podemos utilizar la anotaciÃ³n <em>@ConfineMetaClassChanges</em>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-nd">@Stepwise</span>
<span class="tok-kd">class</span> <span class="tok-nc">FooSpec</span> <span class="tok-kd">extends</span> <span class="tok-n">Specification</span> <span class="tok-o">{</span>
  <span class="tok-nd">@ConfineMetaClassChanges</span>
  <span class="tok-kt">def</span> <span class="tok-s2">&quot;I run first&quot;</span><span class="tok-o">()</span> <span class="tok-o">{</span>
    <span class="tok-nl">when:</span>
    <span class="tok-n">String</span><span class="tok-o">.</span><span class="tok-na">metaClass</span><span class="tok-o">.</span><span class="tok-na">someMethod</span> <span class="tok-o">=</span> <span class="tok-o">{</span> <span class="tok-n">delegate</span> <span class="tok-o">}</span>

    <span class="tok-nl">then:</span>
    <span class="tok-n">String</span><span class="tok-o">.</span><span class="tok-na">metaClass</span><span class="tok-o">.</span><span class="tok-na">hasMetaMethod</span><span class="tok-o">(</span><span class="tok-s1">&#39;someMethod&#39;</span><span class="tok-o">)</span>
  <span class="tok-o">}</span>

  <span class="tok-kt">def</span> <span class="tok-s2">&quot;I run second&quot;</span><span class="tok-o">()</span> <span class="tok-o">{</span>
    <span class="tok-nl">when:</span>
    <span class="tok-s2">&quot;Foo&quot;</span><span class="tok-o">.</span><span class="tok-na">someMethod</span><span class="tok-o">()</span>

    <span class="tok-nl">then:</span>
    <span class="tok-n">thrown</span><span class="tok-o">(</span><span class="tok-n">MissingMethodException</span><span class="tok-o">)</span>
  <span class="tok-o">}</span>
<span class="tok-o">}</span></code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_title_y_narrative">Title y Narrative</h5>
<div class="paragraph">
<p>Podemos especificar lenguaje natural al nombre de nuestras clases con las anotaciones <em>@Title</em></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-nd">@Title</span><span class="tok-o">(</span><span class="tok-s2">&quot;This is easy to read&quot;</span><span class="tok-o">)</span>
<span class="tok-kd">class</span> <span class="tok-nc">ThisIsHarderToReadSpec</span> <span class="tok-kd">extends</span> <span class="tok-n">Specification</span> <span class="tok-o">{</span>
  <span class="tok-o">...</span>
<span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>y <em>@Narrative</em>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-nd">@Narrative</span><span class="tok-o">(</span><span class="tok-s2">&quot;&quot;&quot;&quot;</span>
<span class="tok-n">As</span> <span class="tok-n">a</span> <span class="tok-n">user</span>
<span class="tok-n">I</span> <span class="tok-n">want</span> <span class="tok-n">foo</span>
<span class="tok-n">So</span> <span class="tok-n">that</span> <span class="tok-n">bar</span>
<span class="tok-s2">&quot;&quot;</span><span class="tok-err">&quot;</span><span class="tok-o">)</span>
<span class="tok-kd">class</span> <span class="tok-nf">GiveTheUserFooSpec</span><span class="tok-o">()</span> <span class="tok-o">{</span> <span class="tok-o">...</span> <span class="tok-o">}</span></code></pre>
</div>
</div>
<div style="page-break-after: always;"></div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_ejercicios">6.4. Ejercicios</h3>
<div class="sect3">
<h4 id="_testeando_nuestra_propia_restricciÃ³n_0_25_puntos">6.4.1. Testeando nuestra propia restricciÃ³n (0.25 puntos)</h4>
<div class="paragraph">
<p>Realiza los tests necesarios para comprobar el correcto funcionamiento de la restricciÃ³n que creaste en sesiones anteriores para que la fecha de recordatorio nunca pueda ser posterior a la fecha de la propia tarea.</p>
</div>
<div class="paragraph">
<p>Este test o tests los vamos a escribir en la clase <em>TodoSpec.groovy</em>.</p>
</div>
</div>
<div class="sect3">
<h4 id="_testeando_la_clase_todocontroller_0_50_puntos">6.4.2. Testeando la clase TodoController (0.50 puntos)</h4>
<div class="paragraph">
<p>Escribe las modificaciones necesarias a la clase <em>TodoControllerSpec</em> para pasar los tests unitarios para la parte de scaffolding. Recuerda que estamos utilizando el servicio <em>todoService</em> en el controlador con lo que tendrÃ¡s que inyectar el servicio en concreto en el controlador.</p>
</div>
<div class="paragraph">
<p>AdemÃ¡s, realiza los tests unitarios necesarios para comprobar tambiÃ©n el funcionamiento de los mÃ©todos <em>listNextTodos(Integer days)</em> y <em>showListByCategory()</em> (la vista que nos permite que categorÃ­as queremos filtrar en el listado de las tareas).</p>
</div>
<div class="paragraph">
<p>Estos tests los vamos a escribir en la clase <em>TodoControllerSpec.groovy</em>.</p>
</div>
</div>
<div class="sect3">
<h4 id="_testeando_la_clase_todoservice_0_50_puntos">6.4.3. Testeando la clase TodoService (0.50 puntos)</h4>
<div class="paragraph">
<p>Para terminar con los tests, vamos a implementar un par de tests para testear el servicio <em>TodoService</em>. Estos dos mÃ©todos serÃ¡n <em>countNextTodos()</em> y <em>saveTodo()</em> (que creamos en la sesiÃ³n anterior).</p>
</div>
<div class="paragraph">
<p>El mÃ©todo <em>saveTodo()</em> se encarga de almacenar la nueva instancia pero ademÃ¡s os recuerdo que debÃ­a almacenar la fecha de realizaciÃ³n de la tarea si esta habÃ­a sido realizada.</p>
</div>
<div class="paragraph">
<p>Estos tests los vamos a escribir en la clase <em>TodoServiceSpec.groovy</em>.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="title">Importante</div>
<div class="paragraph">
<p>Es absolutamente necesario que cuando presenteis el proyecto todos los tests se pasen correctamente. AsÃ­ que antes de entregar el proyecto final, recuerda ejecutar el comando <em>grails test-app unit:</em> para comprobar que tus tests se ejecutan correctamente. Es decir, asÃ­ deberÃ­a terminar vuestro proyecto antes de ser entregado.</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="images/grails06/allgreentests.png" alt="Todos los tests en verde" width="50%">
</div>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
</div>
</div>
</div>
<div id="footer">
<div id="footer-text">
Last updated 2015-10-05 20:14:58 CEST
</div>
</div>
</body>
</html>