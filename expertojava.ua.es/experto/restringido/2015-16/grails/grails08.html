<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<!--[if IE]><meta http-equiv="X-UA-Compatible" content="IE=edge"><![endif]-->
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 1.5.2">
<meta name="author" content="Fran García">
<title>Grails</title>
<style>/*! normalize.css v2.1.2 | MIT License | git.io/normalize */
/* ========================================================================== HTML5 display definitions ========================================================================== */
/** Correct `block` display not defined in IE 8/9. */
article, aside, details, figcaption, figure, footer, header, hgroup, main, nav, section, summary { display: block; }

/** Correct `inline-block` display not defined in IE 8/9. */
audio, canvas, video { display: inline-block; }

/** Prevent modern browsers from displaying `audio` without controls. Remove excess height in iOS 5 devices. */
audio:not([controls]) { display: none; height: 0; }

/** Address `[hidden]` styling not present in IE 8/9. Hide the `template` element in IE, Safari, and Firefox < 22. */
[hidden], template { display: none; }

script { display: none !important; }

/* ========================================================================== Base ========================================================================== */
/** 1. Set default font family to sans-serif. 2. Prevent iOS text size adjust after orientation change, without disabling user zoom. */
html { font-family: sans-serif; /* 1 */ -ms-text-size-adjust: 100%; /* 2 */ -webkit-text-size-adjust: 100%; /* 2 */ }

/** Remove default margin. */
body { margin: 0; }

/* ========================================================================== Links ========================================================================== */
/** Remove the gray background color from active links in IE 10. */
a { background: transparent; }

/** Address `outline` inconsistency between Chrome and other browsers. */
a:focus { outline: thin dotted; }

/** Improve readability when focused and also mouse hovered in all browsers. */
a:active, a:hover { outline: 0; }

/* ========================================================================== Typography ========================================================================== */
/** Address variable `h1` font-size and margin within `section` and `article` contexts in Firefox 4+, Safari 5, and Chrome. */
h1 { font-size: 2em; margin: 0.67em 0; }

/** Address styling not present in IE 8/9, Safari 5, and Chrome. */
abbr[title] { border-bottom: 1px dotted; }

/** Address style set to `bolder` in Firefox 4+, Safari 5, and Chrome. */
b, strong { font-weight: bold; }

/** Address styling not present in Safari 5 and Chrome. */
dfn { font-style: italic; }

/** Address differences between Firefox and other browsers. */
hr { -moz-box-sizing: content-box; box-sizing: content-box; height: 0; }

/** Address styling not present in IE 8/9. */
mark { background: #ff0; color: #000; }

/** Correct font family set oddly in Safari 5 and Chrome. */
code, kbd, pre, samp { font-family: monospace, serif; font-size: 1em; }

/** Improve readability of pre-formatted text in all browsers. */
pre { white-space: pre-wrap; }

/** Set consistent quote types. */
q { quotes: "\201C" "\201D" "\2018" "\2019"; }

/** Address inconsistent and variable font size in all browsers. */
small { font-size: 80%; }

/** Prevent `sub` and `sup` affecting `line-height` in all browsers. */
sub, sup { font-size: 75%; line-height: 0; position: relative; vertical-align: baseline; }

sup { top: -0.5em; }

sub { bottom: -0.25em; }

/* ========================================================================== Embedded content ========================================================================== */
/** Remove border when inside `a` element in IE 8/9. */
img { border: 0; }

/** Correct overflow displayed oddly in IE 9. */
svg:not(:root) { overflow: hidden; }

/* ========================================================================== Figures ========================================================================== */
/** Address margin not present in IE 8/9 and Safari 5. */
figure { margin: 0; }

/* ========================================================================== Forms ========================================================================== */
/** Define consistent border, margin, and padding. */
fieldset { border: 1px solid #c0c0c0; margin: 0 2px; padding: 0.35em 0.625em 0.75em; }

/** 1. Correct `color` not being inherited in IE 8/9. 2. Remove padding so people aren't caught out if they zero out fieldsets. */
legend { border: 0; /* 1 */ padding: 0; /* 2 */ }

/** 1. Correct font family not being inherited in all browsers. 2. Correct font size not being inherited in all browsers. 3. Address margins set differently in Firefox 4+, Safari 5, and Chrome. */
button, input, select, textarea { font-family: inherit; /* 1 */ font-size: 100%; /* 2 */ margin: 0; /* 3 */ }

/** Address Firefox 4+ setting `line-height` on `input` using `!important` in the UA stylesheet. */
button, input { line-height: normal; }

/** Address inconsistent `text-transform` inheritance for `button` and `select`. All other form control elements do not inherit `text-transform` values. Correct `button` style inheritance in Chrome, Safari 5+, and IE 8+. Correct `select` style inheritance in Firefox 4+ and Opera. */
button, select { text-transform: none; }

/** 1. Avoid the WebKit bug in Android 4.0.* where (2) destroys native `audio` and `video` controls. 2. Correct inability to style clickable `input` types in iOS. 3. Improve usability and consistency of cursor style between image-type `input` and others. */
button, html input[type="button"], input[type="reset"], input[type="submit"] { -webkit-appearance: button; /* 2 */ cursor: pointer; /* 3 */ }

/** Re-set default cursor for disabled elements. */
button[disabled], html input[disabled] { cursor: default; }

/** 1. Address box sizing set to `content-box` in IE 8/9. 2. Remove excess padding in IE 8/9. */
input[type="checkbox"], input[type="radio"] { box-sizing: border-box; /* 1 */ padding: 0; /* 2 */ }

/** 1. Address `appearance` set to `searchfield` in Safari 5 and Chrome. 2. Address `box-sizing` set to `border-box` in Safari 5 and Chrome (include `-moz` to future-proof). */
input[type="search"] { -webkit-appearance: textfield; /* 1 */ -moz-box-sizing: content-box; -webkit-box-sizing: content-box; /* 2 */ box-sizing: content-box; }

/** Remove inner padding and search cancel button in Safari 5 and Chrome on OS X. */
input[type="search"]::-webkit-search-cancel-button, input[type="search"]::-webkit-search-decoration { -webkit-appearance: none; }

/** Remove inner padding and border in Firefox 4+. */
button::-moz-focus-inner, input::-moz-focus-inner { border: 0; padding: 0; }

/** 1. Remove default vertical scrollbar in IE 8/9. 2. Improve readability and alignment in all browsers. */
textarea { overflow: auto; /* 1 */ vertical-align: top; /* 2 */ }

/* ========================================================================== Tables ========================================================================== */
/** Remove most spacing between table cells. */
table { border-collapse: collapse; border-spacing: 0; }

meta.foundation-mq-small { font-family: "only screen and (min-width: 768px)"; width: 768px; }

meta.foundation-mq-medium { font-family: "only screen and (min-width:1280px)"; width: 1280px; }

meta.foundation-mq-large { font-family: "only screen and (min-width:1440px)"; width: 1440px; }

*, *:before, *:after { -moz-box-sizing: border-box; -webkit-box-sizing: border-box; box-sizing: border-box; }

html, body { font-size: 97%; }

body { background: white; color: #222222; padding: 0; margin: 0; font-family: "Helvetica Neue", "Helvetica", Helvetica, Arial, sans-serif; font-weight: normal; font-style: normal; line-height: 1; position: relative; cursor: auto; }

a:hover { cursor: pointer; }

img, object, embed { max-width: 100%; height: auto; }

object, embed { height: 100%; }

img { -ms-interpolation-mode: bicubic; }

#map_canvas img, #map_canvas embed, #map_canvas object, .map_canvas img, .map_canvas embed, .map_canvas object { max-width: none !important; }

.left { float: left !important; }

.right { float: right !important; }

.text-left { text-align: left !important; }

.text-right { text-align: right !important; }

.text-center { text-align: center !important; }

.text-justify { text-align: justify !important; }

.hide { display: none; }

.antialiased, body { -webkit-font-smoothing: antialiased; }

img { display: inline-block; vertical-align: middle; }

textarea { height: auto; min-height: 50px; }

select { width: 100%; }

p.lead, .paragraph.lead > p, #preamble > .sectionbody > .paragraph:first-of-type p { font-size: 1.21875em; line-height: 1.6; }

.subheader, .admonitionblock td.content > .title, .audioblock > .title, .exampleblock > .title, .imageblock > .title, .listingblock > .title, .literalblock > .title, .stemblock > .title, .openblock > .title, .paragraph > .title, .quoteblock > .title, table.tableblock > .title, .verseblock > .title, .videoblock > .title, .dlist > .title, .olist > .title, .ulist > .title, .qlist > .title, .hdlist > .title { line-height: 1.4; color: #6f6f6f; font-weight: 300; margin-top: 0.2em; margin-bottom: 0.5em; }

/* Typography resets */
div, dl, dt, dd, ul, ol, li, h1, h2, h3, #toctitle, .sidebarblock > .content > .title, h4, h5, h6, pre, form, p, blockquote, th, td { margin: 0; padding: 0; direction: ltr; }

/* Default Link Styles */
a { color: #1164be; text-decoration: none; line-height: inherit; }
a img { border: none; }

/* Default paragraph styles */
p { font-family: inherit; font-weight: normal; font-size: 1em; line-height: 1.4; margin-bottom: 1em; text-rendering: optimizeLegibility; }
p aside { font-size: 0.875em; line-height: 1.35; font-style: italic; }

/* Default header styles */
h1, h2, h3, #toctitle, .sidebarblock > .content > .title, h4, h5, h6 { font-family: "Helvetica Neue", "Helvetica", Helvetica, Arial, sans-serif; font-weight: bold; font-style: normal; color: #1c355e; text-rendering: optimizeLegibility; margin-top: 1em; margin-bottom: 0.5em; line-height: 1.2125em; }
h1 small, h2 small, h3 small, #toctitle small, .sidebarblock > .content > .title small, h4 small, h5 small, h6 small { font-size: 60%; color: #6f6f6f; line-height: 0; }

h1 { font-size: 2.125em; }

h2 { font-size: 1.6875em; }

h3, #toctitle, .sidebarblock > .content > .title { font-size: 1.375em; }

h4 { font-size: 1.125em; }

h5 { font-size: 1.125em; }

h6 { font-size: 1em; }

hr { border: solid #dddddd; border-width: 1px 0 0; clear: both; margin: 1.25em 0 1.1875em; height: 0; }

/* Helpful Typography Defaults */
em, i { font-style: italic; line-height: inherit; }

strong, b { font-weight: bold; line-height: inherit; }

small { font-size: 60%; line-height: inherit; }

code { font-family: Consolas, "Liberation Mono", Courier, monospace; font-weight: bold; }

/* Lists */
ul, ol, dl { font-size: 1em; line-height: 1.4; margin-bottom: 1.25em; list-style-position: outside; font-family: inherit; }

ul, ol { margin-left: 2.5em; }
ul.no-bullet, ol.no-bullet { margin-left: 1.5em; }

/* Unordered Lists */
ul li ul, ul li ol { margin-left: 1.25em; margin-bottom: 0; font-size: 1em; /* Override nested font-size change */ }
ul.square li ul, ul.circle li ul, ul.disc li ul { list-style: inherit; }
ul.square { list-style-type: square; }
ul.circle { list-style-type: circle; }
ul.disc { list-style-type: disc; }
ul.no-bullet { list-style: none; }

/* Ordered Lists */
ol li ul, ol li ol { margin-left: 1.25em; margin-bottom: 0; }

/* Definition Lists */
dl dt { margin-bottom: 0.3125em; font-weight: bold; }
dl dd { margin-bottom: 1.25em; }

/* Abbreviations */
abbr, acronym { text-transform: uppercase; font-size: 90%; color: #222222; border-bottom: 1px dotted #dddddd; cursor: help; }

abbr { text-transform: none; }

/* Blockquotes */
blockquote { margin: 0 0 1.25em; padding: 0.5625em 1.25em 0 1.1875em; border-left: 1px solid #dddddd; }
blockquote cite { display: block; font-size: 0.8125em; color: #555555; }
blockquote cite:before { content: "\2014 \0020"; }
blockquote cite a, blockquote cite a:visited { color: #555555; }

blockquote, blockquote p { line-height: 1.6; color: #6f6f6f; }

/* Microformats */
.vcard { display: inline-block; margin: 0 0 1.25em 0; border: 1px solid #dddddd; padding: 0.625em 0.75em; }
.vcard li { margin: 0; display: block; }
.vcard .fn { font-weight: bold; font-size: 0.9375em; }

.vevent .summary { font-weight: bold; }
.vevent abbr { cursor: auto; text-decoration: none; font-weight: bold; border: none; padding: 0 0.0625em; }

/*@media only screen and (min-width: 768px) { h1, h2, h3, #toctitle, .sidebarblock > .content > .title, h4, h5, h6 { line-height: 1.4; }
  h1 { font-size: 2.75em; }
  h2 { font-size: 2.3125em; }
  h3, #toctitle, .sidebarblock > .content > .title { font-size: 1.6875em; }
  h4 { font-size: 1.4375em; } }*/
/* Tables */
table { background: white; margin-bottom: 1.25em; border: solid 1px #dddddd; }
table thead, table tfoot { background: whitesmoke; font-weight: bold; }
table thead tr th, table thead tr td, table tfoot tr th, table tfoot tr td { padding: 0.5em 0.625em 0.625em; font-size: inherit; color: #222222; text-align: left; }
table tr th, table tr td { padding: 0.5625em 0.625em; font-size: inherit; color: #222222; }
table tr.even, table tr.alt, table tr:nth-of-type(even) { background: #f9f9f9; }
table thead tr th, table tfoot tr th, table tbody tr td, table tr td, table tfoot tr td { display: table-cell; line-height: 1.4; }

h1, h2, h3, #toctitle, .sidebarblock > .content > .title, h4, h5, h6 { line-height: 1.4; border-bottom: 1px solid #dddddd }

.clearfix:before, .clearfix:after, .float-group:before, .float-group:after { content: " "; display: table; }
.clearfix:after, .float-group:after { clear: both; }

*:not(pre) > code { font-size: inherit; font-style: normal !important; letter-spacing: 0; padding: 3px 2px 1px 2px; background-color: #eeeeee; border: 1px solid #dddddd; -webkit-border-radius: 0; border-radius: 0; line-height: inherit; font-weight: normal; }

pre, pre > code { line-height: 1.4; color: black; font-family: monospace, serif; font-weight: normal; }

.keyseq { color: #555555; }

kbd { display: inline-block; color: #222222; font-size: 0.75em; line-height: 1.4; background-color: #f7f7f7; border: 1px solid #ccc; -webkit-border-radius: 3px; border-radius: 3px; -webkit-box-shadow: 0 1px 0 rgba(0, 0, 0, 0.2), 0 0 0 0.1em white inset; box-shadow: 0 1px 0 rgba(0, 0, 0, 0.2), 0 0 0 0.1em white inset; margin: -0.15em 0.15em 0 0.15em; padding: 0.2em 0.6em 0.2em 0.5em; vertical-align: middle; white-space: nowrap; }

.keyseq kbd:first-child { margin-left: 0; }

.keyseq kbd:last-child { margin-right: 0; }

.menuseq, .menu { color: #090909; }

b.button:before, b.button:after { position: relative; top: -1px; font-weight: normal; }

b.button:before { content: "["; padding: 0 3px 0 2px; }

b.button:after { content: "]"; padding: 0 2px 0 3px; }

#header, #content, #footnotes, #footer { width: 100%; margin-left: auto; margin-right: auto; margin-top: 0; margin-bottom: 0; max-width: 62.5em; *zoom: 1; position: relative; padding-left: 0.9375em; padding-right: 0.9375em; }
#header:before, #header:after, #content:before, #content:after, #footnotes:before, #footnotes:after, #footer:before, #footer:after { content: " "; display: table; }
#header:after, #content:after, #footnotes:after, #footer:after { clear: both; }

#content { margin-top: 1.25em; }

#content:before { content: none; }

#header > h1:first-child { color: black; margin-top: 2.25rem; margin-bottom: 0; }
#header > h1:first-child + #toc { margin-top: 8px; border-top: 1px solid #dddddd; }
#header > h1:only-child, body.toc2 #header > h1:nth-last-child(2) { border-bottom: 1px solid #dddddd; padding-bottom: 8px; }
#header .details { border-bottom: 1px solid #dddddd; line-height: 1.45; padding-top: 0.25em; padding-bottom: 0.25em; padding-left: 0.25em; color: #555555; display: -ms-flexbox; display: -webkit-flex; display: flex; -ms-flex-flow: row wrap; -webkit-flex-flow: row wrap; flex-flow: row wrap; }
#header .details span:first-child { margin-left: -0.125em; }
#header .details span.email a { color: #6f6f6f; }
#header .details br { display: none; }
#header .details br + span:before { content: "\00a0\2013\00a0"; }
#header .details br + span.author:before { content: "\00a0\22c5\00a0"; color: #6f6f6f; }
#header .details br + span#revremark:before { content: "\00a0|\00a0"; }
#header #revnumber { text-transform: capitalize; }
#header #revnumber:after { content: "\00a0"; }

#content > h1:first-child:not([class]) { color: black; border-bottom: 1px solid #dddddd; padding-bottom: 8px; margin-top: 0; padding-top: 1rem; margin-bottom: 1.25rem; }

#floating {
  position: fixed;
  z-index: 1000;
  padding: 0.5em;
  right: 0;
  top: 0;
  background: white;
  box-shadow: 0 0 1em #777777;
  -webkit-box-shadow: 0 0 1em #777777;
  -moz-box-shadow: 0 0 1em #777777;
  -webkit-border-bottom-left-radius: 5px;
  -moz-border-radius-bottomleft: 5px;
  max-height: 80%;
  overflow: auto;
}

#floating #full { display: none; } /* Hide the full TOC by default */

#floating:hover #full{
  display: block; /* Show it on hover */
}


#toc { border-bottom: 1px solid #dddddd; padding-bottom: 0.5em; }
#toc > ul { margin-left: 0.125em; }
#toc ul.sectlevel0 > li > a { font-style: italic; }
#toc ul.sectlevel0 ul.sectlevel1 { margin: 0.5em 0; }
#toc ul { font-family: "Helvetica Neue", "Helvetica", Helvetica, Arial, sans-serif; list-style-type: none; }
#toc a { text-decoration: none; }
#toc a:active { text-decoration: underline; }

#toctitle { color: #6f6f6f; font-size: 1.2em; }

@media only screen and (min-width: 768px) { #toctitle { font-size: 1.375em; }
  body.toc2 { padding-left: 15em; padding-right: 0; }
  #toc.toc2 { margin-top: 0 !important; background-color: #f2f2f2; position: fixed; width: 15em; left: 0; top: 0; border-right: 1px solid #dddddd; border-top-width: 0 !important; border-bottom-width: 0 !important; z-index: 1000; padding: 1.25em 1em; height: 100%; overflow: auto; }
  #toc.toc2 #toctitle { margin-top: 0; font-size: 1.2em; }
  #toc.toc2 > ul { font-size: 0.9em; margin-bottom: 0; }
  #toc.toc2 ul ul { margin-left: 0; padding-left: 1em; }
  #toc.toc2 ul.sectlevel0 ul.sectlevel1 { padding-left: 0; margin-top: 0.5em; margin-bottom: 0.5em; }
  body.toc2.toc-right { padding-left: 0; padding-right: 15em; }
  body.toc2.toc-right #toc.toc2 { border-right-width: 0; border-left: 1px solid #dddddd; left: auto; right: 0; } }
@media only screen and (min-width: 1280px) { body.toc2 { padding-left: 20em; padding-right: 0; }
  #toc.toc2 { width: 20em; }
  #toc.toc2 #toctitle { font-size: 1.375em; }
  #toc.toc2 > ul { font-size: 0.95em; }
  #toc.toc2 ul ul { padding-left: 1.25em; }
  body.toc2.toc-right { padding-left: 0; padding-right: 20em; } }
#content #toc { border-style: solid; border-width: 1px; border-color: #d9d9d9; margin-bottom: 1.25em; padding: 1.25em; background: #f2f2f2; -webkit-border-radius: 0; border-radius: 0; }
#content #toc > :first-child { margin-top: 0; }
#content #toc > :last-child { margin-bottom: 0; }

#footer { max-width: 100%; background-color: #222222; padding: 1.25em; }

#footer-text { color: #dddddd; line-height: 1.44; }

.sect1 { padding-bottom: 0.625em; }

@media only screen and (min-width: 768px) { .sect1 { padding-bottom: 1.25em; } }
.sect1 + .sect1 { border-top: 1px solid #dddddd; }

#content h1 > a.anchor, h2 > a.anchor, h3 > a.anchor, #toctitle > a.anchor, .sidebarblock > .content > .title > a.anchor, h4 > a.anchor, h5 > a.anchor, h6 > a.anchor { position: absolute; z-index: 1001; width: 1.5ex; margin-left: -1.5ex; display: block; text-decoration: none !important; visibility: hidden; text-align: center; font-weight: normal; }
#content h1 > a.anchor:before, h2 > a.anchor:before, h3 > a.anchor:before, #toctitle > a.anchor:before, .sidebarblock > .content > .title > a.anchor:before, h4 > a.anchor:before, h5 > a.anchor:before, h6 > a.anchor:before { content: "\00A7"; font-size: 0.85em; display: block; padding-top: 0.1em; }
#content h1:hover > a.anchor, #content h1 > a.anchor:hover, h2:hover > a.anchor, h2 > a.anchor:hover, h3:hover > a.anchor, #toctitle:hover > a.anchor, .sidebarblock > .content > .title:hover > a.anchor, h3 > a.anchor:hover, #toctitle > a.anchor:hover, .sidebarblock > .content > .title > a.anchor:hover, h4:hover > a.anchor, h4 > a.anchor:hover, h5:hover > a.anchor, h5 > a.anchor:hover, h6:hover > a.anchor, h6 > a.anchor:hover { visibility: visible; }
#content h1 > a.link, h2 > a.link, h3 > a.link, #toctitle > a.link, .sidebarblock > .content > .title > a.link, h4 > a.link, h5 > a.link, h6 > a.link { color: #222222; text-decoration: none; }
#content h1 > a.link:hover, h2 > a.link:hover, h3 > a.link:hover, #toctitle > a.link:hover, .sidebarblock > .content > .title > a.link:hover, h4 > a.link:hover, h5 > a.link:hover, h6 > a.link:hover { color: #151515; }

.audioblock, .imageblock, .literalblock, .listingblock, .stemblock, .videoblock { margin-bottom: 1.25em; }

.admonitionblock td.content > .title, .audioblock > .title, .exampleblock > .title, .imageblock > .title, .listingblock > .title, .literalblock > .title, .stemblock > .title, .openblock > .title, .paragraph > .title, .quoteblock > .title, table.tableblock > .title, .verseblock > .title, .videoblock > .title, .dlist > .title, .olist > .title, .ulist > .title, .qlist > .title, .hdlist > .title { text-rendering: optimizeLegibility; text-align: left; }

table.tableblock > caption.title { white-space: nowrap; overflow: visible; max-width: 0; }

.paragraph.lead > p, #preamble > .sectionbody > .paragraph:first-of-type p { color: black; }

table.tableblock #preamble > .sectionbody > .paragraph:first-of-type p { font-size: inherit; }

.admonitionblock > table { border-collapse: separate; border: 0; background: none; width: 100%; }
.admonitionblock > table td.icon { text-align: center; width: 80px; }
.admonitionblock > table td.icon img { max-width: none; }
.admonitionblock > table td.icon .title { font-weight: bold; font-family: "Helvetica Neue", "Helvetica", Helvetica, Arial, sans-serif; text-transform: uppercase; }
.admonitionblock > table td.content { padding-left: 1.125em; padding-right: 1.25em; border-left: 1px solid #dddddd; color: #555555; }
.admonitionblock > table td.content > :last-child > :last-child { margin-bottom: 0; }

.exampleblock > .content { border-style: solid; border-width: 1px; border-color: #e6e6e6; margin-bottom: 1.25em; padding: 1.25em; background: white; -webkit-border-radius: 0; border-radius: 0; }
.exampleblock > .content > :first-child { margin-top: 0; }
.exampleblock > .content > :last-child { margin-bottom: 0; }

.sidebarblock { border-style: solid; border-width: 1px; border-color: #d9d9d9; margin-bottom: 1.25em; padding: 1.25em; background: #f2f2f2; -webkit-border-radius: 0; border-radius: 0; }
.sidebarblock > :first-child { margin-top: 0; }
.sidebarblock > :last-child { margin-bottom: 0; }
.sidebarblock > .content > .title { color: #6f6f6f; margin-top: 0; }

.exampleblock > .content > :last-child > :last-child, .exampleblock > .content .olist > ol > li:last-child > :last-child, .exampleblock > .content .ulist > ul > li:last-child > :last-child, .exampleblock > .content .qlist > ol > li:last-child > :last-child, .sidebarblock > .content > :last-child > :last-child, .sidebarblock > .content .olist > ol > li:last-child > :last-child, .sidebarblock > .content .ulist > ul > li:last-child > :last-child, .sidebarblock > .content .qlist > ol > li:last-child > :last-child { margin-bottom: 0; }

.literalblock pre, .listingblock pre:not(.highlight), .listingblock pre[class="highlight"], .listingblock pre[class^="highlight "], .listingblock pre.CodeRay, .listingblock pre.prettyprint { background: #eeeeee; }
.sidebarblock .literalblock pre, .sidebarblock .listingblock pre:not(.highlight), .sidebarblock .listingblock pre[class="highlight"], .sidebarblock .listingblock pre[class^="highlight "], .sidebarblock .listingblock pre.CodeRay, .sidebarblock .listingblock pre.prettyprint { background: #f2f1f1; }

.literalblock pre, .literalblock pre[class], .listingblock pre, .listingblock pre[class] { border: 1px solid #cccccc; -webkit-border-radius: 0; border-radius: 0; word-wrap: break-word; padding: 0.8em 0.8em 0.65em 0.8em; font-size: 0.8125em; }
.literalblock pre.nowrap, .literalblock pre[class].nowrap, .listingblock pre.nowrap, .listingblock pre[class].nowrap { overflow-x: auto; white-space: pre; word-wrap: normal; }
@media only screen and (min-width: 768px) { .literalblock pre, .literalblock pre[class], .listingblock pre, .listingblock pre[class] { font-size: 0.90625em; } }
@media only screen and (min-width: 1280px) { .literalblock pre, .literalblock pre[class], .listingblock pre, .listingblock pre[class] { font-size: 1em; } }

.literalblock.output pre { color: #eeeeee; background-color: black; }

.listingblock pre.highlightjs { padding: 0; }
.listingblock pre.highlightjs > code { padding: 0.8em 0.8em 0.65em 0.8em; -webkit-border-radius: 0; border-radius: 0; }

.listingblock > .content { position: relative; }

.listingblock code[data-lang]:before { display: none; content: attr(data-lang); position: absolute; font-size: 0.75em; top: 0.425rem; right: 0.5rem; line-height: 1; text-transform: uppercase; color: #999; }

.listingblock:hover code[data-lang]:before { display: block; }

.listingblock.terminal pre .command:before { content: attr(data-prompt); padding-right: 0.5em; color: #999; }

.listingblock.terminal pre .command:not([data-prompt]):before { content: "$"; }

table.pyhltable { border-collapse: separate; border: 0; margin-bottom: 0; background: none; }

table.pyhltable td { vertical-align: top; padding-top: 0; padding-bottom: 0; }

table.pyhltable td.code { padding-left: .75em; padding-right: 0; }

pre.pygments .lineno, table.pyhltable td:not(.code) { color: #999; padding-left: 0; padding-right: .5em; border-right: 1px solid #dddddd; }

pre.pygments .lineno { display: inline-block; margin-right: .25em; }

table.pyhltable .linenodiv { background: none !important; padding-right: 0 !important; }

.quoteblock { margin: 0 1em 1.25em 1.5em; display: table; }
.quoteblock > .title { margin-left: -1.5em; margin-bottom: 0.75em; }
.quoteblock blockquote, .quoteblock blockquote p { color: #6f6f6f; font-size: 1.15rem; line-height: 1.75; word-spacing: 0.1em; letter-spacing: 0; font-style: italic; text-align: justify; }
.quoteblock blockquote { margin: 0; padding: 0; border: 0; }
.quoteblock blockquote:before { content: "\201c"; float: left; font-size: 2.75em; font-weight: bold; line-height: 0.6em; margin-left: -0.6em; color: #6f6f6f; text-shadow: 0 1px 2px rgba(0, 0, 0, 0.1); }
.quoteblock blockquote > .paragraph:last-child p { margin-bottom: 0; }
.quoteblock .attribution { margin-top: 0.5em; margin-right: 0.5ex; text-align: right; }
.quoteblock .quoteblock { margin-left: 0; margin-right: 0; padding: 0.5em 0; border-left: 3px solid #555555; }
.quoteblock .quoteblock blockquote { padding: 0 0 0 0.75em; }
.quoteblock .quoteblock blockquote:before { display: none; }

.verseblock { margin: 0 1em 1.25em 1em; }
.verseblock pre { font-family: "Open Sans", "DejaVu Sans", sans; font-size: 1.15rem; color: #6f6f6f; font-weight: 300; text-rendering: optimizeLegibility; }
.verseblock pre strong { font-weight: 400; }
.verseblock .attribution { margin-top: 1.25rem; margin-left: 0.5ex; }

.quoteblock .attribution, .verseblock .attribution { font-size: 0.8125em; line-height: 1.45; font-style: italic; }
.quoteblock .attribution br, .verseblock .attribution br { display: none; }
.quoteblock .attribution cite, .verseblock .attribution cite { display: block; letter-spacing: -0.05em; color: #555555; }

.quoteblock.abstract { margin: 0 0 1.25em 0; display: block; }
.quoteblock.abstract blockquote, .quoteblock.abstract blockquote p { text-align: left; word-spacing: 0; }
.quoteblock.abstract blockquote:before, .quoteblock.abstract blockquote p:first-of-type:before { display: none; }

table.tableblock { max-width: 100%; border-collapse: separate; }
table.tableblock td > .paragraph:last-child p > p:last-child, table.tableblock th > p:last-child, table.tableblock td > p:last-child { margin-bottom: 0; }

table.spread { width: 100%; }

table.tableblock, th.tableblock, td.tableblock { border: 0 solid #dddddd; }

table.grid-all th.tableblock, table.grid-all td.tableblock { border-width: 0 1px 1px 0; }

table.grid-all tfoot > tr > th.tableblock, table.grid-all tfoot > tr > td.tableblock { border-width: 1px 1px 0 0; }

table.grid-cols th.tableblock, table.grid-cols td.tableblock { border-width: 0 1px 0 0; }

table.grid-all * > tr > .tableblock:last-child, table.grid-cols * > tr > .tableblock:last-child { border-right-width: 0; }

table.grid-rows th.tableblock, table.grid-rows td.tableblock { border-width: 0 0 1px 0; }

table.grid-all tbody > tr:last-child > th.tableblock, table.grid-all tbody > tr:last-child > td.tableblock, table.grid-all thead:last-child > tr > th.tableblock, table.grid-rows tbody > tr:last-child > th.tableblock, table.grid-rows tbody > tr:last-child > td.tableblock, table.grid-rows thead:last-child > tr > th.tableblock { border-bottom-width: 0; }

table.grid-rows tfoot > tr > th.tableblock, table.grid-rows tfoot > tr > td.tableblock { border-width: 1px 0 0 0; }

table.frame-all { border-width: 1px; }

table.frame-sides { border-width: 0 1px; }

table.frame-topbot { border-width: 1px 0; }

th.halign-left, td.halign-left { text-align: left; }

th.halign-right, td.halign-right { text-align: right; }

th.halign-center, td.halign-center { text-align: center; }

th.valign-top, td.valign-top { vertical-align: top; }

th.valign-bottom, td.valign-bottom { vertical-align: bottom; }

th.valign-middle, td.valign-middle { vertical-align: middle; }

table thead th, table tfoot th { font-weight: bold; }

tbody tr th { display: table-cell; line-height: 1.4; background: whitesmoke; }

tbody tr th, tbody tr th p, tfoot tr th, tfoot tr th p { color: #222222; font-weight: bold; }

p.tableblock > code:only-child { background: none; padding: 0; }

p.tableblock { font-size: 1em; }

td > div.verse { white-space: pre; }

ol { margin-left: 2.5em; }

ul li ol { margin-left: 1.5em; }

dl dd { margin-left: 1.125em; }

dl dd:last-child, dl dd:last-child > :last-child { margin-bottom: 0; }

ol > li p, ul > li p, ul dd, ol dd, .olist .olist, .ulist .ulist, .ulist .olist, .olist .ulist { margin-bottom: 0.625em; }

ul.unstyled, ol.unnumbered, ul.checklist, ul.none { list-style-type: none; }

ul.unstyled, ol.unnumbered, ul.checklist { margin-left: 0.625em; }

ul.checklist li > p:first-child > .fa-check-square-o:first-child, ul.checklist li > p:first-child > input[type="checkbox"]:first-child { margin-right: 0.25em; }

ul.checklist li > p:first-child > input[type="checkbox"]:first-child { position: relative; top: 1px; }

ul.inline { margin: 0 auto 0.625em auto; margin-left: -1.375em; margin-right: 0; padding: 0; list-style: none; overflow: hidden; }
ul.inline > li { list-style: none; float: left; margin-left: 1.375em; display: block; }
ul.inline > li > * { display: block; }

.unstyled dl dt { font-weight: normal; font-style: normal; }

ol.arabic { list-style-type: decimal; }

ol.decimal { list-style-type: decimal-leading-zero; }

ol.loweralpha { list-style-type: lower-alpha; }

ol.upperalpha { list-style-type: upper-alpha; }

ol.lowerroman { list-style-type: lower-roman; }

ol.upperroman { list-style-type: upper-roman; }

ol.lowergreek { list-style-type: lower-greek; }

.hdlist > table, .colist > table { border: 0; background: none; }
.hdlist > table > tbody > tr, .colist > table > tbody > tr { background: none; }

td.hdlist1 { padding-right: .75em; font-weight: bold; }

td.hdlist1, td.hdlist2 { vertical-align: top; }

.literalblock + .colist, .listingblock + .colist { margin-top: -0.5em; }

.colist > table tr > td:first-of-type { padding: 0 0.75em; line-height: 1; }
.colist > table tr > td:last-of-type { padding: 0.25em 0; }

.thumb, .th { line-height: 0; display: inline-block; border: solid 4px white; -webkit-box-shadow: 0 0 0 1px #dddddd; box-shadow: 0 0 0 1px #dddddd; }

.imageblock.left, .imageblock[style*="float: left"] { margin: 0.25em 0.625em 1.25em 0; }
.imageblock.right, .imageblock[style*="float: right"] { margin: 0.25em 0 1.25em 0.625em; }
.imageblock > .title { margin-bottom: 0; }
.imageblock.thumb, .imageblock.th { border-width: 6px; }
.imageblock.thumb > .title, .imageblock.th > .title { padding: 0 0.125em; }

.image.left, .image.right { margin-top: 0.25em; margin-bottom: 0.25em; display: inline-block; line-height: 0; }
.image.left { margin-right: 0.625em; }
.image.right { margin-left: 0.625em; }

a.image { text-decoration: none; }

span.footnote, span.footnoteref { vertical-align: super; font-size: 0.875em; }
span.footnote a, span.footnoteref a { text-decoration: none; }
span.footnote a:active, span.footnoteref a:active { text-decoration: underline; }

#footnotes { padding-top: 0.75em; padding-bottom: 0.75em; margin-bottom: 0.625em; }
#footnotes hr { width: 20%; min-width: 6.25em; margin: -.25em 0 .75em 0; border-width: 1px 0 0 0; }
#footnotes .footnote { padding: 0 0.375em; line-height: 1.3; font-size: 0.875em; margin-left: 1.2em; text-indent: -1.2em; margin-bottom: .2em; }
#footnotes .footnote a:first-of-type { font-weight: bold; text-decoration: none; }
#footnotes .footnote:last-of-type { margin-bottom: 0; }

#content #footnotes { margin-top: -0.625em; margin-bottom: 0; padding: 0.75em 0; }

.gist .file-data > table { border: 0; background: #fff; width: 100%; margin-bottom: 0; }
.gist .file-data > table td.line-data { width: 99%; }

div.unbreakable { page-break-inside: avoid; }

.big { font-size: larger; }

.small { font-size: smaller; }

.underline { text-decoration: underline; }

.overline { text-decoration: overline; }

.line-through { text-decoration: line-through; }

.aqua { color: #00bfbf; }

.aqua-background { background-color: #00fafa; }

.black { color: black; }

.black-background { background-color: black; }

.blue { color: #0000bf; }

.blue-background { background-color: #0000fa; }

.fuchsia { color: #bf00bf; }

.fuchsia-background { background-color: #fa00fa; }

.gray { color: #606060; }

.gray-background { background-color: #7d7d7d; }

.green { color: #006000; }

.green-background { background-color: #007d00; }

.lime { color: #00bf00; }

.lime-background { background-color: #00fa00; }

.maroon { color: #600000; }

.maroon-background { background-color: #7d0000; }

.navy { color: #000060; }

.navy-background { background-color: #00007d; }

.olive { color: #606000; }

.olive-background { background-color: #7d7d00; }

.purple { color: #600060; }

.purple-background { background-color: #7d007d; }

.red { color: #bf0000; }

.red-background { background-color: #fa0000; }

.silver { color: #909090; }

.silver-background { background-color: #bcbcbc; }

.teal { color: #006060; }

.teal-background { background-color: #007d7d; }

.white { color: #bfbfbf; }

.white-background { background-color: #fafafa; }

.yellow { color: #bfbf00; }

.yellow-background { background-color: #fafa00; }

span.icon > .fa { cursor: default; }

.admonitionblock td.icon [class^="fa icon-"] { font-size: 2.5em; text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.5); cursor: default; }
.admonitionblock td.icon .icon-note:before { content: "\f05a"; color: #207c98; }
.admonitionblock td.icon .icon-tip:before { content: "\f0eb"; text-shadow: 1px 1px 2px rgba(155, 155, 0, 0.8); color: #111; }
.admonitionblock td.icon .icon-warning:before { content: "\f071"; color: #bf6900; }
.admonitionblock td.icon .icon-caution:before { content: "\f06d"; color: #bf3400; }
.admonitionblock td.icon .icon-important:before { content: "\f06a"; color: #bf0000; }

.conum[data-value] { display: inline-block; color: #fff !important; background-color: #222222; -webkit-border-radius: 100px; border-radius: 100px; text-align: center; font-size: 0.75em; width: 1.67em; height: 1.67em; line-height: 1.67em; font-family: "Open Sans", "DejaVu Sans", sans-serif; font-style: normal; font-weight: bold; }
.conum[data-value] * { color: #fff !important; }
.conum[data-value] + b { display: none; }
.conum[data-value]:after { content: attr(data-value); }
pre .conum[data-value] { position: relative; top: -0.125em; }

b.conum * { color: inherit !important; }

.conum:not([data-value]):empty { display: none; }

.literalblock pre, .listingblock pre { background: #eeeeee; }

</style>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.2.0/css/font-awesome.min.css">
<style>.listingblock .pygments .hll { background-color: #ffffcc }
.listingblock .pygments  { background: #f8f8f8; }
.listingblock .pygments .tok-c { color: #408080; font-style: italic } /* Comment */
.listingblock .pygments .tok-err { border: 1px solid #FF0000 } /* Error */
.listingblock .pygments .tok-k { color: #008000; font-weight: bold } /* Keyword */
.listingblock .pygments .tok-o { color: #666666 } /* Operator */
.listingblock .pygments .tok-cm { color: #408080; font-style: italic } /* Comment.Multiline */
.listingblock .pygments .tok-cp { color: #BC7A00 } /* Comment.Preproc */
.listingblock .pygments .tok-c1 { color: #408080; font-style: italic } /* Comment.Single */
.listingblock .pygments .tok-cs { color: #408080; font-style: italic } /* Comment.Special */
.listingblock .pygments .tok-gd { color: #A00000 } /* Generic.Deleted */
.listingblock .pygments .tok-ge { font-style: italic } /* Generic.Emph */
.listingblock .pygments .tok-gr { color: #FF0000 } /* Generic.Error */
.listingblock .pygments .tok-gh { color: #000080; font-weight: bold } /* Generic.Heading */
.listingblock .pygments .tok-gi { color: #00A000 } /* Generic.Inserted */
.listingblock .pygments .tok-go { color: #888888 } /* Generic.Output */
.listingblock .pygments .tok-gp { color: #000080; font-weight: bold } /* Generic.Prompt */
.listingblock .pygments .tok-gs { font-weight: bold } /* Generic.Strong */
.listingblock .pygments .tok-gu { color: #800080; font-weight: bold } /* Generic.Subheading */
.listingblock .pygments .tok-gt { color: #0044DD } /* Generic.Traceback */
.listingblock .pygments .tok-kc { color: #008000; font-weight: bold } /* Keyword.Constant */
.listingblock .pygments .tok-kd { color: #008000; font-weight: bold } /* Keyword.Declaration */
.listingblock .pygments .tok-kn { color: #008000; font-weight: bold } /* Keyword.Namespace */
.listingblock .pygments .tok-kp { color: #008000 } /* Keyword.Pseudo */
.listingblock .pygments .tok-kr { color: #008000; font-weight: bold } /* Keyword.Reserved */
.listingblock .pygments .tok-kt { color: #B00040 } /* Keyword.Type */
.listingblock .pygments .tok-m { color: #666666 } /* Literal.Number */
.listingblock .pygments .tok-s { color: #BA2121 } /* Literal.String */
.listingblock .pygments .tok-na { color: #7D9029 } /* Name.Attribute */
.listingblock .pygments .tok-nb { color: #008000 } /* Name.Builtin */
.listingblock .pygments .tok-nc { color: #0000FF; font-weight: bold } /* Name.Class */
.listingblock .pygments .tok-no { color: #880000 } /* Name.Constant */
.listingblock .pygments .tok-nd { color: #AA22FF } /* Name.Decorator */
.listingblock .pygments .tok-ni { color: #999999; font-weight: bold } /* Name.Entity */
.listingblock .pygments .tok-ne { color: #D2413A; font-weight: bold } /* Name.Exception */
.listingblock .pygments .tok-nf { color: #0000FF } /* Name.Function */
.listingblock .pygments .tok-nl { color: #A0A000 } /* Name.Label */
.listingblock .pygments .tok-nn { color: #0000FF; font-weight: bold } /* Name.Namespace */
.listingblock .pygments .tok-nt { color: #008000; font-weight: bold } /* Name.Tag */
.listingblock .pygments .tok-nv { color: #19177C } /* Name.Variable */
.listingblock .pygments .tok-ow { color: #AA22FF; font-weight: bold } /* Operator.Word */
.listingblock .pygments .tok-w { color: #bbbbbb } /* Text.Whitespace */
.listingblock .pygments .tok-mb { color: #666666 } /* Literal.Number.Bin */
.listingblock .pygments .tok-mf { color: #666666 } /* Literal.Number.Float */
.listingblock .pygments .tok-mh { color: #666666 } /* Literal.Number.Hex */
.listingblock .pygments .tok-mi { color: #666666 } /* Literal.Number.Integer */
.listingblock .pygments .tok-mo { color: #666666 } /* Literal.Number.Oct */
.listingblock .pygments .tok-sb { color: #BA2121 } /* Literal.String.Backtick */
.listingblock .pygments .tok-sc { color: #BA2121 } /* Literal.String.Char */
.listingblock .pygments .tok-sd { color: #BA2121; font-style: italic } /* Literal.String.Doc */
.listingblock .pygments .tok-s2 { color: #BA2121 } /* Literal.String.Double */
.listingblock .pygments .tok-se { color: #BB6622; font-weight: bold } /* Literal.String.Escape */
.listingblock .pygments .tok-sh { color: #BA2121 } /* Literal.String.Heredoc */
.listingblock .pygments .tok-si { color: #BB6688; font-weight: bold } /* Literal.String.Interpol */
.listingblock .pygments .tok-sx { color: #008000 } /* Literal.String.Other */
.listingblock .pygments .tok-sr { color: #BB6688 } /* Literal.String.Regex */
.listingblock .pygments .tok-s1 { color: #BA2121 } /* Literal.String.Single */
.listingblock .pygments .tok-ss { color: #19177C } /* Literal.String.Symbol */
.listingblock .pygments .tok-bp { color: #008000 } /* Name.Builtin.Pseudo */
.listingblock .pygments .tok-vc { color: #19177C } /* Name.Variable.Class */
.listingblock .pygments .tok-vg { color: #19177C } /* Name.Variable.Global */
.listingblock .pygments .tok-vi { color: #19177C } /* Name.Variable.Instance */
.listingblock .pygments .tok-il { color: #666666 } /* Literal.Number.Integer.Long */
</style>
</head>
<body class="article toc2 toc-left">
<div id="header">
<h1>Grails</h1>
<div class="details">
<span id="author" class="author">Fran García</span><br>
<span id="email" class="email">&lt;<a href="mailto:fgarciarico@gmail.com">fgarciarico@gmail.com</a>&gt;</span><br>
</div>
<div id="toc" class="toc2">
<div id="toctitle">Índice de contenidos</div>
<ul class="sectlevel1">
<li><a href="#sesion08">8. Configuración de aplicaciones. Plugins interesantes</a>
<ul class="sectlevel2">
<li><a href="#_configuraci%C3%B3n_de_aplicaciones">8.1. Configuración de aplicaciones</a></li>
<li><a href="#_empaquetamiento_de_aplicaciones">8.2. Empaquetamiento de aplicaciones</a></li>
<li><a href="#_otros_comandos_interesantes_de_grails">8.3. Otros comandos interesantes de Grails</a></li>
<li><a href="#_plugins">8.4. Plugins</a></li>
<li><a href="#_ejercicios">8.5. Ejercicios</a></li>
</ul>
</li>
</ul>
</div>
</div>
<div id="content">
<div id="preamble">
<div class="sectionbody">
<div style="page-break-after: always;"></div>
</div>
</div>
<div class="sect1">
<h2 id="sesion08">8. Configuración de aplicaciones. Plugins interesantes</h2>
<div class="sectionbody">
<div class="paragraph">
<p>En esta última sesión de Grails analizaremos los diferentes aspectos de configuración de nuestra aplicación y posteriormente instalaremos algunos plugins interesantes desarrollados por la comunidad de usuarios de Grails.</p>
</div>
<div class="sect2">
<h3 id="_configuración_de_aplicaciones">8.1. Configuración de aplicaciones</h3>
<div class="sect3">
<h4 id="_el_archivo_config_groovy">8.1.1. El archivo Config.groovy</h4>
<div class="paragraph">
<p>El archivo <em>grails-app/conf/Config.groovy</em> contiene los parámetros de configuración general de nuestra aplicación. En este archivo se pueden declarar variables que estarán disponibles en cualquier artefacto de nuestra aplicación a través del objeto global <em>grailsApplication.config</em>. Por ejemplo si definimos la siguiente variable <em>es.ua.expertojava.todo.miParametro = "dato"</em>, ésta va a ser accesible desde cualquier controlador, vista, servicio, etc. mediante la expresión <em>grailsApplication.config.es.ua.expertojava.todo.miParametro</em>.</p>
</div>
<div class="paragraph">
<p>Además de poder declarar nuevas variables globales, el archivo <em>Config.groovy</em> utiliza una serie de variables definidas que tienen el siguiente significado:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><em>grails.config.locations</em>: ubicaciones donde encontrar otros archivos de configuración que se fundirán con el principal <em>Config.groovy</em>. Esta variable está comentada por defecto con lo que sólo se tendrá en cuenta el archivo <em>Config.groovy</em>.</p>
</li>
<li>
<p><em>grails.project.groupId</em>: nombre por defecto del paquete en el que se crean todos los artefactos de la aplicación. Por defecto tenemos que este paquete coincidirá con el nombre de la aplicación. Lo podríamos modificar por ejemplo a "es.ua.expertojava.todo" para no ahorrarnos tener que especificar el paquete cada vez que creamos un nuevo artefacto.</p>
</li>
<li>
<p><em>grails.views.default.codec</em>: especifica el formato por defecto de nuestras páginas GSPs. Puede tomar el valor 'none', 'html', o 'base64'. Por defecto se utiliza el valor html.</p>
</li>
<li>
<p><em>grails.controllers.defaultScope</em>: el <em>scope</em> por defecto de los controladores, en principio <em>singleton</em>.</p>
</li>
<li>
<p><em>grails.views.gsp</em>: un mapa de configuración de como se van a renderizar nuestras páginas GSP.</p>
</li>
<li>
<p><em>grails.converters.encoding</em>: codificación de los convertidores</p>
</li>
<li>
<p><em>grails.scaffolding.templates.domainSuffix</em>: el sufijo añadido a las instancias de nuestras clases de dominio en el plugin <em>scaffolding</em>.</p>
</li>
<li>
<p><em>grails.mime.types</em>: indica un mapa con los posibles tipos mime soportados en nuestra aplicación</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_sistema_de_logs">8.1.2. Sistema de logs</h4>
<div class="paragraph">
<p>Grails utiliza la librería <em>log4j</em> para implementar todo el sistema de logs. Podemos configurar estos logs de nuestras aplicaciones en el propio archivo <em>Config.groovy</em>. Aquí encontraremos una variable llamada <em>log4j</em> que ya viene con algunas reglas.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-n">log4j</span><span class="tok-o">.</span><span class="tok-na">main</span> <span class="tok-o">=</span> <span class="tok-o">{</span>
    <span class="tok-n">error</span>  <span class="tok-s1">&#39;org.codehaus.groovy.grails.web.servlet&#39;</span><span class="tok-o">,</span>  <span class="tok-c1">//  controllers</span>
           <span class="tok-s1">&#39;org.codehaus.groovy.grails.web.pages&#39;</span><span class="tok-o">,</span> <span class="tok-c1">//  GSP</span>
           <span class="tok-s1">&#39;org.codehaus.groovy.grails.web.sitemesh&#39;</span><span class="tok-o">,</span> <span class="tok-c1">//  layouts</span>
           <span class="tok-s1">&#39;org.codehaus.groovy.grails.web.mapping.filter&#39;</span><span class="tok-o">,</span> <span class="tok-c1">// URL mapping</span>
           <span class="tok-s1">&#39;org.codehaus.groovy.grails.web.mapping&#39;</span><span class="tok-o">,</span> <span class="tok-c1">// URL mapping</span>
           <span class="tok-s1">&#39;org.codehaus.groovy.grails.commons&#39;</span><span class="tok-o">,</span> <span class="tok-c1">// core / classloading</span>
           <span class="tok-s1">&#39;org.codehaus.groovy.grails.plugins&#39;</span><span class="tok-o">,</span> <span class="tok-c1">// plugins</span>
           <span class="tok-s1">&#39;org.codehaus.groovy.grails.orm.hibernate&#39;</span><span class="tok-o">,</span> <span class="tok-c1">// hibernate integration</span>
           <span class="tok-s1">&#39;org.springframework&#39;</span><span class="tok-o">,</span>
           <span class="tok-s1">&#39;org.hibernate&#39;</span><span class="tok-o">,</span>
           <span class="tok-s1">&#39;net.sf.ehcache.hibernate&#39;</span>
<span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>En esta configuración se especifica que aquellos problemas surgidos a nivel <em>error</em> serán añadidos al archivo de logs. Habitualmente tenemos ocho niveles estándar de logs.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>off</p>
</li>
<li>
<p>fatal</p>
</li>
<li>
<p>error</p>
</li>
<li>
<p>warn</p>
</li>
<li>
<p>info</p>
</li>
<li>
<p>debug</p>
</li>
<li>
<p>trace</p>
</li>
<li>
<p>all</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Esto significa que si por ejemplo especificamos <em>warn 'org.example.domain'</em>, todos los problemas surgidos de tipo <em>warn</em>, <em>error</em> o <em>fatal</em> serán impresos en el archivo. Los otros niveles serán ignorados.</p>
</div>
<div class="paragraph">
<p>Lo habitual es que necesitemos generar logs en controladores, servicios y otros artefactos. Estos artefactos se encuentran en el paquete <em>grails.app.&lt;tipo_de_artefacto&gt;.&lt;nombre_de_clase&gt;</em>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-n">log4j</span><span class="tok-o">.</span><span class="tok-na">main</span> <span class="tok-o">=</span> <span class="tok-o">{</span>
  <span class="tok-c1">// Establecemos el nivel info para todos los artefactos de la aplicación</span>
  <span class="tok-n">info</span> <span class="tok-s2">&quot;grails.app&quot;</span>

  <span class="tok-c1">// Especificamos el nivel debug para el controlador de la clase Tag</span>
  <span class="tok-n">debug</span> <span class="tok-s2">&quot;grails.app.controllers.es.ua.expertojava.todo.TagController&quot;</span>

  <span class="tok-c1">// Especificamos el nivel error para el servicio de la clase Todo</span>
  <span class="tok-n">error</span> <span class="tok-s2">&quot;grails.app.services.es.ua.expertojava.todo.TodoService&quot;</span>

  <span class="tok-c1">// Especificamos el nivel para todas las librerías de etiquetas</span>
  <span class="tok-n">info</span> <span class="tok-s2">&quot;grails.app.taglib&quot;</span>
<span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Los tipos de artefactos pueden ser los siguientes:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><em>conf</em>: para todo lo que esté en el directorio de configuración <em>grails-app/con</em></p>
</li>
<li>
<p><em>filters</em>: para los filtros</p>
</li>
<li>
<p><em>taglib</em>: para las librerías de etiquetas</p>
</li>
<li>
<p><em>services</em>: para los servicios</p>
</li>
<li>
<p><em>controllers</em>: para los controladores</p>
</li>
<li>
<p><em>domain</em>: para las clases de dominio</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Vamos a implementar un pequeño ejemplo en nuestra aplicación. En primer lugar, vamos a crear un appender, que no es más que un objeto en el cual especificamos como y donde queremos escribir los mensajes de log. En nuestro caso lo haremos escribiendo en un archivo de logs, aunque también podríamos haber optado por enviarlo a un correo electrónico o bien almacenarlo en una base de datos.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-n">log4j</span><span class="tok-o">.</span><span class="tok-na">main</span> <span class="tok-o">=</span> <span class="tok-o">{</span>
  <span class="tok-n">appenders</span> <span class="tok-o">{</span>
    <span class="tok-n">file</span> <span class="tok-nl">name:</span><span class="tok-s1">&#39;file&#39;</span><span class="tok-o">,</span> <span class="tok-nl">file:</span><span class="tok-s1">&#39;mylog.log&#39;</span>
  <span class="tok-o">}</span>
<span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>A continuación, vamos a indicarle a nuestra aplicación que queremos utilizar este appender en el controlador de la clase <em>Category</em>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-n">trace</span> <span class="tok-nl">file:</span> <span class="tok-s2">&quot;grails.app.controllers.es.ua.expertojava.todo.CategoryController&quot;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Por último, añadiremos una línea en el método <em>index()</em> del controlador <em>CategoryController</em> para escribir un mensaje de prueba.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-kt">def</span> <span class="tok-nf">index</span><span class="tok-o">()</span> <span class="tok-o">{</span>
  <span class="tok-n">log</span><span class="tok-o">.</span><span class="tok-na">trace</span><span class="tok-o">(</span><span class="tok-s2">&quot;Método index del controlador CategoryController&quot;</span><span class="tok-o">)</span>
  <span class="tok-n">params</span><span class="tok-o">.</span><span class="tok-na">max</span> <span class="tok-o">=</span> <span class="tok-n">Math</span><span class="tok-o">.</span><span class="tok-na">min</span><span class="tok-o">(</span><span class="tok-n">max</span> <span class="tok-o">?:</span> <span class="tok-mi">10</span><span class="tok-o">,</span> <span class="tok-mi">100</span><span class="tok-o">)</span>
  <span class="tok-n">respond</span> <span class="tok-n">Category</span><span class="tok-o">.</span><span class="tok-na">list</span><span class="tok-o">(</span><span class="tok-n">params</span><span class="tok-o">),</span> <span class="tok-nl">model:</span><span class="tok-o">[</span><span class="tok-nl">categoryInstanceCount:</span> <span class="tok-n">Category</span><span class="tok-o">.</span><span class="tok-na">count</span><span class="tok-o">()]</span>
<span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Si todo ha ido bien, tendremos un archivo en la raíz de nuestra aplicación llamado <em>mylog.log</em> y que añadirá el mensaje que hemos creado cada vez que se muestre el listado de usuarios.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-mi">2015</span><span class="tok-o">-</span><span class="tok-mi">03</span><span class="tok-o">-</span><span class="tok-mi">28</span> <span class="tok-mi">12</span><span class="tok-o">:</span><span class="tok-mi">05</span><span class="tok-o">:</span><span class="tok-mi">08</span><span class="tok-o">,</span><span class="tok-mi">549</span> <span class="tok-o">[</span><span class="tok-s2">&quot;http-bio-8080&quot;</span><span class="tok-o">-</span><span class="tok-n">exec</span><span class="tok-o">-</span><span class="tok-mi">1</span><span class="tok-o">]</span> <span class="tok-n">TRACE</span> <span class="tok-n">es</span><span class="tok-o">.</span><span class="tok-na">ua</span><span class="tok-o">.</span><span class="tok-na">expertojava</span><span class="tok-o">.</span><span class="tok-na">todo</span><span class="tok-o">.</span><span class="tok-na">CategoryController</span>  <span class="tok-o">-</span>
<span class="tok-n">M</span><span class="tok-err">é</span><span class="tok-n">todo</span> <span class="tok-n">index</span> <span class="tok-n">del</span> <span class="tok-n">controlador</span> <span class="tok-n">CategoryController</span></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_el_archivo_buildconfig_groovy">8.1.3. El archivo BuildConfig.groovy</h4>
<div class="paragraph">
<p>Además del archivo <em>Config.groovy</em>, todos los aspectos relativos a la configuración de la generación del proyecto se encuentran en el archivo <em>conf/BuildConfig.groovy</em>. En este archivo podemos encontrar las siguientes variables definidas:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><em>grails.servlet.version</em>: indicamos la especificación de Servlets. Por defecto utilizaremos la versión 3.0.</p>
</li>
<li>
<p><em>grails.project.class.dir</em>: especificamos el directorio donde se alojarán todos los archivos compilados del proyecto. Por defecto se alojarán en el directorio <em>target/classes</em></p>
</li>
<li>
<p><em>grails.project.test.class.dir</em>: especificamos el directorio donde se compilarán los tests de nuestros proyectos. Por defecto se alojarán en el directorio <em>target/test-classes</em></p>
</li>
<li>
<p><em>grails.project.test.reports.dir</em>: especificamos el directorio donde se alojarán los informes de las ejecuciones de los tests. Por defecto los tendremos en <em>target/test-reports</em></p>
</li>
<li>
<p><em>grails.project.target.level</em>: especificamos la versión de la máquina virtual de java. Por defecto será la 1.6</p>
</li>
<li>
<p><em>grails.project.war.file</em>: especificamos el nombre y la ubicación del archivo war que se generará. Por defecto, se alojarán en el directorio <em>target</em> y se llamará con el nombre de la aplicación seguido de la versión, empezando por la <em>0.1</em></p>
</li>
<li>
<p><em>grails.project.fork</em>: parámetros de configuración de la máquina virtual de Java utilizada en cada entorno de ejecución.</p>
</li>
<li>
<p><em>grails.project.dependency.resolution</em>: especificamos como se resuelven las dependencias de los archivos JAR de nuestros proyectos.</p>
</li>
<li>
<p><em>grails.project.dependency.resolution.plugins</em>: un listado de los plugins utilizados en nuestra aplicación.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_el_archivo_datasource_groovy">8.1.4. El archivo DataSource.groovy</h4>
<div class="paragraph">
<p>Muchas empresas disponen de varios entornos que las aplicaciones deben superar para finalmente pasar a disposición de los usuarios finales. Los entornos más habituales son el <em>entorno de desarrollo</em> que se refiere al entorno propio del desarrollador, con su propio servidor local instalado en su ordenador, el <em>entorno de tests</em> en el que otras personas se encargan de comprobar que la aplicación funciona tal y como se espera de ella y por último, el <em>entorno de producción</em>, que es donde aparecen en escena los usuarios finales, que son quienes realmente "probarán" el buen funcionamiento de la aplicación.</p>
</div>
<div class="paragraph">
<p>En cada uno de estos entornos, lo habitual es tener una configuración de base de datos diferente para cada uno, puesto que los requerimientos serán distintos. Por ejemplo, en un entorno de desarrollo posiblemente nos sea suficiente utilizar una base de datos en memoria como H2, pero este tipo de base de datos será insuficiente para los entornos de test y producción con lo que deberemos utilizar un servidor de base de datos como por ejemplo MySQL.</p>
</div>
<div class="paragraph">
<p>Como no podía ser menos, Grails lo tiene todo preparado para realizar esta diferenciación sin problemas. El archivo <em>grails-app/conf/DataSource.groovy</em> se encarga de todo mediante la creación por defecto de tres entornos de desarrollo: <em>desarrollo, test y producción</em>, tal y como puedes comprobar en el siguiente ejemplo.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-n">dataSource</span> <span class="tok-o">{</span>
    <span class="tok-n">pooled</span> <span class="tok-o">=</span> <span class="tok-kc">true</span>
    <span class="tok-n">jmxExport</span> <span class="tok-o">=</span> <span class="tok-kc">true</span>
    <span class="tok-n">driverClassName</span> <span class="tok-o">=</span> <span class="tok-s2">&quot;org.h2.Driver&quot;</span>
    <span class="tok-n">username</span> <span class="tok-o">=</span> <span class="tok-s2">&quot;sa&quot;</span>
    <span class="tok-n">password</span> <span class="tok-o">=</span> <span class="tok-s2">&quot;&quot;</span>
<span class="tok-o">}</span>
<span class="tok-n">hibernate</span> <span class="tok-o">{</span>
    <span class="tok-n">cache</span><span class="tok-o">.</span><span class="tok-na">use_second_level_cache</span> <span class="tok-o">=</span> <span class="tok-kc">true</span>
    <span class="tok-n">cache</span><span class="tok-o">.</span><span class="tok-na">use_query_cache</span> <span class="tok-o">=</span> <span class="tok-kc">false</span>
<span class="tok-c1">//    cache.region.factory_class = &#39;net.sf.ehcache.hibernate.EhCacheRegionFactory&#39; // Hibernate 3</span>
    <span class="tok-n">cache</span><span class="tok-o">.</span><span class="tok-na">region</span><span class="tok-o">.</span><span class="tok-na">factory_class</span> <span class="tok-o">=</span> <span class="tok-s1">&#39;org.hibernate.cache.ehcache.EhCacheRegionFactory&#39;</span> <span class="tok-c1">// Hibernate 4</span>
    <span class="tok-n">singleSession</span> <span class="tok-o">=</span> <span class="tok-kc">true</span> <span class="tok-c1">// configure OSIV singleSession mode</span>
    <span class="tok-n">flush</span><span class="tok-o">.</span><span class="tok-na">mode</span> <span class="tok-o">=</span> <span class="tok-s1">&#39;manual&#39;</span> <span class="tok-c1">// OSIV session flush mode outside of transactional context</span>
<span class="tok-o">}</span>

<span class="tok-c1">// environment specific settings</span>
<span class="tok-n">environments</span> <span class="tok-o">{</span>
    <span class="tok-n">development</span> <span class="tok-o">{</span>
        <span class="tok-n">dataSource</span> <span class="tok-o">{</span>
            <span class="tok-n">dbCreate</span> <span class="tok-o">=</span> <span class="tok-s2">&quot;create-drop&quot;</span> <span class="tok-c1">// one of &#39;create&#39;, &#39;create-drop&#39;, &#39;update&#39;, &#39;validate&#39;, &#39;&#39;</span>
            <span class="tok-n">url</span> <span class="tok-o">=</span> <span class="tok-s2">&quot;jdbc:h2:mem:devDb;MVCC=TRUE;LOCK_TIMEOUT=10000;DB_CLOSE_ON_EXIT=FALSE&quot;</span>
        <span class="tok-o">}</span>
    <span class="tok-o">}</span>
    <span class="tok-n">test</span> <span class="tok-o">{</span>
        <span class="tok-n">dataSource</span> <span class="tok-o">{</span>
            <span class="tok-n">dbCreate</span> <span class="tok-o">=</span> <span class="tok-s2">&quot;update&quot;</span>
            <span class="tok-n">url</span> <span class="tok-o">=</span> <span class="tok-s2">&quot;jdbc:h2:mem:testDb;MVCC=TRUE;LOCK_TIMEOUT=10000;DB_CLOSE_ON_EXIT=FALSE&quot;</span>
        <span class="tok-o">}</span>
    <span class="tok-o">}</span>
    <span class="tok-n">production</span> <span class="tok-o">{</span>
        <span class="tok-n">dataSource</span> <span class="tok-o">{</span>
            <span class="tok-n">dbCreate</span> <span class="tok-o">=</span> <span class="tok-s2">&quot;update&quot;</span>
            <span class="tok-n">url</span> <span class="tok-o">=</span> <span class="tok-s2">&quot;jdbc:h2:prodDb;MVCC=TRUE;LOCK_TIMEOUT=10000;DB_CLOSE_ON_EXIT=FALSE&quot;</span>
            <span class="tok-n">properties</span> <span class="tok-o">{</span>
               <span class="tok-c1">// See http://grails.org/doc/latest/guide/conf.html#dataSource for documentation</span>
               <span class="tok-n">jmxEnabled</span> <span class="tok-o">=</span> <span class="tok-kc">true</span>
               <span class="tok-n">initialSize</span> <span class="tok-o">=</span> <span class="tok-mi">5</span>
               <span class="tok-n">maxActive</span> <span class="tok-o">=</span> <span class="tok-mi">50</span>
               <span class="tok-n">minIdle</span> <span class="tok-o">=</span> <span class="tok-mi">5</span>
               <span class="tok-n">maxIdle</span> <span class="tok-o">=</span> <span class="tok-mi">25</span>
               <span class="tok-n">maxWait</span> <span class="tok-o">=</span> <span class="tok-mi">10000</span>
               <span class="tok-n">maxAge</span> <span class="tok-o">=</span> <span class="tok-mi">10</span> <span class="tok-o">*</span> <span class="tok-mi">60000</span>
               <span class="tok-n">timeBetweenEvictionRunsMillis</span> <span class="tok-o">=</span> <span class="tok-mi">5000</span>
               <span class="tok-n">minEvictableIdleTimeMillis</span> <span class="tok-o">=</span> <span class="tok-mi">60000</span>
               <span class="tok-n">validationQuery</span> <span class="tok-o">=</span> <span class="tok-s2">&quot;SELECT 1&quot;</span>
               <span class="tok-n">validationQueryTimeout</span> <span class="tok-o">=</span> <span class="tok-mi">3</span>
               <span class="tok-n">validationInterval</span> <span class="tok-o">=</span> <span class="tok-mi">15000</span>
               <span class="tok-n">testOnBorrow</span> <span class="tok-o">=</span> <span class="tok-kc">true</span>
               <span class="tok-n">testWhileIdle</span> <span class="tok-o">=</span> <span class="tok-kc">true</span>
               <span class="tok-n">testOnReturn</span> <span class="tok-o">=</span> <span class="tok-kc">false</span>
               <span class="tok-n">jdbcInterceptors</span> <span class="tok-o">=</span> <span class="tok-s2">&quot;ConnectionState&quot;</span>
               <span class="tok-n">defaultTransactionIsolation</span> <span class="tok-o">=</span> <span class="tok-n">java</span><span class="tok-o">.</span><span class="tok-na">sql</span><span class="tok-o">.</span><span class="tok-na">Connection</span><span class="tok-o">.</span><span class="tok-na">TRANSACTION_READ_COMMITTED</span>
            <span class="tok-o">}</span>
        <span class="tok-o">}</span>
    <span class="tok-o">}</span>
<span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>En el primer bloque <em>dataSource</em> se definen una serie de valores genéricos, que posteriormente podremos sobreescribir en cada uno de los entornos. El bloque <em>hibernate</em> se refiere a parámetros de configuración del propio hibernate, mientras que el último bloque de <em>environments</em> es el que nos va a permitir diferenciar cada uno de los entornos.</p>
</div>
<div class="paragraph">
<p>Por defecto Grails crea los tres entornos de los que hablábamos anteriormente. Con el comando <em>grails run-app</em> que hemos utilizado hasta ahora, la aplicación se ejecuta en el entorno de desarrollo, que es el utilizado por defecto, pero si quisiéramos utilizar otro entorno podríamos ejecutar los comandos de la siguiente tabla:</p>
</div>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-center valign-middle">Entorno</th>
<th class="tableblock halign-left valign-top">Comando</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-center valign-middle"><p class="tableblock">Desarrollo</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>grails dev run-app</em> o <em>grails run-app</em></p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-middle"><p class="tableblock">Test</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>grails test run-app</em></p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-middle"><p class="tableblock">Producción</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>grails prod run-app</em></p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>En el fichero <em>DataSource.groovy</em> se puede comprobar las tres configuraciones para cada uno de los entornos. Para los entornos de desarrollo y test se va a utilizar una base de datos en memoria como H2, eso si, diferente para cada uno de ellos (<em>devDB</em> y <em>testDb</em>).</p>
</div>
<div class="paragraph">
<p>Para el entorno de producción deberíamos utilizar una base de datos más robusta y propia de entornos de producción como es MySQL. Para ello le especificamos la URI de la base de datos, así como el controlador, el nombre de usuario y la contraseña de acceso a la misma.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-n">production</span> <span class="tok-o">{</span>
        <span class="tok-n">dataSource</span> <span class="tok-o">{</span>
            <span class="tok-n">dbCreate</span> <span class="tok-o">=</span> <span class="tok-s2">&quot;update&quot;</span>
            <span class="tok-n">url</span> <span class="tok-o">=</span> <span class="tok-s2">&quot;jdbc:mysql://localhost:3306/todo?useUnicode=true&amp;characterEncoding=UTF-8&quot;</span>
            <span class="tok-n">username</span> <span class="tok-o">=</span> <span class="tok-s2">&quot;userprod&quot;</span>
            <span class="tok-n">password</span> <span class="tok-o">=</span> <span class="tok-s2">&quot;pwdprod&quot;</span>
            <span class="tok-n">properties</span> <span class="tok-o">{</span>
               <span class="tok-c1">// See http://grails.org/doc/latest/guide/conf.html#dataSource for documentation</span>
               <span class="tok-n">jmxEnabled</span> <span class="tok-o">=</span> <span class="tok-kc">true</span>
               <span class="tok-n">initialSize</span> <span class="tok-o">=</span> <span class="tok-mi">5</span>
               <span class="tok-n">maxActive</span> <span class="tok-o">=</span> <span class="tok-mi">50</span>
               <span class="tok-n">minIdle</span> <span class="tok-o">=</span> <span class="tok-mi">5</span>
               <span class="tok-n">maxIdle</span> <span class="tok-o">=</span> <span class="tok-mi">25</span>
               <span class="tok-n">maxWait</span> <span class="tok-o">=</span> <span class="tok-mi">10000</span>
               <span class="tok-n">maxAge</span> <span class="tok-o">=</span> <span class="tok-mi">10</span> <span class="tok-o">*</span> <span class="tok-mi">60000</span>
               <span class="tok-n">timeBetweenEvictionRunsMillis</span> <span class="tok-o">=</span> <span class="tok-mi">5000</span>
               <span class="tok-n">minEvictableIdleTimeMillis</span> <span class="tok-o">=</span> <span class="tok-mi">60000</span>
               <span class="tok-n">validationQuery</span> <span class="tok-o">=</span> <span class="tok-s2">&quot;SELECT 1&quot;</span>
               <span class="tok-n">validationQueryTimeout</span> <span class="tok-o">=</span> <span class="tok-mi">3</span>
               <span class="tok-n">validationInterval</span> <span class="tok-o">=</span> <span class="tok-mi">15000</span>
               <span class="tok-n">testOnBorrow</span> <span class="tok-o">=</span> <span class="tok-kc">true</span>
               <span class="tok-n">testWhileIdle</span> <span class="tok-o">=</span> <span class="tok-kc">true</span>
               <span class="tok-n">testOnReturn</span> <span class="tok-o">=</span> <span class="tok-kc">false</span>
               <span class="tok-n">jdbcInterceptors</span> <span class="tok-o">=</span> <span class="tok-s2">&quot;ConnectionState&quot;</span>
               <span class="tok-n">defaultTransactionIsolation</span> <span class="tok-o">=</span> <span class="tok-n">java</span><span class="tok-o">.</span><span class="tok-na">sql</span><span class="tok-o">.</span><span class="tok-na">Connection</span><span class="tok-o">.</span><span class="tok-na">TRANSACTION_READ_COMMITTED</span>
            <span class="tok-o">}</span>
        <span class="tok-o">}</span>
    <span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Además, deberíamos disponer del driver correspondiente de MySQL (<a href="http://www.mysql.com/downloads/connector/j/" class="bare">http://www.mysql.com/downloads/connector/j/</a>) y copiarlo en el directorio <em>lib</em> de la aplicación o bien especificarlo en las dependencias en el archivo <em>BuildConfig.groovy</em>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-n">grails</span><span class="tok-o">.</span><span class="tok-na">project</span><span class="tok-o">.</span><span class="tok-na">dependency</span><span class="tok-o">.</span><span class="tok-na">resolution</span> <span class="tok-o">=</span> <span class="tok-o">{</span>
  <span class="tok-o">...</span>

  <span class="tok-n">dependencies</span> <span class="tok-o">{</span>
    <span class="tok-n">runtime</span> <span class="tok-s1">&#39;mysql:mysql-connector-java:5.1.34&#39;</span>
  <span class="tok-o">}</span>
  <span class="tok-o">....</span>
<span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Además, mediante el parámetro <em>dbCreate</em> podemos especificar la forma en la que Grails debe generar el esquema de la base de datos a partir de la definición de las clases de dominio. Este parámetro puede tomar tres valores diferentes:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><em>create-drop</em>. El esquema de la base de datos se creará cada vez que arranquemos la aplicación en el entorno dado, y será destruido al interrumpir su ejecución.</p>
</li>
<li>
<p><em>create</em>. Crea el esquema de la base de datos, en caso de que el éste no exista, pero no modifica el esquema existente, aunque si borrará todos los datos almacenados en la misma.</p>
</li>
<li>
<p><em>update</em>. Crea la base de datos si no existe, y actualiza las tablas si detecta que se han añadido entidades nuevas o campos a los ya existentes. Estas modificaciones no incluirán la eliminación o modificación de nada en la base de datos, con lo que hay que tener cuidado con este tipo de cambios en las clases de dominio y que luego no se ven reflejados automáticamente en la base de datos.</p>
</li>
<li>
<p><em>validate</em>. Simplemente compara nuestro esquema actual con la base de datos especificada para enviarnos algún que otro aviso de diferencia.</p>
</li>
<li>
<p><em>cualquier otro valor</em>. Si especificamos cualquier otro valor, Grails no hará nada por nosotros. No debemos especificar ningún valor a la variable <em>dbCreate</em> si nos encargaremos de la base de datos nosotros mismos mediante una herramienta externa.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_el_archivo_bootstrap_groovy">8.1.5. El archivo BootStrap.groovy</h4>
<div class="paragraph">
<p>A lo largo de las sesiones relativas a Grails, hemos utilizado el archivo de configuración <em>BootStrap.groovy</em> para insertar ciertos datos de ejemplo en nuestra aplicación que nos han servido para comprobar su funcionamiento.</p>
</div>
<div class="paragraph">
<p>El archivo define dos closures, <em>init</em> y <em>destroy</em>. El primero de ellos se ejecutará cada vez que ejecutemos la aplicación mediante el comando <em>grails run-app</em> en cualquiera de los entornos de ejecución recientemente comentados. Mientras que el closure <em>destroy</em> se ejecutará cuando paremos la ejecución de la aplicación.</p>
</div>
<div class="paragraph">
<p>Hasta el momento, cuando hemos insertado los datos en la base de datos, lo hacíamos independientemente del entorno de ejecución en el que estuviéramos, algo que no será lo habitual, puesto que para los entornos de test y producción, es más que probable que los datos ya estén almacenados en la base de datos o bien se inserten mediante una batería de pruebas en el caso del entorno de tests.</p>
</div>
<div class="paragraph">
<p>Teniendo en cuesta esto, necesitaremos diferenciar en cada momento el entorno de ejecución de nuestra aplicación para insertar datos o no. Para ello, Grails dispone de la clase <em>grails.util.Environment</em> y la variable <em>current</em> que nos indica cual es el entorno de ejecución actual. El siguiente código de ejemplo, muestra como realizar esta distinción a la hora de insertar datos en diferentes entornos.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-kn">import</span> <span class="tok-nn">grails.util.Environment</span>

<span class="tok-kd">class</span> <span class="tok-nc">BootStrap</span> <span class="tok-o">{</span>
  <span class="tok-kt">def</span> <span class="tok-n">init</span> <span class="tok-o">=</span> <span class="tok-o">{</span> <span class="tok-n">servletContext</span> <span class="tok-o">-&gt;</span>
    <span class="tok-k">switch</span> <span class="tok-o">(</span><span class="tok-n">Environment</span><span class="tok-o">.</span><span class="tok-na">current</span><span class="tok-o">)</span> <span class="tok-o">{</span>
      <span class="tok-k">case</span> <span class="tok-n">Environment</span><span class="tok-o">.</span><span class="tok-na">DEVELOPMENT</span><span class="tok-o">:</span>
        <span class="tok-n">configuracionDesarrollo</span><span class="tok-o">()</span>
        <span class="tok-k">break</span>
      <span class="tok-k">case</span> <span class="tok-n">Environment</span><span class="tok-o">.</span><span class="tok-na">PRODUCTION</span><span class="tok-o">:</span>
        <span class="tok-n">configuracionProduccion</span><span class="tok-o">()</span>
        <span class="tok-k">break</span>
      <span class="tok-k">case</span> <span class="tok-n">Environment</span><span class="tok-o">.</span><span class="tok-na">TEST</span><span class="tok-o">:</span>
        <span class="tok-n">configuracionTest</span><span class="tok-o">()</span>
        <span class="tok-k">break</span>
    <span class="tok-o">}</span>
  <span class="tok-o">}</span>
  <span class="tok-kt">def</span> <span class="tok-n">destroy</span> <span class="tok-o">=</span> <span class="tok-o">{</span>
    <span class="tok-k">switch</span> <span class="tok-o">(</span><span class="tok-n">Environment</span><span class="tok-o">.</span><span class="tok-na">current</span><span class="tok-o">)</span> <span class="tok-o">{</span>
      <span class="tok-k">case</span> <span class="tok-n">Environment</span><span class="tok-o">.</span><span class="tok-na">DEVELOPMENT</span><span class="tok-o">:</span>
        <span class="tok-n">salirDesarrollo</span><span class="tok-o">()</span>
        <span class="tok-k">break</span>
      <span class="tok-k">case</span> <span class="tok-n">Environment</span><span class="tok-o">.</span><span class="tok-na">PRODUCTION</span><span class="tok-o">:</span>
        <span class="tok-n">salirProduccion</span><span class="tok-o">()</span>
        <span class="tok-k">break</span>
      <span class="tok-k">case</span> <span class="tok-n">Environment</span><span class="tok-o">.</span><span class="tok-na">TEST</span><span class="tok-o">:</span>
        <span class="tok-n">salirTest</span><span class="tok-o">()</span>
        <span class="tok-k">break</span>
    <span class="tok-o">}</span>
  <span class="tok-o">}</span>
<span class="tok-o">}</span></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_el_archivo_urlmappings_groovy">8.1.6. El archivo UrlMappings.groovy</h4>
<div class="paragraph">
<p>Otro de los archivos interesantes en la configuración de una aplicación Grails es <em>UrlMappings.groovy</em>. Gracias a este archivo vamos a poder definir nuevas relaciones entre las URLs y los controladores.</p>
</div>
<div class="paragraph">
<p>Por defecto, este archivo indica que el primer parámetro que sigue al nombre de la aplicación se refiere al controlador, el segundo a la acción y el tercero al identificador de la instancia de la clase de dominio que estamos tratando. Además, en reciente versiones de Grails se ha añadido un nuevo parámetro que indica el formato de la petición, por ejemplo, json o xml.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-kd">class</span> <span class="tok-nc">UrlMappings</span> <span class="tok-o">{</span>

  <span class="tok-kd">static</span> <span class="tok-n">mappings</span> <span class="tok-o">=</span> <span class="tok-o">{</span>
        <span class="tok-s2">&quot;/$controller/$action?/$id?(.$format)?&quot;</span><span class="tok-o">{</span>
            <span class="tok-n">constraints</span> <span class="tok-o">{</span>
                <span class="tok-c1">// apply constraints here</span>
            <span class="tok-o">}</span>
        <span class="tok-o">}</span>

        <span class="tok-s2">&quot;/&quot;</span><span class="tok-o">(</span><span class="tok-nl">view:</span><span class="tok-s2">&quot;/index&quot;</span><span class="tok-o">)</span>
        <span class="tok-s2">&quot;500&quot;</span><span class="tok-o">(</span><span class="tok-nl">view:</span><span class="tok-s1">&#39;/error&#39;</span><span class="tok-o">)</span>
  <span class="tok-o">}</span>
<span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Un ejemplo típico del uso del mapeo de URLs es modificar este comportamiento para permitir otras URLs más limpias. Por ejemplo, como administradores de la aplicación estaría bien poder ver las tareas de los usuarios a partir de su nombre de usuario, algo como <a href="http://localhost:8080/todo/usuario1" class="bare">http://localhost:8080/todo/usuario1</a>.</p>
</div>
<div class="paragraph">
<p>Para ello, podemos introducir una nueva regla en el archivo <em>UrlMappings.groovy</em> para que la aplicación sepa como actuar cuando le llegue una petición con una URL del estilo de la comentada. La siguiente regla se encargaría de este redireccionamiento encubierto.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-s2">&quot;/todos/$username&quot;</span><span class="tok-o">(</span><span class="tok-nl">controller:</span><span class="tok-s2">&quot;todo&quot;</span><span class="tok-o">,</span><span class="tok-nl">action:</span><span class="tok-s2">&quot;showTodosByUser&quot;</span><span class="tok-o">)</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>O bien podemos optar por una sintaxis diferente.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-s2">&quot;/$username&quot;</span><span class="tok-o">{</span>
      <span class="tok-n">controller</span> <span class="tok-o">=</span> <span class="tok-s2">&quot;todo&quot;</span>
      <span class="tok-n">action</span> <span class="tok-o">=</span> <span class="tok-s2">&quot;showtodosbyuser&quot;</span>
<span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>En primer lugar le especificamos la parte de la URL a partir del nombre de la aplicación que necesitamos que concuerde y después definimos que controlador y que acción se deben encargar de procesar esta petición. En ambas opciones tendremos acceso al valor del nombre de usuario a través de la variable <em>params.username</em>.</p>
</div>
<div class="paragraph">
<p>Posteriormente, deberíamos implementar un método en el controlador <em>TodoController</em> llamado <em>showTodosByUser()</em> que nos devolviera aquellos tareas que pertenezcan al usuario cuyo nombre de usuario coincida con el pasado en la url.</p>
</div>
<div class="paragraph">
<p>Otra posible utilidad del mapeo de URLs es la internacionalización de las URLs. Por ejemplo, en nuestra aplicación hemos definido las clases de dominio en inglés y por lo tanto las URLs se muestran también en inglés. Si deseamos que estas URLs se muestren también en castellano, podemos crear una serie de reglas en el archivo <em>UrlMappings.groovy</em>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-s2">&quot;/tarea/$action?/$id?(.$format)?&quot;</span><span class="tok-o">{</span>
      <span class="tok-n">controller</span> <span class="tok-o">=</span> <span class="tok-s2">&quot;tarea&quot;</span>
<span class="tok-o">}</span>

<span class="tok-s2">&quot;/usuario/$action?/$id?(.$format)?&quot;</span><span class="tok-o">{</span>
      <span class="tok-n">controller</span> <span class="tok-o">=</span> <span class="tok-s2">&quot;user&quot;</span>
<span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Las reglas de mapeo también permiten la introducción de restricciones que deben cumplir las partes de la URL. Por ejemplo, si quisiéramos obtener un listado con todos las tareas creadas un determinado día podríamos tener la siguiente url <a href="http://localhost:8080/todo/2015/03/28" class="bare">http://localhost:8080/todo/2015/03/28</a>. Las restricciones que debe cumplir la URL son que el año debe ser una cifra de cuatro dígitos mientras que el mes debe estar compuesta por dos números y el día por otras dos. Para que la aplicación supiera que hacer con este tipo de direcciones debemos introducir la siguiente regla de mapeo.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-s2">&quot;/$year/$month/$day&quot;</span> <span class="tok-o">{</span>
  <span class="tok-n">controller</span> <span class="tok-o">=</span> <span class="tok-s2">&quot;todo&quot;</span>
  <span class="tok-n">action</span> <span class="tok-o">=</span> <span class="tok-s2">&quot;showtodosbyday&quot;</span>
  <span class="tok-n">constraints</span> <span class="tok-o">{</span>
    <span class="tok-n">year</span><span class="tok-o">(</span><span class="tok-nl">matches:</span><span class="tok-s">/\d{4}/</span><span class="tok-o">)</span>
    <span class="tok-n">month</span><span class="tok-o">(</span><span class="tok-nl">matches:</span><span class="tok-s">/\d{2}/</span><span class="tok-o">)</span>
    <span class="tok-n">day</span><span class="tok-o">(</span><span class="tok-nl">matches:</span><span class="tok-s">/\d{2}/</span><span class="tok-o">)</span>
  <span class="tok-o">}</span>
<span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Otro aspecto interesante del mapeo de URLs puede ser la captura de los códigos de error que se producen en el acceso a una aplicación web, como por ejemplo el típico error 404 cuando la página solicitada no existe. En este tipo de casos, estaría bien modificar la típica pantalla de este tipo de errores, por otra en que se mostrará información sobre nuestra aplicación, como por ejemplo un mapa de todas las opciones de la aplicación.</p>
</div>
<div class="paragraph">
<p>Para controlar la información mostrada al producirse estos errores, podemos añadir lo siguiente en el archivo <em>UrlMapping.groovy</em></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-s2">&quot;404&quot;</span><span class="tok-o">(</span><span class="tok-nl">view:</span><span class="tok-s1">&#39;/error&#39;</span><span class="tok-o">)</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>para que sea una página GSP quien se encargue de esta gestión o bien</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-s2">&quot;404&quot;</span><span class="tok-o">(</span><span class="tok-nl">controller:</span><span class="tok-s1">&#39;error&#39;</span><span class="tok-o">,</span> <span class="tok-nl">action:</span><span class="tok-s1">&#39;notFound&#39;</span><span class="tok-o">)</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>para que sea un controlador quien haga este trabajo.</p>
</div>
<div class="paragraph">
<p>Por último, también es muy interesante ver como Grails es capaz de reescribir los enlaces que generamos en nuestra aplicación. Imagina por ejemplo que tenemos la siguiente regla en nuestro archivo <em>UrlMappings.groovy</em></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-kd">static</span> <span class="tok-n">mappings</span> <span class="tok-o">=</span> <span class="tok-o">{</span>
   <span class="tok-s2">&quot;/$blog/$year?/$month?/$day?/$id?&quot;</span><span class="tok-o">(</span><span class="tok-nl">controller:</span><span class="tok-s2">&quot;blog&quot;</span><span class="tok-o">,</span> <span class="tok-nl">action:</span><span class="tok-s2">&quot;show&quot;</span><span class="tok-o">)</span>
<span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Y que en una página GSP tenemos el siguiente código</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-o">&lt;</span><span class="tok-nl">g:</span><span class="tok-n">link</span> <span class="tok-n">controller</span><span class="tok-o">=</span><span class="tok-s2">&quot;blog&quot;</span> <span class="tok-n">action</span><span class="tok-o">=</span><span class="tok-s2">&quot;show&quot;</span> <span class="tok-n">params</span><span class="tok-o">=</span><span class="tok-s2">&quot;[blog:&#39;fred&#39;, year:2014]&quot;</span><span class="tok-o">&gt;</span>
    <span class="tok-n">My</span> <span class="tok-n">Blog</span>
<span class="tok-o">&lt;</span><span class="tok-s">/g:link&gt;</span>

<span class="tok-s">&lt;g:link controller=&quot;blog&quot; action=&quot;show&quot; params=&quot;[blog:&#39;fred&#39;, year:2014, month:10]&quot;&gt;</span>
<span class="tok-s">My Blog - October 2014 Posts</span>
<span class="tok-s">&lt;/</span><span class="tok-nl">g:</span><span class="tok-n">link</span><span class="tok-o">&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Lo que Grails convertiría en lo siguiente</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-o">&lt;</span><span class="tok-n">a</span> <span class="tok-n">href</span><span class="tok-o">=</span><span class="tok-s2">&quot;/fred/2014&quot;</span><span class="tok-o">&gt;</span><span class="tok-n">My</span> <span class="tok-n">Blog</span><span class="tok-o">&lt;</span><span class="tok-s">/a&gt;</span>
<span class="tok-s">&lt;a href=&quot;/</span><span class="tok-n">fred</span><span class="tok-s">/2014/</span><span class="tok-mi">10</span><span class="tok-err">&quot;</span><span class="tok-o">&gt;</span><span class="tok-n">My</span> <span class="tok-n">Blog</span> <span class="tok-o">-</span> <span class="tok-n">October</span> <span class="tok-mi">2014</span> <span class="tok-n">Posts</span><span class="tok-o">&lt;/</span><span class="tok-n">a</span><span class="tok-o">&gt;</span></code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_empaquetamiento_de_aplicaciones">8.2. Empaquetamiento de aplicaciones</h3>
<div class="paragraph">
<p>Al terminar una nueva funcionalidad de una aplicación o una nueva versión de la misma, necesitamos generar el paquete <em>WAR</em> correspondiente a la nueva versión para desplegarla en el servidor de destino.</p>
</div>
<div class="paragraph">
<p>La generación del archivo <em>WAR</em> se realiza simplemente ejecutando el comando <em>grails war</em>, el cual nos generará un archivo con extensión <em>.war</em> con el nombre de la aplicación, en nuestro caso <em>todo</em>, seguido de la versión de la aplicación. En nuestro caso, la primera vez que ejecutemos el comando <em>grails war</em> el fichero generado se llamará <em>todo-0.1.war</em>.</p>
</div>
<div class="paragraph">
<p>Esto sería lo más básico para generar el archivo <em>WAR</em> de la aplicación, sin embargo, lo habitual es hacer alguna cosa más, tal y como se muestra en el siguiente listado.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Actualizar el código fuente del repositorio de control de versiones para asegurarse de que todas las partes del proyecto están actualizadas.</p>
</li>
<li>
<p>Ejecutar los tests de integración, unitarios y funcionales que hayamos implementado para comprobar que todo funciona tal y como esperamos.</p>
</li>
<li>
<p>Incrementar la variable <em>app.version</em> del archivo <em>application.properties</em> manualmente o bien mediante el comando <em>grails set-version 0.2</em>.</p>
</li>
<li>
<p>Limpiar el proyecto de archivos temporales mediante el comando <em>grails clean</em>.</p>
</li>
<li>
<p>Generar el archivo <em>WAR</em> indicándole el entorno donde queremos desplegar este <em>WAR</em>. Por ejemplo, el comando <em>grails prod war</em> crearía un archivo <em>WAR</em> para ser desplegado en nuestro entorno de producción.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Una aplicación Grails empaquetada como un archivo <em>WAR</em> puede ser desplegada en servidores de aplicaciones JAVA EE tales como JBoss (<a href="http://www.jboss.org/" class="bare">http://www.jboss.org/</a>), GlassFish (<a href="https://glassfish.dev.java.net/" class="bare">https://glassfish.dev.java.net/</a>), Apache Geronimo (<a href="http://geronimo.apache.org" class="bare">http://geronimo.apache.org</a>), BEA WebLogic (<a href="http://www.bea.com" class="bare">http://www.bea.com</a>) o IBM WebSphere (<a href="http://www.ibm.com/software/websphere" class="bare">http://www.ibm.com/software/websphere</a>) o incluso en un contenedor web como Apache Tomcat (<a href="http://tomcat.apache.org" class="bare">http://tomcat.apache.org</a>) o Jetty (<a href="http://www.mortbay.com" class="bare">http://www.mortbay.com</a>).</p>
</div>
<div class="paragraph">
<p>Cada uno de estos servidores o contenedores tendrán su propia especificación y forma de desplegar los archivos <em>WAR</em> generados. Unos mediante unos directorios especiales donde copiar los <em>WAR</em>, otros mediante una consola basada en web, otros por línea de comandos e incluso mediante tareas de tipo Ant. En la sección Deployment (<a href="http://www.grails.org/Deployment" class="bare">http://www.grails.org/Deployment</a>) de la web oficial de Grails puedes encontrar información sobre como desplegar los archivos <em>WAR</em> en varios servidores.</p>
</div>
</div>
<div class="sect2">
<h3 id="_otros_comandos_interesantes_de_grails">8.3. Otros comandos interesantes de Grails</h3>
<div class="paragraph">
<p>Durante este módulo dedicado a Grails, han ido apareciendo varios de los comandos más habituales que utilizaremos cuando creemos aplicaciones con Grails. Sin embargo, los comandos vistos hasta ahora no son los únicos y es ahora cuando veremos algunos de ellos. Ten en cuenta también que cuando instalamos plugins, es posible que también se añadan nuevos comandos.</p>
</div>
<div class="paragraph">
<p>Si ejecutamos el comando <em>grails help</em> veremos un listado con todos los posibles comandos que tenemos disponibles en nuestra instalación de Grails. La siguiente tabla muestra los comandos más interesantes que no hemos visto hasta ahora.</p>
</div>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-center valign-middle">Comando</th>
<th class="tableblock halign-left valign-top">Descripción</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-center valign-middle"><p class="tableblock"><em>grails bug-report</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Genera un archivo comprimido en ZIP con los archivos fuente de nuestro proyecto para el caso de que queramos informar de un bug</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-middle"><p class="tableblock"><em>grails clean</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Limpia el directorio <em>tmp</em> de nuestra aplicación. Este comando puede ser combinado con otros comandos como por ejemplo <em>grails clean run-app</em></p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-middle"><p class="tableblock"><em>grails console</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Nos muestra la consola de Groovy que veíamos en la parte del módulo dedicada a este lenguaje de programación.</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-middle"><p class="tableblock"><em>grails doc</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Genera la documentación completa de nuestro proyecto.</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-middle"><p class="tableblock"><em>grails help</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Muestra un listado de comandos disponibles en Grails. Si le pasamos como parámetro uno de esos posibles comandos, nos mostrará información adicional sobre el comando dado. Por ejemplo <em>grails help doc</em></p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-middle"><p class="tableblock"><em>grails list-plugins</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Muestra un listado completo tanto de los plugins disponibles como de los ya instalados en la aplicación.</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-middle"><p class="tableblock"><em>grails plugin-info</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Muestra la información completa del plugin pasado como parámetro al comando.</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-middle"><p class="tableblock"><em>grails run-app -https</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Ejecuta el comando <em>grails run-app</em> utilizando como servidor Tomcat pero sobre un servidor seguro <em>https</em>. El puerto por defecto es 8443 y puede ser modificado añadiendo al comando <em>-Dserver.port.https=&lt;numero_puerto&gt;</em></p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-middle"><p class="tableblock"><em>grails schema-export</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Genera un fichero con las sentencias SQL necesarias para exportar la base de datos.</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-middle"><p class="tableblock"><em>grails set-version</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Establece la versión de la aplicación. Por ejemplo <em>grails set-version 1.0.4</em></p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-middle"><p class="tableblock"><em>grails stats</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Nos muestra una serie de datos referentes a nuestro proyecto, con respecto al número de controladores, clases de dominio, servicios, librerías de etiquetas, tests de integración, etc. y al número de líneas totales en cada apartado.</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-middle"><p class="tableblock"><em>grails uninstall-plugin</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Desinstala el plugin pasado como parámetro de la aplicación.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="_plugins">8.4. Plugins</h3>
<div class="paragraph">
<p>La comunidad de usuarios de Grails es cada vez mayor y eso hace que, cuando una característica no ha sido desarrollada en el núcleo de Grails, sean los propios usuarios quienes se encarguen de desarrollarla como un plugin externo. En el momento en que se escribieron estos apuntes eran casi 1200 los plugins desarrollados por la comunidad (<a href="http://www.grails.org/plugins/" class="bare">http://www.grails.org/plugins/</a>).</p>
</div>
<div class="paragraph">
<p>Estos plugins abarcan aspectos tan diversos como la seguridad como el plugin de Spring Security (<a href="http://www.grails.org/plugin/spring-security-core" class="bare">http://www.grails.org/plugin/spring-security-core</a>), el desarrollo de interfaces gráficas ricas como Rich UI (<a href="http://www.grails.org/plugin/richui" class="bare">http://www.grails.org/plugin/richui</a>) o la exportación de datos a otros formatos con el plugin Export (<a href="http://www.grails.org/plugin/export" class="bare">http://www.grails.org/plugin/export</a>).</p>
</div>
<div class="paragraph">
<p>Para ver el funcionamiento de los plugins en Grails, nosotros vamos a utilizar un plugin que nos permitirá buscar contenido en las clases de dominio de nuestra aplicación sin prácticamente esfuerzo alguno. También utilizaremos el plugin export para exportar la información de nuestras clases de dominio a otros formatos. Pero para empezar, veamos un plugin que nos permitirá utilizar una consola a través de nuestra aplicación para poder realizar todo tipo de operaciones.</p>
</div>
<div class="sect3">
<h4 id="_plugin_console">8.4.1. Plugin console</h4>
<div class="paragraph">
<p>El plugin console no es más un plugin que permite la ejecución en línea de comandos. Desde esta consola tendremos acceso a determinados contextos como pueden ser la propia aplicación o las clases de dominio. Es muy útil cuando queremos realizar operaciones sobre las clases de dominio y no podemos o no queremos tocar la aplicación para esto.</p>
</div>
<div class="paragraph">
<p>La instalación del plugin se realiza con el comando <em>grails install-plugin console</em> o bien editando el archivo de configuración <em>BuildConfig.groovy</em> para añadir el plugin correspondiente:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-n">grails</span><span class="tok-o">.</span><span class="tok-na">project</span><span class="tok-o">.</span><span class="tok-na">dependency</span><span class="tok-o">.</span><span class="tok-na">resolution</span> <span class="tok-o">{</span>
  <span class="tok-o">...</span>
  <span class="tok-n">plugins</span> <span class="tok-o">{</span>
    <span class="tok-o">...</span>
    <span class="tok-n">compile</span> <span class="tok-s2">&quot;:console:1.5.6&quot;</span>
  <span class="tok-o">}</span>
<span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Una vez instalado el plugin y con la aplicación en funcionamiento, podremos acceder a esta consola desde la dirección <em><a href="http://localhost:8080/todo/console" class="bare">http://localhost:8080/todo/console</a></em>.</p>
</div>
<div class="paragraph">
<p>Sin embargo, es probable que, debido a la configuración segura de nuestra aplicación, necesites actualizar las reglas de seguridad para que por ejemplo permita el acceso a esta url a los administradores de la misma.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-n">grails</span><span class="tok-o">.</span><span class="tok-na">plugin</span><span class="tok-o">.</span><span class="tok-na">springsecurity</span><span class="tok-o">.</span><span class="tok-na">controllerAnnotations</span><span class="tok-o">.</span><span class="tok-na">staticRules</span> <span class="tok-o">=</span> <span class="tok-o">[</span>
    <span class="tok-s2">&quot;/console/**&quot;</span><span class="tok-o">:</span>          <span class="tok-o">[</span><span class="tok-s1">&#39;ROLE_ADMIN&#39;</span><span class="tok-o">],</span>
    <span class="tok-s2">&quot;/plugins/console*/**&quot;</span><span class="tok-o">:</span> <span class="tok-o">[</span><span class="tok-s1">&#39;ROLE_ADMIN&#39;</span><span class="tok-o">]</span>
<span class="tok-o">]</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Ten en cuenta que este ejemplo considera que estamos utilizando el método de Spring Security <em>Annotation</em>.</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="images/grails08/console.png" alt="Plugin Console" width="100%">
</div>
</div>
<div class="paragraph">
<p>Con el ejemplo mostrado en la imagen podríamos obtener todos las tareas de nuestra aplicación e imprimirlos por pantalla. Pero además podemos acceder a cualquier artefacto de nuestra aplicación incluidos los servicios, tal y como si estuviéramos ejecutando este código dentro de nuestra aplicación.</p>
</div>
<div class="paragraph">
<p>Las siguientes variables son accesible desde esta consola:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>ctx - el contexto de la aplicación Spring</p>
</li>
<li>
<p>grailsApplication - la instancia de la aplicación Grails</p>
</li>
<li>
<p>config - la configuración Grails</p>
</li>
<li>
<p>request - la petición HTTP actual</p>
</li>
<li>
<p>session - la sesión HTTP actual</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>El objeto <em>ctx</em> sin duda es el más interesante puesto que nos va a permitir acceder al contexto de la aplicación y por consiguiente a varios artefactos como pueden ser los servicios de forma muy sencilla y por ejemplo eliminar tareas directamente.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-n">Todo</span> <span class="tok-n">todo</span> <span class="tok-o">=</span> <span class="tok-n">es</span><span class="tok-o">.</span><span class="tok-na">ua</span><span class="tok-o">.</span><span class="tok-na">expertojava</span><span class="tok-o">.</span><span class="tok-na">todo</span><span class="tok-o">.</span><span class="tok-na">Todo</span><span class="tok-o">.</span><span class="tok-na">get</span><span class="tok-o">(</span><span class="tok-mi">1</span><span class="tok-o">)</span>

<span class="tok-n">ctx</span><span class="tok-o">.</span><span class="tok-na">todoService</span><span class="tok-o">.</span><span class="tok-na">deleteTodo</span><span class="tok-o">(</span><span class="tok-n">todo</span><span class="tok-o">)</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Este plugin es una forma rápida de probar determinadas funcionalidades de nuestra aplicación.</p>
</div>
</div>
<div class="sect3">
<h4 id="_plugin_para_la_búsqueda_de_contenido_searchable">8.4.2. Plugin para la búsqueda de contenido: Searchable</h4>
<div class="paragraph">
<p>Para esta tarea de búsqueda, Grails cuenta con un plugin llamado <em>Searchable</em> que nos va a facilitar muchísimo esta labor. Este plugin además, está basado en el framework OpenSymphony Compass Search Engine (<a href="http://www.opensymphony.com/compass/" class="bare">http://www.opensymphony.com/compass/</a>) y que tiene por detrás a Apache Lucene, con lo que el plugin cuenta con mucho respaldo.</p>
</div>
<div class="paragraph">
<p>Para la instalación de plugin en Grails, debemos modificar el archivo de configuración de configuración <em>BuildConfig.groovy</em> y seguir las instrucciones que vienen en la página del plugin <em><a href="http://grails.org/plugin/searchable" class="bare">http://grails.org/plugin/searchable</a></em>.</p>
</div>
<div class="paragraph">
<p>Estas instrucciones pasan por añadir un nuevo repositorio maven y añadir el plugin en cuestión.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-n">grails</span><span class="tok-o">.</span><span class="tok-na">project</span><span class="tok-o">.</span><span class="tok-na">dependency</span><span class="tok-o">.</span><span class="tok-na">resolution</span> <span class="tok-o">=</span> <span class="tok-o">{</span>
  <span class="tok-o">...</span>

  <span class="tok-n">repositories</span> <span class="tok-o">{</span>
    <span class="tok-o">...</span>
    <span class="tok-n">mavenRepo</span> <span class="tok-s2">&quot;http://repo.grails.org/grails/core&quot;</span>
  <span class="tok-o">}</span>

  <span class="tok-n">plugins</span> <span class="tok-o">{</span>
    <span class="tok-o">...</span>
    <span class="tok-n">compile</span> <span class="tok-s2">&quot;:searchable:0.6.9&quot;</span>
  <span class="tok-o">}</span>
<span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Una vez instalado, podemos comprobar que en la dirección <a href="http://localhost:8080/todo/searchable" class="bare">http://localhost:8080/todo/searchable</a> (habrá que añadir también esta dirección en la configuración segura de nuestra aplicación), tenemos un buscador que se ha generado automáticamente. Sin embargo, si probamos a hacer alguna búsqueda, el buscador nos dirá que no ha encontrada nada. Esto es porque todavía no le hemos dicho al plugin donde debe buscar la información.</p>
</div>
<div class="paragraph">
<p>Si pensamos donde podemos añadir un buscador en nuestra aplicación encontraremos que los usuarios de nuestro aplicación querrán buscar tareas, con lo que debemos indicar en la clases de dominio <em>Todo</em> que necesitamos que nuestro plugin searchable sea capaz de buscar en ella.</p>
</div>
<div class="paragraph">
<p>Para que el plugin <em>searchable</em> sea capaz de encontrar tareas que contengan un determinado texto, necesitamos modificar la clase de dominio <em>Todo</em> y añadirle una nueva propiedad llamada <em>searchable</em>. Esta propiedad es <em>static</em> y debe contener un valor booleano indicando si permitimos la búsqueda o no, con lo que la clase de dominio <em>Todo</em> quedarían así:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-kn">package</span> <span class="tok-n">es</span><span class="tok-o">.</span><span class="tok-na">ua</span><span class="tok-o">.</span><span class="tok-na">expertojava</span><span class="tok-o">.</span><span class="tok-na">todo</span>

<span class="tok-kd">class</span> <span class="tok-nc">Todo</span> <span class="tok-o">{</span>
    <span class="tok-n">String</span> <span class="tok-n">title</span>
    <span class="tok-n">String</span> <span class="tok-n">description</span>
    <span class="tok-n">Date</span> <span class="tok-n">date</span>
    <span class="tok-n">Date</span> <span class="tok-n">reminderDate</span>
    <span class="tok-n">String</span> <span class="tok-n">url</span>
    <span class="tok-n">Boolean</span> <span class="tok-n">done</span> <span class="tok-o">=</span> <span class="tok-kc">false</span>
    <span class="tok-n">Category</span> <span class="tok-n">category</span>

    <span class="tok-n">Date</span> <span class="tok-n">dateCreated</span>
    <span class="tok-n">Date</span> <span class="tok-n">lastUpdated</span>

    <span class="tok-n">Date</span> <span class="tok-n">dateDone</span>

    <span class="tok-n">User</span> <span class="tok-n">user</span>

    <span class="tok-kd">static</span> <span class="tok-n">searchable</span> <span class="tok-o">=</span> <span class="tok-kc">true</span>

    <span class="tok-o">...</span>
<span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Si ahora realizamos alguna búsqueda de prueba, Searchable nos devolverá los resultados encontrados en todas las propiedades de las clases de dominio <em>Todo</em>. Ahora bien, estamos permitiendo que se busque el término de búsqueda en todas las propiedades de las clases de dominio implicadas, algo que no siempre será lo deseado. Para ello, el plugin permite la utilización de dos variables con las que le indicaremos al sistema donde puede buscar o donde no.</p>
</div>
<div class="paragraph">
<p>Estas dos variables son <em>only</em> y <em>except</em> y podemos definirlas de la siguiente forma:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-kd">static</span> <span class="tok-n">searchable</span> <span class="tok-o">=</span> <span class="tok-o">[</span><span class="tok-nl">only:</span> <span class="tok-o">[</span><span class="tok-s1">&#39;title&#39;</span><span class="tok-o">,</span> <span class="tok-s1">&#39;description&#39;</span><span class="tok-o">]]</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>para indicarle que debe buscar en las propiedades <em>title</em> y <em>description</em> o bien mediante:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-kd">static</span> <span class="tok-n">searchable</span> <span class="tok-o">=</span> <span class="tok-o">[</span><span class="tok-nl">except:</span> <span class="tok-s1">&#39;date&#39;</span><span class="tok-o">,</span> <span class="tok-s1">&#39;reminderDate&#39;</span><span class="tok-o">]</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>si lo que queremos es indicarle sólo aquellas propiedades en las que no debemos realizar la búsqueda. En este último caso, buscaremos en todas las propiedades de la clase de dominio <em>Todo</em> excepto en <em>date</em> y <em>reminderDate</em>.</p>
</div>
<div class="paragraph">
<p>En el momento de escribir estos apuntes el plugin tenía un problema para funcionar con Hibernate 4 con lo que vamos a tener que actualizar un par de ficheros para utilizar en su lugar Hibernate 3. Si abrimos el archivo de configuración <em>BuildConfig.groovy</em> veremos como hay una línea indicando</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-n">runtime</span> <span class="tok-s2">&quot;:hibernate4:4.3.10&quot;</span> <span class="tok-c1">// or &quot;:hibernate:3.6.10.18&quot;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>que vamos a tener que modificar para utilizar Hibernate 3. Además, en el archivo de configuración <em>DataSource.groovy</em> encontraremos</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-c1">//cache.region.factory_class = &#39;org.hibernate.cache.SingletonEhCacheRegionFactory&#39; // Hibernate 3</span>
<span class="tok-n">cache</span><span class="tok-o">.</span><span class="tok-na">region</span><span class="tok-o">.</span><span class="tok-na">factory_class</span> <span class="tok-o">=</span> <span class="tok-s1">&#39;org.hibernate.cache.ehcache.SingletonEhCacheRegionFactory&#39;</span> <span class="tok-c1">// Hibernate 4</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>y de igual forma, vamos a tener que modificar para utilizar Hibernate 3 en lugar de Hibernate 4.</p>
</div>
<div class="paragraph">
<p>Con estas modificaciones, si ahora intentamos de nuevo realizar una búsqueda en <em><a href="http://localhost:8080/todo/searchable" class="bare">http://localhost:8080/todo/searchable</a></em> veremos como ya empieza a buscar en los campos <em>title</em> y <em>description</em> de la clase de dominio <em>Todo</em>.</p>
</div>
<div class="paragraph">
<p>Pero si esto se nos queda corto (y posiblemente sea así), podemos utilizar el servicio <em>SearchableService</em>. Además, los métodos de este servicio también están disponibles en las clases de dominio "anotadas" con la variable <em>searchable</em>. Estos son los métodos de los que disponemos:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="https://grails.org/Searchable+Plugin+-+Methods+-+search"><em>search</em></a>: encuentra objetos que cumplen una determinada consulta.</p>
</li>
<li>
<p><a href="https://grails.org/Searchable+Plugin+-+Methods+-+countHits"><em>countHits</em></a>: encuentra el número de objetos que cumplen una determinada consulta.</p>
</li>
<li>
<p><a href="https://grails.org/Searchable+Plugin+-+Methods+-+moreLikeThis"><em>moreLikeThis</em></a>: encuentra objetos similares a la instancia pasada por parámetro.</p>
</li>
<li>
<p><a href="https://grails.org/Searchable+Plugin+-+Methods+-+suggestQuery"><em>suggestQuery</em></a>: sugiere una nueva consulta a partir de la consultada pasada por parámetro.</p>
</li>
<li>
<p><a href="https://grails.org/Searchable+Plugin+-+Methods+-+termFreqs"><em>termsFreqs</em></a>: devuelve la frecuencia para los términos en el índice.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Un ejemplo para buscar en las tareas de nuestra aplicación podría ser el siguiente:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-kt">def</span> <span class="tok-n">searchResult</span> <span class="tok-o">=</span> <span class="tok-n">searchableService</span><span class="tok-o">.</span><span class="tok-na">search</span><span class="tok-o">(</span>
    <span class="tok-s2">&quot;Tests&quot;</span><span class="tok-o">,</span>
    <span class="tok-o">[</span><span class="tok-nl">offset:</span> <span class="tok-mi">0</span><span class="tok-o">,</span> <span class="tok-nl">max:</span> <span class="tok-mi">20</span><span class="tok-o">]</span>
<span class="tok-o">)</span>
<span class="tok-n">println</span> <span class="tok-s2">&quot;${searchResult.total} hits:&quot;</span>
<span class="tok-k">for</span> <span class="tok-o">(</span><span class="tok-n">i</span> <span class="tok-k">in</span> <span class="tok-mi">0</span><span class="tok-o">..&lt;</span><span class="tok-n">searchResult</span><span class="tok-o">.</span><span class="tok-na">results</span><span class="tok-o">.</span><span class="tok-na">size</span><span class="tok-o">())</span> <span class="tok-o">{</span>
    <span class="tok-n">println</span> <span class="tok-s2">&quot;${searchResult.offset + i + 1}: &quot;</span> <span class="tok-o">+</span>
        <span class="tok-s2">&quot;${searchResult.results[i].toString()} &quot;</span> <span class="tok-o">+</span>
        <span class="tok-s2">&quot;(score ${searchResult.scores[i]})&quot;</span>
<span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>o bien, también podemos buscar directamente en la clase de dominio en cuestión.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-c1">//Devuelve un único objeto de tipo Todo</span>
<span class="tok-c1">//que coincidan con la búsqueda realizada</span>
<span class="tok-kt">def</span> <span class="tok-n">todo</span> <span class="tok-o">=</span> <span class="tok-n">Todo</span><span class="tok-o">.</span><span class="tok-na">search</span><span class="tok-o">(</span>
    <span class="tok-s2">&quot;Tests&quot;</span><span class="tok-o">,</span>
    <span class="tok-o">[</span><span class="tok-nl">result:</span> <span class="tok-s1">&#39;top&#39;</span><span class="tok-o">]</span>
<span class="tok-o">)</span>
<span class="tok-k">assert</span> <span class="tok-n">todo</span> <span class="tok-k">instanceof</span> <span class="tok-n">Todo</span>

<span class="tok-c1">//Devuelve todos los objetos de tipo Todo</span>
<span class="tok-c1">//que coincidan con la búsqueda realizada</span>
<span class="tok-kt">def</span> <span class="tok-n">todos</span> <span class="tok-o">=</span> <span class="tok-n">Todo</span><span class="tok-o">.</span><span class="tok-na">search</span><span class="tok-o">(</span>
    <span class="tok-s2">&quot;Tests&quot;</span><span class="tok-o">,</span>
    <span class="tok-o">[</span><span class="tok-nl">reload:</span> <span class="tok-kc">true</span><span class="tok-o">,</span> <span class="tok-nl">result:</span> <span class="tok-s1">&#39;every&#39;</span><span class="tok-o">]</span>
<span class="tok-o">)</span>
<span class="tok-k">assert</span> <span class="tok-n">todos</span><span class="tok-o">.</span><span class="tok-na">each</span> <span class="tok-o">{</span> <span class="tok-n">it</span> <span class="tok-k">instanceof</span> <span class="tok-n">Todo</span> <span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Podemos comprobar estos ejemplos directamente en la consola vista en el plugin anterior.</p>
</div>
<div class="paragraph">
<p>En ocasiones es probable que necesitemos filtrar los resultados de una búsqueda por un determinado parámetro. Por ejemplo, en nuestra aplicación si quisiéramos buscar aquellas tareas que pertenezcan a la categoría "Hogar", deberíamos tener algo así:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-kt">def</span> <span class="tok-n">todos</span> <span class="tok-o">=</span> <span class="tok-n">Todo</span><span class="tok-o">.</span><span class="tok-na">search</span><span class="tok-o">([</span><span class="tok-nl">result:</span><span class="tok-s1">&#39;every&#39;</span><span class="tok-o">])</span> <span class="tok-o">{</span>
    <span class="tok-n">must</span><span class="tok-o">(</span><span class="tok-n">queryString</span><span class="tok-o">(</span><span class="tok-n">params</span><span class="tok-o">.</span><span class="tok-na">q</span><span class="tok-o">))</span>
    <span class="tok-n">must</span><span class="tok-o">(</span><span class="tok-n">term</span><span class="tok-o">(</span><span class="tok-s1">&#39;$/Todo/category/id&#39;</span><span class="tok-o">,</span><span class="tok-n">Category</span><span class="tok-o">.</span><span class="tok-na">findByName</span><span class="tok-o">(</span><span class="tok-s2">&quot;Hogar&quot;</span><span class="tok-o">)?.</span><span class="tok-na">id</span><span class="tok-o">))</span>
<span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Debemos también especificar que entre las propiedades a buscar en la clase de dominio Todo se encuentra la propiedad <em>category</em> y la clase <em>Category</em> también tendrá la propiedad estática <em>searchable</em> a cierto para que nos permitan buscar en las instancias de esta clase.</p>
</div>
</div>
<div class="sect3">
<h4 id="_plugin_para_exportar_a_otros_formatos_export">8.4.3. Plugin para exportar a otros formatos: Export</h4>
<div class="paragraph">
<p>Hoy en día, cualquier aplicación que se precie debe ser capaz de exportar sus datos a otros formatos para que el usuario tenga la comodidad de elegir como quiere utilizar los datos. Los formatos más comunes a exportar la información de nuestra aplicación será <em>pdf</em>, <em>hojas de cálculo excel</em>, <em>csv (datos separados por comas)</em> u <em>ods (la hoja de cálculo de OpenOffice)</em>.</p>
</div>
<div class="paragraph">
<p>Esta tarea que en otros sistemas se vuelve complicada y pesada, en Grails podemos solucionarla utilizando un plugin disponible llamado <em>export</em>. Como siempre, lo primero que vamos a hacer es instalarlo añadiendo la siguiente línea a nuestro archivo <em>BuildConfig.groovy</em>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-n">grails</span><span class="tok-o">.</span><span class="tok-na">project</span><span class="tok-o">.</span><span class="tok-na">dependency</span><span class="tok-o">.</span><span class="tok-na">resolution</span> <span class="tok-o">=</span> <span class="tok-o">{</span>
  <span class="tok-o">...</span>

  <span class="tok-n">repositories</span> <span class="tok-o">{</span>
    <span class="tok-o">...</span>
    <span class="tok-n">mavenRepo</span> <span class="tok-s2">&quot;http://repo.grails.org/grails/core&quot;</span>
  <span class="tok-o">}</span>

  <span class="tok-n">dependencies</span> <span class="tok-o">{</span>
    <span class="tok-o">...</span>
    <span class="tok-n">compile</span> <span class="tok-s1">&#39;commons-beanutils:commons-beanutils:1.8.3&#39;</span>
  <span class="tok-o">}</span>
  <span class="tok-n">plugins</span> <span class="tok-o">{</span>
    <span class="tok-o">...</span>
    <span class="tok-n">compile</span> <span class="tok-s2">&quot;:export:1.7-SNAPSHOT&quot;</span>
  <span class="tok-o">}</span>
<span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Una vez instalado el plugin <em>export</em> debemos añadir algunos <em>mime types</em> en la variable <em>grails.mime.types</em> del archivo <em>Config.groovy</em>. Los nuevos <em>mime types</em> serán los relativos a <em>csv</em>, <em>excel</em>, <em>pdf</em> y <em>ods</em>. La variable <em>grails.mime.types</em> quedaría así:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-n">grails</span><span class="tok-o">.</span><span class="tok-na">mime</span><span class="tok-o">.</span><span class="tok-na">types</span> <span class="tok-o">=</span> <span class="tok-o">[</span>
    <span class="tok-nl">all:</span>           <span class="tok-s1">&#39;*/*&#39;</span><span class="tok-o">,</span>
    <span class="tok-nl">atom:</span>          <span class="tok-s1">&#39;application/atom+xml&#39;</span><span class="tok-o">,</span>
    <span class="tok-nl">css:</span>           <span class="tok-s1">&#39;text/css&#39;</span><span class="tok-o">,</span>
    <span class="tok-nl">csv:</span>           <span class="tok-s1">&#39;text/csv&#39;</span><span class="tok-o">,</span>
    <span class="tok-nl">pdf:</span>           <span class="tok-s1">&#39;application/pdf&#39;</span><span class="tok-o">,</span>
    <span class="tok-nl">excel:</span>         <span class="tok-s1">&#39;application/vnd.ms-excel&#39;</span><span class="tok-o">,</span>
    <span class="tok-nl">ods:</span>           <span class="tok-s1">&#39;application/vnd.oasis.opendocument.spreadsheet&#39;</span><span class="tok-o">,</span>
    <span class="tok-nl">form:</span>          <span class="tok-s1">&#39;application/x-www-form-urlencoded&#39;</span><span class="tok-o">,</span>
    <span class="tok-nl">html:</span>          <span class="tok-o">[</span><span class="tok-s1">&#39;text/html&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;application/xhtml+xml&#39;</span><span class="tok-o">],</span>
    <span class="tok-nl">js:</span>            <span class="tok-s1">&#39;text/javascript&#39;</span><span class="tok-o">,</span>
    <span class="tok-nl">json:</span>          <span class="tok-o">[</span><span class="tok-s1">&#39;application/json&#39;</span><span class="tok-o">,</span> <span class="tok-s1">&#39;text/json&#39;</span><span class="tok-o">],</span>
    <span class="tok-nl">multipartForm:</span> <span class="tok-s1">&#39;multipart/form-data&#39;</span><span class="tok-o">,</span>
    <span class="tok-nl">rss:</span>           <span class="tok-s1">&#39;application/rss+xml&#39;</span><span class="tok-o">,</span>
    <span class="tok-nl">text:</span>          <span class="tok-s1">&#39;text/plain&#39;</span><span class="tok-o">,</span>
    <span class="tok-nl">hal:</span>           <span class="tok-o">[</span><span class="tok-s1">&#39;application/hal+json&#39;</span><span class="tok-o">,</span><span class="tok-s1">&#39;application/hal+xml&#39;</span><span class="tok-o">],</span>
    <span class="tok-nl">xml:</span>           <span class="tok-o">[</span><span class="tok-s1">&#39;text/xml&#39;</span><span class="tok-o">,</span> <span class="tok-s1">&#39;application/xml&#39;</span><span class="tok-o">]</span>
<span class="tok-o">]</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Para empezar a utilizar el plugin, debemos incluir la etiqueta <em>&lt;export:resource/&gt;</em> en la cabecera del archivo GSP donde queramos incluir las opciones para exportar. Esto incluirá los archivos CSS necesarios para crear una barra de herramientas con las opciones para exportar la página actual.</p>
</div>
<div class="paragraph">
<p>El siguiente paso consistirá en incluir la barra de herramientas necesaria para exportar la página HTML generada a algún formato de los ya comentados. Para esto el plugin pone a nuestra disposición una nueva etiqueta <em>&lt;export:formats /&gt;</em>, la cual acepta como parámetro un listado de los formatos a los que queremos exportar la página, como por ejemplo <em>&lt;export:formats formats="['csv','excel','ods','pdf','xml']"/&gt;</em>.</p>
</div>
<div class="paragraph">
<p>Si queremos añadir por ejemplo en la página que contiene el listado de las tareas una barra para exportar dicho listado, podríamos tener algo así en la página <em>grails-app/views/todo/index.gsp</em>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-o">&lt;</span><span class="tok-n">html</span><span class="tok-o">&gt;</span>
  <span class="tok-o">&lt;</span><span class="tok-n">head</span><span class="tok-o">&gt;</span>
    <span class="tok-o">...</span>
    <span class="tok-o">&lt;</span><span class="tok-nl">export:</span><span class="tok-n">resource</span><span class="tok-s">/&gt;</span>
<span class="tok-s">  &lt;/</span><span class="tok-n">head</span><span class="tok-o">&gt;</span>
  <span class="tok-o">&lt;</span><span class="tok-n">body</span><span class="tok-o">&gt;</span>
    <span class="tok-o">...</span>
      <span class="tok-o">&lt;</span><span class="tok-n">h1</span><span class="tok-o">&gt;&lt;</span><span class="tok-nl">g:</span><span class="tok-n">message</span> <span class="tok-n">code</span><span class="tok-o">=</span><span class="tok-s2">&quot;default.list.label&quot;</span> <span class="tok-n">args</span><span class="tok-o">=</span><span class="tok-s2">&quot;[entityName]&quot;</span> <span class="tok-s">/&gt;&lt;/</span><span class="tok-n">h1</span><span class="tok-o">&gt;</span>
      <span class="tok-o">&lt;</span><span class="tok-nl">g:</span><span class="tok-k">if</span> <span class="tok-n">test</span><span class="tok-o">=</span><span class="tok-s2">&quot;${flash.message}&quot;</span><span class="tok-o">&gt;</span>
        <span class="tok-o">&lt;</span><span class="tok-n">div</span> <span class="tok-n">class</span><span class="tok-o">=</span><span class="tok-s2">&quot;message&quot;</span> <span class="tok-n">role</span><span class="tok-o">=</span><span class="tok-s2">&quot;status&quot;</span><span class="tok-o">&gt;</span><span class="tok-n">$</span><span class="tok-o">{</span><span class="tok-n">flash</span><span class="tok-o">.</span><span class="tok-na">message</span><span class="tok-o">}&lt;</span><span class="tok-s">/div&gt;</span>
<span class="tok-s">      &lt;/</span><span class="tok-nl">g:</span><span class="tok-k">if</span><span class="tok-o">&gt;</span>
      <span class="tok-o">&lt;</span><span class="tok-nl">export:</span><span class="tok-n">formats</span> <span class="tok-n">formats</span><span class="tok-o">=</span><span class="tok-s2">&quot;[&#39;csv&#39;, &#39;excel&#39;, &#39;ods&#39;, &#39;pdf&#39;, &#39;xml&#39;]&quot;</span> <span class="tok-s">/&gt;</span>
<span class="tok-s">    ...</span>
<span class="tok-s">  &lt;/</span><span class="tok-n">body</span><span class="tok-o">&gt;</span>
<span class="tok-o">&lt;/</span><span class="tok-n">html</span><span class="tok-o">&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Si echamos un vistazo al listado de tareas comprobaremos como en la parte superior de los mismos aparecerá una barra con los formatos a los que podamos exportar dicho listado.</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="images/grails08/exportbar.png" alt="Barra para exportar a varios formatos" width="50%">
</div>
</div>
<div class="paragraph">
<p>Sin embargo, si intentamos exportar el listado a cualquier de los formatos utilizados, veremos como no sucede nada nuevo y la aplicación vuelve a mostrarnos el listado tal y como ha aparecido siempre, es decir, en formato HTML. Para que la aplicación pueda exportar a los nuevos formatos, debemos modificar el controlador de la clase de dominio <em>Todo</em> y más en concreto el método <em>index()</em> para que acepte los nuevos formatos.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-kn">package</span> <span class="tok-n">es</span><span class="tok-o">.</span><span class="tok-na">ua</span><span class="tok-o">.</span><span class="tok-na">expertojava</span><span class="tok-o">.</span><span class="tok-na">todo</span>



<span class="tok-kn">import</span> <span class="tok-nn">static</span> <span class="tok-n">org</span><span class="tok-o">.</span><span class="tok-na">springframework</span><span class="tok-o">.</span><span class="tok-na">http</span><span class="tok-o">.</span><span class="tok-na">HttpStatus</span><span class="tok-o">.*</span>
<span class="tok-kn">import</span> <span class="tok-nn">grails.transaction.Transactional</span>

<span class="tok-nd">@Transactional</span><span class="tok-o">(</span><span class="tok-n">readOnly</span> <span class="tok-o">=</span> <span class="tok-kc">true</span><span class="tok-o">)</span>
<span class="tok-kd">class</span> <span class="tok-nc">TodoController</span> <span class="tok-o">{</span>

    <span class="tok-kt">def</span> <span class="tok-n">todoService</span>
    <span class="tok-kt">def</span> <span class="tok-n">springSecurityService</span>
    <span class="tok-kt">def</span> <span class="tok-n">exportService</span>

    <span class="tok-kd">static</span> <span class="tok-n">allowedMethods</span> <span class="tok-o">=</span> <span class="tok-o">[</span><span class="tok-nl">save:</span> <span class="tok-s2">&quot;POST&quot;</span><span class="tok-o">,</span> <span class="tok-nl">update:</span> <span class="tok-s2">&quot;PUT&quot;</span><span class="tok-o">,</span> <span class="tok-nl">delete:</span> <span class="tok-s2">&quot;DELETE&quot;</span><span class="tok-o">]</span>

    <span class="tok-kt">def</span> <span class="tok-nf">index</span><span class="tok-o">(</span><span class="tok-n">Integer</span> <span class="tok-n">max</span><span class="tok-o">)</span> <span class="tok-o">{</span>
        <span class="tok-n">params</span><span class="tok-o">.</span><span class="tok-na">max</span> <span class="tok-o">=</span> <span class="tok-n">Math</span><span class="tok-o">.</span><span class="tok-na">min</span><span class="tok-o">(</span><span class="tok-n">max</span> <span class="tok-o">?:</span> <span class="tok-mi">10</span><span class="tok-o">,</span> <span class="tok-mi">100</span><span class="tok-o">)</span>
        <span class="tok-k">if</span><span class="tok-o">(</span><span class="tok-n">params</span><span class="tok-o">?.</span><span class="tok-na">f</span> <span class="tok-o">&amp;&amp;</span> <span class="tok-n">params</span><span class="tok-o">.</span><span class="tok-na">f</span> <span class="tok-o">!=</span> <span class="tok-s2">&quot;html&quot;</span><span class="tok-o">){</span>
            <span class="tok-n">response</span><span class="tok-o">.</span><span class="tok-na">contentType</span> <span class="tok-o">=</span> <span class="tok-n">grailsApplication</span><span class="tok-o">.</span><span class="tok-na">config</span><span class="tok-o">.</span><span class="tok-na">grails</span><span class="tok-o">.</span><span class="tok-na">mime</span><span class="tok-o">.</span><span class="tok-na">types</span><span class="tok-o">[</span><span class="tok-n">params</span><span class="tok-o">.</span><span class="tok-na">f</span><span class="tok-o">]</span>
            <span class="tok-n">response</span><span class="tok-o">.</span><span class="tok-na">setHeader</span><span class="tok-o">(</span><span class="tok-s2">&quot;Content-disposition&quot;</span><span class="tok-o">,</span> <span class="tok-s2">&quot;attachment; filename=todos.${params.extension}&quot;</span><span class="tok-o">)</span>
            <span class="tok-n">exportService</span><span class="tok-o">.</span><span class="tok-na">export</span><span class="tok-o">(</span><span class="tok-n">params</span><span class="tok-o">.</span><span class="tok-na">f</span><span class="tok-o">,</span> <span class="tok-n">response</span><span class="tok-o">.</span><span class="tok-na">outputStream</span><span class="tok-o">,</span> <span class="tok-n">Todo</span><span class="tok-o">.</span><span class="tok-na">findAllByUser</span><span class="tok-o">(</span><span class="tok-n">springSecurityService</span><span class="tok-o">.</span><span class="tok-na">currentUser</span><span class="tok-o">,</span> <span class="tok-n">params</span><span class="tok-o">),</span> <span class="tok-o">[:],</span> <span class="tok-o">[:])</span>
        <span class="tok-o">}</span>
        <span class="tok-n">respond</span> <span class="tok-n">Todo</span><span class="tok-o">.</span><span class="tok-na">findAllByUser</span><span class="tok-o">(</span><span class="tok-n">springSecurityService</span><span class="tok-o">.</span><span class="tok-na">currentUser</span><span class="tok-o">,</span> <span class="tok-n">params</span><span class="tok-o">),</span> <span class="tok-nl">model:</span><span class="tok-o">[</span><span class="tok-nl">todoInstanceCount:</span> <span class="tok-n">Todo</span><span class="tok-o">.</span><span class="tok-na">countByUser</span><span class="tok-o">(</span><span class="tok-n">springSecurityService</span><span class="tok-o">.</span><span class="tok-na">currentUser</span><span class="tok-o">)]</span>
    <span class="tok-o">}</span>
  <span class="tok-o">...</span>
<span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Ahora nuestra aplicación sí va a ser capaz de exportar a otros formatos para que el usuario final elija cual de ellos utilizar en cada ocasión. Sin embargo, si echamos un vistazo por ejemplo al formato en PDF, comprobaremos como el listado que aparece muestra todas las propiedades de la clase <em>Todo</em>, a excepción de la propiedad <em>version</em>, lo cual no va a ser aconsejable.</p>
</div>
<div class="paragraph">
<p>Para mejorar esto, el plugin permite especificar que propiedades queremos mostrar e incluso la etiqueta que queremos que aparezca en la fila de encabezados de la tabla. Para conseguir esto, necesitamos completar los dos últimos parámetros del método <em>export()</em> que anteriormente dejábamos vacíos. Además, también necesitaremos indicarle el formato de como deseamos las propiedades de los usuarios y un mapa de parámetros para el fichero exportado. Así quedaría el método <em>index()</em>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-kt">def</span> <span class="tok-nf">index</span><span class="tok-o">(</span><span class="tok-n">Integer</span> <span class="tok-n">max</span><span class="tok-o">)</span> <span class="tok-o">{</span>
    <span class="tok-n">params</span><span class="tok-o">.</span><span class="tok-na">max</span> <span class="tok-o">=</span> <span class="tok-n">Math</span><span class="tok-o">.</span><span class="tok-na">min</span><span class="tok-o">(</span><span class="tok-n">max</span> <span class="tok-o">?:</span> <span class="tok-mi">10</span><span class="tok-o">,</span> <span class="tok-mi">100</span><span class="tok-o">)</span>
    <span class="tok-k">if</span><span class="tok-o">(</span><span class="tok-n">params</span><span class="tok-o">?.</span><span class="tok-na">f</span> <span class="tok-o">&amp;&amp;</span> <span class="tok-n">params</span><span class="tok-o">.</span><span class="tok-na">f</span> <span class="tok-o">!=</span> <span class="tok-s2">&quot;html&quot;</span><span class="tok-o">){</span>
        <span class="tok-n">response</span><span class="tok-o">.</span><span class="tok-na">contentType</span> <span class="tok-o">=</span> <span class="tok-n">grailsApplication</span><span class="tok-o">.</span><span class="tok-na">config</span><span class="tok-o">.</span><span class="tok-na">grails</span><span class="tok-o">.</span><span class="tok-na">mime</span><span class="tok-o">.</span><span class="tok-na">types</span><span class="tok-o">[</span><span class="tok-n">params</span><span class="tok-o">.</span><span class="tok-na">f</span><span class="tok-o">]</span>
        <span class="tok-n">response</span><span class="tok-o">.</span><span class="tok-na">setHeader</span><span class="tok-o">(</span><span class="tok-s2">&quot;Content-disposition&quot;</span><span class="tok-o">,</span> <span class="tok-s2">&quot;attachment; filename=todos.${params.extension}&quot;</span><span class="tok-o">)</span>

        <span class="tok-n">List</span> <span class="tok-n">props</span> <span class="tok-o">=</span> <span class="tok-o">[</span><span class="tok-s2">&quot;title&quot;</span><span class="tok-o">,</span> <span class="tok-s2">&quot;description&quot;</span><span class="tok-o">,</span> <span class="tok-s2">&quot;date&quot;</span><span class="tok-o">,</span> <span class="tok-s2">&quot;url&quot;</span><span class="tok-o">,</span> <span class="tok-s2">&quot;done&quot;</span><span class="tok-o">]</span>
        <span class="tok-n">Map</span> <span class="tok-n">tags</span> <span class="tok-o">=</span> <span class="tok-o">[</span><span class="tok-s2">&quot;title&quot;</span><span class="tok-o">:</span><span class="tok-s2">&quot;Título&quot;</span><span class="tok-o">,</span>
                     <span class="tok-s2">&quot;description&quot;</span><span class="tok-o">:</span><span class="tok-s2">&quot;Descripción&quot;</span><span class="tok-o">,</span>
                     <span class="tok-s2">&quot;date&quot;</span><span class="tok-o">:</span><span class="tok-s2">&quot;Fecha&quot;</span><span class="tok-o">,</span>
                     <span class="tok-s2">&quot;url&quot;</span><span class="tok-o">:</span><span class="tok-s2">&quot;URL&quot;</span><span class="tok-o">,</span>
                     <span class="tok-s2">&quot;done&quot;</span><span class="tok-o">:</span><span class="tok-s2">&quot;Hecho&quot;</span><span class="tok-o">]</span>

        <span class="tok-c1">// Closure formateador</span>
        <span class="tok-kt">def</span> <span class="tok-n">uppercase</span> <span class="tok-o">=</span> <span class="tok-o">{</span> <span class="tok-n">domain</span><span class="tok-o">,</span> <span class="tok-n">value</span> <span class="tok-o">-&gt;</span>  <span class="tok-k">return</span> <span class="tok-n">value</span><span class="tok-o">.</span><span class="tok-na">toUpperCase</span><span class="tok-o">()</span> <span class="tok-o">}</span>

        <span class="tok-n">Map</span> <span class="tok-n">formatters</span> <span class="tok-o">=</span> <span class="tok-o">[</span><span class="tok-nl">title:</span> <span class="tok-n">uppercase</span><span class="tok-o">]</span>
        <span class="tok-n">Map</span> <span class="tok-n">parameters</span> <span class="tok-o">=</span> <span class="tok-o">[</span><span class="tok-nl">title:</span> <span class="tok-s2">&quot;LISTADO DE USUARIOS&quot;</span><span class="tok-o">]</span>

        <span class="tok-n">exportService</span><span class="tok-o">.</span><span class="tok-na">export</span><span class="tok-o">(</span><span class="tok-n">params</span><span class="tok-o">.</span><span class="tok-na">f</span><span class="tok-o">,</span> <span class="tok-n">response</span><span class="tok-o">.</span><span class="tok-na">outputStream</span><span class="tok-o">,</span>
            <span class="tok-n">Todo</span><span class="tok-o">.</span><span class="tok-na">findAllByUser</span><span class="tok-o">(</span><span class="tok-n">springSecurityService</span><span class="tok-o">.</span><span class="tok-na">currentUser</span><span class="tok-o">,</span> <span class="tok-n">params</span><span class="tok-o">),</span> <span class="tok-n">props</span><span class="tok-o">,</span> <span class="tok-n">tags</span><span class="tok-o">,</span>
            <span class="tok-n">formatters</span><span class="tok-o">,</span> <span class="tok-n">parameters</span><span class="tok-o">)</span>
    <span class="tok-o">}</span>
    <span class="tok-n">respond</span> <span class="tok-n">Todo</span><span class="tok-o">.</span><span class="tok-na">findAllByUser</span><span class="tok-o">(</span><span class="tok-n">springSecurityService</span><span class="tok-o">.</span><span class="tok-na">currentUser</span><span class="tok-o">,</span> <span class="tok-n">params</span><span class="tok-o">),</span> <span class="tok-nl">model:</span><span class="tok-o">[</span><span class="tok-nl">todoInstanceCount:</span> <span class="tok-n">Todo</span><span class="tok-o">.</span><span class="tok-na">countByUser</span><span class="tok-o">(</span><span class="tok-n">springSecurityService</span><span class="tok-o">.</span><span class="tok-na">currentUser</span><span class="tok-o">)]</span>
<span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Por último, comentar también que podemos cambiar los textos asociados a cada uno de los formatos que aparecen en la barra para exportar. Simplemente debemos crear nuevas entradas en el archivo <em>grails-app/i18n/messages.properties</em> correspondientes, tal y como aparece en el siguiente fragmento de código.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span class="tok-k">default</span><span class="tok-o">.</span><span class="tok-na">csv</span> <span class="tok-o">=</span> <span class="tok-n">CSV</span>
<span class="tok-k">default</span><span class="tok-o">.</span><span class="tok-na">excel</span> <span class="tok-o">=</span> <span class="tok-n">EXCEL</span>
<span class="tok-k">default</span><span class="tok-o">.</span><span class="tok-na">pdf</span> <span class="tok-o">=</span> <span class="tok-n">PDF</span>
<span class="tok-k">default</span><span class="tok-o">.</span><span class="tok-na">xml</span> <span class="tok-o">=</span> <span class="tok-n">XML</span>
<span class="tok-k">default</span><span class="tok-o">.</span><span class="tok-na">ods</span> <span class="tok-o">=</span> <span class="tok-n">ODS</span></code></pre>
</div>
</div>
<div style="page-break-after: always;"></div>
</div>
</div>
<div class="sect2">
<h3 id="_ejercicios">8.5. Ejercicios</h3>
<div class="sect3">
<h4 id="_log_de_acceso_a_controladores_0_25_puntos">8.5.1. Log de acceso a controladores (0.25 puntos)</h4>
<div class="paragraph">
<p>Con lo visto en esta sesión sobre la configuración de los logs y lo visto en la sesión 4 de los filtros que se pueden crear en los controladores, genera logs de tipo <em>trace</em> en todos los métodos de los controladores de nuestra aplicación (sin incluir los controladores <em>login</em> y <em>logout</em> del plugin spring security) para saber el usuario, controlador, método y modelo utilizados en la petición.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="bash">2015-03-28 11:13:15,863 <span class="tok-o">[</span>http-bio-8080-exec-9<span class="tok-o">]</span> TRACE todo.LogFilters  - User admin - Controlador category - Accion index - Modelo <span class="tok-o">[</span>categoryInstanceCount:2, categoryInstanceList:<span class="tok-o">[</span>Hogar, Trabajo<span class="tok-o">]]</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Estos logs deberán ser almacenados en un archivo llamados <em>logs/filters.log</em>.</p>
</div>
</div>
<div class="sect3">
<h4 id="_url_limpia_y_pública_para_las_tareas_de_los_usuarios_0_50_puntos">8.5.2. URL limpia y pública para las tareas de los usuarios (0.50 puntos)</h4>
<div class="paragraph">
<p>Crea una url del tipo <em>/todos/$username</em> como la vista en la parte de teoría que muestre todas las tareas del usuario pasado por parámetro en la URL. Este listado de tareas sólo podrá ser accesible por los usuarios de tipo administrador.</p>
</div>
<div class="paragraph">
<p>Modifica también el listado de usuarios que pueden ver los administradores para mostrar un enlace en cada usuario para que les permita ver este listado de tareas. Además, este enlace sólo debe ser mostrado para los usuarios que puedan tener tareas, no para los administradores.</p>
</div>
</div>
<div class="sect3">
<h4 id="_buscador_de_tareas_integrado_0_50_puntos">8.5.3. Buscador de tareas integrado (0.50 puntos)</h4>
<div class="paragraph">
<p>El listado de tareas pide a gritos un buscador integrado. Impleméntalo utilizando el plugin <em>searchable</em> y muéstralo en la parte superior del listado de las tareas. Date cuenta que las tareas están ahora asignadas a un usuario y que por lo tanto, el buscador sólo deberá buscar aquellas tareas que pertenezcan al usuario autenticado.</p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Estoy seguro que no hace falta que te lo recuerde, pero antes de entregar el proyecto ejecuta <em>grails test-app unit:</em> para comprobar que no hayas <em>roto</em> tus tests haciendo otras tareas.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
</div>
</div>
</div>
<div id="footer">
<div id="footer-text">
Last updated 2015-10-05 20:14:58 CEST
</div>
</div>
</body>
</html>