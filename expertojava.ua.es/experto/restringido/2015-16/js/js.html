<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<!--[if IE]><meta http-equiv="X-UA-Compatible" content="IE=edge"><![endif]-->
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 1.5.2">
<meta name="author" content="Aitor Medrano">
<title>JavaScript</title>
<style>/*! normalize.css v2.1.2 | MIT License | git.io/normalize */
/* ========================================================================== HTML5 display definitions ========================================================================== */
/** Correct `block` display not defined in IE 8/9. */
article, aside, details, figcaption, figure, footer, header, hgroup, main, nav, section, summary { display: block; }

/** Correct `inline-block` display not defined in IE 8/9. */
audio, canvas, video { display: inline-block; }

/** Prevent modern browsers from displaying `audio` without controls. Remove excess height in iOS 5 devices. */
audio:not([controls]) { display: none; height: 0; }

/** Address `[hidden]` styling not present in IE 8/9. Hide the `template` element in IE, Safari, and Firefox < 22. */
[hidden], template { display: none; }

script { display: none !important; }

/* ========================================================================== Base ========================================================================== */
/** 1. Set default font family to sans-serif. 2. Prevent iOS text size adjust after orientation change, without disabling user zoom. */
html { font-family: sans-serif; /* 1 */ -ms-text-size-adjust: 100%; /* 2 */ -webkit-text-size-adjust: 100%; /* 2 */ }

/** Remove default margin. */
body { margin: 0; }

/* ========================================================================== Links ========================================================================== */
/** Remove the gray background color from active links in IE 10. */
a { background: transparent; }

/** Address `outline` inconsistency between Chrome and other browsers. */
a:focus { outline: thin dotted; }

/** Improve readability when focused and also mouse hovered in all browsers. */
a:active, a:hover { outline: 0; }

/* ========================================================================== Typography ========================================================================== */
/** Address variable `h1` font-size and margin within `section` and `article` contexts in Firefox 4+, Safari 5, and Chrome. */
h1 { font-size: 2em; margin: 0.67em 0; }

/** Address styling not present in IE 8/9, Safari 5, and Chrome. */
abbr[title] { border-bottom: 1px dotted; }

/** Address style set to `bolder` in Firefox 4+, Safari 5, and Chrome. */
b, strong { font-weight: bold; }

/** Address styling not present in Safari 5 and Chrome. */
dfn { font-style: italic; }

/** Address differences between Firefox and other browsers. */
hr { -moz-box-sizing: content-box; box-sizing: content-box; height: 0; }

/** Address styling not present in IE 8/9. */
mark { background: #ff0; color: #000; }

/** Correct font family set oddly in Safari 5 and Chrome. */
code, kbd, pre, samp { font-family: monospace, serif; font-size: 1em; }

/** Improve readability of pre-formatted text in all browsers. */
pre { white-space: pre-wrap; }

/** Set consistent quote types. */
q { quotes: "\201C" "\201D" "\2018" "\2019"; }

/** Address inconsistent and variable font size in all browsers. */
small { font-size: 80%; }

/** Prevent `sub` and `sup` affecting `line-height` in all browsers. */
sub, sup { font-size: 75%; line-height: 0; position: relative; vertical-align: baseline; }

sup { top: -0.5em; }

sub { bottom: -0.25em; }

/* ========================================================================== Embedded content ========================================================================== */
/** Remove border when inside `a` element in IE 8/9. */
img { border: 0; }

/** Correct overflow displayed oddly in IE 9. */
svg:not(:root) { overflow: hidden; }

/* ========================================================================== Figures ========================================================================== */
/** Address margin not present in IE 8/9 and Safari 5. */
figure { margin: 0; }

/* ========================================================================== Forms ========================================================================== */
/** Define consistent border, margin, and padding. */
fieldset { border: 1px solid #c0c0c0; margin: 0 2px; padding: 0.35em 0.625em 0.75em; }

/** 1. Correct `color` not being inherited in IE 8/9. 2. Remove padding so people aren't caught out if they zero out fieldsets. */
legend { border: 0; /* 1 */ padding: 0; /* 2 */ }

/** 1. Correct font family not being inherited in all browsers. 2. Correct font size not being inherited in all browsers. 3. Address margins set differently in Firefox 4+, Safari 5, and Chrome. */
button, input, select, textarea { font-family: inherit; /* 1 */ font-size: 100%; /* 2 */ margin: 0; /* 3 */ }

/** Address Firefox 4+ setting `line-height` on `input` using `!important` in the UA stylesheet. */
button, input { line-height: normal; }

/** Address inconsistent `text-transform` inheritance for `button` and `select`. All other form control elements do not inherit `text-transform` values. Correct `button` style inheritance in Chrome, Safari 5+, and IE 8+. Correct `select` style inheritance in Firefox 4+ and Opera. */
button, select { text-transform: none; }

/** 1. Avoid the WebKit bug in Android 4.0.* where (2) destroys native `audio` and `video` controls. 2. Correct inability to style clickable `input` types in iOS. 3. Improve usability and consistency of cursor style between image-type `input` and others. */
button, html input[type="button"], input[type="reset"], input[type="submit"] { -webkit-appearance: button; /* 2 */ cursor: pointer; /* 3 */ }

/** Re-set default cursor for disabled elements. */
button[disabled], html input[disabled] { cursor: default; }

/** 1. Address box sizing set to `content-box` in IE 8/9. 2. Remove excess padding in IE 8/9. */
input[type="checkbox"], input[type="radio"] { box-sizing: border-box; /* 1 */ padding: 0; /* 2 */ }

/** 1. Address `appearance` set to `searchfield` in Safari 5 and Chrome. 2. Address `box-sizing` set to `border-box` in Safari 5 and Chrome (include `-moz` to future-proof). */
input[type="search"] { -webkit-appearance: textfield; /* 1 */ -moz-box-sizing: content-box; -webkit-box-sizing: content-box; /* 2 */ box-sizing: content-box; }

/** Remove inner padding and search cancel button in Safari 5 and Chrome on OS X. */
input[type="search"]::-webkit-search-cancel-button, input[type="search"]::-webkit-search-decoration { -webkit-appearance: none; }

/** Remove inner padding and border in Firefox 4+. */
button::-moz-focus-inner, input::-moz-focus-inner { border: 0; padding: 0; }

/** 1. Remove default vertical scrollbar in IE 8/9. 2. Improve readability and alignment in all browsers. */
textarea { overflow: auto; /* 1 */ vertical-align: top; /* 2 */ }

/* ========================================================================== Tables ========================================================================== */
/** Remove most spacing between table cells. */
table { border-collapse: collapse; border-spacing: 0; }

meta.foundation-mq-small { font-family: "only screen and (min-width: 768px)"; width: 768px; }

meta.foundation-mq-medium { font-family: "only screen and (min-width:1280px)"; width: 1280px; }

meta.foundation-mq-large { font-family: "only screen and (min-width:1440px)"; width: 1440px; }

*, *:before, *:after { -moz-box-sizing: border-box; -webkit-box-sizing: border-box; box-sizing: border-box; }

html, body { font-size: 97%; }

body { background: white; color: #222222; padding: 0; margin: 0; font-family: "Helvetica Neue", "Helvetica", Helvetica, Arial, sans-serif; font-weight: normal; font-style: normal; line-height: 1; position: relative; cursor: auto; }

a:hover { cursor: pointer; }

img, object, embed { max-width: 100%; height: auto; }

object, embed { height: 100%; }

img { -ms-interpolation-mode: bicubic; }

#map_canvas img, #map_canvas embed, #map_canvas object, .map_canvas img, .map_canvas embed, .map_canvas object { max-width: none !important; }

.left { float: left !important; }

.right { float: right !important; }

.text-left { text-align: left !important; }

.text-right { text-align: right !important; }

.text-center { text-align: center !important; }

.text-justify { text-align: justify !important; }

.hide { display: none; }

.antialiased, body { -webkit-font-smoothing: antialiased; }

img { display: inline-block; vertical-align: middle; }

textarea { height: auto; min-height: 50px; }

select { width: 100%; }

p.lead, .paragraph.lead > p, #preamble > .sectionbody > .paragraph:first-of-type p { font-size: 1.21875em; line-height: 1.6; }

.subheader, .admonitionblock td.content > .title, .audioblock > .title, .exampleblock > .title, .imageblock > .title, .listingblock > .title, .literalblock > .title, .stemblock > .title, .openblock > .title, .paragraph > .title, .quoteblock > .title, table.tableblock > .title, .verseblock > .title, .videoblock > .title, .dlist > .title, .olist > .title, .ulist > .title, .qlist > .title, .hdlist > .title { line-height: 1.4; color: #6f6f6f; font-weight: 300; margin-top: 0.2em; margin-bottom: 0.5em; }

/* Typography resets */
div, dl, dt, dd, ul, ol, li, h1, h2, h3, #toctitle, .sidebarblock > .content > .title, h4, h5, h6, pre, form, p, blockquote, th, td { margin: 0; padding: 0; direction: ltr; }

/* Default Link Styles */
a { color: #1164be; text-decoration: none; line-height: inherit; }
a img { border: none; }

/* Default paragraph styles */
p { font-family: inherit; font-weight: normal; font-size: 1em; line-height: 1.4; margin-bottom: 1em; text-rendering: optimizeLegibility; }
p aside { font-size: 0.875em; line-height: 1.35; font-style: italic; }

/* Default header styles */
h1, h2, h3, #toctitle, .sidebarblock > .content > .title, h4, h5, h6 { font-family: "Helvetica Neue", "Helvetica", Helvetica, Arial, sans-serif; font-weight: bold; font-style: normal; color: #1c355e; text-rendering: optimizeLegibility; margin-top: 1em; margin-bottom: 0.5em; line-height: 1.2125em; }
h1 small, h2 small, h3 small, #toctitle small, .sidebarblock > .content > .title small, h4 small, h5 small, h6 small { font-size: 60%; color: #6f6f6f; line-height: 0; }

h1 { font-size: 2.125em; }

h2 { font-size: 1.6875em; }

h3, #toctitle, .sidebarblock > .content > .title { font-size: 1.375em; }

h4 { font-size: 1.125em; }

h5 { font-size: 1.125em; }

h6 { font-size: 1em; }

hr { border: solid #dddddd; border-width: 1px 0 0; clear: both; margin: 1.25em 0 1.1875em; height: 0; }

/* Helpful Typography Defaults */
em, i { font-style: italic; line-height: inherit; }

strong, b { font-weight: bold; line-height: inherit; }

small { font-size: 60%; line-height: inherit; }

code { font-family: Consolas, "Liberation Mono", Courier, monospace; font-weight: bold; }

/* Lists */
ul, ol, dl { font-size: 1em; line-height: 1.4; margin-bottom: 1.25em; list-style-position: outside; font-family: inherit; }

ul, ol { margin-left: 2.5em; }
ul.no-bullet, ol.no-bullet { margin-left: 1.5em; }

/* Unordered Lists */
ul li ul, ul li ol { margin-left: 1.25em; margin-bottom: 0; font-size: 1em; /* Override nested font-size change */ }
ul.square li ul, ul.circle li ul, ul.disc li ul { list-style: inherit; }
ul.square { list-style-type: square; }
ul.circle { list-style-type: circle; }
ul.disc { list-style-type: disc; }
ul.no-bullet { list-style: none; }

/* Ordered Lists */
ol li ul, ol li ol { margin-left: 1.25em; margin-bottom: 0; }

/* Definition Lists */
dl dt { margin-bottom: 0.3125em; font-weight: bold; }
dl dd { margin-bottom: 1.25em; }

/* Abbreviations */
abbr, acronym { text-transform: uppercase; font-size: 90%; color: #222222; border-bottom: 1px dotted #dddddd; cursor: help; }

abbr { text-transform: none; }

/* Blockquotes */
blockquote { margin: 0 0 1.25em; padding: 0.5625em 1.25em 0 1.1875em; border-left: 1px solid #dddddd; }
blockquote cite { display: block; font-size: 0.8125em; color: #555555; }
blockquote cite:before { content: "\2014 \0020"; }
blockquote cite a, blockquote cite a:visited { color: #555555; }

blockquote, blockquote p { line-height: 1.6; color: #6f6f6f; }

/* Microformats */
.vcard { display: inline-block; margin: 0 0 1.25em 0; border: 1px solid #dddddd; padding: 0.625em 0.75em; }
.vcard li { margin: 0; display: block; }
.vcard .fn { font-weight: bold; font-size: 0.9375em; }

.vevent .summary { font-weight: bold; }
.vevent abbr { cursor: auto; text-decoration: none; font-weight: bold; border: none; padding: 0 0.0625em; }

/*@media only screen and (min-width: 768px) { h1, h2, h3, #toctitle, .sidebarblock > .content > .title, h4, h5, h6 { line-height: 1.4; }
  h1 { font-size: 2.75em; }
  h2 { font-size: 2.3125em; }
  h3, #toctitle, .sidebarblock > .content > .title { font-size: 1.6875em; }
  h4 { font-size: 1.4375em; } }*/
/* Tables */
table { background: white; margin-bottom: 1.25em; border: solid 1px #dddddd; }
table thead, table tfoot { background: whitesmoke; font-weight: bold; }
table thead tr th, table thead tr td, table tfoot tr th, table tfoot tr td { padding: 0.5em 0.625em 0.625em; font-size: inherit; color: #222222; text-align: left; }
table tr th, table tr td { padding: 0.5625em 0.625em; font-size: inherit; color: #222222; }
table tr.even, table tr.alt, table tr:nth-of-type(even) { background: #f9f9f9; }
table thead tr th, table tfoot tr th, table tbody tr td, table tr td, table tfoot tr td { display: table-cell; line-height: 1.4; }

h1, h2, h3, #toctitle, .sidebarblock > .content > .title, h4, h5, h6 { line-height: 1.4; border-bottom: 1px solid #dddddd }

.clearfix:before, .clearfix:after, .float-group:before, .float-group:after { content: " "; display: table; }
.clearfix:after, .float-group:after { clear: both; }

*:not(pre) > code { font-size: inherit; font-style: normal !important; letter-spacing: 0; padding: 3px 2px 1px 2px; background-color: #eeeeee; border: 1px solid #dddddd; -webkit-border-radius: 0; border-radius: 0; line-height: inherit; font-weight: normal; }

pre, pre > code { line-height: 1.4; color: black; font-family: monospace, serif; font-weight: normal; }

.keyseq { color: #555555; }

kbd { display: inline-block; color: #222222; font-size: 0.75em; line-height: 1.4; background-color: #f7f7f7; border: 1px solid #ccc; -webkit-border-radius: 3px; border-radius: 3px; -webkit-box-shadow: 0 1px 0 rgba(0, 0, 0, 0.2), 0 0 0 0.1em white inset; box-shadow: 0 1px 0 rgba(0, 0, 0, 0.2), 0 0 0 0.1em white inset; margin: -0.15em 0.15em 0 0.15em; padding: 0.2em 0.6em 0.2em 0.5em; vertical-align: middle; white-space: nowrap; }

.keyseq kbd:first-child { margin-left: 0; }

.keyseq kbd:last-child { margin-right: 0; }

.menuseq, .menu { color: #090909; }

b.button:before, b.button:after { position: relative; top: -1px; font-weight: normal; }

b.button:before { content: "["; padding: 0 3px 0 2px; }

b.button:after { content: "]"; padding: 0 2px 0 3px; }

#header, #content, #footnotes, #footer { width: 100%; margin-left: auto; margin-right: auto; margin-top: 0; margin-bottom: 0; max-width: 62.5em; *zoom: 1; position: relative; padding-left: 0.9375em; padding-right: 0.9375em; }
#header:before, #header:after, #content:before, #content:after, #footnotes:before, #footnotes:after, #footer:before, #footer:after { content: " "; display: table; }
#header:after, #content:after, #footnotes:after, #footer:after { clear: both; }

#content { margin-top: 1.25em; }

#content:before { content: none; }

#header > h1:first-child { color: black; margin-top: 2.25rem; margin-bottom: 0; }
#header > h1:first-child + #toc { margin-top: 8px; border-top: 1px solid #dddddd; }
#header > h1:only-child, body.toc2 #header > h1:nth-last-child(2) { border-bottom: 1px solid #dddddd; padding-bottom: 8px; }
#header .details { border-bottom: 1px solid #dddddd; line-height: 1.45; padding-top: 0.25em; padding-bottom: 0.25em; padding-left: 0.25em; color: #555555; display: -ms-flexbox; display: -webkit-flex; display: flex; -ms-flex-flow: row wrap; -webkit-flex-flow: row wrap; flex-flow: row wrap; }
#header .details span:first-child { margin-left: -0.125em; }
#header .details span.email a { color: #6f6f6f; }
#header .details br { display: none; }
#header .details br + span:before { content: "\00a0\2013\00a0"; }
#header .details br + span.author:before { content: "\00a0\22c5\00a0"; color: #6f6f6f; }
#header .details br + span#revremark:before { content: "\00a0|\00a0"; }
#header #revnumber { text-transform: capitalize; }
#header #revnumber:after { content: "\00a0"; }

#content > h1:first-child:not([class]) { color: black; border-bottom: 1px solid #dddddd; padding-bottom: 8px; margin-top: 0; padding-top: 1rem; margin-bottom: 1.25rem; }

#floating {
  position: fixed;
  z-index: 1000;
  padding: 0.5em;
  right: 0;
  top: 0;
  background: white;
  box-shadow: 0 0 1em #777777;
  -webkit-box-shadow: 0 0 1em #777777;
  -moz-box-shadow: 0 0 1em #777777;
  -webkit-border-bottom-left-radius: 5px;
  -moz-border-radius-bottomleft: 5px;
  max-height: 80%;
  overflow: auto;
}

#floating #full { display: none; } /* Hide the full TOC by default */

#floating:hover #full{
  display: block; /* Show it on hover */
}


#toc { border-bottom: 1px solid #dddddd; padding-bottom: 0.5em; }
#toc > ul { margin-left: 0.125em; }
#toc ul.sectlevel0 > li > a { font-style: italic; }
#toc ul.sectlevel0 ul.sectlevel1 { margin: 0.5em 0; }
#toc ul { font-family: "Helvetica Neue", "Helvetica", Helvetica, Arial, sans-serif; list-style-type: none; }
#toc a { text-decoration: none; }
#toc a:active { text-decoration: underline; }

#toctitle { color: #6f6f6f; font-size: 1.2em; }

@media only screen and (min-width: 768px) { #toctitle { font-size: 1.375em; }
  body.toc2 { padding-left: 15em; padding-right: 0; }
  #toc.toc2 { margin-top: 0 !important; background-color: #f2f2f2; position: fixed; width: 15em; left: 0; top: 0; border-right: 1px solid #dddddd; border-top-width: 0 !important; border-bottom-width: 0 !important; z-index: 1000; padding: 1.25em 1em; height: 100%; overflow: auto; }
  #toc.toc2 #toctitle { margin-top: 0; font-size: 1.2em; }
  #toc.toc2 > ul { font-size: 0.9em; margin-bottom: 0; }
  #toc.toc2 ul ul { margin-left: 0; padding-left: 1em; }
  #toc.toc2 ul.sectlevel0 ul.sectlevel1 { padding-left: 0; margin-top: 0.5em; margin-bottom: 0.5em; }
  body.toc2.toc-right { padding-left: 0; padding-right: 15em; }
  body.toc2.toc-right #toc.toc2 { border-right-width: 0; border-left: 1px solid #dddddd; left: auto; right: 0; } }
@media only screen and (min-width: 1280px) { body.toc2 { padding-left: 20em; padding-right: 0; }
  #toc.toc2 { width: 20em; }
  #toc.toc2 #toctitle { font-size: 1.375em; }
  #toc.toc2 > ul { font-size: 0.95em; }
  #toc.toc2 ul ul { padding-left: 1.25em; }
  body.toc2.toc-right { padding-left: 0; padding-right: 20em; } }
#content #toc { border-style: solid; border-width: 1px; border-color: #d9d9d9; margin-bottom: 1.25em; padding: 1.25em; background: #f2f2f2; -webkit-border-radius: 0; border-radius: 0; }
#content #toc > :first-child { margin-top: 0; }
#content #toc > :last-child { margin-bottom: 0; }

#footer { max-width: 100%; background-color: #222222; padding: 1.25em; }

#footer-text { color: #dddddd; line-height: 1.44; }

.sect1 { padding-bottom: 0.625em; }

@media only screen and (min-width: 768px) { .sect1 { padding-bottom: 1.25em; } }
.sect1 + .sect1 { border-top: 1px solid #dddddd; }

#content h1 > a.anchor, h2 > a.anchor, h3 > a.anchor, #toctitle > a.anchor, .sidebarblock > .content > .title > a.anchor, h4 > a.anchor, h5 > a.anchor, h6 > a.anchor { position: absolute; z-index: 1001; width: 1.5ex; margin-left: -1.5ex; display: block; text-decoration: none !important; visibility: hidden; text-align: center; font-weight: normal; }
#content h1 > a.anchor:before, h2 > a.anchor:before, h3 > a.anchor:before, #toctitle > a.anchor:before, .sidebarblock > .content > .title > a.anchor:before, h4 > a.anchor:before, h5 > a.anchor:before, h6 > a.anchor:before { content: "\00A7"; font-size: 0.85em; display: block; padding-top: 0.1em; }
#content h1:hover > a.anchor, #content h1 > a.anchor:hover, h2:hover > a.anchor, h2 > a.anchor:hover, h3:hover > a.anchor, #toctitle:hover > a.anchor, .sidebarblock > .content > .title:hover > a.anchor, h3 > a.anchor:hover, #toctitle > a.anchor:hover, .sidebarblock > .content > .title > a.anchor:hover, h4:hover > a.anchor, h4 > a.anchor:hover, h5:hover > a.anchor, h5 > a.anchor:hover, h6:hover > a.anchor, h6 > a.anchor:hover { visibility: visible; }
#content h1 > a.link, h2 > a.link, h3 > a.link, #toctitle > a.link, .sidebarblock > .content > .title > a.link, h4 > a.link, h5 > a.link, h6 > a.link { color: #222222; text-decoration: none; }
#content h1 > a.link:hover, h2 > a.link:hover, h3 > a.link:hover, #toctitle > a.link:hover, .sidebarblock > .content > .title > a.link:hover, h4 > a.link:hover, h5 > a.link:hover, h6 > a.link:hover { color: #151515; }

.audioblock, .imageblock, .literalblock, .listingblock, .stemblock, .videoblock { margin-bottom: 1.25em; }

.admonitionblock td.content > .title, .audioblock > .title, .exampleblock > .title, .imageblock > .title, .listingblock > .title, .literalblock > .title, .stemblock > .title, .openblock > .title, .paragraph > .title, .quoteblock > .title, table.tableblock > .title, .verseblock > .title, .videoblock > .title, .dlist > .title, .olist > .title, .ulist > .title, .qlist > .title, .hdlist > .title { text-rendering: optimizeLegibility; text-align: left; }

table.tableblock > caption.title { white-space: nowrap; overflow: visible; max-width: 0; }

.paragraph.lead > p, #preamble > .sectionbody > .paragraph:first-of-type p { color: black; }

table.tableblock #preamble > .sectionbody > .paragraph:first-of-type p { font-size: inherit; }

.admonitionblock > table { border-collapse: separate; border: 0; background: none; width: 100%; }
.admonitionblock > table td.icon { text-align: center; width: 80px; }
.admonitionblock > table td.icon img { max-width: none; }
.admonitionblock > table td.icon .title { font-weight: bold; font-family: "Helvetica Neue", "Helvetica", Helvetica, Arial, sans-serif; text-transform: uppercase; }
.admonitionblock > table td.content { padding-left: 1.125em; padding-right: 1.25em; border-left: 1px solid #dddddd; color: #555555; }
.admonitionblock > table td.content > :last-child > :last-child { margin-bottom: 0; }

.exampleblock > .content { border-style: solid; border-width: 1px; border-color: #e6e6e6; margin-bottom: 1.25em; padding: 1.25em; background: white; -webkit-border-radius: 0; border-radius: 0; }
.exampleblock > .content > :first-child { margin-top: 0; }
.exampleblock > .content > :last-child { margin-bottom: 0; }

.sidebarblock { border-style: solid; border-width: 1px; border-color: #d9d9d9; margin-bottom: 1.25em; padding: 1.25em; background: #f2f2f2; -webkit-border-radius: 0; border-radius: 0; }
.sidebarblock > :first-child { margin-top: 0; }
.sidebarblock > :last-child { margin-bottom: 0; }
.sidebarblock > .content > .title { color: #6f6f6f; margin-top: 0; }

.exampleblock > .content > :last-child > :last-child, .exampleblock > .content .olist > ol > li:last-child > :last-child, .exampleblock > .content .ulist > ul > li:last-child > :last-child, .exampleblock > .content .qlist > ol > li:last-child > :last-child, .sidebarblock > .content > :last-child > :last-child, .sidebarblock > .content .olist > ol > li:last-child > :last-child, .sidebarblock > .content .ulist > ul > li:last-child > :last-child, .sidebarblock > .content .qlist > ol > li:last-child > :last-child { margin-bottom: 0; }

.literalblock pre, .listingblock pre:not(.highlight), .listingblock pre[class="highlight"], .listingblock pre[class^="highlight "], .listingblock pre.CodeRay, .listingblock pre.prettyprint { background: #eeeeee; }
.sidebarblock .literalblock pre, .sidebarblock .listingblock pre:not(.highlight), .sidebarblock .listingblock pre[class="highlight"], .sidebarblock .listingblock pre[class^="highlight "], .sidebarblock .listingblock pre.CodeRay, .sidebarblock .listingblock pre.prettyprint { background: #f2f1f1; }

.literalblock pre, .literalblock pre[class], .listingblock pre, .listingblock pre[class] { border: 1px solid #cccccc; -webkit-border-radius: 0; border-radius: 0; word-wrap: break-word; padding: 0.8em 0.8em 0.65em 0.8em; font-size: 0.8125em; }
.literalblock pre.nowrap, .literalblock pre[class].nowrap, .listingblock pre.nowrap, .listingblock pre[class].nowrap { overflow-x: auto; white-space: pre; word-wrap: normal; }
@media only screen and (min-width: 768px) { .literalblock pre, .literalblock pre[class], .listingblock pre, .listingblock pre[class] { font-size: 0.90625em; } }
@media only screen and (min-width: 1280px) { .literalblock pre, .literalblock pre[class], .listingblock pre, .listingblock pre[class] { font-size: 1em; } }

.literalblock.output pre { color: #eeeeee; background-color: black; }

.listingblock pre.highlightjs { padding: 0; }
.listingblock pre.highlightjs > code { padding: 0.8em 0.8em 0.65em 0.8em; -webkit-border-radius: 0; border-radius: 0; }

.listingblock > .content { position: relative; }

.listingblock code[data-lang]:before { display: none; content: attr(data-lang); position: absolute; font-size: 0.75em; top: 0.425rem; right: 0.5rem; line-height: 1; text-transform: uppercase; color: #999; }

.listingblock:hover code[data-lang]:before { display: block; }

.listingblock.terminal pre .command:before { content: attr(data-prompt); padding-right: 0.5em; color: #999; }

.listingblock.terminal pre .command:not([data-prompt]):before { content: "$"; }

table.pyhltable { border-collapse: separate; border: 0; margin-bottom: 0; background: none; }

table.pyhltable td { vertical-align: top; padding-top: 0; padding-bottom: 0; }

table.pyhltable td.code { padding-left: .75em; padding-right: 0; }

pre.pygments .lineno, table.pyhltable td:not(.code) { color: #999; padding-left: 0; padding-right: .5em; border-right: 1px solid #dddddd; }

pre.pygments .lineno { display: inline-block; margin-right: .25em; }

table.pyhltable .linenodiv { background: none !important; padding-right: 0 !important; }

.quoteblock { margin: 0 1em 1.25em 1.5em; display: table; }
.quoteblock > .title { margin-left: -1.5em; margin-bottom: 0.75em; }
.quoteblock blockquote, .quoteblock blockquote p { color: #6f6f6f; font-size: 1.15rem; line-height: 1.75; word-spacing: 0.1em; letter-spacing: 0; font-style: italic; text-align: justify; }
.quoteblock blockquote { margin: 0; padding: 0; border: 0; }
.quoteblock blockquote:before { content: "\201c"; float: left; font-size: 2.75em; font-weight: bold; line-height: 0.6em; margin-left: -0.6em; color: #6f6f6f; text-shadow: 0 1px 2px rgba(0, 0, 0, 0.1); }
.quoteblock blockquote > .paragraph:last-child p { margin-bottom: 0; }
.quoteblock .attribution { margin-top: 0.5em; margin-right: 0.5ex; text-align: right; }
.quoteblock .quoteblock { margin-left: 0; margin-right: 0; padding: 0.5em 0; border-left: 3px solid #555555; }
.quoteblock .quoteblock blockquote { padding: 0 0 0 0.75em; }
.quoteblock .quoteblock blockquote:before { display: none; }

.verseblock { margin: 0 1em 1.25em 1em; }
.verseblock pre { font-family: "Open Sans", "DejaVu Sans", sans; font-size: 1.15rem; color: #6f6f6f; font-weight: 300; text-rendering: optimizeLegibility; }
.verseblock pre strong { font-weight: 400; }
.verseblock .attribution { margin-top: 1.25rem; margin-left: 0.5ex; }

.quoteblock .attribution, .verseblock .attribution { font-size: 0.8125em; line-height: 1.45; font-style: italic; }
.quoteblock .attribution br, .verseblock .attribution br { display: none; }
.quoteblock .attribution cite, .verseblock .attribution cite { display: block; letter-spacing: -0.05em; color: #555555; }

.quoteblock.abstract { margin: 0 0 1.25em 0; display: block; }
.quoteblock.abstract blockquote, .quoteblock.abstract blockquote p { text-align: left; word-spacing: 0; }
.quoteblock.abstract blockquote:before, .quoteblock.abstract blockquote p:first-of-type:before { display: none; }

table.tableblock { max-width: 100%; border-collapse: separate; }
table.tableblock td > .paragraph:last-child p > p:last-child, table.tableblock th > p:last-child, table.tableblock td > p:last-child { margin-bottom: 0; }

table.spread { width: 100%; }

table.tableblock, th.tableblock, td.tableblock { border: 0 solid #dddddd; }

table.grid-all th.tableblock, table.grid-all td.tableblock { border-width: 0 1px 1px 0; }

table.grid-all tfoot > tr > th.tableblock, table.grid-all tfoot > tr > td.tableblock { border-width: 1px 1px 0 0; }

table.grid-cols th.tableblock, table.grid-cols td.tableblock { border-width: 0 1px 0 0; }

table.grid-all * > tr > .tableblock:last-child, table.grid-cols * > tr > .tableblock:last-child { border-right-width: 0; }

table.grid-rows th.tableblock, table.grid-rows td.tableblock { border-width: 0 0 1px 0; }

table.grid-all tbody > tr:last-child > th.tableblock, table.grid-all tbody > tr:last-child > td.tableblock, table.grid-all thead:last-child > tr > th.tableblock, table.grid-rows tbody > tr:last-child > th.tableblock, table.grid-rows tbody > tr:last-child > td.tableblock, table.grid-rows thead:last-child > tr > th.tableblock { border-bottom-width: 0; }

table.grid-rows tfoot > tr > th.tableblock, table.grid-rows tfoot > tr > td.tableblock { border-width: 1px 0 0 0; }

table.frame-all { border-width: 1px; }

table.frame-sides { border-width: 0 1px; }

table.frame-topbot { border-width: 1px 0; }

th.halign-left, td.halign-left { text-align: left; }

th.halign-right, td.halign-right { text-align: right; }

th.halign-center, td.halign-center { text-align: center; }

th.valign-top, td.valign-top { vertical-align: top; }

th.valign-bottom, td.valign-bottom { vertical-align: bottom; }

th.valign-middle, td.valign-middle { vertical-align: middle; }

table thead th, table tfoot th { font-weight: bold; }

tbody tr th { display: table-cell; line-height: 1.4; background: whitesmoke; }

tbody tr th, tbody tr th p, tfoot tr th, tfoot tr th p { color: #222222; font-weight: bold; }

p.tableblock > code:only-child { background: none; padding: 0; }

p.tableblock { font-size: 1em; }

td > div.verse { white-space: pre; }

ol { margin-left: 2.5em; }

ul li ol { margin-left: 1.5em; }

dl dd { margin-left: 1.125em; }

dl dd:last-child, dl dd:last-child > :last-child { margin-bottom: 0; }

ol > li p, ul > li p, ul dd, ol dd, .olist .olist, .ulist .ulist, .ulist .olist, .olist .ulist { margin-bottom: 0.625em; }

ul.unstyled, ol.unnumbered, ul.checklist, ul.none { list-style-type: none; }

ul.unstyled, ol.unnumbered, ul.checklist { margin-left: 0.625em; }

ul.checklist li > p:first-child > .fa-check-square-o:first-child, ul.checklist li > p:first-child > input[type="checkbox"]:first-child { margin-right: 0.25em; }

ul.checklist li > p:first-child > input[type="checkbox"]:first-child { position: relative; top: 1px; }

ul.inline { margin: 0 auto 0.625em auto; margin-left: -1.375em; margin-right: 0; padding: 0; list-style: none; overflow: hidden; }
ul.inline > li { list-style: none; float: left; margin-left: 1.375em; display: block; }
ul.inline > li > * { display: block; }

.unstyled dl dt { font-weight: normal; font-style: normal; }

ol.arabic { list-style-type: decimal; }

ol.decimal { list-style-type: decimal-leading-zero; }

ol.loweralpha { list-style-type: lower-alpha; }

ol.upperalpha { list-style-type: upper-alpha; }

ol.lowerroman { list-style-type: lower-roman; }

ol.upperroman { list-style-type: upper-roman; }

ol.lowergreek { list-style-type: lower-greek; }

.hdlist > table, .colist > table { border: 0; background: none; }
.hdlist > table > tbody > tr, .colist > table > tbody > tr { background: none; }

td.hdlist1 { padding-right: .75em; font-weight: bold; }

td.hdlist1, td.hdlist2 { vertical-align: top; }

.literalblock + .colist, .listingblock + .colist { margin-top: -0.5em; }

.colist > table tr > td:first-of-type { padding: 0 0.75em; line-height: 1; }
.colist > table tr > td:last-of-type { padding: 0.25em 0; }

.thumb, .th { line-height: 0; display: inline-block; border: solid 4px white; -webkit-box-shadow: 0 0 0 1px #dddddd; box-shadow: 0 0 0 1px #dddddd; }

.imageblock.left, .imageblock[style*="float: left"] { margin: 0.25em 0.625em 1.25em 0; }
.imageblock.right, .imageblock[style*="float: right"] { margin: 0.25em 0 1.25em 0.625em; }
.imageblock > .title { margin-bottom: 0; }
.imageblock.thumb, .imageblock.th { border-width: 6px; }
.imageblock.thumb > .title, .imageblock.th > .title { padding: 0 0.125em; }

.image.left, .image.right { margin-top: 0.25em; margin-bottom: 0.25em; display: inline-block; line-height: 0; }
.image.left { margin-right: 0.625em; }
.image.right { margin-left: 0.625em; }

a.image { text-decoration: none; }

span.footnote, span.footnoteref { vertical-align: super; font-size: 0.875em; }
span.footnote a, span.footnoteref a { text-decoration: none; }
span.footnote a:active, span.footnoteref a:active { text-decoration: underline; }

#footnotes { padding-top: 0.75em; padding-bottom: 0.75em; margin-bottom: 0.625em; }
#footnotes hr { width: 20%; min-width: 6.25em; margin: -.25em 0 .75em 0; border-width: 1px 0 0 0; }
#footnotes .footnote { padding: 0 0.375em; line-height: 1.3; font-size: 0.875em; margin-left: 1.2em; text-indent: -1.2em; margin-bottom: .2em; }
#footnotes .footnote a:first-of-type { font-weight: bold; text-decoration: none; }
#footnotes .footnote:last-of-type { margin-bottom: 0; }

#content #footnotes { margin-top: -0.625em; margin-bottom: 0; padding: 0.75em 0; }

.gist .file-data > table { border: 0; background: #fff; width: 100%; margin-bottom: 0; }
.gist .file-data > table td.line-data { width: 99%; }

div.unbreakable { page-break-inside: avoid; }

.big { font-size: larger; }

.small { font-size: smaller; }

.underline { text-decoration: underline; }

.overline { text-decoration: overline; }

.line-through { text-decoration: line-through; }

.aqua { color: #00bfbf; }

.aqua-background { background-color: #00fafa; }

.black { color: black; }

.black-background { background-color: black; }

.blue { color: #0000bf; }

.blue-background { background-color: #0000fa; }

.fuchsia { color: #bf00bf; }

.fuchsia-background { background-color: #fa00fa; }

.gray { color: #606060; }

.gray-background { background-color: #7d7d7d; }

.green { color: #006000; }

.green-background { background-color: #007d00; }

.lime { color: #00bf00; }

.lime-background { background-color: #00fa00; }

.maroon { color: #600000; }

.maroon-background { background-color: #7d0000; }

.navy { color: #000060; }

.navy-background { background-color: #00007d; }

.olive { color: #606000; }

.olive-background { background-color: #7d7d00; }

.purple { color: #600060; }

.purple-background { background-color: #7d007d; }

.red { color: #bf0000; }

.red-background { background-color: #fa0000; }

.silver { color: #909090; }

.silver-background { background-color: #bcbcbc; }

.teal { color: #006060; }

.teal-background { background-color: #007d7d; }

.white { color: #bfbfbf; }

.white-background { background-color: #fafafa; }

.yellow { color: #bfbf00; }

.yellow-background { background-color: #fafa00; }

span.icon > .fa { cursor: default; }

.admonitionblock td.icon [class^="fa icon-"] { font-size: 2.5em; text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.5); cursor: default; }
.admonitionblock td.icon .icon-note:before { content: "\f05a"; color: #207c98; }
.admonitionblock td.icon .icon-tip:before { content: "\f0eb"; text-shadow: 1px 1px 2px rgba(155, 155, 0, 0.8); color: #111; }
.admonitionblock td.icon .icon-warning:before { content: "\f071"; color: #bf6900; }
.admonitionblock td.icon .icon-caution:before { content: "\f06d"; color: #bf3400; }
.admonitionblock td.icon .icon-important:before { content: "\f06a"; color: #bf0000; }

.conum[data-value] { display: inline-block; color: #fff !important; background-color: #222222; -webkit-border-radius: 100px; border-radius: 100px; text-align: center; font-size: 0.75em; width: 1.67em; height: 1.67em; line-height: 1.67em; font-family: "Open Sans", "DejaVu Sans", sans-serif; font-style: normal; font-weight: bold; }
.conum[data-value] * { color: #fff !important; }
.conum[data-value] + b { display: none; }
.conum[data-value]:after { content: attr(data-value); }
pre .conum[data-value] { position: relative; top: -0.125em; }

b.conum * { color: inherit !important; }

.conum:not([data-value]):empty { display: none; }

.literalblock pre, .listingblock pre { background: #eeeeee; }

</style>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.2.0/css/font-awesome.min.css">
<style>.listingblock .pygments .hll { background-color: #ffffcc }
.listingblock .pygments  { background: #f8f8f8; }
.listingblock .pygments .tok-c { color: #408080; font-style: italic } /* Comment */
.listingblock .pygments .tok-err { border: 1px solid #FF0000 } /* Error */
.listingblock .pygments .tok-k { color: #008000; font-weight: bold } /* Keyword */
.listingblock .pygments .tok-o { color: #666666 } /* Operator */
.listingblock .pygments .tok-cm { color: #408080; font-style: italic } /* Comment.Multiline */
.listingblock .pygments .tok-cp { color: #BC7A00 } /* Comment.Preproc */
.listingblock .pygments .tok-c1 { color: #408080; font-style: italic } /* Comment.Single */
.listingblock .pygments .tok-cs { color: #408080; font-style: italic } /* Comment.Special */
.listingblock .pygments .tok-gd { color: #A00000 } /* Generic.Deleted */
.listingblock .pygments .tok-ge { font-style: italic } /* Generic.Emph */
.listingblock .pygments .tok-gr { color: #FF0000 } /* Generic.Error */
.listingblock .pygments .tok-gh { color: #000080; font-weight: bold } /* Generic.Heading */
.listingblock .pygments .tok-gi { color: #00A000 } /* Generic.Inserted */
.listingblock .pygments .tok-go { color: #888888 } /* Generic.Output */
.listingblock .pygments .tok-gp { color: #000080; font-weight: bold } /* Generic.Prompt */
.listingblock .pygments .tok-gs { font-weight: bold } /* Generic.Strong */
.listingblock .pygments .tok-gu { color: #800080; font-weight: bold } /* Generic.Subheading */
.listingblock .pygments .tok-gt { color: #0044DD } /* Generic.Traceback */
.listingblock .pygments .tok-kc { color: #008000; font-weight: bold } /* Keyword.Constant */
.listingblock .pygments .tok-kd { color: #008000; font-weight: bold } /* Keyword.Declaration */
.listingblock .pygments .tok-kn { color: #008000; font-weight: bold } /* Keyword.Namespace */
.listingblock .pygments .tok-kp { color: #008000 } /* Keyword.Pseudo */
.listingblock .pygments .tok-kr { color: #008000; font-weight: bold } /* Keyword.Reserved */
.listingblock .pygments .tok-kt { color: #B00040 } /* Keyword.Type */
.listingblock .pygments .tok-m { color: #666666 } /* Literal.Number */
.listingblock .pygments .tok-s { color: #BA2121 } /* Literal.String */
.listingblock .pygments .tok-na { color: #7D9029 } /* Name.Attribute */
.listingblock .pygments .tok-nb { color: #008000 } /* Name.Builtin */
.listingblock .pygments .tok-nc { color: #0000FF; font-weight: bold } /* Name.Class */
.listingblock .pygments .tok-no { color: #880000 } /* Name.Constant */
.listingblock .pygments .tok-nd { color: #AA22FF } /* Name.Decorator */
.listingblock .pygments .tok-ni { color: #999999; font-weight: bold } /* Name.Entity */
.listingblock .pygments .tok-ne { color: #D2413A; font-weight: bold } /* Name.Exception */
.listingblock .pygments .tok-nf { color: #0000FF } /* Name.Function */
.listingblock .pygments .tok-nl { color: #A0A000 } /* Name.Label */
.listingblock .pygments .tok-nn { color: #0000FF; font-weight: bold } /* Name.Namespace */
.listingblock .pygments .tok-nt { color: #008000; font-weight: bold } /* Name.Tag */
.listingblock .pygments .tok-nv { color: #19177C } /* Name.Variable */
.listingblock .pygments .tok-ow { color: #AA22FF; font-weight: bold } /* Operator.Word */
.listingblock .pygments .tok-w { color: #bbbbbb } /* Text.Whitespace */
.listingblock .pygments .tok-mb { color: #666666 } /* Literal.Number.Bin */
.listingblock .pygments .tok-mf { color: #666666 } /* Literal.Number.Float */
.listingblock .pygments .tok-mh { color: #666666 } /* Literal.Number.Hex */
.listingblock .pygments .tok-mi { color: #666666 } /* Literal.Number.Integer */
.listingblock .pygments .tok-mo { color: #666666 } /* Literal.Number.Oct */
.listingblock .pygments .tok-sb { color: #BA2121 } /* Literal.String.Backtick */
.listingblock .pygments .tok-sc { color: #BA2121 } /* Literal.String.Char */
.listingblock .pygments .tok-sd { color: #BA2121; font-style: italic } /* Literal.String.Doc */
.listingblock .pygments .tok-s2 { color: #BA2121 } /* Literal.String.Double */
.listingblock .pygments .tok-se { color: #BB6622; font-weight: bold } /* Literal.String.Escape */
.listingblock .pygments .tok-sh { color: #BA2121 } /* Literal.String.Heredoc */
.listingblock .pygments .tok-si { color: #BB6688; font-weight: bold } /* Literal.String.Interpol */
.listingblock .pygments .tok-sx { color: #008000 } /* Literal.String.Other */
.listingblock .pygments .tok-sr { color: #BB6688 } /* Literal.String.Regex */
.listingblock .pygments .tok-s1 { color: #BA2121 } /* Literal.String.Single */
.listingblock .pygments .tok-ss { color: #19177C } /* Literal.String.Symbol */
.listingblock .pygments .tok-bp { color: #008000 } /* Name.Builtin.Pseudo */
.listingblock .pygments .tok-vc { color: #19177C } /* Name.Variable.Class */
.listingblock .pygments .tok-vg { color: #19177C } /* Name.Variable.Global */
.listingblock .pygments .tok-vi { color: #19177C } /* Name.Variable.Instance */
.listingblock .pygments .tok-il { color: #666666 } /* Literal.Number.Integer.Long */
</style>
</head>
<body class="article toc2 toc-left">
<div id="header">
<h1>JavaScript</h1>
<div class="details">
<span id="author" class="author">Aitor Medrano</span><br>
<span id="email" class="email">&lt;<a href="mailto:aitor.medrano@ua.es">aitor.medrano@ua.es</a>&gt;</span><br>
<span id="revnumber">version 1.1</span>
<br><span id="revremark">2015-2016</span>
</div>
<div id="toc" class="toc2">
<div id="toctitle">Índice de contenidos</div>
<ul class="sectlevel1">
<li><a href="#sesion01">1. JavaScript. El lenguaje</a>
<ul class="sectlevel2">
<li><a href="#_de_javascript_a_ecmascript">1.1. De JavaScript a ECMAScript</a></li>
<li><a href="#_uso_en_el_navegador">1.2. Uso en el navegador</a></li>
<li><a href="#_herramientas">1.3. Herramientas</a></li>
<li><a href="#_datos_y_variables">1.4. Datos y variables</a></li>
<li><a href="#_instrucciones">1.5. Instrucciones</a></li>
<li><a href="#_funciones">1.6. Funciones</a></li>
<li><a href="#_alcance">1.7. Alcance</a></li>
<li><a href="#__em_timers_em">1.8. <em>Timers</em></a></li>
<li><a href="#_gesti%C3%B3n_de_errores">1.9. Gestión de errores</a></li>
<li><a href="#_ejercicios">1.10. Ejercicios</a></li>
</ul>
</li>
<li><a href="#sesion02">2. JavaScript orientado a objetos</a>
<ul class="sectlevel2">
<li><a href="#_trabajando_con_objetos">2.1. Trabajando con objetos</a></li>
<li><a href="#_objetos_literales">2.2. Objetos literales</a></li>
<li><a href="#_creando_un_tipo_de_datos">2.3. Creando un tipo de datos</a></li>
<li><a href="#_invocaci%C3%B3n_indirecta">2.4. Invocación indirecta</a></li>
<li><a href="#_descriptores_de_propiedades">2.5. Descriptores de propiedades</a></li>
<li><a href="#_prototipos">2.6. Prototipos</a></li>
<li><a href="#_herencia">2.7. Herencia</a></li>
<li><a href="#__code_this_code_y_el_patr%C3%B3n_invocaci%C3%B3n">2.8. <code>this</code> y el patrón invocación</a></li>
<li><a href="#_arrays">2.9. Arrays</a></li>
<li><a href="#_destructurar">2.10. Destructurar</a></li>
<li><a href="#_ejercicios_2">2.11. Ejercicios</a></li>
</ul>
</li>
<li><a href="#sesion03">3. JavaScript y DOM</a>
<ul class="sectlevel2">
<li><a href="#_bom">3.1. BOM</a></li>
<li><a href="#_trabajando_con_el_dom">3.2. Trabajando con el DOM</a></li>
<li><a href="#_trabajando_con_css">3.3. Trabajando con CSS</a></li>
<li><a href="#_animaciones">3.4. Animaciones</a></li>
<li><a href="#_eventos">3.5. Eventos</a></li>
<li><a href="#_trabajando_con_formularios">3.6. Trabajando con formularios</a></li>
<li><a href="#_ejercicios_3">3.7. Ejercicios</a></li>
</ul>
</li>
<li><a href="#sesion04">4. JavaScript avanzado</a>
<ul class="sectlevel2">
<li><a href="#_closures">4.1. Closures</a></li>
<li><a href="#_m%C3%B3dulos">4.2. Módulos</a></li>
<li><a href="#_expresiones_regulares">4.3. Expresiones regulares</a></li>
<li><a href="#_librer%C3%ADas_en_javascript">4.4. Librerías en JavaScript</a></li>
<li><a href="#_testing">4.5. Testing</a></li>
<li><a href="#_ejercicios_4">4.6. Ejercicios</a></li>
</ul>
</li>
<li><a href="#sesion05">5. JavaScript y el navegador</a>
<ul class="sectlevel2">
<li><a href="#_ajax">5.1. AJAX</a></li>
<li><a href="#_json">5.2. JSON</a></li>
<li><a href="#_html_5">5.3. HTML 5</a></li>
<li><a href="#_almacenando_informaci%C3%B3n">5.4. Almacenando información</a></li>
<li><a href="#_web_workers">5.5. Web Workers</a></li>
<li><a href="#_websockets">5.6. WebSockets</a></li>
<li><a href="#_rendimiento">5.7. Rendimiento</a></li>
<li><a href="#_ejercicios_5">5.8. Ejercicios</a></li>
</ul>
</li>
<li><a href="#sesion06">6. jQuery</a>
<ul class="sectlevel2">
<li><a href="#_por_qu%C3%A9_usar_jquery">6.1. Por qué usar jQuery</a></li>
<li><a href="#_versiones">6.2. Versiones</a></li>
<li><a href="#_alias_code_jquery_code_por_code_code">6.3. Alias: <code>jQuery</code> por <code>$</code></a></li>
<li><a href="#_seleccionando_contenido">6.4. Seleccionando contenido</a></li>
<li><a href="#_navegando_por_la_selecci%C3%B3n">6.5. Navegando por la selección</a></li>
<li><a href="#_manipulando_contenido">6.6. Manipulando contenido</a></li>
<li><a href="#_eventos_4">6.7. Eventos</a></li>
<li><a href="#__code_this_code">6.8. <code>this</code></a></li>
<li><a href="#_ejercicios_6">6.9. Ejercicios</a></li>
</ul>
</li>
<li><a href="#sesion07">7. jQuery Avanzado</a>
<ul class="sectlevel2">
<li><a href="#_efectos">7.1. Efectos</a></li>
<li><a href="#_ajax_2">7.2. AJAX</a></li>
<li><a href="#_utilidades">7.3. Utilidades</a></li>
<li><a href="#_plugins">7.4. Plugins</a></li>
<li><a href="#_rendimiento_2">7.5. Rendimiento</a></li>
<li><a href="#_ejercicios_7">7.6. Ejercicios</a></li>
</ul>
</li>
<li><a href="#sesion08">8. Promesas</a>
<ul class="sectlevel2">
<li><a href="#__qu%C3%A9_es_una_promesa">8.1. ¿Qué es una promesa?</a></li>
<li><a href="#_promise_api">8.2. Promise API</a></li>
<li><a href="#_fetch_api">8.3. Fetch API</a></li>
<li><a href="#_jquery_deferreds">8.4. jQuery Deferreds</a></li>
<li><a href="#_ejercicios_8">8.5. Ejercicios</a></li>
</ul>
</li>
</ul>
</div>
</div>
<div id="content">
<div id="preamble">
<div class="sectionbody">
<div style="page-break-after: always;"></div>
</div>
</div>
<div class="sect1">
<h2 id="sesion01">1. JavaScript. El lenguaje</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Antes de comenzar con <em>JavaScript</em>, es necesario fijar una serie de conocimientos previos. A lo largo del módulo se van a utilizar páginas <strong>HTML</strong>, por lo que deberemos saber las etiquetas básicas, la estructura de una página web, uso de listas y capas. Junto a HTML, definiremos su estilo mediante <strong>CSS</strong>, por lo que es necesario conocer su uso básico, y cómo se aplica un estilo a una etiqueta, una clase o un identificador.</p>
</div>
<div class="sect2">
<h3 id="_de_javascript_a_ecmascript">1.1. De JavaScript a ECMAScript</h3>
<div class="paragraph">
<p>JavaScript es un lenguaje de <em>script</em> de amplio uso en la web, y con las nuevas tendencias de aplicaciones de cliente se está convirtiendo en <strong>el</strong> lenguaje de programación. En los últimos años el lenguaje se ha utilizado en otros contextos como el <em>framework</em> Node.js que permite escribir código de servidor.</p>
</div>
<div class="paragraph">
<p>Dentro del mundo de la programación, <em>JavaScript</em> tiene mala fama. Gran parte se debe a que se trata de un lenguaje débilmente tipado, que permite usar variables sin declarar y al tratarse de un lenguaje interpretado, no hay compilador que te diga que hay algo erróneo en tu programa. Realmente <em>JavaScript</em> ofrece mucha flexibilidad y las malas críticas vienen más por el desconocimiento del lenguaje que por defectos del mismo.</p>
</div>
<div class="paragraph">
<p>Contrario a lo que el nombre sugiere, <em>JavaScript</em> tiene poco que ver con <em>Java</em>. La similitud fue una decisión de marketing, allá por el año 1995 cuando <em>Netscape</em> introdujo el lenguaje en el navegador.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/js01/jsHistory.jpg" alt="Inicios de JavaScript" width="66%">
</div>
<div class="title">Figure 1. Inicios de JavaScript</div>
</div>
<div class="paragraph">
<p>Relacionado con <em>JavaScript</em> tenemos <strong>ECMAScript</strong> (ES). Cuando el resto de navegadores empezaron a dar soporte a <em>JavaScript</em>, o lenguajes semejantes como <em>JScript</em>, se escribió un documento a modo de especificación de cómo un sistema JavaScript debería funcionar. El lenguaje descrito en este documento es <em>ECMAScript</em>, y lo que especifica es el lenguaje como lenguaje de propósito general, obviando su integración de éste con la web, es decir, nada de DOM ni BOM.</p>
</div>
<div class="paragraph">
<p>Existen varias versiones de <em>JavaScript</em>. La primera versión ampliamente soportada por diferentes navegadores es <em>ECMAScript</em> 3 (ES3) definida en el año 1999. La especificación 4 promovió varias iniciativas para evolucionar el lenguaje, pero, al menos en lo que implica a la programación web, estas extensiones sólo son útiles cuando son ampliamente soportadas por los navegadores, por lo que se deshechó y se pasó a la versión <em>ECMAScript</em> 5 (ES5), la cual se publicó en 2009. La versión 5 añade al lenguaje algunos objetos, métodos y propiedades, pero el elemento más importante es el modo estricto.</p>
</div>
<div class="paragraph">
<p>A <em>grosso</em> modo, los navegadores importantes ya soportan <em>ECMAScript</em> 5, e incluso algunos soportan algunas características especificas de ECMASCript 6 (también conocido como ECMAScript 2015) o incluso ES7: <a href="http://en.wikipedia.org/wiki/ECMAScript#Implementations" class="bare">http://en.wikipedia.org/wiki/ECMAScript#Implementations</a></p>
</div>
<div class="sect3">
<h4 id="__em_strict_mode_em">1.1.1. <em>Strict mode</em></h4>
<div class="paragraph">
<p>El modo estricto elimina características del lenguaje, lo que simplifica los programas y reduce la cantidad de errores que pueden contener. Por ejemplo, ES5 desaconseja el uso de la instrucción <code>with</code>, lo que provoca que se lance un error al encontrar dicha instrucción, aunque si el navegador no soporta ES5 funcionará correctamente. Otros ejemplos de errores con ES5 es usar variables que no hemos declarado previamente, declarar funciones donde algún parametro está repetido, un objeto donde dos propiedades tengan el mismo nombre, etc&#8230;&#8203;</p>
</div>
<div class="paragraph">
<p>Para activar el modo estricto hay que introducir la cadena <code>"use strict"</code>, lo que las implementaciones antiguas del lenguaje simplemente pasarán por alto, con lo que este modo es retrocompatible con los navegadores que no lo soporten.</p>
</div>
<div class="paragraph">
<p>Dependiendo del alcance, ya sea a nivel de función o global usaremos la cadena <code>"use strict"</code> al inicio del fichero o en la primera línea de la función. Por ejemplo, si sólo queremos activar el modo dentro de una función haremos:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="javascript"><span class="tok-kd">function</span> <span class="tok-nx">modoEstricto</span><span class="tok-p">()</span> <span class="tok-p">{</span>
	<span class="tok-s2">&quot;use strict&quot;</span><span class="tok-p">;</span>
	<span class="tok-c1">// resto de la función</span>
<span class="tok-p">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Esto significa que el código interno de la función se ejecutará con el subconjunto estricto del lenguaje, mientras que otras funciones puede que hagan uso del conjunto completo.</p>
</div>
<div class="paragraph">
<p>El objetivo a medio plazo del lenguaje es que en el futuro sólo se soportará el modo estricto, con lo que ES5 es una versión transicional en la que se anima (pero no obliga) a escribir código en modo estricto.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_uso_en_el_navegador">1.2. Uso en el navegador</h3>
<div class="paragraph">
<p>Para utilizar <em>JavaScript</em> dentro de una página web, usaremos la etiqueta <code>&lt;script&gt;</code>. Mediante esta etiqueta, podemos incluir el código:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>en el propio documento HTML:</p>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="html"><span class="tok-nt">&lt;script&gt;</span>
	<span class="tok-c1">// Instrucciones JavaScript</span>
<span class="tok-nt">&lt;/script&gt;</span></code></pre>
</div>
</div>
</li>
<li>
<p>en un archivo externo (con extensión <code>.js</code>), de modo que se pueda reutilizar entre varios documentos:</p>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="html"><span class="tok-nt">&lt;script </span><span class="tok-na">src=</span><span class="tok-s">&quot;ficheroJavaScript.js&quot;</span><span class="tok-nt">&gt;&lt;/script&gt;</span></code></pre>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="title">async y defer</div>
<div class="paragraph">
<p>Desde HTML5, la etiqueta <code>script</code> admite los siguiente atributos que provocan que el script comience su descarga inmediatamente sin pausar el <em>parser</em>:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>async</code>: ejecuta el script de manera asíncrona una vez descargado y antes del evento <code>load</code> del objeto <code>window</code>. Puede suceder que los scripts <em>async</em> no se ejecuten en el orden en el que aparecen en la página</p>
</li>
<li>
<p><code>defer</code>: garantiza que los scripts se ejecutarán en el orden en el que se encuentran  en la página. Esta ejecución comienza una vez se ha parseado completamente el documento, pero antes del evento <code>DOMContentLoaded</code>.</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="html"><span class="tok-nt">&lt;script </span><span class="tok-na">src=</span><span class="tok-s">&quot;ficheroJavaScriptAsync.js&quot;</span> <span class="tok-na">async</span><span class="tok-nt">&gt;&lt;/script&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Ambos atributos soportan un segundo atributo <code>onload</code> para indicar un manejador que se ejecutará una vez se haya cargado el script.</p>
</div>
<div class="paragraph">
<p>Si no indicamos ninguno de estos atributos, el script se parsea y ejecuta inmediatamente de manera síncrona.</p>
</div>
</td>
</tr>
</table>
</div>
</li>
<li>
<p>como parte de un manejador de eventos, como puede ser <code>onclick</code> o <code>onmouseover</code></p>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="html"><span class="tok-nt">&lt;button</span> <span class="tok-na">onclick=</span><span class="tok-s">&quot;nombreFuncionJavaScript()&quot;</span> <span class="tok-nt">/&gt;</span></code></pre>
</div>
</div>
</li>
<li>
<p>como parte de una URL mediante el pseudo-protocolo <code>javascript:</code></p>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="html"><span class="tok-nt">&lt;a</span> <span class="tok-na">href=</span><span class="tok-s">&quot;javascript:nombreFuncionJavaScript()&quot;</span><span class="tok-nt">&gt;</span>Validar<span class="tok-nt">&lt;/a&gt;</span></code></pre>
</div>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>Normalmente, las referencias JS se incluyen mediante la etiqueta <code>&lt;script&gt;</code> en la cabecera del documento HTML. Pero si queremos que el código JS se ejecute al cargar la página, es conveniente ponerlo antes de cerrar la etiqueta <code>&lt;/body&gt;</code> para asegurarnos que se ha cargado todo el DOM.</p>
</div>
<div class="admonitionblock caution">
<table>
<tr>
<td class="icon">
<i class="fa icon-caution" title="Caution"></i>
</td>
<td class="content">
Una de las consideraciones más importantes es que las páginas web que escribamos deben funcionar incluso si el navegador no soporta <em>JavaScript</em>.
</td>
</tr>
</table>
</div>
<div class="sect3">
<h4 id="_hola_expertojavaua">1.2.1. Hola ExpertoJavaUA</h4>
<div class="paragraph">
<p>Por lo tanto, sabiendo que podemos incluir el código <em>JavaScript</em> dentro del código HTML, ya estamos listos para nuestro saludo:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="html"><span class="tok-cp">&lt;!DOCTYPE html&gt;</span>
<span class="tok-nt">&lt;html</span> <span class="tok-na">lang=</span><span class="tok-s">&quot;es&quot;</span><span class="tok-nt">&gt;</span>
<span class="tok-nt">&lt;head&gt;</span>
	<span class="tok-nt">&lt;title&gt;</span>Hola ExpertoJavaUA<span class="tok-nt">&lt;/title&gt;</span>
	<span class="tok-nt">&lt;meta</span> <span class="tok-na">charset=</span><span class="tok-s">&quot;utf-8&quot;</span> <span class="tok-nt">/&gt;</span>
	<span class="tok-nt">&lt;script&gt;</span>
		<span class="tok-nx">console</span><span class="tok-p">.</span><span class="tok-nx">log</span><span class="tok-p">(</span><span class="tok-s2">&quot;Hola ExpertoJavaUA desde la consola&quot;</span><span class="tok-p">);</span>
		<span class="tok-nx">alert</span><span class="tok-p">(</span><span class="tok-s2">&quot;Hola ExpertoJavaUA desde alert&quot;</span><span class="tok-p">);</span>
	<span class="tok-nt">&lt;/script&gt;</span>
<span class="tok-nt">&lt;/head&gt;</span>
<span class="tok-nt">&lt;body&gt;&lt;/body&gt;</span>
<span class="tok-nt">&lt;/html&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Podéis observar que hemos utilizado la instrucción <code>console.log</code> para mostrar el saludo, pero que realmente, al probarlo en el navegador sólo aparece el mensaje con <code>alert</code>. Para visualizar los mensajes que pasamos por la consola necesitamos utilizar las <em>DevTools</em> que veremos a continuación.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_herramientas">1.3. Herramientas</h3>
<div class="paragraph">
<p>En el curso vamos a utilizar <strong><em>Intellij IDEA</em></strong> (<a href="http://www.jetbrains.com/idea/" class="bare">http://www.jetbrains.com/idea/</a>) para editar nuestros archivos <em>JavaScript</em>, aunque cualquier IDE como <em>Netbeans</em> cumplen de sobra con su propósito.</p>
</div>
<div class="paragraph">
<p>El segundo elemento imprescindible a la hora de aprender un lenguaje es la referencia del mismo. Para ello, Mozilla mantiene la MDN (<em>Mozilla Developer Network</em>) con una extensa referencia de <em>JavaScript</em> llena de ejemplos, en <a href="https://developer.mozilla.org/en/docs/Web/JavaScript/Reference" class="bare">https://developer.mozilla.org/en/docs/Web/JavaScript/Reference</a> que también está traducida (aunque en muchas ocasiones sin tanto contenido) en <a href="https://developer.mozilla.org/es/docs/JavaScript/Referencia" class="bare">https://developer.mozilla.org/es/docs/JavaScript/Referencia</a>. A lo largo de los apuntes tendremos varios enlaces a la MDN para ampliar la información.</p>
</div>
<div class="paragraph">
<p>Para hacer pequeñas pruebas, el hecho de tener que crear un documento HTML que enlace a un documento <em>JavaScript</em> se puede hacer tedioso. Para ello, existen diferentes <em>"parques"</em> donde jugar con nuestro código. Dos de los más conocidos son <strong><em>JSBin</em></strong> (<a href="http://jsbin.com" class="bare">http://jsbin.com</a>) y <strong><em>JSFiddle</em></strong> (<a href="http://jsfiddle.net" class="bare">http://jsfiddle.net</a>).</p>
</div>
<div class="paragraph">
<p>Ambos nos permiten probar código en caliente, e interactuar con código HTML, CSS y usar librerías de terceros como <em>jQuery</em>.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/js01/jsbin.jpg" alt="Ejemplo de uso de JSBin" width="100%">
</div>
<div class="title">Figure 2. JSBin - <a href="http://jsbin.com/wikoha/1/edit?html,js,console" class="bare">http://jsbin.com/wikoha/1/edit?html,js,console</a></div>
</div>
<div class="paragraph">
<p>Otro tipo de herramientas que podemos usar son los validadores de código o herramientas de control de calidad del código, que aconsejan una serie de pautas para minimizar los errores. En esta categoría podemos destacar tanto <strong><em>JSHint</em></strong> (<a href="http://www.jshint.com" class="bare">http://www.jshint.com</a>) como <strong><em>JSLint</em></strong> (<a href="http://www.jslint.com" class="bare">http://www.jslint.com</a>). En ambos casos, existen <em>plugins</em> para todos los IDEs del mercado, así como interfaces web para realizar pruebas básicas con nuestro código.</p>
</div>
<div class="paragraph">
<p>Finalmente, necesitamos un navegador web el cual incluya un interprete de <em>JavaScript</em>. En el módulo vamos a utilizar <em>Google Chrome</em> y <em>Mozilla Firefox</em> indistintamente. Cada navegador incluye un motor <em>JavaScript</em> diferente, el cual se encarga de interpretar las instrucciones y renderizar la página mediante la implementación de <em>ECMAScript</em> adecuada:</p>
</div>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 28%;">
<col style="width: 28%;">
<col style="width: 42%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-center valign-middle">Motor</th>
<th class="tableblock halign-left valign-top">Navegador</th>
<th class="tableblock halign-left valign-top">ECMAScript</th>
</tr>
</thead>
<tbody>
<tr>
<th class="tableblock halign-center valign-middle"><p class="tableblock">Chrome V8</p></th>
<td class="tableblock halign-left valign-top"><p class="tableblock">Google Chrome</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ECMA-262, edition 5</p></td>
</tr>
<tr>
<th class="tableblock halign-center valign-middle"><p class="tableblock">SpiderMonkey 24</p></th>
<td class="tableblock halign-left valign-top"><p class="tableblock">Mozilla Firefox</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ECMA-262, edition 5</p></td>
</tr>
<tr>
<th class="tableblock halign-center valign-middle"><p class="tableblock">Nitro</p></th>
<td class="tableblock halign-left valign-top"><p class="tableblock">Safari</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ECMA-262, edition 5.1</p></td>
</tr>
<tr>
<th class="tableblock halign-center valign-middle"><p class="tableblock">Chakra</p></th>
<td class="tableblock halign-left valign-top"><p class="tableblock">Internet Explorer</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ECMA-262, edition 5</p></td>
</tr>
</tbody>
</table>
<div class="sect3">
<h4 id="__em_dev_tools_em">1.3.1. <em>Dev Tools</em></h4>
<div class="paragraph">
<p>Y por último, aunque cada vez menos necesarias como herramientas de terceros, tenemos las herramientas de depuración de código. Los navegadores actuales incluyen las herramientas para el desarrollador que permiten interactuar con la página que se ha cargado permitiendo tanto la edición del código <em>JavaScript</em> como el estilo de la página, visualizar la consola con los mensajes y errores mostrados, evaluar y auditar su rendimiento, así como depurar el código que se ejecuta. Dentro de este apartado tenemos <strong><em>Firebug</em></strong> (<a href="http://getfirebug.com" class="bare">http://getfirebug.com</a>) como una extensión de <em>Firefox</em>, y las herramientas que integran los navegadores:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Google Chrome - Chrome Developers Tools (<a href="https://developer.chrome.com/devtools" class="bare">https://developer.chrome.com/devtools</a>)</p>
</li>
<li>
<p>Mozilla Firefox: <a href="https://developer.mozilla.org/es/docs/Tools" class="bare">https://developer.mozilla.org/es/docs/Tools</a></p>
</li>
<li>
<p>Safari: <a href="https://developer.apple.com/safari/tools/" class="bare">https://developer.apple.com/safari/tools/</a></p>
</li>
<li>
<p>Internet Explorer - F12: <a href="http://msdn.microsoft.com/es-ES/library/ie/bg182326" class="bare">http://msdn.microsoft.com/es-ES/library/ie/bg182326</a></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>A continuación vamos a centrarnos en las <em>Chrome Developer Tools</em>. Nada más abrirlas, ya sea con el botón derecho e <em>Inspeccionar Elemento</em>, mediante el menú de <span class="menuseq"><span class="menu">Ver</span>&#160;&#9656; <span class="submenu">Opciones para desarrolladores</span>&#160;&#9656; <span class="menuitem">Herramientas para Desarrolladores</span></span> o mediante <kbd>F12</kbd>, <span class="keyseq"><kbd>Ctrl</kbd>+<kbd>Shift</kbd>+<kbd>I</kbd></span> o en Mac <span class="keyseq"><kbd>Command</kbd>+<kbd>Opt</kbd>+<kbd>I</kbd></span>, aparece activa la pestaña de <em>Elements</em>.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/js01/jsDevTools.jpg" alt="DevTools en Google Chrome" width="75%">
</div>
<div class="title">Figure 3. DevTools</div>
</div>
<div class="paragraph">
<p>Se puede observar que la pestaña <em>Elements</em> divide la pantalla en varios bloques:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Página web</strong>, en la parte superior, donde se muestra la representación de la misma</p>
</li>
<li>
<p><strong>HTML</strong>, a la izquierda, con el código de la página (representación DOM), la cual, conforme pasemos el ratón por el código, se resaltará la presentación visual en el bloque anterior. En cualquier momento podremos editar el contenido de un nodo, añadir o eliminar atributos e incluso trasladar o eliminar nodos enteros.</p>
</li>
<li>
<p><strong>CSS</strong>, a la derecha, con los estilos (<em>styles</em>) estáticos y los calculados, así como los eventos del elemento seleccionado en el bloque HTML. Además de poder ver qué reglas están activas, podemos habilitar o deshabilitar propiedades, editar las reglas de las pseudo-clases (<code>active</code>, <code>hover</code>, etc&#8230;&#8203;) y acceder al fuente de un determinado estilo.</p>
</li>
<li>
<p><strong>Consola</strong>, en la parte inferior, donde veremos los mensajes y errores de la página.</p>
</li>
</ul>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
Si queremos visualizar que nodo se seleccionaría al utilizar un determinado selector, podemos hacer uso del método <code>inspect(selector)</code> dentro de la consola. Veremos el uso de selectores mediante las <em>DevTools</em> en la tercera sesión donde estudiaremos <a href="#sesion03">JavaScript y DOM</a>.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Otra pestaña con la que vamos a trabajar es la de fuentes (<em>Sources</em>), desde la cual podemos editar el código fuente de nuestros archivos JS, CSS o HTML (desde la caché local de <em>Chrome</em>). Las <em>DevTools</em> almacenan un histórico de nuestros cambios (<em>Local Modifications</em>) desde donde podemos revertir un cambio a un punto anterior. Una vez tenemos la versión definitiva, podemos guardar los cambios en el fuente de nuestro proyecto mediante <em>Save As</em>.</p>
</div>
<div class="paragraph">
<p>Además, si queremos podemos depurar el código de nuestra aplicación haciendo uso de manera conjunta del código fuente y del panel derecho de <em>Sources</em>, donde podemos añadir <em>breakpoints</em>, pausar la ejecución del código al producirse una excepción, así como evaluar el contenido de las variables (pasando el ratón por encima del código) y la pila de ejecución.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/js01/jsDevToolsDebug.jpg" alt="Debug en las DevTools" width="100%">
</div>
<div class="title">Figure 4. Debug en las DevTools</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
Un tutorial muy completo sobre las <em>Dev-Tools</em>, en vídeo pero con subtítulos en castellano y patrocinado por <em>Google</em> es <a href="http://discover-devtools.codeschool.com/" class="bare">http://discover-devtools.codeschool.com/</a>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="__em_console_api_em">1.3.2. <em>Console API</em></h4>
<div class="paragraph">
<p>En los apuntes vamos a usar el objeto <code>console</code> para mostrar resultados (también podríamos usar <code>alert</code> pero es más molesto). Este objeto no es parte del lenguaje pero sí del entorno y está presente en la mayoría de los navegadores, ya sea en las herramientas del desarrollador o en el inspector web.</p>
</div>
<div class="paragraph">
<p>Así pues, dentro de la consola de las <em>Dev-Tools</em> podremos visualizar los mensajes que enviemos a la consola así como ejecutar comandos <em>JavaScript</em> sobre el código ejecutado.</p>
</div>
<div class="paragraph">
<p>Centrándonos en la <em>Console API</em>, los métodos que podemos usar son:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>log()</code>: muestra por la consola todos los parámetros recibidos, ya sean cadenas u objetos.</p>
<div class="ulist">
<ul>
<li>
<p><code>info()</code>, <code>warn()</code>, <code>error()</code>: muestran mensajes con diferentes niveles de log, normalmente representados con un color distinto.</p>
</li>
</ul>
</div>
</li>
<li>
<p><code>dir()</code>: enumera los objetos recibidos e imprime todas sus propiedades.</p>
</li>
<li>
<p><code>assert()</code>: permite comprobar si se cumple una aserción booleana.</p>
</li>
<li>
<p><code>time()</code> y <code>timeEnd()</code>: calcula el tiempo empleado entre las dos instrucciones</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Por ejemplo, si ejecutamos el siguiente código:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="javascript"><span class="tok-nx">console</span><span class="tok-p">.</span><span class="tok-nx">log</span><span class="tok-p">(</span><span class="tok-s2">&quot;prueba&quot;</span><span class="tok-p">,</span> <span class="tok-mi">1</span><span class="tok-p">,</span> <span class="tok-p">{},</span> <span class="tok-p">[</span><span class="tok-mi">1</span><span class="tok-p">,</span><span class="tok-mi">2</span><span class="tok-p">,</span><span class="tok-mi">3</span><span class="tok-p">]);</span>
<span class="tok-nx">console</span><span class="tok-p">.</span><span class="tok-nx">dir</span><span class="tok-p">({</span><span class="tok-nx">uno</span><span class="tok-o">:</span> <span class="tok-mi">1</span><span class="tok-p">,</span> <span class="tok-nx">dos</span><span class="tok-o">:</span> <span class="tok-p">{</span><span class="tok-nx">tres</span><span class="tok-o">:</span> <span class="tok-mi">3</span><span class="tok-p">}});</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Obtendremos:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/js01/jsConsole.jpg" alt="Uso del objeto console" width="50%">
</div>
<div class="title">Figure 5. Uso del objeto console</div>
</div>
<div class="paragraph">
<p>Si queremos, podemos escribir en la consola sin necesidad de usar <code>console.log()</code>. Esto nos permite probar pequeños cambios o consultar valores de determinados campos, similar a un entorno de depuración que ofrezca un IDE, con completado de código automático (mediante <kbd>TAB</kbd>).</p>
</div>
<div class="paragraph">
<p>Más información del uso de <em>Console API</em> en <a href="https://developer.mozilla.org/en-US/docs/Web/API/console" class="bare">https://developer.mozilla.org/en-US/docs/Web/API/console</a></p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_datos_y_variables">1.4. Datos y variables</h3>
<div class="paragraph">
<p>Como todo lenguaje de programación, <em>JavaScript</em> soporta tanto datos de texto como numéricos, los cuales se almacenan en variables.</p>
</div>
<div class="sect3">
<h4 id="_variables">1.4.1. Variables</h4>
<div class="paragraph">
<p>Para declarar una variable, se utiliza la palabra clave <code>var</code> delante del nombre de variable.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="javascript"><span class="tok-kd">var</span> <span class="tok-nx">contador</span><span class="tok-p">;</span> <span class="tok-c1">// undefined</span>
<span class="tok-nx">contador</span> <span class="tok-o">=</span> <span class="tok-mi">5</span><span class="tok-p">;</span></code></pre>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
Los comentarios siguen la misma sintaxis de Java mediante <code>//</code> y <code>/* */</code>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Los nombres de las variables pueden empezar por minúsculas, mayúsculas, subrayado e incluso con <code>$</code>, pero no pueden empezar con números. Además el nombrado es sensible al uso de las mayúsculas y minúsculas, por lo que no es lo mismo <code>contador</code> que <code>Contador</code>.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
Se recomienda que las variables comiencen con minúsculas, sigan la notación <em>camelCase</em>, tengan un nombre auto-explicativo, y que se evite el uso de <code>$</code> ya que se trata de un carácter muy utilizado por las librerías (en especial, por <em>jQuery</em>) y puede hacer el código menos legible.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>El tipo de datos asociado a la variable se asigna de manera automática. Si al declarar la variable no le asignamos ningún valor, <em>JavaScript</em> le asigna el tipo <code>undefined</code>. Posteriormente podemos cambiar su tipo en cualquier momento asignándole un nuevo valor.</p>
</div>
<div class="paragraph">
<p>La diferencia entre <code>undefined</code> y <code>null</code> es académica y no muy significativa. En los programas en los cuales sea necesario comprobar si algo "tiene un valor", podemos usar la expresión <code>algo == undefined</code>, ya que aunque no sean el mismo valor, la expresión <code>null == undefined</code> producirá verdadero.</p>
</div>
<div class="paragraph">
<p>Otra característica de <em>JavaScript</em> es que podemos asignar valores a variables que no hemos declarado:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="javascript"><span class="tok-kd">var</span> <span class="tok-nx">a</span> <span class="tok-o">=</span> <span class="tok-mi">3</span><span class="tok-p">;</span>
<span class="tok-nx">b</span> <span class="tok-o">=</span> <span class="tok-mi">5</span><span class="tok-p">;</span>
<span class="tok-nx">c</span> <span class="tok-o">=</span> <span class="tok-nx">a</span> <span class="tok-o">+</span> <span class="tok-nx">b</span><span class="tok-p">;</span> <span class="tok-c1">// 8</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Al hacer esto, la variable pasa a tener un alcance global, y aunque sea posible, es mejor evitar su uso. Por ello, esta característica queda en desuso si usamos el modo estricto de ES5:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="javascript"><span class="tok-s2">&quot;use strict&quot;</span><span class="tok-p">;</span>
<span class="tok-kd">var</span> <span class="tok-nx">a</span> <span class="tok-o">=</span> <span class="tok-mi">3</span><span class="tok-p">;</span>
<span class="tok-nx">b</span> <span class="tok-o">=</span> <span class="tok-mi">5</span><span class="tok-p">;</span> <span class="tok-c1">// Uncaught ReferenceError: b is not defined</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Un característica especial de <em>JavaScript</em> es la gestión que hace de las variables conocida como <strong><em>hoisting</em></strong> (elevación). Este concepto permite tener múltiples declaraciones con <code>var</code> a lo largo de un bloque, y todas ellas actuarán como si estuviesen declaradas al inicio del mismo:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="javascript"><span class="tok-kd">var</span> <span class="tok-nx">a</span> <span class="tok-o">=</span> <span class="tok-mi">3</span><span class="tok-p">;</span>
<span class="tok-nx">console</span><span class="tok-p">.</span><span class="tok-nx">log</span><span class="tok-p">(</span><span class="tok-nx">b</span><span class="tok-p">);</span>	<span class="tok-c1">// undefined</span>
<span class="tok-kd">var</span> <span class="tok-nx">b</span> <span class="tok-o">=</span> <span class="tok-mi">5</span><span class="tok-p">;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Es decir, al referenciar a la variable <code>b</code> antes de su declaración no obtendremos el valor de la variable global <code>b</code>, sino <code>undefined</code>. Cuando estudiemos las funciones y el alcance de las variables volveremos a este concepto.</p>
</div>
<div class="paragraph">
<p>Por ello, una buena práctica que se considera como un patrón de diseño (<em>Single Var</em>) es declarar las variables con una única instrucción <code>var</code> en la primera línea de cada bloque (normalmente al inicio de cada función), lo que facilita su lectura:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="javascript"><span class="tok-kd">var</span> <span class="tok-nx">a</span> <span class="tok-o">=</span> <span class="tok-mi">3</span><span class="tok-p">,</span>
	<span class="tok-nx">b</span> <span class="tok-o">=</span> <span class="tok-mi">5</span><span class="tok-p">,</span>
	<span class="tok-nx">suma</span> <span class="tok-o">=</span> <span class="tok-nx">a</span> <span class="tok-o">+</span> <span class="tok-nx">b</span><span class="tok-p">,</span>
	<span class="tok-nx">z</span><span class="tok-p">;</span></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_texto">1.4.2. Texto</h4>
<div class="paragraph">
<p><em>JavaScript</em> almacena las cadenas mediante <em>UTF-16</em>. Podemos crear cadenas tanto con comillas dobles como simples. Podemos incluir comillas dobles dentro de una cadena creada con comillas simples, así como comillas simples dentro de una cadena creada con comillas dobles.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="javascript"><span class="tok-s2">&quot;&quot;</span> <span class="tok-c1">// cadena vacía</span>
<span class="tok-s1">&#39;probando&#39;</span>
<span class="tok-s2">&quot;3.14&quot;</span>
<span class="tok-s1">&#39;nombre=&quot;miFormulario&quot;&#39;</span>
<span class="tok-s2">&quot;comemos en el McDonald&#39;s&quot;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Para concatenar cadenas se utiliza el operador <code>+</code>. Otra propiedad muy utilizada es <code>length</code> para averiguar el tamaño de una cadena.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="javascript"><span class="tok-kd">var</span> <span class="tok-nx">msj</span> <span class="tok-o">=</span> <span class="tok-s2">&quot;Hola &quot;</span> <span class="tok-o">+</span> <span class="tok-s2">&quot;Mundo&quot;</span><span class="tok-p">;</span>
<span class="tok-kd">var</span> <span class="tok-nx">tam</span> <span class="tok-o">=</span> <span class="tok-nx">msj</span><span class="tok-p">.</span><span class="tok-nx">length</span><span class="tok-p">;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p><em>JavaScript</em> soporta una serie de operaciones para tratar las cadenas, como <code>charAt(<em>indice</em>)</code> (0-index), <code>substring(<em>inicio</em> [,<em>fin</em>])</code>, <code>indexOf(<em>cadena</em>)</code>/<code>lastIndexOf(<em>cadena</em>)</code>, <code>trim()</code>, <code>replace()</code> &#8230;&#8203; Por ejemplo:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="javascript"><span class="tok-kd">var</span> <span class="tok-nx">nombre</span> <span class="tok-o">=</span> <span class="tok-s2">&quot;Bruce Wayne&quot;</span><span class="tok-p">;</span>

<span class="tok-nx">console</span><span class="tok-p">.</span><span class="tok-nx">log</span><span class="tok-p">(</span><span class="tok-nx">nombre</span><span class="tok-p">);</span>
<span class="tok-nx">console</span><span class="tok-p">.</span><span class="tok-nx">log</span><span class="tok-p">(</span><span class="tok-k">typeof</span><span class="tok-p">(</span><span class="tok-nx">nombre</span><span class="tok-p">));</span>  <span class="tok-c1">//  &quot;string&quot;</span>
<span class="tok-nx">console</span><span class="tok-p">.</span><span class="tok-nx">log</span><span class="tok-p">(</span><span class="tok-nx">nombre</span><span class="tok-p">.</span><span class="tok-nx">toUpperCase</span><span class="tok-p">());</span>
<span class="tok-nx">console</span><span class="tok-p">.</span><span class="tok-nx">log</span><span class="tok-p">(</span><span class="tok-nx">nombre</span><span class="tok-p">.</span><span class="tok-nx">toLowerCase</span><span class="tok-p">());</span>

<span class="tok-nx">console</span><span class="tok-p">.</span><span class="tok-nx">log</span><span class="tok-p">(</span><span class="tok-nx">nombre</span><span class="tok-p">.</span><span class="tok-nx">length</span><span class="tok-p">);</span> <span class="tok-c1">// 11 -&gt; es una propiedad</span>

<span class="tok-nx">console</span><span class="tok-p">.</span><span class="tok-nx">log</span><span class="tok-p">(</span><span class="tok-nx">nombre</span><span class="tok-p">.</span><span class="tok-nx">charAt</span><span class="tok-p">(</span><span class="tok-mi">0</span><span class="tok-p">));</span>  <span class="tok-c1">// &quot;B&quot;</span>
<span class="tok-nx">console</span><span class="tok-p">.</span><span class="tok-nx">log</span><span class="tok-p">(</span><span class="tok-nx">nombre</span><span class="tok-p">.</span><span class="tok-nx">charAt</span><span class="tok-p">(</span><span class="tok-o">-</span><span class="tok-mi">1</span><span class="tok-p">));</span>  <span class="tok-c1">// &quot;&quot;</span>

<span class="tok-nx">console</span><span class="tok-p">.</span><span class="tok-nx">log</span><span class="tok-p">(</span><span class="tok-nx">nombre</span><span class="tok-p">.</span><span class="tok-nx">indexOf</span><span class="tok-p">(</span><span class="tok-s2">&quot;u&quot;</span><span class="tok-p">));</span> <span class="tok-c1">// 2</span>
<span class="tok-nx">console</span><span class="tok-p">.</span><span class="tok-nx">log</span><span class="tok-p">(</span><span class="tok-nx">nombre</span><span class="tok-p">.</span><span class="tok-nx">lastIndexOf</span><span class="tok-p">(</span><span class="tok-s2">&quot;ce&quot;</span><span class="tok-p">));</span>  <span class="tok-c1">// 3</span>
<span class="tok-nx">console</span><span class="tok-p">.</span><span class="tok-nx">log</span><span class="tok-p">(</span><span class="tok-nx">nombre</span><span class="tok-p">.</span><span class="tok-nx">lastIndexOf</span><span class="tok-p">(</span><span class="tok-s2">&quot;Super&quot;</span><span class="tok-p">));</span>  <span class="tok-c1">// -1</span>

<span class="tok-nx">console</span><span class="tok-p">.</span><span class="tok-nx">log</span><span class="tok-p">(</span><span class="tok-nx">nombre</span><span class="tok-p">.</span><span class="tok-nx">substring</span><span class="tok-p">(</span><span class="tok-mi">6</span><span class="tok-p">));</span> <span class="tok-c1">// &quot;Wayne&quot;</span>
<span class="tok-nx">console</span><span class="tok-p">.</span><span class="tok-nx">log</span><span class="tok-p">(</span><span class="tok-nx">nombre</span><span class="tok-p">.</span><span class="tok-nx">substring</span><span class="tok-p">(</span><span class="tok-mi">6</span><span class="tok-p">,</span><span class="tok-mi">9</span><span class="tok-p">));</span> <span class="tok-c1">// &quot;Way&quot;</span>

<span class="tok-nx">console</span><span class="tok-p">.</span><span class="tok-nx">log</span><span class="tok-p">(</span><span class="tok-nx">nombre</span><span class="tok-p">.</span><span class="tok-nx">replace</span><span class="tok-p">(</span><span class="tok-s2">&quot;e&quot;</span><span class="tok-p">,</span><span class="tok-s2">&quot;i&quot;</span><span class="tok-p">));</span>	<span class="tok-c1">// &quot;Bruci Wayne&quot;; </span> <i class="conum" data-value="1"></i><b>(1)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>El método <code>replace</code> sólo sustituye la primera ocurrencia. Ampliaremos su explicación al estudiar las expresiones regulares</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Un método que conviene repasar es <code>split(<em>separador</em>)</code> que separa una cadena en un array de subcadenas divididas por el <em>separador</em>. Por ejemplo:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="javascript"><span class="tok-kd">var</span> <span class="tok-nx">frase</span> <span class="tok-o">=</span> <span class="tok-s2">&quot;En un lugar de la Mancha&quot;</span><span class="tok-p">;</span>
<span class="tok-kd">var</span> <span class="tok-nx">trozos</span> <span class="tok-o">=</span> <span class="tok-nx">frase</span><span class="tok-p">.</span><span class="tok-nx">split</span><span class="tok-p">(</span><span class="tok-s2">&quot; &quot;</span><span class="tok-p">);</span> <span class="tok-c1">// [&quot;En&quot;, &quot;un&quot;, &quot;lugar&quot;, &quot;de&quot;, &quot;la&quot;, &quot;Mancha&quot;]</span>
<span class="tok-kd">var</span> <span class="tok-nx">truzus</span> <span class="tok-o">=</span> <span class="tok-nx">frase</span><span class="tok-p">.</span><span class="tok-nx">split</span><span class="tok-p">(</span><span class="tok-s2">&quot;u&quot;</span><span class="tok-p">);</span> <span class="tok-c1">// [&quot;En &quot;, &quot;n l&quot;, &quot;gar de la Mancha&quot;]</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Más información en: <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/String" class="bare">https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/String</a></p>
</div>
<div class="paragraph">
<p>Desde <em>ECMAScript</em> 5, las cadenas se tratan como arrays de sólo lectura, por lo cual podemos acceder a los caracteres individuales mediante la notación de array:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="javascript"><span class="tok-nx">s</span> <span class="tok-o">=</span> <span class="tok-s2">&quot;Hola Mundo&quot;</span><span class="tok-p">;</span>
<span class="tok-nx">s</span><span class="tok-p">[</span><span class="tok-mi">0</span><span class="tok-p">]</span>		<span class="tok-c1">// H</span>
<span class="tok-nx">s</span><span class="tok-p">[</span><span class="tok-nx">s</span><span class="tok-p">.</span><span class="tok-nx">length</span><span class="tok-o">-</span><span class="tok-mi">1</span><span class="tok-p">]</span>	<span class="tok-c1">// o</span></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_números">1.4.3. Números</h4>
<div class="paragraph">
<p>Todos los números en <em>JavaScript</em> se almacenan como números de punto flotante de 64 bits. Para crear variables numéricas, le asignaremos el valor a la variable.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="javascript"><span class="tok-kd">var</span> <span class="tok-nx">diez</span> <span class="tok-o">=</span> <span class="tok-mi">10</span><span class="tok-p">;</span> <span class="tok-c1">// entero</span>
<span class="tok-kd">var</span> <span class="tok-nx">pi</span> <span class="tok-o">=</span> <span class="tok-mf">3.14</span><span class="tok-p">;</span> <span class="tok-c1">// real</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Si necesitamos redondear una cifra a un número determinado de decimales usaremos el método <code>toFixed(<em>dígitos</em>)</code>, el cual devuelve la cifra original con tantos decimales como los indicados por el parámetro <em>dígitos</em> realizando los redondeos necesarios:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="javascript"><span class="tok-kd">var</span> <span class="tok-nx">pi</span> <span class="tok-o">=</span> <span class="tok-mf">3.14159265</span><span class="tok-p">;</span>
<span class="tok-nx">console</span><span class="tok-p">.</span><span class="tok-nx">log</span><span class="tok-p">(</span><span class="tok-nx">pi</span><span class="tok-p">.</span><span class="tok-nx">toFixed</span><span class="tok-p">(</span><span class="tok-mi">0</span><span class="tok-p">));</span> <span class="tok-c1">// 3</span>
<span class="tok-nx">console</span><span class="tok-p">.</span><span class="tok-nx">log</span><span class="tok-p">(</span><span class="tok-nx">pi</span><span class="tok-p">.</span><span class="tok-nx">toFixed</span><span class="tok-p">(</span><span class="tok-mi">2</span><span class="tok-p">));</span> <span class="tok-c1">// 3.14</span>
<span class="tok-nx">console</span><span class="tok-p">.</span><span class="tok-nx">log</span><span class="tok-p">(</span><span class="tok-nx">pi</span><span class="tok-p">.</span><span class="tok-nx">toFixed</span><span class="tok-p">(</span><span class="tok-mi">4</span><span class="tok-p">));</span> <span class="tok-c1">// 3.1416</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Podemos utilizar los operadores aritméticos básicos como la suma <code>+</code>, la resta <code>-</code>, el producto <code>*</code> la división <code>/</code> y el resto <code>%</code>.
Para cualquier otra operación, podemos utilizar el objeto <code>Math</code> para operaciones como la potencia (<code>Math.pow(base,exp)</code>), raíz cuadrada (<code>Math.sqrt(num)</code>), redondear (<code>Math.round(num)</code>, <code>Math.ceil(num)</code>, <code>Math.floor(num)</code>), obtener el mayor (<code>Math.max(num1, num2,&#8230;&#8203;)</code>), obtener el menor (<code>Math.min(num1, num2, &#8230;&#8203;)</code>), un número aleatorio en 0 y 1 (<code>Math.random()</code>), el número pi (<code>Math.PI</code>), etc&#8230;&#8203; Más información en <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Math" class="bare">https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Math</a></p>
</div>
<div class="paragraph">
<p>Para pasar una cadena a un número, utilizaremos la función global <code>parseInt(cadena [, base])</code>, donde la base por defecto es 10, es decir, decimal. Igualmente, para pasar a un número real, usaremos la función global <code>parseFloat(cadena [, base])</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="javascript"><span class="tok-kd">var</span> <span class="tok-nx">cadena</span> <span class="tok-o">=</span> <span class="tok-s2">&quot;3.14&quot;</span><span class="tok-p">;</span>
<span class="tok-kd">var</span> <span class="tok-nx">pi</span> <span class="tok-o">=</span> <span class="tok-nb">parseFloat</span><span class="tok-p">(</span><span class="tok-nx">cadena</span><span class="tok-p">,</span> <span class="tok-mi">10</span><span class="tok-p">);</span>
<span class="tok-kd">var</span> <span class="tok-nx">tres</span> <span class="tok-o">=</span> <span class="tok-nb">parseInt</span><span class="tok-p">(</span><span class="tok-nx">pi</span><span class="tok-p">,</span> <span class="tok-mi">10</span><span class="tok-p">);</span></code></pre>
</div>
</div>
<div class="paragraph">
<p><em>JavaScript</em> emplea el valor <code>NaN</code> (que significa <em>NotANumber</em>) para indicar un valor numérico no definido, por ejemplo, la división <code>0/0</code> o al parsear un texto que no coincide con ningún número.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="javascript"><span class="tok-kd">var</span> <span class="tok-nx">numero1</span> <span class="tok-o">=</span> <span class="tok-mi">0</span><span class="tok-p">;</span>
<span class="tok-kd">var</span> <span class="tok-nx">numero2</span> <span class="tok-o">=</span> <span class="tok-mi">0</span><span class="tok-p">;</span>
<span class="tok-nx">console</span><span class="tok-p">.</span><span class="tok-nx">log</span><span class="tok-p">(</span><span class="tok-nx">numero1</span><span class="tok-o">/</span><span class="tok-nx">numero2</span><span class="tok-p">);</span> <span class="tok-c1">// NaN</span>
<span class="tok-nx">console</span><span class="tok-p">.</span><span class="tok-nx">log</span><span class="tok-p">(</span><span class="tok-nb">parseInt</span><span class="tok-p">(</span><span class="tok-s2">&quot;tres&quot;</span><span class="tok-p">));</span> <span class="tok-c1">// NaN</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Si en alguna ocasión queremos averiguar si una variable no es un número, usaremos la función <code>isNaN(valor)</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="javascript"><span class="tok-kd">var</span> <span class="tok-nx">miNumero</span> <span class="tok-o">=</span> <span class="tok-s2">&quot;tres&quot;</span><span class="tok-p">;</span>
<span class="tok-k">if</span> <span class="tok-p">(</span><span class="tok-nb">isNaN</span><span class="tok-p">(</span><span class="tok-nx">miNumero</span><span class="tok-p">))</span> <span class="tok-p">{</span>
	<span class="tok-nx">console</span><span class="tok-p">.</span><span class="tok-nx">log</span><span class="tok-p">(</span><span class="tok-s2">&quot;¡No es un número!&quot;</span><span class="tok-p">);</span>
<span class="tok-p">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Finalmente, si necesitamos referenciar a un valor númerico infinito y positivo, usaremos la constante <code>Infinity</code>. También existe <code>-Infinity</code> para los infinitos negativos.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="javascript"><span class="tok-kd">var</span> <span class="tok-nx">numero1</span> <span class="tok-o">=</span> <span class="tok-mi">10</span><span class="tok-p">;</span>
<span class="tok-kd">var</span> <span class="tok-nx">numero2</span> <span class="tok-o">=</span> <span class="tok-mi">0</span><span class="tok-p">;</span>
<span class="tok-nx">console</span><span class="tok-p">.</span><span class="tok-nx">log</span><span class="tok-p">(</span><span class="tok-nx">numero1</span><span class="tok-o">/</span><span class="tok-nx">numero2</span><span class="tok-p">);</span> <span class="tok-c1">// Infinity</span></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_booleanos">1.4.4. Booleanos</h4>
<div class="paragraph">
<p>Podemos guardar valores de <code>true</code> y <code>false</code> en las variables de tipo <code>boolean</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="javascript"><span class="tok-kd">var</span> <span class="tok-nx">esBooleano</span> <span class="tok-o">=</span> <span class="tok-kc">true</span><span class="tok-p">;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Los operadores que trabajan con booleanos son la conjunción <code>&amp;&amp;</code>, la disyunción <code>||</code> y la negación <code>!</code>. Además, tenemos el operador ternario <code>(cond) ? valorVerdadero : valorFalso</code>.</p>
</div>
<div class="paragraph">
<p>Si un valor es <code>0</code>, <code>-0</code>, <code>null</code>, <code>false</code>, <code>NaN</code>, <code>undefined</code>, o una cadena vacía (<code>""</code>), entonces es falso. Cualquier otro valor en <em>JavaScript</em> a excepción de los valores comentados se convertirán en verdadero al usarlos dentro de un contexto <em>booleano</em>, (por ejemplo, <code>if (true) {};</code>).</p>
</div>
<div class="paragraph">
<p>Es decir, tanto los números distintos de cero, como los objetos y arrays devuelven verdadero. En cambio, el cero, <code>null</code> y el valor <code>undefined</code> son falsos.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="title">Operador ===</div>
<div class="paragraph">
<p>Aparte de los operadores básicos de comparación (<code>&lt;</code>, <code>&lt;=</code>, <code>&gt;</code>, <code>&gt;=</code>, <code>==</code>, <code>!=</code>), <em>JavaScript</em> ofrece el operador <em>identidad</em> ( o igualdad estricta), representado con tres iguales (<code>===</code>)</p>
</div>
<div class="paragraph">
<p>La principal diferencia con el operador igualdad (<code>==</code>) es que éste realiza conversión de tipos, mientras que el operador identidad (<code>===</code>) no realiza conversión. Así tendríamos:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="javascript"><span class="tok-kd">var</span> <span class="tok-nx">verdadero</span> <span class="tok-o">=</span> <span class="tok-p">(</span><span class="tok-s2">&quot;1&quot;</span> <span class="tok-o">==</span> <span class="tok-kc">true</span><span class="tok-p">);</span>
<span class="tok-kd">var</span> <span class="tok-nx">falso</span> <span class="tok-o">=</span> <span class="tok-p">(</span><span class="tok-s2">&quot;1&quot;</span> <span class="tok-o">===</span> <span class="tok-kc">true</span><span class="tok-p">);</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Por supuesto, también existe su operador negado (<code>!==</code>).</p>
</div>
<div class="paragraph">
<p>La comunidad <em>JavaScript</em> recomienda usar siempre el operador <em>identidad</em> en contra del <em>igualdad</em> para evitar la conversión de tipos, es decir, <strong>mejor 3 iguales que 2</strong>.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_coerción_de_tipos">1.4.5. Coerción de tipos</h4>
<div class="paragraph">
<p>Cuando a un operador se le aplica un valor con un tipo de datos incorrecto, <em>JavaScript</em> convertirá el valor al tipo que necesita, mediante un conjunto de reglas que puede que no sean las que nosotros esperamos. A este comportamiento se le conoce como <strong>coerción de tipos</strong>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="javascript"><span class="tok-nx">console</span><span class="tok-p">.</span><span class="tok-nx">log</span><span class="tok-p">(</span><span class="tok-mi">8</span> <span class="tok-o">*</span> <span class="tok-kc">null</span><span class="tok-p">)</span> <span class="tok-c1">// 0</span>
<span class="tok-nx">console</span><span class="tok-p">.</span><span class="tok-nx">log</span><span class="tok-p">(</span><span class="tok-s2">&quot;5&quot;</span> <span class="tok-o">-</span> <span class="tok-mi">1</span><span class="tok-p">)</span> <span class="tok-c1">// 4</span>
<span class="tok-nx">console</span><span class="tok-p">.</span><span class="tok-nx">log</span><span class="tok-p">(</span><span class="tok-s2">&quot;5&quot;</span> <span class="tok-o">+</span> <span class="tok-mi">1</span><span class="tok-p">)</span> <span class="tok-c1">// 51</span>
<span class="tok-nx">console</span><span class="tok-p">.</span><span class="tok-nx">log</span><span class="tok-p">(</span><span class="tok-s2">&quot;five&quot;</span> <span class="tok-o">*</span> <span class="tok-mi">2</span><span class="tok-p">)</span> <span class="tok-c1">// NaN</span>
<span class="tok-nx">console</span><span class="tok-p">.</span><span class="tok-nx">log</span><span class="tok-p">(</span><span class="tok-kc">false</span> <span class="tok-o">==</span> <span class="tok-mi">0</span><span class="tok-p">)</span> <span class="tok-c1">// true</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Por ejemplo, el operador suma siempre intenta concatenar, con lo cual convierte de manera automáticas los números a textos. En cambio, la resta realiza la operación matemática, con lo que parsea el texto a número.</p>
</div>
</div>
<div class="sect3">
<h4 id="_fechas_y_horas">1.4.6. Fechas y horas</h4>
<div class="paragraph">
<p>Para crear una fecha usaremos el objeto <code>Date</code>, ya sea con el constructor vacío de modo que obtengamos la fecha actual, pasándole un valor que representa el timestamp <em>Epoch</em> (desde el 1/1/70), o pasándole al constructor del día (1-31), mes (0-11) y año.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="javascript"><span class="tok-kd">var</span> <span class="tok-nx">fecha</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-nb">Date</span><span class="tok-p">();</span>
<span class="tok-nx">console</span><span class="tok-p">.</span><span class="tok-nx">log</span><span class="tok-p">(</span><span class="tok-nx">fecha</span><span class="tok-p">);</span> <span class="tok-c1">// Wed May 21 2014 21:03:59 GMT+0200 (Hora de verano romance)</span>

<span class="tok-kd">var</span> <span class="tok-nx">nochevieja</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-nb">Date</span><span class="tok-p">(</span><span class="tok-mi">2014</span><span class="tok-p">,</span> <span class="tok-mi">11</span><span class="tok-p">,</span> <span class="tok-mi">31</span><span class="tok-p">);</span>
<span class="tok-nx">console</span><span class="tok-p">.</span><span class="tok-nx">log</span><span class="tok-p">(</span><span class="tok-nx">nochevieja</span><span class="tok-p">);</span> <span class="tok-c1">// Wed Dec 31 2014 00:00:00 GMT+0100 (Hora estándar romance)</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Si además queremos indicar la hora, lo podemos hacer mediante tres parámetros más:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="javascript"><span class="tok-kd">var</span> <span class="tok-nx">cenaNochevieja</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-nb">Date</span><span class="tok-p">(</span><span class="tok-mi">2014</span><span class="tok-p">,</span> <span class="tok-mi">11</span><span class="tok-p">,</span> <span class="tok-mi">31</span><span class="tok-p">,</span> <span class="tok-mi">22</span><span class="tok-p">,</span> <span class="tok-mi">30</span><span class="tok-p">,</span> <span class="tok-mi">0</span><span class="tok-p">);</span>
<span class="tok-nx">console</span><span class="tok-p">.</span><span class="tok-nx">log</span><span class="tok-p">(</span><span class="tok-nx">cenaNochevieja</span><span class="tok-p">);</span> <span class="tok-c1">// Wed Dec 31 2014 22:30:00 GMT+0100 (Hora estándar romance)</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Una vez tenemos un objeto <code>Date</code>, tenemos muchos métodos para realizar operaciones. Algunos de los métodos más importantes son:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>getFullYear()</code>: devuelve el año de la fecha con cuatro dígitos</p>
</li>
<li>
<p><code>getMonth()</code>:  número del mes del año (de 0 a 11)</p>
</li>
<li>
<p><code>getDate()</code>: número de día del mes</p>
</li>
</ul>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="title">Autoevaluación</div>
<div class="paragraph">
<p>A partir del siguiente código ¿Qué saldrá por la consola del navegador? <span class="footnote">[<a id="_footnoteref_1" class="footnote" href="#_footnote_1" title="View footnote.">1</a>]</span></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="javascript"><span class="tok-kd">var</span> <span class="tok-nx">cenaNochevieja</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-nb">Date</span><span class="tok-p">(</span><span class="tok-mi">2014</span><span class="tok-p">,</span> <span class="tok-mi">11</span><span class="tok-p">,</span> <span class="tok-mi">31</span><span class="tok-p">,</span> <span class="tok-mi">22</span><span class="tok-p">,</span> <span class="tok-mi">30</span><span class="tok-p">,</span> <span class="tok-mi">0</span><span class="tok-p">);</span>
<span class="tok-kd">var</span> <span class="tok-nx">anyo</span> <span class="tok-o">=</span> <span class="tok-nx">cenaNochevieja</span><span class="tok-p">.</span><span class="tok-nx">getFullYear</span><span class="tok-p">();</span>
<span class="tok-kd">var</span> <span class="tok-nx">mes</span> <span class="tok-o">=</span> <span class="tok-nx">cenaNochevieja</span><span class="tok-p">.</span><span class="tok-nx">getMonth</span><span class="tok-p">();</span>
<span class="tok-kd">var</span> <span class="tok-nx">diaMes</span>  <span class="tok-o">=</span> <span class="tok-nx">cenaNochevieja</span><span class="tok-p">.</span><span class="tok-nx">getDate</span><span class="tok-p">();</span>
<span class="tok-kd">var</span> <span class="tok-nx">incognita</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-nb">Date</span><span class="tok-p">(</span><span class="tok-nx">cenaNochevieja</span><span class="tok-p">.</span><span class="tok-nx">setDate</span><span class="tok-p">(</span><span class="tok-nx">diaMes</span> <span class="tok-o">+</span> <span class="tok-mi">1</span><span class="tok-p">));</span>

<span class="tok-nx">console</span><span class="tok-p">.</span><span class="tok-nx">log</span><span class="tok-p">(</span><span class="tok-nx">incognita</span><span class="tok-p">);</span></code></pre>
</div>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Más información en <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Date" class="bare">https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Date</a></p>
</div>
<div class="paragraph">
<p>Para comparar fechas podemos usar los operadores <code>&lt;</code> o <code>&gt;</code> con el objeto <code>Date</code>, o la comparación de igualdad/identidad con el método <code>getTime()</code> que nos devuelve el <em>timestamp</em>.</p>
</div>
<div class="listingblock">
<div class="title">Comparando fechas - <a href="http://jsbin.com/rodocu/1/edit?js,console" class="bare">http://jsbin.com/rodocu/1/edit?js,console</a></div>
<div class="content">
<pre class="pygments highlight"><code data-lang="javascript"><span class="tok-kd">var</span> <span class="tok-nx">cenaPreNochevieja</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-nb">Date</span><span class="tok-p">(</span><span class="tok-mi">2014</span><span class="tok-p">,</span> <span class="tok-mi">11</span><span class="tok-p">,</span> <span class="tok-mi">30</span><span class="tok-p">,</span> <span class="tok-mi">22</span><span class="tok-p">,</span> <span class="tok-mi">30</span><span class="tok-p">,</span> <span class="tok-mi">0</span><span class="tok-p">);</span>
<span class="tok-kd">var</span> <span class="tok-nx">cenaNochevieja</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-nb">Date</span><span class="tok-p">(</span><span class="tok-mi">2014</span><span class="tok-p">,</span> <span class="tok-mi">11</span><span class="tok-p">,</span> <span class="tok-mi">31</span><span class="tok-p">,</span> <span class="tok-mi">22</span><span class="tok-p">,</span> <span class="tok-mi">30</span><span class="tok-p">,</span> <span class="tok-mi">0</span><span class="tok-p">);</span>
<span class="tok-kd">var</span> <span class="tok-nx">cenaNochevieja2</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-nb">Date</span><span class="tok-p">(</span><span class="tok-mi">2014</span><span class="tok-p">,</span> <span class="tok-mi">11</span><span class="tok-p">,</span> <span class="tok-mi">31</span><span class="tok-p">,</span> <span class="tok-mi">22</span><span class="tok-p">,</span> <span class="tok-mi">30</span><span class="tok-p">,</span> <span class="tok-mi">0</span><span class="tok-p">);</span>

<span class="tok-nx">console</span><span class="tok-p">.</span><span class="tok-nx">log</span><span class="tok-p">(</span> <span class="tok-nx">cenaPreNochevieja</span> <span class="tok-o">&lt;</span> <span class="tok-nx">cenaNochevieja</span> <span class="tok-p">);</span> <span class="tok-c1">// true</span>
<span class="tok-nx">console</span><span class="tok-p">.</span><span class="tok-nx">log</span><span class="tok-p">(</span> <span class="tok-nx">cenaNochevieja</span> <span class="tok-o">==</span> <span class="tok-nx">cenaNochevieja2</span> <span class="tok-p">);</span> <span class="tok-c1">// false</span>
<span class="tok-nx">console</span><span class="tok-p">.</span><span class="tok-nx">log</span><span class="tok-p">(</span> <span class="tok-nx">cenaNochevieja</span> <span class="tok-o">===</span> <span class="tok-nx">cenaNochevieja2</span> <span class="tok-p">);</span> <span class="tok-c1">// false</span>
<span class="tok-nx">console</span><span class="tok-p">.</span><span class="tok-nx">log</span><span class="tok-p">(</span> <span class="tok-nx">cenaNochevieja</span><span class="tok-p">.</span><span class="tok-nx">getTime</span><span class="tok-p">()</span> <span class="tok-o">==</span> <span class="tok-nx">cenaNochevieja2</span><span class="tok-p">.</span><span class="tok-nx">getTime</span><span class="tok-p">()</span> <span class="tok-p">);</span> <span class="tok-c1">// true</span>
<span class="tok-nx">console</span><span class="tok-p">.</span><span class="tok-nx">log</span><span class="tok-p">(</span> <span class="tok-nx">cenaNochevieja</span><span class="tok-p">.</span><span class="tok-nx">getTime</span><span class="tok-p">()</span> <span class="tok-o">===</span> <span class="tok-nx">cenaNochevieja2</span><span class="tok-p">.</span><span class="tok-nx">getTime</span><span class="tok-p">()</span> <span class="tok-p">);</span> <span class="tok-c1">// true</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Trabajar con fechas siempre es problemático, dado que el propio lenguaje no ofrece métodos para realizar cálculos sobre fechas, o realizar consultas utilizando el lenguaje natural. Una librería muy completa es <strong>Datejs</strong> (<a href="http://www.datejs.com/" class="bare">http://www.datejs.com/</a>).</p>
</div>
</div>
<div class="sect3">
<h4 id="__code_typeof_code">1.4.7. <code>typeof</code></h4>
<div class="paragraph">
<p>El operador <code>typeof</code> devuelve una cadena que identifica el tipo del operando. Así pues,</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="javascript"><span class="tok-k">typeof</span> <span class="tok-mf">94.8</span> <span class="tok-c1">// &#39;number&#39;</span>
<span class="tok-k">typeof</span> <span class="tok-s2">&quot;Batman&quot;</span> <span class="tok-c1">// &#39;string&#39;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Los posibles valores de <code>typeof</code> son <code>'number'</code>,<code>'string'</code>,<code>'boolean'</code>,<code>'undefined'</code>,<code>'function'</code> y <code>'object'</code>. El problema viene cuando hacemos esto:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="javascript"><span class="tok-k">typeof</span> <span class="tok-kc">null</span> <span class="tok-c1">// &#39;object&#39;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>y en vez de recibir <code>'null'</code> nos dice que es un objeto. Es decir, si le pasamos un <em>array</em> o <em>null</em> el resultado es <code>'object'</code>, lo cual es incorrecto.</p>
</div>
<div class="paragraph">
<p>Con lo que para comprobar si es <code>null</code> es mejor usar el operador identidad:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="javascript"><span class="tok-nx">valorNulo</span> <span class="tok-o">===</span> <span class="tok-kc">null</span> <span class="tok-c1">// true</span></code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_instrucciones">1.5. Instrucciones</h3>
<div class="paragraph">
<p>De manera similar a Java, tenemos los siguientes tipos:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>condicionales: <code>if</code>, <code>if/else</code> (también podemos usar el operador ternario <code>?:</code>) y <code>switch</code></p>
</li>
<li>
<p>iterativas: <code>while</code>, <code>do/while</code>, <code>for</code>, <code>for&#8230;&#8203;in</code>, <code>break</code> y <code>continue</code></p>
</li>
<li>
<p>tratamiento de excepciones: <code>try/catch</code> y <code>throw</code></p>
</li>
<li>
<p>depuración: <code>debugger</code> y <code>label</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>A lo largo del curso usaremos las instrucciones tanto en los ejemplos como en los ejercicios que realizaremos.</p>
</div>
<div class="paragraph">
<p>Más información en <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference" class="bare">https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference</a></p>
</div>
<div class="admonitionblock caution">
<table>
<tr>
<td class="icon">
<i class="fa icon-caution" title="Caution"></i>
</td>
<td class="content">
<div class="title">Punto y coma</div>
<div class="paragraph">
<p>En ocasiones, <em>JavaScript</em> permite omitir el punto y coma al final de una sentencia, pero en otras no. Las reglas que definen cuando se puede omitir el punto y coma son complejas, por lo que se recomienda poner siempre el punto y coma.</p>
</div>
<div class="paragraph">
<p>El siguiente artículo detalla la casuística de cuando podemos evitar poner el punto y coma: <a href="http://www.codecademy.com/blog/78-your-guide-to-semicolons-in-javascript" class="bare">http://www.codecademy.com/blog/78-your-guide-to-semicolons-in-javascript</a></p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_funciones">1.6. Funciones</h3>
<div class="paragraph">
<p>Las funciones en <em>JavaScript</em> son objetos, y como tales, se pueden usar como cualquier otro valor. Las funciones pueden almacenarse en variables, objetos y arrays. Se pueden pasar como argumentos a funciones, y una función a su vez puede devolver una función (ella misma u otra). Además, como objetos que son, pueden tener métodos.</p>
</div>
<div class="paragraph">
<p>Pero lo que hace especial a una función respecto a otros tipos de objetos es que las funciones pueden invocarse.</p>
</div>
<div class="paragraph">
<p>Las funciones se crean con la palabra clave <code>function</code> junto a los parámetros sin tipo rodeados por una pareja de paréntesis. El nombre de la función es opcional.</p>
</div>
<div class="paragraph">
<p>JavaScript no produce ningún error de ejecución si el número de argumentos y el de parámetros no coincide. Si hay demasiados valores de argumentos, los argumentos de sobra se ignoran. Por contra, si hay menos argumentos que parámetros, los parámetros que han quedado sin asignar tendrán el valor <code>undefined</code>. No se realiza ninguna comprobación de tipos, con lo que podemos pasar cualquier valor como parámetro.</p>
</div>
<div class="paragraph">
<p>Además, dentro de una función podemos invocar a otra función que definimos en el código a posteriori, con lo que no tenemos ninguna restricción de declarar las funciones antes de usarlas. Pese a no tener restricción, es una buena práctica de código que las funciones que dependen de otras se coloquen tras ellas.</p>
</div>
<div class="paragraph">
<p>Por último, para devolver cualquier valor dentro de una función usaremos la instrucción <code>return</code>, la cual es opcional. Si una función no hace <code>return</code>, el valor devuelto será <code>undefined</code>.</p>
</div>
<div class="sect3">
<h4 id="_función_declaración">1.6.1. Función declaración</h4>
<div class="paragraph">
<p>Si al crear una función le asignamos un nombre se conoce como una <em>función declaración</em>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="javascript"><span class="tok-kd">function</span> <span class="tok-nx">miFuncion</span><span class="tok-p">(</span><span class="tok-nx">param1</span><span class="tok-p">,</span> <span class="tok-nx">param2</span><span class="tok-p">)</span> <span class="tok-p">{</span>
	<span class="tok-c1">// instrucciones</span>
	<span class="tok-k">return</span> <span class="tok-nx">variable</span><span class="tok-p">;</span>
<span class="tok-p">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Las variables declaradas dentro de la función no serán visibles desde fuera de la función. Además, los parámetros se pasan por copia, y aquí vienen lo bueno, se pueden pasar funciones como parámetro de una función, y una función puede devolver otra función.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="javascript"><span class="tok-kd">function</span> <span class="tok-nx">suma</span><span class="tok-p">(</span><span class="tok-nx">alfa</span><span class="tok-p">,</span> <span class="tok-nx">beta</span><span class="tok-p">)</span> <span class="tok-p">{</span>
	<span class="tok-k">return</span> <span class="tok-nx">alfa</span> <span class="tok-o">+</span> <span class="tok-nx">beta</span><span class="tok-p">;</span>
<span class="tok-p">}</span>

<span class="tok-kd">function</span> <span class="tok-nx">calculando</span><span class="tok-p">(</span><span class="tok-nx">gamma</span><span class="tok-p">,</span> <span class="tok-nx">delta</span><span class="tok-p">,</span> <span class="tok-nx">fn</span><span class="tok-p">)</span> <span class="tok-p">{</span>
	<span class="tok-k">return</span> <span class="tok-nx">fn</span><span class="tok-p">(</span><span class="tok-nx">gamma</span><span class="tok-p">,</span> <span class="tok-nx">delta</span><span class="tok-p">);</span>
<span class="tok-p">}</span>

<span class="tok-kd">var</span> <span class="tok-nx">epsilon</span> <span class="tok-o">=</span> <span class="tok-nx">calculando</span><span class="tok-p">(</span><span class="tok-mi">3</span><span class="tok-p">,</span> <span class="tok-mi">4</span><span class="tok-p">,</span> <span class="tok-nx">suma</span><span class="tok-p">);</span></code></pre>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="title">Autoevaluación</div>
<div class="paragraph">
<p>A partir del código anterior, ¿Qué valor obtendríamos en la variables <code>epsilon</code>? <span class="footnote">[<a id="_footnoteref_2" class="footnote" href="#_footnote_2" title="View footnote.">2</a>]</span></p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_función_expresión">1.6.2. Función expresión</h4>
<div class="paragraph">
<p>Otra característica de las funciones de <em>JavaScript</em> es que una función se considera un valor. De este modo, podemos declarar una función anónima la cual no tiene nombre, y asignarla a una variable (conocida como <em>función expresión</em>).</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="javascript"><span class="tok-kd">var</span> <span class="tok-nx">miFuncionExpresion</span> <span class="tok-o">=</span> <span class="tok-kd">function</span> <span class="tok-p">(</span><span class="tok-nx">param1</span><span class="tok-p">,</span> <span class="tok-nx">param2</span><span class="tok-p">)</span> <span class="tok-p">{</span>
	<span class="tok-c1">// instrucciones</span>
	<span class="tok-k">return</span> <span class="tok-nx">variable</span><span class="tok-p">;</span>
<span class="tok-p">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Así pues, el mismo código del ejemplo anterior quedaría así:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="javascript"><span class="tok-kd">var</span> <span class="tok-nx">suma</span> <span class="tok-o">=</span> <span class="tok-kd">function</span> <span class="tok-p">(</span><span class="tok-nx">alfa</span><span class="tok-p">,</span> <span class="tok-nx">beta</span><span class="tok-p">)</span> <span class="tok-p">{</span>
	<span class="tok-k">return</span> <span class="tok-nx">alfa</span> <span class="tok-o">+</span> <span class="tok-nx">beta</span><span class="tok-p">;</span>
<span class="tok-p">};</span>

<span class="tok-kd">var</span> <span class="tok-nx">calculando</span> <span class="tok-o">=</span> <span class="tok-kd">function</span> <span class="tok-p">(</span><span class="tok-nx">gamma</span><span class="tok-p">,</span> <span class="tok-nx">delta</span><span class="tok-p">,</span> <span class="tok-nx">fn</span><span class="tok-p">)</span> <span class="tok-p">{</span>
	<span class="tok-k">return</span> <span class="tok-nx">fn</span><span class="tok-p">(</span><span class="tok-nx">gamma</span><span class="tok-p">,</span> <span class="tok-nx">delta</span><span class="tok-p">);</span>
<span class="tok-p">};</span>

<span class="tok-kd">var</span> <span class="tok-nx">epsilon</span> <span class="tok-o">=</span> <span class="tok-nx">calculando</span><span class="tok-p">(</span><span class="tok-mi">3</span><span class="tok-p">,</span> <span class="tok-mi">4</span><span class="tok-p">,</span> <span class="tok-nx">suma</span><span class="tok-p">);</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Y por último, también podemos crear funciones anónimas al llamar a una función, lo que añade a <em>JavaScript</em> una gran flexibilidad:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="javascript"><span class="tok-kd">var</span> <span class="tok-nx">calculando</span> <span class="tok-o">=</span> <span class="tok-kd">function</span> <span class="tok-p">(</span><span class="tok-nx">gamma</span><span class="tok-p">,</span> <span class="tok-nx">delta</span><span class="tok-p">,</span> <span class="tok-nx">fn</span><span class="tok-p">)</span> <span class="tok-p">{</span>
	<span class="tok-k">return</span> <span class="tok-nx">fn</span><span class="tok-p">(</span><span class="tok-nx">gamma</span><span class="tok-p">,</span> <span class="tok-nx">delta</span><span class="tok-p">);</span>
<span class="tok-p">};</span>

<span class="tok-kd">var</span> <span class="tok-nx">epsilon</span> <span class="tok-o">=</span> <span class="tok-nx">calculando</span><span class="tok-p">(</span><span class="tok-mi">3</span><span class="tok-p">,</span> <span class="tok-mi">4</span><span class="tok-p">,</span> <span class="tok-kd">function</span><span class="tok-p">(</span><span class="tok-nx">alfa</span><span class="tok-p">,</span> <span class="tok-nx">beta</span><span class="tok-p">)</span> <span class="tok-p">{</span>
	<span class="tok-k">return</span> <span class="tok-nx">alfa</span> <span class="tok-o">+</span> <span class="tok-nx">beta</span><span class="tok-p">;</span>
<span class="tok-p">});</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Como veremos en posteriores sesiones, gran parte de las librerías hacen uso de las funciones anónimas a la hora de invocar a las diferentes funciones que ofrecen.</p>
</div>
<div class="paragraph">
<p>Las funciones expresión se pueden invocar inmediatamente, lo que hace que sean muy útiles cuando tenemos un bloque que vamos a utilizar una única vez.</p>
</div>
<div class="listingblock">
<div class="title">Ejemplo de función invocada inmediatamente - IIFE</div>
<div class="content">
<pre class="pygments highlight"><code data-lang="javascript"><span class="tok-p">(</span><span class="tok-kd">function</span><span class="tok-p">()</span> <span class="tok-p">{</span>
	<span class="tok-c1">// instrucciones</span>
<span class="tok-p">})();</span>	<span class="tok-c1">// invoca la función inmediatamente</span></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_funciones_declaración_vs_expresión">1.6.3. Funciones declaración vs expresión</h4>
<div class="paragraph">
<p>Cabe destacar una diferencia importante entre estos tipos de funciones, y es que las funciones declaración se cargan antes de cualquier código, con lo que el motor <em>JavaScript</em> permite ejecutar una llamada a esta función incluso si está antes de su declaración (debido al <em>hoisting</em>). En cambio, con las funciones expresión, se cargan conforme se carga el script, y no van a permitir realizar una llamada a la función hasta que sea declarada, por lo que debemos colocarlas antes del resto de código que quiera invocar dicha función.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="javascript"><span class="tok-nx">cantar</span><span class="tok-p">();</span>
<span class="tok-nx">estribillo</span><span class="tok-p">();</span> <span class="tok-c1">// TypeError: undefined</span>

<span class="tok-kd">function</span> <span class="tok-nx">cantar</span><span class="tok-p">()</span> <span class="tok-p">{</span>
	<span class="tok-nx">console</span><span class="tok-p">.</span><span class="tok-nx">log</span><span class="tok-p">(</span><span class="tok-s2">&quot;¿Qué puedo hacer?&quot;</span><span class="tok-p">);</span>
<span class="tok-p">}</span>

<span class="tok-kd">var</span> <span class="tok-nx">estribillo</span> <span class="tok-o">=</span> <span class="tok-kd">function</span><span class="tok-p">()</span> <span class="tok-p">{</span>
	<span class="tok-nx">console</span><span class="tok-p">.</span><span class="tok-nx">log</span><span class="tok-p">(</span><span class="tok-s2">&quot;He pasado por tu casa 20 veces&quot;</span><span class="tok-p">);</span>
<span class="tok-p">};</span></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="__em_callbacks_em">1.6.4. <em>Callbacks</em></h4>
<div class="paragraph">
<p>Se conoce como <em>callback</em> a una función que se le pasa a otra función para ofrecerle a esta segunda función un modo de volver a llamarnos más tarde.</p>
</div>
<div class="paragraph">
<p>Dicho de otro modo, al llamar a una función, le envío por parámetro otra función (un <em>callback</em>) esperando que la función llamada se encargue de ejecutar esa función <em>callback</em>. Resumiendo, los <em>callbacks</em> son funciones que contienen instrucciones que se invocarán cuando se complete un determinado proceso.</p>
</div>
<div class="paragraph">
<p>Por ejemplo, la función <code>haceAlgo</code> recibe un <em>callback</em> como argumento:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="javascript"><span class="tok-kd">function</span> <span class="tok-nx">haceAlgo</span><span class="tok-p">(</span><span class="tok-nx">miCallback</span><span class="tok-p">)</span> <span class="tok-p">{</span>
	<span class="tok-c1">// hago algo y llamo al callback avisando que terminé</span>
	<span class="tok-nx">miCallback</span><span class="tok-p">();</span>
<span class="tok-p">}</span>

<span class="tok-c1">// Invocamos al callback mediante una función inline</span>
<span class="tok-nx">haceAlgo</span><span class="tok-p">(</span><span class="tok-kd">function</span><span class="tok-p">()</span> <span class="tok-p">{</span>
	<span class="tok-nx">console</span><span class="tok-p">.</span><span class="tok-nx">log</span><span class="tok-p">(</span><span class="tok-s1">&#39;he acabado de hacer algo&#39;</span><span class="tok-p">);</span>
<span class="tok-p">});</span>

<span class="tok-kd">function</span> <span class="tok-nx">ejemploCallback</span><span class="tok-p">()</span> <span class="tok-p">{</span>
	<span class="tok-nx">console</span><span class="tok-p">.</span><span class="tok-nx">log</span><span class="tok-p">(</span><span class="tok-s1">&#39;he realizado algo&#39;</span><span class="tok-p">);</span>
<span class="tok-p">}</span>

<span class="tok-c1">// Invocamos al callback con una función declarada con antelación</span>
<span class="tok-nx">haceAlgo</span><span class="tok-p">(</span><span class="tok-nx">ejemploCallback</span><span class="tok-p">);</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Pero los <em>callbacks</em> no sólo se utilizan para llamar a algo cuando termina una acción. Simplemente podemos tener distintos <em>callbacks</em> que se van llamando en determinados casos, es decir, como puntos de control sobre una función para facilitar el seguimiento de un <em>workflow</em>. La idea es disparar eventos en las funciones que llamaron “avisando” sobre lo que esta sucendiendo:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="javascript"><span class="tok-kd">function</span> <span class="tok-nx">haceAlgo</span><span class="tok-p">(</span><span class="tok-nx">callbackPaso1</span><span class="tok-p">,</span> <span class="tok-nx">callbackPaso2</span><span class="tok-p">,</span> <span class="tok-nx">callbackTermino</span><span class="tok-p">)</span> <span class="tok-p">{</span>
	<span class="tok-c1">// instrucciones proceso 1</span>
	<span class="tok-nx">callbackPaso1</span><span class="tok-p">(</span><span class="tok-s1">&#39;proceso 1&#39;</span><span class="tok-p">);</span>
	<span class="tok-c1">// instrucciones proceso 2</span>
	<span class="tok-nx">callbackPaso2</span><span class="tok-p">(</span><span class="tok-s1">&#39;proceso 2&#39;</span><span class="tok-p">);</span>
	<span class="tok-c1">// instrucciones proceso Final</span>
	<span class="tok-nx">callbackTermino</span><span class="tok-p">(</span><span class="tok-s1">&#39;fin&#39;</span><span class="tok-p">);</span>
<span class="tok-p">}</span>

<span class="tok-kd">function</span> <span class="tok-nx">paso1</span><span class="tok-p">(</span><span class="tok-nx">quePaso</span><span class="tok-p">)</span> <span class="tok-p">{</span>
	<span class="tok-nx">console</span><span class="tok-p">.</span><span class="tok-nx">log</span><span class="tok-p">(</span><span class="tok-nx">quePaso</span><span class="tok-p">);</span>
<span class="tok-p">}</span>

<span class="tok-kd">function</span> <span class="tok-nx">paso2</span><span class="tok-p">(</span><span class="tok-nx">quePaso</span><span class="tok-p">)</span> <span class="tok-p">{</span>
	<span class="tok-nx">console</span><span class="tok-p">.</span><span class="tok-nx">log</span><span class="tok-p">(</span><span class="tok-nx">quePaso</span><span class="tok-p">);</span>
<span class="tok-p">}</span>

<span class="tok-kd">function</span> <span class="tok-nx">termino</span><span class="tok-p">(</span><span class="tok-nx">queHizo</span><span class="tok-p">)</span> <span class="tok-p">{</span>
	<span class="tok-nx">console</span><span class="tok-p">.</span><span class="tok-nx">log</span><span class="tok-p">(</span><span class="tok-nx">queHizo</span><span class="tok-p">);</span>
<span class="tok-p">}</span>

<span class="tok-nx">haceAlgo</span><span class="tok-p">(</span><span class="tok-nx">paso1</span><span class="tok-p">,</span> <span class="tok-nx">paso2</span><span class="tok-p">,</span> <span class="tok-nx">termino</span><span class="tok-p">);</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>De esta forma creamos funciones nombradas fuera de la llamada y éstas a su vez podrían disparar otros eventos (con <em>callbacks</em>) también.</p>
</div>
<div class="paragraph">
<p>Por último y no menos importante, los <em>callbacks</em> no son asíncronos, es decir, tras dispararse el <em>callback</em>, se ejecuta todo el código contenido y el control vuelve a la línea que lo disparó. En el ejemplo anterior dispara el <code>callbackPaso1()</code> y cuando este termina, continúa la ejecución disparando el <code>callbackPaso2()</code>.</p>
</div>
<div class="paragraph">
<p>Esta duda se debe a que al tratar con elementos asíncronos, los <em>callbacks</em> se emplean para gestionar el orden de ejecución de dichas tareas asíncronas.</p>
</div>
</div>
<div class="sect3">
<h4 id="__code_arguments_code">1.6.5. <code>arguments</code></h4>
<div class="paragraph">
<p>Además de los parámetros declarados, cada función recibe dos parámetros adiciones: <code>this</code> y <code>arguments</code>.</p>
</div>
<div class="paragraph">
<p>El parámetro adicional <code>arguments</code> nos da acceso a todos los argumentos recibidos mediante la invocación de la función, incluso los argumentos que sobraron y no se asignaron a parámetros. Esto nos permite escribir funciones que tratan un número indeterminado de parámetros.</p>
</div>
<div class="paragraph">
<p>Estos datos se almacenan en una estructura similar a un array, aunque realmente no lo sea. Pese a ello, si que tiene una propiedad <code>length</code> para obtener el número de parámetros y podemos acceder a cada elemento mediante la notación <code>arguments[x]</code>, pero carece del resto de métodos que si ofrecen los arrays (que veremos en la siguiente sesión).</p>
</div>
<div class="paragraph">
<p>Por ejemplo, podemos crear una función que sume un número indeterminado de parámetros:</p>
</div>
<div class="listingblock">
<div class="title">arguments - <a href="http://jsbin.com/wikoha/2/edit?js,console" class="bare">http://jsbin.com/wikoha/2/edit?js,console</a></div>
<div class="content">
<pre class="pygments highlight"><code data-lang="javascript"><span class="tok-kd">var</span> <span class="tok-nx">suma</span> <span class="tok-o">=</span> <span class="tok-kd">function</span><span class="tok-p">()</span> <span class="tok-p">{</span>
  <span class="tok-kd">var</span> <span class="tok-nx">i</span><span class="tok-p">,</span> <span class="tok-nx">s</span><span class="tok-o">=</span><span class="tok-mi">0</span><span class="tok-p">;</span>
  <span class="tok-k">for</span> <span class="tok-p">(</span><span class="tok-nx">i</span><span class="tok-o">=</span><span class="tok-mi">0</span><span class="tok-p">;</span> <span class="tok-nx">i</span> <span class="tok-o">&lt;</span> <span class="tok-nx">arguments</span><span class="tok-p">.</span><span class="tok-nx">length</span><span class="tok-p">;</span> <span class="tok-nx">i</span><span class="tok-o">+=</span><span class="tok-mi">1</span><span class="tok-p">)</span> <span class="tok-p">{</span>
    <span class="tok-nx">s</span> <span class="tok-o">+=</span> <span class="tok-nx">arguments</span><span class="tok-p">[</span><span class="tok-nx">i</span><span class="tok-p">];</span>
  <span class="tok-p">}</span>
  <span class="tok-k">return</span> <span class="tok-nx">s</span><span class="tok-p">;</span>
<span class="tok-p">};</span>

<span class="tok-nx">console</span><span class="tok-p">.</span><span class="tok-nx">log</span><span class="tok-p">(</span><span class="tok-nx">suma</span><span class="tok-p">(</span><span class="tok-mi">1</span><span class="tok-p">,</span> <span class="tok-mi">2</span><span class="tok-p">,</span> <span class="tok-mi">3</span><span class="tok-p">,</span> <span class="tok-mi">4</span><span class="tok-p">,</span> <span class="tok-mi">5</span><span class="tok-p">));</span>	<span class="tok-c1">// 15</span></code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_alcance">1.7. Alcance</h3>
<div class="paragraph">
<p>Recordemos que el alcance determina desde donde se puede acceder a una variable, es decir, donde nace y donde muere. Por un lado tenemos el alcance <strong>global</strong>, con el que cualquier variable o función global pueden ser invocada o accedida desde cualquier parte del código de la aplicación. En <em>JavaScript</em>, por defecto, todas las variables y funciones que definimos tienen alcance global.</p>
</div>
<div class="paragraph">
<p>Si definimos una variable dentro de una función, el alcance se conoce como de <strong>función</strong>, de modo que la variable vive mientras lo hace la función.</p>
</div>
<div class="paragraph">
<p>Aquella variable/función que definimos dentro de una función (padre) es local a la función pero global para las funciones anidadas (hijas) a la que hemos definido la función (padre). Por esto, más que alcance de función, se le conoce como alcance <strong>anidado</strong>.</p>
</div>
<div class="paragraph">
<p>Y así sucesivamente, podemos definir funciones dentro de funciones con alcance anidado en el hijo que serán accesibles por el nieto, pero no por el padre.</p>
</div>
<div class="listingblock">
<div class="title">Ejemplo Alcance - <a href="http://jsbin.com/didake/1/edit?js,console" class="bare">http://jsbin.com/didake/1/edit?js,console</a></div>
<div class="content">
<pre class="pygments highlight"><code data-lang="javascript"><span class="tok-kd">var</span> <span class="tok-nx">varGlobal</span> <span class="tok-o">=</span> <span class="tok-s2">&quot;Esta es una variable global.&quot;</span><span class="tok-p">;</span>

<span class="tok-kd">var</span> <span class="tok-nx">funcionGlobal</span> <span class="tok-o">=</span> <span class="tok-kd">function</span><span class="tok-p">(</span><span class="tok-nx">alfa</span><span class="tok-p">)</span> <span class="tok-p">{</span>
	<span class="tok-kd">var</span> <span class="tok-nx">varLocal</span> <span class="tok-o">=</span> <span class="tok-s2">&quot;Esta es una variable local con alcance anidado&quot;</span><span class="tok-p">;</span>

	<span class="tok-kd">var</span> <span class="tok-nx">funcionLocal</span> <span class="tok-o">=</span> <span class="tok-kd">function</span><span class="tok-p">()</span> <span class="tok-p">{</span>
		<span class="tok-kd">var</span> <span class="tok-nx">varLocal</span> <span class="tok-o">=</span> <span class="tok-s2">&quot;¡Hola Mundo!&quot;</span><span class="tok-p">;</span>
		<span class="tok-nx">console</span><span class="tok-p">.</span><span class="tok-nx">log</span><span class="tok-p">(</span><span class="tok-nx">varLocal</span><span class="tok-p">);</span>
		<span class="tok-nx">console</span><span class="tok-p">.</span><span class="tok-nx">log</span><span class="tok-p">(</span><span class="tok-nx">alfa</span><span class="tok-p">);</span>
	<span class="tok-p">};</span>

	<span class="tok-nx">funcionLocal</span><span class="tok-p">();</span>
	<span class="tok-nx">console</span><span class="tok-p">.</span><span class="tok-nx">log</span><span class="tok-p">(</span><span class="tok-nx">varLocal</span><span class="tok-p">);</span>
<span class="tok-p">};</span>

<span class="tok-c1">// console.log(varLocal)</span>
<span class="tok-nx">funcionGlobal</span><span class="tok-p">(</span><span class="tok-mi">2</span><span class="tok-p">);</span></code></pre>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="title">Autoevaluación</div>
<div class="paragraph">
<p>A partir del código anterior, ¿Qué mensajes saldrán por pantalla? <span class="footnote">[<a id="_footnoteref_3" class="footnote" href="#_footnote_3" title="View footnote.">3</a>]</span>
¿Y si descomentamos la linea de <code>console.log(varLocal)</code> <span class="footnote">[<a id="_footnoteref_4" class="footnote" href="#_footnote_4" title="View footnote.">4</a>]</span>?</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Si queremos evitar tener colisiones con las variables locales, podemos usar una <strong>función expresión con invocación inmediata</strong> (IIFE). Para ello, tenemos que englobar el código a proteger dentro de una función, la cual se rodea con paréntesis y se invoca, es decir, del siguiente código:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="javascript"><span class="tok-p">(</span><span class="tok-kd">function</span><span class="tok-p">()</span> <span class="tok-p">{</span>
  <span class="tok-c1">// código</span>
<span class="tok-p">})();</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>De este modo, las variables que declaremos dentro serán locales a ésta función, y permitirá el uso de librería de terceros sin efectos colaterales con nuestras variables. Por lo tanto, si intentamos acceder a una variable local de una <em>IIFE</em> (también conocidos como <em>closures anónimos</em>) desde fuera obtendremos una excepción:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="javascript"><span class="tok-p">(</span><span class="tok-kd">function</span><span class="tok-p">()</span> <span class="tok-p">{</span>
	<span class="tok-kd">var</span> <span class="tok-nx">a</span> <span class="tok-o">=</span> <span class="tok-mi">1</span><span class="tok-p">;</span>
	<span class="tok-nx">console</span><span class="tok-p">.</span><span class="tok-nx">log</span><span class="tok-p">(</span><span class="tok-nx">a</span><span class="tok-p">);</span>	<span class="tok-c1">// 1</span>
<span class="tok-p">})();</span>
<span class="tok-nx">console</span><span class="tok-p">.</span><span class="tok-nx">log</span><span class="tok-p">(</span><span class="tok-nx">a</span><span class="tok-p">);</span>	<span class="tok-c1">// Uncaught ReferenceError: a is not defined</span></code></pre>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="title">Autoevaluación</div>
<div class="paragraph">
<p>A partir del siguiente fragmento:</p>
</div>
<div class="listingblock">
<div class="title">IIFE - <a href="http://jsbin.com/giziqo/1/edit?js,console" class="bare">http://jsbin.com/giziqo/1/edit?js,console</a></div>
<div class="content">
<pre class="pygments highlight"><code data-lang="javascript"><span class="tok-p">(</span><span class="tok-kd">function</span><span class="tok-p">()</span> <span class="tok-p">{</span>
	<span class="tok-kd">var</span> <span class="tok-nx">a</span> <span class="tok-o">=</span> <span class="tok-nx">b</span> <span class="tok-o">=</span> <span class="tok-mi">5</span><span class="tok-p">;</span>
<span class="tok-p">})();</span>
<span class="tok-nx">console</span><span class="tok-p">.</span><span class="tok-nx">log</span><span class="tok-p">(</span><span class="tok-nx">b</span><span class="tok-p">);</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>¿Qué valor aparecerá por la consola? <span class="footnote">[<a id="_footnoteref_5" class="footnote" href="#_footnote_5" title="View footnote.">5</a>]</span></p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Más información en: <a href="http://en.wikipedia.org/wiki/Immediately-invoked_function_expression" class="bare">http://en.wikipedia.org/wiki/Immediately-invoked_function_expression</a></p>
</div>
<div class="sect3">
<h4 id="__em_hoisting_em">1.7.1. <em>Hoisting</em></h4>
<div class="paragraph">
<p>Al estudiar la declaración de variables, vimos el concepto de <strong><em>hoisting</em></strong>, el cual eleva las declaraciones encontradas en un bloque a la primera línea. Ahora que ya conocemos como funciona el alcance y las funciones lo estudiaremos en mayor profundidad.</p>
</div>
<div class="paragraph">
<p>En el ejemplo visto en <a href="#_variables">Variables</a>, teníamos el siguiente código:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="javascript"><span class="tok-s2">&quot;use strict&quot;</span><span class="tok-p">;</span>
<span class="tok-kd">var</span> <span class="tok-nx">a</span> <span class="tok-o">=</span> <span class="tok-s2">&quot;global&quot;</span><span class="tok-p">;</span>
<span class="tok-nx">console</span><span class="tok-p">.</span><span class="tok-nx">log</span><span class="tok-p">(</span><span class="tok-nx">b</span><span class="tok-p">);</span>	<span class="tok-c1">// undefined</span>
<span class="tok-kd">var</span> <span class="tok-nx">b</span> <span class="tok-o">=</span> <span class="tok-mi">5</span><span class="tok-p">;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>La variable <code>b</code> era una variable que no se había declarado y pese a ello, aún usando el modo estricto, el intérprete no lanza ninguna excepción, porque la declaración se <em>eleva</em> al principio del bloque (no así la asignación, que permanece en su lugar).</p>
</div>
<div class="paragraph">
<p>Ahora veremos que dentro de una función, al referenciar a una variable nombrada de manera similar a una variable global, al hacer <em>hoisting</em> y declararla más tarde, la referencia apunta a la variable local.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="javascript"><span class="tok-s2">&quot;use strict&quot;</span><span class="tok-p">;</span>
<span class="tok-kd">var</span> <span class="tok-nx">a</span> <span class="tok-o">=</span> <span class="tok-s2">&quot;global&quot;</span><span class="tok-p">;</span>
<span class="tok-nx">console</span><span class="tok-p">.</span><span class="tok-nx">log</span><span class="tok-p">(</span><span class="tok-nx">b</span><span class="tok-p">);</span> <span class="tok-c1">// undefined</span>
<span class="tok-kd">var</span> <span class="tok-nx">b</span> <span class="tok-o">=</span> <span class="tok-mi">5</span><span class="tok-p">;</span>
<span class="tok-nx">console</span><span class="tok-p">.</span><span class="tok-nx">log</span><span class="tok-p">(</span><span class="tok-nx">b</span><span class="tok-p">);</span> <span class="tok-c1">// 5</span>

<span class="tok-kd">function</span> <span class="tok-nx">hoisting</span><span class="tok-p">()</span> <span class="tok-p">{</span>
	<span class="tok-nx">console</span><span class="tok-p">.</span><span class="tok-nx">log</span><span class="tok-p">(</span><span class="tok-nx">b</span><span class="tok-p">);</span> <span class="tok-c1">// undefined </span><i class="conum" data-value="1"></i><b>(1)</b>
	<span class="tok-kd">var</span> <span class="tok-nx">b</span> <span class="tok-o">=</span> <span class="tok-mi">7</span><span class="tok-p">;</span>
	<span class="tok-nx">console</span><span class="tok-p">.</span><span class="tok-nx">log</span><span class="tok-p">(</span><span class="tok-nx">b</span><span class="tok-p">);</span> <span class="tok-c1">// 7</span>
<span class="tok-p">}</span>
<span class="tok-nx">hoisting</span><span class="tok-p">();</span></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Si no hubiese <em>hoisting</em> se mostraría <code>5</code>, pero al elevarse la declaración de la función, la variable local todavía no tiene ningún valor, de ahí el valor <code>undefined</code></td>
</tr>
</table>
</div>
<div class="paragraph">
<p>El siguiente fragmento es el equivalente, donde las declaraciones se elevan al principio del bloque pero las asignaciones e instrucciones se quedan en su sitio:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="javascript"><span class="tok-s2">&quot;use strict&quot;</span><span class="tok-p">;</span>
<span class="tok-kd">var</span> <span class="tok-nx">a</span> <span class="tok-o">=</span> <span class="tok-s2">&quot;global&quot;</span><span class="tok-p">;</span>
<span class="tok-kd">var</span> <span class="tok-nx">b</span><span class="tok-p">;</span>

<span class="tok-kd">function</span> <span class="tok-nx">hoisting</span><span class="tok-p">()</span> <span class="tok-p">{</span>
	<span class="tok-kd">var</span> <span class="tok-nx">b</span><span class="tok-p">;</span>
	<span class="tok-nx">console</span><span class="tok-p">.</span><span class="tok-nx">log</span><span class="tok-p">(</span><span class="tok-nx">b</span><span class="tok-p">);</span> <span class="tok-c1">// undefined</span>
	<span class="tok-nx">b</span> <span class="tok-o">=</span> <span class="tok-mi">7</span><span class="tok-p">;</span>
	<span class="tok-nx">console</span><span class="tok-p">.</span><span class="tok-nx">log</span><span class="tok-p">(</span><span class="tok-nx">b</span><span class="tok-p">);</span> <span class="tok-c1">// 7</span>
<span class="tok-p">}</span>

<span class="tok-nx">console</span><span class="tok-p">.</span><span class="tok-nx">log</span><span class="tok-p">(</span><span class="tok-nx">b</span><span class="tok-p">);</span> <span class="tok-c1">// undefined</span>
<span class="tok-nx">b</span> <span class="tok-o">=</span> <span class="tok-mi">5</span><span class="tok-p">;</span>
<span class="tok-nx">console</span><span class="tok-p">.</span><span class="tok-nx">log</span><span class="tok-p">(</span><span class="tok-nx">b</span><span class="tok-p">);</span> <span class="tok-c1">// 5</span>

<span class="tok-nx">hoisting</span><span class="tok-p">();</span></code></pre>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="title">Autoevaluación</div>
<div class="paragraph">
<p>¿Cual es el resultado de ejecutar el siguiente fragmento y por qué?:  <span class="footnote">[<a id="_footnoteref_6" class="footnote" href="#_footnote_6" title="View footnote.">6</a>]</span></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="javascript"><span class="tok-kd">function</span> <span class="tok-nx">prueba</span><span class="tok-p">()</span> <span class="tok-p">{</span>
	<span class="tok-nx">console</span><span class="tok-p">.</span><span class="tok-nx">log</span><span class="tok-p">(</span><span class="tok-nx">a</span><span class="tok-p">);</span>
	<span class="tok-nx">console</span><span class="tok-p">.</span><span class="tok-nx">log</span><span class="tok-p">(</span><span class="tok-nx">hola</span><span class="tok-p">());</span>

	<span class="tok-kd">var</span> <span class="tok-nx">a</span> <span class="tok-o">=</span> <span class="tok-mi">1</span><span class="tok-p">;</span>
	<span class="tok-kd">function</span> <span class="tok-nx">hola</span><span class="tok-p">()</span> <span class="tok-p">{</span>
		<span class="tok-k">return</span> <span class="tok-mi">2</span><span class="tok-p">;</span>
	<span class="tok-p">}</span>
<span class="tok-p">}</span>
<span class="tok-nx">prueba</span><span class="tok-p">();</span></code></pre>
</div>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect2">
<h3 id="__em_timers_em">1.8. <em>Timers</em></h3>
<div class="paragraph">
<p><em>JavaScript</em> permite la invocación de funciones tras un lapso de tiempo y con repeticiones infinitas.</p>
</div>
<div class="paragraph">
<p>Para ejecutar una acción tras una duración determinada indicada en milisegundos tenemos la función <code>setTimeout(funcion, tiempoMS)</code>. La llamada a <code>setTimeout</code> no bloquea la ejecución del resto de código.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="javascript"><span class="tok-p">(</span><span class="tok-kd">function</span><span class="tok-p">()</span> <span class="tok-p">{</span>
	<span class="tok-kd">var</span> <span class="tok-nx">miFuncion</span> <span class="tok-o">=</span> <span class="tok-kd">function</span><span class="tok-p">()</span> <span class="tok-p">{</span>
		<span class="tok-nx">console</span><span class="tok-p">.</span><span class="tok-nx">log</span><span class="tok-p">(</span><span class="tok-s2">&quot;Batman vuelve&quot;</span><span class="tok-p">);</span>
	<span class="tok-p">};</span>
	<span class="tok-nx">setTimeout</span><span class="tok-p">(</span><span class="tok-nx">miFuncion</span><span class="tok-p">,</span> <span class="tok-mi">2000</span><span class="tok-p">);</span>  <i class="conum" data-value="1"></i><b>(1)</b>
<span class="tok-p">}());</span></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>La función se ejecutará 2 segundos después de cargar la página</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Si queremos que una función se ejecute de manera ininterrumpida con un intervalo de tiempo, podemos hacer una llamada con <code>setTimeOut</code> dentro de la función ya llamada lo que provoca su invocación de manera recursiva.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="javascript"><span class="tok-p">(</span><span class="tok-kd">function</span><span class="tok-p">()</span> <span class="tok-p">{</span>
	<span class="tok-kd">var</span> <span class="tok-nx">velocidad</span> <span class="tok-o">=</span> <span class="tok-mi">2000</span><span class="tok-p">,</span>
	<span class="tok-nx">miFuncion</span> <span class="tok-o">=</span> <span class="tok-kd">function</span><span class="tok-p">()</span> <span class="tok-p">{</span>
		<span class="tok-nx">console</span><span class="tok-p">.</span><span class="tok-nx">log</span><span class="tok-p">(</span><span class="tok-s2">&quot;Batman vuelve&quot;</span><span class="tok-p">);</span>
		<span class="tok-nx">setTimeout</span><span class="tok-p">(</span><span class="tok-nx">miFuncion</span><span class="tok-p">,</span> <span class="tok-nx">velocidad</span><span class="tok-p">);</span>
	<span class="tok-p">};</span>
	<span class="tok-kd">var</span> <span class="tok-nx">timer</span> <span class="tok-o">=</span> <span class="tok-nx">setTimeout</span><span class="tok-p">(</span><span class="tok-nx">miFuncion</span><span class="tok-p">,</span> <span class="tok-nx">velocidad</span><span class="tok-p">);</span>
	<span class="tok-c1">// cancelTimer(timer);</span>
<span class="tok-p">}());</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Al ejecutar el código, tras 2 segundos, saldrá el mensaje por consola, y con cada iteración que se repetirá cada 2 segundos, se incrementará el contador mostrado por las <em>Developer Tools</em>.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/js03/timers.jpg" alt="Ejemplo de función iterada con un Timer">
</div>
</div>
<div class="paragraph">
<p>Aunque si lo que queremos es realizar una llamada a una función de manera repetida con un intervalo determinado, podemos hacer uso de la función <code>setInterval(funcion, intervalo)</code>, la cual repetirá la ejecución de la función indicada.</p>
</div>
<div class="paragraph">
<p>Finalmente, si queremos detener un temporizador, mediante <code>clearInterval(timer)</code> cancelaremos la ejecución de la función.</p>
</div>
<div class="paragraph">
<p>Así pues, si reescribimos el ejemplo anterior haciendo uso de <code>setInterval</code>, tendremos:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="javascript"><span class="tok-p">(</span><span class="tok-kd">function</span><span class="tok-p">()</span> <span class="tok-p">{</span>
	<span class="tok-nx">miFuncion</span> <span class="tok-o">=</span> <span class="tok-kd">function</span><span class="tok-p">()</span> <span class="tok-p">{</span>
		<span class="tok-nx">console</span><span class="tok-p">.</span><span class="tok-nx">log</span><span class="tok-p">(</span><span class="tok-s2">&quot;Batman vuelve&quot;</span><span class="tok-p">);</span>
	<span class="tok-p">};</span>
	<span class="tok-kd">var</span> <span class="tok-nx">timer</span> <span class="tok-o">=</span> <span class="tok-nx">setInterval</span><span class="tok-p">(</span><span class="tok-nx">miFuncion</span><span class="tok-p">,</span> <span class="tok-mi">2000</span><span class="tok-p">);</span>
<span class="tok-p">}());</span></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_gestión_de_errores">1.9. Gestión de errores</h3>
<div class="paragraph">
<p>Para controlar el comportamiento erróneo de una aplicación, podemos hacer uso de las excepciones.</p>
</div>
<div class="sect3">
<h4 id="_capturando_excepciones">1.9.1. Capturando excepciones</h4>
<div class="paragraph">
<p>¿Qué sucede cuando utilizamos a una variable que no esta declarada?</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="javascript"><span class="tok-kd">var</span> <span class="tok-nx">a</span> <span class="tok-o">=</span> <span class="tok-mi">4</span><span class="tok-p">;</span>
<span class="tok-nx">a</span> <span class="tok-o">=</span> <span class="tok-nx">b</span> <span class="tok-o">+</span> <span class="tok-mi">2</span><span class="tok-p">;</span>
<span class="tok-nx">console</span><span class="tok-p">.</span><span class="tok-nx">log</span><span class="tok-p">(</span><span class="tok-s2">&quot;Después del error&quot;</span><span class="tok-p">);</span>	<span class="tok-c1">// No se ejecuta nunca</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Ya hemos visto que cuando se lanza un error, aparece por consola un mensaje informativo. Si queremos ver el código que ha provocado la excepción, en la consola podemos desplegar el mensaje de la excepción, y a su derecha podremos pulsar sobre el <code>archivo:linea</code> y nos mostrará la línea en cuestión que ha provocado el fallo en el panel de <em>Sources</em>:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/js01/tryCatchConsoleCode.jpg" alt="Código tras pulsar sobre la excepción">
</div>
</div>
<div class="paragraph">
<p>Para evitar estos errores, <em>JavaScript</em> ofrece un mecanismo <code>try</code> / <code>catch</code> / <code>finally</code> similar al que ofrece Java. Al capturar una excepción, podemos acceder a la propiedad <code>message</code> de la excepción para averiguar el error.</p>
</div>
<div class="paragraph">
<p>Por ejemplo, si reescribimos el ejemplo anterior y capturamos la excepción tendremos:</p>
</div>
<div class="listingblock">
<div class="title">try-catch-finally - <a href="http://jsbin.com/kenufe/2/edit?js,console" class="bare">http://jsbin.com/kenufe/2/edit?js,console</a></div>
<div class="content">
<pre class="pygments highlight"><code data-lang="javascript"><span class="tok-k">try</span> <span class="tok-p">{</span>
	<span class="tok-kd">var</span> <span class="tok-nx">a</span> <span class="tok-o">=</span> <span class="tok-mi">4</span><span class="tok-p">;</span>
	<span class="tok-nx">a</span> <span class="tok-o">=</span> <span class="tok-nx">b</span> <span class="tok-o">+</span> <span class="tok-mi">2</span><span class="tok-p">;</span>
	<span class="tok-nx">console</span><span class="tok-p">.</span><span class="tok-nx">log</span><span class="tok-p">(</span><span class="tok-s2">&quot;Después del error&quot;</span><span class="tok-p">);</span>
<span class="tok-p">}</span> <span class="tok-k">catch</span><span class="tok-p">(</span><span class="tok-nx">err</span><span class="tok-p">)</span> <span class="tok-p">{</span>
	<span class="tok-nx">console</span><span class="tok-p">.</span><span class="tok-nx">error</span><span class="tok-p">(</span><span class="tok-s2">&quot;Error en try/catch &quot;</span> <span class="tok-o">+</span>  <span class="tok-nx">err</span><span class="tok-p">.</span><span class="tok-nx">message</span><span class="tok-p">);</span>
<span class="tok-p">}</span> <span class="tok-k">finally</span> <span class="tok-p">{</span>
	<span class="tok-nx">console</span><span class="tok-p">.</span><span class="tok-nx">log</span><span class="tok-p">(</span><span class="tok-s2">&quot;Pase lo que pase, llegamos al finally&quot;</span><span class="tok-p">);</span>
<span class="tok-p">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>La cuarta línea, que hace <code>console.log("Después del error")</code>, nunca se ejecutará porque al intentar sumarle 2 a una variable que no hemos declarado, se lanza una excepción que hemos capturado.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/js01/tryCatchConsole.jpg" alt="Consola tras try/catch">
</div>
</div>
</div>
<div class="sect3">
<h4 id="_lanzando_excepciones">1.9.2. Lanzando excepciones</h4>
<div class="paragraph">
<p>Si queremos que nuestro código lance una excepción, usaremos la instrucción <code>throw</code>, pudiendo bien lanzar una cadena de texto que será el mensaje de error, o bien crear un objeto <code>Error</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="javascript"><span class="tok-kd">function</span> <span class="tok-nx">ecuacion2grado</span><span class="tok-p">(</span><span class="tok-nx">a</span><span class="tok-p">,</span><span class="tok-nx">b</span><span class="tok-p">,</span><span class="tok-nx">c</span><span class="tok-p">)</span> <span class="tok-p">{</span>
	<span class="tok-kd">var</span> <span class="tok-nx">aux</span> <span class="tok-o">=</span> <span class="tok-nx">b</span><span class="tok-o">*</span><span class="tok-nx">b</span><span class="tok-o">-</span><span class="tok-mi">4</span><span class="tok-o">*</span><span class="tok-nx">a</span><span class="tok-o">*</span><span class="tok-nx">c</span><span class="tok-p">;</span>
	<span class="tok-k">if</span> <span class="tok-p">(</span><span class="tok-nx">aux</span> <span class="tok-o">&lt;</span> <span class="tok-mi">0</span><span class="tok-p">)</span> <span class="tok-p">{</span>
		<span class="tok-k">throw</span> <span class="tok-s2">&quot;Raíz Negativa&quot;</span><span class="tok-p">;</span>
		<span class="tok-c1">// throw new Error(&quot;Raíz Negativa&quot;);</span>
	<span class="tok-p">}</span>
	<span class="tok-c1">// resto del código</span>
<span class="tok-p">}</span></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_debug">1.9.3. Debug</h4>
<div class="paragraph">
<p>Ya vimos en el apartado de las <a href="#_dev_tools">[_dev_tools]</a> como podemos introducir <em>breakpoints</em> para depurar el código o parar la ejecución del código cuando se produce una excepción.</p>
</div>
<div class="paragraph">
<p>Una gran desconocida es la instrucción <code>debugger</code>, la cual funciona de manera similar a un <em>breakpoint</em> pero a nivel de código, de modo que paraliza la ejecución del código e invoca al <em>debugger</em> (si existe alguno, si no, no realiza nada) y pausa la ejecución de la aplicación.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="javascript"><span class="tok-kd">function</span> <span class="tok-nx">funcionQueDaProblemas</span><span class="tok-p">()</span> <span class="tok-p">{</span>
	<span class="tok-kr">debugger</span><span class="tok-p">;</span>
	<span class="tok-c1">// código que funciona de manera aleatoria</span>
<span class="tok-p">}</span></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_errores_comunes">1.9.4. Errores comunes</h4>
<div class="paragraph">
<p>A la hora de escribir código <em>JavaScript</em>, los errores más comunes son:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>No cerrar una cadena, olvidando las comillas de cierre.</p>
</li>
<li>
<p>Olvidar el punto y coma tras asignar una función anónima a una variable/propiedad.</p>
</li>
<li>
<p>Invocar a una función, método o variable que no existe.</p>
</li>
<li>
<p>Errores de sintaxis, por ejemplo, <code>document.getElementByID("miId");</code></p>
</li>
<li>
<p>Referenciar un elemento del DOM que todavía no se ha cargado.</p>
</li>
<li>
<p>En una condición, usar una asignación (<code>=</code>) en vez de una comparación (<code>==</code> o <code>===</code>). Aunque la aplicación no se va a quejar, siempre será verdadera.</p>
</li>
<li>
<p>Pasar a una función menos parámetros de los necesarios no provoca ningún error, pero podemos obtener resultados inesperados.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Muchos de estos errores se pueden evitar haciendo uso del modo estricto de ECMAScript 5.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_ejercicios">1.10. Ejercicios</h3>
<div class="paragraph">
<p>Todos los ejercicios del módulo deben estar en modo estricto (<code>"use strict"</code>) y cumplir la nomeclatura de nombrado de archivos.</p>
</div>
<div class="paragraph">
<p>El repositorio a clonar es <code>java_ua/ejercicios-js-expertojava</code>.</p>
</div>
<div class="sect3">
<h4 id="__0_4_ptos_ejercicio_11_code_tocani_code">1.10.1. (0.4 ptos) Ejercicio 11. <code>toCani</code></h4>
<div class="paragraph">
<p>Crear una función que reciba una cadena y la devuelva transformada en <em>Cani</em>. Por ejemplo, si le pasamos a la función la cadena <code>"una cadena cani es como esta"</code> obtendremos <code>"UnA KaDeNa kAnI Es kOmO EsTaHHH"</code>.
Para ello, hay que alternar el uso de MAYÚSCULAS y minúsculas, sustituir la letra <code>C</code> por la <code>K</code> y añadir tres letras <code>H</code> al final.</p>
</div>
<div class="paragraph">
<p>La función se almacenará en una archivo denominado <code>ej11.js</code>, y tendrá la siguiente definición:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="javascript"><span class="tok-kd">function</span> <span class="tok-nx">toCani</span><span class="tok-p">(</span><span class="tok-nx">cadena</span><span class="tok-p">)</span> <span class="tok-p">{}</span></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="__0_6_ptos_ejercicio_12_temporizador">1.10.2. (0.6 ptos) Ejercicio 12. Temporizador</h4>
<div class="paragraph">
<p>Crear una función temporizador que reciba como parámetro los minutos y segundos de duración del mismo, de modo, que cada segundo mostrará por consola el tiempo que le queda al temporizador hasta llegar a 0.</p>
</div>
<div class="paragraph">
<p>La función recibirá dos parámetros, con los minutos y los segundos, pero en el caso que sólo le pasemos un parámetro, considerará que son los segundos desde donde comenzará la cuenta atrás.</p>
</div>
<div class="paragraph">
<p>Por ejemplo:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="javascript"><span class="tok-nx">temporizador</span><span class="tok-p">(</span><span class="tok-mi">77</span><span class="tok-p">);</span>	<span class="tok-c1">// le pasamos 77 segundos</span>
<span class="tok-nx">temporizador</span><span class="tok-p">(</span><span class="tok-mi">2</span><span class="tok-p">,</span><span class="tok-mi">50</span><span class="tok-p">);</span>	<span class="tok-c1">// le pasamos 2 minutos y 50 segundos</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Si alguno de los valores que recibe como parámetros son negativos o de un tipo inesperado, la función debe lanzar una excepción informando del problema.</p>
</div>
<div class="paragraph">
<p>La función se almacenará en una archivo denominado <code>ej12.js</code>, y tendrá la siguiente definición:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="javascript"><span class="tok-kd">function</span> <span class="tok-nx">temporizador</span><span class="tok-p">(</span><span class="tok-nx">minutos</span><span class="tok-p">,</span> <span class="tok-nx">segundos</span><span class="tok-p">)</span> <span class="tok-p">{}</span></code></pre>
</div>
</div>
<div style="page-break-after: always;"></div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="sesion02">2. JavaScript orientado a objetos</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_trabajando_con_objetos">2.1. Trabajando con objetos</h3>
<div class="paragraph">
<p>Todo en <em>JavaScript</em> es un objeto. El ejemplo más básico de un objeto en <em>JavaScript</em> es una cadena.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="javascript"><span class="tok-kd">var</span> <span class="tok-nx">cadena</span> <span class="tok-o">=</span> <span class="tok-s2">&quot;Yo soy tu padre&quot;</span><span class="tok-p">,</span>
  <span class="tok-kr">long</span> <span class="tok-o">=</span> <span class="tok-nx">cadena</span><span class="tok-p">.</span><span class="tok-nx">length</span><span class="tok-p">;</span>

<span class="tok-kd">var</span> <span class="tok-nx">minus</span> <span class="tok-o">=</span> <span class="tok-nx">cadena</span><span class="tok-p">.</span><span class="tok-nx">toUpperCase</span><span class="tok-p">();</span>
<span class="tok-nx">console</span><span class="tok-p">.</span><span class="tok-nx">log</span><span class="tok-p">(</span><span class="tok-nx">minus</span><span class="tok-p">);</span>
<span class="tok-nx">console</span><span class="tok-p">.</span><span class="tok-nx">log</span><span class="tok-p">(</span><span class="tok-nx">cadena</span><span class="tok-p">);</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Podemos observar como la cadena tiene atributos (<code>length</code>) y métodos (<code>toUpperCase()</code>).</p>
</div>
<div class="paragraph">
<p>Los tipos de datos primitivos son tipos de datos <code>Number</code>, <code>String</code> o <code>Boolean</code>. Realmente no son objetos, y aunque tengan métodos y propiedades, son <strong>inmutables</strong>.</p>
</div>
<div class="paragraph">
<p>En cambio, los objetos en <em>JavaScript</em> son colecciones de claves mutables. En <em>JavaScript</em>, los arrays son objetos, las funciones son objetos (<code>Function</code>), las fechas son objetos (<code>Date</code>), las expresiones regulares son objetos (<code>RegExp</code>) y los objetos, objetos son (<code>Object</code>).</p>
</div>
<div class="paragraph">
<p>Para crear un objeto, podemos usar el tipo de datos <code>Object</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="javascript"><span class="tok-kd">var</span> <span class="tok-nx">obj</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-nb">Object</span><span class="tok-p">();</span>
<span class="tok-kd">var</span> <span class="tok-nx">str</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-nb">String</span><span class="tok-p">();</span></code></pre>
</div>
</div>
<div class="sect3">
<h4 id="_propiedades">2.1.1. Propiedades</h4>
<div class="paragraph">
<p>Un objeto es un contenedor de propiedades (cada propiedad tiene un nombre y un valor), y por tanto, son útiles para coleccionar y organizar datos. Los objetos pueden contener otros objetos, lo que permite estructuras de grafo o árbol.</p>
</div>
<div class="paragraph">
<p>Para añadir propiedades a un objeto no tenemos más que asignarle un valor utilizando el operador <code>.</code> para indicar que la propiedad forma parte del objeto.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="javascript"><span class="tok-kd">var</span> <span class="tok-nx">persona</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-nb">Object</span><span class="tok-p">();</span>
<span class="tok-nx">persona</span><span class="tok-p">.</span><span class="tok-nx">nombre</span> <span class="tok-o">=</span> <span class="tok-s2">&quot;Aitor&quot;</span><span class="tok-p">;</span>
<span class="tok-nx">persona</span><span class="tok-p">.</span><span class="tok-nx">apellido1</span> <span class="tok-o">=</span> <span class="tok-s2">&quot;Medrano&quot;</span><span class="tok-p">;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Para averiguar si un objeto contiene un campo, podemos usar el operador <code>in</code>. Finalmente, si queremos eliminar una propiedad de un objeto, hemos de utilizar el operador <code>delete</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="javascript"><span class="tok-nx">console</span><span class="tok-p">.</span><span class="tok-nx">log</span><span class="tok-p">(</span><span class="tok-s1">&#39;nombre&#39;</span> <span class="tok-k">in</span> <span class="tok-nx">persona</span><span class="tok-p">);</span> <span class="tok-c1">// true</span>
<span class="tok-k">delete</span> <span class="tok-nx">persona</span><span class="tok-p">.</span><span class="tok-nx">nombre</span><span class="tok-p">;</span>
<span class="tok-nx">console</span><span class="tok-p">.</span><span class="tok-nx">log</span><span class="tok-p">(</span><span class="tok-s1">&#39;nombre&#39;</span> <span class="tok-k">in</span> <span class="tok-nx">persona</span><span class="tok-p">);</span> <span class="tok-c1">// false</span></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_métodos">2.1.2. Métodos</h4>
<div class="paragraph">
<p>Para crear un método, podemos asignar una función anónima a una propiedad, y al formar parte del objeto, la variable <strong><code>this</code> referencia al objeto</strong> en cuestión (y no a la variable global como sucede con las funciones declaración/expresión).</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="javascript"><span class="tok-nx">persona</span><span class="tok-p">.</span><span class="tok-nx">getNombreCompleto</span> <span class="tok-o">=</span> <span class="tok-kd">function</span><span class="tok-p">()</span> <span class="tok-p">{</span>
  <span class="tok-k">return</span> <span class="tok-k">this</span><span class="tok-p">.</span><span class="tok-nx">nombre</span> <span class="tok-o">+</span> <span class="tok-s2">&quot; &quot;</span> <span class="tok-o">+</span> <span class="tok-k">this</span><span class="tok-p">.</span><span class="tok-nx">apellido1</span><span class="tok-p">;</span>
<span class="tok-p">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Y para invocar la función invocaremos el método de manera similar a <em>Java</em>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="javascript"><span class="tok-nx">console</span><span class="tok-p">.</span><span class="tok-nx">log</span><span class="tok-p">(</span> <span class="tok-nx">persona</span><span class="tok-p">.</span><span class="tok-nx">getNombreCompleto</span><span class="tok-p">()</span> <span class="tok-p">);</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Realmente el código no se escribe así, es decir, no se crea un <code>Object</code> y posteriormente se le asocian propiedades y métodos, sino que se simplifica mediante objetos literales.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_objetos_literales">2.2. Objetos literales</h3>
<div class="paragraph">
<p>Los objetos literales ofrecen una notación para crear nuevos objetos valor. Un objeto literal es un par de llaves que rodean 0 o más parejas de clave:valor separados por comas, donde cada clave se considera como un propiedad/método, de la siguiente manera:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="javascript"><span class="tok-kd">var</span> <span class="tok-nx">nadie</span> <span class="tok-o">=</span> <span class="tok-p">{};</span>
<span class="tok-kd">var</span> <span class="tok-nx">persona</span> <span class="tok-o">=</span> <span class="tok-p">{</span>
  <span class="tok-nx">nombre</span> <span class="tok-o">:</span> <span class="tok-s2">&quot;Aitor&quot;</span><span class="tok-p">,</span>	<i class="conum" data-value="1"></i><b>(1)</b>
  <span class="tok-nx">apellido1</span> <span class="tok-o">:</span> <span class="tok-s2">&quot;Medrano&quot;</span><span class="tok-p">,</span>
  <span class="tok-nx">getNombreCompleto</span> <span class="tok-o">:</span> <span class="tok-kd">function</span><span class="tok-p">()</span> <span class="tok-p">{</span>	<i class="conum" data-value="2"></i><b>(2)</b>
    <span class="tok-k">return</span> <span class="tok-k">this</span><span class="tok-p">.</span><span class="tok-nx">nombre</span> <span class="tok-o">+</span> <span class="tok-s2">&quot; &quot;</span> <span class="tok-o">+</span> <span class="tok-k">this</span><span class="tok-p">.</span><span class="tok-nx">apellido1</span><span class="tok-p">;</span>
  <span class="tok-p">}</span>
<span class="tok-p">};</span></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>La propiedad y el valor se separan con dos puntos, y cada una de las propiedades con una coma, de forma similar a JSON.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>un método es una propiedad de tipo <code>function</code></td>
</tr>
</table>
</div>
<div class="admonitionblock caution">
<table>
<tr>
<td class="icon">
<i class="fa icon-caution" title="Caution"></i>
</td>
<td class="content">
Todo objeto literal finaliza con un punto y coma (<code>;</code>)
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Para recuperar un campo, además de la notación <code>.</code>, podemos acceder a cualquier propiedad usando la notación de corchetes <code>[]</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="javascript"><span class="tok-kd">var</span> <span class="tok-nx">nom</span> <span class="tok-o">=</span> <span class="tok-nx">persona</span><span class="tok-p">.</span><span class="tok-nx">nombre</span><span class="tok-p">;</span>
<span class="tok-kd">var</span> <span class="tok-nx">ape1</span> <span class="tok-o">=</span> <span class="tok-nx">persona</span><span class="tok-p">[</span><span class="tok-s2">&quot;apellido1&quot;</span><span class="tok-p">];</span>
<span class="tok-kd">var</span> <span class="tok-nx">nombreCompleto</span> <span class="tok-o">=</span> <span class="tok-nx">persona</span><span class="tok-p">.</span><span class="tok-nx">getNombreCompleto</span><span class="tok-p">();</span>
<span class="tok-kd">var</span> <span class="tok-nx">nombreCompletoCorchete</span> <span class="tok-o">=</span> <span class="tok-nx">persona</span><span class="tok-p">[</span><span class="tok-s2">&quot;getNombreCompleto&quot;</span><span class="tok-p">]();</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>La notación de corchetes es muy útil para acceder a una propiedades cuya clave está almacenada en una variable que contiene una cadena con el nombre de la misma.</p>
</div>
<div class="sect3">
<h4 id="_objetos_anidados">2.2.1. Objetos anidados</h4>
<div class="paragraph">
<p>Los objetos anidados son muy útiles para organizar la información y representar relaciones contiene con cardinalidades 1 a 1, o 1 a muchos:</p>
</div>
<div class="listingblock">
<div class="title">Objetos anidados - <a href="http://jsbin.com/qeduze/1/edit?js" class="bare">http://jsbin.com/qeduze/1/edit?js</a></div>
<div class="content">
<pre class="pygments highlight"><code data-lang="javascript"><span class="tok-kd">var</span> <span class="tok-nx">cliente</span> <span class="tok-o">=</span> <span class="tok-p">{</span>
  <span class="tok-nx">nombre</span><span class="tok-o">:</span> <span class="tok-s2">&quot;Bruce Wayne&quot;</span><span class="tok-p">,</span>
  <span class="tok-nx">email</span><span class="tok-o">:</span> <span class="tok-s2">&quot;bruce@wayne.com&quot;</span><span class="tok-p">,</span>
  <span class="tok-nx">direccion</span><span class="tok-o">:</span> <span class="tok-p">{</span>
    <span class="tok-nx">calle</span><span class="tok-o">:</span> <span class="tok-s2">&quot;Mountain Drive&quot;</span><span class="tok-p">,</span>
    <span class="tok-nx">num</span><span class="tok-o">:</span> <span class="tok-mi">1007</span><span class="tok-p">,</span>
    <span class="tok-nx">ciudad</span><span class="tok-o">:</span> <span class="tok-s2">&quot;Gotham&quot;</span>
  <span class="tok-p">}</span>
<span class="tok-p">};</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>También podemos asignar objetos:</p>
</div>
<div class="listingblock">
<div class="title">Objetos y propiedades anidadas - <a href="http://jsbin.com/qeduze/1/edit?js" class="bare">http://jsbin.com/qeduze/1/edit?js</a></div>
<div class="content">
<pre class="pygments highlight"><code data-lang="javascript"><span class="tok-kd">var</span> <span class="tok-nx">cliente</span> <span class="tok-o">=</span> <span class="tok-p">{};</span>
<span class="tok-nx">cliente</span><span class="tok-p">.</span><span class="tok-nx">nombre</span> <span class="tok-o">=</span> <span class="tok-s2">&quot;Bruce Wayne&quot;</span><span class="tok-p">;</span>
<span class="tok-nx">cliente</span><span class="tok-p">.</span><span class="tok-nx">email</span> <span class="tok-o">=</span> <span class="tok-s2">&quot;bruce@wayne.com&quot;</span><span class="tok-p">;</span>
<span class="tok-nx">cliente</span><span class="tok-p">.</span><span class="tok-nx">direccion</span> <span class="tok-o">=</span> <span class="tok-p">{};</span>
<span class="tok-nx">cliente</span><span class="tok-p">.</span><span class="tok-nx">direccion</span><span class="tok-p">.</span><span class="tok-nx">calle</span> <span class="tok-o">=</span> <span class="tok-s2">&quot;Mountain Drive&quot;</span><span class="tok-p">;</span>
<span class="tok-nx">cliente</span><span class="tok-p">.</span><span class="tok-nx">direccion</span><span class="tok-p">.</span><span class="tok-nx">num</span> <span class="tok-o">=</span> <span class="tok-mi">1007</span><span class="tok-p">;</span>
<span class="tok-nx">cliente</span><span class="tok-p">.</span><span class="tok-nx">direccion</span><span class="tok-p">.</span><span class="tok-nx">ciudad</span> <span class="tok-o">=</span> <span class="tok-s2">&quot;Gotham&quot;</span><span class="tok-p">;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Si accedemos a una propiedad que no existe, obtendremos <code>undefined</code>. Si queremos evitarlo, podemos usar el operador <code>||</code> (<em>or</em>).</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="javascript"><span class="tok-kd">var</span> <span class="tok-nx">nada</span> <span class="tok-o">=</span> <span class="tok-nx">cliente</span><span class="tok-p">.</span><span class="tok-nx">formaPago</span><span class="tok-p">;</span> <span class="tok-c1">// undefined</span>
<span class="tok-kd">var</span> <span class="tok-nx">pagoPorDfecto</span> <span class="tok-o">=</span> <span class="tok-nx">cliente</span><span class="tok-p">.</span><span class="tok-nx">formaPago</span> <span class="tok-o">||</span> <span class="tok-s2">&quot;Efectivo&quot;</span><span class="tok-p">;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Un fallo muy común es acceder a un campo de una propiedad que no existe. El siguiente fragmento fallará, ya que el objeto <code>direccion</code> no está definido.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="javascript"><span class="tok-kd">var</span> <span class="tok-nx">cliente</span> <span class="tok-o">=</span> <span class="tok-p">{};</span>
<span class="tok-nx">cliente</span><span class="tok-p">.</span><span class="tok-nx">direccion</span><span class="tok-p">.</span><span class="tok-nx">calle</span> <span class="tok-o">=</span> <span class="tok-s2">&quot;Mountain Drive&quot;</span><span class="tok-p">;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Si intentamos obtener un valor de una propiedad <code>undefined</code>, se lanzará un excepción <code>TypeError</code>. Para evitar la excepción, podemos usar el operación <code>&amp;&amp;</code> (<em>and</em>).</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="javascript"><span class="tok-kd">var</span> <span class="tok-nx">cliente</span> <span class="tok-o">=</span> <span class="tok-p">{};</span>
<span class="tok-nx">cliente</span><span class="tok-p">.</span><span class="tok-nx">direccion</span><span class="tok-p">;</span> <span class="tok-c1">// undefined</span>
<span class="tok-nx">cliente</span><span class="tok-p">.</span><span class="tok-nx">direccion</span><span class="tok-p">.</span><span class="tok-nx">calle</span><span class="tok-p">;</span> <span class="tok-c1">//   lanza TypeError</span>
<span class="tok-nx">cliente</span><span class="tok-p">.</span><span class="tok-nx">direccion</span> <span class="tok-o">&amp;&amp;</span> <span class="tok-nx">cliente</span><span class="tok-p">.</span><span class="tok-nx">direccion</span><span class="tok-p">.</span><span class="tok-nx">calle</span><span class="tok-p">;</span> <span class="tok-c1">// undefined</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>En resumen, un objeto puede contener otros objetos como propiedades. Por ello, podemos ver código del tipo <code>variable.objeto.objeto.objeto.propiedad</code> o <code>variable['objeto']['objeto']['objeto']['propiedad']</code>. Esto se conoce como <strong>encadenado de objeto</strong> (<em>object chaining</em>).</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_creando_un_tipo_de_datos">2.3. Creando un tipo de datos</h3>
<div class="paragraph">
<p>Si quisiéramos crear dos personas con los mismos atributos que en el ejemplo anterior, tendríamos que repetir mucho código.</p>
</div>
<div class="sect3">
<h4 id="_función_factoría">2.3.1. Función factoría</h4>
<div class="paragraph">
<p>Para evitarlo, y que los objetos compartan un interfaz común, podemos crear una función factoría que devuelva el objeto.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="javascript"><span class="tok-kd">function</span> <span class="tok-nx">creaPersona</span><span class="tok-p">(</span><span class="tok-nx">nom</span><span class="tok-p">,</span> <span class="tok-nx">ape1</span><span class="tok-p">)</span> <span class="tok-p">{</span>
  <span class="tok-k">return</span> <span class="tok-p">{</span>
    <span class="tok-nx">nombre</span> <span class="tok-o">:</span> <span class="tok-nx">nom</span><span class="tok-p">,</span>
    <span class="tok-nx">apellido1</span> <span class="tok-o">:</span> <span class="tok-nx">ape1</span><span class="tok-p">,</span>
    <span class="tok-nx">getNombreCompleto</span> <span class="tok-o">:</span> <span class="tok-kd">function</span><span class="tok-p">()</span> <span class="tok-p">{</span>
      <span class="tok-k">return</span> <span class="tok-k">this</span><span class="tok-p">.</span><span class="tok-nx">nombre</span> <span class="tok-o">+</span> <span class="tok-s2">&quot; &quot;</span> <span class="tok-o">+</span> <span class="tok-k">this</span><span class="tok-p">.</span><span class="tok-nx">apellido1</span><span class="tok-p">;</span>
    <span class="tok-p">}</span>
  <span class="tok-p">};</span>
<span class="tok-p">}</span>

<span class="tok-kd">var</span> <span class="tok-nx">persona</span> <span class="tok-o">=</span> <span class="tok-nx">creaPersona</span><span class="tok-p">(</span><span class="tok-s2">&quot;Aitor&quot;</span><span class="tok-p">,</span> <span class="tok-s2">&quot;Medrano&quot;</span><span class="tok-p">),</span>
  <span class="tok-nx">persona2</span> <span class="tok-o">=</span> <span class="tok-nx">creaPersona</span><span class="tok-p">(</span><span class="tok-s2">&quot;Domingo&quot;</span><span class="tok-p">,</span> <span class="tok-s2">&quot;Gallardo&quot;</span><span class="tok-p">);</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Al tratarse de un lenguaje débilmente tipado, si queremos usar un objeto dentro de un método, es recomendable que comprobemos si existe el método que nos interesa del objeto. Por ejemplo, si queremos añadir un método dentro de una persona, que nos permita saludar a otra, tendríamos lo siguiente:</p>
</div>
<div class="listingblock">
<div class="title">Función Factoría - <a href="http://jsbin.com/tirawe/1/edit?js" class="bare">http://jsbin.com/tirawe/1/edit?js</a></div>
<div class="content">
<pre class="pygments highlight"><code data-lang="javascript"><span class="tok-kd">function</span> <span class="tok-nx">creaPersona</span><span class="tok-p">(</span><span class="tok-nx">nom</span><span class="tok-p">,</span> <span class="tok-nx">ape1</span><span class="tok-p">)</span> <span class="tok-p">{</span>
  <span class="tok-k">return</span> <span class="tok-p">{</span>
    <span class="tok-nx">nombre</span> <span class="tok-o">:</span> <span class="tok-nx">nom</span><span class="tok-p">,</span>
    <span class="tok-nx">apellido1</span> <span class="tok-o">:</span> <span class="tok-nx">ape1</span><span class="tok-p">,</span>
    <span class="tok-nx">getNombreCompleto</span> <span class="tok-o">:</span> <span class="tok-kd">function</span><span class="tok-p">()</span> <span class="tok-p">{</span>
      <span class="tok-k">return</span> <span class="tok-k">this</span><span class="tok-p">.</span><span class="tok-nx">nombre</span> <span class="tok-o">+</span> <span class="tok-s2">&quot; &quot;</span> <span class="tok-o">+</span> <span class="tok-k">this</span><span class="tok-p">.</span><span class="tok-nx">apellido1</span><span class="tok-p">;</span>
    <span class="tok-p">},</span>
    <span class="tok-nx">saluda</span><span class="tok-o">:</span> <span class="tok-kd">function</span><span class="tok-p">(</span><span class="tok-nx">persona</span><span class="tok-p">)</span> <span class="tok-p">{</span>
      <span class="tok-k">if</span> <span class="tok-p">(</span><span class="tok-k">typeof</span> <span class="tok-nx">persona</span><span class="tok-p">.</span><span class="tok-nx">getNombreCompleto</span> <span class="tok-o">!==</span> <span class="tok-s2">&quot;undefined&quot;</span><span class="tok-p">)</span> <span class="tok-p">{</span> <i class="conum" data-value="1"></i><b>(1)</b>
        <span class="tok-k">return</span> <span class="tok-s2">&quot;Hola &quot;</span> <span class="tok-o">+</span> <span class="tok-nx">persona</span><span class="tok-p">.</span><span class="tok-nx">getNombreCompleto</span><span class="tok-p">();</span>
      <span class="tok-p">}</span> <span class="tok-k">else</span> <span class="tok-p">{</span>
        <span class="tok-k">return</span> <span class="tok-s2">&quot;Hola colega&quot;</span><span class="tok-p">;</span>
      <span class="tok-p">}</span>
    <span class="tok-p">}</span>
  <span class="tok-p">};</span>
<span class="tok-p">}</span>

<span class="tok-kd">var</span> <span class="tok-nx">persona</span> <span class="tok-o">=</span> <span class="tok-nx">creaPersona</span><span class="tok-p">(</span><span class="tok-s2">&quot;Aitor&quot;</span><span class="tok-p">,</span> <span class="tok-s2">&quot;Medrano&quot;</span><span class="tok-p">),</span>
  <span class="tok-nx">persona2</span> <span class="tok-o">=</span> <span class="tok-nx">creaPersona</span><span class="tok-p">(</span><span class="tok-s2">&quot;Domingo&quot;</span><span class="tok-p">,</span> <span class="tok-s2">&quot;Gallardo&quot;</span><span class="tok-p">);</span>
<span class="tok-nx">persona</span><span class="tok-p">.</span><span class="tok-nx">saluda</span><span class="tok-p">(</span><span class="tok-nx">persona2</span><span class="tok-p">);</span> <span class="tok-c1">// Hola Domingo Gallardo</span>
<span class="tok-nx">persona</span><span class="tok-p">.</span><span class="tok-nx">saluda</span><span class="tok-p">({});</span> <span class="tok-c1">// Hola colega</span>
<span class="tok-nx">persona</span><span class="tok-p">.</span><span class="tok-nx">saluda</span><span class="tok-p">({</span> <span class="tok-nx">getNombreCompleto</span><span class="tok-o">:</span> <span class="tok-s2">&quot;Bruce Wayne&quot;</span> <span class="tok-p">});</span> <span class="tok-c1">// TypeError, la propiedad getNombreCompleto no es una función</span></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Comprobamos que el objeto contiene la propiedad que vamos a usar</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_función_constructor">2.3.2. Función constructor</h4>
<div class="paragraph">
<p>Otra manera más elegante y eficiente es utilizar es una función constructor haciendo uso de la instrucción <code>new</code>, del mismo modo que creamos una fecha con <code>var fecha = new Date()</code>.</p>
</div>
<div class="paragraph">
<p>Para ello, dentro de la función constructor que nombraremos con la primera letra en mayúscula (convención de código), crearemos las propiedades y los métodos mediante funciones y los asignaremos (ya no usamos la notación JSON) a propiedades de la función, tal que así:</p>
</div>
<div class="listingblock">
<div class="title">Función constructor - <a href="http://jsbin.com/peliq/1/edit?js" class="bare">http://jsbin.com/peliq/1/edit?js</a></div>
<div class="content">
<pre class="pygments highlight"><code data-lang="javascript"><span class="tok-kd">var</span> <span class="tok-nx">Persona</span> <span class="tok-o">=</span> <span class="tok-kd">function</span><span class="tok-p">(</span><span class="tok-nx">nombre</span><span class="tok-p">,</span> <span class="tok-nx">apellido1</span><span class="tok-p">)</span> <span class="tok-p">{</span>
  <span class="tok-k">this</span><span class="tok-p">.</span><span class="tok-nx">nombre</span> <span class="tok-o">=</span> <span class="tok-nx">nombre</span><span class="tok-p">;</span>
  <span class="tok-k">this</span><span class="tok-p">.</span><span class="tok-nx">apellido1</span> <span class="tok-o">=</span> <span class="tok-nx">apellido1</span><span class="tok-p">;</span>

  <span class="tok-k">this</span><span class="tok-p">.</span><span class="tok-nx">getNombreCompleto</span> <span class="tok-o">=</span> <span class="tok-kd">function</span><span class="tok-p">()</span> <span class="tok-p">{</span>
    <span class="tok-k">return</span> <span class="tok-k">this</span><span class="tok-p">.</span><span class="tok-nx">nombre</span> <span class="tok-o">+</span> <span class="tok-s2">&quot; &quot;</span> <span class="tok-o">+</span> <span class="tok-k">this</span><span class="tok-p">.</span><span class="tok-nx">apellido1</span><span class="tok-p">;</span>
  <span class="tok-p">};</span>

  <span class="tok-k">this</span><span class="tok-p">.</span><span class="tok-nx">saluda</span> <span class="tok-o">=</span> <span class="tok-kd">function</span><span class="tok-p">(</span><span class="tok-nx">persona</span><span class="tok-p">)</span> <span class="tok-p">{</span>
    <span class="tok-k">if</span> <span class="tok-p">(</span><span class="tok-nx">persona</span> <span class="tok-k">instanceof</span> <span class="tok-nx">Persona</span><span class="tok-p">)</span> <span class="tok-p">{</span> <i class="conum" data-value="1"></i><b>(1)</b>
      <span class="tok-k">return</span> <span class="tok-s2">&quot;Hola &quot;</span> <span class="tok-o">+</span> <span class="tok-nx">persona</span><span class="tok-p">.</span><span class="tok-nx">getNombreCompleto</span><span class="tok-p">();</span>
    <span class="tok-p">}</span> <span class="tok-k">else</span> <span class="tok-p">{</span>
      <span class="tok-k">return</span> <span class="tok-s2">&quot;Hola colega&quot;</span><span class="tok-p">;</span>
    <span class="tok-p">}</span>
  <span class="tok-p">};</span>
<span class="tok-p">};</span></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Al tratarse de un objeto mediante función constructor, ya podemos consultar su tipo con <code>instanceof</code></td>
</tr>
</table>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="title">instanceof</div>
<div class="paragraph">
<p>Mediante el operador <code>instanceof</code> podemos determinar (<code>true</code> o <code>false</code>) si un objeto es una instancia de una determinada función constructor.</p>
</div>
<div class="paragraph">
<p>Hay que tener en cuenta que devolverá <code>true</code> cada vez que le preguntemos si un objeto es una instancia de <code>Object</code>, ya que todos los objetos heredan del constructor <code>Object()</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="javascript"><span class="tok-kd">var</span> <span class="tok-nx">heroe</span> <span class="tok-o">=</span> <span class="tok-p">{</span> <span class="tok-nx">nombre</span><span class="tok-o">:</span> <span class="tok-s2">&quot;Batman&quot;</span> <span class="tok-p">};</span>
<span class="tok-nx">console</span><span class="tok-p">.</span><span class="tok-nx">log</span><span class="tok-p">(</span><span class="tok-nx">heroe</span> <span class="tok-k">instanceof</span> <span class="tok-nb">Object</span><span class="tok-p">);</span> <span class="tok-c1">// true</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>En cambio, devolverá <code>false</code> al tratar con tipos primitivos que envuelven objetos, pero <code>true</code> si se crean con el operador <code>new</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="javascript"><span class="tok-nx">console</span><span class="tok-p">.</span><span class="tok-nx">log</span><span class="tok-p">(</span><span class="tok-s2">&quot;Batman&quot;</span> <span class="tok-k">instanceof</span> <span class="tok-nb">String</span><span class="tok-p">);</span>  <span class="tok-c1">// false</span>
<span class="tok-nx">console</span><span class="tok-p">.</span><span class="tok-nx">log</span><span class="tok-p">(</span><span class="tok-k">new</span> <span class="tok-nb">String</span><span class="tok-p">(</span><span class="tok-s2">&quot;Batman&quot;</span><span class="tok-p">)</span> <span class="tok-k">instanceof</span> <span class="tok-nb">String</span><span class="tok-p">);</span> <span class="tok-c1">// true</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>En resumen, <code>instanceof</code> sólo funciona con objetos complejos e instancias creadas mediante funciones constructor que devuelven objetos</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Una vez creada la función, la invocaremos mediante la instrucción <code>new</code>, la cual crea una nueva instancia del objeto:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="javascript"><span class="tok-kd">var</span> <span class="tok-nx">persona</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-nx">Persona</span><span class="tok-p">(</span><span class="tok-s2">&quot;Aitor&quot;</span><span class="tok-p">,</span> <span class="tok-s2">&quot;Medrano&quot;</span><span class="tok-p">),</span>
	<span class="tok-nx">persona2</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-nx">Persona</span><span class="tok-p">(</span><span class="tok-s2">&quot;Domingo&quot;</span><span class="tok-p">,</span> <span class="tok-s2">&quot;Gallardo&quot;</span><span class="tok-p">);</span>
<span class="tok-nx">persona</span><span class="tok-p">.</span><span class="tok-nx">saluda</span><span class="tok-p">(</span><span class="tok-nx">persona2</span><span class="tok-p">);</span> <span class="tok-c1">// Hola Domingo Gallardo</span>
<span class="tok-nx">persona</span><span class="tok-p">.</span><span class="tok-nx">saluda</span><span class="tok-p">({});</span> <span class="tok-c1">// Hola colega</span>
<span class="tok-nx">persona</span><span class="tok-p">.</span><span class="tok-nx">saluda</span><span class="tok-p">({</span> <span class="tok-nx">getNombreCompleto</span><span class="tok-o">:</span> <span class="tok-s2">&quot;Bruce Wayne&quot;</span> <span class="tok-p">});</span> <span class="tok-c1">// Hola colega</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>También podíamos haber comenzado con una sintaxis similar a <em>Java</em>, es decir, en vez de una función expresión, mediante una función declaración. Con lo que sustituiríamos la primera línea por:</p>
</div>
<div class="listingblock">
<div class="title">Función constructor notación Java - <a href="https://jsbin.com/bijejaj/edit?js,console" class="bare">https://jsbin.com/bijejaj/edit?js,console</a></div>
<div class="content">
<pre class="pygments highlight"><code data-lang="javascript"><span class="tok-kd">function</span> <span class="tok-nx">Persona</span><span class="tok-p">(</span><span class="tok-nx">nombre</span><span class="tok-p">,</span> <span class="tok-nx">apellido1</span><span class="tok-p">)</span> <span class="tok-p">{</span>
  <span class="tok-k">this</span><span class="tok-p">.</span><span class="tok-nx">nombre</span> <span class="tok-o">=</span> <span class="tok-nx">nombre</span><span class="tok-p">;</span>
  <span class="tok-k">this</span><span class="tok-p">.</span><span class="tok-nx">apellido1</span> <span class="tok-o">=</span> <span class="tok-nx">apellido1</span><span class="tok-p">;</span>
  <span class="tok-c1">// ....</span>
<span class="tok-p">}</span>
<span class="tok-kd">var</span> <span class="tok-nx">batman</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-nx">Persona</span><span class="tok-p">(</span><span class="tok-s2">&quot;Bruce&quot;</span><span class="tok-p">,</span> <span class="tok-s2">&quot;Wayne&quot;</span><span class="tok-p">);</span></code></pre>
</div>
</div>
<div class="admonitionblock caution">
<table>
<tr>
<td class="icon">
<i class="fa icon-caution" title="Caution"></i>
</td>
<td class="content">
<div class="title">No olvides <code>new</code></div>
<div class="paragraph">
<p>Mucho cuidado con olvidar la palabra clave <code>new</code>, porque de ese modo no estaríamos creando un objeto, sino asignando las propiedades y métodos del objeto al objeto <code>window</code>, lo que no nos daría error, pero no haría lo que esperamos.</p>
</div>
<div class="paragraph">
<p>Una manera de evitar esta posibilidad, es añadir una comprobación nada más declarar la función:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="javascript"><span class="tok-kd">var</span> <span class="tok-nx">Persona</span> <span class="tok-o">=</span> <span class="tok-kd">function</span><span class="tok-p">(</span><span class="tok-nx">nombre</span><span class="tok-p">,</span> <span class="tok-nx">apellido1</span><span class="tok-p">)</span> <span class="tok-p">{</span>
  <span class="tok-k">if</span> <span class="tok-p">(</span><span class="tok-k">this</span> <span class="tok-o">===</span> <span class="tok-nb">window</span><span class="tok-p">)</span> <span class="tok-p">{</span>
    <span class="tok-k">return</span> <span class="tok-k">new</span> <span class="tok-nx">Persona</span><span class="tok-p">(</span><span class="tok-nx">nombre</span><span class="tok-p">,</span> <span class="tok-nx">apellido1</span><span class="tok-p">);</span>
  <span class="tok-p">}</span>

  <span class="tok-k">this</span><span class="tok-p">.</span><span class="tok-nx">nombre</span> <span class="tok-o">=</span> <span class="tok-nx">nombre</span><span class="tok-p">;</span>
  <span class="tok-k">this</span><span class="tok-p">.</span><span class="tok-nx">apellido1</span> <span class="tok-o">=</span> <span class="tok-nx">apellido1</span><span class="tok-p">;</span>
  <span class="tok-c1">// continua con el resto del código</span></code></pre>
</div>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Los desarrolladores que vienen (<em>¿venimos?</em>) del mundo de Java preferimos el uso de funciones constructor, aunque realmente al usar una función constructor estamos consiguiendo lo mismo que una función factoría, pero con la variable <code>this</code> siempre referenciando al objeto y no con un comportamiento dinámico como veremos más adelante. Más información: <a href="http://ericleads.com/2013/01/javascript-constructor-functions-vs-factory-functions/" class="bare">http://ericleads.com/2013/01/javascript-constructor-functions-vs-factory-functions/</a></p>
</div>
<div class="paragraph">
<p>En ambos casos, cada vez que creamos un objeto, los métodos vuelven a crearse y ocupan memoria. Así al crear dos personas, los métodos de <code>getNombreCompleto</code> y <code>saluda</code> se crean dos veces cada uno. Para solucionar esto, tenemos que usar la propiedad <code>prototype</code> que veremos más adelante.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_invocación_indirecta">2.4. Invocación indirecta</h3>
<div class="paragraph">
<p>Para poder reutilizar funciones de un objeto entre diferentes objetos, podemos hacer uso del método <code>apply</code>. Este tipo de invocación se conoce como invocación indirecta y permite redefinir el valor de la variable <code>this</code>:</p>
</div>
<div class="paragraph">
<p>Invocación Indirecta - <a href="http://jsbin.com/necohu/1/edit?js" class="bare">http://jsbin.com/necohu/1/edit?js</a></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="javascript"><span class="tok-kd">var</span> <span class="tok-nx">heroe</span> <span class="tok-o">=</span> <span class="tok-p">{</span>
  <span class="tok-nx">nombre</span><span class="tok-o">:</span> <span class="tok-s2">&quot;Superheroe&quot;</span><span class="tok-p">,</span>
  <span class="tok-nx">saludar</span><span class="tok-o">:</span> <span class="tok-kd">function</span><span class="tok-p">()</span> <span class="tok-p">{</span>
    <span class="tok-k">return</span> <span class="tok-s2">&quot;Hola &quot;</span> <span class="tok-o">+</span> <span class="tok-k">this</span><span class="tok-p">.</span><span class="tok-nx">nombre</span><span class="tok-p">;</span>
  <span class="tok-p">}</span>
<span class="tok-p">};</span>

<span class="tok-kd">var</span> <span class="tok-nx">batman</span> <span class="tok-o">=</span> <span class="tok-p">{</span> <span class="tok-nx">nombre</span><span class="tok-o">:</span> <span class="tok-s2">&quot;Batman&quot;</span> <span class="tok-p">};</span>
<span class="tok-kd">var</span> <span class="tok-nx">spiderman</span> <span class="tok-o">=</span> <span class="tok-p">{</span> <span class="tok-nx">nombre</span><span class="tok-o">:</span> <span class="tok-s2">&quot;Spiderman&quot;</span> <span class="tok-p">};</span>

<span class="tok-nx">console</span><span class="tok-p">.</span><span class="tok-nx">log</span><span class="tok-p">(</span><span class="tok-nx">heroe</span><span class="tok-p">.</span><span class="tok-nx">saludar</span><span class="tok-p">());</span> <span class="tok-c1">// Hola Superheroe</span>
<span class="tok-nx">console</span><span class="tok-p">.</span><span class="tok-nx">log</span><span class="tok-p">(</span><span class="tok-nx">heroe</span><span class="tok-p">.</span><span class="tok-nx">saludar</span><span class="tok-p">.</span><span class="tok-nx">apply</span><span class="tok-p">(</span><span class="tok-nx">batman</span><span class="tok-p">));</span> <span class="tok-c1">// Hola Batman</span>
<span class="tok-nx">console</span><span class="tok-p">.</span><span class="tok-nx">log</span><span class="tok-p">(</span><span class="tok-nx">heroe</span><span class="tok-p">.</span><span class="tok-nx">saludar</span><span class="tok-p">.</span><span class="tok-nx">call</span><span class="tok-p">(</span><span class="tok-nx">spiderman</span><span class="tok-p">));</span> <span class="tok-c1">// Hola Spiderman</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Los métodos <code>apply</code> y <code>call</code> son similares, con la diferencia de que mientras <code>apply</code> además admite un segundo parámetro con un array de argumentos que pasar a la función invocada, <code>call</code> admite un número ilimitado de parámetros que se pasarán a la función.</p>
</div>
<div class="listingblock">
<div class="title">call() vs apply() - <a href="http://jsbin.com/sulamu/1/edit?js" class="bare">http://jsbin.com/sulamu/1/edit?js</a></div>
<div class="content">
<pre class="pygments highlight"><code data-lang="javascript"><span class="tok-kd">var</span> <span class="tok-nx">heroe</span> <span class="tok-o">=</span> <span class="tok-p">{</span>
  <span class="tok-nx">nombre</span><span class="tok-o">:</span> <span class="tok-s2">&quot;Superheroe&quot;</span><span class="tok-p">,</span>
  <span class="tok-nx">saludar</span><span class="tok-o">:</span> <span class="tok-kd">function</span><span class="tok-p">()</span> <span class="tok-p">{</span>
    <span class="tok-k">return</span> <span class="tok-s2">&quot;Hola &quot;</span> <span class="tok-o">+</span> <span class="tok-k">this</span><span class="tok-p">.</span><span class="tok-nx">nombre</span><span class="tok-p">;</span>
  <span class="tok-p">},</span>
  <span class="tok-nx">despedirse</span><span class="tok-o">:</span> <span class="tok-kd">function</span><span class="tok-p">(</span><span class="tok-nx">enemigo1</span><span class="tok-p">,</span> <span class="tok-nx">enemigo2</span><span class="tok-p">)</span> <span class="tok-p">{</span>
    <span class="tok-kd">var</span> <span class="tok-nx">malos</span> <span class="tok-o">=</span> <span class="tok-nx">enemigo2</span> <span class="tok-o">?</span> <span class="tok-p">(</span><span class="tok-nx">enemigo1</span> <span class="tok-o">+</span> <span class="tok-s2">&quot; y &quot;</span> <span class="tok-o">+</span> <span class="tok-nx">enemigo2</span><span class="tok-p">)</span> <span class="tok-o">:</span> <span class="tok-nx">enemigo1</span><span class="tok-p">;</span>
    <span class="tok-k">return</span> <span class="tok-s2">&quot;Adios &quot;</span> <span class="tok-o">+</span> <span class="tok-nx">malos</span> <span class="tok-o">+</span> <span class="tok-s2">&quot;, firmado:&quot;</span> <span class="tok-o">+</span> <span class="tok-k">this</span><span class="tok-p">.</span><span class="tok-nx">nombre</span><span class="tok-p">;</span>
  <span class="tok-p">}</span>
<span class="tok-p">};</span>

<span class="tok-kd">var</span> <span class="tok-nx">batman</span> <span class="tok-o">=</span> <span class="tok-p">{</span> <span class="tok-nx">nombre</span><span class="tok-o">:</span> <span class="tok-s2">&quot;Batman&quot;</span> <span class="tok-p">};</span>
<span class="tok-kd">var</span> <span class="tok-nx">spiderman</span> <span class="tok-o">=</span> <span class="tok-p">{</span> <span class="tok-nx">nombre</span><span class="tok-o">:</span> <span class="tok-s2">&quot;Spiderman&quot;</span> <span class="tok-p">};</span>

<span class="tok-nx">console</span><span class="tok-p">.</span><span class="tok-nx">log</span><span class="tok-p">(</span><span class="tok-nx">heroe</span><span class="tok-p">.</span><span class="tok-nx">despedirse</span><span class="tok-p">());</span> <span class="tok-c1">// Adios undefined, firmado:Superheroe</span>
<span class="tok-nx">console</span><span class="tok-p">.</span><span class="tok-nx">log</span><span class="tok-p">(</span><span class="tok-nx">heroe</span><span class="tok-p">.</span><span class="tok-nx">despedirse</span><span class="tok-p">.</span><span class="tok-nx">apply</span><span class="tok-p">(</span><span class="tok-nx">batman</span><span class="tok-p">,</span> <span class="tok-p">[</span><span class="tok-s2">&quot;Joker&quot;</span><span class="tok-p">,</span> <span class="tok-s2">&quot;Dos caras&quot;</span><span class="tok-p">]));</span> <span class="tok-c1">// Adios Joker y Dos caras, firmado:Batman</span>
<span class="tok-nx">console</span><span class="tok-p">.</span><span class="tok-nx">log</span><span class="tok-p">(</span><span class="tok-nx">heroe</span><span class="tok-p">.</span><span class="tok-nx">despedirse</span><span class="tok-p">.</span><span class="tok-nx">call</span><span class="tok-p">(</span><span class="tok-nx">spiderman</span><span class="tok-p">,</span> <span class="tok-s2">&quot;Duende Verde&quot;</span><span class="tok-p">,</span> <span class="tok-s2">&quot;Dr Octopus&quot;</span><span class="tok-p">));</span> <span class="tok-c1">// Adios Duende Verde y Dr Octopus, firmado:Spiderman</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Una tercera aproximación es usar <code>bind</code>, que funciona de manera similar a las anteriores, pero en vez de realizar la llamada a la función, devuelve una función con el contexto modificado.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="javascript"><span class="tok-kd">var</span> <span class="tok-nx">funcionConBatman</span> <span class="tok-o">=</span> <span class="tok-nx">heroe</span><span class="tok-p">.</span><span class="tok-nx">despedirse</span><span class="tok-p">.</span><span class="tok-nx">bind</span><span class="tok-p">(</span><span class="tok-nx">batman</span><span class="tok-p">);</span>
<span class="tok-nx">console</span><span class="tok-p">.</span><span class="tok-nx">log</span><span class="tok-p">(</span><span class="tok-nx">funcionConBatman</span><span class="tok-p">(</span><span class="tok-s2">&quot;Pingüino&quot;</span><span class="tok-p">));</span> <span class="tok-c1">// Adios Pingüino, firmado:Batman</span>
<span class="tok-nx">console</span><span class="tok-p">.</span><span class="tok-nx">log</span><span class="tok-p">(</span><span class="tok-nx">funcionConBatman</span><span class="tok-p">(</span><span class="tok-s2">&quot;Mr Frio&quot;</span><span class="tok-p">));</span> <span class="tok-c1">// Adios Mr Frio, firmado:Batman</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Antes de enamorarse de <code>bind</code>, conviene destacar que forma parte de <em>ECMAScript 5</em>, por lo que los navegadores antiguos no lo soportan.
Se emplea sobre todo cuando usamos un <em>callback</em> y en vez de guardar una referencia a <code>this</code> en una variable auxiliar (normalmente nombrada como <code>that</code>), hacemos uso de <code>bind</code> para pasarle <code>this</code> al <em>callback</em>.</p>
</div>
<div class="paragraph">
<p>Por ejemplo, cuando se trabaja con AJAX suele suceder esto:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="javascript"><span class="tok-kd">var</span> <span class="tok-nx">that</span> <span class="tok-o">=</span> <span class="tok-k">this</span><span class="tok-p">;</span>
<span class="tok-kd">function</span> <span class="tok-nx">callback</span><span class="tok-p">(</span><span class="tok-nx">datos</span><span class="tok-p">){</span>
  <span class="tok-nx">that</span><span class="tok-p">.</span><span class="tok-nx">procesar</span><span class="tok-p">(</span><span class="tok-nx">datos</span><span class="tok-p">);</span>
<span class="tok-p">}</span>
<span class="tok-nx">ajax</span><span class="tok-p">(</span><span class="tok-nx">callback</span><span class="tok-p">);</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Ahora con <code>bind</code> nos quedaría asi:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="javascript"><span class="tok-kd">function</span> <span class="tok-nx">callback</span><span class="tok-p">(</span><span class="tok-nx">datos</span><span class="tok-p">){</span>
  <span class="tok-k">this</span><span class="tok-p">.</span><span class="tok-nx">procesar</span><span class="tok-p">(</span><span class="tok-nx">datos</span><span class="tok-p">);</span>
<span class="tok-p">}</span>
<span class="tok-nx">ajax</span><span class="tok-p">(</span><span class="tok-nx">callback</span><span class="tok-p">.</span><span class="tok-nx">bind</span><span class="tok-p">(</span><span class="tok-k">this</span><span class="tok-p">));</span></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_descriptores_de_propiedades">2.5. Descriptores de propiedades</h3>
<div class="paragraph">
<p>Al definir las propiedades mediante un objeto literal, estas se pueden tanto leer como escribir, ya sea mediante la notación <code>.</code> o <code>[]</code>.</p>
</div>
<div class="paragraph">
<p>Si queremos que nuestro objeto contenga propiedades privadas, sólo hay que declararlas como variables dentro del objeto:</p>
</div>
<div class="listingblock">
<div class="title">Ejemplo propiedad privada</div>
<div class="content">
<pre class="pygments highlight"><code data-lang="javascript"><span class="tok-kd">function</span> <span class="tok-nx">Persona</span><span class="tok-p">(</span><span class="tok-nx">nombre</span><span class="tok-p">,</span> <span class="tok-nx">apellido1</span><span class="tok-p">)</span> <span class="tok-p">{</span>
  <span class="tok-kd">var</span> <span class="tok-nx">tipo</span> <span class="tok-o">=</span> <span class="tok-s2">&quot;Heroe&quot;</span><span class="tok-p">;</span>
  <span class="tok-k">this</span><span class="tok-p">.</span><span class="tok-nx">nombre</span> <span class="tok-o">=</span> <span class="tok-nx">nombre</span><span class="tok-p">;</span>
  <span class="tok-k">this</span><span class="tok-p">.</span><span class="tok-nx">apellido1</span> <span class="tok-o">=</span> <span class="tok-nx">apellido1</span><span class="tok-p">;</span>
<span class="tok-p">}</span>

<span class="tok-kd">var</span> <span class="tok-nx">batman</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-nx">Persona</span><span class="tok-p">(</span><span class="tok-s2">&quot;Bruce&quot;</span><span class="tok-p">,</span> <span class="tok-s2">&quot;Wayne&quot;</span><span class="tok-p">);</span>
<span class="tok-nx">console</span><span class="tok-p">.</span><span class="tok-nx">log</span><span class="tok-p">(</span><span class="tok-nx">batman</span><span class="tok-p">.</span><span class="tok-nx">nombre</span><span class="tok-p">);</span> <span class="tok-c1">// Bruce</span>
<span class="tok-nx">console</span><span class="tok-p">.</span><span class="tok-nx">log</span><span class="tok-p">(</span><span class="tok-nx">batman</span><span class="tok-p">.</span><span class="tok-nx">tipo</span><span class="tok-p">);</span> <span class="tok-c1">// undefined</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Si lo que necesitamos es restringir el estado de las propiedades, a partir de ECMAScript 5, podemos usar:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>un <strong>descriptor de datos</strong> para las propiedades que tienen un valor, el cual puede ser de sólo lectura, mediante <code>Object.defineProperties</code></p>
</li>
<li>
<p>o haciendo uso de los <strong>descriptores de acceso</strong> que definen dos funciones, para los métodos <code>get</code> y <code>set</code>.</p>
</li>
</ul>
</div>
<div class="sect3">
<h4 id="_definiendo_propiedades">2.5.1. Definiendo propiedades</h4>
<div class="paragraph">
<p>Vamos a recuperar el ejemplo de la función factoría que creaba una persona:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="javascript"><span class="tok-kd">function</span> <span class="tok-nx">creaPersona</span><span class="tok-p">(</span><span class="tok-nx">nom</span><span class="tok-p">,</span> <span class="tok-nx">ape1</span><span class="tok-p">)</span> <span class="tok-p">{</span>
  <span class="tok-k">return</span> <span class="tok-p">{</span>
    <span class="tok-nx">nombre</span> <span class="tok-o">:</span> <span class="tok-nx">nom</span><span class="tok-p">,</span>
    <span class="tok-nx">apellido1</span> <span class="tok-o">:</span> <span class="tok-nx">ape1</span><span class="tok-p">,</span>
    <span class="tok-nx">getNombreCompleto</span> <span class="tok-o">:</span> <span class="tok-kd">function</span><span class="tok-p">()</span> <span class="tok-p">{</span>
      <span class="tok-k">return</span> <span class="tok-k">this</span><span class="tok-p">.</span><span class="tok-nx">nombre</span> <span class="tok-o">+</span> <span class="tok-s2">&quot; &quot;</span> <span class="tok-o">+</span> <span class="tok-k">this</span><span class="tok-p">.</span><span class="tok-nx">apellido1</span><span class="tok-p">;</span>
    <span class="tok-p">}</span>
  <span class="tok-p">};</span>
<span class="tok-p">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Para definir las propiedades, haremos uso de <code>Object.defineProperty()</code> rellenando las propiedades <code>value</code> con la variable de la cual tomará el valor, y <code>writable</code> con un <em>booleano</em> que indica si se puede modificar (si no la rellenamos, por defecto se considera que el atributo es de sólo lectura, es decir, <code>false</code>)</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="javascript"><span class="tok-kd">function</span> <span class="tok-nx">creaPersona</span><span class="tok-p">(</span><span class="tok-nx">nom</span><span class="tok-p">,</span> <span class="tok-nx">ape1</span><span class="tok-p">)</span> <span class="tok-p">{</span>
  <span class="tok-kd">var</span> <span class="tok-nx">persona</span> <span class="tok-o">=</span> <span class="tok-p">{};</span>

  <span class="tok-nb">Object</span><span class="tok-p">.</span><span class="tok-nx">defineProperty</span><span class="tok-p">(</span><span class="tok-nx">persona</span><span class="tok-p">,</span> <span class="tok-s2">&quot;nombre&quot;</span><span class="tok-p">,</span> <span class="tok-p">{</span>
    <span class="tok-nx">value</span><span class="tok-o">:</span> <span class="tok-nx">nom</span><span class="tok-p">,</span>
    <span class="tok-nx">writable</span><span class="tok-o">:</span> <span class="tok-kc">true</span>
  <span class="tok-p">});</span>

  <span class="tok-nb">Object</span><span class="tok-p">.</span><span class="tok-nx">defineProperty</span><span class="tok-p">(</span><span class="tok-nx">persona</span><span class="tok-p">,</span> <span class="tok-s2">&quot;apellido1&quot;</span><span class="tok-p">,</span> <span class="tok-p">{</span>
    <span class="tok-nx">value</span><span class="tok-o">:</span> <span class="tok-nx">ape1</span><span class="tok-p">,</span>
    <span class="tok-nx">writable</span><span class="tok-o">:</span> <span class="tok-kc">false</span>
  <span class="tok-p">});</span>

  <span class="tok-k">return</span> <span class="tok-nx">persona</span><span class="tok-p">;</span>
<span class="tok-p">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>De este modo, podemos crear personas, en las cuales podremos modificar el nombre pero no el apellido:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="javascript"><span class="tok-kd">var</span> <span class="tok-nx">batman</span> <span class="tok-o">=</span> <span class="tok-nx">creaPersona</span><span class="tok-p">(</span><span class="tok-s2">&quot;Bruce&quot;</span><span class="tok-p">,</span> <span class="tok-s2">&quot;Wayne&quot;</span><span class="tok-p">);</span>
<span class="tok-nx">console</span><span class="tok-p">.</span><span class="tok-nx">log</span><span class="tok-p">(</span><span class="tok-nx">batman</span><span class="tok-p">.</span><span class="tok-nx">nombre</span><span class="tok-p">,</span> <span class="tok-nx">batman</span><span class="tok-p">.</span><span class="tok-nx">apellido1</span><span class="tok-p">);</span>
<span class="tok-nx">batman</span><span class="tok-p">.</span><span class="tok-nx">nombre</span> <span class="tok-o">=</span> <span class="tok-s2">&quot;Bruno&quot;</span><span class="tok-p">;</span>
<span class="tok-nx">batman</span><span class="tok-p">.</span><span class="tok-nx">apellido1</span> <span class="tok-o">=</span> <span class="tok-s2">&quot;Díaz&quot;</span><span class="tok-p">;</span>  <span class="tok-c1">// No se lanza ningún error, pero no modifica</span>
<span class="tok-nx">console</span><span class="tok-p">.</span><span class="tok-nx">log</span><span class="tok-p">(</span><span class="tok-nx">batman</span><span class="tok-p">.</span><span class="tok-nx">nombre</span><span class="tok-p">,</span> <span class="tok-nx">batman</span><span class="tok-p">.</span><span class="tok-nx">apellido1</span><span class="tok-p">);</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>En vez de tener que crear una instrucción <code>Object.defineProperty()</code> por propiedad, podemos agrupar y usar <code>Object.defineProperties()</code> y simplificar el código:</p>
</div>
<div class="listingblock">
<div class="title">Descriptor de propiedades - <a href="http://jsbin.com/loqofe/1/edit?js" class="bare">http://jsbin.com/loqofe/1/edit?js</a></div>
<div class="content">
<pre class="pygments highlight"><code data-lang="javascript"><span class="tok-kd">function</span> <span class="tok-nx">creaPersona</span><span class="tok-p">(</span><span class="tok-nx">nom</span><span class="tok-p">,</span> <span class="tok-nx">ape1</span><span class="tok-p">)</span> <span class="tok-p">{</span>
  <span class="tok-kd">var</span> <span class="tok-nx">persona</span> <span class="tok-o">=</span> <span class="tok-p">{};</span>

  <span class="tok-nb">Object</span><span class="tok-p">.</span><span class="tok-nx">defineProperties</span><span class="tok-p">(</span><span class="tok-nx">persona</span><span class="tok-p">,</span> <span class="tok-p">{</span>
    <span class="tok-nx">nombre</span><span class="tok-o">:</span> <span class="tok-p">{</span>
      <span class="tok-nx">value</span><span class="tok-o">:</span> <span class="tok-nx">nom</span><span class="tok-p">,</span>
      <span class="tok-nx">writable</span><span class="tok-o">:</span> <span class="tok-kc">true</span>
    <span class="tok-p">},</span>
    <span class="tok-nx">apellido1</span><span class="tok-o">:</span> <span class="tok-p">{</span>
      <span class="tok-nx">value</span><span class="tok-o">:</span> <span class="tok-nx">ape1</span><span class="tok-p">,</span>
      <span class="tok-nx">writable</span><span class="tok-o">:</span> <span class="tok-kc">false</span>
    <span class="tok-p">}</span>
  <span class="tok-p">});</span>

  <span class="tok-k">return</span> <span class="tok-nx">persona</span><span class="tok-p">;</span>
<span class="tok-p">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Si en vez de utilizar una función factoría, queremos hacerlo mediante una función constructor, el funcionamiento es el mismo, sólo que el objeto que le pasaremos a <code>Object.defineProperty()</code> será <code>this</code>:</p>
</div>
<div class="listingblock">
<div class="title">Descriptor de propiedades con función constructor - <a href="https://jsbin.com/mipohe/edit?js,console" class="bare">https://jsbin.com/mipohe/edit?js,console</a></div>
<div class="content">
<pre class="pygments highlight"><code data-lang="javascript"><span class="tok-kd">function</span> <span class="tok-nx">Persona</span><span class="tok-p">(</span><span class="tok-nx">nom</span><span class="tok-p">,</span> <span class="tok-nx">ape1</span><span class="tok-p">)</span> <span class="tok-p">{</span>
  <span class="tok-k">this</span><span class="tok-p">.</span><span class="tok-nx">nombre</span> <span class="tok-o">=</span> <span class="tok-nx">nom</span><span class="tok-p">;</span>

  <span class="tok-nb">Object</span><span class="tok-p">.</span><span class="tok-nx">defineProperties</span><span class="tok-p">(</span><span class="tok-k">this</span><span class="tok-p">,</span> <span class="tok-p">{</span>
    <span class="tok-nx">apellido1</span><span class="tok-o">:</span> <span class="tok-p">{</span>
      <span class="tok-nx">value</span><span class="tok-o">:</span> <span class="tok-nx">ape1</span><span class="tok-p">,</span>
      <span class="tok-nx">writable</span><span class="tok-o">:</span> <span class="tok-kc">false</span>
    <span class="tok-p">}</span>
  <span class="tok-p">});</span>
<span class="tok-p">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Finalmente, si en algún momento queremos consultar un descriptor de una propiedad haremos uso de <code>Object.getOwnPropertyDescriptor(objeto, propiedad)</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="javascript"><span class="tok-kd">var</span> <span class="tok-nx">batman</span> <span class="tok-o">=</span> <span class="tok-nx">creaPersona</span><span class="tok-p">(</span><span class="tok-s2">&quot;Bruce&quot;</span><span class="tok-p">,</span> <span class="tok-s2">&quot;Wayne&quot;</span><span class="tok-p">);</span>
<span class="tok-nx">console</span><span class="tok-p">.</span><span class="tok-nx">log</span><span class="tok-p">(</span><span class="tok-nb">Object</span><span class="tok-p">.</span><span class="tok-nx">getOwnPropertyDescriptor</span><span class="tok-p">(</span><span class="tok-nx">batman</span><span class="tok-p">,</span> <span class="tok-s2">&quot;nombre&quot;</span><span class="tok-p">));</span>
<span class="tok-c1">//  [object Object] {</span>
<span class="tok-c1">//    configurable: false,</span>
<span class="tok-c1">//    enumerable: false,</span>
<span class="tok-c1">//    value: &quot;Bruce&quot;,</span>
<span class="tok-c1">//    writable: true</span>
<span class="tok-c1">//  }</span></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="__em_get_em_y_em_set_em">2.5.2. <em>Get</em> y <em>Set</em></h4>
<div class="paragraph">
<p>Los descriptores de acceso sustituyen a los métodos que modifican las propiedades. Para ello, vamos a crear una propiedad <code>nombreCompleto</code> con sus respectivos métodos de acceso y modificación:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="javascript"><span class="tok-kd">function</span> <span class="tok-nx">creaPersona</span><span class="tok-p">(</span><span class="tok-nx">nom</span><span class="tok-p">,</span> <span class="tok-nx">ape1</span><span class="tok-p">)</span> <span class="tok-p">{</span>
  <span class="tok-kd">var</span> <span class="tok-nx">persona</span> <span class="tok-o">=</span> <span class="tok-p">{};</span>

  <span class="tok-nb">Object</span><span class="tok-p">.</span><span class="tok-nx">defineProperties</span><span class="tok-p">(</span><span class="tok-nx">persona</span><span class="tok-p">,</span> <span class="tok-p">{</span>
    <span class="tok-nx">nombre</span><span class="tok-o">:</span> <span class="tok-p">{</span>
      <span class="tok-nx">value</span><span class="tok-o">:</span> <span class="tok-nx">nom</span><span class="tok-p">,</span>
      <span class="tok-nx">writable</span><span class="tok-o">:</span> <span class="tok-kc">true</span>
    <span class="tok-p">},</span>
    <span class="tok-nx">apellido1</span><span class="tok-o">:</span> <span class="tok-p">{</span>
      <span class="tok-nx">value</span><span class="tok-o">:</span> <span class="tok-nx">ape1</span><span class="tok-p">,</span>
      <span class="tok-nx">writable</span><span class="tok-o">:</span> <span class="tok-kc">false</span>
    <span class="tok-p">},</span>
    <span class="tok-nx">nombreCompleto</span><span class="tok-o">:</span> <span class="tok-p">{</span>
      <span class="tok-nx">get</span><span class="tok-o">:</span> <span class="tok-kd">function</span><span class="tok-p">()</span> <span class="tok-p">{</span> <i class="conum" data-value="1"></i><b>(1)</b>
        <span class="tok-k">return</span> <span class="tok-k">this</span><span class="tok-p">.</span><span class="tok-nx">nombre</span> <span class="tok-o">+</span> <span class="tok-s2">&quot; &quot;</span> <span class="tok-o">+</span> <span class="tok-k">this</span><span class="tok-p">.</span><span class="tok-nx">apellido1</span><span class="tok-p">;</span>
      <span class="tok-p">},</span>
      <span class="tok-nx">set</span><span class="tok-o">:</span> <span class="tok-kd">function</span><span class="tok-p">(</span><span class="tok-nx">valor</span><span class="tok-p">)</span> <span class="tok-p">{</span>  <i class="conum" data-value="2"></i><b>(2)</b>
        <span class="tok-k">this</span><span class="tok-p">.</span><span class="tok-nx">nombre</span> <span class="tok-o">=</span> <span class="tok-nx">valor</span><span class="tok-p">;</span>
        <span class="tok-k">this</span><span class="tok-p">.</span><span class="tok-nx">apellido1</span> <span class="tok-o">=</span> <span class="tok-nx">valor</span><span class="tok-p">;</span>
      <span class="tok-p">}</span>
    <span class="tok-p">}</span>
  <span class="tok-p">});</span>

  <span class="tok-k">return</span> <span class="tok-nx">persona</span><span class="tok-p">;</span>
<span class="tok-p">}</span></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Método de acceso</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Método de modificación. Destacar que como hemos definido la propiedad 'apellido1' como de sólo lectura, no va a cambiar su valor</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>De este modo podemos obtener la propiedad del descriptor de acceso como propiedad en vez de como método:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="javascript"><span class="tok-kd">var</span> <span class="tok-nx">batman</span> <span class="tok-o">=</span> <span class="tok-nx">creaPersona</span><span class="tok-p">(</span><span class="tok-s2">&quot;Bruce&quot;</span><span class="tok-p">,</span> <span class="tok-s2">&quot;Wayne&quot;</span><span class="tok-p">);</span>
<span class="tok-nx">console</span><span class="tok-p">.</span><span class="tok-nx">log</span><span class="tok-p">(</span><span class="tok-nx">batman</span><span class="tok-p">.</span><span class="tok-nx">nombreCompleto</span><span class="tok-p">);</span> <span class="tok-c1">// Bruce Wayne</span>
<span class="tok-nx">batman</span><span class="tok-p">.</span><span class="tok-nx">nombreCompleto</span> <span class="tok-o">=</span> <span class="tok-s2">&quot;Bruno Díaz&quot;</span><span class="tok-p">;</span>
<span class="tok-nx">console</span><span class="tok-p">.</span><span class="tok-nx">log</span><span class="tok-p">(</span><span class="tok-nx">batman</span><span class="tok-p">.</span><span class="tok-nx">nombreCompleto</span><span class="tok-p">);</span> <span class="tok-c1">// Bruno Díaz Wayne</span></code></pre>
</div>
</div>
<div class="imageblock">
<div class="content">
<img src="images/js02/batmanProperties.jpg" alt="Propiedades del objeto Persona" width="66%">
</div>
<div class="title">Figure 6. Objeto con propiedades</div>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
Una propiedad no puede contener al mismo tiempo el atributo <code>value</code> y  <code>get</code> o <code>set</code>, es decir no puede ser descriptor de datos y de acceso al mismo tiempo.
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_iterando_sobre_las_propiedades">2.5.3. Iterando sobre las propiedades</h4>
<div class="paragraph">
<p>Si necesitamos acceder a todas las propiedades que contiene un objeto, podemos recorrerlas como si fueran una enumeración mediante un bucle <code>for in</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="javascript"><span class="tok-k">for</span> <span class="tok-p">(</span><span class="tok-kd">var</span> <span class="tok-nx">prop</span> <span class="tok-k">in</span> <span class="tok-nx">batman</span><span class="tok-p">)</span> <span class="tok-p">{</span>
  <span class="tok-nx">console</span><span class="tok-p">.</span><span class="tok-nx">log</span><span class="tok-p">(</span><span class="tok-nx">batman</span><span class="tok-p">[</span><span class="tok-nx">prop</span><span class="tok-p">]);</span>
<span class="tok-p">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>O hacer uso del método <code>Object.keys(<em>objeto</em>)</code>, el cual nos devuelve las propiedades del objeto en forma de array:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="javascript"><span class="tok-kd">var</span> <span class="tok-nx">propiedades</span> <span class="tok-o">=</span> <span class="tok-nb">Object</span><span class="tok-p">.</span><span class="tok-nx">keys</span><span class="tok-p">(</span><span class="tok-nx">batman</span><span class="tok-p">);</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Por defecto las propiedades definidas mediante descriptores no se visualizan al recorrerlas. Para poder visualizarlas, tenemos que configurar la propiedad <code>enumerable</code> para cada propiedad que queramos obtener:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="javascript"><span class="tok-kd">function</span> <span class="tok-nx">creaPersona</span><span class="tok-p">(</span><span class="tok-nx">nom</span><span class="tok-p">,</span> <span class="tok-nx">ape1</span><span class="tok-p">)</span> <span class="tok-p">{</span>
  <span class="tok-kd">var</span> <span class="tok-nx">persona</span> <span class="tok-o">=</span> <span class="tok-p">{};</span>

  <span class="tok-nb">Object</span><span class="tok-p">.</span><span class="tok-nx">defineProperties</span><span class="tok-p">(</span><span class="tok-nx">persona</span><span class="tok-p">,</span> <span class="tok-p">{</span>
    <span class="tok-nx">nombre</span><span class="tok-o">:</span> <span class="tok-p">{</span>
      <span class="tok-nx">value</span><span class="tok-o">:</span> <span class="tok-nx">nom</span><span class="tok-p">,</span>
      <span class="tok-nx">enumerable</span><span class="tok-o">:</span> <span class="tok-kc">true</span>  <i class="conum" data-value="1"></i><b>(1)</b>
    <span class="tok-p">},</span>
    <span class="tok-nx">apellido1</span><span class="tok-o">:</span> <span class="tok-p">{</span>
      <span class="tok-nx">value</span><span class="tok-o">:</span> <span class="tok-nx">ape1</span><span class="tok-p">,</span>
      <span class="tok-nx">enumerable</span><span class="tok-o">:</span> <span class="tok-kc">true</span>
    <span class="tok-p">},</span>
    <span class="tok-nx">nombreCompleto</span><span class="tok-o">:</span> <span class="tok-p">{</span>
      <span class="tok-nx">get</span><span class="tok-o">:</span> <span class="tok-kd">function</span><span class="tok-p">()</span> <span class="tok-p">{</span>
        <span class="tok-k">return</span> <span class="tok-k">this</span><span class="tok-p">.</span><span class="tok-nx">nombre</span> <span class="tok-o">+</span> <span class="tok-s2">&quot; &quot;</span> <span class="tok-o">+</span> <span class="tok-k">this</span><span class="tok-p">.</span><span class="tok-nx">apellido1</span><span class="tok-p">;</span>
      <span class="tok-p">},</span>
      <span class="tok-nx">enumerable</span><span class="tok-o">:</span> <span class="tok-kc">false</span> <i class="conum" data-value="2"></i><b>(2)</b>
    <span class="tok-p">}</span>
  <span class="tok-p">});</span>

  <span class="tok-k">return</span> <span class="tok-nx">persona</span><span class="tok-p">;</span>
<span class="tok-p">}</span>

<span class="tok-kd">var</span> <span class="tok-nx">batman</span> <span class="tok-o">=</span> <span class="tok-nx">creaPersona</span><span class="tok-p">(</span><span class="tok-s2">&quot;Bruce&quot;</span><span class="tok-p">,</span> <span class="tok-s2">&quot;Wayne&quot;</span><span class="tok-p">);</span>
<span class="tok-nx">console</span><span class="tok-p">.</span><span class="tok-nx">log</span><span class="tok-p">(</span><span class="tok-nb">Object</span><span class="tok-p">.</span><span class="tok-nx">keys</span><span class="tok-p">(</span><span class="tok-nx">batman</span><span class="tok-p">));</span> <i class="conum" data-value="3"></i><b>(3)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Marcamos la propiedad como enumerable</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>La marcamos para que no aparezca</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Obtenemos un array con <code>["nombre", "apellido1"]</code></td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_modificando_una_propiedad">2.5.4. Modificando una propiedad</h4>
<div class="paragraph">
<p>Si por defecto intentamos redefinir una propiedad que ya existe, obtendremos un error. Para poder hacer esto, necesitamos configurar la propiedad <code>configurable</code> a <code>true</code>, ya que por defecto, si no la configuramos es <code>false</code>.</p>
</div>
<div class="paragraph">
<p>Así pues, si ahora queremos que la propiedad de <code>nombreCompleto</code> devuelva el apellido y luego el nombre separado por una coma, necesitaríamos lo siguiente:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="javascript"><span class="tok-kd">function</span> <span class="tok-nx">creaPersona</span><span class="tok-p">(</span><span class="tok-nx">nom</span><span class="tok-p">,</span> <span class="tok-nx">ape1</span><span class="tok-p">)</span> <span class="tok-p">{</span>
  <span class="tok-kd">var</span> <span class="tok-nx">persona</span> <span class="tok-o">=</span> <span class="tok-p">{};</span>

  <span class="tok-nb">Object</span><span class="tok-p">.</span><span class="tok-nx">defineProperties</span><span class="tok-p">(</span><span class="tok-nx">persona</span><span class="tok-p">,</span> <span class="tok-p">{</span>
    <span class="tok-nx">nombre</span><span class="tok-o">:</span> <span class="tok-p">{</span>
      <span class="tok-nx">value</span><span class="tok-o">:</span> <span class="tok-nx">nom</span><span class="tok-p">,</span>
    <span class="tok-p">},</span>
    <span class="tok-nx">apellido1</span><span class="tok-o">:</span> <span class="tok-p">{</span>
      <span class="tok-nx">value</span><span class="tok-o">:</span> <span class="tok-nx">ape1</span><span class="tok-p">,</span>
    <span class="tok-p">},</span>
    <span class="tok-nx">nombreCompleto</span><span class="tok-o">:</span> <span class="tok-p">{</span>
      <span class="tok-nx">get</span><span class="tok-o">:</span> <span class="tok-kd">function</span><span class="tok-p">()</span> <span class="tok-p">{</span>
        <span class="tok-k">return</span> <span class="tok-k">this</span><span class="tok-p">.</span><span class="tok-nx">nombre</span> <span class="tok-o">+</span> <span class="tok-s2">&quot; &quot;</span> <span class="tok-o">+</span> <span class="tok-k">this</span><span class="tok-p">.</span><span class="tok-nx">apellido1</span><span class="tok-p">;</span>
      <span class="tok-p">},</span>
      <span class="tok-nx">configurable</span><span class="tok-o">:</span> <span class="tok-kc">true</span>  <i class="conum" data-value="1"></i><b>(1)</b>
    <span class="tok-p">}</span>
  <span class="tok-p">});</span>

  <span class="tok-k">return</span> <span class="tok-nx">persona</span><span class="tok-p">;</span>
<span class="tok-p">}</span>

<span class="tok-nb">Object</span><span class="tok-p">.</span><span class="tok-nx">defineProperty</span><span class="tok-p">(</span><span class="tok-nx">persona</span><span class="tok-p">,</span> <span class="tok-s2">&quot;nombreCompleto&quot;</span><span class="tok-p">,</span> <span class="tok-p">{</span>  <i class="conum" data-value="2"></i><b>(2)</b>
  <span class="tok-nx">get</span><span class="tok-o">:</span> <span class="tok-kd">function</span><span class="tok-p">()</span> <span class="tok-p">{</span>
    <span class="tok-k">return</span> <span class="tok-k">this</span><span class="tok-p">.</span><span class="tok-nx">apellido1</span> <span class="tok-o">+</span> <span class="tok-s2">&quot;, &quot;</span> <span class="tok-o">+</span> <span class="tok-k">this</span><span class="tok-p">.</span><span class="tok-nx">nombre</span><span class="tok-p">;</span>
  <span class="tok-p">}</span>
<span class="tok-p">});</span></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Permitimos modificar la propiedad una vez definido el objeto</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Redefinimos la propiedad</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_prototipos">2.6. Prototipos</h3>
<div class="paragraph">
<p>Los prototipos son una forma adecuada de definir tipos de objetos que permiten definir propiedades y funcionalidades que se aplicarán a todas las instancias del objeto. Es decir, es un objeto que se usa como fuente secundaria de las propiedades. Así pues, cuando un objeto recibe un petición de una propiedad que no contiene, buscará la propiedad en su prototipo. Si no lo encuentra, en el prototipo del prototipo, y así sucesivamente.</p>
</div>
<div class="paragraph">
<p>A nivel de código, todos los objetos contienen una propiedad <code>prototype</code> que inicialmente referencia a un objeto vacío. Esta propiedad no sirve de mucho hasta que la función se usa como un constructor.</p>
</div>
<div class="paragraph">
<p>Por defecto todos los objetos tienen como prototipo raíz <code>Object.prototype</code>, el cual ofrece algunos métodos que comparten todos los métodos, como <code>toString</code>. Si queremos averiguar el prototipo de un objeto podemos usar la función <code>Object.getPrototypeOf(<em>objeto</em>)</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="javascript"><span class="tok-nx">console</span><span class="tok-p">.</span><span class="tok-nx">log</span><span class="tok-p">(</span><span class="tok-nb">Object</span><span class="tok-p">.</span><span class="tok-nx">getPrototypeOf</span><span class="tok-p">({})</span> <span class="tok-o">==</span> <span class="tok-nb">Object</span><span class="tok-p">.</span><span class="tok-nx">prototype</span><span class="tok-p">);</span> <span class="tok-c1">// true</span>
<span class="tok-nx">console</span><span class="tok-p">.</span><span class="tok-nx">log</span><span class="tok-p">(</span><span class="tok-nb">Object</span><span class="tok-p">.</span><span class="tok-nx">getPrototypeOf</span><span class="tok-p">(</span><span class="tok-nb">Object</span><span class="tok-p">.</span><span class="tok-nx">prototype</span><span class="tok-p">));</span> <span class="tok-c1">// null</span></code></pre>
</div>
</div>
<div class="sect3">
<h4 id="_constructores_y_code_prototype_code">2.6.1. Constructores y <code>prototype</code></h4>
<div class="paragraph">
<p>Al llamar a una función mediante la instrucción <code>new</code> provoca que se invoque como un constructor. El constructor asocia la variable <code>this</code> al objeto creado, y a menos que se indique, la llamada devolverá este objeto.</p>
</div>
<div class="paragraph">
<p>Este objeto se conoce como una instancia de su constructor. Todos los constructores (de hecho todas las funciones) automáticamente contienen la propiedad <code>prototype</code> que por defecto referencia a un objeto vacío que deriva de <code>Object.prototype</code>.</p>
</div>
<div class="paragraph">
<p>Cada instancia creada con este constructor tendrá este objeto como su prototipo. Con lo que para añadir nuevos métodos al constructor, hemos de añadirlos como propiedades del prototipo.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="javascript"><span class="tok-kd">var</span> <span class="tok-nx">Persona</span> <span class="tok-o">=</span> <span class="tok-kd">function</span><span class="tok-p">(</span><span class="tok-nx">nombre</span><span class="tok-p">,</span> <span class="tok-nx">apellido1</span><span class="tok-p">)</span> <span class="tok-p">{</span>
  <span class="tok-k">this</span><span class="tok-p">.</span><span class="tok-nx">nombre</span> <span class="tok-o">=</span> <span class="tok-nx">nombre</span><span class="tok-p">;</span>
  <span class="tok-k">this</span><span class="tok-p">.</span><span class="tok-nx">apellido1</span> <span class="tok-o">=</span> <span class="tok-nx">apellido1</span><span class="tok-p">;</span>
<span class="tok-p">}</span>

<span class="tok-nx">Persona</span><span class="tok-p">.</span><span class="tok-nx">prototype</span><span class="tok-p">.</span><span class="tok-nx">getNombreCompleto</span> <span class="tok-o">=</span> <span class="tok-kd">function</span><span class="tok-p">()</span> <span class="tok-p">{</span>
  <span class="tok-k">return</span> <span class="tok-k">this</span><span class="tok-p">.</span><span class="tok-nx">nombre</span> <span class="tok-o">+</span> <span class="tok-s2">&quot; &quot;</span> <span class="tok-o">+</span> <span class="tok-k">this</span><span class="tok-p">.</span><span class="tok-nx">apellido1</span><span class="tok-p">;</span>
<span class="tok-p">};</span>

<span class="tok-nx">Persona</span><span class="tok-p">.</span><span class="tok-nx">prototype</span><span class="tok-p">.</span><span class="tok-nx">saluda</span> <span class="tok-o">=</span> <span class="tok-kd">function</span><span class="tok-p">(</span><span class="tok-nx">persona</span><span class="tok-p">)</span> <span class="tok-p">{</span>
  <span class="tok-k">if</span> <span class="tok-p">(</span><span class="tok-nx">persona</span> <span class="tok-k">instanceof</span> <span class="tok-nx">Persona</span><span class="tok-p">)</span> <span class="tok-p">{</span>
    <span class="tok-k">return</span> <span class="tok-s2">&quot;Hola &quot;</span> <span class="tok-o">+</span> <span class="tok-nx">persona</span><span class="tok-p">.</span><span class="tok-nx">getNombreCompleto</span><span class="tok-p">();</span>
  <span class="tok-p">}</span> <span class="tok-k">else</span> <span class="tok-p">{</span>
    <span class="tok-k">return</span> <span class="tok-s2">&quot;Hola colega&quot;</span><span class="tok-p">;</span>
  <span class="tok-p">}</span>
<span class="tok-p">};</span>

<span class="tok-kd">var</span> <span class="tok-nx">persona</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-nx">Persona</span><span class="tok-p">(</span><span class="tok-s2">&quot;Aitor&quot;</span><span class="tok-p">,</span> <span class="tok-s2">&quot;Medrano&quot;</span><span class="tok-p">),</span>
  <span class="tok-nx">persona2</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-nx">Persona</span><span class="tok-p">(</span><span class="tok-s2">&quot;Domingo&quot;</span><span class="tok-p">,</span> <span class="tok-s2">&quot;Gallardo&quot;</span><span class="tok-p">);</span>
<span class="tok-nx">persona</span><span class="tok-p">.</span><span class="tok-nx">saluda</span><span class="tok-p">(</span><span class="tok-nx">persona2</span><span class="tok-p">);</span> <span class="tok-c1">// Hola Domingo Gallardo</span>
<span class="tok-nx">persona</span><span class="tok-p">.</span><span class="tok-nx">saluda</span><span class="tok-p">({});</span> <span class="tok-c1">// Hola colega</span>
<span class="tok-nx">persona</span><span class="tok-p">.</span><span class="tok-nx">saluda</span><span class="tok-p">({</span> <span class="tok-nx">getNombreCompleto</span><span class="tok-o">:</span> <span class="tok-s2">&quot;Bruce Wayne&quot;</span> <span class="tok-p">});</span> <span class="tok-c1">// Hola colega</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Una vez definido el prototipo de un objeto, las propiedades del prototipo se convierten en propiedades de los objetos instanciados. Su propósito es similar al uso de clases dentro de un lenguaje clásico orientado a objeto. De hecho, el uso de prototipos en <em>JavaScript</em> se plantea para poder compartir código de manera similar al paradigma orientado a objetos.</p>
</div>
<div class="paragraph">
<p>Ya hemos comentado que todo lo que colocamos en la propiedad <code>prototype</code> se comparte entre todas las instancias del objeto, por lo que las funciones que coloquemos dentro compartirán una única instancia entre todas ellas.</p>
</div>
<div class="paragraph">
<p>Si queremos compartir el prototipo entre diferentes objetos, podemos usar <code>Object.create</code> para crear un objeto con un prototipo específico, aunque es mejor usar una función constructor.</p>
</div>
</div>
<div class="sect3">
<h4 id="__code_prototype_code_y_code_proto_code">2.6.2. <code>prototype</code> y <code>__proto__</code></h4>
<div class="paragraph">
<p>Supongamos el siguiente objeto vacío:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="javascript"><span class="tok-kd">var</span> <span class="tok-nx">objeto</span> <span class="tok-o">=</span> <span class="tok-p">{};</span>
<span class="tok-nx">console</span><span class="tok-p">.</span><span class="tok-nx">dir</span><span class="tok-p">(</span><span class="tok-nx">objeto</span><span class="tok-p">);</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Si inspeccionamos la consola, podemos observar la propiedad <code>__proto__</code> con todas sus propiedades:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/js02/js02ObjetoVacio.png" alt="Propiedades de un objeto vacío" width="66%">
</div>
<div class="title">Figure 7. Propiedades de un Objeto</div>
</div>
<div class="paragraph">
<p>Así pues tenemos que todo objeto contiene una propiedad <code>__proto__</code> que incluye todas las propiedades que hereda nuestro objeto. Es algo así como el padre del objeto. Para recuperar este prototipo podemos usar el método <code>Object.getPrototypeOf()</code> o directamente navegar por la propiedad <code>__proto__</code>, es decir, son intercambiables.</p>
</div>
<div class="paragraph">
<p>Es importante destacar la diferencia entre el modo que un prototipo se asocia con un constructor (a través de la propiedad <code>prototype</code>) y el modo en que los objetos tienen un prototipo (el cual se puede obtener mediante <code>Object.getPrototypeOf</code>). El prototipo real de un constructor es <code>Function.prototype</code> ya que todos los constructores son funciones. Su propiedad <code>prototype</code> será el prototipo de las instancias creadas mediante su constructor, pero no su propio prototipo.</p>
</div>
<div class="paragraph">
<p>Los prototipos en <em>JavaScript</em> son especiales por lo siguiente: cuando le pedimos a JavaScript que queremos invocar el método <code>push</code> de un objeto, o leer la propiedad <code>x</code> de otro objeto, el motor primero buscará dentro de las propiedades del propio objeto. Si el motor JS no encuentra lo que nosotros queremos, seguirá la referencia <code>__proto__</code> y buscará el miembro en el prototipo del objeto.</p>
</div>
<div class="paragraph">
<p>Veamos un ejemplo mediante código:</p>
</div>
<div class="listingblock">
<div class="title">__proto__ vs prototype - <a href="http://jsbin.com/sicivi/1/edit?js" class="bare">http://jsbin.com/sicivi/1/edit?js</a></div>
<div class="content">
<pre class="pygments highlight"><code data-lang="javascript"><span class="tok-kd">function</span> <span class="tok-nx">Heroe</span><span class="tok-p">(){</span>
  <span class="tok-k">this</span><span class="tok-p">.</span><span class="tok-nx">malvado</span> <span class="tok-o">=</span> <span class="tok-kc">false</span><span class="tok-p">;</span>
  <span class="tok-k">this</span><span class="tok-p">.</span><span class="tok-nx">getTipo</span> <span class="tok-o">=</span> <span class="tok-kd">function</span><span class="tok-p">()</span> <span class="tok-p">{</span>
    <span class="tok-k">return</span> <span class="tok-k">this</span><span class="tok-p">.</span><span class="tok-nx">malvado</span> <span class="tok-o">?</span> <span class="tok-s2">&quot;Malo&quot;</span> <span class="tok-o">:</span> <span class="tok-s2">&quot;Bueno&quot;</span><span class="tok-p">;</span>
  <span class="tok-p">};</span>
<span class="tok-p">}</span>

<span class="tok-nx">Heroe</span><span class="tok-p">.</span><span class="tok-nx">prototype</span><span class="tok-p">.</span><span class="tok-nx">atacar</span> <span class="tok-o">=</span> <span class="tok-kd">function</span><span class="tok-p">()</span> <span class="tok-p">{</span>
  <span class="tok-k">return</span> <span class="tok-k">this</span><span class="tok-p">.</span><span class="tok-nx">malvado</span> <span class="tok-o">?</span> <span class="tok-s2">&quot;Ataque con Joker&quot;</span> <span class="tok-o">:</span> <span class="tok-s2">&quot;Ataque con Batman&quot;</span><span class="tok-p">;</span>
<span class="tok-p">}</span>

<span class="tok-kd">var</span> <span class="tok-nx">robin</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-nx">Heroe</span><span class="tok-p">();</span>
<span class="tok-nx">console</span><span class="tok-p">.</span><span class="tok-nx">log</span><span class="tok-p">(</span><span class="tok-nx">robin</span><span class="tok-p">.</span><span class="tok-nx">getTipo</span><span class="tok-p">());</span>   <span class="tok-c1">// Bueno</span>
<span class="tok-nx">console</span><span class="tok-p">.</span><span class="tok-nx">log</span><span class="tok-p">(</span><span class="tok-nx">robin</span><span class="tok-p">.</span><span class="tok-nx">atacar</span><span class="tok-p">());</span>     <span class="tok-c1">// Ataque con Batman</span>

<span class="tok-kd">var</span> <span class="tok-nx">lexLuthor</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-nx">Heroe</span><span class="tok-p">();</span>
<span class="tok-nx">lexLuthor</span><span class="tok-p">.</span><span class="tok-nx">malvado</span> <span class="tok-o">=</span> <span class="tok-kc">true</span><span class="tok-p">;</span>
<span class="tok-nx">console</span><span class="tok-p">.</span><span class="tok-nx">log</span><span class="tok-p">(</span><span class="tok-nx">lexLuthor</span><span class="tok-p">.</span><span class="tok-nx">getTipo</span><span class="tok-p">());</span>   <span class="tok-c1">// Malo</span>
<span class="tok-nx">console</span><span class="tok-p">.</span><span class="tok-nx">log</span><span class="tok-p">(</span><span class="tok-nx">lexLuthor</span><span class="tok-p">.</span><span class="tok-nx">atacar</span><span class="tok-p">());</span>     <span class="tok-c1">// Ataque con Joker</span>

<span class="tok-kd">var</span> <span class="tok-nx">policia</span> <span class="tok-o">=</span> <span class="tok-nb">Object</span><span class="tok-p">.</span><span class="tok-nx">create</span><span class="tok-p">(</span><span class="tok-nx">robin</span><span class="tok-p">);</span>
<span class="tok-nx">console</span><span class="tok-p">.</span><span class="tok-nx">log</span><span class="tok-p">(</span><span class="tok-nx">policia</span><span class="tok-p">.</span><span class="tok-nx">getTipo</span><span class="tok-p">());</span>     <span class="tok-c1">// Bueno</span>
<span class="tok-nx">console</span><span class="tok-p">.</span><span class="tok-nx">log</span><span class="tok-p">(</span><span class="tok-nx">policia</span><span class="tok-p">.</span><span class="tok-nx">__proto__</span><span class="tok-p">.</span><span class="tok-nx">atacar</span><span class="tok-p">());</span>    <span class="tok-c1">// Ataque con Batman</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Ya hemos visto que cada objeto en <em>JavaScript</em> tiene una propiedad <code>prototype</code>. No hay que confundir esta propiedad <code>prototype</code> con la propiedad <code>__proto__</code>, ya que ni tienen el mismo propósito ni apuntan al mismo objeto:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>Array.__proto__</code> nos da el prototipo de <code>Array</code>, es decir, el objeto del que hereda la función <code>Array</code>.</p>
</li>
<li>
<p><code>Array.prototype</code>, en cambio, es el objeto prototipo de todos los <em>arrays</em>, que contiene los métodos que heredarán todos los arrays.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Para finalizar, relacionado con estos conceptos tenemos la instrucción <code>new</code> en JavaScript, la cual realiza tres pasos:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Primero crea un objeto vacío.</p>
</li>
<li>
<p>A continuación, asigna la propiedad <code>__proto__</code> del nuevo objeto a la propiedad <code>prototype</code> de la función invocada</p>
</li>
<li>
<p>Finalmente, el operador invoca la función y pasa el nuevo objeto como la referencia <code>this</code>.</p>
</li>
</ol>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
Un artículo muy gráfico que explica la diferencia entre estas dos propiedades es <em>Prototypes and Inheritance in JavaScript</em> de <em>Scott Allen</em> : <a href="http://msdn.microsoft.com/en-us/magazine/ff852808.aspx" class="bare">http://msdn.microsoft.com/en-us/magazine/ff852808.aspx</a>
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_herencia">2.7. Herencia</h3>
<div class="paragraph">
<p><em>JavaScript</em> es un lenguaje de herencia prototipada, lo que significa que un objeto puede heredar directamente propiedades de otro objeto a partir de su prototipo, sin necesidad de crear clases.</p>
</div>
<div class="paragraph">
<p>Ya hemos visto que mediante la propiedad <code>prototype</code> podemos asociar atributos y métodos al prototipo de nuestras funciones constructor.</p>
</div>
<div class="paragraph">
<p>Retomemos el ejemplo del objeto <code>Persona</code> mediante la función constructor:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="javascript"><span class="tok-kd">var</span> <span class="tok-nx">Persona</span> <span class="tok-o">=</span> <span class="tok-kd">function</span><span class="tok-p">(</span><span class="tok-nx">nombre</span><span class="tok-p">,</span> <span class="tok-nx">apellido1</span><span class="tok-p">)</span> <span class="tok-p">{</span>
  <span class="tok-k">this</span><span class="tok-p">.</span><span class="tok-nx">nombre</span> <span class="tok-o">=</span> <span class="tok-nx">nombre</span><span class="tok-p">;</span>
  <span class="tok-k">this</span><span class="tok-p">.</span><span class="tok-nx">apellido1</span> <span class="tok-o">=</span> <span class="tok-nx">apellido1</span><span class="tok-p">;</span>

  <span class="tok-k">this</span><span class="tok-p">.</span><span class="tok-nx">nombreCompleto</span> <span class="tok-o">=</span> <span class="tok-kd">function</span><span class="tok-p">()</span> <span class="tok-p">{</span>
    <span class="tok-k">return</span> <span class="tok-k">this</span><span class="tok-p">.</span><span class="tok-nx">nombre</span> <span class="tok-o">+</span> <span class="tok-s2">&quot; &quot;</span> <span class="tok-o">+</span> <span class="tok-k">this</span><span class="tok-p">.</span><span class="tok-nx">apellido1</span><span class="tok-p">;</span>
  <span class="tok-p">};</span>

  <span class="tok-k">this</span><span class="tok-p">.</span><span class="tok-nx">saluda</span> <span class="tok-o">=</span> <span class="tok-kd">function</span><span class="tok-p">(</span><span class="tok-nx">persona</span><span class="tok-p">)</span> <span class="tok-p">{</span>
    <span class="tok-k">if</span> <span class="tok-p">(</span><span class="tok-nx">persona</span> <span class="tok-k">instanceof</span> <span class="tok-nx">Persona</span><span class="tok-p">)</span> <span class="tok-p">{</span>
      <span class="tok-k">return</span> <span class="tok-s2">&quot;Hola &quot;</span> <span class="tok-o">+</span> <span class="tok-nx">persona</span><span class="tok-p">.</span><span class="tok-nx">getNombreCompleto</span><span class="tok-p">();</span>
    <span class="tok-p">}</span> <span class="tok-k">else</span> <span class="tok-p">{</span>
      <span class="tok-k">return</span> <span class="tok-s2">&quot;Hola colega&quot;</span><span class="tok-p">;</span>
    <span class="tok-p">}</span>
  <span class="tok-p">};</span>
<span class="tok-p">};</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Para mejorar el uso de la memoria y reducir la duplicidad de los métodos, hemos de llevar los métodos al prototipo. Para ello, crearemos descriptores de acceso para las propiedades y llevaremos los métodos al prototipo de la función constructor:</p>
</div>
<div class="listingblock">
<div class="title">Refactor OO - <a href="http://jsbin.com/racexa/1/edit?js" class="bare">http://jsbin.com/racexa/1/edit?js</a></div>
<div class="content">
<pre class="pygments highlight"><code data-lang="javascript"><span class="tok-kd">var</span> <span class="tok-nx">Persona</span> <span class="tok-o">=</span> <span class="tok-kd">function</span><span class="tok-p">(</span><span class="tok-nx">nombre</span><span class="tok-p">,</span> <span class="tok-nx">apellido1</span><span class="tok-p">)</span> <span class="tok-p">{</span>
  <span class="tok-k">this</span><span class="tok-p">.</span><span class="tok-nx">nombre</span> <span class="tok-o">=</span> <span class="tok-nx">nombre</span><span class="tok-p">;</span>
  <span class="tok-k">this</span><span class="tok-p">.</span><span class="tok-nx">apellido1</span> <span class="tok-o">=</span> <span class="tok-nx">apellido1</span><span class="tok-p">;</span>
<span class="tok-p">};</span>

<span class="tok-nb">Object</span><span class="tok-p">.</span><span class="tok-nx">defineProperties</span><span class="tok-p">(</span><span class="tok-nx">Persona</span><span class="tok-p">.</span><span class="tok-nx">prototype</span><span class="tok-p">,</span> <span class="tok-p">{</span>  <i class="conum" data-value="1"></i><b>(1)</b>
  <span class="tok-nx">nombreCompleto</span><span class="tok-o">:</span> <span class="tok-p">{</span>
    <span class="tok-nx">get</span><span class="tok-o">:</span> <span class="tok-kd">function</span><span class="tok-p">()</span> <span class="tok-p">{</span> <i class="conum" data-value="2"></i><b>(2)</b>
      <span class="tok-k">return</span> <span class="tok-k">this</span><span class="tok-p">.</span><span class="tok-nx">nombre</span> <span class="tok-o">+</span> <span class="tok-s2">&quot; &quot;</span> <span class="tok-o">+</span> <span class="tok-k">this</span><span class="tok-p">.</span><span class="tok-nx">apellido1</span><span class="tok-p">;</span>
    <span class="tok-p">},</span>
    <span class="tok-nx">enumerable</span><span class="tok-o">:</span> <span class="tok-kc">true</span>
  <span class="tok-p">}</span>
<span class="tok-p">});</span>

<span class="tok-nx">Persona</span><span class="tok-p">.</span><span class="tok-nx">prototype</span><span class="tok-p">.</span><span class="tok-nx">saluda</span> <span class="tok-o">=</span> <span class="tok-kd">function</span><span class="tok-p">(</span><span class="tok-nx">persona</span><span class="tok-p">)</span> <span class="tok-p">{</span>  <i class="conum" data-value="3"></i><b>(3)</b>
  <span class="tok-k">if</span> <span class="tok-p">(</span><span class="tok-nx">persona</span> <span class="tok-k">instanceof</span> <span class="tok-nx">Persona</span><span class="tok-p">)</span> <span class="tok-p">{</span>
    <span class="tok-k">return</span> <span class="tok-s2">&quot;Hola &quot;</span> <span class="tok-o">+</span> <span class="tok-nx">persona</span><span class="tok-p">.</span><span class="tok-nx">nombreCompleto</span><span class="tok-p">;</span>
  <span class="tok-p">}</span> <span class="tok-k">else</span> <span class="tok-p">{</span>
    <span class="tok-k">return</span> <span class="tok-s2">&quot;Hola colega&quot;</span><span class="tok-p">;</span>
  <span class="tok-p">}</span>
<span class="tok-p">};</span>

<span class="tok-kd">var</span> <span class="tok-nx">batman</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-nx">Persona</span><span class="tok-p">(</span><span class="tok-s2">&quot;Bruce&quot;</span><span class="tok-p">,</span> <span class="tok-s2">&quot;Wayne&quot;</span><span class="tok-p">);</span>
<span class="tok-nx">console</span><span class="tok-p">.</span><span class="tok-nx">log</span><span class="tok-p">(</span><span class="tok-nx">batman</span><span class="tok-p">.</span><span class="tok-nx">nombreCompleto</span><span class="tok-p">);</span> <span class="tok-c1">// Bruce Wayne</span>
<span class="tok-nx">console</span><span class="tok-p">.</span><span class="tok-nx">log</span><span class="tok-p">(</span><span class="tok-nx">batman</span><span class="tok-p">.</span><span class="tok-nx">saluda</span><span class="tok-p">());</span> <span class="tok-c1">// Hola colega</span>
<span class="tok-kd">var</span> <span class="tok-nx">superman</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-nx">Persona</span><span class="tok-p">(</span><span class="tok-s2">&quot;Clark&quot;</span><span class="tok-p">,</span> <span class="tok-s2">&quot;Kent&quot;</span><span class="tok-p">);</span>
<span class="tok-nx">console</span><span class="tok-p">.</span><span class="tok-nx">log</span><span class="tok-p">(</span><span class="tok-nx">batman</span><span class="tok-p">.</span><span class="tok-nx">saluda</span><span class="tok-p">(</span><span class="tok-nx">superman</span><span class="tok-p">));</span> <span class="tok-c1">// Hola Clark Kent</span></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Fijamos la definición de propiedades en el prototipo de la función constructor</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Añadimos una propiedad de acceso por cada propiedad</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Añadimos los métodos al prototipo</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Si queremos incluir los métodos como dentro de los descriptores de propiedades, podemos añadiros como valores:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="javascript"><span class="tok-nb">Object</span><span class="tok-p">.</span><span class="tok-nx">defineProperties</span><span class="tok-p">(</span><span class="tok-nx">Persona</span><span class="tok-p">.</span><span class="tok-nx">prototype</span><span class="tok-p">,</span> <span class="tok-p">{</span>
  <span class="tok-nx">nombreCompleto</span><span class="tok-o">:</span> <span class="tok-p">{</span>
    <span class="tok-nx">get</span><span class="tok-o">:</span> <span class="tok-kd">function</span><span class="tok-p">()</span> <span class="tok-p">{</span>
      <span class="tok-k">return</span> <span class="tok-k">this</span><span class="tok-p">.</span><span class="tok-nx">nombre</span> <span class="tok-o">+</span> <span class="tok-s2">&quot; &quot;</span> <span class="tok-o">+</span> <span class="tok-k">this</span><span class="tok-p">.</span><span class="tok-nx">apellido1</span><span class="tok-p">;</span>
    <span class="tok-p">},</span>
    <span class="tok-nx">enumerable</span><span class="tok-o">:</span> <span class="tok-kc">true</span>
  <span class="tok-p">},</span>
  <span class="tok-nx">saluda</span><span class="tok-o">:</span> <span class="tok-p">{</span>
    <span class="tok-nx">value</span><span class="tok-o">:</span> <span class="tok-kd">function</span><span class="tok-p">(</span><span class="tok-nx">persona</span><span class="tok-p">)</span> <span class="tok-p">{</span>  <i class="conum" data-value="1"></i><b>(1)</b>
      <span class="tok-k">if</span> <span class="tok-p">(</span><span class="tok-nx">persona</span> <span class="tok-k">instanceof</span> <span class="tok-nx">Persona</span><span class="tok-p">)</span> <span class="tok-p">{</span>
        <span class="tok-k">return</span> <span class="tok-s2">&quot;Hola &quot;</span> <span class="tok-o">+</span> <span class="tok-nx">persona</span><span class="tok-p">.</span><span class="tok-nx">nombreCompleto</span><span class="tok-p">;</span>
      <span class="tok-p">}</span> <span class="tok-k">else</span> <span class="tok-p">{</span>
        <span class="tok-k">return</span> <span class="tok-s2">&quot;Hola colega&quot;</span><span class="tok-p">;</span>
      <span class="tok-p">}</span>
    <span class="tok-p">},</span>
    <span class="tok-nx">enumerable</span><span class="tok-o">:</span> <span class="tok-kc">true</span>
  <span class="tok-p">}</span>
<span class="tok-p">});</span></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>El método saluda ahora es una propiedad cuyo valor es una función</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Para crear un objeto que utilice el prototipo de otro hemos de hacer uso del método <code>Object.create(<em>objetoPrototipo</em>)</code>. De este modo, el <em>objetoPrototipo</em> se convierte en el prototipo del objeto devuelto, y así podemos acceder al objeto padre mediante <code>Object.getPrototypeOf(<em>objetoPrototipo</em>)</code> o la propiedad <code>__proto__</code> (<em>deprecated</em>):</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="javascript"><span class="tok-kd">var</span> <span class="tok-nx">Empleado</span> <span class="tok-o">=</span> <span class="tok-nb">Object</span><span class="tok-p">.</span><span class="tok-nx">create</span><span class="tok-p">(</span><span class="tok-nx">Persona</span><span class="tok-p">);</span>
<span class="tok-nx">console</span><span class="tok-p">.</span><span class="tok-nx">log</span><span class="tok-p">(</span><span class="tok-nx">Empleado</span><span class="tok-p">.</span><span class="tok-nx">hasOwnProperty</span><span class="tok-p">(</span><span class="tok-s1">&#39;nombreCompleto&#39;</span><span class="tok-p">));</span>  <span class="tok-c1">// false</span>
<span class="tok-nx">console</span><span class="tok-p">.</span><span class="tok-nx">log</span><span class="tok-p">(</span><span class="tok-nx">Empleado</span><span class="tok-p">.</span><span class="tok-nx">__proto__</span> <span class="tok-o">===</span> <span class="tok-nx">Persona</span><span class="tok-p">);</span>  <span class="tok-c1">// true</span>
<span class="tok-nx">console</span><span class="tok-p">.</span><span class="tok-nx">log</span><span class="tok-p">(</span><span class="tok-nb">Object</span><span class="tok-p">.</span><span class="tok-nx">getPrototypeOf</span><span class="tok-p">(</span><span class="tok-nx">Empleado</span><span class="tok-p">)</span> <span class="tok-o">===</span> <span class="tok-nx">Persona</span><span class="tok-p">);</span>  <span class="tok-c1">// true</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Si queremos realizar herencia entre objetos, el proceso se realiza en dos pasos:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Heredar el constructor</p>
</li>
<li>
<p>Heredar el prototipo</p>
</li>
</ol>
</div>
<div class="sect3">
<h4 id="_herencia_de_constructor">2.7.1. Herencia de constructor</h4>
<div class="paragraph">
<p>Si usamos funciones constructor, podemos realizar herencia de constructor para que el hijo comparta las mismas propiedades que el padre. Para ello, el hijo debe realizar una llamada al padre y definir sus propios atributos.</p>
</div>
<div class="paragraph">
<p>Por ejemplo, supongamos que queremos crear un objeto <code>Empleado</code> que se base en <code>Persona</code>, pero añadiendo el campo <code>cargo</code> con el puesto laboral del empleado:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="javascript"><span class="tok-kd">var</span> <span class="tok-nx">Empleado</span> <span class="tok-o">=</span> <span class="tok-kd">function</span><span class="tok-p">(</span><span class="tok-nx">nombre</span><span class="tok-p">,</span> <span class="tok-nx">apellido1</span><span class="tok-p">,</span> <span class="tok-nx">cargo</span><span class="tok-p">)</span> <span class="tok-p">{</span>
  <span class="tok-nx">Persona</span><span class="tok-p">.</span><span class="tok-nx">call</span><span class="tok-p">(</span><span class="tok-k">this</span><span class="tok-p">,</span> <span class="tok-nx">nombre</span><span class="tok-p">,</span> <span class="tok-nx">apellido1</span><span class="tok-p">);</span>  <i class="conum" data-value="1"></i><b>(1)</b>
  <span class="tok-k">this</span><span class="tok-p">.</span><span class="tok-nx">cargo</span> <span class="tok-o">=</span> <span class="tok-nx">cargo</span><span class="tok-p">;</span>
<span class="tok-p">};</span></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Llamamos al constructor del padre mediante <code>call</code> para que <code>this</code> tome el valor del hijo.</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_herencia_de_prototipo">2.7.2. Herencia de prototipo</h4>
<div class="paragraph">
<p>Una vez heredado el constructor, necesitamos heredar el prototipo para compartir los métodos y si fuese el caso, sobrescribirlos.</p>
</div>
<div class="paragraph">
<p>Para ello, mediante <code>Object.create(<em>prototipo</em>, <em>propiedades</em>)</code> vamos a definir los métodos del hijo y si quisiéramos sobrescribir los métodos que queramos del padre:</p>
</div>
<div class="listingblock">
<div class="title">Herencia - <a href="http://jsbin.com/ledavu/1/edit?js" class="bare">http://jsbin.com/ledavu/1/edit?js</a></div>
<div class="content">
<pre class="pygments highlight"><code data-lang="javascript"><span class="tok-nx">Empleado</span><span class="tok-p">.</span><span class="tok-nx">prototype</span> <span class="tok-o">=</span> <span class="tok-nb">Object</span><span class="tok-p">.</span><span class="tok-nx">create</span><span class="tok-p">(</span><span class="tok-nx">Persona</span><span class="tok-p">.</span><span class="tok-nx">prototype</span><span class="tok-p">,</span> <span class="tok-p">{</span> <i class="conum" data-value="1"></i><b>(1)</b>
  <span class="tok-nx">saluda</span><span class="tok-o">:</span> <span class="tok-p">{</span>   <span class="tok-c1">// sobreescribimos los métodos que queremos</span>
    <span class="tok-nx">value</span><span class="tok-o">:</span> <span class="tok-kd">function</span><span class="tok-p">(</span><span class="tok-nx">persona</span><span class="tok-p">)</span> <span class="tok-p">{</span>
      <span class="tok-k">if</span> <span class="tok-p">(</span><span class="tok-nx">persona</span> <span class="tok-k">instanceof</span> <span class="tok-nx">Persona</span><span class="tok-p">)</span> <span class="tok-p">{</span>
        <span class="tok-k">return</span> <span class="tok-nx">Persona</span><span class="tok-p">.</span><span class="tok-nx">prototype</span><span class="tok-p">.</span><span class="tok-nx">saluda</span><span class="tok-p">.</span><span class="tok-nx">call</span><span class="tok-p">(</span><span class="tok-k">this</span><span class="tok-p">)</span> <span class="tok-o">+</span> <span class="tok-s2">&quot; (desde un empleado)&quot;</span><span class="tok-p">;</span>  <i class="conum" data-value="2"></i><b>(2)</b>
      <span class="tok-p">}</span> <span class="tok-k">else</span> <span class="tok-p">{</span>
        <span class="tok-k">return</span> <span class="tok-s2">&quot;Hola trabajador&quot;</span><span class="tok-p">;</span>
      <span class="tok-p">}</span>
    <span class="tok-p">},</span>
    <span class="tok-nx">writable</span><span class="tok-o">:</span> <span class="tok-kc">false</span><span class="tok-p">,</span>  <i class="conum" data-value="3"></i><b>(3)</b>
    <span class="tok-nx">enumerable</span><span class="tok-o">:</span> <span class="tok-kc">true</span>
  <span class="tok-p">},</span>
  <span class="tok-nx">nombreCompleto</span><span class="tok-o">:</span> <span class="tok-p">{</span>
    <span class="tok-nx">get</span><span class="tok-o">:</span> <span class="tok-kd">function</span><span class="tok-p">()</span> <span class="tok-p">{</span> <i class="conum" data-value="4"></i><b>(4)</b>
      <span class="tok-kd">var</span> <span class="tok-nx">desc</span> <span class="tok-o">=</span> <span class="tok-nb">Object</span><span class="tok-p">.</span><span class="tok-nx">getOwnPropertyDescriptor</span><span class="tok-p">(</span><span class="tok-nx">Persona</span><span class="tok-p">.</span><span class="tok-nx">prototype</span><span class="tok-p">,</span> <span class="tok-s2">&quot;nombreCompleto&quot;</span><span class="tok-p">);</span>  <i class="conum" data-value="5"></i><b>(5)</b>
      <span class="tok-k">return</span> <span class="tok-nx">desc</span><span class="tok-p">.</span><span class="tok-nx">get</span><span class="tok-p">.</span><span class="tok-nx">call</span><span class="tok-p">(</span><span class="tok-k">this</span><span class="tok-p">)</span> <span class="tok-o">+</span> <span class="tok-s2">&quot;, &quot;</span> <span class="tok-o">+</span> <span class="tok-k">this</span><span class="tok-p">.</span><span class="tok-nx">cargo</span><span class="tok-p">;</span> <i class="conum" data-value="6"></i><b>(6)</b>
    <span class="tok-p">},</span>
    <span class="tok-nx">enumerable</span><span class="tok-o">:</span> <span class="tok-kc">true</span>
  <span class="tok-p">}</span>
<span class="tok-p">});</span></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Redefinimos el prototipo de <code>Empleado</code> con el de <code>Persona</code></td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Dentro del método que sobreescribimos, podemos realizar una llamada al mismo método pero del padre, haciendo uso de <code>call</code> para redefinir el objeto <code>this</code></td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Podemos marcar el método como no modificable para evitar que se pueda sobreescribir</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Si queremos, también podemos sobreescribir los descritores de propiedades</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>Para acceder a una propiedad del padre hemos de hacerlo mediante <code>Object.getOwnPropertyDescriptor</code></td>
</tr>
<tr>
<td><i class="conum" data-value="6"></i><b>6</b></td>
<td>Igual que en punto 2, accedemos al descriptor pero asociándole el objeto <code>this</code> del hijo al padre.</td>
</tr>
</table>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
Un artículo interesante sobre la OO y la herencia en <em>JavaScript</em> es <em>OOP in JavaScript: What you NEED to know</em>:
<a href="http://javascriptissexy.com/oop-in-javascript-what-you-need-to-know/" class="bare">http://javascriptissexy.com/oop-in-javascript-what-you-need-to-know/</a>
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect2">
<h3 id="__code_this_code_y_el_patrón_invocación">2.8. <code>this</code> y el patrón invocación</h3>
<div class="paragraph">
<p>Una de las cosas que diferencia <em>JavaScript</em> de otros lenguajes de programación es que la variable <code>this</code> toma diferentes valores dependiendo de cómo se invoque la función o fragmento donde se encuentra.</p>
</div>
<div class="paragraph">
<p>A la hora de invocar una función lo podemos hacer de cuatro maneras, las cuales se conocen como el <em>patrón invocación</em>:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>El patrón de invocación como método</p>
</li>
<li>
<p>El patrón de invocación como función</p>
</li>
<li>
<p>El patrón de invocación como constructor</p>
</li>
<li>
<p>El patrón de invocación con <em>apply</em> y <em>call</em></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Este patrón define como se inicializa <code>this</code> en cada caso.</p>
</div>
<div class="sect3">
<h4 id="_invocación_como_método">2.8.1. Invocación como método</h4>
<div class="paragraph">
<p>Se conoce como método a aquella función que se almacena como una propiedad de un objeto. En este caso <code>this</code> se inicializa con el objeto al que pertenece la función.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="javascript"><span class="tok-kd">var</span> <span class="tok-nx">obj</span> <span class="tok-o">=</span> <span class="tok-p">{</span>
	<span class="tok-nx">valor</span> <span class="tok-o">:</span> <span class="tok-mi">0</span><span class="tok-p">,</span>
	<span class="tok-nx">incrementar</span><span class="tok-o">:</span> <span class="tok-kd">function</span><span class="tok-p">(</span><span class="tok-nx">inc</span><span class="tok-p">){</span>
		<span class="tok-k">this</span><span class="tok-p">.</span><span class="tok-nx">valor</span> <span class="tok-o">+=</span> <span class="tok-nx">inc</span><span class="tok-p">;</span>
	<span class="tok-p">}</span>
<span class="tok-p">};</span>

<span class="tok-nx">obj</span><span class="tok-p">.</span><span class="tok-nx">incrementar</span><span class="tok-p">(</span><span class="tok-mi">3</span><span class="tok-p">);</span>
<span class="tok-nx">console</span><span class="tok-p">.</span><span class="tok-nx">log</span><span class="tok-p">(</span><span class="tok-nx">obj</span><span class="tok-p">.</span><span class="tok-nx">valor</span><span class="tok-p">);</span> <span class="tok-c1">// 3</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Al asociarse el valor de <code>this</code> en tiempo de invocación (y no de compilación), fomenta que el código sea altamente reutilizable.</p>
</div>
<div class="paragraph">
<p>Los métodos que hacen uso de <code>this</code> para obtener el contexto del objeto se conocen como <em>métodos públicos</em>.</p>
</div>
</div>
<div class="sect3">
<h4 id="_invocación_como_función">2.8.2. Invocación como Función</h4>
<div class="paragraph">
<p>Cuando una función no es una propiedad de un objeto, se invoca como función, y <code>this</code> se inicializa con el objeto global (al trabajar con un navegador, el objeto <code>window</code>).</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="javascript"><span class="tok-kd">function</span> <span class="tok-nx">suma</span><span class="tok-p">(</span><span class="tok-nx">a</span><span class="tok-p">,</span><span class="tok-nx">b</span><span class="tok-p">)</span> <span class="tok-p">{</span>
	<span class="tok-nx">console</span><span class="tok-p">.</span><span class="tok-nx">log</span><span class="tok-p">(</span><span class="tok-nx">a</span><span class="tok-o">+</span><span class="tok-nx">b</span><span class="tok-p">);</span>
	<span class="tok-nx">console</span><span class="tok-p">.</span><span class="tok-nx">log</span><span class="tok-p">(</span><span class="tok-k">this</span><span class="tok-p">);</span>
<span class="tok-p">}</span>
<span class="tok-nx">suma</span><span class="tok-p">(</span><span class="tok-mi">3</span><span class="tok-p">,</span><span class="tok-mi">5</span><span class="tok-p">);</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Y por la consola aparece tanto el resultado como todo el objeto <code>window</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="console"><span class="tok-go">8</span>
<span class="tok-go">Window {top: Window, window: Window, location: Location, ... }</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Esto puede ser un problema, ya que cuando llamamos a una función dentro de otra, <code>this</code> sigue referenciando al objeto global y si queremos acceder al <code>this</code> de la función padre tenemos que almacenarlo previamente en una variable:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="javascript"><span class="tok-kd">var</span> <span class="tok-nx">obj</span> <span class="tok-o">=</span> <span class="tok-p">{</span>
  <span class="tok-nx">valor</span><span class="tok-o">:</span> <span class="tok-mi">0</span><span class="tok-p">,</span>
  <span class="tok-nx">incrementar</span><span class="tok-o">:</span> <span class="tok-kd">function</span><span class="tok-p">(</span><span class="tok-nx">inc</span><span class="tok-p">)</span> <span class="tok-p">{</span> <i class="conum" data-value="1"></i><b>(1)</b>
    <span class="tok-kd">var</span> <span class="tok-nx">that</span> <span class="tok-o">=</span> <span class="tok-k">this</span><span class="tok-p">;</span>

    <span class="tok-kd">function</span> <span class="tok-nx">otraFuncion</span><span class="tok-p">(</span><span class="tok-nx">unValor</span><span class="tok-p">)</span> <span class="tok-p">{</span>  <i class="conum" data-value="2"></i><b>(2)</b>
      <span class="tok-nx">that</span><span class="tok-p">.</span><span class="tok-nx">valor</span> <span class="tok-o">+=</span> <span class="tok-nx">unValor</span><span class="tok-p">;</span>
    <span class="tok-p">}</span>

    <span class="tok-nx">otraFuncion</span><span class="tok-p">(</span><span class="tok-nx">inc</span><span class="tok-p">);</span>
  <span class="tok-p">}</span>
<span class="tok-p">};</span>

<span class="tok-nx">obj</span><span class="tok-p">.</span><span class="tok-nx">incrementar</span><span class="tok-p">(</span><span class="tok-mi">3</span><span class="tok-p">);</span>
<span class="tok-nx">console</span><span class="tok-p">.</span><span class="tok-nx">log</span><span class="tok-p">(</span><span class="tok-nx">obj</span><span class="tok-p">.</span><span class="tok-nx">valor</span><span class="tok-p">);</span> <span class="tok-c1">// 3</span></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Se invoca como método y <code>this</code> referencia al propio objeto</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Se invoca como función y <code>this</code> referencia al objeto global</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Y si hacemos uso de <code>call</code> podemos conseguir lo mismo pero sin necesidad de almacenar <code>this</code> en una variable auxiliar:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="javascript"><span class="tok-kd">var</span> <span class="tok-nx">objBind</span> <span class="tok-o">=</span> <span class="tok-p">{</span>
  <span class="tok-nx">valor</span><span class="tok-o">:</span> <span class="tok-mi">0</span><span class="tok-p">,</span>
  <span class="tok-nx">incrementar</span><span class="tok-o">:</span> <span class="tok-kd">function</span><span class="tok-p">(</span><span class="tok-nx">inc</span><span class="tok-p">)</span> <span class="tok-p">{</span>
    <span class="tok-kd">function</span> <span class="tok-nx">otraFuncion</span><span class="tok-p">(</span><span class="tok-nx">unValor</span><span class="tok-p">)</span> <span class="tok-p">{</span>
      <span class="tok-k">this</span><span class="tok-p">.</span><span class="tok-nx">valor</span> <span class="tok-o">+=</span> <span class="tok-nx">unValor</span><span class="tok-p">;</span>
    <span class="tok-p">}</span>
    <span class="tok-nx">otraFuncion</span><span class="tok-p">.</span><span class="tok-nx">call</span><span class="tok-p">(</span><span class="tok-k">this</span><span class="tok-p">,</span> <span class="tok-nx">inc</span><span class="tok-p">);</span>  <i class="conum" data-value="1"></i><b>(1)</b>
  <span class="tok-p">}</span>
<span class="tok-p">}</span></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Al invocar a una función, le indicamos que toma la referencia <code>this</code> del objeto en vez del global</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_invocación_como_constructor">2.8.3. Invocación como constructor</h4>
<div class="paragraph">
<p>Ya hemos visto que <em>JavaScript</em> ofrece una sintaxis similar a la creación de objetos en Java. Dicho esto, cuando invocamos una función mediante <code>new</code> se creará un objeto con una referencia al valor de la propiedad <code>prototype</code> de la función (también llamado constructor) y <code>this</code> tendrá una referencia a este nuevo objeto.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="javascript"><span class="tok-kd">var</span> <span class="tok-nx">Persona</span> <span class="tok-o">=</span> <span class="tok-kd">function</span><span class="tok-p">()</span> <span class="tok-p">{</span> <span class="tok-c1">// constructor</span>
  <span class="tok-k">this</span><span class="tok-p">.</span><span class="tok-nx">nombre</span> <span class="tok-o">=</span> <span class="tok-s1">&#39;Aitor&#39;</span><span class="tok-p">;</span>
  <span class="tok-k">this</span><span class="tok-p">.</span><span class="tok-nx">apellido1</span> <span class="tok-o">=</span> <span class="tok-s2">&quot;Medrano&quot;</span><span class="tok-p">;</span>
<span class="tok-p">}</span>

<span class="tok-nx">Persona</span><span class="tok-p">.</span><span class="tok-nx">prototype</span><span class="tok-p">.</span><span class="tok-nx">getNombreCompleto</span> <span class="tok-o">=</span> <span class="tok-kd">function</span><span class="tok-p">(){</span>
  <span class="tok-k">return</span> <span class="tok-k">this</span><span class="tok-p">.</span><span class="tok-nx">nombre</span> <span class="tok-o">+</span> <span class="tok-s2">&quot; &quot;</span> <span class="tok-o">+</span> <span class="tok-k">this</span><span class="tok-p">.</span><span class="tok-nx">apellido1</span><span class="tok-p">;</span>
<span class="tok-p">}</span>

<span class="tok-kd">var</span> <span class="tok-nx">p</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-nx">Persona</span><span class="tok-p">();</span>
<span class="tok-nx">console</span><span class="tok-p">.</span><span class="tok-nx">log</span><span class="tok-p">(</span><span class="tok-nx">p</span><span class="tok-p">.</span><span class="tok-nx">getNombreCompleto</span><span class="tok-p">());</span> <span class="tok-c1">// Aitor Medrano</span></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="invocacion-apply">2.8.4. Invocación con <code>apply</code></h4>
<div class="paragraph">
<p>Como <em>JavaScript</em> es un lenguaje orientado a objetos funcional, las funciones pueden contener métodos.</p>
</div>
<div class="paragraph">
<p>El método <code>apply</code> nos permite, además de construir un <em>array</em> de argumentos que usaremos al invocar una función, elegir el valor que tendrá <code>this</code>, lo cual permite reescribir el valor de <code>this</code> en tiempo de ejecución.</p>
</div>
<div class="paragraph">
<p>Para ello, <code>apply</code> recibe 2 parámetros, el primero es el valor para <code>this</code> y el segundo es un <em>array</em> de parámetros.</p>
</div>
<div class="paragraph">
<p>Usando el ejemplo anterior de prototipado, vamos a cambiar el <code>this</code> utilizando <em>apply</em>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="javascript"><span class="tok-kd">var</span> <span class="tok-nx">Persona</span> <span class="tok-o">=</span> <span class="tok-kd">function</span><span class="tok-p">()</span> <span class="tok-p">{</span> <span class="tok-c1">// constructor</span>
  <span class="tok-k">this</span><span class="tok-p">.</span><span class="tok-nx">nombre</span> <span class="tok-o">=</span> <span class="tok-s2">&quot;Aitor&quot;</span><span class="tok-p">;</span>
  <span class="tok-k">this</span><span class="tok-p">.</span><span class="tok-nx">apellido1</span> <span class="tok-o">=</span> <span class="tok-s2">&quot;Medrano&quot;</span><span class="tok-p">;</span>
<span class="tok-p">}</span>

<span class="tok-nx">Persona</span><span class="tok-p">.</span><span class="tok-nx">prototype</span><span class="tok-p">.</span><span class="tok-nx">getNombreCompleto</span> <span class="tok-o">=</span> <span class="tok-kd">function</span><span class="tok-p">(){</span>
  <span class="tok-k">return</span> <span class="tok-k">this</span><span class="tok-p">.</span><span class="tok-nx">nombre</span> <span class="tok-o">+</span> <span class="tok-s2">&quot; &quot;</span> <span class="tok-o">+</span> <span class="tok-k">this</span><span class="tok-p">.</span><span class="tok-nx">apellido1</span><span class="tok-p">;</span>
<span class="tok-p">}</span>

<span class="tok-kd">var</span> <span class="tok-nx">otraPersona</span> <span class="tok-o">=</span> <span class="tok-p">{</span>
  <span class="tok-nx">nombre</span><span class="tok-o">:</span> <span class="tok-s2">&quot;Rubén&quot;</span><span class="tok-p">,</span>
  <span class="tok-nx">apellido1</span><span class="tok-o">:</span> <span class="tok-s2">&quot;Inoto&quot;</span>
<span class="tok-p">}</span>

<span class="tok-kd">var</span> <span class="tok-nx">p</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-nx">Persona</span><span class="tok-p">();</span>
<span class="tok-nx">console</span><span class="tok-p">.</span><span class="tok-nx">log</span><span class="tok-p">(</span><span class="tok-nx">p</span><span class="tok-p">.</span><span class="tok-nx">getNombreCompleto</span><span class="tok-p">());</span> <span class="tok-c1">// Aitor Medrano</span>
<span class="tok-nx">console</span><span class="tok-p">.</span><span class="tok-nx">log</span><span class="tok-p">(</span><span class="tok-nx">p</span><span class="tok-p">.</span><span class="tok-nx">getNombreCompleto</span><span class="tok-p">().</span><span class="tok-nx">apply</span><span class="tok-p">(</span><span class="tok-nx">otraPersona</span><span class="tok-p">));</span> <span class="tok-c1">// Rubén Inoto</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Así pues, el método <code>apply</code> realiza una llamada a una función pasándole tanto el objeto que va a tomar el papel de <code>this</code> como un <em>array</em> con los parámetros que va a utilizar la función.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="title">Autoevaluación - <code>this</code></div>
<div class="paragraph">
<p>¿Cual es el resultado del siguiente fragmento de código? <span class="footnote">[<a id="_footnoteref_7" class="footnote" href="#_footnote_7" title="View footnote.">7</a>]</span></p>
</div>
<div class="listingblock">
<div class="title"><a href="http://jsbin.com/xuzuhu/1/edit?js" class="bare">http://jsbin.com/xuzuhu/1/edit?js</a></div>
<div class="content">
<pre class="pygments highlight"><code data-lang="javascript"><span class="tok-kd">var</span> <span class="tok-nx">nombre</span> <span class="tok-o">=</span> <span class="tok-s1">&#39;Bruce Wayne&#39;</span><span class="tok-p">;</span>
<span class="tok-kd">var</span> <span class="tok-nx">obj</span> <span class="tok-o">=</span> <span class="tok-p">{</span>
  <span class="tok-nx">nombre</span><span class="tok-o">:</span> <span class="tok-s1">&#39;Bruno Díaz&#39;</span><span class="tok-p">,</span>
  <span class="tok-nx">prop</span><span class="tok-o">:</span> <span class="tok-p">{</span>
    <span class="tok-nx">nombre</span><span class="tok-o">:</span> <span class="tok-s1">&#39;Aitor Medrano&#39;</span><span class="tok-p">,</span>
    <span class="tok-nx">getNombre</span><span class="tok-o">:</span> <span class="tok-kd">function</span><span class="tok-p">()</span> <span class="tok-p">{</span>
      <span class="tok-k">return</span> <span class="tok-k">this</span><span class="tok-p">.</span><span class="tok-nx">nombre</span><span class="tok-p">;</span>
    <span class="tok-p">}</span>
  <span class="tok-p">}</span>
<span class="tok-p">};</span>
<span class="tok-nx">console</span><span class="tok-p">.</span><span class="tok-nx">log</span><span class="tok-p">(</span><span class="tok-nx">obj</span><span class="tok-p">.</span><span class="tok-nx">prop</span><span class="tok-p">.</span><span class="tok-nx">getNombre</span><span class="tok-p">());</span>
<span class="tok-kd">var</span> <span class="tok-nx">test</span> <span class="tok-o">=</span> <span class="tok-nx">obj</span><span class="tok-p">.</span><span class="tok-nx">prop</span><span class="tok-p">.</span><span class="tok-nx">getNombre</span><span class="tok-p">;</span>
<span class="tok-nx">console</span><span class="tok-p">.</span><span class="tok-nx">log</span><span class="tok-p">(</span><span class="tok-nx">test</span><span class="tok-p">());</span></code></pre>
</div>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_arrays">2.9. Arrays</h3>
<div class="paragraph">
<p>Se trata de un tipo predefinido que, a diferencia de otros lenguajes, es un objeto. Del mismo modo que los tipos básicos, lo podemos crear de la siguiente manera:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="javascript"><span class="tok-kd">var</span> <span class="tok-nx">cosas</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-nb">Array</span><span class="tok-p">();</span>
<span class="tok-kd">var</span> <span class="tok-nx">tresTipos</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-nb">Array</span><span class="tok-p">(</span><span class="tok-mi">11</span><span class="tok-p">,</span> <span class="tok-s2">&quot;hola&quot;</span><span class="tok-p">,</span> <span class="tok-kc">true</span><span class="tok-p">);</span>
<span class="tok-kd">var</span> <span class="tok-nx">longitud</span> <span class="tok-o">=</span> <span class="tok-nx">tresTipos</span><span class="tok-p">.</span><span class="tok-nx">length</span><span class="tok-p">;</span>	<span class="tok-c1">// 3</span>
<span class="tok-kd">var</span> <span class="tok-nx">once</span> <span class="tok-o">=</span> <span class="tok-nx">tresTipos</span><span class="tok-p">[</span><span class="tok-mi">0</span><span class="tok-p">];</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Podemos observar que en <em>JavaScript</em> los arrays pueden contener tipos diferentes, que el primer elemento es el 0 y que podemos obtener su longitud mediante la propiedad <code>length</code>.</p>
</div>
<div class="paragraph">
<p>Igual que antes, aunque se pueden crear los arrays de este modo, realmente se crean e inicializan con la notación de corchetes de JSON:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="javascript"><span class="tok-kd">var</span> <span class="tok-nx">tresTipos</span> <span class="tok-o">=</span> <span class="tok-p">[</span><span class="tok-mi">11</span><span class="tok-p">,</span> <span class="tok-s2">&quot;hola&quot;</span><span class="tok-p">,</span> <span class="tok-kc">true</span><span class="tok-p">];</span>
<span class="tok-kd">var</span> <span class="tok-nx">once</span> <span class="tok-o">=</span> <span class="tok-nx">tresTipos</span><span class="tok-p">[</span><span class="tok-mi">0</span><span class="tok-p">];</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Podemos añadir elementos sobre la marcha y en la posiciones que queramos (aunque se recomienda añadir los elementos en posiciones secuenciales).</p>
</div>
<div class="listingblock">
<div class="title">Accediendo a arrays - <a href="http://jsbin.com/zegepa/2/edit?js" class="bare">http://jsbin.com/zegepa/2/edit?js</a></div>
<div class="content">
<pre class="pygments highlight"><code data-lang="javascript"><span class="tok-nx">tresTipos</span><span class="tok-p">[</span><span class="tok-mi">3</span><span class="tok-p">]</span> <span class="tok-o">=</span> <span class="tok-mi">15</span><span class="tok-p">;</span>
<span class="tok-nx">tresTipos</span><span class="tok-p">[</span><span class="tok-nx">tresTipos</span><span class="tok-p">.</span><span class="tok-nx">length</span><span class="tok-p">]</span> <span class="tok-o">=</span> <span class="tok-s2">&quot;Bruce&quot;</span><span class="tok-p">;</span>
<span class="tok-kd">var</span> <span class="tok-nx">longitud2</span> <span class="tok-o">=</span> <span class="tok-nx">tresTipos</span><span class="tok-p">.</span><span class="tok-nx">length</span><span class="tok-p">;</span> <span class="tok-c1">// 5</span>
<span class="tok-nx">tresTipos</span><span class="tok-p">[</span><span class="tok-mi">8</span><span class="tok-p">]</span> <span class="tok-o">=</span> <span class="tok-s2">&quot;Wayne&quot;</span><span class="tok-p">;</span>
<span class="tok-kd">var</span> <span class="tok-nx">longitud3</span> <span class="tok-o">=</span> <span class="tok-nx">tresTipos</span><span class="tok-p">.</span><span class="tok-nx">length</span><span class="tok-p">;</span> <span class="tok-c1">// 9</span>
<span class="tok-kd">var</span> <span class="tok-nx">nada</span> <span class="tok-o">=</span> <span class="tok-nx">tresTipos</span><span class="tok-p">[</span><span class="tok-mi">7</span><span class="tok-p">];</span> <span class="tok-c1">// undefined</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Cabe destacar que si accedemos a un elemento que no contiene ningún dato obtendremos <code>undefined</code>.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="title">Autoevaluación</div>
<div class="paragraph">
<p>¿Sabes cual es el contenido del array <code>tiposTres</code> tras ejecutar todas las instrucciones? <span class="footnote">[<a id="_footnoteref_8" class="footnote" href="#_footnote_8" title="View footnote.">8</a>]</span></p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Por lo tanto, si añadimos elementos en posiciones mayores al tamaño del array, éste crecerá con valores <code>undefined</code> hasta el elemento que añadamos.</p>
</div>
<div class="paragraph">
<p>Si en algún momento quisiéramos eliminar un elemento del array, hemos de usar el operador <code>delete</code> sobre el elemento en cuestión.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="javascript"><span class="tok-k">delete</span> <span class="tok-nx">tresTipos</span><span class="tok-p">[</span><span class="tok-mi">1</span><span class="tok-p">];</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>El problema es que <code>delete</code> deja el hueco, y por tanto, la longitud del array no se ve reducida, asignándole <code>undefined</code> al elemento en cuestión.</p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Array de palabras</div>
<div class="paragraph">
<p>Al trabajar con una cadena de texto, una operación que se utiliza mucho es, dividirla en trozos a partir de un separador. Al utilizar el método <code>String.split(separador)</code>, éste devolverá un array de cadenas con cada uno de los trozos.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="javascript"><span class="tok-kd">var</span> <span class="tok-nx">frase</span> <span class="tok-o">=</span> <span class="tok-s2">&quot;Yo soy Batman&quot;</span><span class="tok-p">;</span>
<span class="tok-kd">var</span> <span class="tok-nx">arrayPalabras</span> <span class="tok-o">=</span> <span class="tok-nx">frase</span><span class="tok-p">.</span><span class="tok-nx">split</span><span class="tok-p">(</span><span class="tok-s2">&quot; &quot;</span><span class="tok-p">);</span>
<span class="tok-kd">var</span> <span class="tok-nx">yo</span> <span class="tok-o">=</span> <span class="tok-nx">arrayPalabras</span><span class="tok-p">[</span><span class="tok-mi">0</span><span class="tok-p">];</span>
<span class="tok-kd">var</span> <span class="tok-nx">soy</span> <span class="tok-o">=</span> <span class="tok-nx">arrayPalabras</span><span class="tok-p">[</span><span class="tok-mi">1</span><span class="tok-p">];</span>
<span class="tok-kd">var</span> <span class="tok-nx">Batman</span> <span class="tok-o">=</span> <span class="tok-nx">arrayPalabras</span><span class="tok-p">[</span><span class="tok-mi">2</span><span class="tok-p">];</span></code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_manipulación">2.9.1. Manipulación</h4>
<div class="paragraph">
<p>Los arrays soportan los siguientes métodos para trabajar con elementos individuales:</p>
</div>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 25%;">
<col style="width: 75%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-center valign-middle">Métodos</th>
<th class="tableblock halign-left valign-top">Propósito</th>
</tr>
</thead>
<tbody>
<tr>
<th class="tableblock halign-center valign-middle"><p class="tableblock">pop()</p></th>
<td class="tableblock halign-left valign-top"><p class="tableblock">Extrae y devuelve el último elemento del array</p></td>
</tr>
<tr>
<th class="tableblock halign-center valign-middle"><p class="tableblock">push(<em>elemento</em>)</p></th>
<td class="tableblock halign-left valign-top"><p class="tableblock">Añade el <em>elemento</em> en la última posición</p></td>
</tr>
<tr>
<th class="tableblock halign-center valign-middle"><p class="tableblock">shift()</p></th>
<td class="tableblock halign-left valign-top"><p class="tableblock">Extrae y devuelve el primer elemento del array</p></td>
</tr>
<tr>
<th class="tableblock halign-center valign-middle"><p class="tableblock">unshift(<em>elemento</em>)</p></th>
<td class="tableblock halign-left valign-top"><p class="tableblock">Añade el <em>elemento</em> en la primera posición</p></td>
</tr>
</tbody>
</table>
<div class="listingblock">
<div class="title">Modificando un array - <a href="http://jsbin.com/kefexa/6/edit?js" class="bare">http://jsbin.com/kefexa/6/edit?js</a></div>
<div class="content">
<pre class="pygments highlight"><code data-lang="javascript"><span class="tok-kd">var</span> <span class="tok-nx">notas</span> <span class="tok-o">=</span> <span class="tok-p">[</span><span class="tok-s1">&#39;Suspenso&#39;</span><span class="tok-p">,</span> <span class="tok-s1">&#39;Aprobado&#39;</span><span class="tok-p">,</span> <span class="tok-s1">&#39;Bien&#39;</span><span class="tok-p">,</span> <span class="tok-s1">&#39;Notable&#39;</span><span class="tok-p">,</span> <span class="tok-s1">&#39;Sobresaliente&#39;</span><span class="tok-p">];</span>

<span class="tok-nx">notas</span><span class="tok-p">.</span><span class="tok-nx">push</span><span class="tok-p">(</span><span class="tok-s1">&#39;Matrícula de Honor&#39;</span><span class="tok-p">);</span>
<span class="tok-kd">var</span> <span class="tok-nx">matricula</span> <span class="tok-o">=</span> <span class="tok-nx">notas</span><span class="tok-p">.</span><span class="tok-nx">pop</span><span class="tok-p">();</span> <span class="tok-c1">// &quot;Matrícula de Honor&quot;</span>
<span class="tok-kd">var</span> <span class="tok-nx">suspenso</span> <span class="tok-o">=</span> <span class="tok-nx">notas</span><span class="tok-p">.</span><span class="tok-nx">shift</span><span class="tok-p">();</span> <span class="tok-c1">// &quot;Suspenso&quot;</span>
<span class="tok-nx">notas</span><span class="tok-p">.</span><span class="tok-nx">unshift</span><span class="tok-p">(</span><span class="tok-s1">&#39;Suspendido&#39;</span><span class="tok-p">);</span>

<span class="tok-nx">console</span><span class="tok-p">.</span><span class="tok-nx">log</span><span class="tok-p">(</span><span class="tok-nx">notas</span><span class="tok-p">);</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Además, podemos usar los siguiente métodos que modifican los arrays en su conjunto:</p>
</div>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 25%;">
<col style="width: 75%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-center valign-middle">Métodos</th>
<th class="tableblock halign-left valign-top">Propósito</th>
</tr>
</thead>
<tbody>
<tr>
<th class="tableblock halign-center valign-middle"><p class="tableblock">concat(<em>array2</em>[,&#8230;&#8203;, <em>arrayN</em>])</p></th>
<td class="tableblock halign-left valign-top"><p class="tableblock">Une dos o más arrays</p></td>
</tr>
<tr>
<th class="tableblock halign-center valign-middle"><p class="tableblock">join(<em>separador</em>)</p></th>
<td class="tableblock halign-left valign-top"><p class="tableblock">Concatena las partes de un array en una cadena, indicándole como parámetro el <em>separador</em> a utilizar</p></td>
</tr>
<tr>
<th class="tableblock halign-center valign-middle"><p class="tableblock">reverse()</p></th>
<td class="tableblock halign-left valign-top"><p class="tableblock">Invierte el orden de los elementos del array, mutando el array</p></td>
</tr>
<tr>
<th class="tableblock halign-center valign-middle"><p class="tableblock">sort()</p></th>
<td class="tableblock halign-left valign-top"><p class="tableblock">Ordena los elementos del array alfabéticamente, mutando el array</p></td>
</tr>
<tr>
<th class="tableblock halign-center valign-middle"><p class="tableblock">sort(<em>fcomparacion</em>)</p></th>
<td class="tableblock halign-left valign-top"><p class="tableblock">Ordena los elementos del array mediante la función <em>fcomparacion</em></p></td>
</tr>
<tr>
<th class="tableblock halign-center valign-middle"><p class="tableblock">slice(<em>inicio</em>, <em>fin</em>)</p></th>
<td class="tableblock halign-left valign-top"><p class="tableblock">Devuelve un nuevo array con una copia con los elementos comprendidos entre <em>inicio</em> y <em>fin</em> (con índice <code>0</code>, y sin incluir <em>fin</em>).</p></td>
</tr>
<tr>
<th class="tableblock halign-center valign-middle"><p class="tableblock">splice(<em>índice</em>, <em>cantidad</em>, <em>elem1</em>[, &#8230;&#8203;, <em>elemN</em>])</p></th>
<td class="tableblock halign-left valign-top"><p class="tableblock">Modifica el contenido del array, añadiendo nuevos elementos mientras elimina los antiguos seleccionando a partir de <em>índice</em> la <em>cantidad</em> de elementos indicados. Si <em>cantidad</em> es 0, sólo inserta los nuevos elementos.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Hay que tener en cuenta que los métodos mutables modifican el array sobre el que se realiza la operación:</p>
</div>
<div class="listingblock">
<div class="title">Modificando un array - <a href="http://jsbin.com/kefexa/6/edit?js" class="bare">http://jsbin.com/kefexa/6/edit?js</a></div>
<div class="content">
<pre class="pygments highlight"><code data-lang="javascript"><span class="tok-kd">var</span> <span class="tok-nx">notas</span> <span class="tok-o">=</span> <span class="tok-p">[</span><span class="tok-s1">&#39;Suspenso&#39;</span><span class="tok-p">,</span> <span class="tok-s1">&#39;Aprobado&#39;</span><span class="tok-p">,</span> <span class="tok-s1">&#39;Bien&#39;</span><span class="tok-p">,</span> <span class="tok-s1">&#39;Notable&#39;</span><span class="tok-p">,</span> <span class="tok-s1">&#39;Sobresaliente&#39;</span><span class="tok-p">];</span>

<span class="tok-nx">notas</span><span class="tok-p">.</span><span class="tok-nx">reverse</span><span class="tok-p">();</span>
<span class="tok-nx">console</span><span class="tok-p">.</span><span class="tok-nx">log</span><span class="tok-p">(</span><span class="tok-nx">notas</span><span class="tok-p">);</span>  <span class="tok-c1">// [&quot;Sobresaliente&quot;, &quot;Notable&quot;, &quot;Bien&quot;, &quot;Aprobado&quot;, &quot;Suspenso&quot;]</span>

<span class="tok-nx">notas</span><span class="tok-p">.</span><span class="tok-nx">sort</span><span class="tok-p">();</span>
<span class="tok-nx">console</span><span class="tok-p">.</span><span class="tok-nx">log</span><span class="tok-p">(</span><span class="tok-nx">notas</span><span class="tok-p">);</span>  <span class="tok-c1">// [&quot;Aprobado&quot;, &quot;Bien&quot;, &quot;Notable&quot;, &quot;Sobresaliente&quot;, &quot;Suspenso&quot;]</span>

<span class="tok-nx">notas</span><span class="tok-p">.</span><span class="tok-nx">splice</span><span class="tok-p">(</span><span class="tok-mi">0</span><span class="tok-p">,</span> <span class="tok-mi">4</span><span class="tok-p">,</span> <span class="tok-s2">&quot;Apto&quot;</span><span class="tok-p">);</span> <i class="conum" data-value="1"></i><b>(1)</b>
<span class="tok-nx">console</span><span class="tok-p">.</span><span class="tok-nx">log</span><span class="tok-p">(</span><span class="tok-nx">notas</span><span class="tok-p">);</span> <span class="tok-c1">// [&quot;Apto&quot;, &quot;Suspenso&quot;]</span></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>A partir de la posición 0, borra 4 elementos y añade <code>"Apto"</code>.</td>
</tr>
</table>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="title">Autoevaluación</div>
<div class="paragraph">
<p>¿Cual es el valor de la variables <code>iguales</code>? <span class="footnote">[<a id="_footnoteref_9" class="footnote" href="#_footnote_9" title="View footnote.">9</a>]</span></p>
</div>
<div class="listingblock">
<div class="title">Arrays Autoevaluación - <a href="http://jsbin.com/gawaju/1/edit?js" class="bare">http://jsbin.com/gawaju/1/edit?js</a></div>
<div class="content">
<pre class="pygments highlight"><code data-lang="javascript"><span class="tok-kd">var</span> <span class="tok-nx">nombreChicos</span> <span class="tok-o">=</span> <span class="tok-p">[</span><span class="tok-s2">&quot;Juan&quot;</span><span class="tok-p">,</span> <span class="tok-s2">&quot;Antonio&quot;</span><span class="tok-p">];</span>
<span class="tok-nx">nombreChicos</span><span class="tok-p">.</span><span class="tok-nx">push</span><span class="tok-p">(</span><span class="tok-s2">&quot;Pedro&quot;</span><span class="tok-p">);</span>
<span class="tok-kd">var</span> <span class="tok-nx">nombreChicas</span> <span class="tok-o">=</span> <span class="tok-p">[</span><span class="tok-s2">&quot;Ana&quot;</span><span class="tok-p">,</span> <span class="tok-s2">&quot;Laura&quot;</span><span class="tok-p">];</span>
<span class="tok-kd">var</span> <span class="tok-nx">nombres</span> <span class="tok-o">=</span> <span class="tok-nx">nombreChicos</span><span class="tok-p">.</span><span class="tok-nx">concat</span><span class="tok-p">(</span><span class="tok-nx">nombreChicas</span><span class="tok-p">);</span>
<span class="tok-kd">var</span> <span class="tok-nx">separadoConGuiones</span> <span class="tok-o">=</span> <span class="tok-nx">nombres</span><span class="tok-p">.</span><span class="tok-nx">join</span><span class="tok-p">(</span><span class="tok-s2">&quot;-&quot;</span><span class="tok-p">);</span>
<span class="tok-nx">nombres</span><span class="tok-p">.</span><span class="tok-nx">reverse</span><span class="tok-p">();</span>
<span class="tok-kd">var</span> <span class="tok-nx">alfa</span> <span class="tok-o">=</span> <span class="tok-nx">nombres</span><span class="tok-p">[</span><span class="tok-mi">3</span><span class="tok-p">];</span>
<span class="tok-nx">nombres</span><span class="tok-p">.</span><span class="tok-nx">sort</span><span class="tok-p">();</span>
<span class="tok-kd">var</span> <span class="tok-nx">iguales</span> <span class="tok-o">=</span> <span class="tok-p">(</span><span class="tok-nx">alfa</span> <span class="tok-o">==</span> <span class="tok-nx">nombres</span><span class="tok-p">[</span><span class="tok-mi">2</span><span class="tok-p">]);</span></code></pre>
</div>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Una operación muy usual es querer ordenar un array de objetos por un determinado campo del objeto. Supongamos que tenemos los siguientes datos:</p>
</div>
<div class="listingblock">
<div class="title">Ordenando Array de Objetos - <a href="http://jsbin.com/toluxe/edit?js" class="bare">http://jsbin.com/toluxe/edit?js</a></div>
<div class="content">
<pre class="pygments highlight"><code data-lang="javascript"><span class="tok-kd">var</span> <span class="tok-nx">personas</span> <span class="tok-o">=</span> <span class="tok-p">[</span>
  <span class="tok-p">{</span><span class="tok-nx">nombre</span><span class="tok-o">:</span><span class="tok-s2">&quot;Aitor&quot;</span><span class="tok-p">,</span> <span class="tok-nx">apellido1</span><span class="tok-o">:</span><span class="tok-s2">&quot;Medrano&quot;</span><span class="tok-p">},</span>
  <span class="tok-p">{</span><span class="tok-nx">nombre</span><span class="tok-o">:</span><span class="tok-s2">&quot;Domingo&quot;</span><span class="tok-p">,</span> <span class="tok-nx">apellido1</span><span class="tok-o">:</span><span class="tok-s2">&quot;Gallardo&quot;</span><span class="tok-p">},</span>
  <span class="tok-p">{</span><span class="tok-nx">nombre</span><span class="tok-o">:</span><span class="tok-s2">&quot;Alejandro&quot;</span><span class="tok-p">,</span> <span class="tok-nx">apellido1</span><span class="tok-o">:</span><span class="tok-s2">&quot;Such&quot;</span><span class="tok-p">}</span>
<span class="tok-p">];</span>

<span class="tok-nx">personas</span><span class="tok-p">.</span><span class="tok-nx">sort</span><span class="tok-p">(</span><span class="tok-kd">function</span><span class="tok-p">(</span><span class="tok-nx">a</span><span class="tok-p">,</span><span class="tok-nx">b</span><span class="tok-p">)</span> <span class="tok-p">{</span>
  <span class="tok-k">if</span> <span class="tok-p">(</span><span class="tok-nx">a</span><span class="tok-p">.</span><span class="tok-nx">nombre</span> <span class="tok-o">&lt;</span> <span class="tok-nx">b</span><span class="tok-p">.</span><span class="tok-nx">nombre</span><span class="tok-p">)</span>
    <span class="tok-k">return</span> <span class="tok-o">-</span><span class="tok-mi">1</span><span class="tok-p">;</span>
  <span class="tok-k">if</span> <span class="tok-p">(</span><span class="tok-nx">a</span><span class="tok-p">.</span><span class="tok-nx">nombre</span> <span class="tok-o">&gt;</span> <span class="tok-nx">b</span><span class="tok-p">.</span><span class="tok-nx">nombre</span><span class="tok-p">)</span>
    <span class="tok-k">return</span> <span class="tok-mi">1</span><span class="tok-p">;</span>
  <span class="tok-k">return</span> <span class="tok-mi">0</span><span class="tok-p">;</span>
<span class="tok-p">});</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Por lo tanto, la función de comparación siempre tendrá la siguiente forma:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="javascript"><span class="tok-kd">function</span> <span class="tok-nx">compare</span><span class="tok-p">(</span><span class="tok-nx">a</span><span class="tok-p">,</span> <span class="tok-nx">b</span><span class="tok-p">)</span> <span class="tok-p">{</span>
  <span class="tok-k">if</span> <span class="tok-p">(</span><span class="tok-nx">a</span> <span class="tok-nx">es</span> <span class="tok-nx">menor</span> <span class="tok-nx">que</span> <span class="tok-nx">b</span> <span class="tok-nx">seg</span><span class="tok-err">ú</span><span class="tok-nx">n</span> <span class="tok-nx">criterio</span> <span class="tok-nx">de</span> <span class="tok-nx">ordenamiento</span><span class="tok-p">)</span> <span class="tok-p">{</span>
    <span class="tok-k">return</span> <span class="tok-o">-</span><span class="tok-mi">1</span><span class="tok-p">;</span>
  <span class="tok-p">}</span>
  <span class="tok-k">if</span> <span class="tok-p">(</span><span class="tok-nx">a</span> <span class="tok-nx">es</span> <span class="tok-nx">mayor</span> <span class="tok-nx">que</span> <span class="tok-nx">b</span> <span class="tok-nx">seg</span><span class="tok-err">ú</span><span class="tok-nx">n</span> <span class="tok-nx">criterio</span> <span class="tok-nx">de</span> <span class="tok-nx">ordenamiento</span><span class="tok-p">)</span> <span class="tok-p">{</span>
    <span class="tok-k">return</span> <span class="tok-mi">1</span><span class="tok-p">;</span>
  <span class="tok-p">}</span>
  <span class="tok-c1">// a debe ser igual b</span>
  <span class="tok-k">return</span> <span class="tok-mi">0</span><span class="tok-p">;</span>
<span class="tok-p">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Finalmente, vamos a estudiar los métodos <code>slice</code> y <code>splice</code> que son menos comunes.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="javascript"><span class="tok-kd">var</span> <span class="tok-nx">frutas</span> <span class="tok-o">=</span> <span class="tok-p">[</span><span class="tok-s2">&quot;naranja&quot;</span><span class="tok-p">,</span> <span class="tok-s2">&quot;pera&quot;</span><span class="tok-p">,</span> <span class="tok-s2">&quot;manzana&quot;</span><span class="tok-p">,</span> <span class="tok-s2">&quot;uva&quot;</span><span class="tok-p">,</span> <span class="tok-s2">&quot;fresa&quot;</span><span class="tok-p">,</span> <span class="tok-s2">&quot;naranja&quot;</span><span class="tok-p">];</span>
<span class="tok-kd">var</span> <span class="tok-nx">arrayUvaFresa</span> <span class="tok-o">=</span> <span class="tok-nx">frutas</span><span class="tok-p">.</span><span class="tok-nx">slice</span><span class="tok-p">(</span><span class="tok-mi">3</span><span class="tok-p">,</span> <span class="tok-mi">5</span><span class="tok-p">);</span> <i class="conum" data-value="1"></i><b>(1)</b>
<span class="tok-kd">var</span> <span class="tok-nx">uvaFresa</span> <span class="tok-o">=</span> <span class="tok-nx">frutas</span><span class="tok-p">.</span><span class="tok-nx">splice</span><span class="tok-p">(</span><span class="tok-mi">3</span><span class="tok-p">,</span> <span class="tok-mi">2</span><span class="tok-p">,</span> <span class="tok-s2">&quot;piña&quot;</span><span class="tok-p">);</span> <i class="conum" data-value="2"></i><b>(2)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Crea un nuevo array con los elementos comprendidos entre el tercero y el quinto, quedando <code>["uva", "fresa"]</code></td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Tras borrar dos elementos a partir de la posición tres, añade <code>piña</code>. En <code>uvaFresa</code> se almacena un array con los elementos eliminados (<code>["uva", "fresa"]</code>), mientras que <code>frutas</code> se queda con <code>["naranja", "pera", "manzana", "piña", "naranja"]</code>.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Si lo que queremos es buscar un determinado elemento dentro de un array:</p>
</div>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 25%;">
<col style="width: 75%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-center valign-middle">Método</th>
<th class="tableblock halign-left valign-top">Propósito</th>
</tr>
</thead>
<tbody>
<tr>
<th class="tableblock halign-center valign-middle"><p class="tableblock">indexOf(<em>elem</em>[, <em>inicio</em>])</p></th>
<td class="tableblock halign-left valign-top"><p class="tableblock">Devuelve la primera posición (0..n-1) del elemento comenzando desde el principio o desde <em>inicio</em></p></td>
</tr>
<tr>
<th class="tableblock halign-center valign-middle"><p class="tableblock">lastIndexOf(<em>elem</em>[, <em>inicio</em>])</p></th>
<td class="tableblock halign-left valign-top"><p class="tableblock">Igual que <code>indexOf</code> pero buscando desde el final hasta el principio</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>En ambos casos, si no encuentra el elemento, devuelve <code>-1</code>.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="title">Autoevaluación</div>
<div class="paragraph">
<p>¿Cual es el valor de la variable <code>ultima</code>?</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="javascript"><span class="tok-kd">var</span> <span class="tok-nx">frutas</span> <span class="tok-o">=</span> <span class="tok-p">[</span><span class="tok-s2">&quot;naranja&quot;</span><span class="tok-p">,</span> <span class="tok-s2">&quot;pera&quot;</span><span class="tok-p">,</span> <span class="tok-s2">&quot;manzana&quot;</span><span class="tok-p">,</span> <span class="tok-s2">&quot;uva&quot;</span><span class="tok-p">,</span> <span class="tok-s2">&quot;fresa&quot;</span><span class="tok-p">,</span> <span class="tok-s2">&quot;naranja&quot;</span><span class="tok-p">];</span>
<span class="tok-kd">var</span> <span class="tok-nx">primera</span> <span class="tok-o">=</span> <span class="tok-nx">frutas</span><span class="tok-p">.</span><span class="tok-nx">indexOf</span><span class="tok-p">(</span><span class="tok-s2">&quot;naranja&quot;</span><span class="tok-p">);</span>
<span class="tok-kd">var</span> <span class="tok-nx">ultima</span> <span class="tok-o">=</span> <span class="tok-nx">frutas</span><span class="tok-p">.</span><span class="tok-nx">lastIndexOf</span><span class="tok-p">(</span><span class="tok-s2">&quot;naranja&quot;</span><span class="tok-p">);</span></code></pre>
</div>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_iteración">2.9.2. Iteración</h4>
<div class="paragraph">
<p>Los siguiente métodos aceptan una función <em>callback</em> como primer argumento e invocan dicha función para cada elemento del array. La función que le pasamos a los métodos reciben tres parámetros:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>El valor del elemento del array</p>
</li>
<li>
<p>El índice del elemento</p>
</li>
<li>
<p>El propio array</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>La mayoría de las veces sólo necesitamos utilizar el valor.</p>
</div>
<div class="paragraph">
<p>Los métodos que podemos utilizar son:</p>
</div>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 25%;">
<col style="width: 75%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-center valign-middle">Método</th>
<th class="tableblock halign-left valign-top">Propósito</th>
</tr>
</thead>
<tbody>
<tr>
<th class="tableblock halign-center valign-middle"><p class="tableblock">forEach(<em>función</em>)</p></th>
<td class="tableblock halign-left valign-top"><p class="tableblock">Ejecuta la función para cada elemento del array</p></td>
</tr>
<tr>
<th class="tableblock halign-center valign-middle"><p class="tableblock">map(<em>función</em>)</p></th>
<td class="tableblock halign-left valign-top"><p class="tableblock">Ejecuta la función para cada elemento del array, y el nuevo valor se inserta como un elemento del nuevo array que devuelve.</p></td>
</tr>
<tr>
<th class="tableblock halign-center valign-middle"><p class="tableblock">every(<em>función</em>)</p></th>
<td class="tableblock halign-left valign-top"><p class="tableblock">Verdadero si la función se cumple para todos los valores. Falso en caso contrario (Similar a una conjunción &#8594; Y)</p></td>
</tr>
<tr>
<th class="tableblock halign-center valign-middle"><p class="tableblock">some(<em>función</em>)</p></th>
<td class="tableblock halign-left valign-top"><p class="tableblock">Verdadero si la función se cumple para al menos un valor. Falso si no se cumple para ninguno de los elementos (Similar a un disyunción &#8594; O)</p></td>
</tr>
<tr>
<th class="tableblock halign-center valign-middle"><p class="tableblock">filter(<em>función</em>)</p></th>
<td class="tableblock halign-left valign-top"><p class="tableblock">Devuelve un nuevo array con los elementos que cumplen la función</p></td>
</tr>
<tr>
<th class="tableblock halign-center valign-middle"><p class="tableblock">reduce(<em>función</em>)</p></th>
<td class="tableblock halign-left valign-top"><p class="tableblock">Ejecuta la función para un acumulador y cada valor del array (de inicio a fin) se reduce a un único valor</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>A continuación vamos a estudiar algunos de estos métodos mediante ejemplos.</p>
</div>
<div class="paragraph">
<p>Si queremos pasar a mayúsculas todos los elementos del array, podemos usar la función <code>map()</code>, la cual se ejecuta para cada elemento del array:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="javascript"><span class="tok-kd">var</span> <span class="tok-nx">heroes</span> <span class="tok-o">=</span> <span class="tok-p">[</span><span class="tok-s2">&quot;Batman&quot;</span><span class="tok-p">,</span> <span class="tok-s2">&quot;Superman&quot;</span><span class="tok-p">,</span> <span class="tok-s2">&quot;Ironman&quot;</span><span class="tok-p">,</span> <span class="tok-s2">&quot;Thor&quot;</span><span class="tok-p">];</span>

<span class="tok-kd">function</span> <span class="tok-nx">mayus</span><span class="tok-p">(</span><span class="tok-nx">valor</span><span class="tok-p">,</span> <span class="tok-nx">indice</span><span class="tok-p">,</span> <span class="tok-nx">array</span><span class="tok-p">)</span> <span class="tok-p">{</span>
  <span class="tok-k">return</span> <span class="tok-nx">valor</span><span class="tok-p">.</span><span class="tok-nx">toUpperCase</span><span class="tok-p">();</span>
<span class="tok-p">}</span>

<span class="tok-kd">var</span> <span class="tok-nx">heroesMayus</span> <span class="tok-o">=</span> <span class="tok-nx">heroes</span><span class="tok-p">.</span><span class="tok-nx">map</span><span class="tok-p">(</span><span class="tok-nx">mayus</span><span class="tok-p">);</span>
<span class="tok-nx">console</span><span class="tok-p">.</span><span class="tok-nx">log</span><span class="tok-p">(</span><span class="tok-nx">heroesMayus</span><span class="tok-p">);</span> <span class="tok-c1">// [&quot;BATMAN&quot;, &quot;SUPERMAN&quot;, &quot;IRONMAN&quot;, &quot;THOR&quot;]</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>O si queremos mostrar todos los elementos del array, podemos hacer uso del método <code>forEach</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="javascript"><span class="tok-kd">var</span> <span class="tok-nx">heroes</span> <span class="tok-o">=</span> <span class="tok-p">[</span><span class="tok-s2">&quot;Batman&quot;</span><span class="tok-p">,</span> <span class="tok-s2">&quot;Superman&quot;</span><span class="tok-p">,</span> <span class="tok-s2">&quot;Ironman&quot;</span><span class="tok-p">,</span> <span class="tok-s2">&quot;Thor&quot;</span><span class="tok-p">];</span>
<span class="tok-nx">heroes</span><span class="tok-p">.</span><span class="tok-nx">forEach</span><span class="tok-p">(</span><span class="tok-kd">function</span><span class="tok-p">(</span><span class="tok-nx">valor</span><span class="tok-p">,</span> <span class="tok-nx">indice</span><span class="tok-p">)</span> <span class="tok-p">{</span>
  <span class="tok-nx">console</span><span class="tok-p">.</span><span class="tok-nx">log</span><span class="tok-p">(</span><span class="tok-s2">&quot;[&quot;</span><span class="tok-p">,</span> <span class="tok-nx">indice</span><span class="tok-p">,</span> <span class="tok-s2">&quot;]=&quot;</span><span class="tok-p">,</span> <span class="tok-nx">valor</span><span class="tok-p">);</span>
<span class="tok-p">});</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>O si tenemos un array con números también podemos sumarlos mediante <code>forEach</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="javascript"><span class="tok-kd">var</span> <span class="tok-nx">numeros</span> <span class="tok-o">=</span> <span class="tok-p">[</span><span class="tok-mi">1</span><span class="tok-p">,</span> <span class="tok-mi">3</span><span class="tok-p">,</span> <span class="tok-mi">5</span><span class="tok-p">,</span> <span class="tok-mi">7</span><span class="tok-p">,</span> <span class="tok-mi">9</span><span class="tok-p">];</span>
<span class="tok-kd">var</span> <span class="tok-nx">suma</span> <span class="tok-o">=</span> <span class="tok-mi">0</span><span class="tok-p">;</span>
<span class="tok-nx">numeros</span><span class="tok-p">.</span><span class="tok-nx">forEach</span><span class="tok-p">(</span><span class="tok-kd">function</span><span class="tok-p">(</span><span class="tok-nx">valor</span><span class="tok-p">)</span> <span class="tok-p">{</span>
  <span class="tok-nx">suma</span> <span class="tok-o">+=</span> <span class="tok-nx">valor</span>
<span class="tok-p">});</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Si queremos comprobar si todos los elementos de un array son cadenas, podemos utilizar el método <code>every()</code>. Para ello, crearemos una función <code>esCadena</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="javascript"><span class="tok-kd">function</span> <span class="tok-nx">esCadena</span><span class="tok-p">(</span><span class="tok-nx">valor</span><span class="tok-p">,</span> <span class="tok-nx">indice</span><span class="tok-p">,</span> <span class="tok-nx">array</span><span class="tok-p">)</span> <span class="tok-p">{</span>
  <span class="tok-k">return</span> <span class="tok-k">typeof</span> <span class="tok-nx">valor</span> <span class="tok-o">===</span> <span class="tok-s2">&quot;string&quot;</span><span class="tok-p">;</span>
<span class="tok-p">}</span>

<span class="tok-nx">console</span><span class="tok-p">.</span><span class="tok-nx">log</span><span class="tok-p">(</span><span class="tok-nx">frutas</span><span class="tok-p">.</span><span class="tok-nx">every</span><span class="tok-p">(</span><span class="tok-nx">esCadena</span><span class="tok-p">));</span> <span class="tok-c1">// true</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Si tenemos un array con datos mezclados con textos y números, podemos quedarnos con los elementos que son cadenas mediante la función <code>filter()</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="javascript"><span class="tok-kd">var</span> <span class="tok-nx">mezcladillo</span> <span class="tok-o">=</span> <span class="tok-p">[</span><span class="tok-mi">1</span><span class="tok-p">,</span> <span class="tok-s2">&quot;dos&quot;</span><span class="tok-p">,</span> <span class="tok-mi">3</span><span class="tok-p">,</span> <span class="tok-s2">&quot;cuatro&quot;</span><span class="tok-p">,</span> <span class="tok-mi">5</span><span class="tok-p">,</span> <span class="tok-s2">&quot;seis&quot;</span><span class="tok-p">];</span>

<span class="tok-nx">console</span><span class="tok-p">.</span><span class="tok-nx">log</span><span class="tok-p">(</span><span class="tok-nx">mezcladillo</span><span class="tok-p">.</span><span class="tok-nx">filter</span><span class="tok-p">(</span><span class="tok-nx">esCadena</span><span class="tok-p">));</span> <span class="tok-c1">// [&quot;dos&quot;, &quot;cuatro&quot;, &quot;seis&quot;]</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Finalmente, mediante la función <code>reduce</code> podemos realizar un cálculo sobre los elementos del array, por ejemplo, podemos contar cuantas veces aparece una ocurrencia dentro de un array o sumar sus elementos. Para ello, la función recibe dos parámetros con el valor anterior y el actual:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="javascript"><span class="tok-kd">var</span> <span class="tok-nx">numeros</span> <span class="tok-o">=</span> <span class="tok-p">[</span><span class="tok-mi">1</span><span class="tok-p">,</span> <span class="tok-mi">3</span><span class="tok-p">,</span> <span class="tok-mi">5</span><span class="tok-p">,</span> <span class="tok-mi">7</span><span class="tok-p">,</span> <span class="tok-mi">9</span><span class="tok-p">];</span>
<span class="tok-kd">var</span> <span class="tok-nx">suma</span> <span class="tok-o">=</span> <span class="tok-nx">numeros</span><span class="tok-p">.</span><span class="tok-nx">reduce</span><span class="tok-p">(</span><span class="tok-kd">function</span><span class="tok-p">(</span><span class="tok-nx">anterior</span><span class="tok-p">,</span> <span class="tok-nx">actual</span><span class="tok-p">)</span> <span class="tok-p">{</span>
  <span class="tok-k">return</span> <span class="tok-nx">anterior</span> <span class="tok-o">+</span> <span class="tok-nx">actual</span>
<span class="tok-p">});</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>En el primer paso, como no hay valor anterior, se pasan el primer y el segundo elemento del array (los valores 1 y 3). En siguientes iteraciones, el valor <code>anterior</code> es lo que devuelve el código, y el <code>actual</code> es el siguiente elemento del array. De este modo, estamos cogiendo el valor actual y sumándoselo al valor anterior (el total acumulado)</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="title"><code>arguments</code> a array</div>
<div class="paragraph">
<p>Si queremos convertir el pseudo-array <code>arguments</code> de una función a un array verdadero para poder utilizar sus métodos, podemos hacer uso del prototipo del array, para obtener una copia de los los argumentos:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="javascript"><span class="tok-kd">var</span> <span class="tok-nx">args</span> <span class="tok-o">=</span> <span class="tok-nb">Array</span><span class="tok-p">.</span><span class="tok-nx">prototype</span><span class="tok-p">.</span><span class="tok-nx">slice</span><span class="tok-p">.</span><span class="tok-nx">call</span><span class="tok-p">(</span><span class="tok-nx">arguments</span><span class="tok-p">);</span></code></pre>
</div>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_destructurar">2.10. Destructurar</h3>
<div class="paragraph">
<p>Una novedad que ofrece ES6 es la posibilidad de destructurar tanto arrays como objetos para transformar una estructura de datos compuesta, tales como objetos y arrays, en diferentes datos individuales. Así pues, en vez de asignar una a una las asignaciones para cada variable mediante múltiples sentencias, al destructurar podemos asignar los valores a múltiples variables en una única sentencia.</p>
</div>
<div class="paragraph">
<p>En el caso de los arrays, hemos de asignar un array a las variables entre corchetes (<code>[]</code>):</p>
</div>
<div class="listingblock">
<div class="title">Destructurando de array a variables</div>
<div class="content">
<pre class="pygments highlight"><code data-lang="javascript"><span class="tok-kd">var</span> <span class="tok-nx">numeros</span> <span class="tok-o">=</span> <span class="tok-p">[</span><span class="tok-mi">10</span><span class="tok-p">,</span> <span class="tok-mi">20</span><span class="tok-p">];</span>
<span class="tok-kd">var</span> <span class="tok-p">[</span><span class="tok-nx">n1</span><span class="tok-p">,</span> <span class="tok-nx">n2</span><span class="tok-p">]</span> <span class="tok-o">=</span> <span class="tok-nx">numeros</span><span class="tok-p">;</span>   <span class="tok-c1">// destructurando</span>
<span class="tok-nx">console</span><span class="tok-p">.</span><span class="tok-nx">log</span><span class="tok-p">(</span><span class="tok-nx">n1</span><span class="tok-p">);</span>          <span class="tok-c1">// 10</span>
<span class="tok-nx">console</span><span class="tok-p">.</span><span class="tok-nx">log</span><span class="tok-p">(</span><span class="tok-nx">n2</span><span class="tok-p">);</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>De la misma manera, si queremos extraer los datos de un objeto, lo haremos mediante llaves (<code>{}</code>):</p>
</div>
<div class="listingblock">
<div class="title">Destructurando de objeto a variables</div>
<div class="content">
<pre class="pygments highlight"><code data-lang="javascript"><span class="tok-kd">var</span> <span class="tok-nx">posicion</span> <span class="tok-o">=</span> <span class="tok-p">{</span><span class="tok-nx">x</span><span class="tok-o">:</span> <span class="tok-mi">50</span><span class="tok-p">,</span> <span class="tok-nx">y</span><span class="tok-o">:</span> <span class="tok-mi">100</span><span class="tok-p">};</span>
<span class="tok-kd">var</span> <span class="tok-p">{</span><span class="tok-nx">x</span><span class="tok-p">,</span> <span class="tok-nx">y</span><span class="tok-p">}</span> <span class="tok-o">=</span> <span class="tok-nx">posicion</span><span class="tok-p">;</span>           <span class="tok-c1">// destructurando</span>
<span class="tok-nx">console</span><span class="tok-p">.</span><span class="tok-nx">log</span><span class="tok-p">(</span><span class="tok-nx">x</span><span class="tok-p">);</span>                  <span class="tok-c1">// 50</span>
<span class="tok-nx">console</span><span class="tok-p">.</span><span class="tok-nx">log</span><span class="tok-p">(</span><span class="tok-nx">y</span><span class="tok-p">);</span>                  <span class="tok-c1">// 100</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>La sintaxis de destructurar también permite emplear su uso como parámetros de las funciones declaración, ya sea un objeto o un array.</p>
</div>
<div class="listingblock">
<div class="title">Destructurando un objeto como parámetro de una función</div>
<div class="content">
<pre class="pygments highlight"><code data-lang="javascript"><span class="tok-nx">persona</span><span class="tok-p">.</span><span class="tok-nx">saluda</span><span class="tok-p">(</span><span class="tok-nx">persona2</span><span class="tok-p">);</span> <i class="conum" data-value="1"></i><b>(1)</b>
<span class="tok-nx">persona</span><span class="tok-p">.</span><span class="tok-nx">saluda</span><span class="tok-p">({</span><span class="tok-nx">nombre</span><span class="tok-p">,</span> <span class="tok-nx">apellido1</span><span class="tok-p">});</span> <i class="conum" data-value="2"></i><b>(2)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Recibe un objeto como parámetro, y por tanto dentro de la función saluda accederá a los elementos mediante <code>persona2.nombre</code> y <code>persona2.apellido1</code></td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Recibe un objeto destructurado como parámetro, y por tanto dentro de la función saluda accederá a los elementos mediante <code>nombre</code> y <code>apellido1</code> directamente</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Más información en <a href="https://developer.mozilla.org/es/docs/Web/JavaScript/Referencia/Operadores/Destructuring_assignment" class="bare">https://developer.mozilla.org/es/docs/Web/JavaScript/Referencia/Operadores/Destructuring_assignment</a></p>
</div>
</div>
<div class="sect2">
<h3 id="_ejercicios_2">2.11. Ejercicios</h3>
<div class="sect3">
<h4 id="__0_4_ptos_ejercicio_21_objeto_usuario">2.11.1. (0.4 ptos) Ejercicio 21. Objeto Usuario</h4>
<div class="paragraph">
<p>A partir del siguiente objeto el cual se crea mediante una función factoría:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="javascript"><span class="tok-kd">function</span> <span class="tok-nx">crearUsuario</span><span class="tok-p">(</span><span class="tok-nx">usu</span><span class="tok-p">,</span> <span class="tok-nx">pas</span><span class="tok-p">)</span> <span class="tok-p">{</span>
  <span class="tok-k">return</span> <span class="tok-p">{</span>
    <span class="tok-nx">login</span><span class="tok-o">:</span> <span class="tok-nx">usu</span><span class="tok-p">,</span>
    <span class="tok-nx">password</span><span class="tok-o">:</span> <span class="tok-nx">pas</span><span class="tok-p">,</span>
    <span class="tok-nx">autenticar</span><span class="tok-o">:</span> <span class="tok-kd">function</span><span class="tok-p">(</span><span class="tok-nx">usu</span><span class="tok-p">,</span> <span class="tok-nx">pas</span><span class="tok-p">)</span> <span class="tok-p">{</span>
      <span class="tok-k">return</span> <span class="tok-k">this</span><span class="tok-p">.</span><span class="tok-nx">login</span> <span class="tok-o">===</span> <span class="tok-nx">usu</span> <span class="tok-o">&amp;&amp;</span> <span class="tok-k">this</span><span class="tok-p">.</span><span class="tok-nx">password</span> <span class="tok-o">==</span> <span class="tok-nx">pas</span><span class="tok-p">;</span>
    <span class="tok-p">}</span>
  <span class="tok-p">};</span>
<span class="tok-p">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Refactoriza el código utilizando una función constructor que haga uso de descriptores de datos y acceso, de manera que no permita consultar el <em>password</em> una vez creado el objeto <code>Usuario</code>.</p>
</div>
<div class="paragraph">
<p>Un ejemplo de ejecución sería:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="javascript"><span class="tok-kd">var</span> <span class="tok-nx">usuario</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-nx">Usuario</span><span class="tok-p">(</span><span class="tok-s2">&quot;l1&quot;</span><span class="tok-p">,</span> <span class="tok-s2">&quot;p1&quot;</span><span class="tok-p">);</span>
<span class="tok-nx">console</span><span class="tok-p">.</span><span class="tok-nx">log</span><span class="tok-p">(</span><span class="tok-s2">&quot;login: &quot;</span> <span class="tok-o">+</span> <span class="tok-nx">usuario</span><span class="tok-p">.</span><span class="tok-nx">login</span><span class="tok-p">);</span> <span class="tok-c1">// l1</span>
<span class="tok-nx">console</span><span class="tok-p">.</span><span class="tok-nx">log</span><span class="tok-p">(</span><span class="tok-s2">&quot;password: &quot;</span> <span class="tok-o">+</span> <span class="tok-nx">usuario</span><span class="tok-p">.</span><span class="tok-nx">password</span><span class="tok-p">);</span> <span class="tok-c1">// undefined</span>
<span class="tok-nx">usuario</span><span class="tok-p">.</span><span class="tok-nx">password</span> <span class="tok-o">=</span> <span class="tok-s2">&quot;p2&quot;</span><span class="tok-p">;</span>
<span class="tok-nx">console</span><span class="tok-p">.</span><span class="tok-nx">log</span><span class="tok-p">(</span><span class="tok-s2">&quot;password: &quot;</span> <span class="tok-o">+</span> <span class="tok-nx">usuario</span><span class="tok-p">.</span><span class="tok-nx">password</span><span class="tok-p">);</span> <span class="tok-c1">// undefined</span>
<span class="tok-nx">console</span><span class="tok-p">.</span><span class="tok-nx">log</span><span class="tok-p">(</span><span class="tok-s2">&quot;auth? &quot;</span> <span class="tok-o">+</span> <span class="tok-nx">usuario</span><span class="tok-p">.</span><span class="tok-nx">autenticar</span><span class="tok-p">(</span><span class="tok-s2">&quot;l1&quot;</span><span class="tok-p">,</span> <span class="tok-s2">&quot;l1&quot;</span><span class="tok-p">));</span> <span class="tok-c1">// false</span>
<span class="tok-nx">console</span><span class="tok-p">.</span><span class="tok-nx">log</span><span class="tok-p">(</span><span class="tok-s2">&quot;auth? &quot;</span> <span class="tok-o">+</span> <span class="tok-nx">usuario</span><span class="tok-p">.</span><span class="tok-nx">autenticar</span><span class="tok-p">(</span><span class="tok-s2">&quot;l1&quot;</span><span class="tok-p">,</span> <span class="tok-s2">&quot;p1&quot;</span><span class="tok-p">));</span> <span class="tok-c1">// true</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>El método <code>autenticar</code> quedará como un método el objeto, es decir, no como una propiedad <em>get/set</em>.</p>
</div>
<div class="paragraph">
<p>El objeto se almacenará en una archivo denominado <code>ej21.js</code>.</p>
</div>
</div>
<div class="sect3">
<h4 id="__0_4_ptos_ejercicio_22_herencia">2.11.2. (0.4 ptos) Ejercicio 22. Herencia</h4>
<div class="paragraph">
<p>Crea un objeto <code>Persona</code> que herede de <code>Usuario</code>, pero que añada atributos para almacenar el <em>nombre</em> y el <em>email</em>.</p>
</div>
<div class="paragraph">
<p>Al recuperar el nombre de una persona, si no tiene ninguno, debe devolver el login del usuario.</p>
</div>
<div class="paragraph">
<p>Tanto el objeto <code>Usuario</code> como el objeto <code>Persona</code> se almacenarán en un archivo denominado <code>ej22.js</code>.</p>
</div>
</div>
<div class="sect3">
<h4 id="__0_3_ptos_ejercicio_23_code_string_repetir_code">2.11.3. (0.3 ptos) Ejercicio 23. <code>String.repetir()</code></h4>
<div class="paragraph">
<p>Define una función <code>repetir</code> dentro del objeto <code>String</code> para que, haciendo uso del prototipo, acepte un entero con el número de ocasiones que tiene que repetir la cadena. Por ejemplo:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="javascript"><span class="tok-nx">console</span><span class="tok-p">.</span><span class="tok-nx">log</span><span class="tok-p">(</span><span class="tok-s2">&quot;Viva JavaScript &quot;</span><span class="tok-p">.</span><span class="tok-nx">repetir</span><span class="tok-p">(</span><span class="tok-mi">3</span><span class="tok-p">));</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>En el caso de recibir un tipo inesperado o negativo, deberá lanzar un error informativo.</p>
</div>
<div class="paragraph">
<p>La función se almacenará en una archivo denominado <code>ej23.js</code>.</p>
</div>
</div>
<div class="sect3">
<h4 id="__0_4_ptos_ejercicio_24_arrays">2.11.4. (0.4 ptos) Ejercicio 24. Arrays</h4>
<div class="paragraph">
<p>Sin utilizar las instrucciones <code>for</code> ni <code>while</code>, realiza las siguientes funciones:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Función <code>reverseCopia(array)</code> que a partir de un array, devuelva una copia del mismo pero en orden inverso (no se puede utilizar el método <code>reverse</code>)</p>
</li>
<li>
<p>Función <code>union(array1, array2 [,&#8230;&#8203;arrayN])</code> que a partir de un número variable de arrays, devuelva un array con la unión de sus elementos.. Cada elemento sólo debe aparecer una única vez.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Por ejemplo:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="javascript"><span class="tok-kd">var</span> <span class="tok-nx">frutas</span> <span class="tok-o">=</span> <span class="tok-p">[</span><span class="tok-s2">&quot;naranja&quot;</span><span class="tok-p">,</span> <span class="tok-s2">&quot;pera&quot;</span><span class="tok-p">,</span> <span class="tok-s2">&quot;manzana&quot;</span><span class="tok-p">,</span> <span class="tok-s2">&quot;uva&quot;</span><span class="tok-p">,</span> <span class="tok-s2">&quot;fresa&quot;</span><span class="tok-p">,</span> <span class="tok-s2">&quot;kiwi&quot;</span><span class="tok-p">];</span>
<span class="tok-kd">var</span> <span class="tok-nx">saturf</span> <span class="tok-o">=</span> <span class="tok-nx">miReverse</span><span class="tok-p">(</span><span class="tok-nx">frutas</span><span class="tok-p">);</span>

<span class="tok-nx">console</span><span class="tok-p">.</span><span class="tok-nx">log</span><span class="tok-p">(</span><span class="tok-nx">frutas</span><span class="tok-p">);</span> <span class="tok-c1">// [&quot;naranja&quot;, &quot;pera&quot;, &quot;manzana&quot;, &quot;uva&quot;, &quot;fresa&quot;, &quot;kiwi&quot;]</span>
<span class="tok-nx">console</span><span class="tok-p">.</span><span class="tok-nx">log</span><span class="tok-p">(</span><span class="tok-nx">saturf</span><span class="tok-p">);</span> <span class="tok-c1">// [&quot;kiwi&quot;, &quot;fresa&quot;, &quot;uva&quot;, &quot;manzana&quot;, &quot;pera&quot;, &quot;naranja&quot;]</span>

<span class="tok-kd">var</span> <span class="tok-nx">zumos</span> <span class="tok-o">=</span> <span class="tok-p">[</span><span class="tok-s2">&quot;piña&quot;</span><span class="tok-p">,</span> <span class="tok-s2">&quot;melocotón&quot;</span><span class="tok-p">,</span> <span class="tok-s2">&quot;manzana&quot;</span><span class="tok-p">,</span> <span class="tok-s2">&quot;naranja&quot;</span><span class="tok-p">];</span>
<span class="tok-kd">var</span> <span class="tok-nx">batidos</span> <span class="tok-o">=</span> <span class="tok-p">[</span><span class="tok-s2">&quot;fresa&quot;</span><span class="tok-p">,</span> <span class="tok-s2">&quot;coco&quot;</span><span class="tok-p">,</span> <span class="tok-s2">&quot;chocolate&quot;</span><span class="tok-p">];</span>

<span class="tok-kd">var</span> <span class="tok-nx">sabores</span> <span class="tok-o">=</span> <span class="tok-nx">union</span><span class="tok-p">(</span><span class="tok-nx">frutas</span><span class="tok-p">,</span> <span class="tok-nx">zumos</span><span class="tok-p">,</span> <span class="tok-nx">batidos</span><span class="tok-p">);</span>
<span class="tok-nx">console</span><span class="tok-p">.</span><span class="tok-nx">log</span><span class="tok-p">(</span><span class="tok-nx">sabores</span><span class="tok-p">);</span> <span class="tok-c1">// [&quot;naranja&quot;, &quot;pera&quot;, &quot;manzana&quot;, &quot;uva&quot;, &quot;fresa&quot;, &quot;kiwi&quot;, &quot;piña&quot;, &quot;melocotón&quot;, &quot;coco&quot;, &quot;chocolate&quot;]</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>La funciones se almacenarán en una archivo denominado <code>ej24.js</code>.</p>
</div>
<div style="page-break-after: always;"></div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="sesion03">3. JavaScript y DOM</h2>
<div class="sectionbody">
<div class="paragraph">
<p><em>JavaScript</em> funciona de la mano de las páginas web, y éstas se basan en el DOM y trabajan sobre un navegador que interactúa con el BOM.</p>
</div>
<div class="sect2">
<h3 id="_bom">3.1. BOM</h3>
<div class="paragraph">
<p>El BOM (<em>Browser Object Model</em>) define una serie de objetos que nos permiten interactuar con el navegador, como son <code>window</code>, <code>navigator</code> y <code>location</code>.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/js03/bom.jpg" alt="BOM" width="75%">
</div>
<div class="title">Figure 8. BOM</div>
</div>
<div class="sect3">
<h4 id="_objeto_code_window_code">3.1.1. Objeto <code>window</code></h4>
<div class="paragraph">
<p>El objeto <code>window</code> es el objeto raíz (global) del navegador.</p>
</div>
<div class="paragraph">
<p>Mediante el objeto <code>window</code> podemos:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>abrir una nueva ventana del navegador mediante <code>window.open()</code></p>
<div class="paragraph">
<p>En los navegadores actuales, si intentamos abrir más de una ventana mediante <code>window.open</code> el propio navegador bloqueará su apertura, tal como sucede con las ventanas emergentes de publicidad.</p>
</div>
<div class="paragraph">
<p>Tras abrir una ventana mediante <code>window.open()</code> el método devolverá un nuevo objeto <code>window</code>, el cual será el objeto global para el <em>script</em> que corre sobre dicha ventana, conteniendo todas las propiedades comunes a los objetos como el constructor <code>Object</code> o el objeto <code>Math</code>. Pero si intentamos mirar sus propiedades, la mayoría de los navegadores no lo permitirán, ya que funciona a modo de <strong><em>sandbox</em></strong>.</p>
</div>
<div class="paragraph">
<p>Este modo de trabajo implica que el navegador sólo nos mostrará la información relativa al mismo dominio, y si abrimos una página de un dominio diferente al nuestro no tendremos control sobre las propiedades privadas del objeto <code>window</code>. Este caso lo estudiaremos en la siguiente unidad y aprenderemos como solucionarlo.</p>
</div>
</li>
<li>
<p>cerrar una ventana mediante <code>window.close()</code></p>
</li>
<li>
<p>mostrar mensajes de alerta, confirmación y consulta mediante <code>window.alert(mensaje)</code>, <code>window.confirm(mensaje)</code> y <code>window.prompt(mensaje [,valorPorDefecto])</code>.</p>
<div class="paragraph">
<p>Por ejemplo, si ejecutamos el siguiente fragmento:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="javascript"><span class="tok-nx">alert</span><span class="tok-p">(</span><span class="tok-s2">&quot;uno&quot;</span><span class="tok-p">);</span>
<span class="tok-nx">confirm</span><span class="tok-p">(</span><span class="tok-s2">&quot;dos&quot;</span><span class="tok-p">);</span>
<span class="tok-kd">var</span> <span class="tok-nx">resp</span> <span class="tok-o">=</span> <span class="tok-nx">prompt</span><span class="tok-p">(</span><span class="tok-s2">&quot;tres&quot;</span><span class="tok-p">);</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Podemos observar las diferencias entre los tres diálogos:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/js03/windowMensajes.jpg" alt="Mensajes del objeto window" width="75%">
</div>
<div class="title">Figure 9. Mensajes del objeto window</div>
</div>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_objeto_code_navigator_code">3.1.2. Objeto <code>navigator</code></h4>
<div class="paragraph">
<p>Mediante el objeto <code>navigator</code> podemos acceder a propiedades de información del navegador, tales como su nombre y versión. Para ello, podemos acceder a las propiedades <code>navigator.appName</code> o <code>navigator.appVersion</code>.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/js03/navigator.jpg" alt="Objeto navigator" width="66%">
</div>
<div class="title">Figure 10. Objeto navigator - <a href="http://jsbin.com/luhaye/1/edit?js" class="bare">http://jsbin.com/luhaye/1/edit?js</a></div>
</div>
</div>
<div class="sect3">
<h4 id="_objeto_code_document_code">3.1.3. Objeto <code>document</code></h4>
<div class="paragraph">
<p>Cada objeto <code>window</code> contiene la propiedad <code>document</code>, el cual contiene un objeto que representa el documento mostrado. Este objeto, a su vez, contiene la propiedad <code>location</code> que nos permite obtener información sobre la URL con las propiedades:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>href</code>: cadena que representa la URL completa</p>
</li>
<li>
<p><code>protocol</code>: protocolo de la URL</p>
</li>
<li>
<p><code>host</code>: nombre del host</p>
</li>
<li>
<p><code>pathname</code>: trayectoria del recurso</p>
</li>
<li>
<p><code>search</code>: parte que contiene los parámetros, incluido el símbolo <code>?</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Suponiendo que accedemos a la URL <code><a href="http://localhost:63342/Pruebas/bom/location.html?alfa=beta&amp;gama=delta" class="bare">http://localhost:63342/Pruebas/bom/location.html?alfa=beta&amp;gama=delta</a></code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="javascript"><span class="tok-nx">console</span><span class="tok-p">.</span><span class="tok-nx">log</span><span class="tok-p">(</span><span class="tok-s2">&quot;href:&quot;</span> <span class="tok-o">+</span> <span class="tok-nx">location</span><span class="tok-p">.</span><span class="tok-nx">href</span><span class="tok-p">);</span>  <span class="tok-c1">// http://localhost:63342/Pruebas/bom/location.html?alfa=beta&amp;gama=delta</span>
<span class="tok-nx">console</span><span class="tok-p">.</span><span class="tok-nx">log</span><span class="tok-p">(</span><span class="tok-s2">&quot;protocol:&quot;</span> <span class="tok-o">+</span> <span class="tok-nx">location</span><span class="tok-p">.</span><span class="tok-nx">protocol</span><span class="tok-p">);</span>  <span class="tok-c1">// http:</span>
<span class="tok-nx">console</span><span class="tok-p">.</span><span class="tok-nx">log</span><span class="tok-p">(</span><span class="tok-s2">&quot;host:&quot;</span> <span class="tok-o">+</span> <span class="tok-nx">location</span><span class="tok-p">.</span><span class="tok-nx">host</span><span class="tok-p">);</span>  <span class="tok-c1">// localhost:63342</span>
<span class="tok-nx">console</span><span class="tok-p">.</span><span class="tok-nx">log</span><span class="tok-p">(</span><span class="tok-s2">&quot;pathname:&quot;</span> <span class="tok-o">+</span> <span class="tok-nx">location</span><span class="tok-p">.</span><span class="tok-nx">pathname</span><span class="tok-p">);</span>  <span class="tok-c1">// /Pruebas/bom/location.html</span>
<span class="tok-nx">console</span><span class="tok-p">.</span><span class="tok-nx">log</span><span class="tok-p">(</span><span class="tok-s2">&quot;search:&quot;</span> <span class="tok-o">+</span> <span class="tok-nx">location</span><span class="tok-p">.</span><span class="tok-nx">search</span><span class="tok-p">);</span>  <span class="tok-c1">// ?alfa=beta&amp;gama=delta</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Si a <code>location.href</code> le asignamos una nueva URL, el navegador realizará una petición a dicha URL y el navegador cargará el nuevo documento.</p>
</div>
<div class="paragraph">
<p>Una operación a destacar dentro del objeto <code>document</code> es <code>document.write(texto)</code>, que permite escribir contenido HTML en el documento. Si le pasamos como <code>texto</code> un documento HTML entero, sustituirá por completo el documento existente por el recibido por el método <code>write</code>. Así pues, mediante este método podemos añadir contenido dinámico al documento.</p>
</div>
<div class="paragraph">
<p>Por ejemplo, si queremos generar la hora actual, podemos usar el objeto <code>Date</code> y mediante <code>document.write()</code> escribirla:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="html"><span class="tok-nt">&lt;html&gt;</span>
<span class="tok-nt">&lt;head&gt;&lt;title&gt;</span>La hora<span class="tok-nt">&lt;/title&gt;&lt;/head&gt;</span>
<span class="tok-nt">&lt;body&gt;</span>
    <span class="tok-nt">&lt;p&gt;</span>Son las
      <span class="tok-nt">&lt;script </span><span class="tok-na">type=</span><span class="tok-s">&quot;text/javascript&quot;</span><span class="tok-nt">&gt;</span>
        <span class="tok-kd">var</span> <span class="tok-nx">time</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-nb">Date</span><span class="tok-p">();</span>
        <span class="tok-nb">document</span><span class="tok-p">.</span><span class="tok-nx">write</span><span class="tok-p">(</span><span class="tok-nx">time</span><span class="tok-p">.</span><span class="tok-nx">getHours</span><span class="tok-p">()</span> <span class="tok-o">+</span> <span class="tok-s2">&quot;:&quot;</span> <span class="tok-o">+</span> <span class="tok-nx">time</span><span class="tok-p">.</span><span class="tok-nx">getMinutes</span><span class="tok-p">());</span>
      <span class="tok-nt">&lt;/script&gt;</span>
    <span class="tok-nt">&lt;/p&gt;</span>
  <span class="tok-nt">&lt;/body&gt;</span>
<span class="tok-nt">&lt;/html&gt;</span></code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_trabajando_con_el_dom">3.2. Trabajando con el DOM</h3>
<div class="paragraph">
<p>El 99% de las aplicaciones <em>JavaScript</em> están orientadas a la web, y de ahí su integración con el DOM de las páginas web.</p>
</div>
<div class="paragraph">
<p>El API DOM permite interactuar con el documento HTML y cambiar el contenido y la estructura del mismo, los estilos CSS y gestionar los eventos mediante <em>listeners</em>.</p>
</div>
<div class="paragraph">
<p>Se trata de un modelo que representa un documento mediante una jerarquía de objetos en árbol y que facilita su programación mediante métodos y propiedades.</p>
</div>
<div class="paragraph">
<p>DOM ha ido evolucionando en diferentes versiones:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>DOM Level 0 (<em>Legacy DOM</em>): define las colecciones <code>forms</code>, <code>links</code> e <code>images</code>.</p>
</li>
<li>
<p>DOM Level 1 (1998): introduce el objeto <code>Node</code> y a partir de él, los nodos <code>Document</code>, <code>Element</code>, <code>Attr</code> y <code>Text</code>. Además, las operaciones <code>getElemensByTagName</code>, <code>getAttribute</code>, <code>removeAtribute</code> y <code>setAttribute</code></p>
</li>
<li>
<p>DOM Level 2: facilita el trabajo con XHTML y añade los métodos <code>getElementById</code>, <code>hasAttributes</code> y <code>hasAttribute</code></p>
</li>
<li>
<p>DOM Level 3: añade atributos al modelo, entre ellos <code>textContent</code> y el método <code>isEqualNode</code>.</p>
</li>
<li>
<p>DOM Level 4 (2004): supone el abandono de HTML por XML e introduce los métodos <code>getElementsByClassName</code>, <code>prepend</code>, <code>append</code>,
<code>before</code>, <code>after</code>, <code>replace</code> y <code>remove</code>.</p>
</li>
</ul>
</div>
<div class="sect3">
<h4 id="_el_objeto_code_window_code">3.2.1. El objeto <code>window</code></h4>
<div class="paragraph">
<p>Tal como vimos en la primera sesión, al declarar una variable tiene un alcance global. Realmente, todas las variable globales forman parte del objeto <code>window</code>, ya que éste objeto es el padre de la jerarquía de objetos del navegador (DOM, <em>Document Object Model</em>).</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="javascript"><span class="tok-kd">var</span> <span class="tok-nx">batman</span> <span class="tok-o">=</span> <span class="tok-s2">&quot;Bruce Wayne&quot;</span><span class="tok-p">;</span>
<span class="tok-nx">console</span><span class="tok-p">.</span><span class="tok-nx">log</span><span class="tok-p">(</span><span class="tok-nb">window</span><span class="tok-p">.</span><span class="tok-nx">batman</span><span class="tok-p">);</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Por lo general, casi nunca vamos a referenciar directamente al objeto <code>window</code>. Una de las excepciones es cuando desde una función declaramos una variable local a la función (con alcance anidado) que tiene el mismo nombre que una variable global y queremos referenciar a la global de manera únivoca, utilizaremos el objeto <code>window</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="javascript"><span class="tok-kd">var</span> <span class="tok-nx">superheroe</span> <span class="tok-o">=</span> <span class="tok-s2">&quot;Batman&quot;</span><span class="tok-p">;</span>
<span class="tok-kd">var</span> <span class="tok-nx">mejorSuperheroe</span> <span class="tok-o">=</span> <span class="tok-kd">function</span> <span class="tok-p">()</span> <span class="tok-p">{</span>
  <span class="tok-kd">var</span> <span class="tok-nx">superheroe</span> <span class="tok-o">=</span> <span class="tok-s2">&quot;Superman&quot;</span><span class="tok-p">;</span>

  <span class="tok-k">if</span> <span class="tok-p">(</span><span class="tok-nb">window</span><span class="tok-p">.</span><span class="tok-nx">superheroe</span> <span class="tok-o">!=</span> <span class="tok-nx">superheroe</span><span class="tok-p">)</span> <span class="tok-p">{</span>
    <span class="tok-nx">superheroe</span> <span class="tok-o">=</span> <span class="tok-nb">window</span><span class="tok-p">.</span><span class="tok-nx">superheroe</span><span class="tok-p">;</span>
  <span class="tok-p">}</span>
<span class="tok-p">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Queda claro que sería más conveniente utilizar otro nombre para la variable local, pero ahí queda un ejemplo de su uso.</p>
</div>
</div>
<div class="sect3">
<h4 id="_el_objeto_code_document_code">3.2.2. El objeto <code>document</code></h4>
<div class="paragraph">
<p>El objeto <code>document</code> nos da acceso al <em>DOM</em> (Modelo de objetos de documento) de una página web, y a partir de él, acceder a los elementos que forman la página mediante una estructura jerárquica.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
Podemos cargar los scripts JS al final de un documento HTML para acelerar la carga de una página web y asegurarnos que el DOM ya está cargado.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Al objeto que hace de raíz del árbol, el nodo <code>html</code>, se puede acceder mediante la propiedad <code>document.documentElement</code>. Sin embargo, la mayoría de ocasiones necesitaremos acceder al elemento <code>body</code> más que a la raíz, con lo que usaremos <code>document.body</code>.</p>
</div>
</div>
<div class="sect3">
<h4 id="_elementos_del_dom">3.2.3. Elementos del DOM</h4>
<div class="paragraph">
<p>Cada elemento exceptuando el elemento <code>&lt;html&gt;</code> forma parte de otro elemento, que se le conoce como padre (<em>parent</em>). Un elemento a su vez puede contener elementos hijos (<em>child</em>) y/o hermanos (<em>sibling</em>).</p>
</div>
<div class="paragraph">
<p>Supongamos el siguiente fragmento de código HTML:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="html"><span class="tok-nt">&lt;p&gt;&lt;strong&gt;</span>Hello<span class="tok-nt">&lt;/strong&gt;</span> how are you doing?<span class="tok-nt">&lt;/p&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Cada porción de este fragmento se convierte en un nodo DOM con punteros a otros nodos que apuntan sus nodos relativos (padres, hijos, hermanos, &#8230;&#8203;), del siguiente modo:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/js03/domRelaciones.jpg" alt="Relaciones entre nodos DOM" width="66%">
</div>
<div class="title">Figure 11. Relaciones entre nodos DOM</div>
</div>
<div class="paragraph">
<p>Vamos a estudiar estos enlaces en detalle.</p>
</div>
<div class="sect4">
<h5 id="_enlaces_de_nodos">Enlaces de nodos</h5>
<div class="paragraph">
<p>Podemos acceder a los enlaces existentes entre los nodos mediante las propiedades que poseen los nodos. Cada objeto DOM contiene un conjunto de propiedades para acceder a los nodos con lo que mantiene alguna relación. Por ejemplo, cada nodo tiene una propiedad <code>parentNode</code> que referencia a su padre (si tiene). Estos padres, a su vez, contienen enlaces que devuelven la referencia a sus hijos, pero como puede tener más de un hijo, se almacenan en un <em>pseudoarray</em> denominado <code>childNodes</code>.</p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Plantilla Ejemplo DOM</div>
<div class="paragraph">
<p>Para poder realizar algunos ejemplos de manejo de DOM, vamos a crear un sencillo documento HTML:</p>
</div>
<div class="listingblock">
<div class="title">Plantilla HTML con la que vamos a trabajar el DOM - <a href="http://jsbin.com/bopije/1/edit?html" class="bare">http://jsbin.com/bopije/1/edit?html</a></div>
<div class="content">
<pre class="pygments highlight"><code data-lang="html"><span class="tok-cp">&lt;!DOCTYPE html&gt;</span>
<span class="tok-nt">&lt;html</span> <span class="tok-na">lang=</span><span class="tok-s">&quot;es&quot;</span><span class="tok-nt">&gt;</span>
<span class="tok-nt">&lt;head&gt;</span>
<span class="tok-nt">&lt;title&gt;</span>Ejemplo DOM<span class="tok-nt">&lt;/title&gt;</span>
<span class="tok-nt">&lt;meta</span> <span class="tok-na">charset=</span><span class="tok-s">&quot;utf-8&quot;</span> <span class="tok-nt">/&gt;</span>
<span class="tok-nt">&lt;/head&gt;</span>
<span class="tok-nt">&lt;body&gt;</span>
<span class="tok-nt">&lt;h1&gt;</span>Encabezado uno<span class="tok-nt">&lt;/h1&gt;</span>
<span class="tok-nt">&lt;p&gt;</span>Primer párrafo<span class="tok-nt">&lt;/p&gt;</span>
<span class="tok-nt">&lt;p&gt;</span>Segundo párrafo<span class="tok-nt">&lt;/p&gt;</span>
<span class="tok-nt">&lt;div&gt;&lt;p</span> <span class="tok-na">id=</span><span class="tok-s">&quot;tres&quot;</span><span class="tok-nt">&gt;</span>Tercer párrafo dentro de un div<span class="tok-nt">&lt;/p&gt;&lt;/div&gt;</span>
<span class="tok-nt">&lt;script </span><span class="tok-na">src=</span><span class="tok-s">&quot;dom.js&quot;</span> <span class="tok-na">charset=</span><span class="tok-s">&quot;utf-8&quot;</span><span class="tok-nt">&gt;&lt;/script&gt;</span>
<span class="tok-nt">&lt;/body&gt;</span>
<span class="tok-nt">&lt;/html&gt;</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>En el documento anterior, <code>document.body.childNodes</code> contiene 5 elementos: el encabezado <code>h1</code>, los dos párrafos, la capa y la referencia al script.</p>
</div>
<div class="admonitionblock caution">
<table>
<tr>
<td class="icon">
<i class="fa icon-caution" title="Caution"></i>
</td>
<td class="content">
Si el documento HTML contiene saltos de línea, tabuladores, etc&#8230;&#8203; DOM interpreta estos como nodos de texto, con lo que el número de hijos de un nodo puede no ser el que nosotros esperemos.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Los otros enlaces que ofrece un nodo son:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>firstChild</code>: primer hijo de un nodo, o <code>null</code> si no tiene hijos.</p>
</li>
<li>
<p><code>lastChild</code>: último hijo de un nodo, o <code>null</code> si no tiene hijos.</p>
</li>
<li>
<p><code>nextSibling</code>: siguiente hermano de un nodo, o <code>null</code> si no tiene un hermano a continuación (es el último).</p>
</li>
<li>
<p><code>previousSibling</code>: anterior hermano de un nodo, o <code>null</code> si no tiene un hermano previo (es el primero).</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Por ejemplo:</p>
</div>
<div class="listingblock">
<div class="title">Enlaces DOM - <a href="http://jsbin.com/bopije/1/edit?js" class="bare">http://jsbin.com/bopije/1/edit?js</a></div>
<div class="content">
<pre class="pygments highlight"><code data-lang="javascript"><span class="tok-kd">var</span> <span class="tok-nx">encabezado</span> <span class="tok-o">=</span> <span class="tok-nb">document</span><span class="tok-p">.</span><span class="tok-nx">body</span><span class="tok-p">.</span><span class="tok-nx">firstChild</span><span class="tok-p">;</span>
<span class="tok-kd">var</span> <span class="tok-nx">scriptJS</span> <span class="tok-o">=</span> <span class="tok-nb">document</span><span class="tok-p">.</span><span class="tok-nx">body</span><span class="tok-p">.</span><span class="tok-nx">lastChild</span><span class="tok-p">;</span>
<span class="tok-kd">var</span> <span class="tok-nx">parrafo1</span> <span class="tok-o">=</span> <span class="tok-nx">encabezado</span><span class="tok-p">.</span><span class="tok-nx">nextSibling</span><span class="tok-p">;</span>
<span class="tok-kd">var</span> <span class="tok-nx">capa</span> <span class="tok-o">=</span> <span class="tok-nx">scriptJS</span><span class="tok-p">.</span><span class="tok-nx">previousSibling</span><span class="tok-p">;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>En resumen, los punteros que ofrece un nodo DOM son:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/js03/domPunteros.jpg" alt="Puntero de un nodo DOM" width="66%">
</div>
<div class="title">Figure 12. Puntero de un nodo DOM</div>
</div>
</div>
<div class="sect4">
<h5 id="_tipos_de_nodos">Tipos de nodos</h5>
<div class="paragraph">
<p>Cada uno de los elementos se conoce como nodo, que pueden ser de los siguientes tipos:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Element</strong>: nodo que contiene una etiqueta HTML</p>
</li>
<li>
<p><strong>Attr</strong>: nodo que forma parte de un elemento HTML</p>
</li>
<li>
<p><strong>Text</strong>: nodo que contiene texto y que no puede tener hijos</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Si nos centramos en el código de la capa:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="html"><span class="tok-nt">&lt;div&gt;</span> <i class="conum" data-value="1"></i><b>(1)</b>
  <span class="tok-nt">&lt;p</span> <span class="tok-na">id=</span><span class="tok-s">&quot;tres&quot;</span><span class="tok-nt">&gt;</span> <i class="conum" data-value="2"></i><b>(2)</b>
    Tercer párrafo dentro de un div <i class="conum" data-value="3"></i><b>(3)</b>
  <span class="tok-nt">&lt;/p&gt;</span>
<span class="tok-nt">&lt;/div&gt;</span></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>La capa es un nodo de tipo elemento</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>El atributo id es un nodo de tipo atributo</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>El contenido del párrafo es un nodo de tipo texto</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Si queremos averiguar si un nodo representa un texto o un elemento, usaremos la propiedad <code>nodeType</code>, que devolverá un número, por ejemplo: <code>1</code> si es un elemento (nodo HTML), <code>3</code> si es de texto. Estos números están asociados a constantes del objeto <code>document</code>: <code>document.ELEMENT_NODE</code>, <code>document.TEXT_NODE</code>, etc&#8230;&#8203;</p>
</div>
<div class="paragraph">
<p>Así pues, si quisiéramos crear una función que averiguase si es un nodo de texto:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="javascript"><span class="tok-kd">function</span> <span class="tok-nx">esNodoTexto</span><span class="tok-p">(</span><span class="tok-nx">nodo</span><span class="tok-p">)</span> <span class="tok-p">{</span>
  <span class="tok-k">return</span> <span class="tok-nx">nodo</span><span class="tok-p">.</span><span class="tok-nx">nodeType</span> <span class="tok-o">==</span> <span class="tok-nb">document</span><span class="tok-p">.</span><span class="tok-nx">TEXT_NODE</span><span class="tok-p">;</span> <span class="tok-c1">// 3</span>
<span class="tok-p">}</span>
<span class="tok-nx">esNodoTexto</span><span class="tok-p">(</span><span class="tok-nb">document</span><span class="tok-p">.</span><span class="tok-nx">body</span><span class="tok-p">);</span> <span class="tok-c1">// false</span>
<span class="tok-nx">esNodoTexto</span><span class="tok-p">(</span><span class="tok-nb">document</span><span class="tok-p">.</span><span class="tok-nx">body</span><span class="tok-p">.</span><span class="tok-nx">firstChild</span><span class="tok-p">.</span><span class="tok-nx">firstChild</span><span class="tok-p">);</span> <span class="tok-c1">// true</span></code></pre>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
Realmente existen 12 tipos, pero estos tres son los más importantes. Por ejemplo, el objeto <code>document</code> es el tipo 9.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Los elementos contienen la propiedad <code>nodeName</code> que indica el tipo de etiqueta HTML que representa (siempre en mayúsculas). Los nodos de texto, en cambio, contienen <code>nodeValue</code> que obtiene el texto contenido.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="javascript"><span class="tok-nb">document</span><span class="tok-p">.</span><span class="tok-nx">body</span><span class="tok-p">.</span><span class="tok-nx">firstChild</span><span class="tok-p">.</span><span class="tok-nx">nodeName</span><span class="tok-p">;</span> <span class="tok-c1">// H1</span>
<span class="tok-nb">document</span><span class="tok-p">.</span><span class="tok-nx">body</span><span class="tok-p">.</span><span class="tok-nx">firstChild</span><span class="tok-p">.</span><span class="tok-nx">firstChild</span><span class="tok-p">.</span><span class="tok-nx">nodeValue</span><span class="tok-p">;</span> <span class="tok-c1">// Encabezado uno</span></code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_recorriendo_el_dom">3.2.4. Recorriendo el DOM</h4>
<div class="paragraph">
<p>Si queremos recorrer todos los nodos de un árbol, lo mejor es realizar un recorrido recursivo. Por ejemplo, si queremos crear una función que indique si un nodo (o sus hijos) contiene una determinada cadena:</p>
</div>
<div class="listingblock">
<div class="title">Recorriendo el DOM - <a href="http://jsbin.com/mufin/9/edit?js" class="bare">http://jsbin.com/mufin/9/edit?js</a></div>
<div class="content">
<pre class="pygments highlight"><code data-lang="javascript"><span class="tok-kd">function</span> <span class="tok-nx">buscarTexto</span><span class="tok-p">(</span><span class="tok-nx">nodo</span><span class="tok-p">,</span> <span class="tok-nx">cadena</span><span class="tok-p">)</span> <span class="tok-p">{</span>
  <span class="tok-k">if</span> <span class="tok-p">(</span><span class="tok-nx">nodo</span><span class="tok-p">.</span><span class="tok-nx">nodeType</span> <span class="tok-o">==</span> <span class="tok-nb">document</span><span class="tok-p">.</span><span class="tok-nx">ELEMENT_NODE</span><span class="tok-p">)</span> <span class="tok-p">{</span>
    <span class="tok-k">for</span> <span class="tok-p">(</span><span class="tok-kd">var</span> <span class="tok-nx">i</span><span class="tok-o">=</span><span class="tok-mi">0</span><span class="tok-p">,</span> <span class="tok-nx">len</span><span class="tok-o">=</span><span class="tok-nx">nodo</span><span class="tok-p">.</span><span class="tok-nx">childNodes</span><span class="tok-p">.</span><span class="tok-nx">length</span><span class="tok-p">;</span> <span class="tok-nx">i</span><span class="tok-o">&lt;</span><span class="tok-nx">len</span><span class="tok-p">;</span> <span class="tok-nx">i</span><span class="tok-o">++</span><span class="tok-p">)</span> <span class="tok-p">{</span>
      <span class="tok-k">if</span> <span class="tok-p">(</span><span class="tok-nx">buscarTexto</span><span class="tok-p">(</span><span class="tok-nx">nodo</span><span class="tok-p">.</span><span class="tok-nx">childNodes</span><span class="tok-p">[</span><span class="tok-nx">i</span><span class="tok-p">],</span> <span class="tok-nx">cadena</span><span class="tok-p">))</span> <span class="tok-p">{</span>
        <span class="tok-k">return</span> <span class="tok-kc">true</span><span class="tok-p">;</span>
      <span class="tok-p">}</span>
    <span class="tok-p">}</span>
    <span class="tok-k">return</span> <span class="tok-kc">false</span><span class="tok-p">;</span>
  <span class="tok-p">}</span> <span class="tok-k">else</span> <span class="tok-k">if</span> <span class="tok-p">(</span><span class="tok-nx">nodo</span><span class="tok-p">.</span><span class="tok-nx">nodeType</span> <span class="tok-o">==</span> <span class="tok-nb">document</span><span class="tok-p">.</span><span class="tok-nx">TEXT_NODE</span><span class="tok-p">)</span> <span class="tok-p">{</span>
    <span class="tok-k">return</span> <span class="tok-nx">nodo</span><span class="tok-p">.</span><span class="tok-nx">nodeValue</span><span class="tok-p">.</span><span class="tok-nx">indexOf</span><span class="tok-p">(</span><span class="tok-nx">cadena</span><span class="tok-p">)</span> <span class="tok-o">&gt;</span> <span class="tok-o">-</span><span class="tok-mi">1</span><span class="tok-p">;</span>
  <span class="tok-p">}</span>
<span class="tok-p">}</span></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_seleccionando_elementos">3.2.5. Seleccionando elementos</h4>
<div class="paragraph">
<p>Mediante el DOM, podemos usar dos métodos para seleccionar un determinado elemento.</p>
</div>
<div class="paragraph">
<p>Si queremos seleccionar un conjunto de elementos, por ejemplo, todos los párrafos del documento, necesitamos utilizar el método <code>document.getElementsByTagName(nombreDeTag)</code>. En cambio, si queremos acceder a un elemento por su id (que debería ser único), usaremos el método <code>document.getElementById(nombreDeId)</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="javascript"><span class="tok-p">(</span><span class="tok-kd">function</span><span class="tok-p">()</span> <span class="tok-p">{</span>
  <span class="tok-kd">var</span> <span class="tok-nx">pElements</span> <span class="tok-o">=</span> <span class="tok-nb">document</span><span class="tok-p">.</span><span class="tok-nx">getElementsByTagName</span><span class="tok-p">(</span><span class="tok-s2">&quot;p&quot;</span><span class="tok-p">);</span> <span class="tok-c1">// NodeList</span>
  <span class="tok-nx">console</span><span class="tok-p">.</span><span class="tok-nx">log</span><span class="tok-p">(</span><span class="tok-nx">pElements</span><span class="tok-p">.</span><span class="tok-nx">length</span><span class="tok-p">);</span>  <span class="tok-c1">// 3</span>
  <span class="tok-nx">console</span><span class="tok-p">.</span><span class="tok-nx">log</span><span class="tok-p">(</span><span class="tok-nx">pElements</span><span class="tok-p">[</span><span class="tok-mi">0</span><span class="tok-p">]);</span>  <span class="tok-c1">// Primer párrafo</span>

  <span class="tok-kd">var</span> <span class="tok-nx">divpElement</span> <span class="tok-o">=</span> <span class="tok-nb">document</span><span class="tok-p">.</span><span class="tok-nx">getElementById</span><span class="tok-p">(</span><span class="tok-s2">&quot;tres&quot;</span><span class="tok-p">);</span>
  <span class="tok-nx">console</span><span class="tok-p">.</span><span class="tok-nx">log</span><span class="tok-p">(</span><span class="tok-nx">divpElement</span><span class="tok-p">);</span> <span class="tok-c1">// &quot;&lt;p id=&quot;tres&quot;&gt;Tercer párrafo dentro de un div&lt;/p&gt;&quot;</span>
<span class="tok-p">}());</span></code></pre>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
En vez de usarlos sobre el objeto <code>document</code>, podemos utilizarlos sobre un elemento en concreto para refinar la búsqueda
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Destacar que si estamos interesados en un único elemento, lo haremos mediante su <em>id</em>, mientras que si queremos más de un elemento, lo haremos mediante tu <em>tag</em>, ya que obtendremos un <em>NodeList</em>, el cual es similar a un array, y es una representación viva de los elementos, de modo que si se produce algún cambio en el DOM se verá trasladado al navegador.</p>
</div>
<div class="sect4">
<h5 id="__code_queryselector_code"><code>querySelector</code></h5>
<div class="paragraph">
<p>El método de <code>getElementsByTagName</code> es antiguo y no se suele utilizar. En el año 2013 se definió el <em>Selector API</em>, que define los métodos <code>querySelectorAll</code> y <code>querySelector</code>, los cuales permiten obtener elementos mediantes consultas CSS, las cuales ofrecen mayor flexibilidad:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="javascript"><span class="tok-kd">var</span> <span class="tok-nx">pElements</span> <span class="tok-o">=</span> <span class="tok-nb">document</span><span class="tok-p">.</span><span class="tok-nx">querySelectorAll</span><span class="tok-p">(</span><span class="tok-s2">&quot;p&quot;</span><span class="tok-p">);</span>
<span class="tok-kd">var</span> <span class="tok-nx">divpElement</span> <span class="tok-o">=</span> <span class="tok-nb">document</span><span class="tok-p">.</span><span class="tok-nx">querySelector</span><span class="tok-p">(</span><span class="tok-s2">&quot;div p&quot;</span><span class="tok-p">);</span>
<span class="tok-kd">var</span> <span class="tok-nx">tresElement</span> <span class="tok-o">=</span> <span class="tok-nb">document</span><span class="tok-p">.</span><span class="tok-nx">querySelector</span><span class="tok-p">(</span><span class="tok-s2">&quot;#tres&quot;</span><span class="tok-p">);</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Esta manera de acceder a los elementos es la misma que usa <em>jQuery</em>, por lo que la estudiaremos en la sesión correspondiente.</p>
</div>
<div class="paragraph">
<p>Conviene citar que <code>getElementById</code> es casi 5 veces más rápido que <code>querySelector</code>. Más información en: <a href="http://jsperf.com/getelementbyid-vs-queryselector" class="bare">http://jsperf.com/getelementbyid-vs-queryselector</a></p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_añadiendo_contenido_al_dom">3.2.6. Añadiendo contenido al DOM</h4>
<div class="paragraph">
<p>Si queremos añadir un párrafo al documento que teníamos previamente, primero tenemos que crear el contenido y luego decidir donde colocarlo. Para ello, usaremos el método <code>createElement</code> para crear el elemento y posteriormente, decidir donde colocarlo y añadir el contenido (por ejemplo, mediante <code>appendChild</code>).</p>
</div>
<div class="listingblock">
<div class="title">Añadiendo contenido - <a href="http://jsbin.com/cunoma/1/edit?html,js,console,output" class="bare">http://jsbin.com/cunoma/1/edit?html,js,console,output</a></div>
<div class="content">
<pre class="pygments highlight"><code data-lang="javascript"><span class="tok-p">(</span><span class="tok-kd">function</span><span class="tok-p">()</span> <span class="tok-p">{</span>
  <span class="tok-kd">var</span> <span class="tok-nx">elem</span> <span class="tok-o">=</span> <span class="tok-nb">document</span><span class="tok-p">.</span><span class="tok-nx">createElement</span><span class="tok-p">(</span><span class="tok-s2">&quot;p&quot;</span><span class="tok-p">),</span>
    <span class="tok-nx">texto</span> <span class="tok-o">=</span> <span class="tok-s2">&quot;&lt;strong&gt;Nuevo párrafo creado dinámicamente&lt;/strong&gt;&quot;</span><span class="tok-p">,</span>
    <span class="tok-nx">contenido</span> <span class="tok-o">=</span> <span class="tok-nb">document</span><span class="tok-p">.</span><span class="tok-nx">createTextNode</span><span class="tok-p">(</span><span class="tok-nx">texto</span><span class="tok-p">);</span>

  <span class="tok-nx">elem</span><span class="tok-p">.</span><span class="tok-nx">appendChild</span><span class="tok-p">(</span><span class="tok-nx">contenido</span><span class="tok-p">);</span>
  <span class="tok-nx">elem</span><span class="tok-p">.</span><span class="tok-nx">id</span> <span class="tok-o">=</span> <span class="tok-s2">&quot;conAppendChild&quot;</span><span class="tok-p">;</span>

  <span class="tok-nb">document</span><span class="tok-p">.</span><span class="tok-nx">body</span><span class="tok-p">.</span><span class="tok-nx">appendChild</span><span class="tok-p">(</span><span class="tok-nx">elem</span><span class="tok-p">);</span>
  <span class="tok-c1">// lo añade como el último nodo detrás de script</span>
<span class="tok-p">}());</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Si probamos el código veremos que las etiquetas <code>&lt;strong&gt;</code> se han parseado y en vez de mostrar el texto en negrita se muestra el código de la etiqueta. Además, si intentamos ver el código fuente de la página no veremos el contenido creado dinámicamente, y necesitaremos utilizar las herramientas de desarrollador que ofrecen los navegadores web.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/js03/domAppendChild.jpg" alt="Añadiendo un nodo" width="66%">
</div>
</div>
<div class="paragraph">
<p>Los métodos que podemos utilizar para añadir contenidos son:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>appendChild(nuevoElemento)</code>: el nuevo nodo se incluye inmediatamente después de los hijos ya existentes (si hay alguno) y el nodo padre cuenta con una nueva rama.</p>
</li>
<li>
<p><code>insertBefore(nuevoElemento, elementoExistente)</code>: permiten elegir un nodo existente del documento e incluir otro antes que él.</p>
</li>
</ul>
</div>
<div class="admonitionblock caution">
<table>
<tr>
<td class="icon">
<i class="fa icon-caution" title="Caution"></i>
</td>
<td class="content">
<div class="title">insertAfter</div>
<div class="paragraph">
<p>Aunque parezca mentira, no existe ningún método para añadir después, pero podríamos crearlo fácilmente de la siguiente manera:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="javascript"><span class="tok-kd">function</span> <span class="tok-nx">insertAfter</span><span class="tok-p">(</span><span class="tok-nx">e</span><span class="tok-p">,</span> <span class="tok-nx">i</span><span class="tok-p">){</span>
  <span class="tok-k">if</span> <span class="tok-p">(</span><span class="tok-nx">e</span><span class="tok-p">.</span><span class="tok-nx">nextSibling</span><span class="tok-p">){</span>
    <span class="tok-nx">e</span><span class="tok-p">.</span><span class="tok-nx">parentNode</span><span class="tok-p">.</span><span class="tok-nx">insertBefore</span><span class="tok-p">(</span><span class="tok-nx">i</span><span class="tok-p">,</span> <span class="tok-nx">e</span><span class="tok-p">.</span><span class="tok-nx">nextSibling</span><span class="tok-p">);</span>
  <span class="tok-p">}</span> <span class="tok-k">else</span> <span class="tok-p">{</span>
    <span class="tok-nx">e</span><span class="tok-p">.</span><span class="tok-nx">parentNode</span><span class="tok-p">.</span><span class="tok-nx">appendChild</span><span class="tok-p">(</span><span class="tok-nx">i</span><span class="tok-p">);</span>
  <span class="tok-p">}</span>
<span class="tok-p">}</span></code></pre>
</div>
</div>
</td>
</tr>
</table>
</div>
<div class="ulist">
<ul>
<li>
<p><code>replaceChild(nuevoElemento, elementoExistente)</code>: reemplazar un nodo por otro</p>
</li>
<li>
<p><code>removeChild(nodoABorrar)</code>: elimina un nodo</p>
</li>
<li>
<p><code>cloneNode()</code>: permite clonar un nodo, permitiendo tanto el elemento como el elemento con su contenido</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Así pues, si queremos añadir el párrafo dentro de la capa que tenemos definida en vez de al final del documento, podemos obtener el nodo que contiene el párrafo de la capa, y añadir el nuevo nodo a su padre en la posición que deseemos (al final, antes del nodo o sustituirlo).</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="javascript"><span class="tok-p">(</span><span class="tok-kd">function</span><span class="tok-p">()</span> <span class="tok-p">{</span>
  <span class="tok-kd">var</span> <span class="tok-nx">doc</span> <span class="tok-o">=</span> <span class="tok-nb">document</span><span class="tok-p">,</span>   <i class="conum" data-value="1"></i><b>(1)</b>
    <span class="tok-nx">elem</span> <span class="tok-o">=</span> <span class="tok-nx">doc</span><span class="tok-p">.</span><span class="tok-nx">createElement</span><span class="tok-p">(</span><span class="tok-s2">&quot;p&quot;</span><span class="tok-p">),</span>
    <span class="tok-nx">contenido</span> <span class="tok-o">=</span> <span class="tok-nx">doc</span><span class="tok-p">.</span><span class="tok-nx">createTextNode</span><span class="tok-p">(</span><span class="tok-s2">&quot;&lt;strong&gt;Nuevo párrafo creado dinámicamente&lt;/strong&gt;&quot;</span><span class="tok-p">),</span>
    <span class="tok-nx">pTres</span> <span class="tok-o">=</span> <span class="tok-nx">doc</span><span class="tok-p">.</span><span class="tok-nx">getElementById</span><span class="tok-p">(</span><span class="tok-s2">&quot;tres&quot;</span><span class="tok-p">);</span> <i class="conum" data-value="2"></i><b>(2)</b>

  <span class="tok-nx">elem</span><span class="tok-p">.</span><span class="tok-nx">appendChild</span><span class="tok-p">(</span><span class="tok-nx">contenido</span><span class="tok-p">);</span>
  <span class="tok-nx">elem</span><span class="tok-p">.</span><span class="tok-nx">id</span> <span class="tok-o">=</span> <span class="tok-s2">&quot;conAppendChild&quot;</span><span class="tok-p">;</span>

  <span class="tok-nx">pTres</span><span class="tok-p">.</span><span class="tok-nx">parentNode</span><span class="tok-p">.</span><span class="tok-nx">appendChild</span><span class="tok-p">(</span><span class="tok-nx">elem</span><span class="tok-p">);</span> <i class="conum" data-value="3"></i><b>(3)</b>
<span class="tok-p">}());</span></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Guardamos en una variable la referencia a <code>document</code> para evitar tener que salir del alcance y subir al alcance global con cada referencia. Se trata de una pequeño mejora que aumenta la eficiencia del código.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Obtenemos una referencia al Node que contiene el párrafo de dentro del <code>div</code></td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Insertamos un hijo al padre de <code>#tres</code>, lo que lo convierte en su hermano.
Si hubiesemos querido que se hubiese colocado delante, tendríamos que haber utilizado <code>pTres.parentNode.insertBefore(elem, pTres)</code>.
En cambio, para sustituir un párrafo por el nuevo necesitaríamos hacer <code>pTres.parentNode.replaceChild(elem, pTres)</code>;</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Otra forma de añadir contenido es mediante la propiedad <code>innerHTML</code>, el cual sí que va a parsear el código incluido. Para ello, en vez de crear un elemento y añadirle contenido, el contenido se lo podemos añadir como una propiedad del elemento.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="javascript"><span class="tok-p">(</span><span class="tok-kd">function</span><span class="tok-p">()</span> <span class="tok-p">{</span>
  <span class="tok-kd">var</span>
    <span class="tok-nx">doc</span> <span class="tok-o">=</span> <span class="tok-nb">document</span><span class="tok-p">,</span>
    <span class="tok-nx">elem</span> <span class="tok-o">=</span> <span class="tok-nx">doc</span><span class="tok-p">.</span><span class="tok-nx">createElement</span><span class="tok-p">(</span><span class="tok-s2">&quot;p&quot;</span><span class="tok-p">),</span>
    <span class="tok-nx">pTres</span> <span class="tok-o">=</span> <span class="tok-nx">doc</span><span class="tok-p">.</span><span class="tok-nx">getElementById</span><span class="tok-p">(</span><span class="tok-s2">&quot;tres&quot;</span><span class="tok-p">);</span>

  <span class="tok-nx">elem</span><span class="tok-p">.</span><span class="tok-nx">innerHTML</span> <span class="tok-o">=</span> <span class="tok-s2">&quot;&lt;strong&gt;Nuevo párrafo reemplazado dinámicamente&lt;/strong&gt;&quot;</span><span class="tok-p">;</span>
  <span class="tok-nx">elem</span><span class="tok-p">.</span><span class="tok-nx">id</span> <span class="tok-o">=</span> <span class="tok-s2">&quot;conInner&quot;</span><span class="tok-p">;</span>

  <span class="tok-nx">pTres</span><span class="tok-p">.</span><span class="tok-nx">parentNode</span><span class="tok-p">.</span><span class="tok-nx">replaceChild</span><span class="tok-p">(</span><span class="tok-nx">elem</span><span class="tok-p">,</span> <span class="tok-nx">pTres</span><span class="tok-p">);</span>
<span class="tok-p">}());</span></code></pre>
</div>
</div>
<div class="imageblock">
<div class="content">
<img src="images/js03/domInnerHtml.jpg" alt="Sustituyendo un nodo con parseo HTML" width="50%">
</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="title">innerHTML vs nodeValue</div>
<div class="paragraph">
<p>Mientras que <code>innerHTML</code> interpreta la cadena como HTML, <code>nodeValue</code> la interpreta como texto plano, con lo que los símbolos de <code>&lt;</code> y <code>&gt;</code> no aportan significado al contenido</p>
</div>
</td>
</tr>
</table>
</div>
<div class="admonitionblock caution">
<table>
<tr>
<td class="icon">
<i class="fa icon-caution" title="Caution"></i>
</td>
<td class="content">
<div class="title">document.write()</div>
<div class="paragraph">
<p>Pese a que el método <code>document.write(txt)</code> permite añadir contenido a un documento, hemos de tener mucho cuidado porque, pese a funcionar si lo incluimos al cargar una página, al ejecutarlo dentro de una función una vez el DOM ya ha cargado, el texto que queramos escribir sustituirá todo el contenido que había previamente.
Por lo tanto, si queremos añadir contenido, es mejor hacerlo añadiendo un nodo o mediante <code>innerHtml</code></p>
</div>
</td>
</tr>
</table>
</div>
<div class="sect4">
<h5 id="__code_getelementsby_code_vs_code_queryselector_code"><code>getElementsBy</code> vs <code>querySelector</code></h5>
<div class="paragraph">
<p>Una diferencia importante es que las referencias con <code>getElementsBy*</code> están vivas y siempre contienen el estado actual del documento, mientras que con <code>querySelector*</code> obtenemos las referencias existentes en el momento de ejecución, sin que cambios posteriores en el DOM afecten a las referencias obtenidas.</p>
</div>
<div class="listingblock">
<div class="title">getElementsBy vs querySelector - <a href="http://jsbin.com/luzexi/2/" class="bare">http://jsbin.com/luzexi/2/</a></div>
<div class="content">
<pre class="pygments highlight"><code data-lang="javascript"><span class="tok-p">(</span><span class="tok-kd">function</span><span class="tok-p">()</span> <span class="tok-p">{</span>
  <span class="tok-kd">var</span>
    <span class="tok-nx">getElements</span> <span class="tok-o">=</span> <span class="tok-nb">document</span><span class="tok-p">.</span><span class="tok-nx">getElementsByTagName</span><span class="tok-p">(</span><span class="tok-s2">&quot;p&quot;</span><span class="tok-p">),</span>
    <span class="tok-nx">queryElements</span> <span class="tok-o">=</span> <span class="tok-nb">document</span><span class="tok-p">.</span><span class="tok-nx">querySelectorAll</span><span class="tok-p">(</span><span class="tok-s2">&quot;p&quot;</span><span class="tok-p">);</span>

  <span class="tok-nx">console</span><span class="tok-p">.</span><span class="tok-nx">log</span><span class="tok-p">(</span><span class="tok-s2">&quot;Antes con getElements:&quot;</span> <span class="tok-o">+</span> <span class="tok-nx">getElements</span><span class="tok-p">.</span><span class="tok-nx">length</span><span class="tok-p">);</span>  <span class="tok-c1">// 3</span>
  <span class="tok-nx">console</span><span class="tok-p">.</span><span class="tok-nx">log</span><span class="tok-p">(</span><span class="tok-s2">&quot;Antes con querySelector:&quot;</span> <span class="tok-o">+</span> <span class="tok-nx">queryElements</span><span class="tok-p">.</span><span class="tok-nx">length</span><span class="tok-p">);</span>  <span class="tok-c1">// 3</span>

  <span class="tok-kd">var</span> <span class="tok-nx">elem</span> <span class="tok-o">=</span> <span class="tok-nb">document</span><span class="tok-p">.</span><span class="tok-nx">createElement</span><span class="tok-p">(</span><span class="tok-s2">&quot;p&quot;</span><span class="tok-p">);</span>
  <span class="tok-nx">elem</span><span class="tok-p">.</span><span class="tok-nx">innerHTML</span> <span class="tok-o">=</span> <span class="tok-s2">&quot;getElements vs querySelector&quot;</span><span class="tok-p">;</span>
  <span class="tok-nb">document</span><span class="tok-p">.</span><span class="tok-nx">body</span><span class="tok-p">.</span><span class="tok-nx">appendChild</span><span class="tok-p">(</span><span class="tok-nx">elem</span><span class="tok-p">);</span>

  <span class="tok-nx">console</span><span class="tok-p">.</span><span class="tok-nx">log</span><span class="tok-p">(</span><span class="tok-s2">&quot;Después con getElements:&quot;</span> <span class="tok-o">+</span> <span class="tok-nx">getElements</span><span class="tok-p">.</span><span class="tok-nx">length</span><span class="tok-p">);</span> <span class="tok-c1">// 4</span>
  <span class="tok-nx">console</span><span class="tok-p">.</span><span class="tok-nx">log</span><span class="tok-p">(</span><span class="tok-s2">&quot;Después con querySelector:&quot;</span> <span class="tok-o">+</span> <span class="tok-nx">queryElements</span><span class="tok-p">.</span><span class="tok-nx">length</span><span class="tok-p">);</span> <span class="tok-c1">// 3</span>
<span class="tok-p">}());</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Si ejecutamos la página y visualizamos el contenido de la consola tendremos:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/js03/getElementVSquerySelector.jpg" alt="getElement vs querySelector" width="50%">
</div>
</div>
</div>
<div class="sect4">
<h5 id="_gestionando_atributos">Gestionando atributos</h5>
<div class="paragraph">
<p>Una vez hemos recuperado un nodo, podemos acceder a sus atributos mediante el método <code>getAttribute(nombreAtributo)</code> y modificarlo mediante <code>setAttribute(nombreAtributo, valorAtributo)</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="javascript"><span class="tok-p">(</span><span class="tok-kd">function</span><span class="tok-p">()</span> <span class="tok-p">{</span>
  <span class="tok-kd">var</span> <span class="tok-nx">pTres</span> <span class="tok-o">=</span> <span class="tok-nb">document</span><span class="tok-p">.</span><span class="tok-nx">getElementById</span><span class="tok-p">(</span><span class="tok-s2">&quot;tres&quot;</span><span class="tok-p">);</span>
  <span class="tok-nx">pTres</span><span class="tok-p">.</span><span class="tok-nx">setAttribute</span><span class="tok-p">(</span><span class="tok-s2">&quot;align&quot;</span><span class="tok-p">,</span><span class="tok-s2">&quot;right&quot;</span><span class="tok-p">);</span>
<span class="tok-p">}());</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>También podemos acceder a los atributos como propiedades de los elementos, con lo que podemos hacer lo mismo del siguiente modo:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="javascript"><span class="tok-p">(</span><span class="tok-kd">function</span><span class="tok-p">()</span> <span class="tok-p">{</span>
  <span class="tok-kd">var</span> <span class="tok-nx">pTres</span> <span class="tok-o">=</span> <span class="tok-nb">document</span><span class="tok-p">.</span><span class="tok-nx">getElementById</span><span class="tok-p">(</span><span class="tok-s2">&quot;tres&quot;</span><span class="tok-p">);</span>
  <span class="tok-nx">pTres</span><span class="tok-p">.</span><span class="tok-nx">align</span> <span class="tok-o">=</span> <span class="tok-s2">&quot;right&quot;</span><span class="tok-p">;</span>
<span class="tok-p">}());</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>La gestión de los atributos están en desuso en favor de las hojas de estilo para dotar a las páginas de un comportamiento predefinido y desacoplado en su archivo correspondiente.</p>
</div>
<div class="paragraph">
<p>Cuando veamos el impacto de HTML 5 en JavaScript estudiaremos el uso de los atributos <code>data</code> y el conjunto <code>dataset</code>.</p>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_trabajando_con_css">3.3. Trabajando con CSS</h3>
<div class="paragraph">
<p>En este apartado vamos a ver como modificar el estilos de los elementos, cambiando sus propiedades CSS mediante el uso de Javascript.</p>
</div>
<div class="admonitionblock caution">
<table>
<tr>
<td class="icon">
<i class="fa icon-caution" title="Caution"></i>
</td>
<td class="content">
Se supone que el alumno ya tiene unos conocimientos básicos de CSS
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Para ello, vamos a basarnos en el siguiente código HTML.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="html"><span class="tok-cp">&lt;!DOCTYPE html&gt;</span>
<span class="tok-nt">&lt;html</span> <span class="tok-na">lang=</span><span class="tok-s">&quot;es&quot;</span><span class="tok-nt">&gt;</span>
<span class="tok-nt">&lt;head&gt;</span>
  <span class="tok-nt">&lt;meta</span> <span class="tok-na">charset=</span><span class="tok-s">&quot;utf-8&quot;</span> <span class="tok-nt">/&gt;</span>
  <span class="tok-nt">&lt;title&gt;&lt;/title&gt;</span>
  <span class="tok-nt">&lt;style&gt;</span>
    <span class="tok-nf">#batman</span> <span class="tok-p">{</span> <span class="tok-p">}</span>
    <span class="tok-nc">.css-class</span> <span class="tok-p">{</span>
      <span class="tok-k">color</span><span class="tok-o">:</span> <span class="tok-nb">blue</span><span class="tok-p">;</span>
      <span class="tok-k">border</span> <span class="tok-o">:</span> <span class="tok-m">1px</span> <span class="tok-k">solid</span> <span class="tok-nb">black</span><span class="tok-p">;</span>
    <span class="tok-p">}</span>
  <span class="tok-nt">&lt;/style&gt;</span>
<span class="tok-nt">&lt;/head&gt;</span>
<span class="tok-nt">&lt;body&gt;</span>
  <span class="tok-nt">&lt;div</span> <span class="tok-na">style=</span><span class="tok-s">&quot;font-size:xx-large&quot;</span> <span class="tok-na">id=</span><span class="tok-s">&quot;batman&quot;</span><span class="tok-nt">&gt;</span>Batman siempre gana.<span class="tok-nt">&lt;/div&gt;</span>
  <span class="tok-nt">&lt;script </span><span class="tok-na">src=</span><span class="tok-s">&quot;css.js&quot;</span><span class="tok-nt">&gt;&lt;/script&gt;</span>
<span class="tok-nt">&lt;/body&gt;</span>
<span class="tok-nt">&lt;/html&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>La propiedad <code>style</code> de los elementos nos permiten obtener/modificar los estilos. Por ejemplo, si queremos cambiar mediante <em>JavaScript</em> el color del texto del párrafo a azul y añadirle un borde negro, haríamos lo siguiente:</p>
</div>
<div class="listingblock">
<div class="title">style - <a href="http://jsbin.com/qitume/1/edit?html,js,output" class="bare">http://jsbin.com/qitume/1/edit?html,js,output</a></div>
<div class="content">
<pre class="pygments highlight"><code data-lang="javascript"><span class="tok-p">(</span><span class="tok-kd">function</span><span class="tok-p">()</span> <span class="tok-p">{</span>
  <span class="tok-kd">var</span> <span class="tok-nx">divBatman</span> <span class="tok-o">=</span> <span class="tok-nb">document</span><span class="tok-p">.</span><span class="tok-nx">getElementById</span><span class="tok-p">(</span><span class="tok-s2">&quot;batman&quot;</span><span class="tok-p">);</span>
  <span class="tok-nx">divBatman</span><span class="tok-p">.</span><span class="tok-nx">style</span><span class="tok-p">.</span><span class="tok-nx">color</span> <span class="tok-o">=</span> <span class="tok-s2">&quot;blue&quot;</span><span class="tok-p">;</span>
  <span class="tok-nx">divBatman</span><span class="tok-p">.</span><span class="tok-nx">style</span><span class="tok-p">.</span><span class="tok-nx">border</span> <span class="tok-o">=</span> <span class="tok-s2">&quot;1px solid black&quot;</span><span class="tok-p">;</span>
<span class="tok-p">}());</span></code></pre>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
Si la propiedad CSS contiene un guión, para usarla mediante <em>JavaScript</em>, se usa la notación <em>camelCase</em>. Así pues, <code>background-color</code> pasará a usarse como <code>backgroundColor</code>.
</td>
</tr>
</table>
</div>
<div class="sect3">
<h4 id="_trabajando_con_clases">3.3.1. Trabajando con clases</h4>
<div class="paragraph">
<p>Si vamos a modificar más de un estilo, es conveniente usar una clase CSS para evitar los múltiples accesos, a la cual accederemos mediante mediante JavaScript con la propiedad <code>className</code>.</p>
</div>
<div class="admonitionblock caution">
<table>
<tr>
<td class="icon">
<i class="fa icon-caution" title="Caution"></i>
</td>
<td class="content">
No se utiliza <code>class</code> por que se trata de una palabra reservada.
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="javascript"><span class="tok-p">(</span><span class="tok-kd">function</span><span class="tok-p">()</span> <span class="tok-p">{</span>
  <span class="tok-kd">var</span> <span class="tok-nx">divBatman</span> <span class="tok-o">=</span> <span class="tok-nb">document</span><span class="tok-p">.</span><span class="tok-nx">getElementById</span><span class="tok-p">(</span><span class="tok-s2">&quot;batman&quot;</span><span class="tok-p">);</span>
  <span class="tok-nx">divBatman</span><span class="tok-p">.</span><span class="tok-nx">className</span> <span class="tok-o">=</span> <span class="tok-s2">&quot;css-class&quot;</span><span class="tok-p">;</span>
  <span class="tok-c1">// divBatman.className = &quot;&quot;; -&gt; elimina la clase CSS</span>
<span class="tok-p">}());</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Si queremos añadir más de una clase, podemos separarlas con espacios o utilizar la propiedad <code>classList</code> (en navegadores actuales - <a href="http://caniuse.com/classlist" class="bare">http://caniuse.com/classlist</a> ) que permite añadir clases mediante el método <code>add</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="javascript"><span class="tok-p">(</span><span class="tok-kd">function</span><span class="tok-p">()</span> <span class="tok-p">{</span>
  <span class="tok-kd">var</span> <span class="tok-nx">divBatman</span> <span class="tok-o">=</span> <span class="tok-nb">document</span><span class="tok-p">.</span><span class="tok-nx">getElementById</span><span class="tok-p">(</span><span class="tok-s2">&quot;batman&quot;</span><span class="tok-p">);</span>
  <span class="tok-nx">divBatman</span><span class="tok-p">.</span><span class="tok-nx">classList</span><span class="tok-p">.</span><span class="tok-nx">add</span><span class="tok-p">(</span><span class="tok-s2">&quot;css-class&quot;</span><span class="tok-p">);</span>
  <span class="tok-nx">divBatman</span><span class="tok-p">.</span><span class="tok-nx">classList</span><span class="tok-p">.</span><span class="tok-nx">add</span><span class="tok-p">(</span><span class="tok-s2">&quot;css-class2&quot;</span><span class="tok-p">);</span>
<span class="tok-p">}());</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Otros métodos útiles de <code>classList</code> son <code>remove</code> para eliminar una clase, <code>toggle</code> para cambiar una clase por otra, <code>length</code> para averiguar la longitud de la lista de clases y <code>contains</code> para averiguar si una clase existe dentro de la lista.</p>
</div>
<div class="paragraph">
<p>Si en algún momento queremos averiguar el estilo de una determinada propiedad, podemos acceder a la propiedad de <code>window.getComputedStyle(elem, null).getPropertyValue(cssProperty)</code>. En el caso de que el navegador no lo soporte (sólo IE antiguos), hay que usar el array <code>currentStyle</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="javascript"><span class="tok-p">(</span><span class="tok-kd">function</span><span class="tok-p">()</span> <span class="tok-p">{</span>
  <span class="tok-kd">var</span> <span class="tok-nx">divBatman</span> <span class="tok-o">=</span> <span class="tok-nb">document</span><span class="tok-p">.</span><span class="tok-nx">getElementById</span><span class="tok-p">(</span><span class="tok-s2">&quot;batman&quot;</span><span class="tok-p">);</span>
  <span class="tok-kd">var</span> <span class="tok-nx">color</span> <span class="tok-o">=</span> <span class="tok-nb">window</span><span class="tok-p">.</span><span class="tok-nx">getComputedStyle</span><span class="tok-p">(</span><span class="tok-nx">divBatman</span><span class="tok-p">,</span> <span class="tok-kc">null</span><span class="tok-p">).</span><span class="tok-nx">getPropertyValue</span><span class="tok-p">(</span><span class="tok-s2">&quot;color&quot;</span><span class="tok-p">);</span>
  <span class="tok-kd">var</span> <span class="tok-nx">colorIE</span> <span class="tok-o">=</span> <span class="tok-nx">divBatman</span><span class="tok-p">.</span><span class="tok-nx">currentStyle</span><span class="tok-p">[</span><span class="tok-s2">&quot;color&quot;</span><span class="tok-p">];</span>
<span class="tok-p">}());</span></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_mostrando_y_ocultando_contenido">3.3.2. Mostrando y ocultando contenido</h4>
<div class="paragraph">
<p>Una acción muy común es mostrar y ocultar contenido de manera dinámica. Esto se puede conseguir ocultando un nodo, y posteriormente volverlo a mostrar.</p>
</div>
<div class="paragraph">
<p>Para ello, tenemos la propiedad <code>style.display</code>. Cuando toma el valor de <code>"none"</code>, no se mostrará el elemento, aunque el mismo exista. Más adelante, para volver a mostrarlo, le asignaremos una cadena vacía a la propiedad <code>style.display</code>, y el elemento reaparecerá.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="javascript"><span class="tok-p">(</span><span class="tok-kd">function</span><span class="tok-p">()</span> <span class="tok-p">{</span>
  <span class="tok-kd">var</span> <span class="tok-nx">divBatman</span> <span class="tok-o">=</span> <span class="tok-nb">document</span><span class="tok-p">.</span><span class="tok-nx">getElementById</span><span class="tok-p">(</span><span class="tok-s2">&quot;batman&quot;</span><span class="tok-p">);</span>
  <span class="tok-nx">divBatman</span><span class="tok-p">.</span><span class="tok-nx">style</span><span class="tok-p">.</span><span class="tok-nx">display</span> <span class="tok-o">=</span> <span class="tok-s2">&quot;none&quot;</span><span class="tok-p">;</span> <span class="tok-c1">// oculta</span>
  <span class="tok-nx">divBatman</span><span class="tok-p">.</span><span class="tok-nx">style</span><span class="tok-p">.</span><span class="tok-nx">display</span> <span class="tok-o">=</span> <span class="tok-s2">&quot;&quot;</span><span class="tok-p">;</span> <span class="tok-c1">// visible</span>
<span class="tok-p">}());</span></code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_animaciones">3.4. Animaciones</h3>
<div class="paragraph">
<p>Uno de las acciones más usadas en las web actual es el movimiento y la manipulación de contenidos, de modo que hay texto que aparece/desaparece o cambia de lugar de manera dinámica.</p>
</div>
<div class="paragraph">
<p>Por ejemplo, si lo que queremos es crear una animación, haremos llamadas sucesivas a una función, pero con un límite de ejecuciones mediante el uso de <a href="#Timers">[Timers]</a>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="javascript"><span class="tok-p">(</span><span class="tok-kd">function</span><span class="tok-p">()</span> <span class="tok-p">{</span>
  <span class="tok-kd">var</span> <span class="tok-nx">velocidad</span> <span class="tok-o">=</span> <span class="tok-mi">2000</span><span class="tok-p">,</span>
    <span class="tok-nx">i</span> <span class="tok-o">=</span> <span class="tok-mi">0</span><span class="tok-p">;</span>
    <span class="tok-nx">miFuncion</span> <span class="tok-o">=</span> <span class="tok-kd">function</span><span class="tok-p">()</span> <span class="tok-p">{</span>
      <span class="tok-nx">console</span><span class="tok-p">.</span><span class="tok-nx">log</span><span class="tok-p">(</span><span class="tok-s2">&quot;Batman vuelve &quot;</span> <span class="tok-o">+</span> <span class="tok-nx">i</span><span class="tok-p">);</span>
      <span class="tok-nx">i</span> <span class="tok-o">=</span> <span class="tok-nx">i</span> <span class="tok-o">+</span> <span class="tok-mi">1</span><span class="tok-p">;</span>
      <span class="tok-k">if</span> <span class="tok-p">(</span><span class="tok-nx">i</span> <span class="tok-o">&lt;</span> <span class="tok-mi">10</span><span class="tok-p">)</span> <span class="tok-p">{</span>
        <span class="tok-nx">setTimeout</span><span class="tok-p">(</span><span class="tok-nx">miFuncion</span><span class="tok-p">,</span> <span class="tok-nx">velocidad</span><span class="tok-p">);</span>  <i class="conum" data-value="2"></i><b>(2)</b>
      <span class="tok-p">}</span>
    <span class="tok-p">};</span>
  <span class="tok-nx">setTimeout</span><span class="tok-p">(</span><span class="tok-nx">miFuncion</span><span class="tok-p">,</span> <span class="tok-nx">velocidad</span><span class="tok-p">);</span> <i class="conum" data-value="1"></i><b>(1)</b>
<span class="tok-p">}());</span></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Hacemos una llamada a <code>miFuncion</code></td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Con los valores de <code>i</code> de 0 a 9 se ejecutará <code>miFuncion</code> con una separación de <code>velocidad</code> milisegundos</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Otra manera de hacerlo es utilizar la función <code>setInterval(funcion, intervalo)</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="javascript"><span class="tok-p">(</span><span class="tok-kd">function</span><span class="tok-p">()</span> <span class="tok-p">{</span>
  <span class="tok-kd">var</span> <span class="tok-nx">velocidad</span> <span class="tok-o">=</span> <span class="tok-mi">2000</span><span class="tok-p">,</span>
    <span class="tok-nx">i</span> <span class="tok-o">=</span> <span class="tok-mi">0</span><span class="tok-p">;</span>
    <span class="tok-nx">miFuncion</span> <span class="tok-o">=</span> <span class="tok-kd">function</span><span class="tok-p">()</span> <span class="tok-p">{</span>
      <span class="tok-nx">console</span><span class="tok-p">.</span><span class="tok-nx">log</span><span class="tok-p">(</span><span class="tok-s2">&quot;Batman vuelve &quot;</span> <span class="tok-o">+</span> <span class="tok-nx">i</span><span class="tok-p">);</span>
      <span class="tok-nx">i</span> <span class="tok-o">=</span> <span class="tok-nx">i</span> <span class="tok-o">+</span> <span class="tok-mi">1</span><span class="tok-p">;</span>
      <span class="tok-k">if</span> <span class="tok-p">(</span><span class="tok-nx">i</span> <span class="tok-o">&gt;</span> <span class="tok-mi">9</span><span class="tok-p">)</span> <span class="tok-p">{</span>
        <span class="tok-nx">clearInterval</span><span class="tok-p">(</span><span class="tok-nx">timer</span><span class="tok-p">);</span>
      <span class="tok-p">}</span>
    <span class="tok-p">};</span>
  <span class="tok-kd">var</span> <span class="tok-nx">timer</span> <span class="tok-o">=</span> <span class="tok-nx">setTimeout</span><span class="tok-p">(</span><span class="tok-nx">miFuncion</span><span class="tok-p">,</span> <span class="tok-nx">velocidad</span><span class="tok-p">);</span>
<span class="tok-p">}());</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Para ver un ejemplo de animación en movimiento, a partir de una capa con un cuadrado azul, vamos a moverla horizontalmente de manera ininterrumpida.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="html"><span class="tok-cp">&lt;!DOCTYPE html&gt;</span>
<span class="tok-nt">&lt;html</span> <span class="tok-na">lang=</span><span class="tok-s">&quot;es&quot;</span><span class="tok-nt">&gt;</span>
<span class="tok-nt">&lt;head&gt;</span>
  <span class="tok-nt">&lt;meta</span> <span class="tok-na">charset=</span><span class="tok-s">&quot;utf-8&quot;</span> <span class="tok-nt">/&gt;</span>
  <span class="tok-nt">&lt;title&gt;</span>Caja<span class="tok-nt">&lt;/title&gt;</span>
  <span class="tok-nt">&lt;style&gt;</span>
      <span class="tok-nf">#caja</span> <span class="tok-p">{</span>
        <span class="tok-k">position</span><span class="tok-o">:</span> <span class="tok-k">absolute</span><span class="tok-p">;</span>
        <span class="tok-k">left</span><span class="tok-o">:</span> <span class="tok-m">50px</span><span class="tok-p">;</span>
        <span class="tok-k">top</span><span class="tok-o">:</span> <span class="tok-m">50px</span><span class="tok-p">;</span>
        <span class="tok-k">background-color</span><span class="tok-o">:</span> <span class="tok-nb">blue</span><span class="tok-p">;</span>
        <span class="tok-k">height</span><span class="tok-o">:</span> <span class="tok-m">100px</span><span class="tok-p">;</span>
        <span class="tok-k">width</span><span class="tok-o">:</span> <span class="tok-m">100px</span><span class="tok-p">;</span>
      <span class="tok-p">}</span>
  <span class="tok-nt">&lt;/style&gt;</span>
<span class="tok-nt">&lt;/head&gt;</span>
<span class="tok-nt">&lt;body&gt;</span>
  <span class="tok-nt">&lt;div</span> <span class="tok-na">id=</span><span class="tok-s">&quot;caja&quot;</span><span class="tok-nt">&gt;&lt;/div&gt;</span>
  <span class="tok-nt">&lt;script </span><span class="tok-na">src=</span><span class="tok-s">&quot;caja.js&quot;</span><span class="tok-nt">&gt;&lt;/script&gt;</span>
<span class="tok-nt">&lt;/body&gt;</span>
<span class="tok-nt">&lt;/html&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Y en script, de forma similar al ejemplo anterior:</p>
</div>
<div class="listingblock">
<div class="title">Ejemplo Animación - <a href="http://jsbin.com/daziha/2/edit?html,css,js,output" class="bare">http://jsbin.com/daziha/2/edit?html,css,js,output</a></div>
<div class="content">
<pre class="pygments highlight"><code data-lang="javascript"><span class="tok-p">(</span><span class="tok-kd">function</span><span class="tok-p">()</span> <span class="tok-p">{</span>
  <span class="tok-kd">var</span> <span class="tok-nx">velocidad</span> <span class="tok-o">=</span> <span class="tok-mi">10</span><span class="tok-p">,</span>
    <span class="tok-nx">mueveCaja</span> <span class="tok-o">=</span> <span class="tok-kd">function</span><span class="tok-p">(</span><span class="tok-nx">pasos</span><span class="tok-p">)</span> <span class="tok-p">{</span>
      <span class="tok-kd">var</span> <span class="tok-nx">el</span> <span class="tok-o">=</span> <span class="tok-nb">document</span><span class="tok-p">.</span><span class="tok-nx">getElementById</span><span class="tok-p">(</span><span class="tok-s2">&quot;caja&quot;</span><span class="tok-p">),</span>
        <span class="tok-nx">izq</span> <span class="tok-o">=</span> <span class="tok-nx">el</span><span class="tok-p">.</span><span class="tok-nx">offsetLeft</span><span class="tok-p">;</span> <i class="conum" data-value="1"></i><b>(1)</b>

      <span class="tok-k">if</span> <span class="tok-p">((</span><span class="tok-nx">pasos</span> <span class="tok-o">&gt;</span> <span class="tok-mi">0</span> <span class="tok-o">&amp;&amp;</span> <span class="tok-nx">izq</span> <span class="tok-o">&gt;</span> <span class="tok-mi">399</span><span class="tok-p">)</span> <span class="tok-o">||</span> <span class="tok-p">(</span><span class="tok-nx">pasos</span> <span class="tok-o">&lt;</span> <span class="tok-mi">0</span> <span class="tok-o">&amp;&amp;</span> <span class="tok-nx">izq</span> <span class="tok-o">&lt;</span> <span class="tok-mi">51</span><span class="tok-p">))</span> <span class="tok-p">{</span>
        <span class="tok-nx">clearTimeout</span><span class="tok-p">(</span><span class="tok-nx">timer</span><span class="tok-p">);</span> <i class="conum" data-value="2"></i><b>(2)</b>
        <span class="tok-nx">timer</span> <span class="tok-o">=</span> <span class="tok-nx">setInterval</span><span class="tok-p">(</span><span class="tok-kd">function</span><span class="tok-p">()</span> <span class="tok-p">{</span>
          <span class="tok-nx">mueveCaja</span><span class="tok-p">(</span><span class="tok-nx">pasos</span> <span class="tok-o">*</span> <span class="tok-o">-</span><span class="tok-mi">1</span><span class="tok-p">);</span>  <i class="conum" data-value="3"></i><b>(3)</b>
        <span class="tok-p">},</span> <span class="tok-nx">velocidad</span><span class="tok-p">);</span>
      <span class="tok-p">}</span>

      <span class="tok-nx">el</span><span class="tok-p">.</span><span class="tok-nx">style</span><span class="tok-p">.</span><span class="tok-nx">left</span> <span class="tok-o">=</span> <span class="tok-nx">izq</span> <span class="tok-o">+</span> <span class="tok-nx">pasos</span> <span class="tok-o">+</span> <span class="tok-s2">&quot;px&quot;</span><span class="tok-p">;</span> <i class="conum" data-value="4"></i><b>(4)</b>
    <span class="tok-p">};</span>

  <span class="tok-kd">var</span> <span class="tok-nx">timer</span> <span class="tok-o">=</span> <span class="tok-nx">setInterval</span><span class="tok-p">(</span><span class="tok-kd">function</span> <span class="tok-p">()</span> <span class="tok-p">{</span>
    <span class="tok-nx">mueveCaja</span><span class="tok-p">(</span><span class="tok-mi">3</span><span class="tok-p">);</span>
  <span class="tok-p">},</span> <span class="tok-nx">velocidad</span><span class="tok-p">);</span>
<span class="tok-p">}());</span></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Obtenemos su posición respecto al margen izquierdo</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Si llegamos a uno de los límites horizontales (de 0 a 400, paramos la función)</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Y volvemos a llamarla pero en sentido contrario</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Fija la posición del cuadrado con la que tenía más el número de pasos definidos (de 3 en 3, o de -3 en -3)</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_eventos">3.5. Eventos</h3>
<div class="paragraph">
<p>Los eventos nos van a permitir asociar funciones a acciones que ocurren en el navegador tras la interacción con el usuario, ya sea mediante el teclado o el ratón.</p>
</div>
<div class="sect3">
<h4 id="_gestionando_eventos">3.5.1. Gestionando eventos</h4>
<div class="paragraph">
<p>Para comenzar con un ejemplo muy sencillo, vamos a basarnos en la página web que dibujaba un cuadrado. A partir del evento de hacer click sobre el mismo, cambiaremos su color a rojo. Para ello:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="javascript"><span class="tok-p">(</span><span class="tok-kd">function</span><span class="tok-p">()</span> <span class="tok-p">{</span>
  <span class="tok-kd">var</span> <span class="tok-nx">el</span> <span class="tok-o">=</span> <span class="tok-nb">document</span><span class="tok-p">.</span><span class="tok-nx">getElementById</span><span class="tok-p">(</span><span class="tok-s2">&quot;caja&quot;</span><span class="tok-p">);</span>

  <span class="tok-nx">el</span><span class="tok-p">.</span><span class="tok-nx">onclick</span> <span class="tok-o">=</span> <span class="tok-kd">function</span><span class="tok-p">()</span> <span class="tok-p">{</span>  <i class="conum" data-value="1"></i><b>(1)</b>
    <span class="tok-k">this</span><span class="tok-p">.</span><span class="tok-nx">style</span><span class="tok-p">.</span><span class="tok-nx">backgroundColor</span> <span class="tok-o">=</span> <span class="tok-s2">&quot;red&quot;</span><span class="tok-p">;</span>
  <span class="tok-p">};</span>  <i class="conum" data-value="2"></i><b>(2)</b>

<span class="tok-p">}());</span></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Definimos una función que se ejecutará cada vez que se haga click sobre el elemento</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Un error muy común es olvidar el <code>;</code> tras la definición de la función</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Podemos observar como hemos asociado una función a la propiedad <code>onclick</code> de un elemento, mediante la técnica de <strong>elemento.evento</strong>. De este modo, cada vez que hagamos click sobre el elemento <code>caja</code> se ejecutará dicha función anónima. Otros eventos que podemos usar son <code>onload</code>, <code>onmouseover</code>, <code>onblur</code>, <code>onfocus</code>, etc&#8230;&#8203;</p>
</div>
<div class="paragraph">
<p>Otra formar de asociar una acción al evento, aunque no se recomienda, es incrustar el código JavaScript como parte de un atributo de etiqueta HTML, con el nombre del evento:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="html"><span class="tok-nt">&lt;button</span> <span class="tok-na">onclick=</span><span class="tok-s">&quot;this.style.backgroundColor=&#39;red&#39;;&quot;</span><span class="tok-nt">&gt;</span>Incrustado<span class="tok-nt">&lt;/button&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Y la tercera forma es utilizar la función <code>addEventListener(evento, función, flujoEvento)</code> que veremos más adelante.</p>
</div>
<div class="sect4">
<h5 id="_ejemplo_botones_y_click">Ejemplo botones y click</h5>
<div class="paragraph">
<p>Vamos a hacer un ejemplo un poco más completo. Para ello, vamos a definir una página de web que va a cambiar el estilo con los colores de fondo/frente conforme pulsemos un botón u otro.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="html"><span class="tok-cp">&lt;!DOCTYPE html&gt;</span>
<span class="tok-nt">&lt;html</span> <span class="tok-na">lang=</span><span class="tok-s">&quot;es&quot;</span><span class="tok-nt">&gt;</span>
  <span class="tok-nt">&lt;head&gt;</span>
    <span class="tok-nt">&lt;meta</span> <span class="tok-na">charset=</span><span class="tok-s">&quot;utf-8&quot;</span> <span class="tok-nt">/&gt;</span>
    <span class="tok-nt">&lt;title&gt;</span>Hola Eventos<span class="tok-nt">&lt;/title&gt;</span>
    <span class="tok-nt">&lt;style&gt;</span>
      <span class="tok-nc">.normal</span> <span class="tok-p">{</span>
        <span class="tok-k">background-color</span><span class="tok-o">:</span> <span class="tok-nb">white</span><span class="tok-p">;</span>
        <span class="tok-k">color</span><span class="tok-o">:</span> <span class="tok-nb">black</span><span class="tok-p">;</span>
      <span class="tok-p">}</span>
      <span class="tok-nc">.contrario</span> <span class="tok-p">{</span>
        <span class="tok-k">background-color</span><span class="tok-o">:</span> <span class="tok-nb">black</span><span class="tok-p">;</span>
        <span class="tok-k">color</span><span class="tok-o">:</span> <span class="tok-nb">white</span><span class="tok-p">;</span>
      <span class="tok-p">}</span>
    <span class="tok-nt">&lt;/style&gt;</span>
  <span class="tok-nt">&lt;/head&gt;</span>
  <span class="tok-nt">&lt;body</span> <span class="tok-na">class=</span><span class="tok-s">&quot;normal&quot;</span><span class="tok-nt">&gt;</span>
      <span class="tok-nt">&lt;h1&gt;</span>Hola Eventos<span class="tok-nt">&lt;/h1&gt;</span>
      <span class="tok-nt">&lt;p&gt;&lt;a</span> <span class="tok-na">href=</span><span class="tok-s">&quot;http://es.wikipedia.org/wiki/Batman&quot;</span><span class="tok-nt">&gt;</span>Batman<span class="tok-nt">&lt;/a&gt;</span> Forever<span class="tok-nt">&lt;/p&gt;</span>

      <span class="tok-nt">&lt;button&gt;</span>Normal<span class="tok-nt">&lt;/button&gt;</span>
      <span class="tok-nt">&lt;button&gt;</span>Contrario<span class="tok-nt">&lt;/button&gt;</span>

      <span class="tok-nt">&lt;script </span><span class="tok-na">src=</span><span class="tok-s">&quot;eventos.js&quot;</span><span class="tok-nt">&gt;&lt;/script&gt;</span>
  <span class="tok-nt">&lt;/body&gt;</span>
<span class="tok-nt">&lt;/html&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Y el código <em>JavaScript</em> sería el siguiente:</p>
</div>
<div class="listingblock">
<div class="title">Ejemplo Click - <a href="http://jsbin.com/qawilu/1/edit?html,css,js,output" class="bare">http://jsbin.com/qawilu/1/edit?html,css,js,output</a></div>
<div class="content">
<pre class="pygments highlight"><code data-lang="javascript"><span class="tok-p">(</span><span class="tok-kd">function</span><span class="tok-p">()</span> <span class="tok-p">{</span>
  <span class="tok-kd">var</span> <span class="tok-nx">botones</span> <span class="tok-o">=</span> <span class="tok-nb">document</span><span class="tok-p">.</span><span class="tok-nx">getElementsByTagName</span><span class="tok-p">(</span><span class="tok-s2">&quot;button&quot;</span><span class="tok-p">);</span>

  <span class="tok-k">for</span> <span class="tok-p">(</span><span class="tok-kd">var</span> <span class="tok-nx">i</span><span class="tok-o">=</span><span class="tok-mi">0</span><span class="tok-p">,</span> <span class="tok-nx">len</span><span class="tok-o">=</span><span class="tok-nx">botones</span><span class="tok-p">.</span><span class="tok-nx">length</span><span class="tok-p">;</span> <span class="tok-nx">i</span><span class="tok-o">&lt;</span><span class="tok-nx">len</span><span class="tok-p">;</span> <span class="tok-nx">i</span><span class="tok-o">=</span><span class="tok-nx">i</span><span class="tok-o">+</span><span class="tok-mi">1</span><span class="tok-p">)</span> <span class="tok-p">{</span>
    <span class="tok-nx">botones</span><span class="tok-p">[</span><span class="tok-nx">i</span><span class="tok-p">].</span><span class="tok-nx">onclick</span> <span class="tok-o">=</span> <span class="tok-kd">function</span><span class="tok-p">()</span> <span class="tok-p">{</span>
      <span class="tok-kd">var</span> <span class="tok-nx">className</span> <span class="tok-o">=</span> <span class="tok-k">this</span><span class="tok-p">.</span><span class="tok-nx">innerHTML</span><span class="tok-p">.</span><span class="tok-nx">toLowerCase</span><span class="tok-p">();</span>
      <span class="tok-nb">document</span><span class="tok-p">.</span><span class="tok-nx">body</span><span class="tok-p">.</span><span class="tok-nx">className</span> <span class="tok-o">=</span> <span class="tok-nx">className</span><span class="tok-p">;</span>
    <span class="tok-p">};</span>
    <span class="tok-c1">// botones[i].onclick = function() {};</span>
  <span class="tok-p">}</span>
<span class="tok-p">}());</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Para cada uno de los botones, le añadimos una función anónima al evento <code>onclick</code> para que le asigne al <code>body</code> la clase que coincide con el nombre del botón (en minúsculas).</p>
</div>
<div class="admonitionblock caution">
<table>
<tr>
<td class="icon">
<i class="fa icon-caution" title="Caution"></i>
</td>
<td class="content">
Mucho cuidado con añadir una segunda función al mismo evento tal cual está en la línea 9, ya que realmente estaremos sobreescribiendo (y borrando) la función anterior.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Ante el mismo evento, un objeto puede tener solo un manejador, pero varios listeners.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_flujo_de_eventos">3.5.2. Flujo de eventos</h4>
<div class="paragraph">
<p>A la hora de propagarse un evento, existen dos posibilidades al definir el flujo de eventos para saber cual es el elemento que va a responder al mismo:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Con la <strong>captura de eventos</strong>, al pulsar sobre un elemento, se produce una evento de arriba a abajo, desde el elemento <code>window</code>, pasando por <code>&lt;body&gt;</code> hasta llegar al elemento que lo captura.</p>
</li>
<li>
<p>En cambio, mediante el <strong>burbujeo de eventos</strong> (<em>event bubbling</em>), el evento se produce en el elemento de más abajo y va subiendo hasta llegar al <code>window</code>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Por ejemplo, si tuviéramos el siguiente fragmento HTML:</p>
</div>
<div class="listingblock">
<div class="title">Ejemplo de Flujo de Evento</div>
<div class="content">
<pre class="pygments highlight"><code data-lang="html"><span class="tok-nt">&lt;html</span> <span class="tok-na">onclick=</span><span class="tok-s">&quot;procesaEvento()&quot;</span><span class="tok-nt">&gt;</span>
  <span class="tok-nt">&lt;head&gt;&lt;title&gt;</span>Ejemplo de flujo de eventos<span class="tok-nt">&lt;/title&gt;&lt;/head&gt;</span>
  <span class="tok-nt">&lt;body</span> <span class="tok-na">onclick=</span><span class="tok-s">&quot;procesaEvento()&quot;</span><span class="tok-nt">&gt;</span>
    <span class="tok-nt">&lt;div</span> <span class="tok-na">onclick=</span><span class="tok-s">&quot;procesaEvento()&quot;</span><span class="tok-nt">&gt;</span>Pincha aqui<span class="tok-nt">&lt;/div&gt;</span>
  <span class="tok-nt">&lt;/body&gt;</span>
<span class="tok-nt">&lt;/html&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Cuando se pulsa sobre el texto <em>"Pincha aquí"</em> que se encuentra dentro del <code>&lt;div&gt;</code>, si el navegador sigue el modelo de <em>event bubbling</em>, se ejecutan los siguientes eventos en el orden que muestra el siguiente esquema:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/js03/eventosBurbuja.gif" alt="Burbuja de evento" width="50%">
</div>
<div class="title">Figure 13. Burbuja de Eventos</div>
</div>
<div class="paragraph">
<p>En cambio mediante la captura de eventos tendríamos:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/js03/eventosCaptura.gif" alt="Captura de eventos" width="50%">
</div>
<div class="title">Figure 14. Captura de Eventos</div>
</div>
<div class="paragraph">
<p>El flujo de eventos definido en la especificación DOM soporta tanto el burbujeo como la captura, pero la captura de eventos se ejecuta en primer lugar. Los dos flujos de eventos recorren todos los objetos DOM desde el objeto <code>document</code> hasta el elemento más específico o viceversa.</p>
</div>
</div>
<div class="sect3">
<h4 id="_el_modelo_estándar">3.5.3. El modelo estándar</h4>
<div class="paragraph">
<p>También conocido como eventos de DOM nivel 0, consisten en asignar una función al evento de un elemento.</p>
</div>
<div class="paragraph">
<p>Este modelo se puede hacer utilizando el atributo <code>on*</code> de las etiquetas HTML, o de manera programativa mediante el uso del método <code>addEventListener(evento, función, flujoEvento)</code>.</p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
Vamos a obviar a IE8 y versiones anteriores que no gestionan los eventos de esta manera. Si estás interesado en dicho navegador, emplean la función <code>attachEvent</code> con el mismo propósito. La gestión de código <em>cross-browser</em> la solucionaremos mediante el uso de <em>jQuery</em>.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>El parámetro <code>flujoEvento</code> puede tomar los valores <code>true</code> para aplicar el modelo de captura de eventos, o <code>false</code> para <em>event bubbling</em> (recomendado).</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="javascript"><span class="tok-p">(</span><span class="tok-kd">function</span><span class="tok-p">()</span> <span class="tok-p">{</span>
  <span class="tok-kd">var</span> <span class="tok-nx">botonClick</span> <span class="tok-o">=</span> <span class="tok-kd">function</span><span class="tok-p">()</span> <span class="tok-p">{</span>  <i class="conum" data-value="1"></i><b>(1)</b>
    <span class="tok-kd">var</span> <span class="tok-nx">className</span> <span class="tok-o">=</span> <span class="tok-k">this</span><span class="tok-p">.</span><span class="tok-nx">innerHTML</span><span class="tok-p">.</span><span class="tok-nx">toLowerCase</span><span class="tok-p">();</span>
    <span class="tok-nb">document</span><span class="tok-p">.</span><span class="tok-nx">body</span><span class="tok-p">.</span><span class="tok-nx">className</span> <span class="tok-o">=</span> <span class="tok-nx">className</span><span class="tok-p">;</span>
  <span class="tok-p">}</span>

  <span class="tok-kd">var</span> <span class="tok-nx">botones</span> <span class="tok-o">=</span> <span class="tok-nb">document</span><span class="tok-p">.</span><span class="tok-nx">getElementsByTagName</span><span class="tok-p">(</span><span class="tok-s2">&quot;button&quot;</span><span class="tok-p">);</span>
  <span class="tok-k">for</span> <span class="tok-p">(</span><span class="tok-kd">var</span> <span class="tok-nx">i</span><span class="tok-o">=</span><span class="tok-mi">0</span><span class="tok-p">,</span> <span class="tok-nx">len</span><span class="tok-o">=</span><span class="tok-nx">botones</span><span class="tok-p">.</span><span class="tok-nx">length</span><span class="tok-p">;</span> <span class="tok-nx">i</span><span class="tok-o">&lt;</span><span class="tok-nx">len</span><span class="tok-p">;</span> <span class="tok-nx">i</span><span class="tok-o">=</span><span class="tok-nx">i</span><span class="tok-o">+</span><span class="tok-mi">1</span><span class="tok-p">)</span> <span class="tok-p">{</span>
    <span class="tok-nx">botones</span><span class="tok-p">[</span><span class="tok-nx">i</span><span class="tok-p">].</span><span class="tok-nx">addEventListener</span><span class="tok-p">(</span><span class="tok-s2">&quot;click&quot;</span><span class="tok-p">,</span> <span class="tok-nx">botonClick</span><span class="tok-p">,</span> <span class="tok-kc">false</span><span class="tok-p">);</span>  <i class="conum" data-value="2"></i><b>(2)</b>
    <span class="tok-c1">// botones[i].removeEventListener(&quot;click&quot;, botonClick, false);</span>
  <span class="tok-p">}</span>
<span class="tok-p">}());</span></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Función que cambia la clase del <code>body</code> al valor del elemento con el que se invoque (en nuestro caso, el nombre del botón)</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>A cada botón, se le registra al evento <em>click</em> el manejador de eventos de la función del paso 1, y con flujo de <em>event bubbling</em>.</td>
</tr>
</table>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
Al añadir eventos mediante <code>addEventListener</code> sí que podemos añadir más de una función con el mismo evento a un mismo elemento.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Para borrar un evento podemos usar su antónimo <code>removeEventListener(evento, función, flujoEvento)</code>. Cabe destacar que la función a eliminar debe ser la misma que la utilizada al añadir el evento, por lo que no podemos usar funciones anónimas.</p>
</div>
<div class="paragraph">
<p>Si en algún momento necesitamos obtener información sobre el evento, podemos recoger en la función manejadora del evento un parámetro que se asociará de manera automática al evento. Este parámetro contiene las propiedad <code>type</code> que índica el evento del que proviene (en el ejemplo, sería <code>click</code>), y <code>target</code> con el elemento sobre el cual esta registrado (en el ejemplo sería <code>HTMLButtonElement</code>).</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="javascript"><span class="tok-kd">var</span> <span class="tok-nx">botonClick</span> <span class="tok-o">=</span> <span class="tok-kd">function</span><span class="tok-p">(</span><span class="tok-nx">evt</span><span class="tok-p">)</span> <span class="tok-p">{</span>
  <span class="tok-kd">var</span> <span class="tok-nx">className</span> <span class="tok-o">=</span> <span class="tok-k">this</span><span class="tok-p">.</span><span class="tok-nx">innerHTML</span><span class="tok-p">.</span><span class="tok-nx">toLowerCase</span><span class="tok-p">();</span>
  <span class="tok-nb">document</span><span class="tok-p">.</span><span class="tok-nx">body</span><span class="tok-p">.</span><span class="tok-nx">className</span> <span class="tok-o">=</span> <span class="tok-nx">className</span><span class="tok-p">;</span>
  <span class="tok-nx">console</span><span class="tok-p">.</span><span class="tok-nx">log</span><span class="tok-p">(</span><span class="tok-nx">evt</span><span class="tok-p">.</span><span class="tok-nx">type</span> <span class="tok-o">+</span> <span class="tok-s2">&quot; - &quot;</span> <span class="tok-o">+</span> <span class="tok-nx">evt</span><span class="tok-p">.</span><span class="tok-nx">target</span><span class="tok-p">);</span> <span class="tok-c1">// click - HTMLButtonElement</span>
<span class="tok-p">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Por último, sobre el evento podemos llamar al método <code>preventDefault()</code> para cancelar el comportamiento por defecto que tenía asociado el elemento sobre el cual se ha registrado el evento. Por ejemplo, si quisiéramos evitar que al pulsar sobre el enlace nos llevase a su destino:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="javascript"><span class="tok-kd">var</span> <span class="tok-nx">enlaceClick</span> <span class="tok-o">=</span> <span class="tok-kd">function</span><span class="tok-p">(</span><span class="tok-nx">evt</span><span class="tok-p">)</span> <span class="tok-p">{</span>
  <span class="tok-nx">evt</span><span class="tok-p">.</span><span class="tok-nx">preventDefault</span><span class="tok-p">();</span>
<span class="tok-p">}</span></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_delegación_de_eventos">3.5.4. Delegación de eventos</h4>
<div class="paragraph">
<p>Se basa en el flujo de eventos ofrecidos por <em>event bubbling</em> para delegar un evento desde un elemento inferior en el DOM que va a subir como una burbuja hasta el exterior.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="javascript"><span class="tok-p">(</span><span class="tok-kd">function</span><span class="tok-p">()</span> <span class="tok-p">{</span>
  <span class="tok-nb">document</span><span class="tok-p">.</span><span class="tok-nx">addEventListener</span><span class="tok-p">(</span><span class="tok-s2">&quot;click&quot;</span><span class="tok-p">,</span> <span class="tok-kd">function</span><span class="tok-p">(</span><span class="tok-nx">evt</span><span class="tok-p">)</span> <span class="tok-p">{</span>
    <span class="tok-kd">var</span> <span class="tok-nx">tag</span> <span class="tok-o">=</span> <span class="tok-nx">evt</span><span class="tok-p">.</span><span class="tok-nx">target</span><span class="tok-p">.</span><span class="tok-nx">tagName</span><span class="tok-p">;</span>
      <span class="tok-nx">console</span><span class="tok-p">.</span><span class="tok-nx">log</span><span class="tok-p">(</span><span class="tok-s2">&quot;Click en &quot;</span> <span class="tok-o">+</span> <span class="tok-nx">tag</span><span class="tok-p">);</span>

    <span class="tok-k">if</span> <span class="tok-p">(</span><span class="tok-s2">&quot;A&quot;</span> <span class="tok-o">==</span> <span class="tok-nx">tag</span><span class="tok-p">)</span> <span class="tok-p">{</span>
      <span class="tok-nx">evt</span><span class="tok-p">.</span><span class="tok-nx">preventDefault</span><span class="tok-p">();</span>
    <span class="tok-p">}</span>
  <span class="tok-p">},</span> <span class="tok-kc">false</span><span class="tok-p">);</span>
<span class="tok-p">})();</span></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_tipos_de_eventos">3.5.5. Tipos de eventos</h4>
<div class="paragraph">
<p>Podemos dividir, a grosso modo, los eventos en los siguientes tipos:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Evento de carga.</p>
</li>
<li>
<p>Eventos de foco.</p>
</li>
<li>
<p>Eventos de ratón.</p>
</li>
<li>
<p>Eventos de teclado.</p>
</li>
</ul>
</div>
<div class="sect4">
<h5 id="_evento_de_carga">Evento de carga</h5>
<div class="paragraph">
<p>Para poder asignar un <em>listener</em> a un elemento del DOM, éste debe haberse cargado, y de ahí la conveniencia de incluir el código JavaScript al final de la página HTML, justo antes de cerrar el body.</p>
</div>
<div class="paragraph">
<p>Para asegurarnos que el documento ha cargado completamente, podemos usar el evento <code>window.onload</code>. De este modo podríamos enlazar el código JavaScript al inicio de la página:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="javascript"><span class="tok-kd">function</span> <span class="tok-nx">preparandoManejadores</span><span class="tok-p">()</span> <span class="tok-p">{</span>
  <span class="tok-kd">var</span> <span class="tok-nx">miLogo</span> <span class="tok-o">=</span> <span class="tok-nb">document</span><span class="tok-p">.</span><span class="tok-nx">getElementById</span><span class="tok-p">(</span><span class="tok-s2">&quot;logo&quot;</span><span class="tok-p">);</span>
  <span class="tok-nx">miLogo</span><span class="tok-p">.</span><span class="tok-nx">onclick</span><span class="tok-p">()</span> <span class="tok-p">{</span>
    <span class="tok-nx">alert</span><span class="tok-p">(</span><span class="tok-s2">&quot;Has venido al sitio adecuado.&quot;</span><span class="tok-p">);</span>
  <span class="tok-p">}</span>
<span class="tok-p">}</span>

<span class="tok-nb">window</span><span class="tok-p">.</span><span class="tok-nx">onload</span> <span class="tok-o">=</span> <span class="tok-kd">function</span><span class="tok-p">()</span> <span class="tok-p">{</span>
  <span class="tok-nx">preparandoManejadores</span><span class="tok-p">();</span>
<span class="tok-p">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Un fallo recurrente es incluir más de un manejador para el mismo evento <code>onload</code>. Si incluimos diferentes archivos <code>.js</code>, únicamente se cargará el último manejador, lo que puede provocar comportamientos no deseados.</p>
</div>
<div class="paragraph">
<p>Una característica a destacar es que el evento se lanzará una vez todo el contenido se ha descargado, lo que incluye las imágenes de la página.</p>
</div>
</div>
<div class="sect4">
<h5 id="_eventos_de_foco">Eventos de foco</h5>
<div class="paragraph">
<p>Cuando trabajamos con formularios, al <em>clickar</em> o acceder a un campo mediante el uso del tabulador, éste obtiene el foco, lo que lanza el evento <code>onfocus</code>. Al cambiar a otro campo, el elemento que tiene el foco lo pierde, y se lanza el evento <code>onblur</code>.</p>
</div>
<div class="paragraph">
<p>Supongamos el siguiente fragmento de un formulario:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="html"><span class="tok-nt">&lt;form</span> <span class="tok-na">name=</span><span class="tok-s">&quot;miForm&quot;</span><span class="tok-nt">&gt;</span>
  Nombre: <span class="tok-nt">&lt;input</span> <span class="tok-na">type=</span><span class="tok-s">&quot;text&quot;</span> <span class="tok-na">name=</span><span class="tok-s">&quot;nombre&quot;</span> <span class="tok-na">id=</span><span class="tok-s">&quot;nom&quot;</span> <span class="tok-na">tabindex=</span><span class="tok-s">&quot;10&quot;</span> <span class="tok-nt">/&gt;</span>
  Apellidos: <span class="tok-nt">&lt;input</span> <span class="tok-na">type=</span><span class="tok-s">&quot;text&quot;</span> <span class="tok-na">name=</span><span class="tok-s">&quot;apellidos&quot;</span> <span class="tok-na">id=</span><span class="tok-s">&quot;ape&quot;</span> <span class="tok-na">tabindex=</span><span class="tok-s">&quot;20&quot;</span> <span class="tok-nt">/&gt;</span>
<span class="tok-nt">&lt;/form&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Vamos a simular el comportamiento del atributo <code>placeHolder</code> de HTML5, que escribe un texto de ayuda al campo que desaparece al tener el foco. Tal como veremos más adelante, para acceder al valor de un campo de texto hemos de utilizar la propiedad <code>value</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="javascript"><span class="tok-kd">var</span> <span class="tok-nx">campoNombre</span> <span class="tok-o">=</span> <span class="tok-nb">document</span><span class="tok-p">.</span><span class="tok-nx">getElementById</span><span class="tok-p">(</span><span class="tok-s2">&quot;nom&quot;</span><span class="tok-p">);</span>
<span class="tok-nx">campoNombre</span><span class="tok-p">.</span><span class="tok-nx">value</span> <span class="tok-o">=</span> <span class="tok-s2">&quot;Escribe tu nombre&quot;</span><span class="tok-p">;</span>

<span class="tok-nx">campoNombre</span><span class="tok-p">.</span><span class="tok-nx">onfocus</span> <span class="tok-o">=</span> <span class="tok-kd">function</span><span class="tok-p">()</span> <span class="tok-p">{</span>
  <span class="tok-k">if</span> <span class="tok-p">(</span> <span class="tok-nx">campoNombre</span><span class="tok-p">.</span><span class="tok-nx">value</span> <span class="tok-o">==</span> <span class="tok-s2">&quot;Escribe tu nombre&quot;</span><span class="tok-p">)</span> <span class="tok-p">{</span>
    <span class="tok-nx">campoNombre</span><span class="tok-p">.</span><span class="tok-nx">value</span> <span class="tok-o">=</span> <span class="tok-s2">&quot;&quot;</span><span class="tok-p">;</span>
  <span class="tok-p">}</span>
<span class="tok-p">};</span>

<span class="tok-nx">campoNombre</span><span class="tok-p">.</span><span class="tok-nx">onblur</span> <span class="tok-o">=</span> <span class="tok-kd">function</span><span class="tok-p">()</span> <span class="tok-p">{</span>
  <span class="tok-k">if</span> <span class="tok-p">(</span> <span class="tok-nx">campoNombre</span><span class="tok-p">.</span><span class="tok-nx">value</span> <span class="tok-o">==</span> <span class="tok-s2">&quot;&quot;</span><span class="tok-p">)</span> <span class="tok-p">{</span>
    <span class="tok-nx">campoNombre</span><span class="tok-p">.</span><span class="tok-nx">value</span> <span class="tok-o">=</span> <span class="tok-s2">&quot;Escribe tu nombre&quot;</span><span class="tok-p">;</span>
  <span class="tok-p">}</span>
<span class="tok-p">};</span></code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_eventos_de_ratón">Eventos de ratón</h5>
<div class="paragraph">
<p>Cuando el usuario hace <em>click</em> con el ratón, se generan tres eventos. Primero se genera <code>mousedown</code> en el momento que se presiona el botón. Luego, <code>mouseup</code> cuando se suelta el botón. Finalmente, se genera <code>click</code> para indicar que se ha clickado sobre un elemento. Cuando esto sucede dos veces de manera consecutiva, se genera un evento <code>dblclick</code> (doble <em>click</em>).</p>
</div>
<div class="paragraph">
<p>Cuando asociamos un manejador de eventos a un botón, lo normal es que sólo nos interese si ha hecho <em>click</em>. En cambio, si asociamos el manejador a un nodo que tiene hijos, al hacer click sobre los hijos el evento "burbujea" hacia arriba, por lo que nos interesará averiguar que hijo ha sido el responsable, utilizando la propiedad <code>target</code> del evento.</p>
</div>
<div class="paragraph">
<p>Si nos interesa las coordenadas exactas del click, el objeto evento contiene la propiedades <code>clientX</code> y <code>clientY</code> con los valores en pixeles del cursor en la pantalla. Como los documentos pueden usar el scroll, en ocasiones, estas coordenadas no nos indica en que parte del documento se encuentra el ratón. Algunos navegadores ofrecen las propiedades <code>pageX</code> y <code>pageY</code> para este propósito, aunque otros no. Por suerte, la información respecto a la cantidad de píxeles que el documento ha sido <em>scrollado</em> puede encontrarse en <code>document.body.scrollLeft</code> y <code>document.body.scrollTop</code>.</p>
</div>
<div class="paragraph">
<p>Aunque también es posible averiguar que botón del ratón hemos pulsado mediante las propiedades <code>which</code> y <code>button</code> del evento, es muy dependiente del navegador, por lo que dejaremos su gestión a <em>jQuery</em>.</p>
</div>
<div class="paragraph">
<p>Si además de los <em>clicks</em> nos interesa el movimiento del ratón, el evento <code>mousemove</code> salta cada vez que el ratón se mueve sobre un elemento. Además, los evento <code>mouseover</code> y <code>mouseout</code> se lanzan al entrar o salir del elemento. Para estos dos eventos, la propiedad <code>target</code> referencia el nodo que ha lanzado el evento, mientras que <code>relatedTarget</code> nos indica el nodo de donde viene el ratón (para <code>mouseover</code>) o adonde va (para <code>mouseout</code>)</p>
</div>
<div class="paragraph">
<p>Si el nodo tiene hijos, los eventos <code>mouseover</code> y <code>mouseout</code> pueden dar lugar a malinterpretaciones. Los evento lanzado desde los hijos nodos <em>burbujean</em> hasta el elemento padre, con lo que tendremos un evento <code>mouseover</code> cuando el ratón entre en uno de los hijos. Para detectar (e ignorar) estos eventos, podemos usar la propiedad <code>target</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="javascript"><span class="tok-nx">miParrafo</span><span class="tok-p">.</span><span class="tok-nx">addEventListener</span><span class="tok-p">(</span><span class="tok-s2">&quot;mouseover&quot;</span><span class="tok-p">,</span> <span class="tok-kd">function</span><span class="tok-p">(</span><span class="tok-nx">event</span><span class="tok-p">)</span> <span class="tok-p">{</span>
  <span class="tok-k">if</span> <span class="tok-p">(</span><span class="tok-nx">event</span><span class="tok-p">.</span><span class="tok-nx">target</span> <span class="tok-o">==</span> <span class="tok-nx">miParrafo</span><span class="tok-p">)</span>
    <span class="tok-nx">console</span><span class="tok-p">.</span><span class="tok-nx">log</span><span class="tok-p">(</span><span class="tok-s2">&quot;El ratón ha entrado en mi párrafo&quot;</span><span class="tok-p">);</span>
<span class="tok-p">},</span> <span class="tok-kc">false</span><span class="tok-p">);</span></code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_eventos_de_teclado">Eventos de teclado</h5>
<div class="paragraph">
<p>Si queremos que nuestra aplicación reaccione a la pulsación de las teclas, tenemos de nuevo 3 eventos:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>keydown</code>: al pulsar una tecla; también se lanza si se mantiene pulsada</p>
</li>
<li>
<p><code>keyup</code>: al soltar una tecla</p>
</li>
<li>
<p><code>keypress</code>: tras soltar la tecla, pero sin las teclas de modificación; también se lanza si se mantiene pulsada</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Cuando se pulsa una tecla correspondiente a un carácter alfanumérico, se produce la siguiente secuencia de eventos: <code>keydown</code>, <code>keypress</code>, <code>keyup</code>. Cuando se pulsa otro tipo de tecla, se produce la siguiente secuencia de eventos: <code>keydown</code>, <code>keyup</code>. Si se mantiene pulsada la tecla, en el primer caso se repiten de forma continua los eventos <code>keydown</code> y <code>keypress</code> y en el segundo caso, se repite el evento <code>keydown</code> de forma continua.</p>
</div>
<div class="paragraph">
<p>Normalmente, usaremos <code>keydown</code> y <code>keyup</code> para averiguar que tecla se ha pulsado, por ejemplo los cursores. Si estamos interesado en el carácter pulsado, entonces usaremos <code>keypress</code>.</p>
</div>
<div class="paragraph">
<p>Para probar estos eventos, nos vamos a basar en el siguiente código:</p>
</div>
<div class="listingblock">
<div class="title">Ejemplo Eventos de Teclado - <a href="http://jsbin.com/nisuc/12/watch?html,js,console,output" class="bare">http://jsbin.com/nisuc/12/watch?html,js,console,output</a></div>
<div class="content">
<pre class="pygments highlight"><code data-lang="html"><span class="tok-cp">&lt;!DOCTYPE html&gt;</span>
<span class="tok-nt">&lt;html</span> <span class="tok-na">lang=</span><span class="tok-s">&quot;es&quot;</span><span class="tok-nt">&gt;</span>
<span class="tok-nt">&lt;head&gt;</span>
  <span class="tok-nt">&lt;title&gt;</span>Eventos Teclado<span class="tok-nt">&lt;/title&gt;</span>
  <span class="tok-nt">&lt;meta</span> <span class="tok-na">charset=</span><span class="tok-s">&quot;utf-8&quot;</span> <span class="tok-nt">/&gt;</span>
<span class="tok-nt">&lt;/head&gt;</span>
<span class="tok-nt">&lt;body&gt;</span>
    <span class="tok-nt">&lt;input</span> <span class="tok-na">type=</span><span class="tok-s">&quot;text&quot;</span> <span class="tok-na">name=</span><span class="tok-s">&quot;cajaTexto&quot;</span> <span class="tok-na">id=</span><span class="tok-s">&quot;cajaTexto&quot;</span> <span class="tok-nt">/&gt;</span>
    <span class="tok-nt">&lt;script </span><span class="tok-na">src=</span><span class="tok-s">&quot;eventos.js&quot;</span><span class="tok-nt">&gt;&lt;/script&gt;</span>
<span class="tok-nt">&lt;/body&gt;</span>
<span class="tok-nt">&lt;/html&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Por ejemplo, si nos basamos en el evento <code>keypress</code>, si queremos que sólo se permitan escribir letras en mayúsculas, mediante <code>evt.charCode</code> podemos obtener el código ASCII de la tecla pulsada:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="javascript"><span class="tok-p">(</span><span class="tok-kd">function</span><span class="tok-p">()</span> <span class="tok-p">{</span>
  <span class="tok-kd">var</span> <span class="tok-nx">caja</span> <span class="tok-o">=</span> <span class="tok-nb">document</span><span class="tok-p">.</span><span class="tok-nx">getElementById</span><span class="tok-p">(</span><span class="tok-s2">&quot;cajaTexto&quot;</span><span class="tok-p">);</span>
  <span class="tok-nb">document</span><span class="tok-p">.</span><span class="tok-nx">addEventListener</span><span class="tok-p">(</span><span class="tok-s2">&quot;keypress&quot;</span><span class="tok-p">,</span> <span class="tok-kd">function</span><span class="tok-p">(</span><span class="tok-nx">evt</span><span class="tok-p">)</span> <span class="tok-p">{</span>

    <span class="tok-kd">var</span> <span class="tok-nx">ascii</span> <span class="tok-o">=</span> <span class="tok-nx">evt</span><span class="tok-p">.</span><span class="tok-nx">charCode</span><span class="tok-p">;</span>

    <span class="tok-k">if</span> <span class="tok-p">(</span><span class="tok-nx">ascii</span> <span class="tok-o">&gt;=</span> <span class="tok-mi">65</span> <span class="tok-o">&amp;&amp;</span> <span class="tok-nx">ascii</span> <span class="tok-o">&lt;=</span><span class="tok-mi">90</span><span class="tok-p">)</span> <span class="tok-p">{</span>  <i class="conum" data-value="1"></i><b>(1)</b>
      <span class="tok-c1">// solo dejamos mayúsculas</span>
      <span class="tok-c1">// las minúsculas van del 97 al 122</span>
    <span class="tok-p">}</span> <span class="tok-k">else</span> <span class="tok-p">{</span>
      <span class="tok-nx">evt</span><span class="tok-p">.</span><span class="tok-nx">preventDefault</span><span class="tok-p">();</span>
    <span class="tok-p">}</span>
  <span class="tok-p">},</span> <span class="tok-kc">false</span><span class="tok-p">);</span>
<span class="tok-p">}());</span></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Letras en Mayúsculas. Mediante <code>String.fromCharCode</code> podemos obtener una cadena de una letra con la representación del caracter.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>En cambio, si usamos los eventos <code>keydown</code> y <code>keyup</code>, podemos consultar a partir del evento las propiedades:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>keyCode</code>: obtiene el código ASCII del elemento pulsado</p>
</li>
<li>
<p><code>altKey</code>: devuelve <code>true</code>/<code>false</code> si ha pulsado la tecla <em>ALT</em></p>
</li>
<li>
<p><code>ctrlKey</code>: devuelve <code>true</code>/<code>false</code> si ha pulsado la tecla <em>CTRL</em></p>
</li>
<li>
<p><code>shiftKey</code>: devuelve <code>true</code>/<code>false</code> si ha pulsado la tecla <em>SHIFT</em></p>
</li>
</ul>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
Si usamos un sistema OSX (Apple) al tener un combinación de teclas diferente, la tecla de opción se asocia a la propiedad <code>altKey</code> y la tecla <em>command</em> tienen su propia propiedad <code>metaKey</code>.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Por ejemplo, si queremos capturar cuando el usuario pulsa CTRL + B dentro de la caja de texto, haremos:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="javascript"><span class="tok-nb">document</span><span class="tok-p">.</span><span class="tok-nx">addEventListener</span><span class="tok-p">(</span><span class="tok-s2">&quot;keydown&quot;</span><span class="tok-p">,</span> <span class="tok-kd">function</span><span class="tok-p">(</span><span class="tok-nx">evt</span><span class="tok-p">)</span> <span class="tok-p">{</span>
  <span class="tok-kd">var</span> <span class="tok-nx">code</span> <span class="tok-o">=</span> <span class="tok-nx">evt</span><span class="tok-p">.</span><span class="tok-nx">keyCode</span><span class="tok-p">;</span>
  <span class="tok-kd">var</span> <span class="tok-nx">ctrlKey</span> <span class="tok-o">=</span> <span class="tok-nx">evt</span><span class="tok-p">.</span><span class="tok-nx">ctrlKey</span><span class="tok-p">;</span>

  <span class="tok-k">if</span> <span class="tok-p">(</span><span class="tok-nx">ctrlKey</span> <span class="tok-o">&amp;&amp;</span> <span class="tok-nx">code</span> <span class="tok-o">===</span> <span class="tok-mi">66</span><span class="tok-p">)</span> <span class="tok-p">{</span>
    <span class="tok-nx">console</span><span class="tok-p">.</span><span class="tok-nx">log</span><span class="tok-p">(</span><span class="tok-s2">&quot;Ctrl+B&quot;</span><span class="tok-p">);</span>
  <span class="tok-p">}</span>

<span class="tok-p">},</span> <span class="tok-kc">false</span><span class="tok-p">);</span></code></pre>
</div>
</div>
<div class="admonitionblock caution">
<table>
<tr>
<td class="icon">
<i class="fa icon-caution" title="Caution"></i>
</td>
<td class="content">
Cuidado con confundir <code>charCode</code> para un evento <code>keypress</code> con <code>keyCode</code> en un evento <code>keydown</code>/<code>keyup</code>
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_eventos_y_closures">3.5.6. Eventos y closures</h4>
<div class="paragraph">
<p>Una manera de asociar una función a un evento que responda a determinados elementos es mediante <em>Closures</em>. Vamos a crear un ejemplo muy sencillo para demostrar su uso.</p>
</div>
<div class="paragraph">
<p>Supongamos que queremos añadir algunos botones a una página para ajustar el tamaño del texto. Una manera de hacer esto es especificar el tamaño de fuente del elemento <code>body</code> en píxeles y, a continuación, ajustar el tamaño de los demás elementos de la página (como los encabezados) utilizando la unidad relativa <code>em</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="css"><span class="tok-nt">body</span> <span class="tok-p">{</span>
  <span class="tok-k">font-family</span><span class="tok-o">:</span> <span class="tok-n">Helvetica</span><span class="tok-o">,</span> <span class="tok-n">Arial</span><span class="tok-o">,</span> <span class="tok-k">sans-serif</span><span class="tok-p">;</span>
  <span class="tok-k">font-size</span><span class="tok-o">:</span> <span class="tok-m">12px</span><span class="tok-p">;</span>
<span class="tok-p">}</span>
<span class="tok-nt">h1</span> <span class="tok-p">{</span>
  <span class="tok-k">font-size</span><span class="tok-o">:</span> <span class="tok-m">1.5em</span><span class="tok-p">;</span>
<span class="tok-p">}</span>
<span class="tok-nt">h2</span> <span class="tok-p">{</span>
  <span class="tok-k">font-size</span><span class="tok-o">:</span> <span class="tok-m">1.2em</span><span class="tok-p">;</span>
<span class="tok-p">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Nuestros botones interactivos de tamaño de texto pueden cambiar la propiedad <code>font-size</code> del elemento <code>body</code>, y los ajustes serán aplicados por los otros elementos de la página gracias a las unidades relativas.</p>
</div>
<div class="paragraph">
<p>Aquí está el código JavaScript:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="javascript"><span class="tok-kd">function</span> <span class="tok-nx">cambiarTamanyo</span><span class="tok-p">(</span><span class="tok-nx">tamanyo</span><span class="tok-p">)</span> <span class="tok-p">{</span>  <i class="conum" data-value="1"></i><b>(1)</b>
  <span class="tok-k">return</span> <span class="tok-kd">function</span><span class="tok-p">()</span> <span class="tok-p">{</span>
    <span class="tok-nb">document</span><span class="tok-p">.</span><span class="tok-nx">body</span><span class="tok-p">.</span><span class="tok-nx">style</span><span class="tok-p">.</span><span class="tok-nx">fontSize</span> <span class="tok-o">=</span> <span class="tok-nx">tamanyo</span> <span class="tok-o">+</span> <span class="tok-s1">&#39;px&#39;</span><span class="tok-p">;</span>
  <span class="tok-p">};</span>
<span class="tok-p">}</span>

<span class="tok-kd">var</span> <span class="tok-nx">tam12</span> <span class="tok-o">=</span> <span class="tok-nx">cambiarTamanyo</span><span class="tok-p">(</span><span class="tok-mi">12</span><span class="tok-p">);</span>  <i class="conum" data-value="2"></i><b>(2)</b>
<span class="tok-kd">var</span> <span class="tok-nx">tam14</span> <span class="tok-o">=</span> <span class="tok-nx">cambiarTamanyo</span><span class="tok-p">(</span><span class="tok-mi">14</span><span class="tok-p">);</span>
<span class="tok-kd">var</span> <span class="tok-nx">tam16</span> <span class="tok-o">=</span> <span class="tok-nx">cambiarTamanyo</span><span class="tok-p">(</span><span class="tok-mi">16</span><span class="tok-p">);</span></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Closure que cambia el tamaño de texto del body</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td><code>tam12</code>, <code>tam14</code> y <code>tam16</code> ahora son funciones que cambian el tamaño del texto de body a <code>12</code>, <code>14</code> y <code>16</code> píxeles respectivamente</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Suponiendo que tenemos tres botones con los diferentes tamaños, tal que así:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="html"><span class="tok-nt">&lt;button</span> <span class="tok-na">id=</span><span class="tok-s">&quot;tam-12&quot;</span><span class="tok-nt">&gt;</span>12<span class="tok-nt">&lt;/button&gt;</span>
<span class="tok-nt">&lt;button</span> <span class="tok-na">id=</span><span class="tok-s">&quot;tam-14&quot;</span><span class="tok-nt">&gt;</span>14<span class="tok-nt">&lt;/button&gt;</span>
<span class="tok-nt">&lt;button</span> <span class="tok-na">id=</span><span class="tok-s">&quot;tam-16&quot;</span><span class="tok-nt">&gt;</span>16<span class="tok-nt">&lt;/button&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Podemos conectar los <em>closures</em> a los botones de la siguiente forma:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="javascript"><span class="tok-nb">document</span><span class="tok-p">.</span><span class="tok-nx">getElementById</span><span class="tok-p">(</span><span class="tok-s1">&#39;tam-12&#39;</span><span class="tok-p">).</span><span class="tok-nx">onclick</span> <span class="tok-o">=</span> <span class="tok-nx">tam12</span><span class="tok-p">;</span>
<span class="tok-nb">document</span><span class="tok-p">.</span><span class="tok-nx">getElementById</span><span class="tok-p">(</span><span class="tok-s1">&#39;tam-14&#39;</span><span class="tok-p">).</span><span class="tok-nx">onclick</span> <span class="tok-o">=</span> <span class="tok-nx">tam14</span><span class="tok-p">;</span>
<span class="tok-nb">document</span><span class="tok-p">.</span><span class="tok-nx">getElementById</span><span class="tok-p">(</span><span class="tok-s1">&#39;tam-16&#39;</span><span class="tok-p">).</span><span class="tok-nx">onclick</span> <span class="tok-o">=</span> <span class="tok-nx">tam16</span><span class="tok-p">;</span></code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_trabajando_con_formularios">3.6. Trabajando con formularios</h3>
<div class="paragraph">
<p>Previo a HTML5, gran parte del código <em>JavaScript</em> se centraba en la validación de formularios.</p>
</div>
<div class="paragraph">
<p>Para poder interactuar con un formulario y poder capturar cuando se envía la información, lo mejor es crear un <code>id</code> al formulario y acceder al formulario mediante dicho <code>id</code> tal como hemos visto anteriormente con <code>getElementById</code>.</p>
</div>
<div class="paragraph">
<p>Si el formulario no tiene atributo <code>id</code> pero si <code>name</code>, podremos acceder mediante la propiedad <code>document.forms.nombreDelFormulario</code>.</p>
</div>
<div class="paragraph">
<p>Del mismo modo, para acceder a un campo del formulario, bien lo haremos a través de su <code>id</code> o mediante la propiedad <code>document.forms.nombreDelFormulario.nombreDelCampo</code>.</p>
</div>
<div class="paragraph">
<p>Supongamos que tenemos el siguiente formulario:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="html"><span class="tok-nt">&lt;form</span> <span class="tok-na">name=</span><span class="tok-s">&quot;formCliente&quot;</span> <span class="tok-na">id=</span><span class="tok-s">&quot;frmClnt&quot;</span><span class="tok-nt">&gt;</span>
<span class="tok-nt">&lt;fieldset</span> <span class="tok-na">id=</span><span class="tok-s">&quot;infoPersonal&quot;</span><span class="tok-nt">&gt;</span>
  <span class="tok-nt">&lt;legend&gt;</span>Datos Personales<span class="tok-nt">&lt;/legend&gt;</span>
  <span class="tok-nt">&lt;p&gt;&lt;label</span> <span class="tok-na">for=</span><span class="tok-s">&quot;nom&quot;</span><span class="tok-nt">&gt;</span>Nombre<span class="tok-nt">&lt;/label&gt;</span>
    <span class="tok-nt">&lt;input</span> <span class="tok-na">type=</span><span class="tok-s">&quot;text&quot;</span> <span class="tok-na">name=</span><span class="tok-s">&quot;nombre&quot;</span> <span class="tok-na">id=</span><span class="tok-s">&quot;nom&quot;</span> <span class="tok-nt">/&gt;&lt;/p&gt;</span>
  <span class="tok-nt">&lt;p&gt;&lt;label</span> <span class="tok-na">for=</span><span class="tok-s">&quot;email&quot;</span><span class="tok-nt">&gt;</span>Email<span class="tok-nt">&lt;/label&gt;</span>
    <span class="tok-nt">&lt;input</span> <span class="tok-na">type=</span><span class="tok-s">&quot;email&quot;</span> <span class="tok-na">name=</span><span class="tok-s">&quot;correo&quot;</span> <span class="tok-na">id=</span><span class="tok-s">&quot;email&quot;</span> <span class="tok-nt">/&gt;&lt;/p&gt;</span>
<span class="tok-nt">&lt;/fieldset&gt;</span>

<span class="tok-c">&lt;!-- ...Dirección ... --&gt;</span>

<span class="tok-nt">&lt;/fieldset&gt;</span>
<span class="tok-nt">&lt;/form&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Para acceder al formulario y al nombre del cliente usaríamos:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="javascript"><span class="tok-c1">// Mediante el atributo name</span>
<span class="tok-kd">var</span> <span class="tok-nx">formulario</span> <span class="tok-o">=</span> <span class="tok-nb">document</span><span class="tok-p">.</span><span class="tok-nx">forms</span><span class="tok-p">.</span><span class="tok-nx">formCliente</span><span class="tok-p">;</span>
<span class="tok-kd">var</span> <span class="tok-nx">correo</span> <span class="tok-o">=</span> <span class="tok-nx">formulario</span><span class="tok-p">.</span><span class="tok-nx">correo</span><span class="tok-p">;</span>
<span class="tok-c1">// Mediante el atributo id</span>
<span class="tok-kd">var</span> <span class="tok-nx">formuId</span> <span class="tok-o">=</span> <span class="tok-nb">document</span><span class="tok-p">.</span><span class="tok-nx">getElementById</span><span class="tok-p">(</span><span class="tok-s2">&quot;frmClnt&quot;</span><span class="tok-p">);</span>
<span class="tok-kd">var</span> <span class="tok-nx">correoId</span> <span class="tok-o">=</span> <span class="tok-nb">document</span><span class="tok-p">.</span><span class="tok-nx">getElementById</span><span class="tok-p">(</span><span class="tok-s2">&quot;email&quot;</span><span class="tok-p">);</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Al enviarse un formulario se lanza el evento <code>onsubmit</code>. Si queremos interrumpir el envío, sólo tenemos que devolver <code>false</code> desde el manejador de eventos:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="javascript"><span class="tok-kd">function</span> <span class="tok-nx">preparandoManejadores</span><span class="tok-p">()</span> <span class="tok-p">{</span>
  <span class="tok-nb">document</span><span class="tok-p">.</span><span class="tok-nx">getElementById</span><span class="tok-p">(</span><span class="tok-s2">&quot;frmClnt&quot;</span><span class="tok-p">).</span><span class="tok-nx">onsubmit</span> <span class="tok-o">=</span> <span class="tok-kd">function</span><span class="tok-p">()</span> <span class="tok-p">{</span>
    <span class="tok-kd">var</span> <span class="tok-nx">ok</span> <span class="tok-o">=</span> <span class="tok-kc">false</span><span class="tok-p">;</span>
    <span class="tok-c1">// validamos el formulario</span>
    <span class="tok-k">if</span> <span class="tok-p">(</span><span class="tok-nx">ok</span><span class="tok-p">)</span> <span class="tok-p">{</span>
      <span class="tok-k">return</span> <span class="tok-kc">true</span><span class="tok-p">;</span>  <span class="tok-c1">// se realiza el envío</span>
    <span class="tok-p">}</span> <span class="tok-k">else</span> <span class="tok-p">{</span>
      <span class="tok-k">return</span> <span class="tok-kc">false</span><span class="tok-p">;</span>
    <span class="tok-p">}</span>
  <span class="tok-p">};</span>
<span class="tok-p">}</span>

<span class="tok-nb">window</span><span class="tok-p">.</span><span class="tok-nx">onload</span> <span class="tok-o">=</span>  <span class="tok-kd">function</span><span class="tok-p">()</span> <span class="tok-p">{</span>
  <span class="tok-nx">preparandoManejadores</span><span class="tok-p">();</span>
<span class="tok-p">};</span></code></pre>
</div>
</div>
<div class="sect3">
<h4 id="_campos_de_texto">3.6.1. Campos de texto</h4>
<div class="paragraph">
<p>Si nos centramos en los campos de texto (<code>type="text"</code>) (también válido para los campos de tipo <code>password</code> o <code>hidden</code>), para obtener el valor del campo usaremos la propiedad <code>value</code>, tal como vimos en el apartado de <a href="#_eventos_de_foco">Eventos de foco</a>. Cabe recordar que los eventos que puede lanzar un campo de texto son: <code>focus</code>, <code>blur</code>, <code>change</code>, <code>keypress</code>, <code>keydown</code> y <code>keyup</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="javascript"><span class="tok-kd">var</span> <span class="tok-nx">correoId</span> <span class="tok-o">=</span> <span class="tok-nb">document</span><span class="tok-p">.</span><span class="tok-nx">getElementById</span><span class="tok-p">(</span><span class="tok-s2">&quot;email&quot;</span><span class="tok-p">);</span>
<span class="tok-k">if</span> <span class="tok-p">(</span><span class="tok-nx">correoId</span><span class="tok-p">.</span><span class="tok-nx">value</span> <span class="tok-o">==</span> <span class="tok-s2">&quot;&quot;</span><span class="tok-p">)</span> <span class="tok-p">{</span>
  <span class="tok-nx">alert</span><span class="tok-p">(</span><span class="tok-s2">&quot;Por favor, introduce el correo&quot;</span><span class="tok-p">);</span>
<span class="tok-p">}</span></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_desplegables">3.6.2. Desplegables</h4>
<div class="paragraph">
<p>Para un desplegable creado con <code>select</code>, mediante la propiedad <code>type</code> podemos averiguar si se trata de una lista de selección única (<code>select-one</code>) o selección múltiple (<code>select-multiple</code>).</p>
</div>
<div class="paragraph">
<p>Al seleccionar un elemento, se lanza el evento <code>change</code>. En el caso de tener una selección única, para acceder al elemento seleccionado, usaremos la propiedad <code>selectedIndex</code> (de 0 a n-1). En el caso de selección múltiple, tendremos que recorrer el array de <code>options</code> y consultar la propiedad <code>selected</code>, es decir, <code>options[i].selected</code>.</p>
</div>
<div class="paragraph">
<p>Cada uno de los elementos de la lista es un objeto <code>Option</code>. Si queremos obtener el valor de una opción usaremos la propiedad <code>value</code>, y para su texto <code>text</code>.</p>
</div>
<div class="paragraph">
<p>Supongamos el siguiente código con una lista:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="html"><span class="tok-nt">&lt;form</span> <span class="tok-na">name=</span><span class="tok-s">&quot;formCliente&quot;</span> <span class="tok-na">id=</span><span class="tok-s">&quot;frmClnt&quot;</span><span class="tok-nt">&gt;</span>
<span class="tok-c">&lt;!-- ... Datos Personales ... --&gt;</span>

<span class="tok-nt">&lt;fielset</span> <span class="tok-na">id=</span><span class="tok-s">&quot;direccion&quot;</span><span class="tok-nt">&gt;</span>
  <span class="tok-nt">&lt;legend&gt;</span>Dirección<span class="tok-nt">&lt;/legend&gt;</span>
  <span class="tok-nt">&lt;p&gt;&lt;label</span> <span class="tok-na">for=</span><span class="tok-s">&quot;tipoVia&quot;</span><span class="tok-nt">&gt;</span>Tipo de Via<span class="tok-nt">&lt;/label&gt;</span>
    <span class="tok-nt">&lt;select</span> <span class="tok-na">name=</span><span class="tok-s">&quot;tipoVia&quot;</span> <span class="tok-na">id=</span><span class="tok-s">&quot;tipoViaId&quot;</span><span class="tok-nt">&gt;</span>
      <span class="tok-nt">&lt;option</span> <span class="tok-na">value=</span><span class="tok-s">&quot;calle&quot;</span><span class="tok-nt">&gt;</span>Calle<span class="tok-nt">&lt;/option&gt;</span>
      <span class="tok-nt">&lt;option</span> <span class="tok-na">value=</span><span class="tok-s">&quot;avda&quot;</span><span class="tok-nt">&gt;</span>Avenida<span class="tok-nt">&lt;/option&gt;</span>
      <span class="tok-nt">&lt;option</span> <span class="tok-na">value=</span><span class="tok-s">&quot;pza&quot;</span><span class="tok-nt">&gt;</span>Plaza<span class="tok-nt">&lt;/option&gt;</span>
    <span class="tok-nt">&lt;/select&gt;</span>
  <span class="tok-nt">&lt;/p&gt;</span>
  <span class="tok-nt">&lt;p&gt;&lt;label</span> <span class="tok-na">for=</span><span class="tok-s">&quot;domicilio&quot;</span><span class="tok-nt">&gt;</span>Domicilio<span class="tok-nt">&lt;/label&gt;</span>
    <span class="tok-nt">&lt;input</span> <span class="tok-na">type=</span><span class="tok-s">&quot;text&quot;</span> <span class="tok-na">name=</span><span class="tok-s">&quot;domicilio&quot;</span> <span class="tok-na">id=</span><span class="tok-s">&quot;domi&quot;</span> <span class="tok-nt">/&gt;&lt;/p&gt;</span>
<span class="tok-nt">&lt;/fieldset&gt;</span>
<span class="tok-nt">&lt;/form&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Para obtener que tipo de vía ha seleccionado el usuario haríamos:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="javascript"><span class="tok-kd">var</span> <span class="tok-nx">tipoViaId</span> <span class="tok-o">=</span> <span class="tok-nb">document</span><span class="tok-p">.</span><span class="tok-nx">getElementById</span><span class="tok-p">(</span><span class="tok-s2">&quot;tipoViaId&quot;</span><span class="tok-p">);</span>

<span class="tok-nx">tipoViaId</span><span class="tok-p">.</span><span class="tok-nx">onchange</span> <span class="tok-o">=</span> <span class="tok-kd">function</span><span class="tok-p">()</span> <span class="tok-p">{</span>
  <span class="tok-kd">var</span> <span class="tok-nx">indice</span> <span class="tok-o">=</span> <span class="tok-nx">tipoViaId</span><span class="tok-p">.</span><span class="tok-nx">selectedIndex</span><span class="tok-p">;</span>   <span class="tok-c1">// 1</span>
  <span class="tok-kd">var</span> <span class="tok-nx">valor</span> <span class="tok-o">=</span> <span class="tok-nx">tipoViaId</span><span class="tok-p">.</span><span class="tok-nx">options</span><span class="tok-p">[</span><span class="tok-nx">indice</span><span class="tok-p">].</span><span class="tok-nx">value</span><span class="tok-p">;</span>  <span class="tok-c1">// avda</span>
  <span class="tok-kd">var</span> <span class="tok-nx">texto</span> <span class="tok-o">=</span> <span class="tok-nx">tipoViaId</span><span class="tok-p">.</span><span class="tok-nx">options</span><span class="tok-p">[</span><span class="tok-nx">indice</span><span class="tok-p">].</span><span class="tok-nx">text</span><span class="tok-p">;</span>  <span class="tok-c1">// Avenida</span>
<span class="tok-p">};</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Si en algún momento queremos añadir o eliminar un elemento a la lista de manera dinámica, usaremos los métodos <code>add(option, lugarAntesDe)</code> (si no se indica el lugar se insertará al final de la lista) o <code>remove(indice)</code> respectivamente:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="javascript"><span class="tok-kd">var</span> <span class="tok-nx">op</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-nx">Option</span><span class="tok-p">(</span><span class="tok-s2">&quot;Camino Rural&quot;</span><span class="tok-p">,</span> <span class="tok-s2">&quot;rural&quot;</span><span class="tok-p">);</span>
<span class="tok-nx">tipoViaId</span><span class="tok-p">.</span><span class="tok-nx">add</span><span class="tok-p">(</span><span class="tok-nx">op</span><span class="tok-p">,</span> <span class="tok-nx">tipoViaId</span><span class="tok-p">.</span><span class="tok-nx">options</span><span class="tok-p">[</span><span class="tok-mi">3</span><span class="tok-p">]);</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Más información en: <a href="https://developer.mozilla.org/en-US/docs/Web/API/HTMLSelectElement" class="bare">https://developer.mozilla.org/en-US/docs/Web/API/HTMLSelectElement</a></p>
</div>
</div>
<div class="sect3">
<h4 id="_opciones">3.6.3. Opciones</h4>
<div class="paragraph">
<p>Tanto los <em>radio</em> como los <em>checkboxes</em> tienen la propiedad <code>checked</code> que nos dice si hay algún elemento seleccionado (<code>true</code> o <code>false</code>). Para averiguar cual es el elemento marcado, tenemos que recorrer el array de elementos que lo forman.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="javascript"><span class="tok-nx">color</span><span class="tok-p">.</span><span class="tok-nx">checked</span> <span class="tok-o">=</span> <span class="tok-kc">true</span><span class="tok-p">;</span>

<span class="tok-kd">var</span> <span class="tok-nx">colorElegido</span> <span class="tok-o">=</span> <span class="tok-s2">&quot;&quot;</span><span class="tok-p">;</span>

<span class="tok-k">for</span> <span class="tok-p">(</span><span class="tok-kd">var</span> <span class="tok-nx">i</span> <span class="tok-o">=</span> <span class="tok-mi">0</span><span class="tok-p">,</span> <span class="tok-nx">l</span> <span class="tok-o">=</span> <span class="tok-nx">color</span><span class="tok-p">.</span><span class="tok-nx">length</span><span class="tok-p">;</span> <span class="tok-nx">i</span> <span class="tok-o">&lt;</span> <span class="tok-nx">l</span><span class="tok-p">;</span> <span class="tok-nx">i</span> <span class="tok-o">=</span> <span class="tok-nx">i</span> <span class="tok-o">+</span> <span class="tok-mi">1</span><span class="tok-p">)</span> <span class="tok-p">{</span>
  <span class="tok-k">if</span> <span class="tok-p">(</span><span class="tok-nx">color</span><span class="tok-p">[</span><span class="tok-nx">i</span><span class="tok-p">].</span><span class="tok-nx">checked</span><span class="tok-p">)</span> <span class="tok-p">{</span>
    <span class="tok-nx">colorElegido</span> <span class="tok-o">=</span> <span class="tok-nx">color</span><span class="tok-p">[</span><span class="tok-nx">i</span><span class="tok-p">].</span><span class="tok-nx">value</span><span class="tok-p">;</span>
  <span class="tok-p">}</span>
<span class="tok-p">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Respecto a los eventos, se lanzan tanto el evento <code>click</code> como el <code>change</code>.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_ejercicios_3">3.7. Ejercicios</h3>
<div class="sect3">
<h4 id="__0_4_ptos_ejercicio_31_contenido_bloqueado">3.7.1. (0.4 ptos) Ejercicio 31. Contenido bloqueado</h4>
<div class="paragraph">
<p>Crear una función que recorra el DOM desde la etiqueta <code>&lt;body&gt;</code> y si encuentra la palabra "sexo", elimine el elemento y lo sustituya por "<strong>Contenido Bloqueado</strong>", con el texto en negrita.</p>
</div>
<div class="paragraph">
<p>La función se almacenará en una archivo denominado <code>ej31.js</code>, y tendrá la siguiente definición:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="javascript"><span class="tok-kd">function</span> <span class="tok-nx">bloquearContenido</span><span class="tok-p">()</span> <span class="tok-p">{}</span></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="__0_3_ptos_ejercicio_32_temporizador_dom">3.7.2. (0.3 ptos) Ejercicio 32. Temporizador DOM</h4>
<div class="paragraph">
<p>Siguiendo la misma idea que el ejercicio 12 del Temporizador, crear dos elementos de formulario que indiquen los minutos y segundos de un temporizador, de modo que al darle a comenzar, se muestre el temporizador por pantalla.</p>
</div>
<div class="paragraph">
<p>El código para mostrar el temporizador será el siguiente:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="html"><span class="tok-nt">&lt;h2&gt;</span>Temporizador<span class="tok-nt">&lt;/h2&gt;</span>
<span class="tok-nt">&lt;form</span> <span class="tok-na">id=</span><span class="tok-s">&quot;formTemporizador&quot;</span><span class="tok-nt">&gt;</span>
    Min: <span class="tok-nt">&lt;input</span> <span class="tok-na">type=</span><span class="tok-s">&quot;number&quot;</span> <span class="tok-na">name=</span><span class="tok-s">&quot;min&quot;</span> <span class="tok-na">id=</span><span class="tok-s">&quot;formMin&quot;</span><span class="tok-nt">&gt;</span> <span class="tok-nt">&lt;br</span> <span class="tok-nt">/&gt;</span>
    Seg: <span class="tok-nt">&lt;input</span> <span class="tok-na">type=</span><span class="tok-s">&quot;number&quot;</span> <span class="tok-na">name=</span><span class="tok-s">&quot;seg&quot;</span> <span class="tok-na">id=</span><span class="tok-s">&quot;formSeg&quot;</span><span class="tok-nt">&gt;</span> <span class="tok-nt">&lt;br</span> <span class="tok-nt">/&gt;</span>
    <span class="tok-nt">&lt;input</span> <span class="tok-na">type=</span><span class="tok-s">&quot;submit&quot;</span><span class="tok-nt">&gt;</span>
<span class="tok-nt">&lt;/form&gt;</span>

<span class="tok-nt">&lt;br</span> <span class="tok-nt">/&gt;</span>

<span class="tok-nt">&lt;div</span> <span class="tok-na">id=</span><span class="tok-s">&quot;temporizador&quot;</span><span class="tok-nt">&gt;</span>
<span class="tok-nt">&lt;span</span> <span class="tok-na">id=</span><span class="tok-s">&quot;min&quot;</span><span class="tok-nt">&gt;</span>_<span class="tok-nt">&lt;/span&gt;</span>:<span class="tok-nt">&lt;span</span> <span class="tok-na">id=</span><span class="tok-s">&quot;seg&quot;</span><span class="tok-nt">&gt;</span>_<span class="tok-nt">&lt;/span&gt;</span>
<span class="tok-nt">&lt;/div&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>La apariencia será similar a la siguiente:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/js03/ej32.jpg" alt="Ejercicio temporizador" width="33%">
</div>
<div class="title">Figure 15. Ejercicio Temporizador</div>
</div>
<div class="paragraph">
<p>El contenido HTML y el código JavaScript se almacenarán en una archivo denominado <code>ej32.html</code>.</p>
</div>
</div>
<div class="sect3">
<h4 id="__0_5_ptos_ejercicio_33_tabla_dinámica">3.7.3. (0.5 ptos) Ejercicio 33. Tabla dinámica</h4>
<div class="paragraph">
<p>A partir de una tabla con la siguiente estructura:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="html"><span class="tok-nt">&lt;input</span> <span class="tok-na">type=</span><span class="tok-s">&quot;text&quot;</span> <span class="tok-na">id=</span><span class="tok-s">&quot;texto&quot;</span> <span class="tok-nt">/&gt;</span>
<span class="tok-nt">&lt;button</span> <span class="tok-na">onclick=</span><span class="tok-s">&quot;anyadirFila()&quot;</span><span class="tok-nt">&gt;</span>Añadir fila<span class="tok-nt">&lt;/button&gt;</span>

<span class="tok-nt">&lt;br</span> <span class="tok-nt">/&gt;</span>

<span class="tok-nt">&lt;table&gt;</span>
<span class="tok-nt">&lt;thead&gt;</span>
<span class="tok-nt">&lt;tr&gt;&lt;th&gt;</span>Contenido<span class="tok-nt">&lt;/th&gt;&lt;th&gt;</span>Operación<span class="tok-nt">&lt;/th&gt;&lt;/tr&gt;</span>
<span class="tok-nt">&lt;/thead&gt;</span>
<span class="tok-nt">&lt;tbody</span> <span class="tok-na">id=</span><span class="tok-s">&quot;bodyTabla&quot;</span><span class="tok-nt">&gt;</span>
<span class="tok-nt">&lt;tr&gt;</span>
  <span class="tok-nt">&lt;td</span> <span class="tok-na">id=</span><span class="tok-s">&quot;fila1&quot;</span><span class="tok-nt">&gt;</span>Ejemplo de contenido<span class="tok-nt">&lt;/td&gt;</span>
  <span class="tok-nt">&lt;td&gt;&lt;button</span> <span class="tok-na">onclick=</span><span class="tok-s">&quot;toCani(&#39;fila1&#39;)&quot;</span><span class="tok-nt">&gt;</span>Caniar<span class="tok-nt">&lt;/button&gt;&lt;/td&gt;</span>
<span class="tok-nt">&lt;/tr&gt;</span>
<span class="tok-nt">&lt;/tbody&gt;</span>
<span class="tok-nt">&lt;/tr&gt;</span>
<span class="tok-nt">&lt;/table&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Añade el código necesarios para que la pulsar sobre los botones realice las siguientes acciones:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><em>Añadir fila</em>: Añade el contenido del campo como última fila de la tabla</p>
</li>
<li>
<p><em>Caniar</em>: Transformar el texto de la celda mediante la función <code>toCani</code> de la primera sesión</p>
</li>
<li>
<p>Al pasar el ratón por encima de una celda, cambiará el color de fondo de la misma.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>El contenido HTML y el código JavaScript se almacenarán en una archivo denominado <code>ej33.html</code>.</p>
</div>
</div>
<div class="sect3">
<h4 id="__0_3_ptos_ejercicio_34_carrusel">3.7.4. (0.3 ptos) Ejercicio 34. Carrusel</h4>
<div class="paragraph">
<p>A partir de un array de imágenes:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="javascript"><span class="tok-kd">var</span> <span class="tok-nx">imagenes</span> <span class="tok-o">=</span> <span class="tok-p">[</span><span class="tok-s2">&quot;img/agua.jpg&quot;</span><span class="tok-p">,</span> <span class="tok-s2">&quot;img/hieba.jpg&quot;</span><span class="tok-p">,</span> <span class="tok-s2">&quot;img/hoja.jpg&quot;</span><span class="tok-p">,</span> <span class="tok-s2">&quot;img/primavera.jpg&quot;</span><span class="tok-p">];</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Escribir el código necesario para que tras dos segundos, se muestre la siguiente imagen. Una vez mostrada la última imagen, el carrusel volverá a comenzar por la primera.</p>
</div>
<div class="paragraph">
<p>El contenido HTML y el código JavaScript se almacenarán en una archivo denominado <code>ej34.html</code>.</p>
</div>
<div style="page-break-after: always;"></div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="sesion04">4. JavaScript avanzado</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_closures">4.1. Closures</h3>
<div class="paragraph">
<p>Ya vimos en la primera sesión que <em>JavaScript</em> permite definir funciones dentro de otras funciones.</p>
</div>
<div class="paragraph">
<p>Una función interna tiene acceso a sus parámetros y variables, y también puede acceder a los parámetros y variables de la función a la que está anidada (la externa). La función interna contiene un enlace al contexto exterior, el cual se conoce como <strong>closure</strong>, y es la fuente de un enorme poder expresivo.</p>
</div>
<div class="paragraph">
<p>Los closures son funciones que manejan variables independientes. En otras palabras, la función definida en el <em>closure</em> "recuerda" el entorno en el que se ha creado.</p>
</div>
<div class="paragraph">
<p>Veamos con un ejemplo un <em>closure</em> en acción:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="javascript"><span class="tok-kd">function</span> <span class="tok-nx">inicia</span><span class="tok-p">()</span> <span class="tok-p">{</span>
  <span class="tok-kd">var</span> <span class="tok-nx">nombre</span> <span class="tok-o">=</span> <span class="tok-s2">&quot;Batman&quot;</span><span class="tok-p">;</span>	<i class="conum" data-value="1"></i><b>(1)</b>
  <span class="tok-kd">function</span> <span class="tok-nx">muestraNombre</span><span class="tok-p">()</span> <span class="tok-p">{</span> 	<i class="conum" data-value="2"></i><b>(2)</b>
    <span class="tok-nx">console</span><span class="tok-p">.</span><span class="tok-nx">log</span><span class="tok-p">(</span><span class="tok-nx">nombre</span><span class="tok-p">);</span>	<i class="conum" data-value="3"></i><b>(3)</b>
  <span class="tok-p">}</span>
  <span class="tok-nx">muestraNombre</span><span class="tok-p">();</span>
<span class="tok-p">}</span>
<span class="tok-nx">inicia</span><span class="tok-p">();</span></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td><code>nombre</code> es una variable local</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td><code>muestraNombre()</code> es una función interna (<em>closure</em>)</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>dentro del <em>closure</em> usamos una variable de la función externa</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>La función interna <code>muestraNombre()</code> sólo está disponible en el cuerpo de la función <code>inicia()</code>, y en vez de tener una variable propia, lo que hace es reutilizar la variable <code>nombre</code> declarada en la función externa. Tal como vimos en <a href="#_alcance">Alcance</a>, el ámbito de una variable se define por su ubicación dentro del código fuente y las funciones anidadas tienen acceso a las variables declaradas en su ámbito externo.</p>
</div>
<div class="paragraph">
<p>El siguiente paso es refactorizar el ejemplo para darle una vuelta de tuerca:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="javascript"><span class="tok-kd">function</span> <span class="tok-nx">creaFunc</span><span class="tok-p">()</span> <span class="tok-p">{</span>
  <span class="tok-kd">var</span> <span class="tok-nx">nombre</span> <span class="tok-o">=</span> <span class="tok-s2">&quot;Batman&quot;</span><span class="tok-p">;</span>
  <span class="tok-kd">function</span> <span class="tok-nx">muestraNombre</span><span class="tok-p">()</span> <span class="tok-p">{</span>
    <span class="tok-nx">console</span><span class="tok-p">.</span><span class="tok-nx">log</span><span class="tok-p">(</span><span class="tok-nx">nombre</span><span class="tok-p">);</span>
  <span class="tok-p">}</span>
  <span class="tok-k">return</span> <span class="tok-nx">muestraNombre</span><span class="tok-p">;</span>
<span class="tok-p">}</span>

<span class="tok-kd">var</span> <span class="tok-nx">miFunc</span> <span class="tok-o">=</span> <span class="tok-nx">creaFunc</span><span class="tok-p">();</span>
<span class="tok-nx">miFunc</span><span class="tok-p">();</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>El ejemplo sigue haciendo lo mismo, aunque ahora la función externa nos ha devuelto la función interna <code>muestraNombre()</code> antes de ejecutarla.</p>
</div>
<div class="paragraph">
<p>En principio, podemos dudar de que este código funcionase. Normalmente, las variables locales dentro de una función sólo existen mientras dura la ejecución de dicha función. Una vez que <code>creaFunc()</code> haya terminado de ejecutarse, es razonable suponer que no se pueda ya acceder a la variable <code>nombre</code>. La solución a este rompecabezas es que <code>miFunc</code> se ha convertido en un <em>closure</em> que incorpora tanto la función <code>muestraNombre</code> como la cadena <code>"Batman"</code> que existían cuando se creó el closure. Así pues, hemos creado un <em>closure</em> haciendo que la función padre devuelva una función interna.</p>
</div>
<div class="paragraph">
<p>Un <em>closure</em> es un tipo especial de objeto que combina dos cosas: una función, y el entorno en que se creó esa función. El entorno está formado por las variables locales que estaban dentro del alcance en el momento que se creó el <em>closure</em>.</p>
</div>
<div class="paragraph">
<p>Veamos otro ejemplo donde la función externa devuelve una función interna que recibe parámetros. Para ello, mediante una factoría de función, crearemos una función que permite sumar un valor específico a su argumento:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="javascript"><span class="tok-kd">function</span> <span class="tok-nx">creaSumador</span><span class="tok-p">(</span><span class="tok-nx">x</span><span class="tok-p">)</span> <span class="tok-p">{</span>	<i class="conum" data-value="1"></i><b>(1)</b>
  <span class="tok-k">return</span> <span class="tok-kd">function</span><span class="tok-p">(</span><span class="tok-nx">y</span><span class="tok-p">)</span> <span class="tok-p">{</span>	<i class="conum" data-value="2"></i><b>(2)</b>
    <span class="tok-k">return</span> <span class="tok-nx">x</span> <span class="tok-o">+</span> <span class="tok-nx">y</span><span class="tok-p">;</span>
  <span class="tok-p">};</span>
<span class="tok-p">}</span>

<span class="tok-kd">var</span> <span class="tok-nx">suma5</span> <span class="tok-o">=</span> <span class="tok-nx">creaSumador</span><span class="tok-p">(</span><span class="tok-mi">5</span><span class="tok-p">);</span>
<span class="tok-kd">var</span> <span class="tok-nx">suma10</span> <span class="tok-o">=</span> <span class="tok-nx">creaSumador</span><span class="tok-p">(</span><span class="tok-mi">10</span><span class="tok-p">);</span>

<span class="tok-nx">console</span><span class="tok-p">.</span><span class="tok-nx">log</span><span class="tok-p">(</span><span class="tok-nx">suma5</span><span class="tok-p">(</span><span class="tok-mi">2</span><span class="tok-p">));</span>  <span class="tok-c1">// 7</span>
<span class="tok-nx">console</span><span class="tok-p">.</span><span class="tok-nx">log</span><span class="tok-p">(</span><span class="tok-nx">suma10</span><span class="tok-p">(</span><span class="tok-mi">2</span><span class="tok-p">));</span> <span class="tok-c1">// 12</span></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>función <code>creaSumador(x)</code> que toma un argumento único <code>x</code> y devuelve una nueva función.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>La función devuelta recibe un único argumento y devuelve la suma del argumento <code>y</code> y el valor de <code>x</code> de la función externa.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Tanto <code>suma5</code> como <code>suma10</code> son <em>closures</em>: comparten la misma definición de cuerpo de función, pero almacenan diferentes entornos. En el entorno de <code>suma5</code>, <code>x</code> vale <code>5</code>, mientras que para <code>suma10</code>, <code>x</code> vale <code>10</code>.</p>
</div>
<div class="sect3">
<h4 id="_alcance_en_closures">4.1.1. Alcance en closures</h4>
<div class="paragraph">
<p>Para entender mejor los <em>closures</em>, veamos como funciona el alcance. Ya hemos visto que las funciones internas puede tener sus propias variables, cuyo alcance se restringe a la propia función:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="javascript"><span class="tok-kd">function</span> <span class="tok-nx">funcExterna</span><span class="tok-p">()</span> <span class="tok-p">{</span>
  <span class="tok-kd">function</span> <span class="tok-nx">funcInterna</span><span class="tok-p">()</span> <span class="tok-p">{</span>
    <span class="tok-kd">var</span> <span class="tok-nx">varInterna</span> <span class="tok-o">=</span> <span class="tok-mi">0</span><span class="tok-p">;</span>
    <span class="tok-nx">varInterna</span><span class="tok-o">++</span><span class="tok-p">;</span>
    <span class="tok-nx">console</span><span class="tok-p">.</span><span class="tok-nx">log</span><span class="tok-p">(</span><span class="tok-s1">&#39;varInterna = &#39;</span> <span class="tok-o">+</span> <span class="tok-nx">varInterna</span><span class="tok-p">);</span>
  <span class="tok-p">}</span>
  <span class="tok-k">return</span> <span class="tok-nx">funcInterna</span><span class="tok-p">;</span>
<span class="tok-p">}</span>
<span class="tok-kd">var</span> <span class="tok-nx">ref</span> <span class="tok-o">=</span> <span class="tok-nx">funcExterna</span><span class="tok-p">();</span>
<span class="tok-nx">ref</span><span class="tok-p">();</span>
<span class="tok-nx">ref</span><span class="tok-p">();</span>
<span class="tok-kd">var</span> <span class="tok-nx">ref2</span> <span class="tok-o">=</span> <span class="tok-nx">funcExterna</span><span class="tok-p">();</span>
<span class="tok-nx">ref2</span><span class="tok-p">();</span>
<span class="tok-nx">ref2</span><span class="tok-p">();</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Cada vez que se llama a la función interna, ya sea mediante una referencia o de cualquier otro modo, se crea una nueva variable <code>varInterna</code>, la cual se incremente y se muestra:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="console"><span class="tok-go">varInterna = 1</span>
<span class="tok-go">varInterna = 1</span>
<span class="tok-go">varInterna = 1</span>
<span class="tok-go">varInterna = 1</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Las funciones internas pueden referenciar a las variables globales del mismo modo que cualquier otro tipo de función:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="javascript"><span class="tok-kd">var</span> <span class="tok-nx">varGlobal</span> <span class="tok-o">=</span> <span class="tok-mi">0</span><span class="tok-p">;</span>
<span class="tok-kd">function</span> <span class="tok-nx">funcExterna</span><span class="tok-p">()</span> <span class="tok-p">{</span>
  <span class="tok-kd">function</span> <span class="tok-nx">funcInterna</span><span class="tok-p">()</span> <span class="tok-p">{</span>
    <span class="tok-nx">varGlobal</span><span class="tok-o">++</span><span class="tok-p">;</span>
    <span class="tok-nx">console</span><span class="tok-p">.</span><span class="tok-nx">log</span><span class="tok-p">(</span><span class="tok-s1">&#39;varGlobal = &#39;</span> <span class="tok-o">+</span> <span class="tok-nx">varGlobal</span><span class="tok-p">);</span>
  <span class="tok-p">}</span>
  <span class="tok-k">return</span> <span class="tok-nx">funcInterna</span><span class="tok-p">;</span>
<span class="tok-p">}</span>
<span class="tok-kd">var</span> <span class="tok-nx">ref</span> <span class="tok-o">=</span> <span class="tok-nx">funcExterna</span><span class="tok-p">();</span>
<span class="tok-nx">ref</span><span class="tok-p">();</span>
<span class="tok-nx">ref</span><span class="tok-p">();</span>
<span class="tok-kd">var</span> <span class="tok-nx">ref2</span> <span class="tok-o">=</span> <span class="tok-nx">funcExterna</span><span class="tok-p">();</span>
<span class="tok-nx">ref2</span><span class="tok-p">();</span>
<span class="tok-nx">ref2</span><span class="tok-p">();</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Ahora nuestra función incrementará de manera consistente la variable global con cada llamada:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="console"><span class="tok-go">varGlobal = 1</span>
<span class="tok-go">varGlobal = 2</span>
<span class="tok-go">varGlobal = 3</span>
<span class="tok-go">varGlobal = 4</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Pero ¿qué ocurre si la variable es local a la función externa? Como la función interna hereda el alcance del padre, también podemos referenciar a dicha variable:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="javascript"><span class="tok-kd">function</span> <span class="tok-nx">funcExterna</span><span class="tok-p">()</span> <span class="tok-p">{</span>
  <span class="tok-kd">var</span> <span class="tok-nx">varExterna</span> <span class="tok-o">=</span> <span class="tok-mi">0</span><span class="tok-p">;</span>
  <span class="tok-kd">function</span> <span class="tok-nx">funcInterna</span><span class="tok-p">()</span> <span class="tok-p">{</span>
    <span class="tok-nx">varExterna</span><span class="tok-o">++</span><span class="tok-p">;</span>
    <span class="tok-nx">console</span><span class="tok-p">.</span><span class="tok-nx">log</span><span class="tok-p">(</span><span class="tok-s1">&#39;varExterna = &#39;</span> <span class="tok-o">+</span> <span class="tok-nx">varExterna</span><span class="tok-p">);</span>
  <span class="tok-p">}</span>
  <span class="tok-k">return</span> <span class="tok-nx">funcInterna</span><span class="tok-p">;</span>
<span class="tok-p">}</span>
<span class="tok-kd">var</span> <span class="tok-nx">ref</span> <span class="tok-o">=</span> <span class="tok-nx">funcExterna</span><span class="tok-p">();</span>
<span class="tok-nx">ref</span><span class="tok-p">();</span>
<span class="tok-nx">ref</span><span class="tok-p">();</span>
<span class="tok-kd">var</span> <span class="tok-nx">ref2</span> <span class="tok-o">=</span> <span class="tok-nx">funcExterna</span><span class="tok-p">();</span>
<span class="tok-nx">ref2</span><span class="tok-p">();</span>
<span class="tok-nx">ref2</span><span class="tok-p">();</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Ahora nuestra función tiene un comportamiento más interesante:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="console"><span class="tok-go">varExterna = 1</span>
<span class="tok-go">varExterna = 2</span>
<span class="tok-go">varExterna = 1</span>
<span class="tok-go">varExterna = 2</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Ahora hemos mezclado los dos efectos anteriores. Las llamadas a <code>funcInterna()</code> mediante referencias distintas incrementan <code>varExterna</code> de manera independiente. Podemos observar como la segunda llamada a <code>funcExterna()</code> no limpia el valor de <code>varExterna</code>, sino que ha creado una nueva instancia de <code>varExterna</code> asociada al alcance de la segunda llamada. Si volviesemos a llamar a <code>ref()</code> imprimiría el valor <code>3</code>, y si posteriormente llamamos a <code>ref2()</code> también imprimiría <code>3</code>, ya que los dos contadores están separados.</p>
</div>
<div class="paragraph">
<p>En resumen, cuando una referencia a una función interna utiliza un elemento que se encuentra fuera del alcance en el que se definió la función, se crea un <em>closure</em> en dicha función. Estos elementos externos que no son parámetros ni variables locales a la función interna las encierra el entorno de la función externa, lo que hace que esta variable externa permanezca atada a la función interna. Cuando la función interna finaliza, la memoria no se libera, ya que todavía la necesita el <em>closure</em>.</p>
</div>
</div>
<div class="sect3">
<h4 id="_interacciones_entre_closures">4.1.2. Interacciones entre closures</h4>
<div class="paragraph">
<p>Cuando tenemos más de una función interna, los closures pueden tener comportamientos inesperados. Supongamos que tenemos dos funciones para incrementar el contador:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="javascript"><span class="tok-kd">function</span> <span class="tok-nx">funcExterna</span><span class="tok-p">()</span> <span class="tok-p">{</span>
  <span class="tok-kd">var</span> <span class="tok-nx">varExterna</span> <span class="tok-o">=</span> <span class="tok-mi">0</span><span class="tok-p">;</span>
  <span class="tok-kd">function</span> <span class="tok-nx">funcInterna1</span><span class="tok-p">()</span> <span class="tok-p">{</span>
    <span class="tok-nx">varExterna</span><span class="tok-o">++</span><span class="tok-p">;</span>
    <span class="tok-nx">console</span><span class="tok-p">.</span><span class="tok-nx">log</span><span class="tok-p">(</span><span class="tok-s1">&#39;(1) varExterna = &#39;</span> <span class="tok-o">+</span> <span class="tok-nx">varExterna</span><span class="tok-p">);</span>
  <span class="tok-p">}</span>
  <span class="tok-kd">function</span> <span class="tok-nx">funcInterna2</span><span class="tok-p">()</span> <span class="tok-p">{</span>
    <span class="tok-nx">varExterna</span> <span class="tok-o">+=</span> <span class="tok-mi">2</span><span class="tok-p">;</span>
    <span class="tok-nx">console</span><span class="tok-p">.</span><span class="tok-nx">log</span><span class="tok-p">(</span><span class="tok-s1">&#39;(2) varExterna = &#39;</span> <span class="tok-o">+</span> <span class="tok-nx">varExterna</span><span class="tok-p">);</span>
  <span class="tok-p">}</span>
  <span class="tok-k">return</span> <span class="tok-p">{</span><span class="tok-s1">&#39;func1&#39;</span><span class="tok-o">:</span> <span class="tok-nx">funcInterna1</span><span class="tok-p">,</span> <span class="tok-s1">&#39;func2&#39;</span><span class="tok-o">:</span> <span class="tok-nx">funcInterna2</span><span class="tok-p">};</span>
<span class="tok-p">}</span>
<span class="tok-kd">var</span> <span class="tok-nx">ref</span> <span class="tok-o">=</span> <span class="tok-nx">funcExterna</span><span class="tok-p">();</span>
<span class="tok-nx">ref</span><span class="tok-p">.</span><span class="tok-nx">func1</span><span class="tok-p">();</span>
<span class="tok-nx">ref</span><span class="tok-p">.</span><span class="tok-nx">func2</span><span class="tok-p">();</span>
<span class="tok-nx">ref</span><span class="tok-p">.</span><span class="tok-nx">func1</span><span class="tok-p">();</span>
<span class="tok-kd">var</span> <span class="tok-nx">ref2</span> <span class="tok-o">=</span> <span class="tok-nx">funcExterna</span><span class="tok-p">();</span>
<span class="tok-nx">ref2</span><span class="tok-p">.</span><span class="tok-nx">func1</span><span class="tok-p">();</span>
<span class="tok-nx">ref2</span><span class="tok-p">.</span><span class="tok-nx">func2</span><span class="tok-p">();</span>
<span class="tok-nx">ref2</span><span class="tok-p">.</span><span class="tok-nx">func1</span><span class="tok-p">();</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Devolvemos referencias a ambas funciones mediante un objeto (de manera similar al ejemplo del <em>Sumador</em>) para poder llamar a dichas funciones:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="console"><span class="tok-go">(1) varExterna = 1</span>
<span class="tok-go">(2) varExterna = 3</span>
<span class="tok-go">(1) varExterna = 4</span>
<span class="tok-go">(1) varExterna = 1</span>
<span class="tok-go">(2) varExterna = 3</span>
<span class="tok-go">(1) varExterna = 4</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Las dos funciones internas referencian a la misma variable local, con lo que comparten el mismo entorno de <em>closure</em>. Cuando <code>funcInterna1()</code> incrementa <code>varExterna</code> en 1, la llamada posterior a <code>funcInterna2()</code> parte de dicho valor con lo que el resultado de incrementar en dos unidades es 3. De manera similar a antes, al crear una nueva instancia de <code>funcExterna()</code> se crea un nuevo closure con su respectivo nuevo entorno.</p>
</div>
</div>
<div class="sect3">
<h4 id="_uso_de_closures">4.1.3. Uso de closures</h4>
<div class="paragraph">
<p>¿Son los closures realmente útiles? Vamos a considerar sus implicaciones prácticas. Un <em>closure</em> permite asociar algunos datos (el entorno) con una función que opera sobre esos datos. Esto tiene evidentes paralelismos con la programación orientada a objetos, en la que los objetos nos permiten asociar algunos datos (las propiedades del objeto) con uno o más métodos.</p>
</div>
<div class="paragraph">
<p>Por lo tanto, podemos utilizar un closure en cualquier lugar en el que normalmente usaríamos un objeto con sólo un método.</p>
</div>
<div class="paragraph">
<p>En la web hay situaciones habituales en las que aplicarlos. Gran parte del código <em>JavaScript</em> para web está basado en eventos: definimos un comportamiento y lo conectamos a un evento que se activa con una acción del usuario (como un click o pulsación de una tecla). Nuestro código generalmente se adjunta como un <em>callback</em>.</p>
</div>
<div class="paragraph">
<p>Cuando veamos como podemos trabajar con las hojas de estilo mediante JavaScript haremos uso de un closure.</p>
</div>
</div>
<div class="sect3">
<h4 id="_métodos_privados_mediante_closures">4.1.4. Métodos privados mediante closures</h4>
<div class="paragraph">
<p><em>Java</em> permite declarar métodos privados (solamente accesibles por otros métodos en la misma clase). En cambio, <em>JavaScript</em> no proporciona una forma nativa de hacer esto, pero es posible emularlos utilizando <em>closures</em>.</p>
</div>
<div class="paragraph">
<p>Los métodos privados no sólo son útiles para restringir el acceso al código, también proporcionan una poderosa manera de administrar el espacio de nombres global, evitando que los métodos auxiliares ensucien la interfaz pública del código.</p>
</div>
<div class="paragraph">
<p>A continuación vamos a mostrar un ejemplo de cómo definir algunas funciones públicas que pueden acceder a variables y funciones privadas utilizando closures, también conocido como <strong>patrón Módulo</strong>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="javascript"><span class="tok-kd">var</span> <span class="tok-nx">Contador</span> <span class="tok-o">=</span> <span class="tok-p">(</span><span class="tok-kd">function</span><span class="tok-p">()</span> <span class="tok-p">{</span>
  <span class="tok-kd">var</span> <span class="tok-nx">contadorPriv</span> <span class="tok-o">=</span> <span class="tok-mi">0</span><span class="tok-p">;</span>
  <span class="tok-kd">function</span> <span class="tok-nx">cambiar</span><span class="tok-p">(</span><span class="tok-nx">val</span><span class="tok-p">)</span> <span class="tok-p">{</span>
    <span class="tok-nx">contadorPriv</span> <span class="tok-o">+=</span> <span class="tok-nx">val</span><span class="tok-p">;</span>
  <span class="tok-p">}</span>
  <span class="tok-k">return</span> <span class="tok-p">{</span>
    <span class="tok-nx">incrementar</span><span class="tok-o">:</span> <span class="tok-kd">function</span><span class="tok-p">()</span> <span class="tok-p">{</span>
      <span class="tok-nx">cambiar</span><span class="tok-p">(</span><span class="tok-mi">1</span><span class="tok-p">);</span>
    <span class="tok-p">},</span>
    <span class="tok-nx">decrementar</span><span class="tok-o">:</span> <span class="tok-kd">function</span><span class="tok-p">()</span> <span class="tok-p">{</span>
      <span class="tok-nx">cambiar</span><span class="tok-p">(</span><span class="tok-o">-</span><span class="tok-mi">1</span><span class="tok-p">);</span>
    <span class="tok-p">},</span>
    <span class="tok-nx">valor</span><span class="tok-o">:</span> <span class="tok-kd">function</span><span class="tok-p">()</span> <span class="tok-p">{</span>
      <span class="tok-k">return</span> <span class="tok-nx">contadorPriv</span><span class="tok-p">;</span>
    <span class="tok-p">}</span>
  <span class="tok-p">}</span>
<span class="tok-p">})();</span>

<span class="tok-nx">console</span><span class="tok-p">.</span><span class="tok-nx">log</span><span class="tok-p">(</span><span class="tok-nx">Contador</span><span class="tok-p">.</span><span class="tok-nx">valor</span><span class="tok-p">());</span> <span class="tok-c1">// 0</span>
<span class="tok-nx">Contador</span><span class="tok-p">.</span><span class="tok-nx">incrementar</span><span class="tok-p">();</span>
<span class="tok-nx">Contador</span><span class="tok-p">.</span><span class="tok-nx">incrementar</span><span class="tok-p">();</span>
<span class="tok-nx">console</span><span class="tok-p">.</span><span class="tok-nx">log</span><span class="tok-p">(</span><span class="tok-nx">Contador</span><span class="tok-p">.</span><span class="tok-nx">valor</span><span class="tok-p">());</span> <span class="tok-c1">// 2</span>
<span class="tok-nx">Contador</span><span class="tok-p">.</span><span class="tok-nx">decrementar</span><span class="tok-p">();</span>
<span class="tok-nx">console</span><span class="tok-p">.</span><span class="tok-nx">log</span><span class="tok-p">(</span><span class="tok-nx">Contador</span><span class="tok-p">.</span><span class="tok-nx">valor</span><span class="tok-p">());</span> <span class="tok-c1">// 1</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Hasta ahora cada <em>closure</em> ha tenido su propio entorno. En cambio, aquí creamos un único entorno compartido por tres funciones: <code>Contador.incrementar</code>, <code>Contador.decrementar</code> y <code>Contador.valor</code>.</p>
</div>
<div class="paragraph">
<p>El entorno compartido se crea en el cuerpo de una función anónima, que se ejecuta en el momento que se define. El entorno contiene dos elementos privados: una variable llamada <code>contadorPriv</code> y una función llamada <code>cambiar</code>. No se puede acceder a ninguno de estos elementos privados directamente desde fuera de la función anónima. Se accede a ellos por las tres funciones públicas que se devuelven desde el contenedor anónimo.</p>
</div>
<div class="paragraph">
<p>Esas tres funciones públicas son <em>closures</em> que comparten el mismo entorno. Gracias al ámbito léxico de <em>JavaScript</em>, cada uno de ellas tienen acceso a la variable <code>contadorPriv</code> y a la función <code>cambiar</code>.</p>
</div>
<div class="paragraph">
<p>En este caso hemos definido una función anónima que crea un contador, y luego la llamamos inmediatamente y asignamos el resultado a la variable <code>Contador</code>. Pero podríamos almacenar esta función en una variable independiente y utilizarlo para crear varios contadores:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="javascript"><span class="tok-kd">var</span> <span class="tok-nx">crearContador</span> <span class="tok-o">=</span> <span class="tok-kd">function</span><span class="tok-p">()</span> <span class="tok-p">{</span>
  <span class="tok-kd">var</span> <span class="tok-nx">contadorPriv</span> <span class="tok-o">=</span> <span class="tok-mi">0</span><span class="tok-p">;</span>
  <span class="tok-kd">function</span> <span class="tok-nx">cambiar</span><span class="tok-p">(</span><span class="tok-nx">val</span><span class="tok-p">)</span> <span class="tok-p">{</span>
    <span class="tok-nx">contadorPriv</span> <span class="tok-o">+=</span> <span class="tok-nx">val</span><span class="tok-p">;</span>
  <span class="tok-p">}</span>
  <span class="tok-k">return</span> <span class="tok-p">{</span>
    <span class="tok-nx">incrementar</span><span class="tok-o">:</span> <span class="tok-kd">function</span><span class="tok-p">()</span> <span class="tok-p">{</span>
      <span class="tok-nx">cambiar</span><span class="tok-p">(</span><span class="tok-mi">1</span><span class="tok-p">);</span>
    <span class="tok-p">},</span>
    <span class="tok-nx">decrementar</span><span class="tok-o">:</span> <span class="tok-kd">function</span><span class="tok-p">()</span> <span class="tok-p">{</span>
      <span class="tok-nx">cambiar</span><span class="tok-p">(</span><span class="tok-o">-</span><span class="tok-mi">1</span><span class="tok-p">);</span>
    <span class="tok-p">},</span>
    <span class="tok-nx">valor</span><span class="tok-o">:</span> <span class="tok-kd">function</span><span class="tok-p">()</span> <span class="tok-p">{</span>
      <span class="tok-k">return</span> <span class="tok-nx">contadorPriv</span><span class="tok-p">;</span>
    <span class="tok-p">}</span>
  <span class="tok-p">}</span>
<span class="tok-p">};</span>

<span class="tok-kd">var</span> <span class="tok-nx">Contador1</span> <span class="tok-o">=</span> <span class="tok-nx">crearContador</span><span class="tok-p">();</span>
<span class="tok-kd">var</span> <span class="tok-nx">Contador2</span> <span class="tok-o">=</span> <span class="tok-nx">crearContador</span><span class="tok-p">();</span>
<span class="tok-nx">alert</span><span class="tok-p">(</span><span class="tok-nx">Contador1</span><span class="tok-p">.</span><span class="tok-nx">valor</span><span class="tok-p">());</span> <span class="tok-c1">// 0</span>
<span class="tok-nx">Contador1</span><span class="tok-p">.</span><span class="tok-nx">incrementar</span><span class="tok-p">();</span>
<span class="tok-nx">Contador1</span><span class="tok-p">.</span><span class="tok-nx">incrementar</span><span class="tok-p">();</span>
<span class="tok-nx">console</span><span class="tok-p">.</span><span class="tok-nx">log</span><span class="tok-p">(</span><span class="tok-nx">Contador1</span><span class="tok-p">.</span><span class="tok-nx">valor</span><span class="tok-p">());</span> <span class="tok-c1">// 2</span>
<span class="tok-nx">Contador1</span><span class="tok-p">.</span><span class="tok-nx">decrementar</span><span class="tok-p">();</span>
<span class="tok-nx">console</span><span class="tok-p">.</span><span class="tok-nx">log</span><span class="tok-p">(</span><span class="tok-nx">Contador1</span><span class="tok-p">.</span><span class="tok-nx">valor</span><span class="tok-p">());</span> <span class="tok-c1">// 1</span>
<span class="tok-nx">console</span><span class="tok-p">.</span><span class="tok-nx">log</span><span class="tok-p">(</span><span class="tok-nx">Contador2</span><span class="tok-p">.</span><span class="tok-nx">valor</span><span class="tok-p">());</span> <span class="tok-c1">// 0</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Ten en cuenta que cada uno de los dos contadores mantiene su independencia respecto al otro. Su entorno durante la llamada de la función <code>crearContador()</code> es diferente cada vez. La variable del <em>closure</em> <code>contadorPriv</code> contiene una instancia diferente cada vez.</p>
</div>
<div class="paragraph">
<p>Utilizar <em>closures</em> de este modo proporciona una serie de beneficios que se asocian normalmente con la programación orientada a objectos, en particular la encapsulación y la ocultación de datos que vimos en la unidad anterior.</p>
</div>
</div>
<div class="sect3">
<h4 id="_closures_dentro_de_bucles">4.1.5. Closures dentro de bucles</h4>
<div class="paragraph">
<p>Antes de la introducción de la palabra clave <code>let</code> en JavaScript 1.7, un problema común con <em>closures</em> ocurría cuando se creaban dentro de un bucle <code>loop</code>. Veamos el siguiente ejemplo:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="html"><span class="tok-nt">&lt;p</span> <span class="tok-na">id=</span><span class="tok-s">&quot;ayuda&quot;</span><span class="tok-nt">&gt;</span>La ayuda aparecerá aquí<span class="tok-nt">&lt;/p&gt;</span>
<span class="tok-nt">&lt;p&gt;</span>Correo electrónico: <span class="tok-nt">&lt;input</span> <span class="tok-na">type=</span><span class="tok-s">&quot;email&quot;</span> <span class="tok-na">id=</span><span class="tok-s">&quot;email&quot;</span> <span class="tok-na">name=</span><span class="tok-s">&quot;email&quot;</span><span class="tok-nt">&gt;&lt;/p&gt;</span>
<span class="tok-nt">&lt;p&gt;</span>Nombre: <span class="tok-nt">&lt;input</span> <span class="tok-na">type=</span><span class="tok-s">&quot;text&quot;</span> <span class="tok-na">id=</span><span class="tok-s">&quot;nombre&quot;</span> <span class="tok-na">name=</span><span class="tok-s">&quot;nombre&quot;</span><span class="tok-nt">&gt;&lt;/p&gt;</span>
<span class="tok-nt">&lt;p&gt;</span>Edad: <span class="tok-nt">&lt;input</span> <span class="tok-na">type=</span><span class="tok-s">&quot;number&quot;</span> <span class="tok-na">id=</span><span class="tok-s">&quot;edad&quot;</span> <span class="tok-na">name=</span><span class="tok-s">&quot;edad&quot;</span><span class="tok-nt">&gt;&lt;/p&gt;</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="javascript"><span class="tok-kd">function</span> <span class="tok-nx">muestraAyuda</span><span class="tok-p">(</span><span class="tok-nx">textoAyuda</span><span class="tok-p">)</span> <span class="tok-p">{</span>
  <span class="tok-nb">document</span><span class="tok-p">.</span><span class="tok-nx">getElementById</span><span class="tok-p">(</span><span class="tok-s1">&#39;ayuda&#39;</span><span class="tok-p">).</span><span class="tok-nx">innerHTML</span> <span class="tok-o">=</span> <span class="tok-nx">textoAyuda</span><span class="tok-p">;</span>
<span class="tok-p">}</span>

<span class="tok-kd">function</span> <span class="tok-nx">setupAyuda</span><span class="tok-p">()</span> <span class="tok-p">{</span>
  <span class="tok-kd">var</span> <span class="tok-nx">textosAyuda</span> <span class="tok-o">=</span> <span class="tok-p">[</span>
    <span class="tok-p">{</span><span class="tok-s1">&#39;id&#39;</span><span class="tok-o">:</span> <span class="tok-s1">&#39;email&#39;</span><span class="tok-p">,</span> <span class="tok-s1">&#39;ayuda&#39;</span><span class="tok-o">:</span> <span class="tok-s1">&#39;Dirección de correo electrónico&#39;</span><span class="tok-p">},</span>
    <span class="tok-p">{</span><span class="tok-s1">&#39;id&#39;</span><span class="tok-o">:</span> <span class="tok-s1">&#39;nombre&#39;</span><span class="tok-p">,</span> <span class="tok-s1">&#39;ayuda&#39;</span><span class="tok-o">:</span> <span class="tok-s1">&#39;Nombre completo&#39;</span><span class="tok-p">},</span>
    <span class="tok-p">{</span><span class="tok-s1">&#39;id&#39;</span><span class="tok-o">:</span> <span class="tok-s1">&#39;edad&#39;</span><span class="tok-p">,</span> <span class="tok-s1">&#39;ayuda&#39;</span><span class="tok-o">:</span> <span class="tok-s1">&#39;Edad (debes tener más de 16 años)&#39;</span><span class="tok-p">}</span>
  <span class="tok-p">];</span>

  <span class="tok-k">for</span> <span class="tok-p">(</span><span class="tok-kd">var</span> <span class="tok-nx">i</span> <span class="tok-o">=</span> <span class="tok-mi">0</span><span class="tok-p">;</span> <span class="tok-nx">i</span> <span class="tok-o">&lt;</span> <span class="tok-nx">textosAyuda</span><span class="tok-p">.</span><span class="tok-nx">length</span><span class="tok-p">;</span> <span class="tok-nx">i</span><span class="tok-o">++</span><span class="tok-p">)</span> <span class="tok-p">{</span>
    <span class="tok-kd">var</span> <span class="tok-nx">elem</span> <span class="tok-o">=</span> <span class="tok-nx">textosAyuda</span><span class="tok-p">[</span><span class="tok-nx">i</span><span class="tok-p">];</span>
    <span class="tok-nb">document</span><span class="tok-p">.</span><span class="tok-nx">getElementById</span><span class="tok-p">(</span><span class="tok-nx">elem</span><span class="tok-p">.</span><span class="tok-nx">id</span><span class="tok-p">).</span><span class="tok-nx">onfocus</span> <span class="tok-o">=</span> <span class="tok-kd">function</span><span class="tok-p">()</span> <span class="tok-p">{</span>
      <span class="tok-nx">muestraAyuda</span><span class="tok-p">(</span><span class="tok-nx">elem</span><span class="tok-p">.</span><span class="tok-nx">ayuda</span><span class="tok-p">);</span>
    <span class="tok-p">}</span>
  <span class="tok-p">}</span>
<span class="tok-p">}</span>

<span class="tok-nx">setupAyuda</span><span class="tok-p">();</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>El array <code>textosAyuda</code> define tres avisos de ayuda, cada uno asociado con el <code>id</code> de un campo de entrada en el documento. El bucle recorre estas definiciones, enlazando un evento <code>onfocus</code> a cada uno que muestra el método de ayuda asociada.</p>
</div>
<div class="paragraph">
<p>Si probamos el código, no funciona como esperamos, ya que independientemente del campo en el que se haga foco, siempre se mostrará el mensaje de ayuda de la edad.</p>
</div>
<div class="paragraph">
<p>Esto se debe a que las funciones asignadas a <code>onfocus</code> son <em>closures</em>: constan de la definición de la función y del entorno abarcado desde el ámbito de la función <code>setupAyuda</code>. Pese a haber creado tres closures, todos comparten el mismo entorno. En el momento en que se ejecutan las funciones <em>callback</em> de <code>onfocus</code>, el bucle ya ha finalizado y la variable <code>elem</code> (compartida por los tres <em>closures</em>) referencia a la última entrada del array <code>textosAyuda</code>.</p>
</div>
<div class="paragraph">
<p>Para solucionarlo, podemos utilizar más closures, añadiendo una factoría de función como se ha descrito anteriormente:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="javascript"><span class="tok-kd">function</span> <span class="tok-nx">muestraAyuda</span><span class="tok-p">(</span><span class="tok-nx">textoAyuda</span><span class="tok-p">)</span> <span class="tok-p">{</span>
  <span class="tok-nb">document</span><span class="tok-p">.</span><span class="tok-nx">getElementById</span><span class="tok-p">(</span><span class="tok-s1">&#39;ayuda&#39;</span><span class="tok-p">).</span><span class="tok-nx">innerHTML</span> <span class="tok-o">=</span> <span class="tok-nx">textoAyuda</span><span class="tok-p">;</span>
<span class="tok-p">}</span>

<span class="tok-kd">function</span> <span class="tok-nx">crearCallbackAyuda</span><span class="tok-p">(</span><span class="tok-nx">ayuda</span><span class="tok-p">)</span> <span class="tok-p">{</span>
  <span class="tok-k">return</span> <span class="tok-kd">function</span><span class="tok-p">()</span> <span class="tok-p">{</span>
    <span class="tok-nx">muestraAyuda</span><span class="tok-p">(</span><span class="tok-nx">ayuda</span><span class="tok-p">);</span>
  <span class="tok-p">};</span>
<span class="tok-p">}</span>

<span class="tok-kd">function</span> <span class="tok-nx">setupAyuda</span><span class="tok-p">()</span> <span class="tok-p">{</span>
  <span class="tok-kd">var</span> <span class="tok-nx">textosAyuda</span> <span class="tok-o">=</span> <span class="tok-p">[</span>
    <span class="tok-p">{</span><span class="tok-s1">&#39;id&#39;</span><span class="tok-o">:</span> <span class="tok-s1">&#39;email&#39;</span><span class="tok-p">,</span> <span class="tok-s1">&#39;ayuda&#39;</span><span class="tok-o">:</span> <span class="tok-s1">&#39;Dirección de correo electrónico&#39;</span><span class="tok-p">},</span>
    <span class="tok-p">{</span><span class="tok-s1">&#39;id&#39;</span><span class="tok-o">:</span> <span class="tok-s1">&#39;nombre&#39;</span><span class="tok-p">,</span> <span class="tok-s1">&#39;ayuda&#39;</span><span class="tok-o">:</span> <span class="tok-s1">&#39;Nombre completo&#39;</span><span class="tok-p">},</span>
    <span class="tok-p">{</span><span class="tok-s1">&#39;id&#39;</span><span class="tok-o">:</span> <span class="tok-s1">&#39;edad&#39;</span><span class="tok-p">,</span> <span class="tok-s1">&#39;ayuda&#39;</span><span class="tok-o">:</span> <span class="tok-s1">&#39;Edad (debes tener más de 16 años)&#39;</span><span class="tok-p">}</span>
  <span class="tok-p">];</span>

  <span class="tok-k">for</span> <span class="tok-p">(</span><span class="tok-kd">var</span> <span class="tok-nx">i</span> <span class="tok-o">=</span> <span class="tok-mi">0</span><span class="tok-p">;</span> <span class="tok-nx">i</span> <span class="tok-o">&lt;</span> <span class="tok-nx">textosAyuda</span><span class="tok-p">.</span><span class="tok-nx">length</span><span class="tok-p">;</span> <span class="tok-nx">i</span><span class="tok-o">++</span><span class="tok-p">)</span> <span class="tok-p">{</span>
    <span class="tok-kd">var</span> <span class="tok-nx">elem</span> <span class="tok-o">=</span> <span class="tok-nx">textosAyuda</span><span class="tok-p">[</span><span class="tok-nx">i</span><span class="tok-p">];</span>
    <span class="tok-nb">document</span><span class="tok-p">.</span><span class="tok-nx">getElementById</span><span class="tok-p">(</span><span class="tok-nx">elem</span><span class="tok-p">.</span><span class="tok-nx">id</span><span class="tok-p">).</span><span class="tok-nx">onfocus</span> <span class="tok-o">=</span> <span class="tok-nx">crearCallbackAyuda</span><span class="tok-p">(</span><span class="tok-nx">elem</span><span class="tok-p">.</span><span class="tok-nx">ayuda</span><span class="tok-p">);</span>
  <span class="tok-p">}</span>
<span class="tok-p">}</span>

<span class="tok-nx">setupAyuda</span><span class="tok-p">();</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Ahora ya funciona correctamente, ya que en lugar de los tres callbacks compartiendo el mismo entorno, la función <code>crearCallbackAyuda</code> crea un nuevo entorno para cada uno en el que <code>ayuda</code> se refiere a la cadena correspondiente del array <code>textosAyuda</code>.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="title">Autoevaluación</div>
<div class="paragraph">
<p>A partir del siguiente código:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="javascript"><span class="tok-kd">var</span> <span class="tok-nx">nodos</span> <span class="tok-o">=</span> <span class="tok-nb">document</span><span class="tok-p">.</span><span class="tok-nx">getElementsByTagName</span><span class="tok-p">(</span><span class="tok-s1">&#39;button&#39;</span><span class="tok-p">);</span>
<span class="tok-k">for</span> <span class="tok-p">(</span><span class="tok-kd">var</span> <span class="tok-nx">i</span><span class="tok-o">=</span><span class="tok-mi">0</span><span class="tok-p">,</span> <span class="tok-nx">len</span> <span class="tok-o">=</span> <span class="tok-nx">nodos</span><span class="tok-p">.</span><span class="tok-nx">length</span><span class="tok-p">;</span> <span class="tok-nx">i</span><span class="tok-o">&lt;</span><span class="tok-nx">len</span><span class="tok-p">;</span> <span class="tok-nx">i</span><span class="tok-o">++</span><span class="tok-p">)</span> <span class="tok-p">{</span>
  <span class="tok-nx">nodos</span><span class="tok-p">[</span><span class="tok-nx">i</span><span class="tok-p">].</span><span class="tok-nx">addEventListener</span><span class="tok-p">(</span><span class="tok-s1">&#39;click&#39;</span><span class="tok-p">,</span> <span class="tok-kd">function</span><span class="tok-p">()</span> <span class="tok-p">{</span>
    <span class="tok-nx">console</span><span class="tok-p">.</span><span class="tok-nx">log</span><span class="tok-p">(</span><span class="tok-s2">&quot;Click en elemento número &quot;</span> <span class="tok-o">+</span> <span class="tok-nx">i</span><span class="tok-p">);</span>
  <span class="tok-p">});</span>
<span class="tok-p">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>¿Qué saldrá por consola si el usuario <em>clicka</em> en el primer y cuarto botón? ¿Por qué? <span class="footnote">[<a id="_footnoteref_10" class="footnote" href="#_footnote_10" title="View footnote.">10</a>]</span></p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_consideraciones_de_rendimiento">4.1.6. Consideraciones de rendimiento</h4>
<div class="paragraph">
<p>No es aconsejable crear innecesariamente funciones dentro de otras funciones si no se necesitan los <em>closures</em> para una tarea particular ya que afectará negativamente el rendimiento del script tanto en consumo de memoria como en velocidad de procesamiento.</p>
</div>
<div class="paragraph">
<p>Por ejemplo, cuando se crea un nuevo objeto/clase, los métodos normalmente deberían asociarse al prototipo del objeto en vez de definirse en el constructor del objeto. La razón es que con este último sistema, cada vez que se llama al constructor (cada vez que se crea un objeto) se tienen que reasignar los métodos.</p>
</div>
<div class="paragraph">
<p>Veamos el siguiente caso, que no es práctico pero sí demostrativo:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="javascript"><span class="tok-kd">function</span> <span class="tok-nx">MiObjeto</span><span class="tok-p">(</span><span class="tok-nx">nombre</span><span class="tok-p">,</span> <span class="tok-nx">mensaje</span><span class="tok-p">)</span> <span class="tok-p">{</span>
  <span class="tok-k">this</span><span class="tok-p">.</span><span class="tok-nx">nombre</span> <span class="tok-o">=</span> <span class="tok-nx">nombre</span><span class="tok-p">.</span><span class="tok-nx">toString</span><span class="tok-p">();</span>
  <span class="tok-k">this</span><span class="tok-p">.</span><span class="tok-nx">mensaje</span> <span class="tok-o">=</span> <span class="tok-nx">mensaje</span><span class="tok-p">.</span><span class="tok-nx">toString</span><span class="tok-p">();</span>
  <span class="tok-k">this</span><span class="tok-p">.</span><span class="tok-nx">getNombre</span> <span class="tok-o">=</span> <span class="tok-kd">function</span><span class="tok-p">()</span> <span class="tok-p">{</span>
    <span class="tok-k">return</span> <span class="tok-k">this</span><span class="tok-p">.</span><span class="tok-nx">nombre</span><span class="tok-p">;</span>
  <span class="tok-p">};</span>

  <span class="tok-k">this</span><span class="tok-p">.</span><span class="tok-nx">getMensaje</span> <span class="tok-o">=</span> <span class="tok-kd">function</span><span class="tok-p">()</span> <span class="tok-p">{</span>
    <span class="tok-k">return</span> <span class="tok-k">this</span><span class="tok-p">.</span><span class="tok-nx">mensaje</span><span class="tok-p">;</span>
  <span class="tok-p">};</span>
<span class="tok-p">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>El código anterior no aprovecha los beneficios de los closures. Podríamos modificarlo de la siguiente manera:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="javascript"><span class="tok-kd">function</span> <span class="tok-nx">MiObjeto</span><span class="tok-p">(</span><span class="tok-nx">nombre</span><span class="tok-p">,</span> <span class="tok-nx">mensaje</span><span class="tok-p">)</span> <span class="tok-p">{</span>
  <span class="tok-k">this</span><span class="tok-p">.</span><span class="tok-nx">nombre</span> <span class="tok-o">=</span> <span class="tok-nx">nombre</span><span class="tok-p">.</span><span class="tok-nx">toString</span><span class="tok-p">();</span>
  <span class="tok-k">this</span><span class="tok-p">.</span><span class="tok-nx">mensaje</span> <span class="tok-o">=</span> <span class="tok-nx">mensaje</span><span class="tok-p">.</span><span class="tok-nx">toString</span><span class="tok-p">();</span>
<span class="tok-p">}</span>

<span class="tok-nx">MiObjeto</span><span class="tok-p">.</span><span class="tok-nx">prototype</span> <span class="tok-o">=</span> <span class="tok-p">{</span>
  <span class="tok-nx">getNombre</span><span class="tok-o">:</span> <span class="tok-kd">function</span><span class="tok-p">()</span> <span class="tok-p">{</span>
    <span class="tok-k">return</span> <span class="tok-k">this</span><span class="tok-p">.</span><span class="tok-nx">nombre</span><span class="tok-p">;</span>
  <span class="tok-p">},</span>
  <span class="tok-nx">getMensaje</span><span class="tok-o">:</span> <span class="tok-kd">function</span><span class="tok-p">()</span> <span class="tok-p">{</span>
    <span class="tok-k">return</span> <span class="tok-k">this</span><span class="tok-p">.</span><span class="tok-nx">mensaje</span><span class="tok-p">;</span>
  <span class="tok-p">}</span>
<span class="tok-p">};</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Sin embargo, no se recomienda redefinir el prototipo. Para ello, es mejor añadir funcionalidad al prototipo existente en vez de sustituirlo:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="javascript"><span class="tok-kd">function</span> <span class="tok-nx">MiObjeto</span><span class="tok-p">(</span><span class="tok-nx">nombre</span><span class="tok-p">,</span> <span class="tok-nx">mensaje</span><span class="tok-p">)</span> <span class="tok-p">{</span>
  <span class="tok-k">this</span><span class="tok-p">.</span><span class="tok-nx">nombre</span> <span class="tok-o">=</span> <span class="tok-nx">nombre</span><span class="tok-p">.</span><span class="tok-nx">toString</span><span class="tok-p">();</span>
  <span class="tok-k">this</span><span class="tok-p">.</span><span class="tok-nx">mensaje</span> <span class="tok-o">=</span> <span class="tok-nx">mensaje</span><span class="tok-p">.</span><span class="tok-nx">toString</span><span class="tok-p">();</span>
<span class="tok-p">}</span>

<span class="tok-nx">MiObjeto</span><span class="tok-p">.</span><span class="tok-nx">prototype</span><span class="tok-p">.</span><span class="tok-nx">getNombre</span> <span class="tok-o">=</span> <span class="tok-kd">function</span><span class="tok-p">()</span> <span class="tok-p">{</span>
  <span class="tok-k">return</span> <span class="tok-k">this</span><span class="tok-p">.</span><span class="tok-nx">nombre</span><span class="tok-p">;</span>
<span class="tok-p">};</span>
<span class="tok-nx">MiObjeto</span><span class="tok-p">.</span><span class="tok-nx">prototype</span><span class="tok-p">.</span><span class="tok-nx">getMensaje</span> <span class="tok-o">=</span> <span class="tok-kd">function</span><span class="tok-p">()</span> <span class="tok-p">{</span>
  <span class="tok-k">return</span> <span class="tok-k">this</span><span class="tok-p">.</span><span class="tok-nx">mensaje</span><span class="tok-p">;</span>
<span class="tok-p">};</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>En los dos ejemplos anteriores, todos los objetos comparten el prototipo heredado y no se van a definir los métodos cada vez que se crean objetos.</p>
</div>
<div class="paragraph">
<p>Mas información en <a href="https://developer.mozilla.org/es/docs/Web/JavaScript/Guide/Closures" class="bare">https://developer.mozilla.org/es/docs/Web/JavaScript/Guide/Closures</a></p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_módulos">4.2. Módulos</h3>
<div class="paragraph">
<p>Los módulos permiten reutilizar código entre diferentes aplicaciones. Antes de entrar en detalle con el uso de módulos para organizar el código, es conveniente crear un espacio de nombres (<em>namespace</em>).</p>
</div>
<div class="paragraph">
<p>Todos sabemos que hay que reservar las variables globales para los objetos que tienen relevancia a nivel de sistema y que tienen que nombrarse de tal manera que no sean ambiguos y que minimicen el riesgo de colisión con otros objetos. En resumen, hay que evitar la creación de objetos globales, a no ser que sea estrictamente necesarios.</p>
</div>
<div class="paragraph">
<p>Aun así, vamos a hacer uso de las variables globales para crear un pequeño conjunto de objetos globales que harán de espacios de nombre para los módulos y subsistemas existentes.</p>
</div>
<div class="sect3">
<h4 id="_espacio_de_nombres_estático">4.2.1. Espacio de nombres estático</h4>
<div class="paragraph">
<p>Este tipo fija el nombre del espacio de nombre de manera <em>hard coded</em>.</p>
</div>
<div class="paragraph">
<p>Una posibilidad de hacerlo mediante una <strong>asignación directa</strong>. Es el enfoque más sencillo, pero también el que conlleva más código y si queremos renombre el <em>namespace</em>, tenemos muchas referencias. Sin embargo, es seguro y nada ambiguo.</p>
</div>
<div class="listingblock">
<div class="title">Ejemplo <em>namespace</em> estático - <a href="https://jsbin.com/qeteje/edit?js,console" class="bare">https://jsbin.com/qeteje/edit?js,console</a></div>
<div class="content">
<pre class="pygments highlight"><code data-lang="javascript"><span class="tok-kd">var</span> <span class="tok-nx">miApp</span> <span class="tok-o">=</span> <span class="tok-p">{};</span>

<span class="tok-nx">miApp</span><span class="tok-p">.</span><span class="tok-nx">id</span> <span class="tok-o">=</span> <span class="tok-mi">0</span><span class="tok-p">;</span>

<span class="tok-nx">miApp</span><span class="tok-p">.</span><span class="tok-nx">siguiente</span> <span class="tok-o">=</span> <span class="tok-kd">function</span><span class="tok-p">()</span> <span class="tok-p">{</span>
  <span class="tok-nx">miApp</span><span class="tok-p">.</span><span class="tok-nx">id</span><span class="tok-o">++</span><span class="tok-p">;</span>
  <span class="tok-nx">console</span><span class="tok-p">.</span><span class="tok-nx">log</span><span class="tok-p">(</span><span class="tok-nx">miApp</span><span class="tok-p">.</span><span class="tok-nx">id</span><span class="tok-p">);</span>
  <span class="tok-k">return</span> <span class="tok-nx">miApp</span><span class="tok-p">.</span><span class="tok-nx">id</span><span class="tok-p">;</span>
<span class="tok-p">};</span>

<span class="tok-nx">miApp</span><span class="tok-p">.</span><span class="tok-nx">reset</span> <span class="tok-o">=</span> <span class="tok-kd">function</span><span class="tok-p">()</span> <span class="tok-p">{</span>
  <span class="tok-nx">miApp</span><span class="tok-p">.</span><span class="tok-nx">id</span> <span class="tok-o">=</span> <span class="tok-mi">0</span><span class="tok-p">;</span>
<span class="tok-p">};</span>

<span class="tok-nx">miApp</span><span class="tok-p">.</span><span class="tok-nx">siguiente</span><span class="tok-p">();</span>  <span class="tok-c1">// 1</span>
<span class="tok-nx">miApp</span><span class="tok-p">.</span><span class="tok-nx">siguiente</span><span class="tok-p">();</span>  <span class="tok-c1">// 2</span>
<span class="tok-nx">miApp</span><span class="tok-p">.</span><span class="tok-nx">reset</span><span class="tok-p">();</span>
<span class="tok-nx">miApp</span><span class="tok-p">.</span><span class="tok-nx">siguiente</span><span class="tok-p">();</span>  <span class="tok-c1">// 1</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Pese a que pensemos que haciendo uso de <code>this</code>, podemos evitar repetir tanto el nombre del espacio de nombre, hay que tener cuidado ya no podemos evitar que se asignen las funciones a variables y por tanto, cambie el comportamiento de <code>this</code>:</p>
</div>
<div class="listingblock">
<div class="title">Ejemplo <em>namespace</em> estático con <code>this</code> - <a href="https://jsbin.com/kafokol/edit?js,console" class="bare">https://jsbin.com/kafokol/edit?js,console</a></div>
<div class="content">
<pre class="pygments highlight"><code data-lang="javascript"><span class="tok-kd">var</span> <span class="tok-nx">miApp</span> <span class="tok-o">=</span> <span class="tok-p">{};</span>

<span class="tok-nx">miApp</span><span class="tok-p">.</span><span class="tok-nx">id</span> <span class="tok-o">=</span> <span class="tok-mi">0</span><span class="tok-p">;</span>

<span class="tok-nx">miApp</span><span class="tok-p">.</span><span class="tok-nx">siguiente</span> <span class="tok-o">=</span> <span class="tok-kd">function</span><span class="tok-p">()</span> <span class="tok-p">{</span>
  <span class="tok-k">this</span><span class="tok-p">.</span><span class="tok-nx">id</span><span class="tok-o">++</span><span class="tok-p">;</span>
  <span class="tok-nx">console</span><span class="tok-p">.</span><span class="tok-nx">log</span><span class="tok-p">(</span><span class="tok-k">this</span><span class="tok-p">.</span><span class="tok-nx">id</span><span class="tok-p">);</span>
  <span class="tok-k">return</span> <span class="tok-k">this</span><span class="tok-p">.</span><span class="tok-nx">id</span><span class="tok-p">;</span>
<span class="tok-p">};</span>

<span class="tok-nx">miApp</span><span class="tok-p">.</span><span class="tok-nx">reset</span> <span class="tok-o">=</span> <span class="tok-kd">function</span><span class="tok-p">()</span> <span class="tok-p">{</span>
  <span class="tok-k">this</span><span class="tok-p">.</span><span class="tok-nx">id</span> <span class="tok-o">=</span> <span class="tok-mi">0</span><span class="tok-p">;</span>
<span class="tok-p">};</span>

<span class="tok-nx">miApp</span><span class="tok-p">.</span><span class="tok-nx">siguiente</span><span class="tok-p">();</span> <span class="tok-c1">// 1</span>
<span class="tok-nx">miApp</span><span class="tok-p">.</span><span class="tok-nx">siguiente</span><span class="tok-p">();</span> <span class="tok-c1">// 2</span>
<span class="tok-kd">var</span> <span class="tok-nx">getNextId</span> <span class="tok-o">=</span> <span class="tok-nx">miApp</span><span class="tok-p">.</span><span class="tok-nx">siguiente</span><span class="tok-p">;</span>
<span class="tok-nx">getNextId</span><span class="tok-p">();</span> <span class="tok-c1">// NaN</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>La segunda opción es utilizar la <strong>notación de objetos literales</strong>, de manera que solo se referencia al <em>namespace</em> una sola vez, con lo que cambiar su nombre es trivial.</p>
</div>
<div class="paragraph">
<p>Sigue existiendo el riesgo de obtener un valor inesperado si se asigna un método a una variable, pero es asumible que los objetos definidos dentro de un objeto literal no se van a reasignar:</p>
</div>
<div class="listingblock">
<div class="title">Ejemplo <em>namespace</em> estático con notación objeto literal - <a href="https://jsbin.com/xozefu/edit?js,console" class="bare">https://jsbin.com/xozefu/edit?js,console</a></div>
<div class="content">
<pre class="pygments highlight"><code data-lang="javascript"><span class="tok-kd">var</span> <span class="tok-nx">miApp</span> <span class="tok-o">=</span> <span class="tok-p">{</span>
  <span class="tok-nx">id</span><span class="tok-o">:</span> <span class="tok-mi">0</span><span class="tok-p">,</span>

  <span class="tok-nx">siguiente</span><span class="tok-o">:</span> <span class="tok-kd">function</span><span class="tok-p">()</span> <span class="tok-p">{</span>
    <span class="tok-k">this</span><span class="tok-p">.</span><span class="tok-nx">id</span><span class="tok-o">++</span><span class="tok-p">;</span>
    <span class="tok-nx">console</span><span class="tok-p">.</span><span class="tok-nx">log</span><span class="tok-p">(</span><span class="tok-k">this</span><span class="tok-p">.</span><span class="tok-nx">id</span><span class="tok-p">);</span>
    <span class="tok-k">return</span> <span class="tok-k">this</span><span class="tok-p">.</span><span class="tok-nx">id</span><span class="tok-p">;</span>
  <span class="tok-p">},</span>

  <span class="tok-nx">reset</span><span class="tok-o">:</span> <span class="tok-kd">function</span><span class="tok-p">()</span> <span class="tok-p">{</span>
    <span class="tok-k">this</span><span class="tok-p">.</span><span class="tok-nx">id</span> <span class="tok-o">=</span> <span class="tok-mi">0</span><span class="tok-p">;</span>
  <span class="tok-p">}</span>
<span class="tok-p">};</span>

<span class="tok-nx">miApp</span><span class="tok-p">.</span><span class="tok-nx">siguiente</span><span class="tok-p">();</span>  <span class="tok-c1">// 1</span>
<span class="tok-nx">miApp</span><span class="tok-p">.</span><span class="tok-nx">siguiente</span><span class="tok-p">();</span>  <span class="tok-c1">// 2</span>
<span class="tok-nx">miApp</span><span class="tok-p">.</span><span class="tok-nx">reset</span><span class="tok-p">();</span>
<span class="tok-nx">miApp</span><span class="tok-p">.</span><span class="tok-nx">siguiente</span><span class="tok-p">();</span>  <span class="tok-c1">// 1</span></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_el_patrón_módulo">4.2.2. El patrón módulo</h4>
<div class="paragraph">
<p>La lógica se protege del alcance global mediante un función envoltorio, normalmente una IIFE, la cual devuelve un objeto que representa el interfaz público del módulo. Al invocar inmediatamente la función y asignar el resultado a una variable que define el espacio de nombre, el API del módulo se restringe a dicho <em>namespace</em>.</p>
</div>
<div class="listingblock">
<div class="title">Esqueleto del patrón Módulo</div>
<div class="content">
<pre class="pygments highlight"><code data-lang="javascript"><span class="tok-kd">var</span> <span class="tok-nx">miModulo</span> <span class="tok-o">=</span> <span class="tok-p">(</span><span class="tok-kd">function</span><span class="tok-p">()</span> <span class="tok-p">{</span>
  <span class="tok-kd">var</span> <span class="tok-nx">privado</span><span class="tok-p">;</span>  <i class="conum" data-value="1"></i><b>(1)</b>

  <span class="tok-k">return</span> <span class="tok-p">{</span>
    <span class="tok-c1">// interfaz público</span>
  <span class="tok-p">}</span>
<span class="tok-p">})();</span></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Las variables que no estén incluidas dentro del objeto devuelto, permacenerán privadas, solamente visitblaes por las funciones incluidas dentro del interfaz público</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Así pues, si reescribimos el ejemplo anterior mediante un módulo, tendremos:</p>
</div>
<div class="listingblock">
<div class="title">Ejemplo módulo -</div>
<div class="content">
<pre class="pygments highlight"><code data-lang="javascript"><span class="tok-kd">var</span> <span class="tok-nx">miApp</span> <span class="tok-o">=</span> <span class="tok-p">(</span><span class="tok-kd">function</span><span class="tok-p">()</span> <span class="tok-p">{</span>
  <span class="tok-kd">var</span> <span class="tok-nx">id</span> <span class="tok-o">=</span> <span class="tok-mi">0</span><span class="tok-p">;</span>

  <span class="tok-k">return</span> <span class="tok-p">{</span>  <i class="conum" data-value="1"></i><b>(1)</b>
    <span class="tok-nx">siguiente</span><span class="tok-o">:</span> <span class="tok-kd">function</span><span class="tok-p">()</span> <span class="tok-p">{</span>
      <span class="tok-nx">id</span><span class="tok-o">++</span><span class="tok-p">;</span>
      <span class="tok-nx">console</span><span class="tok-p">.</span><span class="tok-nx">log</span><span class="tok-p">(</span><span class="tok-nx">id</span><span class="tok-p">);</span>
      <span class="tok-k">return</span> <span class="tok-nx">id</span><span class="tok-p">;</span>
    <span class="tok-p">},</span>

    <span class="tok-nx">reset</span><span class="tok-o">:</span> <span class="tok-kd">function</span><span class="tok-p">()</span> <span class="tok-p">{</span>
      <span class="tok-nx">id</span> <span class="tok-o">=</span> <span class="tok-mi">0</span><span class="tok-p">;</span>
    <span class="tok-p">}</span>
  <span class="tok-p">};</span>
<span class="tok-p">})();</span>

<span class="tok-nx">miApp</span><span class="tok-p">.</span><span class="tok-nx">siguiente</span><span class="tok-p">();</span>  <span class="tok-c1">// 1</span>
<span class="tok-nx">miApp</span><span class="tok-p">.</span><span class="tok-nx">siguiente</span><span class="tok-p">();</span>  <span class="tok-c1">// 2</span>
<span class="tok-nx">miApp</span><span class="tok-p">.</span><span class="tok-nx">reset</span><span class="tok-p">();</span>
<span class="tok-nx">miApp</span><span class="tok-p">.</span><span class="tok-nx">siguiente</span><span class="tok-p">();</span>  <span class="tok-c1">// 1</span></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Para que el módulo se comunique con el exterior, mediante <code>return</code> devolvemos un objeto cuyas propiedades son los métodos del módulo.</td>
</tr>
</table>
</div>
<div class="sect4">
<h5 id="_paso_de_parámetros">Paso de parámetros</h5>
<div class="paragraph">
<p>Si necesitamos pasarle parámetros a un método de un módulo es mejor pasar un objeto literal:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="javascript"><span class="tok-nx">miApp</span><span class="tok-p">.</span><span class="tok-nx">siguiente</span><span class="tok-p">({</span><span class="tok-nx">incremento</span><span class="tok-o">:</span> <span class="tok-mi">5</span><span class="tok-p">});</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Y en el módulo podemos comprobar si viene algun parámetro como método mediante el operador <code>||</code>:</p>
</div>
<div class="listingblock">
<div class="title">Ejemplo de paso de parámetros a un módulo - <a href="https://jsbin.com/xunefo/edit?js,console" class="bare">https://jsbin.com/xunefo/edit?js,console</a></div>
<div class="content">
<pre class="pygments highlight"><code data-lang="javascript"><span class="tok-nx">siguiente</span><span class="tok-o">:</span> <span class="tok-kd">function</span><span class="tok-p">()</span> <span class="tok-p">{</span>
  <span class="tok-kd">var</span> <span class="tok-nx">misArgs</span> <span class="tok-o">=</span> <span class="tok-nx">arguments</span><span class="tok-p">[</span><span class="tok-mi">0</span><span class="tok-p">]</span> <span class="tok-o">||</span> <span class="tok-s1">&#39;&#39;</span><span class="tok-p">;</span> <i class="conum" data-value="1"></i><b>(1)</b>
  <span class="tok-kd">var</span> <span class="tok-nx">miIncremento</span> <span class="tok-o">=</span> <span class="tok-nx">misArgs</span><span class="tok-p">.</span><span class="tok-nx">incremento</span> <span class="tok-o">||</span> <span class="tok-mi">1</span><span class="tok-p">;</span>  <i class="conum" data-value="2"></i><b>(2)</b>

  <span class="tok-nx">id</span> <span class="tok-o">=</span> <span class="tok-nx">id</span> <span class="tok-o">+</span> <span class="tok-nx">miIncremento</span><span class="tok-p">;</span>
  <span class="tok-nx">console</span><span class="tok-p">.</span><span class="tok-nx">log</span><span class="tok-p">(</span><span class="tok-nx">id</span><span class="tok-p">);</span>
  <span class="tok-k">return</span> <span class="tok-nx">id</span><span class="tok-p">;</span>
<span class="tok-p">}</span></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Comprobamos si recibimos un parámetro</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Comprobamos si el parámetro recibido contiene la propiedad <code>incremento</code>. Si no, le asignamos <code>1</code> como valor por defecto</td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="_valores_de_configuración">Valores de configuración</h5>
<div class="paragraph">
<p>Si nuestro módulo va a tener muchas variables para almacenar valores por defecto, es mejor centralizarlas y agruparlas dentro de un objeto privado del módulo:</p>
</div>
<div class="listingblock">
<div class="title">Ejemplo de módulo con valores de configuración - <a href="https://jsbin.com/havesi/edit?js,console" class="bare">https://jsbin.com/havesi/edit?js,console</a></div>
<div class="content">
<pre class="pygments highlight"><code data-lang="javascript"><span class="tok-kd">var</span> <span class="tok-nx">miApp</span> <span class="tok-o">=</span> <span class="tok-p">(</span><span class="tok-kd">function</span><span class="tok-p">()</span> <span class="tok-p">{</span>
  <span class="tok-kd">var</span> <span class="tok-nx">id</span> <span class="tok-o">=</span> <span class="tok-mi">0</span><span class="tok-p">;</span>

  <span class="tok-kd">var</span> <span class="tok-nx">CONF</span> <span class="tok-o">=</span> <span class="tok-p">{</span>   <i class="conum" data-value="1"></i><b>(1)</b>
    <span class="tok-nx">incremento</span><span class="tok-o">:</span> <span class="tok-mi">1</span><span class="tok-p">,</span>
    <span class="tok-nx">decremento</span><span class="tok-o">:</span> <span class="tok-mi">1</span>
  <span class="tok-p">};</span>

  <span class="tok-k">return</span> <span class="tok-p">{</span>
    <span class="tok-nx">siguiente</span><span class="tok-o">:</span> <span class="tok-kd">function</span><span class="tok-p">()</span> <span class="tok-p">{</span>
      <span class="tok-kd">var</span> <span class="tok-nx">misArgs</span> <span class="tok-o">=</span> <span class="tok-nx">arguments</span><span class="tok-p">[</span><span class="tok-mi">0</span><span class="tok-p">]</span> <span class="tok-o">||</span> <span class="tok-s1">&#39;&#39;</span><span class="tok-p">;</span>
      <span class="tok-kd">var</span> <span class="tok-nx">miIncremento</span> <span class="tok-o">=</span> <span class="tok-nx">misArgs</span><span class="tok-p">.</span><span class="tok-nx">incremento</span> <span class="tok-o">||</span> <span class="tok-nx">CONF</span><span class="tok-p">.</span><span class="tok-nx">incremento</span><span class="tok-p">;</span>  <i class="conum" data-value="2"></i><b>(2)</b>

      <span class="tok-nx">id</span> <span class="tok-o">=</span> <span class="tok-nx">id</span> <span class="tok-o">+</span> <span class="tok-nx">miIncremento</span><span class="tok-p">;</span>
      <span class="tok-nx">console</span><span class="tok-p">.</span><span class="tok-nx">log</span><span class="tok-p">(</span><span class="tok-nx">id</span><span class="tok-p">);</span>
      <span class="tok-k">return</span> <span class="tok-nx">id</span><span class="tok-p">;</span>
    <span class="tok-p">},</span>

    <span class="tok-nx">reset</span><span class="tok-o">:</span> <span class="tok-kd">function</span><span class="tok-p">()</span> <span class="tok-p">{</span>
      <span class="tok-nx">id</span> <span class="tok-o">=</span> <span class="tok-mi">0</span><span class="tok-p">;</span>
    <span class="tok-p">}</span>
  <span class="tok-p">};</span>
<span class="tok-p">})();</span>

<span class="tok-nx">miApp</span><span class="tok-p">.</span><span class="tok-nx">siguiente</span><span class="tok-p">();</span>  <span class="tok-c1">// 1</span>
<span class="tok-nx">miApp</span><span class="tok-p">.</span><span class="tok-nx">siguiente</span><span class="tok-p">({</span><span class="tok-nx">incremento</span><span class="tok-o">:</span> <span class="tok-mi">5</span><span class="tok-p">});</span>  <span class="tok-c1">// 6</span>
<span class="tok-nx">miApp</span><span class="tok-p">.</span><span class="tok-nx">reset</span><span class="tok-p">();</span>
<span class="tok-nx">miApp</span><span class="tok-p">.</span><span class="tok-nx">siguiente</span><span class="tok-p">();</span>  <span class="tok-c1">// 1</span></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Objeto de configuración con los valores por defecto para configurar el módulo</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Si el parámetro no contiene la propiedad <code>incremento</code>, le asignamos el valor que tenemos en nuestro objeto de configuración.</td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="_encadenando_llamadas">Encadenando llamadas</h5>
<div class="paragraph">
<p>Si queremos encadenar la salida de un método como la entrada de otro, acción que realiza mucho <em>jQuery</em>, sólo tenemos que devolver <code>this</code> como resultado de cada método, y así devolver como resultado del método el propio módulo:</p>
</div>
<div class="listingblock">
<div class="title">Ejemplo de módulo con encadenamiento de llamadas -</div>
<div class="content">
<pre class="pygments highlight"><code data-lang="javascript"><span class="tok-kd">var</span> <span class="tok-nx">miApp</span> <span class="tok-o">=</span> <span class="tok-p">(</span><span class="tok-kd">function</span><span class="tok-p">()</span> <span class="tok-p">{</span>
  <span class="tok-kd">var</span> <span class="tok-nx">id</span> <span class="tok-o">=</span> <span class="tok-mi">0</span><span class="tok-p">;</span>

  <span class="tok-kd">var</span> <span class="tok-nx">CONF</span> <span class="tok-o">=</span> <span class="tok-p">{</span>
    <span class="tok-nx">incremento</span><span class="tok-o">:</span> <span class="tok-mi">1</span><span class="tok-p">,</span>
    <span class="tok-nx">decremento</span><span class="tok-o">:</span> <span class="tok-mi">1</span>
  <span class="tok-p">};</span>

  <span class="tok-k">return</span> <span class="tok-p">{</span>
    <span class="tok-nx">siguiente</span><span class="tok-o">:</span> <span class="tok-kd">function</span><span class="tok-p">()</span> <span class="tok-p">{</span>
      <span class="tok-kd">var</span> <span class="tok-nx">misArgs</span> <span class="tok-o">=</span> <span class="tok-nx">arguments</span><span class="tok-p">[</span><span class="tok-mi">0</span><span class="tok-p">]</span> <span class="tok-o">||</span> <span class="tok-s1">&#39;&#39;</span><span class="tok-p">;</span>
      <span class="tok-kd">var</span> <span class="tok-nx">miIncremento</span> <span class="tok-o">=</span> <span class="tok-nx">misArgs</span><span class="tok-p">.</span><span class="tok-nx">incremento</span> <span class="tok-o">||</span> <span class="tok-nx">CONF</span><span class="tok-p">.</span><span class="tok-nx">incremento</span><span class="tok-p">;</span>

      <span class="tok-nx">id</span> <span class="tok-o">=</span> <span class="tok-nx">id</span> <span class="tok-o">+</span> <span class="tok-nx">miIncremento</span><span class="tok-p">;</span>
      <span class="tok-nx">console</span><span class="tok-p">.</span><span class="tok-nx">log</span><span class="tok-p">(</span><span class="tok-nx">id</span><span class="tok-p">);</span>
      <span class="tok-k">return</span> <span class="tok-k">this</span><span class="tok-p">;</span>  <i class="conum" data-value="1"></i><b>(1)</b>
    <span class="tok-p">},</span>

    <span class="tok-nx">anterior</span><span class="tok-o">:</span> <span class="tok-kd">function</span><span class="tok-p">()</span> <span class="tok-p">{</span>  <i class="conum" data-value="2"></i><b>(2)</b>
      <span class="tok-kd">var</span> <span class="tok-nx">misArgs</span> <span class="tok-o">=</span> <span class="tok-nx">arguments</span><span class="tok-p">[</span><span class="tok-mi">0</span><span class="tok-p">]</span> <span class="tok-o">||</span> <span class="tok-s1">&#39;&#39;</span><span class="tok-p">;</span>
      <span class="tok-kd">var</span> <span class="tok-nx">miDecremento</span> <span class="tok-o">=</span> <span class="tok-nx">misArgs</span><span class="tok-p">.</span><span class="tok-nx">decremento</span> <span class="tok-o">||</span> <span class="tok-nx">CONF</span><span class="tok-p">.</span><span class="tok-nx">decremento</span><span class="tok-p">;</span>

      <span class="tok-nx">id</span> <span class="tok-o">=</span> <span class="tok-nx">id</span> <span class="tok-o">-</span> <span class="tok-nx">miDecremento</span><span class="tok-p">;</span>
      <span class="tok-nx">console</span><span class="tok-p">.</span><span class="tok-nx">log</span><span class="tok-p">(</span><span class="tok-nx">id</span><span class="tok-p">);</span>
      <span class="tok-k">return</span> <span class="tok-k">this</span><span class="tok-p">;</span>
    <span class="tok-p">},</span>

    <span class="tok-nx">reset</span><span class="tok-o">:</span> <span class="tok-kd">function</span><span class="tok-p">()</span> <span class="tok-p">{</span>
      <span class="tok-nx">id</span> <span class="tok-o">=</span> <span class="tok-mi">0</span><span class="tok-p">;</span>
    <span class="tok-p">},</span>
  <span class="tok-p">};</span>
<span class="tok-p">})();</span>

<span class="tok-nx">miApp</span><span class="tok-p">.</span><span class="tok-nx">siguiente</span><span class="tok-p">();</span>  <span class="tok-c1">// 1</span>
<span class="tok-nx">miApp</span><span class="tok-p">.</span><span class="tok-nx">siguiente</span><span class="tok-p">({</span><span class="tok-nx">incremento</span><span class="tok-o">:</span> <span class="tok-mi">5</span><span class="tok-p">});</span>  <span class="tok-c1">// 6</span>
<span class="tok-nx">miApp</span><span class="tok-p">.</span><span class="tok-nx">anterior</span><span class="tok-p">();</span>  <span class="tok-c1">// 5</span>
<span class="tok-nx">miApp</span><span class="tok-p">.</span><span class="tok-nx">reset</span><span class="tok-p">();</span>
<span class="tok-nx">miApp</span><span class="tok-p">.</span><span class="tok-nx">siguiente</span><span class="tok-p">().</span><span class="tok-nx">siguiente</span><span class="tok-p">().</span><span class="tok-nx">anterior</span><span class="tok-p">({</span><span class="tok-nx">decremento</span><span class="tok-o">:</span> <span class="tok-mi">3</span><span class="tok-p">});</span>  <span class="tok-c1">// 1 2 -1 </span> <i class="conum" data-value="3"></i><b>(3)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Devolvemos el módulo para poder encadenar el método</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Creamos un segundo método que también soporta <em>method chaining</em></td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Encadenamos una llamada con otra</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_espacio_de_nombres_dinámico">4.2.3. Espacio de nombres dinámico</h4>
<div class="paragraph">
<p>También conocido como inyección de espacio de nombres, al definir el <em>namespace</em> de esta manera el código es más flexible y facilita tener múltiples instancias independientes de un mismo módulo en <em>namespaces</em> separador.</p>
</div>
<div class="paragraph">
<p>Para ello, se emplea un <em>proxy</em> referenciado directamente dentro de la función envoltorio, con lo cual no necesitamos devolver un valor para asignarlo al espacio de nombres. Para ello, simplemente le pasamos el objeto <em>namespace</em> como argumento a la IIFE:</p>
</div>
<div class="listingblock">
<div class="title">Ejemplo de módulo mediante proxy como parámetro - <a href="https://jsbin.com/pireseg/edit?js,console" class="bare">https://jsbin.com/pireseg/edit?js,console</a></div>
<div class="content">
<pre class="pygments highlight"><code data-lang="javascript"><span class="tok-kd">var</span> <span class="tok-nx">miApp</span> <span class="tok-o">=</span> <span class="tok-p">{};</span>
<span class="tok-p">(</span><span class="tok-kd">function</span><span class="tok-p">(</span><span class="tok-nx">contexto</span><span class="tok-p">)</span> <span class="tok-p">{</span>
  <span class="tok-kd">var</span> <span class="tok-nx">id</span> <span class="tok-o">=</span> <span class="tok-mi">0</span><span class="tok-p">;</span>

  <span class="tok-nx">contexto</span><span class="tok-p">.</span><span class="tok-nx">siguiente</span> <span class="tok-o">=</span> <span class="tok-kd">function</span><span class="tok-p">()</span> <span class="tok-p">{</span>
    <span class="tok-nx">id</span><span class="tok-o">++</span><span class="tok-p">;</span>
    <span class="tok-nx">console</span><span class="tok-p">.</span><span class="tok-nx">log</span><span class="tok-p">(</span><span class="tok-nx">id</span><span class="tok-p">);</span>
    <span class="tok-k">return</span> <span class="tok-nx">id</span><span class="tok-p">;</span>
  <span class="tok-p">};</span>

  <span class="tok-nx">contexto</span><span class="tok-p">.</span><span class="tok-nx">reset</span> <span class="tok-o">=</span> <span class="tok-kd">function</span><span class="tok-p">()</span> <span class="tok-p">{</span>
    <span class="tok-nx">id</span> <span class="tok-o">=</span> <span class="tok-mi">0</span><span class="tok-p">;</span>
  <span class="tok-p">};</span>
<span class="tok-p">})(</span><span class="tok-nx">miApp</span><span class="tok-p">);</span>

<span class="tok-nx">miApp</span><span class="tok-p">.</span><span class="tok-nx">siguiente</span><span class="tok-p">();</span>  <span class="tok-c1">// 1</span>
<span class="tok-nx">miApp</span><span class="tok-p">.</span><span class="tok-nx">siguiente</span><span class="tok-p">();</span>  <span class="tok-c1">// 2</span>
<span class="tok-nx">miApp</span><span class="tok-p">.</span><span class="tok-nx">reset</span><span class="tok-p">();</span>
<span class="tok-nx">miApp</span><span class="tok-p">.</span><span class="tok-nx">siguiente</span><span class="tok-p">();</span>  <span class="tok-c1">// 1</span></code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
En el caso de querer que el módulo se asocie al objeto global, tendremos que pasarle como argumento a la IIFE <code>this</code>.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Otra manera es utilizar como <em>proxy</em> del <em>namespace</em> el objeto <code>this</code>, haciendo uso del método <code>apply</code>:</p>
</div>
<div class="listingblock">
<div class="title">Ejemplo de módulo mediante proxy con <code>this</code> - <a href="https://jsbin.com/fuyowi/edit?js,console" class="bare">https://jsbin.com/fuyowi/edit?js,console</a></div>
<div class="content">
<pre class="pygments highlight"><code data-lang="javascript"><span class="tok-kd">var</span> <span class="tok-nx">miApp</span> <span class="tok-o">=</span> <span class="tok-p">{};</span>
<span class="tok-p">(</span><span class="tok-kd">function</span><span class="tok-p">()</span> <span class="tok-p">{</span>
  <span class="tok-kd">var</span> <span class="tok-nx">id</span> <span class="tok-o">=</span> <span class="tok-mi">0</span><span class="tok-p">;</span>

  <span class="tok-k">this</span><span class="tok-p">.</span><span class="tok-nx">siguiente</span> <span class="tok-o">=</span> <span class="tok-kd">function</span><span class="tok-p">()</span> <span class="tok-p">{</span>
    <span class="tok-nx">id</span><span class="tok-o">++</span><span class="tok-p">;</span>
    <span class="tok-nx">console</span><span class="tok-p">.</span><span class="tok-nx">log</span><span class="tok-p">(</span><span class="tok-nx">id</span><span class="tok-p">);</span>
    <span class="tok-k">return</span> <span class="tok-nx">id</span><span class="tok-p">;</span>
  <span class="tok-p">};</span>

  <span class="tok-k">this</span><span class="tok-p">.</span><span class="tok-nx">reset</span> <span class="tok-o">=</span> <span class="tok-kd">function</span><span class="tok-p">()</span> <span class="tok-p">{</span>
    <span class="tok-nx">id</span> <span class="tok-o">=</span> <span class="tok-mi">0</span><span class="tok-p">;</span>
  <span class="tok-p">};</span>
<span class="tok-p">}).</span><span class="tok-nx">apply</span><span class="tok-p">(</span><span class="tok-nx">miApp</span><span class="tok-p">);</span>

<span class="tok-nx">miApp</span><span class="tok-p">.</span><span class="tok-nx">siguiente</span><span class="tok-p">();</span>  <span class="tok-c1">// 1</span>
<span class="tok-nx">miApp</span><span class="tok-p">.</span><span class="tok-nx">siguiente</span><span class="tok-p">();</span>  <span class="tok-c1">// 2</span>
<span class="tok-nx">miApp</span><span class="tok-p">.</span><span class="tok-nx">reset</span><span class="tok-p">();</span>
<span class="tok-nx">miApp</span><span class="tok-p">.</span><span class="tok-nx">siguiente</span><span class="tok-p">();</span>  <span class="tok-c1">// 1</span></code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="title">Consejos</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Evitar utilizar <em>namespaces</em> anidados, cuando más sencillos, mejor.</p>
</li>
<li>
<p>Aunque se pueda dividir en varios archivos <code>.js</code>, es conveniente asociar un único <em>namespace</em> a un único fichero (y si se llaman igual, mejor)</p>
</li>
</ol>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Más información y ejemplos en <a href="https://www.kenneth-truyers.net/2013/04/27/javascript-namespaces-and-modules/" class="bare">https://www.kenneth-truyers.net/2013/04/27/javascript-namespaces-and-modules/</a></p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_expresiones_regulares">4.3. Expresiones regulares</h3>
<div class="paragraph">
<p>JavaScript permite trabajar con expresiones regulares, las cuales son un modo de describir un patrón en una cadena de datos, y nos servirán para comprobar si un campo contiene un cierto número de dígitos, o si un email está bien formado.</p>
</div>
<div class="paragraph">
<p>Para crear una expresión regular, primero hemos de describir la expresión a crear, ya sea mediante un objeto <code>RegExp</code> o incluyéndola entre barras <code>/</code>. A continuación la hemos de asociar al elemento que queremos aplicarla.</p>
</div>
<div class="paragraph">
<p>Para trabar con expresiones regulares usaremos los métodos <code>test()</code> y <code>search()</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="javascript"><span class="tok-kd">var</span> <span class="tok-nx">exReBatman</span> <span class="tok-o">=</span> <span class="tok-sr">/Batman/</span><span class="tok-p">;</span>	<i class="conum" data-value="1"></i><b>(1)</b>
<span class="tok-kd">var</span> <span class="tok-nx">exReBatman2</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-nb">RegExp</span><span class="tok-p">(</span><span class="tok-s2">&quot;Batman&quot;</span><span class="tok-p">);</span>	<i class="conum" data-value="2"></i><b>(2)</b>

<span class="tok-kd">var</span> <span class="tok-nx">cadena</span> <span class="tok-o">=</span> <span class="tok-s2">&quot;¿Sabías que Batman es mejor que Joker, y el mejor amigo de Batman es Robin?&quot;</span><span class="tok-p">;</span>
<span class="tok-k">if</span> <span class="tok-p">(</span><span class="tok-nx">exReBatman</span><span class="tok-p">.</span><span class="tok-nx">test</span><span class="tok-p">(</span><span class="tok-nx">cadena</span><span class="tok-p">))</span> <span class="tok-p">{</span>	<i class="conum" data-value="3"></i><b>(3)</b>
  <span class="tok-nx">console</span><span class="tok-p">.</span><span class="tok-nx">log</span><span class="tok-p">(</span><span class="tok-s2">&quot;la cadena contiene a Batman&quot;</span><span class="tok-p">);</span>
  <span class="tok-kd">var</span> <span class="tok-nx">pos</span> <span class="tok-o">=</span> <span class="tok-nx">cadena</span><span class="tok-p">.</span><span class="tok-nx">search</span><span class="tok-p">(</span><span class="tok-nx">exReBatman</span><span class="tok-p">);</span>	<i class="conum" data-value="4"></i><b>(4)</b>
  <span class="tok-nx">console</span><span class="tok-p">.</span><span class="tok-nx">log</span><span class="tok-p">(</span><span class="tok-s2">&quot;en la posición &quot;</span> <span class="tok-o">+</span> <span class="tok-nx">pos</span><span class="tok-p">);</span>
<span class="tok-p">}</span></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Creamos una expresión regular para la cadena <code>Batman</code>. Se crean de forma similar a las cadenas pero en vez de <code>"</code> se usa <code>/</code></td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Otra manera de hacer lo mismo que en la linea anterior</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Mediante el método <code>test(cadena)</code> comprueba si la expresión regular se encuentra en la cadena</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Si nos interesa la posición donde se encuentra la expresión, mediante <code>cadena.search(regexp)</code> obtendremos <code>-1</code> si no la encuentra, o la posición comenzando por <code>0</code>.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Si en alguna expresión queremos incluir la barra <code>/</code> como parte de la misma, la tendremos que <em>escapar</em> mediante la barra invertida <code>\</code>, es decir, si quisiéramos crear una expresión que buscase barras haríamos esto: <code>/\//</code></p>
</div>
<div class="admonitionblock caution">
<table>
<tr>
<td class="icon">
<i class="fa icon-caution" title="Caution"></i>
</td>
<td class="content">
<div class="paragraph">
<p>La sintaxis de las expresiones regulares en JavaScript es muy similar a la original del <em>Bell Labs</em> con alguna reinterpretación y extensión de <em>Perl</em>. Las reglas de interpretación pueden ser muy complejas ya que interpretan los caracteres de algunas posiciones como operadores y en otras como literales. Y aunque crear patrones mediante expresiones regular es complicado, todavía lo es más leerlos y modificarlos. Por lo tanto, antes de modificar una expresión regular existente, debes estar seguro de tener el conocimiento y destreza adecuada.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="sect3">
<h4 id="_creando_un_patrón">4.3.1. Creando un patrón</h4>
<div class="paragraph">
<p>Para crear un patrón tenemos diferentes caracteres para fijar el número de ocurrencias y/o colocación del patrón.</p>
</div>
<div class="paragraph">
<p>Si nos centramos en los patrones para indicar un conjunto de caracteres tenemos:</p>
</div>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 1. Patrones de Conjunto de Caracteres</caption>
<colgroup>
<col style="width: 11%;">
<col style="width: 22%;">
<col style="width: 22%;">
<col style="width: 44%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-center valign-middle">Elemento</th>
<th class="tableblock halign-left valign-top">Uso</th>
<th class="tableblock halign-left valign-top">RegExp</th>
<th class="tableblock halign-left valign-top">Ejemplo</th>
</tr>
</thead>
<tbody>
<tr>
<th class="tableblock halign-center valign-middle"><p class="tableblock"><code>^</code></p></th>
<td class="tableblock halign-left valign-top"><p class="tableblock">Comienza por</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>/^Batman/</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Batman es el mejor</p></td>
</tr>
<tr>
<th class="tableblock halign-center valign-middle"><p class="tableblock"><code>$</code></p></th>
<td class="tableblock halign-left valign-top"><p class="tableblock">Acaba por</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>/Batman$/</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">El mejor es Batman</p></td>
</tr>
<tr>
<th class="tableblock halign-center valign-middle"><p class="tableblock"><code>[abc]</code></p></th>
<td class="tableblock halign-left valign-top"><p class="tableblock">dentro del rango (<em>a</em>, <em>b</em> o <em>c</em>)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>/B[aei]tman/</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Batman, Betman, Bitman</p></td>
</tr>
<tr>
<th class="tableblock halign-center valign-middle"><p class="tableblock"><code>[^abc]</code></p></th>
<td class="tableblock halign-left valign-top"><p class="tableblock">fuera del rango</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>/B[^aei]tman/</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Botman, Bbtman, &#8230;&#8203;</p></td>
</tr>
<tr>
<th class="tableblock halign-center valign-middle"><p class="tableblock"><code>[a-z]</code></p></th>
<td class="tableblock halign-left valign-top"><p class="tableblock">entre un rango (de <em>a</em> a <em>z</em>)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>/B[a-e]tman/</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Batman, Bbtman, Bctman, &#8230;&#8203; Betman</p></td>
</tr>
<tr>
<th class="tableblock halign-center valign-middle"><p class="tableblock"><code>.</code></p></th>
<td class="tableblock halign-left valign-top"><p class="tableblock">cualquier caracter</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>/B.tman/</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Batman, Bbtman, B-tman, B(tman, &#8230;&#8203;</p></td>
</tr>
<tr>
<th class="tableblock halign-center valign-middle"><p class="tableblock"><code>\d</code></p></th>
<td class="tableblock halign-left valign-top"><p class="tableblock">dígito</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>/B\dtman/</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">B1tman, B2tman, &#8230;&#8203;</p></td>
</tr>
<tr>
<th class="tableblock halign-center valign-middle"><p class="tableblock"><code>\w</code></p></th>
<td class="tableblock halign-left valign-top"><p class="tableblock">alfanumérico o <code>_</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>/B\wtman/</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Batman, B_tman, B1tman, &#8230;&#8203;</p></td>
</tr>
<tr>
<th class="tableblock halign-center valign-middle"><p class="tableblock"><code>\s</code></p></th>
<td class="tableblock halign-left valign-top"><p class="tableblock">espacio (tab, nueva línea)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>/Batman\s/</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Batman ,</p></td>
</tr>
<tr>
<th class="tableblock halign-center valign-middle"><p class="tableblock"><code>\b</code></p></th>
<td class="tableblock halign-left valign-top"><p class="tableblock">límite de palabra</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>/\bBatman/</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Batman con espacio delante o tras un salto de línea</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Con estos conjuntos podemos crear las siguientes expresiones regulares que serán verdaderas:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="javascript"><span class="tok-sr">/[0123456789]/</span><span class="tok-p">.</span><span class="tok-nx">test</span><span class="tok-p">(</span><span class="tok-s2">&quot;en 2015&quot;</span><span class="tok-p">);</span>
<span class="tok-sr">/[0-9]/</span><span class="tok-p">.</span><span class="tok-nx">test</span><span class="tok-p">(</span><span class="tok-s2">&quot;en 2015&quot;</span><span class="tok-p">);</span>
<span class="tok-sr">/\d\d-\d\d-\d\d\d\d/</span><span class="tok-p">.</span><span class="tok-nx">test</span><span class="tok-p">(</span><span class="tok-s2">&quot;31-01-2015&quot;</span><span class="tok-p">);</span>
<span class="tok-sr">/[01]/</span><span class="tok-p">.</span><span class="tok-nx">test</span><span class="tok-p">(</span><span class="tok-s2">&quot;111101111&quot;</span><span class="tok-p">);</span>
<span class="tok-sr">/[^01]/</span><span class="tok-p">.</span><span class="tok-nx">test</span><span class="tok-p">(</span><span class="tok-s2">&quot;2015&quot;</span><span class="tok-p">);</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Los patrones se suelen repetir y en ocasiones necesitamos indicar un patron en base a un número de ocurrencias de un determinado patrón. Para ello, tenemos los siguientes patrones:</p>
</div>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 2. Patrones de Repetición</caption>
<colgroup>
<col style="width: 11%;">
<col style="width: 22%;">
<col style="width: 22%;">
<col style="width: 44%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-center valign-middle">Elemento</th>
<th class="tableblock halign-left valign-top">Uso</th>
<th class="tableblock halign-left valign-top">RegExp</th>
<th class="tableblock halign-left valign-top">Ejemplo</th>
</tr>
</thead>
<tbody>
<tr>
<th class="tableblock halign-center valign-middle"><p class="tableblock"><code>a?</code></p></th>
<td class="tableblock halign-left valign-top"><p class="tableblock">cero o uno de <em>a</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>/Ba?tman/</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Btman, Batman</p></td>
</tr>
<tr>
<th class="tableblock halign-center valign-middle"><p class="tableblock"><code>a*</code></p></th>
<td class="tableblock halign-left valign-top"><p class="tableblock">cero o más	de <em>a</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>/Ba*tman/</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Btman, Batman, Baatman, &#8230;&#8203;</p></td>
</tr>
<tr>
<th class="tableblock halign-center valign-middle"><p class="tableblock"><code>a+</code></p></th>
<td class="tableblock halign-left valign-top"><p class="tableblock">uno o más de <em>a</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>/Ba+tman/</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Batman, Baatman, Baaatman, &#8230;&#8203;</p></td>
</tr>
<tr>
<th class="tableblock halign-center valign-middle"><p class="tableblock"><code>a{num}</code></p></th>
<td class="tableblock halign-left valign-top"><p class="tableblock">exactamente <em>num</em> unidades de <em>a</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>/Ba{3}tman/</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Baaatman</p></td>
</tr>
<tr>
<th class="tableblock halign-center valign-middle"><p class="tableblock"><code>a{num,}</code></p></th>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>num</em> o más unidades de <em>a</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>/Ba{3,}tman/</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Baaatman, Baaaaatman, &#8230;&#8203;</p></td>
</tr>
<tr>
<th class="tableblock halign-center valign-middle"><p class="tableblock"><code>a{,num}</code></p></th>
<td class="tableblock halign-left valign-top"><p class="tableblock">hasta <em>num</em> unidades de <em>a</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>/Ba{,3}tman/</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Batman, Baatman, Baaatman</p></td>
</tr>
<tr>
<th class="tableblock halign-center valign-middle"><p class="tableblock"><code>a{num1,num2}</code></p></th>
<td class="tableblock halign-left valign-top"><p class="tableblock">de <em>num1</em> a <em>num2</em> unidades de <em>a</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>/Ba{2,4}tman/</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Baatman, Baaatman, Baaaatman</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Con estos conjuntos podemos crear las siguientes expresiones regulares que serán verdaderas:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="javascript"><span class="tok-sr">/\d+/</span><span class="tok-p">.</span><span class="tok-nx">test</span><span class="tok-p">(</span><span class="tok-s2">&quot;2015&quot;</span><span class="tok-p">);</span> <span class="tok-c1">// falso para &quot;&quot;</span>
<span class="tok-sr">/\d*/</span><span class="tok-p">.</span><span class="tok-nx">test</span><span class="tok-p">(</span><span class="tok-s2">&quot;2015&quot;</span><span class="tok-p">);</span>
<span class="tok-sr">/\d*/</span><span class="tok-p">.</span><span class="tok-nx">test</span><span class="tok-p">(</span><span class="tok-s2">&quot;&quot;</span><span class="tok-p">);</span>
<span class="tok-sr">/selfie?/</span><span class="tok-p">.</span><span class="tok-nx">test</span><span class="tok-p">(</span><span class="tok-s2">&quot;selfie&quot;</span><span class="tok-p">);</span>
<span class="tok-sr">/selfie?/</span><span class="tok-p">.</span><span class="tok-nx">test</span><span class="tok-p">(</span><span class="tok-s2">&quot;selfi&quot;</span><span class="tok-p">);</span>
<span class="tok-sr">/\d{1,2}-\d{1,2}-\d{4}/</span><span class="tok-p">.</span><span class="tok-nx">test</span><span class="tok-p">(</span><span class="tok-s2">&quot;31-01-2015&quot;</span><span class="tok-p">);</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Para agrupar expresiones se utilizan los paréntesis <code>()</code>. De este modo podemos utilizar un patrón de repetición sobre una expresión:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="javascript"><span class="tok-kd">var</span> <span class="tok-nx">bebeLlorando</span> <span class="tok-o">=</span> <span class="tok-sr">/buu+(juu+)+/</span><span class="tok-p">;</span> <i class="conum" data-value="1"></i><b>(1)</b>
<span class="tok-nx">bebeLlorando</span><span class="tok-p">.</span><span class="tok-nx">test</span><span class="tok-p">(</span><span class="tok-s2">&quot;buujuuuujuujuuu&quot;</span><span class="tok-p">);</span></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>El primer y el segundo <code>+</code> se aplican a la segunda <code>u</code> de <code>buu</code> y <code>juu</code> respectivamente. El tercero se aplica al grupo <code>juu+</code>, permitiendo una o más secuencias.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Finalmente, si lo que queremos es saber si un fragmento de texto contiene un patrón entre un conjunto de posibles patrones, hemos de utilizar el caracter <code>|</code>, el cual denota una elección entre el patrón de su izquierda y el de su derecha.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="javascript"><span class="tok-kd">var</span> <span class="tok-nx">periodoTemporal</span> <span class="tok-o">=</span> <span class="tok-sr">/\b\d+ ((dia|semana|año)s?|mes(es)?)\b/</span><span class="tok-p">;</span>
<span class="tok-nx">console</span><span class="tok-p">.</span><span class="tok-nx">log</span><span class="tok-p">(</span><span class="tok-s2">&quot;periodoTemporal&quot;</span><span class="tok-p">.</span><span class="tok-nx">test</span><span class="tok-p">(</span><span class="tok-s2">&quot;3 semanas&quot;</span><span class="tok-p">));</span>
<span class="tok-nx">console</span><span class="tok-p">.</span><span class="tok-nx">log</span><span class="tok-p">(</span><span class="tok-s2">&quot;periodoTemporal&quot;</span><span class="tok-p">.</span><span class="tok-nx">test</span><span class="tok-p">(</span><span class="tok-s2">&quot;43 meses&quot;</span><span class="tok-p">));</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>A partir de estos elementos se pueden crear patrones muy complejos:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="javascript"><span class="tok-kd">var</span> <span class="tok-nx">patronDNI</span> <span class="tok-o">=</span> <span class="tok-sr">/[0-9]{8}([-]?)[A-Za-z]/</span><span class="tok-p">;</span>
<span class="tok-kd">var</span> <span class="tok-nx">patronFecha</span> <span class="tok-o">=</span> <span class="tok-sr">/(0[1-9]|[12][0-9]|3[01])[- /.](0[1-9]|1[012])[- /.](19|20)\d\d/</span><span class="tok-p">;</span>
<span class="tok-kd">var</span> <span class="tok-nx">patronEmail</span> <span class="tok-o">=</span> <span class="tok-sr">/[-0-9a-zA-Z.+_]+@[-0-9a-zA-Z.+_]+\.[a-zA-Z]{2,4}/</span><span class="tok-p">;</span>
<span class="tok-kd">var</span> <span class="tok-nx">patronURL</span> <span class="tok-o">=</span> <span class="tok-sr">/^(?:([A-Za-z]+):)?(\/{0,3})([0-9.\-A-Za-z]+)(?::(\d+))?(?:\/([^?#]*))?(?:\?([^#]*))?(?:#(.*))?$/</span><span class="tok-p">;</span>
<span class="tok-kd">var</span> <span class="tok-nx">url</span> <span class="tok-o">=</span> <span class="tok-s2">&quot;http://server.jtech.com:8080/apuntes-js?regexp#ejemplos&quot;</span><span class="tok-p">;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Las expresiones regulares en JavaScript son difíciles de leer en gran parte porque no permiten ni comentarios ni espacios en blanco. Lo bueno es que la mayoría de expresiones regulares que necesitaremos en el día a día ya están creadas, sólo hay que buscar en Internet.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
Una herramienta muy útil es <a href="http://www.regexper.com/" class="bare">http://www.regexper.com/</a>, que nos permite obtener una representación visual de cualquier expresión regular
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_flags">4.3.2. Flags</h4>
<div class="paragraph">
<p>Las expresiones regulares permiten las siguientes opciones que se incluyen tras cerrar la expresión y que modifican las restricciones que se aplican para encontrar las ocurrencias:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>g</code>: emparejamiento global, con lo que realiza la búsqueda en la cadena completa, en vez de pararse en la primera ocurrencia</p>
</li>
<li>
<p><code>i</code>: ignora las mayúsculas, con lo cual la expresión deja de ser sensible las mayúsculas</p>
</li>
<li>
<p><code>m</code>: múltiples líneas, de modo que aplica los caracteres de inicio y fin de linea (<code>^</code> y <code>$</code> respectivamente) a cada línea de una cadena que contiene varias lineas.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Por ejemplo:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="javascript"><span class="tok-kd">var</span> <span class="tok-nx">casaCASA</span> <span class="tok-o">=</span> <span class="tok-sr">/casa/i</span><span class="tok-p">;</span></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_ocurrencias">4.3.3. Ocurrencias</h4>
<div class="paragraph">
<p>Además del método <code>test()</code>, podemos utilizar el método <code>exec()</code> el cual devolverá un objeto con información de las ocurrencias encontradas o <code>null</code> en caso contrario.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="javascript"><span class="tok-kd">var</span> <span class="tok-nx">ocurrencia</span> <span class="tok-o">=</span> <span class="tok-sr">/\d+/</span><span class="tok-p">.</span><span class="tok-nx">exec</span><span class="tok-p">(</span><span class="tok-s2">&quot;uno dos 100&quot;</span><span class="tok-p">);</span>
<span class="tok-nx">console</span><span class="tok-p">.</span><span class="tok-nx">log</span><span class="tok-p">(</span><span class="tok-nx">ocurrencia</span><span class="tok-p">);</span> <span class="tok-c1">// [&quot;100&quot;]</span>
<span class="tok-nx">console</span><span class="tok-p">.</span><span class="tok-nx">log</span><span class="tok-p">(</span><span class="tok-nx">ocurrencia</span><span class="tok-p">.</span><span class="tok-nx">index</span><span class="tok-p">);</span> <span class="tok-c1">// 8</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>El objeto devuelto por <code>exec</code> tiene una propiedad <code>index</code> con la posiciones dentro de la cadena donde se encuentra la ocurrencia. Además, el objeto en sí es un array de cadenas, cuyo primer elemento es la ocurrencia encontrada.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="title"><code>String.match(regexp)</code></div>
<div class="paragraph">
<p>Las cadenas también tienen un método <code>match</code> que se comporta del mismo modo:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="javascript"><span class="tok-nx">console</span><span class="tok-p">.</span><span class="tok-nx">log</span><span class="tok-p">(</span><span class="tok-s2">&quot;uno dos 100&quot;</span><span class="tok-p">.</span><span class="tok-nx">match</span><span class="tok-p">(</span><span class="tok-sr">/\d+/</span><span class="tok-p">));</span></code></pre>
</div>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Cuando una expresión regular contiene subexpresiones agrupadas mediante paréntesis, la ocurrencia que cumple esos grupos aparecerá en el array. La ocurrencia completa siempre es el primer elemento. El siguiente elemento es la parte que cumple el primer grupo (aquel cuyo paréntesis de apertura venga primero), después el segundo grupo, etc..</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="javascript"><span class="tok-kd">var</span> <span class="tok-nx">patronDNI</span> <span class="tok-o">=</span> <span class="tok-sr">/([0-9]{8})([-]?)([A-Za-z])/</span><span class="tok-p">;</span>
<span class="tok-kd">var</span> <span class="tok-nx">ocurrencia</span> <span class="tok-o">=</span> <span class="tok-nx">patronDNI</span><span class="tok-p">.</span><span class="tok-nx">exec</span><span class="tok-p">(</span><span class="tok-s2">&quot;12345678A&quot;</span><span class="tok-p">);</span> <span class="tok-c1">// [&quot;12345678A&quot;, &quot;12345678&quot;, &quot;&quot;, &quot;A&quot;]</span>
<span class="tok-kd">var</span> <span class="tok-nx">numero</span> <span class="tok-o">=</span> <span class="tok-nx">ocurrencia</span><span class="tok-p">[</span><span class="tok-mi">1</span><span class="tok-p">];</span>
<span class="tok-kd">var</span> <span class="tok-nx">letra</span> <span class="tok-o">=</span> <span class="tok-nx">ocurrencia</span><span class="tok-p">[</span><span class="tok-mi">3</span><span class="tok-p">];</span>

<span class="tok-kd">var</span> <span class="tok-nx">txtEntreComillasSimples</span> <span class="tok-o">=</span> <span class="tok-sr">/&#39;([^&#39;]*)&#39;/</span><span class="tok-p">;</span>
<span class="tok-nx">console</span><span class="tok-p">.</span><span class="tok-nx">log</span><span class="tok-p">(</span><span class="tok-nx">txtEntreComillasSimples</span><span class="tok-p">.</span><span class="tok-nx">exec</span><span class="tok-p">(</span><span class="tok-s2">&quot;Yo soy &#39;Batman&#39;&quot;</span><span class="tok-p">));</span> <span class="tok-c1">// [&quot;&#39;Batman&#39;&quot;,&quot;Batman&quot;]</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Cuando un grupo se cumple en múltiples ocasiones, sólo la última ocurrencia se añade al array:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="javascript"><span class="tok-nx">console</span><span class="tok-p">.</span><span class="tok-nx">log</span><span class="tok-p">(</span><span class="tok-sr">/(\d)+/</span><span class="tok-p">.</span><span class="tok-nx">exec</span><span class="tok-p">(</span><span class="tok-s2">&quot;2015&quot;</span><span class="tok-p">));</span>  <span class="tok-c1">// [&quot;2015&quot;,&quot;5&quot;];</span></code></pre>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="title">Trabajando con Fechas</div>
<div class="paragraph">
<p>Mediante expresiones regulares podemos parsear una cadena que contiene una fecha y construir un objeto <code>Date</code> del siguiente modo:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="javascript"><span class="tok-kd">var</span> <span class="tok-nx">regExFecha</span> <span class="tok-o">=</span> <span class="tok-sr">/(\d{1,2})-(\d{1,2})-(\d{4})/</span><span class="tok-p">;</span>
<span class="tok-kd">var</span> <span class="tok-nx">ocurrencia</span> <span class="tok-o">=</span> <span class="tok-nx">regExFecha</span><span class="tok-p">.</span><span class="tok-nx">exec</span><span class="tok-p">(</span><span class="tok-s2">&quot;31-01-2015&quot;</span><span class="tok-p">);</span>
<span class="tok-kd">var</span> <span class="tok-nx">hoy</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-nb">Date</span><span class="tok-p">(</span><span class="tok-nx">ocurrencia</span><span class="tok-p">[</span><span class="tok-mi">3</span><span class="tok-p">],</span><span class="tok-nx">ocurrencia</span><span class="tok-p">[</span><span class="tok-mi">2</span><span class="tok-p">]</span><span class="tok-o">-</span><span class="tok-mi">1</span><span class="tok-p">,</span><span class="tok-nx">ocurrencia</span><span class="tok-p">[</span><span class="tok-mi">1</span><span class="tok-p">]);</span></code></pre>
</div>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_sustituyendo">4.3.4. Sustituyendo</h4>
<div class="paragraph">
<p>Ya vimos en la primera sesión que podemos utilizar el método <code>replace</code> con una cadena para sustituir una parte por otra:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="javascript"><span class="tok-nx">console</span><span class="tok-p">.</span><span class="tok-nx">log</span><span class="tok-p">(</span><span class="tok-s2">&quot;papa&quot;</span><span class="tok-p">.</span><span class="tok-nx">replace</span><span class="tok-p">(</span><span class="tok-s2">&quot;p&quot;</span><span class="tok-p">,</span><span class="tok-s2">&quot;m&quot;</span><span class="tok-p">));</span> <span class="tok-c1">// &quot;mapa&quot;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>El primer parámetro también puede ser una expresión regular, de modo que la primera ocurrencia de la expresión regular se reemplazará. Si a la expresión le añadimos la opción <code>g</code> (de *g*lobal), se sustituirán todas las ocurrencias, no sólo la primera:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="javascript"><span class="tok-nx">console</span><span class="tok-p">.</span><span class="tok-nx">log</span><span class="tok-p">(</span><span class="tok-s2">&quot;papa&quot;</span><span class="tok-p">.</span><span class="tok-nx">replace</span><span class="tok-p">(</span><span class="tok-sr">/p/g</span><span class="tok-p">,</span><span class="tok-s2">&quot;m&quot;</span><span class="tok-p">));</span> <span class="tok-c1">// &quot;mama&quot;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>La gran ventaja de utilizar expresiones regulares para sustituir texto es que podemos volver a las ocurrencias y trabajar con ellas. Supongamos que tenemos un listado de personas ordenado mediante <em>"Apellido, Nombre"</em>, y queremos cambiarlo para poner delante el nombre y quitar la coma:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="javascript"><span class="tok-kd">var</span> <span class="tok-nx">personas</span> <span class="tok-o">=</span> <span class="tok-s2">&quot;Medrano, Aitor\nGallardo, Domingo\nSuch, Alejandro&quot;</span><span class="tok-p">;</span>
<span class="tok-nx">console</span><span class="tok-p">.</span><span class="tok-nx">log</span><span class="tok-p">(</span><span class="tok-nx">personas</span><span class="tok-p">.</span><span class="tok-nx">replace</span><span class="tok-p">(</span><span class="tok-sr">/([\w]+), ([\w]+)/g</span><span class="tok-p">,</span> <span class="tok-s2">&quot;$2 $1&quot;</span><span class="tok-p">));</span> <i class="conum" data-value="1"></i><b>(1)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Los elementos <code>$1</code> y <code>$2</code> referencian a los grupos de paréntesis del patrón.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Hemos visto que en la cadena de sustitución hemos utilizado  <code>$n</code> para referenciar al bloque <em>n</em> de la expresión regular. De este modo, <code>$1</code> referencia al primer patrón, <code>$2</code> para el segundo, &#8230;&#8203; hasta <code>$9</code>. La ocurrencia completa se referencia mediante <code>$&amp;</code>.</p>
</div>
<div class="paragraph">
<p>También podemos pasar una función en vez de una cadena de sustitución, la cual se llamará para todas las ocurrencias (y para la ocurrencia completa también).</p>
</div>
<div class="paragraph">
<p>Por ejemplo:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="javascript"><span class="tok-kd">var</span> <span class="tok-nx">cadena</span> <span class="tok-o">=</span> <span class="tok-s2">&quot;Los mejores lenguajes son Java y JavaScript&quot;</span><span class="tok-p">;</span>
<span class="tok-nx">console</span><span class="tok-p">.</span><span class="tok-nx">log</span><span class="tok-p">(</span><span class="tok-nx">cadena</span><span class="tok-p">.</span><span class="tok-nx">replace</span><span class="tok-p">(</span><span class="tok-sr">/\b(java|javascript)\b/ig</span><span class="tok-p">,</span> <span class="tok-kd">function</span><span class="tok-p">(</span><span class="tok-nx">str</span><span class="tok-p">)</span> <span class="tok-p">{</span>
  <span class="tok-k">return</span> <span class="tok-nx">str</span><span class="tok-p">.</span><span class="tok-nx">toUpperCase</span><span class="tok-p">();</span>
<span class="tok-p">}))</span></code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_librerías_en_javascript">4.4. Librerías en JavaScript</h3>
<div class="paragraph">
<p>Existen multitud de librerías y frameworks en JavaScript. Algunas realizan tareas específicas mientras que otras son más genéricas. Respecto a las de propósito general las más conocidas son:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><em>jQuery</em> (<a href="http://jquery.com" class="bare">http://jquery.com</a>): Estándar de facto dentro del mundo JS. La estudiaremos en detalle en posteriores sesiones.</p>
</li>
<li>
<p><em>Prototype</em> (<a href="http://www.prototypejs.org/" class="bare">http://www.prototypejs.org/</a>) fue una de las primeras librerías JavaScript. Normalmente se usaba de manera conjunta a la librería de efectos visuales <em>scriptaculous</em> (<a href="http://script.aculo.us/" class="bare">http://script.aculo.us/</a>), la cual añade animaciones y controles de interfaz de usuario.</p>
</li>
<li>
<p><em>Mootools</em> (<a href="http://mootools.net/" class="bare">http://mootools.net/</a>): Framework completo que requiere un nivel medio-avanzado de JavaScript con buena documentación, y menos orientada al DOM que otras librerías, pero con soporte de herencia.</p>
</li>
<li>
<p><em>Yahoo User Interface Library</em> (YUI) (<a href="http://developer.yahoo.com/yui/" class="bare">http://developer.yahoo.com/yui/</a>): librería que nace como un proyecto de Yahoo y es la que usa en los proyectos internos. En Agosto de 2014, el equipo de ingenieros han anunciado que van a reducir el apoyo a la librería.</p>
</li>
<li>
<p><em>Dojo Toolkit</em> (<a href="http://dojotoolkit.org/" class="bare">http://dojotoolkit.org/</a>): Muy completa con una gran colección de ficheros JS que resuelven cualquier tarea. Se trata de una librería con un núcleo muy ligero (4KB)</p>
</li>
<li>
<p><em>Closure Library</em> (<a href="http://developers.google.com/closure/library" class="bare">http://developers.google.com/closure/library</a>) es la librería que usa Google para sus aplicaciones web, es decir, GMail, Google Maps, Calendar, etc&#8230;&#8203;</p>
</li>
<li>
<p><em>Underscore</em> (<a href="http://underscorejs.org" class="bare">http://underscorejs.org</a>) librería que agrupa múltiples funciones de manipulación de objetos, funciones y colecciones, que completan a aquellos navegadores que no implementan HTML5.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>El siguiente gráfico muestra el grado de implantación de las librerías, tanto a nivel global como entre las páginas que utilizan <em>JavaScript</em>:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/js04/w3techLibrerias.jpg" alt="Liberías - w3tech" width="50%">
</div>
<div class="title">Figure 16. Librerías - w3tech</div>
</div>
<div class="paragraph">
<p>Si cruzamos esos datos con el tráfico de los sites que utilizan las librerías tenemos la posición de mercado:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/js04/w3techMarketPosition.png" alt="Posición de Mercado - w3tech" width="66%">
</div>
<div class="title">Figure 17. Posición de Mercado - w3tech</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
Podemos consultar más datos estadísticos con actualización diaria en <a href="http://w3techs.com/technologies/overview/javascript_library/all" class="bare">http://w3techs.com/technologies/overview/javascript_library/all</a>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Otras librerías más específicas son:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><em>Bootstrap</em> (<a href="http://getbootstrap.com" class="bare">http://getbootstrap.com</a>): generador de websites adaptables (<em>responsive</em>)</p>
</li>
<li>
<p><em>Handlebars</em> (<a href="http://handlebarsjs.com/" class="bare">http://handlebarsjs.com/</a>) o <em>Mustache.js</em> (<a href="https://github.com/janl/mustache.js" class="bare">https://github.com/janl/mustache.js</a>): uso de plantillas</p>
</li>
<li>
<p><em>YepNope</em> (<a href="http://yepnopejs.com" class="bare">http://yepnopejs.com</a>): carga condicional de scripts</p>
</li>
<li>
<p><em>Lightbox</em> (<a href="http://lokeshdhakar.com/projects/lightbox2/" class="bare">http://lokeshdhakar.com/projects/lightbox2/</a>) : carrusel de fotos</p>
</li>
<li>
<p><em>ShadowBox</em> (<a href="http://www.shadowbox-js.com" class="bare">http://www.shadowbox-js.com</a>): permite mostrar contenido multimedia en ventanas emergentes, ya sean fotos, vídeos o archivos flash.</p>
</li>
<li>
<p><em>Parsley</em> (<a href="http://parsleyjs.org" class="bare">http://parsleyjs.org</a>): para validaciones de formularios</p>
</li>
<li>
<p><em>Datejs</em> (<a href="http://www.datejs.com" class="bare">http://www.datejs.com</a>) o <em>Moment.js</em>: gestión de fechas con lenguaje natural</p>
</li>
</ul>
</div>
<div class="sect3">
<h4 id="_inclusión_de_librerías">4.4.1. Inclusión de librerías</h4>
<div class="paragraph">
<p>Para incluir una librería, tal como vimos en <a href="#_uso_en_el_navegador">Uso en el navegador</a>, usaremos la etiqueta <code>&lt;script&gt;</code> para referenciar una archivo externo con el código de la librería.</p>
</div>
<div class="paragraph">
<p>Cuando incluimos varias librerías, el orden es importante. Las librerías que dependen de otras deben incluirse después. Por ejemplo, si tenemos una librería que hace uso de <em>jQuery</em>, las librerías dependientes deben colocarse a continuación:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="html">...
  <span class="tok-nt">&lt;script </span><span class="tok-na">src=</span><span class="tok-s">&quot;jquery.js&quot;</span> <span class="tok-nt">/&gt;</span>
  <span class="tok-nt">&lt;script </span><span class="tok-na">src=</span><span class="tok-s">&quot;libQueUsaJQuery.js&quot;</span> <span class="tok-nt">/&gt;</span>
<span class="tok-nt">&lt;/body&gt;</span></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_cdn">4.4.2. CDN</h4>
<div class="paragraph">
<p>Cuando trabajamos con librerías de terceros es muy útil y eficiente trabajan con librerías hospedas en Internet mediante CDNs (<em>Content Delivery Network</em> / Red de entrega de contenidos). Estos servidores guardan copias de las librerías de manera transparente al desarrollador y redirigen la petición al servidor más cercano.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/js04/CDN.png" alt="Ejemplo CDN" width="66%">
</div>
<div class="title">Figure 18. Ejemplo CDN</div>
</div>
<div class="paragraph">
<p>Por ejemplo, Google ofrece enlaces a la gran mayoría de librerías existentes en <a href="https://developers.google.com/speed/libraries/" class="bare">https://developers.google.com/speed/libraries/</a> o <a href="http://code.google.com/apis/libraries" class="bare">http://code.google.com/apis/libraries</a> o buscar Google CDN</p>
</div>
<div class="paragraph">
<p>Así pues, para incluir una librería mediante CDN haríamos:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="html">  ...
  <span class="tok-nt">&lt;script </span><span class="tok-na">src=</span><span class="tok-s">&quot;http://ajax.googleapis.com/ajax/libs/jquery/1.6.1/jquery.min.js&quot;</span><span class="tok-nt">&gt;&lt;/script&gt;</span>
<span class="tok-nt">&lt;/body&gt;</span>
<span class="tok-nt">&lt;/html&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>La gran ventaja es que al usarse por múltiples desarrolladores, lo más seguro que el navegador ya la tenga cacheada, y si no, que se encuentre hospedado en un servidor más cercano que el <em>hosting</em> de nuestra aplicación.</p>
</div>
<div class="paragraph">
<p>Si falla el CDN, y queremos hacer una carga de otro servidor CDN o de la copia de nuestro servidor, podemos hacerlo de la siguiente manera:  <a href="http://www.etnassoft.com/2011/06/29/cargar-jquery-desde-un-cdn-o-desde-servidor/" class="bare">http://www.etnassoft.com/2011/06/29/cargar-jquery-desde-un-cdn-o-desde-servidor/</a> )</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_testing">4.5. Testing</h3>
<div class="paragraph">
<p>Todos sabemos que las pruebas son importantes, pero no le damos la importancia que merecen.</p>
</div>
<div class="paragraph">
<p>Al hacer una aplicación <em>testable</em> nos aseguramos que la cantidad de errores que haya en nuestra aplicación se reduzca, lo que también incrementa la mantenibilidad de la aplicación y promueve que el código esté bien estructurado.</p>
</div>
<div class="paragraph">
<p>Las pruebas de unidad en el lado del cliente presentan una problemática distinta a las del servidor. Al trabajar con código de cliente nos pelearemos muchas veces con la separación de la lógica de la aplicación respecto a la lógica DOM, así como la propia estructura del código JavaScript.</p>
</div>
<div class="paragraph">
<p>Ya vimos en la primera sesión que el <em>Console API</em> ofrece el método <code>console.assert(bool, mensaje)</code> para comprobar si se cumple una determinada condición booleana. Una aserción es una sentencia que predice el resultado del código con el valor esperado. Si la predicción no se cumple, la aserción falla, y de este modo sabemos que algo ha ido mal. Por ejemplo:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="javascript"><span class="tok-nx">console</span><span class="tok-p">.</span><span class="tok-nx">assert</span><span class="tok-p">(</span><span class="tok-mi">1</span> <span class="tok-o">==</span> <span class="tok-s2">&quot;1&quot;</span><span class="tok-p">,</span> <span class="tok-s2">&quot;Conversión de tipos&quot;</span><span class="tok-p">);</span>
<span class="tok-nx">console</span><span class="tok-p">.</span><span class="tok-nx">assert</span><span class="tok-p">(</span><span class="tok-mi">1</span> <span class="tok-o">===</span> <span class="tok-s2">&quot;1&quot;</span><span class="tok-p">,</span> <span class="tok-s2">&quot;Sin conversión de tipos&quot;</span><span class="tok-p">);</span> <span class="tok-c1">// Assertion failed: Sin conversión de tipos</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Mediante este tipo de aserciones podemos hacer pruebas sencillas pero sin automatizar, ya que requieren que el desarrollador comprueba la consola para analizar los mensajes visualizadas.</p>
</div>
<div class="paragraph">
<p>Por suerte, existen muchas librerías de pruebas que nos ayudan a probar nuestro código, crear métricas sobre la cobertura y analizar la complejidad del mismo.</p>
</div>
<div class="sect3">
<h4 id="_qunit">4.5.1. QUnit</h4>
<div class="paragraph">
<p>QUnit (<a href="http://qunitjs.com" class="bare">http://qunitjs.com</a>) es un framework de pruebas unitarias que facilita depurar el código. Desarrollado por miembros del equipo de <em>jQuery</em>, es el framework utilizado para probar <em>jQuery</em>. Esto no quiere decir que sea exclusivo de <em>jQuery</em>, sino que permite probar cualquier código JavaScript.</p>
</div>
<div class="paragraph">
<p>Antes de empezar a codificar las pruebas, necesitamos enlazar mediante un CDN a la librería o descargarla desde <a href="http://qunitjs.com" class="bare">http://qunitjs.com</a>. También necesitamos enlazar la hoja de estilo para formatear el resultado de las pruebas.</p>
</div>
<div class="sect4">
<h5 id="_lanzador_qunit">Lanzador QUnit</h5>
<div class="paragraph">
<p>Para escribir nuestra primera prueba necesitamos preparar el entorno con un documento que hace de lanzador:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="html"><span class="tok-cp">&lt;!DOCTYPE html&gt;</span>
<span class="tok-nt">&lt;html</span> <span class="tok-na">lang=</span><span class="tok-s">&quot;es&quot;</span><span class="tok-nt">&gt;</span>
<span class="tok-nt">&lt;head&gt;</span>
    <span class="tok-nt">&lt;title&gt;</span>QUnit Test Suite<span class="tok-nt">&lt;/title&gt;</span>
    <span class="tok-nt">&lt;meta</span> <span class="tok-na">charset=</span><span class="tok-s">&quot;utf-8&quot;</span> <span class="tok-nt">/&gt;</span>
    <span class="tok-nt">&lt;link</span> <span class="tok-na">rel=</span><span class="tok-s">&quot;stylesheet&quot;</span> <span class="tok-na">href=</span><span class="tok-s">&quot;//code.jquery.com/qunit/qunit-1.22.0.css&quot;</span> <span class="tok-na">type=</span><span class="tok-s">&quot;text/css&quot;</span> <span class="tok-na">media=</span><span class="tok-s">&quot;screen&quot;</span><span class="tok-nt">&gt;</span>
<span class="tok-nt">&lt;/head&gt;</span>
<span class="tok-nt">&lt;body&gt;</span>

<span class="tok-nt">&lt;div</span> <span class="tok-na">id=</span><span class="tok-s">&quot;qunit&quot;</span><span class="tok-nt">&gt;&lt;/div&gt;</span>  <i class="conum" data-value="1"></i><b>(1)</b>
<span class="tok-nt">&lt;div</span> <span class="tok-na">id=</span><span class="tok-s">&quot;qunit-fixture&quot;</span><span class="tok-nt">&gt;&lt;/div&gt;</span>  <i class="conum" data-value="2"></i><b>(2)</b>

<span class="tok-nt">&lt;script </span><span class="tok-na">type=</span><span class="tok-s">&quot;text/javascript&quot;</span> <span class="tok-na">src=</span><span class="tok-s">&quot;miProyecto.js&quot;</span><span class="tok-nt">&gt;&lt;/script&gt;</span>  <i class="conum" data-value="3"></i><b>(3)</b>
<span class="tok-nt">&lt;script </span><span class="tok-na">src=</span><span class="tok-s">&quot;//code.jquery.com/qunit/qunit-1.22.0.js&quot;</span><span class="tok-nt">&gt;&lt;/script&gt;</span>
<span class="tok-nt">&lt;script </span><span class="tok-na">src=</span><span class="tok-s">&quot;misPruebas.js&quot;</span><span class="tok-nt">&gt;&lt;/script&gt;</span> <i class="conum" data-value="4"></i><b>(4)</b>

<span class="tok-nt">&lt;/body&gt;</span>
<span class="tok-nt">&lt;/html&gt;</span></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>En esta capa se mostrarán los resultados de la prueba</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Aquí podemos colocar código que añade, modifica o elimina elementos del DOM. El código aquí colocado será <em>reseteado</em> con cada prueba.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>El código a probar lo colocaremos de manera similar a <code>miProyecto.js</code></td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>En <code>misPruebas.js</code> colocaremos el código de las pruebas. De este modo tendremos las pruebas desacopladas del código de aplicación.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>En este ejemplo hemos usado el CDN para referenciar a la librería y hoja de estilo necesarias. Para un entorno de desarrollo e integración continua es mejor descargarla y tener ambos archivos en local.</p>
</div>
<div class="paragraph">
<p>Si lanzamos el archivo sin código ni pruebas, al abrir el documento HTML veremos el interfaz que ofrece:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/js04/qunit.jpg" alt="Lanzando QUnit" width="66%">
</div>
<div class="title">Figure 19. Lanzando QUnit</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="title">Checkboxes de QUnit</div>
<div class="paragraph">
<p>La opción "<em>Hide passed tests</em>" permite ocultar las pruebas exitosas y mostrar sólo los fallos. Esto es realmente útil cuando tenemos un montón de pruebas y sólo unos pocos fallos.</p>
</div>
<div class="paragraph">
<p>Si marcamos "<em>Check for Globals</em>" <em>QUnit</em> crea una lista de todas las propiedades del objeto <code>window</code>, antes y después de cada caso de prueba y posteriormente comprueba las diferencias. Si se añaden o modifican propiedades el test fallará, mostrando las diferencias. De este modo podemos comprobar que ni nuestro código ni nuestras pruebas exportan accidentalmente alguna variable global.</p>
</div>
<div class="paragraph">
<p>El <em>checkbox</em> "<em>No try-catch</em>" provoca que <em>QUnit</em> ejecute la prueba fuera de un bloque <code>try-catch</code>. Si una prueba lanza una excepción, el hilo morirá, lo que no permite continuar pero relanza una excepción nativa, lo cual puede ser realmente útil en navegadores antiguos con escaso soporte para debug, como IE6.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Vamos a probar la siguiente función, que colocamos en <code>miProyecto.js</code>, la cual obtiene si un número es par:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="javascript"><span class="tok-kd">function</span> <span class="tok-nx">esPar</span><span class="tok-p">(</span><span class="tok-nx">num</span><span class="tok-p">)</span> <span class="tok-p">{</span>
  <span class="tok-k">return</span> <span class="tok-nx">num</span> <span class="tok-o">%</span> <span class="tok-mi">2</span> <span class="tok-o">===</span> <span class="tok-mi">0</span><span class="tok-p">;</span>
<span class="tok-p">}</span></code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_caso_de_prueba">Caso de prueba</h5>
<div class="paragraph">
<p>Como hemos comentado antes, vamos a colocar las pruebas de manera desacoplada del código, en el archivo <code>misPruebas.js</code>.</p>
</div>
<div class="paragraph">
<p>Todas las pruebas comienzan con la función <code>QUnit.test()</code> (o <code>QUnit.asyncTest()</code> si son asíncronas, las cuales veremos en la siguiente sesión).</p>
</div>
<div class="paragraph">
<p>Esta función recibe un parámetro con una cadena que sirve para identificar el caso de prueba, y una función que contiene las aserciones que el framework ejecutará. <em>QUnit</em> le pasa a esta función un argumento que expone todos los métodos de aserción de <em>QUnit</em>.</p>
</div>
<div class="paragraph">
<p>De modo, que nuestro código quedará así:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="javascript"><span class="tok-nx">QUnit</span><span class="tok-p">.</span><span class="tok-nx">test</span><span class="tok-p">(</span><span class="tok-s1">&#39;Hola QUnit&#39;</span><span class="tok-p">,</span> <span class="tok-kd">function</span><span class="tok-p">(</span><span class="tok-nx">assert</span><span class="tok-p">)</span> <span class="tok-p">{</span>
  <span class="tok-c1">// Aserciones con las pruebas</span>
<span class="tok-p">});</span></code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_aserciones">Aserciones</h5>
<div class="paragraph">
<p>El bloque principal de las pruebas son las <strong>aserciones</strong>. Las aserciones que ofrece <em>QUnit</em> son <code>ok</code>, <code>equal</code>, <code>notEqual</code>, <code>strictEqual</code>, <code>notStrictEqual</code>, <code>deepEqual</code>, <code>notDeepEqual</code> y <code>throws</code>.</p>
</div>
<div class="paragraph">
<p>Para ejecutar aserciones, hay que colocarlas dentro de un caso de prueba (el cual hemos colocado en <code>misPruebas.js</code>). El siguiente ejemplo demuestra el uso de la aserción booleana <code>ok</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="javascript"><span class="tok-nx">QUnit</span><span class="tok-p">.</span><span class="tok-nx">test</span><span class="tok-p">(</span><span class="tok-s1">&#39;esPar()&#39;</span><span class="tok-p">,</span> <span class="tok-kd">function</span><span class="tok-p">(</span><span class="tok-nx">assert</span><span class="tok-p">)</span> <span class="tok-p">{</span>  <i class="conum" data-value="1"></i><b>(1)</b>
  <span class="tok-nx">assert</span><span class="tok-p">.</span><span class="tok-nx">ok</span><span class="tok-p">(</span><span class="tok-nx">esPar</span><span class="tok-p">(</span><span class="tok-mi">0</span><span class="tok-p">),</span> <span class="tok-s1">&#39;Cero es par&#39;</span><span class="tok-p">);</span> <i class="conum" data-value="2"></i><b>(2)</b>
  <span class="tok-nx">assert</span><span class="tok-p">.</span><span class="tok-nx">ok</span><span class="tok-p">(</span><span class="tok-nx">esPar</span><span class="tok-p">(</span><span class="tok-mi">2</span><span class="tok-p">),</span> <span class="tok-s1">&#39;Y dos&#39;</span><span class="tok-p">);</span>
  <span class="tok-nx">assert</span><span class="tok-p">.</span><span class="tok-nx">ok</span><span class="tok-p">(</span><span class="tok-nx">esPar</span><span class="tok-p">(</span><span class="tok-o">-</span><span class="tok-mi">4</span><span class="tok-p">),</span> <span class="tok-s1">&#39;Los negativos pares&#39;</span><span class="tok-p">);</span>
  <span class="tok-nx">assert</span><span class="tok-p">.</span><span class="tok-nx">ok</span><span class="tok-p">(</span><span class="tok-o">!</span><span class="tok-nx">esPar</span><span class="tok-p">(</span><span class="tok-mi">1</span><span class="tok-p">),</span> <span class="tok-s1">&#39;Uno no es par&#39;</span><span class="tok-p">);</span>
  <span class="tok-nx">assert</span><span class="tok-p">.</span><span class="tok-nx">ok</span><span class="tok-p">(</span><span class="tok-o">!</span><span class="tok-nx">esPar</span><span class="tok-p">(</span><span class="tok-o">-</span><span class="tok-mi">7</span><span class="tok-p">),</span> <span class="tok-s1">&#39;Ni un 7 negativo&#39;</span><span class="tok-p">);</span>
<span class="tok-p">});</span></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Al llamar a <code>QUnit.test()</code> se construye un caso de prueba. El primer parámetro es la cadena que se mostrará en el resultado de la prueba, y el segundo es la función <em>callback</em> que contiene nuestras aserciones y se invocará una vez que ejecutemos <em>QUnit</em>.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Escribimos cinco aserciones, todas siendo <em>booleanas</em> mediante <code>ok(<em>expresionVerdadera</em>, <em>mensaje</em>)</code>. Una aserción <em>booleana</em> espera que el primer parámetro sea verdadero. El segundo parámetro, el cual es opcional, es el mensaje que se muestra en el resultado si la aserción se cumple.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Una vez lanzada la prueba, obtendremos que ha cumplido todas las aserciones:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/js04/qunitPar.jpg" alt="Pruebas esPar()" width="66%">
</div>
<div class="title">Figure 20. Pruebas() esPar</div>
</div>
<div class="paragraph">
<p>Como todas las aserciones han pasado, podemos asegurar que la función <code>esPar()</code> funciona correctamente, o al menos, de la manera esperada.</p>
</div>
<div class="paragraph">
<p>Veamos que sucede si la aserción falla:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="javascript"><span class="tok-nx">QUnit</span><span class="tok-p">.</span><span class="tok-nx">test</span><span class="tok-p">(</span><span class="tok-s1">&#39;esPar()&#39;</span><span class="tok-p">,</span> <span class="tok-kd">function</span><span class="tok-p">(</span><span class="tok-nx">assert</span><span class="tok-p">)</span> <span class="tok-p">{</span>
  <span class="tok-nx">assert</span><span class="tok-p">.</span><span class="tok-nx">ok</span><span class="tok-p">(</span><span class="tok-nx">esPar</span><span class="tok-p">(</span><span class="tok-mi">0</span><span class="tok-p">),</span> <span class="tok-s1">&#39;Cero es par&#39;</span><span class="tok-p">);</span>
  <span class="tok-nx">assert</span><span class="tok-p">.</span><span class="tok-nx">ok</span><span class="tok-p">(</span><span class="tok-nx">esPar</span><span class="tok-p">(</span><span class="tok-mi">2</span><span class="tok-p">),</span> <span class="tok-s1">&#39;Y dos&#39;</span><span class="tok-p">);</span>
  <span class="tok-nx">assert</span><span class="tok-p">.</span><span class="tok-nx">ok</span><span class="tok-p">(</span><span class="tok-nx">esPar</span><span class="tok-p">(</span><span class="tok-o">-</span><span class="tok-mi">4</span><span class="tok-p">),</span> <span class="tok-s1">&#39;Los negativos pares&#39;</span><span class="tok-p">);</span>
  <span class="tok-nx">assert</span><span class="tok-p">.</span><span class="tok-nx">ok</span><span class="tok-p">(</span><span class="tok-o">!</span><span class="tok-nx">esPar</span><span class="tok-p">(</span><span class="tok-mi">1</span><span class="tok-p">),</span> <span class="tok-s1">&#39;Uno no es par&#39;</span><span class="tok-p">);</span>
  <span class="tok-nx">assert</span><span class="tok-p">.</span><span class="tok-nx">ok</span><span class="tok-p">(</span><span class="tok-o">!</span><span class="tok-nx">esPar</span><span class="tok-p">(</span><span class="tok-o">-</span><span class="tok-mi">7</span><span class="tok-p">),</span> <span class="tok-s1">&#39;Ni un 7 negativo&#39;</span><span class="tok-p">);</span>

  <span class="tok-nx">assert</span><span class="tok-p">.</span><span class="tok-nx">ok</span><span class="tok-p">(</span><span class="tok-nx">esPar</span><span class="tok-p">(</span><span class="tok-mi">3</span><span class="tok-p">),</span> <span class="tok-s1">&#39;3 es par&#39;</span><span class="tok-p">);</span>  <i class="conum" data-value="1"></i><b>(1)</b>
<span class="tok-p">});</span></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Provocamos el error con una aserción errónea</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Como podemos esperar, el resultado muestra que la aserción falla:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/js04/qunitParError.jpg" alt="Pruebas esPar() con Error" width="66%">
</div>
<div class="title">Figure 21. Pruebas esPar() con Error</div>
</div>
<div class="paragraph">
<p>Ya sabemos que <code>ok()</code> no es la única aserción que ofrece <em>QUnit</em>. A continuación vamos a ver otras aserciones que permiten una granularidad más fina en las aserciones.</p>
</div>
<div class="sect5">
<h6 id="_comparación">Comparación</h6>
<div class="paragraph">
<p>Si vamos a comparar valores es mejor utilizar la aserción <code>equal(<em>valorReal</em>, <em>valorEsperado</em>, <em>mensaje</em>)</code>, la cual requiere dos parámetros con los valores reales y esperados y el mensaje opcional.</p>
</div>
<div class="paragraph">
<p>Al mostrar el resultado de la prueba, aparecerá tanto el valor real como el esperado, lo cual facilita la depuración del código.</p>
</div>
<div class="paragraph">
<p>Por lo tanto, en vez de hacer la prueba mediante una aserciones booleana:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="javascript"><span class="tok-nx">QUnit</span><span class="tok-p">.</span><span class="tok-nx">test</span><span class="tok-p">(</span><span class="tok-s1">&#39;comparaciones&#39;</span><span class="tok-p">,</span> <span class="tok-kd">function</span><span class="tok-p">(</span><span class="tok-nx">assert</span><span class="tok-p">)</span> <span class="tok-p">{</span>
  <span class="tok-nx">assert</span><span class="tok-p">.</span><span class="tok-nx">ok</span><span class="tok-p">(</span> <span class="tok-mi">1</span> <span class="tok-o">==</span> <span class="tok-mi">1</span><span class="tok-p">,</span> <span class="tok-s1">&#39;uno es igual que uno&#39;</span><span class="tok-p">);</span>
<span class="tok-p">});</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>es mejor hacerla mediante un aserción de comparación:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="javascript"><span class="tok-nx">QUnit</span><span class="tok-p">.</span><span class="tok-nx">test</span><span class="tok-p">(</span><span class="tok-s1">&#39;comparaciones&#39;</span><span class="tok-p">,</span> <span class="tok-kd">function</span><span class="tok-p">(</span><span class="tok-nx">assert</span><span class="tok-p">)</span> <span class="tok-p">{</span>
  <span class="tok-nx">assert</span><span class="tok-p">.</span><span class="tok-nx">equal</span><span class="tok-p">(</span> <span class="tok-mi">1</span><span class="tok-p">,</span> <span class="tok-mi">1</span><span class="tok-p">,</span> <span class="tok-s1">&#39;uno es igual que uno&#39;</span><span class="tok-p">);</span>
  <span class="tok-nx">assert</span><span class="tok-p">.</span><span class="tok-nx">equal</span><span class="tok-p">(</span> <span class="tok-mi">1</span><span class="tok-p">,</span> <span class="tok-kc">true</span><span class="tok-p">,</span> <span class="tok-s1">&#39;pasa porque 1 == true&#39;</span><span class="tok-p">);</span>
<span class="tok-p">});</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Si queremos probar una aserción que falla podemos hacer:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="javascript"><span class="tok-nx">QUnit</span><span class="tok-p">.</span><span class="tok-nx">test</span><span class="tok-p">(</span><span class="tok-s1">&#39;comparaciones&#39;</span><span class="tok-p">,</span> <span class="tok-kd">function</span><span class="tok-p">(</span><span class="tok-nx">assert</span><span class="tok-p">)</span> <span class="tok-p">{</span>
  <span class="tok-nx">assert</span><span class="tok-p">.</span><span class="tok-nx">equal</span><span class="tok-p">(</span> <span class="tok-mi">2</span><span class="tok-p">,</span> <span class="tok-mi">1</span><span class="tok-p">,</span> <span class="tok-s1">&#39;falla porque 2 != 1&#39;</span><span class="tok-p">);</span>
<span class="tok-p">});</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Ahora podemos observar como el mensaje de error es más completo que con la aserción booleana:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/js04/qunitEqual.jpg" alt="Pruebas con equal" width="50%">
</div>
<div class="title">Figure 22. Pruebas con equal</div>
</div>
<div class="paragraph">
<p>Si queremos negar el comportamiento, <em>QUnit</em> ofrece la aserción <code>notEqual</code> para comprobar un valor que no esperamos.</p>
</div>
<div class="paragraph">
<p>Si queremos que se realice una comparación estricta, hemos de usar la aserción <code>strictEqual()</code>. Como podemos suponer, la aserción <code>strictEqual()</code> utiliza el operador <code>===</code> para realizar las comparaciones, lo que conviene tener en cuenta al comparar ciertos valores:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="javascript"><span class="tok-nx">QUnit</span><span class="tok-p">.</span><span class="tok-nx">test</span><span class="tok-p">(</span><span class="tok-s1">&#39;comparacionesEstrictas&#39;</span><span class="tok-p">,</span> <span class="tok-kd">function</span><span class="tok-p">(</span><span class="tok-nx">assert</span><span class="tok-p">)</span> <span class="tok-p">{</span>
  <span class="tok-nx">assert</span><span class="tok-p">.</span><span class="tok-nx">equal</span><span class="tok-p">(</span> <span class="tok-mi">0</span><span class="tok-p">,</span> <span class="tok-kc">false</span><span class="tok-p">,</span> <span class="tok-s1">&#39;pasa la prueba&#39;</span><span class="tok-p">);</span>
  <span class="tok-nx">assert</span><span class="tok-p">.</span><span class="tok-nx">strictEqual</span><span class="tok-p">(</span> <span class="tok-mi">0</span><span class="tok-p">,</span> <span class="tok-kc">false</span><span class="tok-p">,</span> <span class="tok-s1">&#39;falla&#39;</span><span class="tok-p">);</span>
  <span class="tok-nx">assert</span><span class="tok-p">.</span><span class="tok-nx">equal</span><span class="tok-p">(</span> <span class="tok-kc">null</span><span class="tok-p">,</span> <span class="tok-kc">undefined</span><span class="tok-p">,</span> <span class="tok-s1">&#39;pasa la prueba&#39;</span><span class="tok-p">);</span>
  <span class="tok-nx">assert</span><span class="tok-p">.</span><span class="tok-nx">strictEqual</span><span class="tok-p">(</span> <span class="tok-kc">null</span><span class="tok-p">,</span> <span class="tok-kc">undefined</span><span class="tok-p">,</span> <span class="tok-s1">&#39;falla&#39;</span><span class="tok-p">);</span>
<span class="tok-p">});</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Ambas aserciones, estrictas o no, al utilizar los operadores <code>==</code> o <code>===</code> para comparar sus parámetros, no se puede utilizar con arrays u objetos:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="javascript"><span class="tok-nx">QUnit</span><span class="tok-p">.</span><span class="tok-nx">test</span><span class="tok-p">(</span><span class="tok-s1">&#39;comparacionesArrays&#39;</span><span class="tok-p">,</span> <span class="tok-kd">function</span><span class="tok-p">(</span><span class="tok-nx">assert</span><span class="tok-p">)</span> <span class="tok-p">{</span>
  <span class="tok-nx">assert</span><span class="tok-p">.</span><span class="tok-nx">equal</span><span class="tok-p">(</span> <span class="tok-p">{},</span> <span class="tok-p">{},</span> <span class="tok-s1">&#39;falla, estos objetos son diferentes&#39;</span><span class="tok-p">);</span>
  <span class="tok-nx">assert</span><span class="tok-p">.</span><span class="tok-nx">equal</span><span class="tok-p">(</span> <span class="tok-p">{</span><span class="tok-nx">a</span><span class="tok-o">:</span> <span class="tok-mi">1</span><span class="tok-p">},</span> <span class="tok-p">{</span><span class="tok-nx">a</span><span class="tok-o">:</span> <span class="tok-mi">1</span><span class="tok-p">}</span> <span class="tok-p">,</span> <span class="tok-s1">&#39;falla&#39;</span><span class="tok-p">);</span>
  <span class="tok-nx">assert</span><span class="tok-p">.</span><span class="tok-nx">equal</span><span class="tok-p">(</span> <span class="tok-p">[],</span> <span class="tok-p">[],</span> <span class="tok-s1">&#39;falla, son diferentes arrays&#39;</span><span class="tok-p">);</span>
  <span class="tok-nx">assert</span><span class="tok-p">.</span><span class="tok-nx">equal</span><span class="tok-p">(</span> <span class="tok-p">[</span><span class="tok-mi">1</span><span class="tok-p">],</span> <span class="tok-p">[</span><span class="tok-mi">1</span><span class="tok-p">],</span> <span class="tok-s1">&#39;falla&#39;</span><span class="tok-p">);</span>
<span class="tok-p">});</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Para que estas pruebas de igualdad se cumplan, <em>QUnit</em> ofrece otro tipo de aserción, la aserción identidad.</p>
</div>
</div>
<div class="sect5">
<h6 id="_identidad">Identidad</h6>
<div class="paragraph">
<p>La aserción identidad <code>deepEqual(<em>valorReal</em>, <em>valorEsperado</em>, <em>mensaje</em>)</code> espera los mismos parámetros que <code>equal</code>, pero realiza una comparación recursiva que funciona tanto con tipos primitivos como con arrays, objetos y expresiones regulares. Si reescribimos el ejemplo anterior ahora si que pasará las pruebas:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="javascript"><span class="tok-nx">QUnit</span><span class="tok-p">.</span><span class="tok-nx">test</span><span class="tok-p">(</span><span class="tok-s1">&#39;comparacionesArraysRecursiva&#39;</span><span class="tok-p">,</span> <span class="tok-kd">function</span><span class="tok-p">(</span><span class="tok-nx">assert</span><span class="tok-p">)</span> <span class="tok-p">{</span>
  <span class="tok-nx">assert</span><span class="tok-p">.</span><span class="tok-nx">deepEqual</span><span class="tok-p">(</span> <span class="tok-p">{},</span> <span class="tok-p">{},</span> <span class="tok-s1">&#39;correcto, los objetos tienen el mismo contenido&#39;</span><span class="tok-p">);</span>
  <span class="tok-nx">assert</span><span class="tok-p">.</span><span class="tok-nx">deepEqual</span><span class="tok-p">(</span> <span class="tok-p">{</span><span class="tok-nx">a</span><span class="tok-o">:</span> <span class="tok-mi">1</span><span class="tok-p">},</span> <span class="tok-p">{</span><span class="tok-nx">a</span><span class="tok-o">:</span> <span class="tok-mi">1</span><span class="tok-p">}</span> <span class="tok-p">,</span> <span class="tok-s1">&#39;correcto&#39;</span><span class="tok-p">);</span>
  <span class="tok-nx">assert</span><span class="tok-p">.</span><span class="tok-nx">deepEqual</span><span class="tok-p">(</span> <span class="tok-p">[],</span> <span class="tok-p">[],</span> <span class="tok-s1">&#39;correcto, los arrays tienen el mismo contenido&#39;</span><span class="tok-p">);</span>
  <span class="tok-nx">assert</span><span class="tok-p">.</span><span class="tok-nx">deepEqual</span><span class="tok-p">(</span> <span class="tok-p">[</span><span class="tok-mi">1</span><span class="tok-p">],</span> <span class="tok-p">[</span><span class="tok-mi">1</span><span class="tok-p">],</span> <span class="tok-s1">&#39;correcto&#39;</span><span class="tok-p">);</span>
<span class="tok-p">})</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Si queremos negar la identidad podemos hacer uso de su antónimo <code>notDeepEqual()</code>.</p>
</div>
<div class="paragraph">
<p>Además, si estamos interesados en comparar las propiedades y valores de un objeto podemos usar la aserción <code>propEqual()</code>, la cual será existosa si las propiedades son idénticas, con lo cual podemos reescribir las mismas pruebas:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="javascript"><span class="tok-nx">QUnit</span><span class="tok-p">.</span><span class="tok-nx">test</span><span class="tok-p">(</span><span class="tok-s1">&#39;comparacionesPropiedades&#39;</span><span class="tok-p">,</span> <span class="tok-kd">function</span><span class="tok-p">(</span><span class="tok-nx">assert</span><span class="tok-p">)</span> <span class="tok-p">{</span>
  <span class="tok-nx">assert</span><span class="tok-p">.</span><span class="tok-nx">propEqual</span><span class="tok-p">(</span> <span class="tok-p">{},</span> <span class="tok-p">{},</span> <span class="tok-s1">&#39;correcto, los objetos tienen el mismo contenido&#39;</span><span class="tok-p">);</span>
  <span class="tok-nx">assert</span><span class="tok-p">.</span><span class="tok-nx">propEqual</span><span class="tok-p">(</span> <span class="tok-p">{</span><span class="tok-nx">a</span><span class="tok-o">:</span> <span class="tok-mi">1</span><span class="tok-p">},</span> <span class="tok-p">{</span><span class="tok-nx">a</span><span class="tok-o">:</span> <span class="tok-mi">1</span><span class="tok-p">}</span> <span class="tok-p">,</span> <span class="tok-s1">&#39;correcto&#39;</span><span class="tok-p">);</span>
  <span class="tok-nx">assert</span><span class="tok-p">.</span><span class="tok-nx">propEqual</span><span class="tok-p">(</span> <span class="tok-p">[],</span> <span class="tok-p">[],</span> <span class="tok-s1">&#39;correcto, los arrays tienen el mismo contenido&#39;</span><span class="tok-p">);</span>
  <span class="tok-nx">assert</span><span class="tok-p">.</span><span class="tok-nx">propEqual</span><span class="tok-p">(</span> <span class="tok-p">[</span><span class="tok-mi">1</span><span class="tok-p">],</span> <span class="tok-p">[</span><span class="tok-mi">1</span><span class="tok-p">],</span> <span class="tok-s1">&#39;correcto&#39;</span><span class="tok-p">);</span>
<span class="tok-p">});</span></code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_excepciones">Excepciones</h6>
<div class="paragraph">
<p>Para comprobar si nuestro código lanza <code>Error</code>, haremos uso de la aserción <code>throws(<em>función</em> [, <em>excepcionEsperada</em>] [,<em>mensaje</em>])</code>, la cual también puede comprobar que <em>función</em> lanza la <em>excepcionEsperada</em>.</p>
</div>
<div class="listingblock">
<div class="title">Ejemplo <code>throws</code> - <a href="http://jsbin.com/bineto/7/edit?html,js,output" class="bare">http://jsbin.com/bineto/7/edit?html,js,output</a></div>
<div class="content">
<pre class="pygments highlight"><code data-lang="javascript"><span class="tok-nx">QUnit</span><span class="tok-p">.</span><span class="tok-nx">test</span><span class="tok-p">(</span><span class="tok-s1">&#39;excepciones&#39;</span><span class="tok-p">,</span> <span class="tok-kd">function</span><span class="tok-p">(</span><span class="tok-nx">assert</span><span class="tok-p">)</span> <span class="tok-p">{</span>
  <span class="tok-nx">assert</span><span class="tok-p">.</span><span class="tok-kr">throws</span><span class="tok-p">(</span> <span class="tok-kd">function</span><span class="tok-p">()</span> <span class="tok-p">{</span> <span class="tok-k">throw</span> <span class="tok-nb">Error</span><span class="tok-p">(</span><span class="tok-s2">&quot;Hola, soy un Error&quot;</span><span class="tok-p">);</span> <span class="tok-p">},</span>
    <span class="tok-s1">&#39;pasa al lanzar el Error&#39;</span><span class="tok-p">);</span>
  <span class="tok-nx">assert</span><span class="tok-p">.</span><span class="tok-kr">throws</span><span class="tok-p">(</span> <span class="tok-kd">function</span><span class="tok-p">()</span> <span class="tok-p">{</span> <span class="tok-nx">x</span><span class="tok-p">;</span> <span class="tok-p">},</span> <span class="tok-c1">// ReferenceError</span>
    <span class="tok-s1">&#39;pasa al no definir x, &#39;</span><span class="tok-p">);</span>
  <span class="tok-nx">assert</span><span class="tok-p">.</span><span class="tok-kr">throws</span><span class="tok-p">(</span> <span class="tok-kd">function</span><span class="tok-p">()</span> <span class="tok-p">{</span> <span class="tok-nx">esPar</span><span class="tok-p">(</span><span class="tok-mi">2</span><span class="tok-p">);</span> <span class="tok-p">},</span>
    <span class="tok-s1">&#39;falla porque no se lanza ningun Error&#39;</span><span class="tok-p">);</span>
<span class="tok-p">});</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Podemos observar como la tercera aserción falla:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/js04/qunitThrows.jpg" alt="Pruebas con throws" width="50%">
</div>
<div class="title">Figure 23. Pruebas con throws</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_módulos_2">Módulos</h5>
<div class="paragraph">
<p>Colocar todas las aserciones en un único caso de prueba no es buena idea, ya que dificulta su mantenibilidad y no devuelve un resultado claro.</p>
</div>
<div class="paragraph">
<p>Es mucho mejor colocarlos en diferentes casos de pruebas donde cada caso se centra en una única funcionalidad.</p>
</div>
<div class="paragraph">
<p>Incluso, podemos organizar los casos de pruebas en diferentes módulos, lo cual nos ofrece un nivel mayor de abstracción. Para ello, hemos de llamar a la función <code>module()</code>:</p>
</div>
<div class="listingblock">
<div class="title">Ejemplo Módulos - <a href="http://jsbin.com/juxega/2/edit?html,js,output" class="bare">http://jsbin.com/juxega/2/edit?html,js,output</a></div>
<div class="content">
<pre class="pygments highlight"><code data-lang="javascript"><span class="tok-nx">QUnit</span><span class="tok-p">.</span><span class="tok-nx">module</span><span class="tok-p">(</span><span class="tok-s1">&#39;Módulo A&#39;</span><span class="tok-p">);</span>
<span class="tok-nx">QUnit</span><span class="tok-p">.</span><span class="tok-nx">test</span><span class="tok-p">(</span><span class="tok-s1">&#39;una prueba&#39;</span><span class="tok-p">,</span> <span class="tok-kd">function</span><span class="tok-p">(</span><span class="tok-nx">assert</span><span class="tok-p">)</span> <span class="tok-p">{</span> <span class="tok-nx">assert</span><span class="tok-p">.</span><span class="tok-nx">ok</span><span class="tok-p">(</span><span class="tok-kc">true</span><span class="tok-p">,</span> <span class="tok-s2">&quot;ok&quot;</span><span class="tok-p">);</span> <span class="tok-p">});</span>
<span class="tok-nx">QUnit</span><span class="tok-p">.</span><span class="tok-nx">test</span><span class="tok-p">(</span><span class="tok-s1">&#39;otra prueba&#39;</span><span class="tok-p">,</span> <span class="tok-kd">function</span><span class="tok-p">(</span><span class="tok-nx">assert</span><span class="tok-p">)</span> <span class="tok-p">{</span> <span class="tok-nx">assert</span><span class="tok-p">.</span><span class="tok-nx">ok</span><span class="tok-p">(</span><span class="tok-kc">true</span><span class="tok-p">,</span> <span class="tok-s2">&quot;ok&quot;</span><span class="tok-p">);</span> <span class="tok-p">});</span>

<span class="tok-nx">QUnit</span><span class="tok-p">.</span><span class="tok-nx">module</span><span class="tok-p">(</span><span class="tok-s1">&#39;Módulo B&#39;</span><span class="tok-p">);</span>
<span class="tok-nx">QUnit</span><span class="tok-p">.</span><span class="tok-nx">test</span><span class="tok-p">(</span><span class="tok-s1">&#39;una prueba&#39;</span><span class="tok-p">,</span> <span class="tok-kd">function</span><span class="tok-p">(</span><span class="tok-nx">assert</span><span class="tok-p">)</span> <span class="tok-p">{</span> <span class="tok-nx">assert</span><span class="tok-p">.</span><span class="tok-nx">ok</span><span class="tok-p">(</span><span class="tok-kc">true</span><span class="tok-p">,</span> <span class="tok-s2">&quot;ok&quot;</span><span class="tok-p">);</span> <span class="tok-p">});</span>
<span class="tok-nx">QUnit</span><span class="tok-p">.</span><span class="tok-nx">test</span><span class="tok-p">(</span><span class="tok-s1">&#39;otra prueba&#39;</span><span class="tok-p">,</span> <span class="tok-kd">function</span><span class="tok-p">(</span><span class="tok-nx">assert</span><span class="tok-p">)</span> <span class="tok-p">{</span> <span class="tok-nx">assert</span><span class="tok-p">.</span><span class="tok-nx">ok</span><span class="tok-p">(</span><span class="tok-kc">true</span><span class="tok-p">,</span> <span class="tok-s2">&quot;ok&quot;</span><span class="tok-p">);</span> <span class="tok-p">});</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Podemos observar como las pruebas se agrupan en los dos módulos definidos, y en la cabecera nos aparece un desplegable donde podemos filtrar las pruebas realizadas por los módulos disponibles:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/js04/qunitModule.jpg" alt="Pruebas con module" width="50%">
</div>
<div class="title">Figure 24. Pruebas con module</div>
</div>
<div class="paragraph">
<p>Además de agrupar pruebas, podemos usar <code>QUnit.module()</code> para refactorizar las pruebas y extraer código común dentro del módulo. Para ello, le añadirmos un segundo parámetro (el cual es opcional) que define las funciones que se ejecutan antes (<code>setup</code>) o después (<code>teardown</code>) de cada pruebas:</p>
</div>
<div class="listingblock">
<div class="title">Ejemplo Modulos <code>setup</code>,<code>teardown</code> - <a href="http://jsbin.com/juxega/2/edit?html,js,output" class="bare">http://jsbin.com/juxega/2/edit?html,js,output</a></div>
<div class="content">
<pre class="pygments highlight"><code data-lang="javascript"><span class="tok-nx">QUnit</span><span class="tok-p">.</span><span class="tok-nx">module</span><span class="tok-p">(</span><span class="tok-s2">&quot;Módulo C&quot;</span><span class="tok-p">,</span> <span class="tok-p">{</span>
  <span class="tok-nx">setup</span><span class="tok-o">:</span> <span class="tok-kd">function</span><span class="tok-p">(</span> <span class="tok-nx">assert</span> <span class="tok-p">)</span> <span class="tok-p">{</span>
    <span class="tok-nx">assert</span><span class="tok-p">.</span><span class="tok-nx">ok</span><span class="tok-p">(</span> <span class="tok-kc">true</span><span class="tok-p">,</span> <span class="tok-s2">&quot;una aserción extra antes de cada test&quot;</span> <span class="tok-p">);</span>
  <span class="tok-p">},</span> <span class="tok-nx">teardown</span><span class="tok-o">:</span> <span class="tok-kd">function</span><span class="tok-p">(</span> <span class="tok-nx">assert</span> <span class="tok-p">)</span> <span class="tok-p">{</span>
    <span class="tok-nx">assert</span><span class="tok-p">.</span><span class="tok-nx">ok</span><span class="tok-p">(</span> <span class="tok-kc">true</span><span class="tok-p">,</span> <span class="tok-s2">&quot;y otra más después de cada prueba&quot;</span> <span class="tok-p">);</span>
  <span class="tok-p">}</span>
<span class="tok-p">});</span>
<span class="tok-nx">QUnit</span><span class="tok-p">.</span><span class="tok-nx">test</span><span class="tok-p">(</span><span class="tok-s2">&quot;Prueba con setup y teardown&quot;</span><span class="tok-p">,</span> <span class="tok-kd">function</span><span class="tok-p">(</span><span class="tok-nx">assert</span><span class="tok-p">)</span> <span class="tok-p">{</span>
  <span class="tok-nx">assert</span><span class="tok-p">.</span><span class="tok-nx">ok</span><span class="tok-p">(</span> <span class="tok-nx">esPar</span><span class="tok-p">(</span><span class="tok-mi">2</span><span class="tok-p">),</span> <span class="tok-s2">&quot;dos es par&quot;</span><span class="tok-p">);</span>
<span class="tok-p">});</span>
<span class="tok-nx">QUnit</span><span class="tok-p">.</span><span class="tok-nx">test</span><span class="tok-p">(</span><span class="tok-s2">&quot;Prueba con setup y teardown&quot;</span><span class="tok-p">,</span> <span class="tok-kd">function</span><span class="tok-p">(</span><span class="tok-nx">assert</span><span class="tok-p">)</span> <span class="tok-p">{</span>
  <span class="tok-nx">assert</span><span class="tok-p">.</span><span class="tok-nx">ok</span><span class="tok-p">(</span> <span class="tok-nx">esPar</span><span class="tok-p">(</span><span class="tok-mi">4</span><span class="tok-p">),</span> <span class="tok-s2">&quot;cuatro es par&quot;</span><span class="tok-p">);</span>
<span class="tok-p">});</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Podemos especificar las dos propiedades <code>setup</code> como <code>teardown</code> a la vez, o definir únicamente la que nos interese.</p>
</div>
<div class="paragraph">
<p>Al llamar a <code>QUnit.module()</code> de nuevo sin ningún argumento adicional, las funciones de <code>setup</code> y <code>teardown</code> que haya definido algún otro modulo serán reseteadas.</p>
</div>
</div>
<div class="sect4">
<h5 id="_expectativas">Expectativas</h5>
<div class="paragraph">
<p>Al crear una prueba, es una buena práctica indicar el número de aserciones que esperamos que se ejecuten. Al hacerlo, la prueba fallará si una o más aserciones no se ejecutan.</p>
</div>
<div class="paragraph">
<p><em>QUnit</em> ofrece el método <code>expect(<em>numeroAserciones</em>)</code> para este propósito, sobre todo cuando tratamos con código asíncrono, aunque también es útil en funciones síncronas.</p>
</div>
<div class="paragraph">
<p>Por ejemplo, si queremos probar las comparaciones de nuevo, podemos añadir:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="javascript"><span class="tok-nx">QUnit</span><span class="tok-p">.</span><span class="tok-nx">test</span><span class="tok-p">(</span><span class="tok-s1">&#39;comparacionesPropiedades&#39;</span><span class="tok-p">,</span> <span class="tok-kd">function</span><span class="tok-p">(</span><span class="tok-nx">assert</span><span class="tok-p">)</span> <span class="tok-p">{</span>
  <span class="tok-nx">expect</span><span class="tok-p">(</span><span class="tok-mi">4</span><span class="tok-p">);</span>
  <span class="tok-c1">// aserciones</span>
<span class="tok-p">}</span></code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_pruebas_asíncronas">Pruebas asíncronas</h5>
<div class="paragraph">
<p>Ya veremos en la siguiente sesión como realizar llamadas asíncronas a servicios <em>REST</em> mediante <em>AJAX</em>. Casi cualquier proyecto real que contiene <em>JavaScript</em> accede o utiliza funciones asíncronas.</p>
</div>
<div class="paragraph">
<p>Para realizar un caso de prueba asíncrona usaremos <code>QUnit.asyncTest(<em>nombre</em>, <em>funcionPrueba</em>)</code> de manera similar a las pruebas síncronas. Pero aunque la firma sea semejante, su funcionamiento varía.</p>
</div>
<div class="paragraph">
<p>Dentro de la prueba usaremos los métodos <code>QUnit.start()</code> y <code>QUnit.stop()</code>. Cuando <em>QUnit</em> ejecuta un caso de prueba asíncrona, automáticamente detiene el <em>testrunner</em>. Este permanecerá parado hasta que el caso de prueba que contiene las aserciones invoque a <code><strong>QUnit.start()</strong></code>, el cual inicia o continúa la ejecución de la prueba. Este método acepta un entero como argumento opcional para fusionar múltiples llamadas <code>QUnit.start()</code> en una sola.</p>
</div>
<div class="paragraph">
<p>Para paralizar una prueba usaremos <code><strong>QUnit.stop()</strong></code>. Al hacerlo se incrementa el número de llamadas necesarias a <code>QUnit.start()</code> para que el <em>testrunner</em> vuelva a funcionar. <code>QUnit.stop()</code> también acepta un argumento opcional con un entero que especifica el número de llamadas adicionales a <code>QUnit.start()</code> que el <em>framework</em> tiene que esperar. Por defecto, su valor es 1.</p>
</div>
<div class="paragraph">
<p>Para probar estos métodos vamos a centrarnos en la siguiente función que recorre todos los parámetros y obtiene el mayor de ellos, la cual queremos probar que funciona correctamente:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="javascript"><span class="tok-kd">function</span> <span class="tok-nx">mayor</span><span class="tok-p">()</span> <span class="tok-p">{</span>
  <span class="tok-kd">var</span> <span class="tok-nx">max</span><span class="tok-o">=-</span><span class="tok-kc">Infinity</span><span class="tok-p">;</span>
  <span class="tok-k">for</span> <span class="tok-p">(</span><span class="tok-kd">var</span> <span class="tok-nx">i</span><span class="tok-o">=</span><span class="tok-mi">0</span><span class="tok-p">,</span> <span class="tok-nx">len</span><span class="tok-o">=</span><span class="tok-nx">arguments</span><span class="tok-p">.</span><span class="tok-nx">length</span><span class="tok-p">;</span> <span class="tok-nx">i</span><span class="tok-o">&lt;</span><span class="tok-nx">len</span><span class="tok-p">;</span> <span class="tok-nx">i</span><span class="tok-o">++</span><span class="tok-p">)</span> <span class="tok-p">{</span>
    <span class="tok-k">if</span> <span class="tok-p">(</span><span class="tok-nx">arguments</span><span class="tok-p">[</span><span class="tok-nx">i</span><span class="tok-p">]</span> <span class="tok-o">&gt;</span> <span class="tok-nx">max</span><span class="tok-p">)</span> <span class="tok-p">{</span>
      <span class="tok-nx">max</span> <span class="tok-o">=</span> <span class="tok-nx">arguments</span><span class="tok-p">[</span><span class="tok-nx">i</span><span class="tok-p">];</span>
    <span class="tok-p">}</span>
  <span class="tok-p">}</span>
  <span class="tok-k">return</span> <span class="tok-nx">max</span><span class="tok-p">;</span>
<span class="tok-p">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Si imaginamos que esta función trabaja con un conjunto de parámetros muy grande, podemos deducir que queremos evitar que el navegador del usuario se quede bloqueado mientras se calcula el resultado. Para ello, llamaremos a nuestra función <code>max()</code> dentro de un <em>callback</em> que le pasamos a <code>window.setTimeout()</code> con un retraso de 0 milisegundos.</p>
</div>
<div class="paragraph">
<p>Así, el caso de prueba asíncrona quedará así:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="javascript"><span class="tok-nx">QUnit</span><span class="tok-p">.</span><span class="tok-nx">asyncTest</span><span class="tok-p">(</span><span class="tok-s1">&#39;max&#39;</span><span class="tok-p">,</span> <span class="tok-kd">function</span> <span class="tok-p">(</span><span class="tok-nx">assert</span><span class="tok-p">)</span> <span class="tok-p">{</span>  <i class="conum" data-value="1"></i><b>(1)</b>
  <span class="tok-nx">expect</span><span class="tok-p">(</span><span class="tok-mi">1</span><span class="tok-p">);</span>  <i class="conum" data-value="2"></i><b>(2)</b>
  <span class="tok-nb">window</span><span class="tok-p">.</span><span class="tok-nx">setTimeout</span><span class="tok-p">(</span><span class="tok-kd">function</span><span class="tok-p">()</span> <span class="tok-p">{</span>
    <span class="tok-nx">assert</span><span class="tok-p">.</span><span class="tok-nx">strictEqual</span><span class="tok-p">(</span><span class="tok-nx">mayor</span><span class="tok-p">(</span><span class="tok-mi">3</span><span class="tok-p">,</span> <span class="tok-mi">1</span><span class="tok-p">,</span> <span class="tok-mi">2</span><span class="tok-p">),</span> <span class="tok-mi">3</span><span class="tok-p">,</span> <span class="tok-s1">&#39;Todo números positivos&#39;</span><span class="tok-p">);</span>
    <span class="tok-nx">QUnit</span><span class="tok-p">.</span><span class="tok-nx">start</span><span class="tok-p">();</span>  <i class="conum" data-value="3"></i><b>(3)</b>
  <span class="tok-p">},</span> <span class="tok-mi">0</span><span class="tok-p">);</span>
<span class="tok-p">});</span></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Al iniciar la prueba asíncrona, el <em>testrunner</em> se paraliza</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Indicamos que esperamos una aserción</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Primero calculamos el valor, y una vez calculado, reiniciamos el <em>testrunner</em>. Si no hubiesemos llamado a <code>QUnit.start()</code>, el <em>testrunner</em> continuará parado y la prueba habría fallado.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Lo normal es realizar más de una aserción en un caso de prueba. Vamos a completar la prueba con diferentes aserciones. De este modo, entra en juego <code>QUnit.stop()</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="javascript"><span class="tok-nx">QUnit</span><span class="tok-p">.</span><span class="tok-nx">asyncTest</span><span class="tok-p">(</span><span class="tok-s1">&#39;max&#39;</span><span class="tok-p">,</span> <span class="tok-kd">function</span> <span class="tok-p">(</span><span class="tok-nx">assert</span><span class="tok-p">)</span> <span class="tok-p">{</span>
  <span class="tok-nx">expect</span><span class="tok-p">(</span><span class="tok-mi">4</span><span class="tok-p">);</span>  <i class="conum" data-value="1"></i><b>(1)</b>
  <span class="tok-nx">QUnit</span><span class="tok-p">.</span><span class="tok-nx">stop</span><span class="tok-p">(</span><span class="tok-mi">3</span><span class="tok-p">);</span>  <i class="conum" data-value="2"></i><b>(2)</b>

  <span class="tok-nb">window</span><span class="tok-p">.</span><span class="tok-nx">setTimeout</span><span class="tok-p">(</span><span class="tok-kd">function</span><span class="tok-p">()</span> <span class="tok-p">{</span>
    <span class="tok-nx">assert</span><span class="tok-p">.</span><span class="tok-nx">strictEqual</span><span class="tok-p">(</span><span class="tok-nx">mayor</span><span class="tok-p">(),</span> <span class="tok-o">-</span><span class="tok-kc">Infinity</span><span class="tok-p">,</span> <span class="tok-s1">&#39;Sin parámetros&#39;</span><span class="tok-p">);</span>
    <span class="tok-nx">QUnit</span><span class="tok-p">.</span><span class="tok-nx">start</span><span class="tok-p">();</span>
  <span class="tok-p">},</span> <span class="tok-mi">0</span><span class="tok-p">);</span>

  <span class="tok-nb">window</span><span class="tok-p">.</span><span class="tok-nx">setTimeout</span><span class="tok-p">(</span><span class="tok-kd">function</span><span class="tok-p">()</span> <span class="tok-p">{</span>
    <span class="tok-nx">assert</span><span class="tok-p">.</span><span class="tok-nx">strictEqual</span><span class="tok-p">(</span><span class="tok-nx">mayor</span><span class="tok-p">(</span><span class="tok-mi">3</span><span class="tok-p">,</span> <span class="tok-mi">1</span><span class="tok-p">,</span> <span class="tok-mi">2</span><span class="tok-p">),</span> <span class="tok-mi">3</span><span class="tok-p">,</span> <span class="tok-s1">&#39;Todo números positivos&#39;</span><span class="tok-p">);</span>
    <span class="tok-nx">QUnit</span><span class="tok-p">.</span><span class="tok-nx">start</span><span class="tok-p">();</span>
  <span class="tok-p">},</span> <span class="tok-mi">0</span><span class="tok-p">);</span>

  <span class="tok-nb">window</span><span class="tok-p">.</span><span class="tok-nx">setTimeout</span><span class="tok-p">(</span><span class="tok-kd">function</span><span class="tok-p">()</span> <span class="tok-p">{</span>
    <span class="tok-nx">assert</span><span class="tok-p">.</span><span class="tok-nx">strictEqual</span><span class="tok-p">(</span><span class="tok-nx">mayor</span><span class="tok-p">(</span><span class="tok-o">-</span><span class="tok-mi">10</span><span class="tok-p">,</span> <span class="tok-mi">5</span><span class="tok-p">,</span> <span class="tok-mi">3</span><span class="tok-p">,</span> <span class="tok-mi">99</span><span class="tok-p">),</span> <span class="tok-mi">99</span><span class="tok-p">,</span> <span class="tok-s1">&#39;Números positivos y negativos&#39;</span><span class="tok-p">);</span>
    <span class="tok-nx">QUnit</span><span class="tok-p">.</span><span class="tok-nx">start</span><span class="tok-p">();</span>
  <span class="tok-p">},</span> <span class="tok-mi">0</span><span class="tok-p">);</span>

  <span class="tok-nb">window</span><span class="tok-p">.</span><span class="tok-nx">setTimeout</span><span class="tok-p">(</span><span class="tok-kd">function</span><span class="tok-p">()</span> <span class="tok-p">{</span>
    <span class="tok-nx">assert</span><span class="tok-p">.</span><span class="tok-nx">strictEqual</span><span class="tok-p">(</span><span class="tok-nx">mayor</span><span class="tok-p">(</span><span class="tok-o">-</span><span class="tok-mi">14</span><span class="tok-p">,</span> <span class="tok-o">-</span><span class="tok-mi">22</span><span class="tok-p">,</span> <span class="tok-o">-</span><span class="tok-mi">5</span><span class="tok-p">),</span> <span class="tok-o">-</span><span class="tok-mi">5</span><span class="tok-p">,</span> <span class="tok-s1">&#39;Todo números negativos&#39;</span><span class="tok-p">);</span>
    <span class="tok-nx">QUnit</span><span class="tok-p">.</span><span class="tok-nx">start</span><span class="tok-p">();</span>
  <span class="tok-p">},</span> <span class="tok-mi">0</span><span class="tok-p">);</span>
<span class="tok-p">});</span></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Esperamos realizar cuatro aserciones</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Llamamos a <code>QUnit.stop()</code> porque realizamos cuatro llamadas asíncronas, con lo que tenemos que añadirle 3 unidades. Al emplear <code>QUnit.asyncTest()</code>, el <em>framework</em> solo espera una llamada de <code>QUnit.start()</code>. Si hubiesemos omitido la llamada a <code>QUnit.stop()</code> indicando las tres llamadas adicionales a <code>QUnit.start()</code>, la prueba habría fallado ya que el número de aserciones no habría coincidido con la expectativa del caso de prueba.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Al ejecutar la prueba tendremos el siguiente resultado:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/js04/qunitAsync.jpg" alt="Pruebas asíncronas" width="50%">
</div>
<div class="title">Figure 25. Pruebas asíncronas</div>
</div>
<div class="paragraph">
<p>En esta sección hemos visto como probar código asíncrono que no realiza operaciones AJAX. Sin embargo, lo más normal es cargar o enviar datos al servidor. En estos casos, es mejor no confiar en los datos que devuelve el servidor y utilizar <em>mocks</em> para las peticiones AJAX.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_otras_librerías">4.5.2. Otras librerías</h4>
<div class="paragraph">
<p>Aunque no hemos centrado en <em>QUnit</em>, no es la única librería de pruebas que deberíamos conocer. <em>QUnit</em> se centra en las pruebas unitarias siguiendo un enfoque TDD (<em>Test Driven Development</em>).</p>
</div>
<div class="paragraph">
<p>Dependiendo del enfoque necesitaremos emplear las siguientes librerías:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><em>Jasmine</em> (<a href="http://jasmine.github.io" class="bare">http://jasmine.github.io</a>): Sigue un enfoque BDD (Behaviour Driven Development) para centrarse más en los requisitos de negocio que en el código. En los módulos de <em>BackBone</em> y <em>AngularJS</em> trabajaremos con esta librería.</p>
<div class="paragraph">
<p>El código de las pruebas será similar a:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="javascript"><span class="tok-nx">describe</span><span class="tok-p">(</span><span class="tok-s2">&quot;Una suite&quot;</span><span class="tok-p">,</span> <span class="tok-kd">function</span><span class="tok-p">()</span> <span class="tok-p">{</span>
  <span class="tok-nx">it</span><span class="tok-p">(</span><span class="tok-s2">&quot;contiene un requisito con una expectativa&quot;</span><span class="tok-p">,</span> <span class="tok-kd">function</span><span class="tok-p">()</span> <span class="tok-p">{</span>
    <span class="tok-nx">expect</span><span class="tok-p">(</span><span class="tok-kc">true</span><span class="tok-p">).</span><span class="tok-nx">toBe</span><span class="tok-p">(</span><span class="tok-kc">true</span><span class="tok-p">);</span>
  <span class="tok-p">});</span>
<span class="tok-p">});</span></code></pre>
</div>
</div>
</li>
<li>
<p><em>Mocha</em> (<a href="http://mochajs.org" class="bare">http://mochajs.org</a>): Framework de pruebas muy flexible que también sigue un enfoque <em>BDD</em>, con posibilidad de añadir nuevas aserciones, normalmente mediante <em>Chai.js</em> (<a href="http://chaijs.com/" class="bare">http://chaijs.com/</a>) y emplear promesas.</p>
</li>
<li>
<p><em>Sinon.js</em> (<a href="http://sinonjs.org/" class="bare">http://sinonjs.org/</a>) o <em>Mockjax</em> (<a href="https://github.com/jakerella/jquery-mockjax" class="bare">https://github.com/jakerella/jquery-mockjax</a>): frameworks para la creación de objetos <em>mocks</em> y crear objetos que espían y/o suplantan servicios REST/peticiones AJAX</p>
</li>
<li>
<p><em>Blanket.js</em> (<a href="http://blanketjs.org/" class="bare">http://blanketjs.org/</a>): añade informes de cobertura de pruebas sobre <em>QUnit</em>, <em>Mocha</em> o <em>Jasmine</em>. Otra alternativa es <em>CoverJS</em> (<a href="https://github.com/arian/CoverJS" class="bare">https://github.com/arian/CoverJS</a>)</p>
</li>
<li>
<p><em>Plato</em> (<a href="https://github.com/es-analysis/plato" class="bare">https://github.com/es-analysis/plato</a>): permite analizar la complejidad del código JavaScript</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_ejercicios_4">4.6. Ejercicios</h3>
<div class="sect3">
<h4 id="__0_8_ptos_ejercicio_41_em_canificador_em">4.6.1. (0.8 ptos) Ejercicio 41. <em>Canificador</em></h4>
<div class="paragraph">
<p>Realizar un módulo denominado <code>Canificador</code> que ofrezca la funcionalidad del método <code>toCani</code>, permitiendo configurar el final, el cual por defecto es <code>"HHH"</code>.</p>
</div>
<div class="paragraph">
<p>Para ello, podremos realizar una llamada al módulo así:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="javascript"><span class="tok-nx">Canificador</span><span class="tok-p">.</span><span class="tok-nx">toCani</span><span class="tok-p">({</span><span class="tok-s2">&quot;texto&quot;</span><span class="tok-o">:</span> <span class="tok-s2">&quot;Texto a canificar&quot;</span><span class="tok-p">,</span> <span class="tok-s2">&quot;final&quot;</span><span class="tok-o">:</span><span class="tok-s2">&quot;ARGH&quot;</span><span class="tok-p">});</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Haciendo uso de expresiones regulares, vamos a mejorar la funcionalidad para que sustituya las <em>"ca"</em>, <em>"co"</em>, <em>"cu"</em> por <em>"ka"</em>, <em>"ko"</em>, <em>"ku"</em>, pero no así las <em>"ce"</em>, <em>"ci"</em>. Además, todas las ocurrencias de <em>"qu"</em> también se sustiuirán por <em>"k"</em>, y las <em>"ch"</em> por <em>"x"</em>.</p>
</div>
<div class="paragraph">
<p>También queremos almacenar el número de ocasiones que se ha invocado el método <code>toCani</code>, el cual se podrá consultar mediante <code>Canificador.getTotal()</code>.</p>
</div>
<div class="paragraph">
<p>El módulo a su vez debe permitir <em>descanificar</em> una cadena mediante el método <code>unCani</code>, la cual pasará toda la cadena a minúsculas, sustituirá las letras <code>k</code> por <code>c</code> y eliminirá el final que haya introducido el <em>Canificador</em>. Esta operación reducirá en una unidad el número total de invocaciones del módulo.</p>
</div>
<div class="paragraph">
<p>Además, debéis utilizar la siguiente plantilla para visualizar el funcionamiento:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="html"><span class="tok-nt">&lt;textarea</span> <span class="tok-na">id=</span><span class="tok-s">&quot;texto&quot;</span><span class="tok-nt">&gt;</span>Cecilia me ha dicho que este es el texto a canificar<span class="tok-nt">&lt;/textarea&gt;</span>
<span class="tok-nt">&lt;button</span> <span class="tok-na">id=</span><span class="tok-s">&quot;canificar&quot;</span><span class="tok-nt">&gt;</span>Canificar<span class="tok-nt">&lt;/button&gt;</span>
<span class="tok-nt">&lt;button</span> <span class="tok-na">id=</span><span class="tok-s">&quot;descanificar&quot;</span><span class="tok-nt">&gt;</span>Descanificar<span class="tok-nt">&lt;/button&gt;</span>
<span class="tok-nt">&lt;br</span> <span class="tok-nt">/&gt;</span>
Resultado: <span class="tok-nt">&lt;div</span> <span class="tok-na">id=</span><span class="tok-s">&quot;resultado&quot;</span><span class="tok-nt">&gt;</span> <span class="tok-nt">&lt;/div&gt;</span>
<span class="tok-nt">&lt;br</span> <span class="tok-nt">/&gt;</span>
Total: <span class="tok-nt">&lt;div</span> <span class="tok-na">id=</span><span class="tok-s">&quot;total&quot;</span><span class="tok-nt">&gt;&lt;/div&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>El código del <em>Canificador</em> junto a la gestión de eventos se almacenarán en una archivo denominado <code>ej41.js</code>.</p>
</div>
</div>
<div class="sect3">
<h4 id="__0_4_ptos_ejercicio_42_pruebas">4.6.2. (0.4 ptos) Ejercicio 42. Pruebas</h4>
<div class="paragraph">
<p>Para comprobar que el módulo anterior funciona correctamente, hay que desarrollar un suite de pruebas mediante <em>QUnit</em> que valide todas las operaciones, usando las aserciones adecuadas así como indicando mediante expectativas el número de aserciones a probar, y creando un módulo tanto para <code>toCani</code> como para <code>unCani</code>.</p>
</div>
<div class="paragraph">
<p>Todo el código se almacenará en una archivo denominado <code>ej42QUnit.js</code>.</p>
</div>
<div style="page-break-after: always;"></div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="sesion05">5. JavaScript y el navegador</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_ajax">5.1. AJAX</h3>
<div class="paragraph">
<p>Uno de los usos más comunes en <em>JavaScript</em> es AJAX (<em>Asynchronous JavaScript And XML</em>), técnica (que no lenguaje) que permite realizar peticiones HTTP al servidor desde <em>JavaScript</em>, y recibir la respuesta sin recargar la página ni cambiar a otra página distinta. La información que se recibe se inserta mediante el API DOM que vimos en la sesión anterior.</p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
Al igual que al abrir ventanas, el navegador restringe las peticiones al servidor para que sólo se puedan realizar sobre el mismo dominio al que pertenece la página que realiza la petición. Es decir, una página que desarrollamos en <em>localhost</em> no puede hacer una petición a <em>Twitter</em>.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Para usar AJAX, hemos de emplear el objeto <code>XMLHttpRequest</code> para lanzar una petición HTTP al servidor con el método <code>open(getPost, recurso, esAsync)</code> donde:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>getPost</code>: cadena con el valor <code>GET</code> o <code>POST</code> dependiendo del protocolo deseado</p>
</li>
<li>
<p><code>recurso</code>: URI del recurso que se solicita</p>
</li>
<li>
<p><code>esAsync</code>: booleano donde <code>true</code> indica que la petición en asíncrona</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Posteriormente se recibe la respuesta mediante la propiedad <code>responseText</code>.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
Aunque en sus inicios era original de IE, posteriormente fue adoptado por todos los navegadores.
</td>
</tr>
</table>
</div>
<div class="admonitionblock caution">
<table>
<tr>
<td class="icon">
<i class="fa icon-caution" title="Caution"></i>
</td>
<td class="content">
Vamos a dejar de lado IE8 y anteriores que en vez de usar el objeto <code>XMLHttpRequest</code> necesitan crear un objeto <code>ActiveXObject("Microsoft.XMLHTTP")</code>. Para trabajar con AJAX en versiones de navegadores antiguos se recomienda hacerlo mediante <em>jQuery</em>.
</td>
</tr>
</table>
</div>
<div class="sect3">
<h4 id="_ajax_síncrono">5.1.1. AJAX síncrono</h4>
<div class="paragraph">
<p>Para comenzar vamos a basarnos en un ejemplo con llamadas síncronas (sí, parece extraño, es como si usáramos <em>SJAX</em>), ya que el código es un poco más sencillo. El siguiente fragmento realiza una petición a un archivo del servidor <code>fichero.txt</code>, y tras recibirlo, lo muestra mediante un diálogo de alerta.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="javascript"><span class="tok-kd">var</span> <span class="tok-nx">xhr</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-nx">XMLHttpRequest</span><span class="tok-p">();</span>
<span class="tok-nx">xhr</span><span class="tok-p">.</span><span class="tok-nx">open</span><span class="tok-p">(</span><span class="tok-s2">&quot;GET&quot;</span><span class="tok-p">,</span><span class="tok-s2">&quot;fichero.txt&quot;</span><span class="tok-p">,</span> <span class="tok-kc">false</span><span class="tok-p">);</span>  <i class="conum" data-value="1"></i><b>(1)</b>
<span class="tok-nx">xhr</span><span class="tok-p">.</span><span class="tok-nx">send</span><span class="tok-p">(</span><span class="tok-kc">null</span><span class="tok-p">);</span>  <i class="conum" data-value="2"></i><b>(2)</b>
<span class="tok-nx">alert</span><span class="tok-p">(</span><span class="tok-nx">xhr</span><span class="tok-p">.</span><span class="tok-nx">responseText</span><span class="tok-p">);</span> <i class="conum" data-value="3"></i><b>(3)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Tras crear el objeto, se crea una conexión donde le indicamos el método de acceso (<code>GET</code> o <code>POST</code>), el nombre el recurso al que accedemos (<code>fichero.txt</code>) y finalmente si la llamada es asíncrona (<code>true</code>) o síncrona (<code>false</code>).</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Se envía la petición, en este caso sin parámetros (<code>null</code>)</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Recuperamos la respuesta con la propiedad <code>responseText</code>. Si el contenido del archivo hubiese estado en formato <em>XML</em>, usaríamos la propiedad <code>responseXML</code></td>
</tr>
</table>
</div>
<div class="paragraph">
<p>A modo de esquema, el siguiente gráfico representa las llamadas realizadas mediante una petición síncrona:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/js05/ajaxCicloSync.jpg" alt="Ciclo de llamadas síncrono en AJAX" width="50%">
</div>
<div class="title">Figure 26. Ciclo de llamadas síncrono en AJAX</div>
</div>
</div>
<div class="sect3">
<h4 id="_ajax_asíncrono">5.1.2. AJAX asíncrono</h4>
<div class="paragraph">
<p>Al realizar una petición síncrona, AJAX bloquea el navegador y se queda a la espera de la respuesta. Para evitar este bloqueo, usaremos el modo <strong>asíncrono</strong>. De este modo, tras realizar la petición, el control vuelve al navegador inmediatamente. El problema que tenemos ahora es averiguar si el recurso solicitado ya esta disponible. Para ello, tenemos la propiedad <code>readyState</code>, la cual tenemos que consultar para conocer el estado de la petición. Pero si la consultamos inmediatamente, nos dirá que no ha finalizado. Para evitar tener que crear un bucle infinito de consulta de la propiedad, siguiente el esquema de eventos, usaremos el manejador que ofrece la propiedad <code>onreadystatechange</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="javascript"><span class="tok-kd">var</span> <span class="tok-nx">xhr</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-nx">XMLHttpRequest</span><span class="tok-p">();</span>
<span class="tok-nx">xhr</span><span class="tok-p">.</span><span class="tok-nx">open</span><span class="tok-p">(</span><span class="tok-s2">&quot;GET&quot;</span><span class="tok-p">,</span><span class="tok-s2">&quot;fichero.txt&quot;</span><span class="tok-p">,</span> <span class="tok-kc">true</span><span class="tok-p">);</span> <i class="conum" data-value="1"></i><b>(1)</b>
<span class="tok-nx">xhr</span><span class="tok-p">.</span><span class="tok-nx">onreadystatechange</span> <span class="tok-o">=</span> <span class="tok-kd">function</span><span class="tok-p">()</span> <span class="tok-p">{</span>  <i class="conum" data-value="2"></i><b>(2)</b>
  <span class="tok-k">if</span> <span class="tok-p">(</span><span class="tok-nx">xhr</span><span class="tok-p">.</span><span class="tok-nx">readyState</span> <span class="tok-o">===</span> <span class="tok-mi">4</span><span class="tok-p">)</span> <span class="tok-p">{</span>  <i class="conum" data-value="3"></i><b>(3)</b>
    <span class="tok-nx">alert</span><span class="tok-p">(</span><span class="tok-nx">xhr</span><span class="tok-p">.</span><span class="tok-nx">responseText</span><span class="tok-p">);</span>
  <span class="tok-p">}</span>
<span class="tok-p">};</span>
<span class="tok-nx">xhr</span><span class="tok-p">.</span><span class="tok-nx">send</span><span class="tok-p">(</span><span class="tok-kc">null</span><span class="tok-p">);</span></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Ahora realizamos la petición de manera asíncrona indicándolo con <code>true</code> en el tercer parámetro</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Asociamos una función <em>callback</em> al evento de cambio de estado</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Comprobamos mediante el estado si la petición ha fallado (1), si ha cargado sólo las cabeceras HTTP (2), si está cargándose (3) o si ya esta completa (4).</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Además de comprobar el estado de la conexión, debemos comprobar el estado de la respuesta HTTP, para averiguar si realmente hemos obtenido la respuesta que solicitábamos. Para ello, la propiedad <code>status</code>
nos devolverá el código correspondiente (200 OK, 304 no ha cambiado desde la última petición, 404 no encontrado).</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="javascript"><span class="tok-nx">xhr</span><span class="tok-p">.</span><span class="tok-nx">onreadystatechange</span> <span class="tok-o">=</span> <span class="tok-kd">function</span><span class="tok-p">()</span> <span class="tok-p">{</span>
  <span class="tok-k">if</span> <span class="tok-p">(</span><span class="tok-nx">xhr</span><span class="tok-p">.</span><span class="tok-nx">readyState</span> <span class="tok-o">===</span>  <span class="tok-mi">4</span><span class="tok-p">)</span> <span class="tok-p">{</span>
    <span class="tok-kd">var</span> <span class="tok-nx">status</span> <span class="tok-o">=</span> <span class="tok-nx">xhr</span><span class="tok-p">.</span><span class="tok-nx">status</span><span class="tok-p">;</span>
    <span class="tok-k">if</span> <span class="tok-p">((</span><span class="tok-nx">status</span> <span class="tok-o">&gt;=</span> <span class="tok-mi">200</span> <span class="tok-o">&amp;&amp;</span> <span class="tok-nx">status</span> <span class="tok-o">&lt;</span> <span class="tok-mi">300</span><span class="tok-p">)</span> <span class="tok-o">||</span> <span class="tok-p">(</span><span class="tok-nx">status</span> <span class="tok-o">===</span> <span class="tok-mi">304</span><span class="tok-p">))</span> <span class="tok-p">{</span>
      <span class="tok-nx">alert</span><span class="tok-p">(</span><span class="tok-nx">xhr</span><span class="tok-p">.</span><span class="tok-nx">responseText</span><span class="tok-p">);</span>
    <span class="tok-p">}</span> <span class="tok-k">else</span> <span class="tok-p">{</span>
      <span class="tok-nx">alert</span><span class="tok-p">(</span><span class="tok-s2">&quot;Houston, tenemos un problema&quot;</span><span class="tok-p">);</span>
    <span class="tok-p">}</span>
  <span class="tok-p">}</span>
<span class="tok-p">};</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>A modo de esquema, el siguiente gráfico representa las llamadas realizadas mediante una petición asíncrona:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/js05/ajaxCicloAsync.jpg" alt="Ciclo de llamadas asíncrono en AJAX" width="50%">
</div>
<div class="title">Figure 27. Ciclo de llamadas asíncrono en AJAX</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="title">Bucle de Eventos</div>
<div class="paragraph">
<p>En la primera sesión comentamos que <em>JavaScript</em> es un lenguaje mono-hilo. ¿Cómo se gestionan las peticiones HTTP asíncronas?</p>
</div>
<div class="paragraph">
<p>Todo el código <em>JavaScript</em> corre en un único hilo, mientras que el código que implementa tareas asíncronas no forma parte de <em>JavaScript</em> y por tanto es libre de ejecutarse en un hilo separado. Una vez la tarea asíncrona finaliza, el <em>callback</em> se sitúa en una cola para devolverle el contenido al hilo principal.</p>
</div>
<div class="paragraph">
<p>Tras añadir el <em>callback</em> a la cola, no hay ninguna garantía de cuanto va a tener que esperar. La cola puede contener sucesos tales como clicks de ratón, teclas pulsadas, respuestas HTTP o cualquier otra tarea asíncrona. El <em>runtime</em> de <em>JavaScript</em> ejecuta  un bucle infinito consistente en llevar el primer elemento de la cola, ejecutar el código que lanza el elemento y volver a comprobar la cola. Este ciclo se conoce como el <strong>bucle de eventos</strong>.</p>
</div>
<div class="paragraph">
<p>Más información en <a href="https://thomashunter.name/blog/the-javascript-event-loop-presentation/" class="bare">https://thomashunter.name/blog/the-javascript-event-loop-presentation/</a></p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_enviando_datos">5.1.3. Enviando datos</h4>
<div class="paragraph">
<p>Cuando vamos a enviar datos, el primer paso es serializarlos. Para ello, debemos considerar qué datos vamos a enviar, ya sean parejas de variable/valor o ficheros, si vamos a emplear el protocolo GET o POST y el formato de los datos a enviar.</p>
</div>
<div class="paragraph">
<p>HTML5 introduce el objeto <code>FormData</code> para serializar los datos y convertir la información a <code>multipart/form-data</code>. Se trata de un objeto similar a un mapa, el cual se puede inicializar con un formulario (pasándole al constructor el elemento DOM del formulario) o crearlo en blanco y añadirle valores mediante el método <code>append()</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="javascript"><span class="tok-kd">var</span> <span class="tok-nx">formDataObj</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-nx">FormData</span><span class="tok-p">();</span>

<span class="tok-nx">formDataObj</span><span class="tok-p">.</span><span class="tok-nx">append</span><span class="tok-p">(</span><span class="tok-s1">&#39;uno&#39;</span><span class="tok-p">,</span> <span class="tok-s1">&#39;JavaScript&#39;</span><span class="tok-p">);</span>
<span class="tok-nx">formDataObj</span><span class="tok-p">.</span><span class="tok-nx">append</span><span class="tok-p">(</span><span class="tok-s1">&#39;dos&#39;</span><span class="tok-p">,</span> <span class="tok-s1">&#39;jQuery&#39;</span><span class="tok-p">);</span>
<span class="tok-nx">formDataObj</span><span class="tok-p">.</span><span class="tok-nx">append</span><span class="tok-p">(</span><span class="tok-s1">&#39;tres&#39;</span><span class="tok-p">,</span> <span class="tok-s1">&#39;HTML5&#39;</span><span class="tok-p">);</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Más información en <a href="https://developer.mozilla.org/es/docs/Web/Guide/Usando_Objetos_FormData" class="bare">https://developer.mozilla.org/es/docs/Web/Guide/Usando_Objetos_FormData</a></p>
</div>
<div class="sect4">
<h5 id="_envío_mediante_get">Envío mediante GET</h5>
<div class="paragraph">
<p>A la hora de hacer el envío, mediante el método <code>send()</code> de la petición le podemos pasar una cadena compuesta por pares de <code>variable=valor</code>, separadas por <code>&amp;</code>, con los valores codificados mediante la función <code>encodeURIComponent</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="javascript"><span class="tok-kd">var</span> <span class="tok-nx">valor</span> <span class="tok-o">=</span> <span class="tok-s2">&quot;Somos la Ñ&quot;</span><span class="tok-p">;</span>
<span class="tok-kd">var</span> <span class="tok-nx">datos</span> <span class="tok-o">=</span> <span class="tok-s2">&quot;uno=JavaScript&amp;cuatro=&quot;</span> <span class="tok-o">+</span> <span class="tok-nb">encodeURIComponent</span><span class="tok-p">(</span><span class="tok-nx">valor</span><span class="tok-p">);</span>
<span class="tok-c1">// uno=JavaScript&amp;cuatro=Somos%20la%20%C3%91</span>

<span class="tok-kd">var</span> <span class="tok-nx">xhr</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-nx">XMLHttpRequest</span><span class="tok-p">();</span>
<span class="tok-nx">xhr</span><span class="tok-p">.</span><span class="tok-nx">open</span><span class="tok-p">(</span><span class="tok-s2">&quot;GET&quot;</span><span class="tok-p">,</span> <span class="tok-s2">&quot;fichero.txt&quot;</span><span class="tok-p">,</span> <span class="tok-kc">true</span><span class="tok-p">);</span>
<span class="tok-c1">// resto de código AJAX</span>
<span class="tok-nx">xhr</span><span class="tok-p">.</span><span class="tok-nx">send</span><span class="tok-p">(</span><span class="tok-nx">datos</span><span class="tok-p">);</span></code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_envío_mediante_post">Envío mediante POST</h5>
<div class="paragraph">
<p>Para poder enviar datos con POST, a la hora de abrir la conexión le indicaremos el método de envío mediante <code>xhr.setRequestHeader(
'Content-Type', 'application/x-www-form-urlencoded')</code> o el tipo de contenido deseado (<code>multipart/form-data</code>, <code>text/xml</code>, <code>application/json</code>, &#8230;&#8203;).</p>
</div>
<div class="paragraph">
<p>Tras esto, al enviar la petición los datos como una cadena o mediante un objeto <code>FormData</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="javascript"><span class="tok-kd">var</span> <span class="tok-nx">xhr</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-nx">XMLHttpRequest</span><span class="tok-p">();</span>
<span class="tok-nx">xhr</span><span class="tok-p">.</span><span class="tok-nx">open</span><span class="tok-p">(</span><span class="tok-s2">&quot;POST&quot;</span><span class="tok-p">,</span><span class="tok-s2">&quot;fichero.txt&quot;</span><span class="tok-p">,</span> <span class="tok-kc">true</span><span class="tok-p">);</span> <i class="conum" data-value="1"></i><b>(1)</b>
<span class="tok-nx">xhr</span><span class="tok-p">.</span><span class="tok-nx">setRequestHeader</span><span class="tok-p">(</span><span class="tok-s2">&quot;Content-Type&quot;</span><span class="tok-p">,</span><span class="tok-s2">&quot;application/x-www-form-urlencoded&quot;</span><span class="tok-p">);</span> <i class="conum" data-value="2"></i><b>(2)</b>
<span class="tok-c1">// Resto de código AJAX</span>
<span class="tok-nx">xhr</span><span class="tok-p">.</span><span class="tok-nx">send</span><span class="tok-p">(</span><span class="tok-s2">&quot;heroe=Batman&quot;</span><span class="tok-p">);</span> <i class="conum" data-value="3"></i><b>(3)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Primer parámetro a <code>POST</code></td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Indicamos el tipo de contenido que envía el formulario</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Le adjuntamos datos de envío como una cadena, o un objeto <code>FormData</code></td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_eventos_2">5.1.4. Eventos</h4>
<div class="paragraph">
<p>Toda petición AJAX lanza una serie de eventos conforme se realiza y completa la comunicación, ya sea al descargar datos del servidor como al enviarlos. Los eventos que podemos gestionar y el motivo de su lanzamiento son:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>loadstart</code>: se lanza al iniciarse la petición</p>
</li>
<li>
<p><code>progress</code>: se lanza múltiples veces conforme se transfiere la información</p>
</li>
<li>
<p><code>load</code>: al completarse la transferencia</p>
</li>
<li>
<p><code>error</code>: se produce un error</p>
</li>
<li>
<p><code>abort</code>: el usuario cancela la petición</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Todos estos eventos se tienen que añadir antes de abrir la petición.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="javascript"><span class="tok-kd">var</span> <span class="tok-nx">xhr</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-nx">XMLHttpRequest</span><span class="tok-p">();</span>
<span class="tok-nx">xhr</span><span class="tok-p">.</span><span class="tok-nx">addEventListener</span><span class="tok-p">(</span><span class="tok-s1">&#39;loadstart&#39;</span><span class="tok-p">,</span> <span class="tok-nx">onLoadStart</span><span class="tok-p">,</span> <span class="tok-kc">false</span><span class="tok-p">);</span>
<span class="tok-nx">xhr</span><span class="tok-p">.</span><span class="tok-nx">addEventListener</span><span class="tok-p">(</span><span class="tok-s1">&#39;progress&#39;</span><span class="tok-p">,</span> <span class="tok-nx">onProgress</span><span class="tok-p">,</span> <span class="tok-kc">false</span><span class="tok-p">);</span>
<span class="tok-nx">xhr</span><span class="tok-p">.</span><span class="tok-nx">addEventListener</span><span class="tok-p">(</span><span class="tok-s1">&#39;load&#39;</span><span class="tok-p">,</span> <span class="tok-nx">onLoad</span><span class="tok-p">,</span> <span class="tok-kc">false</span><span class="tok-p">);</span>
<span class="tok-nx">xhr</span><span class="tok-p">.</span><span class="tok-nx">addEventListener</span><span class="tok-p">(</span><span class="tok-s1">&#39;error&#39;</span><span class="tok-p">,</span> <span class="tok-nx">onError</span><span class="tok-p">,</span> <span class="tok-kc">false</span><span class="tok-p">);</span>
<span class="tok-nx">xhr</span><span class="tok-p">.</span><span class="tok-nx">addEventListener</span><span class="tok-p">(</span><span class="tok-s1">&#39;abort&#39;</span><span class="tok-p">,</span> <span class="tok-nx">onAbort</span><span class="tok-p">,</span> <span class="tok-kc">false</span><span class="tok-p">);</span>

<span class="tok-nx">xhr</span><span class="tok-p">.</span><span class="tok-nx">open</span><span class="tok-p">(</span><span class="tok-s1">&#39;GET&#39;</span><span class="tok-p">,</span> <span class="tok-s1">&#39;http://www.omdbapi.com/?s=batman&#39;</span><span class="tok-p">);</span>

<span class="tok-kd">function</span> <span class="tok-nx">onLoadStart</span><span class="tok-p">(</span><span class="tok-nx">evt</span><span class="tok-p">)</span> <span class="tok-p">{</span>
  <span class="tok-nx">console</span><span class="tok-p">.</span><span class="tok-nx">log</span><span class="tok-p">(</span><span class="tok-s1">&#39;Iniciando la petición&#39;</span><span class="tok-p">);</span>
<span class="tok-p">}</span>

<span class="tok-kd">function</span> <span class="tok-nx">onProgress</span><span class="tok-p">(</span><span class="tok-nx">evt</span><span class="tok-p">)</span> <span class="tok-p">{</span>
  <span class="tok-kd">var</span> <span class="tok-nx">porcentajeActual</span> <span class="tok-o">=</span> <span class="tok-p">(</span><span class="tok-nx">evt</span><span class="tok-p">.</span><span class="tok-nx">loaded</span> <span class="tok-o">/</span> <span class="tok-nx">evt</span><span class="tok-p">.</span><span class="tok-nx">total</span><span class="tok-p">)</span> <span class="tok-o">*</span> <span class="tok-mi">100</span><span class="tok-p">;</span>   <i class="conum" data-value="1"></i><b>(1)</b>
  <span class="tok-nx">console</span><span class="tok-p">.</span><span class="tok-nx">log</span><span class="tok-p">(</span><span class="tok-nx">porcentajeActual</span><span class="tok-p">);</span>
<span class="tok-p">}</span>

<span class="tok-kd">function</span> <span class="tok-nx">onLoad</span><span class="tok-p">(</span><span class="tok-nx">evt</span><span class="tok-p">)</span> <span class="tok-p">{</span>
  <span class="tok-nx">console</span><span class="tok-p">.</span><span class="tok-nx">log</span><span class="tok-p">(</span><span class="tok-s1">&#39;Transferencia completada&#39;</span><span class="tok-p">);</span>
<span class="tok-p">}</span>

<span class="tok-kd">function</span> <span class="tok-nx">onError</span><span class="tok-p">(</span><span class="tok-nx">evt</span><span class="tok-p">)</span> <span class="tok-p">{</span>
  <span class="tok-nx">console</span><span class="tok-p">.</span><span class="tok-nx">error</span><span class="tok-p">(</span><span class="tok-s1">&#39;Error durante la transferenciaº&#39;</span><span class="tok-p">);</span>
<span class="tok-p">}</span>

<span class="tok-kd">function</span> <span class="tok-nx">onAbort</span><span class="tok-p">(</span><span class="tok-nx">evt</span><span class="tok-p">)</span> <span class="tok-p">{</span>
  <span class="tok-nx">console</span><span class="tok-p">.</span><span class="tok-nx">error</span><span class="tok-p">(</span><span class="tok-s1">&#39;El usuario ha cancelado la petición&#39;</span><span class="tok-p">);</span>
<span class="tok-p">}</span></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Mediante las propiedades <code>loaded</code> y <code>total</code> del evento, podemos obtener el porcentaje del archivo descargado.</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_respuesta_http">5.1.5. Respuesta HTTP</h4>
<div class="paragraph">
<p>Si el tipo de datos obtenido de una petición no es una cadena, podemos indicarlo mediante el atributo <code>responseType</code>, el cual puede contener los siguientes valores: <code>text</code>, <code>arraybuffer</code>, <code>document</code> (para documentos XML o HTML), <code>blob</code> o <code>json</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="javascript"><span class="tok-kd">var</span> <span class="tok-nx">xhr</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-nx">XMLHttpRequest</span><span class="tok-p">();</span>
<span class="tok-nx">xhr</span><span class="tok-p">.</span><span class="tok-nx">open</span><span class="tok-p">(</span><span class="tok-s1">&#39;GET&#39;</span><span class="tok-p">,</span> <span class="tok-s1">&#39;http://expertojava.ua.es/experto/publico/imagenes/logo-completo.png&#39;</span><span class="tok-p">,</span> <span class="tok-kc">true</span><span class="tok-p">);</span>

<span class="tok-nx">xhr</span><span class="tok-p">.</span><span class="tok-nx">responseType</span> <span class="tok-o">=</span> <span class="tok-s1">&#39;blob&#39;</span><span class="tok-p">;</span> <i class="conum" data-value="1"></i><b>(1)</b>

<span class="tok-nx">xhr</span><span class="tok-p">.</span><span class="tok-nx">addEventListener</span><span class="tok-p">(</span><span class="tok-s1">&#39;load&#39;</span><span class="tok-p">,</span> <span class="tok-nx">finDescarga</span><span class="tok-p">,</span> <span class="tok-kc">false</span><span class="tok-p">);</span>
<span class="tok-nx">xhr</span><span class="tok-p">.</span><span class="tok-nx">send</span><span class="tok-p">();</span>

<span class="tok-kd">function</span> <span class="tok-nx">finDescarga</span><span class="tok-p">(</span><span class="tok-nx">evt</span><span class="tok-p">)</span> <span class="tok-p">{</span>
  <span class="tok-k">if</span> <span class="tok-p">(</span><span class="tok-k">this</span><span class="tok-p">.</span><span class="tok-nx">status</span> <span class="tok-o">==</span> <span class="tok-mi">200</span><span class="tok-p">)</span> <span class="tok-p">{</span>
    <span class="tok-kd">var</span> <span class="tok-nx">blob</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-nx">Blob</span><span class="tok-p">([</span><span class="tok-k">this</span><span class="tok-p">.</span><span class="tok-nx">response</span><span class="tok-p">],</span> <span class="tok-p">{</span><span class="tok-nx">type</span><span class="tok-o">:</span> <span class="tok-s1">&#39;img/png&#39;</span><span class="tok-p">});</span>
    <span class="tok-nb">document</span><span class="tok-p">.</span><span class="tok-nx">getElementById</span><span class="tok-p">(</span><span class="tok-s2">&quot;datos&quot;</span><span class="tok-p">).</span><span class="tok-nx">src</span> <span class="tok-o">=</span> <span class="tok-nx">blob</span><span class="tok-p">;</span>
  <span class="tok-p">}</span>
<span class="tok-p">}</span></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Indicamos que el tipo de la imagen es un <em>blob</em></td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_json">5.2. JSON</h3>
<div class="paragraph">
<p>Tal como vimos en el módulo de Servicios <em>REST</em>, <em>JSON</em> es un formato de texto que almacena datos reconocibles como objetos por <em>JavaScript</em>. Pese a que <em>AJAX</em> nació de la mano de <em>XML</em> como el formato idóneo de intercambio de datos, <em>JSON</em> se ha convertido en el estándar de facto para el intercambio de datos entre navegador y servidor, ya que se trata de un formato más eficiente y con una sintaxis de acceso a las propiedades más sencilla.</p>
</div>
<div class="paragraph">
<p>Supongamos que tenemos un archivo de texto (<code>heroes.json</code>) con información representada en <em>JSON</em>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="javascript"><span class="tok-p">{</span>
  <span class="tok-s2">&quot;nombre&quot;</span><span class="tok-o">:</span> <span class="tok-s2">&quot;Batman&quot;</span><span class="tok-p">,</span>
  <span class="tok-s2">&quot;email&quot;</span><span class="tok-o">:</span> <span class="tok-s2">&quot;batman@heroes.com&quot;</span><span class="tok-p">,</span>
  <span class="tok-s2">&quot;gadgets&quot;</span><span class="tok-o">:</span> <span class="tok-p">[</span><span class="tok-s2">&quot;batmovil&quot;</span><span class="tok-p">,</span><span class="tok-s2">&quot;batarang&quot;</span><span class="tok-p">],</span>
  <span class="tok-s2">&quot;amigos&quot;</span><span class="tok-o">:</span> <span class="tok-p">[</span>
    <span class="tok-p">{</span> <span class="tok-s2">&quot;nombre&quot;</span><span class="tok-o">:</span> <span class="tok-s2">&quot;Robin&quot;</span><span class="tok-p">,</span> <span class="tok-s2">&quot;email&quot;</span><span class="tok-o">:</span> <span class="tok-s2">&quot;robin@heroes.com&quot;</span><span class="tok-p">},</span>
    <span class="tok-p">{</span> <span class="tok-s2">&quot;nombre&quot;</span><span class="tok-o">:</span> <span class="tok-s2">&quot;Cat Woman&quot;</span><span class="tok-p">,</span> <span class="tok-s2">&quot;email&quot;</span><span class="tok-o">:</span> <span class="tok-s2">&quot;catwoman@heroes.com&quot;</span><span class="tok-p">}</span>
  <span class="tok-p">]</span>
<span class="tok-p">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Si queremos recuperarla mediante <em>AJAX</em>, una vez recuperada la información del servidor, desde <em>ES5</em> podemos usar el objeto <code>JSON</code> para interactuar con el texto. Este objeto ofrece los siguientes métodos:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>JSON.stringify(<em>objeto</em>)</code> obtiene la representación <em>JSON</em> de un <em>objeto</em> como una cadena, es decir, serializa el objeto, omitiendo todas las funciones, las propiedades con valores <code>undefined</code> y propiedades del prototipo.</p>
</li>
<li>
<p><code>JSON.parse(<em>cadena</em>)</code> parsea una <em>cadena</em> <em>JSON</em> en un objeto <em>JavaScript</em>.</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="javascript"><span class="tok-kd">var</span> <span class="tok-nx">batman</span> <span class="tok-o">=</span> <span class="tok-p">{</span> <span class="tok-s2">&quot;nombre&quot;</span><span class="tok-o">:</span> <span class="tok-s2">&quot;Batman&quot;</span><span class="tok-p">,</span> <span class="tok-s2">&quot;email&quot;</span><span class="tok-o">:</span> <span class="tok-s2">&quot;batman@heroes.com&quot;</span> <span class="tok-p">};</span>
<span class="tok-kd">var</span> <span class="tok-nx">batmanTexto</span> <span class="tok-o">=</span> <span class="tok-nx">JSON</span><span class="tok-p">.</span><span class="tok-nx">stringify</span><span class="tok-p">(</span><span class="tok-nx">batman</span><span class="tok-p">);</span>
<span class="tok-kd">var</span> <span class="tok-nx">batmanOBjeto</span> <span class="tok-o">=</span> <span class="tok-nx">JSON</span><span class="tok-p">.</span><span class="tok-nx">parse</span><span class="tok-p">(</span><span class="tok-nx">batmanTexto</span><span class="tok-p">);</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Así pues, volvamos al código AJAX. Una vez recuperada la información del servidor, la transformamos a un objeto mediante <code>JSON.parse()</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="javascript"><span class="tok-kd">var</span> <span class="tok-nx">xhr</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-nx">XMLHttpRequest</span><span class="tok-p">();</span>
<span class="tok-nx">xhr</span><span class="tok-p">.</span><span class="tok-nx">open</span><span class="tok-p">(</span><span class="tok-s2">&quot;GET&quot;</span><span class="tok-p">,</span><span class="tok-s2">&quot;heroes.json&quot;</span><span class="tok-p">,</span> <span class="tok-kc">true</span><span class="tok-p">);</span>
<span class="tok-nx">xhr</span><span class="tok-p">.</span><span class="tok-nx">onreadystatechange</span> <span class="tok-o">=</span> <span class="tok-kd">function</span><span class="tok-p">()</span> <span class="tok-p">{</span>
  <span class="tok-k">if</span> <span class="tok-p">(</span><span class="tok-nx">xhr</span><span class="tok-p">.</span><span class="tok-nx">readyState</span> <span class="tok-o">===</span> <span class="tok-mi">4</span><span class="tok-p">)</span> <span class="tok-p">{</span>
    <span class="tok-kd">var</span> <span class="tok-nx">respuesta</span> <span class="tok-o">=</span> <span class="tok-nx">JSON</span><span class="tok-p">.</span><span class="tok-nx">parse</span><span class="tok-p">(</span><span class="tok-nx">xhr</span><span class="tok-p">.</span><span class="tok-nx">responseText</span><span class="tok-p">);</span>  <i class="conum" data-value="1"></i><b>(1)</b>
    <span class="tok-nx">alert</span><span class="tok-p">(</span><span class="tok-nx">respuesta</span><span class="tok-p">.</span><span class="tok-nx">nombre</span><span class="tok-p">);</span>  <i class="conum" data-value="2"></i><b>(2)</b>
  <span class="tok-p">}</span>
<span class="tok-p">};</span>
<span class="tok-nx">xhr</span><span class="tok-p">.</span><span class="tok-nx">send</span><span class="tok-p">(</span><span class="tok-kc">null</span><span class="tok-p">);</span></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Con el texto recibido, lo deserializamos en un objeto respuesta</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Si hiciéramos un alert de <code>resp</code> tendríamos un objeto, por lo que podemos acceder a las propiedades.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Si quisiéramos enviar datos al servidor en formato JSON, realizaremos una petición POST indicándole como tipo de contenido <code>application/json</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="javascript"><span class="tok-kd">var</span> <span class="tok-nx">xhr</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-nx">XMLHttpRequest</span><span class="tok-p">();</span>
<span class="tok-nx">xhr</span><span class="tok-p">.</span><span class="tok-nx">open</span><span class="tok-p">(</span><span class="tok-s2">&quot;POST&quot;</span><span class="tok-p">,</span><span class="tok-s2">&quot;fichero.txt&quot;</span><span class="tok-p">,</span> <span class="tok-kc">true</span><span class="tok-p">);</span>
<span class="tok-nx">xhr</span><span class="tok-p">.</span><span class="tok-nx">setRequestHeader</span><span class="tok-p">(</span><span class="tok-s2">&quot;Content-Type&quot;</span><span class="tok-p">,</span><span class="tok-s2">&quot;application/json&quot;</span><span class="tok-p">);</span>
<span class="tok-nx">xhr</span><span class="tok-p">.</span><span class="tok-nx">onreadystatechange</span> <span class="tok-o">=</span> <span class="tok-kd">function</span><span class="tok-p">()</span> <span class="tok-p">{</span>
  <span class="tok-c1">// código del manejador</span>
<span class="tok-p">};</span>
<span class="tok-nx">xhr</span><span class="tok-p">.</span><span class="tok-nx">send</span><span class="tok-p">(</span><span class="tok-nx">JSON</span><span class="tok-p">.</span><span class="tok-nx">stringify</span><span class="tok-p">(</span><span class="tok-nx">objeto</span><span class="tok-p">));</span></code></pre>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="title">eval</div>
<div class="paragraph">
<p>Si el navegador no soporta ES5, podemos usar la función <code>eval(codigo)</code> que evalúa una cadena como código <em>JavaScript</em>. Así pues, podríamos hacer:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="javascript"><span class="tok-kd">var</span> <span class="tok-nx">textoRespuesta</span> <span class="tok-o">=</span> <span class="tok-nx">xhr</span><span class="tok-p">.</span><span class="tok-nx">responseText</span><span class="tok-p">;</span>
<span class="tok-kd">var</span> <span class="tok-nx">objRespuesta</span> <span class="tok-o">=</span> <span class="tok-nb">eval</span><span class="tok-p">(</span> <span class="tok-s2">&quot;(&quot;</span> <span class="tok-o">+</span> <span class="tok-nx">textoRespuesta</span> <span class="tok-o">+</span> <span class="tok-s2">&quot;)&quot;</span> <span class="tok-p">);</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>El problema de <code>eval</code> es que además de evaluar <em>JSON</em>, también puede evaluar código malicioso, con lo que su uso no se recomienda.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="sect3">
<h4 id="_filtrando_campos">5.2.1. Filtrando campos</h4>
<div class="paragraph">
<p>Al serializar un objeto mediante <code>stringify</code> podemos indicar tanto los campos que queremos incluir como el número de espacios utilizados como sangría del código.</p>
</div>
<div class="paragraph">
<p>Primero nos centraremos en el filtrado de campos. El segundo parámetro de <code>stringify</code> puede ser:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>un <em>array</em> con los campos que se incluirán al serializar</p>
</li>
<li>
<p>una función que recibe una clave y una propiedad, y que permite modificar el comportamiento de la operación. Si para un campo devuelve <code>undefined</code> dicho campo no se serializará.</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="javascript"><span class="tok-kd">var</span> <span class="tok-nx">heroe</span> <span class="tok-o">=</span> <span class="tok-p">{</span>
  <span class="tok-nx">nombre</span><span class="tok-o">:</span> <span class="tok-s2">&quot;Batman&quot;</span><span class="tok-p">,</span>
  <span class="tok-nx">email</span><span class="tok-o">:</span> <span class="tok-s2">&quot;batman@heroes.com&quot;</span><span class="tok-p">,</span>
  <span class="tok-nx">gadgets</span><span class="tok-o">:</span> <span class="tok-p">[</span><span class="tok-s2">&quot;batmovil&quot;</span><span class="tok-p">,</span> <span class="tok-s2">&quot;batarang&quot;</span><span class="tok-p">],</span>
  <span class="tok-nx">amigos</span><span class="tok-o">:</span> <span class="tok-p">[</span>
    <span class="tok-p">{</span> <span class="tok-nx">nombre</span><span class="tok-o">:</span> <span class="tok-s2">&quot;Robin&quot;</span><span class="tok-p">,</span> <span class="tok-nx">email</span><span class="tok-o">:</span> <span class="tok-s2">&quot;robin@heroes.com&quot;</span><span class="tok-p">},</span>
    <span class="tok-p">{</span> <span class="tok-nx">nombre</span><span class="tok-o">:</span> <span class="tok-s2">&quot;Cat Woman&quot;</span><span class="tok-p">,</span> <span class="tok-nx">email</span><span class="tok-o">:</span> <span class="tok-s2">&quot;catwoman@heroes.com&quot;</span><span class="tok-p">}</span>
  <span class="tok-p">]</span>
<span class="tok-p">};</span>

<span class="tok-kd">var</span> <span class="tok-nx">nomEmail</span> <span class="tok-o">=</span> <span class="tok-nx">JSON</span><span class="tok-p">.</span><span class="tok-nx">stringify</span><span class="tok-p">(</span><span class="tok-nx">heroe</span><span class="tok-p">,</span> <span class="tok-p">[</span><span class="tok-s2">&quot;nombre&quot;</span><span class="tok-p">,</span> <span class="tok-s2">&quot;email&quot;</span><span class="tok-p">]);</span>
<span class="tok-kd">var</span> <span class="tok-nx">joker</span> <span class="tok-o">=</span> <span class="tok-nx">JSON</span><span class="tok-p">.</span><span class="tok-nx">stringify</span><span class="tok-p">(</span><span class="tok-nx">heroe</span><span class="tok-p">,</span> <span class="tok-kd">function</span> <span class="tok-p">(</span><span class="tok-nx">clave</span><span class="tok-p">,</span> <span class="tok-nx">valor</span><span class="tok-p">)</span> <span class="tok-p">{</span>
  <span class="tok-k">switch</span> <span class="tok-p">(</span><span class="tok-nx">clave</span><span class="tok-p">)</span> <span class="tok-p">{</span>
    <span class="tok-k">case</span> <span class="tok-s2">&quot;nombre&quot;</span><span class="tok-o">:</span>
      <span class="tok-k">return</span> <span class="tok-s2">&quot;Joker&quot;</span><span class="tok-p">;</span>
    <span class="tok-k">case</span> <span class="tok-s2">&quot;email&quot;</span><span class="tok-o">:</span>
      <span class="tok-k">return</span> <span class="tok-s2">&quot;joker_&quot;</span> <span class="tok-o">+</span> <span class="tok-nx">valor</span><span class="tok-p">;</span>
    <span class="tok-k">case</span> <span class="tok-s2">&quot;gadgets&quot;</span><span class="tok-o">:</span>
      <span class="tok-k">return</span> <span class="tok-nx">valor</span><span class="tok-p">.</span><span class="tok-nx">join</span><span class="tok-p">(</span><span class="tok-s2">&quot; y &quot;</span><span class="tok-p">);</span>
    <span class="tok-k">default</span><span class="tok-o">:</span>
      <span class="tok-k">return</span> <span class="tok-nx">valor</span><span class="tok-p">;</span>
  <span class="tok-p">}</span>
<span class="tok-p">});</span>

<span class="tok-nx">console</span><span class="tok-p">.</span><span class="tok-nx">log</span><span class="tok-p">(</span><span class="tok-nx">nomEmail</span><span class="tok-p">);</span> <span class="tok-c1">// {&quot;nombre&quot;:&quot;Batman&quot;,&quot;email&quot;:&quot;batman@heroes.com&quot;}</span>
<span class="tok-nx">console</span><span class="tok-p">.</span><span class="tok-nx">log</span><span class="tok-p">(</span><span class="tok-nx">joker</span><span class="tok-p">);</span> <span class="tok-c1">// {&quot;nombre&quot;:&quot;Joker&quot;,&quot;email&quot;:&quot;joker_batman@heroes.com&quot;,&quot;gadgets&quot;:&quot;batmovil y batarang&quot;,&quot;amigos&quot;:[{&quot;nombre&quot;:&quot;Joker&quot;,&quot;email&quot;:&quot;joker_robin@heroes.com&quot;},{&quot;nombre&quot;:&quot;Joker&quot;,&quot;email&quot;:&quot;joker_catwoman@heroes.com&quot;}]}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>En el caso de querer indentar el código, con el tercer parámetro le indicamos con un número (entre 1 y 10) la cantidad de espacios utilizados como sangría, y en el caso de pasarle un carácter, será el elemento utilizado como separador.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="javascript"><span class="tok-nx">console</span><span class="tok-p">.</span><span class="tok-nx">log</span><span class="tok-p">(</span><span class="tok-nx">JSON</span><span class="tok-p">.</span><span class="tok-nx">stringify</span><span class="tok-p">(</span><span class="tok-nx">heroe</span><span class="tok-p">,</span> <span class="tok-p">[</span><span class="tok-s2">&quot;nombre&quot;</span><span class="tok-p">,</span> <span class="tok-s2">&quot;email&quot;</span><span class="tok-p">]));</span>
<span class="tok-nx">console</span><span class="tok-p">.</span><span class="tok-nx">log</span><span class="tok-p">(</span><span class="tok-nx">JSON</span><span class="tok-p">.</span><span class="tok-nx">stringify</span><span class="tok-p">(</span><span class="tok-nx">heroe</span><span class="tok-p">,</span> <span class="tok-p">[</span><span class="tok-s2">&quot;nombre&quot;</span><span class="tok-p">,</span> <span class="tok-s2">&quot;email&quot;</span><span class="tok-p">],</span> <span class="tok-mi">4</span><span class="tok-p">));</span>
<span class="tok-nx">console</span><span class="tok-p">.</span><span class="tok-nx">log</span><span class="tok-p">(</span><span class="tok-nx">JSON</span><span class="tok-p">.</span><span class="tok-nx">stringify</span><span class="tok-p">(</span><span class="tok-nx">heroe</span><span class="tok-p">,</span> <span class="tok-p">[</span><span class="tok-s2">&quot;nombre&quot;</span><span class="tok-p">,</span> <span class="tok-s2">&quot;email&quot;</span><span class="tok-p">],</span> <span class="tok-s2">&quot;&lt;-&gt;&quot;</span><span class="tok-p">));</span></code></pre>
</div>
</div>
<div class="imageblock">
<div class="content">
<img src="images/js05/jsonStringify.jpg" alt="Personalizando la serialización de JSON">
</div>
<div class="title">Figure 28. Personalizando la serialización de JSON</div>
</div>
</div>
<div class="sect3">
<h4 id="_ejemplo_omdb">5.2.2. Ejemplo OMDB</h4>
<div class="paragraph">
<p>Una vez que sabemos como parsear una respuesta JSON, vamos a mostrar un ejemplo completo de una petición AJAX al servidor de OMDB para obtener los datos de una película. Al realizar una petición de búsqueda con <a href="http://www.omdbapi.com/?s=batman" class="bare">http://www.omdbapi.com/?s=batman</a>, en OMDB, obtendremos una respuesta tal que así:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="json"><span class="tok-p">{</span><span class="tok-nt">&quot;Search&quot;</span><span class="tok-p">:[</span>
  <span class="tok-p">{</span><span class="tok-nt">&quot;Title&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;Batman Begins&quot;</span><span class="tok-p">,</span><span class="tok-nt">&quot;Year&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;2005&quot;</span><span class="tok-p">,</span><span class="tok-nt">&quot;imdbID&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;tt0372784&quot;</span><span class="tok-p">,</span><span class="tok-nt">&quot;Type&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;movie&quot;</span><span class="tok-p">,</span><span class="tok-nt">&quot;Poster&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;http://ia.media-imdb.com/images/M/MV5BNTM3OTc0MzM2OV5BMl5BanBnXkFtZTYwNzUwMTI3._V1_SX300.jpg&quot;</span><span class="tok-p">},</span>
  <span class="tok-p">{</span><span class="tok-nt">&quot;Title&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;Batman&quot;</span><span class="tok-p">,</span><span class="tok-nt">&quot;Year&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;1989&quot;</span><span class="tok-p">,</span><span class="tok-nt">&quot;imdbID&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;tt0096895&quot;</span><span class="tok-p">,</span><span class="tok-nt">&quot;Type&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;movie&quot;</span><span class="tok-p">,</span><span class="tok-nt">&quot;Poster&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;http://ia.media-imdb.com/images/M/MV5BMTYwNjAyODIyMF5BMl5BanBnXkFtZTYwNDMwMDk2._V1_SX300.jpg&quot;</span><span class="tok-p">},</span>
  <span class="tok-p">{</span><span class="tok-nt">&quot;Title&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;Batman Returns&quot;</span><span class="tok-p">,</span><span class="tok-nt">&quot;Year&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;1992&quot;</span><span class="tok-p">,</span><span class="tok-nt">&quot;imdbID&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;tt0103776&quot;</span><span class="tok-p">,</span><span class="tok-nt">&quot;Type&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;movie&quot;</span><span class="tok-p">,</span><span class="tok-nt">&quot;Poster&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;http://ia.media-imdb.com/images/M/MV5BODM2OTc0Njg2OF5BMl5BanBnXkFtZTgwMDA4NjQxMTE@._V1_SX300.jpg&quot;</span><span class="tok-p">},</span>
  <span class="tok-err">...</span>
<span class="tok-p">]}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Por lo tanto, para mostrar el título y el año de las peliculas encontradas haremos:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="javascript"><span class="tok-kd">var</span> <span class="tok-nx">xhr</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-nx">XMLHttpRequest</span><span class="tok-p">();</span>
<span class="tok-nx">xhr</span><span class="tok-p">.</span><span class="tok-nx">open</span><span class="tok-p">(</span><span class="tok-s1">&#39;GET&#39;</span><span class="tok-p">,</span> <span class="tok-s1">&#39;http://www.omdbapi.com/?s=batman&#39;</span><span class="tok-p">,</span> <span class="tok-s1">&#39;true&#39;</span><span class="tok-p">);</span>
<span class="tok-nx">xhr</span><span class="tok-p">.</span><span class="tok-nx">onreadystatechange</span> <span class="tok-o">=</span> <span class="tok-kd">function</span><span class="tok-p">()</span> <span class="tok-p">{</span>
    <span class="tok-k">if</span> <span class="tok-p">(</span><span class="tok-nx">xhr</span><span class="tok-p">.</span><span class="tok-nx">readyState</span> <span class="tok-o">===</span> <span class="tok-mi">4</span><span class="tok-p">)</span> <span class="tok-p">{</span>
        <span class="tok-nx">mostrarPelicula</span><span class="tok-p">(</span><span class="tok-nx">xhr</span><span class="tok-p">.</span><span class="tok-nx">responseText</span><span class="tok-p">);</span>  <i class="conum" data-value="1"></i><b>(1)</b>
    <span class="tok-p">}</span>
<span class="tok-p">};</span>
<span class="tok-nx">xhr</span><span class="tok-p">.</span><span class="tok-nx">send</span><span class="tok-p">(</span><span class="tok-kc">null</span><span class="tok-p">);</span>

<span class="tok-kd">function</span> <span class="tok-nx">mostrarPelicula</span><span class="tok-p">(</span><span class="tok-nx">datos</span><span class="tok-p">)</span> <span class="tok-p">{</span>
    <span class="tok-kd">var</span> <span class="tok-nx">o</span> <span class="tok-o">=</span> <span class="tok-nx">JSON</span><span class="tok-p">.</span><span class="tok-nx">parse</span><span class="tok-p">(</span><span class="tok-nx">datos</span><span class="tok-p">);</span>  <i class="conum" data-value="2"></i><b>(2)</b>
    <span class="tok-kd">var</span> <span class="tok-nx">pelis</span> <span class="tok-o">=</span> <span class="tok-nx">o</span><span class="tok-p">.</span><span class="tok-nx">Search</span><span class="tok-p">;</span>
    <span class="tok-k">for</span> <span class="tok-p">(</span><span class="tok-nx">numPeli</span> <span class="tok-k">in</span> <span class="tok-nx">pelis</span><span class="tok-p">)</span> <span class="tok-p">{</span>
        <span class="tok-nx">console</span><span class="tok-p">.</span><span class="tok-nx">log</span><span class="tok-p">(</span><span class="tok-nx">pelis</span><span class="tok-p">[</span><span class="tok-nx">numPeli</span><span class="tok-p">].</span><span class="tok-nx">Title</span> <span class="tok-o">+</span> <span class="tok-s2">&quot; - &quot;</span> <span class="tok-o">+</span> <span class="tok-nx">pelis</span><span class="tok-p">[</span><span class="tok-nx">numPeli</span><span class="tok-p">].</span><span class="tok-nx">Year</span><span class="tok-p">);</span>
    <span class="tok-p">}</span>
<span class="tok-p">}</span></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Una vez recibida la respuesta, desacoplamos la petición del tratamiento de la respuesta</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Transformamos los datos recibidos como JSON en un objeto para facilitar su manejo</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_cross_domain">5.2.3. Cross-Domain</h4>
<div class="paragraph">
<p>Sabemos que el navegador funciona como <em>sandbox</em> y restringe las peticiones <em>AJAX</em>, de modo que sólo permite realizar peticiones a recursos que se encuentren en el mismo dominio.</p>
</div>
<div class="paragraph">
<p>Esta restricción de conoce como <em>Same-Origin Policy</em>, y para ello las peticiones tienen que compartir protocolo, servidor y puerto. Esta política también fija que desde un dominio A se puede realizar una petición a un dominio B, pero no se puede obtener ninguna información de la petición hacia B, ni la respuesta ni siquiera el código de respuesta.</p>
</div>
<div class="paragraph">
<p>El uso de <em>cross-domain AJAX</em> permite romper esta política bajo ciertas circunstancias, dependiendo de la técnica utilizada:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Proxy</strong> en el servidor: creamos un servicio en nuestro servidor que <em>retransmita</em> la petición al host al que queremos llegar. Como las peticiones desde el lado del servidor no están restringidas, no habrá ningún problema.</p>
<div class="imageblock">
<div class="content">
<img src="images/js05/ajaxProxyYahoo.gif" alt="Proxy en el servidor">
</div>
<div class="title">Figure 29. Proxy en el Servidor</div>
</div>
</li>
<li>
<p><strong>CORS</strong> (<em>Cross-Origin Resource Sharing</em>): Si el servidor al que le haces la petición la permite (enviando la cabecera <code>Access-Control-Allow-Origin</code>), el navegador también dejará que se realice. Para ello, los servidores tienen que especificar que permiten peticiones de otros dominios.</p>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="conf">Access-Control-Allow-Credentials:<span class="tok-w"> </span>true<span class="tok-w"></span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Además, en el código del cliente, hemos de comprobar si la conexión se ha realizado con credenciales (el objeto <code>XMLHttpRequest</code> contiene la propiedad <code>withCredentials</code> a <code>true</code>):</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="javascript"><span class="tok-kd">var</span> <span class="tok-nx">xhr</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-nx">XMLHttpRequest</span><span class="tok-p">();</span>
<span class="tok-k">if</span> <span class="tok-p">(</span><span class="tok-s2">&quot;withCredentials&quot;</span> <span class="tok-k">in</span> <span class="tok-nx">xhr</span><span class="tok-p">)</span> <span class="tok-p">{</span>
  <span class="tok-c1">// CORS Habilitado</span>
<span class="tok-p">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>La realidad es que pocos dominios permiten su uso (algunos son <a href="http://bit.ly" class="bare">http://bit.ly</a> o <a href="http://twitpic.com" class="bare">http://twitpic.com</a>).</p>
</div>
<div class="paragraph">
<p>Si queremos evitarnos configurar el servidor con la cabecera, podemos hacer uso de <a href="http://www.corsproxy.com" class="bare">http://www.corsproxy.com</a>, el cual fusiona tanto la técnica <em>CORS</em> como el uso de un proxy.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
Un artículo muy completo sobre el uso de <em>CORS</em>: <a href="http://www.html5rocks.com/en/tutorials/cors" class="bare">http://www.html5rocks.com/en/tutorials/cors</a>
</td>
</tr>
</table>
</div>
</li>
<li>
<p><strong>JSONP</strong> (<em>JSON with Padding</em>): Las restricciones de seguridad no se aplican a la etiqueta <code>&lt;script&gt;</code>. Con ella podemos cargar (¡y ejecutar!) código <em>JavaScript</em> de cualquier origen mediante una petición <em>GET</em>, con lo que podríamos cargar en un punto del documento la respuesta del servidor en formato <em>JSON</em>.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_jsonp">5.2.4. JSONP</h4>
<div class="paragraph">
<p>Estudiemos en más detalle esta técnica. Supongamos que realizamos la siguiente petición:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="html"><span class="tok-nt">&lt;script </span><span class="tok-na">src=</span><span class="tok-s">&quot;http://www.omdbapi.com/?s=batman&quot;</span><span class="tok-nt">&gt;&lt;/script&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Esto no sirve de mucho, ya que sólo inserta en ese punto del documento el objeto en formato <em>JSON</em>, pero no hace nada con esa información.</p>
</div>
<div class="paragraph">
<p>Lo que <em>JSONP</em> permite es definir una función (que es nuestra) y que recibirá como parámetro el <em>JSON</em> que envía el servidor. Los servicios que admiten <em>JSONP</em> reciben un parámetro en la petición, (normalmente llamado <em>callback</em>) que especifica el nombre de la función a llamar.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="url">http://www.omdbapi.com/?s=batman?callback=miFuncion</code></pre>
</div>
</div>
<div class="paragraph">
<p>El servidor nos devolverá un <em>JavaScript</em> del estilo:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="javascript"><span class="tok-nx">miFuncion</span><span class="tok-p">(</span><span class="tok-nx">respuestaEnJSON</span><span class="tok-p">);</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Es decir, tras la llamada, se ejecutará <code>miFuncion</code> recibiendo como argumento el <em>JSON</em>. En <code>miFuncion</code> procesaríamos los datos y los mostraríamos en la página.</p>
</div>
<div class="paragraph">
<p>Si queremos que la petición se realice al producirse un evento, hemos de crear la etiqueta <code>&lt;script&gt;</code> de manera dinámica:</p>
</div>
<div class="listingblock">
<div class="title">Ejemplo JSONP - <a href="http://jsbin.com/riruc/1/edit?html,js,output" class="bare">http://jsbin.com/riruc/1/edit?html,js,output</a></div>
<div class="content">
<pre class="pygments highlight"><code data-lang="html"><span class="tok-nt">&lt;body&gt;</span>
<span class="tok-nt">&lt;script&gt;</span>
  <span class="tok-kd">function</span> <span class="tok-nx">llamarServicio</span><span class="tok-p">()</span> <span class="tok-p">{</span>
    <span class="tok-kd">var</span> <span class="tok-nx">s</span> <span class="tok-o">=</span> <span class="tok-nb">document</span><span class="tok-p">.</span><span class="tok-nx">createElement</span><span class="tok-p">(</span><span class="tok-s2">&quot;script&quot;</span><span class="tok-p">);</span>
    <span class="tok-nx">s</span><span class="tok-p">.</span><span class="tok-nx">src</span> <span class="tok-o">=</span> <span class="tok-s2">&quot;http://www.omdbapi.com/?s=batman?callback=miFuncion&quot;</span><span class="tok-p">;</span>
    <span class="tok-nb">document</span><span class="tok-p">.</span><span class="tok-nx">body</span><span class="tok-p">.</span><span class="tok-nx">appendChild</span><span class="tok-p">(</span><span class="tok-nx">s</span><span class="tok-p">);</span>
  <span class="tok-p">}</span>
  <span class="tok-kd">function</span> <span class="tok-nx">miFuncion</span><span class="tok-p">(</span><span class="tok-nx">json</span><span class="tok-p">)</span> <span class="tok-p">{</span>
    <span class="tok-nb">document</span><span class="tok-p">.</span><span class="tok-nx">getElementById</span><span class="tok-p">(</span><span class="tok-s2">&quot;resultado&quot;</span><span class="tok-p">).</span><span class="tok-nx">innerHTML</span> <span class="tok-o">=</span> <span class="tok-nx">JSON</span><span class="tok-p">.</span><span class="tok-nx">stringify</span><span class="tok-p">(</span><span class="tok-nx">json</span><span class="tok-p">);</span>
  <span class="tok-p">}</span>
<span class="tok-nt">&lt;/script&gt;</span>
<span class="tok-nt">&lt;input</span> <span class="tok-na">type=</span><span class="tok-s">&quot;button&quot;</span> <span class="tok-na">onclick=</span><span class="tok-s">&quot;llamarServicio()&quot;</span> <span class="tok-na">value=</span><span class="tok-s">&quot;JSONP&quot;</span><span class="tok-nt">&gt;</span>
<span class="tok-nt">&lt;div</span> <span class="tok-na">id=</span><span class="tok-s">&quot;resultado&quot;</span><span class="tok-nt">&gt;&lt;/div&gt;</span>
<span class="tok-nt">&lt;/body&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Esta técnica se restringe a peticiones <em>GET</em>, con lo que si queremos hacer otro tipo de petición (<em>POST</em>, <em>PUT</em> o <em>DELETE</em>), no podremos usar <em>JSONP</em>. Además, requiere que el servidor sea de confianza, ya que el servicio podría devolver código malicioso que se ejecutará en el contexto de nuestra página (lo que le da acceso a las <em>cookies</em>, almacenamiento local, etc&#8230;&#8203;). Para reducir los riesgos se pueden usar <em>frames</em> y <code>window.postMessage</code> para aislar las peticiones <em>JSONP</em>.</p>
</div>
<div class="paragraph">
<p>Trabajaremos más ejemplos de <em>AJAX</em> mediante <em>jQuery</em> en siguientes sesiones, el cual facilita mucho el acceso a contenido remoto desde el cliente.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
Podemos consultar un ejemplo completo de <em>JSONP</em> con código <em>jQuery</em> en el cliente y <em>Java</em> en el servidor en <a href="http://www.mysamplecode.com/2012/05/jquery-cross-domain-ajax-request.html" class="bare">http://www.mysamplecode.com/2012/05/jquery-cross-domain-ajax-request.html</a>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_testing_2">5.2.5. Testing</h4>
<div class="paragraph">
<p>En la unidad anterior ya vimos como hacer pruebas de código asíncrono mediante <em>QUnit</em>. Veamos un ejemplo que pruebe código AJAX:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="javascript"><span class="tok-nx">QUnit</span><span class="tok-p">.</span><span class="tok-nx">asyncTest</span><span class="tok-p">(</span><span class="tok-s1">&#39;ajaxHeroes&#39;</span><span class="tok-p">,</span> <span class="tok-kd">function</span> <span class="tok-p">(</span><span class="tok-nx">assert</span><span class="tok-p">)</span> <span class="tok-p">{</span>
  <span class="tok-nx">expect</span><span class="tok-p">(</span><span class="tok-mi">2</span><span class="tok-p">);</span>  <i class="conum" data-value="1"></i><b>(1)</b>

  <span class="tok-kd">var</span> <span class="tok-nx">xhr</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-nx">XMLHttpRequest</span><span class="tok-p">();</span>
  <span class="tok-nx">xhr</span><span class="tok-p">.</span><span class="tok-nx">open</span><span class="tok-p">(</span><span class="tok-s2">&quot;GET&quot;</span><span class="tok-p">,</span><span class="tok-s2">&quot;heroes.json&quot;</span><span class="tok-p">,</span> <span class="tok-kc">true</span><span class="tok-p">);</span>
  <span class="tok-nx">xhr</span><span class="tok-p">.</span><span class="tok-nx">onreadystatechange</span> <span class="tok-o">=</span> <span class="tok-kd">function</span><span class="tok-p">()</span> <span class="tok-p">{</span>
    <span class="tok-k">if</span> <span class="tok-p">(</span><span class="tok-nx">xhr</span><span class="tok-p">.</span><span class="tok-nx">readyState</span> <span class="tok-o">===</span> <span class="tok-mi">4</span><span class="tok-p">)</span> <span class="tok-p">{</span>
      <span class="tok-kd">var</span> <span class="tok-nx">respuesta</span> <span class="tok-o">=</span> <span class="tok-nx">JSON</span><span class="tok-p">.</span><span class="tok-nx">parse</span><span class="tok-p">(</span><span class="tok-nx">xhr</span><span class="tok-p">.</span><span class="tok-nx">responseText</span><span class="tok-p">);</span>
      <span class="tok-nx">assert</span><span class="tok-p">.</span><span class="tok-nx">equal</span><span class="tok-p">(</span><span class="tok-nx">respuesta</span><span class="tok-p">.</span><span class="tok-nx">nombre</span><span class="tok-p">,</span> <span class="tok-s2">&quot;Batman&quot;</span><span class="tok-p">,</span> <span class="tok-s2">&quot;Atributo de archivo json&quot;</span><span class="tok-p">);</span>
      <span class="tok-nx">assert</span><span class="tok-p">.</span><span class="tok-nx">equal</span><span class="tok-p">(</span><span class="tok-nx">respuesta</span><span class="tok-p">.</span><span class="tok-nx">amigos</span><span class="tok-p">[</span><span class="tok-mi">0</span><span class="tok-p">].</span><span class="tok-nx">nombre</span><span class="tok-p">,</span> <span class="tok-s2">&quot;Robin&quot;</span><span class="tok-p">,</span> <span class="tok-s2">&quot;Atributo de un hijo que es array&quot;</span><span class="tok-p">);</span>
      <span class="tok-nx">QUnit</span><span class="tok-p">.</span><span class="tok-nx">start</span><span class="tok-p">();</span>  <i class="conum" data-value="2"></i><b>(2)</b>
    <span class="tok-p">}</span>
  <span class="tok-p">};</span>
  <span class="tok-nx">xhr</span><span class="tok-p">.</span><span class="tok-nx">send</span><span class="tok-p">(</span><span class="tok-kc">null</span><span class="tok-p">);</span>
<span class="tok-p">});</span></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Le indicamos a la prueba que vamos a realizar dos aserciones</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Una vez indicadas las aserciones, le indicamos a QUnit que lance la petición AJAX</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_html_5">5.3. HTML 5</h3>
<div class="paragraph">
<p>Las principales características que ofrece HTML 5 y que se están incorporando a los navegadores de manera progresiva son:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Soporte de vídeo, mediante <code>&lt;video&gt;</code> (operaciones <code>.play()</code>, <code>.pause()</code>, <code>currentTime = 0</code>; evento <code>ended</code>, <code>play</code>, <code>pause</code>, &#8230;&#8203;)</p>
</li>
<li>
<p>Soporte de audio</p>
</li>
<li>
<p>Elemento <code>canvas</code> para la generación de gráficos en 2D, similar a SVG.</p>
</li>
<li>
<p>Almacenamiento local y/o <em>offline</em>, mediante el objeto <code>localStorage</code> que estudiaremos más adelante.</p>
</li>
<li>
<p>Nuevos elementos de formulario, como tipos <code>email</code>, <code>date</code>, <code>number</code>, &#8230;&#8203;</p>
</li>
<li>
<p>Arrastrar y soltar (Drag-and-drop)</p>
</li>
<li>
<p>Geolocalización</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>La implementación de cada una de estas prestaciones viene determinada por el navegador y la versión empleada. Si queremos consultar alguna característica concreta, podemos comprobar en <a href="http://caniuse.com" class="bare">http://caniuse.com</a> que navegadores la soportan.</p>
</div>
<div class="paragraph">
<p>Cada una de las características vistas anteriormente (vídeo, audio, geolocalización) tienen sus métodos y eventos propios, que se salen del alcance del módulo.</p>
</div>
<div class="paragraph">
<p>En cuanto a <em>JavaScript</em>, la única característica que viene de la mano de <em>ECMAScript 5</em> es la selección de elementos mediante la clase CSS, mediante el método <code>getElementsByClassName(claseCSS)</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="javascript"><span class="tok-kd">var</span> <span class="tok-nx">c1</span> <span class="tok-o">=</span> <span class="tok-nb">document</span><span class="tok-p">.</span><span class="tok-nx">getElementsByClassName</span><span class="tok-p">(</span><span class="tok-s2">&quot;clase1&quot;</span><span class="tok-p">)</span>
<span class="tok-kd">var</span> <span class="tok-nx">c12</span> <span class="tok-o">=</span> <span class="tok-nb">document</span><span class="tok-p">.</span><span class="tok-nx">getElementsByClassName</span><span class="tok-p">(</span><span class="tok-s2">&quot;clase1 clase2&quot;</span><span class="tok-p">);</span></code></pre>
</div>
</div>
<div class="sect3">
<h4 id="_detección_de_características_em_modernizr_em">5.3.1. Detección de características. <em>Modernizr</em></h4>
<div class="paragraph">
<p>Si a nivel programativo queremos averiguar si el navegador que empleamos soporta una determinada característica para así emplearla, necesitamos realizar una detección de la misma:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="javascript"><span class="tok-k">if</span> <span class="tok-p">(</span><span class="tok-nb">document</span><span class="tok-p">.</span><span class="tok-nx">getElementsByClassName</span><span class="tok-p">)</span> <span class="tok-p">{</span>
  <span class="tok-c1">// existe, por lo que el navegador lo soporta</span>
<span class="tok-p">}</span> <span class="tok-k">else</span> <span class="tok-p">{</span>
  <span class="tok-c1">// no existe, con lo que el navegador no lo soporta</span>
<span class="tok-p">}</span></code></pre>
</div>
</div>
<div class="admonitionblock caution">
<table>
<tr>
<td class="icon">
<i class="fa icon-caution" title="Caution"></i>
</td>
<td class="content">
<div class="title">Detección del navegador</div>
<div class="paragraph">
<p>Hace años se programaba detectando el navegador con el que se conectaba el usuario:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="javascript"><span class="tok-k">if</span> <span class="tok-p">(</span><span class="tok-nx">navigator</span><span class="tok-p">.</span><span class="tok-nx">userAgent</span><span class="tok-p">.</span><span class="tok-nx">indexOf</span><span class="tok-p">(</span><span class="tok-s2">&quot;Netscape&quot;</span><span class="tok-p">))</span> <span class="tok-p">{</span> <span class="tok-c1">/// }</span>
<span class="tok-k">if</span> <span class="tok-p">(</span><span class="tok-nx">navigator</span><span class="tok-p">.</span><span class="tok-nx">appName</span> <span class="tok-o">==</span> <span class="tok-s2">&quot;Microsoft Internet Explorer&quot;</span><span class="tok-p">)</span> <span class="tok-p">{</span> <span class="tok-c1">/// }</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Este tipo de desarrollo es muy peligroso, por las continuas actualizaciones del navegador y el costoso mantenimiento del código. Es mucho mejor detectar la característica en la que estamos interesados o usar un framework como <em>jQuery</em> para implementar código <em>cross-browser</em>.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Para ayudarnos a detectar las características que ofrece nuestro navegador, podemos usar la famosa librería <strong><em>Modernizr</em></strong> (<a href="http://www.modernizr.com" class="bare">http://www.modernizr.com</a>). Esta librería ofrece el objeto <code>Modernizr</code> que contiene propiedades booleanas con las prestaciones soportadas, por ejemplo, <code>Modernizr.video</code> o <code>Modernizr.localStorage</code>. Así pues, una vez incluida la librería, para detectar si el navegador soporta la etiqueta <code>video</code> de HTML5 haríamos:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="javascript"><span class="tok-k">if</span> <span class="tok-p">(</span><span class="tok-nx">Modernizr</span><span class="tok-p">.</span><span class="tok-nx">video</span><span class="tok-p">)</span> <span class="tok-p">{</span>
  <span class="tok-c1">// usamos el vídeo de HTML5</span>
<span class="tok-p">}</span> <span class="tok-k">else</span> <span class="tok-p">{</span>
  <span class="tok-c1">// usamos el vídeo Flash</span>
<span class="tok-p">}</span></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_polyfills">5.3.2. Polyfills</h4>
<div class="paragraph">
<p>Si nuestro navegador no soporta la característica deseada, podemos usar <em>HTML shims</em> o <em>polyfills</em> que reproducen la funcionalidad del navegador.</p>
</div>
<div class="paragraph">
<p>Un <strong><em>shim</em></strong> es una librería que ofrece una nueva API a un entorno antiguo mediante los medios que ofrece el entorno.</p>
</div>
<div class="paragraph">
<p>Un <strong><em>polyfill</em></strong> es un fragmento de código (o <em>plugin</em>) que ofrece la tecnología que esperamos que el navegador ofrezca de manera nativa. Con lo que un <em>polyfill</em> es un <em>shim</em> para el API del navegador.</p>
</div>
<div class="paragraph">
<p>Lo que nosotros haremos es comprobar mediante <em>Modernizr</em> si el navegador soporta un API, y en caso negativo, cargar un <em>polyfill</em>.</p>
</div>
<div class="paragraph">
<p>Por ejemplo, si nuestra aplicación tiene que soportar navegadores  antiguos, podemos usar el <em>polyfill</em> <strong>html5shiv</strong> (<a href="https://github.com/aFarkas/html5shiv" class="bare">https://github.com/aFarkas/html5shiv</a>):</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="html"><span class="tok-c">&lt;!--[if lt IE 9]&gt;</span>
<span class="tok-c">&lt;script src=&quot;html5shiv.js&quot;&gt;&lt;/script&gt;</span>
<span class="tok-c">&lt;![endif]--&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Si estamos interesados en una funcionalidad concreta de HTML5, en la página de <em>Modernizr</em> tienen un catálogo extenso de <em>polyfills</em>: <a href="https://github.com/Modernizr/Modernizr/wiki/HTML5-Cross-Browser-Polyfills" class="bare">https://github.com/Modernizr/Modernizr/wiki/HTML5-Cross-Browser-Polyfills</a></p>
</div>
<div class="paragraph">
<p>En <a href="http://html5please.com" class="bare">http://html5please.com</a> tenemos un listado de las características de HTML y su estado, con recomendaciones de <em>polyfills</em> e implementaciones para facilitar la decisión de usar o no dichas características.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_almacenando_información">5.4. Almacenando información</h3>
<div class="paragraph">
<p>Una manera de almacenar información en el navegador es mediante <em>cookies</em>, aunque su gestión mediante <em>JavaScript</em> sea muy laboriosa.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
Todos los almacenes que vamos a estudiar a continuación se pueden visualizar dentro de las <em>DevTools</em> en la pestaña <em>Resources</em>.
</td>
</tr>
</table>
</div>
<div class="sect3">
<h4 id="_cookies">5.4.1. Cookies</h4>
<div class="paragraph">
<p>Para almacenar una <em>cookie</em> podemos acceder a la propiedad <code>document.cookie</code> asignándole un valor o consultándola para recuperar el valor almacenado.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="javascript"><span class="tok-nb">document</span><span class="tok-p">.</span><span class="tok-nx">cookie</span> <span class="tok-o">=</span> <span class="tok-s2">&quot;nombre=Batman&quot;</span><span class="tok-p">;</span>
<span class="tok-kd">var</span> <span class="tok-nx">info</span> <span class="tok-o">=</span> <span class="tok-nb">document</span><span class="tok-p">.</span><span class="tok-nx">cookie</span><span class="tok-p">;</span>
<span class="tok-nb">document</span><span class="tok-p">.</span><span class="tok-nx">cookie</span> <span class="tok-o">=</span> <span class="tok-s2">&quot;amigo=Robin&quot;</span><span class="tok-p">;</span> <i class="conum" data-value="1"></i><b>(1)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>crea la cookie para <code>amigo</code>, sin eliminar la de <code>nombre</code></td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Por defecto las <em>cookies</em> se eliminan al cerrar el navegador. Si queremos que no sea así, podemos indicar su fecha de expiración mediante el atributo <code>expires</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="javascript"><span class="tok-nb">document</span><span class="tok-p">.</span><span class="tok-nx">cookie</span> <span class="tok-o">=</span> <span class="tok-s2">&quot;nombre=Batman; expires=Thu Dec 31 2015 00:00:00 GMT+0100 (CET)&quot;</span><span class="tok-p">;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Para eliminar una <em>cookie</em> hay que poner el atributo <code>expires</code> con una fecha del pasado y no pasarle ningún valor:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="javascript"><span class="tok-nb">document</span><span class="tok-p">.</span><span class="tok-nx">cookie</span> <span class="tok-o">=</span> <span class="tok-s2">&quot;nombre=; expires=Thu Jan 01 1970 00:00:00 GMT+0100 (CET)&quot;</span><span class="tok-p">;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Más ejemplos en <a href="https://developer.mozilla.org/en-US/docs/Web/API/document.cookie" class="bare">https://developer.mozilla.org/en-US/docs/Web/API/document.cookie</a></p>
</div>
<div class="paragraph">
<p>La principal ventaja de usar <em>cookies</em> es que tanto el servidor con <em>Java</em> (o cualquier otro lenguaje) como el navegador mediante <em>JavaScript</em> pueden acceder a la información almacenada.</p>
</div>
<div class="paragraph">
<p>Pero también tiene sus inconvenientes, ya que:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>sólo pueden almacenar hasta 4KB (normalmente guardan una clave <em>hash</em> que identifica la vista)</p>
</li>
<li>
<p>se envían y vuelven a recibir con cada petición</p>
</li>
<li>
<p>caducan</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_localstorage">5.4.2. LocalStorage</h4>
<div class="paragraph">
<p>En cambio, si nos centramos en <em>LocalStorage</em>, sólo podemos usarlo mediante <em>JavaScript</em>, aunque como veremos a continuación, su uso es muy sencillo y potente:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>puede almacenar entre 5 y 10 MB</p>
</li>
<li>
<p>la información almacenada no se envía al servidor con cada petición</p>
</li>
<li>
<p>no caduca</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>El almacenamiento local aparece de la mano de HTML5 y se basa en un mapa de claves/valor donde podemos almacenar todo el contenido que deseemos. Para ello, hemos de usar el objeto global <code>localStorage</code> y asociarle valores a sus propiedades. También podemos usar los métodos <code>.setItem(clave)</code> y <code>.getItem(clave)</code> para acceder a las propiedades de manera dinámica.</p>
</div>
<div class="admonitionblock caution">
<table>
<tr>
<td class="icon">
<i class="fa icon-caution" title="Caution"></i>
</td>
<td class="content">
Las propiedades son sensibles a las mayúsculas, con lo que <code>.nombre</code> y <code>.Nombre</code> son propiedades distintas.
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="javascript"><span class="tok-nx">localStorage</span><span class="tok-p">.</span><span class="tok-nx">nombre</span> <span class="tok-o">=</span> <span class="tok-s2">&quot;Aitor&quot;</span><span class="tok-p">;</span>
<span class="tok-nx">localStorage</span><span class="tok-p">.</span><span class="tok-nx">setItem</span><span class="tok-p">(</span><span class="tok-s2">&quot;apellido1&quot;</span><span class="tok-p">,</span><span class="tok-s2">&quot;Medrano&quot;</span><span class="tok-p">);</span>

<span class="tok-nx">console</span><span class="tok-p">.</span><span class="tok-nx">log</span><span class="tok-p">(</span><span class="tok-nx">localStorage</span><span class="tok-p">.</span><span class="tok-nx">nombre</span><span class="tok-p">);</span>
<span class="tok-nx">console</span><span class="tok-p">.</span><span class="tok-nx">log</span><span class="tok-p">(</span><span class="tok-nx">localStorage</span><span class="tok-p">.</span><span class="tok-nx">getItem</span><span class="tok-p">(</span><span class="tok-s2">&quot;apellido1&quot;</span><span class="tok-p">));</span></code></pre>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
MDN recomienda usar los métodos <code>getItem</code> y <code>setItem</code> en vez del uso de las propiedades
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Si queremos comprobar o modificar lo que hay en almacenado en el almacén del navegador, podemos abrir las <em>Dev-Tools</em> y acceder a la pestaña <em>Resources</em>:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/js05/localStorageDevTools.jpg" alt="LocalStorage en DevTools" width="66%">
</div>
<div class="title">Figure 30. LocalStorage en DevTools</div>
</div>
<div class="paragraph">
<p>Si en algún momento queremos saber cuantos elementos tenemos almacenados, podemos usar la propiedad <code>length</code></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="javascript"><span class="tok-nx">console</span><span class="tok-p">.</span><span class="tok-nx">log</span><span class="tok-p">(</span><span class="tok-nx">localStorage</span><span class="tok-p">.</span><span class="tok-nx">length</span><span class="tok-p">);</span> <span class="tok-c1">// 2</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Si queremos eliminar una propiedad, usaremos el método <code>removeItem(clave)</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="javascript"><span class="tok-nx">localStorage</span><span class="tok-p">.</span><span class="tok-nx">removeItem</span><span class="tok-p">(</span><span class="tok-nx">apellido1</span><span class="tok-p">);</span>
<span class="tok-nx">console</span><span class="tok-p">.</span><span class="tok-nx">log</span><span class="tok-p">(</span><span class="tok-nx">localStorage</span><span class="tok-p">.</span><span class="tok-nx">getItem</span><span class="tok-p">(</span><span class="tok-s2">&quot;apellido1&quot;</span><span class="tok-p">));</span> <span class="tok-c1">// undefined</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Finalmente, si queremos limpiar el almacenamiento local, podemos hacer un <code>clear()</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="javascript"><span class="tok-nx">localStorage</span><span class="tok-p">.</span><span class="tok-nx">clear</span><span class="tok-p">();</span>
<span class="tok-nx">console</span><span class="tok-p">.</span><span class="tok-nx">log</span><span class="tok-p">(</span><span class="tok-nx">localStorage</span><span class="tok-p">.</span><span class="tok-nx">getItem</span><span class="tok-p">(</span><span class="tok-s2">&quot;nombre&quot;</span><span class="tok-p">));</span> <span class="tok-c1">// undefined</span></code></pre>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
En los navegadores <em>Safari</em>, <em>Safari iOS</em> y <em>Android</em>, al usar la navegación privada, no se permite el uso de <code>localStorage</code>. En el resto, al salir de la navegación privada, la base de datos se vacía.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Cabe destacar que los datos se almacenan todos como cadenas, ya que antes de almacenar se ejecuta el método <code>.toString</code> por lo que si insertamos un dato como número, deberemos volver al parsearlo al recuperarlo del almacenamiento.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="javascript"><span class="tok-nx">localStorage</span><span class="tok-p">.</span><span class="tok-nx">edad</span> <span class="tok-o">=</span> <span class="tok-mi">35</span><span class="tok-p">;</span>
<span class="tok-nx">console</span><span class="tok-p">.</span><span class="tok-nx">log</span><span class="tok-p">(</span><span class="tok-k">typeof</span> <span class="tok-nx">localStorage</span><span class="tok-p">.</span><span class="tok-nx">getItem</span><span class="tok-p">(</span><span class="tok-s2">&quot;edad&quot;</span><span class="tok-p">));</span> <span class="tok-c1">// &quot;string&quot;</span>
<span class="tok-kd">var</span> <span class="tok-nx">edad</span> <span class="tok-o">=</span> <span class="tok-nb">parseInt</span><span class="tok-p">(</span><span class="tok-nx">localStorage</span><span class="tok-p">.</span><span class="tok-nx">getItem</span><span class="tok-p">(</span><span class="tok-s2">&quot;edad&quot;</span><span class="tok-p">),</span> <span class="tok-mi">10</span><span class="tok-p">);</span></code></pre>
</div>
</div>
<div class="sect4">
<h5 id="_almacenando_un_objeto">Almacenando un objeto</h5>
<div class="paragraph">
<p>Si lo que queremos almacenar es un objeto, realmente se almacenará una cadena indicando que se trata de un objeto.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="javascript"><span class="tok-kd">var</span> <span class="tok-nx">persona</span> <span class="tok-o">=</span> <span class="tok-p">{</span>
  <span class="tok-nx">nombre</span> <span class="tok-o">:</span> <span class="tok-s2">&quot;Aitor&quot;</span><span class="tok-p">,</span>
  <span class="tok-nx">apellido1</span> <span class="tok-o">:</span> <span class="tok-s2">&quot;Medrano&quot;</span><span class="tok-p">,</span>
  <span class="tok-nx">edad</span> <span class="tok-o">:</span> <span class="tok-mi">35</span>
<span class="tok-p">};</span>

<span class="tok-nx">localStorage</span><span class="tok-p">.</span><span class="tok-nx">setItem</span><span class="tok-p">(</span><span class="tok-s2">&quot;persona&quot;</span><span class="tok-p">,</span> <span class="tok-nx">persona</span><span class="tok-p">);</span>
<span class="tok-nx">console</span><span class="tok-p">.</span><span class="tok-nx">log</span><span class="tok-p">(</span><span class="tok-nx">localStorage</span><span class="tok-p">.</span><span class="tok-nx">getItem</span><span class="tok-p">(</span><span class="tok-s2">&quot;persona&quot;</span><span class="tok-p">));</span> <span class="tok-c1">// [object Object]</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Para solucionar esto, lo mejor es usar las librerías JSON que acabamos de estudiar para crear una representación del objeto mediante <code>JSON.stringify(objeto)</code> y posteriormente recuperarlo con <code>JSON.parse(objetoLS)</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="javascript"><span class="tok-kd">var</span> <span class="tok-nx">persona</span> <span class="tok-o">=</span> <span class="tok-p">{</span>
  <span class="tok-nx">nombre</span> <span class="tok-o">:</span> <span class="tok-s2">&quot;Aitor&quot;</span><span class="tok-p">,</span>
  <span class="tok-nx">apellido1</span> <span class="tok-o">:</span> <span class="tok-s2">&quot;Medrano&quot;</span><span class="tok-p">,</span>
  <span class="tok-nx">edad</span> <span class="tok-o">:</span> <span class="tok-mi">18</span>
<span class="tok-p">};</span>

<span class="tok-nx">localStorage</span><span class="tok-p">.</span><span class="tok-nx">setItem</span><span class="tok-p">(</span><span class="tok-s2">&quot;persona&quot;</span><span class="tok-p">,</span> <span class="tok-nx">JSON</span><span class="tok-p">.</span><span class="tok-nx">stringify</span><span class="tok-p">(</span><span class="tok-nx">persona</span><span class="tok-p">));</span>
<span class="tok-nx">console</span><span class="tok-p">.</span><span class="tok-nx">log</span><span class="tok-p">(</span><span class="tok-nx">localStorage</span><span class="tok-p">.</span><span class="tok-nx">getItem</span><span class="tok-p">(</span><span class="tok-s2">&quot;persona&quot;</span><span class="tok-p">));</span> <span class="tok-c1">// &quot;{\&quot;nombre\&quot;:\&quot;Aitor\&quot;, \&quot;apellido1\&quot;:\&quot;Medrano\&quot;, \&quot;edad\&quot;:18}&quot;</span>
<span class="tok-kd">var</span> <span class="tok-nx">personaRecuperada</span> <span class="tok-o">=</span> <span class="tok-nx">JSON</span><span class="tok-p">.</span><span class="tok-nx">parse</span><span class="tok-p">(</span><span class="tok-nx">localStorage</span><span class="tok-p">.</span><span class="tok-nx">getItem</span><span class="tok-p">(</span><span class="tok-s2">&quot;persona&quot;</span><span class="tok-p">));</span>
<span class="tok-nx">console</span><span class="tok-p">.</span><span class="tok-nx">log</span><span class="tok-p">(</span><span class="tok-nx">personaRecuperada</span><span class="tok-p">);</span> <span class="tok-cm">/* [object Object] {</span>
<span class="tok-cm">  apellido1: &quot;Medrano&quot;,</span>
<span class="tok-cm">  edad: 18,</span>
<span class="tok-cm">  nombre: &quot;Aitor&quot;</span>
<span class="tok-cm">} */</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>El uso del almacenamiento local sigue el planteamiento de <em>sandbox</em>, con lo que queda restringido su uso al dominio activo, con lo que no podremos acceder a propiedades del almacenamiento local creadas desde un dominio distinto.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_sessionstorage">5.4.3. SessionStorage</h4>
<div class="paragraph">
<p>De manera similar a <code>localStorage</code>, podemos usar el objeto <code>sessionStorage</code> para almacenar la información con un ciclo de vida asociado a la sesión del navegador. Es decir, al cerrar el navegador, el almacenamiento se vaciará.</p>
</div>
<div class="paragraph">
<p>Un caso partícular es que se produzca un cierre inesperado por fallo del navegador. En dicho caso, los datos se restablecen como si no hubiésemos cerrado la sesión.</p>
</div>
<div class="paragraph">
<p>Ambos objetos heredan del interfaz <code>Storage</code> por lo que el código de uso es similar.</p>
</div>
</div>
<div class="sect3">
<h4 id="_indexeddb">5.4.4. IndexedDB</h4>
<div class="paragraph">
<p>Además del almacenamiento local, el navegador permite almacenar la información en una estructura más compleja similar a una BBDD.</p>
</div>
<div class="paragraph">
<p>Existen 2 posibilidades:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>WebSQL DB</strong>: <em>wrapper</em> sobre <em>SQLite</em> que permite interactuar con lo datos mediante un interfaz <em>SQL</em>, con lo que podemos ejecutar sentencias <em>select</em>, <em>insert</em>, <em>update</em> o <em>delete</em>. El problema viene de que al tratarse de un estándar, y no haber más de una implementación, la especificación se ha congelado y ha pasado a un estado de <em>deprecated</em>. En la actualidad la soportan la mayor parte de los navegadores excepto <em>Firefox</em> e <em>IE</em> (ver <a href="http://caniuse.com/#feat=sql-storage" class="bare">http://caniuse.com/#feat=sql-storage</a>).</p>
</li>
<li>
<p><strong>IndexedDB</strong>: expone un <em>API</em> como un almacén de objetos, el cual comparte muchos conceptos con una <em>BBDD SQL</em>, tales como base de datos, registro, campo o transacción. La principal diferencia es que no se interactúa mediante el lenguaje <em>SQL</em>, sino que se utilizan métodos del mismo modo que se hace mediante <em>JPA</em> o <em>Hibernate</em>. Su soporte es completo en <em>Firefox</em>, <em>Chrome</em> y <em>Opera</em>, pero parcial en el resto (<a href="http://caniuse.com/#search=IndexedDB" class="bare">http://caniuse.com/#search=IndexedDB</a>)</p>
</li>
</ul>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
Un artículo muy interesante donde comparan con código estos enfoques es <em>Client-Side Storage</em>:
<a href="http://www.html5rocks.com/en/tutorials/offline/storage/" class="bare">http://www.html5rocks.com/en/tutorials/offline/storage/</a>
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_web_workers">5.5. Web Workers</h3>
<div class="paragraph">
<p>El modelo mono-hilo de <em>JavaScript</em> provoca que el desarrollador utilice las llamadas asíncronas <em>AJAX</em> y los <em>timers</em> mediante <code>setTimeout()</code> y <code>setInterval()</code> como triquiñuelas para no bloquear el hilo de ejecución, por ejemplo, mediante la manipulación del DOM, la cual es quizás la tarea más costosa que podemos realizar con <em>JavaScript</em>.</p>
</div>
<div class="paragraph">
<p><em>HTML5</em> introduce los <em>Web Workers</em> como una solución a la ejecución mono-hilo de JavaScript. De este modo, vamos a poder crear hilos de ejecución que se ejecutan en  <em>background</em> que corren al mismo tiempo (más o menos) y que pueden llegar a aprovechar las arquitecturas multi-núcleo que ofrece el hardware.</p>
</div>
<div class="paragraph">
<p>Al crear un <em>web worker</em>, éste correrá en <em>background</em> mientras que el hilo principal procesa los eventos del interfaz de usuario, incluso si el hilo del <em>worker</em> esta ocupado procesando gran cantidad de datos. Por ejemplo, un <em>worker</em> puede procesar una estructura JSON para extraer la información útil a mostrar en el  interfaz de usuario.</p>
</div>
<div class="sect3">
<h4 id="_hilo_padre">5.5.1. Hilo padre</h4>
<div class="paragraph">
<p>El código que pertenece a un <em>web worker</em> reside en un archivo <em>JavaScript</em> aparte. El hilo padre crea el nuevo <em>worker</em> indicando la URI del <em>script</em> en el constructor de <code>Worker</code>, el cual lo carga de manera asíncrona y lo ejecuta.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="javascript"><span class="tok-c1">// archivo JS padre</span>
<span class="tok-kd">var</span> <span class="tok-nx">worker</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-nx">Worker</span><span class="tok-p">(</span><span class="tok-s2">&quot;otroFichero.js&quot;</span><span class="tok-p">);</span> <i class="conum" data-value="1"></i><b>(1)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Creamos un <em>web worker</em> en el hijo padre que referencia al código que reside en <code>otroFichero.js</code></td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Para lanzar el <em>worker</em>, el hilo padre le envía un mensaje al hijo mediante el método <code>postMessage(<em>mensaje</em>)</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="javascript"><span class="tok-nx">worker</span><span class="tok-p">.</span><span class="tok-nx">postMessage</span><span class="tok-p">(</span><span class="tok-s2">&quot;contenido&quot;</span><span class="tok-p">);</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>La página padre puede comunicarse con los <em>workers</em> mediante el API <code>postMessage</code>, el cual también se envía para que los <em>workers</em> envíen mensajes al padre. Además de poder enviar datos de tipos primitivos (cadena, número, booleano, <code>null</code> o <code>undefined</code>), podemos enviar estructuras JSON mediante arrays y objetos. Lo que no se puede enviar son funciones ya que pueden contener referencias al DOM.</p>
</div>
<div class="paragraph">
<p>Los hilos del padre y de los <em>workers</em> tienen su propio espacio en memoria, con lo que los mensajes enviados desde y hacia se pasan por copia, no por referencia, con lo cual se realiza un proceso de serialización y deserialización de la información. Por este motivo, se desaconseja enviar grandes cantidades de información al <em>worker</em>.</p>
</div>
<div class="paragraph">
<p>Además de enviar información, el padre puede registrar un <em>callback</em> que quede a la espera de recibir un mensaje una vez que el <em>worker</em> haya finalizado su trabajo. Este permite al hilo del padre utilizar la respuesta del hijo, como por ejemplo, modificar el DOM con la información procesada por el <em>worker</em>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="javascript"><span class="tok-nx">worker</span><span class="tok-p">.</span><span class="tok-nx">onmessage</span> <span class="tok-o">=</span> <span class="tok-kd">function</span><span class="tok-p">(</span><span class="tok-nx">evt</span><span class="tok-p">)</span> <span class="tok-p">{</span>  <i class="conum" data-value="1"></i><b>(1)</b>
  <span class="tok-nx">console</span><span class="tok-p">.</span><span class="tok-nx">log</span><span class="tok-p">(</span><span class="tok-s2">&quot;El worker me ha contestado!&quot;</span><span class="tok-p">);</span>
  <span class="tok-nx">console</span><span class="tok-p">.</span><span class="tok-nx">log</span><span class="tok-p">(</span><span class="tok-s2">&quot;Y me ha enviado &quot;</span> <span class="tok-o">+</span> <span class="tok-nx">evt</span><span class="tok-p">.</span><span class="tok-nx">data</span><span class="tok-p">);</span> <i class="conum" data-value="2"></i><b>(2)</b>
<span class="tok-p">};</span></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>También podemos registrar el evento mediante <code>worker.addEventListener('message', function(evt) {</code></td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>El objeto <code>evt</code> contiene la información de la respuesta</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>El <em>callback</em> recibe como parámetro un objeto <code>evt</code>, el cual contiene las propiedades:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>target</code>: identifica al <em>worker</em> que envió el mensaje, por lo que se usa cuando tener un entorno con múltiples <em>workers</em></p>
</li>
<li>
<p><code>data</code>: contiene el mensaje enviado por el <em>worker</em> de vuelta a su padre</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>En resumen, el código del padre será:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="javascript"><span class="tok-kd">var</span> <span class="tok-nx">worker</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-nx">Worker</span><span class="tok-p">(</span><span class="tok-s2">&quot;otroFichero.js&quot;</span><span class="tok-p">);</span>

<span class="tok-nx">worker</span><span class="tok-p">.</span><span class="tok-nx">onmessage</span> <span class="tok-o">=</span> <span class="tok-kd">function</span><span class="tok-p">(</span><span class="tok-nx">evt</span><span class="tok-p">)</span> <span class="tok-p">{</span>  <i class="conum" data-value="1"></i><b>(1)</b>
  <span class="tok-nx">console</span><span class="tok-p">.</span><span class="tok-nx">log</span><span class="tok-p">(</span><span class="tok-s2">&quot;El worker me ha contestado!&quot;</span><span class="tok-p">);</span>
  <span class="tok-nx">console</span><span class="tok-p">.</span><span class="tok-nx">log</span><span class="tok-p">(</span><span class="tok-s2">&quot;Y me ha enviado &quot;</span> <span class="tok-o">+</span> <span class="tok-nx">evt</span><span class="tok-p">.</span><span class="tok-nx">data</span><span class="tok-p">);</span>
<span class="tok-p">};</span>

<span class="tok-nx">worker</span><span class="tok-p">.</span><span class="tok-nx">postMessage</span><span class="tok-p">(</span><span class="tok-s2">&quot;contenido&quot;</span><span class="tok-p">);</span></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="__em_worker_em_hijo">5.5.2. <em>Worker</em> hijo</h4>
<div class="paragraph">
<p>El <em>worker</em> en sí se coloca en un archivo <code>.js</code> aparte, que en el ejemplo anterior hemos nombrado como <code>otroFichero.js</code>.</p>
</div>
<div class="paragraph">
<p>Por ejemplo, en su ejemplo más sencillo si queremos que devuelva el mensaje recibido y le salude haríamos:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="javascript"><span class="tok-nx">self</span><span class="tok-p">.</span><span class="tok-nx">addEventListener</span><span class="tok-p">(</span><span class="tok-s1">&#39;message&#39;</span><span class="tok-p">,</span> <span class="tok-kd">function</span><span class="tok-p">(</span><span class="tok-nx">evt</span><span class="tok-p">)</span> <span class="tok-p">{</span>  <i class="conum" data-value="1"></i><b>(1)</b>
  <span class="tok-kd">var</span> <span class="tok-nx">mensaje</span> <span class="tok-o">=</span> <span class="tok-nx">evt</span><span class="tok-p">.</span><span class="tok-nx">data</span><span class="tok-p">;</span> <i class="conum" data-value="2"></i><b>(2)</b>

  <span class="tok-nx">self</span><span class="tok-p">.</span><span class="tok-nx">postMessage</span><span class="tok-p">(</span><span class="tok-s2">&quot;Hola &quot;</span> <span class="tok-o">+</span> <span class="tok-nx">mensaje</span><span class="tok-p">);</span>  <i class="conum" data-value="3"></i><b>(3)</b>
<span class="tok-p">});</span></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>El <em>worker</em> también registra un manejador de evento para los mensajes que recibe de su padre. Este manejador también se podía haber añadido mediante la propiedad <code>onmessage</code></td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>De manera similar al padre, extraemos la información a partir de la propiedad <code>data</code></td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Para volver a enviar un mensaje al padre también utiliza el método <code>postMessage</code>.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>En el contexto de un <em>worker</em>, tanto <code>self</code> como <code>this</code> referencian al alcance global.</p>
</div>
</div>
<div class="sect3">
<h4 id="_finalizando_los_em_workers_em">5.5.3. Finalizando los <em>workers</em></h4>
<div class="paragraph">
<p>Los <em>workers</em> consumen muchos recursos, ya que son hilos a nivel de sistema operativo. Por lo tanto, no conviene crear un gran número de hilos y deberíamos terminar el <em>web worker</em> una vez ha finalizado su trabajo.</p>
</div>
<div class="admonitionblock caution">
<table>
<tr>
<td class="icon">
<i class="fa icon-caution" title="Caution"></i>
</td>
<td class="content">
Aunque es común tener múltiples hilos <em>workers</em> para dividir el trabajo entre ellos, hay que ir con mucho cuidado, ya que tienen un gran coste de rendimiento al arrancar y consumen mucha memoria por cada instancia.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Para que un <em>worker</em> termine por sí mismo y deseche cualquier tarea pendiente usaremos el método <code>close</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="javascript"><span class="tok-nx">self</span><span class="tok-p">.</span><span class="tok-nx">close</span><span class="tok-p">();</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>O si un padre quiere finalizar a un <em>worker</em> hijo mediante el método <code>terminate</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="javascript"><span class="tok-nx">worker</span><span class="tok-p">.</span><span class="tok-nx">terminate</span><span class="tok-p">();</span></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_seguridad_y_restricciones">5.5.4. Seguridad y restricciones</h4>
<div class="paragraph">
<p>Como los web workers trabajan de manera independiente del hilo de interfaz del navegador, dentro de un <em>worker</em> no tenemos acceso a muchos objetos JavaScript como <code>document</code>, <code>window</code> (variables globales), <code>console</code>, <code>parent</code> ni, el más importante, al DOM.
El hecho de no tener acceso al DOM y no poder modificar la página puede parecer muy restrictivo, pero es una importante decisión sobre la seguridad. ¿Qué podría pasar si múltiples hilos intentaran modificar el mismo elemento? Por ello los <em>web workers</em> funcionan en un entorno restringido y de mono-hilo.</p>
</div>
<div class="paragraph">
<p>Dicho esto, podemos usar los <em>workers</em> para procesar datos y devolver el resultado al hilo principal, el cual sí que puede modificar el DOM. Aunque tiene reducido el número de objetos que pueden usar, desde un worker si que tenemos acceso a algunas funciones como <code>setTimeout()/clearTimeout()</code>, <code>setInterval()/clearInterval()</code>, <code>navigator</code>, etc&#8230;&#8203; También podemos usar los objetos <code>XMLHttpRequest</code> y <code>localStorage</code> dentro de un <em>worker</em>, e incluso importar otros workers.</p>
</div>
<div class="paragraph">
<p>Ya hemos comentado que en su contexto, tanto <code>self</code> como <code>this</code> referencian al alcance global.</p>
</div>
<div class="paragraph">
<p>Otra restricción de los <em>web workers</em> es que siguen la política de <em>Same-Origin Policy</em>. Por ejemplo, un script hospedado en <a href="http://www.ejemplo.com" class="bare">http://www.ejemplo.com</a> no puede acceder a otro en <a href="https://www.ejemplo.com" class="bare">https://www.ejemplo.com</a>. Incluso con nombres de dominio idénticos, la política fuerza que el protocolo sea el mismo. Esto no suele ser un problema ya que suelen residir en el mismo dominio, siempre es bueno recordarlo.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="title">Carga de archivos</div>
<div class="paragraph">
<p>Dentro de un worker podemos cargar otros archivos JavaScript mediante <code>importScripts()</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="javascript"><span class="tok-nx">importScripts</span><span class="tok-p">(</span><span class="tok-s2">&quot;script1.js&quot;</span><span class="tok-p">,</span> <span class="tok-s2">&quot;script2.js&quot;</span><span class="tok-p">);</span></code></pre>
</div>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_gestión_de_errores_2">5.5.5. Gestión de errores</h4>
<div class="paragraph">
<p>Al no tener acceso a la consola, el proceso de depuración y gestión de errores se complica un poco. Por suerte, las <em>Dev-Tools</em> nos permiten depurar el código del <em>worker</em> como si se tratase de cualquier otro código <em>JavaScript</em></p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/js05/webWorkerDebug.jpg" alt="Debug de un Web Worker en Chrome" width="66%">
</div>
<div class="title">Figure 31. Debug de un Web Worker</div>
</div>
<div class="paragraph">
<p>Para gestionar los errores lanzados por un <em>web workers</em>, el padre puede asignar un manejador de eventos sobre el evento <code>error</code>, el cual propaga un objeto <code>ErrorEvent</code>, el cual se desglosa en tres propiedades:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>filename</code>: nombre del <em>script</em> que provocó el error.</p>
</li>
<li>
<p><code>lineno</code>: línea del error.</p>
</li>
<li>
<p><code>message</code>: descripción del error.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Por ejemplo, en el código de padre podemos añadir el evento de la siguiente manera:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="javascript"><span class="tok-nx">worker</span><span class="tok-p">.</span><span class="tok-nx">addEventListener</span><span class="tok-p">(</span><span class="tok-s1">&#39;error&#39;</span><span class="tok-p">,</span> <span class="tok-kd">function</span><span class="tok-p">(</span><span class="tok-nx">error</span><span class="tok-p">){</span>
  <span class="tok-nx">console</span><span class="tok-p">.</span><span class="tok-nx">log</span><span class="tok-p">(</span><span class="tok-s1">&#39;Error provocado por el worker: &#39;</span> <span class="tok-o">+</span> <span class="tok-nx">error</span><span class="tok-p">.</span><span class="tok-nx">filename</span>
    <span class="tok-o">+</span> <span class="tok-s1">&#39; en la linea: &#39;</span> <span class="tok-o">+</span> <span class="tok-nx">error</span><span class="tok-p">.</span><span class="tok-nx">lineno</span>
    <span class="tok-o">+</span> <span class="tok-s1">&#39; con el mensaje: &#39;</span> <span class="tok-o">+</span> <span class="tok-nx">error</span><span class="tok-p">.</span><span class="tok-nx">message</span><span class="tok-p">);</span>
<span class="tok-p">});</span></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_casos_de_uso">5.5.6. Casos de uso</h4>
<div class="paragraph">
<p>Ya hemos comentado que los web workers no están pensados para usarse en grandes cantidades debido a su alto coste de inicio y el gran coste de memoria por instancia.</p>
</div>
<div class="paragraph">
<p>Un caso de uso real puede ser cuando tenemos que trabajar con una librería de terceros con un API síncrona que provoca que el hilo principal tenga que esperar al resultado antes de continuar con la siguiente sentencia. En este caso, podemos delegar la tarea a un nuevo worker para beneficiarnos de la capacidad asíncrona.</p>
</div>
<div class="paragraph">
<p>También funcionan muy bien en situaciones de checkeo (<em>polling</em>) continuo a un destino en <em>background</em> y envío de mensaje al hilo principal cuando llega algún dato.</p>
</div>
<div class="paragraph">
<p>Si necesitamos procesar una gran cantidad de información devuelta por el servidor, es mejor crear varios <em>workers</em> para procesar los datos en porciones que no se solapen.</p>
</div>
<div class="paragraph">
<p>Finalmente, también se emplea para analizar fuentes de video o audio con la ayuda de múltiples web workers, cada uno trabajando en una parte predefinida del problema</p>
</div>
<div class="paragraph">
<p>Aunque se trate de una tecnología que no esta completamente implantada, en un futuro abrirá nuevas posibilidades una vez los navegadores la implementes y ofrezcan herramientas de depuración.</p>
</div>
</div>
<div class="sect3">
<h4 id="__em_shared_workers_em">5.5.7. <em>Shared workers</em></h4>
<div class="paragraph">
<p>La especificación de HTML5 define dos tipos de <em>workers</em>, los dedicados y los compartidos (<em>shared</em>). Los dedicados son los que hemos estudiado, ya que existe una relación directa entre el creador del worker y el propio <em>worker</em> mediante una relación 1:1.</p>
</div>
<div class="paragraph">
<p>En cambio, un <em>shared worker</em> puede compartirse entre todas las páginas de un mismo origen, por ejemplo, todas las páginas o <em>scripts</em> de un mismo dominio pueden comunicarse con un único <em>shared worker</em>.</p>
</div>
<div class="admonitionblock caution">
<table>
<tr>
<td class="icon">
<i class="fa icon-caution" title="Caution"></i>
</td>
<td class="content">
Hay que tener en cuenta que a día de hoy ni <em>Internet Explorer</em> ni <em>Safari</em> los soportan, estando disponibles únicamente en <em>Firefox</em>, <em>Chrome</em> y <em>Opera</em> (<a href="http://caniuse.com/#feat=sharedworkers" class="bare">http://caniuse.com/#feat=sharedworkers</a>).
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>La principal diferencia en el modo de usar los <em>workers</em> compartidos es que se asocian a un puerto mediante la propiedad <code>port</code>, para mantener el contacto con el <em>script</em> padre que accede a ellos.</p>
</div>
<div class="paragraph">
<p>Para crear un <em>worker</em> compartido le pasaremos la URL del script o el nombre del <em>worker</em> al constructor de <code>SharedWorker</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="javascript"><span class="tok-kd">var</span> <span class="tok-nx">sharedWorker</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-nx">SharedWorker</span><span class="tok-p">(</span><span class="tok-s1">&#39;otroScript.js&#39;</span><span class="tok-p">);</span>
<span class="tok-nx">sharedWorker</span><span class="tok-p">.</span><span class="tok-nx">port</span><span class="tok-p">.</span><span class="tok-nx">onmessage</span> <span class="tok-o">=</span> <span class="tok-kd">function</span><span class="tok-p">(</span><span class="tok-nx">evt</span><span class="tok-p">)</span> <span class="tok-p">{</span>
  <span class="tok-c1">// recibimos los datos del hijo compartido</span>
<span class="tok-p">}</span>

<span class="tok-nx">sharedWorker</span><span class="tok-p">.</span><span class="tok-nx">port</span><span class="tok-p">.</span><span class="tok-nx">start</span><span class="tok-p">();</span>  <i class="conum" data-value="1"></i><b>(1)</b>

<span class="tok-nx">sharedWorker</span><span class="tok-p">.</span><span class="tok-nx">port</span><span class="tok-p">.</span><span class="tok-nx">postMessage</span><span class="tok-p">(</span><span class="tok-s1">&#39;datos que queremos enviar&#39;</span><span class="tok-p">);</span></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Antes de poder enviar mensajes, necesitamos arrancar el puerto mediante el método <code>start()</code></td>
</tr>
</table>
</div>
<div class="paragraph">
<p>De manera similar, un <em>worker</em> puede escuchar el evento <code>connect</code>, el cual se lanza cuando un nuevo cliente intenta conectarse al <em>worker</em>. Una vez conectado, sobre el puerto activo, añadiremos un manejador sobre el evento <code>message</code>, dentro del cual normalmente contestaremos al hilo padre:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="javascript"><span class="tok-nx">self</span><span class="tok-p">.</span><span class="tok-nx">onconnect</span> <span class="tok-o">=</span> <span class="tok-kd">function</span><span class="tok-p">(</span><span class="tok-nx">evento</span><span class="tok-p">)</span> <span class="tok-p">{</span>
  <span class="tok-kd">var</span> <span class="tok-nx">clientePuerto</span> <span class="tok-o">=</span> <span class="tok-nx">event</span><span class="tok-p">.</span><span class="tok-nx">source</span><span class="tok-p">;</span>  <i class="conum" data-value="1"></i><b>(1)</b>

  <span class="tok-nx">clientePuerto</span><span class="tok-p">.</span><span class="tok-nx">onmessage</span> <span class="tok-o">=</span> <span class="tok-kd">function</span><span class="tok-p">(</span><span class="tok-nx">evento</span><span class="tok-p">)</span> <span class="tok-p">{</span>  <i class="conum" data-value="2"></i><b>(2)</b>
    <span class="tok-kd">var</span> <span class="tok-nx">datos</span> <span class="tok-o">=</span> <span class="tok-nx">evento</span><span class="tok-p">.</span><span class="tok-nx">data</span><span class="tok-p">;</span>  <i class="conum" data-value="3"></i><b>(3)</b>
    <span class="tok-c1">// ... procesamos los datos</span>
    <span class="tok-nx">clientePuerto</span><span class="tok-p">.</span><span class="tok-nx">postMessage</span><span class="tok-p">(</span><span class="tok-s1">&#39;datos de respuesta&#39;</span><span class="tok-p">);</span> <i class="conum" data-value="4"></i><b>(4)</b>
  <span class="tok-p">}</span>

  <span class="tok-nx">clientePuerto</span><span class="tok-p">.</span><span class="tok-nx">start</span><span class="tok-p">();</span>  <i class="conum" data-value="5"></i><b>(5)</b>
<span class="tok-p">};</span></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td><code>evento.source</code> contiene la referencia al puerto del cliente</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>escucha cualquier mensaje enviado por este cliente</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td><code>evento.data</code> contiene el mensaje enviado por el cliente</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>tras procesar los datos, se envía la respuesta al padre</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>tras asignar el manejador, le indicamos al puerto que ya estamos listos para escuchar y enviar mensajes mediante el método <code>start()</code>.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Un caso de uso de los <em>shared workers</em> es que, debido a su naturaleza compartida, permite mantener el mismo estado en diferentes pestañas de la misma aplicación, ya que las páginas utilizan el mismo <em>script</em> de <em>worker</em> compartido para mantener e informar del estado.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_websockets">5.6. WebSockets</h3>
<div class="paragraph">
<p>Una de las características más novedosas de HTML5 son los <em>WebSockets</em>, los cuales permiten comunicar un cliente con el servidor sin necesidad de peticiones AJAX.</p>
</div>
<div class="paragraph">
<p>Así pues, son una técnica de comunicación bidireccional sobre un socket TCP, un tipo de tecnología PUSH.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
En el módulo de Componentes Web ya estudiamos como trabajar con WebSockets, pero desde el punto de vista del servidor mediante Servlets. Ahora vamos a centrarnos en el lado del cliente.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Para utilizar <em>WebSockets</em> necesitamos crear un objeto <code>WebSocket</code>, el cual automáticamente abrirá un conexión temporal al servidor.</p>
</div>
<div class="paragraph">
<p>Su constructor recibe un parámetro con la URL que vamos a conectar y otro opcional con información sobre los protocolos a emplear:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="javascript"><span class="tok-kd">var</span> <span class="tok-nx">ejemploWS</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-nx">WebSocket</span><span class="tok-p">(</span><span class="tok-s2">&quot;ws://www.ejemplo.com/servidorSockets&quot;</span><span class="tok-p">,</span> <span class="tok-s2">&quot;json&quot;</span><span class="tok-p">);</span> <i class="conum" data-value="1"></i><b>(1)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>los esquemas URL <code>ws</code> y <code>wss</code> referencias a conexiones con websockets y websockets seguros, respectivamente</td>
</tr>
</table>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
No podemos usar <em>WebSockets</em> entre contextos seguros y no seguros, ya que se mantiene <em>Same-Origin Policy</em>, con lo que no podemos abrir una conexión no segura desde una página cargada mediante HTTPS o viceversa.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Una vez creada la conexión, podemos consultar el estado de la misma mediante la propiedad <code>status</code>, cuyos valores pueden ser:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>0</code>: conectando</p>
</li>
<li>
<p><code>1</code>: abierto</p>
</li>
<li>
<p><code>2</code>: cerrado</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Una vez conectados, ya podemos enviar datos al servidor mediante el método <code>send()</code> cada vez que queramos enviar un mensaje:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="javascript"><span class="tok-nx">ejemploWS</span><span class="tok-p">.</span><span class="tok-nx">send</span><span class="tok-p">(</span><span class="tok-s2">&quot;Texto para el servidor&quot;</span><span class="tok-p">);</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Los datos que podemos enviar son del tipo <code>String</code> (en UTF8), <code>Blob</code> o <code>ArrayBuffer</code></p>
</div>
<div class="paragraph">
<p>Cuando hayamos finalizado la conexión <em>WebSocket</em>, llamaremos al método <code>close()</code> del objeto <code>WebSocket</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="javascript"><span class="tok-nx">ejemploWS</span><span class="tok-p">.</span><span class="tok-nx">close</span><span class="tok-p">();</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Antes de cerrar la conexión puede ser necesario comprobar el valor del atributo <code>bufferedAmount</code> para verificar que se ha transmitido toda la información.</p>
</div>
<div class="sect3">
<h4 id="_eventos_3">5.6.1. Eventos</h4>
<div class="paragraph">
<p>Al tratarse de una conexión asíncrona, no hay garantía de poder llamar al método <code>send()</code> inmediatamente después de haber creado el objeto <code>WebSocket</code>.</p>
</div>
<div class="paragraph">
<p>Por ello, todos los mecanismos de comunicación y gestión de la conexión se realizan mediante eventos.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/js05/webSocketEvents.jpg" alt="Eventos con WebSocket" width="50%">
</div>
<div class="title">Figure 32. Eventos con WebSocket</div>
</div>
<div class="paragraph">
<p>Para enviar información, previamente hemos de asegurarnos que la conexión se ha abierto exitosamente mediante el evento <code>onopen</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="javascript"><span class="tok-nx">ejemploWS</span><span class="tok-p">.</span><span class="tok-nx">onopen</span> <span class="tok-o">=</span> <span class="tok-kd">function</span> <span class="tok-p">(</span><span class="tok-nx">evt</span><span class="tok-p">)</span> <span class="tok-p">{</span>
  <span class="tok-nx">ejemploWS</span><span class="tok-p">.</span><span class="tok-nx">send</span><span class="tok-p">(</span><span class="tok-s2">&quot;Texto para el servidor&quot;</span><span class="tok-p">);</span>
<span class="tok-p">};</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Para tratar la respuesta del servidor hay que utilizar el evento <code>onmessage</code> el cual saltará al recibir un mensaje:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="javascript"><span class="tok-nx">ejemploWS</span><span class="tok-p">.</span><span class="tok-nx">onmessage</span> <span class="tok-o">=</span> <span class="tok-kd">function</span> <span class="tok-p">(</span><span class="tok-nx">evt</span><span class="tok-p">)</span> <span class="tok-p">{</span>
  <span class="tok-nx">console</span><span class="tok-p">.</span><span class="tok-nx">log</span><span class="tok-p">(</span><span class="tok-nx">evt</span><span class="tok-p">.</span><span class="tok-nx">data</span><span class="tok-p">);</span>  <i class="conum" data-value="1"></i><b>(1)</b>
<span class="tok-p">};</span></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Para extraer la información del mensaje, hay que acceder a la propiedad <code>data</code> del objeto recibido.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Finalmente, para comprobar si ha sucedido algún error, le asignaremos un manejador al evento <code>onerror</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="javascript"><span class="tok-nx">ejemploWS</span><span class="tok-p">.</span><span class="tok-nx">onerror</span> <span class="tok-o">=</span> <span class="tok-kd">function</span> <span class="tok-p">(</span><span class="tok-nx">evt</span><span class="tok-p">)</span> <span class="tok-p">{</span>
  <span class="tok-nx">console</span><span class="tok-p">.</span><span class="tok-nx">log</span><span class="tok-p">(</span><span class="tok-s2">&quot;Error:&quot;</span> <span class="tok-o">+</span> <span class="tok-nx">evt</span><span class="tok-p">);</span>
<span class="tok-p">};</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Los casos de uso principales de los <em>WebSockets</em> se centran en:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Actualización en tiempo real en las aplicaciones de redes sociales</p>
</li>
<li>
<p>Juegos multi-jugador mediante <em>HTML5</em></p>
</li>
<li>
<p>Aplicaciones de chat online</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_ejemplo_chat">5.6.2. Ejemplo chat</h4>
<div class="paragraph">
<p>Si ahora revisamos el código de la sala de chat que vimos en el módulo de Componentes Web, podemos comprobar como se creaba la conexión y la manera en que gestionábamos los eventos de los mensajes recibidos:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="javascript"><span class="tok-kd">var</span> <span class="tok-nx">websocket</span><span class="tok-p">;</span>

<span class="tok-kd">function</span> <span class="tok-nx">connect</span><span class="tok-p">(</span><span class="tok-nx">nick</span><span class="tok-p">,</span> <span class="tok-nx">sala</span><span class="tok-p">)</span> <span class="tok-p">{</span>
  <span class="tok-k">if</span> <span class="tok-p">(</span><span class="tok-nx">sala</span> <span class="tok-o">==</span> <span class="tok-kc">undefined</span><span class="tok-p">)</span> <span class="tok-p">{</span>
    <span class="tok-nx">websocket</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-nx">WebSocket</span><span class="tok-p">(</span><span class="tok-s2">&quot;ws://localhost:8080/cweb-chat/ChatWS&quot;</span><span class="tok-p">);</span>
  <span class="tok-p">}</span> <span class="tok-k">else</span> <span class="tok-p">{</span>
    <span class="tok-nx">websocket</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-nx">WebSocket</span><span class="tok-p">(</span><span class="tok-s2">&quot;ws://localhost:8080/cweb-chat/ChatWS/&quot;</span> <span class="tok-o">+</span> <span class="tok-nx">sala</span> <span class="tok-o">+</span> <span class="tok-s2">&quot;?nick=&quot;</span> <span class="tok-o">+</span> <span class="tok-nx">nick</span><span class="tok-p">);</span>
  <span class="tok-p">}</span>

  <span class="tok-nx">websocket</span><span class="tok-p">.</span><span class="tok-nx">onmessage</span> <span class="tok-o">=</span> <span class="tok-nx">onMessage</span><span class="tok-p">;</span>  <i class="conum" data-value="1"></i><b>(1)</b>
  <span class="tok-nx">websocket</span><span class="tok-p">.</span><span class="tok-nx">onopen</span> <span class="tok-o">=</span> <span class="tok-nx">onOpen</span><span class="tok-p">;</span>
<span class="tok-p">}</span>

<span class="tok-kd">function</span> <span class="tok-nx">onOpen</span><span class="tok-p">(</span><span class="tok-nx">event</span><span class="tok-p">)</span> <span class="tok-p">{</span>
  <span class="tok-nb">document</span><span class="tok-p">.</span><span class="tok-nx">getElementById</span><span class="tok-p">(</span><span class="tok-s2">&quot;chat&quot;</span><span class="tok-p">).</span><span class="tok-nx">style</span><span class="tok-p">.</span><span class="tok-nx">display</span> <span class="tok-o">=</span> <span class="tok-s1">&#39;block&#39;</span><span class="tok-p">;</span>
  <span class="tok-nb">document</span><span class="tok-p">.</span><span class="tok-nx">getElementById</span><span class="tok-p">(</span><span class="tok-s2">&quot;login&quot;</span><span class="tok-p">).</span><span class="tok-nx">style</span><span class="tok-p">.</span><span class="tok-nx">display</span> <span class="tok-o">=</span> <span class="tok-s1">&#39;none&#39;</span><span class="tok-p">;</span>
<span class="tok-p">}</span>

<span class="tok-kd">function</span> <span class="tok-nx">onMessage</span><span class="tok-p">(</span><span class="tok-nx">event</span><span class="tok-p">)</span> <span class="tok-p">{</span>
  <span class="tok-nx">items</span> <span class="tok-o">=</span> <span class="tok-nx">event</span><span class="tok-p">.</span><span class="tok-nx">data</span><span class="tok-p">.</span><span class="tok-nx">split</span><span class="tok-p">(</span><span class="tok-s2">&quot;;&quot;</span><span class="tok-p">);</span>  <i class="conum" data-value="2"></i><b>(2)</b>
  <span class="tok-nb">document</span><span class="tok-p">.</span><span class="tok-nx">getElementById</span><span class="tok-p">(</span><span class="tok-s2">&quot;mensajes&quot;</span><span class="tok-p">).</span><span class="tok-nx">innerHTML</span> <span class="tok-o">=</span> <span class="tok-s2">&quot;&lt;p&gt;&lt;strong&gt;&amp;lt;&quot;</span> <span class="tok-o">+</span> <span class="tok-nx">items</span><span class="tok-p">[</span><span class="tok-mi">0</span><span class="tok-p">]</span> <span class="tok-o">+</span> <span class="tok-s2">&quot;&amp;gt;&lt;/strong&gt; &quot;</span> <span class="tok-o">+</span> <span class="tok-nx">items</span><span class="tok-p">[</span><span class="tok-mi">1</span><span class="tok-p">]</span> <span class="tok-o">+</span> <span class="tok-s2">&quot;&lt;/p&gt;&quot;</span> <span class="tok-o">+</span> <span class="tok-nb">document</span><span class="tok-p">.</span><span class="tok-nx">getElementById</span><span class="tok-p">(</span><span class="tok-s2">&quot;mensajes&quot;</span><span class="tok-p">).</span><span class="tok-nx">innerHTML</span><span class="tok-p">;</span>
<span class="tok-p">}</span>

<span class="tok-kd">function</span> <span class="tok-nx">send</span><span class="tok-p">(</span><span class="tok-nx">texto</span><span class="tok-p">)</span> <span class="tok-p">{</span>
  <span class="tok-nx">websocket</span><span class="tok-p">.</span><span class="tok-nx">send</span><span class="tok-p">(</span><span class="tok-nx">texto</span><span class="tok-p">);</span>
<span class="tok-p">}</span>

<span class="tok-c1">// Eliminar esta linea para implementar nick y sala</span>
<span class="tok-nb">window</span><span class="tok-p">.</span><span class="tok-nx">addEventListener</span><span class="tok-p">(</span><span class="tok-s2">&quot;load&quot;</span><span class="tok-p">,</span> <span class="tok-nx">connect</span><span class="tok-p">,</span> <span class="tok-kc">false</span><span class="tok-p">);</span></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Asociamos las funciones a los eventos de mensaje y apertura de la conexión</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Al recibir un mensaje, separa los datos por el carácter <code>;</code></td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_rendimiento">5.7. Rendimiento</h3>
<div class="paragraph">
<p>Un elemento a tener en cuenta desde el mismo momento que empezar a codificar es el rendimiento.</p>
</div>
<div class="sect3">
<h4 id="_identificar_los_problemas">5.7.1. Identificar los problemas</h4>
<div class="paragraph">
<p>Antes de optimizar cualquier código, debemos averiguar que parte es la que provoca los cuellos de botella o que funcionan lentamente.</p>
</div>
<div class="paragraph">
<p>Para ello, podemos hacer uso de:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Herramientas de <strong>Profiling</strong>: Las <em>Dev-Tools</em> incluyen este tipo de herramientas, las cuales podemos usar desde:</p>
<div class="ulist">
<ul>
<li>
<p>el botón/pestaña de <em>Profile</em></p>
</li>
<li>
<p>la consola, mediante las funciones <code>profile()</code> y <code>profileEnd()</code></p>
</li>
<li>
<p>el código de aplicación, mediante <code>console.profile()</code> y <code>console.profileEnd()</code></p>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
Más información sobre el <em>profiler CPU</em> en <a href="https://developer.chrome.com/devtools/docs/cpu-profiling" class="bare">https://developer.chrome.com/devtools/docs/cpu-profiling</a> o sobre el <em>profiler</em> de pila en <a href="https://developer.chrome.com/devtools/docs/heap-profiling" class="bare">https://developer.chrome.com/devtools/docs/heap-profiling</a>
</td>
</tr>
</table>
</div>
</li>
</ul>
</div>
</li>
<li>
<p><strong>Timers</strong> manuales: en el código de aplicación, mediante <code>console.time()</code> y <code>console.timeEnd()</code></p>
</li>
<li>
<p>Herramientas de <strong>Análisis de peticiones</strong>, por ejemplo, mediante las <em>DevTools</em> y la pestaña <em>Network</em>, donde podemos visualizar todos los recursos (<code>.html</code>, <code>.js</code>, <code>.css</code>, imágenes, etc..) que utiliza nuestra página, con su tipo y tamaño, los detalles de las respuestas del servidor, o un <em>timeline</em> con las peticiones de red.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Para ello, primero hemos de abrir la pestaña <em>Network</em> de las <em>Dev-Tools</em> y posteriormente acceder al recurso que queremos analizar. Por ejemplo, si accedemos a la web del experto <a href="../../../../index.html" class="bare">http://expertojava.ua.es/</a> obtendremos el siguiente análisis:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/js05/devToolsNetwork.jpg" alt="Análisis de Peticiones con DevTools" width="100%">
</div>
<div class="title">Figure 33. Análisis de Peticiones con DevTools</div>
</div>
<div class="paragraph">
<p>Del gráfico podemos deducir que pese a que los recursos que más ocupan son las librerías y hojas de estilo de <em>Bootstrap</em> y <em>jQuery</em> las cuales se cachean en posteriores visitas. Si volvemos a cargar la página tendremos que el tiempo de carga de las librerías es 0 y se obtienen desde la caché del navegador:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/js05/devToolsNetworkCache.jpg" alt="Análisis de Peticiones con DevTools con recursos cacheados" width="100%">
</div>
<div class="title">Figure 34. Análisis de Peticiones con DevTools con recursos cacheados</div>
</div>
<div class="paragraph">
<p>Podemos observar como el recurso <code>publico</code> de tipo <code>html</code> tiene un código de estado 304, lo que indica que este recurso ya se ha descargado previamente y que no ha sido modificado desde entonces, y por ello se han descargado 123 B en vez de 3,9 KB, es decir, la cabecera HTTP del recurso.</p>
</div>
<div class="paragraph">
<p>Si comprobamos la barra de estado inferior podemos ver como hemos pasado de 227KB a 123B de información transferida, y de 381ms a 246ms. Además, el tiempo necesario para la carga de la página y del DOM también se ha reducido.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
Si queremos que el navegador realice una carga completa de la página ignorando los recursos cacheado, podemos usar <em>CTRL</em> + <em>F5</em> o <em>SHIFT</em> + botón de actualizar.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Más información sobre el análisis de la red en <a href="https://developer.chrome.com/devtools/docs/network" class="bare">https://developer.chrome.com/devtools/docs/network</a></p>
</div>
</div>
<div class="sect3">
<h4 id="_reglas">5.7.2. Reglas</h4>
<div class="paragraph">
<p>Una serie de reglas a tomar dentro de JavaScript son:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Minificar</strong> el código (eliminado espacios y comentarios) para reducir el tamaño de los archivos, mediante herramientas como:</p>
<div class="ulist">
<ul>
<li>
<p><em>Google Closure Compiler</em> (<a href="https://developers.google.com/closure/compiler/" class="bare">https://developers.google.com/closure/compiler/</a>)</p>
</li>
<li>
<p><em>YUI Compressor</em> (<a href="http://yui.github.io/yuicompressor/" class="bare">http://yui.github.io/yuicompressor/</a>)</p>
</li>
<li>
<p><em>UglifyJS2</em> (<a href="https://github.com/mishoo/UglifyJS2" class="bare">https://github.com/mishoo/UglifyJS2</a>)
Relacionado con la minificación está la <strong>ofuscación</strong>, la cual además de eliminar contenido innecesario, renombra las variables y funciones, lo que a su vez también reduce todavía más el tamaño del código. Aunque es conveniente tener en cuenta que minificar es menos arriesgado.</p>
</li>
</ul>
</div>
</li>
<li>
<p><strong>Reducir el número de archivos <em>JavaScript</em></strong> que contiene nuestra página, ya que el navegador tiene un número determinado de peticiones simultaneas que puede realizar. Para ello, podemos combinar nuestras librerías en una sola, por ejemplo, mediante <em>Google Closure Compiler</em> en <a href="http://closure-compiler.appspot.com/home" class="bare">http://closure-compiler.appspot.com/home</a>. Se recomienda tres tipos de enlace a las librerías JavaScript:</p>
<div class="ulist">
<ul>
<li>
<p>mediante CDN a las librerías famosas (<em>jQuery</em>, <em>Bootstrap</em>, ..)</p>
</li>
<li>
<p>dejar a solas la librería de nuestra aplicación, ya que si la modificamos cada semana no tenemos que estar combinándola con las librerías de terceros</p>
</li>
<li>
<p>combinar el resto de librerías de terceros.</p>
</li>
</ul>
</div>
</li>
<li>
<p>Comprobar la <strong>calidad del código</strong> mediante herramientas de validación como:</p>
<div class="ulist">
<ul>
<li>
<p>JSLint (<a href="http://jslint.com" class="bare">http://jslint.com</a>)</p>
</li>
<li>
<p>JSHint (<a href="http://jshint.com" class="bare">http://jshint.com</a>)</p>
</li>
</ul>
</div>
</li>
<li>
<p>Colocar los enlaces a las hojas de estilo antes de los archivos <em>JavaScript</em>, para que la página se renderice antes.</p>
</li>
<li>
<p>Colocar los enlaces a código <em>JavaScript</em> al final de la página, para que primero se cargue todo el contenido <em>DOM</em>, o realizar la carga de la librería <em>JavaScript</em> de manera asíncrona incluyendo el atributo <code><strong>async</strong></code>:</p>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="html"><span class="tok-nt">&lt;script </span><span class="tok-na">src=</span><span class="tok-s">&quot;miLibreriaJS.js&quot;</span> <span class="tok-na">async</span><span class="tok-nt">&gt;&lt;/script&gt;</span></code></pre>
</div>
</div>
</li>
<li>
<p>Utilizar funciones con nombre en vez de anónimas, para que aparezcan en el <em>Profiler</em></p>
</li>
<li>
<p>Aislar las llamadas <em>AJAX</em> y <em>HTTP</em> para centrarse en el código <em>JavaScript</em>. Para ello, es conveniente crear objetos <em>mock</em> que eviten el tráfico de red.</p>
</li>
<li>
<p>Dominar la herramienta <em>Profiler</em> que usemos en nuestro entorno de trabajo.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>También podemos instalar el plugin de <em>Google Chrome</em> denominado <strong>PageSpeed</strong> o acceder la web del proyecto (<a href="https://developers.google.com/speed/pagespeed/" class="bare">https://developers.google.com/speed/pagespeed/</a>) donde podemos indicarle qué página queremos analizar. Por ejemplo, si probamos con <a href="../../../../index.html" class="bare">http://expertojava.ua.es</a> tendremos el siguiente resultado:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/js05/pageSpeed.jpg" alt="Análisis de Rendimiento con PageSpeed" width="66%">
</div>
<div class="title">Figure 35. Análisis de Rendimiento con PageSpeed</div>
</div>
<div class="paragraph">
<p>Además de <em>Google</em>, el equipo de <em>Yahoo</em> tiene un artículo imprescindible donde explica el conjunto de reglas (<a href="https://developer.yahoo.com/performance/rules.html" class="bare">https://developer.yahoo.com/performance/rules.html</a>) que siguen ellos para evaluar el rendimiento de una aplicación web y el plugin <strong>YSlow</strong> (<a href="http://yslow.org/" class="bare">http://yslow.org/</a>) para cualquier navegador que evalúa estas reglas.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_ejercicios_5">5.8. Ejercicios</h3>
<div class="sect3">
<h4 id="__0_6_ptos_ejercicio_51_em_star_wars_em">5.8.1. (0.6 ptos) Ejercicio 51. <em>Star Wars</em></h4>
<div class="paragraph">
<p>Vamos a crear una aplicación que muestre información sobre <em>Star Wars</em>. Para ello, vamos a utilizar el API REST que ofrece <em>'The Star Wars API'</em> en <a href="http://swapi.co" class="bare">http://swapi.co</a>, la cual permite su acceso mediante CORS (sin necesidad de usar JSONP).</p>
</div>
<div class="paragraph">
<p>Para ello, al cargar la página, vamos a mostrar un listado con las películas de <em>Star Wars</em>.</p>
</div>
<div class="paragraph">
<p>Al pulsar sobre el título de una película, se mostrará la sinopsis de la misma y un listado con un máximo de 10 personajes que aparecen en la misma.</p>
</div>
<div class="paragraph">
<p>Para ello, nos basaremos en la siguiente página:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="html"><span class="tok-cp">&lt;!DOCTYPE html&gt;</span>
<span class="tok-nt">&lt;html&gt;</span>
<span class="tok-nt">&lt;head&gt;</span>
<span class="tok-nt">&lt;title&gt;</span>Ejercicio 51<span class="tok-nt">&lt;/title&gt;</span>
<span class="tok-nt">&lt;meta</span> <span class="tok-na">charset=</span><span class="tok-s">&quot;utf-8&quot;</span> <span class="tok-nt">/&gt;</span>
<span class="tok-nt">&lt;/head&gt;</span>
<span class="tok-nt">&lt;body&gt;</span>
  <span class="tok-nt">&lt;h1&gt;</span>Star War API<span class="tok-nt">&lt;/h1&gt;</span>
  <span class="tok-nt">&lt;h2&gt;</span>Películas - <span class="tok-nt">&lt;span</span> <span class="tok-na">id=</span><span class="tok-s">&quot;total&quot;</span><span class="tok-nt">&gt;&lt;/span&gt;&lt;/h2&gt;</span>
  <span class="tok-nt">&lt;ul</span> <span class="tok-na">id=</span><span class="tok-s">&quot;peliculas&quot;</span><span class="tok-nt">&gt;&lt;/ul&gt;</span>

  <span class="tok-nt">&lt;h2&gt;</span>Sinopsis<span class="tok-nt">&lt;/h2&gt;</span>
  <span class="tok-nt">&lt;div</span> <span class="tok-na">id=</span><span class="tok-s">&quot;sinopsis&quot;</span><span class="tok-nt">&gt;&lt;/div&gt;</span>

  <span class="tok-nt">&lt;h2&gt;</span>Personajes<span class="tok-nt">&lt;/h2&gt;</span>
  <span class="tok-nt">&lt;ul</span> <span class="tok-na">id=</span><span class="tok-s">&quot;personajes&quot;</span><span class="tok-nt">&gt;&lt;/ul&gt;</span>
  <span class="tok-nt">&lt;script </span><span class="tok-na">src=</span><span class="tok-s">&quot;ej51.js&quot;</span><span class="tok-nt">&gt;&lt;/script&gt;</span>
<span class="tok-nt">&lt;/body&gt;</span>
<span class="tok-nt">&lt;/html&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Y haciendo uso de <em>AJAX</em> y <em>JSON</em>, obtendremos un resultado similar al siguiente:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/js05/ej51.jpg" alt="Resultado de SWAPI" width="66%">
</div>
<div class="title">Figure 36. Resultado de SWAPI</div>
</div>
<div class="paragraph">
<p>Todo el código <em>JavaScript</em> se almacenará en una archivo denominado <code>ej51.js</code>:</p>
</div>
</div>
<div class="sect3">
<h4 id="__0_5_ptos_ejercicio_52_em_almacén_em">5.8.2. (0.5 ptos) Ejercicio 52. <em>Almacén</em></h4>
<div class="paragraph">
<p>Supongamos que tenemos un formulario de registro acceso a una aplicación con el usuario:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="html"><span class="tok-cp">&lt;!DOCTYPE html&gt;</span>
<span class="tok-nt">&lt;html&gt;</span>
<span class="tok-nt">&lt;head&gt;</span>
  <span class="tok-nt">&lt;title&gt;</span>Ejercicio 52<span class="tok-nt">&lt;/title&gt;</span>
  <span class="tok-nt">&lt;meta</span> <span class="tok-na">charset=</span><span class="tok-s">&quot;utf-8&quot;</span> <span class="tok-nt">/&gt;</span>
<span class="tok-nt">&lt;/head&gt;</span>
<span class="tok-nt">&lt;body&gt;</span>
  <span class="tok-nt">&lt;form</span> <span class="tok-na">id=</span><span class="tok-s">&quot;miForm&quot;</span><span class="tok-nt">&gt;</span>
    Usuario: <span class="tok-nt">&lt;input</span> <span class="tok-na">type=</span><span class="tok-s">&quot;text&quot;</span> <span class="tok-na">name=</span><span class="tok-s">&quot;usuario&quot;</span> <span class="tok-na">id=</span><span class="tok-s">&quot;inputUsuario&quot;</span> <span class="tok-nt">/&gt;&lt;br/&gt;</span>
    <span class="tok-nt">&lt;input</span> <span class="tok-na">type=</span><span class="tok-s">&quot;submit&quot;</span> <span class="tok-na">id=</span><span class="tok-s">&quot;btnSubmit&quot;</span> <span class="tok-na">value=</span><span class="tok-s">&quot;Enviar&quot;</span> <span class="tok-nt">/&gt;</span>
  <span class="tok-nt">&lt;/form&gt;</span>
  Visitas usuario: <span class="tok-nt">&lt;span</span> <span class="tok-na">id=</span><span class="tok-s">&quot;visitas&quot;</span><span class="tok-nt">&gt;&lt;/span&gt;</span> <span class="tok-nt">&lt;br</span> <span class="tok-nt">/&gt;</span>
  Total visitas: <span class="tok-nt">&lt;span</span> <span class="tok-na">id=</span><span class="tok-s">&quot;total&quot;</span><span class="tok-nt">&gt;&lt;/span&gt;</span>
  <span class="tok-nt">&lt;script </span><span class="tok-na">src=</span><span class="tok-s">&quot;ej52.js&quot;</span><span class="tok-nt">&gt;&lt;/script&gt;</span>
<span class="tok-nt">&lt;/body&gt;</span>
<span class="tok-nt">&lt;/html&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Tras introducir los datos del usuario, las capas de <code>visitas</code> y <code>total</code> se actualizarán automáticamente con el número de visitas del usuario y con el total de visitas realizadas desde el navegador, independientemente del usuario rellenado.</p>
</div>
<div class="paragraph">
<p>Para ello, guardar en el almacén local:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>una entrada con el total de visitas</p>
</li>
<li>
<p>una entrada por cada usuario para contar el número de visitas</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Todo el código <em>JavaScript</em> se almacenará en una archivo denominado <code>ej52.js</code>:</p>
</div>
</div>
<div class="sect3">
<h4 id="__0_5_ptos_ejercicio_53_em_web_workers_em">5.8.3. (0.5 ptos) Ejercicio 53. <em>Web Workers</em></h4>
<div class="paragraph">
<p>A partir del API de <em>Star Wars</em>, vamos a crear una aplicación que nos indique cuantos elementos contiene cada una de las categorías.</p>
</div>
<div class="paragraph">
<p>Para ello, mediante <a href="http://swapi.co/api/" class="bare">http://swapi.co/api/</a> obtendremos un objeto JSON con las propiedades y las URLs de los recursos disponibles.</p>
</div>
<div class="paragraph">
<p>Para cada uno de estos recursos, hemos de crear un Web Worker que realice la petición AJAX y obtenga el número de elementos que contiene, es decir, cada uno de los hijos realizará una petición REST a una categoría. Una vez obtenido el resultado, devolverá el número de elementos de dicha categoría al padre.</p>
</div>
<div class="paragraph">
<p>La plantilla HTML será similar a la siguiente:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="html"><span class="tok-cp">&lt;!DOCTYPE html&gt;</span>
<span class="tok-nt">&lt;html&gt;</span>
<span class="tok-nt">&lt;head</span> <span class="tok-na">lang=</span><span class="tok-s">&quot;es&quot;</span><span class="tok-nt">&gt;</span>
<span class="tok-nt">&lt;meta</span> <span class="tok-na">charset=</span><span class="tok-s">&quot;UTF-8&quot;</span><span class="tok-nt">&gt;</span>
<span class="tok-nt">&lt;title&gt;</span>Ejercicio 53<span class="tok-nt">&lt;/title&gt;</span>
<span class="tok-nt">&lt;/head&gt;</span>
<span class="tok-nt">&lt;body&gt;</span>
<span class="tok-nt">&lt;h1&gt;</span>Star War API - Workers<span class="tok-nt">&lt;/h1&gt;</span>
<span class="tok-nt">&lt;h2&gt;</span>Elementos - <span class="tok-nt">&lt;span</span> <span class="tok-na">id=</span><span class="tok-s">&quot;total&quot;</span><span class="tok-nt">&gt;&lt;/span&gt;&lt;/h2&gt;</span>
<span class="tok-nt">&lt;ul</span> <span class="tok-na">id=</span><span class="tok-s">&quot;elementos&quot;</span><span class="tok-nt">&gt;&lt;/ul&gt;</span>

<span class="tok-nt">&lt;script </span><span class="tok-na">src=</span><span class="tok-s">&quot;ej53.js&quot;</span><span class="tok-nt">&gt;&lt;/script&gt;</span>
<span class="tok-nt">&lt;/body&gt;</span>
<span class="tok-nt">&lt;/html&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Y el resultado a la siguiente imagen:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/js05/ej53.jpg" alt="Resultado de SWAPI Workers" width="33%">
</div>
<div class="title">Figure 37. Resultado de SWAPI Workers</div>
</div>
<div class="paragraph">
<p>Todo el código <em>JavaScript</em> se almacenará en:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>un archivo denominado <code>ej53.js</code>, con el código necesario para obtener las categorías y sus urls, y la creación y comunicación con el <em>web worker</em>.</p>
</li>
<li>
<p>un archivo denominado <code>ej53worker.js</code>, con el código necesario para obtener la cantidad de elementos de una determinada categoría/url.</p>
</li>
</ul>
</div>
<div style="page-break-after: always;"></div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="sesion06">6. jQuery</h2>
<div class="sectionbody">
<div class="paragraph">
<p>A día de hoy, podemos asegurar que jQuery (<a href="http://jquery.com" class="bare">http://jquery.com</a>) es la librería JavaScript más utilizada ya que facilita mucho el trabajo del desarrollador. Su lema de <em>write less, do more</em> (escribe menos, haz más) resume su propósito.</p>
</div>
<div class="sect2">
<h3 id="_por_qué_usar_jquery">6.1. Por qué usar jQuery</h3>
<div class="paragraph">
<p>Entre sus características podemos destacar que:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>es software libre y gratuito, lo que ha facilitado su implantación.</p>
</li>
<li>
<p>funciona en todos los navegadores modernos</p>
</li>
<li>
<p>abstrae las prestaciones que ofrece cada navegador, lo que permite que nuestro código se centre en el diseño más que en la plataforma de ejecución</p>
</li>
<li>
<p>se centra en simplificar las tareas de <em>scripts</em> comunes como:</p>
<div class="ulist">
<ul>
<li>
<p>manipular el contenido de un documento web</p>
</li>
<li>
<p>gestionar los eventos con independencia del navegador</p>
</li>
<li>
<p>añadir atractivos efectos y transiciones.</p>
</li>
</ul>
</div>
</li>
<li>
<p>facilita los escenarios de trabajo más comunes como:</p>
<div class="ulist">
<ul>
<li>
<p>gestionar las configuraciones que se realizan al cargar una página</p>
</li>
<li>
<p>tras un evento, obtener y manipular/animar el contenido para volverlo a mostrar en la página.</p>
</li>
</ul>
</div>
</li>
<li>
<p>aprovecha el conocimiento que ya poseemos de CSS, al utilizar la misma sintaxis de selectores</p>
</li>
<li>
<p>trabaja con conjuntos de elementos, permitiéndonos realizar una acción sobre más de un elemento DOM de manera simultánea</p>
</li>
<li>
<p>permite realizar múltiples operaciones sobre un conjunto de elementos mediante una única línea de código, mediante el encadenamiento de sentencias (<em>statement chaining</em>).</p>
</li>
<li>
<p>es extensible mediante multitud de <em>plugins</em> de terceros, o si queremos, mediante <em>plugins</em> de nuestra propia creación</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_versiones">6.2. Versiones</h3>
<div class="paragraph">
<p>Si accedemos a la página de jQuery (<a href="http://jquery.com" class="bare">http://jquery.com</a>) podemos descargar dos versiones: la versión 1.12.1 y la 2.2.1. La principal diferencia es que la versión 2.x deja de dar soporte a las versiones 6, 7 y 8 de Internet Explorer.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/js06/js06Versiones.jpg" alt="Versiones jQuery">
</div>
<div class="title">Figure 38. Versiones jQuery</div>
</div>
<div class="paragraph">
<p>Además, a la hora de descargar la versión en la que estemos interesados, podemos bajar uno de los dos siguientes scripts:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>un script que no está comprimido y que nos permite consultar el código, pero que ocupa más (este es el que usaremos en el módulo)</p>
</li>
<li>
<p>el que está comprimido (<em>minificado</em>) y que se usa en producción para reducir la carga de la página.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Por ejemplo, si nos centramos en la versión <code>1.12.1</code>, la versión de desarrollo ocupa 287KB mientras que la minificada sólo ocupa 95KB, es decir, casi tres veces más.</p>
</div>
<div class="paragraph">
<p>Si no queremos descargarla, podemos usar cualquiera de los CDNs que más nos interese:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>jQuery: <code>&lt;script src="//code.jquery.com/jquery-1.12.1.min.js"&gt;&lt;/script&gt;</code></p>
</li>
<li>
<p>Google: <code>&lt;script src="//ajax.googleapis.com/ajax/libs/jquery/1.12.1/jquery.min.js"&gt;&lt;/script&gt;</code></p>
</li>
<li>
<p>CDNJS: <code>&lt;script src="//cdnjs.cloudflare.com/ajax/libs/jquery/1.12.1/jquery.min.js"&gt;&lt;/script&gt;</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Así pues, una vez elegida la versión que mejor nos convenga, la incluiremos dentro de nuestro código, teniendo en cuenta que deberíamos cargarla tras los archivos CSS y antes de todas las librerías que dependan de <em>jQuery</em>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="html"><span class="tok-nt">&lt;link</span> <span class="tok-na">rel=</span><span class="tok-s">&quot;stylesheet&quot;</span> <span class="tok-na">type=</span><span class="tok-s">&quot;text/css&quot;</span> <span class="tok-na">href=</span><span class="tok-s">&quot;estilos.css&quot;</span> <span class="tok-nt">/&gt;</span>
<span class="tok-nt">&lt;script </span><span class="tok-na">src=</span><span class="tok-s">&quot;jquery.js&quot;</span> <span class="tok-nt">/&gt;</span>
<span class="tok-nt">&lt;script </span><span class="tok-na">src=</span><span class="tok-s">&quot;libQueUsaJQuery.js&quot;</span> <span class="tok-nt">/&gt;</span></code></pre>
</div>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
En todos los ejemplos que veremos en esta sesión y las posteriores damos por supuesto que se ha incluido correctamente la librería de jQuery.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_alias_code_jquery_code_por_code_code">6.3. Alias: <code>jQuery</code> por <code>$</code></h3>
<div class="paragraph">
<p>Así pues, uno de los puntos fuertes de <em>jQuery</em> es que reduce el número de instrucciones que usaríamos con <em>JavaScript</em>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="javascript"><span class="tok-nb">document</span><span class="tok-p">.</span><span class="tok-nx">getElementById</span><span class="tok-p">(</span><span class="tok-s2">&quot;miCapa&quot;</span><span class="tok-p">).</span><span class="tok-nx">className</span> <span class="tok-o">=</span> <span class="tok-s2">&quot;resaltado&quot;</span><span class="tok-p">;</span>
<span class="tok-nx">jQuery</span><span class="tok-p">(</span><span class="tok-s2">&quot;#miCapa&quot;</span><span class="tok-p">).</span><span class="tok-nx">addClass</span><span class="tok-p">(</span><span class="tok-s2">&quot;resaltado&quot;</span><span class="tok-p">);</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Además de ser más corto, <em>jQuery</em> nos permitirá acceder a un elemento sin hacerlo por su ID (por ejemplo, por su clase CSS, por el tipo de etiqueta HTML, &#8230;&#8203;) y filtrar los resultados del selector.</p>
</div>
<div class="paragraph">
<p>Para reducir el tamaño del código, en vez de utilizar todo el rato la función <code>jQuery</code>, se utiliza el alias <code>$</code> que viene predefinido en la librería:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="javascript"><span class="tok-nx">$</span><span class="tok-p">(</span><span class="tok-s2">&quot;#miCapa&quot;</span><span class="tok-p">).</span><span class="tok-nx">addClass</span><span class="tok-p">(</span><span class="tok-s2">&quot;resaltado&quot;</span><span class="tok-p">);</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Así pues, tras el <code>$</code>, rodeado por paréntesis le pasaremos el selector del elemento sobre el que queremos trabajar, para posteriormente encadenar la acción a realizar sobre la selección.</p>
</div>
<div class="paragraph">
<p>Si utilizamos otras librerías <em>JavaScript</em> que también utilice el <code>$</code>, se recomienda realizar una llamada a <code>$.noConflict()</code> para evitar conflictos de <em>namespace</em>. Tras la llamada, el alias <code>$</code> deja de estar disponible, obligándonos a escribir <code>jQuery</code> cada vez que escribiríamos <code>$</code>.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="title">Permitiendo otro alias</div>
<div class="paragraph">
<p>Tal como hemos visto, es recomendable agrupar las instrucciones dentro de una función expresión de invocación inmediata. Si ademas queremos permitir que fuera de esta función se use el alias <code>$</code> para usar otra librería JS como <em>Mootools</em> o <em>Prototype</em>, podemos hacer esto:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="javascript"><span class="tok-p">(</span><span class="tok-kd">function</span><span class="tok-p">(</span><span class="tok-nx">$</span><span class="tok-p">)</span> <span class="tok-p">{</span>	<i class="conum" data-value="1"></i><b>(1)</b>
  <span class="tok-c1">// código jQuery que usa el $</span>
<span class="tok-p">})</span> <span class="tok-p">(</span><span class="tok-nx">jQuery</span><span class="tok-p">);</span></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Si quisiéramos cambiar el alias del <code>$</code> por otro carácter o cadena, en vez de pasar el <code>$</code> como parámetro, podríamos pasarle, por ejemplo, <code>JQ</code>.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Otra manera es usando el evento <code>document.ready</code> que estudiaremos más adelante, el cual se lanza cuando la página ha cargado y recibe como argumento el objeto global <code>jQuery</code>, el cual podemos renombrar:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="javascript"><span class="tok-nx">jQuery</span><span class="tok-p">(</span> <span class="tok-nb">document</span> <span class="tok-p">).</span><span class="tok-nx">ready</span><span class="tok-p">(</span><span class="tok-kd">function</span><span class="tok-p">(</span> <span class="tok-nx">$</span> <span class="tok-p">)</span> <span class="tok-p">{</span>
  <span class="tok-c1">// código jQuery que usa el $</span>
<span class="tok-p">});</span></code></pre>
</div>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_seleccionando_contenido">6.4. Seleccionando contenido</h3>
<div class="paragraph">
<p>Sin duda, una de las operaciones que más vamos a realizar con jQuery es recuperar contenido, mediante selectores y filtros, sobre el cual posteriormente realizaremos alguna acción.</p>
</div>
<div class="paragraph">
<p>El resultado de aplicar un selector siempre va a ser un array de objetos (no son objetos DOM, sino objetos <em>jQuery</em> que envuelven a los objetos DOM añadiéndoles funcionalidad extra) que cumplen el criterio de la consulta. Posteriormente, podemos aplicar un filtro sobre un selector para refinar el array de resultados que devuelve.</p>
</div>
<div class="sect3">
<h4 id="_selectores">6.4.1. Selectores</h4>
<div class="paragraph">
<p>Los selectores y filtros que usa <em>jQuery</em> se basan en la sintaxis de CSS. Para aplicar un selector, le tenemos que pasar el selector como un parámetro entre comillas a la función <code>jQuery</code>, o mejor, a su alias <code>$</code>, del siguiente modo:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="javascript"><span class="tok-nx">$</span><span class="tok-p">(</span><span class="tok-s1">&#39;selector&#39;</span><span class="tok-p">);</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Si queremos restringir el contexto de aplicación del selector para evitar realizar la búsqueda sobre el documento DOM completo, le podemos pasar el contexto como segundo parámetro:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="javascript"><span class="tok-nx">$</span><span class="tok-p">(</span><span class="tok-s1">&#39;selector&#39;</span><span class="tok-p">,</span> <span class="tok-nx">contexto</span><span class="tok-p">);</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Si el contexto que le pasamos contiene muchos elementos, cada elemento se utiliza como punto de inicio en la búsqueda del selector.</p>
</div>
<div class="paragraph">
<p>De este modo, obtendríamos resultados diferentes:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="javascript"><span class="tok-nx">$</span><span class="tok-p">(</span><span class="tok-s1">&#39;p:even&#39;</span><span class="tok-p">);</span> <i class="conum" data-value="1"></i><b>(1)</b>
<span class="tok-nx">$</span><span class="tok-p">(</span><span class="tok-s1">&#39;p:even&#39;</span><span class="tok-p">,</span> <span class="tok-nx">$</span><span class="tok-p">(</span><span class="tok-s1">&#39;.importante&#39;</span><span class="tok-p">));</span> <i class="conum" data-value="2"></i><b>(2)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Obtiene los párrafos pares</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Dentro de los elementos cuya clase es <em>importante</em>, obtendría los párrafos pares</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Si únicamente queremos restringir la búsqueda a un elemento lo mejor es buscar el elemento por su id y pasarle como contexto el <code>HTMLElement</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="javascript"><span class="tok-kd">var</span> <span class="tok-nx">contenido</span> <span class="tok-o">=</span> <span class="tok-nb">document</span><span class="tok-p">.</span><span class="tok-nx">getElementById</span><span class="tok-p">(</span><span class="tok-s2">&quot;contenido&quot;</span><span class="tok-p">);</span>
<span class="tok-nx">$</span><span class="tok-p">(</span><span class="tok-s1">&#39;p:even&#39;</span><span class="tok-p">,</span> <span class="tok-nx">contenido</span><span class="tok-p">);</span></code></pre>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
Hay que intentar minimizar las llamadas a DOM para mejorar el rendimiento. Si podemos sacar a una variable la referencia al elemento que queremos trabajar ahorraremos llamadas <em>jQuery</em>.
</td>
</tr>
</table>
</div>
<div class="sect4">
<h5 id="_básicos">Básicos</h5>
<div class="paragraph">
<p>A continuación tenemos los selectores que son exactamente igual que en CSS:</p>
</div>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 14%;">
<col style="width: 57%;">
<col style="width: 28%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-center valign-middle">Selector</th>
<th class="tableblock halign-left valign-top">Propósito</th>
<th class="tableblock halign-left valign-top">Ejemplo</th>
</tr>
</thead>
<tbody>
<tr>
<th class="tableblock halign-center valign-middle"><p class="tableblock"><em>etiqueta</em></p></th>
<td class="tableblock halign-left valign-top"><p class="tableblock">Encuentra todos los elementos de <em>etiqueta</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>p</code></p></td>
</tr>
<tr>
<th class="tableblock halign-center valign-middle"><p class="tableblock">#<em>identificador</em></p></th>
<td class="tableblock halign-left valign-top"><p class="tableblock">Encuentra el elemento cuyo <code>id</code> es <em>identificador</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>#contenido</code></p></td>
</tr>
<tr>
<th class="tableblock halign-center valign-middle"><p class="tableblock">.<em>nombreClase</em></p></th>
<td class="tableblock halign-left valign-top"><p class="tableblock">Encuentra todos los elementos cuyo <code>class</code> es <em>nombreClase</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>.anuncio</code></p></td>
</tr>
<tr>
<th class="tableblock halign-center valign-middle"><p class="tableblock"><em>etiqueta</em>.<em>nombreClase</em></p></th>
<td class="tableblock halign-left valign-top"><p class="tableblock">Encuentra todos los elementos de tipo <em>etiqueta</em> cuyo <code>class</code> es <em>nombreClase</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>div.anuncio</code></p></td>
</tr>
<tr>
<th class="tableblock halign-center valign-middle"><p class="tableblock"><em>etiqueta</em>#<em>ident</em>.<em>nombreClase</em></p></th>
<td class="tableblock halign-left valign-top"><p class="tableblock">Encuentra el elemento de tipo etiqueta cuyo <code>id</code> es <em>ident</em> y su <code>class</code> es <em>nombreClase</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>div#banner.anuncio</code></p></td>
</tr>
<tr>
<th class="tableblock halign-center valign-middle"><p class="tableblock">*</p></th>
<td class="tableblock halign-left valign-top"><p class="tableblock">Encuentra todos los elementos de la página</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>*</code></p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Para poder probar todos estos selectores vamos a basarnos en la siguiente página:</p>
</div>
<div class="listingblock">
<div class="title">Plantilla Ejemplo Selectores - <a href="http://jsbin.com/modiko/6/edit?html,css,js,output" class="bare">http://jsbin.com/modiko/6/edit?html,css,js,output</a></div>
<div class="content">
<pre class="pygments highlight"><code data-lang="html"><span class="tok-cp">&lt;!DOCTYPE html&gt;</span>
<span class="tok-nt">&lt;html&gt;</span>
<span class="tok-nt">&lt;head</span> <span class="tok-na">lang=</span><span class="tok-s">&quot;es&quot;</span><span class="tok-nt">&gt;</span>
  <span class="tok-nt">&lt;meta</span> <span class="tok-na">charset=</span><span class="tok-s">&quot;UTF-8&quot;</span><span class="tok-nt">&gt;</span>
  <span class="tok-nt">&lt;title&gt;</span>Selectores<span class="tok-nt">&lt;/title&gt;</span>
  <span class="tok-nt">&lt;style&gt;</span>
  <span class="tok-nc">.a</span> <span class="tok-p">{</span> <span class="tok-k">color</span><span class="tok-o">:</span> <span class="tok-nb">red</span><span class="tok-p">;</span> <span class="tok-p">}</span>
  <span class="tok-nc">.b</span> <span class="tok-p">{</span> <span class="tok-k">color</span><span class="tok-o">:</span> <span class="tok-nb">gold</span><span class="tok-p">;</span> <span class="tok-p">}</span>
  <span class="tok-nt">&lt;/style&gt;</span>
<span class="tok-nt">&lt;/head&gt;</span>
<span class="tok-nt">&lt;body&gt;</span>
  <span class="tok-nt">&lt;ul</span> <span class="tok-na">id=</span><span class="tok-s">&quot;listado&quot;</span><span class="tok-nt">&gt;</span>
    <span class="tok-nt">&lt;li</span> <span class="tok-na">class=</span><span class="tok-s">&quot;a&quot;</span><span class="tok-nt">&gt;</span>elemento 0<span class="tok-nt">&lt;/li&gt;</span>
    <span class="tok-nt">&lt;li</span> <span class="tok-na">class=</span><span class="tok-s">&quot;a&quot;</span><span class="tok-nt">&gt;</span>elemento 1<span class="tok-nt">&lt;/li&gt;</span>
    <span class="tok-nt">&lt;li</span> <span class="tok-na">class=</span><span class="tok-s">&quot;b&quot;</span><span class="tok-nt">&gt;</span>elemento 2<span class="tok-nt">&lt;/li&gt;</span>
    <span class="tok-nt">&lt;li</span> <span class="tok-na">class=</span><span class="tok-s">&quot;b&quot;</span><span class="tok-nt">&gt;</span>elemento 3<span class="tok-nt">&lt;/li&gt;</span>
  <span class="tok-nt">&lt;/ul&gt;</span>
  <span class="tok-nt">&lt;p</span> <span class="tok-na">id=</span><span class="tok-s">&quot;pa0&quot;</span> <span class="tok-na">class=</span><span class="tok-s">&quot;a&quot;</span> <span class="tok-na">lang=</span><span class="tok-s">&quot;es-AR&quot;</span><span class="tok-nt">&gt;</span>Párrafo 0<span class="tok-nt">&lt;/p&gt;</span>
  <span class="tok-nt">&lt;p&gt;</span>Párrafo 1<span class="tok-nt">&lt;/p&gt;</span>
  <span class="tok-nt">&lt;p</span> <span class="tok-na">id=</span><span class="tok-s">&quot;pa2&quot;</span> <span class="tok-na">class=</span><span class="tok-s">&quot;b&quot;</span><span class="tok-nt">&gt;</span>Párrafo 2<span class="tok-nt">&lt;/p&gt;</span>
  <span class="tok-nt">&lt;p</span> <span class="tok-na">id=</span><span class="tok-s">&quot;pa3&quot;</span> <span class="tok-na">lang=</span><span class="tok-s">&quot;es-ES&quot;</span><span class="tok-nt">&gt;</span>Párrafo 3<span class="tok-nt">&lt;/p&gt;</span>
<span class="tok-nt">&lt;/body&gt;</span>
<span class="tok-nt">&lt;/html&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>La cual se visualiza del siguiente modo:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/js06/js06PaginaPlantillaSelectores.jpg" alt="Página de Plantilla para trabajar con Selectores">
</div>
<div class="title">Figure 39. Página de Plantilla para trabajar con Selectores</div>
</div>
<div class="paragraph">
<p>Y ahora vamos a comparar como lo haríamos mediante <em>DOM</em> y como con <em>jQuery</em> (<a href="http://jsbin.com/modiko/6/edit?html,css,js,output" class="bare">http://jsbin.com/modiko/6/edit?html,css,js,output</a>) en los siguientes ejemplos:</p>
</div>
<div class="listingblock">
<div class="title">Obtener todos los párrafos</div>
<div class="content">
<pre class="pygments highlight"><code data-lang="javascript"><span class="tok-nb">document</span><span class="tok-p">.</span><span class="tok-nx">getElementsByTagName</span><span class="tok-p">(</span><span class="tok-s2">&quot;p&quot;</span><span class="tok-p">);</span>
<span class="tok-nx">$</span><span class="tok-p">(</span><span class="tok-s2">&quot;p&quot;</span><span class="tok-p">);</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Obtener la etiqueta cuyo id sea <code>listado</code></div>
<div class="content">
<pre class="pygments highlight"><code data-lang="javascript"><span class="tok-nb">document</span><span class="tok-p">.</span><span class="tok-nx">getElementById</span><span class="tok-p">(</span><span class="tok-s2">&quot;listado&quot;</span><span class="tok-p">);</span>
<span class="tok-nx">$</span><span class="tok-p">(</span><span class="tok-s2">&quot;#listado&quot;</span><span class="tok-p">);</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Obtener las etiquetas <code>li</code> cuya clase sea <code>a</code>:</div>
<div class="content">
<pre class="pygments highlight"><code data-lang="javascript"><span class="tok-kd">var</span> <span class="tok-nx">todos</span> <span class="tok-o">=</span> <span class="tok-nb">document</span><span class="tok-p">.</span><span class="tok-nx">getElementsByTagName</span><span class="tok-p">(</span><span class="tok-s2">&quot;li&quot;</span><span class="tok-p">);</span>	<i class="conum" data-value="1"></i><b>(1)</b>
<span class="tok-kd">var</span> <span class="tok-nx">liClaseA</span> <span class="tok-o">=</span> <span class="tok-p">[];</span>
<span class="tok-k">for</span> <span class="tok-p">(</span><span class="tok-kd">var</span> <span class="tok-nx">i</span> <span class="tok-o">=</span> <span class="tok-mi">0</span><span class="tok-p">,</span> <span class="tok-nx">tam</span> <span class="tok-o">=</span> <span class="tok-nx">todos</span><span class="tok-p">.</span><span class="tok-nx">length</span><span class="tok-p">;</span> <span class="tok-nx">i</span> <span class="tok-o">&lt;</span> <span class="tok-nx">tam</span><span class="tok-p">;</span> <span class="tok-nx">i</span><span class="tok-o">++</span><span class="tok-p">)</span> <span class="tok-p">{</span>
  <span class="tok-k">if</span> <span class="tok-p">(</span><span class="tok-nx">todos</span><span class="tok-p">[</span><span class="tok-nx">i</span><span class="tok-p">].</span><span class="tok-nx">className</span> <span class="tok-o">===</span> <span class="tok-s2">&quot;a&quot;</span><span class="tok-p">)</span> <span class="tok-p">{</span>
    <span class="tok-nx">liClaseA</span><span class="tok-p">.</span><span class="tok-nx">push</span><span class="tok-p">(</span><span class="tok-nx">todos</span><span class="tok-p">[</span><span class="tok-nx">i</span><span class="tok-p">]);</span>
  <span class="tok-p">}</span>
<span class="tok-p">}</span>
<span class="tok-nx">$</span><span class="tok-p">(</span><span class="tok-s2">&quot;li.a&quot;</span><span class="tok-p">);</span>	<span class="tok-c1">// jQuery</span></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Mediante DOM tenemos que recuperar todas las etiquetas, recorrerlas como un array y seleccionar los elementos deseados</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="title">Obtener las etiquetas de clase <code>b</code>, pero solo si están dentro de un lista desordenada</div>
<div class="content">
<pre class="pygments highlight"><code data-lang="javascript"><span class="tok-kd">var</span> <span class="tok-nx">todos</span> <span class="tok-o">=</span> <span class="tok-nb">document</span><span class="tok-p">.</span><span class="tok-nx">getElementsByTagName</span><span class="tok-p">(</span><span class="tok-s2">&quot;ul&quot;</span><span class="tok-p">);</span>	<i class="conum" data-value="1"></i><b>(1)</b>
<span class="tok-p">...</span>
<span class="tok-p">...</span>
<span class="tok-nx">$</span><span class="tok-p">(</span><span class="tok-s2">&quot;ul .b&quot;</span><span class="tok-p">);</span>	<span class="tok-c1">// jQuery</span></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Mediante DOM tenemos que recuperar todas las etiquetas, recuperar sus hijos, nietos, etc&#8230;&#8203; y ver si alguno tiene dicha clase</td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="_jerárquicos">Jerárquicos</h5>
<div class="paragraph">
<p>Además de los selectores básicos, podemos hacer consultas dependiendo de las relaciones jerárquicas o una serie de criterios comunes, mediante la siguiente sintaxis:</p>
</div>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 25%;">
<col style="width: 50%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-center valign-middle">Selector</th>
<th class="tableblock halign-left valign-top">Propósito</th>
<th class="tableblock halign-left valign-top">Ejemplo</th>
</tr>
</thead>
<tbody>
<tr>
<th class="tableblock halign-center valign-middle"><p class="tableblock"><em>selector1</em>, <em>selector2</em>, &#8230;&#8203;</p></th>
<td class="tableblock halign-left valign-top"><p class="tableblock">Encuentra todos los selectores especificados</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>p, div</code></p></td>
</tr>
<tr>
<th class="tableblock halign-center valign-middle"><p class="tableblock">.<em>clase1</em>.<em>clase2</em></p></th>
<td class="tableblock halign-left valign-top"><p class="tableblock">Encuentra todos los elementos cuya <code>class</code> son <em>clase1</em> y <em>clase2</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>.anuncio.vip</code></p></td>
</tr>
<tr>
<th class="tableblock halign-center valign-middle"><p class="tableblock"><em>padre</em> &gt; <em>hijo</em></p></th>
<td class="tableblock halign-left valign-top"><p class="tableblock">Encuentra todos los elementos <em>hijo</em> que son hijos directos del tipo <em>padre</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>div &gt; img</code></p></td>
</tr>
<tr>
<th class="tableblock halign-center valign-middle"><p class="tableblock"><em>ascendiente</em> <em>descendiente</em></p></th>
<td class="tableblock halign-left valign-top"><p class="tableblock">Encuentra todos los elementos <em>descendiente</em> contenidos dentro del tipo <em>ascendiente</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>div img</code></p></td>
</tr>
<tr>
<th class="tableblock halign-center valign-middle"><p class="tableblock"><em>anterior</em> + <em>posterior</em></p></th>
<td class="tableblock halign-left valign-top"><p class="tableblock">Encuentra todos los elementos <em>posterior</em> que están después de <em>anterior</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>img + p</code></p></td>
</tr>
<tr>
<th class="tableblock halign-center valign-middle"><p class="tableblock"><em>anterior</em> ~ <em>hermanos</em></p></th>
<td class="tableblock halign-left valign-top"><p class="tableblock">Encuentra todos los hermanos (<em>siblings</em>) que están tras <em>anterior</em> y que cumplen el selector de <em>hermanos</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>div.carrusel ~ img</code></p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Y algunos ejemplos con estos selectores (<a href="http://jsbin.com/modiko/6/edit?html,css,js,output" class="bare">http://jsbin.com/modiko/6/edit?html,css,js,output</a>):</p>
</div>
<div class="listingblock">
<div class="title">Obtener los párrafos y los elementos de lista cuya clase sea <code>b</code>:</div>
<div class="content">
<pre class="pygments highlight"><code data-lang="javascript"><span class="tok-nx">$</span><span class="tok-p">(</span><span class="tok-s2">&quot;p, li.b&quot;</span><span class="tok-p">);</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Obtener los elementos de lista cuya clase sea <code>a</code> y que sean descendientes de una lista desordenada:</div>
<div class="content">
<pre class="pygments highlight"><code data-lang="javascript"><span class="tok-nx">$</span><span class="tok-p">(</span><span class="tok-s2">&quot;ul li.a&quot;</span><span class="tok-p">);</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Obtener el primer párrafo que está tras una lista desordenada:</div>
<div class="content">
<pre class="pygments highlight"><code data-lang="javascript"><span class="tok-nx">$</span><span class="tok-p">(</span><span class="tok-s2">&quot;ul + p&quot;</span><span class="tok-p">);</span>	<span class="tok-c1">// párrafo 0</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Obtener los párrafos que son hermanos posteriores del id <code>listado</code>:</div>
<div class="content">
<pre class="pygments highlight"><code data-lang="javascript"><span class="tok-nx">$</span><span class="tok-p">(</span><span class="tok-s2">&quot;#listado ~ p&quot;</span><span class="tok-p">);</span>	<span class="tok-c1">// párrafo 0</span></code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_filtros">6.4.2. Filtros</h4>
<div class="paragraph">
<p>Los filtros trabajan de manera conjunta con los selectores para ofrecer un control todavía más preciso a la hora de seleccionar elementos del documento.</p>
</div>
<div class="paragraph">
<p>Comienzan con <code>:</code>, y se pueden encadenar para crear filtros complejos, como por ejemplo:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="javascript"><span class="tok-nx">$</span><span class="tok-p">(</span><span class="tok-s2">&quot;#noticias tr:has(td):not(:contains(&#39;Java&#39;))&quot;</span><span class="tok-p">);</span></code></pre>
</div>
</div>
<div class="sect4">
<h5 id="_básicos_2">Básicos</h5>
<div class="paragraph">
<p>Permiten refinar la selección con los elementos que cumplen condiciones relativas a la posición que ocupan o un determinado índice:</p>
</div>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 20%;">
<col style="width: 80%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-center valign-middle">Filtro</th>
<th class="tableblock halign-left valign-top">Propósito</th>
</tr>
</thead>
<tbody>
<tr>
<th class="tableblock halign-center valign-middle"><p class="tableblock">:first</p></th>
<td class="tableblock halign-left valign-top"><p class="tableblock">Selecciona sólo la primera instancia del conjunto devuelto por el selector</p></td>
</tr>
<tr>
<th class="tableblock halign-center valign-middle"><p class="tableblock">:last</p></th>
<td class="tableblock halign-left valign-top"><p class="tableblock">Selecciona sólo la última instancia del conjunto devuelto por el selector</p></td>
</tr>
<tr>
<th class="tableblock halign-center valign-middle"><p class="tableblock">:even</p></th>
<td class="tableblock halign-left valign-top"><p class="tableblock">Selecciona sólo los elementos pares del conjunto devuelto por el selector</p></td>
</tr>
<tr>
<th class="tableblock halign-center valign-middle"><p class="tableblock">:odd</p></th>
<td class="tableblock halign-left valign-top"><p class="tableblock">Selecciona sólo los elementos impares del conjunto devuelto por el selector</p></td>
</tr>
<tr>
<th class="tableblock halign-center valign-middle"><p class="tableblock">:eq(<em>n</em>)</p></th>
<td class="tableblock halign-left valign-top"><p class="tableblock">Selecciona los elementos situados en el índice <em>n</em></p></td>
</tr>
<tr>
<th class="tableblock halign-center valign-middle"><p class="tableblock">:gt(<em>n</em>)</p></th>
<td class="tableblock halign-left valign-top"><p class="tableblock">Selecciona los elementos situados detrás del índice <em>n</em></p></td>
</tr>
<tr>
<th class="tableblock halign-center valign-middle"><p class="tableblock">:lt(<em>n</em>)</p></th>
<td class="tableblock halign-left valign-top"><p class="tableblock">Selecciona los elementos situados antes del índice <em>n</em></p></td>
</tr>
<tr>
<th class="tableblock halign-center valign-middle"><p class="tableblock">:header</p></th>
<td class="tableblock halign-left valign-top"><p class="tableblock">Selecciona todos los elementos cabeceras (<code>h1</code>, <code>h2</code>, <code>h3</code> ,&#8230;&#8203;)</p></td>
</tr>
<tr>
<th class="tableblock halign-center valign-middle"><p class="tableblock">:animated</p></th>
<td class="tableblock halign-left valign-top"><p class="tableblock">Selecciona todos los elementos que están actualmente animados de alguna manera</p></td>
</tr>
<tr>
<th class="tableblock halign-center valign-middle"><p class="tableblock">:not(<em>selector</em>)</p></th>
<td class="tableblock halign-left valign-top"><p class="tableblock">Selecciona los elementos que no cumplen el <em>selector</em></p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Y algunos ejemplos con estos filtros (<a href="http://jsbin.com/hufido/1/edit?html,css,js,output" class="bare">http://jsbin.com/hufido/1/edit?html,css,js,output</a>):</p>
</div>
<div class="listingblock">
<div class="title">Obtener el primer párrafo</div>
<div class="content">
<pre class="pygments highlight"><code data-lang="javascript"><span class="tok-nx">$</span><span class="tok-p">(</span><span class="tok-s2">&quot;p:first&quot;</span><span class="tok-p">);</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Obtener el último elemento cuya clase sea <code>a</code></div>
<div class="content">
<pre class="pygments highlight"><code data-lang="javascript"><span class="tok-nx">$</span><span class="tok-p">(</span><span class="tok-s2">&quot;.a:last&quot;</span><span class="tok-p">);</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Obtener los párrafos pares (el primer párrafo es el 0, con lo cual es par)</div>
<div class="content">
<pre class="pygments highlight"><code data-lang="javascript"><span class="tok-nx">$</span><span class="tok-p">(</span><span class="tok-s2">&quot;p:even&quot;</span><span class="tok-p">);</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Obtener todos los párrafos menos los dos primeros</div>
<div class="content">
<pre class="pygments highlight"><code data-lang="javascript"><span class="tok-nx">$</span><span class="tok-p">(</span><span class="tok-s2">&quot;p:gt(1)&quot;</span><span class="tok-p">);</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Obtener todos los párrafos menos el segundo</div>
<div class="content">
<pre class="pygments highlight"><code data-lang="javascript"><span class="tok-nx">$</span><span class="tok-p">(</span><span class="tok-s2">&quot;p:not(p:eq(1))&quot;</span><span class="tok-p">);</span></code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_basados_en_los_atributos">Basados en los Atributos</h5>
<div class="paragraph">
<p>Permiten refinar la selección con los elementos que cumplen condiciones relativas al contenido de los atributos:</p>
</div>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 25%;">
<col style="width: 75%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-center valign-middle">Filtro</th>
<th class="tableblock halign-left valign-top">Propósito</th>
</tr>
</thead>
<tbody>
<tr>
<th class="tableblock halign-center valign-middle"><p class="tableblock">[<em>atrib</em>]</p></th>
<td class="tableblock halign-left valign-top"><p class="tableblock">Incluye los elementos que tienen el atributo <em>atrib</em></p></td>
</tr>
<tr>
<th class="tableblock halign-center valign-middle"><p class="tableblock">[<em>atrib</em>=<em>valor</em>]</p></th>
<td class="tableblock halign-left valign-top"><p class="tableblock">Incluye los elementos que tienen el atributo <em>atrib</em> con el valor <em>valor</em></p></td>
</tr>
<tr>
<th class="tableblock halign-center valign-middle"><p class="tableblock">[<em>atrib</em>!=<em>valor</em>]</p></th>
<td class="tableblock halign-left valign-top"><p class="tableblock">Incluye los elementos que tienen el atributo <em>atrib</em> y no tiene el valor <em>valor</em></p></td>
</tr>
<tr>
<th class="tableblock halign-center valign-middle"><p class="tableblock">[<em>atrib</em>^=<em>valor</em>]</p></th>
<td class="tableblock halign-left valign-top"><p class="tableblock">Incluye los elementos que tienen el atributo <em>atrib</em> y su valor comienza por <em>valor</em></p></td>
</tr>
<tr>
<th class="tableblock halign-center valign-middle"><p class="tableblock">[<em>atrib</em>$=<em>valor</em>]</p></th>
<td class="tableblock halign-left valign-top"><p class="tableblock">Incluye los elementos que tienen el atributo <em>atrib</em> y su valor termina con <em>valor</em></p></td>
</tr>
<tr>
<th class="tableblock halign-center valign-middle"><p class="tableblock">[<em>atrib</em>*=<em>valor</em>]</p></th>
<td class="tableblock halign-left valign-top"><p class="tableblock">Incluye los elementos que tienen el atributo <em>atrib</em> y su valor contiene <em>valor</em></p></td>
</tr>
<tr>
<th class="tableblock halign-center valign-middle"><p class="tableblock">[<em>filtroAtrib1</em>][<em>filtroAtrib2</em>]</p></th>
<td class="tableblock halign-left valign-top"><p class="tableblock">Incluye los elementos que cumplen todos los filtros especificados, es decir, <em>filtroAtrib1</em> y <em>filtroAtrib2</em></p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Y algunos ejemplos con estos filtros (<a href="http://jsbin.com/ziraqe/1/edit?html,css,js,output" class="bare">http://jsbin.com/ziraqe/1/edit?html,css,js,output</a>):</p>
</div>
<div class="listingblock">
<div class="title">Obtener los párrafos que tienen alguna clase</div>
<div class="content">
<pre class="pygments highlight"><code data-lang="javascript"><span class="tok-nx">$</span><span class="tok-p">(</span><span class="tok-s2">&quot;p[class]&quot;</span><span class="tok-p">);</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Obtener el párrafo cuyo id sea <code>pa2</code></div>
<div class="content">
<pre class="pygments highlight"><code data-lang="javascript"><span class="tok-nx">$</span><span class="tok-p">(</span><span class="tok-s2">&quot;p[id=pa2]&quot;</span><span class="tok-p">);</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Obtener los párrafos cuyo id comience por <code>pa</code></div>
<div class="content">
<pre class="pygments highlight"><code data-lang="javascript"><span class="tok-nx">$</span><span class="tok-p">(</span><span class="tok-s2">&quot;p[id^=pa]&quot;</span><span class="tok-p">);</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Obtener los párrafos cuyo id comience por <code>pa</code> y que su atributo <code>lang</code> contenga <code>es</code></div>
<div class="content">
<pre class="pygments highlight"><code data-lang="javascript"><span class="tok-nx">$</span><span class="tok-p">(</span><span class="tok-s2">&quot;p[id^=pa][lang*=es]&quot;</span><span class="tok-p">);</span></code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_basados_en_el_contenido">Basados en el Contenido</h5>
<div class="paragraph">
<p>Permiten refinar la selección con los elementos que cumplen condiciones relativas a su contenido:</p>
</div>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 25%;">
<col style="width: 75%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-center valign-middle">Filtro</th>
<th class="tableblock halign-left valign-top">Propósito</th>
</tr>
</thead>
<tbody>
<tr>
<th class="tableblock halign-center valign-middle"><p class="tableblock">:contains(<em>texto</em>)</p></th>
<td class="tableblock halign-left valign-top"><p class="tableblock">Incluye los elementos que contienen la cadena <em>texto</em></p></td>
</tr>
<tr>
<th class="tableblock halign-center valign-middle"><p class="tableblock">:empty</p></th>
<td class="tableblock halign-left valign-top"><p class="tableblock">Incluye los elementos vacíos, es decir, sin contenido</p></td>
</tr>
<tr>
<th class="tableblock halign-center valign-middle"><p class="tableblock">:has(<em>selector</em>)</p></th>
<td class="tableblock halign-left valign-top"><p class="tableblock">Incluye los elementos que contienen al menos uno que cumple el <em>selector</em></p></td>
</tr>
<tr>
<th class="tableblock halign-center valign-middle"><p class="tableblock">:parents</p></th>
<td class="tableblock halign-left valign-top"><p class="tableblock">Incluye los elementos que son padres, es decir, que contienen al menos otro elemento, incluido texto</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Y algunos ejemplos con estos filtros (<a href="http://jsbin.com/runojo/1/edit?html,css,js,output" class="bare">http://jsbin.com/runojo/1/edit?html,css,js,output</a>):</p>
</div>
<div class="listingblock">
<div class="title">Obtener los párrafos que contienen el número 3</div>
<div class="content">
<pre class="pygments highlight"><code data-lang="javascript"><span class="tok-nx">$</span><span class="tok-p">(</span><span class="tok-s2">&quot;p:contains(3)&quot;</span><span class="tok-p">);</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Obtener todos los elementos que contienen el número 3</div>
<div class="content">
<pre class="pygments highlight"><code data-lang="javascript"><span class="tok-nx">$</span><span class="tok-p">(</span><span class="tok-s2">&quot;:contains(3)&quot;</span><span class="tok-p">);</span>	<i class="conum" data-value="1"></i><b>(1)</b>
<span class="tok-nx">$</span><span class="tok-p">(</span><span class="tok-s2">&quot;p:contains(3),li:contains(3)&quot;</span><span class="tok-p">);</span> <i class="conum" data-value="2"></i><b>(2)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Selecciona los que contienen un 3, y sus padres, ya que por ejemplo, el elemento body contiene un 3 dentro de un párrafo, con lo cual no sería una solución correcta</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Restringimos la búsqueda sobre los elementos que conocemos. Para hacerlo correctamente deberíamos seleccionar todos aquellos que fueran hijos</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="title">Obtener los párrafos que son padres</div>
<div class="content">
<pre class="pygments highlight"><code data-lang="javascript"><span class="tok-nx">$</span><span class="tok-p">(</span><span class="tok-s2">&quot;p:parent&quot;</span><span class="tok-p">);</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Obtener una lista desordenada donde haya algún elemento que sea de la clase <code>b</code></div>
<div class="content">
<pre class="pygments highlight"><code data-lang="javascript"><span class="tok-nx">$</span><span class="tok-p">(</span><span class="tok-s2">&quot;ul:has(li[class=b])&quot;</span><span class="tok-p">);</span></code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_basados_en_la_visibilidad">Basados en la Visibilidad</h5>
<div class="paragraph">
<p>Permiten refinar la selección con los elementos que cumplen condiciones relativas a la propiedad <code>visibility</code>:</p>
</div>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 25%;">
<col style="width: 75%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-center valign-middle">Filtro</th>
<th class="tableblock halign-left valign-top">Propósito</th>
</tr>
</thead>
<tbody>
<tr>
<th class="tableblock halign-center valign-middle"><p class="tableblock">:visible</p></th>
<td class="tableblock halign-left valign-top"><p class="tableblock">Incluye los elementos visibles</p></td>
</tr>
<tr>
<th class="tableblock halign-center valign-middle"><p class="tableblock">:hidden</p></th>
<td class="tableblock halign-left valign-top"><p class="tableblock">Incluye los elementos ocultos</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Y un ejemplo:</p>
</div>
<div class="listingblock">
<div class="title">Obtener todos los párrafos que éstan ocultos</div>
<div class="content">
<pre class="pygments highlight"><code data-lang="javascript"><span class="tok-nx">$</span><span class="tok-p">(</span><span class="tok-s2">&quot;p:hidden&quot;</span><span class="tok-p">);</span></code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_basados_en_los_hijos">Basados en los Hijos</h5>
<div class="paragraph">
<p>Permiten refinar la selección examinando la relación que cada elemento tiene con su elemento padre:</p>
</div>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 25%;">
<col style="width: 75%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-center valign-middle">Filtro</th>
<th class="tableblock halign-left valign-top">Propósito</th>
</tr>
</thead>
<tbody>
<tr>
<th class="tableblock halign-center valign-middle"><p class="tableblock">:nth-child(<em>índice</em>)</p></th>
<td class="tableblock halign-left valign-top"><p class="tableblock">Incluye los hijos número <em>índice</em>, numerados de <em>1</em> a <em>n</em>.</p></td>
</tr>
<tr>
<th class="tableblock halign-center valign-middle"><p class="tableblock">:nth-child(even)</p></th>
<td class="tableblock halign-left valign-top"><p class="tableblock">Incluye los hijos pares</p></td>
</tr>
<tr>
<th class="tableblock halign-center valign-middle"><p class="tableblock">:nth-child(odd)</p></th>
<td class="tableblock halign-left valign-top"><p class="tableblock">Incluye los hijos impares</p></td>
</tr>
<tr>
<th class="tableblock halign-center valign-middle"><p class="tableblock">:nth-child(<em>ecuación</em>)</p></th>
<td class="tableblock halign-left valign-top"><p class="tableblock">Incluye los hijos cuya posición cumple la <em>ecuación</em>, por ejemplo, <code>2n</code> o <code>3n+1</code></p></td>
</tr>
<tr>
<th class="tableblock halign-center valign-middle"><p class="tableblock">:first-child</p></th>
<td class="tableblock halign-left valign-top"><p class="tableblock">Incluye los elementos que son el primer hijo</p></td>
</tr>
<tr>
<th class="tableblock halign-center valign-middle"><p class="tableblock">:last-child</p></th>
<td class="tableblock halign-left valign-top"><p class="tableblock">Incluye los elementos que son el último hijo</p></td>
</tr>
<tr>
<th class="tableblock halign-center valign-middle"><p class="tableblock">:only-child</p></th>
<td class="tableblock halign-left valign-top"><p class="tableblock">Incluye los elementos que son hijos únicos, es decir, no tienen hermanos</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Y algunos ejemplos con estos filtros:</p>
</div>
<div class="listingblock">
<div class="title">Obtener el tercer elemento de lista de una lista desordenada</div>
<div class="content">
<pre class="pygments highlight"><code data-lang="javascript"><span class="tok-nx">$</span><span class="tok-p">(</span><span class="tok-s2">&quot;ul li:nth-child(3)&quot;</span><span class="tok-p">);</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Obtener el último elemento de lista de una lista desordenada</div>
<div class="content">
<pre class="pygments highlight"><code data-lang="javascript"><span class="tok-nx">$</span><span class="tok-p">(</span><span class="tok-s2">&quot;ul li:last-child&quot;</span><span class="tok-p">);</span></code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_basados_en_los_elementos_del_formulario">Basados en los Elementos del Formulario</h5>
<div class="paragraph">
<p>Aunque se consideran como selectores de formulario, se expresan como filtros y permiten refina los campos dependiendo del tipo de elemento:</p>
</div>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 25%;">
<col style="width: 75%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-center valign-middle">Selector</th>
<th class="tableblock halign-left valign-top">Propósito</th>
</tr>
</thead>
<tbody>
<tr>
<th class="tableblock halign-center valign-middle"><p class="tableblock">:input</p></th>
<td class="tableblock halign-left valign-top"><p class="tableblock">Encuentra todos los <em>input</em>, <em>select</em>, <em>textarea</em> y elementos <em>button</em></p></td>
</tr>
<tr>
<th class="tableblock halign-center valign-middle"><p class="tableblock">:text</p></th>
<td class="tableblock halign-left valign-middle" rowspan="9"><p class="tableblock">Encuentra todos los elementos de dicho tipo</p></td>
</tr>
<tr>
<th class="tableblock halign-center valign-middle"><p class="tableblock">:password</p></th>
</tr>
<tr>
<th class="tableblock halign-center valign-middle"><p class="tableblock">:radio</p></th>
</tr>
<tr>
<th class="tableblock halign-center valign-middle"><p class="tableblock">:checkbox</p></th>
</tr>
<tr>
<th class="tableblock halign-center valign-middle"><p class="tableblock">:submit</p></th>
</tr>
<tr>
<th class="tableblock halign-center valign-middle"><p class="tableblock">:reset</p></th>
</tr>
<tr>
<th class="tableblock halign-center valign-middle"><p class="tableblock">:image</p></th>
</tr>
<tr>
<th class="tableblock halign-center valign-middle"><p class="tableblock">:button</p></th>
</tr>
<tr>
<th class="tableblock halign-center valign-middle"><p class="tableblock">:file</p></th>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Y para realizar filtrados adicionales sobre los elementos, podemos usar los siguientes filtros de manera conjunta a los anteriores:</p>
</div>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 25%;">
<col style="width: 75%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-center valign-middle">Filtro</th>
<th class="tableblock halign-left valign-top">Propósito</th>
</tr>
</thead>
<tbody>
<tr>
<th class="tableblock halign-center valign-middle"><p class="tableblock">:enabled</p></th>
<td class="tableblock halign-left valign-top"><p class="tableblock">Incluye los elementos que están habilitados</p></td>
</tr>
<tr>
<th class="tableblock halign-center valign-middle"><p class="tableblock">:disabled</p></th>
<td class="tableblock halign-left valign-top"><p class="tableblock">Incluye los elementos que están deshabilitados</p></td>
</tr>
<tr>
<th class="tableblock halign-center valign-middle"><p class="tableblock">:checked</p></th>
<td class="tableblock halign-left valign-top"><p class="tableblock">Incluye los elementos que están marcados (<em>radio</em> y <em>checkbox</em>)</p></td>
</tr>
<tr>
<th class="tableblock halign-center valign-middle"><p class="tableblock">:selected</p></th>
<td class="tableblock halign-left valign-top"><p class="tableblock">Incluye los elementos que están seleccionados (<em>select</em>)</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Y algunos ejemplos con estos filtros:</p>
</div>
<div class="listingblock">
<div class="title">Obtener todos los campos de un formulario, incluyendo los botones</div>
<div class="content">
<pre class="pygments highlight"><code data-lang="javascript"><span class="tok-nx">$</span><span class="tok-p">(</span><span class="tok-s2">&quot;form :input&quot;</span><span class="tok-p">);</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Obtener los campos de texto que están habilitados</div>
<div class="content">
<pre class="pygments highlight"><code data-lang="javascript"><span class="tok-nx">$</span><span class="tok-p">(</span><span class="tok-s2">&quot;form :text:enabled&quot;</span><span class="tok-p">);</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Obtener los campos de tipo <em>checkbox</em> que están marcados</div>
<div class="content">
<pre class="pygments highlight"><code data-lang="javascript"><span class="tok-nx">$</span><span class="tok-p">(</span><span class="tok-s2">&quot;form :checkbox:checked&quot;</span><span class="tok-p">);</span></code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_el_objeto_code_jquery_code">6.4.3. El objeto <code>jQuery</code></h4>
<div class="paragraph">
<p>Tras seleccionar la información mediante selectores y filtros obtendremos un objeto <code>jQuery</code>, el cual envuelve a uno o más elementos HTML.</p>
</div>
<div class="paragraph">
<p>A partir de este objeto vamos a poder acceder al resultado, iterar sobre él o encadenar nuevas sentencias.</p>
</div>
<div class="paragraph">
<p>Las propiedades y métodos que soporta un objeto <code>jQuery</code> son:</p>
</div>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 20%;">
<col style="width: 60%;">
<col style="width: 20%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-center valign-middle">Propiedad / Método</th>
<th class="tableblock halign-left valign-top">Propósito</th>
<th class="tableblock halign-left valign-top">Devuelve</th>
</tr>
</thead>
<tbody>
<tr>
<th class="tableblock halign-center valign-middle"><p class="tableblock">context</p></th>
<td class="tableblock halign-left valign-top"><p class="tableblock">Devuelve el conjunto de elementos utilizado como contexto</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>HTMLElement</code></p></td>
</tr>
<tr>
<th class="tableblock halign-center valign-middle"><p class="tableblock">each(<em>función</em>)</p></th>
<td class="tableblock halign-left valign-top"><p class="tableblock">Invoca la <em>función</em> para cada uno de los elementos buscados</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>jQuery</code></p></td>
</tr>
<tr>
<th class="tableblock halign-center valign-middle"><p class="tableblock">find(<em>selector</em>)</p></th>
<td class="tableblock halign-left valign-top"><p class="tableblock">Obtiene elementos descendientes que cumplen el <em>selector</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>jQuery</code></p></td>
</tr>
<tr>
<th class="tableblock halign-center valign-middle"><p class="tableblock">get() / toArray()</p></th>
<td class="tableblock halign-left valign-top"><p class="tableblock">Devuelve un array con todos los elementos DOM del conjunto de resultado. Se usa cuando necesitamos trabajar con los objetos DOM en vez de los objetos propios de jQuery</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>HTMLElement[]</code></p></td>
</tr>
<tr>
<th class="tableblock halign-center valign-middle"><p class="tableblock">get(<em>índice</em>)</p></th>
<td class="tableblock halign-left valign-top"><p class="tableblock">Obtiene un único elemento DOM que ocupa la posición <em>índice</em> del conjunto de resultados</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>HTMLElement</code></p></td>
</tr>
<tr>
<th class="tableblock halign-center valign-middle"><p class="tableblock">index(<em>HTMLElement</em>)</p></th>
<td class="tableblock halign-left valign-top"><p class="tableblock">Obtiene el <em>indice</em> del <em>HTMLElement</em> especificado</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>number</code></p></td>
</tr>
<tr>
<th class="tableblock halign-center valign-middle"><p class="tableblock">index(<em>jQuery</em>)</p></th>
<td class="tableblock halign-left valign-top"><p class="tableblock">Obtiene el <em>indice</em> del primer elemento del objeto <em>jQuery</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>number</code></p></td>
</tr>
<tr>
<th class="tableblock halign-center valign-middle"><p class="tableblock">index(<em>selector</em>)</p></th>
<td class="tableblock halign-left valign-top"><p class="tableblock">Obtiene el <em>indice</em> del primer elemento del objeto <em>jQuery</em> dentro del conjunto de elementos encontrados por el <em>selector</em>. Realiza la operación inversa a las anteriores</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>number</code></p></td>
</tr>
<tr>
<th class="tableblock halign-center valign-middle"><p class="tableblock">length / size()</p></th>
<td class="tableblock halign-left valign-top"><p class="tableblock">Número de elementos del conjunto de resultados</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>number</code></p></td>
</tr>
<tr>
<th class="tableblock halign-center valign-middle"><p class="tableblock">selector</p></th>
<td class="tableblock halign-left valign-top"><p class="tableblock">Devuelve el selector empleado</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>string</code></p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Destacar que los métodos <code>index()</code> son los complementarios a <code>get()</code>, de modo que en <code>get()</code> se indica un índice y se obtiene un <code>HTMLElement</code>, y el <code>index()</code> a partir del elemento se obtiene el índice.</p>
</div>
<div class="paragraph">
<p>Vamos a practicar estos métodos con algunos ejemplos:</p>
</div>
<div class="listingblock">
<div class="title">Obtener el selector empleado</div>
<div class="content">
<pre class="pygments highlight"><code data-lang="javascript"><span class="tok-kd">var</span> <span class="tok-nx">parrafosImpares</span> <span class="tok-o">=</span> <span class="tok-nx">$</span><span class="tok-p">(</span><span class="tok-s2">&quot;p:odd&quot;</span><span class="tok-p">);</span>
<span class="tok-nx">console</span><span class="tok-p">.</span><span class="tok-nx">log</span><span class="tok-p">(</span><span class="tok-nx">parrafosImpares</span><span class="tok-p">.</span><span class="tok-nx">selector</span><span class="tok-p">);</span> <span class="tok-c1">// &quot;p:odd&quot;</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Obtener la cantidad de párrafos del documento</div>
<div class="content">
<pre class="pygments highlight"><code data-lang="javascript"><span class="tok-kd">var</span> <span class="tok-nx">numParrafos</span> <span class="tok-o">=</span> <span class="tok-nx">$</span><span class="tok-p">(</span><span class="tok-s2">&quot;p&quot;</span><span class="tok-p">).</span><span class="tok-nx">length</span><span class="tok-p">;</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Obtener el primer elemento de la lista</div>
<div class="content">
<pre class="pygments highlight"><code data-lang="javascript"><span class="tok-nx">$</span><span class="tok-p">(</span><span class="tok-s2">&quot;li&quot;</span><span class="tok-p">).</span><span class="tok-nx">get</span><span class="tok-p">()[</span><span class="tok-mi">0</span><span class="tok-p">];</span>	<span class="tok-c1">// object HTMLLIElement -&gt; objeto DOM</span>
<span class="tok-nx">$</span><span class="tok-p">(</span><span class="tok-s2">&quot;li&quot;</span><span class="tok-p">).</span><span class="tok-nx">get</span><span class="tok-p">(</span><span class="tok-mi">0</span><span class="tok-p">);</span>	<span class="tok-c1">// object HTMLLIElement -&gt; objeto DOM</span>
<span class="tok-nx">$</span><span class="tok-p">(</span><span class="tok-s2">&quot;li:first-child&quot;</span><span class="tok-p">);</span>	<span class="tok-c1">// object Object -&gt; objeto jQuery</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Obtener la posición del elemento cuyo id es <em>contenido</em></div>
<div class="content">
<pre class="pygments highlight"><code data-lang="javascript"><span class="tok-nx">$</span><span class="tok-p">(</span><span class="tok-s2">&quot;body *&quot;</span><span class="tok-p">).</span><span class="tok-nx">index</span><span class="tok-p">(</span><span class="tok-nb">document</span><span class="tok-p">.</span><span class="tok-nx">getElementById</span><span class="tok-p">(</span><span class="tok-s2">&quot;contenido&quot;</span><span class="tok-p">));</span>
<span class="tok-nx">$</span><span class="tok-p">(</span><span class="tok-s2">&quot;body *&quot;</span><span class="tok-p">).</span><span class="tok-nx">index</span><span class="tok-p">(</span><span class="tok-nx">$</span><span class="tok-p">(</span><span class="tok-s2">&quot;#contenido&quot;</span><span class="tok-p">));</span>
<span class="tok-nx">$</span><span class="tok-p">(</span><span class="tok-s2">&quot;#contenido&quot;</span><span class="tok-p">).</span><span class="tok-nx">index</span><span class="tok-p">(</span><span class="tok-s2">&quot;body *&quot;</span><span class="tok-p">);</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Obtener los elementos de lista que tienen la clase <code>b</code></div>
<div class="content">
<pre class="pygments highlight"><code data-lang="javascript"><span class="tok-nx">$</span><span class="tok-p">(</span><span class="tok-s2">&quot;ul&quot;</span><span class="tok-p">).</span><span class="tok-nx">find</span><span class="tok-p">(</span><span class="tok-s2">&quot;li.b&quot;</span><span class="tok-p">);</span>
<span class="tok-nx">$</span><span class="tok-p">(</span><span class="tok-s2">&quot;ul li.b&quot;</span><span class="tok-p">);</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Realizar una acción sobre todos los párrafos</div>
<div class="content">
<pre class="pygments highlight"><code data-lang="javascript"><span class="tok-nx">$</span><span class="tok-p">(</span><span class="tok-s2">&quot;p&quot;</span><span class="tok-p">).</span><span class="tok-nx">each</span><span class="tok-p">(</span><span class="tok-kd">function</span><span class="tok-p">()</span> <span class="tok-p">{</span>
  <span class="tok-c1">// Por ejemplo, ponerles un borde</span>
  <span class="tok-nx">$</span><span class="tok-p">(</span><span class="tok-k">this</span><span class="tok-p">).</span><span class="tok-nx">css</span><span class="tok-p">(</span><span class="tok-s2">&quot;border&quot;</span><span class="tok-p">,</span><span class="tok-s2">&quot;3px solid red&quot;</span><span class="tok-p">);</span>
<span class="tok-p">});</span></code></pre>
</div>
</div>
<div class="sect4">
<h5 id="_de_code_htmlelement_code_a_code_jquery_code">De <code>HTMLElement</code> a <code>jQuery</code></h5>
<div class="paragraph">
<p>Si tenemos un objeto DOM y queremos crear un objeto <code>jQuery</code>, podemos hacerlo pasándolo como argumento a la función <code>$</code>. De este modo podemos incluir código que no usa <em>jQuery</em> e integrarlo de un modo sencillo.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="javascript"><span class="tok-kd">var</span> <span class="tok-nx">contenido</span> <span class="tok-o">=</span> <span class="tok-nb">document</span><span class="tok-p">.</span><span class="tok-nx">getElementById</span><span class="tok-p">(</span><span class="tok-s2">&quot;contenido&quot;</span><span class="tok-p">);</span>
<span class="tok-kd">var</span> <span class="tok-nx">contenidoJQuery</span> <span class="tok-o">=</span> <span class="tok-nx">$</span><span class="tok-p">(</span><span class="tok-nx">contenido</span><span class="tok-p">);</span></code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_modificando_la_selección">6.4.4. Modificando la selección</h4>
<div class="paragraph">
<p>Una vez seleccionada la información mediante selectores y filtros, vamos a poder modificarla añadiendo nuevos elementos al conjunto de resultados o restringiendo los resultados a un subconjunto menor.</p>
</div>
<div class="sect4">
<h5 id="_encadenando_sentencias">Encadenando sentencias</h5>
<div class="paragraph">
<p>Una de las características más potentes de <em>jQuery</em> es su habilidad de encadenar múltiples sentencias de manera conjunta para realizar varias operaciones en una única línea de código.</p>
</div>
<div class="paragraph">
<p>Para ello, tras usar el selector, mediante el operador <code>.</code> podemos añadir métodos que se irán encadenando unos detrás de otros:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="javascript"><span class="tok-nx">$</span><span class="tok-p">(</span><span class="tok-nx">selector</span><span class="tok-p">).</span><span class="tok-nx">funcion1</span><span class="tok-p">().</span><span class="tok-nx">funcion2</span><span class="tok-p">().</span><span class="tok-nx">funcion3</span><span class="tok-p">();</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Al encadenar las sentencias, los métodos se ejecutan sobre el elemento modificado. Si queremos que dentro del <em>chaining</em> vuelva a trabajar con la selección inicial, podemos usar <code>end()</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="javascript"><span class="tok-nx">$</span><span class="tok-p">(</span><span class="tok-k">this</span><span class="tok-p">).</span><span class="tok-nx">siblings</span><span class="tok-p">(</span><span class="tok-s1">&#39;button&#39;</span><span class="tok-p">).</span><span class="tok-nx">removeAttr</span><span class="tok-p">(</span><span class="tok-s1">&#39;disabled&#39;</span><span class="tok-p">).</span><span class="tok-nx">end</span><span class="tok-p">().</span><span class="tok-nx">attr</span><span class="tok-p">(</span><span class="tok-s1">&#39;disabled&#39;</span><span class="tok-p">,</span><span class="tok-s1">&#39;disabled&#39;</span><span class="tok-p">);</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Todos los métodos que veremos a continuación devuelven un objeto <em>jQuery</em>, para permitir el encadenamiento de sentencias.</p>
</div>
</div>
<div class="sect4">
<h5 id="_expandiendo_la_selección">Expandiendo la selección</h5>
<div class="paragraph">
<p>El método <code>add</code> permite ampliar la selección añadiendo elementos al conjunto de resultados:</p>
</div>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 25%;">
<col style="width: 75%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-center valign-middle">Método</th>
<th class="tableblock halign-left valign-top">Propósito</th>
</tr>
</thead>
<tbody>
<tr>
<th class="tableblock halign-center valign-middle"><p class="tableblock">add(<em>selector</em>)</p></th>
<td class="tableblock halign-left valign-top"><p class="tableblock">Añade todos los elementos que cumplen el <em>selector</em></p></td>
</tr>
<tr>
<th class="tableblock halign-center valign-middle"><p class="tableblock">add(<em>selector</em>, <em>contexto</em>)</p></th>
<td class="tableblock halign-left valign-top"><p class="tableblock">Añade todos los elementos que cumplen el <em>selector</em> dentro del <em>contexto</em></p></td>
</tr>
<tr>
<th class="tableblock halign-center valign-middle"><p class="tableblock">add(<em>HTMLElement</em>)</p></th>
<td class="tableblock halign-left valign-middle" rowspan="2"><p class="tableblock">Añade un elemento o un array de <em>HTMLElements</em></p></td>
</tr>
<tr>
<th class="tableblock halign-center valign-middle"><p class="tableblock">add(<em>HTMLElement[]</em>)</p></th>
</tr>
<tr>
<th class="tableblock halign-center valign-middle"><p class="tableblock">add(<em>jQuery</em>)</p></th>
<td class="tableblock halign-left valign-top"><p class="tableblock">Añade los contenidos del objeto <em>jQuery</em></p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Por ejemplo, podemos obtener un selector para posteriormente reutilizarlo sobre otra selección:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="javascript"><span class="tok-kd">var</span> <span class="tok-nx">imgFlickr</span> <span class="tok-o">=</span> <span class="tok-nx">$</span><span class="tok-p">(</span><span class="tok-s2">&quot;img[src*=flickr]&quot;</span><span class="tok-p">);</span>
<span class="tok-nx">$</span><span class="tok-p">(</span><span class="tok-s2">&quot;img:even&quot;</span><span class="tok-p">).</span><span class="tok-nx">add</span><span class="tok-p">(</span><span class="tok-s2">&quot;img[src*=twitpic]&quot;</span><span class="tok-p">).</span><span class="tok-nx">add</span><span class="tok-p">(</span><span class="tok-nx">imgFlickr</span><span class="tok-p">);</span></code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_reduciendo_la_selección">Reduciendo la selección</h5>
<div class="paragraph">
<p>Si lo que queremos es reducir el conjunto de resultados para refinar la selección, podemos utilizar los siguientes métodos similar a los empleados en los filtros:</p>
</div>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 25%;">
<col style="width: 75%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-center valign-middle">Método</th>
<th class="tableblock halign-left valign-top">Propósito</th>
</tr>
</thead>
<tbody>
<tr>
<th class="tableblock halign-center valign-middle"><p class="tableblock">eq(<em>índice</em>)</p></th>
<td class="tableblock halign-left valign-top"><p class="tableblock">Elimina todos los elementos a excepción al que ocupa la posición <em>índice</em> . Si el <em>indice</em> es negativo, cuenta desde el final.</p></td>
</tr>
<tr>
<th class="tableblock halign-center valign-middle"><p class="tableblock">first()</p></th>
<td class="tableblock halign-left valign-top"><p class="tableblock">Elimina todos los elementos excepto el primero</p></td>
</tr>
<tr>
<th class="tableblock halign-center valign-middle"><p class="tableblock">has(<em>selector</em>)</p></th>
<td class="tableblock halign-left valign-middle" rowspan="4"><p class="tableblock">Elimina los elementos que no tengan un descendiente que cumpla el <em>selector</em> o el objeto <em>jQuery</em> o aquellos descendientes que no incluyan los objetos <em>HTMLElement</em> especificados</p></td>
</tr>
<tr>
<th class="tableblock halign-center valign-middle"><p class="tableblock">has(<em>jQuery</em>)</p></th>
</tr>
<tr>
<th class="tableblock halign-center valign-middle"><p class="tableblock">has(<em>HTMLElement</em>)</p></th>
</tr>
<tr>
<th class="tableblock halign-center valign-middle"><p class="tableblock">has(<em>HTMLElement[]</em>)</p></th>
</tr>
<tr>
<th class="tableblock halign-center valign-middle"><p class="tableblock">last()</p></th>
<td class="tableblock halign-left valign-top"><p class="tableblock">Elimina todos los elementos excepto el último</p></td>
</tr>
<tr>
<th class="tableblock halign-center valign-middle"><p class="tableblock">slice(<em>inicio</em>, <em>fin</em>)</p></th>
<td class="tableblock halign-left valign-top"><p class="tableblock">Elimina los elementos fuera del rango indicado por los valores de <em>inicio</em> y <em>fin</em></p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Por ejemplo, mediante los operadores sencillos podemos restringir el conjunto de resultados (<a href="http://jsbin.com/hufoci/1/edit?html,css,js,output" class="bare">http://jsbin.com/hufoci/1/edit?html,css,js,output</a>):</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="javascript"><span class="tok-nx">$</span><span class="tok-p">(</span><span class="tok-s2">&quot;li&quot;</span><span class="tok-p">).</span><span class="tok-nx">first</span><span class="tok-p">();</span>
<span class="tok-nx">$</span><span class="tok-p">(</span><span class="tok-s2">&quot;li&quot;</span><span class="tok-p">).</span><span class="tok-nx">last</span><span class="tok-p">();</span>
<span class="tok-nx">$</span><span class="tok-p">(</span><span class="tok-s2">&quot;li&quot;</span><span class="tok-p">).</span><span class="tok-nx">eq</span><span class="tok-p">(</span><span class="tok-mi">1</span><span class="tok-p">);</span> <span class="tok-c1">// segundo elemento</span>
<span class="tok-nx">$</span><span class="tok-p">(</span><span class="tok-s2">&quot;li&quot;</span><span class="tok-p">).</span><span class="tok-nx">eq</span><span class="tok-p">(</span><span class="tok-o">-</span><span class="tok-mi">1</span><span class="tok-p">);</span> <span class="tok-c1">// último elemento</span>
<span class="tok-nx">$</span><span class="tok-p">(</span><span class="tok-s2">&quot;li&quot;</span><span class="tok-p">).</span><span class="tok-nx">slice</span><span class="tok-p">(</span><span class="tok-mi">0</span><span class="tok-p">,</span><span class="tok-mi">2</span><span class="tok-p">);</span> <span class="tok-c1">// primeros dos elementos</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Otros métodos que permiten restringir el resultado son <code>filter()</code> y <code>not()</code>, los cuales son complementarios:</p>
</div>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 25%;">
<col style="width: 75%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-center valign-middle">Método</th>
<th class="tableblock halign-left valign-top">Propósito</th>
</tr>
</thead>
<tbody>
<tr>
<th class="tableblock halign-center valign-middle"><p class="tableblock">filter(<em>selector</em>)</p></th>
<td class="tableblock halign-left valign-top"><p class="tableblock">Mantiene todos los elementos que cumplen el selector</p></td>
</tr>
<tr>
<th class="tableblock halign-center valign-middle"><p class="tableblock">filter(<em>HTMLElement</em>)</p></th>
<td class="tableblock halign-left valign-top"><p class="tableblock">Elimina todos los elementos menos el <em>HTMLElement</em></p></td>
</tr>
<tr>
<th class="tableblock halign-center valign-middle"><p class="tableblock">filter(<em>jQuery</em>)</p></th>
<td class="tableblock halign-left valign-top"><p class="tableblock">Elimina todos los elementos que no están contenidos en el objeto <em>jQuery</em></p></td>
</tr>
<tr>
<th class="tableblock halign-center valign-middle"><p class="tableblock">filter(<em>función(índice)</em>)</p></th>
<td class="tableblock halign-left valign-top"><p class="tableblock">La función se invoca por cada elemento; aquellos en los que la función devuelva <code>false</code> se eliminarán</p></td>
</tr>
<tr>
<th class="tableblock halign-center valign-middle"><p class="tableblock">not(<em>selector</em>)</p></th>
<td class="tableblock halign-left valign-top"><p class="tableblock">Elimina los elementos que cumplen el selector</p></td>
</tr>
<tr>
<th class="tableblock halign-center valign-middle"><p class="tableblock">not(<em>HTMLElement[]</em>)</p></th>
<td class="tableblock halign-left valign-top"><p class="tableblock">Elimina los elementos del array</p></td>
</tr>
<tr>
<th class="tableblock halign-center valign-middle"><p class="tableblock">not(<em>HTMLElement</em>)</p></th>
<td class="tableblock halign-left valign-top"><p class="tableblock">Elimina el elemento especificado</p></td>
</tr>
<tr>
<th class="tableblock halign-center valign-middle"><p class="tableblock">not(<em>jQuery</em>)</p></th>
<td class="tableblock halign-left valign-top"><p class="tableblock">Elimina los elementos contenidos en el objeto <em>jQuery</em></p></td>
</tr>
<tr>
<th class="tableblock halign-center valign-middle"><p class="tableblock">not(<em>función(índice)</em>)</p></th>
<td class="tableblock halign-left valign-top"><p class="tableblock">La función se invoca por cada elemento; aquellos en los que la función devuelva <code>true</code> se eliminarán</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Por ejemplo (<a href="http://jsbin.com/dahuvu/1/edit?html,css,js,output" class="bare">http://jsbin.com/dahuvu/1/edit?html,css,js,output</a>):</p>
</div>
<div class="listingblock">
<div class="title">Obtener los párrafos que tiene clase o que no la tienen</div>
<div class="content">
<pre class="pygments highlight"><code data-lang="javascript"><span class="tok-nx">$</span><span class="tok-p">(</span><span class="tok-s2">&quot;p&quot;</span><span class="tok-p">).</span><span class="tok-nx">filter</span><span class="tok-p">(</span><span class="tok-s2">&quot;[class]&quot;</span><span class="tok-p">)</span>
<span class="tok-nx">$</span><span class="tok-p">(</span><span class="tok-s2">&quot;p&quot;</span><span class="tok-p">).</span><span class="tok-nx">not</span><span class="tok-p">(</span><span class="tok-s2">&quot;[class]&quot;</span><span class="tok-p">);</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Obtener los párrafos cuyo id comience por <em>pa</em> o los que no comiencen por <em>pa</em></div>
<div class="content">
<pre class="pygments highlight"><code data-lang="javascript"><span class="tok-kd">var</span> <span class="tok-nx">pa</span> <span class="tok-o">=</span> <span class="tok-nx">$</span><span class="tok-p">(</span><span class="tok-s2">&quot;[id^=pa]&quot;</span><span class="tok-p">);</span>
<span class="tok-nx">$</span><span class="tok-p">(</span><span class="tok-s2">&quot;p&quot;</span><span class="tok-p">).</span><span class="tok-nx">filter</span><span class="tok-p">(</span><span class="tok-nx">pa</span><span class="tok-p">);</span>
<span class="tok-nx">$</span><span class="tok-p">(</span><span class="tok-s2">&quot;p&quot;</span><span class="tok-p">).</span><span class="tok-nx">not</span><span class="tok-p">(</span><span class="tok-nx">pa</span><span class="tok-p">);</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Obtener los párrafos cuya clase es <em>a</em> o el párrafo que ocupa la tercera posición</div>
<div class="content">
<pre class="pygments highlight"><code data-lang="javascript"><span class="tok-nx">$</span><span class="tok-p">(</span><span class="tok-s2">&quot;p&quot;</span><span class="tok-p">).</span><span class="tok-nx">filter</span><span class="tok-p">(</span><span class="tok-kd">function</span><span class="tok-p">(</span><span class="tok-nx">indice</span><span class="tok-p">)</span> <span class="tok-p">{</span>
  <span class="tok-k">return</span> <span class="tok-k">this</span><span class="tok-p">.</span><span class="tok-nx">getAttribute</span><span class="tok-p">(</span><span class="tok-s2">&quot;class&quot;</span><span class="tok-p">)</span> <span class="tok-o">==</span> <span class="tok-s2">&quot;a&quot;</span> <span class="tok-o">||</span> <span class="tok-nx">indice</span> <span class="tok-o">==</span> <span class="tok-mi">2</span><span class="tok-p">;</span>
<span class="tok-p">});</span></code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_navegando_por_la_selección">6.5. Navegando por la selección</h3>
<div class="paragraph">
<p>Una vez tenemos la selección de elementos con la que queremos trabajar podemos navegar (<em>traversing</em>) desde la selección empleando las relaciones DOM entre los elementos.</p>
</div>
<div class="sect3">
<h4 id="_navegación_descendiente">6.5.1. Navegación descendiente</h4>
<div class="paragraph">
<p>Para navegar descendentemente podemos emplear los siguientes métodos:</p>
</div>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 25%;">
<col style="width: 75%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-center valign-middle">Método</th>
<th class="tableblock halign-left valign-top">Propósito</th>
</tr>
</thead>
<tbody>
<tr>
<th class="tableblock halign-center valign-middle"><p class="tableblock">children()</p></th>
<td class="tableblock halign-left valign-top"><p class="tableblock">Selecciona los hijos (descendientes inmediatos) de todos los elementos del conjunto de resultados</p></td>
</tr>
<tr>
<th class="tableblock halign-center valign-middle"><p class="tableblock">children(<em>selector</em>)</p></th>
<td class="tableblock halign-left valign-top"><p class="tableblock">Selecciona todos los elementos que cumplen el selector y que son hijos del conjunto de resultados</p></td>
</tr>
<tr>
<th class="tableblock halign-center valign-middle"><p class="tableblock">contents()</p></th>
<td class="tableblock halign-left valign-top"><p class="tableblock">Devuelve los hijos, incluyendo los contenidos de texto u nodos de comentarios de todos los elementos</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>El uso de las relaciones DOM suele emplearse con el método <code>find()</code> (ver <a href="#_el_objeto_code_jquery_code">El objeto <code>jQuery</code></a>) para buscar un selector entre los descendientes de la selección. Además, en ambos casos no se devuelven elementos duplicados.</p>
</div>
<div class="paragraph">
<p>Por ejemplo, podemos recorrer todos los hijos de un selector de este modo:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="javascript"><span class="tok-kd">var</span> <span class="tok-nx">numHijos</span> <span class="tok-o">=</span> <span class="tok-nx">$</span><span class="tok-p">(</span><span class="tok-s2">&quot;ul&quot;</span><span class="tok-p">).</span><span class="tok-nx">children</span><span class="tok-p">().</span><span class="tok-nx">each</span><span class="tok-p">(</span>
  <span class="tok-kd">function</span><span class="tok-p">(</span><span class="tok-nx">indice</span><span class="tok-p">,</span> <span class="tok-nx">elem</span><span class="tok-p">)</span> <span class="tok-p">{</span>
    <span class="tok-nx">console</span><span class="tok-p">.</span><span class="tok-nx">log</span><span class="tok-p">(</span><span class="tok-nx">elem</span><span class="tok-p">.</span><span class="tok-nx">tagName</span> <span class="tok-o">+</span> <span class="tok-s2">&quot; - &quot;</span> <span class="tok-o">+</span> <span class="tok-nx">elem</span><span class="tok-p">.</span><span class="tok-nx">className</span><span class="tok-p">);</span>
  <span class="tok-p">}</span>
<span class="tok-p">).</span><span class="tok-nx">length</span><span class="tok-p">;</span></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_navegación_ascendente">6.5.2. Navegación ascendente</h4>
<div class="paragraph">
<p>Si en cambio estamos interesados en los elementos que están por encima de nuestro conjunto de resultados usaremos los siguientes métodos:</p>
</div>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 25%;">
<col style="width: 75%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-center valign-middle">Método</th>
<th class="tableblock halign-left valign-top">Propósito</th>
</tr>
</thead>
<tbody>
<tr>
<th class="tableblock halign-center valign-middle"><p class="tableblock">parent()</p></th>
<td class="tableblock halign-left valign-middle" rowspan="2"><p class="tableblock">Selecciona el padre de cada elemento del objeto <em>jQuery</em>, pudiéndose filtrar por el <em>selector</em></p></td>
</tr>
<tr>
<th class="tableblock halign-center valign-middle"><p class="tableblock">parent(<em>selector</em>)</p></th>
</tr>
<tr>
<th class="tableblock halign-center valign-middle"><p class="tableblock">parents()</p></th>
<td class="tableblock halign-left valign-middle" rowspan="2"><p class="tableblock">Selecciona los ascendentes de cada elemento del objeto <em>jQuery</em>, pudiéndose filtrar por el <em>selector</em></p></td>
</tr>
<tr>
<th class="tableblock halign-center valign-middle"><p class="tableblock">parents(<em>selector</em>)</p></th>
</tr>
<tr>
<th class="tableblock halign-center valign-middle"><p class="tableblock">parentsUntil(<em>selector1</em>)</p></th>
<td class="tableblock halign-left valign-middle" rowspan="2"><p class="tableblock">Selecciona los ascendentes de cada elemento del objeto <em>jQuery</em> hasta que se encuentre una ocurrencia para el <em>selector1</em>. Los resultados se pueden filtrar mediante <em>selector2</em>.</p></td>
</tr>
<tr>
<th class="tableblock halign-center valign-middle"><p class="tableblock">parentsUntil(<em>selector1</em>, <em>selector2</em>)</p></th>
</tr>
<tr>
<th class="tableblock halign-center valign-middle"><p class="tableblock">parentsUntil(<em>HTMLElement</em>)</p></th>
<td class="tableblock halign-left valign-middle" rowspan="4"><p class="tableblock">Selecciona los ascendentes de cada elemento del objeto <em>jQuery</em> hasta que se encuentre uno de los elementos especificados. Los resultados se pueden filtrar mediante un <em>selector</em>.</p></td>
</tr>
<tr>
<th class="tableblock halign-center valign-middle"><p class="tableblock">parentsUntil(<em>HTMLElement</em>, <em>selector</em>)</p></th>
</tr>
<tr>
<th class="tableblock halign-center valign-middle"><p class="tableblock">parentsUntil(<em>HTMLElement[]</em>)</p></th>
</tr>
<tr>
<th class="tableblock halign-center valign-middle"><p class="tableblock">parentsUntil(<em>HTMLElement[]</em>, <em>selector</em>)</p></th>
</tr>
<tr>
<th class="tableblock halign-center valign-middle"><p class="tableblock">closest(<em>selector</em>)</p></th>
<td class="tableblock halign-left valign-middle" rowspan="2"><p class="tableblock">Selecciona el ascendente más cercano de cada elemento del objeto <em>jQuery</em> y realiza la intersección con el <em>selector</em> / <em>contexto</em>.</p></td>
</tr>
<tr>
<th class="tableblock halign-center valign-middle"><p class="tableblock">closest(<em>selector</em>, <em>contexto</em>)</p></th>
</tr>
<tr>
<th class="tableblock halign-center valign-middle"><p class="tableblock">closest(<em>jQuery</em>)</p></th>
<td class="tableblock halign-left valign-middle" rowspan="2"><p class="tableblock">Selecciona el ascendente más cercano de cada elemento del objeto <em>jQuery</em> y realiza la intersección con los elementos contenidos en el parámetro.</p></td>
</tr>
<tr>
<th class="tableblock halign-center valign-middle"><p class="tableblock">closest(<em>HTMLElement</em>)</p></th>
</tr>
<tr>
<th class="tableblock halign-center valign-middle"><p class="tableblock">offsetParent()</p></th>
<td class="tableblock halign-left valign-top"><p class="tableblock">Encuentra el ascendente posicionado más cercano (tiene valor <code>fixed</code>, <code>absolute</code> o <code>relative</code> en la propiedad <code>position</code>). Útil para trabajar con animaciones</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Algunos ejemplos con estos métodos:</p>
</div>
<div class="listingblock">
<div class="title">Obtener el padre de todos los enlaces - Obtener aquellos padres de enlaces que tienen el atributo <code>lang</code></div>
<div class="content">
<pre class="pygments highlight"><code data-lang="javascript"><span class="tok-nx">$</span><span class="tok-p">(</span><span class="tok-s2">&quot;a&quot;</span><span class="tok-p">).</span><span class="tok-nx">parent</span><span class="tok-p">();</span>
<span class="tok-nx">$</span><span class="tok-p">(</span><span class="tok-s2">&quot;a&quot;</span><span class="tok-p">).</span><span class="tok-nx">parent</span><span class="tok-p">(</span><span class="tok-s2">&quot;[lang]&quot;</span><span class="tok-p">);</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Obtener los ascendentes (padre, abuelo, etc..) de los elementos cuya clase sea <code>a</code></div>
<div class="content">
<pre class="pygments highlight"><code data-lang="javascript"><span class="tok-nx">$</span><span class="tok-p">(</span><span class="tok-s2">&quot;.a&quot;</span><span class="tok-p">).</span><span class="tok-nx">parents</span><span class="tok-p">();</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Obtener los ascendentes hasta llegar a la etiqueta <code>form</code> de los elementos cuya clase sea <code>a</code> y que contenga el valor <code>es</code> en el atributo <code>lang</code></div>
<div class="content">
<pre class="pygments highlight"><code data-lang="javascript"><span class="tok-nx">$</span><span class="tok-p">(</span><span class="tok-s2">&quot;.a&quot;</span><span class="tok-p">).</span><span class="tok-nx">parentsUntil</span><span class="tok-p">(</span><span class="tok-s1">&#39;form&#39;</span><span class="tok-p">,</span><span class="tok-s1">&#39;[lang*=es]&#39;</span><span class="tok-p">);</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Obtiene los ascendentes más cercanos cuya clase sea <code>a</code>, de la imagen cuya fuente referencie a <em>flickr</em></div>
<div class="content">
<pre class="pygments highlight"><code data-lang="javascript"><span class="tok-nx">$</span><span class="tok-p">(</span><span class="tok-s2">&quot;img[src*=flickr]&quot;</span><span class="tok-p">).</span><span class="tok-nx">closest</span><span class="tok-p">(</span><span class="tok-s2">&quot;.a&quot;</span><span class="tok-p">);</span></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_navegación_horizontal">6.5.3. Navegación horizontal</h4>
<div class="paragraph">
<p>Finalmente, si lo queremos es navegar entre los elementos que están en el mismo nivel, podemos utilizar los siguientes métodos:</p>
</div>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 25%;">
<col style="width: 75%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-center valign-middle">Método</th>
<th class="tableblock halign-left valign-top">Propósito</th>
</tr>
</thead>
<tbody>
<tr>
<th class="tableblock halign-center valign-middle"><p class="tableblock">siblings()</p></th>
<td class="tableblock halign-left valign-top"><p class="tableblock">Selecciona todos los hermanos (anteriores y posteriores) para cada uno de los elementos del objeto <code>jQuery</code>.</p></td>
</tr>
<tr>
<th class="tableblock halign-center valign-middle"><p class="tableblock">next()</p></th>
<td class="tableblock halign-left valign-top"><p class="tableblock">Selecciona el hermano inmediatamente posterior para cada elemento del objeto <em>jQuery</em>.</p></td>
</tr>
<tr>
<th class="tableblock halign-center valign-middle"><p class="tableblock">nextAll()</p></th>
<td class="tableblock halign-left valign-top"><p class="tableblock">Selecciona todos los hermanos posteriores para cada elemento del objeto <em>jQuery</em>, pudiéndose filtrar por el <em>selector</em></p></td>
</tr>
<tr>
<th class="tableblock halign-center valign-middle"><p class="tableblock">nextUntil(<em>selector</em>)</p></th>
<td class="tableblock halign-left valign-middle" rowspan="3"><p class="tableblock">Selecciona los hermanos anteriores para cada elemento hasta (sin incluir) un elemento que cumpla el <em>selector</em> o un elemento del objeto <code>jQuery</code> o del array <code>HTMLElement</code>.</p></td>
</tr>
<tr>
<th class="tableblock halign-center valign-middle"><p class="tableblock">nextUntil(<em>jQuery</em>)</p></th>
</tr>
<tr>
<th class="tableblock halign-center valign-middle"><p class="tableblock">nextUntil(<em>HTMLElement[]</em>)</p></th>
</tr>
<tr>
<th class="tableblock halign-center valign-middle"><p class="tableblock">prev()</p></th>
<td class="tableblock halign-left valign-top"><p class="tableblock">Selecciona el hermano inmediatamente anterior para cada elemento del objeto <code>jQuery</code>.</p></td>
</tr>
<tr>
<th class="tableblock halign-center valign-middle"><p class="tableblock">prevAll()</p></th>
<td class="tableblock halign-left valign-top"><p class="tableblock">Selecciona todos los hermanos anteriores para cada elemento del objeto <code>jQuery</code>.</p></td>
</tr>
<tr>
<th class="tableblock halign-center valign-middle"><p class="tableblock">prevUntil(<em>selector</em>)</p></th>
<td class="tableblock halign-left valign-middle" rowspan="3"><p class="tableblock">Selecciona los hermanos anteriores para cada elemento hasta (sin incluir) un elemento que cumpla el <em>selector</em> o un elemento del objeto <code>jQuery</code> o del array <code>HTMLElement</code>.</p></td>
</tr>
<tr>
<th class="tableblock halign-center valign-middle"><p class="tableblock">prevUntil(<em>jQuery</em>)</p></th>
</tr>
<tr>
<th class="tableblock halign-center valign-middle"><p class="tableblock">prevUntil(<em>HTMLElement[]</em>)</p></th>
</tr>
</tbody>
</table>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
Todos estos métodos aceptan un segundo parámetro opcional con un <em>selector</em> para filtrar resultados.
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_manipulando_contenido">6.6. Manipulando contenido</h3>
<div class="paragraph">
<p>Una vez seleccionados los elementos con los que queremos trabajar mediante el uso de selectores y filtros, llega el momento de manipular su contenido.</p>
</div>
<div class="paragraph">
<p>En ocasiones crearemos contenido de manera dinámica, de modo que <em>jQuery</em> nos ofrece métodos para crear, copiar, borrar y mover contenido, además de permitir envolver contenido dentro de otro.</p>
</div>
<div class="paragraph">
<p>Además, <em>jQuery</em> ofrece soporte <em>Cross-Browser</em> para trabajar con CSS, incluyendo información sobre posicionamiento y tamaño.</p>
</div>
<div class="sect3">
<h4 id="_creando_contenido">6.6.1. Creando contenido</h4>
<div class="paragraph">
<p>Para crear nuevo contenido, no tenemos más que pasarle una cadena con el código <em>HTML</em> a la función <code>$()</code></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="javascript"><span class="tok-kd">var</span> <span class="tok-nx">nuevoEncabezado</span> <span class="tok-o">=</span> <span class="tok-nx">$</span><span class="tok-p">(</span><span class="tok-s2">&quot;&lt;h1&gt;Encabezado Nivel 1&lt;/h1&gt;&quot;</span><span class="tok-p">);</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>También podemos hacerlo mediante los siguientes métodos:</p>
</div>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 25%;">
<col style="width: 75%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-center valign-middle">Método</th>
<th class="tableblock halign-left valign-top">Propósito</th>
</tr>
</thead>
<tbody>
<tr>
<th class="tableblock halign-center valign-middle"><p class="tableblock">html()</p></th>
<td class="tableblock halign-left valign-top"><p class="tableblock">Devuelve el contenido <em>HTML</em> del primer elemento del conjunto de resultados</p></td>
</tr>
<tr>
<th class="tableblock halign-center valign-middle"><p class="tableblock">html(<em>nuevoContenido</em>)</p></th>
<td class="tableblock halign-left valign-top"><p class="tableblock">Asigna el <em>nuevoContenido</em> <em>HTML</em> a todos los elementos del conjunto de resultados</p></td>
</tr>
<tr>
<th class="tableblock halign-center valign-middle"><p class="tableblock">text()</p></th>
<td class="tableblock halign-left valign-top"><p class="tableblock">Devuelve el contenido de todos los elemento del conjunto de resultados</p></td>
</tr>
<tr>
<th class="tableblock halign-center valign-middle"><p class="tableblock">text(<em>nuevoTexto</em>)</p></th>
<td class="tableblock halign-left valign-top"><p class="tableblock">Asigna el <em>nuevoTexto</em> a todos los elementos del conjunto de resultados</p></td>
</tr>
</tbody>
</table>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
La principal diferencia entre <code>html(contenido)</code> y <code>text(contenido)</code>  es que si pasamos código HTML al método <code>text()</code>, éste escapará los símbolos de <code>&lt;</code> y <code>&gt;</code>.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Vamos a practicar estos métodos con algunos ejemplos:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="javascript"><span class="tok-nx">console</span><span class="tok-p">.</span><span class="tok-nx">log</span><span class="tok-p">(</span><span class="tok-nx">$</span><span class="tok-p">(</span><span class="tok-s2">&quot;#listado&quot;</span><span class="tok-p">).</span><span class="tok-nx">html</span><span class="tok-p">());</span>	<span class="tok-c1">// &lt;li class=&quot;a&quot;&gt;elemento 0.......elemento 3&lt;/li&gt;</span>
<span class="tok-nx">console</span><span class="tok-p">.</span><span class="tok-nx">log</span><span class="tok-p">(</span><span class="tok-nx">$</span><span class="tok-p">(</span><span class="tok-s2">&quot;#listado&quot;</span><span class="tok-p">).</span><span class="tok-nx">text</span><span class="tok-p">());</span>	<span class="tok-c1">// elemento 0 elemento 1 ... elemento 3</span>
<span class="tok-nx">console</span><span class="tok-p">.</span><span class="tok-nx">log</span><span class="tok-p">(</span><span class="tok-nx">$</span><span class="tok-p">(</span><span class="tok-s2">&quot;li&quot;</span><span class="tok-p">).</span><span class="tok-nx">html</span><span class="tok-p">());</span>	<span class="tok-c1">// elemento 0</span>
<span class="tok-nx">console</span><span class="tok-p">.</span><span class="tok-nx">log</span><span class="tok-p">(</span><span class="tok-nx">$</span><span class="tok-p">(</span><span class="tok-s2">&quot;li&quot;</span><span class="tok-p">).</span><span class="tok-nx">text</span><span class="tok-p">());</span>	<span class="tok-c1">// elemento 0elemento 1elemento 2elemento 3</span>
<span class="tok-nx">$</span><span class="tok-p">(</span><span class="tok-s2">&quot;#listado&quot;</span><span class="tok-p">).</span><span class="tok-nx">html</span><span class="tok-p">(</span><span class="tok-s2">&quot;&lt;li&gt;Nuevo elemento mediante jQuery&lt;/li&gt;&quot;</span><span class="tok-p">);</span>
<span class="tok-nx">console</span><span class="tok-p">.</span><span class="tok-nx">log</span><span class="tok-p">(</span><span class="tok-nx">$</span><span class="tok-p">(</span><span class="tok-s2">&quot;#listado&quot;</span><span class="tok-p">).</span><span class="tok-nx">html</span><span class="tok-p">());</span>	<span class="tok-c1">// &lt;li&gt;Nuevo elemento mediante jQuery&lt;/li&gt;</span>
<span class="tok-nx">$</span><span class="tok-p">(</span><span class="tok-s2">&quot;p:first&quot;</span><span class="tok-p">).</span><span class="tok-nx">html</span><span class="tok-p">(</span><span class="tok-s2">&quot;Este es el primer párrafo con &lt;br /&gt; en medio&quot;</span><span class="tok-p">);</span>
<span class="tok-nx">$</span><span class="tok-p">(</span><span class="tok-s2">&quot;p:last&quot;</span><span class="tok-p">).</span><span class="tok-nx">text</span><span class="tok-p">(</span><span class="tok-s2">&quot;Este es el último párrafo con &lt;br /&gt; en medio&quot;</span><span class="tok-p">);</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Como podemos observar, al asignar nuevo contenido estamos eliminando el contenido previo y sustituyéndolo por el nuevo, pero manteniendo los atributos de la etiqueta sobre la que se añade el contenido.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/js06/js06CreandoContenido.jpg" alt="Resultado de crear contenido" width="33%">
</div>
<div class="title">Figure 40. Resultado de crear contenido</div>
</div>
</div>
<div class="sect3">
<h4 id="_trabajando_con_valores">6.6.2. Trabajando con valores</h4>
<div class="paragraph">
<p>Una vez hemos seleccionado elementos que forman parte de un formulario, podremos obtener o modificar sus valores mediante el método <code>val()</code>:</p>
</div>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 25%;">
<col style="width: 75%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-center valign-middle">Método</th>
<th class="tableblock halign-left valign-top">Propósito</th>
</tr>
</thead>
<tbody>
<tr>
<th class="tableblock halign-center valign-middle"><p class="tableblock">val()</p></th>
<td class="tableblock halign-left valign-top"><p class="tableblock">Devuelve el valor del primer elemento del conjunto de resultados</p></td>
</tr>
<tr>
<th class="tableblock halign-center valign-middle"><p class="tableblock">val(<em>valor</em>)</p></th>
<td class="tableblock halign-left valign-top"><p class="tableblock">Asigna el <em>valor</em> a todos los elementos del conjunto de resultados</p></td>
</tr>
<tr>
<th class="tableblock halign-center valign-middle"><p class="tableblock">val(<em>función</em>)</p></th>
<td class="tableblock halign-left valign-top"><p class="tableblock">Asigna valores a todos los elementos del conjunto de resultados mediante la <em>función</em></p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Por ejemplo:</p>
</div>
<div class="listingblock">
<div class="title">Mostrar el valor de todos los elementos de entrada:</div>
<div class="content">
<pre class="pygments highlight"><code data-lang="javascript"><span class="tok-nx">$</span><span class="tok-p">(</span><span class="tok-s2">&quot;input&quot;</span><span class="tok-p">).</span><span class="tok-nx">each</span><span class="tok-p">(</span><span class="tok-kd">function</span><span class="tok-p">(</span><span class="tok-nx">indice</span><span class="tok-p">,</span> <span class="tok-nx">elem</span><span class="tok-p">)</span> <span class="tok-p">{</span>
  <span class="tok-nx">console</span><span class="tok-p">.</span><span class="tok-nx">log</span><span class="tok-p">(</span><span class="tok-s2">&quot;Nombre: &quot;</span> <span class="tok-o">+</span> <span class="tok-nx">elem</span><span class="tok-p">.</span><span class="tok-nx">name</span> <span class="tok-o">+</span> <span class="tok-s2">&quot; Valor: &quot;</span> <span class="tok-o">+</span> <span class="tok-nx">$</span><span class="tok-p">(</span><span class="tok-nx">elem</span><span class="tok-p">).</span><span class="tok-nx">val</span><span class="tok-p">());</span>
<span class="tok-p">});</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Asignar el valor mediante una función</div>
<div class="content">
<pre class="pygments highlight"><code data-lang="javascript"><span class="tok-nx">$</span><span class="tok-p">(</span><span class="tok-s2">&quot;input&quot;</span><span class="tok-p">).</span><span class="tok-nx">val</span><span class="tok-p">(</span><span class="tok-kd">function</span><span class="tok-p">(</span><span class="tok-nx">indice</span><span class="tok-p">,</span> <span class="tok-nx">valorActual</span><span class="tok-p">)</span> <span class="tok-p">{</span>
  <span class="tok-k">return</span> <span class="tok-p">(</span><span class="tok-nx">indice</span> <span class="tok-o">+</span> <span class="tok-mi">1</span><span class="tok-p">)</span> <span class="tok-o">*</span> <span class="tok-mi">100</span><span class="tok-p">;</span>
<span class="tok-p">});</span></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_trabajando_con_atributos">6.6.3. Trabajando con atributos</h4>
<div class="paragraph">
<p>Para inspeccionar o modificar el valor de los atributos de los elementos usaremos el método <code>attr</code>.</p>
</div>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 25%;">
<col style="width: 75%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-center valign-middle">Método</th>
<th class="tableblock halign-left valign-top">Propósito</th>
</tr>
</thead>
<tbody>
<tr>
<th class="tableblock halign-center valign-middle"><p class="tableblock">attr(<em>nombre</em>)</p></th>
<td class="tableblock halign-left valign-top"><p class="tableblock">Accede a la propiedad del primero elemento del conjunto de resultados. Éste método facilita obtener el valor de propiedades. Si el elemento no tiene un atributo con dicho nombre, devuelve <code>undefined</code></p></td>
</tr>
<tr>
<th class="tableblock halign-center valign-middle"><p class="tableblock">attr(<em>objetoPropiedades</em>)</p></th>
<td class="tableblock halign-left valign-top"><p class="tableblock">Asigna una serie de atributos en todos los elementos del conjunto de resultado mediante la sintaxis de notación de objeto, lo que permite asignar un gran número de propiedades de una sola vez
<code>$("img").attr({ src:"/imagenes/logo.gif", title:"JavaUA", alt: "Logo JavaUA"});</code></p></td>
</tr>
<tr>
<th class="tableblock halign-center valign-middle"><p class="tableblock">attr(<em>clave</em>, <em>valor</em>)</p></th>
<td class="tableblock halign-left valign-top"><p class="tableblock">Asigna  <em>valor</em> a la propiedad <em>clave</em> a todos los elementos del conjunto de resultados</p></td>
</tr>
<tr>
<th class="tableblock halign-center valign-middle"><p class="tableblock">attr(<em>clave</em>, <em>función</em>)</p></th>
<td class="tableblock halign-left valign-top"><p class="tableblock">Asigna una única propiedad a un valor calculado para todos los elementos del conjunto de resultados. En vez de pasar un valor mediante una cadena, la función devolverá el valor del atributo.</p></td>
</tr>
<tr>
<th class="tableblock halign-center valign-middle"><p class="tableblock">removeAttr(<em>nombre</em>)</p></th>
<td class="tableblock halign-left valign-top"><p class="tableblock">Elimina el atributo <em>nombre</em> de todos los elementos del conjunto de resultados</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Vamos a estudiar algunos ejemplos, suponiendo que tenemos un enlace con una imagen del siguiente modo:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="html"><span class="tok-nt">&lt;a</span> <span class="tok-na">href=</span><span class="tok-s">&quot;imagenes/logo.jpg&quot;</span><span class="tok-nt">&gt;&lt;img</span> <span class="tok-na">src=</span><span class="tok-s">&quot;imagenes/logo.jpg&quot;</span> <span class="tok-na">alt=</span><span class="tok-s">&quot;logo&quot;</span> <span class="tok-nt">/&gt;&lt;/a&gt;</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Abrir el enlace en una nueva ventana</div>
<div class="content">
<pre class="pygments highlight"><code data-lang="javascript"><span class="tok-nx">$</span><span class="tok-p">(</span><span class="tok-s2">&quot;a&quot;</span><span class="tok-p">).</span><span class="tok-nx">attr</span><span class="tok-p">(</span><span class="tok-s2">&quot;target&quot;</span><span class="tok-p">,</span><span class="tok-s2">&quot;_blank&quot;</span><span class="tok-p">);</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Quitar el cuadrado que encubre la imagen al tratarse de un enlace</div>
<div class="content">
<pre class="pygments highlight"><code data-lang="javascript"><span class="tok-nx">$</span><span class="tok-p">(</span><span class="tok-s2">&quot;a&quot;</span><span class="tok-p">).</span><span class="tok-nx">removeAttr</span><span class="tok-p">(</span><span class="tok-s2">&quot;href&quot;</span><span class="tok-p">);</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Cambiar la ruta de la imagen y su texto alternativo</div>
<div class="content">
<pre class="pygments highlight"><code data-lang="javascript"><span class="tok-nx">$</span><span class="tok-p">(</span><span class="tok-s2">&quot;img&quot;</span><span class="tok-p">).</span><span class="tok-nx">attr</span><span class="tok-p">({</span><span class="tok-nx">src</span><span class="tok-o">:</span><span class="tok-s2">&quot;imagenes/batman.jpg&quot;</span><span class="tok-p">,</span> <span class="tok-nx">alt</span><span class="tok-o">:</span><span class="tok-s2">&quot;Batman&quot;</span><span class="tok-p">});</span></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_insertando_contenido">6.6.4. Insertando contenido</h4>
<div class="paragraph">
<p><em>jQuery</em> ofrece varios métodos para insertar nuevo contenido en el documento, tanto antes como después del contenido de los elementos de la página.</p>
</div>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 25%;">
<col style="width: 75%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-center valign-middle">Método</th>
<th class="tableblock halign-left valign-top">Propósito</th>
</tr>
</thead>
<tbody>
<tr>
<th class="tableblock halign-center valign-middle"><p class="tableblock">append(<em>contenido</em>)</p></th>
<td class="tableblock halign-left valign-top"><p class="tableblock">Anexa contenido (al final) dentro de cada elemento del conjunto de resultados</p></td>
</tr>
<tr>
<th class="tableblock halign-center valign-middle"><p class="tableblock">appendTo(<em>selector</em>)</p></th>
<td class="tableblock halign-left valign-top"><p class="tableblock">Traslada todos los elementos del conjunto de resultados detrás de los encontrados por el <em>selector</em></p></td>
</tr>
<tr>
<th class="tableblock halign-center valign-middle"><p class="tableblock">prepend(<em>contenido</em>)</p></th>
<td class="tableblock halign-left valign-top"><p class="tableblock">Añade contenido (al inicio) dentro de cada elemento del conjunto de resultados</p></td>
</tr>
<tr>
<th class="tableblock halign-center valign-middle"><p class="tableblock">prependTo(<em>selector</em>)</p></th>
<td class="tableblock halign-left valign-top"><p class="tableblock">Traslada todos los elementos del conjunto de resultados delante de los encontrados por el <em>selector</em></p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>El <em>contenido</em> de los métodos puede ser contenido HTML, un objeto <code>jQuery</code>, un array de <code>HTMLElement</code> o una función que devuelva el contenido.</p>
</div>
<div class="paragraph">
<p>Supongamos que partimos del siguiente fragmento:</p>
</div>
<div class="listingblock">
<div class="title">Plantilla Ejemplos Modificar Contenido - <a href="http://jsbin.com/yobegu/2/edit?html,js,output" class="bare">http://jsbin.com/yobegu/2/edit?html,js,output</a></div>
<div class="content">
<pre class="pygments highlight"><code data-lang="html"><span class="tok-nt">&lt;p&gt;</span>Párrafo 1<span class="tok-nt">&lt;/p&gt;</span>
<span class="tok-nt">&lt;p&gt;</span>Párrafo 2<span class="tok-nt">&lt;/p&gt;</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Añadir un texto al final de todos los párrafos</div>
<div class="content">
<pre class="pygments highlight"><code data-lang="javascript"><span class="tok-nx">$</span><span class="tok-p">(</span><span class="tok-s2">&quot;p&quot;</span><span class="tok-p">).</span><span class="tok-nx">append</span><span class="tok-p">(</span><span class="tok-s2">&quot; con nuevo contenido anexado&quot;</span><span class="tok-p">);</span>
<span class="tok-c1">// &lt;p&gt;Párrafo 1 con nuevo contenido anexado&lt;/p&gt;</span>
<span class="tok-c1">// &lt;p&gt;Párrafo 2 con nuevo contenido anexado&lt;/p&gt;</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Añadir un texto al inicio de todos los párrafos</div>
<div class="content">
<pre class="pygments highlight"><code data-lang="javascript"><span class="tok-nx">$</span><span class="tok-p">(</span><span class="tok-s2">&quot;p&quot;</span><span class="tok-p">).</span><span class="tok-nx">prepend</span><span class="tok-p">(</span><span class="tok-s2">&quot;Nuevo contenido en el &quot;</span><span class="tok-p">);</span>
<span class="tok-c1">// &lt;p&gt;Nuevo contenido en el Párrafo 1&lt;/p&gt;</span>
<span class="tok-c1">// &lt;p&gt;Nuevo contenido en el Párrafo 2&lt;/p&gt;</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Trasladar el último párrafo delante del primero</div>
<div class="content">
<pre class="pygments highlight"><code data-lang="javascript"><span class="tok-nx">$</span><span class="tok-p">(</span><span class="tok-s2">&quot;p:last&quot;</span><span class="tok-p">).</span><span class="tok-nx">prependTo</span><span class="tok-p">(</span><span class="tok-s2">&quot;p:first&quot;</span><span class="tok-p">);</span>
<span class="tok-c1">// &lt;p&gt;Párrafo 2&lt;/p&gt;</span>
<span class="tok-c1">// &lt;p&gt;Párrafo 1&lt;/p&gt;</span></code></pre>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="title">Autoevaluación</div>
<div class="paragraph">
<p>Suponiendo que tenemos una capa que contiene una capa con artículos ¿Qué realiza el siguiente código ? <span class="footnote">[<a id="_footnoteref_11" class="footnote" href="#_footnote_11" title="View footnote.">11</a>]</span></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="javascript"><span class="tok-nx">$</span><span class="tok-p">(</span><span class="tok-s1">&#39;#articulo&#39;</span><span class="tok-p">).</span><span class="tok-nx">find</span><span class="tok-p">(</span><span class="tok-s1">&#39;span.co&#39;</span><span class="tok-p">).</span><span class="tok-nx">each</span><span class="tok-p">(</span><span class="tok-kd">function</span><span class="tok-p">()</span> <span class="tok-p">{</span>
  <span class="tok-kd">var</span> <span class="tok-nx">$this</span> <span class="tok-o">=</span> <span class="tok-nx">$</span><span class="tok-p">(</span><span class="tok-k">this</span><span class="tok-p">);</span>
  <span class="tok-nx">$</span><span class="tok-p">(</span><span class="tok-s1">&#39;&lt;blockquote&gt;&lt;/blockquote&gt;&#39;</span><span class="tok-p">,</span> <span class="tok-p">{</span>
    <span class="tok-kr">class</span><span class="tok-o">:</span> <span class="tok-s1">&#39;co&#39;</span><span class="tok-p">,</span>
    <span class="tok-nx">text</span><span class="tok-o">:</span> <span class="tok-nx">$this</span><span class="tok-p">.</span><span class="tok-nx">text</span><span class="tok-p">()</span>
  <span class="tok-p">}).</span><span class="tok-nx">prependTo</span><span class="tok-p">(</span> <span class="tok-nx">$this</span><span class="tok-p">.</span><span class="tok-nx">closest</span><span class="tok-p">(</span><span class="tok-s1">&#39;p&#39;</span><span class="tok-p">)</span> <span class="tok-p">);</span>
<span class="tok-p">});</span></code></pre>
</div>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Si queremos que el contenido se situe antes o después de ciertos elementos (y no dentro de los seleccionados), hemos de emplear los siguiente métodos:</p>
</div>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 25%;">
<col style="width: 75%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-center valign-middle">Método</th>
<th class="tableblock halign-left valign-top">Propósito</th>
</tr>
</thead>
<tbody>
<tr>
<th class="tableblock halign-center valign-middle"><p class="tableblock">after(<em>contenido</em>)</p></th>
<td class="tableblock halign-left valign-top"><p class="tableblock">Inserta el <em>contenido</em> detrás de cada elemento del conjunto de resultados</p></td>
</tr>
<tr>
<th class="tableblock halign-center valign-middle"><p class="tableblock">before(<em>contenido</em>)</p></th>
<td class="tableblock halign-left valign-top"><p class="tableblock">Inserta el <em>contenido</em> antes de cada elemento del conjunto de resultados</p></td>
</tr>
<tr>
<th class="tableblock halign-center valign-middle"><p class="tableblock">insertAfter(<em>selector</em>)</p></th>
<td class="tableblock halign-left valign-top"><p class="tableblock">Inserta todos los elementos del conjunto de resultados detrás de los encontrados por el <em>selector</em></p></td>
</tr>
<tr>
<th class="tableblock halign-center valign-middle"><p class="tableblock">insertBefore(<em>selector</em>)</p></th>
<td class="tableblock halign-left valign-top"><p class="tableblock">Inserta todos los elementos del conjunto de resultados delante de los encontrados por el <em>selector</em></p></td>
</tr>
</tbody>
</table>
<div class="listingblock">
<div class="title">Añadir un nuevo párrafo detrás de cada uno de los existentes</div>
<div class="content">
<pre class="pygments highlight"><code data-lang="javascript"><span class="tok-nx">$</span><span class="tok-p">(</span><span class="tok-s2">&quot;p&quot;</span><span class="tok-p">).</span><span class="tok-nx">after</span><span class="tok-p">(</span><span class="tok-s2">&quot;&lt;p&gt;Párrafo separado&lt;/p&gt;&quot;</span><span class="tok-p">);</span>
<span class="tok-nx">$</span><span class="tok-p">(</span><span class="tok-s2">&quot;&lt;p&gt;Párrafo separado&lt;/p&gt;&quot;</span><span class="tok-p">).</span><span class="tok-nx">insertAfter</span><span class="tok-p">(</span><span class="tok-s2">&quot;p&quot;</span><span class="tok-p">);</span>
<span class="tok-c1">// &lt;p&gt;Párrafo 1&lt;/p&gt;</span>
<span class="tok-c1">// &lt;p&gt;Párrafo separado&lt;/p&gt;</span>
<span class="tok-c1">// &lt;p&gt;Párrafo 2&lt;/p&gt;</span>
<span class="tok-c1">// &lt;p&gt;Párrafo separado&lt;/p&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Por ejemplo, si queremos mover un elemento una posición hacia abajo, dentro de <code>after</code> podemos crear una función anónima que devuelva el contenido a mover (además nos sirve para hacer un filtro):</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="javascript"><span class="tok-nx">$</span><span class="tok-p">(</span><span class="tok-s2">&quot;p:eq(1)&quot;</span><span class="tok-p">).</span><span class="tok-nx">after</span><span class="tok-p">(</span><span class="tok-kd">function</span><span class="tok-p">()</span> <span class="tok-p">{</span>
  <span class="tok-k">return</span> <span class="tok-nx">$</span><span class="tok-p">(</span><span class="tok-k">this</span><span class="tok-p">).</span><span class="tok-nx">prev</span><span class="tok-p">();</span>
<span class="tok-p">});</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Finalmente, si queremos duplicar el contenido usaremos el método <code>clone()</code>:</p>
</div>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 25%;">
<col style="width: 75%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-center valign-middle">Método</th>
<th class="tableblock halign-left valign-top">Propósito</th>
</tr>
</thead>
<tbody>
<tr>
<th class="tableblock halign-center valign-middle"><p class="tableblock">clone()</p></th>
<td class="tableblock halign-left valign-top"><p class="tableblock">Clona los elementos del conjunto de resultados y selecciona los clonados</p></td>
</tr>
<tr>
<th class="tableblock halign-center valign-middle"><p class="tableblock">clone(bool)</p></th>
<td class="tableblock halign-left valign-top"><p class="tableblock">Clona los elementos del conjunto de resultados y todos sus manejadores de eventos y selecciona los clonados (pasándole <code>true</code>)</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Por ejemplo, podemos clonar un elemento existente para modificarlo a continuación:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="javascript"><span class="tok-kd">var</span> <span class="tok-nx">vip2</span> <span class="tok-o">=</span> <span class="tok-nx">$</span><span class="tok-p">(</span><span class="tok-s2">&quot;#vip&quot;</span><span class="tok-p">).</span><span class="tok-nx">clone</span><span class="tok-p">();</span>
<span class="tok-nx">vip2</span><span class="tok-p">.</span><span class="tok-nx">attr</span><span class="tok-p">(</span><span class="tok-s2">&quot;id&quot;</span><span class="tok-p">,</span><span class="tok-s2">&quot;vip2&quot;</span><span class="tok-p">);</span></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_modificando_el_contenido">6.6.5. Modificando el contenido</h4>
<div class="paragraph">
<p><em>jQuery</em> permite envolver contenido en la página, sustituir contenido, copiar y eliminarlo, mediante los siguientes métodos.</p>
</div>
<div class="paragraph">
<p>Si nos centramos en los métodos para envolver contenido, de manera que les añadiremos un padre, tenemos:</p>
</div>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 25%;">
<col style="width: 75%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-center valign-middle">Método</th>
<th class="tableblock halign-left valign-top">Propósito</th>
</tr>
</thead>
<tbody>
<tr>
<th class="tableblock halign-center valign-middle"><p class="tableblock">wrap(<em>html</em>)</p></th>
<td class="tableblock halign-left valign-top"><p class="tableblock">Envuelve cada elemento del conjunto de resultados con el contenido <em>html</em> especificado</p></td>
</tr>
<tr>
<th class="tableblock halign-center valign-middle"><p class="tableblock">wrap(<em>elemento</em>)</p></th>
<td class="tableblock halign-left valign-top"><p class="tableblock">Envuelve cada elemento del conjunto de resultados con el <em>elemento</em> especificado</p></td>
</tr>
<tr>
<th class="tableblock halign-center valign-middle"><p class="tableblock">wrapAll(<em>html</em>)</p></th>
<td class="tableblock halign-left valign-top"><p class="tableblock">Envuelve todos los elementos del conjunto de resultados con el contenido <em>html</em> especificado</p></td>
</tr>
<tr>
<th class="tableblock halign-center valign-middle"><p class="tableblock">wrapAll(<em>elemento</em>)</p></th>
<td class="tableblock halign-left valign-top"><p class="tableblock">Envuelve todos los elementos del conjunto de resultados con un único <em>elemento</em></p></td>
</tr>
<tr>
<th class="tableblock halign-center valign-middle"><p class="tableblock">wrapInner(<em>html</em>)</p></th>
<td class="tableblock halign-left valign-top"><p class="tableblock">Envuelve los contenidos de los hijos internos de cada elemento del conjunto de resultados (incluyendo los nodos de texto) con una estructura <em>html</em></p></td>
</tr>
<tr>
<th class="tableblock halign-center valign-middle"><p class="tableblock">wrapInner(<em>elemento</em>)</p></th>
<td class="tableblock halign-left valign-top"><p class="tableblock">Envuelve los contenidos de los hijos internos de cada elemento del conjunto de resultados (incluyendo los nodos de texto) con un <em>elemento</em> DOM</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Una caso particular de <code>wrapAll()</code> es el cual en el que la selección no comparte un padre común. En este caso, el nuevo elemento se inserta com padre del primer elemento seleccionado. A continuación, <em>jQuery</em> mueve el resto de elementos para que sean hermanos del primero.</p>
</div>
<div class="paragraph">
<p>Vamos a practicar estos métodos con algunos ejemplos (<a href="http://jsbin.com/gavipi/1/edit?html,js,output" class="bare">http://jsbin.com/gavipi/1/edit?html,js,output</a>):</p>
</div>
<div class="listingblock">
<div class="title">Envuelve cada párrafo con una capa de color rojo (tantas capas como párrafos)</div>
<div class="content">
<pre class="pygments highlight"><code data-lang="javascript"><span class="tok-nx">$</span><span class="tok-p">(</span><span class="tok-s2">&quot;p&quot;</span><span class="tok-p">).</span><span class="tok-nx">wrap</span><span class="tok-p">(</span><span class="tok-s2">&quot;&lt;div style=&#39;color:red&#39; /&gt;&quot;</span><span class="tok-p">);</span>
<span class="tok-c1">// &lt;div style=&#39;color:red&#39;&gt;&lt;p&gt;Párrafo 1&lt;/p&gt;&lt;/div&gt;</span>
<span class="tok-c1">// &lt;div style=&#39;color:red&#39;&gt;&lt;p&gt;Párrafo 2&lt;/p&gt;&lt;/div&gt;</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Envuelve todos los párrafos con una capa de color rojo (una capa que envuelve a todos los párrafos)</div>
<div class="content">
<pre class="pygments highlight"><code data-lang="javascript"><span class="tok-nx">$</span><span class="tok-p">(</span><span class="tok-s2">&quot;p&quot;</span><span class="tok-p">).</span><span class="tok-nx">wrapAll</span><span class="tok-p">(</span><span class="tok-s2">&quot;&lt;div style=&#39;color:red&#39; /&gt;&quot;</span><span class="tok-p">);</span>
<span class="tok-c1">// &lt;div style=&#39;color:red&#39;&gt;&lt;p&gt;Párrafo 1&lt;/p&gt;&lt;p&gt;Párrafo 2&lt;/p&gt;...&lt;/div&gt;</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Envuelve el contenido de todos los párrafos con una capa de color rojo</div>
<div class="content">
<pre class="pygments highlight"><code data-lang="javascript"><span class="tok-nx">$</span><span class="tok-p">(</span><span class="tok-s2">&quot;p&quot;</span><span class="tok-p">).</span><span class="tok-nx">wrapInner</span><span class="tok-p">(</span><span class="tok-s2">&quot;&lt;div style=&#39;color:red&#39; /&gt;&quot;</span><span class="tok-p">);</span>
<span class="tok-c1">// &lt;p&gt;&lt;div style=&#39;color:red&#39;&gt;Párrafo 1&lt;/div&gt;&lt;/p&gt;</span>
<span class="tok-c1">// &lt;p&gt;&lt;div style=&#39;color:red&#39;&gt;Párrafo 2&lt;/div&gt;&lt;/p&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Si lo que queremos es sustituir o eliminar contenido, tenemos los siguientes métodos:</p>
</div>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 25%;">
<col style="width: 75%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-center valign-middle">Método</th>
<th class="tableblock halign-left valign-top">Propósito</th>
</tr>
</thead>
<tbody>
<tr>
<th class="tableblock halign-center valign-middle"><p class="tableblock">replaceWith(<em>contenido</em>)</p></th>
<td class="tableblock halign-left valign-top"><p class="tableblock">Sustituye todos los elementos del conjunto de resultados con el <em>contenido</em> especificado, ya sea HTML o un elemento DOM</p></td>
</tr>
<tr>
<th class="tableblock halign-center valign-middle"><p class="tableblock">replaceAll(<em>selector</em>)</p></th>
<td class="tableblock halign-left valign-top"><p class="tableblock">Sustituye los elementos encontrados por el <em>selector</em> con los del conjunto de resultados, es decir, lo contrario a <code>replaceWith</code>.</p></td>
</tr>
<tr>
<th class="tableblock halign-center valign-middle"><p class="tableblock">empty()</p></th>
<td class="tableblock halign-left valign-top"><p class="tableblock">Elimina todos los nodos hijos del conjunto de resultados</p></td>
</tr>
<tr>
<th class="tableblock halign-center valign-middle"><p class="tableblock">remove()</p></th>
<td class="tableblock halign-left valign-top"><p class="tableblock">Elimina todos los elementos del conjunto de resultados del DOM</p></td>
</tr>
<tr>
<th class="tableblock halign-center valign-middle"><p class="tableblock">detach()</p></th>
<td class="tableblock halign-left valign-middle" rowspan="2"><p class="tableblock">Igual que <code>remove()</code> pero devuelve los elementos eliminados. Esto permite volver a insertarlos en otra parte del documento</p></td>
</tr>
<tr>
<th class="tableblock halign-center valign-middle"><p class="tableblock">detach(selector)</p></th>
</tr>
<tr>
<th class="tableblock halign-center valign-middle"><p class="tableblock">unwrap()</p></th>
<td class="tableblock halign-left valign-top"><p class="tableblock">Elimina el padre de cada uno de los elementos del conjunto de resultados, de modo que los elementos se convierten en hijos de sus abuelos.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Vamos a practicar estos métodos con algunos ejemplos:</p>
</div>
<div class="listingblock">
<div class="title">Sustituye los párrafos (y su contenido) por capas</div>
<div class="content">
<pre class="pygments highlight"><code data-lang="javascript"><span class="tok-nx">$</span><span class="tok-p">(</span><span class="tok-s2">&quot;p&quot;</span><span class="tok-p">).</span><span class="tok-nx">replaceWith</span><span class="tok-p">(</span><span class="tok-s2">&quot;&lt;div&gt;Capa Nueva&lt;/div&gt;&quot;</span><span class="tok-p">);</span>
<span class="tok-nx">$</span><span class="tok-p">(</span><span class="tok-s2">&quot;&lt;div&gt;Capa Nueva&lt;/div&gt;&quot;</span><span class="tok-p">).</span><span class="tok-nx">replaceAll</span><span class="tok-p">(</span><span class="tok-s2">&quot;p&quot;</span><span class="tok-p">);</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Vacía la lista desordenada (la etiqueta <code>ul</code> sigue en el documento)</div>
<div class="content">
<pre class="pygments highlight"><code data-lang="javascript"><span class="tok-nx">$</span><span class="tok-p">(</span><span class="tok-s2">&quot;ul&quot;</span><span class="tok-p">).</span><span class="tok-nx">empty</span><span class="tok-p">();</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Elimina la lista desordenada (la etiqueta <code>ul</code> desaparece)</div>
<div class="content">
<pre class="pygments highlight"><code data-lang="javascript"><span class="tok-nx">$</span><span class="tok-p">(</span><span class="tok-s2">&quot;ul&quot;</span><span class="tok-p">).</span><span class="tok-nx">remove</span><span class="tok-p">();</span>
<span class="tok-kd">var</span> <span class="tok-nx">listaBorrada</span> <span class="tok-o">=</span> <span class="tok-nx">$</span><span class="tok-p">(</span><span class="tok-s2">&quot;ul&quot;</span><span class="tok-p">).</span><span class="tok-nx">detach</span><span class="tok-p">();</span></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_trabajando_con_css_2">6.6.6. Trabajando con CSS</h4>
<div class="paragraph">
<p>Los métodos <em>jQuery</em> facilitan el acceso y modificación de las propiedades CSS con código <em>Cross-Browser</em>, además de facilitar la información de posicionamiento y tamaño de los elementos de la página.</p>
</div>
<div class="paragraph">
<p>El método <code>css()</code> permite obtener y asignar <strong>estilos</strong> CSS a un conjunto de elementos modificando el valor del atributo <code>style</code> mediante valores a propiedades CSS:</p>
</div>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 25%;">
<col style="width: 75%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-center valign-middle">Método</th>
<th class="tableblock halign-left valign-top">Propósito</th>
</tr>
</thead>
<tbody>
<tr>
<th class="tableblock halign-center valign-middle"><p class="tableblock">css(<em>nombre</em>)</p></th>
<td class="tableblock halign-left valign-top"><p class="tableblock">Devuelve el valor de la propiedad CSS <em>nombre</em> del primer elemento del conjunto de resultados</p></td>
</tr>
<tr>
<th class="tableblock halign-center valign-middle"><p class="tableblock">css(<em>propiedades</em>)</p></th>
<td class="tableblock halign-left valign-top"><p class="tableblock">Asigna las propiedades de cada elemento del conjunto de resultados mediante la sintaxis de objeto: <code>var cssObj = {'background-color':'blue';'font-weight':'bold'}; $(this).set(cssObj);</code></p></td>
</tr>
<tr>
<th class="tableblock halign-center valign-middle"><p class="tableblock">css(<em>propiedad</em>, <em>valor</em>)</p></th>
<td class="tableblock halign-left valign-top"><p class="tableblock">Asigna un <em>valor</em> a una única <em>propiedad</em> CSS. Si se pasa un número, se convertirá automáticamente a un valor de píxel, a excepción de: <code>z-index</code>, <code>font-weight</code>, <code>opacity</code>, <code>zoom</code> y <code>line-height</code>.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Algunos ejemplos del uso del método <code>css()</code>:</p>
</div>
<div class="listingblock">
<div class="title">Cambia el tamaño de los párrafos</div>
<div class="content">
<pre class="pygments highlight"><code data-lang="javascript"><span class="tok-kd">var</span> <span class="tok-nx">tamAnt</span> <span class="tok-o">=</span> <span class="tok-nx">$</span><span class="tok-p">(</span><span class="tok-s2">&quot;p&quot;</span><span class="tok-p">).</span><span class="tok-nx">css</span><span class="tok-p">(</span><span class="tok-s2">&quot;font-size&quot;</span><span class="tok-p">);</span>
<span class="tok-nx">$</span><span class="tok-p">(</span><span class="tok-s2">&quot;p&quot;</span><span class="tok-p">).</span><span class="tok-nx">css</span><span class="tok-p">(</span><span class="tok-s2">&quot;font-size&quot;</span><span class="tok-p">,</span><span class="tok-s2">&quot;1.5em&quot;</span><span class="tok-p">);</span>
<span class="tok-nx">$</span><span class="tok-p">(</span><span class="tok-s2">&quot;p&quot;</span><span class="tok-p">).</span><span class="tok-nx">css</span><span class="tok-p">(</span><span class="tok-s2">&quot;font-size&quot;</span><span class="tok-p">,</span><span class="tok-s2">&quot;+=5&quot;</span><span class="tok-p">);</span> <span class="tok-c1">// 5 píxeles más</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Cambiar tamaño y color de los párrafos</div>
<div class="content">
<pre class="pygments highlight"><code data-lang="javascript"><span class="tok-kd">var</span> <span class="tok-nx">valoresCSS</span> <span class="tok-o">=</span> <span class="tok-p">{</span>
  <span class="tok-s2">&quot;font-size&quot;</span><span class="tok-o">:</span> <span class="tok-s2">&quot;1.5em&quot;</span><span class="tok-p">,</span>
  <span class="tok-s2">&quot;color&quot;</span><span class="tok-o">:</span> <span class="tok-s2">&quot;blue&quot;</span>
<span class="tok-p">};</span>
<span class="tok-nx">$</span><span class="tok-p">(</span><span class="tok-s2">&quot;p&quot;</span><span class="tok-p">).</span><span class="tok-nx">css</span><span class="tok-p">(</span><span class="tok-s2">&quot;font-size&quot;</span><span class="tok-p">,</span> <span class="tok-nx">valoresCSS</span><span class="tok-p">);</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Además, <em>jQuery</em> también ofrece métodos para trabajar con las <strong>clases</strong> CSS y poder añadir, borrar, detectar o intercambiar sus clases:</p>
</div>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 25%;">
<col style="width: 75%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-center valign-middle">Método</th>
<th class="tableblock halign-left valign-top">Propósito</th>
</tr>
</thead>
<tbody>
<tr>
<th class="tableblock halign-center valign-middle"><p class="tableblock">addClass(<em>clase1</em> [<em>clase2</em>])</p></th>
<td class="tableblock halign-left valign-top"><p class="tableblock">Añade la <em>clase</em> especificada a cada elemento del conjunto de resultados</p></td>
</tr>
<tr>
<th class="tableblock halign-center valign-middle"><p class="tableblock">hasClass(<em>clase</em>)</p></th>
<td class="tableblock halign-left valign-top"><p class="tableblock">Devueve <code>true</code> si está presenta la <em>clase</em> en al menos uno de los elementos del conjunto de resultados</p></td>
</tr>
<tr>
<th class="tableblock halign-center valign-middle"><p class="tableblock">removeClass(<em>clase</em> [<em>clase2</em>])</p></th>
<td class="tableblock halign-left valign-top"><p class="tableblock">Elimina la <em>clase</em> de todos los elementos del conjunto de resultados</p></td>
</tr>
<tr>
<th class="tableblock halign-center valign-middle"><p class="tableblock">toggleClass(<em>clase</em> [<em>clase2</em>])</p></th>
<td class="tableblock halign-left valign-top"><p class="tableblock">Si no está presente, añade la <em>clase</em>. Si está presente, la elimina.</p></td>
</tr>
<tr>
<th class="tableblock halign-center valign-middle"><p class="tableblock">toggleClass(<em>clase</em>, <em>cambio</em>)</p></th>
<td class="tableblock halign-left valign-top"><p class="tableblock">Si <em>cambio</em> es <code>true</code> añade la <em>clase</em>, pero la elimina en el caso de que <em>cambio</em> sea <code>false</code>.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Y algunos ejemplos de la manipulación de clases CSS (<a href="http://jsbin.com/tujuni/3/edit?html,css,js,console,output" class="bare">http://jsbin.com/tujuni/3/edit?html,css,js,console,output</a>):</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="javascript"><span class="tok-nx">$</span><span class="tok-p">(</span><span class="tok-s2">&quot;p&quot;</span><span class="tok-p">).</span><span class="tok-nx">addClass</span><span class="tok-p">(</span><span class="tok-s2">&quot;a&quot;</span><span class="tok-p">);</span>
<span class="tok-nx">$</span><span class="tok-p">(</span><span class="tok-s2">&quot;p:even&quot;</span><span class="tok-p">).</span><span class="tok-nx">removeClass</span><span class="tok-p">(</span><span class="tok-s2">&quot;b&quot;</span><span class="tok-p">).</span><span class="tok-nx">addClass</span><span class="tok-p">(</span><span class="tok-s2">&quot;a&quot;</span><span class="tok-p">);</span>

<span class="tok-nx">console</span><span class="tok-p">.</span><span class="tok-nx">log</span><span class="tok-p">(</span><span class="tok-s2">&quot;En algún elemento:&quot;</span> <span class="tok-o">+</span> <span class="tok-nx">$</span><span class="tok-p">(</span><span class="tok-s2">&quot;p&quot;</span><span class="tok-p">).</span><span class="tok-nx">hasClass</span><span class="tok-p">(</span><span class="tok-s2">&quot;a&quot;</span><span class="tok-p">));</span>
<span class="tok-nx">$</span><span class="tok-p">(</span><span class="tok-s2">&quot;p&quot;</span><span class="tok-p">).</span><span class="tok-nx">each</span><span class="tok-p">(</span><span class="tok-kd">function</span><span class="tok-p">(</span><span class="tok-nx">indice</span><span class="tok-p">,</span> <span class="tok-nx">elem</span><span class="tok-p">)</span> <span class="tok-p">{</span>
  <span class="tok-nx">console</span><span class="tok-p">.</span><span class="tok-nx">log</span><span class="tok-p">(</span><span class="tok-s2">&quot;Elemento: &quot;</span> <span class="tok-o">+</span> <span class="tok-nx">$</span><span class="tok-p">(</span><span class="tok-nx">elem</span><span class="tok-p">).</span><span class="tok-nx">text</span><span class="tok-p">()</span> <span class="tok-o">+</span> <span class="tok-s2">&quot; -&gt; &quot;</span> <span class="tok-o">+</span> <span class="tok-nx">$</span><span class="tok-p">(</span><span class="tok-nx">elem</span><span class="tok-p">).</span><span class="tok-nx">hasClass</span><span class="tok-p">(</span><span class="tok-s2">&quot;a&quot;</span><span class="tok-p">));</span>
<span class="tok-p">});</span>

<span class="tok-nx">$</span><span class="tok-p">(</span><span class="tok-s2">&quot;p&quot;</span><span class="tok-p">).</span><span class="tok-nx">toggleClass</span><span class="tok-p">(</span><span class="tok-s2">&quot;a&quot;</span><span class="tok-p">);</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Respecto al <strong>posicionamiento</strong> CSS, <em>jQuery</em> ofrece métodos que soportan <em>Cross-Browser</em> para averiguar la posición de los elementos:</p>
</div>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 25%;">
<col style="width: 75%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-center valign-middle">Método</th>
<th class="tableblock halign-left valign-top">Propósito</th>
</tr>
</thead>
<tbody>
<tr>
<th class="tableblock halign-center valign-middle"><p class="tableblock">offset()</p></th>
<td class="tableblock halign-left valign-top"><p class="tableblock">Obtiene el desplazamiento actual (en píxeles) del primer elemento del conjunto de resultados, respecto al documento</p></td>
</tr>
<tr>
<th class="tableblock halign-center valign-middle"><p class="tableblock">offsetParent()</p></th>
<td class="tableblock halign-left valign-top"><p class="tableblock">Devuelve una colección <em>jQuery</em> con el padre posicionado del primer elemento del conjunto de resultados</p></td>
</tr>
<tr>
<th class="tableblock halign-center valign-middle"><p class="tableblock">position()</p></th>
<td class="tableblock halign-left valign-top"><p class="tableblock">Obtiene la posiciones superior e izquierda de un elemento relativo al desplazamiento de su padre</p></td>
</tr>
<tr>
<th class="tableblock halign-center valign-middle"><p class="tableblock">scrollTop()</p></th>
<td class="tableblock halign-left valign-top"><p class="tableblock">Obtiene el desplazamiento del scroll superior del primer elemento del conjunto de resultados</p></td>
</tr>
<tr>
<th class="tableblock halign-center valign-middle"><p class="tableblock">scrollTop(<em>valor</em>)</p></th>
<td class="tableblock halign-left valign-top"><p class="tableblock">Asigna el <em>valor</em> del desplazamiento del scroll superior a todos los elementos del conjunto de resultados</p></td>
</tr>
<tr>
<th class="tableblock halign-center valign-middle"><p class="tableblock">scrollLeft()</p></th>
<td class="tableblock halign-left valign-top"><p class="tableblock">Obtiene el desplazamiento del scroll superior del primer elemento del conjunto de resultados</p></td>
</tr>
<tr>
<th class="tableblock halign-center valign-middle"><p class="tableblock">scrollLeft(<em>valor</em>)</p></th>
<td class="tableblock halign-left valign-top"><p class="tableblock">Asigna el <em>valor</em> del desplazamiento del scroll izquierdo a todos los elementos del conjunto de resultados</p></td>
</tr>
</tbody>
</table>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="javascript"><span class="tok-kd">var</span> <span class="tok-nx">pos</span> <span class="tok-o">=</span> <span class="tok-nx">$</span><span class="tok-p">(</span><span class="tok-s2">&quot;img&quot;</span><span class="tok-p">).</span><span class="tok-nx">position</span><span class="tok-p">();</span>
<span class="tok-nx">console</span><span class="tok-p">.</span><span class="tok-nx">log</span><span class="tok-p">(</span><span class="tok-s2">&quot;Arriba:&quot;</span> <span class="tok-o">+</span> <span class="tok-nx">pos</span><span class="tok-p">.</span><span class="tok-nx">top</span> <span class="tok-o">+</span> <span class="tok-s2">&quot; Izq:&quot;</span> <span class="tok-o">+</span> <span class="tok-nx">pos</span><span class="tok-p">.</span><span class="tok-nx">left</span><span class="tok-p">);</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Y finalmente para obtener información <em>Cross-Browser</em> y manipular propiedades específicas relativas al <strong>tamaño</strong> de los elementos:</p>
</div>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 25%;">
<col style="width: 75%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-center valign-middle">Método</th>
<th class="tableblock halign-left valign-top">Propósito</th>
</tr>
</thead>
<tbody>
<tr>
<th class="tableblock halign-center valign-middle"><p class="tableblock">height()</p></th>
<td class="tableblock halign-left valign-top"><p class="tableblock">Obtiene la altura calculada en píxeles del primer elemento del conjunto de resultados</p></td>
</tr>
<tr>
<th class="tableblock halign-center valign-middle"><p class="tableblock">height(<em>valor</em>)</p></th>
<td class="tableblock halign-left valign-top"><p class="tableblock">Asigna la altura CSS para cada elemento del conjunto de resultados</p></td>
</tr>
<tr>
<th class="tableblock halign-center valign-middle"><p class="tableblock">width()</p></th>
<td class="tableblock halign-left valign-top"><p class="tableblock">Obtiene la anchura calculada en píxeles del primer elemento del conjunto de resultados</p></td>
</tr>
<tr>
<th class="tableblock halign-center valign-middle"><p class="tableblock">width(<em>valor</em>)</p></th>
<td class="tableblock halign-left valign-top"><p class="tableblock">Asigna la anchura CSS para cada elemento del conjunto de resultados</p></td>
</tr>
<tr>
<th class="tableblock halign-center valign-middle"><p class="tableblock">innerHeight()</p></th>
<td class="tableblock halign-left valign-top"><p class="tableblock">Obtiene la altura interna (excluye el borde e incluye el <em>padding</em>) para el primer elemento del conjunto de resultados</p></td>
</tr>
<tr>
<th class="tableblock halign-center valign-middle"><p class="tableblock">innerWidth()</p></th>
<td class="tableblock halign-left valign-top"><p class="tableblock">Obtiene la anchura interna (excluye el borde e incluye el <em>padding</em>) para el primer elemento del conjunto de resultados</p></td>
</tr>
<tr>
<th class="tableblock halign-center valign-middle"><p class="tableblock">outerHeight(<em>margen</em>)</p></th>
<td class="tableblock halign-left valign-top"><p class="tableblock">Obtiene la altura externa (incluye el borde y el <em>padding</em>) para el primer elemento del conjunto de resultados. Si el <em>margen</em> es <code>true</code>, también se incluyen los valores del margen.</p></td>
</tr>
<tr>
<th class="tableblock halign-center valign-middle"><p class="tableblock">outerWidth(<em>margen</em>)</p></th>
<td class="tableblock halign-left valign-top"><p class="tableblock">Obtiene la anchura externa (incluye el borde y el <em>padding</em>) para el primer elemento del conjunto de resultados. Si el <em>margen</em> es <code>true</code>, también se incluyen los valores del margen.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Por ejemplo, supongamos que tenemos el siguiente fragmento CSS:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="css"><span class="tok-nt">div</span><span class="tok-nf">#capa</span> <span class="tok-p">{</span>
  <span class="tok-k">width</span><span class="tok-o">:</span> <span class="tok-m">250px</span><span class="tok-p">;</span>
  <span class="tok-k">height</span><span class="tok-o">:</span> <span class="tok-m">180px</span><span class="tok-p">;</span>
  <span class="tok-k">margin</span><span class="tok-o">:</span> <span class="tok-m">10px</span><span class="tok-p">;</span>
  <span class="tok-k">padding</span><span class="tok-o">:</span> <span class="tok-m">20px</span><span class="tok-p">;</span>
  <span class="tok-k">background</span><span class="tok-o">:</span> <span class="tok-nb">blue</span><span class="tok-p">;</span>
  <span class="tok-k">border</span><span class="tok-o">:</span> <span class="tok-m">2px</span> <span class="tok-k">solid</span> <span class="tok-nb">black</span><span class="tok-p">;</span>
  <span class="tok-k">cursor</span><span class="tok-o">:</span> <span class="tok-k">pointer</span><span class="tok-p">;</span>
<span class="tok-p">}</span>
<span class="tok-nt">p</span><span class="tok-o">,</span> <span class="tok-nt">span</span> <span class="tok-p">{</span>
  <span class="tok-k">font-size</span><span class="tok-o">:</span> <span class="tok-m">16pt</span><span class="tok-p">;</span>
<span class="tok-p">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Si en el documento HTML tenemos capas con ids para imprimir el valor de las propiedades mediante este código:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="javascript"><span class="tok-nx">$</span><span class="tok-p">(</span><span class="tok-s2">&quot;#height&quot;</span><span class="tok-p">).</span><span class="tok-nx">html</span><span class="tok-p">(</span><span class="tok-nx">$</span><span class="tok-p">(</span><span class="tok-s2">&quot;#capa&quot;</span><span class="tok-p">).</span><span class="tok-nx">height</span><span class="tok-p">());</span>
<span class="tok-nx">$</span><span class="tok-p">(</span><span class="tok-s2">&quot;#width&quot;</span><span class="tok-p">).</span><span class="tok-nx">html</span><span class="tok-p">(</span><span class="tok-nx">$</span><span class="tok-p">(</span><span class="tok-s2">&quot;#capa&quot;</span><span class="tok-p">).</span><span class="tok-nx">width</span><span class="tok-p">());</span>
<span class="tok-nx">$</span><span class="tok-p">(</span><span class="tok-s2">&quot;#innerH&quot;</span><span class="tok-p">).</span><span class="tok-nx">html</span><span class="tok-p">(</span><span class="tok-nx">$</span><span class="tok-p">(</span><span class="tok-s2">&quot;#capa&quot;</span><span class="tok-p">).</span><span class="tok-nx">innerHeight</span><span class="tok-p">());</span>
<span class="tok-nx">$</span><span class="tok-p">(</span><span class="tok-s2">&quot;#innerW&quot;</span><span class="tok-p">).</span><span class="tok-nx">html</span><span class="tok-p">(</span><span class="tok-nx">$</span><span class="tok-p">(</span><span class="tok-s2">&quot;#capa&quot;</span><span class="tok-p">).</span><span class="tok-nx">innerWidth</span><span class="tok-p">());</span>
<span class="tok-nx">$</span><span class="tok-p">(</span><span class="tok-s2">&quot;#outerH&quot;</span><span class="tok-p">).</span><span class="tok-nx">html</span><span class="tok-p">(</span><span class="tok-nx">$</span><span class="tok-p">(</span><span class="tok-s2">&quot;#capa&quot;</span><span class="tok-p">).</span><span class="tok-nx">outerHeight</span><span class="tok-p">());</span>
<span class="tok-nx">$</span><span class="tok-p">(</span><span class="tok-s2">&quot;#outerW&quot;</span><span class="tok-p">).</span><span class="tok-nx">html</span><span class="tok-p">(</span><span class="tok-nx">$</span><span class="tok-p">(</span><span class="tok-s2">&quot;#capa&quot;</span><span class="tok-p">).</span><span class="tok-nx">outerWidth</span><span class="tok-p">());</span>
<span class="tok-nx">$</span><span class="tok-p">(</span><span class="tok-s2">&quot;#offset&quot;</span><span class="tok-p">).</span><span class="tok-nx">html</span><span class="tok-p">(</span><span class="tok-nx">$</span><span class="tok-p">(</span><span class="tok-s2">&quot;#capa&quot;</span><span class="tok-p">).</span><span class="tok-nx">offset</span><span class="tok-p">().</span><span class="tok-nx">top</span> <span class="tok-o">+</span> <span class="tok-s2">&quot; - &quot;</span> <span class="tok-o">+</span> <span class="tok-nx">$</span><span class="tok-p">(</span><span class="tok-s2">&quot;#capa&quot;</span><span class="tok-p">).</span><span class="tok-nx">offset</span><span class="tok-p">().</span><span class="tok-nx">left</span><span class="tok-p">);</span>
<span class="tok-nx">$</span><span class="tok-p">(</span><span class="tok-s2">&quot;#position&quot;</span><span class="tok-p">).</span><span class="tok-nx">html</span><span class="tok-p">(</span><span class="tok-nx">$</span><span class="tok-p">(</span><span class="tok-s2">&quot;#capa&quot;</span><span class="tok-p">).</span><span class="tok-nx">position</span><span class="tok-p">().</span><span class="tok-nx">top</span> <span class="tok-o">+</span> <span class="tok-s2">&quot; - &quot;</span> <span class="tok-o">+</span> <span class="tok-nx">$</span><span class="tok-p">(</span><span class="tok-s2">&quot;#capa&quot;</span><span class="tok-p">).</span><span class="tok-nx">position</span><span class="tok-p">().</span><span class="tok-nx">left</span><span class="tok-p">);</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Tendríamos un resultado similar a este (<a href="http://jsbin.com/futozu/2/edit?html,css,js,output" class="bare">http://jsbin.com/futozu/2/edit?html,css,js,output</a>):</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/js06/js06PosicionTamanyo.jpg" alt="Posición y Tamaño con jQuery" width="33%">
</div>
<div class="title">Figure 41. Posición y Tamaño con jQuery</div>
</div>
</div>
<div class="sect3">
<h4 id="_asociando_datos_con_elementos">6.6.7. Asociando datos con elementos</h4>
<div class="paragraph">
<p><em>jQuery</em> ofrece el método <code>data()</code> para trabajar con los atributos de datos personalizados que ofrece HTML5, que empiezan por <code>data-</code>, es decir, <code>data-nombre</code>, <code>data-tipo</code>, etc&#8230;&#8203;</p>
</div>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 25%;">
<col style="width: 75%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-center valign-middle">Método</th>
<th class="tableblock halign-left valign-top">Propósito</th>
</tr>
</thead>
<tbody>
<tr>
<th class="tableblock halign-center valign-middle"><p class="tableblock">data(<em>clave</em>)</p></th>
<td class="tableblock halign-left valign-top"><p class="tableblock">Obtiene el atributo <code>data-<em>clave</em></code> del primer elemento del conjunto de resultados</p></td>
</tr>
<tr>
<th class="tableblock halign-center valign-middle"><p class="tableblock">data(<em>clave</em>, <em>valor</em>)</p></th>
<td class="tableblock halign-left valign-top"><p class="tableblock">Almacena el <em>valor</em> en el atributo <code>data-<em>clave</em></code> en cada elemento del conjunto de resultados</p></td>
</tr>
<tr>
<th class="tableblock halign-center valign-middle"><p class="tableblock">removeData()</p></th>
<td class="tableblock halign-left valign-top"><p class="tableblock">Elimina todos los atributos de datos de cada elemento del conjunto de resultados</p></td>
</tr>
<tr>
<th class="tableblock halign-center valign-middle"><p class="tableblock">removeData(<em>clave</em>)</p></th>
<td class="tableblock halign-left valign-top"><p class="tableblock">Elimina el atributo <code>data-<em>clave</em></code> de cada elemento del conjunto de resultados</p></td>
</tr>
</tbody>
</table>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
Es mejor acceder a los elementos por su atributo <code>data</code> que por el texto que contienen sus atributos, ya que éste último puede cambiar debido a la internacionalización (18n) de la aplicación.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Vamos a practicar estos métodos con algunos ejemplos:</p>
</div>
<div class="listingblock">
<div class="title">Asigna el valor a un atributo</div>
<div class="content">
<pre class="pygments highlight"><code data-lang="javascript"><span class="tok-nx">$</span><span class="tok-p">(</span><span class="tok-s2">&quot;#listado&quot;</span><span class="tok-p">).</span><span class="tok-nx">data</span><span class="tok-p">(</span><span class="tok-s2">&quot;tipo&quot;</span><span class="tok-p">,</span><span class="tok-s2">&quot;tutorial&quot;</span><span class="tok-p">);</span>
<span class="tok-nx">$</span><span class="tok-p">(</span><span class="tok-s2">&quot;#listado&quot;</span><span class="tok-p">).</span><span class="tok-nx">data</span><span class="tok-p">(</span><span class="tok-s2">&quot;codigo&quot;</span><span class="tok-p">,</span> <span class="tok-mi">123</span><span class="tok-p">);</span> <i class="conum" data-value="1"></i><b>(1)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Lo que sería similar a <code>&lt;ul id="#listado" data-tipo="tutorial" data-codigo="123"&gt;</code>. Cuidado que estos atributos no se renderizan como atributos del DOM, por lo cual no los podemos inspeccionar mediante las <em>DevTools</em></td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="title">Elimina el valor a un atributo</div>
<div class="content">
<pre class="pygments highlight"><code data-lang="javascript"><span class="tok-nx">$</span><span class="tok-p">(</span><span class="tok-s2">&quot;#listado&quot;</span><span class="tok-p">).</span><span class="tok-nx">removeData</span><span class="tok-p">(</span><span class="tok-s2">&quot;tipo&quot;</span><span class="tok-p">);</span></code></pre>
</div>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
Los atributos de datos almacenados mediante <em>jQuery</em> no se trasladan a atributos del DOM, por lo que no podremos obtenerlos mediante <code>getAttribute()</code>.
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_eventos_4">6.7. Eventos</h3>
<div class="paragraph">
<p>Igual que estudiamos en la sesión de <em>JavaScript</em> vamos a ver como <em>jQuery</em> simplifica, y mucho, el tratamiento de los eventos.</p>
</div>
<div class="paragraph">
<p>Sus principales ventajas son:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>permite asociar un manejador a un grupo de elementos obtenido mediante selectores y filtros.</p>
</li>
<li>
<p>permite conectarse a y desconectarse de los eventos de manera <em>Cross-Browser</em> y dar soporte a IE8 y anteriores.</p>
</li>
<li>
<p>ofrece un objeto de evento que expone la mayoría de las propiedades comunes de manera  <em>Cross-Browser</em>.</p>
</li>
<li>
<p>ofrece funciones que encapsulan las funcionalidades de eventos más comunes y funciones auxiliares con código <em>Cross-Browser</em>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Para empezar veremos el evento que más vamos a utilizar.</p>
</div>
<div class="sect3">
<h4 id="_evento_code_document_ready_code">6.7.1. Evento <code>document.ready</code></h4>
<div class="paragraph">
<p>Del mismo modo que con JavaScript básico, si ponemos un selector <em>jQuery</em> en el encabezado que referencia a elementos DOM que no se han cargado, no va a funcionar. En cambio, si movemos el selector a una posición previa a cerrar el <code>body</code> irá todo correctamente. Para asegurarnos, de manera similar a <code>window.onload</code>, mediante jQuery usaremos el siguiente fragmento:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="javascript"><span class="tok-nx">$</span><span class="tok-p">(</span><span class="tok-nb">document</span><span class="tok-p">).</span><span class="tok-nx">ready</span><span class="tok-p">(</span><span class="tok-kd">function</span><span class="tok-p">()</span> <span class="tok-p">{</span>
  <span class="tok-c1">// código jQuery</span>
<span class="tok-p">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>La ventaja de usar <em>jQuery</em> es que permite usar varias funciones sobre el mismo evento, ya que mediante <code>window.onload</code> sólo se ejecutará la última función que le hayamos asignado.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="javascript"><span class="tok-nx">$</span><span class="tok-p">(</span><span class="tok-nb">document</span><span class="tok-p">).</span><span class="tok-nx">ready</span><span class="tok-p">(</span><span class="tok-kd">function</span><span class="tok-p">()</span> <span class="tok-p">{</span>
  <span class="tok-c1">// código alfa</span>
<span class="tok-p">}</span>

<span class="tok-nx">$</span><span class="tok-p">(</span><span class="tok-nb">document</span><span class="tok-p">).</span><span class="tok-nx">ready</span><span class="tok-p">(</span><span class="tok-kd">function</span><span class="tok-p">()</span> <span class="tok-p">{</span>
  <span class="tok-c1">// código beta</span>
<span class="tok-p">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Además, mientras que con <code>window.onload</code> el evento espera a que haya cargado toda la página, incluidas las imágenes, con <em>jQuery</em> se lanzará cuando haya cargado el DOM, sin tener que esperar a descargar todas las imágenes. Esto se conoce como el evento <code>document.ready</code>.</p>
</div>
<div class="paragraph">
<p>Si queremos poner el mismo código pero de manera simplificada, aunque menos legible, podemos hacerlo del siguiente modo:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="javascript"><span class="tok-nx">$</span><span class="tok-p">(</span><span class="tok-kd">function</span><span class="tok-p">()</span> <span class="tok-p">{</span>
  <span class="tok-c1">// código jQuery</span>
<span class="tok-p">});</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Es decir, cada vez que le pasemos una función a <code>jQuery()</code> o <code>$()</code>, le diremos al navegador que espere hasta que el DOM haya cargado completamente para ejecutar el código.</p>
</div>
</div>
<div class="sect3">
<h4 id="_adjuntando_manejadores_de_eventos">6.7.2. Adjuntando manejadores de eventos</h4>
<div class="paragraph">
<p>Una vez hemos seleccionado el conjunto de elementos al cual queremos asociarle un manejador, usaremos la función <code>on()</code> para indicar que evento capturar y el código del manejador, y <code>off()</code> para eliminar un manejador de eventos.</p>
</div>
<div class="paragraph">
<p>En versiones anteriores de jQuery se usaban los métodos <code>bind()</code>, <code>unbind()</code>, <code>live()</code>, <code>die()</code>, los cuales han sido marcados como métodos <em>deprecated</em> y no veremos en este módulo.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
Antes de <em>jQuery 1.7</em>, en vez de <code>on()</code>, se usaba <code>bind()</code> con <em>jQuery</em> 1.0, <code>live()</code> con la versión 1.3 y <code>delegate()</code> a partir de la versión 1.4.2
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Así pues, mediante <code>on(eventos [,selector] [,datos] ,manejador(objetoEvento))</code> capturaremos los eventos. Más información en <a href="http://api.jquery.com/on" class="bare">http://api.jquery.com/on</a> . En su versión más simple la usaremos del siguiente modo:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="javascript"><span class="tok-nx">$</span><span class="tok-p">(</span><span class="tok-nx">selector</span><span class="tok-p">).</span><span class="tok-nx">on</span><span class="tok-p">(</span><span class="tok-s2">&quot;nombreDelEvento&quot;</span><span class="tok-p">,</span> <span class="tok-kd">function</span><span class="tok-p">()</span> <span class="tok-p">{</span>
  <span class="tok-c1">// código del manejador</span>
<span class="tok-p">})</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Por ejemplo, si queremos capturar cuando se hace click sobre un párrafo:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="javascript"><span class="tok-nx">$</span><span class="tok-p">(</span><span class="tok-s2">&quot;p&quot;</span><span class="tok-p">).</span><span class="tok-nx">on</span><span class="tok-p">(</span><span class="tok-s2">&quot;click&quot;</span><span class="tok-p">,</span> <span class="tok-kd">function</span><span class="tok-p">()</span> <span class="tok-p">{</span>
  <span class="tok-nx">console</span><span class="tok-p">.</span><span class="tok-nx">log</span><span class="tok-p">(</span><span class="tok-s2">&quot;Click sobre un párrafo&quot;</span><span class="tok-p">);</span>
<span class="tok-p">})</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Si queremos capturar más de un evento, hemos de separar el nombre de los eventos con espacio:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="javascript"><span class="tok-nx">$</span><span class="tok-p">(</span><span class="tok-s2">&quot;p&quot;</span><span class="tok-p">).</span><span class="tok-nx">on</span><span class="tok-p">(</span><span class="tok-s2">&quot;click mouseenter&quot;</span><span class="tok-p">,</span> <span class="tok-kd">function</span><span class="tok-p">()</span> <span class="tok-p">{</span>
  <span class="tok-nx">console</span><span class="tok-p">.</span><span class="tok-nx">log</span><span class="tok-p">(</span><span class="tok-s2">&quot;Click o mouseenter sobre un párrafo&quot;</span><span class="tok-p">);</span>
<span class="tok-p">})</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Cuando aplicamos el evento <code>on</code>, en vez de seleccionar todos los elementos de un tipo que hay en DOM, es mejor elegir el padre del que estamos interesado y luego filtrar dentro del método. Por ejemplo, en vez de:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="javascript"><span class="tok-nx">$</span><span class="tok-p">(</span><span class="tok-s2">&quot;dt&quot;</span><span class="tok-p">).</span><span class="tok-nx">on</span><span class="tok-p">(</span><span class="tok-s2">&quot;mouseenter&quot;</span><span class="tok-p">,</span> <span class="tok-kd">function</span><span class="tok-p">()</span> <span class="tok-p">{</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>es más eficiente hacer</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="javascript"><span class="tok-nx">$</span><span class="tok-p">(</span><span class="tok-s2">&quot;dl&quot;</span><span class="tok-p">).</span><span class="tok-nx">on</span><span class="tok-p">(</span><span class="tok-s2">&quot;mouseenter&quot;</span><span class="tok-p">,</span><span class="tok-s2">&quot;dt&quot;</span><span class="tok-p">,</span><span class="tok-kd">function</span><span class="tok-p">()</span> <span class="tok-p">{</span></code></pre>
</div>
</div>
<div class="sect4">
<h5 id="_ejemplo_eventos">Ejemplo eventos</h5>
<div class="paragraph">
<p>Vamos a realizar un ejemplo para ver a <em>jQuery</em> en acción. Vamos a cambiar los estilos de una caja cuando el ratón pase por encima del mismo. Si hacemos click sobre la caja, eliminaremos el evento.</p>
</div>
<div class="paragraph">
<p>Así pues, primero dibujemos la caja:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="html"><span class="tok-cp">&lt;!DOCTYPE html&gt;</span>
<span class="tok-nt">&lt;html</span> <span class="tok-na">lang=</span><span class="tok-s">&quot;es&quot;</span><span class="tok-nt">&gt;</span>
<span class="tok-nt">&lt;head&gt;</span>
  <span class="tok-nt">&lt;meta</span> <span class="tok-na">charset=</span><span class="tok-s">&quot;UTF-8&quot;</span><span class="tok-nt">&gt;</span>
  <span class="tok-nt">&lt;style </span><span class="tok-na">type=</span><span class="tok-s">&quot;text/css&quot;</span><span class="tok-nt">&gt;</span>
    <span class="tok-nc">.normal</span> <span class="tok-p">{</span>
      <span class="tok-k">width</span><span class="tok-o">:</span><span class="tok-m">300px</span><span class="tok-p">;</span> <span class="tok-k">height</span><span class="tok-o">:</span><span class="tok-m">200px</span><span class="tok-p">;</span> <span class="tok-k">background-color</span><span class="tok-o">:</span><span class="tok-nb">yellow</span><span class="tok-p">;</span> <span class="tok-k">font-size</span><span class="tok-o">:</span><span class="tok-m">18pt</span><span class="tok-p">;</span>
    <span class="tok-p">}</span>
    <span class="tok-nc">.resaltado</span> <span class="tok-p">{</span>
      <span class="tok-k">background-color</span><span class="tok-o">:</span><span class="tok-nb">red</span><span class="tok-p">;</span>
    <span class="tok-p">}</span>
  <span class="tok-nt">&lt;/style&gt;</span>
<span class="tok-nt">&lt;/head&gt;</span>
<span class="tok-nt">&lt;body&gt;</span>
<span class="tok-nt">&lt;h1&gt;</span>Eventos con jQuery<span class="tok-nt">&lt;/h1&gt;</span>
<span class="tok-nt">&lt;div</span> <span class="tok-na">id=</span><span class="tok-s">&quot;destinoEvento&quot;</span> <span class="tok-na">class=</span><span class="tok-s">&quot;normal&quot;</span><span class="tok-nt">&gt;</span>Pasar el ratón para ver el efecto. Click para quitar/añadir el manejador.<span class="tok-nt">&lt;/div&gt;</span>
<span class="tok-nt">&lt;/body&gt;</span>
<span class="tok-nt">&lt;/html&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>A continuación, el código <em>JavaScript</em> para capturar y manejar los eventos:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="javascript"><span class="tok-nx">$</span><span class="tok-p">(</span><span class="tok-nb">document</span><span class="tok-p">).</span><span class="tok-nx">ready</span><span class="tok-p">(</span><span class="tok-kd">function</span><span class="tok-p">()</span> <span class="tok-p">{</span>
  <span class="tok-kd">var</span> <span class="tok-nx">dest</span> <span class="tok-o">=</span> <span class="tok-nx">$</span><span class="tok-p">(</span><span class="tok-s2">&quot;#destinoEvento&quot;</span><span class="tok-p">);</span>	<i class="conum" data-value="1"></i><b>(1)</b>
  <span class="tok-nx">dest</span><span class="tok-p">.</span><span class="tok-nx">on</span><span class="tok-p">(</span><span class="tok-s2">&quot;mouseover mouseleave&quot;</span><span class="tok-p">,</span> <span class="tok-kd">function</span><span class="tok-p">(</span><span class="tok-nx">evt</span><span class="tok-p">)</span> <span class="tok-p">{</span>	<i class="conum" data-value="2"></i><b>(2)</b>
    <span class="tok-nx">dest</span><span class="tok-p">.</span><span class="tok-nx">toggleClass</span><span class="tok-p">(</span><span class="tok-s2">&quot;resaltado&quot;</span><span class="tok-p">);</span>
  <span class="tok-p">});</span>
  <span class="tok-nx">dest</span><span class="tok-p">.</span><span class="tok-nx">on</span><span class="tok-p">(</span><span class="tok-s2">&quot;click&quot;</span><span class="tok-p">,</span> <span class="tok-kd">function</span><span class="tok-p">(</span><span class="tok-nx">evt</span><span class="tok-p">)</span> <span class="tok-p">{</span>
    <span class="tok-nx">dest</span><span class="tok-p">.</span><span class="tok-nx">off</span><span class="tok-p">(</span><span class="tok-s2">&quot;mouseover mouseleave&quot;</span><span class="tok-p">);</span>	<i class="conum" data-value="3"></i><b>(3)</b>
    <span class="tok-nx">$</span><span class="tok-p">(</span><span class="tok-s2">&quot;#destinoEvento&quot;</span><span class="tok-p">).</span><span class="tok-nx">text</span><span class="tok-p">(</span><span class="tok-s2">&quot;Manejadores eliminados&quot;</span><span class="tok-p">);</span>
  <span class="tok-p">});</span>
<span class="tok-p">});</span></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Guardamos el destino del enlace en una variable para evitar repetir la búsqueda</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Capturamos los eventos de <code>mouseover</code> y <code>mouseleave</code> sobre la caja y le cambiamos la clase del estilo dentro del manejador</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Dentro de la captura del evento <code>click</code>, eliminamos los manejadores de los eventos <code>mouseover</code> y <code>mouseleave</code> e informamos al usuario del cambio. Si el destino tuviese más manejadores sobre estos eventos, también se eliminarían.</td>
</tr>
</table>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<code>.on()</code> sólo puede crear manejadores de eventos sobre elementos que ya existen en el momento de asignación del <em>listener</em>. Los elementos similares creados tras asignar los manejadores no capturarán los eventos configurados con anterioridad.
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_métodos_auxiliares">6.7.3. Métodos auxiliares</h4>
<div class="paragraph">
<p><em>jQuery</em> ofrece un conjunto de métodos auxiliares para simplificar su uso con los eventos más utilizados. Si los ordenamos por su categoría tenemos:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Ratón: <code>click()</code>, <code>dblclick()</code>, <code>focusout()</code>, <code>hover()</code>, <code>mousedown()</code>, <code>mouseenter()</code>, <code>mouseleave()</code>, <code>mousemove()</code>, <code>mouseout()</code>, <code>mouseover()</code>, <code>mouseup()</code>.</p>
</li>
<li>
<p>Teclado: <code>focusout(), keydown()</code>, <code>keypress()</code>, <code>keyup()</code>.</p>
</li>
<li>
<p>Formulario: <code>blur()</code>, <code>change()</code>, <code>focus()</code>, <code>focusin()</code>, <code>select()</code>, <code>submit()</code>.</p>
</li>
<li>
<p>Navegador: <code>error()</code>, <code>resize()</code>, <code>scroll()</code>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Es decir, las dos acciones siguientes son semejantes:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="javascript"><span class="tok-nx">$</span><span class="tok-p">(</span><span class="tok-s2">&quot;p&quot;</span><span class="tok-p">).</span><span class="tok-nx">click</span><span class="tok-p">(</span><span class="tok-kd">function</span><span class="tok-p">()</span> <span class="tok-p">{</span>
  <span class="tok-c1">// Manejador</span>
<span class="tok-p">});</span>

<span class="tok-nx">$</span><span class="tok-p">(</span><span class="tok-s2">&quot;p&quot;</span><span class="tok-p">).</span><span class="tok-nx">on</span><span class="tok-p">(</span><span class="tok-s2">&quot;click&quot;</span><span class="tok-p">,</span> <span class="tok-kd">function</span><span class="tok-p">()</span> <span class="tok-p">{</span>
  <span class="tok-c1">// Manejador</span>
<span class="tok-p">});</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Un caso particular que conviene estudiar es el método <code>hover()</code>, el cual acepta dos manejadores, los cuales se ejecutarán cuando el ratón entre y salga del elemento respectivamente:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="javascript"><span class="tok-nx">$</span><span class="tok-p">(</span><span class="tok-kd">function</span><span class="tok-p">()</span> <span class="tok-p">{</span>
  <span class="tok-nx">$</span><span class="tok-p">(</span><span class="tok-s2">&quot;#destino&quot;</span><span class="tok-p">).</span><span class="tok-nx">hover</span><span class="tok-p">(</span><span class="tok-nx">resaltar</span><span class="tok-p">,</span> <span class="tok-nx">resaltar</span><span class="tok-p">);</span>

  <span class="tok-nx">$</span><span class="tok-p">(</span><span class="tok-s2">&quot;#destino&quot;</span><span class="tok-p">).</span><span class="tok-nx">click</span><span class="tok-p">(</span><span class="tok-nx">fnClick1</span><span class="tok-p">);</span>
  <span class="tok-nx">$</span><span class="tok-p">(</span><span class="tok-s2">&quot;#destino&quot;</span><span class="tok-p">).</span><span class="tok-nx">dblclick</span><span class="tok-p">(</span><span class="tok-nx">fnClick2</span><span class="tok-p">);</span>
<span class="tok-p">});</span>

<span class="tok-kd">function</span> <span class="tok-nx">resaltar</span><span class="tok-p">(</span><span class="tok-nx">evt</span><span class="tok-p">)</span> <span class="tok-p">{</span>
  <span class="tok-nx">$</span><span class="tok-p">(</span><span class="tok-s2">&quot;#destino&quot;</span><span class="tok-p">).</span><span class="tok-nx">toggleClass</span><span class="tok-p">(</span><span class="tok-s2">&quot;resaltado&quot;</span><span class="tok-p">);</span>
<span class="tok-p">}</span>
<span class="tok-kd">function</span> <span class="tok-nx">fnClick1</span><span class="tok-p">()</span> <span class="tok-p">{</span>
  <span class="tok-nx">$</span><span class="tok-p">(</span><span class="tok-s2">&quot;#destino&quot;</span><span class="tok-p">).</span><span class="tok-nx">html</span><span class="tok-p">(</span><span class="tok-s2">&quot;Click!&quot;</span><span class="tok-p">);</span>
<span class="tok-p">}</span>
<span class="tok-kd">function</span> <span class="tok-nx">fnClick2</span><span class="tok-p">()</span> <span class="tok-p">{</span>
  <span class="tok-nx">$</span><span class="tok-p">(</span><span class="tok-s2">&quot;#destino&quot;</span><span class="tok-p">).</span><span class="tok-nx">html</span><span class="tok-p">(</span><span class="tok-s2">&quot;Doble Click!&quot;</span><span class="tok-p">);</span>
<span class="tok-p">}</span></code></pre>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
Recordad que el método <code>clone()</code> clona el contenido seleccionado, pero sin copiar sus eventos. Para ello, hay que pasarle como parámetro <code>true</code>, para que clones los eventos del selector
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>También podemos usar los siguientes métodos para realizar tareas específicas:</p>
</div>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 25%;">
<col style="width: 75%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-center valign-middle">Método</th>
<th class="tableblock halign-left valign-top">Propósito</th>
</tr>
</thead>
<tbody>
<tr>
<th class="tableblock halign-center valign-middle"><p class="tableblock">one(<em>tipo</em>, <em>datos</em>, <em>manejador</em>)</p></th>
<td class="tableblock halign-left valign-top"><p class="tableblock">Permite capturar el evento <em>tipo</em> una sola vez para cada elemento del conjunto de resultado</p></td>
</tr>
<tr>
<th class="tableblock halign-center valign-middle"><p class="tableblock">trigger(<em>evento</em>, <em>datos</em>)</p></th>
<td class="tableblock halign-left valign-top"><p class="tableblock">Lanza un evento para cada elemento del conjunto de resultados, lo que también provoca que se ejecute la acción predeterminada por el navegador. Por ejemplo, si le pasamos un <em>evento</em> <code>click</code>, el navegador actuará como si se hubiese <em>clickado</em> dicho elemento.</p></td>
</tr>
<tr>
<th class="tableblock halign-center valign-middle"><p class="tableblock">triggerHandler(<em>evento</em>, <em>datos</em>)</p></th>
<td class="tableblock halign-left valign-top"><p class="tableblock">Dispara todos los manejadores asociados al <em>evento</em> sin ejecutar la acción predeterminada o burbujero del navegador. Sólo funciona para el primer elemento del conjunto de resultados del selector</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Por ejemplo, supongamos que tenemos varios cuadrados y queremos que cambien su color una sola vez:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="html"><span class="tok-cp">&lt;!DOCTYPE html&gt;</span>
<span class="tok-nt">&lt;html</span> <span class="tok-na">lang=</span><span class="tok-s">&quot;es&quot;</span><span class="tok-nt">&gt;</span>
<span class="tok-nt">&lt;head&gt;</span>
  <span class="tok-nt">&lt;title&gt;</span>Usando el objeto jQuery Event<span class="tok-nt">&lt;/title&gt;</span>
  <span class="tok-nt">&lt;meta</span> <span class="tok-na">charset=</span><span class="tok-s">&quot;UTF-8&quot;</span><span class="tok-nt">&gt;</span>
  <span class="tok-nt">&lt;style </span><span class="tok-na">type=</span><span class="tok-s">&quot;text/css&quot;</span><span class="tok-nt">&gt;</span>
    <span class="tok-nt">div</span> <span class="tok-p">{</span>
      <span class="tok-k">width</span><span class="tok-o">:</span> <span class="tok-m">60px</span><span class="tok-p">;</span> <span class="tok-k">height</span><span class="tok-o">:</span> <span class="tok-m">60px</span><span class="tok-p">;</span> <span class="tok-k">margin</span><span class="tok-o">:</span> <span class="tok-m">10px</span><span class="tok-p">;</span> <span class="tok-k">float</span><span class="tok-o">:</span> <span class="tok-k">left</span><span class="tok-p">;</span>
      <span class="tok-k">background</span><span class="tok-o">:</span> <span class="tok-nb">blue</span><span class="tok-p">;</span> <span class="tok-k">border</span><span class="tok-o">:</span> <span class="tok-m">2px</span> <span class="tok-k">solid</span> <span class="tok-nb">black</span><span class="tok-p">;</span> <span class="tok-k">cursor</span><span class="tok-o">:</span> <span class="tok-k">pointer</span><span class="tok-p">;</span>
    <span class="tok-p">}</span>
    <span class="tok-nt">p</span> <span class="tok-p">{</span>
      <span class="tok-k">font-size</span><span class="tok-o">:</span> <span class="tok-m">18pt</span><span class="tok-p">;</span>
    <span class="tok-p">}</span>
  <span class="tok-nt">&lt;/style&gt;</span>
<span class="tok-nt">&lt;/head&gt;</span>
<span class="tok-nt">&lt;body&gt;</span>
  <span class="tok-nt">&lt;p&gt;</span>Click en cualquier cuadrado para cambiar su color<span class="tok-nt">&lt;/p&gt;</span>
  <span class="tok-nt">&lt;div&gt;&lt;/div&gt;</span>
  <span class="tok-nt">&lt;div&gt;&lt;/div&gt;</span>
  <span class="tok-nt">&lt;div&gt;&lt;/div&gt;</span>
  <span class="tok-nt">&lt;div&gt;&lt;/div&gt;</span>
<span class="tok-nt">&lt;/body&gt;</span>
<span class="tok-nt">&lt;/html&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Y el código para cambiar el color una sola vez al hacer <em>click</em>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="javascript"><span class="tok-nx">$</span><span class="tok-p">(</span><span class="tok-kd">function</span><span class="tok-p">()</span> <span class="tok-p">{</span>
  <span class="tok-nx">$</span><span class="tok-p">(</span><span class="tok-s2">&quot;div&quot;</span><span class="tok-p">).</span><span class="tok-nx">one</span><span class="tok-p">(</span><span class="tok-s2">&quot;click&quot;</span><span class="tok-p">,</span> <span class="tok-kd">function</span><span class="tok-p">(</span><span class="tok-nx">evt</span><span class="tok-p">)</span> <span class="tok-p">{</span>
    <span class="tok-nx">$</span><span class="tok-p">(</span><span class="tok-k">this</span><span class="tok-p">).</span><span class="tok-nx">css</span><span class="tok-p">({</span>
      <span class="tok-nx">background</span><span class="tok-o">:</span> <span class="tok-s2">&quot;red&quot;</span><span class="tok-p">,</span> <span class="tok-nx">cursor</span><span class="tok-o">:</span> <span class="tok-s2">&quot;auto&quot;</span>
    <span class="tok-p">});</span>
    <span class="tok-nx">console</span><span class="tok-p">.</span><span class="tok-nx">log</span><span class="tok-p">(</span><span class="tok-s2">&quot;Evento &quot;</span> <span class="tok-o">+</span> <span class="tok-nx">evt</span><span class="tok-p">.</span><span class="tok-nx">type</span> <span class="tok-o">+</span> <span class="tok-s2">&quot; en div &quot;</span> <span class="tok-o">+</span> <span class="tok-nx">$</span><span class="tok-p">(</span><span class="tok-k">this</span><span class="tok-p">).</span><span class="tok-nx">attr</span><span class="tok-p">(</span><span class="tok-s2">&quot;id&quot;</span><span class="tok-p">));</span>
  <span class="tok-p">});</span>
<span class="tok-p">});</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Si hacemos click más de una ocasión sobre un mismo cuadrado podemos comprobar como no sale por consola.</p>
</div>
</div>
<div class="sect3">
<h4 id="_objeto_em_jquery_em_code_event_code">6.7.4. Objeto <em>jQuery</em> <code>Event</code></h4>
<div class="paragraph">
<p>Para poder trabajar con manejadores de eventos <em>Cross-Browser</em>, es importante que exista un único objeto que permite acceder a las propiedades más importantes:</p>
</div>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 25%;">
<col style="width: 75%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-center valign-middle">Propiedad / Método</th>
<th class="tableblock halign-left valign-top">Propósito</th>
</tr>
</thead>
<tbody>
<tr>
<th class="tableblock halign-center valign-middle"><p class="tableblock">type</p></th>
<td class="tableblock halign-left valign-top"><p class="tableblock">Tipo del evento, por ejemplo, <code>click</code></p></td>
</tr>
<tr>
<th class="tableblock halign-center valign-middle"><p class="tableblock">target</p></th>
<td class="tableblock halign-left valign-top"><p class="tableblock">Elemento que lanzó el evento</p></td>
</tr>
<tr>
<th class="tableblock halign-center valign-middle"><p class="tableblock">data</p></th>
<td class="tableblock halign-left valign-top"><p class="tableblock">Datos pasados al manejador</p></td>
</tr>
<tr>
<th class="tableblock halign-center valign-middle"><p class="tableblock">pageX, pageY</p></th>
<td class="tableblock halign-left valign-top"><p class="tableblock">Coordenadas relativas al documento del ratón en el momento de lanzarse el evento</p></td>
</tr>
<tr>
<th class="tableblock halign-center valign-middle"><p class="tableblock">result</p></th>
<td class="tableblock halign-left valign-top"><p class="tableblock">Valor devuelto por el último manejador</p></td>
</tr>
<tr>
<th class="tableblock halign-center valign-middle"><p class="tableblock">timestamp</p></th>
<td class="tableblock halign-left valign-top"><p class="tableblock">Tiempo en el que se lanzó el evento</p></td>
</tr>
<tr>
<th class="tableblock halign-center valign-middle"><p class="tableblock">preventDefault()</p></th>
<td class="tableblock halign-left valign-top"><p class="tableblock">Previene el comportamiento por defecto del navegador</p></td>
</tr>
<tr>
<th class="tableblock halign-center valign-middle"><p class="tableblock">idDefaultPrevented()</p></th>
<td class="tableblock halign-left valign-top"><p class="tableblock">Averigua si se ha detenido el comportamiento por defecto</p></td>
</tr>
<tr>
<th class="tableblock halign-center valign-middle"><p class="tableblock">stopPropagation()</p></th>
<td class="tableblock halign-left valign-top"><p class="tableblock">Detiene el burbujeo del evento hacia los elementos superiores</p></td>
</tr>
<tr>
<th class="tableblock halign-center valign-middle"><p class="tableblock">isPropagationStopped()</p></th>
<td class="tableblock halign-left valign-top"><p class="tableblock">Averigua si se ha detenido el burbujeo del evento</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Este objeto se obtiene como parámetro de la función manejadora del evento. Para mostrar estas propiedades en acción, vamos a basarnos en el siguiente código donde podemos ver tres capas:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="html"><span class="tok-cp">&lt;!DOCTYPE html&gt;</span>
<span class="tok-nt">&lt;html</span> <span class="tok-na">lang=</span><span class="tok-s">&quot;es&quot;</span><span class="tok-nt">&gt;</span>
<span class="tok-nt">&lt;head&gt;</span>
	<span class="tok-nt">&lt;title&gt;</span>Usando el objeto jQuery Event<span class="tok-nt">&lt;/title&gt;</span>
	<span class="tok-nt">&lt;meta</span> <span class="tok-na">charset=</span><span class="tok-s">&quot;UTF-8&quot;</span><span class="tok-nt">&gt;</span>
	<span class="tok-nt">&lt;style </span><span class="tok-na">type=</span><span class="tok-s">&quot;text/css&quot;</span><span class="tok-nt">&gt;</span>
	<span class="tok-nc">.normal</span> <span class="tok-p">{</span>
		<span class="tok-k">width</span><span class="tok-o">:</span><span class="tok-m">300px</span><span class="tok-p">;</span> <span class="tok-k">height</span><span class="tok-o">:</span><span class="tok-m">200px</span><span class="tok-p">;</span> <span class="tok-k">background-color</span><span class="tok-o">:</span> <span class="tok-nb">silver</span><span class="tok-p">;</span>
		<span class="tok-k">font-size</span><span class="tok-o">:</span><span class="tok-m">18pt</span><span class="tok-p">;</span> <span class="tok-k">margin</span><span class="tok-o">:</span><span class="tok-m">5pt</span> <span class="tok-m">5pt</span> <span class="tok-m">5pt</span> <span class="tok-m">5pt</span><span class="tok-p">;</span>
	<span class="tok-p">}</span>
	<span class="tok-nt">&lt;/style&gt;</span>
<span class="tok-nt">&lt;/head&gt;</span>
<span class="tok-nt">&lt;body&gt;</span>
<span class="tok-nt">&lt;h1&gt;</span>Usando el objeto jQuery Event<span class="tok-nt">&lt;/h1&gt;</span>
<span class="tok-nt">&lt;div</span> <span class="tok-na">id=</span><span class="tok-s">&quot;div1&quot;</span> <span class="tok-na">class=</span><span class="tok-s">&quot;normal&quot;</span><span class="tok-nt">&gt;</span>Click en esta capa (div1) para ver la información del evento<span class="tok-nt">&lt;/div&gt;</span>
<span class="tok-nt">&lt;div</span> <span class="tok-na">id=</span><span class="tok-s">&quot;div2&quot;</span> <span class="tok-na">class=</span><span class="tok-s">&quot;normal&quot;</span><span class="tok-nt">&gt;</span>Click en esta capa (div2) para ver la información del evento<span class="tok-nt">&lt;/div&gt;</span>
<span class="tok-nt">&lt;/body&gt;</span>
<span class="tok-nt">&lt;/html&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Y el código para mostrar la información:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="javascript"><span class="tok-nx">$</span><span class="tok-p">(</span><span class="tok-kd">function</span><span class="tok-p">()</span> <span class="tok-p">{</span>
  <span class="tok-nx">$</span><span class="tok-p">(</span><span class="tok-s2">&quot;div&quot;</span><span class="tok-p">).</span><span class="tok-nx">click</span><span class="tok-p">(</span><span class="tok-kd">function</span><span class="tok-p">(</span><span class="tok-nx">evt</span><span class="tok-p">)</span> <span class="tok-p">{</span>
      <span class="tok-nx">$</span><span class="tok-p">(</span><span class="tok-k">this</span><span class="tok-p">).</span><span class="tok-nx">html</span><span class="tok-p">(</span><span class="tok-s2">&quot;pageX: &quot;</span> <span class="tok-o">+</span> <span class="tok-nx">evt</span><span class="tok-p">.</span><span class="tok-nx">pageX</span> <span class="tok-o">+</span> <span class="tok-s2">&quot;, pageY: &quot;</span> <span class="tok-o">+</span> <span class="tok-nx">evt</span><span class="tok-p">.</span><span class="tok-nx">pageY</span> <span class="tok-o">+</span> <span class="tok-s2">&quot;, tipo: &quot;</span> <span class="tok-o">+</span> <span class="tok-nx">evt</span><span class="tok-p">.</span><span class="tok-nx">type</span> <span class="tok-o">+</span> <span class="tok-s2">&quot;, target: &quot;</span> <span class="tok-o">+</span> <span class="tok-nx">evt</span><span class="tok-p">.</span><span class="tok-nx">target</span><span class="tok-p">);</span>
  <span class="tok-p">});</span>
<span class="tok-p">});</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Al pulsar encima de las capas, se mostrará la información de coordenadas relativas, tipo y <em>target</em> del evento:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/js06/js06ObjetojQueryEvent.jpg" alt="Ejemplo de uso del objeto jQuery Event" width="33%">
</div>
<div class="title">Figure 42. Ejemplo de uso del objeto jQuery Event</div>
</div>
</div>
<div class="sect3">
<h4 id="_eventos_personalizados">6.7.5. Eventos personalizados</h4>
<div class="paragraph">
<p>Sabemos que una vez seleccionado un elemento, mediante el método <code>on</code> podemos capturar el evento y controlar el código del manejador mediante una función anónima.</p>
</div>
<div class="paragraph">
<p>Ya hemos visto que si queremos lanzar un evento de manera programativa, sin que lo haga el usuario, podemos usar el método <code>trigger(evento,datos)</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="javascript"><span class="tok-nx">$</span><span class="tok-p">(</span><span class="tok-s1">&#39;body&#39;</span><span class="tok-p">).</span><span class="tok-nx">trigger</span><span class="tok-p">(</span><span class="tok-s1">&#39;click&#39;</span><span class="tok-p">);</span>	<span class="tok-c1">// lanza el evento _click_ sobre el _body_</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>De este modo, podemos crear eventos personalizados para posteriormente capturarlos:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="javascript"><span class="tok-nx">$</span><span class="tok-p">(</span><span class="tok-s1">&#39;body&#39;</span><span class="tok-p">).</span><span class="tok-nx">on</span><span class="tok-p">(</span><span class="tok-s1">&#39;batClick&#39;</span><span class="tok-p">,</span> <span class="tok-kd">function</span><span class="tok-p">()</span> <span class="tok-p">{</span>
  <span class="tok-nx">console</span><span class="tok-p">.</span><span class="tok-nx">log</span><span class="tok-p">(</span><span class="tok-s2">&quot;Capturado el evento personalizado batClick&quot;</span><span class="tok-p">);</span>
<span class="tok-p">});</span>
<span class="tok-nx">$</span><span class="tok-p">(</span><span class="tok-s1">&#39;body&#39;</span><span class="tok-p">).</span><span class="tok-nx">trigger</span><span class="tok-p">(</span><span class="tok-s1">&#39;batClick&#39;</span><span class="tok-p">);</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Veamos un ejemplo práctico. Supongamos que accedemos a un servicio REST que devuelve JSON como el de <em>OMDB</em> visto en la sesión anterior:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="javascript"><span class="tok-kd">var</span> <span class="tok-nx">datos</span><span class="tok-p">;</span>

<span class="tok-nx">$</span><span class="tok-p">.</span><span class="tok-nx">getJSON</span><span class="tok-p">(</span><span class="tok-s1">&#39;http://www.omdbapi.com/?s=batman&amp;callback=?&#39;</span><span class="tok-p">,</span> <span class="tok-kd">function</span><span class="tok-p">(</span><span class="tok-nx">resultado</span><span class="tok-p">)</span> <span class="tok-p">{</span>
  <span class="tok-nx">datos</span> <span class="tok-o">=</span> <span class="tok-nx">resultado</span><span class="tok-p">;</span>
<span class="tok-p">});</span>

<span class="tok-nx">console</span><span class="tok-p">.</span><span class="tok-nx">log</span><span class="tok-p">(</span><span class="tok-nx">datos</span><span class="tok-p">);</span>	<span class="tok-c1">// undefined</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Tal como vimos, se trata de una llamada asíncrona de modo que cuando mostramos los datos recibidos no obtenemos nada porque realmente la llamada AJAX todavía no ha finalizado.</p>
</div>
<div class="paragraph">
<p>Para poder controlar cuando se han cargado los datos podemos lanzar un evento personalizado de modo que al capturarlo estaremos seguro que la petición ha finalizado.</p>
</div>
<div class="paragraph">
<p>Ejemplo modelo publicador/subscriptor - <a href="http://jsbin.com/pisihe/edit?html,js,console,output" class="bare">http://jsbin.com/pisihe/edit?html,js,console,output</a></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="javascript"><span class="tok-nx">$</span><span class="tok-p">.</span><span class="tok-nx">getJSON</span><span class="tok-p">(</span><span class="tok-s1">&#39;http://www.omdbapi.com/?s=batman&amp;callback=?&#39;</span><span class="tok-p">,</span> <span class="tok-kd">function</span><span class="tok-p">(</span><span class="tok-nx">datos</span><span class="tok-p">)</span> <span class="tok-p">{</span>
  <span class="tok-nx">$</span><span class="tok-p">(</span><span class="tok-nb">document</span><span class="tok-p">).</span><span class="tok-nx">trigger</span><span class="tok-p">(</span><span class="tok-s1">&#39;obd/datos&#39;</span><span class="tok-p">,</span> <span class="tok-nx">datos</span><span class="tok-p">);</span>	<span class="tok-c1">// publicador</span>
<span class="tok-p">});</span>

<span class="tok-nx">$</span><span class="tok-p">(</span><span class="tok-nb">document</span><span class="tok-p">).</span><span class="tok-nx">on</span><span class="tok-p">(</span><span class="tok-s1">&#39;obd/datos&#39;</span><span class="tok-p">,</span> <span class="tok-kd">function</span><span class="tok-p">(</span><span class="tok-nx">evt</span><span class="tok-p">,</span> <span class="tok-nx">datos</span><span class="tok-p">)</span> <span class="tok-p">{</span>
  <span class="tok-nx">console</span><span class="tok-p">.</span><span class="tok-nx">log</span><span class="tok-p">(</span><span class="tok-s1">&#39;Subscriptor 1 recibe los datos&#39;</span><span class="tok-p">);</span>		<span class="tok-c1">// subscriptor 1</span>
<span class="tok-p">});</span>

<span class="tok-nx">$</span><span class="tok-p">(</span><span class="tok-nb">document</span><span class="tok-p">).</span><span class="tok-nx">on</span><span class="tok-p">(</span><span class="tok-s1">&#39;obd/datos&#39;</span><span class="tok-p">,</span> <span class="tok-kd">function</span><span class="tok-p">(</span><span class="tok-nx">evt</span><span class="tok-p">,</span> <span class="tok-nx">datos</span><span class="tok-p">)</span> <span class="tok-p">{</span>
  <span class="tok-nx">console</span><span class="tok-p">.</span><span class="tok-nx">log</span><span class="tok-p">(</span><span class="tok-s1">&#39;Subscriptor 2 recibe los datos&#39;</span><span class="tok-p">);</span>		<span class="tok-c1">// subscriptor 2</span>
<span class="tok-p">});</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>A este mecanismo de comunicación se le conoce como <em>Publish/Subscribe</em> (y que implementa el patrón <em>Observer</em>), donde podemos tener varios publicadores que envían información mediante el <code>trigger</code> del evento personalizado y múltiples subscriptores con los capturadores del evento.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
Esto mismo lo podemos resolver mediante las <em>promesas</em> que veremos en la siguiente unidad.
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect2">
<h3 id="__code_this_code">6.8. <code>this</code></h3>
<div class="paragraph">
<p>Ya sabemos que al cargar una página, si referenciamos a <code>this</code> desde la raíz apunta al objeto <code>window</code>. En cambio, si lo hacemos desde dentro una función, siempre apuntará a su padre. Es decir, si la función se llama desde el click de un enlace, <code>this</code> contendrá el enlace.</p>
</div>
<div class="paragraph">
<p>Supongamos que tenemos un botón que lanza un manejador:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="html"><span class="tok-nt">&lt;button</span> <span class="tok-na">id=</span><span class="tok-s">&quot;clickeame&quot;</span><span class="tok-nt">&gt;</span>Click aquí<span class="tok-nt">&lt;/button&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Al mostrar con consola el valor de <code>this</code> obtendremos el elemento <em>button</em>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="javascript"><span class="tok-nx">$</span><span class="tok-p">(</span><span class="tok-s2">&quot;#clickeame&quot;</span><span class="tok-p">).</span><span class="tok-nx">click</span><span class="tok-p">(</span><span class="tok-kd">function</span><span class="tok-p">(</span><span class="tok-nx">evt</span><span class="tok-p">)</span> <span class="tok-p">{</span>
  <span class="tok-nx">console</span><span class="tok-p">.</span><span class="tok-nx">log</span><span class="tok-p">(</span><span class="tok-k">this</span><span class="tok-p">);</span> <span class="tok-c1">// HTMLButtonElement</span>
  <span class="tok-nx">console</span><span class="tok-p">.</span><span class="tok-nx">log</span><span class="tok-p">(</span><span class="tok-k">this</span><span class="tok-p">.</span><span class="tok-nx">type</span><span class="tok-p">);</span> <span class="tok-c1">// &quot;submit&quot;</span>
<span class="tok-p">})</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Una acción que se utiliza mucho es convertir el elemento HTML a un objeto jQuery:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="javascript"><span class="tok-kd">var</span> <span class="tok-nx">$this</span> <span class="tok-o">=</span> <span class="tok-nx">$</span><span class="tok-p">(</span><span class="tok-k">this</span><span class="tok-p">);</span></code></pre>
</div>
</div>
<div class="sect3">
<h4 id="_modificando_code_this_code">6.8.1. Modificando <code>this</code></h4>
<div class="paragraph">
<p>Si queremos especificar qué va a ser <code>this</code> al pasarle el control a una función, podemos usar un <em>proxy</em> mediante:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="javascript"><span class="tok-nx">$</span><span class="tok-p">.</span><span class="tok-nx">proxy</span><span class="tok-p">(</span><span class="tok-nx">nombreDeLaFuncion</span><span class="tok-p">,</span> <span class="tok-nx">objetoQueSeraThis</span><span class="tok-p">);</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Supongamos que rescribimos el ejemplo anterior mediante un módulo, del siguiente modo:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="javascript"><span class="tok-kd">var</span> <span class="tok-nx">manejador</span> <span class="tok-o">=</span>  <span class="tok-p">{</span>
  <span class="tok-nx">type</span><span class="tok-o">:</span> <span class="tok-s2">&quot;Mi manejador de eventos&quot;</span><span class="tok-p">,</span>
  <span class="tok-nx">manejadorClick</span><span class="tok-o">:</span> <span class="tok-kd">function</span><span class="tok-p">(</span><span class="tok-nx">evt</span><span class="tok-p">)</span> <span class="tok-p">{</span>
    <span class="tok-nx">console</span><span class="tok-p">.</span><span class="tok-nx">log</span><span class="tok-p">(</span><span class="tok-k">this</span><span class="tok-p">.</span><span class="tok-nx">type</span><span class="tok-p">);</span>
  <span class="tok-p">}</span>
<span class="tok-p">};</span>

<span class="tok-nx">$</span><span class="tok-p">(</span><span class="tok-kd">function</span><span class="tok-p">()</span> <span class="tok-p">{</span>
  <span class="tok-nx">$</span><span class="tok-p">(</span><span class="tok-s2">&quot;#clickeame&quot;</span><span class="tok-p">).</span><span class="tok-nx">click</span><span class="tok-p">(</span><span class="tok-nx">manejador</span><span class="tok-p">.</span><span class="tok-nx">manejadorClick</span><span class="tok-p">);</span>
<span class="tok-p">});</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Si volvemos al ejemplo anterior, y en vez de obtener mediante <code>this</code> el botón queremos que tome el del manejadores haremos:</p>
</div>
<div class="listingblock">
<div class="title">Ejemplo $.proxy() -  <a href="http://jsbin.com/budipe/9/edit?html,js,console,output" class="bare">http://jsbin.com/budipe/9/edit?html,js,console,output</a></div>
<div class="content">
<pre class="pygments highlight"><code data-lang="javascript"><span class="tok-nx">$</span><span class="tok-p">(</span><span class="tok-kd">function</span><span class="tok-p">()</span> <span class="tok-p">{</span>
  <span class="tok-nx">$</span><span class="tok-p">(</span><span class="tok-s2">&quot;#clickeame&quot;</span><span class="tok-p">).</span><span class="tok-nx">click</span><span class="tok-p">(</span><span class="tok-nx">$</span><span class="tok-p">.</span><span class="tok-nx">proxy</span><span class="tok-p">(</span><span class="tok-nx">manejador</span><span class="tok-p">.</span><span class="tok-nx">manejadorClick</span><span class="tok-p">,</span> <span class="tok-nx">manejador</span><span class="tok-p">));</span>
<span class="tok-p">});</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Más información en <a href="http://api.jquery.com/jQuery.proxy/" class="bare">http://api.jquery.com/jQuery.proxy/</a></p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_ejercicios_6">6.9. Ejercicios</h3>
<div class="sect3">
<h4 id="__0_2_ptos_ejercicio_61_recuperando_contenido">6.9.1. (0.2 ptos) Ejercicio 61. Recuperando contenido</h4>
<div class="paragraph">
<p>A partir del siguiente documento con enlaces, añadir el código jQuery necesario para que al lado de cada enlace muestre mediante una imagen el formato del archivo (<em>pdf</em>, <em>html</em>) o el tipo de enlace (sólo para email).</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="html"><span class="tok-cp">&lt;!DOCTYPE html&gt;</span>
<span class="tok-nt">&lt;html</span> <span class="tok-na">lang=</span><span class="tok-s">&quot;es&quot;</span><span class="tok-nt">&gt;</span>
<span class="tok-nt">&lt;head&gt;</span>
  <span class="tok-nt">&lt;meta</span> <span class="tok-na">charset=</span><span class="tok-s">&quot;UTF-8&quot;</span><span class="tok-nt">&gt;</span>
  <span class="tok-nt">&lt;title&gt;</span>Ejercicio 61. Enlaces<span class="tok-nt">&lt;/title&gt;</span>
<span class="tok-nt">&lt;/head&gt;</span>
<span class="tok-nt">&lt;body&gt;</span>
Enlaces
<span class="tok-nt">&lt;ul&gt;</span>
  <span class="tok-nt">&lt;li&gt;&lt;a</span> <span class="tok-na">href=</span><span class="tok-s">&quot;algunsitio.html&quot;</span><span class="tok-nt">&gt;</span>Enlace 1<span class="tok-nt">&lt;/a&gt;&lt;/li&gt;</span>
  <span class="tok-nt">&lt;li&gt;&lt;a</span> <span class="tok-na">name=</span><span class="tok-s">&quot;#ancla1&quot;</span><span class="tok-nt">&gt;</span>Ancla de Enlace<span class="tok-nt">&lt;/a&gt;&lt;/li&gt;</span>
  <span class="tok-nt">&lt;li&gt;&lt;a</span> <span class="tok-na">href=</span><span class="tok-s">&quot;algunsitio.html&quot;</span><span class="tok-nt">&gt;</span>Enlace 2<span class="tok-nt">&lt;/a&gt;&lt;/li&gt;</span>
  <span class="tok-nt">&lt;li&gt;&lt;a</span> <span class="tok-na">href=</span><span class="tok-s">&quot;algunsitio.pdf&quot;</span><span class="tok-nt">&gt;</span>Enlace 3<span class="tok-nt">&lt;/a&gt;&lt;/li&gt;</span>
  <span class="tok-nt">&lt;li&gt;&lt;a</span> <span class="tok-na">href=</span><span class="tok-s">&quot;algunsitio.html&quot;</span><span class="tok-nt">&gt;</span>Enlace 4<span class="tok-nt">&lt;/a&gt;&lt;/li&gt;</span>
  <span class="tok-nt">&lt;li&gt;&lt;a</span> <span class="tok-na">href=</span><span class="tok-s">&quot;algunsitio.pdf&quot;</span><span class="tok-nt">&gt;</span>Enlace 5<span class="tok-nt">&lt;/a&gt;&lt;/li&gt;</span>
  <span class="tok-nt">&lt;li&gt;&lt;a</span> <span class="tok-na">href=</span><span class="tok-s">&quot;algunsitio.pdf&quot;</span><span class="tok-nt">&gt;</span>Enlace 6<span class="tok-nt">&lt;/a&gt;&lt;/li&gt;</span>
  <span class="tok-nt">&lt;li&gt;&lt;a</span> <span class="tok-na">href=</span><span class="tok-s">&quot;mailto:batman@heroes.com&quot;</span><span class="tok-nt">&gt;</span>Enlace email<span class="tok-nt">&lt;/a&gt;&lt;/li&gt;</span>
<span class="tok-nt">&lt;/ul&gt;</span>
<span class="tok-nt">&lt;/body&gt;</span>
<span class="tok-nt">&lt;/html&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Tras ejecutar la página, el resultado debe ser similar a la siguiente imagen:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/js06/ejer61.jpg" alt="Enlaces con imágenes" width="25%">
</div>
<div class="title">Figure 43. Enlaces con imágenes</div>
</div>
<div class="paragraph">
<p>Todo el código estará incluido en el archivo <code>ej61.js</code></p>
</div>
</div>
<div class="sect3">
<h4 id="__0_7_ptos_ejercicio_62_apuntes_1_0">6.9.2. (0.7 ptos) Ejercicio 62. Apuntes 1.0</h4>
<div class="paragraph">
<p>A partir del documento <em>HTML</em> de los apuntes, haciendo uso de <em>jQuery</em> realizar las siguientes tareas:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>cambia los datos del autor y email con tus datos personales</p>
</li>
<li>
<p>sustituye la tabla de contenidos con una lista desordenada que sólo contenga los títulos de primer nivel, con enlaces al lugar correspondiente</p>
</li>
<li>
<p>añade un enlace al final de cada capítulo para volver al inicio del documento.</p>
</li>
<li>
<p>añade dos botones (A+, a-) tras el título del documento que modifiquen el tamaño del texto para hacerlo más grande o más pequeño.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>La apariencia será similar a la siguiente:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/js06/ejer62.jpg" alt="Apuntes retocados" width="66%">
</div>
<div class="title">Figure 44. Apuntes retocados</div>
</div>
<div class="paragraph">
<p>Todo el código estará incluido en el archivo <code>ej62.js</code></p>
</div>
</div>
<div class="sect3">
<h4 id="__0_3_ptos_ejercicio_63_tabla_con_resaltado">6.9.3. (0.3 ptos) Ejercicio 63. Tabla con resaltado</h4>
<div class="paragraph">
<p>Supongamos que tenemos una tabla con información en filas similar a la siguiente:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="html"><span class="tok-cp">&lt;!DOCTYPE html&gt;</span>
<span class="tok-nt">&lt;html</span> <span class="tok-na">lang=</span><span class="tok-s">&quot;es&quot;</span><span class="tok-nt">&gt;</span>
<span class="tok-nt">&lt;head&gt;</span>
	<span class="tok-nt">&lt;meta</span> <span class="tok-na">charset=</span><span class="tok-s">&quot;UTF-8&quot;</span><span class="tok-nt">&gt;</span>
	<span class="tok-nt">&lt;title&gt;</span>Ejercicio 63. Tablas<span class="tok-nt">&lt;/title&gt;</span>
	<span class="tok-nt">&lt;style </span><span class="tok-na">type=</span><span class="tok-s">&quot;text/css&quot;</span><span class="tok-nt">&gt;</span>
	<span class="tok-nt">th</span><span class="tok-o">,</span><span class="tok-nt">td</span> <span class="tok-p">{</span>
		<span class="tok-k">font-family</span><span class="tok-o">:</span> <span class="tok-n">Verdana</span><span class="tok-o">,</span> <span class="tok-n">Arial</span><span class="tok-o">,</span> <span class="tok-n">Helvetica</span><span class="tok-p">;</span>	<span class="tok-k">font-size</span><span class="tok-o">:</span> <span class="tok-m">18px</span><span class="tok-p">;</span> <span class="tok-k">color</span><span class="tok-o">:</span> <span class="tok-m">#000000</span><span class="tok-p">;</span>
	<span class="tok-p">}</span>
	<span class="tok-nt">tr</span> <span class="tok-p">{</span>
		<span class="tok-k">border</span><span class="tok-o">:</span> <span class="tok-m">1px</span> <span class="tok-k">solid</span> <span class="tok-nb">gray</span><span class="tok-p">;</span>
	<span class="tok-p">}</span>
	<span class="tok-nt">td</span> <span class="tok-p">{</span>
		<span class="tok-k">width</span><span class="tok-o">:</span><span class="tok-m">200px</span><span class="tok-p">;</span> <span class="tok-k">padding</span><span class="tok-o">:</span><span class="tok-m">3px</span><span class="tok-p">;</span>
	<span class="tok-p">}</span>
	<span class="tok-nt">th</span> <span class="tok-p">{</span>
		<span class="tok-k">background-color</span><span class="tok-o">:</span><span class="tok-m">#D2E0E8</span><span class="tok-p">;</span> <span class="tok-k">color</span><span class="tok-o">:</span><span class="tok-m">#003366</span>
	<span class="tok-p">}</span>
	<span class="tok-nt">table</span> <span class="tok-p">{</span>
		<span class="tok-k">border</span><span class="tok-o">:</span> <span class="tok-m">1pt</span> <span class="tok-k">solid</span> <span class="tok-nb">gray</span><span class="tok-p">;</span>
	<span class="tok-p">}</span>
	<span class="tok-nc">.clickable</span> <span class="tok-p">{</span>
		<span class="tok-k">cursor</span><span class="tok-o">:</span><span class="tok-k">pointer</span><span class="tok-p">;</span>
	<span class="tok-p">}</span>
<span class="tok-nt">&lt;/style&gt;</span>
<span class="tok-nt">&lt;/head&gt;</span>
<span class="tok-nt">&lt;body&gt;</span>
<span class="tok-nt">&lt;h1&gt;</span>Usando jQuery para resaltar filas de una tabla<span class="tok-nt">&lt;/h1&gt;</span>
<span class="tok-nt">&lt;table</span> <span class="tok-na">id=</span><span class="tok-s">&quot;laLista&quot;</span><span class="tok-nt">&gt;</span>
	<span class="tok-nt">&lt;thead&gt;</span>
		<span class="tok-nt">&lt;tr&gt;&lt;th&gt;</span>Producto<span class="tok-nt">&lt;/th&gt;&lt;th&gt;</span>Precio<span class="tok-nt">&lt;/th&gt;&lt;/tr&gt;</span>
	<span class="tok-nt">&lt;/thead&gt;</span>
	<span class="tok-nt">&lt;tbody&gt;</span>
		<span class="tok-nt">&lt;tr&gt;&lt;td&gt;</span>Leche<span class="tok-nt">&lt;/td&gt;&lt;td&gt;</span>1.99<span class="tok-nt">&lt;/td&gt;&lt;/tr&gt;</span>
		<span class="tok-nt">&lt;tr&gt;&lt;td&gt;</span>Huevos<span class="tok-nt">&lt;/td&gt;&lt;td&gt;</span>2.29<span class="tok-nt">&lt;/td&gt;&lt;/tr&gt;</span>
		<span class="tok-nt">&lt;tr&gt;&lt;td&gt;</span>Mantequilla<span class="tok-nt">&lt;/td&gt;&lt;td&gt;</span>3.49<span class="tok-nt">&lt;/td&gt;&lt;/tr&gt;</span>
		<span class="tok-nt">&lt;tr&gt;&lt;td&gt;</span>Pan<span class="tok-nt">&lt;/td&gt;&lt;td&gt;</span>0.99<span class="tok-nt">&lt;/td&gt;&lt;/tr&gt;</span>
		<span class="tok-nt">&lt;tr&gt;&lt;td&gt;</span>Macarrones<span class="tok-nt">&lt;/td&gt;&lt;td&gt;</span>1.19<span class="tok-nt">&lt;/td&gt;&lt;/tr&gt;</span>
		<span class="tok-nt">&lt;tr&gt;&lt;td&gt;</span>Miel<span class="tok-nt">&lt;/td&gt;&lt;td&gt;</span>4.39<span class="tok-nt">&lt;/td&gt;&lt;/tr&gt;</span>
		<span class="tok-nt">&lt;tr&gt;&lt;td&gt;</span>Galletas<span class="tok-nt">&lt;/td&gt;&lt;td&gt;</span>2.99<span class="tok-nt">&lt;/td&gt;&lt;/tr&gt;</span>
	<span class="tok-nt">&lt;/tbody&gt;</span>
<span class="tok-nt">&lt;/table&gt;</span>
<span class="tok-nt">&lt;/body&gt;</span>
<span class="tok-nt">&lt;/html&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Las tareas a realizar son:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Añadir a cada fila de manera alterna los siguientes estilos:</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="css"><span class="tok-nc">.par</span> <span class="tok-p">{</span>
	<span class="tok-k">background-color</span><span class="tok-o">:</span><span class="tok-m">#0f0</span><span class="tok-p">;</span>
<span class="tok-p">}</span>
<span class="tok-nc">.impar</span> <span class="tok-p">{</span>
	<span class="tok-k">background-color</span><span class="tok-o">:</span><span class="tok-m">#afa</span><span class="tok-p">;</span>
<span class="tok-p">}</span></code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Resalta la fila sobre la que está el ratón con el siguiente estilo:</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="css"><span class="tok-nc">.resaltado</span> <span class="tok-p">{</span>
	<span class="tok-k">background-color</span><span class="tok-o">:</span> <span class="tok-m">#ffcc00</span><span class="tok-p">;</span>
	<span class="tok-k">font-weight</span><span class="tok-o">:</span><span class="tok-k">bold</span><span class="tok-p">;</span>
<span class="tok-p">}</span></code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Al clickar sobre una fila, mostrará una alerta con el producto y su precio</p>
</li>
</ul>
</div>
<div class="imageblock">
<div class="content">
<img src="images/js06/ejer63.jpg" alt="Tabla con resaltado" width="66%">
</div>
<div class="title">Figure 45. Tabla con resaltado</div>
</div>
<div class="paragraph">
<p>Todo el código estará incluido en el archivo <code>ej63.js</code></p>
</div>
<div style="page-break-after: always;"></div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="sesion07">7. jQuery Avanzado</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_efectos">7.1. Efectos</h3>
<div class="paragraph">
<p>jQuery facilita el uso de animaciones y efectos consiguiendo grandes resultados con apenas un par de líneas, como por ejemplo:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Mostrar y ocultar elementos</p>
</li>
<li>
<p>Efectos de aparecer y desvanecer elementos</p>
</li>
<li>
<p>Mover elementos a través de la pantalla</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Podemos consultar todos los efectos disponibles en <a href="http://api.jquery.com/category/effects/" class="bare">http://api.jquery.com/category/effects/</a></p>
</div>
<div class="sect3">
<h4 id="_mostrar_y_ocultar">7.1.1. Mostrar y ocultar</h4>
<div class="paragraph">
<p>Tanto mostrar como ocultar elementos son acciones comunes y sencillas que podemos realizar de manera inmediata o durante un período de tiempo.</p>
</div>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 25%;">
<col style="width: 75%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-center valign-middle">Método</th>
<th class="tableblock halign-left valign-top">Propósito</th>
</tr>
</thead>
<tbody>
<tr>
<th class="tableblock halign-center valign-middle"><p class="tableblock">show()</p></th>
<td class="tableblock halign-left valign-top"><p class="tableblock">Muestra cada elemento del conjunto de resultados, si estaban ocultos</p></td>
</tr>
<tr>
<th class="tableblock halign-center valign-middle"><p class="tableblock">show(<em>velocidad</em>[,<em>callback</em>])</p></th>
<td class="tableblock halign-left valign-top"><p class="tableblock">Muestra todos los elementos del conjunto del resultados mediante una animación, y opcionalmente lanza un <em>callback</em> tras completar la animación</p></td>
</tr>
<tr>
<th class="tableblock halign-center valign-middle"><p class="tableblock">hide()</p></th>
<td class="tableblock halign-left valign-top"><p class="tableblock">Oculta cada elemento del conjunto de resultados, si estaban visibles</p></td>
</tr>
<tr>
<th class="tableblock halign-center valign-middle"><p class="tableblock">hide(<em>velocidad</em>[,<em>callback</em>])</p></th>
<td class="tableblock halign-left valign-top"><p class="tableblock">Oculta todos los elementos del conjunto del resultados mediante una animación, y opcionalmente lanza un <em>callback</em> tras completar la animación</p></td>
</tr>
<tr>
<th class="tableblock halign-center valign-middle"><p class="tableblock">toggle()</p></th>
<td class="tableblock halign-left valign-top"><p class="tableblock">Cambia la visualización (visible u oculto, de manera contraria a su estado) para cada elemento del conjunto de resultados</p></td>
</tr>
<tr>
<th class="tableblock halign-center valign-middle"><p class="tableblock">toggle(<em>switch</em>)</p></th>
<td class="tableblock halign-left valign-top"><p class="tableblock">Cambia la visualización para cada elemento del conjunto de resultados dependiendo del <em>switch</em> (verdadero muestra todos los elementos, falso para ocultarlos)</p></td>
</tr>
<tr>
<th class="tableblock halign-center valign-middle"><p class="tableblock">toggle(<em>velocidad</em>[,<em>callback</em>])</p></th>
<td class="tableblock halign-left valign-top"><p class="tableblock">Cambia la visualización de todos los elementos del conjunto del resultados mediante una animación, y opcionalmente lanza un <em>callback</em> tras completar la animación</p></td>
</tr>
</tbody>
</table>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
En aquellos métodos que aceptan una <em>velocidad</em> como parámetro, la podemos indicar de manera númerica, especificando la cantidad de milisegundos de duración del efecto, o mediante una cadena con los posibles valores a <code>slow</code> (lento - 600ms), <code>normal</code> (400ms) o <code>fast</code> (rápido - 200ms).
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Por ejemplo, supongamos que tenemos un cuadrado con varios botones para cambiar su visualización:</p>
</div>
<div class="listingblock">
<div class="title">Ejemplo Mostrar y Ocultar - <a href="http://jsbin.com/zakaga/1/edit?html,css,js,output" class="bare">http://jsbin.com/zakaga/1/edit?html,css,js,output</a></div>
<div class="content">
<pre class="pygments highlight"><code data-lang="html"><span class="tok-cp">&lt;!DOCTYPE html&gt;</span>
<span class="tok-nt">&lt;html</span> <span class="tok-na">lang=</span><span class="tok-s">&quot;es&quot;</span><span class="tok-nt">&gt;</span>
<span class="tok-nt">&lt;head&gt;</span>
	<span class="tok-nt">&lt;title&gt;</span>Mostrar y Ocultar<span class="tok-nt">&lt;/title&gt;</span>
	<span class="tok-nt">&lt;meta</span> <span class="tok-na">charset=</span><span class="tok-s">&quot;UTF-8&quot;</span><span class="tok-nt">&gt;</span>
	<span class="tok-nt">&lt;style </span><span class="tok-na">type=</span><span class="tok-s">&quot;text/css&quot;</span><span class="tok-nt">&gt;</span>
	<span class="tok-nt">div</span><span class="tok-nf">#laCapa</span> <span class="tok-p">{</span>
		<span class="tok-k">width</span><span class="tok-o">:</span> <span class="tok-m">250px</span><span class="tok-p">;</span> <span class="tok-k">height</span><span class="tok-o">:</span> <span class="tok-m">180px</span><span class="tok-p">;</span> <span class="tok-k">margin</span><span class="tok-o">:</span> <span class="tok-m">10px</span><span class="tok-p">;</span> <span class="tok-k">padding</span><span class="tok-o">:</span> <span class="tok-m">20px</span><span class="tok-p">;</span>
		<span class="tok-k">background</span><span class="tok-o">:</span> <span class="tok-nb">blue</span><span class="tok-p">;</span> <span class="tok-k">border</span><span class="tok-o">:</span> <span class="tok-m">2px</span> <span class="tok-k">solid</span> <span class="tok-nb">black</span><span class="tok-p">;</span> <span class="tok-k">cursor</span><span class="tok-o">:</span> <span class="tok-k">pointer</span><span class="tok-p">;</span>
	<span class="tok-p">}</span>
	<span class="tok-nt">p</span><span class="tok-o">,</span> <span class="tok-nt">span</span> <span class="tok-p">{</span>
		<span class="tok-k">font-size</span><span class="tok-o">:</span> <span class="tok-m">16pt</span><span class="tok-p">;</span>
	<span class="tok-p">}</span>
	<span class="tok-nt">button</span> <span class="tok-p">{</span>
		<span class="tok-k">margin</span><span class="tok-o">:</span> <span class="tok-m">5px</span><span class="tok-p">;</span>
	<span class="tok-p">}</span>
	<span class="tok-nt">&lt;/style&gt;</span>
<span class="tok-nt">&lt;/head&gt;</span>
<span class="tok-nt">&lt;body&gt;</span>
	<span class="tok-nt">&lt;p&gt;</span>Mostrando y Ocultando un elemento<span class="tok-nt">&lt;/p&gt;</span>
	<span class="tok-nt">&lt;div</span> <span class="tok-na">id=</span><span class="tok-s">&quot;laCapa&quot;</span><span class="tok-nt">&gt;&lt;/div&gt;</span>
	<span class="tok-nt">&lt;button</span> <span class="tok-na">id=</span><span class="tok-s">&quot;mostrar&quot;</span><span class="tok-nt">&gt;</span>Mostrar<span class="tok-nt">&lt;/button&gt;</span>
	<span class="tok-nt">&lt;button</span> <span class="tok-na">id=</span><span class="tok-s">&quot;ocultar&quot;</span><span class="tok-nt">&gt;</span>Ocultar<span class="tok-nt">&lt;/button&gt;</span>
	<span class="tok-nt">&lt;button</span> <span class="tok-na">id=</span><span class="tok-s">&quot;cambiar&quot;</span><span class="tok-nt">&gt;</span>Cambiar (Toggle)<span class="tok-nt">&lt;/button&gt;</span>
<span class="tok-nt">&lt;/body&gt;</span>
<span class="tok-nt">&lt;/html&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Y el código para cambiar el estado de visualización con una pequeña animación:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="javascript"><span class="tok-nx">$</span><span class="tok-p">(</span><span class="tok-kd">function</span><span class="tok-p">()</span> <span class="tok-p">{</span>
	<span class="tok-nx">$</span><span class="tok-p">(</span><span class="tok-s2">&quot;#mostrar&quot;</span><span class="tok-p">).</span><span class="tok-nx">click</span><span class="tok-p">(</span><span class="tok-kd">function</span><span class="tok-p">()</span> <span class="tok-p">{</span>
		<span class="tok-nx">$</span><span class="tok-p">(</span><span class="tok-s2">&quot;#laCapa&quot;</span><span class="tok-p">).</span><span class="tok-nx">show</span><span class="tok-p">(</span><span class="tok-s2">&quot;normal&quot;</span><span class="tok-p">);</span>
	<span class="tok-p">});</span>
	<span class="tok-nx">$</span><span class="tok-p">(</span><span class="tok-s2">&quot;#ocultar&quot;</span><span class="tok-p">).</span><span class="tok-nx">click</span><span class="tok-p">(</span><span class="tok-kd">function</span><span class="tok-p">()</span> <span class="tok-p">{</span>
		<span class="tok-nx">$</span><span class="tok-p">(</span><span class="tok-s2">&quot;#laCapa&quot;</span><span class="tok-p">).</span><span class="tok-nx">hide</span><span class="tok-p">(</span><span class="tok-mi">2000</span><span class="tok-p">);</span>	<span class="tok-c1">// ms</span>
	<span class="tok-p">});</span>
	<span class="tok-nx">$</span><span class="tok-p">(</span><span class="tok-s2">&quot;#cambiar&quot;</span><span class="tok-p">).</span><span class="tok-nx">click</span><span class="tok-p">(</span><span class="tok-kd">function</span><span class="tok-p">()</span> <span class="tok-p">{</span>
		<span class="tok-nx">$</span><span class="tok-p">(</span><span class="tok-s2">&quot;#laCapa&quot;</span><span class="tok-p">).</span><span class="tok-nx">toggle</span><span class="tok-p">(</span><span class="tok-s2">&quot;slow&quot;</span><span class="tok-p">);</span>
	<span class="tok-p">});</span>
<span class="tok-p">});</span></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_aparecer_y_desvanecer">7.1.2. Aparecer y desvanecer</h4>
<div class="paragraph">
<p>Los efectos más comunes se basan en la aparición progresiva y desvanecimiento del contenido de manera completa o hasta una determinada opacidad. jQuery ofrece un conjunto de métodos para estos efectos:</p>
</div>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 25%;">
<col style="width: 75%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-center valign-middle">Método</th>
<th class="tableblock halign-left valign-top">Propósito</th>
</tr>
</thead>
<tbody>
<tr>
<th class="tableblock halign-center valign-middle"><p class="tableblock">fadeIn(<em>velocidad</em>[,<em>callback</em>])</p></th>
<td class="tableblock halign-left valign-top"><p class="tableblock">El contenido aparece a la <em>velocidad</em> indicada para cada elemento del conjunto de resultados, y opcionalmente lanza un <em>callback</em> tras completar la animación</p></td>
</tr>
<tr>
<th class="tableblock halign-center valign-middle"><p class="tableblock">fadeOut(<em>velocidad</em>[,<em>callback</em>])</p></th>
<td class="tableblock halign-left valign-top"><p class="tableblock">El contenido se desvanece a la <em>velocidad</em> indicada para cada elemento del conjunto de resultados, y opcionalmente lanza un <em>callback</em> tras completar la animación</p></td>
</tr>
<tr>
<th class="tableblock halign-center valign-middle"><p class="tableblock">fadeTo(<em>velocidad</em>,<em>opacidad</em>[,<em>callback</em>])</p></th>
<td class="tableblock halign-left valign-top"><p class="tableblock">El contenido cambia a la <em>opacidad</em> y <em>velocidad</em> indicadas para cada elemento del conjunto de resultados, y opcionalmente lanza un <em>callback</em> tras completar la animación</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Ya hemos visto que si queremos que se ejecute una función cuando termine la ejecución, la pasaremos como <em>callback</em>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="javascript"><span class="tok-nx">$</span><span class="tok-p">(</span><span class="tok-k">this</span><span class="tok-p">).</span><span class="tok-nx">fadeOut</span><span class="tok-p">(</span><span class="tok-mi">1000</span><span class="tok-p">,</span> <span class="tok-kd">function</span><span class="tok-p">()</span> <span class="tok-p">{</span>
	<span class="tok-nx">console</span><span class="tok-p">.</span><span class="tok-nx">log</span><span class="tok-p">(</span><span class="tok-s2">&quot;He acabado&quot;</span><span class="tok-p">);</span>
<span class="tok-p">});</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Por ejemplo, para simular un efecto <em>toggle</em>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="javascript"><span class="tok-nx">$</span><span class="tok-p">(</span><span class="tok-k">this</span><span class="tok-p">).</span><span class="tok-nx">fadeOut</span><span class="tok-p">(</span><span class="tok-mi">500</span><span class="tok-p">,</span> <span class="tok-kd">function</span><span class="tok-p">()</span> <span class="tok-p">{</span>
	<span class="tok-nx">$</span><span class="tok-p">(</span><span class="tok-k">this</span><span class="tok-p">).</span><span class="tok-nx">delay</span><span class="tok-p">(</span><span class="tok-mi">2000</span><span class="tok-p">).</span><span class="tok-nx">fadeIn</span><span class="tok-p">(</span><span class="tok-mi">500</span><span class="tok-p">);</span>
<span class="tok-p">});</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Si hubiésemos puesto la función fuera del parámetro del <code>fadeOut</code>, se hubiese ejecutado justamente después de iniciarse la animación, y no al finalizar la misma.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="javascript"><span class="tok-nx">$</span><span class="tok-p">(</span><span class="tok-k">this</span><span class="tok-p">).</span><span class="tok-nx">fadeOut</span><span class="tok-p">(</span><span class="tok-mi">500</span><span class="tok-p">).</span><span class="tok-nx">css</span><span class="tok-p">(</span><span class="tok-s2">&quot;margin&quot;</span><span class="tok-p">,</span><span class="tok-s2">&quot;50 px&quot;</span><span class="tok-p">);</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>De manera similar al ejemplo anterior, vamos a dibujar un cuadrado con 4 botones para mostrar estos efectos:</p>
</div>
<div class="listingblock">
<div class="title">Ejemplo Aparecer y Desvanecer - <a href="http://jsbin.com/holumo/1/edit?html,css,js,output" class="bare">http://jsbin.com/holumo/1/edit?html,css,js,output</a></div>
<div class="content">
<pre class="pygments highlight"><code data-lang="html"><span class="tok-cp">&lt;!DOCTYPE html&gt;</span>
<span class="tok-nt">&lt;html</span> <span class="tok-na">lang=</span><span class="tok-s">&quot;es&quot;</span><span class="tok-nt">&gt;</span>
<span class="tok-nt">&lt;head&gt;</span>
	<span class="tok-nt">&lt;title&gt;</span>Aparecer y Desvanecer<span class="tok-nt">&lt;/title&gt;</span>
	<span class="tok-nt">&lt;meta</span> <span class="tok-na">charset=</span><span class="tok-s">&quot;UTF-8&quot;</span><span class="tok-nt">&gt;</span>
	<span class="tok-nt">&lt;style </span><span class="tok-na">type=</span><span class="tok-s">&quot;text/css&quot;</span><span class="tok-nt">&gt;</span>
		<span class="tok-nt">div</span><span class="tok-nf">#laCapa</span> <span class="tok-p">{</span>
			<span class="tok-k">width</span><span class="tok-o">:</span> <span class="tok-m">250px</span><span class="tok-p">;</span> <span class="tok-k">height</span><span class="tok-o">:</span> <span class="tok-m">180px</span><span class="tok-p">;</span> <span class="tok-k">margin</span><span class="tok-o">:</span> <span class="tok-m">10px</span><span class="tok-p">;</span> <span class="tok-k">padding</span><span class="tok-o">:</span> <span class="tok-m">20px</span><span class="tok-p">;</span>
			<span class="tok-k">background</span><span class="tok-o">:</span> <span class="tok-nb">blue</span><span class="tok-p">;</span> <span class="tok-k">border</span><span class="tok-o">:</span> <span class="tok-m">2px</span> <span class="tok-k">solid</span> <span class="tok-nb">black</span><span class="tok-p">;</span> <span class="tok-k">cursor</span><span class="tok-o">:</span> <span class="tok-k">pointer</span><span class="tok-p">;</span>
		<span class="tok-p">}</span>
		<span class="tok-nt">p</span><span class="tok-o">,</span> <span class="tok-nt">span</span> <span class="tok-p">{</span>
			<span class="tok-k">font-size</span><span class="tok-o">:</span> <span class="tok-m">16pt</span><span class="tok-p">;</span>
		<span class="tok-p">}</span>
		<span class="tok-nt">button</span> <span class="tok-p">{</span>
			<span class="tok-k">margin</span><span class="tok-o">:</span> <span class="tok-m">5px</span><span class="tok-p">;</span>
		<span class="tok-p">}</span>
	<span class="tok-nt">&lt;/style&gt;</span>
<span class="tok-nt">&lt;/head&gt;</span>
<span class="tok-nt">&lt;body&gt;</span>
	<span class="tok-nt">&lt;p&gt;</span>Aparecer y Desvanecer un elemento<span class="tok-nt">&lt;/p&gt;</span>
	<span class="tok-nt">&lt;div</span> <span class="tok-na">id=</span><span class="tok-s">&quot;laCapa&quot;</span><span class="tok-nt">&gt;&lt;/div&gt;</span>
	<span class="tok-nt">&lt;button</span> <span class="tok-na">id=</span><span class="tok-s">&quot;aparecer&quot;</span><span class="tok-nt">&gt;</span>Aparecer<span class="tok-nt">&lt;/button&gt;</span>
	<span class="tok-nt">&lt;button</span> <span class="tok-na">id=</span><span class="tok-s">&quot;desvanecer&quot;</span><span class="tok-nt">&gt;</span>Desvanecer<span class="tok-nt">&lt;/button&gt;</span>
	<span class="tok-nt">&lt;button</span> <span class="tok-na">id=</span><span class="tok-s">&quot;fade03&quot;</span><span class="tok-nt">&gt;</span>Opacidad hasta .3<span class="tok-nt">&lt;/button&gt;</span>
	<span class="tok-nt">&lt;button</span> <span class="tok-na">id=</span><span class="tok-s">&quot;fade10&quot;</span><span class="tok-nt">&gt;</span>Opacidad hasta 1.0<span class="tok-nt">&lt;/button&gt;</span>
<span class="tok-nt">&lt;/body&gt;</span>
<span class="tok-nt">&lt;/html&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Y el código para cambiar el estado de visualización con una pequeña animación:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="javascript"><span class="tok-nx">$</span><span class="tok-p">(</span><span class="tok-kd">function</span><span class="tok-p">()</span> <span class="tok-p">{</span>
	<span class="tok-nx">$</span><span class="tok-p">(</span><span class="tok-s2">&quot;#aparecer&quot;</span><span class="tok-p">).</span><span class="tok-nx">click</span><span class="tok-p">(</span><span class="tok-kd">function</span><span class="tok-p">()</span> <span class="tok-p">{</span>
		<span class="tok-nx">$</span><span class="tok-p">(</span><span class="tok-s2">&quot;#laCapa&quot;</span><span class="tok-p">).</span><span class="tok-nx">fadeIn</span><span class="tok-p">(</span><span class="tok-mi">300</span><span class="tok-p">);</span>
	<span class="tok-p">});</span>
	<span class="tok-nx">$</span><span class="tok-p">(</span><span class="tok-s2">&quot;#desvanecer&quot;</span><span class="tok-p">).</span><span class="tok-nx">click</span><span class="tok-p">(</span><span class="tok-kd">function</span><span class="tok-p">()</span> <span class="tok-p">{</span>
		<span class="tok-nx">$</span><span class="tok-p">(</span><span class="tok-s2">&quot;#laCapa&quot;</span><span class="tok-p">).</span><span class="tok-nx">fadeOut</span><span class="tok-p">(</span><span class="tok-s2">&quot;normal&quot;</span><span class="tok-p">);</span>
	<span class="tok-p">});</span>
	<span class="tok-nx">$</span><span class="tok-p">(</span><span class="tok-s2">&quot;#fade03&quot;</span><span class="tok-p">).</span><span class="tok-nx">click</span><span class="tok-p">(</span><span class="tok-kd">function</span><span class="tok-p">()</span> <span class="tok-p">{</span>
		<span class="tok-nx">$</span><span class="tok-p">(</span><span class="tok-s2">&quot;#laCapa&quot;</span><span class="tok-p">).</span><span class="tok-nx">fadeTo</span><span class="tok-p">(</span><span class="tok-s2">&quot;slow&quot;</span><span class="tok-p">,</span> <span class="tok-mf">0.3</span><span class="tok-p">);</span>
	<span class="tok-p">});</span>
	<span class="tok-nx">$</span><span class="tok-p">(</span><span class="tok-s2">&quot;#fade10&quot;</span><span class="tok-p">).</span><span class="tok-nx">click</span><span class="tok-p">(</span><span class="tok-kd">function</span><span class="tok-p">()</span> <span class="tok-p">{</span>
		<span class="tok-nx">$</span><span class="tok-p">(</span><span class="tok-s2">&quot;#laCapa&quot;</span><span class="tok-p">).</span><span class="tok-nx">fadeTo</span><span class="tok-p">(</span><span class="tok-s2">&quot;slow&quot;</span><span class="tok-p">,</span> <span class="tok-mf">1.0</span><span class="tok-p">);</span>
	<span class="tok-p">});</span>
<span class="tok-p">});</span></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_enrollar_y_desenrollar">7.1.3. Enrollar y desenrollar</h4>
<div class="paragraph">
<p>jQuery ofrece un conjunto de métodos para enrollar y desenrolar los elementos a modo de persiana:</p>
</div>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 25%;">
<col style="width: 75%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-center valign-middle">Método</th>
<th class="tableblock halign-left valign-top">Propósito</th>
</tr>
</thead>
<tbody>
<tr>
<th class="tableblock halign-center valign-middle"><p class="tableblock">slideDown(<em>velocidad</em>[,<em>callback</em>])</p></th>
<td class="tableblock halign-left valign-top"><p class="tableblock">El contenido se desenrolla a la <em>velocidad</em> indicada modificando la altura de cada elemento del conjunto de resultados , y opcionalmente lanza un <em>callback</em> tras completar la animación</p></td>
</tr>
<tr>
<th class="tableblock halign-center valign-middle"><p class="tableblock">slideUp(<em>velocidad</em>[,<em>callback</em>])</p></th>
<td class="tableblock halign-left valign-top"><p class="tableblock">El contenido se enrolla a la <em>velocidad</em> indicada modificando la altura de cada elemento del conjunto de resultados , y opcionalmente lanza un <em>callback</em> tras completar la animación</p></td>
</tr>
<tr>
<th class="tableblock halign-center valign-middle"><p class="tableblock">slideToggle(<em>velocidad</em>[,<em>callback</em>])</p></th>
<td class="tableblock halign-left valign-top"><p class="tableblock">Cambia la visualización del contenido enrollando o desenrollando el contenido a la <em>velocidad</em> indicada modificando la altura de cada elemento del conjunto de resultados, y opcionalmente lanza un <em>callback</em> tras completar la animación</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>De manera similar al ejemplo anterior, vamos a dibujar un cuadrado con 3 botones para mostrar estos efectos:</p>
</div>
<div class="listingblock">
<div class="title">Ejemplo Enrollar y Desenrollar - <a href="http://jsbin.com/hunoq/1/edit?html,css,js,output" class="bare">http://jsbin.com/hunoq/1/edit?html,css,js,output</a></div>
<div class="content">
<pre class="pygments highlight"><code data-lang="html"><span class="tok-cp">&lt;!DOCTYPE html&gt;</span>
<span class="tok-nt">&lt;html</span> <span class="tok-na">lang=</span><span class="tok-s">&quot;es&quot;</span><span class="tok-nt">&gt;</span>
<span class="tok-nt">&lt;head&gt;</span>
	<span class="tok-nt">&lt;title&gt;</span>Enrollar y Desenrollar<span class="tok-nt">&lt;/title&gt;</span>
	<span class="tok-nt">&lt;meta</span> <span class="tok-na">charset=</span><span class="tok-s">&quot;UTF-8&quot;</span><span class="tok-nt">&gt;</span>
	<span class="tok-nt">&lt;style </span><span class="tok-na">type=</span><span class="tok-s">&quot;text/css&quot;</span><span class="tok-nt">&gt;</span>
		<span class="tok-nt">div</span><span class="tok-nf">#laCapa</span> <span class="tok-p">{</span>
			<span class="tok-k">width</span><span class="tok-o">:</span> <span class="tok-m">250px</span><span class="tok-p">;</span> <span class="tok-k">height</span><span class="tok-o">:</span> <span class="tok-m">180px</span><span class="tok-p">;</span> <span class="tok-k">margin</span><span class="tok-o">:</span> <span class="tok-m">10px</span><span class="tok-p">;</span> <span class="tok-k">padding</span><span class="tok-o">:</span> <span class="tok-m">20px</span><span class="tok-p">;</span>
			<span class="tok-k">background</span><span class="tok-o">:</span> <span class="tok-nb">blue</span><span class="tok-p">;</span> <span class="tok-k">border</span><span class="tok-o">:</span> <span class="tok-m">2px</span> <span class="tok-k">solid</span> <span class="tok-nb">black</span><span class="tok-p">;</span> <span class="tok-k">cursor</span><span class="tok-o">:</span> <span class="tok-k">pointer</span><span class="tok-p">;</span>
		<span class="tok-p">}</span>
		<span class="tok-nt">p</span><span class="tok-o">,</span> <span class="tok-nt">span</span> <span class="tok-p">{</span>
			<span class="tok-k">font-size</span><span class="tok-o">:</span> <span class="tok-m">16pt</span><span class="tok-p">;</span>
		<span class="tok-p">}</span>
		<span class="tok-nt">button</span> <span class="tok-p">{</span>
			<span class="tok-k">margin</span><span class="tok-o">:</span> <span class="tok-m">5px</span><span class="tok-p">;</span>
		<span class="tok-p">}</span>
	<span class="tok-nt">&lt;/style&gt;</span>
<span class="tok-nt">&lt;/head&gt;</span>
<span class="tok-nt">&lt;body&gt;</span>
	<span class="tok-nt">&lt;p&gt;</span>Enrollando y Desenrollando un elemento<span class="tok-nt">&lt;/p&gt;</span>
	<span class="tok-nt">&lt;div</span> <span class="tok-na">id=</span><span class="tok-s">&quot;laCapa&quot;</span><span class="tok-nt">&gt;&lt;/div&gt;</span>
	<span class="tok-nt">&lt;button</span> <span class="tok-na">id=</span><span class="tok-s">&quot;enrollar&quot;</span><span class="tok-nt">&gt;</span>Enrollar<span class="tok-nt">&lt;/button&gt;</span>
	<span class="tok-nt">&lt;button</span> <span class="tok-na">id=</span><span class="tok-s">&quot;desenrollar&quot;</span><span class="tok-nt">&gt;</span>Desenrollar<span class="tok-nt">&lt;/button&gt;</span>
	<span class="tok-nt">&lt;button</span> <span class="tok-na">id=</span><span class="tok-s">&quot;cambiar&quot;</span><span class="tok-nt">&gt;</span>Cambiar (Toggle)<span class="tok-nt">&lt;/button&gt;</span>
<span class="tok-nt">&lt;/body&gt;</span>
<span class="tok-nt">&lt;/html&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Y el código para enrollar y desenrollar con una pequeña animación:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="javascript"><span class="tok-nx">$</span><span class="tok-p">(</span><span class="tok-kd">function</span><span class="tok-p">()</span> <span class="tok-p">{</span>
	<span class="tok-nx">$</span><span class="tok-p">(</span><span class="tok-s2">&quot;#enrollar&quot;</span><span class="tok-p">).</span><span class="tok-nx">click</span><span class="tok-p">(</span><span class="tok-kd">function</span><span class="tok-p">()</span> <span class="tok-p">{</span>
		<span class="tok-nx">$</span><span class="tok-p">(</span><span class="tok-s2">&quot;#laCapa&quot;</span><span class="tok-p">).</span><span class="tok-nx">slideUp</span><span class="tok-p">(</span><span class="tok-s2">&quot;normal&quot;</span><span class="tok-p">);</span>
	<span class="tok-p">});</span>
	<span class="tok-nx">$</span><span class="tok-p">(</span><span class="tok-s2">&quot;#desenrollar&quot;</span><span class="tok-p">).</span><span class="tok-nx">click</span><span class="tok-p">(</span><span class="tok-kd">function</span><span class="tok-p">()</span> <span class="tok-p">{</span>
		<span class="tok-nx">$</span><span class="tok-p">(</span><span class="tok-s2">&quot;#laCapa&quot;</span><span class="tok-p">).</span><span class="tok-nx">slideDown</span><span class="tok-p">(</span><span class="tok-mi">2000</span><span class="tok-p">);</span>
	<span class="tok-p">});</span>
	<span class="tok-nx">$</span><span class="tok-p">(</span><span class="tok-s2">&quot;#cambiar&quot;</span><span class="tok-p">).</span><span class="tok-nx">click</span><span class="tok-p">(</span><span class="tok-kd">function</span><span class="tok-p">()</span> <span class="tok-p">{</span>
		<span class="tok-nx">$</span><span class="tok-p">(</span><span class="tok-s2">&quot;#laCapa&quot;</span><span class="tok-p">).</span><span class="tok-nx">slideToggle</span><span class="tok-p">(</span><span class="tok-s2">&quot;slow&quot;</span><span class="tok-p">);</span>
	<span class="tok-p">});</span>
<span class="tok-p">});</span></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_creando_animaciones">7.1.4. Creando animaciones</h4>
<div class="paragraph">
<p>Para crear animaciones personalizadas sobre las propiedades de los elementos llamaremos a la función <code>animate()</code>, y para detenerlas a <code>stop()</code>.</p>
</div>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 25%;">
<col style="width: 75%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-center valign-middle">Método</th>
<th class="tableblock halign-left valign-top">Propósito</th>
</tr>
</thead>
<tbody>
<tr>
<th class="tableblock halign-center valign-middle"><p class="tableblock">animate(<em>parámetros</em>, <em>duración</em>, <em>easing</em>, <em>callback</em>)</p></th>
<td class="tableblock halign-left valign-top"><p class="tableblock">Crea una animación personalizada donde <em>parámetros</em> indica un objeto CSS con las propiedades a animar, con una <em>duración</em> y <em>easing</em> (linear o <em>swing</em>) determinados y lanza un <em>callback</em> tras completar la animación</p></td>
</tr>
<tr>
<th class="tableblock halign-center valign-middle"><p class="tableblock">animate(<em>parametros</em>, <em>opciones</em>)</p></th>
<td class="tableblock halign-left valign-top"><p class="tableblock">Crea una animación personalizada donde <em>parametros</em> indica las propiedades a animar y las <em>opciones</em> de las animación (<em>complete</em>, <em>step</em>, <em>queue</em>)</p></td>
</tr>
<tr>
<th class="tableblock halign-center valign-middle"><p class="tableblock">stop()</p></th>
<td class="tableblock halign-left valign-top"><p class="tableblock">Detiene todas las animaciones en marcha para todos los elementos</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>De manera similar al ejemplo anterior, vamos a dibujar un cuadrado con 4 botones para cambiar el tamaño de un elemento, el tamaño del texto, mover el elemento y hacerlo todo a la vez:</p>
</div>
<div class="listingblock">
<div class="title">Ejemplo Animaciones - <a href="http://jsbin.com/wiyodo/2/edit?html,css,js,output" class="bare">http://jsbin.com/wiyodo/2/edit?html,css,js,output</a></div>
<div class="content">
<pre class="pygments highlight"><code data-lang="html"><span class="tok-cp">&lt;!DOCTYPE html&gt;</span>
<span class="tok-nt">&lt;html</span> <span class="tok-na">lang=</span><span class="tok-s">&quot;es&quot;</span><span class="tok-nt">&gt;</span>
<span class="tok-nt">&lt;head&gt;</span>
	<span class="tok-nt">&lt;title&gt;</span>Animaciones<span class="tok-nt">&lt;/title&gt;</span>
	<span class="tok-nt">&lt;meta</span> <span class="tok-na">charset=</span><span class="tok-s">&quot;UTF-8&quot;</span><span class="tok-nt">&gt;</span>
	<span class="tok-nt">&lt;style </span><span class="tok-na">type=</span><span class="tok-s">&quot;text/css&quot;</span><span class="tok-nt">&gt;</span>
		<span class="tok-nt">div</span><span class="tok-nf">#laCapa</span> <span class="tok-p">{</span>
			<span class="tok-k">position</span><span class="tok-o">:</span> <span class="tok-k">relative</span><span class="tok-p">;</span> <span class="tok-k">width</span><span class="tok-o">:</span> <span class="tok-m">250px</span><span class="tok-p">;</span> <span class="tok-k">height</span><span class="tok-o">:</span> <span class="tok-m">180px</span><span class="tok-p">;</span> <span class="tok-k">margin</span><span class="tok-o">:</span> <span class="tok-m">10px</span><span class="tok-p">;</span> <span class="tok-k">padding</span><span class="tok-o">:</span> <span class="tok-m">20px</span><span class="tok-p">;</span>
			<span class="tok-k">background</span><span class="tok-o">:</span> <span class="tok-nb">blue</span><span class="tok-p">;</span> <span class="tok-k">border</span><span class="tok-o">:</span> <span class="tok-m">2px</span> <span class="tok-k">solid</span> <span class="tok-nb">black</span><span class="tok-p">;</span> <span class="tok-k">cursor</span><span class="tok-o">:</span> <span class="tok-k">pointer</span><span class="tok-p">;</span>
		<span class="tok-p">}</span>
		<span class="tok-nt">p</span><span class="tok-o">,</span> <span class="tok-nt">span</span> <span class="tok-p">{</span>
			<span class="tok-k">font-size</span><span class="tok-o">:</span> <span class="tok-m">16pt</span><span class="tok-p">;</span>
		<span class="tok-p">}</span>
		<span class="tok-nt">button</span> <span class="tok-p">{</span>
			<span class="tok-k">margin</span><span class="tok-o">:</span> <span class="tok-m">5px</span><span class="tok-p">;</span>
		<span class="tok-p">}</span>
	<span class="tok-nt">&lt;/style&gt;</span>
<span class="tok-nt">&lt;/head&gt;</span>
<span class="tok-nt">&lt;body&gt;</span>
	<span class="tok-nt">&lt;p&gt;</span>Animaciones<span class="tok-nt">&lt;/p&gt;</span>
	<span class="tok-nt">&lt;div</span> <span class="tok-na">id=</span><span class="tok-s">&quot;laCapa&quot;</span><span class="tok-nt">&gt;</span>Anímame un poco!<span class="tok-nt">&lt;/div&gt;</span>
	<span class="tok-nt">&lt;button</span> <span class="tok-na">id=</span><span class="tok-s">&quot;derecha&quot;</span><span class="tok-nt">&gt;</span>Crecer a la derecha<span class="tok-nt">&lt;/button&gt;</span>
	<span class="tok-nt">&lt;button</span> <span class="tok-na">id=</span><span class="tok-s">&quot;texto&quot;</span><span class="tok-nt">&gt;</span>Texto grande<span class="tok-nt">&lt;/button&gt;</span>
	<span class="tok-nt">&lt;button</span> <span class="tok-na">id=</span><span class="tok-s">&quot;mover&quot;</span><span class="tok-nt">&gt;</span>Mover la capa<span class="tok-nt">&lt;/button&gt;</span>
	<span class="tok-nt">&lt;button</span> <span class="tok-na">id=</span><span class="tok-s">&quot;todo&quot;</span><span class="tok-nt">&gt;</span>Todo<span class="tok-nt">&lt;/button&gt;</span>
<span class="tok-nt">&lt;/body&gt;</span>
<span class="tok-nt">&lt;/html&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Y el código para cambiar animar cada uno de los botones:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="javascript"><span class="tok-nx">$</span><span class="tok-p">(</span><span class="tok-kd">function</span><span class="tok-p">()</span> <span class="tok-p">{</span>
	<span class="tok-nx">$</span><span class="tok-p">(</span><span class="tok-s2">&quot;#derecha&quot;</span><span class="tok-p">).</span><span class="tok-nx">click</span><span class="tok-p">(</span><span class="tok-kd">function</span><span class="tok-p">()</span> <span class="tok-p">{</span>
	  <span class="tok-nx">$</span><span class="tok-p">(</span><span class="tok-s2">&quot;#laCapa&quot;</span><span class="tok-p">).</span><span class="tok-nx">animate</span><span class="tok-p">({</span> <span class="tok-nx">width</span><span class="tok-o">:</span> <span class="tok-s2">&quot;500px&quot;</span> <span class="tok-p">},</span> <span class="tok-mi">1000</span><span class="tok-p">);</span>
	<span class="tok-p">});</span>
	<span class="tok-nx">$</span><span class="tok-p">(</span><span class="tok-s2">&quot;#texto&quot;</span><span class="tok-p">).</span><span class="tok-nx">click</span><span class="tok-p">(</span><span class="tok-kd">function</span><span class="tok-p">()</span> <span class="tok-p">{</span>
	  <span class="tok-nx">$</span><span class="tok-p">(</span><span class="tok-s2">&quot;#laCapa&quot;</span><span class="tok-p">).</span><span class="tok-nx">animate</span><span class="tok-p">({</span> <span class="tok-nx">fontSize</span><span class="tok-o">:</span> <span class="tok-s2">&quot;24pt&quot;</span> <span class="tok-p">},</span> <span class="tok-mi">1000</span><span class="tok-p">);</span>
	<span class="tok-p">});</span>
	<span class="tok-nx">$</span><span class="tok-p">(</span><span class="tok-s2">&quot;#mover&quot;</span><span class="tok-p">).</span><span class="tok-nx">click</span><span class="tok-p">(</span><span class="tok-kd">function</span><span class="tok-p">()</span> <span class="tok-p">{</span>
	  <span class="tok-nx">$</span><span class="tok-p">(</span><span class="tok-s2">&quot;#laCapa&quot;</span><span class="tok-p">).</span><span class="tok-nx">animate</span><span class="tok-p">({</span> <span class="tok-nx">left</span><span class="tok-o">:</span> <span class="tok-s2">&quot;500&quot;</span> <span class="tok-p">},</span> <span class="tok-mi">1000</span><span class="tok-p">,</span> <span class="tok-s2">&quot;swing&quot;</span><span class="tok-p">);</span>
	<span class="tok-p">});</span>
	<span class="tok-nx">$</span><span class="tok-p">(</span><span class="tok-s2">&quot;#todo&quot;</span><span class="tok-p">).</span><span class="tok-nx">click</span><span class="tok-p">(</span><span class="tok-kd">function</span><span class="tok-p">()</span> <span class="tok-p">{</span>
		<span class="tok-nx">$</span><span class="tok-p">(</span><span class="tok-s2">&quot;#laCapa&quot;</span><span class="tok-p">).</span><span class="tok-nx">animate</span><span class="tok-p">({</span> <span class="tok-nx">width</span><span class="tok-o">:</span> <span class="tok-s2">&quot;500px&quot;</span><span class="tok-p">,</span> <span class="tok-nx">fontSize</span><span class="tok-o">:</span> <span class="tok-s2">&quot;24pt&quot;</span><span class="tok-p">,</span> <span class="tok-nx">left</span><span class="tok-o">:</span> <span class="tok-s2">&quot;500&quot;</span> <span class="tok-p">},</span> <span class="tok-mi">1000</span><span class="tok-p">,</span> <span class="tok-s2">&quot;swing&quot;</span><span class="tok-p">);</span>
	<span class="tok-p">});</span>
<span class="tok-p">});</span></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_ejemplo_carrusel">7.1.5. Ejemplo carrusel</h4>
<div class="paragraph">
<p>Para poner estos efectos en practica y por comparar funcionalidad realizada en JavaScript respecto a la misma con jQuery, vamos a realizar un carrusel de imagenes de manera similar a la realizada en sesiones anteriores.</p>
</div>
<div class="paragraph">
<p>Para ello, vamos a definir una capa para cada una de las imágenes</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="html"><span class="tok-cp">&lt;!DOCTYPE html&gt;</span>
<span class="tok-nt">&lt;html</span> <span class="tok-na">lang=</span><span class="tok-s">&quot;es&quot;</span><span class="tok-nt">&gt;</span>
<span class="tok-nt">&lt;head&gt;</span>
	<span class="tok-nt">&lt;title&gt;</span>Carrusel jQuery<span class="tok-nt">&lt;/title&gt;</span>
	<span class="tok-nt">&lt;meta</span> <span class="tok-na">charset=</span><span class="tok-s">&quot;UTF-8&quot;</span><span class="tok-nt">&gt;</span>
	<span class="tok-nt">&lt;style </span><span class="tok-na">type=</span><span class="tok-s">&quot;text/css&quot;</span><span class="tok-nt">&gt;</span>
		<span class="tok-nf">#carrusel</span> <span class="tok-p">{</span>
			<span class="tok-k">height</span><span class="tok-o">:</span><span class="tok-m">400px</span><span class="tok-p">;</span> <span class="tok-k">width</span><span class="tok-o">:</span><span class="tok-m">400px</span><span class="tok-p">;</span>
		<span class="tok-p">}</span>
		<span class="tok-nf">#carrusel</span> <span class="tok-nt">div</span> <span class="tok-p">{</span>
			<span class="tok-k">position</span><span class="tok-o">:</span><span class="tok-k">absolute</span><span class="tok-p">;</span> <span class="tok-k">z-index</span><span class="tok-o">:</span> <span class="tok-m">0</span><span class="tok-p">;</span>
		<span class="tok-p">}</span>
		<span class="tok-nf">#carrusel</span> <span class="tok-nt">div</span><span class="tok-nc">.anterior</span> <span class="tok-p">{</span>
			<span class="tok-k">z-index</span><span class="tok-o">:</span> <span class="tok-m">1</span><span class="tok-p">;</span>
		<span class="tok-p">}</span>
		<span class="tok-nf">#carrusel</span> <span class="tok-nt">div</span><span class="tok-nc">.actual</span> <span class="tok-p">{</span>
			<span class="tok-k">z-index</span><span class="tok-o">:</span> <span class="tok-m">2</span><span class="tok-p">;</span>
		<span class="tok-p">}</span>
	<span class="tok-nt">&lt;/style&gt;</span>
<span class="tok-nt">&lt;/head&gt;</span>
<span class="tok-nt">&lt;body&gt;</span>
<span class="tok-nt">&lt;h1&gt;</span>Carrusel jQuery<span class="tok-nt">&lt;/h1&gt;</span>
<span class="tok-nt">&lt;div</span> <span class="tok-na">id=</span><span class="tok-s">&quot;carrusel&quot;</span><span class="tok-nt">&gt;</span>
	<span class="tok-nt">&lt;div</span> <span class="tok-na">class=</span><span class="tok-s">&quot;actual&quot;</span><span class="tok-nt">&gt;&lt;img</span> <span class="tok-na">src=</span><span class="tok-s">&quot;imagenes/hierba.jpg&quot;</span> <span class="tok-na">width=</span><span class="tok-s">&quot;400&quot;</span> <span class="tok-na">height=</span><span class="tok-s">&quot;400&quot;</span> <span class="tok-na">class=</span><span class="tok-s">&quot;galeria&quot;</span> <span class="tok-nt">/&gt;&lt;/div&gt;</span>
	<span class="tok-nt">&lt;div&gt;&lt;img</span> <span class="tok-na">src=</span><span class="tok-s">&quot;imagenes/hoja.jpg&quot;</span>  <span class="tok-na">width=</span><span class="tok-s">&quot;400&quot;</span> <span class="tok-na">height=</span><span class="tok-s">&quot;400&quot;</span> <span class="tok-na">class=</span><span class="tok-s">&quot;galeria&quot;</span> <span class="tok-nt">/&gt;&lt;/div&gt;</span>
	<span class="tok-nt">&lt;div&gt;&lt;img</span> <span class="tok-na">src=</span><span class="tok-s">&quot;imagenes/primavera.jpg&quot;</span> <span class="tok-na">width=</span><span class="tok-s">&quot;400&quot;</span> <span class="tok-na">height=</span><span class="tok-s">&quot;400&quot;</span> <span class="tok-na">class=</span><span class="tok-s">&quot;galeria&quot;</span> <span class="tok-nt">/&gt;&lt;/div&gt;</span>
	<span class="tok-nt">&lt;div&gt;&lt;img</span> <span class="tok-na">src=</span><span class="tok-s">&quot;imagenes/agua.jpg&quot;</span> <span class="tok-na">width=</span><span class="tok-s">&quot;400&quot;</span> <span class="tok-na">height=</span><span class="tok-s">&quot;400&quot;</span> <span class="tok-na">class=</span><span class="tok-s">&quot;galeria&quot;</span> <span class="tok-nt">/&gt;&lt;/div&gt;</span>
<span class="tok-nt">&lt;/div&gt;</span>
<span class="tok-nt">&lt;/body&gt;</span>
<span class="tok-nt">&lt;/html&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>A continuación, añadimos el código <em>jQuery</em> para que cada 2 segundos cambie de imagen, teniendo en cuenta que al llegar a la última, vuelva a mostrar la primera:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="javascript"><span class="tok-nx">$</span><span class="tok-p">(</span><span class="tok-kd">function</span> <span class="tok-p">()</span> <span class="tok-p">{</span>
	<span class="tok-nx">setInterval</span><span class="tok-p">(</span><span class="tok-s2">&quot;carruselImagenes()&quot;</span><span class="tok-p">,</span> <span class="tok-mi">2000</span><span class="tok-p">);</span>
<span class="tok-p">});</span>

<span class="tok-kd">function</span> <span class="tok-nx">carruselImagenes</span><span class="tok-p">()</span> <span class="tok-p">{</span>
	<span class="tok-kd">var</span> <span class="tok-nx">fotoActual</span> <span class="tok-o">=</span> <span class="tok-nx">$</span><span class="tok-p">(</span><span class="tok-s1">&#39;#carrusel div.actual&#39;</span><span class="tok-p">);</span>
	<span class="tok-kd">var</span> <span class="tok-nx">fotoSig</span> <span class="tok-o">=</span> <span class="tok-nx">fotoActual</span><span class="tok-p">.</span><span class="tok-nx">next</span><span class="tok-p">();</span>
	<span class="tok-k">if</span> <span class="tok-p">(</span><span class="tok-nx">fotoSig</span><span class="tok-p">.</span><span class="tok-nx">length</span> <span class="tok-o">==</span> <span class="tok-mi">0</span><span class="tok-p">)</span> <span class="tok-p">{</span>
		<span class="tok-nx">fotoSig</span> <span class="tok-o">=</span> <span class="tok-nx">$</span><span class="tok-p">(</span><span class="tok-s1">&#39;#carrusel div:first&#39;</span><span class="tok-p">);</span>	<i class="conum" data-value="1"></i><b>(1)</b>
	<span class="tok-p">}</span>
	<span class="tok-nx">fotoActual</span><span class="tok-p">.</span><span class="tok-nx">removeClass</span><span class="tok-p">(</span><span class="tok-s1">&#39;actual&#39;</span><span class="tok-p">).</span><span class="tok-nx">addClass</span><span class="tok-p">(</span><span class="tok-s1">&#39;anterior&#39;</span><span class="tok-p">);</span>	<i class="conum" data-value="2"></i><b>(2)</b>
	<span class="tok-nx">fotoSig</span><span class="tok-p">.</span><span class="tok-nx">css</span><span class="tok-p">({</span> <span class="tok-nx">opacity</span><span class="tok-o">:</span> <span class="tok-mf">0.0</span> <span class="tok-p">}).</span><span class="tok-nx">addClass</span><span class="tok-p">(</span><span class="tok-s1">&#39;actual&#39;</span><span class="tok-p">)</span>	<i class="conum" data-value="3"></i><b>(3)</b>
		<span class="tok-p">.</span><span class="tok-nx">animate</span><span class="tok-p">({</span> <span class="tok-nx">opacity</span><span class="tok-o">:</span> <span class="tok-mf">1.0</span> <span class="tok-p">},</span> <span class="tok-mi">1000</span><span class="tok-p">,</span> <i class="conum" data-value="4"></i><b>(4)</b>
			<span class="tok-kd">function</span> <span class="tok-p">()</span> <span class="tok-p">{</span> <span class="tok-nx">fotoActual</span><span class="tok-p">.</span><span class="tok-nx">removeClass</span><span class="tok-p">(</span><span class="tok-s1">&#39;anterior&#39;</span><span class="tok-p">);</span> <span class="tok-p">});</span>	<i class="conum" data-value="5"></i><b>(5)</b>
<span class="tok-p">}</span></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Si la siguiente foto es la última, seleccionamos la primera foto</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Cambiamos la clase CSS de la foto actual para que se posicione detrás y se oculte</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>La siguiente foto la hacemos transparente, la marcamos como actual</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Le añadimos una animación de 1 segundo en la que pasa de transparente a visible</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>Al terminar la animación, le quitamos la clase de <code>anterior</code> para que pase al frente</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_deshabilitando_los_efectos">7.1.6. Deshabilitando los efectos</h4>
<div class="paragraph">
<p>Si el sistema donde corre nuestra aplicación es poco potente, podemos deshabilitar todos los efectos y animaciones haciendo uso de la propiedad booleana <code>jQuery.fx.off</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="javascript"><span class="tok-nx">$</span><span class="tok-p">.</span><span class="tok-nx">fx</span><span class="tok-p">.</span><span class="tok-nx">off</span> <span class="tok-o">=</span> <span class="tok-kc">true</span><span class="tok-p">;</span>
<span class="tok-c1">// Volvemos a activar los efectos</span>
<span class="tok-nx">$</span><span class="tok-p">.</span><span class="tok-nx">fx</span><span class="tok-p">.</span><span class="tok-nx">off</span> <span class="tok-o">=</span> <span class="tok-kc">false</span><span class="tok-p">;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Al estar deshabilitadas, los elementos aparecerán y desaparecer sin ningún tipo de animación.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_ajax_2">7.2. AJAX</h3>
<div class="paragraph">
<p>Todas las peticiones AJAX realizadas con <em>jQuery</em> se realizan con el método <code>$.ajax()</code> (<a href="http://api.jquery.com/category/ajax/" class="bare">http://api.jquery.com/category/ajax/</a>).</p>
</div>
<div class="paragraph">
<p>Para simplificar el trabajo, <em>jQuery</em> ofrece varios métodos que realmente son sobrecargas sobre el método <code>$.ajax()</code>. Si comprobamos el código fuente de este función podremos ver como es mucho más complejo que lo que estudiamos en la sesión de <em>JavaScript</em>.</p>
</div>
<div class="paragraph">
<p>Los métodos que ofrece <em>jQuery</em> son:</p>
</div>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 25%;">
<col style="width: 75%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-center valign-middle">Método</th>
<th class="tableblock halign-left valign-top">Propósito</th>
</tr>
</thead>
<tbody>
<tr>
<th class="tableblock halign-center valign-middle"><p class="tableblock"><em>selector</em>.load(url)</p></th>
<td class="tableblock halign-left valign-top"><p class="tableblock">Incrustra el contenido crudo de la <em>url</em> sobre el <em>selector</em></p></td>
</tr>
<tr>
<th class="tableblock halign-center valign-middle"><p class="tableblock">$.get(url, callback, tipoDatos)</p></th>
<td class="tableblock halign-left valign-top"><p class="tableblock">Realiza una petición GET a la <em>url</em>. Una vez recuperada la respuesta, se invocará el <em>callback</em> el cual recuperará los datos del <em>tipoDatos</em></p></td>
</tr>
<tr>
<th class="tableblock halign-center valign-middle"><p class="tableblock">$.getJSON(url, callback)</p></th>
<td class="tableblock halign-left valign-top"><p class="tableblock">Similar a <code>$.get()</code> pero recuperando datos en formato JSON</p></td>
</tr>
<tr>
<th class="tableblock halign-center valign-middle"><p class="tableblock">$.getScript(url, callback)</p></th>
<td class="tableblock halign-left valign-top"><p class="tableblock">Carga un archivo <em>JavaScript</em> de la <em>url</em> mediante un petición GET, y lo ejecuta.</p></td>
</tr>
<tr>
<th class="tableblock halign-center valign-middle"><p class="tableblock">$.post(url, datos, callback)</p></th>
<td class="tableblock halign-left valign-top"><p class="tableblock">Realiza una petición POST a la <em>url</em>, enviando los datos como parámetros de la petición</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Todos estos métodos devuelven un objeto <code>jqXHR</code> el cual  abstrae el mecanismo de conexión, ya sea un objeto <code>HTMLHttpRequest</code>, un objeto <code>XMLHTTP</code> o una etiqueta <code>&lt;script&gt;</code>.</p>
</div>
<div class="sect3">
<h4 id="__code_ajax_code">7.2.1. <code>$.ajax()</code></h4>
<div class="paragraph">
<p>Ya hemos comentado que el método <code>$.ajax()</code> es el que centraliza todas las llamadas AJAX. Pese a que normalmente no lo vamos a emplear directamente, conviene conocer todas las posibilidades que ofrece. Para ello, recibe como parámetro un objeto con las siguientes propiedades:</p>
</div>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 25%;">
<col style="width: 75%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-center valign-middle">Propiedad</th>
<th class="tableblock halign-left valign-top">Propósito</th>
</tr>
</thead>
<tbody>
<tr>
<th class="tableblock halign-center valign-middle"><p class="tableblock">url</p></th>
<td class="tableblock halign-left valign-top"><p class="tableblock">URL a la que se realiza la petición</p></td>
</tr>
<tr>
<th class="tableblock halign-center valign-middle"><p class="tableblock">type</p></th>
<td class="tableblock halign-left valign-top"><p class="tableblock">Tipo de petición (GET o POST)</p></td>
</tr>
<tr>
<th class="tableblock halign-center valign-middle"><p class="tableblock">dataType</p></th>
<td class="tableblock halign-left valign-top"><p class="tableblock">Tipo de datos que devuelve la petición, ya sea texto o binario.</p></td>
</tr>
<tr>
<th class="tableblock halign-center valign-middle"><p class="tableblock">success</p></th>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>Callback</em> que se invoca cuando la petición ha sido exitosa y que recibe los datos de respuesta como parámetro</p></td>
</tr>
<tr>
<th class="tableblock halign-center valign-middle"><p class="tableblock">error</p></th>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>Callback</em> que se invoca cuando la petición ha fallado</p></td>
</tr>
<tr>
<th class="tableblock halign-center valign-middle"><p class="tableblock">complete</p></th>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>Callback</em> que se invoca cuando la petición ha finalizado</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Por ejemplo, si quisieramos recuperar el archivo <code>fichero.txt</code>, realizaríamos una llamada del siguiente modo:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="javascript"><span class="tok-nx">$</span><span class="tok-p">.</span><span class="tok-nx">ajax</span><span class="tok-p">({</span>
	<span class="tok-nx">url</span><span class="tok-o">:</span> <span class="tok-s2">&quot;fichero.txt&quot;</span><span class="tok-p">,</span>
	<span class="tok-nx">type</span><span class="tok-o">:</span> <span class="tok-s2">&quot;GET&quot;</span><span class="tok-p">,</span>
	<span class="tok-nx">dataType</span><span class="tok-o">:</span> <span class="tok-s2">&quot;text&quot;</span><span class="tok-p">,</span>
	<span class="tok-nx">success</span><span class="tok-o">:</span> <span class="tok-nx">todoOK</span><span class="tok-p">,</span>
	<span class="tok-nx">error</span><span class="tok-o">:</span> <span class="tok-nx">fallo</span><span class="tok-p">,</span>
	<span class="tok-nx">complete</span><span class="tok-o">:</span> <span class="tok-kd">function</span><span class="tok-p">(</span><span class="tok-nx">xhr</span><span class="tok-p">,</span> <span class="tok-nx">estado</span><span class="tok-p">)</span> <span class="tok-p">{</span>
		<span class="tok-nx">console</span><span class="tok-p">.</span><span class="tok-nx">log</span><span class="tok-p">(</span><span class="tok-s2">&quot;Peticion finalizada &quot;</span> <span class="tok-o">+</span> <span class="tok-nx">estado</span><span class="tok-p">);</span>
	<span class="tok-p">}</span>
<span class="tok-p">});</span>

<span class="tok-kd">function</span> <span class="tok-nx">todoOK</span><span class="tok-p">(</span><span class="tok-nx">datos</span><span class="tok-p">)</span> <span class="tok-p">{</span>
	<span class="tok-nx">console</span><span class="tok-p">.</span><span class="tok-nx">log</span><span class="tok-p">(</span><span class="tok-s2">&quot;Todo ha ido bien &quot;</span> <span class="tok-o">+</span> <span class="tok-nx">datos</span><span class="tok-p">);</span>
<span class="tok-p">}</span>

<span class="tok-kd">function</span> <span class="tok-nx">fallo</span><span class="tok-p">(</span><span class="tok-nx">xhr</span><span class="tok-p">,</span> <span class="tok-nx">estado</span><span class="tok-p">,</span> <span class="tok-nx">msjErr</span><span class="tok-p">)</span> <span class="tok-p">{</span>
	<span class="tok-nx">console</span><span class="tok-p">.</span><span class="tok-nx">log</span><span class="tok-p">(</span><span class="tok-s2">&quot;Algo ha fallado &quot;</span> <span class="tok-o">+</span> <span class="tok-nx">msjErr</span><span class="tok-p">);</span>
<span class="tok-p">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Si quisiéramos incrustar el contenido recibido por la petición, en vez de sacarlo por consola, lo podríamos añadir a una capa o un párrafo:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="javascript"><span class="tok-kd">function</span> <span class="tok-nx">todoOK</span><span class="tok-p">(</span><span class="tok-nx">datos</span><span class="tok-p">)</span> <span class="tok-p">{</span>
	<span class="tok-nx">$</span><span class="tok-p">(</span><span class="tok-s2">&quot;#resultado&quot;</span><span class="tok-p">).</span><span class="tok-nx">append</span><span class="tok-p">(</span><span class="tok-nx">datos</span><span class="tok-p">);</span>
<span class="tok-p">}</span></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="__code_load_code">7.2.2. <code>load()</code></h4>
<div class="paragraph">
<p>Si queremos incrustrar contenido proveniente de una URL, con la misma funcionalidad que un <em>include</em> estático en JSP, usaremos el método <code>load(url)</code>. Por ejemplo:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="javascript"><span class="tok-nx">$</span><span class="tok-p">(</span><span class="tok-s2">&quot;body&quot;</span><span class="tok-p">).</span><span class="tok-nx">load</span><span class="tok-p">(</span><span class="tok-s2">&quot;contacto.html&quot;</span><span class="tok-p">);</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>De este modo incluiríamos hasta la cabecera del documento html. Para indicarle que estamos interesados en una parte del documento, podemos indicar que cargue el elemento cuya clase CSS sea <code>contenido</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="javascript"><span class="tok-nx">$</span><span class="tok-p">(</span><span class="tok-s2">&quot;body&quot;</span><span class="tok-p">).</span><span class="tok-nx">load</span><span class="tok-p">(</span><span class="tok-s2">&quot;contacto.html .contenido&quot;</span><span class="tok-p">);</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Mediante este método vamos a poder incluir contenido de manera dinámica al lanzarse un evento. Supongamos que tenemos un enlace a <code>contacto.html</code>. Vamos a modificarlo para que en vez de redirigir a la página, incruste el contenido:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="html"><span class="tok-nt">&lt;a</span> <span class="tok-na">href=</span><span class="tok-s">&quot;contacto.html&quot;</span><span class="tok-nt">&gt;</span>Contacto<span class="tok-nt">&lt;/a&gt;</span>
<span class="tok-nt">&lt;div</span> <span class="tok-na">id=</span><span class="tok-s">&quot;contenedor&quot;</span><span class="tok-nt">&gt;&lt;/div&gt;</span>

<span class="tok-nt">&lt;script&gt;</span>
<span class="tok-nx">$</span><span class="tok-p">(</span><span class="tok-s1">&#39;a&#39;</span><span class="tok-p">).</span><span class="tok-nx">on</span><span class="tok-p">(</span><span class="tok-s1">&#39;click&#39;</span><span class="tok-p">,</span> <span class="tok-kd">function</span><span class="tok-p">(</span><span class="tok-nx">evt</span><span class="tok-p">)</span> <span class="tok-p">{</span>
	<span class="tok-kd">var</span> <span class="tok-nx">href</span> <span class="tok-o">=</span> <span class="tok-nx">$</span><span class="tok-p">(</span><span class="tok-k">this</span><span class="tok-p">).</span><span class="tok-nx">attr</span><span class="tok-p">(</span><span class="tok-s1">&#39;href&#39;</span><span class="tok-p">);</span>	<i class="conum" data-value="1"></i><b>(1)</b>
	<span class="tok-nx">$</span><span class="tok-p">(</span><span class="tok-s1">&#39;#contenedor&#39;</span><span class="tok-p">).</span><span class="tok-nx">load</span><span class="tok-p">(</span><span class="tok-nx">href</span> <span class="tok-o">+</span> <span class="tok-s1">&#39; .contenido&#39;</span><span class="tok-p">);</span>	<i class="conum" data-value="2"></i><b>(2)</b>
	<span class="tok-nx">evt</span><span class="tok-p">.</span><span class="tok-nx">preventDefault</span><span class="tok-p">();</span>	<i class="conum" data-value="3"></i><b>(3)</b>
<span class="tok-p">});</span>
<span class="tok-nt">&lt;/script&gt;</span></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Obtenemos el documento que queremos incluir</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Incrustamos el contenido del documento dentro de la capa con id <code>contenedor</code></td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Evitamos que cargue el enlace</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_recibiendo_información_del_servidor">7.2.3. Recibiendo información del servidor</h4>
<div class="paragraph">
<p>Mediante <code>$.get(url [,datos], callBack(datosRespuesta) [,tipoDatosRespuesta])</code> se envía una petición GET con <code>datos</code> como parámetro. Tras responder el servidor, se ejecutará el <em>callBack</em> con los datos recibidos cuyo tipo son del <code>tipoDatosRespuesta</code>.</p>
</div>
<div class="paragraph">
<p>Así pues, el mismo ejemplo visto anteriormente puede quedar reducido al siguiente fragmento:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="javascript"><span class="tok-nx">$</span><span class="tok-p">.</span><span class="tok-nx">get</span><span class="tok-p">(</span><span class="tok-s2">&quot;fichero.txt&quot;</span><span class="tok-p">,</span> <span class="tok-kd">function</span><span class="tok-p">(</span><span class="tok-nx">datos</span><span class="tok-p">)</span> <span class="tok-p">{</span>
	<span class="tok-nx">console</span><span class="tok-p">.</span><span class="tok-nx">log</span><span class="tok-p">(</span><span class="tok-nx">datos</span><span class="tok-p">);</span>
<span class="tok-p">});</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>En el caso de <strong><em>XML</em></strong>, seguiremos usando el mismo método pero hemos de tener en cuenta el formato del documento. Supongamos que tenemos el siguiente documento <code>heroes.xml</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><span class="tok-nt">&lt;heroe&gt;</span>
	<span class="tok-nt">&lt;nombre&gt;</span>Batman<span class="tok-nt">&lt;/nombre&gt;</span>
	<span class="tok-nt">&lt;email&gt;</span>batman@heroes.com<span class="tok-nt">&lt;/email&gt;</span>
<span class="tok-nt">&lt;/heroe&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Para poder recuperar el contenido hemos de tener el cuenta que trabajaremos con las funciones DOM que ya conocemos:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="javascript"><span class="tok-nx">$</span><span class="tok-p">.</span><span class="tok-nx">get</span><span class="tok-p">(</span><span class="tok-s2">&quot;heroes.xml&quot;</span><span class="tok-p">,</span> <span class="tok-kd">function</span><span class="tok-p">(</span><span class="tok-nx">datos</span><span class="tok-p">)</span> <span class="tok-p">{</span>
	<span class="tok-kd">var</span> <span class="tok-nx">nombre</span> <span class="tok-o">=</span> <span class="tok-nx">datos</span><span class="tok-p">.</span><span class="tok-nx">getElementsByTagName</span><span class="tok-p">(</span><span class="tok-s2">&quot;nombre&quot;</span><span class="tok-p">)[</span><span class="tok-mi">0</span><span class="tok-p">];</span>
	<span class="tok-kd">var</span> <span class="tok-nx">email</span> <span class="tok-o">=</span> <span class="tok-nx">datos</span><span class="tok-p">.</span><span class="tok-nx">getElementsByTagName</span><span class="tok-p">(</span><span class="tok-s2">&quot;email&quot;</span><span class="tok-p">)[</span><span class="tok-mi">0</span><span class="tok-p">];</span>
	<span class="tok-kd">var</span> <span class="tok-nx">val</span> <span class="tok-o">=</span> <span class="tok-nx">nombre</span><span class="tok-p">.</span><span class="tok-nx">firstChild</span><span class="tok-p">.</span><span class="tok-nx">nodeValue</span> <span class="tok-o">+</span> <span class="tok-s2">&quot; &quot;</span> <span class="tok-o">+</span> <span class="tok-nx">email</span><span class="tok-p">.</span><span class="tok-nx">firstChild</span><span class="tok-p">.</span><span class="tok-nx">nodeValue</span><span class="tok-p">;</span>
	<span class="tok-nx">$</span><span class="tok-p">(</span><span class="tok-s2">&quot;#resultado&quot;</span><span class="tok-p">).</span><span class="tok-nx">append</span><span class="tok-p">(</span><span class="tok-nx">val</span><span class="tok-p">);</span>
<span class="tok-p">},</span><span class="tok-s2">&quot;xml&quot;</span><span class="tok-p">);</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Si la información a recuperar es de tipo <strong><em>JSON</em></strong>, <em>jQuery</em> ofrece el método <code>$.getJSON(url [,datos], callBack(datosRespuesta))</code>.</p>
</div>
<div class="paragraph">
<p>Por ejemplo, supongamos que queremos acceder a <em>Flickr</em> para obtener las imágenes que tienen cierta etiqueta:</p>
</div>
<div class="listingblock">
<div class="title">Ejemplo getJSON Flickr - <a href="http://jsbin.com/hunape/1/edit?html,js,output" class="bare">http://jsbin.com/hunape/1/edit?html,js,output</a></div>
<div class="content">
<pre class="pygments highlight"><code data-lang="javascript"><span class="tok-kd">var</span> <span class="tok-nx">flickrAPI</span> <span class="tok-o">=</span> <span class="tok-s2">&quot;http://api.flickr.com/services/feeds/photos_public.gne?jsoncallback=?&quot;</span><span class="tok-p">;</span>
<span class="tok-nx">$</span><span class="tok-p">.</span><span class="tok-nx">getJSON</span><span class="tok-p">(</span> <span class="tok-nx">flickrAPI</span><span class="tok-p">,</span> <span class="tok-p">{</span>
	<span class="tok-nx">tags</span><span class="tok-o">:</span> <span class="tok-s2">&quot;proyecto víbora ii&quot;</span><span class="tok-p">,</span>
	<span class="tok-nx">tagmode</span><span class="tok-o">:</span> <span class="tok-s2">&quot;any&quot;</span><span class="tok-p">,</span>
	<span class="tok-nx">format</span><span class="tok-o">:</span> <span class="tok-s2">&quot;json&quot;</span>
<span class="tok-p">},</span> <span class="tok-nx">formateaImagenes</span><span class="tok-p">);</span>

<span class="tok-kd">function</span> <span class="tok-nx">formateaImagenes</span><span class="tok-p">(</span><span class="tok-nx">datos</span><span class="tok-p">)</span> <span class="tok-p">{</span>
	<span class="tok-nx">$</span><span class="tok-p">.</span><span class="tok-nx">each</span><span class="tok-p">(</span><span class="tok-nx">datos</span><span class="tok-p">.</span><span class="tok-nx">items</span><span class="tok-p">,</span> <span class="tok-kd">function</span><span class="tok-p">(</span><span class="tok-nx">i</span><span class="tok-p">,</span> <span class="tok-nx">elemento</span><span class="tok-p">)</span> <span class="tok-p">{</span>	<i class="conum" data-value="1"></i><b>(1)</b>
		<span class="tok-nx">$</span><span class="tok-p">(</span><span class="tok-s2">&quot;&lt;img&gt;&quot;</span><span class="tok-p">).</span><span class="tok-nx">attr</span><span class="tok-p">(</span><span class="tok-s2">&quot;src&quot;</span><span class="tok-p">,</span> <span class="tok-nx">elemento</span><span class="tok-p">.</span><span class="tok-nx">media</span><span class="tok-p">.</span><span class="tok-nx">m</span><span class="tok-p">).</span><span class="tok-nx">appendTo</span><span class="tok-p">(</span><span class="tok-s2">&quot;#contenido&quot;</span><span class="tok-p">);</span>	<i class="conum" data-value="2"></i><b>(2)</b>
		<span class="tok-k">if</span> <span class="tok-p">(</span><span class="tok-nx">i</span> <span class="tok-o">===</span> <span class="tok-mi">4</span><span class="tok-p">)</span> <span class="tok-p">{</span>	<i class="conum" data-value="3"></i><b>(3)</b>
			<span class="tok-k">return</span> <span class="tok-kc">false</span><span class="tok-p">;</span>
		<span class="tok-p">}</span>
	<span class="tok-p">});</span>
<span class="tok-p">}</span></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>la función <code>$.each(<em>colección</em>, <em>callback(índice, elemento)</em>)</code> recorre el array y realiza una llamada al <em>callback</em> para cada uno de los elementos</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Por cada imagen, la anexa al id <code>contenido</code> construyendo una etiqueta <code>img</code></td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Limita el número de imágenes a mostrar en 5. Cuando el <em>callback</em> de <code>$.each()</code> devuelve <code>false</code>, detiene la iteración sobre el array</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="title">$.each()</div>
<div class="paragraph">
<p>La utilidad $.each() se trata de un método auxiliar que ofrece <em>jQuery</em> para iterar sobre una colección, ya sea:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>un array mediante <code>$.each(<em>colección</em>, <em>callback(índice, elemento)</em>)</code></p>
</li>
<li>
<p>un conjunto de selectores con <code>$(selector).each(<em>callback(índice, elemento)</em>)</code></p>
</li>
<li>
<p>o las propiedades de un objeto mediante <code>$.each(<em>objeto</em>, <em>callback(clave, valor)</em>)</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Se emplea mucho para tratar la respuesta de las peticiones AJAX.
Más información en <a href="http://api.jquery.com/jquery.each/" class="bare">http://api.jquery.com/jquery.each/</a></p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Finalmente, en ocasiones necesitamos inyectar código adicional al vuelo. Para ello, podemos recuperar un archivo <strong><em>JavaScript</em></strong> y que lo ejecute a continuación mediante el método <code>$.getScript(urlScript, callback)</code>. Una vez finalizada la ejecución del script, se invocará al <em>callback</em>.</p>
</div>
<div class="paragraph">
<p>Supongamos que tenemos el siguiente código en <code>script.js</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="javascript"><span class="tok-nx">console</span><span class="tok-p">.</span><span class="tok-nx">log</span><span class="tok-p">(</span><span class="tok-s2">&quot;Ejecutado dentro del script&quot;</span><span class="tok-p">);</span>
<span class="tok-nx">$</span><span class="tok-p">(</span><span class="tok-s2">&quot;#resultado&quot;</span><span class="tok-p">).</span><span class="tok-nx">html</span><span class="tok-p">(</span><span class="tok-s2">&quot;&lt;strong&gt;getScript&lt;/strong&gt;&quot;</span><span class="tok-p">);</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Y el código <em>jQuery</em> que ejecuta el script:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="javascript"><span class="tok-nx">$</span><span class="tok-p">.</span><span class="tok-nx">getScript</span><span class="tok-p">(</span><span class="tok-s2">&quot;script.js&quot;</span><span class="tok-p">,</span> <span class="tok-kd">function</span><span class="tok-p">(</span><span class="tok-nx">datos</span><span class="tok-p">,</span> <span class="tok-nx">statusTxt</span><span class="tok-p">)</span> <span class="tok-p">{</span>
	<span class="tok-nx">console</span><span class="tok-p">.</span><span class="tok-nx">log</span><span class="tok-p">(</span><span class="tok-nx">statusTxt</span><span class="tok-p">);</span>
<span class="tok-p">})</span></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_enviando_información_al_servidor">7.2.4. Enviando información al servidor</h4>
<div class="paragraph">
<p>La función <code>$.post(url, datos, callback(datosRespuesta))</code> permite enviar datos mediante una petición POST.</p>
</div>
<div class="paragraph">
<p>Una singularidad es la manera de adjuntar los datos en la petición, ya sea:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Creando un objeto cuyos valores obtenemos mediante <code>val()</code>.</p>
</li>
<li>
<p>Serializando el formulario mediante el método <code>serialize()</code>, el cual codifica los elementos del formulario mediante una cadena de texto</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Vamos a crear un ejemplo con un formulario sencillo para realizar el envío mediante AJAX:</p>
</div>
<div class="listingblock">
<div class="title">Ejemplo AJAX POST</div>
<div class="content">
<pre class="pygments highlight"><code data-lang="html"><span class="tok-nt">&lt;form</span> <span class="tok-na">name=</span><span class="tok-s">&quot;formCliente&quot;</span> <span class="tok-na">id=</span><span class="tok-s">&quot;frmClnt&quot;</span> <span class="tok-na">action=</span><span class="tok-s">&quot;#&quot;</span><span class="tok-nt">&gt;</span>
<span class="tok-nt">&lt;fieldset</span> <span class="tok-na">id=</span><span class="tok-s">&quot;infoPersonal&quot;</span><span class="tok-nt">&gt;</span>
	<span class="tok-nt">&lt;legend&gt;</span>Datos Personales<span class="tok-nt">&lt;/legend&gt;</span>
	<span class="tok-nt">&lt;p&gt;&lt;label</span> <span class="tok-na">for=</span><span class="tok-s">&quot;nombre&quot;</span><span class="tok-nt">&gt;</span>Nombre<span class="tok-nt">&lt;/label&gt;</span>
		<span class="tok-nt">&lt;input</span> <span class="tok-na">type=</span><span class="tok-s">&quot;text&quot;</span> <span class="tok-na">name=</span><span class="tok-s">&quot;nombre&quot;</span> <span class="tok-na">id=</span><span class="tok-s">&quot;idNombre&quot;</span> <span class="tok-nt">/&gt;&lt;/p&gt;</span>
	<span class="tok-nt">&lt;p&gt;&lt;label</span> <span class="tok-na">for=</span><span class="tok-s">&quot;correo&quot;</span><span class="tok-nt">&gt;</span>Email<span class="tok-nt">&lt;/label&gt;</span>
		<span class="tok-nt">&lt;input</span> <span class="tok-na">type=</span><span class="tok-s">&quot;email&quot;</span> <span class="tok-na">name=</span><span class="tok-s">&quot;correo&quot;</span> <span class="tok-na">id=</span><span class="tok-s">&quot;idEmail&quot;</span> <span class="tok-nt">/&gt;&lt;/p&gt;</span>
<span class="tok-nt">&lt;/fieldset&gt;</span>
<span class="tok-nt">&lt;p&gt;&lt;button</span> <span class="tok-na">type=</span><span class="tok-s">&quot;submit&quot;</span><span class="tok-nt">&gt;</span>Guardar<span class="tok-nt">&lt;/button&gt;&lt;/p&gt;</span>
<span class="tok-nt">&lt;/form&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Y el código que se comunica con el servidor:</p>
</div>
<div class="listingblock">
<div class="title">Ejemplo <code>$.post()</code></div>
<div class="content">
<pre class="pygments highlight"><code data-lang="javascript"><span class="tok-nx">$</span><span class="tok-p">(</span><span class="tok-s1">&#39;form&#39;</span><span class="tok-p">).</span><span class="tok-nx">on</span><span class="tok-p">(</span><span class="tok-s1">&#39;submit&#39;</span><span class="tok-p">,</span> <span class="tok-kd">function</span><span class="tok-p">(</span><span class="tok-nx">evt</span><span class="tok-p">)</span> <span class="tok-p">{</span>	<i class="conum" data-value="1"></i><b>(1)</b>
	<span class="tok-nx">evt</span><span class="tok-p">.</span><span class="tok-nx">preventDefault</span><span class="tok-p">();</span>		<i class="conum" data-value="2"></i><b>(2)</b>
	<span class="tok-c1">// var nom = $(this).find(&#39;#inputName&#39;).val();	</span><i class="conum" data-value="3"></i><b>(3)</b>
	<span class="tok-kd">var</span> <span class="tok-nx">datos</span> <span class="tok-o">=</span> <span class="tok-nx">$</span><span class="tok-p">(</span><span class="tok-k">this</span><span class="tok-p">).</span><span class="tok-nx">serialize</span><span class="tok-p">();</span>	<span class="tok-c1">// nombre=asdf&amp;email=asdf</span>
	<span class="tok-nx">$</span><span class="tok-p">.</span><span class="tok-nx">post</span><span class="tok-p">(</span><span class="tok-s2">&quot;/GuardaFormServlet&quot;</span><span class="tok-p">,</span> <span class="tok-nx">datos</span><span class="tok-p">,</span> <span class="tok-kd">function</span> <span class="tok-p">(</span><span class="tok-nx">respuestaServidor</span><span class="tok-p">)</span> <span class="tok-p">{</span>	<i class="conum" data-value="4"></i><b>(4)</b>
		<span class="tok-nx">console</span><span class="tok-p">.</span><span class="tok-nx">log</span><span class="tok-p">(</span><span class="tok-s2">&quot;Completado &quot;</span> <span class="tok-o">+</span> <span class="tok-nx">respuestaServidor</span><span class="tok-p">);</span>
	<span class="tok-p">});</span>
<span class="tok-p">});</span></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Escuchamos el evento de <em>submit</em></td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Desactivar el envío por defecto del formulario</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Obtener el contenido de los campos, lo cual podemos hacerlo campo por campo como en la línea 3, u obtener una representación de los datos como parámetros de una URL mediante el método <code>serialize()</code> como en la línea 4.</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Enviar el contenido a un script del servidor y recuperamos la respuesta. Mediante <code>$.post()</code> le pasaremos el destino del envío, los datos a envíar y una función <em>callback</em> que se llamará cuando el servidor finalice la petición.</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_tipos_de_datos">7.2.5. Tipos de datos</h4>
<div class="paragraph">
<p>Ya hemos visto que podemos trabajar con cuatro tipos de datos. A continuación vamos a estudiarlos para averiguar cuando conviene usar uno u otro:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Fragmentos <em>HTML</em></strong> necesitan poco para funcionar, ya que mediante <code>load()</code> podemos cargarlos sin necesidad de ejecutar ningún <em>callback</em>. Como inconveniente, los datos puede que no tengan ni la estructura ni el formato que necesitemos, con lo que estamos acoplando nuestro contenido con el externo.</p>
</li>
<li>
<p><strong>Archivos <em>JSON</em></strong>, que permiten estructurar la información para su reutilización. Compactos y fáciles de usar, donde la información es auto-explicativa y se puede manejar mediante objetos mediante <code>JSON.parse()</code> y <code>JSON.stringify()</code>. Hay que tener cuidado con errores en el contenido de los archivos ya que pueden provocar efectos colaterales.</p>
</li>
<li>
<p><strong>Archivos <em>JavaScript</em></strong>, ofrecen flexibilidad pero no son realmente un mecanismo de almacenamiento, ya que no podemos usarlos desde sistemas heterogéneos. La posibilidad de cargar scripts <em>JavaScripts</em> en caliente permite refactorizar el código en archivos externos, reduciendo el tamaño del código hasta que sea necesario.</p>
</li>
<li>
<p><strong>Archivos <em>XML</em></strong>, han perdido mercado en favor de JSON, pero se sigue utilizando para permitir que sistemas de terceros sin importar la tecnología de acceso puedan conectarse a nuestros sistemas.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>A día de hoy, JSON tiene todas las de ganar, tanto por rendimiento en las comunicaciones como por el tamaño de la información a transmitir.</p>
</div>
</div>
<div class="sect3">
<h4 id="_manejadores_de_eventos_ajax">7.2.6. Manejadores de eventos AJAX</h4>
<div class="paragraph">
<p><em>jQuery</em> ofrece un conjunto de métodos globales para interactuar con los eventos que se lanzan al realizar una petición AJAX. Estos métodos no los llamamos dentro de la aplicación, sino que es el navegador el que realiza las llamadas.</p>
</div>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 25%;">
<col style="width: 75%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-center valign-middle">Método</th>
<th class="tableblock halign-left valign-top">Propósito</th>
</tr>
</thead>
<tbody>
<tr>
<th class="tableblock halign-center valign-middle"><p class="tableblock">ajaxComplete()</p></th>
<td class="tableblock halign-left valign-top"><p class="tableblock">Registra un manejador que se invocará cuando la petición AJAX se complete</p></td>
</tr>
<tr>
<th class="tableblock halign-center valign-middle"><p class="tableblock">ajaxError()</p></th>
<td class="tableblock halign-left valign-top"><p class="tableblock">Registra un manejador que se invocará cuando la petición AJAX se complete con un error</p></td>
</tr>
<tr>
<th class="tableblock halign-center valign-middle"><p class="tableblock">ajaxStart()</p></th>
<td class="tableblock halign-left valign-top"><p class="tableblock">Registra un manejador que se invocará cuando la primera petición AJAX comience</p></td>
</tr>
<tr>
<th class="tableblock halign-center valign-middle"><p class="tableblock">ajaxStop()</p></th>
<td class="tableblock halign-left valign-top"><p class="tableblock">Registra un manejador que se invocará cuando todas las peticiones AJAX hayan finalizado</p></td>
</tr>
<tr>
<th class="tableblock halign-center valign-middle"><p class="tableblock">ajaxSend()</p></th>
<td class="tableblock halign-left valign-top"><p class="tableblock">Adjunta una función que se invocará antes de enviar la petición AJAX</p></td>
</tr>
<tr>
<th class="tableblock halign-center valign-middle"><p class="tableblock">ajaxSuccess()</p></th>
<td class="tableblock halign-left valign-top"><p class="tableblock">Adjunta una función que se invocará cuando una petición AJAX finalice correctamente</p></td>
</tr>
</tbody>
</table>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
Recordad que estos métodos son globales y se ejecutan para todas las peticiones AJAX de nuestra aplicación, de ahí que se sólo se adjunten al objeto <code>document</code>.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Por ejemplo, si antes de recuperar el archivo de texto registramos todos estos manejadores:</p>
</div>
<div class="listingblock">
<div class="title">Ejemplo Manejadores AJAX - <a href="http://jsbin.com/loqace/edit?js,console" class="bare">http://jsbin.com/loqace/edit?js,console</a></div>
<div class="content">
<pre class="pygments highlight"><code data-lang="javascript"><span class="tok-nx">$</span><span class="tok-p">(</span><span class="tok-nb">document</span><span class="tok-p">).</span><span class="tok-nx">ready</span><span class="tok-p">(</span><span class="tok-kd">function</span><span class="tok-p">()</span> <span class="tok-p">{</span>
  <span class="tok-nx">$</span><span class="tok-p">(</span><span class="tok-nb">document</span><span class="tok-p">).</span><span class="tok-nx">ajaxStart</span><span class="tok-p">(</span><span class="tok-kd">function</span> <span class="tok-p">()</span> <span class="tok-p">{</span>
    <span class="tok-nx">console</span><span class="tok-p">.</span><span class="tok-nx">log</span><span class="tok-p">(</span><span class="tok-s2">&quot;AJAX comenzando&quot;</span><span class="tok-p">);</span>
  <span class="tok-p">});</span>
  <span class="tok-nx">$</span><span class="tok-p">(</span><span class="tok-nb">document</span><span class="tok-p">).</span><span class="tok-nx">ajaxStop</span><span class="tok-p">(</span><span class="tok-kd">function</span> <span class="tok-p">()</span> <span class="tok-p">{</span>
    <span class="tok-nx">console</span><span class="tok-p">.</span><span class="tok-nx">log</span><span class="tok-p">(</span><span class="tok-s2">&quot;AJAX petición finalizada&quot;</span><span class="tok-p">);</span>
  <span class="tok-p">});</span>
  <span class="tok-nx">$</span><span class="tok-p">(</span><span class="tok-nb">document</span><span class="tok-p">).</span><span class="tok-nx">ajaxSend</span><span class="tok-p">(</span><span class="tok-kd">function</span> <span class="tok-p">()</span> <span class="tok-p">{</span>
    <span class="tok-nx">console</span><span class="tok-p">.</span><span class="tok-nx">log</span><span class="tok-p">(</span><span class="tok-s2">&quot;Antes de enviar la información...&quot;</span><span class="tok-p">);</span>
  <span class="tok-p">});</span>
  <span class="tok-nx">$</span><span class="tok-p">(</span><span class="tok-nb">document</span><span class="tok-p">).</span><span class="tok-nx">ajaxComplete</span><span class="tok-p">(</span><span class="tok-kd">function</span> <span class="tok-p">()</span> <span class="tok-p">{</span>
    <span class="tok-nx">console</span><span class="tok-p">.</span><span class="tok-nx">log</span><span class="tok-p">(</span><span class="tok-s2">&quot;Todo ha finalizado!&quot;</span><span class="tok-p">);</span>
  <span class="tok-p">});</span>
  <span class="tok-nx">$</span><span class="tok-p">(</span><span class="tok-nb">document</span><span class="tok-p">).</span><span class="tok-nx">ajaxError</span><span class="tok-p">(</span><span class="tok-kd">function</span> <span class="tok-p">(</span><span class="tok-nx">evt</span><span class="tok-p">,</span> <span class="tok-nx">jqXHR</span><span class="tok-p">,</span> <span class="tok-nx">settings</span><span class="tok-p">,</span> <span class="tok-nx">err</span><span class="tok-p">)</span> <span class="tok-p">{</span>
    <span class="tok-nx">console</span><span class="tok-p">.</span><span class="tok-nx">error</span><span class="tok-p">(</span><span class="tok-s2">&quot;Houston, tenemos un problema: &quot;</span> <span class="tok-o">+</span> <span class="tok-nx">evt</span> <span class="tok-o">+</span> <span class="tok-s2">&quot; - jq:&quot;</span> <span class="tok-o">+</span> <span class="tok-nx">jqXHR</span> <span class="tok-o">+</span> <span class="tok-s2">&quot; - settings :&quot;</span> <span class="tok-o">+</span> <span class="tok-nx">settings</span> <span class="tok-o">+</span> <span class="tok-s2">&quot; err:&quot;</span> <span class="tok-o">+</span> <span class="tok-nx">err</span><span class="tok-p">);</span>
  <span class="tok-p">});</span>
  <span class="tok-nx">$</span><span class="tok-p">(</span><span class="tok-nb">document</span><span class="tok-p">).</span><span class="tok-nx">ajaxSuccess</span><span class="tok-p">(</span><span class="tok-kd">function</span> <span class="tok-p">()</span> <span class="tok-p">{</span>
    <span class="tok-nx">console</span><span class="tok-p">.</span><span class="tok-nx">log</span><span class="tok-p">(</span><span class="tok-s2">&quot;Parece que ha funcionado todo!&quot;</span><span class="tok-p">);</span>
  <span class="tok-p">});</span>

  <span class="tok-nx">getDatos</span><span class="tok-p">();</span>
<span class="tok-p">});</span>

<span class="tok-kd">function</span> <span class="tok-nx">getDatos</span><span class="tok-p">()</span> <span class="tok-p">{</span>
	<span class="tok-nx">$</span><span class="tok-p">.</span><span class="tok-nx">getJSON</span><span class="tok-p">(</span><span class="tok-s2">&quot;http://www.omdbapi.com/?s=batman&amp;callback=?&quot;</span><span class="tok-p">,</span> <span class="tok-nx">todoOk</span><span class="tok-p">);</span>
<span class="tok-p">}</span>

<span class="tok-kd">function</span> <span class="tok-nx">todoOk</span><span class="tok-p">(</span><span class="tok-nx">datos</span><span class="tok-p">)</span> <span class="tok-p">{</span>
	<span class="tok-nx">console</span><span class="tok-p">.</span><span class="tok-nx">log</span><span class="tok-p">(</span><span class="tok-s2">&quot;Datos recibidos y adjuntándolos a resultado&quot;</span><span class="tok-p">);</span>
	<span class="tok-nx">$</span><span class="tok-p">(</span><span class="tok-s2">&quot;#resultado&quot;</span><span class="tok-p">).</span><span class="tok-nx">append</span><span class="tok-p">(</span><span class="tok-nx">JSON</span><span class="tok-p">.</span><span class="tok-nx">stringify</span><span class="tok-p">(</span><span class="tok-nx">datos</span><span class="tok-p">));</span>
<span class="tok-p">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Tras ejecutar el código, por la consola aparecerán los siguientes mensajes en el orden en el que se ejecutan:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/js07/js07EventosAJAX.jpg" alt="Eventos AJAX">
</div>
<div class="title">Figure 46. Eventos globales AJAX</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="title">Autoevaluación</div>
<div class="paragraph">
<p>Si en el código renombramos la URL por la de un fichero que no encuentra, ¿Qué evento se lanza ahora y cual deja de lanzarse? <span class="footnote">[<a id="_footnoteref_12" class="footnote" href="#_footnote_12" title="View footnote.">12</a>]</span>
¿Qué saldrá por consola? <span class="footnote">[<a id="_footnoteref_13" class="footnote" href="#_footnote_13" title="View footnote.">13</a>]</span></p>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_utilidades">7.3. Utilidades</h3>
<div class="paragraph">
<p>A continuación veremos un conjunto de utilidades que ofrece <em>jQuery</em>.</p>
</div>
<div class="sect3">
<h4 id="_comprobación_de_tipos">7.3.1. Comprobación de tipos</h4>
<div class="paragraph">
<p>El siguiente conjunto de funciones de comprobación de tipos, también conocidas como de introspección de objetos, nos van a permitir:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Determinar el tipo de un objeto</p>
</li>
<li>
<p>Gestionar el uso de parámetros opcionales</p>
</li>
<li>
<p>Validar parámetros</p>
</li>
</ul>
</div>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 25%;">
<col style="width: 75%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-center valign-middle">Función</th>
<th class="tableblock halign-left valign-top">Propósito</th>
</tr>
</thead>
<tbody>
<tr>
<th class="tableblock halign-center valign-middle"><p class="tableblock">$.isArray(<em>array</em>)</p></th>
<td class="tableblock halign-left valign-top"><p class="tableblock">Determina si <em>array</em> es un <em>Array</em>. Si es un objeto <em>array-like</em> devolverá falso</p></td>
</tr>
<tr>
<th class="tableblock halign-center valign-middle"><p class="tableblock">$.isFunction(<em>función</em>)</p></th>
<td class="tableblock halign-left valign-top"><p class="tableblock">Determina si <em>función</em> es una Función</p></td>
</tr>
<tr>
<th class="tableblock halign-center valign-middle"><p class="tableblock">$.isEmptyObject(<em>objeto</em>)</p></th>
<td class="tableblock halign-left valign-top"><p class="tableblock">Determina si <em>objeto</em> esta vacío</p></td>
</tr>
<tr>
<th class="tableblock halign-center valign-middle"><p class="tableblock">$.isPlainObject(<em>objeto</em>)</p></th>
<td class="tableblock halign-left valign-top"><p class="tableblock">Determina si <em>objeto</em> es un objeto sencillo, creado como un objeto literal (mediante las llaves) o mediante <code>new objeto</code>.</p></td>
</tr>
<tr>
<th class="tableblock halign-center valign-middle"><p class="tableblock">$.isXmlDoc(<em>documento</em>)</p></th>
<td class="tableblock halign-left valign-top"><p class="tableblock">Determina si el <em>documento</em> es un documento XML o un nodo XML</p></td>
</tr>
<tr>
<th class="tableblock halign-center valign-middle"><p class="tableblock">$.isNumeric(<em>objeto</em>)</p></th>
<td class="tableblock halign-left valign-top"><p class="tableblock">Determina si <em>objeto</em> es un valor numérico escalar.</p></td>
</tr>
<tr>
<th class="tableblock halign-center valign-middle"><p class="tableblock">$.isWindow(<em>objeto</em>)</p></th>
<td class="tableblock halign-left valign-top"><p class="tableblock">Determina si <em>objeto</em> representa una ventana de navegador</p></td>
</tr>
<tr>
<th class="tableblock halign-center valign-middle"><p class="tableblock">$.type(<em>objeto</em>)</p></th>
<td class="tableblock halign-left valign-top"><p class="tableblock">Obtiene la clase <em>Javascript</em> del <em>objeto</em>. Los posibles valores son <code>boolean</code>, <code>number</code>, <code>string</code>, <code>function</code>, <code>array</code>, <code>date</code>, <code>regexp</code>, <code>object</code>, <code>undefined</code> o <code>null</code></p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Para ver estas utilidades en funcionamiento, vamos a crear un ejemplo sobre un fragmento de código que realiza una llamada a una función:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="javascript"><span class="tok-kd">function</span> <span class="tok-nx">llamaOtraFuncion</span><span class="tok-p">(</span><span class="tok-nx">veces</span><span class="tok-p">,</span> <span class="tok-nx">retraso</span><span class="tok-p">,</span> <span class="tok-nx">funcion</span><span class="tok-p">)</span> <span class="tok-p">{</span>
	<span class="tok-kd">var</span> <span class="tok-nx">i</span> <span class="tok-o">=</span> <span class="tok-mi">0</span><span class="tok-p">;</span>
	<span class="tok-p">(</span> <span class="tok-kd">function</span> <span class="tok-nx">bucle</span><span class="tok-p">()</span> <span class="tok-p">{</span>
		<span class="tok-nx">i</span><span class="tok-o">++</span><span class="tok-p">;</span>
		<span class="tok-nx">funcion</span><span class="tok-p">();</span>
		<span class="tok-k">if</span> <span class="tok-p">(</span><span class="tok-nx">i</span> <span class="tok-o">&lt;</span> <span class="tok-nx">veces</span><span class="tok-p">)</span> <span class="tok-p">{</span>
			<span class="tok-nx">setTimeout</span><span class="tok-p">(</span><span class="tok-nx">bucle</span><span class="tok-p">,</span> <span class="tok-nx">retraso</span><span class="tok-p">);</span>
		<span class="tok-p">}</span>
	<span class="tok-p">})();</span>
<span class="tok-p">}</span>

<span class="tok-kd">function</span> <span class="tok-nx">saluda</span><span class="tok-p">()</span> <span class="tok-p">{</span>
	<span class="tok-nx">$</span><span class="tok-p">(</span><span class="tok-s2">&quot;#resultado&quot;</span><span class="tok-p">).</span><span class="tok-nx">append</span><span class="tok-p">(</span><span class="tok-s2">&quot;Saludando desde la función &lt;br /&gt;&quot;</span><span class="tok-p">);</span>
<span class="tok-p">}</span>

<span class="tok-nx">$</span><span class="tok-p">(</span><span class="tok-kd">function</span><span class="tok-p">()</span> <span class="tok-p">{</span>
	<span class="tok-nx">llamaOtraFuncion</span><span class="tok-p">(</span><span class="tok-mi">3</span><span class="tok-p">,</span> <span class="tok-mi">500</span><span class="tok-p">,</span> <span class="tok-nx">saluda</span><span class="tok-p">);</span>
<span class="tok-p">});</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>A continuación, vamos a modificarlo para asignar valores por defecto:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="javascript"><span class="tok-kd">function</span> <span class="tok-nx">llamaOtraFuncion</span><span class="tok-p">(</span><span class="tok-nx">arg1</span><span class="tok-p">,</span> <span class="tok-nx">arg2</span><span class="tok-p">,</span> <span class="tok-nx">arg3</span><span class="tok-p">)</span> <span class="tok-p">{</span>
	<span class="tok-kd">var</span> <span class="tok-nx">veces</span> <span class="tok-o">=</span> <span class="tok-nx">$</span><span class="tok-p">.</span><span class="tok-nx">isNumeric</span><span class="tok-p">(</span><span class="tok-nx">arg1</span><span class="tok-p">)</span> <span class="tok-o">?</span> <span class="tok-nx">arg1</span> <span class="tok-o">:</span> <span class="tok-mi">5</span><span class="tok-p">;</span>
	<span class="tok-kd">var</span> <span class="tok-nx">retraso</span> <span class="tok-o">=</span> <span class="tok-nx">$</span><span class="tok-p">.</span><span class="tok-nx">isNumeric</span><span class="tok-p">(</span><span class="tok-nx">arg2</span><span class="tok-p">)</span> <span class="tok-o">?</span> <span class="tok-nx">arg2</span> <span class="tok-o">:</span> <span class="tok-mi">1000</span><span class="tok-p">;</span>
	<span class="tok-kd">var</span> <span class="tok-nx">funcion</span> <span class="tok-o">=</span> <span class="tok-nx">$</span><span class="tok-p">.</span><span class="tok-nx">isFunction</span><span class="tok-p">(</span><span class="tok-nx">arg1</span><span class="tok-p">)</span> <span class="tok-o">?</span> <span class="tok-nx">arg1</span> <span class="tok-o">:</span> <span class="tok-nx">$</span><span class="tok-p">.</span><span class="tok-nx">isFunction</span><span class="tok-p">(</span><span class="tok-nx">arg2</span><span class="tok-p">)</span> <span class="tok-o">?</span> <span class="tok-nx">arg2</span> <span class="tok-o">:</span> <span class="tok-nx">arg3</span><span class="tok-p">;</span>

	<span class="tok-kd">var</span> <span class="tok-nx">i</span> <span class="tok-o">=</span> <span class="tok-mi">0</span><span class="tok-p">;</span>
	<span class="tok-c1">// resto de código...</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>De modo que ahora podemos realizar diferentes llamadas sobrecargando los parámetros:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="javascript"><span class="tok-nx">llamaOtraFuncion</span><span class="tok-p">(</span><span class="tok-mi">3</span><span class="tok-p">,</span> <span class="tok-mi">500</span><span class="tok-p">,</span> <span class="tok-nx">saluda</span><span class="tok-p">);</span>	<span class="tok-c1">// 3 veces con retardo de 0,5 seg</span>
<span class="tok-nx">llamaOtraFuncion</span><span class="tok-p">(</span><span class="tok-nx">saluda</span><span class="tok-p">);</span>	<span class="tok-c1">// 5 veces con retardo de 1 seg</span>
<span class="tok-nx">llamaOtraFuncion</span><span class="tok-p">(</span><span class="tok-mi">7</span><span class="tok-p">,</span> <span class="tok-nx">saluda</span><span class="tok-p">);</span>	<span class="tok-c1">// 7 veces con retardo de 1 seg</span></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_manipulación_de_colecciones">7.3.2. Manipulación de colecciones</h4>
<div class="paragraph">
<p>El siguiente conjunto de funciones de manipulación de objetos nos permiten trabajar con <em>arrays</em> y objetos simplificando ciertas tareas:</p>
</div>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 25%;">
<col style="width: 75%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-center valign-middle">Función</th>
<th class="tableblock halign-left valign-top">Propósito</th>
</tr>
</thead>
<tbody>
<tr>
<th class="tableblock halign-center valign-middle"><p class="tableblock">$.makeArray(<em>objeto</em>)</p></th>
<td class="tableblock halign-left valign-top"><p class="tableblock">Convierte el <em>objeto</em> en un <em>array</em>. Se utiliza cuando necesitamos llamar a funciones que sólo soportan los <em>arrays</em>, como <code>join</code> o <code>reverse</code>, o cuando necesitamos pasar un parametro a una función como <em>array</em></p></td>
</tr>
<tr>
<th class="tableblock halign-center valign-middle"><p class="tableblock">$.inArray(<em>valor</em>, <em>array</em>)</p></th>
<td class="tableblock halign-left valign-top"><p class="tableblock">Determina si el <em>array</em> contiene el <em>valor</em>. Devuelve <code>-1</code> o el índice que ocupa el <em>valor</em>. Un tercer parámetro opcional permite indicar el índice por el cual comienza la búsqueda.</p></td>
</tr>
<tr>
<th class="tableblock halign-center valign-middle"><p class="tableblock">$.unique(<em>array</em>)</p></th>
<td class="tableblock halign-left valign-top"><p class="tableblock">Elimina cualquier elemento duplicado que se encuentre en el <em>array</em></p></td>
</tr>
<tr>
<th class="tableblock halign-center valign-middle"><p class="tableblock">$.merge(<em>array1</em>, <em>array2</em>)</p></th>
<td class="tableblock halign-left valign-top"><p class="tableblock">Combina los contenidos de <em>array1</em> y <em>array2</em>, similar a la función <code>concat()</code>.</p></td>
</tr>
<tr>
<th class="tableblock halign-center valign-middle"><p class="tableblock">$.map(<em>array</em>, <em>callback</em>)</p></th>
<td class="tableblock halign-left valign-top"><p class="tableblock">Construye un nuevo array cuyo contenido es el resultado de llamar al <em>callback</em> para cada elemento, similar a la funcion <code>map()</code>.</p></td>
</tr>
<tr>
<th class="tableblock halign-center valign-middle"><p class="tableblock">$.grep(<em>array</em>, <em>callback</em> [,invertido])</p></th>
<td class="tableblock halign-left valign-top"><p class="tableblock">Filtra el <em>array</em> mediante el <em>callback</em>, de modo que añadirá los elementos que pasen la función, la cual recibe un objeto DOM como parámetro, y devuelve un <em>array JavaScript</em>, similar a la función <code>filter()</code></p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>A continuación tenemos un fragmento de código con ejemplos de uso de estos métodos:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="javascript"><span class="tok-kd">var</span> <span class="tok-nx">miArray</span> <span class="tok-o">=</span> <span class="tok-p">[</span><span class="tok-mi">1</span><span class="tok-p">,</span> <span class="tok-mi">2</span><span class="tok-p">,</span> <span class="tok-mi">3</span><span class="tok-p">,</span> <span class="tok-mi">3</span><span class="tok-p">,</span> <span class="tok-mi">4</span><span class="tok-p">,</span> <span class="tok-mi">4</span><span class="tok-p">,</span> <span class="tok-mi">5</span><span class="tok-p">];</span>
<span class="tok-kd">var</span> <span class="tok-nx">miArray2</span> <span class="tok-o">=</span> <span class="tok-p">[</span><span class="tok-mi">6</span><span class="tok-p">,</span> <span class="tok-mi">7</span><span class="tok-p">,</span> <span class="tok-mi">8</span><span class="tok-p">];</span>

<span class="tok-k">if</span> <span class="tok-p">(</span><span class="tok-nx">$</span><span class="tok-p">.</span><span class="tok-nx">inArray</span><span class="tok-p">(</span><span class="tok-mi">4</span><span class="tok-p">,</span> <span class="tok-nx">miArray</span><span class="tok-p">)</span> <span class="tok-o">!=</span> <span class="tok-o">-</span><span class="tok-mi">1</span><span class="tok-p">)</span> <span class="tok-p">{</span>
	<span class="tok-nx">console</span><span class="tok-p">.</span><span class="tok-nx">log</span><span class="tok-p">(</span><span class="tok-s2">&quot;4 esta en el array&quot;</span><span class="tok-p">);</span>
<span class="tok-p">}</span>

<span class="tok-nx">$</span><span class="tok-p">.</span><span class="tok-nx">unique</span><span class="tok-p">(</span><span class="tok-nx">miArray</span><span class="tok-p">);</span>
<span class="tok-nx">console</span><span class="tok-p">.</span><span class="tok-nx">log</span><span class="tok-p">(</span><span class="tok-nx">miArray</span><span class="tok-p">);</span> <span class="tok-c1">// [1, 2, 3, 4, 5]</span>

<span class="tok-nx">$</span><span class="tok-p">.</span><span class="tok-nx">merge</span><span class="tok-p">(</span><span class="tok-nx">miArray</span><span class="tok-p">,</span> <span class="tok-nx">miArray2</span><span class="tok-p">);</span>
<span class="tok-nx">console</span><span class="tok-p">.</span><span class="tok-nx">log</span><span class="tok-p">(</span><span class="tok-nx">miArray</span><span class="tok-p">);</span>

<span class="tok-kd">var</span> <span class="tok-nx">miArrayDoble</span> <span class="tok-o">=</span> <span class="tok-nx">$</span><span class="tok-p">.</span><span class="tok-nx">map</span><span class="tok-p">(</span><span class="tok-nx">miArray</span><span class="tok-p">,</span> <span class="tok-kd">function</span><span class="tok-p">(</span><span class="tok-nx">elem</span><span class="tok-p">,</span> <span class="tok-nx">indice</span><span class="tok-p">)</span> <span class="tok-p">{</span>
	<span class="tok-k">return</span> <span class="tok-nx">indice</span> <span class="tok-o">*</span> <span class="tok-mi">2</span><span class="tok-p">;</span>
<span class="tok-p">});</span>
<span class="tok-nx">console</span><span class="tok-p">.</span><span class="tok-nx">log</span><span class="tok-p">(</span><span class="tok-nx">miArrayDoble</span><span class="tok-p">);</span>

<span class="tok-kd">var</span> <span class="tok-nx">miArrayFiltrado</span> <span class="tok-o">=</span> <span class="tok-nx">$</span><span class="tok-p">.</span><span class="tok-nx">grep</span><span class="tok-p">(</span><span class="tok-nx">miArray</span><span class="tok-p">,</span> <span class="tok-kd">function</span><span class="tok-p">(</span><span class="tok-nx">elem</span><span class="tok-p">)</span> <span class="tok-p">{</span>
	<span class="tok-k">return</span> <span class="tok-nx">elem</span> <span class="tok-o">%</span> <span class="tok-mi">2</span> <span class="tok-o">==</span> <span class="tok-mi">0</span><span class="tok-p">;</span>
<span class="tok-p">});</span>
<span class="tok-nx">console</span><span class="tok-p">.</span><span class="tok-nx">log</span><span class="tok-p">(</span><span class="tok-nx">miArrayFiltrado</span><span class="tok-p">);</span></code></pre>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="title">Autoevaluación</div>
<div class="paragraph">
<p>¿Qué saldrá por la consola tras ejecutar el método <code>$.merge()</code>? <span class="footnote">[<a id="_footnoteref_14" class="footnote" href="#_footnote_14" title="View footnote.">14</a>]</span></p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_copiando_objetos">7.3.3. Copiando objetos</h4>
<div class="paragraph">
<p>Si tenemos uno o varios objetos de los cuales queremos copiar sus propiedades en uno final, podemos hacer uso del método <code>$.extend(<em>destino</em>, <em>origen</em>)</code>;</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="javascript"><span class="tok-kd">var</span> <span class="tok-nx">animal</span> <span class="tok-o">=</span> <span class="tok-p">{</span>
	<span class="tok-nx">comer</span><span class="tok-o">:</span> <span class="tok-kd">function</span><span class="tok-p">()</span> <span class="tok-p">{</span>
		<span class="tok-nx">console</span><span class="tok-p">.</span><span class="tok-nx">log</span><span class="tok-p">(</span><span class="tok-s2">&quot;Comiendo&quot;</span><span class="tok-p">);</span>
	<span class="tok-p">}</span>
<span class="tok-p">}</span>
<span class="tok-kd">var</span> <span class="tok-nx">perro</span> <span class="tok-o">=</span> <span class="tok-p">{</span>
	<span class="tok-nx">ladrar</span><span class="tok-o">:</span> <span class="tok-kd">function</span><span class="tok-p">()</span> <span class="tok-p">{</span>
		<span class="tok-nx">console</span><span class="tok-p">.</span><span class="tok-nx">log</span><span class="tok-p">(</span><span class="tok-s2">&quot;Ladrando&quot;</span><span class="tok-p">);</span>
	<span class="tok-p">}</span>
<span class="tok-p">}</span>

<span class="tok-nx">$</span><span class="tok-p">.</span><span class="tok-nx">extend</span><span class="tok-p">(</span><span class="tok-nx">perro</span><span class="tok-p">,</span> <span class="tok-nx">animal</span><span class="tok-p">);</span>
<span class="tok-nx">perro</span><span class="tok-p">.</span><span class="tok-nx">comer</span><span class="tok-p">();</span>	<span class="tok-c1">// Comiendo</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Es decir, permite copiar miembros de un objeto fuente en uno destino, sin realizar herencia, sólo clonando las propiedades. Si hay un conflicto, se sobreescribirán con las propiedades del objeto fuente, y si tenemos múltiples objetos fuentes, de izquierda a derecha.</p>
</div>
<div class="paragraph">
<p>Si los objetos que vamos a clonar contienen objetos anidados, necesitamos indicarle a <em>jQuery</em> que el clonado debe ser recursivo, mediante un booleano a  <code>true</code> como primer parámetro:</p>
</div>
<div class="listingblock">
<div class="title">Ejemplo $.extend() <a href="http://jsbin.com/vinawe/1/edit?js,console" class="bare">http://jsbin.com/vinawe/1/edit?js,console</a></div>
<div class="content">
<pre class="pygments highlight"><code data-lang="javascript"><span class="tok-kd">var</span> <span class="tok-nx">animal</span> <span class="tok-o">=</span> <span class="tok-p">{</span>
	<span class="tok-nx">acciones</span><span class="tok-o">:</span> <span class="tok-p">{</span>
		<span class="tok-nx">comer</span><span class="tok-o">:</span> <span class="tok-kd">function</span><span class="tok-p">()</span> <span class="tok-p">{</span>
			<span class="tok-nx">console</span><span class="tok-p">.</span><span class="tok-nx">log</span><span class="tok-p">(</span><span class="tok-s2">&quot;Comiendo&quot;</span><span class="tok-p">);</span>
		<span class="tok-p">},</span>
		<span class="tok-nx">sentar</span><span class="tok-o">:</span> <span class="tok-kd">function</span><span class="tok-p">()</span> <span class="tok-p">{</span>
			<span class="tok-nx">console</span><span class="tok-p">.</span><span class="tok-nx">log</span><span class="tok-p">(</span><span class="tok-s2">&quot;Sentando&quot;</span><span class="tok-p">);</span>
		<span class="tok-p">}</span>
	<span class="tok-p">}</span>
<span class="tok-p">};</span>
<span class="tok-kd">var</span> <span class="tok-nx">perro</span> <span class="tok-o">=</span> <span class="tok-p">{</span>
	<span class="tok-nx">acciones</span><span class="tok-o">:</span> <span class="tok-p">{</span>
		<span class="tok-nx">ladrar</span><span class="tok-o">:</span> <span class="tok-kd">function</span><span class="tok-p">()</span> <span class="tok-p">{</span>
			<span class="tok-nx">console</span><span class="tok-p">.</span><span class="tok-nx">log</span><span class="tok-p">(</span><span class="tok-s2">&quot;Ladrando&quot;</span><span class="tok-p">);</span>
		<span class="tok-p">},</span>
		<span class="tok-nx">cavar</span><span class="tok-o">:</span> <span class="tok-kd">function</span><span class="tok-p">()</span> <span class="tok-p">{</span>
			<span class="tok-nx">console</span><span class="tok-p">.</span><span class="tok-nx">log</span><span class="tok-p">(</span><span class="tok-s2">&quot;Cavando&quot;</span><span class="tok-p">);</span>
		<span class="tok-p">}</span>
	<span class="tok-p">}</span>
<span class="tok-p">};</span>
<span class="tok-kd">var</span> <span class="tok-nx">perroCopia</span> <span class="tok-o">=</span> <span class="tok-p">{};</span>

<span class="tok-nx">$</span><span class="tok-p">.</span><span class="tok-nx">extend</span><span class="tok-p">(</span><span class="tok-nx">perroCopia</span><span class="tok-p">,</span> <span class="tok-nx">perro</span><span class="tok-p">);</span>	<i class="conum" data-value="1"></i><b>(1)</b>
<span class="tok-nx">perroCopia</span><span class="tok-p">.</span><span class="tok-nx">acciones</span><span class="tok-p">.</span><span class="tok-nx">ladrar</span><span class="tok-p">();</span>	<span class="tok-c1">// Ladrando</span>

<span class="tok-nx">$</span><span class="tok-p">.</span><span class="tok-nx">extend</span><span class="tok-p">(</span><span class="tok-kc">true</span><span class="tok-p">,</span> <span class="tok-nx">perroCopia</span><span class="tok-p">,</span> <span class="tok-nx">animal</span><span class="tok-p">);</span>	<i class="conum" data-value="2"></i><b>(2)</b>
<span class="tok-nx">perroCopia</span><span class="tok-p">.</span><span class="tok-nx">acciones</span><span class="tok-p">.</span><span class="tok-nx">comer</span><span class="tok-p">();</span>	<span class="tok-c1">// Comiendo</span>
<span class="tok-nx">perroCopia</span><span class="tok-p">.</span><span class="tok-nx">acciones</span><span class="tok-p">.</span><span class="tok-nx">ladrar</span><span class="tok-p">();</span>	<span class="tok-c1">// Ladrando</span>

<span class="tok-nx">$</span><span class="tok-p">.</span><span class="tok-nx">extend</span><span class="tok-p">(</span><span class="tok-nx">perro</span><span class="tok-p">,</span> <span class="tok-nx">animal</span><span class="tok-p">);</span>		<i class="conum" data-value="3"></i><b>(3)</b>
<span class="tok-nx">perro</span><span class="tok-p">.</span><span class="tok-nx">acciones</span><span class="tok-p">.</span><span class="tok-nx">comer</span><span class="tok-p">();</span>		<span class="tok-c1">// Comiendo</span>
<span class="tok-nx">perro</span><span class="tok-p">.</span><span class="tok-nx">acciones</span><span class="tok-p">.</span><span class="tok-nx">ladrar</span><span class="tok-p">();</span>	<span class="tok-c1">// error</span></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Copiamos los atributos de <code>perro</code> en <code>perroCopia</code>, con lo que podemos acceder a las propiedades</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Al hacer una copia recursiva, en vez de sustituir la propiedad <code>acciones</code> de <code>perroCopia</code> por la de <code>animal</code>, las fusiona</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>En cambio, si no hacemos la copia recursiva, podemos acceder a las propiedades de <code>animal</code> pero no a las de <code>perro</code></td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Más información en <a href="http://api.jquery.com/jquery.extend/" class="bare">http://api.jquery.com/jquery.extend/</a></p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_plugins">7.4. Plugins</h3>
<div class="paragraph">
<p>Aunque el núcleo de <em>jQuery</em> ya ofrece multitud de funcionalidad y utilidades, también soporta una arquitectura de plugins para extender la funcionalidad de la librería.</p>
</div>
<div class="paragraph">
<p>El <em>website</em> de <em>jQuery</em> ofrece un enorme repositorio de <em>plugins</em> en <a href="http://plugins.jquery.com/" class="bare">http://plugins.jquery.com/</a>, donde se listan con demos, código de ejemplo y tutoriales para facilitar su uso.</p>
</div>
<div class="paragraph">
<p>En la siguiente sesión estudiaremos el <em>plugin</em> <em>jQueryUI</em> como un ejemplo de complemento que extiende la librería.</p>
</div>
<div class="paragraph">
<p>Aunque <em>jQuery</em> ofrece múltitud de <em>plugins</em> que extienden el código, en ocasiones necesitamos ir un poco más allá y nos toca escribir nuestro propio código que podemos empaquetar como un nuevo plugin.</p>
</div>
<div class="paragraph">
<p>El archivo fuente que contenga nuestro <em>plugin</em> debería cumplir la siguiente convención de nombrado:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="sh">jquery.nombrePlugin.js
jquery.nombrePlugin-1.0.js</code></pre>
</div>
</div>
<div class="paragraph">
<p>Además, se recomienda añadir un comentario en la cabecera donde se visualice la versión del mismo.</p>
</div>
<div class="sect3">
<h4 id="_creando_un_plugin">7.4.1. Creando un plugin</h4>
<div class="paragraph">
<p>A la hora de crear un <em>plugin</em>, lo primero que asumimos es que <em>jQuery</em> ha cargado. Lo que no podemos asumir es que el alias <code>$</code> esté disponible. Por ello, dentro de nuestros plugins usaremos el nombre completo <code>jQuery</code> o definiremos el <code>$</code> por nosotros mismos.</p>
</div>
<div class="paragraph">
<p>Conviene recordar que podemos hacer uso de una <em>IIFE</em> para poder usar el <code>$</code> dentro de nuestro plugin:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="javascript"><span class="tok-p">(</span><span class="tok-kd">function</span><span class="tok-p">(</span><span class="tok-nx">$</span><span class="tok-p">)</span> <span class="tok-p">{</span>
	<span class="tok-c1">// código del plugin</span>
<span class="tok-p">})(</span><span class="tok-nx">jQuery</span><span class="tok-p">);</span></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_funciones_globales">7.4.2. Funciones globales</h4>
<div class="paragraph">
<p>Del mismo modo que <em>jQuery</em> ofrece la función <code>$.ajax()</code>, la cual no necesita ningún objeto para funcionar, nosotros podemos extender el abanico de funciones de utilidades que ofrece <em>jQuery</em>.</p>
</div>
<div class="paragraph">
<p>Para añadir una función al espacio de nombre de <em>jQuery</em> únicamente hemos de asignar la función como una propiedad del objeto <code>jQuery</code>:</p>
</div>
<div class="listingblock">
<div class="title">Añadir función global en jQuery - <a href="http://jsbin.com/zohugu/1/edit?js,console" class="bare">http://jsbin.com/zohugu/1/edit?js,console</a></div>
<div class="content">
<pre class="pygments highlight"><code data-lang="javascript"><span class="tok-p">(</span><span class="tok-kd">function</span><span class="tok-p">(</span><span class="tok-nx">$</span><span class="tok-p">)</span> <span class="tok-p">{</span>
	<span class="tok-nx">$</span><span class="tok-p">.</span><span class="tok-nx">suma</span> <span class="tok-o">=</span> <span class="tok-kd">function</span><span class="tok-p">(</span><span class="tok-nx">array</span><span class="tok-p">)</span> <span class="tok-p">{</span>	<i class="conum" data-value="1"></i><b>(1)</b>
		<span class="tok-kd">var</span> <span class="tok-nx">total</span> <span class="tok-o">=</span> <span class="tok-mi">0</span><span class="tok-p">;</span>
		<span class="tok-nx">$</span><span class="tok-p">.</span><span class="tok-nx">each</span><span class="tok-p">(</span><span class="tok-nx">array</span><span class="tok-p">,</span> <span class="tok-kd">function</span> <span class="tok-p">(</span><span class="tok-nx">indice</span><span class="tok-p">,</span> <span class="tok-nx">valor</span><span class="tok-p">)</span> <span class="tok-p">{</span>
			<span class="tok-nx">valor</span> <span class="tok-o">=</span> <span class="tok-nx">$</span><span class="tok-p">.</span><span class="tok-nx">trim</span><span class="tok-p">(</span><span class="tok-nx">valor</span><span class="tok-p">);</span>
			<span class="tok-nx">valor</span> <span class="tok-o">=</span> <span class="tok-nb">parseFloat</span><span class="tok-p">(</span><span class="tok-nx">valor</span><span class="tok-p">)</span> <span class="tok-o">||</span> <span class="tok-mi">0</span><span class="tok-p">;</span>

			<span class="tok-nx">total</span> <span class="tok-o">+=</span> <span class="tok-nx">valor</span><span class="tok-p">;</span>
		<span class="tok-p">});</span>
		<span class="tok-k">return</span> <span class="tok-nx">total</span><span class="tok-p">;</span>
	<span class="tok-p">};</span>
<span class="tok-p">})(</span><span class="tok-nx">jQuery</span><span class="tok-p">);</span></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Le asociamos la función a la propiedad de <em>jQuery</em></td>
</tr>
</table>
</div>
<div class="paragraph">
<p>De este modo, vamos a poder llamar a esta función mediante:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="javascript"><span class="tok-kd">var</span> <span class="tok-nx">resultado</span> <span class="tok-o">=</span> <span class="tok-nx">$</span><span class="tok-p">.</span><span class="tok-nx">suma</span><span class="tok-p">([</span><span class="tok-mi">1</span><span class="tok-p">,</span><span class="tok-mi">2</span><span class="tok-p">,</span><span class="tok-mi">3</span><span class="tok-p">,</span><span class="tok-mi">4</span><span class="tok-p">]);</span>	<span class="tok-c1">// 10</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>También podríamos crear un nuevo espacio de nombres para las funciones globales que queramos añadir, y así evitar conflictos que puedan aparecer con otros plugins. Para ello, sólo hemos de asociar a nuestra función global un objeto el cual contenga como propiedades las funciones que queramos añadir como plugin:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="javascript"><span class="tok-p">(</span><span class="tok-kd">function</span><span class="tok-p">(</span><span class="tok-nx">$</span><span class="tok-p">)</span> <span class="tok-p">{</span>
	<span class="tok-nx">$</span><span class="tok-p">.</span><span class="tok-nx">MathUtils</span> <span class="tok-o">=</span> <span class="tok-p">{</span>
		<span class="tok-nx">suma</span> <span class="tok-o">:</span> <span class="tok-kd">function</span><span class="tok-p">(</span><span class="tok-nx">array</span><span class="tok-p">)</span> <span class="tok-p">{</span>
			<span class="tok-c1">// código de la función</span>
		<span class="tok-p">},</span>
		<span class="tok-nx">media</span><span class="tok-o">:</span> <span class="tok-kd">function</span><span class="tok-p">(</span><span class="tok-nx">array</span><span class="tok-p">)</span> <span class="tok-p">{</span>
			<span class="tok-c1">// código de la función</span>
		<span class="tok-p">}</span>
	<span class="tok-p">};</span>
<span class="tok-p">})(</span><span class="tok-nx">jQuery</span><span class="tok-p">);</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>De este modo, invocaremos a las funciones así:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="javascript"><span class="tok-kd">var</span> <span class="tok-nx">resultado</span> <span class="tok-o">=</span> <span class="tok-nx">$</span><span class="tok-p">.</span><span class="tok-nx">MathUtils</span><span class="tok-p">.</span><span class="tok-nx">suma</span><span class="tok-p">([</span><span class="tok-mi">1</span><span class="tok-p">,</span><span class="tok-mi">2</span><span class="tok-p">,</span><span class="tok-mi">3</span><span class="tok-p">,</span><span class="tok-mi">4</span><span class="tok-p">]);</span>
<span class="tok-kd">var</span> <span class="tok-nx">resultado</span> <span class="tok-o">=</span> <span class="tok-nx">$</span><span class="tok-p">.</span><span class="tok-nx">MathUtils</span><span class="tok-p">.</span><span class="tok-nx">media</span><span class="tok-p">([</span><span class="tok-mi">1</span><span class="tok-p">,</span><span class="tok-mi">2</span><span class="tok-p">,</span><span class="tok-mi">3</span><span class="tok-p">,</span><span class="tok-mi">4</span><span class="tok-p">]);</span></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_métodos_de_objeto">7.4.3. Métodos de objeto</h4>
<div class="paragraph">
<p>Si queremos extender las funciones de <em>jQuery</em>, mediante prototipos podemos crear métodos nuevos que se apliquen al objeto <code>jQuery</code> activo. <em>jQuery</em> utiliza el alias <code>fn</code> en vez <code>prototype</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="javascript"><span class="tok-p">(</span><span class="tok-kd">function</span><span class="tok-p">(</span><span class="tok-nx">$</span><span class="tok-p">)</span> <span class="tok-p">{</span>
	<span class="tok-nx">$</span><span class="tok-p">.</span><span class="tok-nx">fn</span><span class="tok-p">.</span><span class="tok-nx">nombreNuevaFuncion</span> <span class="tok-o">=</span> <span class="tok-kd">function</span><span class="tok-p">()</span> <span class="tok-p">{</span>
		<span class="tok-c1">// código nuevo</span>
	<span class="tok-p">};</span>
<span class="tok-p">})(</span><span class="tok-nx">jQuery</span><span class="tok-p">);</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Normalmente no sabemos si la función trabajará sobre un sólo objeto o sobre una colección, ya que un selector de <em>jQuery</em> puede devolver cero, uno o múltiples elementos. De modo que una buena práctica es plantear un escenario donde recibimos un array de datos.</p>
</div>
<div class="paragraph">
<p>La manera más facil de garantizar este comportamiento es iterar sobre la colección mediante el método <code>each()</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="javascript"><span class="tok-nx">$</span><span class="tok-p">.</span><span class="tok-nx">fn</span><span class="tok-p">.</span><span class="tok-nx">nombreNuevaFuncion</span> <span class="tok-o">=</span> <span class="tok-kd">function</span><span class="tok-p">()</span> <span class="tok-p">{</span>
	<span class="tok-k">this</span><span class="tok-p">.</span><span class="tok-nx">each</span><span class="tok-p">(</span><span class="tok-kd">function</span><span class="tok-p">()</span> <span class="tok-p">{</span>
		<span class="tok-c1">// Hacemos algo con cada elemento</span>
	<span class="tok-p">});</span>
<span class="tok-p">};</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Así pues, si quisiéramos extender <em>jQuery</em> y ofrecer un nuevo método que le cambiase la clase CSS a un nodo haríamos:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="javascript"><span class="tok-p">(</span><span class="tok-kd">function</span><span class="tok-p">(</span><span class="tok-nx">$</span><span class="tok-p">)</span> <span class="tok-p">{</span>
	<span class="tok-nx">$</span><span class="tok-p">.</span><span class="tok-nx">fn</span><span class="tok-p">.</span><span class="tok-nx">cambiarClase</span> <span class="tok-o">=</span> <span class="tok-kd">function</span><span class="tok-p">(</span><span class="tok-nx">clase1</span><span class="tok-p">,</span> <span class="tok-nx">clase2</span><span class="tok-p">)</span> <span class="tok-p">{</span>
		<span class="tok-k">this</span><span class="tok-p">.</span><span class="tok-nx">each</span><span class="tok-p">(</span><span class="tok-kd">function</span><span class="tok-p">()</span> <span class="tok-p">{</span>	<i class="conum" data-value="1"></i><b>(1)</b>
			<span class="tok-kd">var</span> <span class="tok-nx">elem</span> <span class="tok-o">=</span> <span class="tok-nx">$</span><span class="tok-p">(</span><span class="tok-k">this</span><span class="tok-p">);</span>	<i class="conum" data-value="2"></i><b>(2)</b>
			<span class="tok-k">if</span> <span class="tok-p">(</span><span class="tok-nx">elem</span><span class="tok-p">.</span><span class="tok-nx">hasClass</span><span class="tok-p">(</span><span class="tok-nx">clase1</span><span class="tok-p">))</span> <span class="tok-p">{</span>
				<span class="tok-nx">elem</span><span class="tok-p">.</span><span class="tok-nx">removeClass</span><span class="tok-p">(</span><span class="tok-nx">clase1</span><span class="tok-p">).</span><span class="tok-nx">addClass</span><span class="tok-p">(</span><span class="tok-nx">clase2</span><span class="tok-p">);</span>
			<span class="tok-p">}</span> <span class="tok-k">else</span> <span class="tok-k">if</span> <span class="tok-p">(</span><span class="tok-nx">elem</span><span class="tok-p">.</span><span class="tok-nx">hasClass</span><span class="tok-p">(</span><span class="tok-nx">clase2</span><span class="tok-p">))</span> <span class="tok-p">{</span>
				<span class="tok-nx">elem</span><span class="tok-p">.</span><span class="tok-nx">removeClass</span><span class="tok-p">(</span><span class="tok-nx">clase2</span><span class="tok-p">).</span><span class="tok-nx">addClass</span><span class="tok-p">(</span><span class="tok-nx">clase1</span><span class="tok-p">);</span>
			<span class="tok-p">}</span>
		<span class="tok-p">});</span>
	<span class="tok-p">};</span>
<span class="tok-p">})(</span><span class="tok-nx">jQuery</span><span class="tok-p">);</span></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Recorremos la colección de objetos que nos devuelve el selector. En este punto <code>this</code> referencia al objeto devuelto por <em>jQuery</em></td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Cacheamos la referencia al elemento en concreto sobre el que iteramos</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Esto permitirá que posteriormente realicemos una llamada al nuevo método mediante cualquier selector:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="javascript"><span class="tok-nx">$</span><span class="tok-p">(</span><span class="tok-s2">&quot;div&quot;</span><span class="tok-p">).</span><span class="tok-nx">cambiarClase</span><span class="tok-p">(</span><span class="tok-s2">&quot;principal&quot;</span><span class="tok-p">,</span><span class="tok-s2">&quot;secundaria&quot;</span><span class="tok-p">);</span></code></pre>
</div>
</div>
<div class="sect4">
<h5 id="_encadenar_funciones">Encadenar funciones</h5>
<div class="paragraph">
<p>Al crear una función prototipo, hemos de tener en cuenta que probablemente, después de llamar a nuestra función, es posible que el desarrollador quiera seguir encadenando llamadas.</p>
</div>
<div class="paragraph">
<p>Es por ello, que es muy importante que la función devuelva un objeto <code>jQuery</code> para permitir que continúe el encadenamiento. Este objeto normalmente es el mismo que <code>this</code>.</p>
</div>
<div class="paragraph">
<p>En nuestro caso, podemos modificar el plugin para devolver el objeto que iteramos:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="javascript"><span class="tok-p">(</span><span class="tok-kd">function</span><span class="tok-p">(</span><span class="tok-nx">$</span><span class="tok-p">)</span> <span class="tok-p">{</span>
	<span class="tok-nx">$</span><span class="tok-p">.</span><span class="tok-nx">fn</span><span class="tok-p">.</span><span class="tok-nx">cambiarClase</span> <span class="tok-o">=</span> <span class="tok-kd">function</span><span class="tok-p">(</span><span class="tok-nx">clase1</span><span class="tok-p">,</span> <span class="tok-nx">clase2</span><span class="tok-p">)</span> <span class="tok-p">{</span>
		<span class="tok-k">return</span> <span class="tok-k">this</span><span class="tok-p">.</span><span class="tok-nx">each</span><span class="tok-p">(</span><span class="tok-kd">function</span><span class="tok-p">()</span> <span class="tok-p">{</span>	<i class="conum" data-value="1"></i><b>(1)</b>
			<span class="tok-kd">var</span> <span class="tok-nx">elem</span> <span class="tok-o">=</span> <span class="tok-nx">$</span><span class="tok-p">(</span><span class="tok-k">this</span><span class="tok-p">);</span>
			<span class="tok-k">if</span> <span class="tok-p">(</span><span class="tok-nx">elem</span><span class="tok-p">.</span><span class="tok-nx">hasClass</span><span class="tok-p">(</span><span class="tok-nx">clase1</span><span class="tok-p">))</span> <span class="tok-p">{</span>
				<span class="tok-nx">elem</span><span class="tok-p">.</span><span class="tok-nx">removeClass</span><span class="tok-p">(</span><span class="tok-nx">clase1</span><span class="tok-p">).</span><span class="tok-nx">addClass</span><span class="tok-p">(</span><span class="tok-nx">clase2</span><span class="tok-p">);</span>
			<span class="tok-p">}</span> <span class="tok-k">else</span> <span class="tok-k">if</span> <span class="tok-p">(</span><span class="tok-nx">elem</span><span class="tok-p">.</span><span class="tok-nx">hasClass</span><span class="tok-p">(</span><span class="tok-nx">clase2</span><span class="tok-p">))</span> <span class="tok-p">{</span>
				<span class="tok-nx">elem</span><span class="tok-p">.</span><span class="tok-nx">removeClass</span><span class="tok-p">(</span><span class="tok-nx">clase2</span><span class="tok-p">).</span><span class="tok-nx">addClass</span><span class="tok-p">(</span><span class="tok-nx">clase1</span><span class="tok-p">);</span>
			<span class="tok-p">}</span>
		<span class="tok-p">});</span>
	<span class="tok-p">};</span>
<span class="tok-p">})(</span><span class="tok-nx">jQuery</span><span class="tok-p">);</span></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Al devolver cada objeto que iteramos, permitimos el encadenamiento</td>
</tr>
</table>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="title">Función como parámetro</div>
<div class="paragraph">
<p>Al encadenar funciones, si queremos que nuestro plugin reciba como párametro una función, por ejemplo para dar soporte a <em>callbacks</em>, para evitar un mal funcionamiento cuando no se pase ninguna función, hemos de comprobar si es una función e invocarla en dicho caso:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="javascript"><span class="tok-nx">$</span><span class="tok-p">.</span><span class="tok-nx">fn</span><span class="tok-p">.</span><span class="tok-nx">pluginQueRecibeFuncion</span> <span class="tok-o">=</span> <span class="tok-kd">function</span><span class="tok-p">(</span><span class="tok-nx">funcionParam</span><span class="tok-p">)</span> <span class="tok-p">{</span>
	<span class="tok-k">if</span> <span class="tok-p">(</span><span class="tok-nx">$</span><span class="tok-p">.</span><span class="tok-nx">isFunction</span><span class="tok-p">(</span><span class="tok-nx">funcionParam</span><span class="tok-p">))</span> <span class="tok-p">{</span>
		<span class="tok-nx">funcionParam</span><span class="tok-p">.</span><span class="tok-nx">call</span><span class="tok-p">(</span><span class="tok-k">this</span><span class="tok-p">);</span>
	<span class="tok-p">}</span>
	<span class="tok-k">return</span> <span class="tok-k">this</span><span class="tok-p">;</span>
<span class="tok-p">}</span></code></pre>
</div>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="_opciones_2">Opciones</h5>
<div class="paragraph">
<p>Conforme los <em>plugins</em> crecen, es una buena práctica permitir que el plugin reciba un objeto con las opciones de configuración del mismo.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="javascript"><span class="tok-nx">$</span><span class="tok-p">.</span><span class="tok-nx">fn</span><span class="tok-p">.</span><span class="tok-nx">pluginConConf</span> <span class="tok-o">=</span> <span class="tok-kd">function</span><span class="tok-p">(</span><span class="tok-nx">opciones</span><span class="tok-p">)</span> <span class="tok-p">{</span>
	<span class="tok-kd">var</span> <span class="tok-nx">confFabrica</span> <span class="tok-o">=</span> <span class="tok-p">{</span><span class="tok-nx">prop</span><span class="tok-o">:</span> <span class="tok-s2">&quot;valorPorDefecto&quot;</span><span class="tok-p">};</span>
	<span class="tok-kd">var</span> <span class="tok-nx">conf</span> <span class="tok-o">=</span> <span class="tok-nx">$</span><span class="tok-p">.</span><span class="tok-nx">extend</span><span class="tok-p">(</span><span class="tok-nx">confFabrica</span><span class="tok-p">,</span> <span class="tok-nx">opciones</span><span class="tok-p">);</span>	<i class="conum" data-value="1"></i><b>(1)</b>

	<span class="tok-k">return</span> <span class="tok-k">this</span><span class="tok-p">.</span><span class="tok-nx">each</span><span class="tok-p">(</span><span class="tok-kd">function</span><span class="tok-p">()</span> <span class="tok-p">{</span>
		<span class="tok-c1">// código que trabaja con conf.prop </span><i class="conum" data-value="2"></i><b>(2)</b>
	<span class="tok-p">});</span>
<span class="tok-p">};</span></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Sobreescribe los valores de fabrica del objeto de configuración con el recibido como parámetro</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Dentro de la iteración, usamos los valores que contiene el objeto de configuración</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Además, es conveniente que permitamos modificar los valores de fabrica para permitir mayor flexibilidad. Para ello, extraemos los valores de fábrica del <em>plugin</em> a una propiedad del método:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="javascript"><span class="tok-nx">$</span><span class="tok-p">.</span><span class="tok-nx">fn</span><span class="tok-p">.</span><span class="tok-nx">pluginConConf</span> <span class="tok-o">=</span> <span class="tok-kd">function</span><span class="tok-p">(</span><span class="tok-nx">opciones</span><span class="tok-p">)</span> <span class="tok-p">{</span>

	<span class="tok-kd">var</span> <span class="tok-nx">conf</span> <span class="tok-o">=</span> <span class="tok-nx">$</span><span class="tok-p">.</span><span class="tok-nx">extend</span><span class="tok-p">({},</span> <span class="tok-nx">$</span><span class="tok-p">.</span><span class="tok-nx">fn</span><span class="tok-p">.</span><span class="tok-nx">pluginConConf</span><span class="tok-p">.</span><span class="tok-nx">confFabrica</span><span class="tok-p">,</span> <span class="tok-nx">opciones</span><span class="tok-p">);</span>	<i class="conum" data-value="1"></i><b>(1)</b>

	<span class="tok-k">return</span> <span class="tok-k">this</span><span class="tok-p">.</span><span class="tok-nx">each</span><span class="tok-p">(</span><span class="tok-kd">function</span><span class="tok-p">()</span> <span class="tok-p">{</span>
		<span class="tok-c1">// código que trabaja con conf.prop</span>
	<span class="tok-p">});</span>
<span class="tok-p">};</span>

<span class="tok-nx">$</span><span class="tok-p">.</span><span class="tok-nx">fn</span><span class="tok-p">.</span><span class="tok-nx">pluginConConf</span><span class="tok-p">.</span><span class="tok-nx">confFabrica</span> <span class="tok-o">=</span> <span class="tok-p">{</span><span class="tok-nx">prop</span><span class="tok-o">:</span> <span class="tok-s2">&quot;valorPorDefecto&quot;</span><span class="tok-p">};</span></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Creamos un nuevo objeto de configuración</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>De este modo, vamos a poder inicializar los valores de fábrica, incluso desde fuera de un bloque de <code>ready</code> mediante:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="javascript"><span class="tok-nx">$</span><span class="tok-p">.</span><span class="tok-nx">fn</span><span class="tok-p">.</span><span class="tok-nx">pluginConConf</span><span class="tok-p">.</span><span class="tok-nx">confFabrica</span><span class="tok-p">.</span><span class="tok-nx">prop</span> <span class="tok-o">=</span> <span class="tok-s2">&quot;nuevoValor&quot;</span><span class="tok-p">;</span></code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_rendimiento_2">7.5. Rendimiento</h3>
<div class="paragraph">
<p>A la hora de escribir código <em>jQuery</em> es útil conocer la manera de que tenga el mejor rendimiento sin penalizar la comprensión ni mantenibilidad del código. Sin embargo, es importante tener en mente que la optimización prematura suele ser la raíz de todos los males.</p>
</div>
<div class="sect3">
<h4 id="_consejos_de_rendimiento">7.5.1. Consejos de rendimiento</h4>
<div class="paragraph">
<p>Una vez localizado el problema mediante el <em>profiling</em> del código que vimos en la sesión de <em>JavaScript</em>, llega el momento de optimizar el código. Para ello, deberemos:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Utilizar la <strong>última versión de <em>jQuery</em></strong>, ya que siempre contienen mejoras de rendimiento que repercutirán en nuestra aplicación.</p>
</li>
<li>
<p><strong>Cachear los selectores</strong>, para evitar búsquedas innecesarias. Por ejemplo, el siguiente fragmento realiza 1000 búsquedas:</p>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="javascript"><span class="tok-nx">console</span><span class="tok-p">.</span><span class="tok-nx">time</span><span class="tok-p">(</span><span class="tok-s2">&quot;Sin cachear&quot;</span><span class="tok-p">);</span>
<span class="tok-k">for</span> <span class="tok-p">(</span><span class="tok-kd">var</span> <span class="tok-nx">i</span><span class="tok-o">=</span><span class="tok-mi">0</span><span class="tok-p">;</span> <span class="tok-nx">i</span> <span class="tok-o">&lt;</span> <span class="tok-mi">1000</span><span class="tok-p">;</span> <span class="tok-nx">i</span><span class="tok-o">++</span><span class="tok-p">)</span> <span class="tok-p">{</span>
	<span class="tok-kd">var</span> <span class="tok-nx">s</span> <span class="tok-o">=</span> <span class="tok-nx">$</span><span class="tok-p">(</span><span class="tok-s2">&quot;div&quot;</span><span class="tok-p">);</span>
<span class="tok-p">}</span>
<span class="tok-nx">console</span><span class="tok-p">.</span><span class="tok-nx">timeEnd</span><span class="tok-p">(</span><span class="tok-s2">&quot;Sin cachear&quot;</span><span class="tok-p">);</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Mientras que así sólo realizamos una:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="javascript"><span class="tok-nx">console</span><span class="tok-p">.</span><span class="tok-nx">time</span><span class="tok-p">(</span><span class="tok-s2">&quot;Cacheando&quot;</span><span class="tok-p">);</span>
<span class="tok-kd">var</span> <span class="tok-nx">miCapa</span> <span class="tok-o">=</span> <span class="tok-nx">$</span><span class="tok-p">(</span><span class="tok-s2">&quot;div&quot;</span><span class="tok-p">);</span>
<span class="tok-k">for</span> <span class="tok-p">(</span><span class="tok-kd">var</span> <span class="tok-nx">i</span><span class="tok-o">=</span><span class="tok-mi">0</span><span class="tok-p">;</span> <span class="tok-nx">i</span> <span class="tok-o">&lt;</span> <span class="tok-mi">1000</span><span class="tok-p">;</span> <span class="tok-nx">i</span><span class="tok-o">++</span><span class="tok-p">)</span> <span class="tok-p">{</span>
	<span class="tok-kd">var</span> <span class="tok-nx">s</span> <span class="tok-o">=</span> <span class="tok-nx">miCapa</span><span class="tok-p">;</span>
<span class="tok-p">}</span>
<span class="tok-nx">console</span><span class="tok-p">.</span><span class="tok-nx">timeEnd</span><span class="tok-p">(</span><span class="tok-s2">&quot;Cacheando&quot;</span><span class="tok-p">);</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Y por la consola tendremos que el fragmento que no cachea tarda 8.990ms mientras que el que cachea sólo 0.045ms, es decir, 200 veces menos.</p>
</div>
</li>
<li>
<p><strong>Cachear otros elementos</strong>, como llamadas a métodos o acceso a propiedades dentro de bucles. Por ejemplo, el siguiente fragmento recorre un conjunto de 1000 capas:</p>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="javascript"><span class="tok-nx">console</span><span class="tok-p">.</span><span class="tok-nx">time</span><span class="tok-p">(</span><span class="tok-s2">&quot;Sin cachear&quot;</span><span class="tok-p">);</span>
<span class="tok-kd">var</span> <span class="tok-nx">miCapa</span> <span class="tok-o">=</span> <span class="tok-nx">$</span><span class="tok-p">(</span><span class="tok-s2">&quot;div&quot;</span><span class="tok-p">);</span>
<span class="tok-kd">var</span> <span class="tok-nx">s</span> <span class="tok-o">=</span> <span class="tok-mi">0</span><span class="tok-p">;</span>
<span class="tok-k">for</span> <span class="tok-p">(</span><span class="tok-kd">var</span> <span class="tok-nx">i</span><span class="tok-o">=</span><span class="tok-mi">0</span><span class="tok-p">;</span> <span class="tok-nx">i</span> <span class="tok-o">&lt;</span> <span class="tok-nx">miCapa</span><span class="tok-p">.</span><span class="tok-nx">length</span><span class="tok-p">;</span> <span class="tok-nx">i</span><span class="tok-o">++</span><span class="tok-p">)</span> <span class="tok-p">{</span>
	<span class="tok-nx">s</span> <span class="tok-o">+=</span> <span class="tok-nx">i</span><span class="tok-p">;</span>
<span class="tok-p">}</span>
<span class="tok-nx">console</span><span class="tok-p">.</span><span class="tok-nx">timeEnd</span><span class="tok-p">(</span><span class="tok-s2">&quot;Sin cachear&quot;</span><span class="tok-p">);</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Mientras que sí extraemos la llamada al método fuera del bucle, accederemos a la propiedad de longitud una sola vez:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="javascript"><span class="tok-nx">console</span><span class="tok-p">.</span><span class="tok-nx">time</span><span class="tok-p">(</span><span class="tok-s2">&quot;Cacheando&quot;</span><span class="tok-p">);</span>
<span class="tok-kd">var</span> <span class="tok-nx">miCapa</span> <span class="tok-o">=</span> <span class="tok-nx">$</span><span class="tok-p">(</span><span class="tok-s2">&quot;div&quot;</span><span class="tok-p">);</span>
<span class="tok-kd">var</span> <span class="tok-nx">longitud</span> <span class="tok-o">=</span> <span class="tok-nx">miCapa</span><span class="tok-p">.</span><span class="tok-nx">length</span><span class="tok-p">;</span>
<span class="tok-kd">var</span> <span class="tok-nx">s</span> <span class="tok-o">=</span> <span class="tok-mi">0</span><span class="tok-p">;</span>
<span class="tok-k">for</span> <span class="tok-p">(</span><span class="tok-kd">var</span> <span class="tok-nx">i</span><span class="tok-o">=</span><span class="tok-mi">0</span><span class="tok-p">;</span> <span class="tok-nx">i</span> <span class="tok-o">&lt;</span> <span class="tok-nx">longitud</span><span class="tok-p">;</span> <span class="tok-nx">i</span><span class="tok-o">++</span><span class="tok-p">)</span> <span class="tok-p">{</span>
	<span class="tok-nx">s</span> <span class="tok-o">+=</span> <span class="tok-nx">i</span><span class="tok-p">;</span>
<span class="tok-p">}</span>
<span class="tok-nx">console</span><span class="tok-p">.</span><span class="tok-nx">timeEnd</span><span class="tok-p">(</span><span class="tok-s2">&quot;Cacheando&quot;</span><span class="tok-p">);</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>También podemos cachear llamadas AJAX del siguiente modo:</p>
</div>
<div class="listingblock">
<div class="title">Ejemplo cacheo llamadas AJAX - <a href="http://jsbin.com/kabuju/edit?js,console,output" class="bare">http://jsbin.com/kabuju/edit?js,console,output</a></div>
<div class="content">
<pre class="pygments highlight"><code data-lang="javascript"><span class="tok-kd">function</span> <span class="tok-nx">getDatos</span><span class="tok-p">(</span><span class="tok-nx">id</span><span class="tok-p">)</span> <span class="tok-p">{</span>
  <span class="tok-k">if</span> <span class="tok-p">(</span><span class="tok-o">!</span><span class="tok-nx">api</span><span class="tok-p">[</span><span class="tok-nx">id</span><span class="tok-p">])</span> <span class="tok-p">{</span>
		<span class="tok-kd">var</span> <span class="tok-nx">url</span> <span class="tok-o">=</span> <span class="tok-s2">&quot;http://www.omdbapi.com/?s=&quot;</span> <span class="tok-o">+</span> <span class="tok-nx">busqueda</span> <span class="tok-o">+</span> <span class="tok-s2">&quot;&amp;callback=?&quot;</span><span class="tok-p">;</span>
		<span class="tok-nx">console</span><span class="tok-p">.</span><span class="tok-nx">log</span><span class="tok-p">(</span><span class="tok-s2">&quot;Petición a &quot;</span> <span class="tok-o">+</span> <span class="tok-nx">url</span><span class="tok-p">);</span>
		<span class="tok-nx">api</span><span class="tok-p">[</span><span class="tok-nx">id</span><span class="tok-p">]</span> <span class="tok-o">=</span> <span class="tok-nx">$</span><span class="tok-p">.</span><span class="tok-nx">getJSON</span><span class="tok-p">(</span><span class="tok-nx">url</span><span class="tok-p">);</span>
  <span class="tok-p">}</span>

  <span class="tok-nx">api</span><span class="tok-p">[</span><span class="tok-nx">id</span><span class="tok-p">].</span><span class="tok-nx">done</span><span class="tok-p">(</span><span class="tok-nx">todoOk</span><span class="tok-p">).</span><span class="tok-nx">fail</span><span class="tok-p">(</span><span class="tok-kd">function</span><span class="tok-p">()</span> <span class="tok-p">{</span>
    <span class="tok-nx">$</span><span class="tok-p">(</span><span class="tok-s2">&quot;#resultado&quot;</span><span class="tok-p">).</span><span class="tok-nx">html</span><span class="tok-p">(</span><span class="tok-s2">&quot;Error&quot;</span><span class="tok-p">);</span>
  <span class="tok-p">});</span>
<span class="tok-p">}</span>

<span class="tok-kd">function</span> <span class="tok-nx">todoOk</span><span class="tok-p">(</span><span class="tok-nx">datos</span><span class="tok-p">)</span> <span class="tok-p">{</span>
	<span class="tok-nx">console</span><span class="tok-p">.</span><span class="tok-nx">log</span><span class="tok-p">(</span><span class="tok-s2">&quot;Datos recibidos y adjuntándolos a resultado&quot;</span><span class="tok-p">);</span>
	<span class="tok-nx">$</span><span class="tok-p">(</span><span class="tok-s2">&quot;#resultado&quot;</span><span class="tok-p">).</span><span class="tok-nx">append</span><span class="tok-p">(</span><span class="tok-nx">JSON</span><span class="tok-p">.</span><span class="tok-nx">stringify</span><span class="tok-p">(</span><span class="tok-nx">datos</span><span class="tok-p">));</span>
<span class="tok-p">}</span></code></pre>
</div>
</div>
</li>
<li>
<p>Cuando sea posible, <strong>utilizar propiedades de elementos</strong>. En vez de utilizar un método <em>jQuery</em>, en ocasiones, podemos obtener la misma información a partir de una propiedad. Por ejemplo, en vez de obtener el atributo <code>id</code> mediante el método <code>attr</code> hacerlo mediante su propiedad:</p>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="javascript"><span class="tok-kd">var</span> <span class="tok-nx">lento</span> <span class="tok-o">=</span> <span class="tok-nx">miCapa</span><span class="tok-p">.</span><span class="tok-nx">attr</span><span class="tok-p">(</span><span class="tok-s2">&quot;id&quot;</span><span class="tok-p">);</span>
<span class="tok-kd">var</span> <span class="tok-nx">rapido</span> <span class="tok-o">=</span> <span class="tok-nx">miCapa</span><span class="tok-p">[</span><span class="tok-mi">0</span><span class="tok-p">].</span><span class="tok-nx">id</span><span class="tok-p">;</span></code></pre>
</div>
</div>
<div class="admonitionblock caution">
<table>
<tr>
<td class="icon">
<i class="fa icon-caution" title="Caution"></i>
</td>
<td class="content">
Hay que tener cuidado que normalmente al acceder mediante una propiedad el resultado deja de ser un objeto <em>jQuery</em>, con lo que no vamos a poder encadenar el resultado en una llamada posterior.
</td>
</tr>
</table>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<p>Estos y más consejos detallados los promueve <em>jQuery</em> en <a href="http://learn.jquery.com/performance/" class="bare">http://learn.jquery.com/performance/</a></p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_ejercicios_7">7.6. Ejercicios</h3>
<div class="sect3">
<h4 id="__0_4_ptos_ejercicio_71_apuntes_2_0">7.6.1. (0.4 ptos) Ejercicio 71. Apuntes 2.0</h4>
<div class="paragraph">
<p>A partir del ejercicio 62 realizado en la sesión anterior donde modificábamos la página de apuntes, vamos a mejorarlo de manera que:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Al cargar la página, todos los capítulos estén ocultos, incluidas las notas al pie.</p>
</li>
<li>
<p>Al pulsar sobre un enlace de la tabla de contenidos, se muestre el contenido de dicho capítulo. Si había un capítulo mostrado, debe ocultarse. Es decir, sólo puede visualizar en pantalla un único capítulo.</p>
</li>
<li>
<p>Tanto la aparición como la desaparición del contenido se debe realizar mediante una animación.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Al cargar la página la apariencia será similar a la siguiente imagen:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/js07/ejer71.jpg" alt="Apuntes 2.0">
</div>
<div class="title">Figure 47. Apuntes 2.0</div>
</div>
<div class="paragraph">
<p>Todo el código estará incluido en el archivo <code>ej71.js</code>.</p>
</div>
</div>
<div class="sect3">
<h4 id="__0_5_ptos_ejercicio_72_star_wars_em_jquery_em">7.6.2. (0.5 ptos) Ejercicio 72. Star Wars <em>jQuery</em></h4>
<div class="paragraph">
<p>A partir del ejercicio 51 sobre <em>Star Wars API</em>, vamos a basarnos en el mismo API pero escribiendo el código mediante <em>jQuery</em> y su API para AJAX.</p>
</div>
<div class="paragraph">
<p>Ahora vamos a mostrar un listado con todos los personajes. Al elegir uno de los disponibles se mostrará su információn básica, así como el título de las películas en las que aparece. Cuando se cambie el personaje, mediante una animación se ocultará la información del antiguo personaje (borrando sus datos) antes de mostrar sólo la información del nuevo.</p>
</div>
<div class="paragraph">
<p>Para ello, usaremos la siguiente plantilla:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="html"><span class="tok-cp">&lt;!DOCTYPE html&gt;</span>
<span class="tok-nt">&lt;html&gt;</span>
<span class="tok-nt">&lt;head</span> <span class="tok-na">lang=</span><span class="tok-s">&quot;es&quot;</span><span class="tok-nt">&gt;</span>
	<span class="tok-nt">&lt;meta</span> <span class="tok-na">charset=</span><span class="tok-s">&quot;UTF-8&quot;</span><span class="tok-nt">&gt;</span>
	<span class="tok-nt">&lt;title&gt;</span>Ejercicio 72<span class="tok-nt">&lt;/title&gt;</span>
<span class="tok-nt">&lt;/head&gt;</span>
<span class="tok-nt">&lt;body&gt;</span>
<span class="tok-nt">&lt;h1&gt;</span>Star Wars API<span class="tok-nt">&lt;/h1&gt;</span>
<span class="tok-nt">&lt;h2&gt;</span>Personajes - <span class="tok-nt">&lt;span</span> <span class="tok-na">id=</span><span class="tok-s">&#39;total&#39;</span><span class="tok-nt">&gt;&lt;/span&gt;&lt;/h2&gt;</span>
Elige entre los principales personajes: <span class="tok-nt">&lt;select</span> <span class="tok-na">id=</span><span class="tok-s">&#39;personajes&#39;</span><span class="tok-nt">&gt;&lt;/select&gt;</span>
<span class="tok-nt">&lt;br</span> <span class="tok-nt">/&gt;</span>
<span class="tok-nt">&lt;br</span> <span class="tok-nt">/&gt;</span>
<span class="tok-nt">&lt;div</span> <span class="tok-na">id=</span><span class="tok-s">&#39;personaje&#39;</span> <span class="tok-na">style=</span><span class="tok-s">&#39;display:none; background:ghostwhite&#39;</span><span class="tok-nt">&gt;</span>
	Nombre: <span class="tok-nt">&lt;span</span> <span class="tok-na">id=</span><span class="tok-s">&#39;nombre&#39;</span><span class="tok-nt">&gt;&lt;/span&gt;&lt;br</span> <span class="tok-nt">/&gt;</span>
	Sexo: <span class="tok-nt">&lt;span</span> <span class="tok-na">id=</span><span class="tok-s">&#39;sexo&#39;</span><span class="tok-nt">&gt;&lt;/span&gt;&lt;br</span> <span class="tok-nt">/&gt;</span>
	Especie: <span class="tok-nt">&lt;span</span> <span class="tok-na">id=</span><span class="tok-s">&#39;especie&#39;</span><span class="tok-nt">&gt;&lt;/span&gt;&lt;br</span> <span class="tok-nt">/&gt;</span>
	Películas: <span class="tok-nt">&lt;ul</span> <span class="tok-na">id=</span><span class="tok-s">&#39;peliculas&#39;</span><span class="tok-nt">&gt;&lt;/ul&gt;&lt;br</span> <span class="tok-nt">/&gt;</span>
<span class="tok-nt">&lt;/div&gt;</span>

<span class="tok-nt">&lt;script </span><span class="tok-na">src=</span><span class="tok-s">&quot;jquery-1.11.2.js&quot;</span><span class="tok-nt">&gt;&lt;/script&gt;</span>
<span class="tok-nt">&lt;script </span><span class="tok-na">src=</span><span class="tok-s">&quot;ej72.js&quot;</span><span class="tok-nt">&gt;&lt;/script&gt;</span>
<span class="tok-nt">&lt;/body&gt;</span>
<span class="tok-nt">&lt;/html&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Al cargar a <em>Obi-Wan</em> la apariencia será similar a la siguiente imagen:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/js07/ejer72.jpg" alt="Star Wars jQuery">
</div>
<div class="title">Figure 48. Star Wars jQuery</div>
</div>
<div class="paragraph">
<p>Todo el código estará incluido en el archivo <code>ej72.js</code>.</p>
</div>
</div>
<div class="sect3">
<h4 id="__0_3_ptos_ejercicio_73_em_plugin_em_canificador">7.6.3. (0.3 ptos) Ejercicio 73. <em>Plugin</em> Canificador</h4>
<div class="paragraph">
<p>A partir del ejercicio 41 donde creamos el módulo <em>Canificador</em>, crear un <em>plugin</em> de <em>jQuery</em> que integre la misma funcionalidad, de modo que podamos utilizarlo tanto de manera global como si fuese un método de objeto:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="javascript"><span class="tok-kd">var</span> <span class="tok-nx">cadenaCaniada</span> <span class="tok-o">=</span> <span class="tok-nx">$</span><span class="tok-p">.</span><span class="tok-nx">toCani</span><span class="tok-p">(</span><span class="tok-s2">&quot;Mi cadena&quot;</span><span class="tok-p">);</span>
<span class="tok-nx">$</span><span class="tok-p">(</span><span class="tok-s2">&quot;#contenidoCani&quot;</span><span class="tok-p">).</span><span class="tok-nx">toCani</span><span class="tok-p">();</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>El <em>plugin</em> debe permitir modificar la configuración base para que el final de la cadena sea diferente a <code>HHH</code>.</p>
</div>
<div class="paragraph">
<p>Todo el código estará incluido en el archivo <code>jquery.canificador.js</code>.</p>
</div>
<div style="page-break-after: always;"></div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="sesion08">8. Promesas</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Las promesas son una característica novedosa para gestionar los eventos asíncronos, permitiendo escribir código más sencillo, <em>callbacks</em> más cortos, y mantener la lógica de la aplicación de alto nivel separada de los comportamientos de bajo nivel.</p>
</div>
<div class="paragraph">
<p>Al utilizar promesas, podemos usar <em>callbacks</em> en cualquier situación, y no solo con eventos. Además ofrecen un mecanismo estándar para indicar la finalización de tareas.</p>
</div>
<div class="sect2">
<h3 id="__qué_es_una_promesa">8.1. ¿Qué es una promesa?</h3>
<div class="paragraph">
<p>Una promesa es un objeto que representa un evento único, normalmente como resultado de una tarea asíncrona como una llamada <em>AJAX</em>. Almacenan un valor futuro, ya sea el resultado de una petición HTTP o la lectura de un fichero desde disco.</p>
</div>
<div class="paragraph">
<p>En la vida real, cuando vamos a un restaurante de comida rápida y pedimos un menú con hamburguesa con bacón y patatas fritas, estamos obteniendo una promesa con el número del pedido, porque primero lo pagamos y esperamos recibir nuestra comida, pero es un proceso asíncrono el cual inicia una transacción. Mientras esperamos a que nos llamen con nuestra sabrosa hamburguesa, podemos realizar otras acciones, como decirle a nuestra pareja que busque una mesa o preparar un tuit con lo rica que está nuestra hamburguesa. Estas acciones se traducen en <em>callbacks</em>, los cuales se ejecutarán una vez se finalice la operación. Una vez nuestro pedido está preparado, nos llaman con el número del mismo y nuestra deseada comida. O inesperadamente, se ha acabado el bacón y nuestra promesa se cumple pero erroneamente. Así pues, un valor futuro puede finalizar correctamente o fallar, pero en ambos casos, finalizar.</p>
</div>
</div>
<div class="sect2">
<h3 id="_promise_api">8.2. Promise API</h3>
<div class="paragraph">
<p>Las promesas forman parte del API de <em>JavaScript</em> desde <em>ECMAScript</em> 6, con lo cual es una tecnología novedosa que puede no estar disponible en todos los navegadores. Aún así, las últimas versiones de los navegadores ya lo soportan: <a href="http://caniuse.com/#feat=promises" class="bare">http://caniuse.com/#feat=promises</a></p>
</div>
<div class="paragraph">
<p>Además de la implementación del estándar ECMAScript 6, <em>jQuery</em> implementa las promesas mediante los <em>Deferreds</em>, y existen librerías de terceros como <strong>BlueBird</strong> (<a href="https://github.com/petkaantonov/bluebird" class="bare">https://github.com/petkaantonov/bluebird</a>) o <strong>Q</strong> (<a href="https://github.com/kriskowal/q" class="bare">https://github.com/kriskowal/q</a>) que cumplen el estándard.</p>
</div>
<div class="sect3">
<h4 id="_hola_promesa">8.2.1. Hola Promesa</h4>
<div class="paragraph">
<p>Para crear una promesa, utilizaremos el contructor <code>Promise()</code>, el cual recibe como argumento un callback con dos parámetros, <code>resolver</code> y <code>rechazar</code>. Este callback se ejecuta inmediatamente.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Para facilitar la lectura del código, las funciones <code>resolver</code> y <code>rechazar</code> están traducidas. El API de promesas utiliza <code>resolve</code> y <code>reject</code> como alternativa, y además, ofrece métodos auxiliares para realizar estas acciones con dicha nomenclatura.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Dentro de la promesa, realizaremos las acciones deseadas y si todo funciona como esperamos llamaremos a <code>resolver</code>. Sino, llamaremos a <code>rechazar</code> (mejor pasándole un objeto <code>Error</code> para capturar la pila de llamadas)</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="javascript"><span class="tok-kd">var</span> <span class="tok-nx">promesa</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-nx">Promise</span><span class="tok-p">(</span><span class="tok-kd">function</span><span class="tok-p">(</span><span class="tok-nx">resolver</span><span class="tok-p">,</span> <span class="tok-nx">rechazar</span><span class="tok-p">)</span> <span class="tok-p">{</span>
  <span class="tok-kd">var</span> <span class="tok-nx">ok</span><span class="tok-p">;</span>

  <span class="tok-c1">// código con la llamada async</span>

  <span class="tok-k">if</span> <span class="tok-p">(</span><span class="tok-nx">ok</span><span class="tok-p">)</span> <span class="tok-p">{</span>
    <span class="tok-nx">resolver</span><span class="tok-p">(</span><span class="tok-s2">&quot;Ha funcionado&quot;</span><span class="tok-p">);</span> <span class="tok-c1">// resuelve p</span>
  <span class="tok-p">}</span> <span class="tok-k">else</span> <span class="tok-p">{</span>
    <span class="tok-nx">rechazar</span><span class="tok-p">(</span><span class="tok-nb">Error</span><span class="tok-p">(</span><span class="tok-s2">&quot;Ha fallado&quot;</span><span class="tok-p">));</span> <span class="tok-c1">// rechaza p</span>
  <span class="tok-p">}</span>
<span class="tok-p">});</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Así pues, los parámetros <code>resolver</code> y <code>rechazar</code> tienen la capacidad de manipular el estado interno de la instancia de promesa <code>p</code>. Esto se conoce como el patrón <em>Revealing Constructor</em> (<a href="http://blog.domenic.me/the-revealing-constructor-pattern/" class="bare">http://blog.domenic.me/the-revealing-constructor-pattern/</a>), ya que el constructor revela sus entrañas pero solo al código que lo construye, el cual es el único que puede resolver o rechazar la promesa. Por ello, cuando le pasamos la promesa a cualquier otro método, éste solo podrá añadir callbacks sobre la misma:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="javascript"><span class="tok-nx">hacerCosasCon</span><span class="tok-p">(</span><span class="tok-nx">promesa</span><span class="tok-p">);</span></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_uso_básico">8.2.2. Uso básico</h4>
<div class="paragraph">
<p>Una vez tenemos nuestra promesa, independientemente del estado en el que se encuentre, mediante <code>then(callbackResuelta, callbackRechazada)</code> podremos actuar en consecuencia dependiendo del <em>callback</em> que se dispare:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="javascript"><span class="tok-nx">promesa</span><span class="tok-p">.</span><span class="tok-nx">then</span><span class="tok-p">(</span>
  <span class="tok-kd">function</span><span class="tok-p">(</span><span class="tok-nx">resultado</span><span class="tok-p">)</span> <span class="tok-p">{</span>
    <span class="tok-nx">console</span><span class="tok-p">.</span><span class="tok-nx">log</span><span class="tok-p">(</span><span class="tok-nx">resultado</span><span class="tok-p">);</span> <span class="tok-c1">// &quot;Ha funcionado&quot;</span>
  <span class="tok-p">},</span> <span class="tok-kd">function</span><span class="tok-p">(</span><span class="tok-nx">err</span><span class="tok-p">)</span> <span class="tok-p">{</span>
    <span class="tok-nx">console</span><span class="tok-p">.</span><span class="tok-nx">error</span><span class="tok-p">(</span><span class="tok-nx">err</span><span class="tok-p">);</span> <span class="tok-c1">// Error: &quot;Ha fallado&quot;</span>
  <span class="tok-p">}</span>
<span class="tok-p">);</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>El primer <em>callback</em> es para el caso completado, y el segundo para el rechazado. Ambos son opcionales, con lo que podemos añadir un <em>callback</em> para únicamente el caso completado o rechazado.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
La especificación describe el término <strong>thenable</strong> para aquelos objetos que son similares a una promesa, ya que contienen un método <strong>then</strong>.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Uno de los ejemplos más sencillos es una petición AJAX mediante jQuery:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="javascript"><span class="tok-kd">var</span> <span class="tok-nx">p</span> <span class="tok-o">=</span> <span class="tok-nx">$</span><span class="tok-p">.</span><span class="tok-nx">get</span><span class="tok-p">(</span><span class="tok-s2">&quot;http://www.omdbapi.com/?t=Interstellar&amp;r=json&quot;</span><span class="tok-p">);</span>

<span class="tok-nx">p</span><span class="tok-p">.</span><span class="tok-nx">then</span><span class="tok-p">(</span><span class="tok-kd">function</span><span class="tok-p">(</span><span class="tok-nx">resultado</span><span class="tok-p">)</span> <span class="tok-p">{</span>
  <span class="tok-nx">console</span><span class="tok-p">.</span><span class="tok-nx">log</span><span class="tok-p">(</span><span class="tok-nx">resultado</span><span class="tok-p">);</span>
<span class="tok-p">});</span></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_estados_de_una_promesa">8.2.3. Estados de una promesa</h4>
<div class="paragraph">
<p>Nada más comenzar, una promesa está en un estado pendiente (<em>pending</em>). Al finalizar, su estado será <strong>completada</strong> (<em>fulfilled</em>), lo que implica que la tarea se ha realizado/resuelto, o <strong>rechazada</strong> (<em>rejected</em>), si la tarea no se completó.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/js08/js08estados.jpg" alt="Estados de una promesa">
</div>
<div class="title">Figure 49. Estados de una Promesa</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
No hay que confundir completada con éxito, ya que una promesa se puede completar pero contener un error (por ejemplo, el usuario solicitado no existe), o puede no completarse porque el usuario cancelase la petición incluso sin ocurrir ningún error.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Una vez que una promesa se completa o se rechaza, se mantendrá en dicho estado para siempre (conocido como <em>settled</em>), y sus <em>callbacks</em> nunca se volverán a disparar. Tanto el estado como cualquier valor dado como resultado no se pueden modificar.</p>
</div>
<div class="paragraph">
<p>Dicho de otro modo, una promesa sólo puede completarse o rechazarse una vez. No puede hacerlo dos veces, ni cambiar de un estado completado a rechazado, o viceversa.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="title">Autoevaluación</div>
<div class="paragraph">
<p>A partir del siguiente código anterior, ¿Qué mensajes saldrán por pantalla? <span class="footnote">[<a id="_footnoteref_15" class="footnote" href="#_footnote_15" title="View footnote.">15</a>]</span></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="javascript"><span class="tok-kd">var</span> <span class="tok-nx">promesa</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-nx">Promise</span><span class="tok-p">(</span><span class="tok-kd">function</span> <span class="tok-p">(</span><span class="tok-nx">resolver</span><span class="tok-p">,</span> <span class="tok-nx">rechazar</span><span class="tok-p">)</span> <span class="tok-p">{</span>
  <span class="tok-nx">resolver</span><span class="tok-p">(</span><span class="tok-nb">Math</span><span class="tok-p">.</span><span class="tok-nx">PI</span><span class="tok-p">);</span>
  <span class="tok-nx">rechazar</span><span class="tok-p">(</span><span class="tok-mi">0</span><span class="tok-p">);</span>
  <span class="tok-nx">resolver</span><span class="tok-p">(</span><span class="tok-nb">Math</span><span class="tok-p">.</span><span class="tok-nx">sqrt</span><span class="tok-p">(</span><span class="tok-o">-</span><span class="tok-mi">1</span><span class="tok-p">));</span>
<span class="tok-p">});</span>

<span class="tok-nx">promesa</span><span class="tok-p">.</span><span class="tok-nx">then</span><span class="tok-p">(</span><span class="tok-kd">function</span> <span class="tok-p">(</span><span class="tok-nx">num</span><span class="tok-p">)</span> <span class="tok-p">{</span>
  <span class="tok-nx">console</span><span class="tok-p">.</span><span class="tok-nx">log</span><span class="tok-p">(</span><span class="tok-s2">&quot;El número es &quot;</span> <span class="tok-o">+</span> <span class="tok-nx">num</span><span class="tok-p">)</span>
<span class="tok-p">})</span></code></pre>
</div>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Es decir, se queda en un estado inmutable, el cual se puede observar tantas veces como queramos. Por ello, una vez resuelta, podemos pasar tranquilamente la promesa a cualquier otra función, ya que nadie va a poder modificar su estado.</p>
</div>
<div class="paragraph">
<p>Y ahora viene la pregunta del millón: Si la función rechazar pasa una promesa al estado rechazado, ¿por qué la función resolver no pasa la promesa al estado resuelta en vez de al estado completada? La respuesta corta es que resolver una promesa no es lo mismo que completarla. La larga es que cuando a la función <code>resolver</code> se le pasa un valor, la promesa se completa automáticamente. En cambio, cuando se le pasa otra promesa (por ejemplo <code>promesa.resolver(otraPromesa)</code>), las promesas se unen para crear una única promesa, de manera que cuando se resuelve la 2ª promesa (<code>otraPromesa</code>), ambas promesas se resolverán. Del mismo modo, si se rechaza la 2ª promesa, las dos promesas se rechazarán.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
El argumento que se pasa a <code>resolver</code> decide el destino de la promesa. Si es un valor, se completa. Si es una promesa, su estado depende de ésta última.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Tanto <code>resolver</code> como <code>rechazar</code> se pueden llamar sin argumentos, en cuyo caso el valor de la promesa será <code>undefined</code>.</p>
</div>
<div class="paragraph">
<p>Finalmente, si queremos crear una promesa que inmediatamente se resuelva o rechace, podemos emplear los métodos <code>Promise.resolve()</code> o <code>Promise.reject()</code>:</p>
</div>
<div class="listingblock">
<div class="title">Funciones equivalentes para resolver y rechazar</div>
<div class="content">
<pre class="pygments highlight"><code data-lang="javascript"><span class="tok-k">new</span> <span class="tok-nx">Promise</span><span class="tok-p">(</span><span class="tok-kd">function</span><span class="tok-p">(</span><span class="tok-nx">resolver</span><span class="tok-p">,</span> <span class="tok-nx">rechazar</span><span class="tok-p">)</span> <span class="tok-p">{</span>
  <span class="tok-nx">resolver</span><span class="tok-p">(</span><span class="tok-s2">&quot;forma larga&quot;</span><span class="tok-p">);</span>
<span class="tok-p">});</span>
<span class="tok-nx">Promise</span><span class="tok-p">.</span><span class="tok-nx">resolve</span><span class="tok-p">(</span><span class="tok-s2">&quot;forma corta&quot;</span><span class="tok-p">);</span>

<span class="tok-k">new</span> <span class="tok-nx">Promise</span><span class="tok-p">(</span><span class="tok-kd">function</span><span class="tok-p">(</span><span class="tok-nx">resolver</span><span class="tok-p">,</span> <span class="tok-nx">rechazar</span><span class="tok-p">)</span> <span class="tok-p">{</span>
  <span class="tok-nx">reject</span><span class="tok-p">(</span><span class="tok-s2">&quot;rechazo larga&quot;</span><span class="tok-p">);</span>
<span class="tok-p">});</span>
<span class="tok-nx">Promise</span><span class="tok-p">.</span><span class="tok-nx">reject</span><span class="tok-p">(</span><span class="tok-s2">&quot;rechazo corta&quot;</span><span class="tok-p">);</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Estos métodos son útiles cuando ya tienes el elemento que debería resolver o rechazar la promesa.</p>
</div>
</div>
<div class="sect3">
<h4 id="_consumiendo_promesas">8.2.4. Consumiendo promesas</h4>
<div class="paragraph">
<p>Una gran ventaja de emplear promesas es que podemos adjuntar tantos <em>callbacks</em> a una promesa como queramos, los cuales se ejecutarán una vez que la promesa se resuelva o rechace. Es decir, una promesa la pueden consumir varios consumidores.</p>
</div>
<div class="paragraph">
<p>Veamos un ejemplo completo. Supongamos que al entrar a una aplicación, queremos mostrar la información del usuario tanto en la barra de navegación como en el titulo de la página.</p>
</div>
<div class="paragraph">
<p>Si no empleasemos promesas, el código sería similar a:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="javascript"><span class="tok-kd">var</span> <span class="tok-nx">usuario</span> <span class="tok-o">=</span> <span class="tok-p">{</span>
  <span class="tok-nx">perfilUsuario</span><span class="tok-o">:</span> <span class="tok-kc">null</span><span class="tok-p">,</span>

  <span class="tok-nx">obtenerPerfil</span><span class="tok-o">:</span> <span class="tok-kd">function</span><span class="tok-p">()</span> <span class="tok-p">{</span>
    <span class="tok-k">if</span> <span class="tok-p">(</span><span class="tok-o">!</span><span class="tok-k">this</span><span class="tok-p">.</span><span class="tok-nx">perfilUsuario</span><span class="tok-p">)</span> <span class="tok-p">{</span>
      <span class="tok-kd">var</span> <span class="tok-nx">xhr</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-nx">XMLHttpRequest</span><span class="tok-p">();</span>
      <span class="tok-nx">xhr</span><span class="tok-p">.</span><span class="tok-nx">open</span><span class="tok-p">(</span><span class="tok-s2">&quot;GET&quot;</span><span class="tok-p">,</span><span class="tok-s2">&quot;usuario.json&quot;</span><span class="tok-p">,</span> <span class="tok-kc">true</span><span class="tok-p">);</span>
      <span class="tok-nx">xhr</span><span class="tok-p">.</span><span class="tok-nx">onreadystatechange</span> <span class="tok-o">=</span> <span class="tok-kd">function</span><span class="tok-p">()</span> <span class="tok-p">{</span>
        <span class="tok-k">if</span> <span class="tok-p">(</span><span class="tok-nx">xhr</span><span class="tok-p">.</span><span class="tok-nx">readyState</span> <span class="tok-o">===</span>  <span class="tok-mi">4</span><span class="tok-p">)</span> <span class="tok-p">{</span>
          <span class="tok-nx">perfilUsuario</span> <span class="tok-o">=</span> <span class="tok-nx">JSON</span><span class="tok-p">.</span><span class="tok-nx">parse</span><span class="tok-p">(</span><span class="tok-nx">xhr</span><span class="tok-p">.</span><span class="tok-nx">responseText</span><span class="tok-p">);</span>
        <span class="tok-p">}</span>
      <span class="tok-p">};</span>
      <span class="tok-nx">xhr</span><span class="tok-p">.</span><span class="tok-nx">send</span><span class="tok-p">(</span><span class="tok-kc">null</span><span class="tok-p">);</span>
    <span class="tok-p">}</span>
  <span class="tok-p">}</span>
<span class="tok-p">};</span>

<span class="tok-nx">usuario</span><span class="tok-p">.</span><span class="tok-nx">obtenerPerfil</span><span class="tok-p">();</span>
<span class="tok-k">if</span> <span class="tok-p">(</span><span class="tok-nx">usuario</span><span class="tok-p">.</span><span class="tok-nx">perfilUsuario</span><span class="tok-p">)</span> <span class="tok-p">{</span>  <i class="conum" data-value="1"></i><b>(1)</b>
  <span class="tok-nb">document</span><span class="tok-p">.</span><span class="tok-nx">getElementById</span><span class="tok-p">(</span><span class="tok-s2">&quot;navbar&quot;</span><span class="tok-p">).</span><span class="tok-nx">innerHTML</span> <span class="tok-o">=</span> <span class="tok-nx">usuario</span><span class="tok-p">.</span><span class="tok-nx">login</span><span class="tok-p">;</span>
  <span class="tok-nb">document</span><span class="tok-p">.</span><span class="tok-nx">getElementById</span><span class="tok-p">(</span><span class="tok-s2">&quot;titulo&quot;</span><span class="tok-p">).</span><span class="tok-nx">innerHTML</span> <span class="tok-o">=</span> <span class="tok-nx">usuario</span><span class="tok-p">.</span><span class="tok-nx">nombre</span><span class="tok-p">;</span>
<span class="tok-p">}</span></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Pese a parecer que este código funciona, nunca se rellenarán los datos porque al ser una llamada asíncrona, la variable <code>perfilUsuario</code> estará a null.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Para que funcione correctamente, el código de rellenar la página se tiene que acoplar con la petición AJAX:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="javascript"><span class="tok-kd">var</span> <span class="tok-nx">usuario</span> <span class="tok-o">=</span> <span class="tok-p">{</span>
  <span class="tok-nx">perfilUsuario</span><span class="tok-o">:</span> <span class="tok-kc">null</span><span class="tok-p">,</span>

  <span class="tok-nx">obtenerPerfil</span><span class="tok-o">:</span> <span class="tok-kd">function</span><span class="tok-p">()</span> <span class="tok-p">{</span>
    <span class="tok-k">if</span> <span class="tok-p">(</span><span class="tok-o">!</span><span class="tok-k">this</span><span class="tok-p">.</span><span class="tok-nx">perfilUsuario</span><span class="tok-p">)</span> <span class="tok-p">{</span>
      <span class="tok-kd">var</span> <span class="tok-nx">xhr</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-nx">XMLHttpRequest</span><span class="tok-p">();</span>
      <span class="tok-nx">xhr</span><span class="tok-p">.</span><span class="tok-nx">open</span><span class="tok-p">(</span><span class="tok-s2">&quot;GET&quot;</span><span class="tok-p">,</span><span class="tok-s2">&quot;usuario.json&quot;</span><span class="tok-p">,</span> <span class="tok-kc">true</span><span class="tok-p">);</span>
      <span class="tok-nx">xhr</span><span class="tok-p">.</span><span class="tok-nx">onreadystatechange</span> <span class="tok-o">=</span> <span class="tok-kd">function</span><span class="tok-p">()</span> <span class="tok-p">{</span>
        <span class="tok-k">if</span> <span class="tok-p">(</span><span class="tok-nx">xhr</span><span class="tok-p">.</span><span class="tok-nx">readyState</span> <span class="tok-o">===</span>  <span class="tok-mi">4</span><span class="tok-p">)</span> <span class="tok-p">{</span>
          <span class="tok-nx">perfilUsuario</span> <span class="tok-o">=</span> <span class="tok-nx">JSON</span><span class="tok-p">.</span><span class="tok-nx">parse</span><span class="tok-p">(</span><span class="tok-nx">xhr</span><span class="tok-p">.</span><span class="tok-nx">responseText</span><span class="tok-p">);</span>
          <span class="tok-nb">document</span><span class="tok-p">.</span><span class="tok-nx">getElementById</span><span class="tok-p">(</span><span class="tok-s2">&quot;navbar&quot;</span><span class="tok-p">).</span><span class="tok-nx">innerHTML</span> <span class="tok-o">=</span> <span class="tok-nx">perfilUsuario</span><span class="tok-p">.</span><span class="tok-nx">login</span><span class="tok-p">;</span> <i class="conum" data-value="1"></i><b>(1)</b>
          <span class="tok-nb">document</span><span class="tok-p">.</span><span class="tok-nx">getElementById</span><span class="tok-p">(</span><span class="tok-s2">&quot;titulo&quot;</span><span class="tok-p">).</span><span class="tok-nx">innerHTML</span> <span class="tok-o">=</span> <span class="tok-nx">perfilUsuario</span><span class="tok-p">.</span><span class="tok-nx">nombre</span><span class="tok-p">;</span>
        <span class="tok-p">}</span>
      <span class="tok-p">};</span>
      <span class="tok-nx">xhr</span><span class="tok-p">.</span><span class="tok-nx">send</span><span class="tok-p">(</span><span class="tok-kc">null</span><span class="tok-p">);</span>
    <span class="tok-p">}</span>
  <span class="tok-p">}</span>
<span class="tok-p">};</span>

<span class="tok-nx">usuario</span><span class="tok-p">.</span><span class="tok-nx">obtenerPerfil</span><span class="tok-p">();</span></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Ahora pintamos los datos tras recibirlos de manera asíncrona</td>
</tr>
</table>
</div>
<div class="sect4">
<h5 id="_prometiendo_ajax">Prometiendo AJAX</h5>
<div class="paragraph">
<p>En cambio, si al obtener los datos AJAX, los envolvemos en una promesa, el código queda más legible y ahora sí que podemos desacoplar la petición AJAX del dibujado HTML:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="javascript"><span class="tok-kd">var</span> <span class="tok-nx">usuario</span> <span class="tok-o">=</span> <span class="tok-p">{</span>
  <span class="tok-nx">promesaUsuario</span><span class="tok-o">:</span> <span class="tok-kc">null</span><span class="tok-p">,</span>

  <span class="tok-nx">obtenerPerfil</span><span class="tok-o">:</span> <span class="tok-kd">function</span><span class="tok-p">()</span> <span class="tok-p">{</span>
    <span class="tok-k">if</span> <span class="tok-p">(</span><span class="tok-o">!</span><span class="tok-k">this</span><span class="tok-p">.</span><span class="tok-nx">promesaUsuario</span><span class="tok-p">)</span> <span class="tok-p">{</span>
      <span class="tok-k">this</span><span class="tok-p">.</span><span class="tok-nx">promesaUsuario</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-nx">Promise</span><span class="tok-p">(</span><span class="tok-kd">function</span><span class="tok-p">(</span><span class="tok-nx">resolver</span><span class="tok-p">,</span> <span class="tok-nx">rechazar</span><span class="tok-p">)</span> <span class="tok-p">{</span>
        <span class="tok-kd">var</span> <span class="tok-nx">xhr</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-nx">XMLHttpRequest</span><span class="tok-p">();</span>
        <span class="tok-nx">xhr</span><span class="tok-p">.</span><span class="tok-nx">open</span><span class="tok-p">(</span><span class="tok-s2">&quot;GET&quot;</span><span class="tok-p">,</span><span class="tok-s2">&quot;usuario.json&quot;</span><span class="tok-p">,</span> <span class="tok-kc">true</span><span class="tok-p">);</span>
        <span class="tok-nx">xhr</span><span class="tok-p">.</span><span class="tok-nx">onreadystatechange</span> <span class="tok-o">=</span> <span class="tok-kd">function</span><span class="tok-p">()</span> <span class="tok-p">{</span>
          <span class="tok-k">if</span> <span class="tok-p">(</span><span class="tok-nx">xhr</span><span class="tok-p">.</span><span class="tok-nx">readyState</span> <span class="tok-o">===</span>  <span class="tok-mi">4</span><span class="tok-p">)</span> <span class="tok-p">{</span>
            <span class="tok-nx">resolver</span><span class="tok-p">(</span><span class="tok-nx">JSON</span><span class="tok-p">.</span><span class="tok-nx">parse</span><span class="tok-p">(</span><span class="tok-nx">xhr</span><span class="tok-p">.</span><span class="tok-nx">responseText</span><span class="tok-p">));</span>
          <span class="tok-p">}</span>
        <span class="tok-p">};</span>
        <span class="tok-nx">xhr</span><span class="tok-p">.</span><span class="tok-nx">onerror</span> <span class="tok-o">=</span> <span class="tok-kd">function</span><span class="tok-p">()</span> <span class="tok-p">{</span>
          <span class="tok-nx">rechazar</span><span class="tok-p">(</span><span class="tok-nb">Error</span><span class="tok-p">(</span><span class="tok-s2">&quot;Error al obtener usuario&quot;</span><span class="tok-p">));</span>
        <span class="tok-p">};</span>
        <span class="tok-nx">xhr</span><span class="tok-p">.</span><span class="tok-nx">send</span><span class="tok-p">(</span><span class="tok-kc">null</span><span class="tok-p">);</span>
      <span class="tok-p">});</span>
    <span class="tok-p">}</span>
    <span class="tok-k">return</span> <span class="tok-k">this</span><span class="tok-p">.</span><span class="tok-nx">promesaUsuario</span><span class="tok-p">;</span>
  <span class="tok-p">}</span>
<span class="tok-p">};</span>

<span class="tok-kd">var</span> <span class="tok-nx">navbar</span> <span class="tok-o">=</span> <span class="tok-p">{</span>
  <span class="tok-nx">mostrar</span><span class="tok-o">:</span> <span class="tok-kd">function</span><span class="tok-p">(</span><span class="tok-nx">usuario</span><span class="tok-p">)</span> <span class="tok-p">{</span>
    <span class="tok-nx">usuario</span><span class="tok-p">.</span><span class="tok-nx">obtenerPerfil</span><span class="tok-p">().</span><span class="tok-nx">then</span><span class="tok-p">(</span><span class="tok-kd">function</span><span class="tok-p">(</span><span class="tok-nx">perfil</span><span class="tok-p">)</span> <span class="tok-p">{</span>
      <span class="tok-nb">document</span><span class="tok-p">.</span><span class="tok-nx">getElementById</span><span class="tok-p">(</span><span class="tok-s2">&quot;navbar&quot;</span><span class="tok-p">).</span><span class="tok-nx">innerHTML</span> <span class="tok-o">=</span> <span class="tok-nx">perfil</span><span class="tok-p">.</span><span class="tok-nx">login</span><span class="tok-p">;</span>
    <span class="tok-p">});</span>
  <span class="tok-p">}</span>
<span class="tok-p">}</span>

<span class="tok-kd">var</span> <span class="tok-nx">titulo</span> <span class="tok-o">=</span> <span class="tok-p">{</span>
  <span class="tok-nx">mostrar</span><span class="tok-o">:</span> <span class="tok-kd">function</span><span class="tok-p">(</span><span class="tok-nx">usuario</span><span class="tok-p">)</span> <span class="tok-p">{</span>
    <span class="tok-nx">usuario</span><span class="tok-p">.</span><span class="tok-nx">obtenerPerfil</span><span class="tok-p">().</span><span class="tok-nx">then</span><span class="tok-p">(</span><span class="tok-kd">function</span><span class="tok-p">(</span><span class="tok-nx">perfil</span><span class="tok-p">)</span> <span class="tok-p">{</span>
      <span class="tok-nb">document</span><span class="tok-p">.</span><span class="tok-nx">getElementById</span><span class="tok-p">(</span><span class="tok-s2">&quot;titulo&quot;</span><span class="tok-p">).</span><span class="tok-nx">innerHTML</span> <span class="tok-o">=</span> <span class="tok-nx">perfil</span><span class="tok-p">.</span><span class="tok-nx">nombre</span><span class="tok-p">;</span>
    <span class="tok-p">});</span>
  <span class="tok-p">}</span>
<span class="tok-p">}</span>

<span class="tok-nx">navbar</span><span class="tok-p">.</span><span class="tok-nx">mostrar</span><span class="tok-p">(</span><span class="tok-nx">usuario</span><span class="tok-p">);</span> <i class="conum" data-value="1"></i><b>(1)</b>
<span class="tok-nx">titulo</span><span class="tok-p">.</span><span class="tok-nx">mostrar</span><span class="tok-p">(</span><span class="tok-nx">usuario</span><span class="tok-p">);</span></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Da igual si se ha obtenido el usuario. Como se obtiene una promesa, cuando se resuelva será cuando se dibujen los datos</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Así pues, podemos añadir tanto consumidores a una misma promesa conforme necesitamos, los cuales se ejecutarán una vez de resuelva la misma.</p>
</div>
<div class="paragraph">
<p>Además, podemos añadir más <em>callback</em> cuando queramos, incluso si la promesa ya ha sido resuelta o rechazada (en dicho caso, se ejecutarán inmediatamente).</p>
</div>
</div>
<div class="sect4">
<h5 id="_devolviendo_promesas">Devolviendo promesas</h5>
<div class="paragraph">
<p>¿Y si queremos realizar una acción tras mostrar los datos del usuario? Al tratarse de una tarea asíncrona, necesitamos a su vez, que las operaciones de mostrar los datos también devuelvan una promesa.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
Cualquier función que utilice una promesa debería devolver una nueva promesa
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Ahora nuestro código quedará así:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="javascript"><span class="tok-c1">// ...</span>
<span class="tok-kd">var</span> <span class="tok-nx">titulo</span> <span class="tok-o">=</span> <span class="tok-p">{</span>
  <span class="tok-nx">mostrar</span><span class="tok-o">:</span> <span class="tok-kd">function</span><span class="tok-p">(</span><span class="tok-nx">usuario</span><span class="tok-p">)</span> <span class="tok-p">{</span>
    <span class="tok-k">return</span> <span class="tok-nx">usuario</span><span class="tok-p">.</span><span class="tok-nx">obtenerPerfil</span><span class="tok-p">().</span><span class="tok-nx">then</span><span class="tok-p">(</span><span class="tok-kd">function</span><span class="tok-p">(</span><span class="tok-nx">perfil</span><span class="tok-p">)</span> <span class="tok-p">{</span>  <i class="conum" data-value="1"></i><b>(1)</b>
      <span class="tok-nb">document</span><span class="tok-p">.</span><span class="tok-nx">getElementById</span><span class="tok-p">(</span><span class="tok-s2">&quot;titulo&quot;</span><span class="tok-p">).</span><span class="tok-nx">innerHTML</span> <span class="tok-o">=</span> <span class="tok-nx">perfil</span><span class="tok-p">.</span><span class="tok-nx">nombre</span><span class="tok-p">;</span>
    <span class="tok-p">});</span>
  <span class="tok-p">}</span>
<span class="tok-p">}</span></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Como <code>then</code> devuelve una promesa, a su vez, hacemos que <code>mostrar</code> la  propague</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_prometiendo_code_xmlhttprequest_code">8.2.5. Prometiendo <code>XMLHttpRequest</code></h4>
<div class="paragraph">
<p>A día de hoy <code>XMLHttpRequest</code> no devuelve una promesa. Siendo, probablemente, la operación asíncrona más empleada por su uso en AJAX, el hecho de que devuelva una promesa va a simplicar las peticiones AJAX. Para ello, podemos crear una función que devuelve una promesa del siguiente modo:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="javascript"><span class="tok-kd">function</span> <span class="tok-nx">ajaxUA</span><span class="tok-p">(</span><span class="tok-nx">url</span><span class="tok-p">)</span> <span class="tok-p">{</span>
  <span class="tok-k">return</span> <span class="tok-k">new</span> <span class="tok-nx">Promise</span><span class="tok-p">(</span><span class="tok-kd">function</span><span class="tok-p">(</span><span class="tok-nx">resolver</span><span class="tok-p">,</span> <span class="tok-nx">rechazar</span><span class="tok-p">)</span> <span class="tok-p">{</span>	<i class="conum" data-value="1"></i><b>(1)</b>
    <span class="tok-kd">var</span> <span class="tok-nx">req</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-nx">XMLHttpRequest</span><span class="tok-p">();</span>
    <span class="tok-nx">req</span><span class="tok-p">.</span><span class="tok-nx">open</span><span class="tok-p">(</span><span class="tok-s1">&#39;GET&#39;</span><span class="tok-p">,</span> <span class="tok-nx">url</span><span class="tok-p">);</span>

    <span class="tok-nx">req</span><span class="tok-p">.</span><span class="tok-nx">onload</span> <span class="tok-o">=</span> <span class="tok-kd">function</span><span class="tok-p">()</span> <span class="tok-p">{</span>
      <span class="tok-k">if</span> <span class="tok-p">(</span><span class="tok-nx">req</span><span class="tok-p">.</span><span class="tok-nx">status</span> <span class="tok-o">==</span> <span class="tok-mi">200</span><span class="tok-p">)</span> <span class="tok-p">{</span>
        <span class="tok-nx">resolver</span><span class="tok-p">(</span><span class="tok-nx">req</span><span class="tok-p">.</span><span class="tok-nx">response</span><span class="tok-p">);</span>	<i class="conum" data-value="2"></i><b>(2)</b>
      <span class="tok-p">}</span> <span class="tok-k">else</span> <span class="tok-p">{</span>
        <span class="tok-nx">rechazar</span><span class="tok-p">(</span><span class="tok-nb">Error</span><span class="tok-p">(</span><span class="tok-nx">req</span><span class="tok-p">.</span><span class="tok-nx">statusText</span><span class="tok-p">));</span>	<i class="conum" data-value="3"></i><b>(3)</b>
      <span class="tok-p">}</span>
    <span class="tok-p">};</span>

    <span class="tok-nx">req</span><span class="tok-p">.</span><span class="tok-nx">onerror</span> <span class="tok-o">=</span> <span class="tok-kd">function</span><span class="tok-p">()</span> <span class="tok-p">{</span>	<i class="conum" data-value="4"></i><b>(4)</b>
      <span class="tok-nx">reject</span><span class="tok-p">(</span><span class="tok-nb">Error</span><span class="tok-p">(</span><span class="tok-s2">&quot;Error de Red&quot;</span><span class="tok-p">));</span>
    <span class="tok-p">};</span>

    <span class="tok-nx">req</span><span class="tok-p">.</span><span class="tok-nx">send</span><span class="tok-p">();</span>
  <span class="tok-p">});</span>
<span class="tok-p">}</span></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Devolvemos una promesa</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Si la petición ha ido bien, resolvemos la promesa</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>En cambio, si ha fallado, la rechazamos</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Controlamos los posibles errores de red</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Hecho esto, podemos realizar las peticiones del siguiente modo:</p>
</div>
<div class="listingblock">
<div class="title">Ejemplo <code>then</code></div>
<div class="content">
<pre class="pygments highlight"><code data-lang="javascript"><span class="tok-nx">ajaxUA</span><span class="tok-p">(</span><span class="tok-s1">&#39;heroes.json&#39;</span><span class="tok-p">).</span><span class="tok-nx">then</span><span class="tok-p">(</span><span class="tok-kd">function</span><span class="tok-p">(</span><span class="tok-nx">response</span><span class="tok-p">)</span> <span class="tok-p">{</span>
  <span class="tok-nx">console</span><span class="tok-p">.</span><span class="tok-nx">log</span><span class="tok-p">(</span><span class="tok-s2">&quot;¡Bien!&quot;</span><span class="tok-p">,</span> <span class="tok-nx">response</span><span class="tok-p">);</span>
<span class="tok-p">},</span> <span class="tok-kd">function</span><span class="tok-p">(</span><span class="tok-nx">error</span><span class="tok-p">)</span> <span class="tok-p">{</span>
  <span class="tok-nx">console</span><span class="tok-p">.</span><span class="tok-nx">error</span><span class="tok-p">(</span><span class="tok-s2">&quot;¡Mal!&quot;</span><span class="tok-p">,</span> <span class="tok-nx">error</span><span class="tok-p">);</span>
<span class="tok-p">});</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Gracias al encadenamiento de promesas, podemos obtener el texto de una petición AJAX del siguiente modo:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="javascript"><span class="tok-nx">ajaxUA</span><span class="tok-p">(</span><span class="tok-s1">&#39;heroes.json&#39;</span><span class="tok-p">).</span><span class="tok-nx">then</span><span class="tok-p">(</span><span class="tok-kd">function</span><span class="tok-p">(</span><span class="tok-nx">response</span><span class="tok-p">)</span> <span class="tok-p">{</span> <i class="conum" data-value="1"></i><b>(1)</b>
  <span class="tok-k">return</span> <span class="tok-nx">JSON</span><span class="tok-p">.</span><span class="tok-nx">parse</span><span class="tok-p">(</span><span class="tok-nx">response</span><span class="tok-p">);</span>
<span class="tok-p">}).</span><span class="tok-nx">then</span><span class="tok-p">(</span><span class="tok-kd">function</span><span class="tok-p">(</span><span class="tok-nx">response</span><span class="tok-p">)</span> <span class="tok-p">{</span>  <i class="conum" data-value="2"></i><b>(2)</b>
  <span class="tok-nx">console</span><span class="tok-p">.</span><span class="tok-nx">log</span><span class="tok-p">(</span><span class="tok-s2">&quot;JSON de Heroes:&quot;</span><span class="tok-p">,</span> <span class="tok-nx">response</span><span class="tok-p">);</span>
<span class="tok-p">});</span></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Recibe la respuesta JSON</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Recibe el objeto JavaScript parseado</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Además, como <code>JSON.parse</code> recibe un único argumento y devuelve el texto transformado, podemos simplicarlo del siguiente modo:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="javascript"><span class="tok-nx">ajaxUA</span><span class="tok-p">(</span><span class="tok-s1">&#39;heroes.json&#39;</span><span class="tok-p">).</span><span class="tok-nx">then</span><span class="tok-p">(</span><span class="tok-nx">JSON</span><span class="tok-p">.</span><span class="tok-nx">parse</span><span class="tok-p">).</span><span class="tok-nx">then</span><span class="tok-p">(</span><span class="tok-kd">function</span><span class="tok-p">(</span><span class="tok-nx">response</span><span class="tok-p">)</span> <span class="tok-p">{</span>
  <span class="tok-nx">console</span><span class="tok-p">.</span><span class="tok-nx">log</span><span class="tok-p">(</span><span class="tok-s2">&quot;JSON de Heroes:&quot;</span><span class="tok-p">,</span> <span class="tok-nx">response</span><span class="tok-p">);</span>
<span class="tok-p">});</span></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_encadenando_promesas">8.2.6. Encadenando promesas</h4>
<div class="paragraph">
<p>Acabamos de ver que tanto <code>then</code> como <code>catch</code> devuelven una promesa, lo que facilita su encadenamiento, aunque no devuelven una referencia a la misma promesa. Cada vez que se llama a uno de estos métodos se crea una nueva promesa y se devuelve, siendo estas dos promesas diferentes:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="javascript"><span class="tok-kd">var</span> <span class="tok-nx">p1</span><span class="tok-p">,</span><span class="tok-nx">p2</span><span class="tok-p">;</span>

<span class="tok-nx">p1</span> <span class="tok-o">=</span> <span class="tok-nx">Promise</span><span class="tok-p">.</span><span class="tok-nx">resolve</span><span class="tok-p">();</span>
<span class="tok-nx">p2</span> <span class="tok-o">=</span> <span class="tok-nx">p1</span><span class="tok-p">.</span><span class="tok-nx">then</span><span class="tok-p">(</span><span class="tok-kd">function</span><span class="tok-p">()</span> <span class="tok-p">{</span>
  <span class="tok-c1">// ....</span>
<span class="tok-p">});</span>
<span class="tok-nx">console</span><span class="tok-p">.</span><span class="tok-nx">log</span><span class="tok-p">(</span><span class="tok-nx">p1</span> <span class="tok-o">!==</span> <span class="tok-nx">p2</span><span class="tok-p">);</span>  <span class="tok-c1">// true</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Gracias a esto podemos encadenar promesas con el resultado de un paso anterior:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="javascript"><span class="tok-nx">paso1</span><span class="tok-p">().</span><span class="tok-nx">then</span><span class="tok-p">(</span>
  <span class="tok-kd">function</span> <span class="tok-nx">paso2</span><span class="tok-p">(</span><span class="tok-nx">resultadoPaso1</span><span class="tok-p">)</span> <span class="tok-p">{</span>
    <span class="tok-c1">// Acciones paso 2</span>
  <span class="tok-p">}</span>
<span class="tok-p">).</span><span class="tok-nx">then</span><span class="tok-p">(</span>
  <span class="tok-kd">function</span> <span class="tok-nx">paso3</span><span class="tok-p">(</span><span class="tok-nx">resultadoPaso2</span><span class="tok-p">)</span> <span class="tok-p">{</span>
    <span class="tok-c1">// Acciones paso 3</span>
  <span class="tok-p">}</span>
<span class="tok-p">).</span><span class="tok-nx">then</span><span class="tok-p">(</span>
  <span class="tok-kd">function</span> <span class="tok-nx">paso4</span><span class="tok-p">(</span><span class="tok-nx">resultadoPaso3</span><span class="tok-p">)</span> <span class="tok-p">{</span>
    <span class="tok-c1">// Acciones paso 3</span>
  <span class="tok-p">}</span>
<span class="tok-p">)</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Cada llamada a <code>then</code> devuelve una nueva promesa que podemos emplear para adjuntarla a otro <em>callback</em>. Sea cual sea el valor que devuelve el <em>callback</em> resuelve la nueva promesa. Mediante este patrón podemos hacer que cada paso envíe su valor devuelto al siguiente paso.</p>
</div>
<div class="paragraph">
<p>Si un paso devuelve una promesa en vez de un valor, el siguiente paso recibe el valor empleado para completar la promesa. Veamos este caso mediante un ejemplo:</p>
</div>
<div class="listingblock">
<div class="title">Ejemplo Encadenado de Promesas: <a href="http://jsbin.com/pibahakawi/edit?js,console" class="bare">http://jsbin.com/pibahakawi/edit?js,console</a></div>
<div class="content">
<pre class="pygments highlight"><code data-lang="javascript"><span class="tok-nx">Promise</span><span class="tok-p">.</span><span class="tok-nx">resolve</span><span class="tok-p">(</span><span class="tok-s1">&#39;Hola!&#39;</span><span class="tok-p">).</span><span class="tok-nx">then</span><span class="tok-p">(</span>
  <span class="tok-kd">function</span> <span class="tok-nx">paso2</span><span class="tok-p">(</span><span class="tok-nx">resultado</span><span class="tok-p">)</span> <span class="tok-p">{</span>
    <span class="tok-nx">console</span><span class="tok-p">.</span><span class="tok-nx">log</span><span class="tok-p">(</span><span class="tok-s1">&#39;Recibido paso 2: &#39;</span> <span class="tok-o">+</span> <span class="tok-nx">resultado</span><span class="tok-p">);</span>
    <span class="tok-k">return</span> <span class="tok-s1">&#39;Saludos desde el paso 2&#39;</span><span class="tok-p">;</span>               <span class="tok-c1">// Devolvemos un valor</span>
  <span class="tok-p">}</span>
<span class="tok-p">).</span><span class="tok-nx">then</span><span class="tok-p">(</span>
  <span class="tok-kd">function</span> <span class="tok-nx">paso3</span><span class="tok-p">(</span><span class="tok-nx">resultado</span><span class="tok-p">)</span> <span class="tok-p">{</span>
    <span class="tok-nx">console</span><span class="tok-p">.</span><span class="tok-nx">log</span><span class="tok-p">(</span><span class="tok-s1">&#39;Recibido paso 3: &#39;</span> <span class="tok-o">+</span> <span class="tok-nx">resultado</span><span class="tok-p">);</span>     <span class="tok-c1">// No devolvemos nada</span>
  <span class="tok-p">}</span>
<span class="tok-p">).</span><span class="tok-nx">then</span><span class="tok-p">(</span>
  <span class="tok-kd">function</span> <span class="tok-nx">paso4</span><span class="tok-p">(</span><span class="tok-nx">resultado</span><span class="tok-p">)</span> <span class="tok-p">{</span>
    <span class="tok-nx">console</span><span class="tok-p">.</span><span class="tok-nx">log</span><span class="tok-p">(</span><span class="tok-s1">&#39;Recibido paso 4: &#39;</span> <span class="tok-o">+</span> <span class="tok-nx">resultado</span><span class="tok-p">);</span>
    <span class="tok-k">return</span> <span class="tok-nx">Promise</span><span class="tok-p">.</span><span class="tok-nx">resolve</span><span class="tok-p">(</span><span class="tok-s1">&#39;Valor completado&#39;</span><span class="tok-p">);</span>    <span class="tok-c1">// Devuelve una promesa</span>
  <span class="tok-p">}</span>
<span class="tok-p">).</span><span class="tok-nx">then</span><span class="tok-p">(</span>
  <span class="tok-kd">function</span> <span class="tok-nx">paso5</span><span class="tok-p">(</span><span class="tok-nx">resultado</span><span class="tok-p">)</span> <span class="tok-p">{</span>
    <span class="tok-nx">console</span><span class="tok-p">.</span><span class="tok-nx">log</span><span class="tok-p">(</span><span class="tok-s1">&#39;Recibido paso 5: &#39;</span> <span class="tok-o">+</span> <span class="tok-nx">resultado</span><span class="tok-p">);</span>
  <span class="tok-p">}</span>
<span class="tok-p">);</span>

<span class="tok-c1">// Consola</span>
<span class="tok-c1">// &quot;Recibido paso 2: Hola!&quot;</span>
<span class="tok-c1">// &quot;Recibido paso 3: Saludos desde el paso 2&quot;</span>
<span class="tok-c1">// &quot;Recibido paso 4: undefined&quot;</span>
<span class="tok-c1">// &quot;Recibido paso 5: Valor completado&quot;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Al devolver un valor de manera explícita como en el paso dos, la promesa se resuelve. Como el paso 3 no devuelve ningún valor, la promesa se completa con <code>undefined</code>. Y el valor devuelto por el paso 4 completa la promesa que envuelve el paso 4.</p>
</div>
</div>
<div class="sect3">
<h4 id="_orden_de_ejecución_de_em_callbacks_em">8.2.7. Orden de ejecución de <em>callbacks</em></h4>
<div class="paragraph">
<p>Los promesas permiten gestionar el orden en el que se ejecuta el codigo respecto a otras tareas. Hay que distinguir bien entre qué elementos se ejecutan de manera síncrona, y cuales asíncronos.</p>
</div>
<div class="paragraph">
<p>La función <code>resolver</code> que se le pasa al constructor de <code>Promise</code> se ejecuta de manera síncrona. En cambio, todos los <em>callbacks</em> que se le pasan a <code>then</code> y a <code>catch</code> se invocan de manera asíncrona.</p>
</div>
<div class="paragraph">
<p>Veamoslo con un ejemplo:</p>
</div>
<div class="listingblock">
<div class="title">Ejemplo orden de ejecución</div>
<div class="content">
<pre class="pygments highlight"><code data-lang="javascript"><span class="tok-kd">var</span> <span class="tok-nx">promesa</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-nx">Promise</span><span class="tok-p">(</span><span class="tok-kd">function</span> <span class="tok-p">(</span><span class="tok-nx">resolver</span><span class="tok-p">,</span> <span class="tok-nx">rechazar</span><span class="tok-p">)</span> <span class="tok-p">{</span>
  <span class="tok-nx">console</span><span class="tok-p">.</span><span class="tok-nx">log</span><span class="tok-p">(</span><span class="tok-s2">&quot;Antes de la funcion resolver&quot;</span><span class="tok-p">);</span>
  <span class="tok-nx">resolver</span><span class="tok-p">();</span>
<span class="tok-p">});</span>

<span class="tok-nx">promesa</span><span class="tok-p">.</span><span class="tok-nx">then</span><span class="tok-p">(</span><span class="tok-kd">function</span><span class="tok-p">()</span> <span class="tok-p">{</span>
  <span class="tok-nx">console</span><span class="tok-p">.</span><span class="tok-nx">log</span><span class="tok-p">(</span><span class="tok-s2">&quot;Dentro del callback de completado&quot;</span><span class="tok-p">);</span>
<span class="tok-p">});</span>

<span class="tok-nx">console</span><span class="tok-p">.</span><span class="tok-nx">log</span><span class="tok-p">(</span><span class="tok-s2">&quot;Fin de la cita&quot;</span><span class="tok-p">);</span>

<span class="tok-c1">// Consola</span>
<span class="tok-c1">// Antes de la funcion resolver</span>
<span class="tok-c1">// Fin de la cita</span>
<span class="tok-c1">// Dentro del callback de completado</span></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_gestión_de_errores_3">8.2.8. Gestión de errores</h4>
<div class="paragraph">
<p>Los rechazos y los errores se propagan a través de la cadena de promesas. Cuando se rechaza una promesa, todas las siguientes promesas de la cadena se rechazan como si fuera un dominó. Para detener el efecto dominó, debemos capturar el rechazo.</p>
</div>
<div class="paragraph">
<p>Para ello, además de utilizar el método <code>then</code> y pasar como segundo argumento la función para gestionar los errores, el API nos ofrece el método <code>catch</code>:</p>
</div>
<div class="listingblock">
<div class="title">Ejemplo <code>catch</code></div>
<div class="content">
<pre class="pygments highlight"><code data-lang="javascript"><span class="tok-nx">ajaxUA</span><span class="tok-p">(</span><span class="tok-s1">&#39;heroes.json&#39;</span><span class="tok-p">).</span><span class="tok-nx">then</span><span class="tok-p">(</span><span class="tok-kd">function</span><span class="tok-p">(</span><span class="tok-nx">response</span><span class="tok-p">)</span> <span class="tok-p">{</span>
  <span class="tok-nx">console</span><span class="tok-p">.</span><span class="tok-nx">log</span><span class="tok-p">(</span><span class="tok-s2">&quot;¡Bien!&quot;</span><span class="tok-p">,</span> <span class="tok-nx">response</span><span class="tok-p">);</span>
<span class="tok-p">}).</span><span class="tok-k">catch</span><span class="tok-p">(</span><span class="tok-kd">function</span><span class="tok-p">(</span><span class="tok-nx">error</span><span class="tok-p">)</span> <span class="tok-p">{</span>
  <span class="tok-nx">console</span><span class="tok-p">.</span><span class="tok-nx">error</span><span class="tok-p">(</span><span class="tok-s2">&quot;¡Mal!&quot;</span><span class="tok-p">,</span> <span class="tok-nx">error</span><span class="tok-p">);</span>
<span class="tok-p">});</span></code></pre>
</div>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
En la práctica, se utiliza un método <code>catch</code> al final de la cadena para manejar todos los rechazos.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Veamos como utilizar un <code>catch</code> al final de una cadena de promesas:</p>
</div>
<div class="listingblock">
<div class="title">Ejemplo <code>catch</code> al final de una cadena de promesas</div>
<div class="content">
<pre class="pygments highlight"><code data-lang="javascript"><span class="tok-nx">Promise</span><span class="tok-p">.</span><span class="tok-nx">reject</span><span class="tok-p">(</span><span class="tok-nb">Error</span><span class="tok-p">(</span><span class="tok-s2">&quot;Algo ha ido mal&quot;</span><span class="tok-p">)).</span><span class="tok-nx">then</span><span class="tok-p">(</span>  <i class="conum" data-value="1"></i><b>(1)</b>
  <span class="tok-kd">function</span> <span class="tok-nx">paso2</span><span class="tok-p">()</span> <span class="tok-p">{</span>  <i class="conum" data-value="2"></i><b>(2)</b>
    <span class="tok-nx">console</span><span class="tok-p">.</span><span class="tok-nx">log</span><span class="tok-p">(</span><span class="tok-s2">&quot;Por aquí no pasaré&quot;</span><span class="tok-p">);</span>
  <span class="tok-p">}</span>
<span class="tok-p">).</span><span class="tok-nx">then</span><span class="tok-p">(</span>
  <span class="tok-kd">function</span> <span class="tok-nx">paso3</span><span class="tok-p">()</span> <span class="tok-p">{</span>
    <span class="tok-nx">console</span><span class="tok-p">.</span><span class="tok-nx">log</span><span class="tok-p">(</span><span class="tok-s2">&quot;Y por aquí tampoco&quot;</span><span class="tok-p">);</span>
  <span class="tok-p">}</span>
<span class="tok-p">).</span><span class="tok-k">catch</span><span class="tok-p">(</span>  <i class="conum" data-value="3"></i><b>(3)</b>
  <span class="tok-kd">function</span> <span class="tok-p">(</span><span class="tok-nx">err</span><span class="tok-p">)</span> <span class="tok-p">{</span>
    <span class="tok-nx">console</span><span class="tok-p">.</span><span class="tok-nx">error</span><span class="tok-p">(</span><span class="tok-s2">&quot;Algo ha fallado por el camino&quot;</span><span class="tok-p">);</span>
    <span class="tok-nx">console</span><span class="tok-p">.</span><span class="tok-nx">error</span><span class="tok-p">(</span><span class="tok-nx">err</span><span class="tok-p">);</span>
  <span class="tok-p">}</span>
<span class="tok-p">);</span>

<span class="tok-c1">// Consola</span>
<span class="tok-c1">// Algo ha fallado por el camino</span>
<span class="tok-c1">// Error: Algo ha ido mal</span></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Creamos una promesa rechazada</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>No se ejectuan ni el paso 2, ni el 3, ya que la promesa no se ha cumplido</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>En cambio, si lo hace el manejador del error.</td>
</tr>
</table>
</div>
<div class="sect4">
<h5 id="_excepciones_y_promesas">Excepciones y promesas</h5>
<div class="paragraph">
<p>Una promesa se rechaza si se hace de manera explicita mediante la función <code>rechazar</code> del constructor, con <code>Promise.reject</code> o si el <em>callback</em> pasado a <code>then</code> lanza un error:</p>
</div>
<div class="paragraph">
<p>Vamos a repetir el ejemplo, pero lanzando un <code>Error</code> en el constructor de la promesa:</p>
</div>
<div class="listingblock">
<div class="title">Ejemplo <code>catch</code> con <code>Error</code> lanzado por el constructor</div>
<div class="content">
<pre class="pygments highlight"><code data-lang="javascript"><span class="tok-nx">rechazarCon</span><span class="tok-p">(</span><span class="tok-s2">&quot;¡Malas noticias!&quot;</span><span class="tok-p">).</span><span class="tok-nx">then</span><span class="tok-p">(</span>
  <span class="tok-kd">function</span> <span class="tok-nx">paso2</span><span class="tok-p">()</span> <span class="tok-p">{</span>
    <span class="tok-nx">console</span><span class="tok-p">.</span><span class="tok-nx">log</span><span class="tok-p">(</span><span class="tok-s2">&quot;Por aquí no pasaré&quot;</span><span class="tok-p">)</span>
  <span class="tok-p">}</span>
<span class="tok-p">).</span><span class="tok-k">catch</span><span class="tok-p">(</span>
  <span class="tok-kd">function</span> <span class="tok-p">(</span><span class="tok-nx">err</span><span class="tok-p">)</span> <span class="tok-p">{</span>
    <span class="tok-nx">console</span><span class="tok-p">.</span><span class="tok-nx">error</span><span class="tok-p">(</span><span class="tok-s2">&quot;Y vuelve a fallar&quot;</span><span class="tok-p">);</span>
    <span class="tok-nx">console</span><span class="tok-p">.</span><span class="tok-nx">error</span><span class="tok-p">(</span><span class="tok-nx">err</span><span class="tok-p">);</span>
  <span class="tok-p">}</span>
<span class="tok-p">);</span>

<span class="tok-kd">function</span> <span class="tok-nx">rechazarCon</span><span class="tok-p">(</span><span class="tok-nx">cadena</span><span class="tok-p">)</span> <span class="tok-p">{</span>
  <span class="tok-k">return</span> <span class="tok-k">new</span> <span class="tok-nx">Promise</span><span class="tok-p">(</span><span class="tok-kd">function</span> <span class="tok-p">(</span><span class="tok-nx">resolver</span><span class="tok-p">,</span> <span class="tok-nx">rechazar</span><span class="tok-p">)</span> <span class="tok-p">{</span>
    <span class="tok-k">throw</span> <span class="tok-nb">Error</span><span class="tok-p">(</span><span class="tok-nx">cadena</span><span class="tok-p">);</span>
    <span class="tok-nx">resolver</span><span class="tok-p">(</span><span class="tok-s2">&quot;No se utiliza&quot;</span><span class="tok-p">);</span>
  <span class="tok-p">});</span>
<span class="tok-p">}</span>
<span class="tok-c1">// Consola</span>
<span class="tok-c1">// Y vuelve a fallar</span>
<span class="tok-c1">// Error: ¡Malas noticias!</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Este comportamiento resalta la ventaja de realizar todo el trabajo relacionado con la promesa dentro del callback del constructor, para que los errores se capturen automáticamente y se conviertan en rechazos.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
Al lanzar el objeto <code>Error</code> para rechazar una promesa, la pila de llamadas se captura, lo que facilita el manejo del error en el manejador <code>catch</code>.
</td>
</tr>
</table>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="title">Autoevaluación</div>
<div class="paragraph">
<p>A partir del siguiente código anterior, ¿Qué mensajes saldrán por pantalla? <span class="footnote">[<a id="_footnoteref_16" class="footnote" href="#_footnote_16" title="View footnote.">16</a>]</span></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="javascript"><span class="tok-kd">var</span> <span class="tok-nx">promesaJSON</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-nx">Promise</span><span class="tok-p">(</span><span class="tok-kd">function</span><span class="tok-p">(</span><span class="tok-nx">resolver</span><span class="tok-p">,</span> <span class="tok-nx">rechazar</span><span class="tok-p">)</span> <span class="tok-p">{</span>
  <span class="tok-nx">resolver</span><span class="tok-p">(</span><span class="tok-nx">JSON</span><span class="tok-p">.</span><span class="tok-nx">parse</span><span class="tok-p">(</span><span class="tok-s2">&quot;Esto no es JSON&quot;</span><span class="tok-p">));</span>
<span class="tok-p">});</span>

<span class="tok-nx">promesaJSON</span><span class="tok-p">.</span><span class="tok-nx">then</span><span class="tok-p">(</span><span class="tok-kd">function</span><span class="tok-p">(</span><span class="tok-nx">datos</span><span class="tok-p">)</span> <span class="tok-p">{</span>
  <span class="tok-nx">console</span><span class="tok-p">.</span><span class="tok-nx">log</span><span class="tok-p">(</span><span class="tok-s2">&quot;¡Bien!&quot;</span><span class="tok-p">,</span> <span class="tok-nx">datos</span><span class="tok-p">);</span>
<span class="tok-p">}).</span><span class="tok-k">catch</span><span class="tok-p">(</span><span class="tok-kd">function</span><span class="tok-p">(</span><span class="tok-nx">err</span><span class="tok-p">)</span> <span class="tok-p">{</span>
  <span class="tok-nx">console</span><span class="tok-p">.</span><span class="tok-nx">error</span><span class="tok-p">(</span><span class="tok-s2">&quot;¡Mal!&quot;</span><span class="tok-p">,</span> <span class="tok-nx">err</span><span class="tok-p">);</span>
<span class="tok-p">});</span></code></pre>
</div>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="__code_catch_code_vs_code_then_undefined_función_code"><code>catch</code> vs <code>then(undefined, función)</code></h5>
<div class="paragraph">
<p>El método <code>catch</code> es similar a emplear <code>then(undefined, función)</code>, pero más legible. Por lo tanto, el anterior fragmento (Ejemplo <code>catch</code>) es equivalente a este:</p>
</div>
<div class="listingblock">
<div class="title">Ejemplo <code>then(undefined, función)</code></div>
<div class="content">
<pre class="pygments highlight"><code data-lang="javascript"><span class="tok-nx">ajaxUA</span><span class="tok-p">(</span><span class="tok-s1">&#39;heroes.json&#39;</span><span class="tok-p">).</span><span class="tok-nx">then</span><span class="tok-p">(</span><span class="tok-kd">function</span><span class="tok-p">(</span><span class="tok-nx">response</span><span class="tok-p">)</span> <span class="tok-p">{</span>
  <span class="tok-nx">console</span><span class="tok-p">.</span><span class="tok-nx">log</span><span class="tok-p">(</span><span class="tok-s2">&quot;¡Bien!&quot;</span><span class="tok-p">,</span> <span class="tok-nx">response</span><span class="tok-p">);</span>
<span class="tok-p">}).</span><span class="tok-nx">then</span><span class="tok-p">(</span><span class="tok-kc">undefined</span><span class="tok-p">,</span> <span class="tok-kd">function</span><span class="tok-p">(</span><span class="tok-nx">error</span><span class="tok-p">)</span> <span class="tok-p">{</span>
  <span class="tok-nx">console</span><span class="tok-p">.</span><span class="tok-nx">error</span><span class="tok-p">(</span><span class="tok-s2">&quot;¡Mal!&quot;</span><span class="tok-p">,</span> <span class="tok-nx">error</span><span class="tok-p">);</span>
<span class="tok-p">});</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Pero que sean similares no significan que sean iguales. Hay una sutil diferencia entre encadenar dos funciones <code>then</code> a hacerlo con una sola. Al rechazar una promesa se pasa al siguiente <code>then</code> con un callback de rechazo (o <code>catch</code>, ya que son equivalentes). Es decir, con <code>then(func1, func2)</code>, se llamará a <em>func1</em> o a <em>func2</em>, nunca a las dos. Pero con
<code>then(func1).catch(func2)</code>, se llamarán a ambas si <em>func1</em> rechaza la promesa, ya que son pasos separados de la cadena.</p>
</div>
<div class="paragraph">
<p>Veamoslo con otro ejemplo:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="javascript"><span class="tok-nx">paso1</span><span class="tok-p">().</span><span class="tok-nx">then</span><span class="tok-p">(</span><span class="tok-kd">function</span><span class="tok-p">()</span> <span class="tok-p">{</span>
  <span class="tok-k">return</span> <span class="tok-nx">paso2</span><span class="tok-p">();</span>
<span class="tok-p">}).</span><span class="tok-nx">then</span><span class="tok-p">(</span><span class="tok-kd">function</span><span class="tok-p">()</span> <span class="tok-p">{</span>
  <span class="tok-k">return</span> <span class="tok-nx">paso3</span><span class="tok-p">();</span>
<span class="tok-p">}).</span><span class="tok-k">catch</span><span class="tok-p">(</span><span class="tok-kd">function</span><span class="tok-p">(</span><span class="tok-nx">err</span><span class="tok-p">)</span> <span class="tok-p">{</span>
  <span class="tok-k">return</span> <span class="tok-nx">recuperacion1</span><span class="tok-p">();</span>
<span class="tok-p">}).</span><span class="tok-nx">then</span><span class="tok-p">(</span><span class="tok-kd">function</span><span class="tok-p">()</span> <span class="tok-p">{</span>
    <span class="tok-k">return</span> <span class="tok-nx">paso4</span><span class="tok-p">();</span>
  <span class="tok-p">},</span> <span class="tok-kd">function</span><span class="tok-p">(</span><span class="tok-nx">err</span><span class="tok-p">)</span> <span class="tok-p">{</span>
    <span class="tok-k">return</span> <span class="tok-nx">recuperacion2</span><span class="tok-p">();</span>
<span class="tok-p">}).</span><span class="tok-k">catch</span><span class="tok-p">(</span><span class="tok-kd">function</span><span class="tok-p">(</span><span class="tok-nx">err</span><span class="tok-p">)</span> <span class="tok-p">{</span>
  <span class="tok-nx">console</span><span class="tok-p">.</span><span class="tok-nx">error</span><span class="tok-p">(</span><span class="tok-s2">&quot;No me importa nada&quot;</span><span class="tok-p">);</span>
<span class="tok-p">}).</span><span class="tok-nx">then</span><span class="tok-p">(</span><span class="tok-kd">function</span><span class="tok-p">()</span> <span class="tok-p">{</span>
  <span class="tok-nx">console</span><span class="tok-p">.</span><span class="tok-nx">log</span><span class="tok-p">(</span><span class="tok-s2">&quot;¡Finiquitado!&quot;</span><span class="tok-p">);</span>
<span class="tok-p">});</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Este flujo de llamadas es muy similar a emplear <em>try/catch</em> en el lenguaje estandard de manera que los errores que suceden dentro de un <code>try</code> saltan inmediatamanete al bloque <code>catch</code>.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_promesas_en_paralelo">8.2.9. Promesas en paralelo</h4>
<div class="paragraph">
<p>Si tenemos un conjunto de promesas que queremos ejecutar, y lo hacemos mediante un bucle, se ejecutarán en paralelo, en un orden indeterminado finalizando cada una conforme al tiempo necesario por cada tarea.</p>
</div>
<div class="paragraph">
<p>Supongamos que tenemos una aplicación bancaria en la cual tenemos varias cuentas, de manera que cuando el usuario entra en la aplicación, se le muestra el saldo de cada una de ellas:</p>
</div>
<div class="listingblock">
<div class="title">Ejemplo promesas en paralelo</div>
<div class="content">
<pre class="pygments highlight"><code data-lang="javascript"><span class="tok-kd">var</span> <span class="tok-nx">cuentas</span> <span class="tok-o">=</span> <span class="tok-p">[</span><span class="tok-s2">&quot;/banco1/12345678&quot;</span><span class="tok-p">,</span> <span class="tok-s2">&quot;/banco2/13572468&quot;</span><span class="tok-p">,</span> <span class="tok-s2">&quot;/banco3/87654321&quot;</span><span class="tok-p">];</span>

<span class="tok-nx">cuentas</span><span class="tok-p">.</span><span class="tok-nx">forEach</span><span class="tok-p">(</span><span class="tok-kd">function</span><span class="tok-p">(</span><span class="tok-nx">cuenta</span><span class="tok-p">)</span> <span class="tok-p">{</span>
  <span class="tok-nx">ajaxUA</span><span class="tok-p">(</span><span class="tok-nx">cuenta</span><span class="tok-p">).</span><span class="tok-nx">then</span><span class="tok-p">(</span><span class="tok-kd">function</span><span class="tok-p">(</span><span class="tok-nx">balance</span><span class="tok-p">)</span> <span class="tok-p">{</span>
    <span class="tok-nx">console</span><span class="tok-p">.</span><span class="tok-nx">log</span><span class="tok-p">(</span><span class="tok-nx">cuenta</span> <span class="tok-o">+</span> <span class="tok-s2">&quot; Balance -&gt; &quot;</span> <span class="tok-o">+</span> <span class="tok-nx">balance</span><span class="tok-p">);</span>
  <span class="tok-p">});</span>
<span class="tok-p">});</span>

<span class="tok-c1">// Consola</span>
<span class="tok-c1">// Banco 1 Balance -&gt; 234</span>
<span class="tok-c1">// Banco 3 Balance -&gt; 1546</span>
<span class="tok-c1">// Banco 2 Balance -&gt; 789</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Si además queremos mostrar un mensaje cuando se hayan consultado todas las cuentas, necesitamos consolidar todas las promesas en una nueva. Para ello, mediante el método <code>Promise.all</code>, podemos escribir código de finalización de tareas paralelas, del tipo "<em>Cuando todas estas cosas hayan finalizado, haz esta otra</em>".</p>
</div>
<div class="paragraph">
<p>El comportamiento de <code>Promise.all(arrayDePromesas).then(function(arrayDeResultados)</code> es el siguiente: devuelve una nueva promesa que se cumplirá cuando lo hayan hecho todas las promesas recibidas. Si alguna se rechaza, la nueva promesa también se rechazará. El resultado es un array de resultados que siguen el mismo orden de las promesas recibidas.</p>
</div>
<div class="paragraph">
<p>Así pues, reescribimos el ejemplo y tendremos:</p>
</div>
<div class="listingblock">
<div class="title">Ejemplo promesas en paralelo, finalización única</div>
<div class="content">
<pre class="pygments highlight"><code data-lang="javascript"><span class="tok-kd">var</span> <span class="tok-nx">cuentas</span> <span class="tok-o">=</span> <span class="tok-p">[</span><span class="tok-s2">&quot;/banco1/12345678&quot;</span><span class="tok-p">,</span> <span class="tok-s2">&quot;/banco2/13572468&quot;</span><span class="tok-p">,</span> <span class="tok-s2">&quot;/banco3/87654321&quot;</span><span class="tok-p">];</span>

<span class="tok-kd">var</span> <span class="tok-nx">peticiones</span> <span class="tok-o">=</span> <span class="tok-nx">cuentas</span><span class="tok-p">.</span><span class="tok-nx">map</span><span class="tok-p">(</span><span class="tok-kd">function</span><span class="tok-p">(</span><span class="tok-nx">cuenta</span><span class="tok-p">)</span> <span class="tok-p">{</span>
  <span class="tok-k">return</span> <span class="tok-nx">ajaxUA</span><span class="tok-p">(</span><span class="tok-nx">cuenta</span><span class="tok-p">);</span>
<span class="tok-p">});</span>

<span class="tok-nx">Promise</span><span class="tok-p">.</span><span class="tok-nx">all</span><span class="tok-p">(</span><span class="tok-nx">peticiones</span><span class="tok-p">).</span><span class="tok-nx">then</span><span class="tok-p">(</span><span class="tok-kd">function</span> <span class="tok-p">(</span><span class="tok-nx">balances</span><span class="tok-p">)</span> <span class="tok-p">{</span>
  <span class="tok-nx">console</span><span class="tok-p">.</span><span class="tok-nx">log</span><span class="tok-p">(</span><span class="tok-s2">&quot;Los &quot;</span> <span class="tok-o">+</span> <span class="tok-nx">balances</span><span class="tok-p">.</span><span class="tok-nx">length</span> <span class="tok-o">+</span> <span class="tok-s2">&quot; han sido actualizados&quot;</span><span class="tok-p">);</span>
<span class="tok-p">}).</span><span class="tok-k">catch</span><span class="tok-p">(</span><span class="tok-kd">function</span><span class="tok-p">(</span><span class="tok-nx">err</span><span class="tok-p">)</span> <span class="tok-p">{</span>
  <span class="tok-nx">console</span><span class="tok-p">.</span><span class="tok-nx">error</span><span class="tok-p">(</span><span class="tok-s2">&quot;Error al recuperar los balances&quot;</span><span class="tok-p">,</span> <span class="tok-nx">err</span><span class="tok-p">);</span>
<span class="tok-p">})</span>
<span class="tok-c1">// Consola</span>
<span class="tok-c1">// Los 3 balances han sido actualizados</span></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_promesas_en_secuencia">8.2.10. Promesas en secuencia</h4>
<div class="paragraph">
<p>Cuando hemos estudiado como encadenar promesas, hemos visto como podemos codificar que una promesa se ejecute cuando ha finalizado la anterior. Para ello, de antemano tenemos que saber las promesas que vamos a gestionar.</p>
</div>
<div class="paragraph">
<p>¿Y si el número de promesas es indeterminado? Es decir, si tenemos un array con las promesas que se tienen que ejecutar secuancialmente ¿Cómo puedo hacerlo?</p>
</div>
<div class="paragraph">
<p>Una solución es hacerlo mediante un bucle iterativo:</p>
</div>
<div class="listingblock">
<div class="title">Ejemplo promesas en secuencia, mediante <code>reduce</code></div>
<div class="content">
<pre class="pygments highlight"><code data-lang="javascript"><span class="tok-kd">function</span> <span class="tok-nx">secuencia</span><span class="tok-p">(</span><span class="tok-nx">array</span><span class="tok-p">,</span> <span class="tok-nx">callback</span><span class="tok-p">)</span> <span class="tok-p">{</span>
  <span class="tok-kd">var</span> <span class="tok-nx">seq</span> <span class="tok-o">=</span> <span class="tok-nx">Promise</span><span class="tok-p">.</span><span class="tok-nx">resolve</span><span class="tok-p">();</span>

  <span class="tok-nx">array</span><span class="tok-p">.</span><span class="tok-nx">forEach</span><span class="tok-p">(</span><span class="tok-kd">function</span> <span class="tok-p">(</span><span class="tok-nx">elem</span><span class="tok-p">)</span> <span class="tok-p">{</span>
    <span class="tok-nx">seq</span> <span class="tok-o">=</span> <span class="tok-nx">seq</span><span class="tok-p">.</span><span class="tok-nx">then</span><span class="tok-p">(</span><span class="tok-kd">function</span><span class="tok-p">()</span> <span class="tok-p">{</span> <i class="conum" data-value="1"></i><b>(1)</b>
      <span class="tok-k">return</span> <span class="tok-nx">callback</span><span class="tok-p">(</span><span class="tok-nx">elem</span><span class="tok-p">);</span>
    <span class="tok-p">});</span>
  <span class="tok-p">});</span>
<span class="tok-p">}</span>

<span class="tok-nx">secuencia</span><span class="tok-p">(</span><span class="tok-nx">cuentas</span><span class="tok-p">,</span> <span class="tok-kd">function</span> <span class="tok-p">(</span><span class="tok-nx">cuenta</span><span class="tok-p">)</span> <span class="tok-p">{</span>
  <span class="tok-k">return</span> <span class="tok-nx">ajaxUA</span><span class="tok-p">(</span><span class="tok-nx">cuenta</span><span class="tok-p">).</span><span class="tok-nx">then</span><span class="tok-p">(</span><span class="tok-kd">function</span><span class="tok-p">(</span><span class="tok-nx">balance</span><span class="tok-p">)</span> <span class="tok-p">{</span>
    <span class="tok-nx">console</span><span class="tok-p">.</span><span class="tok-nx">log</span><span class="tok-p">(</span><span class="tok-nx">cuenta</span> <span class="tok-o">+</span> <span class="tok-s2">&quot; Balance -&gt; &quot;</span> <span class="tok-o">+</span> <span class="tok-nx">balance</span><span class="tok-p">);</span>
  <span class="tok-p">});</span>
<span class="tok-p">})</span></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>en cada iteración, <code>seq</code> contiene el valor de la secuencia anterior hasta que se resuelve y almacena la nueva promesa</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Si empleamos la función <code>reduce</code>, el código se reduce al ahorrarnos la variable <code>seq</code>:</p>
</div>
<div class="listingblock">
<div class="title">Ejemplo promesas en secuencia, mediante <code>reduce</code></div>
<div class="content">
<pre class="pygments highlight"><code data-lang="javascript"><span class="tok-kd">function</span> <span class="tok-nx">secuencia</span><span class="tok-p">(</span><span class="tok-nx">array</span><span class="tok-p">,</span> <span class="tok-nx">callback</span><span class="tok-p">)</span> <span class="tok-p">{</span>
  <span class="tok-k">return</span> <span class="tok-nx">array</span><span class="tok-p">.</span><span class="tok-nx">reduce</span><span class="tok-p">(</span><span class="tok-kd">function</span> <span class="tok-nx">cadena</span><span class="tok-p">(</span><span class="tok-nx">promesa</span><span class="tok-p">,</span> <span class="tok-nx">elem</span><span class="tok-p">)</span> <span class="tok-p">{</span>  <i class="conum" data-value="1"></i><b>(1)</b>
    <span class="tok-k">return</span> <span class="tok-nx">promesa</span><span class="tok-p">.</span><span class="tok-nx">then</span><span class="tok-p">(</span><span class="tok-kd">function</span><span class="tok-p">()</span> <span class="tok-p">{</span>
      <span class="tok-k">return</span> <span class="tok-nx">callback</span><span class="tok-p">(</span><span class="tok-nx">elem</span><span class="tok-p">);</span>
    <span class="tok-p">});</span>
  <span class="tok-p">},</span> <span class="tok-nx">Promise</span><span class="tok-p">.</span><span class="tok-nx">resolve</span><span class="tok-p">());</span>  <i class="conum" data-value="2"></i><b>(2)</b>
<span class="tok-p">}</span></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>La variable <code>promesa</code> almacena el valor anterior. La función <code>cadena</code> siempre devuelve una promesa que resuelve el <code>callback</code>.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>El array se reduce hasta finalizarlo y devolver la última promesa de la cadena</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>En cambio, mediante código recursivo, pese a que pensemos que podemos desbordar la pila, cada llamada se coloca encima de la pila, de manera que el bucle de eventos la resuelve en primer lugar:</p>
</div>
<div class="listingblock">
<div class="title">Ejemplo promesas en secuencia, mediante recursión</div>
<div class="content">
<pre class="pygments highlight"><code data-lang="javascript"><span class="tok-kd">function</span> <span class="tok-nx">secuencia</span><span class="tok-p">(</span><span class="tok-nx">array</span><span class="tok-p">,</span> <span class="tok-nx">callback</span><span class="tok-p">)</span> <span class="tok-p">{</span>
  <span class="tok-kd">function</span> <span class="tok-nx">cadena</span><span class="tok-p">(</span><span class="tok-nx">array</span><span class="tok-p">,</span> <span class="tok-nx">indice</span><span class="tok-p">)</span> <span class="tok-p">{</span>
    <span class="tok-k">if</span> <span class="tok-p">(</span><span class="tok-nx">indice</span> <span class="tok-o">===</span> <span class="tok-nx">array</span><span class="tok-p">.</span><span class="tok-nx">length</span><span class="tok-p">)</span> <span class="tok-p">{</span>
      <span class="tok-k">return</span> <span class="tok-nx">Promise</span><span class="tok-p">.</span><span class="tok-nx">resolve</span><span class="tok-p">();</span>
    <span class="tok-p">}</span> <span class="tok-k">else</span> <span class="tok-p">{</span>
      <span class="tok-k">return</span> <span class="tok-nx">Promise</span><span class="tok-p">.</span><span class="tok-nx">resolve</span><span class="tok-p">(</span><span class="tok-nx">callback</span><span class="tok-p">(</span><span class="tok-nx">array</span><span class="tok-p">[</span><span class="tok-nx">indice</span><span class="tok-p">])).</span><span class="tok-nx">then</span><span class="tok-p">(</span><span class="tok-kd">function</span><span class="tok-p">()</span> <span class="tok-p">{</span>
        <span class="tok-k">return</span> <span class="tok-nx">cadena</span><span class="tok-p">(</span><span class="tok-nx">array</span><span class="tok-p">,</span> <span class="tok-nx">indice</span> <span class="tok-o">+</span> <span class="tok-mi">1</span><span class="tok-p">);</span>
      <span class="tok-p">});</span>
    <span class="tok-p">}</span>
  <span class="tok-p">}</span>
  <span class="tok-k">return</span> <span class="tok-nx">cadena</span><span class="tok-p">(</span><span class="tok-nx">array</span><span class="tok-p">,</span> <span class="tok-mi">0</span><span class="tok-p">);</span>
<span class="tok-p">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Aunque ambos planteamientos obtengan el mismo resultado, los dos enfoques tienen sus diferencias. Mientras que mediante el bucle se contruye la cadena entera de promesas sin esperar a que se resuelvan, mediante el planteamiento recursivo, las promesas se añaden bajo demanda tras resolver la promesa anterior. Así pues, el enfoque recursivo permite decidir si continuar o romper la cadena en base al resultado de una promesa anterior.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Las librerías de terceros que permiten gestionar las promesas ofrecen funciones auxiliares para trabajar con promesas en secuencia o de manera paralela.
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_carrera_de_promesas">8.2.11. Carrera de promesas</h4>
<div class="paragraph">
<p>En ocasiones vamos a realizar diferentes peticiones que realizan la misma acción a diferentes servicios, pero sólo nos interesará el que nos devuelve el resultado más rápidamente.</p>
</div>
<div class="paragraph">
<p>Para ello, el API ofrece el método <code>Promise.race(arrayDePromesas)</code>, la cual reduce el array de promesas y devuelve una nueva promesa con el primer valor disponible. Es decir, se examina cada promesa hasta que una de ellas finaliza, ya sea resuelta o rechazada, la cual se devuelve.</p>
</div>
<div class="paragraph">
<p>Mediante esta operación, podemos crear un mecanismo para gestionar la latencia de una petición a servidor, de manera que si tarda más de X segundos, acceda a una caché. En el caso de que falle la cache, el mecanismo fallará.</p>
</div>
<div class="listingblock">
<div class="title">Ejemplo de carrera de promesas</div>
<div class="content">
<pre class="pygments highlight"><code data-lang="javascript"><span class="tok-kd">function</span> <span class="tok-nx">obtenerDatos</span><span class="tok-p">(</span><span class="tok-nx">url</span><span class="tok-p">)</span> <span class="tok-p">{</span>
  <span class="tok-kd">var</span> <span class="tok-nx">tiempo</span> <span class="tok-o">=</span> <span class="tok-mi">500</span><span class="tok-p">;</span>  <span class="tok-c1">// ms</span>
  <span class="tok-kd">var</span> <span class="tok-nx">caduca</span> <span class="tok-o">=</span> <span class="tok-nb">Date</span><span class="tok-p">.</span><span class="tok-nx">now</span><span class="tok-p">()</span> <span class="tok-o">+</span> <span class="tok-nx">tiempo</span><span class="tok-p">;</span>

  <span class="tok-kd">var</span> <span class="tok-nx">datosServer</span> <span class="tok-o">=</span> <span class="tok-nx">ajaxUA</span><span class="tok-p">(</span><span class="tok-nx">url</span><span class="tok-p">);</span>

  <span class="tok-kd">var</span> <span class="tok-nx">datosCache</span> <span class="tok-o">=</span> <span class="tok-nx">buscarEnCache</span><span class="tok-p">(</span><span class="tok-nx">url</span><span class="tok-p">).</span><span class="tok-nx">then</span><span class="tok-p">(</span><span class="tok-kd">function</span> <span class="tok-p">(</span><span class="tok-nx">datos</span><span class="tok-p">)</span> <span class="tok-p">{</span>
    <span class="tok-k">return</span> <span class="tok-k">new</span> <span class="tok-nx">Promise</span><span class="tok-p">(</span><span class="tok-kd">function</span> <span class="tok-p">(</span><span class="tok-nx">resolver</span><span class="tok-p">,</span> <span class="tok-nx">rechazar</span><span class="tok-p">)</span> <span class="tok-p">{</span>
      <span class="tok-kd">var</span> <span class="tok-nx">lapso</span> <span class="tok-o">=</span> <span class="tok-nb">Math</span><span class="tok-p">.</span><span class="tok-nx">max</span><span class="tok-p">(</span><span class="tok-nx">caduca</span><span class="tok-o">:</span> <span class="tok-nb">Date</span><span class="tok-p">.</span><span class="tok-nx">now</span><span class="tok-p">(),</span> <span class="tok-mi">0</span><span class="tok-p">);</span>
      <span class="tok-nx">setTimeout</span><span class="tok-p">(</span><span class="tok-kd">function</span> <span class="tok-p">()</span> <span class="tok-p">{</span>
        <span class="tok-nx">resolver</span><span class="tok-p">(</span><span class="tok-nx">datos</span><span class="tok-p">);</span>
      <span class="tok-p">},</span> <span class="tok-nx">lapso</span><span class="tok-p">);</span>
    <span class="tok-p">})</span>
  <span class="tok-p">});</span>

  <span class="tok-kd">var</span> <span class="tok-nx">fallo</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-nx">Promise</span><span class="tok-p">(</span><span class="tok-kd">function</span> <span class="tok-p">(</span><span class="tok-nx">resolver</span><span class="tok-p">,</span> <span class="tok-nx">rechazar</span><span class="tok-p">)</span> <span class="tok-p">{</span>
    <span class="tok-nx">setTimeout</span><span class="tok-p">(</span><span class="tok-kd">function</span> <span class="tok-p">()</span> <span class="tok-p">{</span>
      <span class="tok-nx">rechazar</span><span class="tok-p">(</span><span class="tok-k">new</span> <span class="tok-nb">Error</span><span class="tok-p">(</span><span class="tok-s2">&quot;No se ha podido recuperar los datos de &quot;</span> <span class="tok-o">+</span> <span class="tok-nx">url</span><span class="tok-p">));</span>
    <span class="tok-p">},</span> <span class="tok-nx">tiempo</span><span class="tok-p">);</span>
  <span class="tok-p">});</span>

  <span class="tok-k">return</span> <span class="tok-nx">Promse</span><span class="tok-p">.</span><span class="tok-nx">race</span><span class="tok-p">([</span><span class="tok-nx">datosServer</span><span class="tok-p">,</span> <span class="tok-nx">datosCache</span><span class="tok-p">,</span> <span class="tok-nx">fallo</span><span class="tok-p">]);</span>
<span class="tok-p">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Se trata de una solución simplificada, donde se ha omitido el código de <code>buscarEnCache</code>, y no se han planteado todos los escenarios posibles.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="title">Autoevaluación</div>
<div class="paragraph">
<p>¿Qué pasaría se la petición a los datos del servidor falla inmediatamente debido a un fallo de red? <span class="footnote">[<a id="_footnoteref_17" class="footnote" href="#_footnote_17" title="View footnote.">17</a>]</span></p>
</div>
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Librerías de programación reactiva como RxJS, Bacon.js y Kefir.js están diseñadas especificamente para estos escenarios
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_fetch_api">8.3. Fetch API</h3>
<div class="paragraph">
<p>Aprovechando las promesas, ES6 ofrece el Fetch API para realizar peticiones AJAX que directamente devuelvan un promesa. Es decir, ya no se emplea el objeto <code>XMLHttpRequest</code>, el cual no se creó con AJAX en mente, sino una serie de métodos y objetos diseñados para tal fin. Al emplear promesas, el código es más sencillo y limpio, evitando los <em>callbacks</em> anidados.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Actualmente, el API lo soportan tanto <em>Google Chrome</em> como <em>Mozilla Firefox</em>. Podéis comprobar el resto de navegadores en <a href="http://caniuse.com/#search=fetch" class="bare">http://caniuse.com/#search=fetch</a>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>El objeto <code>window</code> ofrece el método <code>fetch</code>, con un primer argumento con la URL de la petición, y un segundo opcional con un objeto literal que permite configurar la petición:</p>
</div>
<div class="listingblock">
<div class="title">Ejemplo Fetch API</div>
<div class="content">
<pre class="pygments highlight"><code data-lang="javascript"><span class="tok-c1">// url (obligatorio), opciones (opcional)</span>
<span class="tok-nx">fetch</span><span class="tok-p">(</span><span class="tok-s1">&#39;/ruta/url&#39;</span><span class="tok-p">,</span> <span class="tok-p">{</span>
	<span class="tok-nx">method</span><span class="tok-o">:</span> <span class="tok-s1">&#39;get&#39;</span>
<span class="tok-p">}).</span><span class="tok-nx">then</span><span class="tok-p">(</span><span class="tok-kd">function</span><span class="tok-p">(</span><span class="tok-nx">respuesta</span><span class="tok-p">)</span> <span class="tok-p">{</span>

<span class="tok-p">}).</span><span class="tok-k">catch</span><span class="tok-p">(</span><span class="tok-kd">function</span><span class="tok-p">(</span><span class="tok-nx">err</span><span class="tok-p">)</span> <span class="tok-p">{</span>
	<span class="tok-c1">// Error :(</span>
<span class="tok-p">});</span></code></pre>
</div>
</div>
<div class="sect3">
<h4 id="_hola_em_fetch_em">8.3.1. Hola <em>Fetch</em></h4>
<div class="paragraph">
<p>A modo de ejemplo, vamos a reescibir el ejemplo de la sesión 5 que hacíamos uso de AJAX, pero ahora con la <em>Fetch API</em>. De esta manera, el código queda mucho más concreto:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="javascript"><span class="tok-nx">fetch</span><span class="tok-p">(</span><span class="tok-s1">&#39;http://www.omdbapi.com/?s=batman&#39;</span><span class="tok-p">,</span> <span class="tok-p">{</span>
    <span class="tok-nx">method</span><span class="tok-o">:</span> <span class="tok-s1">&#39;get&#39;</span>
<span class="tok-p">}).</span><span class="tok-nx">then</span><span class="tok-p">(</span><span class="tok-kd">function</span><span class="tok-p">(</span><span class="tok-nx">respuesta</span><span class="tok-p">)</span> <span class="tok-p">{</span>
  <span class="tok-k">if</span> <span class="tok-p">(</span><span class="tok-o">!</span><span class="tok-nx">respuesta</span><span class="tok-p">.</span><span class="tok-nx">ok</span><span class="tok-p">)</span> <span class="tok-p">{</span>
    <span class="tok-k">throw</span> <span class="tok-nb">Error</span><span class="tok-p">(</span><span class="tok-nx">respuesta</span><span class="tok-p">.</span><span class="tok-nx">statusText</span><span class="tok-p">);</span>
  <span class="tok-p">}</span>
  <span class="tok-k">return</span> <span class="tok-nx">respuesta</span><span class="tok-p">.</span><span class="tok-nx">json</span><span class="tok-p">();</span>
<span class="tok-p">}).</span><span class="tok-nx">then</span><span class="tok-p">(</span><span class="tok-kd">function</span><span class="tok-p">(</span><span class="tok-nx">datos</span><span class="tok-p">)</span> <span class="tok-p">{</span>
    <span class="tok-kd">var</span> <span class="tok-nx">pelis</span> <span class="tok-o">=</span> <span class="tok-nx">datos</span><span class="tok-p">.</span><span class="tok-nx">Search</span><span class="tok-p">;</span>
    <span class="tok-k">for</span> <span class="tok-p">(</span><span class="tok-kd">var</span> <span class="tok-nx">numPeli</span> <span class="tok-k">in</span> <span class="tok-nx">pelis</span><span class="tok-p">)</span> <span class="tok-p">{</span>
        <span class="tok-nx">console</span><span class="tok-p">.</span><span class="tok-nx">log</span><span class="tok-p">(</span><span class="tok-nx">pelis</span><span class="tok-p">[</span><span class="tok-nx">numPeli</span><span class="tok-p">].</span><span class="tok-nx">Title</span> <span class="tok-o">+</span> <span class="tok-s2">&quot;: &quot;</span> <span class="tok-o">+</span> <span class="tok-nx">pelis</span><span class="tok-p">[</span><span class="tok-nx">numPeli</span><span class="tok-p">].</span><span class="tok-nx">Year</span><span class="tok-p">);</span>
    <span class="tok-p">}</span>
<span class="tok-p">}).</span><span class="tok-k">catch</span><span class="tok-p">(</span><span class="tok-kd">function</span><span class="tok-p">(</span><span class="tok-nx">err</span><span class="tok-p">)</span> <span class="tok-p">{</span>
	<span class="tok-nx">console</span><span class="tok-p">.</span><span class="tok-nx">error</span><span class="tok-p">(</span><span class="tok-s2">&quot;Error en Fetch de películas de Batman&quot;</span><span class="tok-p">,</span> <span class="tok-nx">err</span><span class="tok-p">);</span>
<span class="tok-p">});</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Como podemos observar, haciendo uso de las promesas, podemos encadenarlas y en el último paso comprobar los errores.</p>
</div>
<div class="paragraph">
<p>Por ejemplo, podemos refactorizar el control de estado y extraelo a una función:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="javascript"><span class="tok-kd">function</span> <span class="tok-nx">estado</span><span class="tok-p">(</span><span class="tok-nx">respuesta</span><span class="tok-p">)</span> <span class="tok-p">{</span>
  <span class="tok-k">if</span> <span class="tok-p">(</span><span class="tok-nx">respuesta</span><span class="tok-p">.</span><span class="tok-nx">ok</span><span class="tok-p">)</span> <span class="tok-p">{</span>
    <span class="tok-k">return</span> <span class="tok-nx">Promise</span><span class="tok-p">.</span><span class="tok-nx">resolve</span><span class="tok-p">(</span><span class="tok-nx">respuesta</span><span class="tok-p">);</span>
  <span class="tok-p">}</span> <span class="tok-k">else</span> <span class="tok-p">{</span>
    <span class="tok-k">return</span> <span class="tok-nx">Promise</span><span class="tok-p">.</span><span class="tok-nx">reject</span><span class="tok-p">(</span><span class="tok-k">new</span> <span class="tok-nb">Error</span><span class="tok-p">(</span><span class="tok-nx">respuesta</span><span class="tok-p">.</span><span class="tok-nx">statusText</span><span class="tok-p">));</span>
  <span class="tok-p">}</span>
<span class="tok-p">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>De este modo, nuestro código quedaría así:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="javascript"><span class="tok-nx">fetch</span><span class="tok-p">(</span><span class="tok-s1">&#39;http://www.omdbapi.com/?s=batman&#39;</span><span class="tok-p">,</span> <span class="tok-p">{</span>
  <span class="tok-nx">method</span><span class="tok-o">:</span> <span class="tok-s1">&#39;get&#39;</span>
<span class="tok-p">}).</span><span class="tok-nx">then</span><span class="tok-p">(</span><span class="tok-nx">estado</span><span class="tok-p">)</span>
<span class="tok-p">.</span><span class="tok-nx">then</span><span class="tok-p">(</span><span class="tok-kd">function</span> <span class="tok-p">(</span><span class="tok-nx">respuesta</span><span class="tok-p">)</span> <span class="tok-p">{</span>
  <span class="tok-k">return</span> <span class="tok-nx">respuesta</span><span class="tok-p">.</span><span class="tok-nx">json</span><span class="tok-p">();</span>
<span class="tok-p">}).</span><span class="tok-nx">then</span><span class="tok-p">(</span><span class="tok-kd">function</span><span class="tok-p">(</span><span class="tok-nx">datos</span><span class="tok-p">)</span> <span class="tok-p">{</span>
  <span class="tok-kd">var</span> <span class="tok-nx">pelis</span> <span class="tok-o">=</span> <span class="tok-nx">datos</span><span class="tok-p">.</span><span class="tok-nx">Search</span><span class="tok-p">;</span>
  <span class="tok-k">for</span> <span class="tok-p">(</span><span class="tok-kd">var</span> <span class="tok-nx">numPeli</span> <span class="tok-k">in</span> <span class="tok-nx">pelis</span><span class="tok-p">)</span> <span class="tok-p">{</span>
    <span class="tok-nx">console</span><span class="tok-p">.</span><span class="tok-nx">log</span><span class="tok-p">(</span><span class="tok-nx">pelis</span><span class="tok-p">[</span><span class="tok-nx">numPeli</span><span class="tok-p">].</span><span class="tok-nx">Title</span> <span class="tok-o">+</span> <span class="tok-s2">&quot;: &quot;</span> <span class="tok-o">+</span> <span class="tok-nx">pelis</span><span class="tok-p">[</span><span class="tok-nx">numPeli</span><span class="tok-p">].</span><span class="tok-nx">Year</span><span class="tok-p">);</span>
  <span class="tok-p">}</span>
<span class="tok-p">}).</span><span class="tok-k">catch</span><span class="tok-p">(</span><span class="tok-kd">function</span><span class="tok-p">(</span><span class="tok-nx">err</span><span class="tok-p">)</span> <span class="tok-p">{</span>
  <span class="tok-nx">console</span><span class="tok-p">.</span><span class="tok-nx">error</span><span class="tok-p">(</span><span class="tok-s2">&quot;Error en Fetch de películas de Batman&quot;</span><span class="tok-p">,</span> <span class="tok-nx">err</span><span class="tok-p">);</span>
<span class="tok-p">});</span></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_cabeceras">8.3.2. Cabeceras</h4>
<div class="paragraph">
<p>Una ventaja de este API es la posibilidad de asignar las cabeceras de las peticiones mediante el objeto <code>Headers()</code>, el cual tiene una estructura similar a una mapa. A continuación se muestra un ejemplo de como acceder y manipular las cabeceras mediante los métodos <code>append</code>, <code>has</code>, <code>get</code>, <code>set</code> y <code>delete</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="javascript"><span class="tok-kd">var</span> <span class="tok-nx">headers</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-nx">Headers</span><span class="tok-p">();</span>

<span class="tok-nx">headers</span><span class="tok-p">.</span><span class="tok-nx">append</span><span class="tok-p">(</span><span class="tok-s1">&#39;Content-Type&#39;</span><span class="tok-p">,</span> <span class="tok-s1">&#39;text/plain&#39;</span><span class="tok-p">);</span>
<span class="tok-nx">headers</span><span class="tok-p">.</span><span class="tok-nx">append</span><span class="tok-p">(</span><span class="tok-s1">&#39;Mi-Cabecera-Personalizada&#39;</span><span class="tok-p">,</span> <span class="tok-s1">&#39;cualquierValor&#39;</span><span class="tok-p">);</span>

<span class="tok-nx">headers</span><span class="tok-p">.</span><span class="tok-nx">has</span><span class="tok-p">(</span><span class="tok-s1">&#39;Content-Type&#39;</span><span class="tok-p">);</span> <span class="tok-c1">// true</span>
<span class="tok-nx">headers</span><span class="tok-p">.</span><span class="tok-nx">get</span><span class="tok-p">(</span><span class="tok-s1">&#39;Content-Type&#39;</span><span class="tok-p">);</span> <span class="tok-c1">// &quot;text/plain&quot;</span>
<span class="tok-nx">headers</span><span class="tok-p">.</span><span class="tok-nx">set</span><span class="tok-p">(</span><span class="tok-s1">&#39;Content-Type&#39;</span><span class="tok-p">,</span> <span class="tok-s1">&#39;application/json&#39;</span><span class="tok-p">);</span>

<span class="tok-nx">headers</span><span class="tok-p">.</span><span class="tok-k">delete</span><span class="tok-p">(</span><span class="tok-s1">&#39;Mi-Cabecera-Personalizada&#39;</span><span class="tok-p">);</span>

<span class="tok-c1">// Add initial values</span>
<span class="tok-kd">var</span> <span class="tok-nx">headers</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-nx">Headers</span><span class="tok-p">({</span> <i class="conum" data-value="1"></i><b>(1)</b>
  <span class="tok-s1">&#39;Content-Type&#39;</span><span class="tok-o">:</span> <span class="tok-s1">&#39;text/plain&#39;</span><span class="tok-p">,</span>
  <span class="tok-s1">&#39;Mi-Cabecera-Personalizada&#39;</span><span class="tok-o">:</span> <span class="tok-s1">&#39;cualquierValor&#39;</span>
<span class="tok-p">});</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Para usar las cabeceras, las pasaremos como parámetro de creación de una petición mediante una instancia de <code>Request</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="javascript"><span class="tok-kd">var</span> <span class="tok-nx">peticion</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-nx">Request</span><span class="tok-p">(</span><span class="tok-s1">&#39;/url-peticion&#39;</span><span class="tok-p">,</span> <span class="tok-p">{</span>
  <span class="tok-nx">headers</span><span class="tok-o">:</span> <span class="tok-k">new</span> <span class="tok-nx">Headers</span><span class="tok-p">({</span>
    <span class="tok-s1">&#39;Content-Type&#39;</span><span class="tok-o">:</span> <span class="tok-s1">&#39;text/plain&#39;</span>
  <span class="tok-p">})</span>
<span class="tok-p">});</span>

<span class="tok-nx">fetch</span><span class="tok-p">(</span><span class="tok-nx">peticion</span><span class="tok-p">).</span><span class="tok-nx">then</span><span class="tok-p">(</span><span class="tok-kd">function</span><span class="tok-p">()</span> <span class="tok-p">{</span> <span class="tok-cm">/* manejar la respuesta */</span> <span class="tok-p">});</span></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_petición">8.3.3. Petición</h4>
<div class="paragraph">
<p>Para poder configurar toda la información que representa una petición se emplea el objeto <code>Request</code>. Este objeto puede contener las siguientes propiedades:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>method</code>: <code>GET</code>, <code>POST</code>, <code>PUT</code>, <code>DELETE</code>, <code>HEAD</code></p>
</li>
<li>
<p><code>url</code>: URL de la petición</p>
</li>
<li>
<p><code>headers</code>: objeto Headers con las cabeceras asociadas</p>
</li>
<li>
<p><code>body</code>: datos a enviar con la petición</p>
</li>
<li>
<p><code>referrer</code>: <em>referrer</em> de la petición</p>
</li>
<li>
<p><code>mode</code>: <code>cors</code>, <code>no-cors</code>, <code>same-origin</code></p>
</li>
<li>
<p><code>credentials</code>: indica si se envian <em>cookies</em> con la petición: <code>include</code>, <code>omit</code>, <code>same-origin</code></p>
</li>
<li>
<p><code>redirect</code>: <code>follow</code>, <code>error</code>, <code>manual</code></p>
</li>
<li>
<p><code>integrity</code>: valor integridad del subrecurso</p>
</li>
<li>
<p><code>cache</code>: tipo de cache (<code>default</code>, <code>reload</code>, <code>no-cache</code>)</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Con estos parámetros, una petición puede quedar así:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="javascript"><span class="tok-kd">var</span> <span class="tok-nx">request</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-nx">Request</span><span class="tok-p">(</span><span class="tok-s1">&#39;/heroes.json&#39;</span><span class="tok-p">,</span> <span class="tok-p">{</span>
  <span class="tok-nx">method</span><span class="tok-o">:</span> <span class="tok-s1">&#39;get&#39;</span><span class="tok-p">,</span>
  <span class="tok-nx">mode</span><span class="tok-o">:</span> <span class="tok-s1">&#39;cors&#39;</span><span class="tok-p">,</span>
  <span class="tok-nx">headers</span><span class="tok-o">:</span> <span class="tok-k">new</span> <span class="tok-nx">Headers</span><span class="tok-p">({</span>
    <span class="tok-s1">&#39;Content-Type&#39;</span><span class="tok-o">:</span> <span class="tok-s1">&#39;text/plain&#39;</span>
  <span class="tok-p">})</span>
<span class="tok-p">});</span>

<span class="tok-nx">fetch</span><span class="tok-p">(</span><span class="tok-nx">request</span><span class="tok-p">).</span><span class="tok-nx">then</span><span class="tok-p">(</span><span class="tok-kd">function</span><span class="tok-p">()</span> <span class="tok-p">{</span> <span class="tok-cm">/* manejar la respuesta */</span> <span class="tok-p">});</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Realmente, el método <code>fetch</code> recibe una URL a la que se envía una petición, y un objeto literal con la configuración de la petición, por lo que el código queda mejor así:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="javascript"><span class="tok-nx">fetch</span><span class="tok-p">(</span><span class="tok-s1">&#39;/heroes.json&#39;</span><span class="tok-p">,</span> <span class="tok-p">{</span>
  <span class="tok-nx">method</span><span class="tok-o">:</span> <span class="tok-s1">&#39;GET&#39;</span><span class="tok-p">,</span>
  <span class="tok-nx">mode</span><span class="tok-o">:</span> <span class="tok-s1">&#39;cors&#39;</span><span class="tok-p">,</span>
  <span class="tok-nx">headers</span><span class="tok-o">:</span> <span class="tok-k">new</span> <span class="tok-nx">Headers</span><span class="tok-p">({</span>
    <span class="tok-s1">&#39;Content-Type&#39;</span><span class="tok-o">:</span> <span class="tok-s1">&#39;text/plain&#39;</span>
  <span class="tok-p">})</span>
<span class="tok-p">}).</span><span class="tok-nx">then</span><span class="tok-p">(</span><span class="tok-kd">function</span><span class="tok-p">()</span> <span class="tok-p">{</span> <span class="tok-cm">/* manejar la respuesta */</span> <span class="tok-p">});</span></code></pre>
</div>
</div>
<div class="sect4">
<h5 id="_enviando_datos_2">Enviando datos</h5>
<div class="paragraph">
<p>Ya sabemos que un caso muy común es enviar la información de un formulario vía AJAX.</p>
</div>
<div class="paragraph">
<p>Para ello, además de configurar que la petición sea <code>POST</code>, le asociaremos en la propiedad <code>body</code> un <code>FormData</code> creado a partir del identificador del elemento del formulario:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="javascript"><span class="tok-nx">fetch</span><span class="tok-p">(</span><span class="tok-s1">&#39;/submit&#39;</span><span class="tok-p">,</span> <span class="tok-p">{</span>
  <span class="tok-nx">method</span><span class="tok-o">:</span> <span class="tok-s1">&#39;post&#39;</span><span class="tok-p">,</span>
  <span class="tok-nx">body</span><span class="tok-o">:</span> <span class="tok-k">new</span> <span class="tok-nx">FormData</span><span class="tok-p">(</span><span class="tok-nb">document</span><span class="tok-p">.</span><span class="tok-nx">getElementById</span><span class="tok-p">(</span><span class="tok-s1">&#39;formulario-cliente&#39;</span><span class="tok-p">))</span>
<span class="tok-p">});</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Si lo que queremos es enviar JSON al servidor, en la misma propiedad, le asociamos un nuevo objeto JSON:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="javascript"><span class="tok-nx">fetch</span><span class="tok-p">(</span><span class="tok-s1">&#39;/submit-json&#39;</span><span class="tok-p">,</span> <span class="tok-p">{</span>
  <span class="tok-nx">method</span><span class="tok-o">:</span> <span class="tok-s1">&#39;post&#39;</span><span class="tok-p">,</span>
  <span class="tok-nx">body</span><span class="tok-o">:</span> <span class="tok-nx">JSON</span><span class="tok-p">.</span><span class="tok-nx">stringify</span><span class="tok-p">({</span>
    <span class="tok-nx">email</span><span class="tok-o">:</span> <span class="tok-nb">document</span><span class="tok-p">.</span><span class="tok-nx">getElementById</span><span class="tok-p">(</span><span class="tok-s1">&#39;email&#39;</span><span class="tok-p">).</span><span class="tok-nx">value</span>
    <span class="tok-nx">comentarios</span><span class="tok-o">:</span> <span class="tok-nb">document</span><span class="tok-p">.</span><span class="tok-nx">getElementById</span><span class="tok-p">(</span><span class="tok-s1">&#39;comentarios&#39;</span><span class="tok-p">).</span><span class="tok-nx">value</span>
  <span class="tok-p">})</span>
<span class="tok-p">});</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>O si queremos enviar información en formato URL:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="javascript"><span class="tok-nx">fetch</span><span class="tok-p">(</span><span class="tok-s1">&#39;/submit-urlencoded&#39;</span><span class="tok-p">,</span> <span class="tok-p">{</span>
  <span class="tok-nx">method</span><span class="tok-o">:</span> <span class="tok-s1">&#39;post&#39;</span><span class="tok-p">,</span>
  <span class="tok-nx">headers</span><span class="tok-o">:</span> <span class="tok-p">{</span>
    <span class="tok-s2">&quot;Content-type&quot;</span><span class="tok-o">:</span> <span class="tok-s2">&quot;application/x-www-form-urlencoded; charset=UTF-8&quot;</span>
  <span class="tok-p">},</span>
  <span class="tok-nx">body</span><span class="tok-o">:</span> <span class="tok-s1">&#39;heroe=Batman&amp;nombre=Bruce+Wayne&#39;</span>
<span class="tok-p">});</span></code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_respuesta">8.3.4. Respuesta</h4>
<div class="paragraph">
<p>Una vez realizada la petición, dentro del manejador, reciberemos un objeto <code>Response</code>, compuesto de una serie de propiedades que representan la respuesta del servidor, de las cuales extraremos la información:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>type</code>: indican el origen de la petición. Dependiendo del tipo, podremos consultar diferente información:</p>
<div class="ulist">
<ul>
<li>
<p><code>basic</code>: proviene del mismo origen, sin restricciones.</p>
</li>
<li>
<p><code>cors</code>: acceso permitido a origen externo. Las cabeceras que se pueden consultar son <code>Cache-Control</code>, <code>Content-Language</code>, <code>Content-Type</code>, <code>Expires</code>, <code>Last-Modified</code>, y <code>Pragma</code></p>
</li>
<li>
<p><code>opaque</code>: origen externo que no devuelve cabeceras CORS, con lo que no podemos leer los datos ni visualizar el estado de la petición.</p>
</li>
</ul>
</div>
</li>
<li>
<p><code>status</code>: código de estado (200, 404, etc.)</p>
</li>
<li>
<p><code>ok</code>: Booleano que indica si la respuesta fue exitosa (en el rango 200-299 de estado)</p>
</li>
<li>
<p><code>statusText</code>: código de estado (<code>OK</code>)</p>
</li>
<li>
<p><code>headers</code>: objeto Headers asociado a la respuesta.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Además, el objeto <code>Response</code> ofrece los siguientes métodos para crear nuevas respuestas con diferente código de estado o a un destino distino:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>clone()</code>: clona el objeto <em>Response</em></p>
</li>
<li>
<p><code>error()</code>: devuelve un nuevo objeto <em>Response</em> asociado con un error de red.</p>
</li>
<li>
<p><code>redirect()</code>: crea una nueva respuesta con una URL diferente</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Finalmente, para transformar la respuesta a una promesa con un tipo de dato del cual extraer la información de la petición, tenemos los siguientes métodos:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>arrayBuffer()</code>: Devuelve una promesa que se resuelve con un <em>ArrayBuffer</em>.</p>
</li>
<li>
<p><code>blob()</code>: Devuelve una promesa que se resuelve con un <em>Blob</em>.</p>
</li>
<li>
<p><code>formData()</code>: Devuelve una promesa que se resuelve con un objeto <em>FormData</em>.</p>
</li>
<li>
<p><code>json()</code>: Devuelve una promesa que se resuelve con un objeto <em>JSON</em>.</p>
</li>
<li>
<p><code>text()</code>: Devuelve una promesa que se resuelve con un texto (<em>USVString</em>).</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Veamos estos métodos en funcionamiento.</p>
</div>
<div class="sect4">
<h5 id="_parseando_la_respuesta">Parseando la respuesta</h5>
<div class="paragraph">
<p>A día de hoy, el estandar es emplear el formato JSON para las respuestas. En vez de utilizar <code>JSON.parse(cadena)</code> para transformar la cadena de respuesta en un objeto, podemos utilizar el método <code>json()</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="javascript"><span class="tok-nx">fetch</span><span class="tok-p">(</span><span class="tok-s1">&#39;heroes.json&#39;</span><span class="tok-p">).</span><span class="tok-nx">then</span><span class="tok-p">(</span><span class="tok-kd">function</span><span class="tok-p">(</span><span class="tok-nx">response</span><span class="tok-p">)</span> <span class="tok-p">{</span>
  <span class="tok-k">return</span> <span class="tok-nx">response</span><span class="tok-p">.</span><span class="tok-nx">json</span><span class="tok-p">();</span>
<span class="tok-p">}).</span><span class="tok-nx">then</span><span class="tok-p">(</span><span class="tok-kd">function</span><span class="tok-p">(</span><span class="tok-nx">datos</span><span class="tok-p">)</span> <span class="tok-p">{</span>
  <span class="tok-nx">console</span><span class="tok-p">.</span><span class="tok-nx">log</span><span class="tok-p">(</span><span class="tok-nx">datos</span><span class="tok-p">);</span> <span class="tok-c1">// datos es un objeto JavaScript</span>
<span class="tok-p">});</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Si la información, viene en texto plano o como documento HTML, podemos emplear <code>text()</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="javascript"><span class="tok-nx">fetch</span><span class="tok-p">(</span><span class="tok-s1">&#39;/siguientePagina&#39;</span><span class="tok-p">).</span><span class="tok-nx">then</span><span class="tok-p">(</span><span class="tok-kd">function</span><span class="tok-p">(</span><span class="tok-nx">response</span><span class="tok-p">)</span> <span class="tok-p">{</span>
  <span class="tok-k">return</span> <span class="tok-nx">response</span><span class="tok-p">.</span><span class="tok-nx">text</span><span class="tok-p">();</span>
<span class="tok-p">}).</span><span class="tok-nx">then</span><span class="tok-p">(</span><span class="tok-kd">function</span><span class="tok-p">(</span><span class="tok-nx">texto</span><span class="tok-p">)</span> <span class="tok-p">{</span>
  <span class="tok-c1">// &lt;!DOCTYPE ....</span>
  <span class="tok-nx">console</span><span class="tok-p">.</span><span class="tok-nx">log</span><span class="tok-p">(</span><span class="tok-nx">texto</span><span class="tok-p">);</span>
<span class="tok-p">});</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Finalmente, si recibimos una imagen o archivo en binario, hemos de emplear <code>blob()</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="javascript"><span class="tok-nx">fetch</span><span class="tok-p">(</span><span class="tok-s1">&#39;paisaje.jpg&#39;</span><span class="tok-p">).</span><span class="tok-nx">then</span><span class="tok-p">(</span><span class="tok-kd">function</span><span class="tok-p">(</span><span class="tok-nx">response</span><span class="tok-p">)</span> <span class="tok-p">{</span>
  <span class="tok-k">return</span> <span class="tok-nx">response</span><span class="tok-p">.</span><span class="tok-nx">blob</span><span class="tok-p">();</span>
<span class="tok-p">})</span>
<span class="tok-p">.</span><span class="tok-nx">then</span><span class="tok-p">(</span><span class="tok-kd">function</span><span class="tok-p">(</span><span class="tok-nx">blobImagen</span><span class="tok-p">)</span> <span class="tok-p">{</span>
  <span class="tok-nb">document</span><span class="tok-p">.</span><span class="tok-nx">querySelector</span><span class="tok-p">(</span><span class="tok-s1">&#39;img&#39;</span><span class="tok-p">).</span><span class="tok-nx">src</span> <span class="tok-o">=</span> <span class="tok-nx">URL</span><span class="tok-p">.</span><span class="tok-nx">createObjectURL</span><span class="tok-p">(</span><span class="tok-nx">blobImagen</span><span class="tok-p">);</span>
<span class="tok-p">});</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Más ejemplos en <a href="https://blog.gospodarets.com/fetch_in_action/" class="bare">https://blog.gospodarets.com/fetch_in_action/</a></p>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_jquery_deferreds">8.4. jQuery Deferreds</h3>
<div class="paragraph">
<p>Los <em>Deferreds</em> son la implementación que hace <em>jQuery</em> de las promesas, ofreciendo una implementación de las promesas independiente de la versión de <em>ECMAScript</em> que tenga nuestro navegador.</p>
</div>
<div class="sect3">
<h4 id="__code_deferred_code">8.4.1. <code>$.Deferred()</code></h4>
<div class="paragraph">
<p>Cada promesa de <em>jQuery</em> comienza con un <code>Deferred</code>.
Un <code>Deferred</code> es solo una promesa con métodos que permiten a su propietario resolverla o rechazarla. Todas las otras promesas son de sólo lectura.</p>
</div>
<div class="paragraph">
<p>Para crear un <code>Deferred</code>, usaremos el constructor <code>$.Deferred()</code>. Una vez creada una promesa podemos invocar los siguientes métodos:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>state()</code>: devuelve el estado</p>
</li>
<li>
<p><code>resolve()</code>: resuelve la promesa</p>
</li>
<li>
<p><code>reject()</code>: rechaza la promesa</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="javascript"><span class="tok-kd">var</span> <span class="tok-nx">deferred</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-nx">$</span><span class="tok-p">.</span><span class="tok-nx">Deferred</span><span class="tok-p">();</span>

<span class="tok-nx">deferred</span><span class="tok-p">.</span><span class="tok-nx">state</span><span class="tok-p">();</span>  <i class="conum" data-value="1"></i><b>(1)</b>
<span class="tok-nx">deferred</span><span class="tok-p">.</span><span class="tok-nx">resolve</span><span class="tok-p">();</span>	<i class="conum" data-value="2"></i><b>(2)</b>
<span class="tok-nx">deferred</span><span class="tok-p">.</span><span class="tok-nx">state</span><span class="tok-p">();</span>  <i class="conum" data-value="3"></i><b>(3)</b>
<span class="tok-nx">deferred</span><span class="tok-p">.</span><span class="tok-nx">reject</span><span class="tok-p">();</span> <i class="conum" data-value="4"></i><b>(4)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Devuelve el estado de la promesa. Nada más creada su estado es <code>pending</code>.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Le indicamos a la promesa que ha finalizado la acción que queremos controlar.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Volvemos a obtener el estado, pero ahora ya es <code>resolved</code>.</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Permite rechazar la promesa. En este ejemplo no tiene efecto, ya que la promesa se ha resuelto.</td>
</tr>
</table>
</div>
<div class="admonitionblock caution">
<table>
<tr>
<td class="icon">
<i class="fa icon-caution" title="Caution"></i>
</td>
<td class="content">
Mucho cuidado con diseñar una aplicación que se base en comprobar el estado de una promesa para actuar en consecuencia. El único momento que tiene sentido actuar dependiendo de su valor es cuando tras un <em>callback</em> de <code>done()</code> querramos averiguar si hemos llegado tras resolver o rechazar la promesa.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Si al método constructor le pasamos una función, ésta se ejecutará tan pronto como el objete se cree, y la función recibe como parámetro el nuevo objeto <em>deferred</em>. Mediante esta característica podemos crear un envoltorio que realiza una tarea asíncrona y que dispare un <em>callback</em> cuando haya finalizado:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="javascript"><span class="tok-kd">function</span> <span class="tok-nx">realizarTarea</span><span class="tok-p">()</span> <span class="tok-p">{</span>
	<span class="tok-k">return</span> <span class="tok-nx">$</span><span class="tok-p">.</span><span class="tok-nx">Deferred</span><span class="tok-p">(</span><span class="tok-kd">function</span><span class="tok-p">(</span><span class="tok-nx">def</span><span class="tok-p">)</span> <span class="tok-p">{</span>
		<span class="tok-c1">// tarea async que dispara un callback al acabar</span>
	<span class="tok-p">});</span>
<span class="tok-p">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Podemos obtener una promesa "pura" a partir del método <code>promise()</code>. El resultado es similar a <code>Deferred</code>, excepto que faltan los métodos de <code>resolve()</code> y <code>reject()</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="javascript"><span class="tok-kd">var</span> <span class="tok-nx">deferred</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-nx">$</span><span class="tok-p">.</span><span class="tok-nx">Deferred</span><span class="tok-p">();</span>
<span class="tok-kd">var</span> <span class="tok-nx">promise</span> <span class="tok-o">=</span> <span class="tok-nx">deferred</span><span class="tok-p">.</span><span class="tok-nx">promise</span><span class="tok-p">();</span>

<span class="tok-nx">promise</span><span class="tok-p">.</span><span class="tok-nx">state</span><span class="tok-p">();</span>  <span class="tok-c1">// &quot;pending&quot;</span>
<span class="tok-nx">deferred</span><span class="tok-p">.</span><span class="tok-nx">reject</span><span class="tok-p">();</span>
<span class="tok-nx">promise</span><span class="tok-p">.</span><span class="tok-nx">state</span><span class="tok-p">();</span>  <span class="tok-c1">// &quot;rejected&quot;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>El método <code>promise()</code> existe principalmente para dar soporte a la encapsulación: si una función devuelve un <code>Deferred</code>, puede ser resuelta o rechazada por el programa que la invoca. En cambio, si sólo devolvemos la promesa pura correspondiente al <code>Deferred</code>, el programa que la invoca sólo puede leer su estado y añadir <em>callbacks</em>. La propia <em>jQuery</em> sigue este enfoque al devolver promesas puras desde sus métodos AJAX:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="javascript"><span class="tok-kd">var</span> <span class="tok-nx">obteniendoProductos</span> <span class="tok-o">=</span> <span class="tok-nx">$</span><span class="tok-p">.</span><span class="tok-nx">get</span><span class="tok-p">(</span><span class="tok-s2">&quot;/products&quot;</span><span class="tok-p">);</span>

<span class="tok-nx">obteniendoProductos</span><span class="tok-p">.</span><span class="tok-nx">state</span><span class="tok-p">();</span>  <span class="tok-c1">// &quot;pending&quot;</span>
<span class="tok-nx">obteniendoProductos</span><span class="tok-p">.</span><span class="tok-nx">resolve</span><span class="tok-p">;</span>  <span class="tok-c1">// undefined</span></code></pre>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
Las promesas se suelen nombrar con gerundios para indicar que representan un proceso
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_manejadores_de_promesas">8.4.2. Manejadores de promesas</h4>
<div class="paragraph">
<p>Una vez tenemos una promesa, podemos adjuntarle tantos <em>callbacks</em> como queremos mediante los métodos:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>done()</code>: se lanza cuando la promesa se resuelve. correctamente, mediante <code>resolve()</code>∫</p>
</li>
<li>
<p><code>fail()</code>: se lanza cuando la promesa se rechaza, mediante <code>reject()</code></p>
</li>
<li>
<p><code>always()</code>: se lanza cuando se completa la promesa, independientemente que su estado sea resuelta o rechazada</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Por ejemplo:</p>
</div>
<div class="listingblock">
<div class="title">Ejemplo Deferreds: <a href="http://jsbin.com/qixaza/2/edit?html,js,console,output" class="bare">http://jsbin.com/qixaza/2/edit?html,js,console,output</a></div>
<div class="content">
<pre class="pygments highlight"><code data-lang="javascript"><span class="tok-kd">var</span> <span class="tok-nx">promesa</span> <span class="tok-o">=</span> <span class="tok-nx">$</span><span class="tok-p">.</span><span class="tok-nx">Deferred</span><span class="tok-p">();</span>
<span class="tok-nx">promesa</span><span class="tok-p">.</span><span class="tok-nx">done</span><span class="tok-p">(</span><span class="tok-kd">function</span><span class="tok-p">()</span> <span class="tok-p">{</span>
  <span class="tok-nx">console</span><span class="tok-p">.</span><span class="tok-nx">log</span><span class="tok-p">(</span><span class="tok-s2">&quot;Se ejecutará cuando la promesa se resuelva.&quot;</span><span class="tok-p">);</span>
<span class="tok-p">});</span>

<span class="tok-nx">promesa</span><span class="tok-p">.</span><span class="tok-nx">fail</span><span class="tok-p">(</span><span class="tok-kd">function</span><span class="tok-p">()</span> <span class="tok-p">{</span>
  <span class="tok-nx">console</span><span class="tok-p">.</span><span class="tok-nx">log</span><span class="tok-p">(</span><span class="tok-s2">&quot;Se ejecutará cuando la promesa se rechace.&quot;</span><span class="tok-p">);</span>
<span class="tok-p">});</span>

<span class="tok-nx">promesa</span><span class="tok-p">.</span><span class="tok-nx">always</span><span class="tok-p">(</span><span class="tok-kd">function</span><span class="tok-p">()</span> <span class="tok-p">{</span>
  <span class="tok-nx">console</span><span class="tok-p">.</span><span class="tok-nx">log</span><span class="tok-p">(</span><span class="tok-s2">&quot;Se ejecutará en cualquier caso.&quot;</span><span class="tok-p">);</span>
<span class="tok-p">});</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Por ejemplo, supongamos que tenemos tres botones que modifican la promesa:</p>
</div>
<div class="listingblock">
<div class="title">Ejemplo Deferreds: <a href="http://jsbin.com/qixaza/2/edit?html,js,console,output" class="bare">http://jsbin.com/qixaza/2/edit?html,js,console,output</a></div>
<div class="content">
<pre class="pygments highlight"><code data-lang="html"><span class="tok-nt">&lt;button</span> <span class="tok-na">id=</span><span class="tok-s">&quot;btnResuelve&quot;</span><span class="tok-nt">&gt;</span>Resolver<span class="tok-nt">&lt;/button&gt;</span>
<span class="tok-nt">&lt;button</span> <span class="tok-na">id=</span><span class="tok-s">&quot;btnRechaza&quot;</span><span class="tok-nt">&gt;</span>Rechazar<span class="tok-nt">&lt;/button&gt;</span>
<span class="tok-nt">&lt;button</span> <span class="tok-na">id=</span><span class="tok-s">&quot;btnEstado&quot;</span><span class="tok-nt">&gt;</span>¿Estado?<span class="tok-nt">&lt;/button&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Y si capturamos los eventos <em>click</em> para que modifiquen la promesa, tendremos:</p>
</div>
<div class="listingblock">
<div class="title">Ejemplo Deferreds: <a href="http://jsbin.com/qixaza/2/edit?html,js,console,output" class="bare">http://jsbin.com/qixaza/2/edit?html,js,console,output</a></div>
<div class="content">
<pre class="pygments highlight"><code data-lang="javascript"><span class="tok-nx">$</span><span class="tok-p">(</span><span class="tok-s2">&quot;#btnResuelve&quot;</span><span class="tok-p">).</span><span class="tok-nx">click</span><span class="tok-p">(</span><span class="tok-kd">function</span><span class="tok-p">()</span> <span class="tok-p">{</span>
  <span class="tok-nx">promesa</span><span class="tok-p">.</span><span class="tok-nx">resolve</span><span class="tok-p">();</span>
<span class="tok-p">});</span>
<span class="tok-nx">$</span><span class="tok-p">(</span><span class="tok-s2">&quot;#btnRechaza&quot;</span><span class="tok-p">).</span><span class="tok-nx">click</span><span class="tok-p">(</span><span class="tok-kd">function</span><span class="tok-p">()</span> <span class="tok-p">{</span>
  <span class="tok-nx">promesa</span><span class="tok-p">.</span><span class="tok-nx">reject</span><span class="tok-p">();</span>
<span class="tok-p">});</span>
<span class="tok-nx">$</span><span class="tok-p">(</span><span class="tok-s2">&quot;#btnEstado&quot;</span><span class="tok-p">).</span><span class="tok-nx">click</span><span class="tok-p">(</span><span class="tok-kd">function</span><span class="tok-p">()</span> <span class="tok-p">{</span>
  <span class="tok-nx">console</span><span class="tok-p">.</span><span class="tok-nx">log</span><span class="tok-p">(</span><span class="tok-nx">promesa</span><span class="tok-p">.</span><span class="tok-nx">state</span><span class="tok-p">());</span>
<span class="tok-p">});</span></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_encadenando_promesas_2">8.4.3. Encadenando promesas</h4>
<div class="paragraph">
<p>Los métodos de los objetos <code>Deferred</code> se pueden encadenar, de manera que cada método devuelve a su vez un objeto <code>Deferred</code> donde poder volver a llamar a otros métodos:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="javascript"><span class="tok-nx">promesa</span><span class="tok-p">.</span><span class="tok-nx">done</span><span class="tok-p">(</span><span class="tok-kd">function</span><span class="tok-p">()</span> <span class="tok-p">{</span>
  <span class="tok-nx">console</span><span class="tok-p">.</span><span class="tok-nx">log</span><span class="tok-p">(</span><span class="tok-s2">&quot;Se ejecutará cuando la promesa se resuelva.&quot;</span><span class="tok-p">);</span>
<span class="tok-p">}).</span><span class="tok-nx">fail</span><span class="tok-p">(</span><span class="tok-kd">function</span><span class="tok-p">()</span> <span class="tok-p">{</span>
  <span class="tok-nx">console</span><span class="tok-p">.</span><span class="tok-nx">log</span><span class="tok-p">(</span><span class="tok-s2">&quot;Se ejecutará cuando la promesa se rechace.&quot;</span><span class="tok-p">);</span>
<span class="tok-p">}).</span><span class="tok-nx">always</span><span class="tok-p">(</span><span class="tok-kd">function</span><span class="tok-p">()</span> <span class="tok-p">{</span>
  <span class="tok-nx">console</span><span class="tok-p">.</span><span class="tok-nx">log</span><span class="tok-p">(</span><span class="tok-s2">&quot;Se ejecutará en cualquier caso.&quot;</span><span class="tok-p">);</span>
<span class="tok-p">});</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Mediante el método <code>then()</code> podemos agrupar los tres <em>callbacks</em> de una sola vez:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="javascript"><span class="tok-nx">promesa</span><span class="tok-p">.</span><span class="tok-nx">then</span><span class="tok-p">(</span><span class="tok-nx">doneCallback</span><span class="tok-p">,</span> <span class="tok-nx">failCallback</span><span class="tok-p">,</span> <span class="tok-nx">alwaysCallback</span><span class="tok-p">);</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Con lo que si reescribimos el ejemplo tendríamos:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="javascript"><span class="tok-nx">promesa</span><span class="tok-p">.</span><span class="tok-nx">then</span><span class="tok-p">(</span><span class="tok-kd">function</span><span class="tok-p">()</span> <span class="tok-p">{</span>
  <span class="tok-nx">console</span><span class="tok-p">.</span><span class="tok-nx">log</span><span class="tok-p">(</span><span class="tok-s2">&quot;Se ejecutará cuando la promesa se resuelva.&quot;</span><span class="tok-p">);</span>
<span class="tok-p">},</span> <span class="tok-kd">function</span><span class="tok-p">()</span> <span class="tok-p">{</span>
  <span class="tok-nx">console</span><span class="tok-p">.</span><span class="tok-nx">log</span><span class="tok-p">(</span><span class="tok-s2">&quot;Se ejecutará cuando la promesa se rechace.&quot;</span><span class="tok-p">);</span>
<span class="tok-p">},</span> <span class="tok-kd">function</span><span class="tok-p">()</span> <span class="tok-p">{</span>
  <span class="tok-nx">console</span><span class="tok-p">.</span><span class="tok-nx">log</span><span class="tok-p">(</span><span class="tok-s2">&quot;Se ejecutará en cualquier caso.&quot;</span><span class="tok-p">);</span>
<span class="tok-p">});</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Además, el orden en el que se adjuntan los <em>callbacks</em> definen su orden de ejecución. Por ejemplo, si duplicamos los <em>callbacks</em> y volvemos a añadirlos, tendremos:</p>
</div>
<div class="paragraph">
<p>Supongamos que reescribimos el ejemplo anterior con el siguiente fragmento para manejar las promesas:</p>
</div>
<div class="listingblock">
<div class="title">Ejemplo Orden Deferreds: <a href="http://jsbin.com/wanavo/1/edit?html,js,console,output" class="bare">http://jsbin.com/wanavo/1/edit?html,js,console,output</a></div>
<div class="content">
<pre class="pygments highlight"><code data-lang="javascript"><span class="tok-kd">var</span> <span class="tok-nx">promesa</span> <span class="tok-o">=</span> <span class="tok-nx">$</span><span class="tok-p">.</span><span class="tok-nx">Deferred</span><span class="tok-p">();</span>
<span class="tok-nx">promesa</span><span class="tok-p">.</span><span class="tok-nx">done</span><span class="tok-p">(</span><span class="tok-kd">function</span><span class="tok-p">()</span> <span class="tok-p">{</span>
  <span class="tok-nx">console</span><span class="tok-p">.</span><span class="tok-nx">log</span><span class="tok-p">(</span><span class="tok-s2">&quot;Primer callback.&quot;</span><span class="tok-p">);</span>
<span class="tok-p">}).</span><span class="tok-nx">done</span><span class="tok-p">(</span><span class="tok-kd">function</span><span class="tok-p">()</span> <span class="tok-p">{</span>
  <span class="tok-nx">console</span><span class="tok-p">.</span><span class="tok-nx">log</span><span class="tok-p">(</span><span class="tok-s2">&quot;Segundo callback.&quot;</span><span class="tok-p">);</span>
<span class="tok-p">}).</span><span class="tok-nx">done</span><span class="tok-p">(</span><span class="tok-kd">function</span><span class="tok-p">()</span> <span class="tok-p">{</span>
  <span class="tok-nx">console</span><span class="tok-p">.</span><span class="tok-nx">log</span><span class="tok-p">(</span><span class="tok-s2">&quot;Tercer callback.&quot;</span><span class="tok-p">);</span>
<span class="tok-p">});</span>

<span class="tok-nx">promesa</span><span class="tok-p">.</span><span class="tok-nx">fail</span><span class="tok-p">(</span><span class="tok-kd">function</span><span class="tok-p">()</span> <span class="tok-p">{</span>
  <span class="tok-nx">console</span><span class="tok-p">.</span><span class="tok-nx">log</span><span class="tok-p">(</span><span class="tok-s2">&quot;Houston! Tenemos un problema&quot;</span><span class="tok-p">);</span>
<span class="tok-p">});</span>

<span class="tok-nx">promesa</span><span class="tok-p">.</span><span class="tok-nx">always</span><span class="tok-p">(</span><span class="tok-kd">function</span><span class="tok-p">()</span> <span class="tok-p">{</span>
  <span class="tok-nx">console</span><span class="tok-p">.</span><span class="tok-nx">log</span><span class="tok-p">(</span><span class="tok-s2">&quot;Dentro del always&quot;</span><span class="tok-p">);</span>
<span class="tok-p">}).</span><span class="tok-nx">done</span><span class="tok-p">(</span><span class="tok-kd">function</span><span class="tok-p">()</span> <span class="tok-p">{</span>
  <span class="tok-nx">console</span><span class="tok-p">.</span><span class="tok-nx">log</span><span class="tok-p">(</span><span class="tok-s2">&quot;Y un cuarto callback si todo ha ido bien&quot;</span><span class="tok-p">);</span>
<span class="tok-p">});</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Si probamos a resolver la promesa, la salida por consola será la siguiente:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="console"><span class="tok-go">&quot;Primer callback.&quot;</span>
<span class="tok-go">&quot;Segundo callback.&quot;</span>
<span class="tok-go">&quot;Tercer callback.&quot;</span>
<span class="tok-go">&quot;Dentro del always&quot;</span>
<span class="tok-go">&quot;Y un cuarto callback si todo ha ido bien&quot;</span></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_modelando_con_promesas">8.4.4. Modelando con promesas</h4>
<div class="paragraph">
<p>Veamos en detalle un caso de uso de promesas para representar una serie de acciones que puede realizar el usuario a partir de un formulario básico con AJAX que contiene un campo de texto con observaciones.</p>
</div>
<div class="paragraph">
<p>Queremos asegurarnos que el formularios solo se envia una vez y que el usuario recibe una confirmación cuando envía las observaciones. Además, queremos separar el código que describe el comportamiento de la aplicación del código que trabaja el contenido de la página. Esto facilita el <em>testing</em> y minimiza la cantidad de código necesario que necesitaríamos modificar si cambiamo la disposición de la página.</p>
</div>
<div class="paragraph">
<p>Así pues, separamos la lógica de aplicación mediante promesas:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="javascript"><span class="tok-kd">var</span> <span class="tok-nx">enviandoObservaciones</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-nx">$</span><span class="tok-p">.</span><span class="tok-nx">Deferred</span><span class="tok-p">();</span>

<span class="tok-nx">enviandoObservaciones</span><span class="tok-p">.</span><span class="tok-nx">done</span><span class="tok-p">(</span><span class="tok-kd">function</span><span class="tok-p">(</span><span class="tok-nx">input</span><span class="tok-p">)</span> <span class="tok-p">{</span>
  <span class="tok-nx">$</span><span class="tok-p">.</span><span class="tok-nx">post</span><span class="tok-p">(</span><span class="tok-s2">&quot;/observaciones&quot;</span><span class="tok-p">,</span> <span class="tok-nx">input</span><span class="tok-p">);</span>
<span class="tok-p">});</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Y la interacción DOM se encarga de modificar el estado de la promesa:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="javascript"><span class="tok-nx">$</span><span class="tok-p">(</span><span class="tok-s2">&quot;#observaciones&quot;</span><span class="tok-p">).</span><span class="tok-nx">submit</span><span class="tok-p">(</span><span class="tok-kd">function</span><span class="tok-p">()</span> <span class="tok-p">{</span>
  <span class="tok-nx">enviandoObservaciones</span><span class="tok-p">.</span><span class="tok-nx">resolve</span><span class="tok-p">(</span><span class="tok-nx">$</span><span class="tok-p">(</span><span class="tok-s2">&quot;textarea&quot;</span><span class="tok-p">,</span> <span class="tok-k">this</span><span class="tok-p">).</span><span class="tok-nx">val</span><span class="tok-p">());</span>	<i class="conum" data-value="1"></i><b>(1)</b>

  <span class="tok-k">return</span> <span class="tok-kc">false</span><span class="tok-p">;</span>  <i class="conum" data-value="2"></i><b>(2)</b>
<span class="tok-p">});</span>

<span class="tok-nx">enviandoObservaciones</span><span class="tok-p">.</span><span class="tok-nx">done</span><span class="tok-p">(</span><span class="tok-kd">function</span><span class="tok-p">()</span> <span class="tok-p">{</span>
  <span class="tok-nx">$</span><span class="tok-p">(</span><span class="tok-s2">&quot;#contenido&quot;</span><span class="tok-p">).</span><span class="tok-nx">append</span><span class="tok-p">(</span><span class="tok-s2">&quot;&lt;p&gt;¡Gracias por las observaciones!&lt;/p&gt;&quot;</span><span class="tok-p">);</span>	<i class="conum" data-value="3"></i><b>(3)</b>
<span class="tok-p">});</span></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Cuando el usuario pulsa sobre enviar, se resuelve la promesa. Si le pasamos un parámetro a un método de promesa (ya sea ), el parámetro se reenvía al callback correspondiente.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Prevenimos el comportamiento por defecto del navegador.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Le añadimos un segundo manejador que nos permite separar el código de aplicación del tratamiento del DOM.</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_prestando_promesas_del_futuro">8.4.5. Prestando promesas del futuro</h4>
<div class="paragraph">
<p>Si queremos mejorar nuestro formulario, más que asumir de manera optimista que nuestro POST funcionará correctamente, deberíamos primero indicar que el formulario se ha enviado, por ejemplo, mediante una barra de progreso, y posteriormente indicarle al usuario si el envío ha sido exitoso o fallido cuando el servidor responda.</p>
</div>
<div class="paragraph">
<p>Para ello, podemos adjuntar <em>callbacks</em> a la promesa que devuelve <code>$.post</code>. El problema viene cuando tenemos que manipular el DOM desde esos <em>callbacks</em>, y hemos planteado usar promesas para separar el código de aplicación del de manipulación del DOM.</p>
</div>
<div class="paragraph">
<p>Una manera de separar la creación de una promesa del <em>callback</em> de lógica de aplicación es reenviar los eventos de <code>resolve</code>/<code>reject</code> desde la promesa POST a una promesa que se encuentre fuera de nuestro alcance. En vez de necesitar varias líneas con código anidado del tipo <code>promesa1.done(promesa2.resolve);..</code>, lo haremos mediante <code>then()</code> (antes de <em>jQuery 1.8</em> mediante <code>pipe()</code>).</p>
</div>
<div class="paragraph">
<p>Para ello, <code>then()</code> devuelve una nueva promesa que permite filtrar el estado y los valores de una promesa mediante una función, lo que la convierte en una ventana al futuro, permitiendo adjuntar comportamiento a una promesa que todavía no existe.</p>
</div>
<div class="paragraph">
<p>Si ahora mejoramos el código del formulario haciendo que nuestra promesa POST se encole en una nueva promesa llamada <code>guardandoObservaciones</code>, tendremos que el código de aplicación quede así:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="javascript"><span class="tok-kd">var</span> <span class="tok-nx">enviandoObservaciones</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-nx">$</span><span class="tok-p">.</span><span class="tok-nx">Deferred</span><span class="tok-p">();</span>
<span class="tok-kd">var</span> <span class="tok-nx">guardandoObservaciones</span> <span class="tok-o">=</span> <span class="tok-nx">enviandoObservaciones</span><span class="tok-p">.</span><span class="tok-nx">pipe</span><span class="tok-p">(</span><span class="tok-kd">function</span><span class="tok-p">(</span><span class="tok-nx">input</span><span class="tok-p">)</span> <span class="tok-p">{</span>
  <span class="tok-k">return</span> <span class="tok-nx">$</span><span class="tok-p">.</span><span class="tok-nx">post</span><span class="tok-p">(</span><span class="tok-s2">&quot;/observaciones&quot;</span><span class="tok-p">,</span> <span class="tok-nx">input</span><span class="tok-p">);</span>	<i class="conum" data-value="1"></i><b>(1)</b>
<span class="tok-p">});</span></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Encolamos la promesa de guardado tras el envío</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Con lo que la manipulación del DOM queda del siguiente modo:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="javascript"><span class="tok-nx">$</span><span class="tok-p">(</span><span class="tok-s2">&quot;#observaciones&quot;</span><span class="tok-p">).</span><span class="tok-nx">submit</span><span class="tok-p">(</span><span class="tok-kd">function</span><span class="tok-p">()</span> <span class="tok-p">{</span>
  <span class="tok-nx">enviandoObservaciones</span><span class="tok-p">.</span><span class="tok-nx">resolve</span><span class="tok-p">(</span><span class="tok-nx">$</span><span class="tok-p">(</span><span class="tok-s2">&quot;textarea&quot;</span><span class="tok-p">,</span> <span class="tok-k">this</span><span class="tok-p">).</span><span class="tok-nx">val</span><span class="tok-p">());</span>
  <span class="tok-k">return</span> <span class="tok-kc">false</span><span class="tok-p">;</span>
<span class="tok-p">});</span>

<span class="tok-nx">enviandoObservaciones</span><span class="tok-p">.</span><span class="tok-nx">done</span><span class="tok-p">(</span><span class="tok-kd">function</span><span class="tok-p">()</span> <span class="tok-p">{</span>
  <span class="tok-nx">$</span><span class="tok-p">(</span><span class="tok-s2">&quot;#contenido&quot;</span><span class="tok-p">).</span><span class="tok-nx">append</span><span class="tok-p">(</span><span class="tok-s2">&quot;&lt;div class=&#39;spinner&#39;&gt;&quot;</span><span class="tok-p">);</span>	<i class="conum" data-value="1"></i><b>(1)</b>
<span class="tok-p">});</span>

<span class="tok-nx">guardandoObservaciones</span><span class="tok-p">.</span><span class="tok-nx">then</span><span class="tok-p">(</span>
  <span class="tok-kd">function</span><span class="tok-p">()</span> <span class="tok-p">{</span>	<span class="tok-c1">// done</span>
    <span class="tok-nx">$</span><span class="tok-p">(</span><span class="tok-s2">&quot;#contenido&quot;</span><span class="tok-p">).</span><span class="tok-nx">append</span><span class="tok-p">(</span><span class="tok-s2">&quot;&lt;p&gt;¡Gracias por las observaciones!&lt;/p&gt;&quot;</span><span class="tok-p">);</span>
  <span class="tok-p">},</span> <span class="tok-kd">function</span><span class="tok-p">()</span> <span class="tok-p">{</span>	<span class="tok-c1">// fail</span>
    <span class="tok-nx">$</span><span class="tok-p">(</span><span class="tok-s2">&quot;#contenido&quot;</span><span class="tok-p">).</span><span class="tok-nx">append</span><span class="tok-p">(</span><span class="tok-s2">&quot;&lt;p&gt;Se ha producido un error al contactar con el servidor.&lt;/p&gt;&quot;</span><span class="tok-p">);</span>
  <span class="tok-p">},</span> <span class="tok-kd">function</span><span class="tok-p">()</span> <span class="tok-p">{</span>	<span class="tok-c1">// always</span>
    <span class="tok-nx">$</span><span class="tok-p">(</span><span class="tok-s2">&quot;#contenido&quot;</span><span class="tok-p">).</span><span class="tok-nx">remove</span><span class="tok-p">(</span><span class="tok-s2">&quot;.spinner&quot;</span><span class="tok-p">);</span>	<i class="conum" data-value="2"></i><b>(2)</b>
<span class="tok-p">});</span></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Al enviar los datos creamos la barra de progreso</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Cuando finaliza el guardado, quitamos la barra de progreso</td>
</tr>
</table>
</div>
<div class="sect4">
<h5 id="_intersección_de_promesas">Intersección de promesas</h5>
<div class="paragraph">
<p>Parte de la magia de las promesas es su naturaleza binaria. Como solo tienen dos estados, se pueden combinar igual que si fuesen <em>booleanos</em> (aunque todavía no sepamos que valores tendrán).</p>
</div>
<div class="paragraph">
<p>De la misma manera que tenemos <code>Promise.all</code>, jQuery ofrece el método <code>$.when()</code>  como operador equivalente a la intersección (Y).</p>
</div>
<div class="paragraph">
<p>Así pues, dada una lista de promesas, <code>when()</code> devuelve una nueva promesa como resultado de otras promesas y que cumple estas reglas:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Cuando todas las promesas recibidas se resuelven, la nueva promesa estará resuelta.</p>
</li>
<li>
<p>Cuando alguna de las promesas recibidas se rechaza, la nueva promesa se rechaza.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Por ello, cuando estemos esperando que múltiples eventos desordenados ocurran y necesitamos realizar una acción cuando todos hayan finalizado deberemos utilizar <code>when()</code>. Por ejemplo, el caso de uso más común es al realizar varias llamadas AJAX simultáneas:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="javascript"><span class="tok-nx">$</span><span class="tok-p">(</span><span class="tok-s2">&quot;#contenido&quot;</span><span class="tok-p">).</span><span class="tok-nx">append</span><span class="tok-p">(</span><span class="tok-s2">&quot;&lt;div class=&#39;spinner&#39;&gt;&quot;</span><span class="tok-p">);</span>
<span class="tok-nx">$</span><span class="tok-p">.</span><span class="tok-nx">when</span><span class="tok-p">(</span>	<span class="tok-nx">$</span><span class="tok-p">.</span><span class="tok-nx">get</span><span class="tok-p">(</span><span class="tok-s2">&quot;/datosEncriptados&quot;</span><span class="tok-p">),</span><span class="tok-nx">$</span><span class="tok-p">.</span><span class="tok-nx">get</span><span class="tok-p">(</span><span class="tok-s2">&quot;/claveEncriptacion&quot;</span><span class="tok-p">))</span>
  <span class="tok-p">.</span><span class="tok-nx">then</span><span class="tok-p">(</span><span class="tok-kd">function</span><span class="tok-p">()</span> <span class="tok-p">{</span>	<span class="tok-c1">// done</span>
    <span class="tok-c1">// ambas llamadas han funcionado</span>
  <span class="tok-p">},</span> <span class="tok-kd">function</span><span class="tok-p">()</span> <span class="tok-p">{</span>	<span class="tok-c1">// fail</span>
    <span class="tok-c1">// una de las llamadas ha fallado</span>
  <span class="tok-p">},</span> <span class="tok-kd">function</span><span class="tok-p">()</span> <span class="tok-p">{</span>	<span class="tok-c1">// always</span>
    <span class="tok-nx">$</span><span class="tok-p">(</span><span class="tok-s2">&quot;#contenido&quot;</span><span class="tok-p">).</span><span class="tok-nx">remove</span><span class="tok-p">(</span><span class="tok-s2">&quot;.spinner&quot;</span><span class="tok-p">);</span>
<span class="tok-p">});</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Si las dos promesas se resuelven, entonces la promesa agregada también se resuelve, y se llamará la función del primer <em>callback</em> (<code>done()</code>). Sin embargo, en cuanto una de las promesas se rechace, la promesa agregada se rechazará también, disparando el <em>callback</em> de <code>fail()</code>.</p>
</div>
<div class="paragraph">
<p>Otro caso de uso es permitir al usuario solicitar un recurso que puede o no estar disponible. Por ejemplo, supongamos un <em>widget</em> de un chat que cargamos con <em>YepNope</em>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="javascript"><span class="tok-kd">var</span> <span class="tok-nx">cargandoChat</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-nx">$</span><span class="tok-p">.</span><span class="tok-nx">Deferred</span><span class="tok-p">();</span>
<span class="tok-nx">yepnope</span><span class="tok-p">({</span>
  <span class="tok-nx">load</span><span class="tok-o">:</span> <span class="tok-s2">&quot;recursos/chat.js&quot;</span><span class="tok-p">,</span>
  <span class="tok-nx">complete</span><span class="tok-o">:</span> <span class="tok-nx">cargandoChat</span><span class="tok-p">.</span><span class="tok-nx">resolve</span>
<span class="tok-p">});</span>

<span class="tok-kd">var</span> <span class="tok-nx">lanzandoChat</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-nx">$</span><span class="tok-p">.</span><span class="tok-nx">Deferred</span><span class="tok-p">();</span>
<span class="tok-nx">$</span><span class="tok-p">(</span><span class="tok-s2">&quot;#lanzarChat&quot;</span><span class="tok-p">).</span><span class="tok-nx">click</span><span class="tok-p">(</span><span class="tok-nx">lanzandoChat</span><span class="tok-p">.</span><span class="tok-nx">resolve</span><span class="tok-p">);</span>
<span class="tok-nx">lanzandoChat</span><span class="tok-p">.</span><span class="tok-nx">done</span><span class="tok-p">(</span><span class="tok-kd">function</span><span class="tok-p">()</span> <span class="tok-p">{</span>
  <span class="tok-nx">$</span><span class="tok-p">(</span><span class="tok-s2">&quot;#contenidoChat&quot;</span><span class="tok-p">).</span><span class="tok-nx">append</span><span class="tok-p">(</span><span class="tok-s2">&quot;&lt;div class=&#39;spinner&#39;&gt;&quot;</span><span class="tok-p">);</span>
<span class="tok-p">});</span>

<span class="tok-nx">$</span><span class="tok-p">.</span><span class="tok-nx">when</span><span class="tok-p">(</span><span class="tok-nx">cargandoChat</span><span class="tok-p">,</span> <span class="tok-nx">lanzandoChat</span><span class="tok-p">).</span><span class="tok-nx">done</span><span class="tok-p">(</span><span class="tok-kd">function</span><span class="tok-p">()</span> <span class="tok-p">{</span>
  <span class="tok-nx">$</span><span class="tok-p">(</span><span class="tok-s2">&quot;#contenidoChat&quot;</span><span class="tok-p">).</span><span class="tok-nx">remove</span><span class="tok-p">(</span><span class="tok-s2">&quot;.spinner&quot;</span><span class="tok-p">);</span>
  <span class="tok-c1">// comienza el chat</span>
<span class="tok-p">});</span></code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_deferreds_y_ajax">8.4.6. Deferreds y AJAX</h4>
<div class="paragraph">
<p>Las promesas facilitan mucho el trabajo con AJAX y el trabajo con acceso simultáneos a recursos remotos.</p>
</div>
<div class="paragraph">
<p>El objeto <code>jxXHR</code> que se obtiene de los métodos AJAX como <code>$.ajax()</code> o <code>$.getJSON()</code> implementan el interfaz <code>Promise</code>, por lo que vamos a poder utilizar los métodos <code>done</code>, <code>fail</code>, <code>then</code>, <code>always</code> y <code>when</code>.</p>
</div>
<div class="paragraph">
<p>Así pues, vamos a poder escribir código similar al siguiente, donde tras hacer la petición vamos a poder utilizar los <em>callbacks</em> que ofrecen las promesas:</p>
</div>
<div class="paragraph">
<p>Ejemplo AJAX y Deferreds: <a href="http://jsbin.com/ponaca/edit?html,js,console,output" class="bare">http://jsbin.com/ponaca/edit?html,js,console,output</a></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="javascript"><span class="tok-kd">function</span> <span class="tok-nx">getDatos</span><span class="tok-p">()</span> <span class="tok-p">{</span>
  <span class="tok-kd">var</span> <span class="tok-nx">peticion</span> <span class="tok-o">=</span> <span class="tok-nx">$</span><span class="tok-p">.</span><span class="tok-nx">getJSON</span><span class="tok-p">(</span><span class="tok-s2">&quot;http://www.omdbapi.com/?s=batman&amp;callback=?&quot;</span><span class="tok-p">);</span>
  <span class="tok-nx">peticion</span><span class="tok-p">.</span><span class="tok-nx">done</span><span class="tok-p">(</span><span class="tok-nx">todoOk</span><span class="tok-p">).</span><span class="tok-nx">fail</span><span class="tok-p">(</span><span class="tok-kd">function</span><span class="tok-p">()</span> <span class="tok-p">{</span>
    <span class="tok-nx">console</span><span class="tok-p">.</span><span class="tok-nx">log</span><span class="tok-p">(</span><span class="tok-s2">&quot;Algo ha fallado&quot;</span><span class="tok-p">);</span>
  <span class="tok-p">});</span>
  <span class="tok-nx">peticion</span><span class="tok-p">.</span><span class="tok-nx">always</span><span class="tok-p">(</span><span class="tok-kd">function</span><span class="tok-p">()</span> <span class="tok-p">{</span>
    <span class="tok-nx">console</span><span class="tok-p">.</span><span class="tok-nx">log</span><span class="tok-p">(</span><span class="tok-s2">&quot;Final, bien o mal&quot;</span><span class="tok-p">);</span>
  <span class="tok-p">});</span>
<span class="tok-p">}</span>

<span class="tok-kd">function</span> <span class="tok-nx">todoOk</span><span class="tok-p">(</span><span class="tok-nx">datos</span><span class="tok-p">)</span> <span class="tok-p">{</span>
  <span class="tok-nx">console</span><span class="tok-p">.</span><span class="tok-nx">log</span><span class="tok-p">(</span><span class="tok-s2">&quot;Datos recibidos y adjuntándolos a resultado&quot;</span><span class="tok-p">);</span>
  <span class="tok-nx">$</span><span class="tok-p">(</span><span class="tok-s2">&quot;#resultado&quot;</span><span class="tok-p">).</span><span class="tok-nx">append</span><span class="tok-p">(</span><span class="tok-nx">JSON</span><span class="tok-p">.</span><span class="tok-nx">stringify</span><span class="tok-p">(</span><span class="tok-nx">datos</span><span class="tok-p">));</span>
<span class="tok-p">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>En resumen, el uso de promesas simplifica la gestión de eventos asíncronos evitando múltiples condiciones anidadas. Ya veremos en el módulo de <em>Angular</em> como dicho <em>framework</em> hace un uso extenso de las promesas.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_ejercicios_8">8.5. Ejercicios</h3>
<div class="sect3">
<h4 id="__0_5_ptos_ejercicio_81_star_wars_fetch">8.5.1. (0.5 ptos) Ejercicio 81. Star Wars Fetch</h4>
<div class="paragraph">
<p>A partir del ejercicio 72 sobre <em>Star Wars API</em>, vamos a reescribir el contenido mediante <em>Fetch API</em> y el uso de promesas para reducir el código y simplificar la lógica de las llamadas.</p>
</div>
<div class="paragraph">
<p>En este caso, el listado de películas se tiene que pintar en el DOM de una sola vez, no conforme se reciben los títulos de las películas con cada petición AJAX.</p>
</div>
<div class="paragraph">
<p>Todo el código estará incluido en el archivo <code>ej81.js</code>.</p>
</div>
</div>
<div class="sect3">
<h4 id="__0_3_ptos_ejercicio_82_star_wars_deferreds">8.5.2. (0.3 ptos) Ejercicio 82. Star Wars Deferreds</h4>
<div class="paragraph">
<p>A partir del ejercicio 72 sobre <em>Star Wars API</em>, se pide reescribir el contenido para hacer uso de <em>Deferreds</em>.</p>
</div>
<div class="paragraph">
<p>De igual manera que el ejercicio anterior, el listado de películas se tiene que pintar en el DOM de una sola vez, no conforme se reciben los títulos de las películas con cada petición AJAX.</p>
</div>
<div class="paragraph">
<p>Todo el código estará incluido en el archivo <code>ej82.js</code>.</p>
</div>
</div>
</div>
</div>
</div>
</div>
<div id="footnotes">
<hr>
<div class="footnote" id="_footnote_1">
<a href="#_footnoteref_1">1</a>. 1&#8201;&#8212;&#8201;1&#8201;&#8212;&#8201;2015
</div>
<div class="footnote" id="_footnote_2">
<a href="#_footnoteref_2">2</a>. 7
</div>
<div class="footnote" id="_footnote_3">
<a href="#_footnoteref_3">3</a>. "¡Hola Mundo!", "2" y "Esta es una variable local con alcance anidado"
</div>
<div class="footnote" id="_footnote_4">
<a href="#_footnoteref_4">4</a>. No saldría nada porque tendríamos un error de <em>JavaScript</em> al no ser visible <code>varLocal</code>
</div>
<div class="footnote" id="_footnote_5">
<a href="#_footnoteref_5">5</a>. 5, porque <code>a</code> si que es local a la función, pero <code>b</code> es global. Si la ejecutásemos mediante el modo estricto, obtendríamos un error de referencia
</div>
<div class="footnote" id="_footnote_6">
<a href="#_footnoteref_6">6</a>. <code>undefined</code> y <code>2</code>, ya que tanto la variable como la función hacen <em>hoisting</em>. La variable se declara pero no toma valor hasta la asignación, en cambio, la función si que se declara y se puede invocar.
</div>
<div class="footnote" id="_footnote_7">
<a href="#_footnoteref_7">7</a>. <code>"Aitor Medrano"</code> y <code>"Bruce Wayne"</code>, en el primer <code>console.log()</code>, <code>getNombre()</code> se invoca como un método de <code>obj.prop</code>, por lo que <code>this</code> toma el valor de la propiedad <code>obj.prop.nombre</code>. En el segundo <code>console.log()</code>, al invocarse como función, la variable <code>test</code> forma parte del objeto global, por ello, la función devuelve el valor de la propiedad <code>nombre</code> del objeto <code>window</code>
</div>
<div class="footnote" id="_footnote_8">
<a href="#_footnoteref_8">8</a>. [11, "hola", true, 15, "Bruce", undefined, undefined, undefined, "Wayne"&#93;
</div>
<div class="footnote" id="_footnote_9">
<a href="#_footnoteref_9">9</a>. <code>false</code>, porque tras darle la vuelta los valores son <code>["Laura, Ana, Pedro, Antonio, Juan"]</code> y al ordenarlos quedan como <code>["Ana, Antonio, Juan, Laura, Pedro"]</code>, por lo que a <code>alfa</code> se asigna el valor <code>Antonio</code>, mientras que <code>nombres[2]</code> queda como <code>Juan</code>
</div>
<div class="footnote" id="_footnote_10">
<a href="#_footnoteref_10">10</a>. Saldrá 'Click en elemento número 4', considerando que hay cuatro nodos en la lista, ya que se crean tantos closures como nodos haya pero con un único entorno en común, de modo que todos comparten el valor de la variable <code>i</code>
</div>
<div class="footnote" id="_footnote_11">
<a href="#_footnoteref_11">11</a>. Crea una cita con el contenido que había en la capa <code>span.co</code>
</div>
<div class="footnote" id="_footnote_12">
<a href="#_footnoteref_12">12</a>. Antes se lanzaba <code>ajaxSuccess</code> y ahora se lanza <code>ajaxError</code>
</div>
<div class="footnote" id="_footnote_13">
<a href="#_footnoteref_13">13</a>. AJAX Comenzando, Antes de enviar la información&#8230;&#8203;, GET url Not found, Houston tenemos un problema: Not found, Todo ha finalizado!, AJAX petición finalizada
</div>
<div class="footnote" id="_footnote_14">
<a href="#_footnoteref_14">14</a>. Un array con los valores: 5, 4, 3, 2, 1, 6, 7, 8
</div>
<div class="footnote" id="_footnote_15">
<a href="#_footnoteref_15">15</a>. Sólo el valor de PI, ya que una vez resuelta, la promesa no puede tomar otro valor
</div>
<div class="footnote" id="_footnote_16">
<a href="#_footnoteref_16">16</a>. ¡Mal! y el error de parseo de JSON inválido, ya que se lanza una excepción en el constructor y por tanto no se resuelve la promesa
</div>
<div class="footnote" id="_footnote_17">
<a href="#_footnoteref_17">17</a>. La promesa <code>datosServer</code> se rechazaría y por consiguiente no se comprobaría la caché
</div>
</div>
<div id="footer">
<div id="footer-text">
Version 1.1<br>
Last updated 2016-02-23 21:54:11 CET
</div>
</div>
</body>
</html>