<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<!--[if IE]><meta http-equiv="X-UA-Compatible" content="IE=edge"><![endif]-->
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 1.5.2">
<meta name="author" content="José Luis Zamora Sánchez">
<title>Servidores web y PaaS</title>
<style>/*! normalize.css v2.1.2 | MIT License | git.io/normalize */
/* ========================================================================== HTML5 display definitions ========================================================================== */
/** Correct `block` display not defined in IE 8/9. */
article, aside, details, figcaption, figure, footer, header, hgroup, main, nav, section, summary { display: block; }

/** Correct `inline-block` display not defined in IE 8/9. */
audio, canvas, video { display: inline-block; }

/** Prevent modern browsers from displaying `audio` without controls. Remove excess height in iOS 5 devices. */
audio:not([controls]) { display: none; height: 0; }

/** Address `[hidden]` styling not present in IE 8/9. Hide the `template` element in IE, Safari, and Firefox < 22. */
[hidden], template { display: none; }

script { display: none !important; }

/* ========================================================================== Base ========================================================================== */
/** 1. Set default font family to sans-serif. 2. Prevent iOS text size adjust after orientation change, without disabling user zoom. */
html { font-family: sans-serif; /* 1 */ -ms-text-size-adjust: 100%; /* 2 */ -webkit-text-size-adjust: 100%; /* 2 */ }

/** Remove default margin. */
body { margin: 0; }

/* ========================================================================== Links ========================================================================== */
/** Remove the gray background color from active links in IE 10. */
a { background: transparent; }

/** Address `outline` inconsistency between Chrome and other browsers. */
a:focus { outline: thin dotted; }

/** Improve readability when focused and also mouse hovered in all browsers. */
a:active, a:hover { outline: 0; }

/* ========================================================================== Typography ========================================================================== */
/** Address variable `h1` font-size and margin within `section` and `article` contexts in Firefox 4+, Safari 5, and Chrome. */
h1 { font-size: 2em; margin: 0.67em 0; }

/** Address styling not present in IE 8/9, Safari 5, and Chrome. */
abbr[title] { border-bottom: 1px dotted; }

/** Address style set to `bolder` in Firefox 4+, Safari 5, and Chrome. */
b, strong { font-weight: bold; }

/** Address styling not present in Safari 5 and Chrome. */
dfn { font-style: italic; }

/** Address differences between Firefox and other browsers. */
hr { -moz-box-sizing: content-box; box-sizing: content-box; height: 0; }

/** Address styling not present in IE 8/9. */
mark { background: #ff0; color: #000; }

/** Correct font family set oddly in Safari 5 and Chrome. */
code, kbd, pre, samp { font-family: monospace, serif; font-size: 1em; }

/** Improve readability of pre-formatted text in all browsers. */
pre { white-space: pre-wrap; }

/** Set consistent quote types. */
q { quotes: "\201C" "\201D" "\2018" "\2019"; }

/** Address inconsistent and variable font size in all browsers. */
small { font-size: 80%; }

/** Prevent `sub` and `sup` affecting `line-height` in all browsers. */
sub, sup { font-size: 75%; line-height: 0; position: relative; vertical-align: baseline; }

sup { top: -0.5em; }

sub { bottom: -0.25em; }

/* ========================================================================== Embedded content ========================================================================== */
/** Remove border when inside `a` element in IE 8/9. */
img { border: 0; }

/** Correct overflow displayed oddly in IE 9. */
svg:not(:root) { overflow: hidden; }

/* ========================================================================== Figures ========================================================================== */
/** Address margin not present in IE 8/9 and Safari 5. */
figure { margin: 0; }

/* ========================================================================== Forms ========================================================================== */
/** Define consistent border, margin, and padding. */
fieldset { border: 1px solid #c0c0c0; margin: 0 2px; padding: 0.35em 0.625em 0.75em; }

/** 1. Correct `color` not being inherited in IE 8/9. 2. Remove padding so people aren't caught out if they zero out fieldsets. */
legend { border: 0; /* 1 */ padding: 0; /* 2 */ }

/** 1. Correct font family not being inherited in all browsers. 2. Correct font size not being inherited in all browsers. 3. Address margins set differently in Firefox 4+, Safari 5, and Chrome. */
button, input, select, textarea { font-family: inherit; /* 1 */ font-size: 100%; /* 2 */ margin: 0; /* 3 */ }

/** Address Firefox 4+ setting `line-height` on `input` using `!important` in the UA stylesheet. */
button, input { line-height: normal; }

/** Address inconsistent `text-transform` inheritance for `button` and `select`. All other form control elements do not inherit `text-transform` values. Correct `button` style inheritance in Chrome, Safari 5+, and IE 8+. Correct `select` style inheritance in Firefox 4+ and Opera. */
button, select { text-transform: none; }

/** 1. Avoid the WebKit bug in Android 4.0.* where (2) destroys native `audio` and `video` controls. 2. Correct inability to style clickable `input` types in iOS. 3. Improve usability and consistency of cursor style between image-type `input` and others. */
button, html input[type="button"], input[type="reset"], input[type="submit"] { -webkit-appearance: button; /* 2 */ cursor: pointer; /* 3 */ }

/** Re-set default cursor for disabled elements. */
button[disabled], html input[disabled] { cursor: default; }

/** 1. Address box sizing set to `content-box` in IE 8/9. 2. Remove excess padding in IE 8/9. */
input[type="checkbox"], input[type="radio"] { box-sizing: border-box; /* 1 */ padding: 0; /* 2 */ }

/** 1. Address `appearance` set to `searchfield` in Safari 5 and Chrome. 2. Address `box-sizing` set to `border-box` in Safari 5 and Chrome (include `-moz` to future-proof). */
input[type="search"] { -webkit-appearance: textfield; /* 1 */ -moz-box-sizing: content-box; -webkit-box-sizing: content-box; /* 2 */ box-sizing: content-box; }

/** Remove inner padding and search cancel button in Safari 5 and Chrome on OS X. */
input[type="search"]::-webkit-search-cancel-button, input[type="search"]::-webkit-search-decoration { -webkit-appearance: none; }

/** Remove inner padding and border in Firefox 4+. */
button::-moz-focus-inner, input::-moz-focus-inner { border: 0; padding: 0; }

/** 1. Remove default vertical scrollbar in IE 8/9. 2. Improve readability and alignment in all browsers. */
textarea { overflow: auto; /* 1 */ vertical-align: top; /* 2 */ }

/* ========================================================================== Tables ========================================================================== */
/** Remove most spacing between table cells. */
table { border-collapse: collapse; border-spacing: 0; }

meta.foundation-mq-small { font-family: "only screen and (min-width: 768px)"; width: 768px; }

meta.foundation-mq-medium { font-family: "only screen and (min-width:1280px)"; width: 1280px; }

meta.foundation-mq-large { font-family: "only screen and (min-width:1440px)"; width: 1440px; }

*, *:before, *:after { -moz-box-sizing: border-box; -webkit-box-sizing: border-box; box-sizing: border-box; }

html, body { font-size: 97%; }

body { background: white; color: #222222; padding: 0; margin: 0; font-family: "Helvetica Neue", "Helvetica", Helvetica, Arial, sans-serif; font-weight: normal; font-style: normal; line-height: 1; position: relative; cursor: auto; }

a:hover { cursor: pointer; }

img, object, embed { max-width: 100%; height: auto; }

object, embed { height: 100%; }

img { -ms-interpolation-mode: bicubic; }

#map_canvas img, #map_canvas embed, #map_canvas object, .map_canvas img, .map_canvas embed, .map_canvas object { max-width: none !important; }

.left { float: left !important; }

.right { float: right !important; }

.text-left { text-align: left !important; }

.text-right { text-align: right !important; }

.text-center { text-align: center !important; }

.text-justify { text-align: justify !important; }

.hide { display: none; }

.antialiased, body { -webkit-font-smoothing: antialiased; }

img { display: inline-block; vertical-align: middle; }

textarea { height: auto; min-height: 50px; }

select { width: 100%; }

p.lead, .paragraph.lead > p, #preamble > .sectionbody > .paragraph:first-of-type p { font-size: 1.21875em; line-height: 1.6; }

.subheader, .admonitionblock td.content > .title, .audioblock > .title, .exampleblock > .title, .imageblock > .title, .listingblock > .title, .literalblock > .title, .stemblock > .title, .openblock > .title, .paragraph > .title, .quoteblock > .title, table.tableblock > .title, .verseblock > .title, .videoblock > .title, .dlist > .title, .olist > .title, .ulist > .title, .qlist > .title, .hdlist > .title { line-height: 1.4; color: #6f6f6f; font-weight: 300; margin-top: 0.2em; margin-bottom: 0.5em; }

/* Typography resets */
div, dl, dt, dd, ul, ol, li, h1, h2, h3, #toctitle, .sidebarblock > .content > .title, h4, h5, h6, pre, form, p, blockquote, th, td { margin: 0; padding: 0; direction: ltr; }

/* Default Link Styles */
a { color: #1164be; text-decoration: none; line-height: inherit; }
a img { border: none; }

/* Default paragraph styles */
p { font-family: inherit; font-weight: normal; font-size: 1em; line-height: 1.4; margin-bottom: 1em; text-rendering: optimizeLegibility; }
p aside { font-size: 0.875em; line-height: 1.35; font-style: italic; }

/* Default header styles */
h1, h2, h3, #toctitle, .sidebarblock > .content > .title, h4, h5, h6 { font-family: "Helvetica Neue", "Helvetica", Helvetica, Arial, sans-serif; font-weight: bold; font-style: normal; color: #1c355e; text-rendering: optimizeLegibility; margin-top: 1em; margin-bottom: 0.5em; line-height: 1.2125em; }
h1 small, h2 small, h3 small, #toctitle small, .sidebarblock > .content > .title small, h4 small, h5 small, h6 small { font-size: 60%; color: #6f6f6f; line-height: 0; }

h1 { font-size: 2.125em; }

h2 { font-size: 1.6875em; }

h3, #toctitle, .sidebarblock > .content > .title { font-size: 1.375em; }

h4 { font-size: 1.125em; }

h5 { font-size: 1.125em; }

h6 { font-size: 1em; }

hr { border: solid #dddddd; border-width: 1px 0 0; clear: both; margin: 1.25em 0 1.1875em; height: 0; }

/* Helpful Typography Defaults */
em, i { font-style: italic; line-height: inherit; }

strong, b { font-weight: bold; line-height: inherit; }

small { font-size: 60%; line-height: inherit; }

code { font-family: Consolas, "Liberation Mono", Courier, monospace; font-weight: bold; }

/* Lists */
ul, ol, dl { font-size: 1em; line-height: 1.4; margin-bottom: 1.25em; list-style-position: outside; font-family: inherit; }

ul, ol { margin-left: 2.5em; }
ul.no-bullet, ol.no-bullet { margin-left: 1.5em; }

/* Unordered Lists */
ul li ul, ul li ol { margin-left: 1.25em; margin-bottom: 0; font-size: 1em; /* Override nested font-size change */ }
ul.square li ul, ul.circle li ul, ul.disc li ul { list-style: inherit; }
ul.square { list-style-type: square; }
ul.circle { list-style-type: circle; }
ul.disc { list-style-type: disc; }
ul.no-bullet { list-style: none; }

/* Ordered Lists */
ol li ul, ol li ol { margin-left: 1.25em; margin-bottom: 0; }

/* Definition Lists */
dl dt { margin-bottom: 0.3125em; font-weight: bold; }
dl dd { margin-bottom: 1.25em; }

/* Abbreviations */
abbr, acronym { text-transform: uppercase; font-size: 90%; color: #222222; border-bottom: 1px dotted #dddddd; cursor: help; }

abbr { text-transform: none; }

/* Blockquotes */
blockquote { margin: 0 0 1.25em; padding: 0.5625em 1.25em 0 1.1875em; border-left: 1px solid #dddddd; }
blockquote cite { display: block; font-size: 0.8125em; color: #555555; }
blockquote cite:before { content: "\2014 \0020"; }
blockquote cite a, blockquote cite a:visited { color: #555555; }

blockquote, blockquote p { line-height: 1.6; color: #6f6f6f; }

/* Microformats */
.vcard { display: inline-block; margin: 0 0 1.25em 0; border: 1px solid #dddddd; padding: 0.625em 0.75em; }
.vcard li { margin: 0; display: block; }
.vcard .fn { font-weight: bold; font-size: 0.9375em; }

.vevent .summary { font-weight: bold; }
.vevent abbr { cursor: auto; text-decoration: none; font-weight: bold; border: none; padding: 0 0.0625em; }

/*@media only screen and (min-width: 768px) { h1, h2, h3, #toctitle, .sidebarblock > .content > .title, h4, h5, h6 { line-height: 1.4; }
  h1 { font-size: 2.75em; }
  h2 { font-size: 2.3125em; }
  h3, #toctitle, .sidebarblock > .content > .title { font-size: 1.6875em; }
  h4 { font-size: 1.4375em; } }*/
/* Tables */
table { background: white; margin-bottom: 1.25em; border: solid 1px #dddddd; }
table thead, table tfoot { background: whitesmoke; font-weight: bold; }
table thead tr th, table thead tr td, table tfoot tr th, table tfoot tr td { padding: 0.5em 0.625em 0.625em; font-size: inherit; color: #222222; text-align: left; }
table tr th, table tr td { padding: 0.5625em 0.625em; font-size: inherit; color: #222222; }
table tr.even, table tr.alt, table tr:nth-of-type(even) { background: #f9f9f9; }
table thead tr th, table tfoot tr th, table tbody tr td, table tr td, table tfoot tr td { display: table-cell; line-height: 1.4; }

h1, h2, h3, #toctitle, .sidebarblock > .content > .title, h4, h5, h6 { line-height: 1.4; border-bottom: 1px solid #dddddd }

.clearfix:before, .clearfix:after, .float-group:before, .float-group:after { content: " "; display: table; }
.clearfix:after, .float-group:after { clear: both; }

*:not(pre) > code { font-size: inherit; font-style: normal !important; letter-spacing: 0; padding: 3px 2px 1px 2px; background-color: #eeeeee; border: 1px solid #dddddd; -webkit-border-radius: 0; border-radius: 0; line-height: inherit; font-weight: normal; }

pre, pre > code { line-height: 1.4; color: black; font-family: monospace, serif; font-weight: normal; }

.keyseq { color: #555555; }

kbd { display: inline-block; color: #222222; font-size: 0.75em; line-height: 1.4; background-color: #f7f7f7; border: 1px solid #ccc; -webkit-border-radius: 3px; border-radius: 3px; -webkit-box-shadow: 0 1px 0 rgba(0, 0, 0, 0.2), 0 0 0 0.1em white inset; box-shadow: 0 1px 0 rgba(0, 0, 0, 0.2), 0 0 0 0.1em white inset; margin: -0.15em 0.15em 0 0.15em; padding: 0.2em 0.6em 0.2em 0.5em; vertical-align: middle; white-space: nowrap; }

.keyseq kbd:first-child { margin-left: 0; }

.keyseq kbd:last-child { margin-right: 0; }

.menuseq, .menu { color: #090909; }

b.button:before, b.button:after { position: relative; top: -1px; font-weight: normal; }

b.button:before { content: "["; padding: 0 3px 0 2px; }

b.button:after { content: "]"; padding: 0 2px 0 3px; }

#header, #content, #footnotes, #footer { width: 100%; margin-left: auto; margin-right: auto; margin-top: 0; margin-bottom: 0; max-width: 62.5em; *zoom: 1; position: relative; padding-left: 0.9375em; padding-right: 0.9375em; }
#header:before, #header:after, #content:before, #content:after, #footnotes:before, #footnotes:after, #footer:before, #footer:after { content: " "; display: table; }
#header:after, #content:after, #footnotes:after, #footer:after { clear: both; }

#content { margin-top: 1.25em; }

#content:before { content: none; }

#header > h1:first-child { color: black; margin-top: 2.25rem; margin-bottom: 0; }
#header > h1:first-child + #toc { margin-top: 8px; border-top: 1px solid #dddddd; }
#header > h1:only-child, body.toc2 #header > h1:nth-last-child(2) { border-bottom: 1px solid #dddddd; padding-bottom: 8px; }
#header .details { border-bottom: 1px solid #dddddd; line-height: 1.45; padding-top: 0.25em; padding-bottom: 0.25em; padding-left: 0.25em; color: #555555; display: -ms-flexbox; display: -webkit-flex; display: flex; -ms-flex-flow: row wrap; -webkit-flex-flow: row wrap; flex-flow: row wrap; }
#header .details span:first-child { margin-left: -0.125em; }
#header .details span.email a { color: #6f6f6f; }
#header .details br { display: none; }
#header .details br + span:before { content: "\00a0\2013\00a0"; }
#header .details br + span.author:before { content: "\00a0\22c5\00a0"; color: #6f6f6f; }
#header .details br + span#revremark:before { content: "\00a0|\00a0"; }
#header #revnumber { text-transform: capitalize; }
#header #revnumber:after { content: "\00a0"; }

#content > h1:first-child:not([class]) { color: black; border-bottom: 1px solid #dddddd; padding-bottom: 8px; margin-top: 0; padding-top: 1rem; margin-bottom: 1.25rem; }

#floating {
  position: fixed;
  z-index: 1000;
  padding: 0.5em;
  right: 0;
  top: 0;
  background: white;
  box-shadow: 0 0 1em #777777;
  -webkit-box-shadow: 0 0 1em #777777;
  -moz-box-shadow: 0 0 1em #777777;
  -webkit-border-bottom-left-radius: 5px;
  -moz-border-radius-bottomleft: 5px;
  max-height: 80%;
  overflow: auto;
}

#floating #full { display: none; } /* Hide the full TOC by default */

#floating:hover #full{
  display: block; /* Show it on hover */
}


#toc { border-bottom: 1px solid #dddddd; padding-bottom: 0.5em; }
#toc > ul { margin-left: 0.125em; }
#toc ul.sectlevel0 > li > a { font-style: italic; }
#toc ul.sectlevel0 ul.sectlevel1 { margin: 0.5em 0; }
#toc ul { font-family: "Helvetica Neue", "Helvetica", Helvetica, Arial, sans-serif; list-style-type: none; }
#toc a { text-decoration: none; }
#toc a:active { text-decoration: underline; }

#toctitle { color: #6f6f6f; font-size: 1.2em; }

@media only screen and (min-width: 768px) { #toctitle { font-size: 1.375em; }
  body.toc2 { padding-left: 15em; padding-right: 0; }
  #toc.toc2 { margin-top: 0 !important; background-color: #f2f2f2; position: fixed; width: 15em; left: 0; top: 0; border-right: 1px solid #dddddd; border-top-width: 0 !important; border-bottom-width: 0 !important; z-index: 1000; padding: 1.25em 1em; height: 100%; overflow: auto; }
  #toc.toc2 #toctitle { margin-top: 0; font-size: 1.2em; }
  #toc.toc2 > ul { font-size: 0.9em; margin-bottom: 0; }
  #toc.toc2 ul ul { margin-left: 0; padding-left: 1em; }
  #toc.toc2 ul.sectlevel0 ul.sectlevel1 { padding-left: 0; margin-top: 0.5em; margin-bottom: 0.5em; }
  body.toc2.toc-right { padding-left: 0; padding-right: 15em; }
  body.toc2.toc-right #toc.toc2 { border-right-width: 0; border-left: 1px solid #dddddd; left: auto; right: 0; } }
@media only screen and (min-width: 1280px) { body.toc2 { padding-left: 20em; padding-right: 0; }
  #toc.toc2 { width: 20em; }
  #toc.toc2 #toctitle { font-size: 1.375em; }
  #toc.toc2 > ul { font-size: 0.95em; }
  #toc.toc2 ul ul { padding-left: 1.25em; }
  body.toc2.toc-right { padding-left: 0; padding-right: 20em; } }
#content #toc { border-style: solid; border-width: 1px; border-color: #d9d9d9; margin-bottom: 1.25em; padding: 1.25em; background: #f2f2f2; -webkit-border-radius: 0; border-radius: 0; }
#content #toc > :first-child { margin-top: 0; }
#content #toc > :last-child { margin-bottom: 0; }

#footer { max-width: 100%; background-color: #222222; padding: 1.25em; }

#footer-text { color: #dddddd; line-height: 1.44; }

.sect1 { padding-bottom: 0.625em; }

@media only screen and (min-width: 768px) { .sect1 { padding-bottom: 1.25em; } }
.sect1 + .sect1 { border-top: 1px solid #dddddd; }

#content h1 > a.anchor, h2 > a.anchor, h3 > a.anchor, #toctitle > a.anchor, .sidebarblock > .content > .title > a.anchor, h4 > a.anchor, h5 > a.anchor, h6 > a.anchor { position: absolute; z-index: 1001; width: 1.5ex; margin-left: -1.5ex; display: block; text-decoration: none !important; visibility: hidden; text-align: center; font-weight: normal; }
#content h1 > a.anchor:before, h2 > a.anchor:before, h3 > a.anchor:before, #toctitle > a.anchor:before, .sidebarblock > .content > .title > a.anchor:before, h4 > a.anchor:before, h5 > a.anchor:before, h6 > a.anchor:before { content: "\00A7"; font-size: 0.85em; display: block; padding-top: 0.1em; }
#content h1:hover > a.anchor, #content h1 > a.anchor:hover, h2:hover > a.anchor, h2 > a.anchor:hover, h3:hover > a.anchor, #toctitle:hover > a.anchor, .sidebarblock > .content > .title:hover > a.anchor, h3 > a.anchor:hover, #toctitle > a.anchor:hover, .sidebarblock > .content > .title > a.anchor:hover, h4:hover > a.anchor, h4 > a.anchor:hover, h5:hover > a.anchor, h5 > a.anchor:hover, h6:hover > a.anchor, h6 > a.anchor:hover { visibility: visible; }
#content h1 > a.link, h2 > a.link, h3 > a.link, #toctitle > a.link, .sidebarblock > .content > .title > a.link, h4 > a.link, h5 > a.link, h6 > a.link { color: #222222; text-decoration: none; }
#content h1 > a.link:hover, h2 > a.link:hover, h3 > a.link:hover, #toctitle > a.link:hover, .sidebarblock > .content > .title > a.link:hover, h4 > a.link:hover, h5 > a.link:hover, h6 > a.link:hover { color: #151515; }

.audioblock, .imageblock, .literalblock, .listingblock, .stemblock, .videoblock { margin-bottom: 1.25em; }

.admonitionblock td.content > .title, .audioblock > .title, .exampleblock > .title, .imageblock > .title, .listingblock > .title, .literalblock > .title, .stemblock > .title, .openblock > .title, .paragraph > .title, .quoteblock > .title, table.tableblock > .title, .verseblock > .title, .videoblock > .title, .dlist > .title, .olist > .title, .ulist > .title, .qlist > .title, .hdlist > .title { text-rendering: optimizeLegibility; text-align: left; }

table.tableblock > caption.title { white-space: nowrap; overflow: visible; max-width: 0; }

.paragraph.lead > p, #preamble > .sectionbody > .paragraph:first-of-type p { color: black; }

table.tableblock #preamble > .sectionbody > .paragraph:first-of-type p { font-size: inherit; }

.admonitionblock > table { border-collapse: separate; border: 0; background: none; width: 100%; }
.admonitionblock > table td.icon { text-align: center; width: 80px; }
.admonitionblock > table td.icon img { max-width: none; }
.admonitionblock > table td.icon .title { font-weight: bold; font-family: "Helvetica Neue", "Helvetica", Helvetica, Arial, sans-serif; text-transform: uppercase; }
.admonitionblock > table td.content { padding-left: 1.125em; padding-right: 1.25em; border-left: 1px solid #dddddd; color: #555555; }
.admonitionblock > table td.content > :last-child > :last-child { margin-bottom: 0; }

.exampleblock > .content { border-style: solid; border-width: 1px; border-color: #e6e6e6; margin-bottom: 1.25em; padding: 1.25em; background: white; -webkit-border-radius: 0; border-radius: 0; }
.exampleblock > .content > :first-child { margin-top: 0; }
.exampleblock > .content > :last-child { margin-bottom: 0; }

.sidebarblock { border-style: solid; border-width: 1px; border-color: #d9d9d9; margin-bottom: 1.25em; padding: 1.25em; background: #f2f2f2; -webkit-border-radius: 0; border-radius: 0; }
.sidebarblock > :first-child { margin-top: 0; }
.sidebarblock > :last-child { margin-bottom: 0; }
.sidebarblock > .content > .title { color: #6f6f6f; margin-top: 0; }

.exampleblock > .content > :last-child > :last-child, .exampleblock > .content .olist > ol > li:last-child > :last-child, .exampleblock > .content .ulist > ul > li:last-child > :last-child, .exampleblock > .content .qlist > ol > li:last-child > :last-child, .sidebarblock > .content > :last-child > :last-child, .sidebarblock > .content .olist > ol > li:last-child > :last-child, .sidebarblock > .content .ulist > ul > li:last-child > :last-child, .sidebarblock > .content .qlist > ol > li:last-child > :last-child { margin-bottom: 0; }

.literalblock pre, .listingblock pre:not(.highlight), .listingblock pre[class="highlight"], .listingblock pre[class^="highlight "], .listingblock pre.CodeRay, .listingblock pre.prettyprint { background: #eeeeee; }
.sidebarblock .literalblock pre, .sidebarblock .listingblock pre:not(.highlight), .sidebarblock .listingblock pre[class="highlight"], .sidebarblock .listingblock pre[class^="highlight "], .sidebarblock .listingblock pre.CodeRay, .sidebarblock .listingblock pre.prettyprint { background: #f2f1f1; }

.literalblock pre, .literalblock pre[class], .listingblock pre, .listingblock pre[class] { border: 1px solid #cccccc; -webkit-border-radius: 0; border-radius: 0; word-wrap: break-word; padding: 0.8em 0.8em 0.65em 0.8em; font-size: 0.8125em; }
.literalblock pre.nowrap, .literalblock pre[class].nowrap, .listingblock pre.nowrap, .listingblock pre[class].nowrap { overflow-x: auto; white-space: pre; word-wrap: normal; }
@media only screen and (min-width: 768px) { .literalblock pre, .literalblock pre[class], .listingblock pre, .listingblock pre[class] { font-size: 0.90625em; } }
@media only screen and (min-width: 1280px) { .literalblock pre, .literalblock pre[class], .listingblock pre, .listingblock pre[class] { font-size: 1em; } }

.literalblock.output pre { color: #eeeeee; background-color: black; }

.listingblock pre.highlightjs { padding: 0; }
.listingblock pre.highlightjs > code { padding: 0.8em 0.8em 0.65em 0.8em; -webkit-border-radius: 0; border-radius: 0; }

.listingblock > .content { position: relative; }

.listingblock code[data-lang]:before { display: none; content: attr(data-lang); position: absolute; font-size: 0.75em; top: 0.425rem; right: 0.5rem; line-height: 1; text-transform: uppercase; color: #999; }

.listingblock:hover code[data-lang]:before { display: block; }

.listingblock.terminal pre .command:before { content: attr(data-prompt); padding-right: 0.5em; color: #999; }

.listingblock.terminal pre .command:not([data-prompt]):before { content: "$"; }

table.pyhltable { border-collapse: separate; border: 0; margin-bottom: 0; background: none; }

table.pyhltable td { vertical-align: top; padding-top: 0; padding-bottom: 0; }

table.pyhltable td.code { padding-left: .75em; padding-right: 0; }

pre.pygments .lineno, table.pyhltable td:not(.code) { color: #999; padding-left: 0; padding-right: .5em; border-right: 1px solid #dddddd; }

pre.pygments .lineno { display: inline-block; margin-right: .25em; }

table.pyhltable .linenodiv { background: none !important; padding-right: 0 !important; }

.quoteblock { margin: 0 1em 1.25em 1.5em; display: table; }
.quoteblock > .title { margin-left: -1.5em; margin-bottom: 0.75em; }
.quoteblock blockquote, .quoteblock blockquote p { color: #6f6f6f; font-size: 1.15rem; line-height: 1.75; word-spacing: 0.1em; letter-spacing: 0; font-style: italic; text-align: justify; }
.quoteblock blockquote { margin: 0; padding: 0; border: 0; }
.quoteblock blockquote:before { content: "\201c"; float: left; font-size: 2.75em; font-weight: bold; line-height: 0.6em; margin-left: -0.6em; color: #6f6f6f; text-shadow: 0 1px 2px rgba(0, 0, 0, 0.1); }
.quoteblock blockquote > .paragraph:last-child p { margin-bottom: 0; }
.quoteblock .attribution { margin-top: 0.5em; margin-right: 0.5ex; text-align: right; }
.quoteblock .quoteblock { margin-left: 0; margin-right: 0; padding: 0.5em 0; border-left: 3px solid #555555; }
.quoteblock .quoteblock blockquote { padding: 0 0 0 0.75em; }
.quoteblock .quoteblock blockquote:before { display: none; }

.verseblock { margin: 0 1em 1.25em 1em; }
.verseblock pre { font-family: "Open Sans", "DejaVu Sans", sans; font-size: 1.15rem; color: #6f6f6f; font-weight: 300; text-rendering: optimizeLegibility; }
.verseblock pre strong { font-weight: 400; }
.verseblock .attribution { margin-top: 1.25rem; margin-left: 0.5ex; }

.quoteblock .attribution, .verseblock .attribution { font-size: 0.8125em; line-height: 1.45; font-style: italic; }
.quoteblock .attribution br, .verseblock .attribution br { display: none; }
.quoteblock .attribution cite, .verseblock .attribution cite { display: block; letter-spacing: -0.05em; color: #555555; }

.quoteblock.abstract { margin: 0 0 1.25em 0; display: block; }
.quoteblock.abstract blockquote, .quoteblock.abstract blockquote p { text-align: left; word-spacing: 0; }
.quoteblock.abstract blockquote:before, .quoteblock.abstract blockquote p:first-of-type:before { display: none; }

table.tableblock { max-width: 100%; border-collapse: separate; }
table.tableblock td > .paragraph:last-child p > p:last-child, table.tableblock th > p:last-child, table.tableblock td > p:last-child { margin-bottom: 0; }

table.spread { width: 100%; }

table.tableblock, th.tableblock, td.tableblock { border: 0 solid #dddddd; }

table.grid-all th.tableblock, table.grid-all td.tableblock { border-width: 0 1px 1px 0; }

table.grid-all tfoot > tr > th.tableblock, table.grid-all tfoot > tr > td.tableblock { border-width: 1px 1px 0 0; }

table.grid-cols th.tableblock, table.grid-cols td.tableblock { border-width: 0 1px 0 0; }

table.grid-all * > tr > .tableblock:last-child, table.grid-cols * > tr > .tableblock:last-child { border-right-width: 0; }

table.grid-rows th.tableblock, table.grid-rows td.tableblock { border-width: 0 0 1px 0; }

table.grid-all tbody > tr:last-child > th.tableblock, table.grid-all tbody > tr:last-child > td.tableblock, table.grid-all thead:last-child > tr > th.tableblock, table.grid-rows tbody > tr:last-child > th.tableblock, table.grid-rows tbody > tr:last-child > td.tableblock, table.grid-rows thead:last-child > tr > th.tableblock { border-bottom-width: 0; }

table.grid-rows tfoot > tr > th.tableblock, table.grid-rows tfoot > tr > td.tableblock { border-width: 1px 0 0 0; }

table.frame-all { border-width: 1px; }

table.frame-sides { border-width: 0 1px; }

table.frame-topbot { border-width: 1px 0; }

th.halign-left, td.halign-left { text-align: left; }

th.halign-right, td.halign-right { text-align: right; }

th.halign-center, td.halign-center { text-align: center; }

th.valign-top, td.valign-top { vertical-align: top; }

th.valign-bottom, td.valign-bottom { vertical-align: bottom; }

th.valign-middle, td.valign-middle { vertical-align: middle; }

table thead th, table tfoot th { font-weight: bold; }

tbody tr th { display: table-cell; line-height: 1.4; background: whitesmoke; }

tbody tr th, tbody tr th p, tfoot tr th, tfoot tr th p { color: #222222; font-weight: bold; }

p.tableblock > code:only-child { background: none; padding: 0; }

p.tableblock { font-size: 1em; }

td > div.verse { white-space: pre; }

ol { margin-left: 2.5em; }

ul li ol { margin-left: 1.5em; }

dl dd { margin-left: 1.125em; }

dl dd:last-child, dl dd:last-child > :last-child { margin-bottom: 0; }

ol > li p, ul > li p, ul dd, ol dd, .olist .olist, .ulist .ulist, .ulist .olist, .olist .ulist { margin-bottom: 0.625em; }

ul.unstyled, ol.unnumbered, ul.checklist, ul.none { list-style-type: none; }

ul.unstyled, ol.unnumbered, ul.checklist { margin-left: 0.625em; }

ul.checklist li > p:first-child > .fa-check-square-o:first-child, ul.checklist li > p:first-child > input[type="checkbox"]:first-child { margin-right: 0.25em; }

ul.checklist li > p:first-child > input[type="checkbox"]:first-child { position: relative; top: 1px; }

ul.inline { margin: 0 auto 0.625em auto; margin-left: -1.375em; margin-right: 0; padding: 0; list-style: none; overflow: hidden; }
ul.inline > li { list-style: none; float: left; margin-left: 1.375em; display: block; }
ul.inline > li > * { display: block; }

.unstyled dl dt { font-weight: normal; font-style: normal; }

ol.arabic { list-style-type: decimal; }

ol.decimal { list-style-type: decimal-leading-zero; }

ol.loweralpha { list-style-type: lower-alpha; }

ol.upperalpha { list-style-type: upper-alpha; }

ol.lowerroman { list-style-type: lower-roman; }

ol.upperroman { list-style-type: upper-roman; }

ol.lowergreek { list-style-type: lower-greek; }

.hdlist > table, .colist > table { border: 0; background: none; }
.hdlist > table > tbody > tr, .colist > table > tbody > tr { background: none; }

td.hdlist1 { padding-right: .75em; font-weight: bold; }

td.hdlist1, td.hdlist2 { vertical-align: top; }

.literalblock + .colist, .listingblock + .colist { margin-top: -0.5em; }

.colist > table tr > td:first-of-type { padding: 0 0.75em; line-height: 1; }
.colist > table tr > td:last-of-type { padding: 0.25em 0; }

.thumb, .th { line-height: 0; display: inline-block; border: solid 4px white; -webkit-box-shadow: 0 0 0 1px #dddddd; box-shadow: 0 0 0 1px #dddddd; }

.imageblock.left, .imageblock[style*="float: left"] { margin: 0.25em 0.625em 1.25em 0; }
.imageblock.right, .imageblock[style*="float: right"] { margin: 0.25em 0 1.25em 0.625em; }
.imageblock > .title { margin-bottom: 0; }
.imageblock.thumb, .imageblock.th { border-width: 6px; }
.imageblock.thumb > .title, .imageblock.th > .title { padding: 0 0.125em; }

.image.left, .image.right { margin-top: 0.25em; margin-bottom: 0.25em; display: inline-block; line-height: 0; }
.image.left { margin-right: 0.625em; }
.image.right { margin-left: 0.625em; }

a.image { text-decoration: none; }

span.footnote, span.footnoteref { vertical-align: super; font-size: 0.875em; }
span.footnote a, span.footnoteref a { text-decoration: none; }
span.footnote a:active, span.footnoteref a:active { text-decoration: underline; }

#footnotes { padding-top: 0.75em; padding-bottom: 0.75em; margin-bottom: 0.625em; }
#footnotes hr { width: 20%; min-width: 6.25em; margin: -.25em 0 .75em 0; border-width: 1px 0 0 0; }
#footnotes .footnote { padding: 0 0.375em; line-height: 1.3; font-size: 0.875em; margin-left: 1.2em; text-indent: -1.2em; margin-bottom: .2em; }
#footnotes .footnote a:first-of-type { font-weight: bold; text-decoration: none; }
#footnotes .footnote:last-of-type { margin-bottom: 0; }

#content #footnotes { margin-top: -0.625em; margin-bottom: 0; padding: 0.75em 0; }

.gist .file-data > table { border: 0; background: #fff; width: 100%; margin-bottom: 0; }
.gist .file-data > table td.line-data { width: 99%; }

div.unbreakable { page-break-inside: avoid; }

.big { font-size: larger; }

.small { font-size: smaller; }

.underline { text-decoration: underline; }

.overline { text-decoration: overline; }

.line-through { text-decoration: line-through; }

.aqua { color: #00bfbf; }

.aqua-background { background-color: #00fafa; }

.black { color: black; }

.black-background { background-color: black; }

.blue { color: #0000bf; }

.blue-background { background-color: #0000fa; }

.fuchsia { color: #bf00bf; }

.fuchsia-background { background-color: #fa00fa; }

.gray { color: #606060; }

.gray-background { background-color: #7d7d7d; }

.green { color: #006000; }

.green-background { background-color: #007d00; }

.lime { color: #00bf00; }

.lime-background { background-color: #00fa00; }

.maroon { color: #600000; }

.maroon-background { background-color: #7d0000; }

.navy { color: #000060; }

.navy-background { background-color: #00007d; }

.olive { color: #606000; }

.olive-background { background-color: #7d7d00; }

.purple { color: #600060; }

.purple-background { background-color: #7d007d; }

.red { color: #bf0000; }

.red-background { background-color: #fa0000; }

.silver { color: #909090; }

.silver-background { background-color: #bcbcbc; }

.teal { color: #006060; }

.teal-background { background-color: #007d7d; }

.white { color: #bfbfbf; }

.white-background { background-color: #fafafa; }

.yellow { color: #bfbf00; }

.yellow-background { background-color: #fafa00; }

span.icon > .fa { cursor: default; }

.admonitionblock td.icon [class^="fa icon-"] { font-size: 2.5em; text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.5); cursor: default; }
.admonitionblock td.icon .icon-note:before { content: "\f05a"; color: #207c98; }
.admonitionblock td.icon .icon-tip:before { content: "\f0eb"; text-shadow: 1px 1px 2px rgba(155, 155, 0, 0.8); color: #111; }
.admonitionblock td.icon .icon-warning:before { content: "\f071"; color: #bf6900; }
.admonitionblock td.icon .icon-caution:before { content: "\f06d"; color: #bf3400; }
.admonitionblock td.icon .icon-important:before { content: "\f06a"; color: #bf0000; }

.conum[data-value] { display: inline-block; color: #fff !important; background-color: #222222; -webkit-border-radius: 100px; border-radius: 100px; text-align: center; font-size: 0.75em; width: 1.67em; height: 1.67em; line-height: 1.67em; font-family: "Open Sans", "DejaVu Sans", sans-serif; font-style: normal; font-weight: bold; }
.conum[data-value] * { color: #fff !important; }
.conum[data-value] + b { display: none; }
.conum[data-value]:after { content: attr(data-value); }
pre .conum[data-value] { position: relative; top: -0.125em; }

b.conum * { color: inherit !important; }

.conum:not([data-value]):empty { display: none; }

.literalblock pre, .listingblock pre { background: #eeeeee; }

</style>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.2.0/css/font-awesome.min.css">
<style>.listingblock .pygments .hll { background-color: #ffffcc }
.listingblock .pygments  { background: #f8f8f8; }
.listingblock .pygments .tok-c { color: #408080; font-style: italic } /* Comment */
.listingblock .pygments .tok-err { border: 1px solid #FF0000 } /* Error */
.listingblock .pygments .tok-k { color: #008000; font-weight: bold } /* Keyword */
.listingblock .pygments .tok-o { color: #666666 } /* Operator */
.listingblock .pygments .tok-cm { color: #408080; font-style: italic } /* Comment.Multiline */
.listingblock .pygments .tok-cp { color: #BC7A00 } /* Comment.Preproc */
.listingblock .pygments .tok-c1 { color: #408080; font-style: italic } /* Comment.Single */
.listingblock .pygments .tok-cs { color: #408080; font-style: italic } /* Comment.Special */
.listingblock .pygments .tok-gd { color: #A00000 } /* Generic.Deleted */
.listingblock .pygments .tok-ge { font-style: italic } /* Generic.Emph */
.listingblock .pygments .tok-gr { color: #FF0000 } /* Generic.Error */
.listingblock .pygments .tok-gh { color: #000080; font-weight: bold } /* Generic.Heading */
.listingblock .pygments .tok-gi { color: #00A000 } /* Generic.Inserted */
.listingblock .pygments .tok-go { color: #888888 } /* Generic.Output */
.listingblock .pygments .tok-gp { color: #000080; font-weight: bold } /* Generic.Prompt */
.listingblock .pygments .tok-gs { font-weight: bold } /* Generic.Strong */
.listingblock .pygments .tok-gu { color: #800080; font-weight: bold } /* Generic.Subheading */
.listingblock .pygments .tok-gt { color: #0044DD } /* Generic.Traceback */
.listingblock .pygments .tok-kc { color: #008000; font-weight: bold } /* Keyword.Constant */
.listingblock .pygments .tok-kd { color: #008000; font-weight: bold } /* Keyword.Declaration */
.listingblock .pygments .tok-kn { color: #008000; font-weight: bold } /* Keyword.Namespace */
.listingblock .pygments .tok-kp { color: #008000 } /* Keyword.Pseudo */
.listingblock .pygments .tok-kr { color: #008000; font-weight: bold } /* Keyword.Reserved */
.listingblock .pygments .tok-kt { color: #B00040 } /* Keyword.Type */
.listingblock .pygments .tok-m { color: #666666 } /* Literal.Number */
.listingblock .pygments .tok-s { color: #BA2121 } /* Literal.String */
.listingblock .pygments .tok-na { color: #7D9029 } /* Name.Attribute */
.listingblock .pygments .tok-nb { color: #008000 } /* Name.Builtin */
.listingblock .pygments .tok-nc { color: #0000FF; font-weight: bold } /* Name.Class */
.listingblock .pygments .tok-no { color: #880000 } /* Name.Constant */
.listingblock .pygments .tok-nd { color: #AA22FF } /* Name.Decorator */
.listingblock .pygments .tok-ni { color: #999999; font-weight: bold } /* Name.Entity */
.listingblock .pygments .tok-ne { color: #D2413A; font-weight: bold } /* Name.Exception */
.listingblock .pygments .tok-nf { color: #0000FF } /* Name.Function */
.listingblock .pygments .tok-nl { color: #A0A000 } /* Name.Label */
.listingblock .pygments .tok-nn { color: #0000FF; font-weight: bold } /* Name.Namespace */
.listingblock .pygments .tok-nt { color: #008000; font-weight: bold } /* Name.Tag */
.listingblock .pygments .tok-nv { color: #19177C } /* Name.Variable */
.listingblock .pygments .tok-ow { color: #AA22FF; font-weight: bold } /* Operator.Word */
.listingblock .pygments .tok-w { color: #bbbbbb } /* Text.Whitespace */
.listingblock .pygments .tok-mb { color: #666666 } /* Literal.Number.Bin */
.listingblock .pygments .tok-mf { color: #666666 } /* Literal.Number.Float */
.listingblock .pygments .tok-mh { color: #666666 } /* Literal.Number.Hex */
.listingblock .pygments .tok-mi { color: #666666 } /* Literal.Number.Integer */
.listingblock .pygments .tok-mo { color: #666666 } /* Literal.Number.Oct */
.listingblock .pygments .tok-sb { color: #BA2121 } /* Literal.String.Backtick */
.listingblock .pygments .tok-sc { color: #BA2121 } /* Literal.String.Char */
.listingblock .pygments .tok-sd { color: #BA2121; font-style: italic } /* Literal.String.Doc */
.listingblock .pygments .tok-s2 { color: #BA2121 } /* Literal.String.Double */
.listingblock .pygments .tok-se { color: #BB6622; font-weight: bold } /* Literal.String.Escape */
.listingblock .pygments .tok-sh { color: #BA2121 } /* Literal.String.Heredoc */
.listingblock .pygments .tok-si { color: #BB6688; font-weight: bold } /* Literal.String.Interpol */
.listingblock .pygments .tok-sx { color: #008000 } /* Literal.String.Other */
.listingblock .pygments .tok-sr { color: #BB6688 } /* Literal.String.Regex */
.listingblock .pygments .tok-s1 { color: #BA2121 } /* Literal.String.Single */
.listingblock .pygments .tok-ss { color: #19177C } /* Literal.String.Symbol */
.listingblock .pygments .tok-bp { color: #008000 } /* Name.Builtin.Pseudo */
.listingblock .pygments .tok-vc { color: #19177C } /* Name.Variable.Class */
.listingblock .pygments .tok-vg { color: #19177C } /* Name.Variable.Global */
.listingblock .pygments .tok-vi { color: #19177C } /* Name.Variable.Instance */
.listingblock .pygments .tok-il { color: #666666 } /* Literal.Number.Integer.Long */
</style>
</head>
<body class="article toc2 toc-left">
<div id="header">
<h1>Servidores web y PaaS</h1>
<div class="details">
<span id="author" class="author">José Luis Zamora Sánchez</span><br>
<span id="email" class="email">&lt;<a href="mailto:joseluiszamora.jlz@gmail.com">joseluiszamora.jlz@gmail.com</a>&gt;</span><br>
</div>
<div id="toc" class="toc2">
<div id="toctitle">Índice de contenidos</div>
<ul class="sectlevel1">
<li><a href="#sesion03">3. Seguridad declarativa en WildFly  (JAAS)</a>
<ul class="sectlevel2">
<li><a href="#_implementaci%C3%B3n_de_la_seguridad_declarativa_en_wildfly">3.1. Implementación de la seguridad declarativa en WildFly</a>
<ul class="sectlevel3">
<li><a href="#_security_domain_y_login_modules">3.1.1. Security Domain y Login Modules</a></li>
<li><a href="#_activaci%C3%B3n_de_la_auditoria_de_seguridad">3.1.2. Activación de la auditoria de seguridad</a></li>
</ul>
</li>
<li><a href="#_administraci%C3%B3n_de_usuarios_y_roless_con_realmdirect">3.2. Administración de usuarios y roless con RealmDirect</a>
<ul class="sectlevel3">
<li><a href="#_realm_personalizado">3.2.1. Realm Personalizado</a></li>
<li><a href="#_configuraci%C3%B3n_de_un_login_module_basado_en_bd">3.2.2. Configuración de un login module basado en BD</a></li>
<li><a href="#_protecci%C3%B3n_de_las_password">3.2.3. Protección de las password</a></li>
<li><a href="#_integraci%C3%B3n_con_un_servidor_ldap_externo">3.2.4. Integración con un servidor LDAP Externo</a></li>
<li><a href="#_login_module_ldapextended">3.2.5. Login module LdapExtended</a></li>
</ul>
</li>
<li><a href="#_role_based_access_control_en_interfaces_de_administraci%C3%B3n">3.3. Role Based Access Control en interfaces de administración</a></li>
<li><a href="#_referencias">3.4. Referencias</a></li>
<li><a href="#_ejercicios_de_seguridad_declarativa_en_wildfly">3.5. Ejercicios de seguridad declarativa en WildFly</a>
<ul class="sectlevel3">
<li><a href="#_configuraci%C3%B3n_despliegue_y_alta_de_usuarios_en_wildfly_0_6_puntos">3.5.1. Configuración, despliegue y alta de usuarios en WildFly (0.6 puntos)</a></li>
<li><a href="#_gesti%C3%B3n_de_usuarios_en_base_de_datos_0_3_puntos">3.5.2. Gestión de usuarios en Base de datos (0.3 puntos)</a></li>
<li><a href="#_seguridad_integrada_con_ldap_corporativo_0_3_puntos">3.5.3. Seguridad integrada con LDAP corporativo (0.3 puntos)</a></li>
<li><a href="#_entrega">3.5.4. Entrega</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
</div>
<div id="content">
<div id="preamble">
<div class="sectionbody">
<div style="page-break-after: always;"></div>
</div>
</div>
<div class="sect1">
<h2 id="sesion03">3. Seguridad declarativa en WildFly  (JAAS)</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Desde el punto de vista del programador, no hay grandes diferencias a la hora de desarrollar y desplegar una aplicación en WildFly, GlassFish u otro servidor de aplicaciones,  pero es desde la perspectiva del administrador desde donde cada producto muestra una forma diferente de operar. Desde este punto de vista hemos querido cubrir los aspectos más generales del uso de WildFly. A partir de ahora nos centraremos en la seguridad.</p>
</div>
<div class="paragraph">
<p>En esta sesión hablaremos sobre seguridad en declarativa en WildFly y en la siguiente hablaremos de seguridad en la capa de transporte</p>
</div>
<div class="sect2">
<h3 id="_implementación_de_la_seguridad_declarativa_en_wildfly">3.1. Implementación de la seguridad declarativa en WildFly</h3>
<div class="paragraph">
<p>A estas alturas ya tenemos una idea general sobre seguridad declarativa, pero como repaso vamos a revisar una serie de conceptos que enlazan lo que ya hemos visto con algunos elementos nuevos:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Usuarios, grupos y roles</dt>
<dd>
<p>Son los elementos básicos a la hora de definir la seguridad de una aplicación Web y que ya hemos utilizado a lo largo del curso. En el caso concreto de WildFly, grupo y rol se tratan como un mismo concepto, como veremos más adelante.</p>
</dd>
<dt class="hdlist1">Políticas de seguridad</dt>
<dd>
<p>Son asociaciones entre recursos de WildFly y usuarios o roles. Es decir nos permiten definir exactamente quién puede acceder a un determinado recurso y qué operaciones puede hacer con él.</p>
</dd>
<dt class="hdlist1">Dominios de seguridad (Security Domains)</dt>
<dd>
<p>Son las configuraciones de autenticación, autorización, mapeo de seguridad y auditoría propias del servidor de aplicaciones. Implementan la especificación JAAS (Java Authentication and Authorization Service) de seguridad declarativa.</p>
</dd>
<dt class="hdlist1">Security Realms</dt>
<dd>
<p>Los Realm son los almacenes de usuarios, password y roles de las interfaces de administración del servidor (puntos de entrada) tanto desde el exterior como internamente en el propio servidor. Son componentes sobre los que se sustentan los security domain. De inicio WildFly cuenta con dos Security Realm:</p>
<div class="ulist">
<ul>
<li>
<p><strong>ManagementRealm</strong>: que sirve para securizar el acceso a las herramientas de administración (Autenticación)</p>
</li>
<li>
<p><strong>ApplicationRealm</strong>: que se utiliza para controlar el acceso a las aplicaciones desplegadas (Autenticación y Autorización).</p>
</li>
</ul>
</div>
</dd>
</dl>
</div>
<div class="paragraph">
<p>La configuración del Realm de administración es la siguiente:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"> <span class="tok-nt">&lt;security-realm</span> <span class="tok-na">name=</span><span class="tok-s">&quot;ManagementRealm&quot;</span><span class="tok-nt">&gt;</span>
	<span class="tok-nt">&lt;authentication&gt;</span>
		<span class="tok-nt">&lt;local</span> <span class="tok-na">default-user=</span><span class="tok-s">&quot;$local&quot;</span> <span class="tok-na">skip-group-loading=</span><span class="tok-s">&quot;true&quot;</span><span class="tok-nt">/&gt;</span>
		<span class="tok-nt">&lt;properties</span> <span class="tok-na">path=</span><span class="tok-s">&quot;mgmt-users.properties&quot;</span> <span class="tok-na">relative-to=</span><span class="tok-s">&quot;jboss.server.config.dir&quot;</span><span class="tok-nt">/&gt;</span>
	<span class="tok-nt">&lt;/authentication&gt;</span>
	<span class="tok-nt">&lt;authorization</span> <span class="tok-na">map-groups-to-roles=</span><span class="tok-s">&quot;false&quot;</span><span class="tok-nt">&gt;</span>
		<span class="tok-nt">&lt;properties</span> <span class="tok-na">path=</span><span class="tok-s">&quot;mgmt-groups.properties&quot;</span> <span class="tok-na">relative-to=</span><span class="tok-s">&quot;jboss.server.config.dir&quot;</span><span class="tok-nt">/&gt;</span>
	<span class="tok-nt">&lt;/authorization&gt;</span>
 <span class="tok-nt">&lt;/security-realm&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>El Realm distingue entre accesos desde la máquina local y accesos remotos. Para los primeros no se requiere password, por lo que la herramienta CLI ejecutada en local se conecta directamente, como ya vimos en la primera sesión. En el caso de utilizar CLI contra una instancia remota o acceder a través de la Consola Web sí que se nos pedirá usuario/password.</p>
</div>
<div class="paragraph">
<p>Los ficheros indicados <em>mgmt-users.properties</em> y <em>mgmt-groups.properties</em> contendrán los usuarios y grupos a los que pertenecen.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
El concepto de grupo sí existe para el  ManagementRealm ya que se pueden definir grupos de usuarios y posteriormente asociarlos con roles de administración RBAC (que veremos al final de la sesión).
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>El Realm de aplicaciones  tiene una configuración muy parecida:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><span class="tok-nt">&lt;security-realm</span> <span class="tok-na">name=</span><span class="tok-s">&quot;ApplicationRealm&quot;</span><span class="tok-nt">&gt;</span>
	<span class="tok-nt">&lt;authentication&gt;</span>
		<span class="tok-nt">&lt;local</span> <span class="tok-na">default-user=</span><span class="tok-s">&quot;$local&quot;</span> <span class="tok-na">allowed-users=</span><span class="tok-s">&quot;*&quot;</span> <span class="tok-na">skip-group-loading=</span><span class="tok-s">&quot;true&quot;</span><span class="tok-nt">/&gt;</span>
		<span class="tok-nt">&lt;properties</span> <span class="tok-na">path=</span><span class="tok-s">&quot;application-users.properties&quot;</span> <span class="tok-na">relative-to=</span><span class="tok-s">&quot;jboss.server.config.dir&quot;</span><span class="tok-nt">/&gt;</span>
	<span class="tok-nt">&lt;/authentication&gt;</span>
	<span class="tok-nt">&lt;authorization&gt;</span>
		<span class="tok-nt">&lt;properties</span> <span class="tok-na">path=</span><span class="tok-s">&quot;application-roles.properties&quot;</span> <span class="tok-na">relative-to=</span><span class="tok-s">&quot;jboss.server.config.dir&quot;</span><span class="tok-nt">/&gt;</span>
	<span class="tok-nt">&lt;/authorization&gt;</span>
<span class="tok-nt">&lt;/security-realm&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>También admite un usuario local de tipo invitado <em>$local</em> y codifica la información de usuarios en ficheros locales. En este caso sí está habilitado el mapeo entre usuarios y roles y se define un fichero específico para ello.</p>
</div>
<div class="paragraph">
<p>Los Security Realm se pueden utilizar tanto en conexiones provenientes del exterior como en conexiones internas. El ejemplo típico de esto último es el subsistema <em>Remoting</em> utilizado para acceder al contenedor de EJB&#8217;s, que por defecto está vinculado al Realm de aplicaciones:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><span class="tok-nt">&lt;subsystem</span> <span class="tok-na">xmlns=</span><span class="tok-s">&quot;urn:jboss:domain:remoting:2.0&quot;</span><span class="tok-nt">&gt;</span>
 <span class="tok-nt">&lt;endpoint</span> <span class="tok-na">worker=</span><span class="tok-s">&quot;default&quot;</span><span class="tok-nt">/&gt;</span>
 <span class="tok-nt">&lt;http-connector</span> <span class="tok-na">name=</span><span class="tok-s">&quot;http-remoting-connector&quot;</span> <span class="tok-na">connector-ref=</span><span class="tok-s">&quot;default&quot;</span> <span class="tok-na">security-realm=</span><span class="tok-s">&quot;ApplicationRealm&quot;</span><span class="tok-nt">/&gt;</span>
<span class="tok-nt">&lt;/subsystem&gt;</span></code></pre>
</div>
</div>
<div class="sect3">
<h4 id="_security_domain_y_login_modules">3.1.1. Security Domain y Login Modules</h4>
<div class="paragraph">
<p>Los <em>Security Domain</em> definen las políticas de autenticación y autorización del servidor de aplicaciones. Un security domain configura uno o varios <em>login modules</em> que implementan estas políticas. La configuración por defecto es la siguiente:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml">        <span class="tok-nt">&lt;subsystem</span> <span class="tok-na">xmlns=</span><span class="tok-s">&quot;urn:jboss:domain:security:1.2&quot;</span><span class="tok-nt">&gt;</span>
            <span class="tok-nt">&lt;security-domains&gt;</span>
                <span class="tok-nt">&lt;security-domain</span> <span class="tok-na">name=</span><span class="tok-s">&quot;other&quot;</span> <span class="tok-na">cache-type=</span><span class="tok-s">&quot;default&quot;</span><span class="tok-nt">&gt;</span>
                    <span class="tok-nt">&lt;authentication&gt;</span>
                        <span class="tok-nt">&lt;login-module</span> <span class="tok-na">code=</span><span class="tok-s">&quot;Remoting&quot;</span> <span class="tok-na">flag=</span><span class="tok-s">&quot;optional&quot;</span><span class="tok-nt">&gt;</span>
                            <span class="tok-nt">&lt;module-option</span> <span class="tok-na">name=</span><span class="tok-s">&quot;password-stacking&quot;</span> <span class="tok-na">value=</span><span class="tok-s">&quot;useFirstPass&quot;</span><span class="tok-nt">/&gt;</span>
                        <span class="tok-nt">&lt;/login-module&gt;</span>
                        <span class="tok-nt">&lt;login-module</span> <span class="tok-na">code=</span><span class="tok-s">&quot;RealmDirect&quot;</span> <span class="tok-na">flag=</span><span class="tok-s">&quot;required&quot;</span><span class="tok-nt">&gt;</span>
                            <span class="tok-nt">&lt;module-option</span> <span class="tok-na">name=</span><span class="tok-s">&quot;password-stacking&quot;</span> <span class="tok-na">value=</span><span class="tok-s">&quot;useFirstPass&quot;</span><span class="tok-nt">/&gt;</span>
                        <span class="tok-nt">&lt;/login-module&gt;</span>
                    <span class="tok-nt">&lt;/authentication&gt;</span>
                <span class="tok-nt">&lt;/security-domain&gt;</span>
                <span class="tok-nt">&lt;security-domain</span> <span class="tok-na">name=</span><span class="tok-s">&quot;jboss-web-policy&quot;</span> <span class="tok-na">cache-type=</span><span class="tok-s">&quot;default&quot;</span><span class="tok-nt">&gt;</span>
                    <span class="tok-nt">&lt;authorization&gt;</span>
                        <span class="tok-nt">&lt;policy-module</span> <span class="tok-na">code=</span><span class="tok-s">&quot;Delegating&quot;</span> <span class="tok-na">flag=</span><span class="tok-s">&quot;required&quot;</span><span class="tok-nt">/&gt;</span>
                    <span class="tok-nt">&lt;/authorization&gt;</span>
                <span class="tok-nt">&lt;/security-domain&gt;</span>
                <span class="tok-nt">&lt;security-domain</span> <span class="tok-na">name=</span><span class="tok-s">&quot;jboss-ejb-policy&quot;</span> <span class="tok-na">cache-type=</span><span class="tok-s">&quot;default&quot;</span><span class="tok-nt">&gt;</span>
                    <span class="tok-nt">&lt;authorization&gt;</span>
                        <span class="tok-nt">&lt;policy-module</span> <span class="tok-na">code=</span><span class="tok-s">&quot;Delegating&quot;</span> <span class="tok-na">flag=</span><span class="tok-s">&quot;required&quot;</span><span class="tok-nt">/&gt;</span>
                    <span class="tok-nt">&lt;/authorization&gt;</span>
                <span class="tok-nt">&lt;/security-domain&gt;</span>
            <span class="tok-nt">&lt;/security-domains&gt;</span>
        <span class="tok-nt">&lt;/subsystem&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Además del Dominio <em>other</em> tenemos los dominios <em>jboss-ejb-policy</em> y <em>jboss-web-policy</em> que componen los módulos de autorización predefinidos, pero el security domain que nos interesa es el denominado <em>other</em>.</p>
</div>
<div class="paragraph">
<p>Other es el security domain por defecto en la instalación, preparado para trabajar con el <em>Application Realm</em> y en él podemos identificar dos login modules distintos:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Remoting</dt>
<dd>
<p>Utilizado internamente cuando las peticiones de autenticación se reciben a través del protocolo Remoting (habitualmente llamadas a un EJB).</p>
</dd>
<dt class="hdlist1">RealmDirect</dt>
<dd>
<p>Utilizado en el resto de peticiones (por ejemplo, al acceder a una aplicación Web). Este módulo tiene la particularidad delegar en un Realm la tarea de autenticación, que por defecto será el <em>ApplicationRealm</em>.</p>
</dd>
</dl>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="images/paas03/jboss-security.png" alt="jboss security" width="50%">
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
El Realm que utilizará RealmDirect se puede especificar mediante el module-option <em>realm</em>.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Por defecto, los login modules se ejecutarán en el orden en el que se hayan definido. Adicionalmente existe un parámetro denominado <em>flag</em> en cada login module, que nos permitirá definir cómo tratar cada resultado parcial.</p>
</div>
<div class="paragraph">
<p>Puede tener los siguientes valores:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Required</dt>
<dd>
<p>El usuario debe validarse con éxito necesariamente. Independientemente del resultado intentará validarse con el resto de login modules.</p>
</dd>
<dt class="hdlist1">Requisite</dt>
<dd>
<p>El usuario debe validarse con éxito necesariamente. Una vez validado, intentará validarse con el resto de login modules. Las siguientes validaciones podrán fallar pero el usuario seguirá autenticado (excepto si tienen el atributo de requerido). Si falla la validación, termina el proceso de autenticación.</p>
</dd>
<dt class="hdlist1">Sufficient</dt>
<dd>
<p>El usuario intentará validarse, si falla lo intentará con el resto de login modules, pero si es autenticado, la validación termina en ese punto.</p>
</dd>
<dt class="hdlist1">Optional</dt>
<dd>
<p>El usuario intentará validarse, aunque no necesariamente tiene porqué tener éxito. Si todos los login modules están configurados como optional, necesariamente tendrá que validarse con al menos uno de ellos.</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>El módulo RealmDirect tiene una única opción, el <em>password-stacking</em> que debe ser utilizado con el valor <em>useFirstPass</em> si se utilizan varios login modules.</p>
</div>
<div class="paragraph">
<p>En esta sesión trabajaremos con tres login modules:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>RealmDirect</strong> almacena usuarios y roles en ficheros. Estos ficheros son los definidos dentro del ApplicationRealm.</p>
</li>
<li>
<p><strong>Database</strong> almacena usuarios y roles en una base de datos relacional.</p>
</li>
<li>
<p><strong>LDAP</strong> almacena usuarios y roles en un servidor LDAP como OpenLDAP.</p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
La lista completa de login modules la podéis encontrar en esta página: <a href="https://docs.jboss.org/author/display/AS71/Security+subsystem+configuration" class="bare">https://docs.jboss.org/author/display/AS71/Security+subsystem+configuration</a>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_activación_de_la_auditoria_de_seguridad">3.1.2. Activación de la auditoria de seguridad</h4>
<div class="paragraph">
<p>En la fase de construcción resulta muy útil  habilitar la auditoría de seguridad antes de comenzar a trabajar con seguridad declarativa. El log normal de Wildfly no suele proporcionar información significativa cuando intentamos acceder a una aplicación securizada y por la causa que sea el servidor no considera válidas nuestras credenciales.</p>
</div>
<div class="paragraph">
<p>La forma de hacerlo en WildFly es un tanto enrevesada pues hay que añadir la siguiente información al subsistema de <strong>logging</strong>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><span class="tok-nt">&lt;subsystem</span> <span class="tok-na">xmlns=</span><span class="tok-s">&quot;urn:jboss:domain:logging:2.0&quot;</span><span class="tok-nt">&gt;</span>
			...
            <span class="tok-nt">&lt;periodic-rotating-file-handler</span> <span class="tok-na">name=</span><span class="tok-s">&quot;AUDIT&quot;</span> <span class="tok-na">autoflush=</span><span class="tok-s">&quot;true&quot;</span><span class="tok-nt">&gt;</span>
                <span class="tok-nt">&lt;level</span> <span class="tok-na">name=</span><span class="tok-s">&quot;TRACE&quot;</span><span class="tok-nt">/&gt;</span>
                <span class="tok-nt">&lt;formatter&gt;</span>
                    <span class="tok-nt">&lt;pattern-formatter</span> <span class="tok-na">pattern=</span><span class="tok-s">&quot;%d{HH:mm:ss,SSS} %-5p [%c] (%t) %s%E%n&quot;</span><span class="tok-nt">/&gt;</span>
                <span class="tok-nt">&lt;/formatter&gt;</span>
                <span class="tok-nt">&lt;file</span> <span class="tok-na">relative-to=</span><span class="tok-s">&quot;jboss.server.log.dir&quot;</span> <span class="tok-na">path=</span><span class="tok-s">&quot;audit.log&quot;</span><span class="tok-nt">/&gt;</span>
                <span class="tok-nt">&lt;suffix</span> <span class="tok-na">value=</span><span class="tok-s">&quot;.yyyy-MM-dd&quot;</span><span class="tok-nt">/&gt;</span>
                <span class="tok-nt">&lt;append</span> <span class="tok-na">value=</span><span class="tok-s">&quot;true&quot;</span><span class="tok-nt">/&gt;</span>
            <span class="tok-nt">&lt;/periodic-rotating-file-handler&gt;</span>
            <span class="tok-nt">&lt;logger</span> <span class="tok-na">category=</span><span class="tok-s">&quot;org.jboss.security&quot;</span><span class="tok-nt">&gt;</span>
                <span class="tok-nt">&lt;level</span> <span class="tok-na">name=</span><span class="tok-s">&quot;TRACE&quot;</span><span class="tok-nt">/&gt;</span>
                <span class="tok-nt">&lt;handlers&gt;</span>
                    <span class="tok-nt">&lt;handler</span> <span class="tok-na">name=</span><span class="tok-s">&quot;AUDIT&quot;</span><span class="tok-nt">/&gt;</span>
                <span class="tok-nt">&lt;/handlers&gt;</span>
            <span class="tok-nt">&lt;/logger&gt;</span>
			...</code></pre>
</div>
</div>
<div class="paragraph">
<p>Con este cambio crearemos un nuevo fichero de log, denominado <em>audit.log</em> en la carpeta de logs del servidor con toda la información de la negociación de la seguridad declarativa.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_administración_de_usuarios_y_roless_con_realmdirect">3.2. Administración de usuarios y roless con RealmDirect</h3>
<div class="paragraph">
<p>La forma de dar de alta o editar usuarios ya la conocemos y es a través del script <em>add-user.sh</em> especificando el realm de Aplicaciones. Desde este script se permite asociar un usuario a uno o varios grupos (roles):</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="text">What groups do you want this user to belong to? (Please enter a comma separated list, or leave blank for none)[  ]: usuarios</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
add-user.sh da de alta los usuarios indistintamente en la modalidad de standalone y domain.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Los usuarios se almacenarán con el siguiente formato:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="text">username=HEX(MD5(username &#39;:&#39; realm &#39;:&#39; password))</code></pre>
</div>
</div>
<div class="paragraph">
<p>Ejemplo:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="text">experto=579f4faae456fd4b742f89e35fa935e2
admin=c22052286cd5d72239a90fe193737253</code></pre>
</div>
</div>
<div class="paragraph">
<p>Los roles se especificarán como texto plano en el fichero <em>application-roles.properties</em>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="console"><span class="tok-go">experto=Users</span>
<span class="tok-go">admin=Administrators</span></code></pre>
</div>
</div>
<div class="sect3">
<h4 id="_realm_personalizado">3.2.1. Realm Personalizado</h4>
<div class="paragraph">
<p>Como comentamos, RealmDirect utiliza el ApplicationRealm como Realm por defecto a la hora de autenticar usuarios en ficheros. Es perfectamente posible crear un nuevo Realm con una ubicación de ficheros distinta y especificar dicho Realm como el Realm a utilizar por Realm Direct en nuestro security domain. De esta forma podríamos tener separados los usuarios de nuestra aplicación, del común del servidor. La limitación es que el script add-user no da facilidades para trabajar con distintos Realm por lo que es necesario dar de alta manualmente los usuarios (encriptación(hash) de password incluida).</p>
</div>
</div>
<div class="sect3">
<h4 id="_configuración_de_un_login_module_basado_en_bd">3.2.2. Configuración de un login module basado en BD</h4>
<div class="paragraph">
<p>Vamos a agregar al dominio <em>other</em> el login module <em>Database</em>, apoyado en una base de datos externa siguiendo los siguientes pasos:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Crear una base de datos MySQL , denominada "seguridad" con las siguientes tablas</p>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="sql"><span class="tok-k">CREATE</span> <span class="tok-k">TABLE</span> <span class="tok-n">USERS</span> <span class="tok-p">(</span>
    <span class="tok-n">principal_id</span> <span class="tok-nb">VARCHAR</span><span class="tok-p">(</span><span class="tok-mi">64</span><span class="tok-p">)</span> <span class="tok-k">primary</span> <span class="tok-k">key</span><span class="tok-p">,</span>
	<span class="tok-n">password</span> <span class="tok-nb">VARCHAR</span><span class="tok-p">(</span><span class="tok-mi">64</span><span class="tok-p">));</span>
<span class="tok-p">;</span>

<span class="tok-k">CREATE</span> <span class="tok-k">TABLE</span> <span class="tok-n">ROLES</span> <span class="tok-p">(</span>
    <span class="tok-n">principal_id</span> <span class="tok-nb">VARCHAR</span><span class="tok-p">(</span><span class="tok-mi">64</span><span class="tok-p">)</span> <span class="tok-k">primary</span> <span class="tok-k">key</span><span class="tok-p">,</span>
	<span class="tok-n">user_role</span> <span class="tok-nb">VARCHAR</span><span class="tok-p">(</span><span class="tok-mi">64</span><span class="tok-p">),</span>
<span class="tok-p">;</span>

<span class="tok-k">ALTER</span> <span class="tok-k">TABLE</span> <span class="tok-n">ROLES</span>
   <span class="tok-k">ADD</span> <span class="tok-k">CONSTRAINT</span> <span class="tok-n">FK1_PRINCIPLES</span>
   <span class="tok-k">FOREIGN</span> <span class="tok-k">KEY</span> <span class="tok-p">(</span> <span class="tok-n">principal_id</span><span class="tok-p">)</span>
   <span class="tok-k">REFERENCES</span> <span class="tok-n">USERS</span> <span class="tok-p">(</span><span class="tok-n">principal_id</span><span class="tok-p">)</span>
   <span class="tok-k">ON</span> <span class="tok-k">DELETE</span> <span class="tok-k">CASCADE</span>
<span class="tok-p">;</span></code></pre>
</div>
</div>
</li>
<li>
<p>Definir un usuario específico para la conexión a la BD seguridad: <em>usuSeg</em>, clave <em>usuSeg</em>. Esto lo podéis hacer desde la herramienta MySQL Workbench que tenéis en Linux.</p>
</li>
<li>
<p>Crear un origen de datos en WildFly, de nombre <em>java:jboss/datasources/seguridad</em>, que acceda a la BD que acabamos de crear.</p>
</li>
<li>
<p>Crear un nuevo security domain que utilice el login module <em>Database</em>:</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="console"><span class="tok-gp">#</span> Crear un nuevo security domain con seguridad basada en base de datos
<span class="tok-go">batch</span>

<span class="tok-go">connect</span>

<span class="tok-gp">#</span> Configure the security domain
<span class="tok-go">/subsystem=security/security-domain=seguridad/:add(cache-type=default)</span>
<span class="tok-go">/subsystem=security/security-domain=seguridad/authentication=classic:add(login-modules=[{&quot;code&quot;=&gt;&quot;Database&quot;, &quot;flag&quot;=&gt;&quot;required&quot;, &quot;module-options&quot;=&gt;[(&quot;dsJndiName&quot;=&gt;&quot;java:jboss/datasources/seguridad&quot;),(&quot;principalsQuery&quot;=&gt;&quot;SELECT PASSWORD FROM USERS WHERE principal_id = ?&quot;), (&quot;rolesQuery&quot;=&gt;&quot;SELECT user_role, &#39;Roles&#39; FROM ROLES where principal_id = ?&quot;)]}])</span>

<span class="tok-gp">#</span> Run the batch commands
<span class="tok-go">run-batch</span>

<span class="tok-gp">#</span> Reload the server configuration
<span class="tok-go">:reload</span></code></pre>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="title">Grupos</div>
WildFly no introduce el concepto de grupos de usuarios pero la implementación del Login Module Database es muy flexible, por lo que se puede modelar una tabla de grupos, asociar usuarios a grupos y permitir asociar roles a los grupos. Después de esto, bastaría con modificar las queries de recuperación de roles.
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_protección_de_las_password">3.2.3. Protección de las password</h4>
<div class="paragraph">
<p>Nuevamente WildFly no nos da un sistema directo para proteger las constraseñas pero si nos permite especificar un mecanismo de encriptación/hash y encargarnos nosotros mismos de su gestión. Concretamente hay que añadir las siguientes opciones al login module:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><span class="tok-nt">&lt;module-option</span> <span class="tok-na">name=</span><span class="tok-s">&quot;password-stacking&quot;</span> <span class="tok-na">value=</span><span class="tok-s">&quot;useFirstPass&quot;</span><span class="tok-nt">/&gt;</span>
<span class="tok-nt">&lt;module-option</span> <span class="tok-na">name=</span><span class="tok-s">&quot;hashAlgorithm&quot;</span> <span class="tok-na">value=</span><span class="tok-s">&quot;MD5&quot;</span><span class="tok-nt">/&gt;</span>
<span class="tok-nt">&lt;module-option</span> <span class="tok-na">name=</span><span class="tok-s">&quot;hashEncoding&quot;</span> <span class="tok-na">value=</span><span class="tok-s">&quot;hex&quot;</span><span class="tok-nt">/&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Con estas opciones se especifica el algoritmo para calcular el hash a partir de la contraseña, así como la forma de convertir la cadena binaria resultande en una representación en formato de texto (base64).</p>
</div>
<div class="paragraph">
<p>En la siguiente dirección tenéis una utilidad para calcular estos hash, es importante que el hash generado se introduzca en minúsculas porque la validación es case sensitive: <a href="http://md5-hash-online.waraxe.us/" class="bare">http://md5-hash-online.waraxe.us/</a></p>
</div>
<div class="sect4">
<h5 id="_aplicación_web_de_ejemplo">Aplicación Web de Ejemplo</h5>
<div class="paragraph">
<p>Vamos a construir una sencilla aplicación Web que aproveche la configuración de seguridad que hemos preparado hasta ahora. Esta aplicación Web contará con un único servlet que mostrará la lista de usuarios de la BD seguridad.</p>
</div>
<div class="paragraph">
<p>Para ello definiremos un servlet y lo protegeremos de tal modo que sólo los usuarios y administradores puedan acceder a él. Utilizaremos la autenticación Basic para simplificar.</p>
</div>
<div class="paragraph">
<p>Lo construiremos en los siguientes pasos:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Configurar el nuevo dominio "seguridad" en IntelliJ. Crear un nuevo proyecto Web, mediante Maven.</p>
</li>
<li>
<p>Crear un servlet que responda a la ruta /listado, y que devuelva la consulta:</p>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span class="tok-nd">@WebServlet</span><span class="tok-o">(</span><span class="tok-s">&quot;/protegido/ConsultaServlet&quot;</span><span class="tok-o">)</span>
<span class="tok-nd">@ServletSecurity</span><span class="tok-o">(</span><span class="tok-nd">@HttpConstraint</span><span class="tok-o">(</span><span class="tok-n">rolesAllowed</span> <span class="tok-o">=</span> <span class="tok-o">{</span> <span class="tok-s">&quot;rol_usuario&quot;</span><span class="tok-o">,</span><span class="tok-s">&quot;rol_administrador&quot;</span> <span class="tok-o">}))</span>
<span class="tok-kd">public</span> <span class="tok-kd">class</span> <span class="tok-nc">ConsultaServlet</span> <span class="tok-kd">extends</span> <span class="tok-n">HttpServlet</span> <span class="tok-o">{</span>

    <span class="tok-nd">@Resource</span><span class="tok-o">(</span><span class="tok-n">mappedName</span> <span class="tok-o">=</span> <span class="tok-s">&quot;java:jboss/datasources/seguridad&quot;</span><span class="tok-o">)</span>
    <span class="tok-n">DataSource</span> <span class="tok-n">segDS</span><span class="tok-o">;</span>

    <span class="tok-kd">protected</span> <span class="tok-kt">void</span> <span class="tok-nf">processRequest</span><span class="tok-o">(</span><span class="tok-n">HttpServletRequest</span> <span class="tok-n">request</span><span class="tok-o">,</span>
                                  <span class="tok-n">HttpServletResponse</span> <span class="tok-n">response</span><span class="tok-o">)</span>
            <span class="tok-kd">throws</span> <span class="tok-n">ServletException</span><span class="tok-o">,</span> <span class="tok-n">IOException</span> <span class="tok-o">{</span>

        <span class="tok-n">String</span> <span class="tok-n">query</span> <span class="tok-o">=</span> <span class="tok-s">&quot;SELECT * FROM USERS&quot;</span><span class="tok-o">;</span>
        <span class="tok-n">Connection</span> <span class="tok-n">conn</span> <span class="tok-o">=</span> <span class="tok-kc">null</span><span class="tok-o">;</span>
        <span class="tok-n">Statement</span> <span class="tok-n">stmt</span><span class="tok-o">;</span>

        <span class="tok-n">response</span><span class="tok-o">.</span><span class="tok-na">setContentType</span><span class="tok-o">(</span><span class="tok-s">&quot;text/html;charset=UTF-8&quot;</span><span class="tok-o">);</span>

        <span class="tok-n">PrintWriter</span> <span class="tok-n">out</span> <span class="tok-o">=</span> <span class="tok-n">response</span><span class="tok-o">.</span><span class="tok-na">getWriter</span><span class="tok-o">();</span>
        <span class="tok-k">try</span> <span class="tok-o">{</span>

            <span class="tok-n">conn</span> <span class="tok-o">=</span> <span class="tok-n">segDS</span><span class="tok-o">.</span><span class="tok-na">getConnection</span><span class="tok-o">();</span>
            <span class="tok-n">stmt</span> <span class="tok-o">=</span> <span class="tok-n">conn</span><span class="tok-o">.</span><span class="tok-na">createStatement</span><span class="tok-o">();</span>


            <span class="tok-n">out</span><span class="tok-o">.</span><span class="tok-na">println</span><span class="tok-o">(</span><span class="tok-s">&quot;&lt;html&gt;&quot;</span><span class="tok-o">);</span>
            <span class="tok-n">out</span><span class="tok-o">.</span><span class="tok-na">println</span><span class="tok-o">(</span><span class="tok-s">&quot;&lt;head&gt;&quot;</span><span class="tok-o">);</span>
            <span class="tok-n">out</span><span class="tok-o">.</span><span class="tok-na">println</span><span class="tok-o">(</span><span class="tok-s">&quot;&lt;title&gt;Servlet listado&lt;/title&gt;&quot;</span><span class="tok-o">);</span>
            <span class="tok-n">out</span><span class="tok-o">.</span><span class="tok-na">println</span><span class="tok-o">(</span><span class="tok-s">&quot;&lt;/head&gt;&quot;</span><span class="tok-o">);</span>
            <span class="tok-n">out</span><span class="tok-o">.</span><span class="tok-na">println</span><span class="tok-o">(</span><span class="tok-s">&quot;&lt;body&gt;&quot;</span><span class="tok-o">);</span>

            <span class="tok-n">out</span><span class="tok-o">.</span><span class="tok-na">println</span><span class="tok-o">(</span><span class="tok-s">&quot;Lista de usuarios:&lt;BR/&gt;&quot;</span><span class="tok-o">);</span>

            <span class="tok-n">ResultSet</span> <span class="tok-n">rs</span> <span class="tok-o">=</span> <span class="tok-n">stmt</span><span class="tok-o">.</span><span class="tok-na">executeQuery</span><span class="tok-o">(</span><span class="tok-n">query</span><span class="tok-o">);</span>
            <span class="tok-k">while</span><span class="tok-o">(</span><span class="tok-n">rs</span><span class="tok-o">.</span><span class="tok-na">next</span><span class="tok-o">())</span>
            <span class="tok-o">{</span>
                <span class="tok-n">out</span><span class="tok-o">.</span><span class="tok-na">println</span><span class="tok-o">(</span><span class="tok-n">rs</span><span class="tok-o">.</span><span class="tok-na">getString</span><span class="tok-o">(</span><span class="tok-s">&quot;principal_id&quot;</span><span class="tok-o">)+</span><span class="tok-s">&quot;/&quot;</span><span class="tok-o">+</span><span class="tok-n">rs</span><span class="tok-o">.</span><span class="tok-na">getString</span><span class="tok-o">(</span><span class="tok-s">&quot;password&quot;</span><span class="tok-o">)+</span><span class="tok-s">&quot;&lt;br/&gt;&quot;</span><span class="tok-o">);</span>
            <span class="tok-o">}</span>

            <span class="tok-n">out</span><span class="tok-o">.</span><span class="tok-na">println</span><span class="tok-o">(</span><span class="tok-s">&quot;&lt;/body&gt;&quot;</span><span class="tok-o">);</span>
            <span class="tok-n">out</span><span class="tok-o">.</span><span class="tok-na">println</span><span class="tok-o">(</span><span class="tok-s">&quot;&lt;/html&gt;&quot;</span><span class="tok-o">);</span>
        <span class="tok-o">}</span> <span class="tok-k">catch</span> <span class="tok-o">(</span><span class="tok-n">Exception</span> <span class="tok-n">e</span><span class="tok-o">)</span> <span class="tok-o">{</span>
            <span class="tok-n">out</span><span class="tok-o">.</span><span class="tok-na">println</span><span class="tok-o">(</span><span class="tok-n">e</span><span class="tok-o">.</span><span class="tok-na">getMessage</span><span class="tok-o">());</span>

        <span class="tok-o">}</span> <span class="tok-k">finally</span> <span class="tok-o">{</span>
            <span class="tok-k">try</span> <span class="tok-o">{</span>
                <span class="tok-n">out</span><span class="tok-o">.</span><span class="tok-na">close</span><span class="tok-o">();</span>
                <span class="tok-k">if</span><span class="tok-o">(</span><span class="tok-n">conn</span><span class="tok-o">!=</span><span class="tok-kc">null</span><span class="tok-o">)</span>
                    <span class="tok-n">conn</span><span class="tok-o">.</span><span class="tok-na">close</span><span class="tok-o">();</span>
            <span class="tok-o">}</span> <span class="tok-k">catch</span> <span class="tok-o">(</span><span class="tok-n">SQLException</span> <span class="tok-n">ex</span><span class="tok-o">)</span> <span class="tok-o">{</span>
                <span class="tok-n">Logger</span><span class="tok-o">.</span><span class="tok-na">getLogger</span><span class="tok-o">(</span><span class="tok-n">ConsultaServlet</span><span class="tok-o">.</span><span class="tok-na">class</span><span class="tok-o">.</span><span class="tok-na">getName</span><span class="tok-o">()).</span><span class="tok-na">log</span><span class="tok-o">(</span><span class="tok-n">Level</span><span class="tok-o">.</span><span class="tok-na">SEVERE</span><span class="tok-o">,</span> <span class="tok-kc">null</span><span class="tok-o">,</span> <span class="tok-n">ex</span><span class="tok-o">);</span>
            <span class="tok-o">}</span>
        <span class="tok-o">}</span>
    <span class="tok-o">}</span></code></pre>
</div>
</div>
</li>
<li>
<p>Configurar los descriptores de despliegue. El archivo web.xml tendrá un aspecto parecido a este:</p>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"> <span class="tok-nt">&lt;session-config&gt;</span>
  <span class="tok-nt">&lt;session-timeout&gt;</span>30<span class="tok-nt">&lt;/session-timeout&gt;</span>
  <span class="tok-nt">&lt;/session-config&gt;</span>
 <span class="tok-nt">&lt;welcome-file-list&gt;</span>
  <span class="tok-nt">&lt;welcome-file&gt;</span>index.jsp<span class="tok-nt">&lt;/welcome-file&gt;</span>
  <span class="tok-nt">&lt;/welcome-file-list&gt;</span>
 <span class="tok-nt">&lt;login-config&gt;</span>
  <span class="tok-nt">&lt;auth-method&gt;</span>BASIC<span class="tok-nt">&lt;/auth-method&gt;</span>
  <span class="tok-nt">&lt;realm-name&gt;</span>Mi dominio de seguridad<span class="tok-nt">&lt;/realm-name&gt;</span>
  <span class="tok-nt">&lt;/login-config&gt;</span>
 <span class="tok-nt">&lt;security-role&gt;</span>
  <span class="tok-nt">&lt;description</span> <span class="tok-nt">/&gt;</span>
  <span class="tok-nt">&lt;role-name&gt;</span>rol_usuario<span class="tok-nt">&lt;/role-name&gt;</span>
  <span class="tok-nt">&lt;/security-role&gt;</span>
 <span class="tok-nt">&lt;security-role&gt;</span>
  <span class="tok-nt">&lt;description</span> <span class="tok-nt">/&gt;</span>
  <span class="tok-nt">&lt;role-name&gt;</span>rol_administrador<span class="tok-nt">&lt;/role-name&gt;</span>
  <span class="tok-nt">&lt;/security-role&gt;</span>
  <span class="tok-nt">&lt;/web-app&gt;</span></code></pre>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
WildFly en su versión 8.10 da algunos problemas a la hora de combinar diferentes tipos de restricciones de integridad sobre un mismo recurso. Como recomendación intentad siempre que sea posible, no declarar más de una restricción sobre un mismo recurso de la aplicación.
</td>
</tr>
</table>
</div>
</li>
<li>
<p>Añadiremos el descriptor específico de WildFly <em>jboss-web.xml</em>, en la carpeta WEB-INF:</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><span class="tok-nt">&lt;jboss-web</span> <span class="tok-na">xmlns=</span><span class="tok-s">&quot;http://www.jboss.com/xml/ns/javaee&quot;</span>
           <span class="tok-na">xmlns:xsi=</span><span class="tok-s">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span>
           <span class="tok-na">xsi:schemaLocation=</span><span class="tok-s">&quot;http://www.jboss.com/xml/ns/javaee http://www.jboss.org/schema/jbossas/jboss-web_8_0.xsd&quot;</span>
           <span class="tok-na">version=</span><span class="tok-s">&quot;8.0&quot;</span><span class="tok-nt">&gt;</span>

    <span class="tok-nt">&lt;context-root&gt;</span>/intranet<span class="tok-nt">&lt;/context-root&gt;</span>
    <span class="tok-nt">&lt;security-domain&gt;</span>
        seguridad
    <span class="tok-nt">&lt;/security-domain&gt;</span>
<span class="tok-nt">&lt;/jboss-web&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>En el estamos indicando tanto el contexto raiz de la aplicación como el security domain contra el que vamos a autenticarnos.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_integración_con_un_servidor_ldap_externo">3.2.4. Integración con un servidor LDAP Externo</h4>
<div class="paragraph">
<p>LDAP ("Lightweight Directory Acces Protocol") es un protocolo de tipo cliente-servidor para acceder a un servicio de directorio.</p>
</div>
<div class="paragraph">
<p>Cada entrada en el directorio LDAP describe un objeto (por ejemplo: una persona, un recurso de red, una organización) y tiene un único identificador llamado Nombre Distinguido (DN, Distinguished Name). La entrada consiste de una colección de atributos (por ejemplo una persona podría tener apellido, organización, e-mail). Para encontrar las entradas hay que navegar a través del Árbol de Información de Directorio (DIT, Directory Information Tree). En la raíz del árbol se encuentra "el mundo", el cual esta subdividido en el siguiente nivel en países, y en el siguiente en organizaciones. Dentro de las organizaciones se almacenan información de gente, recursos, etc.</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="images/paas03/ldap1.png" alt="ldap1" width="100%">
</div>
</div>
<div class="paragraph">
<p>Es habitual en empresas de cierto tamaño el tener un servidor donde se almacena la información corporativa de directorio. Los servidores de aplicaciones suelen integrar componentes que permiten acceder a la información de usuarios y roles que resida en dicho servidor LDAP.</p>
</div>
<div class="paragraph">
<p>En nuestra máquina virtual, podemos simular este directorio corporativo instalando OpenLDAP y cargando un directorio de pruebas. Estos serán los pasos a seguir:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Instalar el servidor SLDAPd ejecutando los comandos:</p>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="console"><span class="tok-go">sudo apt-get update</span>
<span class="tok-go">sudo apt-get -y install slapd ldap-utils</span></code></pre>
</div>
</div>
</li>
<li>
<p>Configuración básica del directorio:</p>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="console"><span class="tok-go">sudo dpkg-reconfigure slapd</span></code></pre>
</div>
</div>
<table class="tableblock frame-all grid-all" style="width: 70%;">
<colgroup>
<col style="width: 75%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Preguntas</th>
<th class="tableblock halign-left valign-top">Respuestas</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Omit OpenLDAP server configuration</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">DNS domain name</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ua.es</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Organization name</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">jtech</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Administrator password</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">expertojavajs</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Database backend to use</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">HDB</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Do you want the database to be purged</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">yes</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Move old database</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">yes</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Allow LDAPv2 protocol</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">no</p></td>
</tr>
</tbody>
</table>
</li>
<li>
<p>Configurar el nuevo dominio LDAP mediante un script en lenguaje LDIF:</p>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="console"><span class="tok-gp">#</span>grupo de usuarios
<span class="tok-go">dn: ou=users,dc=ua,dc=es</span>
<span class="tok-go">objectClass: organizationalUnit</span>
<span class="tok-go">ou: users</span>

<span class="tok-gp">#</span>grupo de roles
<span class="tok-go">dn: ou=roles,dc=ua,dc=es</span>
<span class="tok-go">objectClass: organizationalUnit</span>
<span class="tok-go">ou: roles</span>

<span class="tok-gp">#</span>alumno1
<span class="tok-go">dn: uid=alu1,ou=users,dc=ua,dc=es</span>
<span class="tok-go">objectclass: top</span>
<span class="tok-go">objectclass: uidObject</span>
<span class="tok-go">objectClass: inetOrgPerson</span>
<span class="tok-go">objectclass: person</span>
<span class="tok-go">uid: alu1</span>
<span class="tok-go">cn: Cuenta de alu1</span>
<span class="tok-go">sn: alu1</span>
<span class="tok-go">userPassword: alu1</span>
<span class="tok-go">mail: alu1@ua.es</span>

<span class="tok-gp">#</span>alumno2
<span class="tok-go">dn: uid=alu2,ou=users,dc=ua,dc=es</span>
<span class="tok-go">objectclass: top</span>
<span class="tok-go">objectclass: uidObject</span>
<span class="tok-go">objectClass: inetOrgPerson</span>
<span class="tok-go">objectclass: person</span>
<span class="tok-go">uid: alu2</span>
<span class="tok-go">cn: Cuenta de alu2</span>
<span class="tok-go">sn: alu2</span>
<span class="tok-go">userPassword: alu2</span>
<span class="tok-go">mail: alu2@ua.es</span>

<span class="tok-gp">#</span>profesor1
<span class="tok-go">dn: uid=prof1,ou=users,dc=ua,dc=es</span>
<span class="tok-go">objectclass: top</span>
<span class="tok-go">objectclass: uidObject</span>
<span class="tok-go">objectClass: inetOrgPerson</span>
<span class="tok-go">objectclass: person</span>
<span class="tok-go">uid: prof1</span>
<span class="tok-go">cn: Cuenta de prof1</span>
<span class="tok-go">sn: prof1</span>
<span class="tok-go">userPassword: prof1</span>
<span class="tok-go">mail: prof1@ua.es</span>

<span class="tok-gp">#</span>definir rol_usuario y miembros
<span class="tok-go">dn: cn=rol_usuario,ou=roles,dc=ua,dc=es</span>
<span class="tok-go">objectclass: top</span>
<span class="tok-go">objectclass: groupOfNames</span>
<span class="tok-go">cn: rol_usuario</span>
<span class="tok-go">description: grupo de alumnos</span>
<span class="tok-go">member: uid=alu1,ou=users,dc=ua,dc=es</span>
<span class="tok-go">member: uid=alu2,ou=users,dc=ua,dc=es</span>

<span class="tok-gp">#</span>definir rol_administrador y miembros
<span class="tok-go">dn: cn=rol_administrador,ou=roles,dc=ua,dc=es</span>
<span class="tok-go">objectclass: top</span>
<span class="tok-go">objectclass: groupOfNames</span>
<span class="tok-go">cn: rol_administrador</span>
<span class="tok-go">description: grupo de profesores</span>
<span class="tok-go">member: uid=prof1,ou=users,dc=ua,dc=es</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>No vamos a entrar en detalle sobre cómo se configura un servidor LDAP, pero como podéis ver en la configuración, hay una clara jerarquía de objetos. Partiendo del dominio jtech, se crea un usuario administrador y dos unidades organizativas. Dentro de esas dos unidades organizativas (usuarios y grupos) crearemos a su vez un usuario (de login usuario) y un grupo denominado usuarios.</p>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<p>Si os fijáis, al final se indica que el usuario "usuario" pertenece al grupo "usuarios". Cada objeto que hemos comentado se localiza por su dn y en su nombre va arrastrando toda la estructura del directorio.</p>
</div>
<div class="paragraph">
<p>Para cargar esta configuración en nuestro LDAP, debéis ejecutar lo siguiente:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="console"><span class="tok-go">sudo ldapadd -x -D cn=admin,dc=ua,dc=es -W -f directorio.ldif</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Para comprobar que todo ha ido bien, podéis consultar el directorio mediante el comando ldapsearch:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="console"><span class="tok-go">sudo ldapsearch -x -b &#39;dc=ua,dc=es&#39; &#39;(objectclass=*)&#39;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>(El asterisco es un comodín, si queréis podéis probar a sustituirlo por cualquier valor de "objectclass" que veáis en la configuración).</p>
</div>
<div class="sect4">
<h5 id="_jxplorer">JXplorer</h5>
<div class="paragraph">
<p>Otra opción para trabajar sobre el directorio es utilizar un cliente LDAP, como por ejemplo, JXplorer. Una vez el directorio tenga la configuración básica, podemos conectarnos a él, indicando el dn de la organización y el usuario/password del administrador. Se nos mostrará gráficamente la composición del directorio y se nos permitirá añadir/modificar/borrar elementos del mismo:</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="images/paas03/ldap2.png" alt="ldap2" width="50%">
</div>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="images/paas03/ldap3.png" alt="ldap3" width="66%">
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_login_module_ldapextended">3.2.5. Login module LdapExtended</h4>
<div class="paragraph">
<p>Una vez configurado nuestro directorio LDAP, debemos añadir y configurar el login module específico para Ldap en  nuestro security domain:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><span class="tok-nt">&lt;login-module</span> <span class="tok-na">code=</span><span class="tok-s">&quot;LdapExtended&quot;</span> <span class="tok-na">flag=</span><span class="tok-s">&quot;required&quot;</span> <span class="tok-nt">&gt;</span>
	<span class="tok-nt">&lt;module-option</span> <span class="tok-na">name=</span><span class="tok-s">&quot;java.naming.factory.initial&quot;</span> <span class="tok-na">value=</span><span class="tok-s">&quot;com.sun.jndi.ldap.LdapCtxFactory&quot;</span><span class="tok-nt">/&gt;</span>
	<span class="tok-nt">&lt;module-option</span> <span class="tok-na">name=</span><span class="tok-s">&quot;java.naming.provider.url&quot;</span> <span class="tok-na">value=</span><span class="tok-s">&quot;ldap://localhost:389&quot;</span><span class="tok-nt">/&gt;</span>
	<span class="tok-nt">&lt;module-option</span> <span class="tok-na">name=</span><span class="tok-s">&quot;java.naming.security.authentication&quot;</span> <span class="tok-na">value=</span><span class="tok-s">&quot;simple&quot;</span><span class="tok-nt">/&gt;</span>
	<span class="tok-nt">&lt;module-option</span> <span class="tok-na">name=</span><span class="tok-s">&quot;bindDN&quot;</span> <span class="tok-na">value=</span><span class="tok-s">&quot;cn=admin,dc=ua,dc=es&quot;</span><span class="tok-nt">/&gt;</span>
	<span class="tok-nt">&lt;module-option</span> <span class="tok-na">name=</span><span class="tok-s">&quot;bindCredential&quot;</span> <span class="tok-na">value=</span><span class="tok-s">&quot;expertojavajs&quot;</span><span class="tok-nt">/&gt;</span>
	<span class="tok-nt">&lt;module-option</span> <span class="tok-na">name=</span><span class="tok-s">&quot;baseCtxDN&quot;</span> <span class="tok-na">value=</span><span class="tok-s">&quot;ou=users,dc=ua,dc=es&quot;</span><span class="tok-nt">/&gt;</span>
	<span class="tok-nt">&lt;module-option</span> <span class="tok-na">name=</span><span class="tok-s">&quot;baseFilter&quot;</span> <span class="tok-na">value=</span><span class="tok-s">&quot;(uid={0})&quot;</span> <span class="tok-nt">/&gt;</span>

	<span class="tok-nt">&lt;module-option</span> <span class="tok-na">name=</span><span class="tok-s">&quot;rolesCtxDN&quot;</span> <span class="tok-na">value=</span><span class="tok-s">&quot;ou=roles,dc=ua,dc=es&quot;</span> <span class="tok-nt">/&gt;</span>
	<span class="tok-nt">&lt;module-option</span> <span class="tok-na">name=</span><span class="tok-s">&quot;roleFilter&quot;</span> <span class="tok-na">value=</span><span class="tok-s">&quot;(member={1})&quot;</span> <span class="tok-nt">/&gt;</span>
	<span class="tok-nt">&lt;module-option</span> <span class="tok-na">name=</span><span class="tok-s">&quot;roleAttributeID&quot;</span> <span class="tok-na">value=</span><span class="tok-s">&quot;cn&quot;</span> <span class="tok-nt">/&gt;</span>

	<span class="tok-nt">&lt;module-option</span> <span class="tok-na">name=</span><span class="tok-s">&quot;searchScope&quot;</span> <span class="tok-na">value=</span><span class="tok-s">&quot;ONELEVEL_SCOPE&quot;</span> <span class="tok-nt">/&gt;</span>
    <span class="tok-nt">&lt;module-option</span> <span class="tok-na">name=</span><span class="tok-s">&quot;allowEmptyPasswords&quot;</span> <span class="tok-na">value=</span><span class="tok-s">&quot;true&quot;</span> <span class="tok-nt">/&gt;</span>
<span class="tok-nt">&lt;/login-module&gt;</span></code></pre>
</div>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
Cuidado con los espacios en blanco después de los valores de cada propiedad que configuréis tanto en los ficheros LDIF como en los valores de las propiedades. Os ahorraréis bastantes quebraderos de cabeza&#8230;&#8203;
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_role_based_access_control_en_interfaces_de_administración">3.3. Role Based Access Control en interfaces de administración</h3>
<div class="paragraph">
<p>Por último, comentar que a partir de WildFly 8, se introduce también el control de autorización en tareas administrativas. Hasta ahora en JBoss cualquier usuario con acceso al ManagementRealm se consideraba super usuario y podía realizar cualquier tarea de administración. Desde esta nueva versión es posible establecer un control mas preciso de lo que un usuario puede hacer y lo que no, habilitando el control RBAC:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><span class="tok-nt">&lt;management&gt;</span>

        <span class="tok-nt">&lt;access-control</span> <span class="tok-na">provider=</span><span class="tok-s">&quot;simple&quot;</span><span class="tok-nt">&gt;</span> <span class="tok-c">&lt;!-- cambiar por rbac--&gt;</span>
            <span class="tok-nt">&lt;role-mapping&gt;</span>
                <span class="tok-nt">&lt;role</span> <span class="tok-na">name=</span><span class="tok-s">&quot;SuperUser&quot;</span><span class="tok-nt">&gt;</span>
                    <span class="tok-nt">&lt;include&gt;</span>
                        <span class="tok-nt">&lt;user</span> <span class="tok-na">name=</span><span class="tok-s">&quot;$local&quot;</span><span class="tok-nt">/&gt;</span>
						<span class="tok-nt">&lt;user</span> <span class="tok-na">alias=</span><span class="tok-s">&quot;experto&quot;</span> <span class="tok-na">name=</span><span class="tok-s">&quot;experto&quot;</span> <span class="tok-nt">/&gt;</span> <span class="tok-c">&lt;!-- Añadir al menos un usuario como Superusuario después del cambio --&gt;</span>
                    <span class="tok-nt">&lt;/include&gt;</span>
                <span class="tok-nt">&lt;/role&gt;</span>
            <span class="tok-nt">&lt;/role-mapping&gt;</span>
        <span class="tok-nt">&lt;/access-control&gt;</span>

    <span class="tok-nt">&lt;/management&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>En la sección de roles se muestra un único rol (superusuario), pero tras habilitar el mecanismo de roles tenemos a disposición nuestra los siguientes roles:</p>
</div>
<table class="tableblock frame-all grid-all" style="width: 80%;">
<colgroup>
<col style="width: 20%;">
<col style="width: 80%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Role</th>
<th class="tableblock halign-left valign-top">Permissions</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Monitor</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">El más restrictivo. Solo permisos de consulta de la información en tiempo de ejecución. No permite la consulta de recursos, datos o información de log.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Operator</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Los permisos de Monitor y además puede parar/arrancar instancias, activar/desactivar colas JMS y liberar conexiones de base de datos.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Maintainer</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Los permisos del Operator y además puede modificar la configuración: desplegar nuevas aplicaciones y recursos.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Deployer</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Los permisos de Maintainer pero restringidos al despliegue de aplicaciones.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Administrator</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Los permisos de Maintainer  pero además permite ver y modificar datos sensibles tales como sistemas de seguridad. No tiene acceso al sistema de auditoria de administración (audit loggin system).</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Auditor</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Los permisos del monitor más la posibilidad de poder consultar/modificar el audit logging system).</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Super User</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Tiene todos los permisos, y es el equivalente al usuario administrador de versiones anteriores.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>La administración de la asignación de roles a usuarios y/o grupos está integrada en la consola Web, en contraposición al alta de usuarios, que se sigue haciendo por script.</p>
</div>
<div class="paragraph">
<p>En el caso de querer asociar un grupo de usuarios (mgmt-groups.properties) a un rol de administración, se añadiría de la siguiente forma:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><span class="tok-nt">&lt;role</span> <span class="tok-na">name=</span><span class="tok-s">&quot;Deployer&quot;</span><span class="tok-nt">&gt;</span>
	<span class="tok-nt">&lt;include&gt;</span>
		<span class="tok-nt">&lt;group</span> <span class="tok-na">alias=</span><span class="tok-s">&quot;group-lead-devs&quot;</span> <span class="tok-na">name=</span><span class="tok-s">&quot;lead-developers&quot;</span><span class="tok-nt">/&gt;</span>
	<span class="tok-nt">&lt;/include&gt;</span>
<span class="tok-nt">&lt;/role&gt;</span></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_referencias">3.4. Referencias</h3>
<div class="ulist">
<ul>
<li>
<p>WildFly Administration Guide <a href="https://docs.jboss.org/author/display/WFLY8/Admin+Guide" class="bare">https://docs.jboss.org/author/display/WFLY8/Admin+Guide</a></p>
</li>
<li>
<p>OpenLDAP <a href="http://www.openldap.org/doc/admin24/quickstart.html" class="bare">http://www.openldap.org/doc/admin24/quickstart.html</a></p>
</li>
<li>
<p>Instalar LDAP en Ubuntu <a href="http://www.openxarxes.com/instalar-y-configurar-ldap-en-ubuntu-lucid-10-04/" class="bare">http://www.openxarxes.com/instalar-y-configurar-ldap-en-ubuntu-lucid-10-04/</a></p>
</li>
<li>
<p>Security Realms <a href="https://docs.jboss.org/author/display/AS71/Security+Realms" class="bare">https://docs.jboss.org/author/display/AS71/Security+Realms</a></p>
</li>
<li>
<p>Security subsystem configuration <a href="https://docs.jboss.org/author/display/AS71/Security+subsystem+configuration" class="bare">https://docs.jboss.org/author/display/AS71/Security+subsystem+configuration</a></p>
</li>
<li>
<p>Role Based Access Control <a href="https://docs.jboss.org/author/display/WFLY9/RBAC" class="bare">https://docs.jboss.org/author/display/WFLY9/RBAC</a></p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_ejercicios_de_seguridad_declarativa_en_wildfly">3.5. Ejercicios de seguridad declarativa en WildFly</h3>
<div class="paragraph">
<p>Nuestro siguiente proyecto será poner en marcha una sencilla intranet para nuestra organización donde se muestren las noticias más importantes del día.</p>
</div>
<div class="paragraph">
<p>Trabajaréis sobre el proyecto Maven <em>apli-intranet</em>. Esta aplicación web contempla dos tipos de acciones:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Consulta de noticias del día, abierta a cualquier empleado (autenticado) de la empresa, mediante el servlet <em>ConsultaServlet</em>.</p>
</li>
<li>
<p>Alta de nuevas noticias, únicamente habilitada para los usuarios administradores de la intranet con el servlet <em>NuevoMensajeServlet</em>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>El contexto raíz de la aplicación debe ser <em>/intranet</em> y a este nivel se encuentra la página y el servlet que implementan la consulta. El JSP y Servlet de alta de noticias se encuentran en <em>/intranet/admin</em> para que podamos establecer restricciones de seguridad diferenciadas.</p>
</div>
<div class="paragraph">
<p>La información relativa a nuestra aplicación se almacenará en la BD <em>seguridad</em> que hemos presentado en la teoría y que crearemos con el script incluido en las plantillas. Para acceder a la base de datos, crearemos un  origen de datos al que denominaremos <em>java:jboss/datasources/seguridad</em>.</p>
</div>
<div class="paragraph">
<p>La tabla donde almacenaremos las noticias tiene el siguiente esquema:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="sql"><span class="tok-k">CREATE</span> <span class="tok-k">TABLE</span>  <span class="tok-o">`</span><span class="tok-n">noticias</span><span class="tok-o">`</span> <span class="tok-p">(</span>
  <span class="tok-o">`</span><span class="tok-n">fecha</span><span class="tok-o">`</span> <span class="tok-k">timestamp</span> <span class="tok-k">NOT</span> <span class="tok-k">NULL</span> <span class="tok-k">DEFAULT</span> <span class="tok-k">CURRENT_TIMESTAMP</span><span class="tok-p">,</span>
  <span class="tok-o">`</span><span class="tok-n">noticia</span><span class="tok-o">`</span> <span class="tok-nb">varchar</span><span class="tok-p">(</span><span class="tok-mi">1024</span><span class="tok-p">)</span> <span class="tok-k">DEFAULT</span> <span class="tok-k">NULL</span>
<span class="tok-p">)</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Para poner en marcha este proyecto definiremos la seguridad en tres fases separadas, en las que iremos sumando distintos orígenes de datos de información de autenticación (ficheros, base de datos, LDAP) para que trabajen de forma <em>conjunta</em>.</p>
</div>
<div class="sect3">
<h4 id="_configuración_despliegue_y_alta_de_usuarios_en_wildfly_0_6_puntos">3.5.1. Configuración, despliegue y alta de usuarios en WildFly (0.6 puntos)</h4>
<div class="paragraph">
<p>En este ejercicio configuraremos el modelo de seguridad general que queremos para nuestra aplicación. Para ello crearemos un nuevo security domain, al que llamaremos <strong>seguridad-domain</strong>. Funcionará de forma similar al security domain <em>Other</em> pero almacenando la información de usuarios y roles en ficheros específicos.</p>
</div>
<div class="paragraph">
<p>Será necesario crear un nuevo realm, de nombre <strong>IntranetRealm</strong> y que almacenará la información de usuarios en los siguientes ficheros:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>intranet-users.properties</p>
</li>
<li>
<p>intranet-roles.properties</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Una vez definido el modelo de seguridad general, definiremos los siguientes roles:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><em>usuarios</em>, que contendrán al conjunto de usuarios de la empresa y tendrán el rol: <em>rol_usuario</em>.</p>
</li>
<li>
<p><em>administradores</em>, que serán aquellos usuarios que tengan permiso para dar de alta nuevas noticias en la aplicación, poseerán el rol: <em>rol_administrador</em>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Como el desarrollo de la aplicación lo llevan a cabo dos programadores, daremos de alta cada uno de ello con un rol distinto y los incluiremos como usuarios del IntranetRealm de WildFly:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><em>programador1</em> (clave programador1), que tendrá asociado el rol usuario.</p>
</li>
<li>
<p><em>programador2</em> (clave programador2), asociado al rol administrador.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Por último, habrá que modificar el código fuente de la aplicación para que:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Se utilice el nuevo security domain y especificar el contexto raíz /intranet.</p>
</li>
<li>
<p>Definir los roles autorizados para ejecutar los distintos servlets mediante anotaciones:</p>
<div class="ulist">
<ul>
<li>
<p>/ConsultaServlet: roles usuario y administrador:</p>
</li>
<li>
<p>/admin/NuevoMensajeServlet: sólo podrán ejecutarlo los usuarios administradores</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>Debéis comprobar que el usuario "programador1" sólo puede ver las noticias del día, mientras que el usuario "programador2" también puede añadir nuevas noticias a la base de datos.</p>
</div>
</div>
<div class="sect3">
<h4 id="_gestión_de_usuarios_en_base_de_datos_0_3_puntos">3.5.2. Gestión de usuarios en Base de datos (0.3 puntos)</h4>
<div class="paragraph">
<p>En nuestra empresa hay un número variable de empleados externos. Estos empleados no pertenecen a ningún directorio corporativo pero se mantienen en una base de datos. El objetivo de este ejercicio es añadir al security domain un login module que trabaje con usuarios y grupos mantenidos en la BD <em>seguridad</em>.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
Debeis configurar login module como se explica en teoría, configurando el parámetro <em>flag</em> de los login module de modo que un usuario se reconozca como autenticado cuando sea válido para al menos un login module (basado en ficheros o en BD).
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Para comprobar que todo está en orden, daréis de alta los siguientes usuarios:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><em>consultor1</em> (clave consultor1), asociado al rol usuario.</p>
</li>
<li>
<p><em>consultor2</em> (clave consultor2), asociado al rol administrador.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Es importante almacenar las contraseñas codificadas por tanto hay que configurar el login module de modo que utilice MD5 en la validación. Asimismo tenéis que comprobar que los usuarios programador1 y programador2 siguen trabajando con normalidad!!</p>
</div>
</div>
<div class="sect3">
<h4 id="_seguridad_integrada_con_ldap_corporativo_0_3_puntos">3.5.3. Seguridad integrada con LDAP corporativo (0.3 puntos)</h4>
<div class="paragraph">
<p>En esta última fase, enlazaremos el directorio corporativo de la empresa con el security domain de WildFly, de modo que un usuario se definirá en el directorio, y en función del rol asociado, tendrá acceso parcial o completo a la aplicación.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
Debéis seguir los pasos descritos en teoría y ejecutar el script LDIF que se adjuntan como plantilla. Este script creará automáticamente los siguientes usuarios:
</td>
</tr>
</table>
</div>
<div class="ulist">
<ul>
<li>
<p><em>alu1</em> (clave alu1) asociado al rol usuario.</p>
</li>
<li>
<p><em>alu2</em> (clave alu2) asociado al rol usuario.</p>
</li>
<li>
<p><em>prof1</em> (clave prof1) asociado al rol administrador.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Podéis utilizar la herramienta <em>JXplorer</em> para comprobar que los usuarios se han creado correctamente, y si tenéis problemas para autenticar algún usuario, recordad que tenéis que habilitar la auditoría de seguridad, para que os dé más detalle de lo que ocurre.</p>
</div>
<div class="paragraph">
<p>El resultado de las tres fases es un security domain que obtiene información sobre los usuarios de múltiples orígenes y permite establecer reglas de seguridad unificadas.</p>
</div>
</div>
<div class="sect3">
<h4 id="_entrega">3.5.4. Entrega</h4>
<div class="paragraph">
<p>En esta sesión debeis entregar el proyecto apli-intranet con las modificaciones requeridas y la configuración de WildFly <em>standalone.xml</em>.</p>
</div>
</div>
</div>
</div>
</div>
</div>
<div id="footer">
<div id="footer-text">
Last updated 2015-10-16 22:32:33 CEST
</div>
</div>
</body>
</html>