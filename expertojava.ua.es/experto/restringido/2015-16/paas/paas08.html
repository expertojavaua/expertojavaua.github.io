<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<!--[if IE]><meta http-equiv="X-UA-Compatible" content="IE=edge"><![endif]-->
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 1.5.2">
<meta name="author" content="José Luis Zamora Sánchez">
<title>Servidores web y PaaS</title>
<style>/*! normalize.css v2.1.2 | MIT License | git.io/normalize */
/* ========================================================================== HTML5 display definitions ========================================================================== */
/** Correct `block` display not defined in IE 8/9. */
article, aside, details, figcaption, figure, footer, header, hgroup, main, nav, section, summary { display: block; }

/** Correct `inline-block` display not defined in IE 8/9. */
audio, canvas, video { display: inline-block; }

/** Prevent modern browsers from displaying `audio` without controls. Remove excess height in iOS 5 devices. */
audio:not([controls]) { display: none; height: 0; }

/** Address `[hidden]` styling not present in IE 8/9. Hide the `template` element in IE, Safari, and Firefox < 22. */
[hidden], template { display: none; }

script { display: none !important; }

/* ========================================================================== Base ========================================================================== */
/** 1. Set default font family to sans-serif. 2. Prevent iOS text size adjust after orientation change, without disabling user zoom. */
html { font-family: sans-serif; /* 1 */ -ms-text-size-adjust: 100%; /* 2 */ -webkit-text-size-adjust: 100%; /* 2 */ }

/** Remove default margin. */
body { margin: 0; }

/* ========================================================================== Links ========================================================================== */
/** Remove the gray background color from active links in IE 10. */
a { background: transparent; }

/** Address `outline` inconsistency between Chrome and other browsers. */
a:focus { outline: thin dotted; }

/** Improve readability when focused and also mouse hovered in all browsers. */
a:active, a:hover { outline: 0; }

/* ========================================================================== Typography ========================================================================== */
/** Address variable `h1` font-size and margin within `section` and `article` contexts in Firefox 4+, Safari 5, and Chrome. */
h1 { font-size: 2em; margin: 0.67em 0; }

/** Address styling not present in IE 8/9, Safari 5, and Chrome. */
abbr[title] { border-bottom: 1px dotted; }

/** Address style set to `bolder` in Firefox 4+, Safari 5, and Chrome. */
b, strong { font-weight: bold; }

/** Address styling not present in Safari 5 and Chrome. */
dfn { font-style: italic; }

/** Address differences between Firefox and other browsers. */
hr { -moz-box-sizing: content-box; box-sizing: content-box; height: 0; }

/** Address styling not present in IE 8/9. */
mark { background: #ff0; color: #000; }

/** Correct font family set oddly in Safari 5 and Chrome. */
code, kbd, pre, samp { font-family: monospace, serif; font-size: 1em; }

/** Improve readability of pre-formatted text in all browsers. */
pre { white-space: pre-wrap; }

/** Set consistent quote types. */
q { quotes: "\201C" "\201D" "\2018" "\2019"; }

/** Address inconsistent and variable font size in all browsers. */
small { font-size: 80%; }

/** Prevent `sub` and `sup` affecting `line-height` in all browsers. */
sub, sup { font-size: 75%; line-height: 0; position: relative; vertical-align: baseline; }

sup { top: -0.5em; }

sub { bottom: -0.25em; }

/* ========================================================================== Embedded content ========================================================================== */
/** Remove border when inside `a` element in IE 8/9. */
img { border: 0; }

/** Correct overflow displayed oddly in IE 9. */
svg:not(:root) { overflow: hidden; }

/* ========================================================================== Figures ========================================================================== */
/** Address margin not present in IE 8/9 and Safari 5. */
figure { margin: 0; }

/* ========================================================================== Forms ========================================================================== */
/** Define consistent border, margin, and padding. */
fieldset { border: 1px solid #c0c0c0; margin: 0 2px; padding: 0.35em 0.625em 0.75em; }

/** 1. Correct `color` not being inherited in IE 8/9. 2. Remove padding so people aren't caught out if they zero out fieldsets. */
legend { border: 0; /* 1 */ padding: 0; /* 2 */ }

/** 1. Correct font family not being inherited in all browsers. 2. Correct font size not being inherited in all browsers. 3. Address margins set differently in Firefox 4+, Safari 5, and Chrome. */
button, input, select, textarea { font-family: inherit; /* 1 */ font-size: 100%; /* 2 */ margin: 0; /* 3 */ }

/** Address Firefox 4+ setting `line-height` on `input` using `!important` in the UA stylesheet. */
button, input { line-height: normal; }

/** Address inconsistent `text-transform` inheritance for `button` and `select`. All other form control elements do not inherit `text-transform` values. Correct `button` style inheritance in Chrome, Safari 5+, and IE 8+. Correct `select` style inheritance in Firefox 4+ and Opera. */
button, select { text-transform: none; }

/** 1. Avoid the WebKit bug in Android 4.0.* where (2) destroys native `audio` and `video` controls. 2. Correct inability to style clickable `input` types in iOS. 3. Improve usability and consistency of cursor style between image-type `input` and others. */
button, html input[type="button"], input[type="reset"], input[type="submit"] { -webkit-appearance: button; /* 2 */ cursor: pointer; /* 3 */ }

/** Re-set default cursor for disabled elements. */
button[disabled], html input[disabled] { cursor: default; }

/** 1. Address box sizing set to `content-box` in IE 8/9. 2. Remove excess padding in IE 8/9. */
input[type="checkbox"], input[type="radio"] { box-sizing: border-box; /* 1 */ padding: 0; /* 2 */ }

/** 1. Address `appearance` set to `searchfield` in Safari 5 and Chrome. 2. Address `box-sizing` set to `border-box` in Safari 5 and Chrome (include `-moz` to future-proof). */
input[type="search"] { -webkit-appearance: textfield; /* 1 */ -moz-box-sizing: content-box; -webkit-box-sizing: content-box; /* 2 */ box-sizing: content-box; }

/** Remove inner padding and search cancel button in Safari 5 and Chrome on OS X. */
input[type="search"]::-webkit-search-cancel-button, input[type="search"]::-webkit-search-decoration { -webkit-appearance: none; }

/** Remove inner padding and border in Firefox 4+. */
button::-moz-focus-inner, input::-moz-focus-inner { border: 0; padding: 0; }

/** 1. Remove default vertical scrollbar in IE 8/9. 2. Improve readability and alignment in all browsers. */
textarea { overflow: auto; /* 1 */ vertical-align: top; /* 2 */ }

/* ========================================================================== Tables ========================================================================== */
/** Remove most spacing between table cells. */
table { border-collapse: collapse; border-spacing: 0; }

meta.foundation-mq-small { font-family: "only screen and (min-width: 768px)"; width: 768px; }

meta.foundation-mq-medium { font-family: "only screen and (min-width:1280px)"; width: 1280px; }

meta.foundation-mq-large { font-family: "only screen and (min-width:1440px)"; width: 1440px; }

*, *:before, *:after { -moz-box-sizing: border-box; -webkit-box-sizing: border-box; box-sizing: border-box; }

html, body { font-size: 97%; }

body { background: white; color: #222222; padding: 0; margin: 0; font-family: "Helvetica Neue", "Helvetica", Helvetica, Arial, sans-serif; font-weight: normal; font-style: normal; line-height: 1; position: relative; cursor: auto; }

a:hover { cursor: pointer; }

img, object, embed { max-width: 100%; height: auto; }

object, embed { height: 100%; }

img { -ms-interpolation-mode: bicubic; }

#map_canvas img, #map_canvas embed, #map_canvas object, .map_canvas img, .map_canvas embed, .map_canvas object { max-width: none !important; }

.left { float: left !important; }

.right { float: right !important; }

.text-left { text-align: left !important; }

.text-right { text-align: right !important; }

.text-center { text-align: center !important; }

.text-justify { text-align: justify !important; }

.hide { display: none; }

.antialiased, body { -webkit-font-smoothing: antialiased; }

img { display: inline-block; vertical-align: middle; }

textarea { height: auto; min-height: 50px; }

select { width: 100%; }

p.lead, .paragraph.lead > p, #preamble > .sectionbody > .paragraph:first-of-type p { font-size: 1.21875em; line-height: 1.6; }

.subheader, .admonitionblock td.content > .title, .audioblock > .title, .exampleblock > .title, .imageblock > .title, .listingblock > .title, .literalblock > .title, .stemblock > .title, .openblock > .title, .paragraph > .title, .quoteblock > .title, table.tableblock > .title, .verseblock > .title, .videoblock > .title, .dlist > .title, .olist > .title, .ulist > .title, .qlist > .title, .hdlist > .title { line-height: 1.4; color: #6f6f6f; font-weight: 300; margin-top: 0.2em; margin-bottom: 0.5em; }

/* Typography resets */
div, dl, dt, dd, ul, ol, li, h1, h2, h3, #toctitle, .sidebarblock > .content > .title, h4, h5, h6, pre, form, p, blockquote, th, td { margin: 0; padding: 0; direction: ltr; }

/* Default Link Styles */
a { color: #1164be; text-decoration: none; line-height: inherit; }
a img { border: none; }

/* Default paragraph styles */
p { font-family: inherit; font-weight: normal; font-size: 1em; line-height: 1.4; margin-bottom: 1em; text-rendering: optimizeLegibility; }
p aside { font-size: 0.875em; line-height: 1.35; font-style: italic; }

/* Default header styles */
h1, h2, h3, #toctitle, .sidebarblock > .content > .title, h4, h5, h6 { font-family: "Helvetica Neue", "Helvetica", Helvetica, Arial, sans-serif; font-weight: bold; font-style: normal; color: #1c355e; text-rendering: optimizeLegibility; margin-top: 1em; margin-bottom: 0.5em; line-height: 1.2125em; }
h1 small, h2 small, h3 small, #toctitle small, .sidebarblock > .content > .title small, h4 small, h5 small, h6 small { font-size: 60%; color: #6f6f6f; line-height: 0; }

h1 { font-size: 2.125em; }

h2 { font-size: 1.6875em; }

h3, #toctitle, .sidebarblock > .content > .title { font-size: 1.375em; }

h4 { font-size: 1.125em; }

h5 { font-size: 1.125em; }

h6 { font-size: 1em; }

hr { border: solid #dddddd; border-width: 1px 0 0; clear: both; margin: 1.25em 0 1.1875em; height: 0; }

/* Helpful Typography Defaults */
em, i { font-style: italic; line-height: inherit; }

strong, b { font-weight: bold; line-height: inherit; }

small { font-size: 60%; line-height: inherit; }

code { font-family: Consolas, "Liberation Mono", Courier, monospace; font-weight: bold; }

/* Lists */
ul, ol, dl { font-size: 1em; line-height: 1.4; margin-bottom: 1.25em; list-style-position: outside; font-family: inherit; }

ul, ol { margin-left: 2.5em; }
ul.no-bullet, ol.no-bullet { margin-left: 1.5em; }

/* Unordered Lists */
ul li ul, ul li ol { margin-left: 1.25em; margin-bottom: 0; font-size: 1em; /* Override nested font-size change */ }
ul.square li ul, ul.circle li ul, ul.disc li ul { list-style: inherit; }
ul.square { list-style-type: square; }
ul.circle { list-style-type: circle; }
ul.disc { list-style-type: disc; }
ul.no-bullet { list-style: none; }

/* Ordered Lists */
ol li ul, ol li ol { margin-left: 1.25em; margin-bottom: 0; }

/* Definition Lists */
dl dt { margin-bottom: 0.3125em; font-weight: bold; }
dl dd { margin-bottom: 1.25em; }

/* Abbreviations */
abbr, acronym { text-transform: uppercase; font-size: 90%; color: #222222; border-bottom: 1px dotted #dddddd; cursor: help; }

abbr { text-transform: none; }

/* Blockquotes */
blockquote { margin: 0 0 1.25em; padding: 0.5625em 1.25em 0 1.1875em; border-left: 1px solid #dddddd; }
blockquote cite { display: block; font-size: 0.8125em; color: #555555; }
blockquote cite:before { content: "\2014 \0020"; }
blockquote cite a, blockquote cite a:visited { color: #555555; }

blockquote, blockquote p { line-height: 1.6; color: #6f6f6f; }

/* Microformats */
.vcard { display: inline-block; margin: 0 0 1.25em 0; border: 1px solid #dddddd; padding: 0.625em 0.75em; }
.vcard li { margin: 0; display: block; }
.vcard .fn { font-weight: bold; font-size: 0.9375em; }

.vevent .summary { font-weight: bold; }
.vevent abbr { cursor: auto; text-decoration: none; font-weight: bold; border: none; padding: 0 0.0625em; }

/*@media only screen and (min-width: 768px) { h1, h2, h3, #toctitle, .sidebarblock > .content > .title, h4, h5, h6 { line-height: 1.4; }
  h1 { font-size: 2.75em; }
  h2 { font-size: 2.3125em; }
  h3, #toctitle, .sidebarblock > .content > .title { font-size: 1.6875em; }
  h4 { font-size: 1.4375em; } }*/
/* Tables */
table { background: white; margin-bottom: 1.25em; border: solid 1px #dddddd; }
table thead, table tfoot { background: whitesmoke; font-weight: bold; }
table thead tr th, table thead tr td, table tfoot tr th, table tfoot tr td { padding: 0.5em 0.625em 0.625em; font-size: inherit; color: #222222; text-align: left; }
table tr th, table tr td { padding: 0.5625em 0.625em; font-size: inherit; color: #222222; }
table tr.even, table tr.alt, table tr:nth-of-type(even) { background: #f9f9f9; }
table thead tr th, table tfoot tr th, table tbody tr td, table tr td, table tfoot tr td { display: table-cell; line-height: 1.4; }

h1, h2, h3, #toctitle, .sidebarblock > .content > .title, h4, h5, h6 { line-height: 1.4; border-bottom: 1px solid #dddddd }

.clearfix:before, .clearfix:after, .float-group:before, .float-group:after { content: " "; display: table; }
.clearfix:after, .float-group:after { clear: both; }

*:not(pre) > code { font-size: inherit; font-style: normal !important; letter-spacing: 0; padding: 3px 2px 1px 2px; background-color: #eeeeee; border: 1px solid #dddddd; -webkit-border-radius: 0; border-radius: 0; line-height: inherit; font-weight: normal; }

pre, pre > code { line-height: 1.4; color: black; font-family: monospace, serif; font-weight: normal; }

.keyseq { color: #555555; }

kbd { display: inline-block; color: #222222; font-size: 0.75em; line-height: 1.4; background-color: #f7f7f7; border: 1px solid #ccc; -webkit-border-radius: 3px; border-radius: 3px; -webkit-box-shadow: 0 1px 0 rgba(0, 0, 0, 0.2), 0 0 0 0.1em white inset; box-shadow: 0 1px 0 rgba(0, 0, 0, 0.2), 0 0 0 0.1em white inset; margin: -0.15em 0.15em 0 0.15em; padding: 0.2em 0.6em 0.2em 0.5em; vertical-align: middle; white-space: nowrap; }

.keyseq kbd:first-child { margin-left: 0; }

.keyseq kbd:last-child { margin-right: 0; }

.menuseq, .menu { color: #090909; }

b.button:before, b.button:after { position: relative; top: -1px; font-weight: normal; }

b.button:before { content: "["; padding: 0 3px 0 2px; }

b.button:after { content: "]"; padding: 0 2px 0 3px; }

#header, #content, #footnotes, #footer { width: 100%; margin-left: auto; margin-right: auto; margin-top: 0; margin-bottom: 0; max-width: 62.5em; *zoom: 1; position: relative; padding-left: 0.9375em; padding-right: 0.9375em; }
#header:before, #header:after, #content:before, #content:after, #footnotes:before, #footnotes:after, #footer:before, #footer:after { content: " "; display: table; }
#header:after, #content:after, #footnotes:after, #footer:after { clear: both; }

#content { margin-top: 1.25em; }

#content:before { content: none; }

#header > h1:first-child { color: black; margin-top: 2.25rem; margin-bottom: 0; }
#header > h1:first-child + #toc { margin-top: 8px; border-top: 1px solid #dddddd; }
#header > h1:only-child, body.toc2 #header > h1:nth-last-child(2) { border-bottom: 1px solid #dddddd; padding-bottom: 8px; }
#header .details { border-bottom: 1px solid #dddddd; line-height: 1.45; padding-top: 0.25em; padding-bottom: 0.25em; padding-left: 0.25em; color: #555555; display: -ms-flexbox; display: -webkit-flex; display: flex; -ms-flex-flow: row wrap; -webkit-flex-flow: row wrap; flex-flow: row wrap; }
#header .details span:first-child { margin-left: -0.125em; }
#header .details span.email a { color: #6f6f6f; }
#header .details br { display: none; }
#header .details br + span:before { content: "\00a0\2013\00a0"; }
#header .details br + span.author:before { content: "\00a0\22c5\00a0"; color: #6f6f6f; }
#header .details br + span#revremark:before { content: "\00a0|\00a0"; }
#header #revnumber { text-transform: capitalize; }
#header #revnumber:after { content: "\00a0"; }

#content > h1:first-child:not([class]) { color: black; border-bottom: 1px solid #dddddd; padding-bottom: 8px; margin-top: 0; padding-top: 1rem; margin-bottom: 1.25rem; }

#floating {
  position: fixed;
  z-index: 1000;
  padding: 0.5em;
  right: 0;
  top: 0;
  background: white;
  box-shadow: 0 0 1em #777777;
  -webkit-box-shadow: 0 0 1em #777777;
  -moz-box-shadow: 0 0 1em #777777;
  -webkit-border-bottom-left-radius: 5px;
  -moz-border-radius-bottomleft: 5px;
  max-height: 80%;
  overflow: auto;
}

#floating #full { display: none; } /* Hide the full TOC by default */

#floating:hover #full{
  display: block; /* Show it on hover */
}


#toc { border-bottom: 1px solid #dddddd; padding-bottom: 0.5em; }
#toc > ul { margin-left: 0.125em; }
#toc ul.sectlevel0 > li > a { font-style: italic; }
#toc ul.sectlevel0 ul.sectlevel1 { margin: 0.5em 0; }
#toc ul { font-family: "Helvetica Neue", "Helvetica", Helvetica, Arial, sans-serif; list-style-type: none; }
#toc a { text-decoration: none; }
#toc a:active { text-decoration: underline; }

#toctitle { color: #6f6f6f; font-size: 1.2em; }

@media only screen and (min-width: 768px) { #toctitle { font-size: 1.375em; }
  body.toc2 { padding-left: 15em; padding-right: 0; }
  #toc.toc2 { margin-top: 0 !important; background-color: #f2f2f2; position: fixed; width: 15em; left: 0; top: 0; border-right: 1px solid #dddddd; border-top-width: 0 !important; border-bottom-width: 0 !important; z-index: 1000; padding: 1.25em 1em; height: 100%; overflow: auto; }
  #toc.toc2 #toctitle { margin-top: 0; font-size: 1.2em; }
  #toc.toc2 > ul { font-size: 0.9em; margin-bottom: 0; }
  #toc.toc2 ul ul { margin-left: 0; padding-left: 1em; }
  #toc.toc2 ul.sectlevel0 ul.sectlevel1 { padding-left: 0; margin-top: 0.5em; margin-bottom: 0.5em; }
  body.toc2.toc-right { padding-left: 0; padding-right: 15em; }
  body.toc2.toc-right #toc.toc2 { border-right-width: 0; border-left: 1px solid #dddddd; left: auto; right: 0; } }
@media only screen and (min-width: 1280px) { body.toc2 { padding-left: 20em; padding-right: 0; }
  #toc.toc2 { width: 20em; }
  #toc.toc2 #toctitle { font-size: 1.375em; }
  #toc.toc2 > ul { font-size: 0.95em; }
  #toc.toc2 ul ul { padding-left: 1.25em; }
  body.toc2.toc-right { padding-left: 0; padding-right: 20em; } }
#content #toc { border-style: solid; border-width: 1px; border-color: #d9d9d9; margin-bottom: 1.25em; padding: 1.25em; background: #f2f2f2; -webkit-border-radius: 0; border-radius: 0; }
#content #toc > :first-child { margin-top: 0; }
#content #toc > :last-child { margin-bottom: 0; }

#footer { max-width: 100%; background-color: #222222; padding: 1.25em; }

#footer-text { color: #dddddd; line-height: 1.44; }

.sect1 { padding-bottom: 0.625em; }

@media only screen and (min-width: 768px) { .sect1 { padding-bottom: 1.25em; } }
.sect1 + .sect1 { border-top: 1px solid #dddddd; }

#content h1 > a.anchor, h2 > a.anchor, h3 > a.anchor, #toctitle > a.anchor, .sidebarblock > .content > .title > a.anchor, h4 > a.anchor, h5 > a.anchor, h6 > a.anchor { position: absolute; z-index: 1001; width: 1.5ex; margin-left: -1.5ex; display: block; text-decoration: none !important; visibility: hidden; text-align: center; font-weight: normal; }
#content h1 > a.anchor:before, h2 > a.anchor:before, h3 > a.anchor:before, #toctitle > a.anchor:before, .sidebarblock > .content > .title > a.anchor:before, h4 > a.anchor:before, h5 > a.anchor:before, h6 > a.anchor:before { content: "\00A7"; font-size: 0.85em; display: block; padding-top: 0.1em; }
#content h1:hover > a.anchor, #content h1 > a.anchor:hover, h2:hover > a.anchor, h2 > a.anchor:hover, h3:hover > a.anchor, #toctitle:hover > a.anchor, .sidebarblock > .content > .title:hover > a.anchor, h3 > a.anchor:hover, #toctitle > a.anchor:hover, .sidebarblock > .content > .title > a.anchor:hover, h4:hover > a.anchor, h4 > a.anchor:hover, h5:hover > a.anchor, h5 > a.anchor:hover, h6:hover > a.anchor, h6 > a.anchor:hover { visibility: visible; }
#content h1 > a.link, h2 > a.link, h3 > a.link, #toctitle > a.link, .sidebarblock > .content > .title > a.link, h4 > a.link, h5 > a.link, h6 > a.link { color: #222222; text-decoration: none; }
#content h1 > a.link:hover, h2 > a.link:hover, h3 > a.link:hover, #toctitle > a.link:hover, .sidebarblock > .content > .title > a.link:hover, h4 > a.link:hover, h5 > a.link:hover, h6 > a.link:hover { color: #151515; }

.audioblock, .imageblock, .literalblock, .listingblock, .stemblock, .videoblock { margin-bottom: 1.25em; }

.admonitionblock td.content > .title, .audioblock > .title, .exampleblock > .title, .imageblock > .title, .listingblock > .title, .literalblock > .title, .stemblock > .title, .openblock > .title, .paragraph > .title, .quoteblock > .title, table.tableblock > .title, .verseblock > .title, .videoblock > .title, .dlist > .title, .olist > .title, .ulist > .title, .qlist > .title, .hdlist > .title { text-rendering: optimizeLegibility; text-align: left; }

table.tableblock > caption.title { white-space: nowrap; overflow: visible; max-width: 0; }

.paragraph.lead > p, #preamble > .sectionbody > .paragraph:first-of-type p { color: black; }

table.tableblock #preamble > .sectionbody > .paragraph:first-of-type p { font-size: inherit; }

.admonitionblock > table { border-collapse: separate; border: 0; background: none; width: 100%; }
.admonitionblock > table td.icon { text-align: center; width: 80px; }
.admonitionblock > table td.icon img { max-width: none; }
.admonitionblock > table td.icon .title { font-weight: bold; font-family: "Helvetica Neue", "Helvetica", Helvetica, Arial, sans-serif; text-transform: uppercase; }
.admonitionblock > table td.content { padding-left: 1.125em; padding-right: 1.25em; border-left: 1px solid #dddddd; color: #555555; }
.admonitionblock > table td.content > :last-child > :last-child { margin-bottom: 0; }

.exampleblock > .content { border-style: solid; border-width: 1px; border-color: #e6e6e6; margin-bottom: 1.25em; padding: 1.25em; background: white; -webkit-border-radius: 0; border-radius: 0; }
.exampleblock > .content > :first-child { margin-top: 0; }
.exampleblock > .content > :last-child { margin-bottom: 0; }

.sidebarblock { border-style: solid; border-width: 1px; border-color: #d9d9d9; margin-bottom: 1.25em; padding: 1.25em; background: #f2f2f2; -webkit-border-radius: 0; border-radius: 0; }
.sidebarblock > :first-child { margin-top: 0; }
.sidebarblock > :last-child { margin-bottom: 0; }
.sidebarblock > .content > .title { color: #6f6f6f; margin-top: 0; }

.exampleblock > .content > :last-child > :last-child, .exampleblock > .content .olist > ol > li:last-child > :last-child, .exampleblock > .content .ulist > ul > li:last-child > :last-child, .exampleblock > .content .qlist > ol > li:last-child > :last-child, .sidebarblock > .content > :last-child > :last-child, .sidebarblock > .content .olist > ol > li:last-child > :last-child, .sidebarblock > .content .ulist > ul > li:last-child > :last-child, .sidebarblock > .content .qlist > ol > li:last-child > :last-child { margin-bottom: 0; }

.literalblock pre, .listingblock pre:not(.highlight), .listingblock pre[class="highlight"], .listingblock pre[class^="highlight "], .listingblock pre.CodeRay, .listingblock pre.prettyprint { background: #eeeeee; }
.sidebarblock .literalblock pre, .sidebarblock .listingblock pre:not(.highlight), .sidebarblock .listingblock pre[class="highlight"], .sidebarblock .listingblock pre[class^="highlight "], .sidebarblock .listingblock pre.CodeRay, .sidebarblock .listingblock pre.prettyprint { background: #f2f1f1; }

.literalblock pre, .literalblock pre[class], .listingblock pre, .listingblock pre[class] { border: 1px solid #cccccc; -webkit-border-radius: 0; border-radius: 0; word-wrap: break-word; padding: 0.8em 0.8em 0.65em 0.8em; font-size: 0.8125em; }
.literalblock pre.nowrap, .literalblock pre[class].nowrap, .listingblock pre.nowrap, .listingblock pre[class].nowrap { overflow-x: auto; white-space: pre; word-wrap: normal; }
@media only screen and (min-width: 768px) { .literalblock pre, .literalblock pre[class], .listingblock pre, .listingblock pre[class] { font-size: 0.90625em; } }
@media only screen and (min-width: 1280px) { .literalblock pre, .literalblock pre[class], .listingblock pre, .listingblock pre[class] { font-size: 1em; } }

.literalblock.output pre { color: #eeeeee; background-color: black; }

.listingblock pre.highlightjs { padding: 0; }
.listingblock pre.highlightjs > code { padding: 0.8em 0.8em 0.65em 0.8em; -webkit-border-radius: 0; border-radius: 0; }

.listingblock > .content { position: relative; }

.listingblock code[data-lang]:before { display: none; content: attr(data-lang); position: absolute; font-size: 0.75em; top: 0.425rem; right: 0.5rem; line-height: 1; text-transform: uppercase; color: #999; }

.listingblock:hover code[data-lang]:before { display: block; }

.listingblock.terminal pre .command:before { content: attr(data-prompt); padding-right: 0.5em; color: #999; }

.listingblock.terminal pre .command:not([data-prompt]):before { content: "$"; }

table.pyhltable { border-collapse: separate; border: 0; margin-bottom: 0; background: none; }

table.pyhltable td { vertical-align: top; padding-top: 0; padding-bottom: 0; }

table.pyhltable td.code { padding-left: .75em; padding-right: 0; }

pre.pygments .lineno, table.pyhltable td:not(.code) { color: #999; padding-left: 0; padding-right: .5em; border-right: 1px solid #dddddd; }

pre.pygments .lineno { display: inline-block; margin-right: .25em; }

table.pyhltable .linenodiv { background: none !important; padding-right: 0 !important; }

.quoteblock { margin: 0 1em 1.25em 1.5em; display: table; }
.quoteblock > .title { margin-left: -1.5em; margin-bottom: 0.75em; }
.quoteblock blockquote, .quoteblock blockquote p { color: #6f6f6f; font-size: 1.15rem; line-height: 1.75; word-spacing: 0.1em; letter-spacing: 0; font-style: italic; text-align: justify; }
.quoteblock blockquote { margin: 0; padding: 0; border: 0; }
.quoteblock blockquote:before { content: "\201c"; float: left; font-size: 2.75em; font-weight: bold; line-height: 0.6em; margin-left: -0.6em; color: #6f6f6f; text-shadow: 0 1px 2px rgba(0, 0, 0, 0.1); }
.quoteblock blockquote > .paragraph:last-child p { margin-bottom: 0; }
.quoteblock .attribution { margin-top: 0.5em; margin-right: 0.5ex; text-align: right; }
.quoteblock .quoteblock { margin-left: 0; margin-right: 0; padding: 0.5em 0; border-left: 3px solid #555555; }
.quoteblock .quoteblock blockquote { padding: 0 0 0 0.75em; }
.quoteblock .quoteblock blockquote:before { display: none; }

.verseblock { margin: 0 1em 1.25em 1em; }
.verseblock pre { font-family: "Open Sans", "DejaVu Sans", sans; font-size: 1.15rem; color: #6f6f6f; font-weight: 300; text-rendering: optimizeLegibility; }
.verseblock pre strong { font-weight: 400; }
.verseblock .attribution { margin-top: 1.25rem; margin-left: 0.5ex; }

.quoteblock .attribution, .verseblock .attribution { font-size: 0.8125em; line-height: 1.45; font-style: italic; }
.quoteblock .attribution br, .verseblock .attribution br { display: none; }
.quoteblock .attribution cite, .verseblock .attribution cite { display: block; letter-spacing: -0.05em; color: #555555; }

.quoteblock.abstract { margin: 0 0 1.25em 0; display: block; }
.quoteblock.abstract blockquote, .quoteblock.abstract blockquote p { text-align: left; word-spacing: 0; }
.quoteblock.abstract blockquote:before, .quoteblock.abstract blockquote p:first-of-type:before { display: none; }

table.tableblock { max-width: 100%; border-collapse: separate; }
table.tableblock td > .paragraph:last-child p > p:last-child, table.tableblock th > p:last-child, table.tableblock td > p:last-child { margin-bottom: 0; }

table.spread { width: 100%; }

table.tableblock, th.tableblock, td.tableblock { border: 0 solid #dddddd; }

table.grid-all th.tableblock, table.grid-all td.tableblock { border-width: 0 1px 1px 0; }

table.grid-all tfoot > tr > th.tableblock, table.grid-all tfoot > tr > td.tableblock { border-width: 1px 1px 0 0; }

table.grid-cols th.tableblock, table.grid-cols td.tableblock { border-width: 0 1px 0 0; }

table.grid-all * > tr > .tableblock:last-child, table.grid-cols * > tr > .tableblock:last-child { border-right-width: 0; }

table.grid-rows th.tableblock, table.grid-rows td.tableblock { border-width: 0 0 1px 0; }

table.grid-all tbody > tr:last-child > th.tableblock, table.grid-all tbody > tr:last-child > td.tableblock, table.grid-all thead:last-child > tr > th.tableblock, table.grid-rows tbody > tr:last-child > th.tableblock, table.grid-rows tbody > tr:last-child > td.tableblock, table.grid-rows thead:last-child > tr > th.tableblock { border-bottom-width: 0; }

table.grid-rows tfoot > tr > th.tableblock, table.grid-rows tfoot > tr > td.tableblock { border-width: 1px 0 0 0; }

table.frame-all { border-width: 1px; }

table.frame-sides { border-width: 0 1px; }

table.frame-topbot { border-width: 1px 0; }

th.halign-left, td.halign-left { text-align: left; }

th.halign-right, td.halign-right { text-align: right; }

th.halign-center, td.halign-center { text-align: center; }

th.valign-top, td.valign-top { vertical-align: top; }

th.valign-bottom, td.valign-bottom { vertical-align: bottom; }

th.valign-middle, td.valign-middle { vertical-align: middle; }

table thead th, table tfoot th { font-weight: bold; }

tbody tr th { display: table-cell; line-height: 1.4; background: whitesmoke; }

tbody tr th, tbody tr th p, tfoot tr th, tfoot tr th p { color: #222222; font-weight: bold; }

p.tableblock > code:only-child { background: none; padding: 0; }

p.tableblock { font-size: 1em; }

td > div.verse { white-space: pre; }

ol { margin-left: 2.5em; }

ul li ol { margin-left: 1.5em; }

dl dd { margin-left: 1.125em; }

dl dd:last-child, dl dd:last-child > :last-child { margin-bottom: 0; }

ol > li p, ul > li p, ul dd, ol dd, .olist .olist, .ulist .ulist, .ulist .olist, .olist .ulist { margin-bottom: 0.625em; }

ul.unstyled, ol.unnumbered, ul.checklist, ul.none { list-style-type: none; }

ul.unstyled, ol.unnumbered, ul.checklist { margin-left: 0.625em; }

ul.checklist li > p:first-child > .fa-check-square-o:first-child, ul.checklist li > p:first-child > input[type="checkbox"]:first-child { margin-right: 0.25em; }

ul.checklist li > p:first-child > input[type="checkbox"]:first-child { position: relative; top: 1px; }

ul.inline { margin: 0 auto 0.625em auto; margin-left: -1.375em; margin-right: 0; padding: 0; list-style: none; overflow: hidden; }
ul.inline > li { list-style: none; float: left; margin-left: 1.375em; display: block; }
ul.inline > li > * { display: block; }

.unstyled dl dt { font-weight: normal; font-style: normal; }

ol.arabic { list-style-type: decimal; }

ol.decimal { list-style-type: decimal-leading-zero; }

ol.loweralpha { list-style-type: lower-alpha; }

ol.upperalpha { list-style-type: upper-alpha; }

ol.lowerroman { list-style-type: lower-roman; }

ol.upperroman { list-style-type: upper-roman; }

ol.lowergreek { list-style-type: lower-greek; }

.hdlist > table, .colist > table { border: 0; background: none; }
.hdlist > table > tbody > tr, .colist > table > tbody > tr { background: none; }

td.hdlist1 { padding-right: .75em; font-weight: bold; }

td.hdlist1, td.hdlist2 { vertical-align: top; }

.literalblock + .colist, .listingblock + .colist { margin-top: -0.5em; }

.colist > table tr > td:first-of-type { padding: 0 0.75em; line-height: 1; }
.colist > table tr > td:last-of-type { padding: 0.25em 0; }

.thumb, .th { line-height: 0; display: inline-block; border: solid 4px white; -webkit-box-shadow: 0 0 0 1px #dddddd; box-shadow: 0 0 0 1px #dddddd; }

.imageblock.left, .imageblock[style*="float: left"] { margin: 0.25em 0.625em 1.25em 0; }
.imageblock.right, .imageblock[style*="float: right"] { margin: 0.25em 0 1.25em 0.625em; }
.imageblock > .title { margin-bottom: 0; }
.imageblock.thumb, .imageblock.th { border-width: 6px; }
.imageblock.thumb > .title, .imageblock.th > .title { padding: 0 0.125em; }

.image.left, .image.right { margin-top: 0.25em; margin-bottom: 0.25em; display: inline-block; line-height: 0; }
.image.left { margin-right: 0.625em; }
.image.right { margin-left: 0.625em; }

a.image { text-decoration: none; }

span.footnote, span.footnoteref { vertical-align: super; font-size: 0.875em; }
span.footnote a, span.footnoteref a { text-decoration: none; }
span.footnote a:active, span.footnoteref a:active { text-decoration: underline; }

#footnotes { padding-top: 0.75em; padding-bottom: 0.75em; margin-bottom: 0.625em; }
#footnotes hr { width: 20%; min-width: 6.25em; margin: -.25em 0 .75em 0; border-width: 1px 0 0 0; }
#footnotes .footnote { padding: 0 0.375em; line-height: 1.3; font-size: 0.875em; margin-left: 1.2em; text-indent: -1.2em; margin-bottom: .2em; }
#footnotes .footnote a:first-of-type { font-weight: bold; text-decoration: none; }
#footnotes .footnote:last-of-type { margin-bottom: 0; }

#content #footnotes { margin-top: -0.625em; margin-bottom: 0; padding: 0.75em 0; }

.gist .file-data > table { border: 0; background: #fff; width: 100%; margin-bottom: 0; }
.gist .file-data > table td.line-data { width: 99%; }

div.unbreakable { page-break-inside: avoid; }

.big { font-size: larger; }

.small { font-size: smaller; }

.underline { text-decoration: underline; }

.overline { text-decoration: overline; }

.line-through { text-decoration: line-through; }

.aqua { color: #00bfbf; }

.aqua-background { background-color: #00fafa; }

.black { color: black; }

.black-background { background-color: black; }

.blue { color: #0000bf; }

.blue-background { background-color: #0000fa; }

.fuchsia { color: #bf00bf; }

.fuchsia-background { background-color: #fa00fa; }

.gray { color: #606060; }

.gray-background { background-color: #7d7d7d; }

.green { color: #006000; }

.green-background { background-color: #007d00; }

.lime { color: #00bf00; }

.lime-background { background-color: #00fa00; }

.maroon { color: #600000; }

.maroon-background { background-color: #7d0000; }

.navy { color: #000060; }

.navy-background { background-color: #00007d; }

.olive { color: #606000; }

.olive-background { background-color: #7d7d00; }

.purple { color: #600060; }

.purple-background { background-color: #7d007d; }

.red { color: #bf0000; }

.red-background { background-color: #fa0000; }

.silver { color: #909090; }

.silver-background { background-color: #bcbcbc; }

.teal { color: #006060; }

.teal-background { background-color: #007d7d; }

.white { color: #bfbfbf; }

.white-background { background-color: #fafafa; }

.yellow { color: #bfbf00; }

.yellow-background { background-color: #fafa00; }

span.icon > .fa { cursor: default; }

.admonitionblock td.icon [class^="fa icon-"] { font-size: 2.5em; text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.5); cursor: default; }
.admonitionblock td.icon .icon-note:before { content: "\f05a"; color: #207c98; }
.admonitionblock td.icon .icon-tip:before { content: "\f0eb"; text-shadow: 1px 1px 2px rgba(155, 155, 0, 0.8); color: #111; }
.admonitionblock td.icon .icon-warning:before { content: "\f071"; color: #bf6900; }
.admonitionblock td.icon .icon-caution:before { content: "\f06d"; color: #bf3400; }
.admonitionblock td.icon .icon-important:before { content: "\f06a"; color: #bf0000; }

.conum[data-value] { display: inline-block; color: #fff !important; background-color: #222222; -webkit-border-radius: 100px; border-radius: 100px; text-align: center; font-size: 0.75em; width: 1.67em; height: 1.67em; line-height: 1.67em; font-family: "Open Sans", "DejaVu Sans", sans-serif; font-style: normal; font-weight: bold; }
.conum[data-value] * { color: #fff !important; }
.conum[data-value] + b { display: none; }
.conum[data-value]:after { content: attr(data-value); }
pre .conum[data-value] { position: relative; top: -0.125em; }

b.conum * { color: inherit !important; }

.conum:not([data-value]):empty { display: none; }

.literalblock pre, .listingblock pre { background: #eeeeee; }

</style>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.2.0/css/font-awesome.min.css">
<style>.listingblock .pygments .hll { background-color: #ffffcc }
.listingblock .pygments  { background: #f8f8f8; }
.listingblock .pygments .tok-c { color: #408080; font-style: italic } /* Comment */
.listingblock .pygments .tok-err { border: 1px solid #FF0000 } /* Error */
.listingblock .pygments .tok-k { color: #008000; font-weight: bold } /* Keyword */
.listingblock .pygments .tok-o { color: #666666 } /* Operator */
.listingblock .pygments .tok-cm { color: #408080; font-style: italic } /* Comment.Multiline */
.listingblock .pygments .tok-cp { color: #BC7A00 } /* Comment.Preproc */
.listingblock .pygments .tok-c1 { color: #408080; font-style: italic } /* Comment.Single */
.listingblock .pygments .tok-cs { color: #408080; font-style: italic } /* Comment.Special */
.listingblock .pygments .tok-gd { color: #A00000 } /* Generic.Deleted */
.listingblock .pygments .tok-ge { font-style: italic } /* Generic.Emph */
.listingblock .pygments .tok-gr { color: #FF0000 } /* Generic.Error */
.listingblock .pygments .tok-gh { color: #000080; font-weight: bold } /* Generic.Heading */
.listingblock .pygments .tok-gi { color: #00A000 } /* Generic.Inserted */
.listingblock .pygments .tok-go { color: #888888 } /* Generic.Output */
.listingblock .pygments .tok-gp { color: #000080; font-weight: bold } /* Generic.Prompt */
.listingblock .pygments .tok-gs { font-weight: bold } /* Generic.Strong */
.listingblock .pygments .tok-gu { color: #800080; font-weight: bold } /* Generic.Subheading */
.listingblock .pygments .tok-gt { color: #0044DD } /* Generic.Traceback */
.listingblock .pygments .tok-kc { color: #008000; font-weight: bold } /* Keyword.Constant */
.listingblock .pygments .tok-kd { color: #008000; font-weight: bold } /* Keyword.Declaration */
.listingblock .pygments .tok-kn { color: #008000; font-weight: bold } /* Keyword.Namespace */
.listingblock .pygments .tok-kp { color: #008000 } /* Keyword.Pseudo */
.listingblock .pygments .tok-kr { color: #008000; font-weight: bold } /* Keyword.Reserved */
.listingblock .pygments .tok-kt { color: #B00040 } /* Keyword.Type */
.listingblock .pygments .tok-m { color: #666666 } /* Literal.Number */
.listingblock .pygments .tok-s { color: #BA2121 } /* Literal.String */
.listingblock .pygments .tok-na { color: #7D9029 } /* Name.Attribute */
.listingblock .pygments .tok-nb { color: #008000 } /* Name.Builtin */
.listingblock .pygments .tok-nc { color: #0000FF; font-weight: bold } /* Name.Class */
.listingblock .pygments .tok-no { color: #880000 } /* Name.Constant */
.listingblock .pygments .tok-nd { color: #AA22FF } /* Name.Decorator */
.listingblock .pygments .tok-ni { color: #999999; font-weight: bold } /* Name.Entity */
.listingblock .pygments .tok-ne { color: #D2413A; font-weight: bold } /* Name.Exception */
.listingblock .pygments .tok-nf { color: #0000FF } /* Name.Function */
.listingblock .pygments .tok-nl { color: #A0A000 } /* Name.Label */
.listingblock .pygments .tok-nn { color: #0000FF; font-weight: bold } /* Name.Namespace */
.listingblock .pygments .tok-nt { color: #008000; font-weight: bold } /* Name.Tag */
.listingblock .pygments .tok-nv { color: #19177C } /* Name.Variable */
.listingblock .pygments .tok-ow { color: #AA22FF; font-weight: bold } /* Operator.Word */
.listingblock .pygments .tok-w { color: #bbbbbb } /* Text.Whitespace */
.listingblock .pygments .tok-mb { color: #666666 } /* Literal.Number.Bin */
.listingblock .pygments .tok-mf { color: #666666 } /* Literal.Number.Float */
.listingblock .pygments .tok-mh { color: #666666 } /* Literal.Number.Hex */
.listingblock .pygments .tok-mi { color: #666666 } /* Literal.Number.Integer */
.listingblock .pygments .tok-mo { color: #666666 } /* Literal.Number.Oct */
.listingblock .pygments .tok-sb { color: #BA2121 } /* Literal.String.Backtick */
.listingblock .pygments .tok-sc { color: #BA2121 } /* Literal.String.Char */
.listingblock .pygments .tok-sd { color: #BA2121; font-style: italic } /* Literal.String.Doc */
.listingblock .pygments .tok-s2 { color: #BA2121 } /* Literal.String.Double */
.listingblock .pygments .tok-se { color: #BB6622; font-weight: bold } /* Literal.String.Escape */
.listingblock .pygments .tok-sh { color: #BA2121 } /* Literal.String.Heredoc */
.listingblock .pygments .tok-si { color: #BB6688; font-weight: bold } /* Literal.String.Interpol */
.listingblock .pygments .tok-sx { color: #008000 } /* Literal.String.Other */
.listingblock .pygments .tok-sr { color: #BB6688 } /* Literal.String.Regex */
.listingblock .pygments .tok-s1 { color: #BA2121 } /* Literal.String.Single */
.listingblock .pygments .tok-ss { color: #19177C } /* Literal.String.Symbol */
.listingblock .pygments .tok-bp { color: #008000 } /* Name.Builtin.Pseudo */
.listingblock .pygments .tok-vc { color: #19177C } /* Name.Variable.Class */
.listingblock .pygments .tok-vg { color: #19177C } /* Name.Variable.Global */
.listingblock .pygments .tok-vi { color: #19177C } /* Name.Variable.Instance */
.listingblock .pygments .tok-il { color: #666666 } /* Literal.Number.Integer.Long */
</style>
</head>
<body class="article toc2 toc-left">
<div id="header">
<h1>Servidores web y PaaS</h1>
<div class="details">
<span id="author" class="author">José Luis Zamora Sánchez</span><br>
<span id="email" class="email">&lt;<a href="mailto:joseluiszamora.jlz@gmail.com">joseluiszamora.jlz@gmail.com</a>&gt;</span><br>
</div>
<div id="toc" class="toc2">
<div id="toctitle">Índice de contenidos</div>
<ul class="sectlevel1">
<li><a href="#sesion08">8. Integración continua y escalabilidad</a>
<ul class="sectlevel2">
<li><a href="#_escalabilidad">8.1. Escalabilidad</a>
<ul class="sectlevel3">
<li><a href="#_autoescalado_en_openshift">8.1.1. Autoescalado en OpenShift</a></li>
<li><a href="#_definir_una_aplicaci%C3%B3n_como_escalable">8.1.2. Definir una aplicación como escalable</a></li>
<li><a href="#_ajustar_la_configuraci%C3%B3n_de_escalado">8.1.3. Ajustar la configuración de escalado</a></li>
<li><a href="#_monitorizaci%C3%B3n_del_balanceador">8.1.4. Monitorización del balanceador</a></li>
<li><a href="#_configuraci%C3%B3n_de_haproxy">8.1.5. Configuración de HAProxy</a></li>
</ul>
</li>
<li><a href="#_devops">8.2. DevOps</a>
<ul class="sectlevel3">
<li><a href="#_introducci%C3%B3n">8.2.1. Introducción</a></li>
<li><a href="#_devops_y_cloud_computing">8.2.2. DevOps y Cloud Computing</a></li>
<li><a href="#_integraci%C3%B3n_continua_ci_con_jenkins">8.2.3. Integración continua (CI) con Jenkins</a></li>
<li><a href="#_como_trabajar_contra_un_repositorio_de_bitbucket">8.2.4. Como trabajar contra un repositorio de Bitbucket</a></li>
<li><a href="#_alternativas_a_jenkins">8.2.5. Alternativas a Jenkins</a></li>
<li><a href="#_deployment_pipeline">8.2.6. Deployment pipeline</a></li>
</ul>
</li>
<li><a href="#_referencias">8.3. Referencias</a></li>
<li><a href="#_ejercicios_de_integraci%C3%B3n_continua_y_escalabilidad">8.4. Ejercicios de Integración continua y escalabilidad</a>
<ul class="sectlevel3">
<li><a href="#_despliegue_de_una_aplicaci%C3%B3n_escalable_0_2_puntos">8.4.1. Despliegue de una aplicación escalable (0.2 Puntos)</a></li>
<li><a href="#_prueba_de_estr%C3%A9s_0_4_puntos">8.4.2. Prueba de Estrés ( 0.4 puntos)</a></li>
<li><a href="#_integraci%C3%B3n_continua_0_2_puntos">8.4.3. Integración continua (0.2 puntos)</a></li>
<li><a href="#_pruebas_con_arquillian_0_4_puntos">8.4.4. Pruebas con Arquillian (0.4 puntos)</a></li>
<li><a href="#_entrega">8.4.5. Entrega</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
</div>
<div id="content">
<div id="preamble">
<div class="sectionbody">
<div style="page-break-after: always;"></div>
</div>
</div>
<div class="sect1">
<h2 id="sesion08">8. Integración continua y escalabilidad</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_escalabilidad">8.1. Escalabilidad</h3>
<div class="paragraph">
<p>Ya sabemos que OpenShift nos permite trabajar con diferentes tipos de gear con diferentes tamaños de memoría, y recientemente capacidad de proceso (small high cpu),  pero la forma natural de aumentar la capacidad de proceso de las aplicaciones en PaaS y en OpenShift es el llamado escalado horizontal, o lo que es lo mismo, que nuestra aplicación se ejecute en múltiples servidores simultáneamente.</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="images/paas07/scale1.png" alt="scale1" width="50%">
</div>
<div class="title">Figure 1. Escalabilidad vertical contra escalabilidad horizontal</div>
</div>
<div class="sect3">
<h4 id="_autoescalado_en_openshift">8.1.1. Autoescalado en OpenShift</h4>
<div class="paragraph">
<p>Primero de todo aclarar que el que una aplicación sea escalable no implica que el autoescalado esté activado pero es que Openshift, por defecto gestiona automáticamente la escalabilidad de las aplicaciones, y lo hace de la siguiente forma:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Introduce un elemento en el gear de la aplicación denominado HAProxy y su función es la de balanceador de carga por software. Este componente analiza el tráfico web entrante y lo reenvía al gear de la aplicación.</p>
</li>
<li>
<p>Por defecto OpenShift asigna un máximo de 16 conexiones por gear. Cuando HAProxy detecta que se alcanza un 90% de ocupación de estas conexiones de forma sostenida,  dispara un evento para la creación de forma automática de un nuevo gear que pueda ayudar a tratar la carga de trabajo creciente.</p>
</li>
<li>
<p>Mediante la herramienta <em>rsync</em>, OpenShift copia la configuración, el código y los ficheros empaquetados de la aplicación a un nuevo gear y arranca una nueva instancia del servidor de aplicaciones.</p>
</li>
<li>
<p>Si HAProxy detecta una bajada del número de conexiones por debajo del 50% del maximo, durante un tiempo predefinido,  desencadena la eliminación de los gear replicados hasta que se alcance una situación estable o bien se alcance el mínimo de gears activos configurados.</p>
</li>
</ol>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="images/paas07/scale4.png" alt="scale4" width="50%">
</div>
<div class="title">Figure 2. Aplicación escalable</div>
</div>
<div class="paragraph">
<p>Como vemos en la imagen, las aplicaciones escalables situan el backend en un gear independiente a las aplicaciones, en contraposición con las aplicaciones que hemos visto hasta ahora, en las que middleware y backend comparten gear. Esto es necesario para que todos los gear replicados puedan acceder a la base de datos concurrentemente.  OpenShift elige la ubicación de la base de datos de forma automática, en función del tipo de aplicación.</p>
</div>
<div class="paragraph">
<p>HAProxy por defecto utiliza el algoritmo <em>leastconn</em> para repartir las conexiones entre los gear activos, y su forma de trabajar es asignar una nueva conexión al gear que tenga menos conexiones activas en ese momento. Este comportamiento se puede modificar, como veremos más adelante.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="title">¿Y si hago cambios en el código de una aplicación escalable?</div>
si hacemos un cambio en el código de una aplicación y lo subimos con un comando <em>push</em> de git, iniciaremos la compilación de la aplicación en el gear primario, y una vez compilada que se sincronicen los cambios entre todos los gears activos con el comando <em>rsync</em>.
</td>
</tr>
</table>
</div>
<div class="sect4">
<h5 id="_motivos_para_definir_las_aplicaciones_como_escalables_por_defecto">Motivos para definir las aplicaciones como escalables por defecto</h5>
<div class="ulist">
<ul>
<li>
<p>Mayor rendimiento al tener cada servidor y cada BD en un gear dedicado.</p>
</li>
<li>
<p>Aunque a priori no sea necesario, el configurar una aplicación como escalable permite que llegado el momento se pueda incrementar la capacidad de proceso.</p>
</li>
<li>
<p>Permite autoescalado y escalado manual, en el caso de que sepamos que va a producirse un aumento importante de la carga de trabajo.</p>
</li>
<li>
<p><strong>No</strong> existe un comando que convierta una aplicación no escalable en escalable. Sólo se puede configurar como escalable en el momento de crear la aplicación.</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="_otras_ventajas">Otras ventajas</h5>
<div class="ulist">
<ul>
<li>
<p>Alta disponibilidad. Si una instancia de servidor falla, HAProxy repartirá la carga de trabajo entre el resto de instancias que estén operativas. No está documentado que haya ningún proceso automático que reinicie las instancias en caso de caída.</p>
</li>
<li>
<p>Replicación de la sesión: Si trabajamos con JBoss/Wildfly podemos beneficiarnos de la replica de la información de sesión entre los gears de la aplicación. Esto permite que si un servidor cae, la información de sesión se pueda recuperar de otra instancia. Para ello se utiliza una mecanismo de caché distribuida llamado Infinispan. Para habilitar este mecanismo hay que hacer un pequeño cambio en el fichero web.xml de las aplicaciones:</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><span class="tok-nt">&lt;web-app&gt;</span>
   <span class="tok-nt">&lt;distributable/&gt;</span>
<span class="tok-nt">&lt;/web-app&gt;</span></code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>El uso de una caché distribuida permite compartir información entre nodos leyendo y escribiendo elementos con los métodos <em>put/get</em>.</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span class="tok-nd">@Resource</span><span class="tok-o">(</span><span class="tok-n">lookup</span><span class="tok-o">=</span><span class="tok-s">&quot;java:jboss/infinispan/container/cluster&quot;</span><span class="tok-o">)</span>
<span class="tok-kd">private</span> <span class="tok-n">CacheContainer</span> <span class="tok-n">container</span><span class="tok-o">;</span>

<span class="tok-c1">// A partir de este punto se pueden utilizar los métodos get() y put() para acceder y almacenar elementos en la caché.</span></code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_definir_una_aplicación_como_escalable">8.1.2. Definir una aplicación como escalable</h4>
<div class="paragraph">
<p>Como ya hemos comentado, sólo es posible configurar una aplicación como escalable en el momento de su creación. Como siempre, tenemos dos opciones:</p>
</div>
<div class="paragraph">
<p>Desde la consola web:</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="images/paas07/scale5.png" alt="scale5">
</div>
</div>
<div class="paragraph">
<p>Desde un terminal con la herramienta rhc:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="console"><span class="tok-go">rhc rhc app create &lt;app&gt; &lt;cartridges&gt;... -s</span></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_ajustar_la_configuración_de_escalado">8.1.3. Ajustar la configuración de escalado</h4>
<div class="paragraph">
<p>Por defecto las aplicaciones utilizan un gear para la aplicación, más otro adicional si existe una base de datos. Para ajustar el número máximo y mínimo de gears debemos entrar en la configuración de nuestra aplicación y hacer click sobre los valores del apartado scales:</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="images/paas07/scale6.png" alt="scale6">
</div>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="images/paas07/scale3.png" alt="scale3">
</div>
</div>
<div class="paragraph">
<p>Alternativamente podemos utilizar el comando rhc donde habrá que especificar el cartridge concreto a escalar, la aplicación y el rango de valores.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="console"><span class="tok-go">rhc cartridge-scale &lt;cartridge a configurar&gt; -a &lt;your app&gt; --min &lt;minimum&gt; --max &lt;maximum&gt;</span></code></pre>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
Si especificamos como máximo -1, estamos indicando que nuestro máximo será el número máximo de gears que nos permita nuestra cuenta.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Una vez creada y en ejecución podemos ajustar manualmente el número de gears con los comandos:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="console"><span class="tok-go">rhc app scale-up &lt;app&gt;</span>
<span class="tok-go">rhc app scale-down &lt;app&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Por último, si queremos desactivar el autoescalado, y que seamos nosotros los únicos que gestionemos el número de gears debemos hacerlo a través de nuestra copia del repositorio Git. Debemos entrar en la ruta</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="console"><span class="tok-go">cd &lt;app&gt;/.openshift/markers</span>
<span class="tok-go">touch disable_auto_scaling</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Con esto crearemos un fichero marcador, de nombre <em>disable_auto_scaling</em>, que debemos subir al repositorio con un commit y un push.</p>
</div>
</div>
<div class="sect3">
<h4 id="_monitorización_del_balanceador">8.1.4. Monitorización del balanceador</h4>
<div class="paragraph">
<p>HAProxy ofrece la posibilidad de consultar datos acumulados sobre la carga de trabajo que está gestionando nuestra aplicación. Podemos acceder a dicha información accediendo a la URL: <a href="http://&lt;app&gt;-&lt;domain&gt;.rhcloud.com/haproxy-status" class="bare">http://&lt;app&gt;-&lt;domain&gt;.rhcloud.com/haproxy-status</a></p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="images/paas07/scale7.png" alt="scale7">
</div>
</div>
<div class="paragraph">
<p>De esta página nos interesa la segunda tabla, concretamente la fila local gear donde se muestra la información relativa al gear donde se ejecuta nuestra aplicación. En situaciones donde se requieran gear adicionales, aparecerán nuevas entradas en dicha tabla.</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="images/paas07/scale8.png" alt="scale8">
</div>
</div>
<div class="paragraph">
<p>Cada gear se presentará en un color en función del estado en el que se encuentre.</p>
</div>
</div>
<div class="sect3">
<h4 id="_configuración_de_haproxy">8.1.5. Configuración de HAProxy</h4>
<div class="paragraph">
<p>HAProxy mantiene su configuración en un fichero haproxy.cfg que se ha de modificar directamente en el gear principal de la aplicación. Para ello hay que iniciar una sesión ssh y acceder a la carpeta de configuración haproxy/conf:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="console"><span class="tok-gp">$</span> rhc ssh &lt;app&gt;
<span class="tok-gp">$</span> <span class="tok-nb">cd </span>haproxy/conf
<span class="tok-gp">$</span> vi haproxy.cfg</code></pre>
</div>
</div>
<div class="paragraph">
<p>En este fichero podemos modificar entre otras cosas el algoritmo de reparto de carga. Si realizamos algún cambio en la configuración tendremos que reiniciar el cartridge correspondiente al balanceador.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="console"><span class="tok-gp">$</span> rhc cartridge-restart --cartridge haproxy -a &lt;app&gt;</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_devops">8.2. DevOps</h3>
<div class="sect3">
<h4 id="_introducción">8.2.1. Introducción</h4>
<div class="paragraph">
<p>El uso de metodologías ágiles en el desarrollo de aplicaciones es algo relativamente habitual en la actualidad.  Estas metodologias favorecen las entregas parciales al usuario final y permite que éste haga cambios en los requermientos, en función de sus necesidades. El problema lo tenemos cuando en lugar de facilitar un producto instalable, resulta que debemos proporcionar la infraestructura necesaria para hacerlo funcionar, como es el caso de grandes empresas. Y es que tradicionalmente desarrollo y sistemas suelen ser dos bandos con intereses contrapuestos:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><em>Desarrollo</em>: quiero construir y publicar lo que me pide el negocio con agilidad.</p>
</li>
<li>
<p><em>Explotación</em>: me miden por el coste y disponibilidad. No quiero riesgos.</p>
</li>
</ul>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="images/paas08/WallOfConfusion.png" alt="WallOfConfusion" width="50%">
</div>
</div>
<div class="paragraph">
<p>Como ejemplo, en un banco podemos encontrarnos con que desde negocio se presiona para poner en marcha un nuevo servicio a clientes. Como respuesta, un equipo de desarrollo comienza a trabajar en el nuevo proyecto. Internamente pueden utilizar la metodología en cascada o incluso metodologías ágiles para proporcionar al usuario interno, distintas entregas del proyecto pero si hablamos de desplegar una aplicación en producción entonces es cuando comienzan las fricciones:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><em>Desarrollo</em>:  Perciben demasiada burocracia,  falta de permisos en producción (monitorización, incidencias), lentitud en los traspasos.</p>
</li>
<li>
<p><em>Explotación</em>: Consideran que les falta información acerca de las aplicaciones que luego tienen que soportar, procedimientos de despliegue mal documentados o con errores, incertidumbre.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>DevOps es un propósito de reconducir esa situación planteando la participación efectiva de los administradores de sistemas en el proceso de desarrollo de aplicaciones, utilizando las mismas metodologías ágiles que los desarrolladores.</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="images/paas08/devops3.png" alt="devops3" width="50%">
</div>
</div>
<div class="paragraph">
<p>Dentro de una organización se podría identificar la madurez de implantación de DevOps mediante el siguiente gráfico:</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="images/paas08/devops2.png" alt="devops2" width="50%">
</div>
</div>
<div class="paragraph">
<p>El escalón más básico consiste en la adopción de metodologías ágiles no sólo para la construcción del proyecto sino también para la definición de la infraestructura necesaria para su funcionamiento (infraestructura como script). El siguiente nivel sería la automatización de la integración de cambios en infraestructura y aplicación, y por último el despliegue continuo. La entrega continua implica que dejen de existir las versiones como tal de las aplicaciones y que las nuevas funcionalidades que se desarrollen pasen por un exahustivo proceso automático de validación y despliegue en producción.</p>
</div>
<div class="paragraph">
<p>Note: Continous Delivery es un concepto más genérico que Continuous Deployment. El primero hace referencia a todos los aspectos que permiten hacer despliegues por funcionalidad mientras que el segundo se refiere en sí al proceso técnico de ante un cambio en la aplicación, iniciar el despliegue en producción.</p>
</div>
<div class="paragraph">
<p>En resumen DevOps pretende mejorar la productividad potenciando el trabajo colaborativo dentre desarrolladores y técnicos de sistemas permitiendo que:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Desarrollo se concentre en la construcción de las aplicaciones.</p>
</li>
<li>
<p>Operaciones se concentre en la creación de entornos estandarizados.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_devops_y_cloud_computing">8.2.2. DevOps y Cloud Computing</h4>
<div class="paragraph">
<p>La gran ventaja de las grandes plataformas IaaS y PaaS frente a la informática tradicional es que resuelven gran parte del trabajo de estandarización de entornos y de procesos. Las prácticas que hemos comentado forman parte de los recursos que la propia arquitectura ofrece al administrador de sistemas con lo que simplifica su utilización:</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="images/paas08/devops1.png" alt="devops1">
</div>
</div>
<div class="paragraph">
<p>En el caso concreto de OpenShift, ya sabemos que tanto la creación de gears como cualquier aspecto de configuración es susceptible de automatizarse mediante script y que en su concepción más básica se utiliza el despliegue continuo. A continuación veremos como aplicar también integración continua, pruebas automatizadas y cómo poder definir una build pipeline.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Las herramientas de integración continua, automatización de pruebas, metodologías por si mismas justificarían varias sesiones con lo que hablaremos de los aspecto más importantes y nos centraremos en su implementación en OpenShift.
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_integración_continua_ci_con_jenkins">8.2.3. Integración continua (CI) con Jenkins</h4>
<div class="paragraph">
<p>Entendemos por integración continua un sistema que ejecuta, ante un cambio en una aplicación, la compilación y ejecución automática de un conjunto de pruebas. Si la aplicación compila correctamente y supera las pruebas, la aplicación se considera apta para el despliegue (habitualmente en un entorno desarrollo o integración), pero por el contrario, si no se supera, se deja constancia del error y no se altera la versión de la aplicacion que actualmente está ejecutándose en el siguiente entorno de trabajo.</p>
</div>
<div class="paragraph">
<p>Para aplicar integración continua en un proyecto, necesitaremos herramientas ya conocidas como control de versiones (Git, SVN, etc.) , compilación (desde javac hasta Maven, Gradle) y ejecución de pruebas, pero también necesitaremos una aplicación denominada servidor de CI. Por defecto OpenShift utiliza Jenkins, aunque no nos impide que instalemos cualquier otro producto.</p>
</div>
<div class="paragraph">
<p>El uso de Jenkins está muy integrado en OpenShift en tanto desde la consola web basta con decir que indicar que queremo utilizar integración contínua para una de nuestras aplicaciones, para que el sistema configure los servicios necesarios para comenzar a trabajar con Jenkins.</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="images/paas08/ci1.png" alt="ci1">
</div>
</div>
<div class="paragraph">
<p>Al activar Jenkins se creará un nuevo gear específico para el servidor de CI y se configurará una tarea específica para compilar la aplicación a través de Jenkins. Al crear el servidor Jenkins se nos informa de una URL para acceder a su configuración y un usuario/password para poder identificarnos como administrador.</p>
</div>
<div class="sect4">
<h5 id="_introducción_a_jenkins">Introducción a Jenkins</h5>
<div class="paragraph">
<p>En el caso de Jenkins podemos entenderlo como una herramienta de ejecución y monitorización de jobs, en un sentido más amplio que la compilación y despliegue de aplicaciones. Si accedemos a la consola de Jenkins, nos encontraremos una pantalla similar a la siguiente:</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="images/paas08/ci2.png" alt="ci2">
</div>
</div>
<div class="paragraph">
<p>En la parte principal de la pantalla veremos una tabla en la que aparece una única entrada con el mismo nombre que nuestra aplicación  y una serie de métricas, inicialmente sin datos. Lo primero que hay que entender es que para Jenkins, cada aplicación que se construye se denomina <strong>tarea</strong> y  cada vez que se active dicha tarea se genera una <strong>compilación</strong>. Si instalamos Jenkins en nuestra propia infraestructura debemos configurar entre otras cosas:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Rutas de las distintas herramientas que intervienen en la construcción de los proyectos.</p>
</li>
<li>
<p>Seguridad básica de Jenkins.</p>
</li>
<li>
<p>Las tareas necesarias para compilar.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Con OpenShift tenemos la ventaja de que estas tres cosas ya están preconfiguradas y listas para funcionar desde el primer momento. Si pulsamos en el icono de "Programar una ejecución", activaremos manualmente la tarea y comenzaremos a construir la aplicación. En la parte izquierda de la pantalla se mostrará una barra de progreso donde podemos ver el avance de la construcción y si pulsamos en <em>Console Output</em> podremos ver exactamente la salida por consola del script de compilación.</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="images/paas08/ci3.png" alt="ci3">
</div>
</div>
<div class="paragraph">
<p>Una de las características más importantes de Jenkins es que almacena toda la información relativa a la construcción de una aplicación (compilación, pruebas, despliegue), no sólo la muestra en tiempo real.</p>
</div>
<div class="paragraph">
<p>Si dentro de una tarea pulsamos en <em>Configurar</em> se nos muestra un formulario donde se puede parametrizar casi cualquier aspecto de la construcción de la aplicación. Entre otros aspectos:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Definición y descripción de la tarea</dt>
<dd>
<p>Datos identificativos del proyecto.</p>
</dd>
<dt class="hdlist1">Builder a utilizar</dt>
<dd>
<p>Al activarse una tarea se crea dinámicamente un nuevo gear que se encarga específicamente de la construcción de la aplicación.</p>
</dd>
<dt class="hdlist1">Disparadores de ejecuciones</dt>
<dd>
<p>Podemos configurar si queremos que nuestra tarea se active mediante un script, al finalizar otras tareas, periódicamente o cuando se produzca un cambio en un repositorio.</p>
</dd>
<dt class="hdlist1">Ejecución</dt>
<dd>
<p>Es un area donde se muestra el sh que se va a ejecutar y se nos permite su total edición.
Post Ejecución: Podemos definir comandos adicionales que se ejecuten al finalizar correctamente una tarea.</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>Una vez se haya ejecutado una tarea, veremos que en la pantalla principal aparecen dos iconos asociados a la tarea. El primero de ellos indica si la última compilación ha sido OK o KO, y el segundo muestra una tendencia, en forma de icono de "previsión meteorológica". Si todo va bien, se muestra un icono soleado, pero si se van produciendo errores de compilación, el icono va cambiando hasta mostrar una "tormenta".</p>
</div>
<div class="paragraph">
<p>Por último, comentar que Jenkins se puede extender mediante plugins y existe un conjunto muy numeroso de ellos por lo que es un servidor de CI que se puede adaptar a multitud de proyectos. Existen los plugin de tipo <em>publisher</em> que permiten mostrar información extendida sobre las tareas ejecutadas de forma visual. Es el caso del plugi de <em>Cobertura</em> que muestra gráficamente el grado de cobertura de las pruebas unitarias definidas para una aplicación.</p>
</div>
<div class="paragraph">
<p>Otro plugin interesante es el <em>Pipeline plugin</em> que permite representar un conjunto de tareas interrelacionadas de forma visual. Concretamente se suele utilizar en para representar los Deployment Pipeline de los procesos de Continuous Delivery.</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="images/paas08/ci4.png" alt="ci4">
</div>
</div>
</div>
<div class="sect4">
<h5 id="_uso_de_jenkins_en_openshift">Uso de Jenkins en OpenShift</h5>
<div class="paragraph">
<p>Por defecto Jenkins se configura  utilizando un Gear para el propio servidor y otro Gear "esclavo" para cada trabajo de compilación. Esto puede ser una limitación muy importante en el caso de trabajar con el  plan gratuito pero veremos formas de paliar este problema. La ventaja de utilizar un Gear específico para compilar es que no estamos parando la aplicación en ningún momento, ni consumiendo parte de sus recursos en la construcción de la aplicación, y si se produce un fallo en el proceso no llega a afectar a la aplicación en ejecucuión.</p>
</div>
<div class="paragraph">
<p>Los eventos que se suceden cuando un usuario hace un cambio sobre una aplicación que trabaja con CI en OpenShift son los siguientes:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>El desarrollador hace <em>push</em> de un cambio al repositorio de la aplicación.</p>
</li>
<li>
<p>Jenkins recibe una notificación de que se ha hecho un cambio en el repositorio de fuentes.</p>
</li>
<li>
<p>A continuación Jenkins crea un gear esclavo para construir la aplicación. Desde ese momento el nuevo gear se puede ver tanto con el comando <em>rhc domain show</em> como accediendo a la consola web. El nombre de la aplicación será el nombre original añadiéndole "bldr" (builder). Este mecanismo tiene una limitación y es que los 28 primeros caracteres de las aplicaciones deben ser únicos o existe riesgo de que en lugar de crear un builder nuevo, se comparta entre las aplicaciones coincidentes.</p>
</li>
<li>
<p>Jenkins ejecuta la tarea de compilación sobre el gear.</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Se descarga el código fuente del repositorio git y mediante el comando <em>rsync</em> se copian las librerías asociadas al proyecto que existieran en la aplicación.</p>
</li>
<li>
<p>Se ejecuta el script ci_build.sh que inicia el proceso de compilación en la máquina builder.</p>
<div class="olist lowerroman">
<ol class="lowerroman" type="i">
<li>
<p>Se ejecutan los script  .openshift/action_hooks/pre_build definidos para la aplicación antes de la construcción.</p>
</li>
<li>
<p>Se construye la aplicación ejecutando todos los pasos de construcción definidos en la tarea de Jenkins.</p>
</li>
<li>
<p>Se ejecutan los script  .openshift/action_hooks/build definidos para la aplicación después de la construcción.</p>
</li>
</ol>
</div>
</li>
<li>
<p>Ejecución de pasos adicionales post compilación  que el desarrollador pueda haber definido.</p>
</li>
</ol>
</div>
</li>
<li>
<p>Una vez construida la aplicación con éxito, Jenkins solicita la parada de la aplicación en ejecución.</p>
</li>
<li>
<p>Mediante <em>rsync</em> se copian los nuevos artefactos compilados al gear de la aplicación.</p>
</li>
<li>
<p>Jenkins inicia de nuevo el gear.</p>
</li>
<li>
<p>Se archiva toda la información del proceso de build en Jenkins.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Pasados 15 minutos sin actividad el builder se destruye automáticamente aunque la información de los procesos de build se mantienen en el gear principal de Jenkins.</p>
</div>
<div class="paragraph">
<p>Además de poder acceder a la consola de las build para analizar el proceso de construcción de una aplicación, en el caso de que algo no funcione como debe, tenemos a nuestra disposición el log de Jenkins, el cual podemos consultar mediante el  comando habitual de OpenShift:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="console"><span class="tok-go">rhc tail jenkins</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Por su parte, si la aplicación no se despliega correctamente podemos consultar el log del gear de la aplicación.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="console"><span class="tok-go">rhc tail &lt;app&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Por último, mencionar que la construcción de la aplicación se realiza con los parámetros por defecto de OpenShift (<em>mvn -e clean package -Popenshift -DskipTests'</em>), por lo que por defecto no se ejecutarán ningún caso de prueba de JUnit u otras herramientas que queramos utilizar. Para poder habilitarlas, dentro del código de la build hay una sección con un comentario:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="console"><span class="tok-gp">#</span> Run tests here</code></pre>
</div>
</div>
<div class="paragraph">
<p>A continuación podríamos añadir la ejecución de pruebas unitarias y cobertura del código:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="console"><span class="tok-go">mvn test cobertura:cobertura</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Si invocamos el comando cobertura necesitaremos el plugin de Cobertura para Jenkins para poder integrar la información de cobertura en la información de la build.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_como_trabajar_contra_un_repositorio_de_bitbucket">8.2.4. Como trabajar contra un repositorio de Bitbucket</h4>
<div class="paragraph">
<p>Ya conocemos cómo OpenShift es capaz de instalar Jenkins y crear una tarea de construcción y despliegue por nosotros. No obstante, nuestras necesidades pueden ser algo más complejas o podemos necesitar ejecutar pasos adicionales en el proceso de construcción. Para ello Jenkins nos permite editar las tareas o bien crear una nueva tarea desde cero.</p>
</div>
<div class="paragraph">
<p>Por ejemplo, podemos querer trabajar con un repositorio en Bitbucket como repositorio principal, en lugar del asociado al gear. La modificación aparentemente es sencilla pues bastaría con edita la información que se muestra en la sección de "Configuración del origen del código fuente":</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="images/paas08/ci5.png" alt="ci5">
</div>
</div>
<div class="paragraph">
<p>Pero si lo hacéis os encontraréis con errores de acceso y de permisos al escribir en rutas del gear.</p>
</div>
<div class="sect4">
<h5 id="_tipo_de_credenciales">Tipo de credenciales</h5>
<div class="paragraph">
<p>Lo primero es comentar las tres formas de autenticarse más habituales contra repositorios:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Público (sin credenciales)</dt>
<dd>
<p>Los repositorios de GitHub gratuitos son todos públicos, pero como ya sabéis en BitBucket se pueden tener públicos o privados</p>
</dd>
<dt class="hdlist1">Usuario/password</dt>
<dd>
<p>Donde Jenkins utilizará nuestras claves personales del repositorio. ¿Que ocurre si tenemos que cambiar de password?</p>
</dd>
<dt class="hdlist1">Claves RSA</dt>
<dd>
<p>Mediante el sistema de clave pública/clave privada con lo que lo que se identificará será la propia instancia de Jenkins ante el repositorio de BitBucket o GitHub.</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>Para poder utilizar credenciales de tipo usuario/password es necesario instalar un componente adicional, el <em>plugin de Bitbucket para Jenkins</em>, pero el método por claves RSA ni siquiera os funcionará con este plugin pues la política de permisos de OpenShift sobre los gear impide que tengamos acceso a la carpeta .ssh donde se guardan las credenciales de usuario y al fichero <em>known_hosts</em> donde se almacenan las máquinas a las que nos hemos conectado. Para poder acceder a otros repositorios con claves RSA, se puede utilizar un catridge alternativo que ubica esta información en $OPENSHIFT_DATA_DIR.</p>
</div>
<div class="paragraph">
<p>Vamos a proponer una solución que contempla ambos enfoques pero requiere una configuración adicional.</p>
</div>
</div>
<div class="sect4">
<h5 id="_jenkins_alternativo">Jenkins "Alternativo"</h5>
<div class="paragraph">
<p>En lugar de dejar a OpenShift la responsabilidad de crear una instancia de Jenkins, la crearemos nosotros en primer lugar, pero utilizando un cartridge de terceros:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="console"><span class="tok-go"> rhc create-app jenkins  jenkins-1  &quot;https://cartreflect-claytondev.rhcloud.com/reflect?github=majecek/openshift-community-git-ssh</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Este cartridge tiene la particularidad de trasladar a la carpeta <em>$OPENSHIFT_DATA_DIR/git-ssh</em> toda la información relativa a claves RSA con lo que podremos trabajar con libertad. La estrategia es definir una variable de entorno llamada GIT_SSH que permite especificar un script de tratamiento de credenciales, que entre otras cosas puede especificar la ubicación de las credenciales.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Dado que en gear sólo tenemos permisos para trabajar en carpetas específicas Jenkins está configurado para obtener la identificación del usuario de la carpeta $OPENSHIFT_DATA_DIR en lugar de la propia del usuario como ocurriría en una instalación local. Esto se hace configurando la variable de entorno GIT_SSH para que apunte a un shellscript que  lea de otra ubicación las claves RSA. En el caso de Openshift se encuentra en  /usr/libexec/openshift/cartridges/jenkins/bin/git_ssh_wrapper.sh. Este mismo mecanismo se utiliza en una instalación local de Jenkins para ejecutar tareas de Jenkins como distintos usuarios.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Si queremos trabajar con claves RSA, todavía tenemos pendiente el crearlas, así que accederemos a la carpeta OPENSHIFT_DATA_DIR/git-ssh y ejecutaremos:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="console"><span class="tok-go">ssh-keygen</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Deberemos especificar en qué ubicación guardar la clave privada. Especificaremos un nombre de fichero con su ruta completa:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="console"><span class="tok-go">/var/lib/openshift/547ae964e0b8cdbb49000092/app-root/data/git-ssh/id_rsa</span>



<span class="tok-go">The key fingerprint is:</span>
<span class="tok-go">7d:f1:25:07:da:a7:e3:b0:c5:e0:e7:82:27:dc:2d:33 547ae964e0b8cdbb49000092@ex-std-node44.prod.rhcloud.com</span>
<span class="tok-go">The key&#39;s randomart image is:</span>
<span class="tok-go">+--[ RSA 2048]----+</span>
<span class="tok-go">|              .  |</span>
<span class="tok-go">|             o . |</span>
<span class="tok-go">|            + o +|</span>
<span class="tok-go">|         . . = * |</span>
<span class="tok-go">|        S . + B  |</span>
<span class="tok-go">|         . + O . |</span>
<span class="tok-go">|          + E +  |</span>
<span class="tok-go">|           o =   |</span>
<span class="tok-go">|                 |</span>
<span class="tok-go">+-----------------+</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Por último, tenemos que avisar a BitBucket de que vamos a descargar código mediante Jenkins. para ello debemos añadir la clave RSA pública asociada a Jenkins dentro de las <strong>Deployment key</strong> de Bitbucket.</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="images/paas08/ci6.png" alt="ci6">
</div>
</div>
<div class="paragraph">
<p>Ahora ya estamos en condiciones de autenticarnos en repositorios privados tanto por usuario/password como por claves RSA.</p>
</div>
</div>
<div class="sect4">
<h5 id="_bitbucket_plugin">BitBucket Plugin</h5>
<div class="paragraph">
<p>Gracias a este plugin es posible tener un mayor control de cómo se comunica Jenkins con BitBucket, pero no sólo sirve a la hora de acreditarnos, sino que nos permite que ante un cambio en Bitbucket se dispare la ejecución de una tarea Jenkins.</p>
</div>
<div class="paragraph">
<p>Si editamos una tarea de Jenkins tras instalar el plugin nos aparecerá una nueva forma de "disparar" la ejecución de la tarea.</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="images/paas08/ci85.png" alt="ci85">
</div>
</div>
<div class="paragraph">
<p>Por la parte de Bitbucket hay que añadir un nuevo elemento que avise a Jenkins cuando hay un cambio en el repositorio. Debemos añadir un <strong>Hook</strong> y lo más sencillo, es especificar uno de tipo POST, es decir una llamada http directa al servidor Jenkins:</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="images/paas08/ci8.png" alt="ci8">
</div>
</div>
<div class="paragraph">
<p>La URL a indicar es la URL de Jenkins añadiendo la ruta <em>/Bitbucket-hook/</em></p>
</div>
<div class="paragraph">
<p>Por último tenemos que dar de alta las credenciales concretas que vamos a utilizar para autenticarnos. Para ello, en la configuración de la tarea, en la sección del repositorio de código fuente, aparece un desplegable que nos permite especificar qué credenciales queremos utilizar para identificarnos. Como ya sabemos, estas credenciales pueden ser un usuario/password, o especificar la ruta a la clave privada RSA, o directamente "pegar" dicha clave en el formulario de configuración.</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="images/paas08/ci9.png" alt="ci9">
</div>
</div>
<div class="paragraph">
<p>También tenemos a nivel del menú principal de Jenkins, una nueva opción "Credentials" para gestionar estas credenciales.</p>
</div>
<div class="paragraph">
<p>Por último, comentar que a la fecha de la redacción de estos apuntes no funciona correctamente la descarga de código del repositorio de Bitbucket, en el sentido de que el comando de compilación <em>gear build</em> no sabe exactamente qué rama hay que compilar. La solución pasa por forzar a utilizar una rama concreta. En nuestro ejemplo <em>master</em>. Hay que forzar a descargar el contenido a la rama local master:</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="images/paas08/ci10.png" alt="ci10">
</div>
</div>
<div class="paragraph">
<p>Y luego antes de compilar, especificar sobre qué rama vamos a trabajar. Hay que editar el código de la build:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="console"><span class="tok-gp">#</span> Build/update libs and run user pre_build and build

<span class="tok-go">GIT_BRANCH=master		# &lt;-- Forzar a compilar sobre la rama master</span>
<span class="tok-go">gear build</span>

<span class="tok-gp">#</span> Run tests here</code></pre>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
La misma tarea que estamos presentando para trabajar contra Bitbucket la podríamos utilizar para compilar proyectos alojados en GitHub. Bastaría con instalar el plugin asociado a GitHub, configurar el repositorio remoto con la clave pública de Jenkins y cambiar la URL de Hook por: https://[url jenkins]/github-webhook/ con content type  <em>application/x-www-form-urlencoded</em>. En GitHub no se observa el problema de las ramas descrito para el plugin de Bitbucket.
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_alternativas_a_jenkins">8.2.5. Alternativas a Jenkins</h4>
<div class="paragraph">
<p>Una de las principales ventajas de utilizar Jenkins integrado en OpenShift es que de forma automática tenemos un sistema que implementa el despliegue continuo. Sin embargo si utilizamos el plan gratuito podemos encontrarnos con sólo nos deja un único gear para poder desplegar nuestras aplicaciones. Una medida que puede paliar el problema es configurar el propio gear de Jenkins como un builder, de modo que tanto la ejecución del servidor como los procesos de compilación correrían en el mismo gear. Esto puede ser factible para proyectos pequeños pero si nos excedemos de los límites de almacenamiento o consumo de memoria, podemos tener errores inesperados.</p>
</div>
<div class="paragraph">
<p>La otra alternativa es utilizar un servidor de CI de otro proveedor en Cloud. Travis, Shippable y CodeShip son soluciones que funcionan con OpenShift. La estrategia con estos servidores es clonar desde un repositorio principal el código fuente, aplicar las validaciones que consideremos oportunas, y si todo es correcto, hacer un <em>push</em> al repositorio del gear en el que queremos desplegar.</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="images/paas08/ship1.png" alt="ship1">
</div>
</div>
<div class="paragraph">
<p>En el caso concreto de Shippable, nos podemos identificar mediante Oauth Con las cuentas de Bitbucket o GitHub e inmediatamente acceder a nuestros proyectos, pero antes de poder desplegar hacen falta dos cosas:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Añadir la clave pública de Shippable dentro de las claves públicas admitidas de OpenShift, en la pestaña Settings:</p>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="images/paas08/ship2.png" alt="ship2">
</div>
</div>
</li>
<li>
<p>Definir un script de construcción y despliegue. En el caso de Shippable, se denomina <em>shippable.yml</em> y se encuentra en la carpeta raíz del proyecto:</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="console"><span class="tok-go">language: java</span>

<span class="tok-go">jdk:</span>
<span class="tok-go">   - openjdk7</span>

<span class="tok-go">env:</span>
<span class="tok-go">  global:</span>
<span class="tok-go">    - JBOSS_HOME=/tmp/jboss-as-7.1.0.Final</span>
<span class="tok-go">    - JBOSS_SERVER_LOCATION=http://download.jboss.org/jbossas/7.1/jboss-as-7.1.0.Final/jboss-as-7.1.0.Final.tar.gz</span>
<span class="tok-go">    - OPENSHIFT_REPO=ssh://54566a5a5973ca89760000cf@jbossas-djbyte.rhcloud.com/~/git/jbossas.git/</span>

<span class="tok-go">before_install:</span>
<span class="tok-go">  - if [ ! -e $JBOSS_HOME ]; then curl -s $JBOSS_SERVER_LOCATION | tar zx -C /tmp; fi</span>
<span class="tok-go">  - git remote -v | grep ^openshift || git remote add openshift $OPENSHIFT_REPO</span>

<span class="tok-go">before_script:</span>
<span class="tok-go">  - mkdir -p shippable/testresults</span>
<span class="tok-go">  - mkdir -p shippable/codecoverage</span>

<span class="tok-go">script:</span>
<span class="tok-go">  - mvn clean cobertura:cobertura</span>
<span class="tok-go">  - mvn test -Parq-jbossas-managed</span>

<span class="tok-go">after_success:</span>
<span class="tok-go">  - git push -f openshift $BRANCH:master</span></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_deployment_pipeline">8.2.6. Deployment pipeline</h4>
<div class="paragraph">
<p>Con los elementos que conocemos ya podríamos definir una estrategia de construcción y despliegue para una aplicación en cloud. Esta estrategia podrá ser más o menos compleja en función del tipo de aplicación y el número de partes que intervengan en el proceso. Además del uso que hemos visto de herramientas de CI como Jenkins o Shippable, donde lo que hacemos es básicamente mover código fuente o desplegar aplicaciones ya compiladas en gears, también podemos utilizar el propio api REST de OpenShift para crear, desplegar y destruir gears como parte del ciclo de construcción de una aplicación. En las referencias se cita un enlace donde se explica el plugin <em>OpenShift Deployer</em> que utilizando el api REST permite integrar dentro del proceso de despliegue estas tareas.</p>
</div>
<div class="paragraph">
<p>También se incluye en las referencias algunos enlaces con <em>best practices</em> sobre cómo aprovechar OpenShift para implementar un deployment pipeline. En todas ellas lo habitual suele ser definir varios dominios, uno por cada entorno de trabajo que vayamos a definir. Una posible división entre entornos sería:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Desarrollo</dt>
<dd>
<p>Entorno al que los programadores tienen acceso completo y pueden subir sus cambios desarrollados en local cuando consideran que con correctos y se pueden integrar con la aplicación.</p>
</dd>
<dt class="hdlist1">Test</dt>
<dd>
<p>De forma diaria, se ejecuta una tarea de Jenkins que trae las modificaciones de código realizadas en Desarrollo, recompila la aplicación y ejecuta todas las pruebas automatizadas. También este entorno sirve para que el equipo de testing pueda realizar sus pruebas. Sobre este entorno se podrían realizar pruebas de aceptación por parte de usuarios, o bien separarlas en diferentes entornos.</p>
</dd>
<dt class="hdlist1">Preproducción o Stage</dt>
<dd>
<p>Cuando el equipo de testing da el ok a estas pruebas, manualmente se traspasan los cambios de Test a Preproducción. Todo el código de preproducción se considera código validado y preparado para pasar a producción. Sin embargo en este entorno el equipo de Operaciones puede realizar las últimas pruebas de cara a su puesta en producción.</p>
</dd>
<dt class="hdlist1">Producción</dt>
<dd>
<p>Cuando se considere que la nueva versión puede publicarse, alguien desde operaciones iniciará el proceso de traspaso desde preproducción hasta producción manualmente, quedando la nueva aplicación disponible a los clientes.</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>En entornos estáticos tradicionales, se suele tener un servidor por entorno, lo cual puede condicionar las pruebas que se realicen sobre una aplicación ya que en proyectos grandes se pueden estar probandos distintas <em>features</em> simultáneamente y ser incompatibles dichas pruebas. O también es habitual que se quieran promocionar determinadas funcionalidades pero no otras hasta una fecha pactada con el cliente. Gracias a las herramientas (Git, Jenkins, OpenShift) podemos crear servidores de pruebas temporales para ramas específicas de un proyecto, que se validen de forma independiente, y que cuando llegue el momento previo a su despligue en producción, se integren en Preproducción.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_referencias">8.3. Referencias</h3>
<div class="ulist">
<ul>
<li>
<p>Application Scaling <a href="https://www.OpenShift.com/developers/scaling" class="bare">https://www.OpenShift.com/developers/scaling</a></p>
</li>
<li>
<p>Scaling in action <a href="https://www.openshift.com/blogs/scaling-in-action-on-openshift" class="bare">https://www.openshift.com/blogs/scaling-in-action-on-openshift</a></p>
</li>
<li>
<p>Autoescalado en OpenShift <a href="https://blog.openshift.com/how-to-host-your-java-ee-application-with-auto-scaling/" class="bare">https://blog.openshift.com/how-to-host-your-java-ee-application-with-auto-scaling/</a></p>
</li>
<li>
<p>Puppet <a href="http://es.wikipedia.org/wiki/Puppet_(software" class="bare">http://es.wikipedia.org/wiki/Puppet_(software</a>)</p>
</li>
<li>
<p>Continuous delivery <a href="http://www.xebia.in/assets/files/whitepaper_xebia_continuous_delivery.pdf" class="bare">http://www.xebia.in/assets/files/whitepaper_xebia_continuous_delivery.pdf</a></p>
</li>
<li>
<p>Continuous delivery using pipelines <a href="http://www.methodsandtools.com/archive/archive.php?id=121" class="bare">http://www.methodsandtools.com/archive/archive.php?id=121</a></p>
</li>
<li>
<p>Openshift development pipeline <a href="https://blog.openshift.com/elevating-your-development-pipeline-to-the-cloud-with-openshift/" class="bare">https://blog.openshift.com/elevating-your-development-pipeline-to-the-cloud-with-openshift/</a></p>
</li>
<li>
<p>Administering Jenkins <a href="https://wiki.jenkins-ci.org/display/JENKINS/Administering+Jenkins" class="bare">https://wiki.jenkins-ci.org/display/JENKINS/Administering+Jenkins</a></p>
</li>
<li>
<p>Cómo subar Sonar en OpenShift <a href="http://majecek.wordpress.com/2013/12/06/how-to-run-sonarqube-4-0-on-openshift/" class="bare">http://majecek.wordpress.com/2013/12/06/how-to-run-sonarqube-4-0-on-openshift/</a></p>
</li>
<li>
<p>Desplegar en OpenShift desde un jenkins externo: <a href="https://blog.openshift.com/deploy-openshift-external-jenkins-instance/" class="bare">https://blog.openshift.com/deploy-openshift-external-jenkins-instance/</a></p>
</li>
<li>
<p>Estrategias de Release Management: <a href="https://blog.openshift.com/release-management-in-the-cloud/" class="bare">https://blog.openshift.com/release-management-in-the-cloud/</a></p>
</li>
<li>
<p>Development pipeline en cloud: <a href="https://blog.openshift.com/elevating-your-development-pipeline-to-the-cloud-with-openshift/" class="bare">https://blog.openshift.com/elevating-your-development-pipeline-to-the-cloud-with-openshift/</a></p>
</li>
<li>
<p>Ticket Monster <a href="http://www.jboss.org/ticket-monster/" class="bare">http://www.jboss.org/ticket-monster/</a></p>
</li>
<li>
<p>Blog de Arun Gupta <a href="http://blog.arungupta.me" class="bare">http://blog.arungupta.me</a></p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_ejercicios_de_integración_continua_y_escalabilidad">8.4. Ejercicios de Integración continua y escalabilidad</h3>
<div class="paragraph">
<p>En esta sesión vamos a trabajar con la aplicación <em>Ticket Monster</em>. Esta aplicación es una plataforma de venta de entradas por internet y Red Hat la publica con fines educativos y como demostracíon de distintas tecnologías. Para más información en la sección de referencias hay un enlace con documentación acerca de esta aplicación.</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="images/paas08/ejer1.png" alt="ejer1">
</div>
</div>
<div class="paragraph">
<p>Por lo pronto vamos a descargarnos el código de GitHub correspondiente a la rama de código dirigida a WildFly. Concretamente ejecutaremos:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="console"><span class="tok-go">git clone -b WildFly https://github.com/jboss-developer/ticket-monster.git</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Una vez descargado lo compilaremos con los siguientes parámetros:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="console"><span class="tok-go">cd ticket-monster/demo</span>
<span class="tok-go">mvn clean package -Ppostgresql-openshift</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>La compilación generará un fichero <em>ticket-monster.war</em>.</p>
</div>
<div class="sect3">
<h4 id="_despliegue_de_una_aplicación_escalable_0_2_puntos">8.4.1. Despliegue de una aplicación escalable (0.2 Puntos)</h4>
<div class="paragraph">
<p>Para este ejercicio se pide:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Crear una aplicación OpenShift de nombre <em>ticketmonster</em> que sea escalable y que utilice una base de datos <em>PostgreSQL</em>.</p>
</li>
<li>
<p>Desplegar el war compilado como aplicación.</p>
</li>
<li>
<p>Verificar que la aplicación funciona correctamente.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_prueba_de_estrés_0_4_puntos">8.4.2. Prueba de Estrés ( 0.4 puntos)</h4>
<div class="paragraph">
<p>En este ejercicio vamos a comprobar cómo funciona el mecanismo de autoescalado simulando una carga de trabajo elevada. Para ello, lo primero es instalar una herramienta de pruebas de estrés: <em>ApacheBench</em>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="console"><span class="tok-gp">$</span> sudo apt-get install apache2-utils</code></pre>
</div>
</div>
<div class="paragraph">
<p>La aplicación Ticket monster, tiene una sección de administración generada mediante JBoss Forge y de la cual también expone una interfaz REST para manipular los datos de la aplicación. Vamos a lanzar una consulta de un servicio REST de forma masiva, con el fin de generar un número de sesiones concurrentes lo suficientemente elevado como para que OpenShift dispare la activación de un segundo gear.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Recordad que al configurar una aplicación como escalable ya consumimos 2 gear, así que como mucho, vamos a poder incorporar un tercero.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>La forma de lanzar una prueba de carga contra un servicio REST  de consulta (GET) sería la siguiente:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="console"><span class="tok-gp">$</span> ab -n <span class="tok-m">50000</span> -c <span class="tok-m">50</span> -s <span class="tok-m">100</span> http://ticketmonster-jlzamora.rhcloud.com/rest/sections</code></pre>
</div>
</div>
<div class="paragraph">
<p>Donde  "n" es el número de peticiones a realizar, "c" es el número de peticiones concurrentes y "s" es el tiempo máximo de espera por petición.</p>
</div>
<div class="paragraph">
<p>Si nos conectamos mediante SSH al gear de la aplicación, podemos consultar el log del balanceador en la ruta $OPENSHIFT_LOG_DIR/haproxy_ctld.log donde podremos ver los eventos de creación/destruccion de gears en función de la carga de trabjo. Adicionalmente en la consulta web de HAProxy también podemos ver el número de gears que tenemos en funcionamiento y su carga de trabajo.</p>
</div>
<div class="paragraph">
<p>Para este ejercicio se pide:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Ejecutar la prueba de estrés y verificar que pasado un tiempo se crea automáticamente un gear adicional.</p>
</li>
<li>
<p>En cuanto aparezca el nuevo gear, finalizar la prueba de carga mediante <em>CTRL+C</em> al comando de ApacheBench. Guardar los datos estadísticos de rendimiento que ha generado la herramienta en un fichero llamado <strong>1Gear.txt</strong>.</p>
</li>
<li>
<p>Comprobar que pasado un tiempo, se elimina automáticamente el segundo gear.</p>
</li>
<li>
<p>Obtener una copia del fichero <strong>haproxy_ctld.log</strong> como entregable.</p>
</li>
<li>
<p>Forzar a que la aplicación ticketmonster trabaje siempre con dos gears.</p>
</li>
<li>
<p>Repetir la prueba de carga hasta un número de ejecuciones similar a la realizada en el paso 2, y almacenar las estadísticas de ApacheBench en un fichero llamado <strong>2Gear.txt</strong>.</p>
</li>
</ol>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
Si os interesa realizar pruebas de estrés, además de ApacheBench podéis utilizar JMeter para realizar pruebas de estrés. Se trata de una herramienta mucho más completa pero algo más complicada de sacar partido. Como SaaS, tenéis la herramienta BlazeMeter, que permite generar simulaciones de carga de trabajo de forma sencilla pero también permite ejecutar pruebas de estrés de JMeter. La pega es que el acceso gratuito permite generar un volúmen de peticiones limitado.
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_integración_continua_0_2_puntos">8.4.3. Integración continua (0.2 puntos)</h4>
<div class="paragraph">
<p>Esta vez vamos a trabajar sobre una aplicación Java EE 7 de ejemplo muy sencilla, pero sobre la que aplicaremos los distintos conceptos que hemos aprendido sobre integración continua y despliegue continuo. En este primer ejercicio se pide crear una nueva aplicación OpenShift denominada <em>bigbang</em> y desplegar sobre ella la aplicación de ejemplo, alojada en GitHub. Para ello eliminaremos los fuentes por defecto y haremos un _pull del siguiente repositorio de GitHub:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="console"><span class="tok-go">git rm -rf src/ pom.xml</span>
<span class="tok-go">git commit . -m &quot;Eliminar aplicación de ejemplo &quot;</span>

<span class="tok-go">git remote add javaee7 https://github.com/Djbyte1977/bigbang.git</span>
<span class="tok-go">git pull javaee7 master</span>

<span class="tok-go">git push origin master</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Una vez desplegada la aplicación, comprobad que funciona correctamente. La aplicación expone un servicio REST del que podéis obtener una lista de personas o el nombre de una persona concreta preguntando por su id:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="console"><span class="tok-go">http://[URL aplicación Openshift]/resources/persons</span>

<span class="tok-go">http://[URL aplicación Openshift]/resources/persons/id</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Lo siguiente será habilitar integración continua para el proyecto y modificar la clase <em>PersonDatabase</em>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"> <span class="tok-kd">public</span> <span class="tok-kt">void</span> <span class="tok-nf">init</span><span class="tok-o">()</span> <span class="tok-o">{</span>
    <span class="tok-n">persons</span> <span class="tok-o">=</span> <span class="tok-n">Arrays</span><span class="tok-o">.</span><span class="tok-na">asList</span><span class="tok-o">(</span>
	<span class="tok-k">new</span> <span class="tok-nf">Person</span><span class="tok-o">(</span><span class="tok-s">&quot;Penny&quot;</span><span class="tok-o">),</span>
	<span class="tok-k">new</span> <span class="tok-nf">Person</span><span class="tok-o">(</span><span class="tok-s">&quot;Leonard&quot;</span><span class="tok-o">),</span>
	<span class="tok-k">new</span> <span class="tok-nf">Person</span><span class="tok-o">(</span><span class="tok-s">&quot;Sheldon&quot;</span><span class="tok-o">),</span>
	<span class="tok-k">new</span> <span class="tok-nf">Person</span><span class="tok-o">(</span><span class="tok-s">&quot;Amy&quot;</span><span class="tok-o">),</span>
	<span class="tok-k">new</span> <span class="tok-nf">Person</span><span class="tok-o">(</span><span class="tok-s">&quot;Howard&quot;</span><span class="tok-o">),</span>
	<span class="tok-k">new</span> <span class="tok-nf">Person</span><span class="tok-o">(</span><span class="tok-s">&quot;Bernadette&quot;</span><span class="tok-o">),</span>
	<span class="tok-k">new</span> <span class="tok-nf">Person</span><span class="tok-o">(</span><span class="tok-s">&quot;Raj&quot;</span><span class="tok-o">),</span>
	<span class="tok-k">new</span> <span class="tok-nf">Person</span><span class="tok-o">(</span><span class="tok-s">&quot;Priya&quot;</span><span class="tok-o">),</span>

	<span class="tok-c1">// Añadir una persona a la lista</span>
	<span class="tok-k">new</span> <span class="tok-nf">Person</span><span class="tok-o">(</span><span class="tok-s">&quot;Stu&quot;</span><span class="tok-o">));</span>

    <span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Por último, hacer un <em>push</em> del cambio y  verificar que la aplicación se compila primero en Jenkins antes de desplegarse. Ahora, cada vez que hagamos un push, la aplicación se compilará previamente, y si se produce algún fallo, el despliegue no se realizará, por tanto tenemos un nivel adicional de tolerancia ante fallos.</p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
Si ejecutamos la compilación por primera vez, es posible que se produzca algún error de comuncaciones entre nuestra consola y el gear Builder. Normalmente esto es debido a que son instancias gratuitas y que el primer arranque es más costoso. Si lo intentáis por segunda vez os debe funcionar.
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_pruebas_con_arquillian_0_4_puntos">8.4.4. Pruebas con Arquillian (0.4 puntos)</h4>
<div class="paragraph">
<p>El siguiente paso es incluir una serie de pruebas que nos garanticen no sólo que el código compila sino que el funcionamiento de la aplicación será el esperado. Para ello incorporaremos a la aplicación un par de casos de prueba implementados con <em>Arquillian</em>. Esta herramienta permite diseñar pruebas unitarias y pruebas integradas que se pueden ejecutar directamente sobre un servidor de aplicaciones, permitiendo realizar pruebas en condiciones muy cercanas a las del funcionamiento real que tendrá la aplicación.</p>
</div>
<div class="paragraph">
<p>Para dotar al proyecto de estas capacidades utilizaremos Forge dentro de la carpeta del proyecto.  Ejecutaremos:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="console"><span class="tok-gp">$</span> forge

<span class="tok-go">[bigbang]$ addon-install-from-git --url https://github.com/forge/addon-arquillian.git</span>


<span class="tok-go">//Como Framework de pruebas elegid JUnit y elegir el contenedor que queráis utilizar.</span>
<span class="tok-go">[bigbang]$ arquillian-setup</span>

<span class="tok-go">[bigbang]$ arquillian-container-setup</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Forge no sólo se utiliza para crear nuevos proyectos sino que permite modificar proyectos ya existentes. En este caso hemos añadido un plugin a Forge para poder trabajar con Arquillian y hemos añadido a nuestra aplicación la configuración necesaria para utilizar distintos contenedores. Cada contenedor está especializado en interactuar con un tipo de servidor de aplicaciones, en distintas configuraciones. En el caso de WildFly tenemos:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">arquillian-wildfly-remote</dt>
<dd>
<p>Que trabaja contra un servidor WildFly que se esté ejecutando en una máquina, por defecto en localhost:8080</p>
</dd>
<dt class="hdlist1">arquillian-wildfly-managed</dt>
<dd>
<p>En este caso Arquillian se encarga de parar y arrancar el servidor y sólo debemos indicarle en qué carpeta se encuentra, bien a través de la variable de entorno <em>JBOSS_HOME</em> o bien en el fichero de configuración de arquillian (<em>arquillian.xml</em>).</p>
</dd>
</dl>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
Por defecto estos plugins siempre van a trabaja contra la última versión de WildFly con lo que si la aplicación se ejecutará en una versión distinta, habría que modificarla en el fichero <em>pom.xml</em>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Para trabajar con OpenShift la aproximación es diferente pues en principio no se puede iniciar un proceso servidor dentro de un gear fuera de los puertos autorizados. Por tanto no es sencillo el utilizar uno de los modos anteriores pues la instancia de WildFly no tendrá permisos para abrir los puertos que necesita para funcionar.</p>
</div>
<div class="paragraph">
<p>Por fortuna existe un contenedor específico para OpenShift, <strong>arquillian-openshift-express</strong>, que permite utilizar instancias de JBoss/WildFly ejecutadas dentro de un gear.</p>
</div>
<div class="paragraph">
<p>Como hemos seleccionado la opción de <em>openshift-express</em>, ya tenemos nuestro proyecto preparado con los perfiles adecuados para poder utilizarlo. Faltaría modificar el fichero <em>arquillian.xml</em> dentro de la carpeta de test/resources indicando sobre qué gear vamos a lanzar las pruebas. En nuestro caso, como sólo contamos con tres gear disponibles vamos a utilizar el mismo gear que el despliegue final.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
En condiciones de "producción" necesitaremos 4 gear: 2 para Jenkins, uno para el servidor de Test y otro para el servidor de producción.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Añadiremos la configuración del gear sobre el que vamos a probar:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><span class="tok-c">&lt;!-- Datos de ejemplo, cambiar por los vuestros--&gt;</span>
 <span class="tok-nt">&lt;container</span> <span class="tok-na">qualifier=</span><span class="tok-s">&quot;arquillian-openshift-express&quot;</span><span class="tok-nt">&gt;</span>
     <span class="tok-nt">&lt;configuration&gt;</span>
            <span class="tok-nt">&lt;property</span> <span class="tok-na">name=</span><span class="tok-s">&quot;namespace&quot;</span><span class="tok-nt">&gt;</span>jlzamora<span class="tok-nt">&lt;/property&gt;</span>
            <span class="tok-nt">&lt;property</span> <span class="tok-na">name=</span><span class="tok-s">&quot;application&quot;</span><span class="tok-nt">&gt;</span>bigbang<span class="tok-nt">&lt;/property&gt;</span>
            <span class="tok-nt">&lt;property</span> <span class="tok-na">name=</span><span class="tok-s">&quot;libraDomain&quot;</span><span class="tok-nt">&gt;</span>rhcloud.com<span class="tok-nt">&lt;/property&gt;</span>
            <span class="tok-nt">&lt;property</span> <span class="tok-na">name=</span><span class="tok-s">&quot;sshUserName&quot;</span><span class="tok-nt">&gt;</span>5479d3685973ca8081000033<span class="tok-nt">&lt;/property&gt;</span>
            <span class="tok-nt">&lt;property</span> <span class="tok-na">name=</span><span class="tok-s">&quot;login&quot;</span><span class="tok-nt">&gt;</span>jl_msg@hotmail.com<span class="tok-nt">&lt;/property&gt;</span>
            <span class="tok-nt">&lt;property</span> <span class="tok-na">name=</span><span class="tok-s">&quot;deploymentTimeoutInSeconds&quot;</span><span class="tok-nt">&gt;</span>1000<span class="tok-nt">&lt;/property&gt;</span>
            <span class="tok-nt">&lt;property</span> <span class="tok-na">name=</span><span class="tok-s">&quot;disableStrictHostChecking&quot;</span><span class="tok-nt">&gt;</span>true<span class="tok-nt">&lt;/property&gt;</span>
        <span class="tok-nt">&lt;/configuration&gt;</span>
        <span class="tok-nt">&lt;/container&gt;</span></code></pre>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
En lugar de indicar valores constantes, si vamos a ejecutar las pruebas desde jenkins podemos utilizar la sintaxis: ${env.NOMBRE_VARIABLE} para leer el valor de una variable de entorno.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>También es necesario hacer algunos cambios manualmente sobre el <em>pom.xml</em> por ¿fallo? de la versión 2.12 de Forge:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Añadir el repositorio de JBoss para poder descargar las últimas versiones de los plugin:</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml">        <span class="tok-nt">&lt;repository&gt;</span>
            <span class="tok-nt">&lt;id&gt;</span>jboss-public-repository-group<span class="tok-nt">&lt;/id&gt;</span>
            <span class="tok-nt">&lt;name&gt;</span>JBoss Public Repository Group<span class="tok-nt">&lt;/name&gt;</span>
            <span class="tok-nt">&lt;url&gt;</span>http://repository.jboss.org/nexus/content/groups/public/<span class="tok-nt">&lt;/url&gt;</span>
            <span class="tok-nt">&lt;layout&gt;</span>default<span class="tok-nt">&lt;/layout&gt;</span>
            <span class="tok-nt">&lt;releases&gt;</span>
                <span class="tok-nt">&lt;enabled&gt;</span>true<span class="tok-nt">&lt;/enabled&gt;</span>
                <span class="tok-nt">&lt;updatePolicy&gt;</span>never<span class="tok-nt">&lt;/updatePolicy&gt;</span>
            <span class="tok-nt">&lt;/releases&gt;</span>
            <span class="tok-nt">&lt;snapshots&gt;</span>
                <span class="tok-nt">&lt;enabled&gt;</span>true<span class="tok-nt">&lt;/enabled&gt;</span>
                <span class="tok-nt">&lt;updatePolicy&gt;</span>never<span class="tok-nt">&lt;/updatePolicy&gt;</span>
            <span class="tok-nt">&lt;/snapshots&gt;</span>
        <span class="tok-nt">&lt;/repository&gt;</span></code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Añadir dependencias para crear los clientes REST utilizados en las pruebas:</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><span class="tok-nt">&lt;dependency&gt;</span>
    <span class="tok-nt">&lt;groupId&gt;</span>org.jboss.resteasy<span class="tok-nt">&lt;/groupId&gt;</span>
    <span class="tok-nt">&lt;artifactId&gt;</span>resteasy-client<span class="tok-nt">&lt;/artifactId&gt;</span>
    <span class="tok-nt">&lt;version&gt;</span>3.0.10.Final<span class="tok-nt">&lt;/version&gt;</span>	<span class="tok-c">&lt;!--Sustituir por la versión que utilice WildFly  --&gt;</span>
    <span class="tok-nt">&lt;scope&gt;</span>test<span class="tok-nt">&lt;/scope&gt;</span>
<span class="tok-nt">&lt;/dependency&gt;</span>
<span class="tok-nt">&lt;dependency&gt;</span>
    <span class="tok-nt">&lt;groupId&gt;</span>org.jboss.resteasy<span class="tok-nt">&lt;/groupId&gt;</span>
    <span class="tok-nt">&lt;artifactId&gt;</span>resteasy-jaxb-provider<span class="tok-nt">&lt;/artifactId&gt;</span>
    <span class="tok-nt">&lt;version&gt;</span>3.0.10.Final<span class="tok-nt">&lt;/version&gt;</span>  <span class="tok-c">&lt;!--Sustituir por la versión que utilice WildFly  --&gt;</span>
    <span class="tok-nt">&lt;scope&gt;</span>test<span class="tok-nt">&lt;/scope&gt;</span>
<span class="tok-nt">&lt;/dependency&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Además de incluir la configuración de Arquillian debéis incluir tambien algún caso de pruebas. En las plantillas de la sesión 8 encontraréis la clase <em>PersonTest.java</em> que define dos casos concretos para validar el servicio REST:</p>
</div>
<div class="paragraph">
<p>Esta es la parte concreta de los casos de prueba:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java">    <span class="tok-nd">@Test</span>
    <span class="tok-kd">public</span> <span class="tok-kt">void</span> <span class="tok-nf">testGetAll</span><span class="tok-o">()</span> <span class="tok-o">{</span>
        <span class="tok-n">Person</span><span class="tok-o">[]</span> <span class="tok-n">persons</span> <span class="tok-o">=</span> <span class="tok-n">target</span><span class="tok-o">.</span><span class="tok-na">request</span><span class="tok-o">().</span><span class="tok-na">get</span><span class="tok-o">(</span><span class="tok-n">Person</span><span class="tok-o">[].</span><span class="tok-na">class</span><span class="tok-o">);</span>
        <span class="tok-n">assertEquals</span><span class="tok-o">(</span><span class="tok-mi">8</span><span class="tok-o">,</span> <span class="tok-n">persons</span><span class="tok-o">.</span><span class="tok-na">length</span><span class="tok-o">);</span>

        <span class="tok-n">assertEquals</span><span class="tok-o">(</span><span class="tok-s">&quot;Penny&quot;</span><span class="tok-o">,</span> <span class="tok-n">persons</span><span class="tok-o">[</span><span class="tok-mi">0</span><span class="tok-o">].</span><span class="tok-na">getName</span><span class="tok-o">());</span>
        <span class="tok-n">assertEquals</span><span class="tok-o">(</span><span class="tok-s">&quot;Leonard&quot;</span><span class="tok-o">,</span> <span class="tok-n">persons</span><span class="tok-o">[</span><span class="tok-mi">1</span><span class="tok-o">].</span><span class="tok-na">getName</span><span class="tok-o">());</span>
        <span class="tok-n">assertEquals</span><span class="tok-o">(</span><span class="tok-s">&quot;Sheldon&quot;</span><span class="tok-o">,</span> <span class="tok-n">persons</span><span class="tok-o">[</span><span class="tok-mi">2</span><span class="tok-o">].</span><span class="tok-na">getName</span><span class="tok-o">());</span>
        <span class="tok-n">assertEquals</span><span class="tok-o">(</span><span class="tok-s">&quot;Amy&quot;</span><span class="tok-o">,</span> <span class="tok-n">persons</span><span class="tok-o">[</span><span class="tok-mi">3</span><span class="tok-o">].</span><span class="tok-na">getName</span><span class="tok-o">());</span>
        <span class="tok-n">assertEquals</span><span class="tok-o">(</span><span class="tok-s">&quot;Howard&quot;</span><span class="tok-o">,</span> <span class="tok-n">persons</span><span class="tok-o">[</span><span class="tok-mi">4</span><span class="tok-o">].</span><span class="tok-na">getName</span><span class="tok-o">());</span>
        <span class="tok-n">assertEquals</span><span class="tok-o">(</span><span class="tok-s">&quot;Bernadette&quot;</span><span class="tok-o">,</span> <span class="tok-n">persons</span><span class="tok-o">[</span><span class="tok-mi">5</span><span class="tok-o">].</span><span class="tok-na">getName</span><span class="tok-o">());</span>
        <span class="tok-n">assertEquals</span><span class="tok-o">(</span><span class="tok-s">&quot;Raj&quot;</span><span class="tok-o">,</span> <span class="tok-n">persons</span><span class="tok-o">[</span><span class="tok-mi">6</span><span class="tok-o">].</span><span class="tok-na">getName</span><span class="tok-o">());</span>
        <span class="tok-n">assertEquals</span><span class="tok-o">(</span><span class="tok-s">&quot;Priya&quot;</span><span class="tok-o">,</span> <span class="tok-n">persons</span><span class="tok-o">[</span><span class="tok-mi">7</span><span class="tok-o">].</span><span class="tok-na">getName</span><span class="tok-o">());</span>
    <span class="tok-o">}</span>

    <span class="tok-cm">/**</span>
<span class="tok-cm">     * Test of get method, of class Person.</span>
<span class="tok-cm">     */</span>
    <span class="tok-nd">@Test</span>
    <span class="tok-kd">public</span> <span class="tok-kt">void</span> <span class="tok-nf">testGetOne</span><span class="tok-o">()</span> <span class="tok-o">{</span>
        <span class="tok-n">WebTarget</span> <span class="tok-n">target2</span> <span class="tok-o">=</span> <span class="tok-n">target</span><span class="tok-o">.</span><span class="tok-na">path</span><span class="tok-o">(</span><span class="tok-s">&quot;{id}&quot;</span><span class="tok-o">);</span>

        <span class="tok-n">Person</span> <span class="tok-n">response</span> <span class="tok-o">=</span> <span class="tok-n">target2</span><span class="tok-o">.</span><span class="tok-na">resolveTemplate</span><span class="tok-o">(</span><span class="tok-s">&quot;id&quot;</span><span class="tok-o">,</span> <span class="tok-mi">0</span><span class="tok-o">).</span><span class="tok-na">request</span><span class="tok-o">().</span><span class="tok-na">get</span><span class="tok-o">(</span><span class="tok-n">Person</span><span class="tok-o">.</span><span class="tok-na">class</span><span class="tok-o">);</span>
        <span class="tok-n">assertEquals</span><span class="tok-o">(</span><span class="tok-s">&quot;Penny&quot;</span><span class="tok-o">,</span> <span class="tok-n">response</span><span class="tok-o">.</span><span class="tok-na">getName</span><span class="tok-o">());</span>

        <span class="tok-n">response</span> <span class="tok-o">=</span> <span class="tok-n">target2</span><span class="tok-o">.</span><span class="tok-na">resolveTemplate</span><span class="tok-o">(</span><span class="tok-s">&quot;id&quot;</span><span class="tok-o">,</span> <span class="tok-mi">1</span><span class="tok-o">).</span><span class="tok-na">request</span><span class="tok-o">().</span><span class="tok-na">get</span><span class="tok-o">(</span><span class="tok-n">Person</span><span class="tok-o">.</span><span class="tok-na">class</span><span class="tok-o">);</span>
        <span class="tok-n">assertEquals</span><span class="tok-o">(</span><span class="tok-s">&quot;Leonard&quot;</span><span class="tok-o">,</span> <span class="tok-n">response</span><span class="tok-o">.</span><span class="tok-na">getName</span><span class="tok-o">());</span>
    <span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>En este ejercicio se pide:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Ejecutar las pruebas utilizando los dos tipos de contenedores de Wildfly en local. Documentar en el fichero <em>soluciones.txt</em> los pasos realizados. Deben ejecutarse correctamente las pruebas pero alguna de ellas detectará un error en el código. Revisar los logs y corregirlo.</p>
</li>
<li>
<p>Desplegar la aplicación en OpenShift.</p>
</li>
<li>
<p>Desde la máquina local probar a ejecutar las pruebas contra la aplicación bigbang de OpenShift:</p>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="console"><span class="tok-go">mvn test -Parquillian-openshift-express</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>La salida de esta ejecución se debe incluir en el fichero <em>soluciones.txt</em>.</p>
</div>
</li>
</ol>
</div>
<div class="sect4">
<h5 id="_posibles_problemas">Posibles problemas</h5>
<div class="paragraph">
<p>A pesar de tener los pasos detallados, a la hora de ejecutar estos ejercicios os podéis encontrar  (entre otros) los siguientes problemas:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Lentitud: Los gear gratuitos de OpenShift son muy lentos y tienen una memoria limitada. Las pruebas con Arquillian son pesadas y en estas condiciones tardan bastante en ejecutarse. Dado que los gear se ejecutan en la costa este de EEUU, tenemos el problema añadido de que por la noche son todavía más lentos.</p>
</li>
<li>
<p>Desconexiones de los builder  (excepción hudson.remoting.RequestAbortedException: java.io.IOException: Unexpected termination of the channel). Al lanzar tareas en Jenkins es posible que el gear builder se desconecte del servidor de Jenkins. Se puede solucionar accediendo a la configuración de los nodos, pulsar sobre el builder y a continuación pinchar en el botón "Lanzar agente esclavo" que se muestra para reconectar, cuando hemos perdido la conexión.</p>
</li>
<li>
<p>Errores de ejecución en las pruebas: Las pruebas pueden mostrar un error 500 y en este caso habría que ir al log del servidor para obtener más información. Es posible que si no hemos incluido correctamente las dependencias de Resteasy (la implementación REST de JBoss/Wildfly) las pruebas fallen al no poder crear el cliente REST.</p>
</li>
<li>
<p>Parar a mitad las pruebas con Arquillian. Si interrumpís alguna prueba, podéis hacer un pull del repositorio, borrar los ficheros temporales de la carpeta <em>deployments</em> y volver a hacer un push al servidor para dejarlo en la situación original.</p>
</li>
<li>
<p>Para más información podéis consultar el enlace <a href="http://blog.arungupta.me/2014/11/deployment-pipeline-javaee7-wildfly-arquillian-openshift-jenkins-techtip56/" class="bare">http://blog.arungupta.me/2014/11/deployment-pipeline-javaee7-wildfly-arquillian-openshift-jenkins-techtip56/</a>  pero si probáis el ejemplo que se expone tal cual está, no va a funcionar en WildFly 8.2. Es necesario modificar la clase PersonDatabase y cambiar la anotación @Singleton por @ApplicationScope para que el servidor pueda inyectar correctamente el bean.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_entrega">8.4.5. Entrega</h4>
<div class="paragraph">
<p>En esta sesión hay que presentar una copia del repositorio <em>bigbang</em> eliminando la configuración de git como ya hemos hecho en sesiones anteriores y una serie de ficheros:
* Los ficheros 1gear.txt y 2gear.txt del segundo ejercicio.
* El Log del balanceador HAProxy: haproxy_ctld.log.
* Recoger en el fichero de <em>soluciones.txt</em> los pasos necesarios para lanzar las pruebas de arquillian y el log de compilación de las pruebas contra OpenShift.</p>
</div>
</div>
</div>
</div>
</div>
</div>
<div id="footer">
<div id="footer-text">
Last updated 2015-10-16 22:32:33 CEST
</div>
</div>
</body>
</html>