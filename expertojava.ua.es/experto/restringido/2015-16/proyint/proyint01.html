<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<!--[if IE]><meta http-equiv="X-UA-Compatible" content="IE=edge"><![endif]-->
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 1.5.2">
<meta name="author" content="María Isabel Alfonso, Domingo Gallardo, Alejandro Such, Jose Luis Zamora">
<title>Proyecto de Aplicación Web</title>
<style>/*! normalize.css v2.1.2 | MIT License | git.io/normalize */
/* ========================================================================== HTML5 display definitions ========================================================================== */
/** Correct `block` display not defined in IE 8/9. */
article, aside, details, figcaption, figure, footer, header, hgroup, main, nav, section, summary { display: block; }

/** Correct `inline-block` display not defined in IE 8/9. */
audio, canvas, video { display: inline-block; }

/** Prevent modern browsers from displaying `audio` without controls. Remove excess height in iOS 5 devices. */
audio:not([controls]) { display: none; height: 0; }

/** Address `[hidden]` styling not present in IE 8/9. Hide the `template` element in IE, Safari, and Firefox < 22. */
[hidden], template { display: none; }

script { display: none !important; }

/* ========================================================================== Base ========================================================================== */
/** 1. Set default font family to sans-serif. 2. Prevent iOS text size adjust after orientation change, without disabling user zoom. */
html { font-family: sans-serif; /* 1 */ -ms-text-size-adjust: 100%; /* 2 */ -webkit-text-size-adjust: 100%; /* 2 */ }

/** Remove default margin. */
body { margin: 0; }

/* ========================================================================== Links ========================================================================== */
/** Remove the gray background color from active links in IE 10. */
a { background: transparent; }

/** Address `outline` inconsistency between Chrome and other browsers. */
a:focus { outline: thin dotted; }

/** Improve readability when focused and also mouse hovered in all browsers. */
a:active, a:hover { outline: 0; }

/* ========================================================================== Typography ========================================================================== */
/** Address variable `h1` font-size and margin within `section` and `article` contexts in Firefox 4+, Safari 5, and Chrome. */
h1 { font-size: 2em; margin: 0.67em 0; }

/** Address styling not present in IE 8/9, Safari 5, and Chrome. */
abbr[title] { border-bottom: 1px dotted; }

/** Address style set to `bolder` in Firefox 4+, Safari 5, and Chrome. */
b, strong { font-weight: bold; }

/** Address styling not present in Safari 5 and Chrome. */
dfn { font-style: italic; }

/** Address differences between Firefox and other browsers. */
hr { -moz-box-sizing: content-box; box-sizing: content-box; height: 0; }

/** Address styling not present in IE 8/9. */
mark { background: #ff0; color: #000; }

/** Correct font family set oddly in Safari 5 and Chrome. */
code, kbd, pre, samp { font-family: monospace, serif; font-size: 1em; }

/** Improve readability of pre-formatted text in all browsers. */
pre { white-space: pre-wrap; }

/** Set consistent quote types. */
q { quotes: "\201C" "\201D" "\2018" "\2019"; }

/** Address inconsistent and variable font size in all browsers. */
small { font-size: 80%; }

/** Prevent `sub` and `sup` affecting `line-height` in all browsers. */
sub, sup { font-size: 75%; line-height: 0; position: relative; vertical-align: baseline; }

sup { top: -0.5em; }

sub { bottom: -0.25em; }

/* ========================================================================== Embedded content ========================================================================== */
/** Remove border when inside `a` element in IE 8/9. */
img { border: 0; }

/** Correct overflow displayed oddly in IE 9. */
svg:not(:root) { overflow: hidden; }

/* ========================================================================== Figures ========================================================================== */
/** Address margin not present in IE 8/9 and Safari 5. */
figure { margin: 0; }

/* ========================================================================== Forms ========================================================================== */
/** Define consistent border, margin, and padding. */
fieldset { border: 1px solid #c0c0c0; margin: 0 2px; padding: 0.35em 0.625em 0.75em; }

/** 1. Correct `color` not being inherited in IE 8/9. 2. Remove padding so people aren't caught out if they zero out fieldsets. */
legend { border: 0; /* 1 */ padding: 0; /* 2 */ }

/** 1. Correct font family not being inherited in all browsers. 2. Correct font size not being inherited in all browsers. 3. Address margins set differently in Firefox 4+, Safari 5, and Chrome. */
button, input, select, textarea { font-family: inherit; /* 1 */ font-size: 100%; /* 2 */ margin: 0; /* 3 */ }

/** Address Firefox 4+ setting `line-height` on `input` using `!important` in the UA stylesheet. */
button, input { line-height: normal; }

/** Address inconsistent `text-transform` inheritance for `button` and `select`. All other form control elements do not inherit `text-transform` values. Correct `button` style inheritance in Chrome, Safari 5+, and IE 8+. Correct `select` style inheritance in Firefox 4+ and Opera. */
button, select { text-transform: none; }

/** 1. Avoid the WebKit bug in Android 4.0.* where (2) destroys native `audio` and `video` controls. 2. Correct inability to style clickable `input` types in iOS. 3. Improve usability and consistency of cursor style between image-type `input` and others. */
button, html input[type="button"], input[type="reset"], input[type="submit"] { -webkit-appearance: button; /* 2 */ cursor: pointer; /* 3 */ }

/** Re-set default cursor for disabled elements. */
button[disabled], html input[disabled] { cursor: default; }

/** 1. Address box sizing set to `content-box` in IE 8/9. 2. Remove excess padding in IE 8/9. */
input[type="checkbox"], input[type="radio"] { box-sizing: border-box; /* 1 */ padding: 0; /* 2 */ }

/** 1. Address `appearance` set to `searchfield` in Safari 5 and Chrome. 2. Address `box-sizing` set to `border-box` in Safari 5 and Chrome (include `-moz` to future-proof). */
input[type="search"] { -webkit-appearance: textfield; /* 1 */ -moz-box-sizing: content-box; -webkit-box-sizing: content-box; /* 2 */ box-sizing: content-box; }

/** Remove inner padding and search cancel button in Safari 5 and Chrome on OS X. */
input[type="search"]::-webkit-search-cancel-button, input[type="search"]::-webkit-search-decoration { -webkit-appearance: none; }

/** Remove inner padding and border in Firefox 4+. */
button::-moz-focus-inner, input::-moz-focus-inner { border: 0; padding: 0; }

/** 1. Remove default vertical scrollbar in IE 8/9. 2. Improve readability and alignment in all browsers. */
textarea { overflow: auto; /* 1 */ vertical-align: top; /* 2 */ }

/* ========================================================================== Tables ========================================================================== */
/** Remove most spacing between table cells. */
table { border-collapse: collapse; border-spacing: 0; }

meta.foundation-mq-small { font-family: "only screen and (min-width: 768px)"; width: 768px; }

meta.foundation-mq-medium { font-family: "only screen and (min-width:1280px)"; width: 1280px; }

meta.foundation-mq-large { font-family: "only screen and (min-width:1440px)"; width: 1440px; }

*, *:before, *:after { -moz-box-sizing: border-box; -webkit-box-sizing: border-box; box-sizing: border-box; }

html, body { font-size: 97%; }

body { background: white; color: #222222; padding: 0; margin: 0; font-family: "Helvetica Neue", "Helvetica", Helvetica, Arial, sans-serif; font-weight: normal; font-style: normal; line-height: 1; position: relative; cursor: auto; }

a:hover { cursor: pointer; }

img, object, embed { max-width: 100%; height: auto; }

object, embed { height: 100%; }

img { -ms-interpolation-mode: bicubic; }

#map_canvas img, #map_canvas embed, #map_canvas object, .map_canvas img, .map_canvas embed, .map_canvas object { max-width: none !important; }

.left { float: left !important; }

.right { float: right !important; }

.text-left { text-align: left !important; }

.text-right { text-align: right !important; }

.text-center { text-align: center !important; }

.text-justify { text-align: justify !important; }

.hide { display: none; }

.antialiased, body { -webkit-font-smoothing: antialiased; }

img { display: inline-block; vertical-align: middle; }

textarea { height: auto; min-height: 50px; }

select { width: 100%; }

p.lead, .paragraph.lead > p, #preamble > .sectionbody > .paragraph:first-of-type p { font-size: 1.21875em; line-height: 1.6; }

.subheader, .admonitionblock td.content > .title, .audioblock > .title, .exampleblock > .title, .imageblock > .title, .listingblock > .title, .literalblock > .title, .stemblock > .title, .openblock > .title, .paragraph > .title, .quoteblock > .title, table.tableblock > .title, .verseblock > .title, .videoblock > .title, .dlist > .title, .olist > .title, .ulist > .title, .qlist > .title, .hdlist > .title { line-height: 1.4; color: #6f6f6f; font-weight: 300; margin-top: 0.2em; margin-bottom: 0.5em; }

/* Typography resets */
div, dl, dt, dd, ul, ol, li, h1, h2, h3, #toctitle, .sidebarblock > .content > .title, h4, h5, h6, pre, form, p, blockquote, th, td { margin: 0; padding: 0; direction: ltr; }

/* Default Link Styles */
a { color: #1164be; text-decoration: none; line-height: inherit; }
a img { border: none; }

/* Default paragraph styles */
p { font-family: inherit; font-weight: normal; font-size: 1em; line-height: 1.4; margin-bottom: 1em; text-rendering: optimizeLegibility; }
p aside { font-size: 0.875em; line-height: 1.35; font-style: italic; }

/* Default header styles */
h1, h2, h3, #toctitle, .sidebarblock > .content > .title, h4, h5, h6 { font-family: "Helvetica Neue", "Helvetica", Helvetica, Arial, sans-serif; font-weight: bold; font-style: normal; color: #1c355e; text-rendering: optimizeLegibility; margin-top: 1em; margin-bottom: 0.5em; line-height: 1.2125em; }
h1 small, h2 small, h3 small, #toctitle small, .sidebarblock > .content > .title small, h4 small, h5 small, h6 small { font-size: 60%; color: #6f6f6f; line-height: 0; }

h1 { font-size: 2.125em; }

h2 { font-size: 1.6875em; }

h3, #toctitle, .sidebarblock > .content > .title { font-size: 1.375em; }

h4 { font-size: 1.125em; }

h5 { font-size: 1.125em; }

h6 { font-size: 1em; }

hr { border: solid #dddddd; border-width: 1px 0 0; clear: both; margin: 1.25em 0 1.1875em; height: 0; }

/* Helpful Typography Defaults */
em, i { font-style: italic; line-height: inherit; }

strong, b { font-weight: bold; line-height: inherit; }

small { font-size: 60%; line-height: inherit; }

code { font-family: Consolas, "Liberation Mono", Courier, monospace; font-weight: bold; }

/* Lists */
ul, ol, dl { font-size: 1em; line-height: 1.4; margin-bottom: 1.25em; list-style-position: outside; font-family: inherit; }

ul, ol { margin-left: 2.5em; }
ul.no-bullet, ol.no-bullet { margin-left: 1.5em; }

/* Unordered Lists */
ul li ul, ul li ol { margin-left: 1.25em; margin-bottom: 0; font-size: 1em; /* Override nested font-size change */ }
ul.square li ul, ul.circle li ul, ul.disc li ul { list-style: inherit; }
ul.square { list-style-type: square; }
ul.circle { list-style-type: circle; }
ul.disc { list-style-type: disc; }
ul.no-bullet { list-style: none; }

/* Ordered Lists */
ol li ul, ol li ol { margin-left: 1.25em; margin-bottom: 0; }

/* Definition Lists */
dl dt { margin-bottom: 0.3125em; font-weight: bold; }
dl dd { margin-bottom: 1.25em; }

/* Abbreviations */
abbr, acronym { text-transform: uppercase; font-size: 90%; color: #222222; border-bottom: 1px dotted #dddddd; cursor: help; }

abbr { text-transform: none; }

/* Blockquotes */
blockquote { margin: 0 0 1.25em; padding: 0.5625em 1.25em 0 1.1875em; border-left: 1px solid #dddddd; }
blockquote cite { display: block; font-size: 0.8125em; color: #555555; }
blockquote cite:before { content: "\2014 \0020"; }
blockquote cite a, blockquote cite a:visited { color: #555555; }

blockquote, blockquote p { line-height: 1.6; color: #6f6f6f; }

/* Microformats */
.vcard { display: inline-block; margin: 0 0 1.25em 0; border: 1px solid #dddddd; padding: 0.625em 0.75em; }
.vcard li { margin: 0; display: block; }
.vcard .fn { font-weight: bold; font-size: 0.9375em; }

.vevent .summary { font-weight: bold; }
.vevent abbr { cursor: auto; text-decoration: none; font-weight: bold; border: none; padding: 0 0.0625em; }

/*@media only screen and (min-width: 768px) { h1, h2, h3, #toctitle, .sidebarblock > .content > .title, h4, h5, h6 { line-height: 1.4; }
  h1 { font-size: 2.75em; }
  h2 { font-size: 2.3125em; }
  h3, #toctitle, .sidebarblock > .content > .title { font-size: 1.6875em; }
  h4 { font-size: 1.4375em; } }*/
/* Tables */
table { background: white; margin-bottom: 1.25em; border: solid 1px #dddddd; }
table thead, table tfoot { background: whitesmoke; font-weight: bold; }
table thead tr th, table thead tr td, table tfoot tr th, table tfoot tr td { padding: 0.5em 0.625em 0.625em; font-size: inherit; color: #222222; text-align: left; }
table tr th, table tr td { padding: 0.5625em 0.625em; font-size: inherit; color: #222222; }
table tr.even, table tr.alt, table tr:nth-of-type(even) { background: #f9f9f9; }
table thead tr th, table tfoot tr th, table tbody tr td, table tr td, table tfoot tr td { display: table-cell; line-height: 1.4; }

h1, h2, h3, #toctitle, .sidebarblock > .content > .title, h4, h5, h6 { line-height: 1.4; border-bottom: 1px solid #dddddd }

.clearfix:before, .clearfix:after, .float-group:before, .float-group:after { content: " "; display: table; }
.clearfix:after, .float-group:after { clear: both; }

*:not(pre) > code { font-size: inherit; font-style: normal !important; letter-spacing: 0; padding: 3px 2px 1px 2px; background-color: #eeeeee; border: 1px solid #dddddd; -webkit-border-radius: 0; border-radius: 0; line-height: inherit; font-weight: normal; }

pre, pre > code { line-height: 1.4; color: black; font-family: monospace, serif; font-weight: normal; }

.keyseq { color: #555555; }

kbd { display: inline-block; color: #222222; font-size: 0.75em; line-height: 1.4; background-color: #f7f7f7; border: 1px solid #ccc; -webkit-border-radius: 3px; border-radius: 3px; -webkit-box-shadow: 0 1px 0 rgba(0, 0, 0, 0.2), 0 0 0 0.1em white inset; box-shadow: 0 1px 0 rgba(0, 0, 0, 0.2), 0 0 0 0.1em white inset; margin: -0.15em 0.15em 0 0.15em; padding: 0.2em 0.6em 0.2em 0.5em; vertical-align: middle; white-space: nowrap; }

.keyseq kbd:first-child { margin-left: 0; }

.keyseq kbd:last-child { margin-right: 0; }

.menuseq, .menu { color: #090909; }

b.button:before, b.button:after { position: relative; top: -1px; font-weight: normal; }

b.button:before { content: "["; padding: 0 3px 0 2px; }

b.button:after { content: "]"; padding: 0 2px 0 3px; }

#header, #content, #footnotes, #footer { width: 100%; margin-left: auto; margin-right: auto; margin-top: 0; margin-bottom: 0; max-width: 62.5em; *zoom: 1; position: relative; padding-left: 0.9375em; padding-right: 0.9375em; }
#header:before, #header:after, #content:before, #content:after, #footnotes:before, #footnotes:after, #footer:before, #footer:after { content: " "; display: table; }
#header:after, #content:after, #footnotes:after, #footer:after { clear: both; }

#content { margin-top: 1.25em; }

#content:before { content: none; }

#header > h1:first-child { color: black; margin-top: 2.25rem; margin-bottom: 0; }
#header > h1:first-child + #toc { margin-top: 8px; border-top: 1px solid #dddddd; }
#header > h1:only-child, body.toc2 #header > h1:nth-last-child(2) { border-bottom: 1px solid #dddddd; padding-bottom: 8px; }
#header .details { border-bottom: 1px solid #dddddd; line-height: 1.45; padding-top: 0.25em; padding-bottom: 0.25em; padding-left: 0.25em; color: #555555; display: -ms-flexbox; display: -webkit-flex; display: flex; -ms-flex-flow: row wrap; -webkit-flex-flow: row wrap; flex-flow: row wrap; }
#header .details span:first-child { margin-left: -0.125em; }
#header .details span.email a { color: #6f6f6f; }
#header .details br { display: none; }
#header .details br + span:before { content: "\00a0\2013\00a0"; }
#header .details br + span.author:before { content: "\00a0\22c5\00a0"; color: #6f6f6f; }
#header .details br + span#revremark:before { content: "\00a0|\00a0"; }
#header #revnumber { text-transform: capitalize; }
#header #revnumber:after { content: "\00a0"; }

#content > h1:first-child:not([class]) { color: black; border-bottom: 1px solid #dddddd; padding-bottom: 8px; margin-top: 0; padding-top: 1rem; margin-bottom: 1.25rem; }

#floating {
  position: fixed;
  z-index: 1000;
  padding: 0.5em;
  right: 0;
  top: 0;
  background: white;
  box-shadow: 0 0 1em #777777;
  -webkit-box-shadow: 0 0 1em #777777;
  -moz-box-shadow: 0 0 1em #777777;
  -webkit-border-bottom-left-radius: 5px;
  -moz-border-radius-bottomleft: 5px;
  max-height: 80%;
  overflow: auto;
}

#floating #full { display: none; } /* Hide the full TOC by default */

#floating:hover #full{
  display: block; /* Show it on hover */
}


#toc { border-bottom: 1px solid #dddddd; padding-bottom: 0.5em; }
#toc > ul { margin-left: 0.125em; }
#toc ul.sectlevel0 > li > a { font-style: italic; }
#toc ul.sectlevel0 ul.sectlevel1 { margin: 0.5em 0; }
#toc ul { font-family: "Helvetica Neue", "Helvetica", Helvetica, Arial, sans-serif; list-style-type: none; }
#toc a { text-decoration: none; }
#toc a:active { text-decoration: underline; }

#toctitle { color: #6f6f6f; font-size: 1.2em; }

@media only screen and (min-width: 768px) { #toctitle { font-size: 1.375em; }
  body.toc2 { padding-left: 15em; padding-right: 0; }
  #toc.toc2 { margin-top: 0 !important; background-color: #f2f2f2; position: fixed; width: 15em; left: 0; top: 0; border-right: 1px solid #dddddd; border-top-width: 0 !important; border-bottom-width: 0 !important; z-index: 1000; padding: 1.25em 1em; height: 100%; overflow: auto; }
  #toc.toc2 #toctitle { margin-top: 0; font-size: 1.2em; }
  #toc.toc2 > ul { font-size: 0.9em; margin-bottom: 0; }
  #toc.toc2 ul ul { margin-left: 0; padding-left: 1em; }
  #toc.toc2 ul.sectlevel0 ul.sectlevel1 { padding-left: 0; margin-top: 0.5em; margin-bottom: 0.5em; }
  body.toc2.toc-right { padding-left: 0; padding-right: 15em; }
  body.toc2.toc-right #toc.toc2 { border-right-width: 0; border-left: 1px solid #dddddd; left: auto; right: 0; } }
@media only screen and (min-width: 1280px) { body.toc2 { padding-left: 20em; padding-right: 0; }
  #toc.toc2 { width: 20em; }
  #toc.toc2 #toctitle { font-size: 1.375em; }
  #toc.toc2 > ul { font-size: 0.95em; }
  #toc.toc2 ul ul { padding-left: 1.25em; }
  body.toc2.toc-right { padding-left: 0; padding-right: 20em; } }
#content #toc { border-style: solid; border-width: 1px; border-color: #d9d9d9; margin-bottom: 1.25em; padding: 1.25em; background: #f2f2f2; -webkit-border-radius: 0; border-radius: 0; }
#content #toc > :first-child { margin-top: 0; }
#content #toc > :last-child { margin-bottom: 0; }

#footer { max-width: 100%; background-color: #222222; padding: 1.25em; }

#footer-text { color: #dddddd; line-height: 1.44; }

.sect1 { padding-bottom: 0.625em; }

@media only screen and (min-width: 768px) { .sect1 { padding-bottom: 1.25em; } }
.sect1 + .sect1 { border-top: 1px solid #dddddd; }

#content h1 > a.anchor, h2 > a.anchor, h3 > a.anchor, #toctitle > a.anchor, .sidebarblock > .content > .title > a.anchor, h4 > a.anchor, h5 > a.anchor, h6 > a.anchor { position: absolute; z-index: 1001; width: 1.5ex; margin-left: -1.5ex; display: block; text-decoration: none !important; visibility: hidden; text-align: center; font-weight: normal; }
#content h1 > a.anchor:before, h2 > a.anchor:before, h3 > a.anchor:before, #toctitle > a.anchor:before, .sidebarblock > .content > .title > a.anchor:before, h4 > a.anchor:before, h5 > a.anchor:before, h6 > a.anchor:before { content: "\00A7"; font-size: 0.85em; display: block; padding-top: 0.1em; }
#content h1:hover > a.anchor, #content h1 > a.anchor:hover, h2:hover > a.anchor, h2 > a.anchor:hover, h3:hover > a.anchor, #toctitle:hover > a.anchor, .sidebarblock > .content > .title:hover > a.anchor, h3 > a.anchor:hover, #toctitle > a.anchor:hover, .sidebarblock > .content > .title > a.anchor:hover, h4:hover > a.anchor, h4 > a.anchor:hover, h5:hover > a.anchor, h5 > a.anchor:hover, h6:hover > a.anchor, h6 > a.anchor:hover { visibility: visible; }
#content h1 > a.link, h2 > a.link, h3 > a.link, #toctitle > a.link, .sidebarblock > .content > .title > a.link, h4 > a.link, h5 > a.link, h6 > a.link { color: #222222; text-decoration: none; }
#content h1 > a.link:hover, h2 > a.link:hover, h3 > a.link:hover, #toctitle > a.link:hover, .sidebarblock > .content > .title > a.link:hover, h4 > a.link:hover, h5 > a.link:hover, h6 > a.link:hover { color: #151515; }

.audioblock, .imageblock, .literalblock, .listingblock, .stemblock, .videoblock { margin-bottom: 1.25em; }

.admonitionblock td.content > .title, .audioblock > .title, .exampleblock > .title, .imageblock > .title, .listingblock > .title, .literalblock > .title, .stemblock > .title, .openblock > .title, .paragraph > .title, .quoteblock > .title, table.tableblock > .title, .verseblock > .title, .videoblock > .title, .dlist > .title, .olist > .title, .ulist > .title, .qlist > .title, .hdlist > .title { text-rendering: optimizeLegibility; text-align: left; }

table.tableblock > caption.title { white-space: nowrap; overflow: visible; max-width: 0; }

.paragraph.lead > p, #preamble > .sectionbody > .paragraph:first-of-type p { color: black; }

table.tableblock #preamble > .sectionbody > .paragraph:first-of-type p { font-size: inherit; }

.admonitionblock > table { border-collapse: separate; border: 0; background: none; width: 100%; }
.admonitionblock > table td.icon { text-align: center; width: 80px; }
.admonitionblock > table td.icon img { max-width: none; }
.admonitionblock > table td.icon .title { font-weight: bold; font-family: "Helvetica Neue", "Helvetica", Helvetica, Arial, sans-serif; text-transform: uppercase; }
.admonitionblock > table td.content { padding-left: 1.125em; padding-right: 1.25em; border-left: 1px solid #dddddd; color: #555555; }
.admonitionblock > table td.content > :last-child > :last-child { margin-bottom: 0; }

.exampleblock > .content { border-style: solid; border-width: 1px; border-color: #e6e6e6; margin-bottom: 1.25em; padding: 1.25em; background: white; -webkit-border-radius: 0; border-radius: 0; }
.exampleblock > .content > :first-child { margin-top: 0; }
.exampleblock > .content > :last-child { margin-bottom: 0; }

.sidebarblock { border-style: solid; border-width: 1px; border-color: #d9d9d9; margin-bottom: 1.25em; padding: 1.25em; background: #f2f2f2; -webkit-border-radius: 0; border-radius: 0; }
.sidebarblock > :first-child { margin-top: 0; }
.sidebarblock > :last-child { margin-bottom: 0; }
.sidebarblock > .content > .title { color: #6f6f6f; margin-top: 0; }

.exampleblock > .content > :last-child > :last-child, .exampleblock > .content .olist > ol > li:last-child > :last-child, .exampleblock > .content .ulist > ul > li:last-child > :last-child, .exampleblock > .content .qlist > ol > li:last-child > :last-child, .sidebarblock > .content > :last-child > :last-child, .sidebarblock > .content .olist > ol > li:last-child > :last-child, .sidebarblock > .content .ulist > ul > li:last-child > :last-child, .sidebarblock > .content .qlist > ol > li:last-child > :last-child { margin-bottom: 0; }

.literalblock pre, .listingblock pre:not(.highlight), .listingblock pre[class="highlight"], .listingblock pre[class^="highlight "], .listingblock pre.CodeRay, .listingblock pre.prettyprint { background: #eeeeee; }
.sidebarblock .literalblock pre, .sidebarblock .listingblock pre:not(.highlight), .sidebarblock .listingblock pre[class="highlight"], .sidebarblock .listingblock pre[class^="highlight "], .sidebarblock .listingblock pre.CodeRay, .sidebarblock .listingblock pre.prettyprint { background: #f2f1f1; }

.literalblock pre, .literalblock pre[class], .listingblock pre, .listingblock pre[class] { border: 1px solid #cccccc; -webkit-border-radius: 0; border-radius: 0; word-wrap: break-word; padding: 0.8em 0.8em 0.65em 0.8em; font-size: 0.8125em; }
.literalblock pre.nowrap, .literalblock pre[class].nowrap, .listingblock pre.nowrap, .listingblock pre[class].nowrap { overflow-x: auto; white-space: pre; word-wrap: normal; }
@media only screen and (min-width: 768px) { .literalblock pre, .literalblock pre[class], .listingblock pre, .listingblock pre[class] { font-size: 0.90625em; } }
@media only screen and (min-width: 1280px) { .literalblock pre, .literalblock pre[class], .listingblock pre, .listingblock pre[class] { font-size: 1em; } }

.literalblock.output pre { color: #eeeeee; background-color: black; }

.listingblock pre.highlightjs { padding: 0; }
.listingblock pre.highlightjs > code { padding: 0.8em 0.8em 0.65em 0.8em; -webkit-border-radius: 0; border-radius: 0; }

.listingblock > .content { position: relative; }

.listingblock code[data-lang]:before { display: none; content: attr(data-lang); position: absolute; font-size: 0.75em; top: 0.425rem; right: 0.5rem; line-height: 1; text-transform: uppercase; color: #999; }

.listingblock:hover code[data-lang]:before { display: block; }

.listingblock.terminal pre .command:before { content: attr(data-prompt); padding-right: 0.5em; color: #999; }

.listingblock.terminal pre .command:not([data-prompt]):before { content: "$"; }

table.pyhltable { border-collapse: separate; border: 0; margin-bottom: 0; background: none; }

table.pyhltable td { vertical-align: top; padding-top: 0; padding-bottom: 0; }

table.pyhltable td.code { padding-left: .75em; padding-right: 0; }

pre.pygments .lineno, table.pyhltable td:not(.code) { color: #999; padding-left: 0; padding-right: .5em; border-right: 1px solid #dddddd; }

pre.pygments .lineno { display: inline-block; margin-right: .25em; }

table.pyhltable .linenodiv { background: none !important; padding-right: 0 !important; }

.quoteblock { margin: 0 1em 1.25em 1.5em; display: table; }
.quoteblock > .title { margin-left: -1.5em; margin-bottom: 0.75em; }
.quoteblock blockquote, .quoteblock blockquote p { color: #6f6f6f; font-size: 1.15rem; line-height: 1.75; word-spacing: 0.1em; letter-spacing: 0; font-style: italic; text-align: justify; }
.quoteblock blockquote { margin: 0; padding: 0; border: 0; }
.quoteblock blockquote:before { content: "\201c"; float: left; font-size: 2.75em; font-weight: bold; line-height: 0.6em; margin-left: -0.6em; color: #6f6f6f; text-shadow: 0 1px 2px rgba(0, 0, 0, 0.1); }
.quoteblock blockquote > .paragraph:last-child p { margin-bottom: 0; }
.quoteblock .attribution { margin-top: 0.5em; margin-right: 0.5ex; text-align: right; }
.quoteblock .quoteblock { margin-left: 0; margin-right: 0; padding: 0.5em 0; border-left: 3px solid #555555; }
.quoteblock .quoteblock blockquote { padding: 0 0 0 0.75em; }
.quoteblock .quoteblock blockquote:before { display: none; }

.verseblock { margin: 0 1em 1.25em 1em; }
.verseblock pre { font-family: "Open Sans", "DejaVu Sans", sans; font-size: 1.15rem; color: #6f6f6f; font-weight: 300; text-rendering: optimizeLegibility; }
.verseblock pre strong { font-weight: 400; }
.verseblock .attribution { margin-top: 1.25rem; margin-left: 0.5ex; }

.quoteblock .attribution, .verseblock .attribution { font-size: 0.8125em; line-height: 1.45; font-style: italic; }
.quoteblock .attribution br, .verseblock .attribution br { display: none; }
.quoteblock .attribution cite, .verseblock .attribution cite { display: block; letter-spacing: -0.05em; color: #555555; }

.quoteblock.abstract { margin: 0 0 1.25em 0; display: block; }
.quoteblock.abstract blockquote, .quoteblock.abstract blockquote p { text-align: left; word-spacing: 0; }
.quoteblock.abstract blockquote:before, .quoteblock.abstract blockquote p:first-of-type:before { display: none; }

table.tableblock { max-width: 100%; border-collapse: separate; }
table.tableblock td > .paragraph:last-child p > p:last-child, table.tableblock th > p:last-child, table.tableblock td > p:last-child { margin-bottom: 0; }

table.spread { width: 100%; }

table.tableblock, th.tableblock, td.tableblock { border: 0 solid #dddddd; }

table.grid-all th.tableblock, table.grid-all td.tableblock { border-width: 0 1px 1px 0; }

table.grid-all tfoot > tr > th.tableblock, table.grid-all tfoot > tr > td.tableblock { border-width: 1px 1px 0 0; }

table.grid-cols th.tableblock, table.grid-cols td.tableblock { border-width: 0 1px 0 0; }

table.grid-all * > tr > .tableblock:last-child, table.grid-cols * > tr > .tableblock:last-child { border-right-width: 0; }

table.grid-rows th.tableblock, table.grid-rows td.tableblock { border-width: 0 0 1px 0; }

table.grid-all tbody > tr:last-child > th.tableblock, table.grid-all tbody > tr:last-child > td.tableblock, table.grid-all thead:last-child > tr > th.tableblock, table.grid-rows tbody > tr:last-child > th.tableblock, table.grid-rows tbody > tr:last-child > td.tableblock, table.grid-rows thead:last-child > tr > th.tableblock { border-bottom-width: 0; }

table.grid-rows tfoot > tr > th.tableblock, table.grid-rows tfoot > tr > td.tableblock { border-width: 1px 0 0 0; }

table.frame-all { border-width: 1px; }

table.frame-sides { border-width: 0 1px; }

table.frame-topbot { border-width: 1px 0; }

th.halign-left, td.halign-left { text-align: left; }

th.halign-right, td.halign-right { text-align: right; }

th.halign-center, td.halign-center { text-align: center; }

th.valign-top, td.valign-top { vertical-align: top; }

th.valign-bottom, td.valign-bottom { vertical-align: bottom; }

th.valign-middle, td.valign-middle { vertical-align: middle; }

table thead th, table tfoot th { font-weight: bold; }

tbody tr th { display: table-cell; line-height: 1.4; background: whitesmoke; }

tbody tr th, tbody tr th p, tfoot tr th, tfoot tr th p { color: #222222; font-weight: bold; }

p.tableblock > code:only-child { background: none; padding: 0; }

p.tableblock { font-size: 1em; }

td > div.verse { white-space: pre; }

ol { margin-left: 2.5em; }

ul li ol { margin-left: 1.5em; }

dl dd { margin-left: 1.125em; }

dl dd:last-child, dl dd:last-child > :last-child { margin-bottom: 0; }

ol > li p, ul > li p, ul dd, ol dd, .olist .olist, .ulist .ulist, .ulist .olist, .olist .ulist { margin-bottom: 0.625em; }

ul.unstyled, ol.unnumbered, ul.checklist, ul.none { list-style-type: none; }

ul.unstyled, ol.unnumbered, ul.checklist { margin-left: 0.625em; }

ul.checklist li > p:first-child > .fa-check-square-o:first-child, ul.checklist li > p:first-child > input[type="checkbox"]:first-child { margin-right: 0.25em; }

ul.checklist li > p:first-child > input[type="checkbox"]:first-child { position: relative; top: 1px; }

ul.inline { margin: 0 auto 0.625em auto; margin-left: -1.375em; margin-right: 0; padding: 0; list-style: none; overflow: hidden; }
ul.inline > li { list-style: none; float: left; margin-left: 1.375em; display: block; }
ul.inline > li > * { display: block; }

.unstyled dl dt { font-weight: normal; font-style: normal; }

ol.arabic { list-style-type: decimal; }

ol.decimal { list-style-type: decimal-leading-zero; }

ol.loweralpha { list-style-type: lower-alpha; }

ol.upperalpha { list-style-type: upper-alpha; }

ol.lowerroman { list-style-type: lower-roman; }

ol.upperroman { list-style-type: upper-roman; }

ol.lowergreek { list-style-type: lower-greek; }

.hdlist > table, .colist > table { border: 0; background: none; }
.hdlist > table > tbody > tr, .colist > table > tbody > tr { background: none; }

td.hdlist1 { padding-right: .75em; font-weight: bold; }

td.hdlist1, td.hdlist2 { vertical-align: top; }

.literalblock + .colist, .listingblock + .colist { margin-top: -0.5em; }

.colist > table tr > td:first-of-type { padding: 0 0.75em; line-height: 1; }
.colist > table tr > td:last-of-type { padding: 0.25em 0; }

.thumb, .th { line-height: 0; display: inline-block; border: solid 4px white; -webkit-box-shadow: 0 0 0 1px #dddddd; box-shadow: 0 0 0 1px #dddddd; }

.imageblock.left, .imageblock[style*="float: left"] { margin: 0.25em 0.625em 1.25em 0; }
.imageblock.right, .imageblock[style*="float: right"] { margin: 0.25em 0 1.25em 0.625em; }
.imageblock > .title { margin-bottom: 0; }
.imageblock.thumb, .imageblock.th { border-width: 6px; }
.imageblock.thumb > .title, .imageblock.th > .title { padding: 0 0.125em; }

.image.left, .image.right { margin-top: 0.25em; margin-bottom: 0.25em; display: inline-block; line-height: 0; }
.image.left { margin-right: 0.625em; }
.image.right { margin-left: 0.625em; }

a.image { text-decoration: none; }

span.footnote, span.footnoteref { vertical-align: super; font-size: 0.875em; }
span.footnote a, span.footnoteref a { text-decoration: none; }
span.footnote a:active, span.footnoteref a:active { text-decoration: underline; }

#footnotes { padding-top: 0.75em; padding-bottom: 0.75em; margin-bottom: 0.625em; }
#footnotes hr { width: 20%; min-width: 6.25em; margin: -.25em 0 .75em 0; border-width: 1px 0 0 0; }
#footnotes .footnote { padding: 0 0.375em; line-height: 1.3; font-size: 0.875em; margin-left: 1.2em; text-indent: -1.2em; margin-bottom: .2em; }
#footnotes .footnote a:first-of-type { font-weight: bold; text-decoration: none; }
#footnotes .footnote:last-of-type { margin-bottom: 0; }

#content #footnotes { margin-top: -0.625em; margin-bottom: 0; padding: 0.75em 0; }

.gist .file-data > table { border: 0; background: #fff; width: 100%; margin-bottom: 0; }
.gist .file-data > table td.line-data { width: 99%; }

div.unbreakable { page-break-inside: avoid; }

.big { font-size: larger; }

.small { font-size: smaller; }

.underline { text-decoration: underline; }

.overline { text-decoration: overline; }

.line-through { text-decoration: line-through; }

.aqua { color: #00bfbf; }

.aqua-background { background-color: #00fafa; }

.black { color: black; }

.black-background { background-color: black; }

.blue { color: #0000bf; }

.blue-background { background-color: #0000fa; }

.fuchsia { color: #bf00bf; }

.fuchsia-background { background-color: #fa00fa; }

.gray { color: #606060; }

.gray-background { background-color: #7d7d7d; }

.green { color: #006000; }

.green-background { background-color: #007d00; }

.lime { color: #00bf00; }

.lime-background { background-color: #00fa00; }

.maroon { color: #600000; }

.maroon-background { background-color: #7d0000; }

.navy { color: #000060; }

.navy-background { background-color: #00007d; }

.olive { color: #606000; }

.olive-background { background-color: #7d7d00; }

.purple { color: #600060; }

.purple-background { background-color: #7d007d; }

.red { color: #bf0000; }

.red-background { background-color: #fa0000; }

.silver { color: #909090; }

.silver-background { background-color: #bcbcbc; }

.teal { color: #006060; }

.teal-background { background-color: #007d7d; }

.white { color: #bfbfbf; }

.white-background { background-color: #fafafa; }

.yellow { color: #bfbf00; }

.yellow-background { background-color: #fafa00; }

span.icon > .fa { cursor: default; }

.admonitionblock td.icon [class^="fa icon-"] { font-size: 2.5em; text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.5); cursor: default; }
.admonitionblock td.icon .icon-note:before { content: "\f05a"; color: #207c98; }
.admonitionblock td.icon .icon-tip:before { content: "\f0eb"; text-shadow: 1px 1px 2px rgba(155, 155, 0, 0.8); color: #111; }
.admonitionblock td.icon .icon-warning:before { content: "\f071"; color: #bf6900; }
.admonitionblock td.icon .icon-caution:before { content: "\f06d"; color: #bf3400; }
.admonitionblock td.icon .icon-important:before { content: "\f06a"; color: #bf0000; }

.conum[data-value] { display: inline-block; color: #fff !important; background-color: #222222; -webkit-border-radius: 100px; border-radius: 100px; text-align: center; font-size: 0.75em; width: 1.67em; height: 1.67em; line-height: 1.67em; font-family: "Open Sans", "DejaVu Sans", sans-serif; font-style: normal; font-weight: bold; }
.conum[data-value] * { color: #fff !important; }
.conum[data-value] + b { display: none; }
.conum[data-value]:after { content: attr(data-value); }
pre .conum[data-value] { position: relative; top: -0.125em; }

b.conum * { color: inherit !important; }

.conum:not([data-value]):empty { display: none; }

.literalblock pre, .listingblock pre { background: #eeeeee; }

</style>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.2.0/css/font-awesome.min.css">
<style>.listingblock .pygments .hll { background-color: #ffffcc }
.listingblock .pygments  { background: #f8f8f8; }
.listingblock .pygments .tok-c { color: #408080; font-style: italic } /* Comment */
.listingblock .pygments .tok-err { border: 1px solid #FF0000 } /* Error */
.listingblock .pygments .tok-k { color: #008000; font-weight: bold } /* Keyword */
.listingblock .pygments .tok-o { color: #666666 } /* Operator */
.listingblock .pygments .tok-cm { color: #408080; font-style: italic } /* Comment.Multiline */
.listingblock .pygments .tok-cp { color: #BC7A00 } /* Comment.Preproc */
.listingblock .pygments .tok-c1 { color: #408080; font-style: italic } /* Comment.Single */
.listingblock .pygments .tok-cs { color: #408080; font-style: italic } /* Comment.Special */
.listingblock .pygments .tok-gd { color: #A00000 } /* Generic.Deleted */
.listingblock .pygments .tok-ge { font-style: italic } /* Generic.Emph */
.listingblock .pygments .tok-gr { color: #FF0000 } /* Generic.Error */
.listingblock .pygments .tok-gh { color: #000080; font-weight: bold } /* Generic.Heading */
.listingblock .pygments .tok-gi { color: #00A000 } /* Generic.Inserted */
.listingblock .pygments .tok-go { color: #888888 } /* Generic.Output */
.listingblock .pygments .tok-gp { color: #000080; font-weight: bold } /* Generic.Prompt */
.listingblock .pygments .tok-gs { font-weight: bold } /* Generic.Strong */
.listingblock .pygments .tok-gu { color: #800080; font-weight: bold } /* Generic.Subheading */
.listingblock .pygments .tok-gt { color: #0044DD } /* Generic.Traceback */
.listingblock .pygments .tok-kc { color: #008000; font-weight: bold } /* Keyword.Constant */
.listingblock .pygments .tok-kd { color: #008000; font-weight: bold } /* Keyword.Declaration */
.listingblock .pygments .tok-kn { color: #008000; font-weight: bold } /* Keyword.Namespace */
.listingblock .pygments .tok-kp { color: #008000 } /* Keyword.Pseudo */
.listingblock .pygments .tok-kr { color: #008000; font-weight: bold } /* Keyword.Reserved */
.listingblock .pygments .tok-kt { color: #B00040 } /* Keyword.Type */
.listingblock .pygments .tok-m { color: #666666 } /* Literal.Number */
.listingblock .pygments .tok-s { color: #BA2121 } /* Literal.String */
.listingblock .pygments .tok-na { color: #7D9029 } /* Name.Attribute */
.listingblock .pygments .tok-nb { color: #008000 } /* Name.Builtin */
.listingblock .pygments .tok-nc { color: #0000FF; font-weight: bold } /* Name.Class */
.listingblock .pygments .tok-no { color: #880000 } /* Name.Constant */
.listingblock .pygments .tok-nd { color: #AA22FF } /* Name.Decorator */
.listingblock .pygments .tok-ni { color: #999999; font-weight: bold } /* Name.Entity */
.listingblock .pygments .tok-ne { color: #D2413A; font-weight: bold } /* Name.Exception */
.listingblock .pygments .tok-nf { color: #0000FF } /* Name.Function */
.listingblock .pygments .tok-nl { color: #A0A000 } /* Name.Label */
.listingblock .pygments .tok-nn { color: #0000FF; font-weight: bold } /* Name.Namespace */
.listingblock .pygments .tok-nt { color: #008000; font-weight: bold } /* Name.Tag */
.listingblock .pygments .tok-nv { color: #19177C } /* Name.Variable */
.listingblock .pygments .tok-ow { color: #AA22FF; font-weight: bold } /* Operator.Word */
.listingblock .pygments .tok-w { color: #bbbbbb } /* Text.Whitespace */
.listingblock .pygments .tok-mb { color: #666666 } /* Literal.Number.Bin */
.listingblock .pygments .tok-mf { color: #666666 } /* Literal.Number.Float */
.listingblock .pygments .tok-mh { color: #666666 } /* Literal.Number.Hex */
.listingblock .pygments .tok-mi { color: #666666 } /* Literal.Number.Integer */
.listingblock .pygments .tok-mo { color: #666666 } /* Literal.Number.Oct */
.listingblock .pygments .tok-sb { color: #BA2121 } /* Literal.String.Backtick */
.listingblock .pygments .tok-sc { color: #BA2121 } /* Literal.String.Char */
.listingblock .pygments .tok-sd { color: #BA2121; font-style: italic } /* Literal.String.Doc */
.listingblock .pygments .tok-s2 { color: #BA2121 } /* Literal.String.Double */
.listingblock .pygments .tok-se { color: #BB6622; font-weight: bold } /* Literal.String.Escape */
.listingblock .pygments .tok-sh { color: #BA2121 } /* Literal.String.Heredoc */
.listingblock .pygments .tok-si { color: #BB6688; font-weight: bold } /* Literal.String.Interpol */
.listingblock .pygments .tok-sx { color: #008000 } /* Literal.String.Other */
.listingblock .pygments .tok-sr { color: #BB6688 } /* Literal.String.Regex */
.listingblock .pygments .tok-s1 { color: #BA2121 } /* Literal.String.Single */
.listingblock .pygments .tok-ss { color: #19177C } /* Literal.String.Symbol */
.listingblock .pygments .tok-bp { color: #008000 } /* Name.Builtin.Pseudo */
.listingblock .pygments .tok-vc { color: #19177C } /* Name.Variable.Class */
.listingblock .pygments .tok-vg { color: #19177C } /* Name.Variable.Global */
.listingblock .pygments .tok-vi { color: #19177C } /* Name.Variable.Instance */
.listingblock .pygments .tok-il { color: #666666 } /* Literal.Number.Integer.Long */
</style>
</head>
<body class="article toc2 toc-left">
<div id="header">
<h1>Proyecto de Aplicación Web</h1>
<div class="details">
<span id="author" class="author">María Isabel Alfonso</span><br>
<span id="email" class="email"><a href="mailto:eli@ua.es">eli@ua.es</a></span><br>
<span id="author2" class="author">Domingo Gallardo</span><br>
<span id="email2" class="email"><a href="mailto:domingo.gallardo@ua.es">domingo.gallardo@ua.es</a></span><br>
<span id="author3" class="author">Alejandro Such</span><br>
<span id="email3" class="email"><a href="mailto:alejandro.such@ua.es">alejandro.such@ua.es</a></span><br>
<span id="author4" class="author">Jose Luis Zamora</span><br>
<span id="email4" class="email"><a href="mailto:joseluis.zamora@ua.es">joseluis.zamora@ua.es</a></span><br>
</div>
<div id="toc" class="toc2">
<div id="toctitle">Índice de contenidos</div>
<ul class="sectlevel1">
<li><a href="#sesion01">2. (1,5 puntos) Caso de estudio</a>
<ul class="sectlevel2">
<li><a href="#_introducci%C3%B3n_a_maven">2.1. Introducción a Maven</a>
<ul class="sectlevel3">
<li><a href="#_instalaci%C3%B3n_de_maven">2.1.1. Instalación de Maven</a></li>
<li><a href="#_dependencias_de_librer%C3%ADas_en_proyectos_java">2.1.2. Dependencias de librerías en proyectos Java</a></li>
<li><a href="#_el_proceso_de_build_de_un_proyecto">2.1.3. El proceso de build de un proyecto</a></li>
<li><a href="#_estructura_de_un_proyecto_maven">2.1.4. Estructura de un proyecto Maven</a></li>
<li><a href="#_pom_project_object_model">2.1.5. POM: Project Object Model</a></li>
<li><a href="#_repositorios_maven">2.1.6. Repositorios Maven</a></li>
<li><a href="#_dependencias_de_versiones">2.1.7. Dependencias de versiones</a></li>
<li><a href="#_gesti%C3%B3n_de_dependencias">2.1.8. Gestión de dependencias</a></li>
<li><a href="#_el_ciclo_de_vida_de_maven">2.1.9. El ciclo de vida de Maven</a></li>
<li><a href="#_ejecuci%C3%B3n_de_tests">2.1.10. Ejecución de  tests</a></li>
<li><a href="#_uso_de_maven_en_intellij">2.1.11. Uso de Maven en IntelliJ</a></li>
<li><a href="#_maven_con_git">2.1.12. Maven con Git</a></li>
<li><a href="#_c%C3%B3mo_crear_un_proyecto_maven_m%C3%ADnimo">2.1.13. Cómo crear un proyecto Maven mínimo</a></li>
</ul>
</li>
<li><a href="#_paso_a_paso_creaci%C3%B3n_del_proyecto_git">2.2. Paso a paso: creación del proyecto Git</a></li>
<li><a href="#_paso_a_paso_despliegue_con_maven">2.3. Paso a paso: despliegue con Maven</a></li>
<li><a href="#_paso_a_paso_despliegue_con_intellij">2.4. Paso a paso: despliegue con IntelliJ</a></li>
<li><a href="#_caso_de_estudio_y_modelo_de_dominio">2.5. Caso de estudio y modelo de dominio</a>
<ul class="sectlevel3">
<li><a href="#_introducci%C3%B3n">2.5.1. Introducción</a></li>
<li><a href="#_historias_de_usuario">2.5.2. Historias de usuario</a></li>
<li><a href="#_requisitos_de_informaci%C3%B3n_irq">2.5.3. Requisitos de información (IRQ)</a></li>
<li><a href="#_casos_de_uso">2.5.4. Casos de uso</a></li>
<li><a href="#_requisitos_de_restricci%C3%B3n_crq">2.5.5. Requisitos de restricción (CRQ)</a></li>
<li><a href="#_modelo_de_clases">2.5.6. Modelo de clases</a></li>
<li><a href="#_relaciones_entre_entidades_por_referencias_y_por_identificador">2.5.7. Relaciones entre entidades por referencias y por identificador</a></li>
</ul>
</li>
<li><a href="#_desarrollo_e_implementaci%C3%B3n_parte_guiada_0_5_puntos">2.6. Desarrollo e implementación (parte guiada, 0,5 puntos)</a>
<ul class="sectlevel3">
<li><a href="#_clase_abstracta_com%C3%BAn_a_todas_las_entidades_code_clasedominio_code">2.6.1. Clase abstracta común a todas las entidades <code>ClaseDominio</code></a></li>
<li><a href="#_clases_de_domino_code_libro_code_y_code_recomendacion_code">2.6.2. Clases de domino <code>Libro</code> y <code>Recomendacion</code></a></li>
<li><a href="#_jerarqu%C3%ADa_de_clases_code_usuario_code_code_alumno_code_code_profesor_code">2.6.3. Jerarquía de clases <code>Usuario</code>, <code>Alumno</code>, <code>Profesor</code></a></li>
<li><a href="#_gesti%C3%B3n_de_excepciones">2.6.4. Gestión de excepciones</a></li>
<li><a href="#_m%C3%A9todos_de_utilidad">2.6.5. Métodos de utilidad</a></li>
<li><a href="#_reglas_de_negocio">2.6.6. Reglas de negocio</a></li>
<li><a href="#_p%C3%A1gina_web_de_prueba">2.6.7. Página web de prueba</a></li>
</ul>
</li>
<li><a href="#_desarrollo_e_implementaci%C3%B3n_parte_no_guiada_1_punto">2.7. Desarrollo e implementación (parte no guiada, 1 punto)</a></li>
</ul>
</li>
</ul>
</div>
</div>
<div id="content">
<div id="preamble">
<div class="sectionbody">
<div style="page-break-after: always;"></div>
</div>
</div>
<div class="sect1">
<h2 id="sesion01">2. (1,5 puntos) Caso de estudio</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_introducción_a_maven">2.1. Introducción a Maven</h3>
<div class="paragraph">
<p>Maven es una herramienta Java de gestión del proceso de construcción de proyectos software, que simplifica la complejidad de sus distintas partes: compilación, prueba, empaquetamiento y despliegue. Es una herramienta muy popular en proyectos open source que facilita:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>La descarga de las librerías (ficheros JAR) externas de las que depende un proyecto</p>
</li>
<li>
<p>La construcción, prueba y despliegue del proyecto desarrollado, produciendo el fichero JAR o WAR final a partir de su código fuente y del fichero POM de descripción del proyecto</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Maven se origina de hecho en la comunidad <em>open source</em>, en concreto en la Apache Software Foundation en la que se desarrolló para poder gestionar y minimizar la complejidad de la construcción del proyecto Jakarta Turbine en 2002. El diseñador principal de Maven fue Jason van Zyl, ahora en la empresa Sonatype. En 2003 el proyecto fue aceptado como proyecto de nivel principal de Apache. En octubre de 2005 se lanzó Maven 2. Desde entonces ha sido adoptado como la herramienta de desarrollo de software de muchas empresas y se ha integrado con muchos otros proyectos y entornos. Maven 3.0 se lanzó en octubre de 2010, siendo la mayoría de sus comandos compatibles con Maven 2.</p>
</div>
<div class="paragraph">
<p>Maven es una herramienta de línea de comando, similar a las herramientas habituales en Java como <code>javac</code>, <code>jar</code> o a proyectos como Ant. Aunque es posible utilizar Maven en IDEs como Eclipse o Glassfish, es muy útil conocer la utilización de Maven en línea de comandos porque es la base de cualquier adaptación gráfica.</p>
</div>
<div class="paragraph">
<p>Una de las características principales de Maven es su enfoque declarativo, frente al enfoque orientado a tareas de herramientas tradicionales como Make o Ant. En Maven, el proceso de compilación de un proyecto se basa en una descripción de su estructura y de su contenido. Maven mantiene el concepto de modelo de un proyecto y obliga a definir un identificador único para cada proyecto que desarrollemos, así como declarar sus características (URL, versión, librerías que usa, tipo y nombre del artefacto generado, etc.). Todas estas características deben estar especificadas en el fichero POM (<em>Project Object Model</em>, fichero <code>pom.xml</code> en el directorio raíz del proyecto).</p>
</div>
<div class="paragraph">
<p>Maven impone una estructura de directorios en la que guardar los distintos elementos de un programa Java. En el caso de una aplicación web:</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="images/proyint01/maven.png" alt="Estructura de directorios de Maven" width="33%">
</div>
</div>
<div class="sect3">
<h4 id="_instalación_de_maven">2.1.1. Instalación de Maven</h4>
<div class="paragraph">
<p>Maven ya viene preinstalado en la máquina virtual del experto. La instalación en Linux es muy sencilla.</p>
</div>
<div class="paragraph">
<p>En primer lugar debemos descargar la última versión de la <a href="http://maven.apache.org/download.html">página web oficial</a> y descomprimirla en algún directorio del sistema. En el caso de la MV, lo hemos instalado en <code>/usr/local/maven</code>.</p>
</div>
<div class="paragraph">
<p>Maven es una aplicación Java, y utiliza la variable <code>JAVA_HOME</code> para encontrar la ruta del JDK. También es necesario añadir el directorio <code>bin</code> de Maven al <code>PATH</code> del sistema. Se pueden definir en el fichero de configuración <code>.profile</code> de un usuario. En nuestro caso hemos modificado el único usuario de la MV <code>expertojava</code>. La variabel de entorno <code>M2_HOME</code> es utilizada por IntelliJ para localizar la ubicación de Maven. El código que hemos añadido ha sido este:</p>
</div>
<div class="listingblock">
<div class="title">Fichero .profile:</div>
<div class="content">
<pre class="pygments highlight"><code data-lang="bash session"><span class="tok-gp">#</span><span class="tok-c"># Java</span>
<span class="tok-go">export JAVA_HOME=/usr/local/java</span>
<span class="tok-go">PATH=$JAVA_HOME/bin:$PATH</span>

<span class="tok-gp">#</span><span class="tok-c"># Maven</span>
<span class="tok-go">export M2_HOME=/usr/local/maven</span>
<span class="tok-go">PATH=$PATH:/usr/local/maven/bin</span></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_dependencias_de_librerías_en_proyectos_java">2.1.2. Dependencias de librerías en proyectos Java</h4>
<div class="paragraph">
<p>Una característica del desarrollo de proyectos Java es la gran cantidad de librerías (ficheros JAR) necesarios para compilar y ejecutar un proyecto. Todas las librerías que se importan deben estar físicamente tanto en la máquina en la que se compila el proyecto como en la que posteriormente se ejecuta.</p>
</div>
<div class="paragraph">
<p>El proceso de mantener estas dependencias es tedioso y muy propenso a errores. Hay que obtener las librerías, cuidar que sean las versiones correctas, obtener las librerías de las que éstas dependen a su vez y distribuirlas todas ellas en todos los ordenadores de los desarrolladores y en los servidores en los que el proyecto se va a desplegar.</p>
</div>
<div class="paragraph">
<p>Por ejemplo, si nuestro proyecto necesita una implementación de JPA, como Hibernate, es necesario bajarse todos los JAR de Hibernate, junto con los JAR de los que depende, una lista de más de 15 ficheros. Es complicado hacerlo a mano y distribuir los ficheros en todos los ordenadores en los que el proyecto debe compilarse y ejecutarse. Para que Maven automatice el proceso sólo es necesario declarar la dependencia con este JAR en el fichero POM con las siguientes líneas:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml">...
   <span class="tok-nt">&lt;dependency&gt;</span>
      <span class="tok-nt">&lt;groupId&gt;</span>org.hibernate<span class="tok-nt">&lt;/groupId&gt;</span>
      <span class="tok-nt">&lt;artifactId&gt;</span>hibernate-entitymanager<span class="tok-nt">&lt;/artifactId&gt;</span>
      <span class="tok-nt">&lt;version&gt;</span>3.5.6-Final<span class="tok-nt">&lt;/version&gt;</span>
   <span class="tok-nt">&lt;/dependency&gt;</span>
...</code></pre>
</div>
</div>
<div class="paragraph">
<p>Maven se encarga de descargar todas las bibliotecas necesarias para un proyecto cuando ejecutamos el comando <code>mvn install</code>. Las guarda en el denominado <em>repositorio local</em>, el directorio oculto <code>.m2</code> en el directorio raíz del usuario, y después copia referencias a ellas en el proyecto.</p>
</div>
</div>
<div class="sect3">
<h4 id="_el_proceso_de_build_de_un_proyecto">2.1.3. El proceso de build de un proyecto</h4>
<div class="paragraph">
<p>Los que hemos programado en C recordamos los ficheros <code>Makefile</code> en los que se especificaban las dependencias entre los distintos elementos de un proyecto y la secuencia de compilación necesaria para generar una librería o un ejecutable. En Java, el desarrollo de aplicaciones medianamente complejas es más complicado que en C. Estamos obligados a gestionar un gran número de recursos: código fuente, ficheros de configuración, librerías externas, librerías desarrolladas en la empresa, etc. Para gestionar este desarrollo es necesario algo de más nivel que las herramientas que proporciona Java (<code>javac</code>, <code>jar</code>, <code>rmic</code>, <code>java</code>, etc.)</p>
</div>
<div class="paragraph">
<p>¿En qué consiste el proceso de compilación y empaquetado en Java?. Básicamente en construir lo que Maven llama un <em>artefacto</em> (terminología de Maven que significa <em>fichero</em>) a partir de un proyecto Java definido con una estructura propia de Maven (apartado siguiente). Los posibles artefactos en los que podemos empaquetar un programa Java son:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Fichero JAR</dt>
<dd>
<p>librería de clases o aplicación standalone. Contiene clases Java compiladas (.class) organizadas en paquetes, ficheros de recursos y (opcionalmente) otros ficheros JAR con bibliotecas usadas por las clases. En las aplicaciones enterprise, los EJB también se empaquetan en ficheros JAR que se despliegan en servidores de aplicaciones.</p>
</dd>
<dt class="hdlist1">Fichero WAR</dt>
<dd>
<p>aplicación web lista para desplegarse en un servidor web. Contiene un conjunto de clases Java, bibliotecas, ficheros de configuración y ficheros de distintos formatos que maneja el servidor web (HTML, JPG, etc.)</p>
</dd>
<dt class="hdlist1">Fichero EAR</dt>
<dd>
<p>aplicación enterprise que se despliega en un servidor de aplicaciones. Contiene bibliotecas, componentes EJB y distintas aplicaciones web (ficheros WAR).</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>Además, el ciclo de desarrollo de un proyecto es más complejo que esta construcción, ya que es necesario realizar un conjunto de tareas adicionales como gestionar las dependencias con librerías externas, integrar el código en repositorios de control de versiones (CVS, subversion o Git), lanzar tests o desplegar la aplicación en algún servidor de aplicaciones.</p>
</div>
<div class="paragraph">
<p>Podría pensarse que los entornos de desarrollo (Eclipse, Netbeans o IntelliJ) pueden dar una buena solución a la complejidad del proceso de construcción, pero no es así. Son imprescindibles para el desarrollo, pero no ayudan demasiado en la construcción del proyecto. La configuración de las dependencias se realiza mediante asistentes gráficos que no generan ficheros de texto comprensibles que podamos utilizar para comunicarnos con otros compañeros o equipos de desarrolladores y que pueden dar lugar a errores. El hecho de que sean entornos gráficos hacen complicado también usarlos en procesos de automatización y de integración continua.</p>
</div>
</div>
<div class="sect3">
<h4 id="_estructura_de_un_proyecto_maven">2.1.4. Estructura de un proyecto Maven</h4>
<div class="paragraph">
<p>La estructura de directorios de una aplicación web Maven es la que hemos visto anteriormente. Volvemos a mostrar aquí la figura:</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="images/proyint01/maven.png" alt="Estructura de directorios de Maven" width="33%">
</div>
</div>
<div class="paragraph">
<p>El nombre del directorio raíz no influye en el proyecto Maven, podemos cambiarlo sin que afecte a ninguno de sus elementos. En ese directorio raíz se definen los siguientes directorios:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>src</code>: código fuente del proyecto, tanto clases principales como clases de prueba. Dentro se define un directorio <code>main</code> y otro <code>test</code>, en donde van el código fuente de la aplicación y su código de prueba. Dentro de ambos se define un directorio <code>java</code> con los paquetes de código fuente de la aplicación, un directorio <code>webapps</code> con los ficheros HTML, JSP y de configuración de la aplicación web y un directorio <code>resources</code> en el que se dejan ficheros de configuración. Ambos directorios se añaden al <em>classpath</em>.</p>
</li>
<li>
<p><code>target</code>: clases compiladas y artefactos generados a partir del código fuente y del resto de ficheros del directorio <code>src</code>.</p>
</li>
<li>
<p>fichero <code>pom.xml</code>: fichero con la descripción de los elementos necesarios para todo el ciclo de vida del proyecto: compilación, test, empaquetado, despliegue e instalación en el repositorio de la empresa.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_pom_project_object_model">2.1.5. POM: Project Object Model</h4>
<div class="paragraph">
<p>El elemento más importante de un proyecto Maven, a parte de su estructura, es su fichero POM en el que se define completamente el proyecto. Este fichero define elementos XML preestablecidos que deben ser definidos para el proyecto concreto que estamos desarrollando. Viendo algunos de ellos podemos entender también más características de Maven.</p>
</div>
<div class="paragraph">
<p>Vamos a utilizar como ejemplo la versión inicial del POM del proyecto web que vamos a construir en un rato. Veamos su fichero <code>pom.xml</code>.  Al comienzo nos encontramos con la cabecera XML y la definición del proyecto:</p>
</div>
<div class="listingblock">
<div class="title">pom.xml</div>
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><span class="tok-cp">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
<span class="tok-nt">&lt;project</span> <span class="tok-na">xmlns=</span><span class="tok-s">&quot;http://maven.apache.org/POM/4.0.0&quot;</span>  <span class="tok-na">xmlns:xsi=</span><span class="tok-s">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span> <span class="tok-na">xsi:schemaLocation=</span><span class="tok-s">&quot;http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd&quot;</span><span class="tok-nt">&gt;</span> <i class="conum" data-value="1"></i><b>(1)</b>
    <span class="tok-nt">&lt;modelVersion&gt;</span>4.0.0<span class="tok-nt">&lt;/modelVersion&gt;</span>

    <span class="tok-nt">&lt;groupId&gt;</span>org.expertojava<span class="tok-nt">&lt;/groupId&gt;</span>
    <span class="tok-nt">&lt;artifactId&gt;</span>jbib-rest<span class="tok-nt">&lt;/artifactId&gt;</span>
    <span class="tok-nt">&lt;version&gt;</span>1.0-SNAPSHOT<span class="tok-nt">&lt;/version&gt;</span><i class="conum" data-value="2"></i><b>(2)</b>
    <span class="tok-nt">&lt;packaging&gt;</span>war<span class="tok-nt">&lt;/packaging&gt;</span> <i class="conum" data-value="3"></i><b>(3)</b>

    <span class="tok-nt">&lt;name&gt;</span>jbib-rest<span class="tok-nt">&lt;/name&gt;</span> <i class="conum" data-value="4"></i><b>(4)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>La primera definición <code>project xmlns</code> es común para todos los ficheros <code>pom.xml</code>. En ella se declara el tipo de esquema XML y la dirección donde se encuentra el fichero de esquema XML. Se utiliza para que los editores de XML puedan validar correctamente el fichero. Esta sintaxis depende de la versión de Maven que se esté utilizando.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Después aparece la identificación del proyecto, en la que hay que definir el grupo que desarrolla el proyecto (<em>groupId</em>), el nombre del artefacto que genera el proyecto (<em>artifactId</em>), el tipo de empaquetamiento (<em>packaging</em>) y su versión (<em>version</em>). Estos campos representan las denominadas <em>coordenadas del proyecto</em> (hablaremos de ello más adelante). En nuestro caso son <code>org.expertojava:jbib-rest:war:1.0-SNAPSHOT</code>.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>En el atributo <code>packaging</code> debemos definir el tipo de empaquetado del <em>artefacto</em>  resultante. En nuestro caso, será un fichero WAR que contendrá toda la aplicación web. Este artefacto se generará cuando hagamos un <code>mvn package</code>.</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Por último, el atributo <code>name</code> define el nombre lógico del proyecto.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>A continuación se definen algunas propiedades del proyecto, que se utilizarán en los distintos procesos de Maven. En nuestro caso, por ahora, sólo la codificación de caracteres que estamos utilizando en el código fuente de nuestro proyecto:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><span class="tok-nt">&lt;properties&gt;</span>
    <span class="tok-nt">&lt;project.build.sourceEncoding&gt;</span>UTF-8<span class="tok-nt">&lt;/project.build.sourceEncoding&gt;</span>
<span class="tok-nt">&lt;/properties&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Después vienen la definición de las dependencias del proyecto: librerías de las que dependen el proyecto. En nuestro caso:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Librerías Java EE: <code>javax:javaee-web-api:7.0</code></p>
</li>
<li>
<p>Librarías para logs logs_ : <code>log4j:log4j:1.2.17</code> y <code>commons-logging:commons-logging:1.2</code></p>
</li>
<li>
<p>JUnit: <code>junit:junit:4.11</code></p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml">    <span class="tok-nt">&lt;dependencies&gt;</span>
        <span class="tok-nt">&lt;dependency&gt;</span>
            <span class="tok-nt">&lt;groupId&gt;</span>javax<span class="tok-nt">&lt;/groupId&gt;</span>
            <span class="tok-nt">&lt;artifactId&gt;</span>javaee-web-api<span class="tok-nt">&lt;/artifactId&gt;</span>
            <span class="tok-nt">&lt;version&gt;</span>7.0<span class="tok-nt">&lt;/version&gt;</span>
            <span class="tok-nt">&lt;scope&gt;</span>provided<span class="tok-nt">&lt;/scope&gt;</span>
        <span class="tok-nt">&lt;/dependency&gt;</span>
        <span class="tok-nt">&lt;dependency&gt;</span>
            <span class="tok-nt">&lt;groupId&gt;</span>log4j<span class="tok-nt">&lt;/groupId&gt;</span>
            <span class="tok-nt">&lt;artifactId&gt;</span>log4j<span class="tok-nt">&lt;/artifactId&gt;</span>
            <span class="tok-nt">&lt;version&gt;</span>1.2.17<span class="tok-nt">&lt;/version&gt;</span>
        <span class="tok-nt">&lt;/dependency&gt;</span>
        <span class="tok-nt">&lt;dependency&gt;</span>
            <span class="tok-nt">&lt;groupId&gt;</span>commons-logging<span class="tok-nt">&lt;/groupId&gt;</span>
            <span class="tok-nt">&lt;artifactId&gt;</span>commons-logging<span class="tok-nt">&lt;/artifactId&gt;</span>
            <span class="tok-nt">&lt;version&gt;</span>1.2<span class="tok-nt">&lt;/version&gt;</span>
        <span class="tok-nt">&lt;/dependency&gt;</span>
        <span class="tok-nt">&lt;dependency&gt;</span>
            <span class="tok-nt">&lt;groupId&gt;</span>junit<span class="tok-nt">&lt;/groupId&gt;</span>
            <span class="tok-nt">&lt;artifactId&gt;</span>junit<span class="tok-nt">&lt;/artifactId&gt;</span>
            <span class="tok-nt">&lt;version&gt;</span>4.11<span class="tok-nt">&lt;/version&gt;</span>
        <span class="tok-nt">&lt;/dependency&gt;</span>
    <span class="tok-nt">&lt;/dependencies&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Por último, definimos algunas características de los procesos de Maven que construyen el proyecto, definiendo parámetros para los <em>pluging</em> de Maven que se encargan de ejecutarlos.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml">    <span class="tok-nt">&lt;build&gt;</span>
        <span class="tok-nt">&lt;finalName&gt;</span>${project.name}<span class="tok-nt">&lt;/finalName&gt;</span> <i class="conum" data-value="1"></i><b>(1)</b>
        <span class="tok-nt">&lt;plugins&gt;</span>
            <span class="tok-nt">&lt;plugin&gt;</span>
                <span class="tok-nt">&lt;groupId&gt;</span>org.apache.maven.plugins<span class="tok-nt">&lt;/groupId&gt;</span>  <i class="conum" data-value="2"></i><b>(2)</b>
                <span class="tok-nt">&lt;artifactId&gt;</span>maven-compiler-plugin<span class="tok-nt">&lt;/artifactId&gt;</span>
                <span class="tok-nt">&lt;version&gt;</span>3.1<span class="tok-nt">&lt;/version&gt;</span>
                <span class="tok-nt">&lt;configuration&gt;</span>
                    <span class="tok-nt">&lt;source&gt;</span>1.7<span class="tok-nt">&lt;/source&gt;</span>
                    <span class="tok-nt">&lt;target&gt;</span>1.7<span class="tok-nt">&lt;/target&gt;</span>
                <span class="tok-nt">&lt;/configuration&gt;</span>
            <span class="tok-nt">&lt;/plugin&gt;</span>
            <span class="tok-nt">&lt;plugin&gt;</span>
                <span class="tok-nt">&lt;groupId&gt;</span>org.apache.maven.plugins<span class="tok-nt">&lt;/groupId&gt;</span> <i class="conum" data-value="3"></i><b>(3)</b>
                <span class="tok-nt">&lt;artifactId&gt;</span>maven-war-plugin<span class="tok-nt">&lt;/artifactId&gt;</span>
                <span class="tok-nt">&lt;version&gt;</span>2.3<span class="tok-nt">&lt;/version&gt;</span>
                <span class="tok-nt">&lt;configuration&gt;</span>
                    <span class="tok-nt">&lt;failOnMissingWebXml&gt;</span>false<span class="tok-nt">&lt;/failOnMissingWebXml&gt;</span>
                <span class="tok-nt">&lt;/configuration&gt;</span>
            <span class="tok-nt">&lt;/plugin&gt;</span>
            <span class="tok-nt">&lt;plugin&gt;</span>
                <span class="tok-nt">&lt;groupId&gt;</span>org.wildfly.plugins<span class="tok-nt">&lt;/groupId&gt;</span> <i class="conum" data-value="4"></i><b>(4)</b>
                <span class="tok-nt">&lt;artifactId&gt;</span>wildfly-maven-plugin<span class="tok-nt">&lt;/artifactId&gt;</span>
                <span class="tok-nt">&lt;version&gt;</span>1.0.2.Final<span class="tok-nt">&lt;/version&gt;</span>
                <span class="tok-nt">&lt;configuration&gt;</span>
                    <span class="tok-nt">&lt;hostname&gt;</span>localhost<span class="tok-nt">&lt;/hostname&gt;</span>
                    <span class="tok-nt">&lt;port&gt;</span>9990<span class="tok-nt">&lt;/port&gt;</span>
                <span class="tok-nt">&lt;/configuration&gt;</span>
            <span class="tok-nt">&lt;/plugin&gt;</span>
        <span class="tok-nt">&lt;/plugins&gt;</span>
    <span class="tok-nt">&lt;/build&gt;</span>
<span class="tok-nt">&lt;/project&gt;</span></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>En <code>finalName</code> definimos el nombre del <em>artefacto</em> generado cuando hagamos un <code>mvn package</code>. En nuestro caso será <code>jbib-web.war</code>.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>En el plugin <code>maven-compiler-plugin</code> declaramos la versión de Java con la que queremos que se compilen las clases. En nuestro caso, la versión 1.7.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>El plugin <code>maven-war-plugin</code> lo usamos únicamente para declarar que podemos no incluir un fichero <code>web.xml</code> en la aplicación.</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Por último, el <a href="https://docs.jboss.org/wildfly/plugins/maven/latest/">plugin de Maven de Wildfly</a> <code>wildfly-maven-plugin</code> permite realizar el despliegue de la aplicación web en el servidor de aplicaciones. El despliegue se realiza con el comando <code>mvn wildfly:deploy</code>.</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_repositorios_maven">2.1.6. Repositorios Maven</h4>
<div class="paragraph">
<p>Los proyectos software modernos necesitan un gran número de clases y librerías definidas en otros proyectos. Esos proyectos pueden ser otros desarrollados por nosotros en la empresa o librerías open source bajadas de Internet.</p>
</div>
<div class="paragraph">
<p>La tarea de mantener las dependencias de un proyecto es complicada, tanto para las dependencias entre nuestros proyectos como las dependencias con otros proyectos open source disponibles en Internet. Por ejemplo, si queremos utilizar un framework como Spring, tendremos que descargarnos no sólo los JAR desarrollados en el proyecto, sino también un buen número de otras librerías open source que usa. Cada librería es un fichero JAR. ¿Qué pasa si alguna de esas librerías ya las estamos usando y las tenemos ya descargadas? O, peor aún, ¿Qué pasa si estamos usando otras versiones de esas librerías en nuestros proyectos? ¿Podremos detectar los posibles conflictos?. Maven se encarga de gestionar estas dependencias directas y las dependencias transitivas mediante los ficheros POM:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Descarga las librerías necesarias para construir el proyecto y los ficheros POM asociados a esas librerías</p>
</li>
<li>
<p>Resuelve dependencias transitivas, librerías que dependen de librerías de las que dependen nuestro proyecto</p>
</li>
<li>
<p>Resuelve conflictos entre librerías</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Un elemento fundamental para gestionar las dependencias es poder identificar y nombrar un proyecto. En Maven el nombre de un proyecto se define mediante los siguientes elementos (que en Maven se denominan <em>coordenadas</em>):</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">groupId</dt>
<dd>
<p>El grupo, compañía, equipo, organización, etc. Se utiliza una convención similar a la de los paquetes Java, comenzando por el nombre de dominio invertido de la organización que crea el proyecto. Por ejemplo, los <code>groupId</code> de la Apache Software Foundation comienzan con <code>org.apache</code></p>
</dd>
<dt class="hdlist1">artifactId</dt>
<dd>
<p>Identificador único que representa de forma única el proyecto dentro del <code>groupId</code></p>
</dd>
<dt class="hdlist1">version</dt>
<dd>
<p>Número de versión del proyecto, por ejemplo <code>1.3.5</code> o <code>1.3.6-beta-01</code>. Es posible utilizar la palabra <code>SNAPSHOT</code> en el número de versión para indicar que es una versión en desarrollo y que todavía no está lanzada. Se utiliza internamente en los proyectos en desarrollo. La idea es que antes de que terminemos el desarrollo de la versión 1.0 (o cualquier otro número de versión), utilizaremos el nombre <code>1.0-SNAPSHOT</code> para indicar que se trata de "1.0 en desarrollo".</p>
</dd>
<dt class="hdlist1">packaging</dt>
<dd>
<p>Tipo de empaquetamiento del proyecto. Por defecto es <code>jar</code>. Un tipo <code>jar</code> genera una librería JAR, un tipo <code>war</code> se refiere a una aplicación web.</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>En Maven un proyecto genera un artefacto. El artefacto puede ser un fichero JAR, WAR o EAR. El tipo de artefacto viene indicado en el tipo de empaquetamiento del proyecto.</p>
</div>
<div class="paragraph">
<p>El nombre final del fichero resultante de la construcción del proyecto es por defecto: <code>&lt;artifactId&gt;-&lt;version&gt;.&lt;packaging&gt;</code>.</p>
</div>
<div class="paragraph">
<p>Por ejemplo, Apache ha desarrollado el proyecto <code>commons-email</code> que proporciona una serie de utilidades para la gestión de correos electrónicos en Java. Sus coordenadas son:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml">org.apache.commons:commons-email:1.1:jar</code></pre>
</div>
</div>
<div class="paragraph">
<p>El artefacto (fichero JAR) generado por el proyecto tiene como nombre <code>email-1.1.jar</code></p>
</div>
<div class="paragraph">
<p>Cuando ejecutamos Maven por primera vez veremos que descarga un número de ficheros del repositorio remoto de Maven. Estos ficheros corresponden a plugins y librerías que necesita para construir el proyecto con el que estamos trabajando. Maven los descarga de un repositorio global a un repositorio local donde están disponibles para su uso. Sólo es necesario hacer esto la primera vez que se necesita la librería o el plugin. Las siguientes ocasiones ya está disponible en el repositorio local.</p>
</div>
<div class="paragraph">
<p>La direcciones en las que se encuentran los repositorios son las siguientes:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Repositorio central</dt>
<dd>
<p>El repositorio central de Maven se encuentra en <a href="http://repo1.maven.org/maven2">http://repo1.maven.org/maven2</a>. Se puede acceder a la dirección con un navegador y explorar su estructura.</p>
</dd>
<dt class="hdlist1">Repositorio local</dt>
<dd>
<p>El repositorio local se encuentra en el directorio <code>${HOME}/.m2/repository</code>.</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>La estructura de directorios de los repositorios (tanto el central como el local) está directamente relacionada con las <em>coordenadas</em> de los proyectos. Los proyectos tienen la siguiente ruta, relativa a la raíz del repositorio:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml">/<span class="tok-nt">&lt;groupId&gt;</span>/<span class="tok-nt">&lt;artifactId&gt;</span>/<span class="tok-nt">&lt;version&gt;</span>/<span class="tok-nt">&lt;artifactId&gt;</span>-<span class="tok-nt">&lt;version&gt;</span>.<span class="tok-nt">&lt;packaging&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Por ejemplo, el artefacto <code>commons-email-1.1.jar</code>, con coordenadas <code>org.apache.commons:commons-email:1.1:jar</code> está disponible en la ruta:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml">/org/apache/commons/commons-email/1.1/commons-email-1.1.jar]]</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_dependencias_de_versiones">2.1.7. Dependencias de versiones</h4>
<div class="paragraph">
<p>El estándar de Maven para los números de versiones es muy importante, porque permite definir reglas para gestionar correctamente las dependencias en caso de conflicto. El número de versión de un proyecto se define por un número principal, un número menor y un número incremental. También es posible definir un calificador, para indicar una versión alfa o beta. Los números se separan por puntos y el calificador por un guión. Por ejemplo, el número <code>1.3.5-alpha-03</code> define un número de versión principal 1, la versión menor 3, la versión incremental de 5 y el calificador de <code>alpha-03</code>.</p>
</div>
<div class="paragraph">
<p>Maven compara las versiones de una dependencia utilizando este orden. Por ejemplo, la versión 1.3.4 representa un build más reciente que la 1.0.9. Los clasificadores se comparan utilizando comparación de cadenas. Hay que tener cuidado, porque <code>alpha10</code> es anterior a <code>alpha2</code>; habría que llamar al segundo <code>alpha02</code>.</p>
</div>
<div class="paragraph">
<p>Maven permite definir rangos de versiones en las dependencias, utilizando los operadores de rango exclusivos <code>(</code>, <code>)</code> o inclusivos <code>[</code>, <code>]</code>. Así, por ejemplo, si queremos indicar que nuestro proyecto necesita una versión de JUnit mayor o igual de 3.8, pero menor que 4.0, lo podemos indicar con el siguiente rango:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><span class="tok-nt">&lt;version&gt;</span>[3.8,4.0)<span class="tok-nt">&lt;/version&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Si una dependencia transitiva necesita la versión 3.8.1, esa es la escoge Maven sin crear ningún conflicto.</p>
</div>
<div class="paragraph">
<p>Es posible también indicar rangos de mayor que o menor que dejando sin escribir ningún número de versión antes o después de la coma. Por ejemplo, <code>[4.0,)</code> representa cualquier número mayor o igual que 4.0, <code>(,2.0)</code> representa cualquier versión menor que la <code>2.0</code> y <code>[1.2]</code> significa sólo la versión <code>1.2</code> y ninguna otra.</p>
</div>
<div class="paragraph">
<p>Cuando dos proyectos necesitan dos versiones distintas de la misma librería, Maven intenta resolver el conflicto, descargándose la que satisface todos los rangos. Si no utilizamos los operadores de rango estamos indicando que preferimos esa versión, pero que podríamos utilizar alguna otra. Por ejemplo, es distinto especificar <code>3.1</code> y <code>[3.1]</code>. En el primer caso preferimos la versión 3.1, pero si otro proyecto necesitara la <code>3.2</code> Maven se descargaría esa. En el segundo caso exigimos que la versión descargada sea la <code>3.1</code>. Si otro proyecto especifica otra versión obligatoria, por ejemplo <code>3.2</code>, entonces el proyecto no se compilará.</p>
</div>
<div class="paragraph">
<p>La utilización de la palabra <code>SNAPSHOT</code> en una dependencia hace que Maven descargue al repositorio local la última versión disponible del artefacto. Por ejemplo, si declaramos que necesitamos la librería <code>foo-1.0-SNAPSHOT.jar</code> cuando construyamos el proyecto Maven intentará buscar en el repositorio remoto la última versión de esta librería, incluso aunque ya exista en el repositorio local. Si encuentra en el repositorio remoto la versión <code>foo-1.0.-20110506.110000-1.jar</code> (versión que fue generada el 2011/05/06 a las 11:00:00) la descarga y sustituye la que tiene en el local. De forma inversa, cuando ejecutamos el goal <em>install</em> y se despliega el artefacto en el servidor remoto, Maven sustituye el palabra <code>SNAPSHOT</code> por la fecha actual.</p>
</div>
</div>
<div class="sect3">
<h4 id="_gestión_de_dependencias">2.1.8. Gestión de dependencias</h4>
<div class="paragraph">
<p>Hemos visto que una de las características principales de Maven es la posibilidad de definir las dependencias de un proyecto. En la sección <code>dependencies</code> del fichero POM se declaran las librerías necesarias para compilar, testear y ejecutar nuestra aplicación. Maven obtiene estas dependencias del repositorio central o de algún repositorio local configurado por nuestra empresa y las guarda en el directorio <code>.$HOME/.m2/repository</code>. Si utilizamos la misma librería en un varios proyectos, sólo se descargará una vez, lo que nos ahorrará espacio de disco y tiempo. Y lo que es más importante, el proyecto será mucho más ligero y portable, porque no llevará incluidas las librerías que necesita para su construcción.</p>
</div>
<div class="paragraph">
<p>Ya hemos visto en apartados anteriores cómo se declaran las dependencias en el fichero POM. Cada dependencia se define de forma unívoca utilizando sus coordenadas. El mecanismo de declaración de las dependencias es el mismo para las dependencias de librerías externas como para las definidas dentro de la organización.</p>
</div>
<div class="paragraph">
<p>Para definir una dependencia hay que identificar también el número de versión que se quiere utilizar, utilizando la nomenclatura del apartado anterior. Por ejemplo, la siguiente dependencia especifica una versión 3.0 o posterior de <code>hibernate</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><span class="tok-nt">&lt;dependency&gt;</span>
   <span class="tok-nt">&lt;groupId&gt;</span>org.hibernate<span class="tok-nt">&lt;/groupId&gt;</span>
   <span class="tok-nt">&lt;artifactId&gt;</span>hibernate<span class="tok-nt">&lt;/artifactId&gt;</span>
   <span class="tok-nt">&lt;version&gt;</span>[3.0,)<span class="tok-nt">&lt;/version&gt;</span>
<span class="tok-nt">&lt;/dependency&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Un concepto fundamental en Maven es el de dependencia transitiva. En los repositorios no solo se depositan los artefactos generados por los proyectos, sino también el fichero POM del proyecto. Y en ese fichero se definen las dependencias propias del proyecto. Por ejemplo, junto con el artefacto <code>hibernate-3.0.jar</code> se encuentra el fichero POM <code>hibernate-3.0.pom.xml</code> en el que se definen sus propias dependencias, librerías necesarias para Hibernate-3.0. Estas librerías son dependencias transitivas de nuestro proyecto. Si nuestro proyecto necesita Hibernate, e Hibernate necesita estas otra librería B, nuestro proyecto también necesita (de forma transitiva) la librería B. A su vez esa librería B tendrá también otras dependencias, y así sucesivamente.</p>
</div>
<div class="paragraph">
<p>Maven se encarga de resolver todas las dependencias transitivas y de descargar al respositorio local todos los artefactos necesarios para que nuestro proyecto se construya correctamente.</p>
</div>
<div class="paragraph">
<p>Otro elemento importante es el ámbito (<em>scope</em>) en el que se define la dependencia. El ámbito por defecto es <em>compile</em> y define librerías necesarias para la compilación del proyecto. También es posible especificar otros ámbitos. Por ejemplo <em>test</em>, indicando que la librería es necesaria para realizar pruebas del proyecto:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><span class="tok-nt">&lt;dependency&gt;</span>
   <span class="tok-nt">&lt;groupId&gt;</span>junit<span class="tok-nt">&lt;/groupId&gt;</span>
   <span class="tok-nt">&lt;artifactId&gt;</span>junit<span class="tok-nt">&lt;/artifactId&gt;</span>
   <span class="tok-nt">&lt;version&gt;</span>4.8.1<span class="tok-nt">&lt;/version&gt;</span>
   <span class="tok-nt">&lt;type&gt;</span>jar<span class="tok-nt">&lt;/type&gt;</span>
   <span class="tok-nt">&lt;scope&gt;</span>test<span class="tok-nt">&lt;/scope&gt;</span>
<span class="tok-nt">&lt;/dependency&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Otros ámbitos posibles son <em>provided</em> y <em>runtime</em>. Una dependencia se define <em>provided</em> cuando es necesaria para compilar la aplicación, pero que no se incluirá en el WAR y no será desplegada. Por ejemplo las APIs de servlets:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><span class="tok-nt">&lt;dependency&gt;</span>
   <span class="tok-nt">&lt;groupId&gt;</span>javax.servlet<span class="tok-nt">&lt;/groupId&gt;</span>
   <span class="tok-nt">&lt;artifactId&gt;</span>servlet-api<span class="tok-nt">&lt;/artifactId&gt;</span>
   <span class="tok-nt">&lt;version&gt;</span>2.4<span class="tok-nt">&lt;/version&gt;</span>
   <span class="tok-nt">&lt;scope&gt;</span>provided<span class="tok-nt">&lt;/scope&gt;</span>
<span class="tok-nt">&lt;/dependency&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Las dependencias <em>runtime</em> son dependencias que no se necesitan para la compilación, sólo para la ejecución. Por ejemplo los drivers de JDBC para conectarse a la base de datos:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><span class="tok-nt">&lt;dependency&gt;</span>
   <span class="tok-nt">&lt;groupId&gt;</span>mysql<span class="tok-nt">&lt;/groupId&gt;</span>
   <span class="tok-nt">&lt;artifactId&gt;</span>mysql-connector-java<span class="tok-nt">&lt;/artifactId&gt;</span>
   <span class="tok-nt">&lt;version&gt;</span>3.1.13<span class="tok-nt">&lt;/version&gt;</span>
   <span class="tok-nt">&lt;scope&gt;</span>runtime<span class="tok-nt">&lt;/scope&gt;</span>
<span class="tok-nt">&lt;/dependency&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Una herramienta muy útil es el informe de dependencia. Este informe se genera cuando se ejecuta el objetivo <code>site</code>. Maven construye un sitio web con información sobre el proyecto y coloca el informe en el fichero <code>target/dependencies.html</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="bash session"><span class="tok-gp">$</span> mvn site</code></pre>
</div>
</div>
<div class="paragraph">
<p>El informe muestra una lista de dependencias directas y transitivas y su ámbito.</p>
</div>
</div>
<div class="sect3">
<h4 id="_el_ciclo_de_vida_de_maven">2.1.9. El ciclo de vida de Maven</h4>
<div class="paragraph">
<p>El concepto de ciclo de vida es central para Maven. El ciclo de vida de un proyecto Maven es una secuencia de fases que hay que seguir de forma ordenada para construir el artefacto final.</p>
</div>
<div class="paragraph">
<p>Las fases principales del ciclo de vida por defecto son:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">validate</dt>
<dd>
<p>valida que el proyecto es correcto y que está disponible toda la información necesaria</p>
</dd>
<dt class="hdlist1">process-resources</dt>
<dd>
<p>procesar el código fuente, por ejemplo para filtrar algunos valores</p>
</dd>
<dt class="hdlist1">compile</dt>
<dd>
<p>compila el código fuente del proyecto</p>
</dd>
<dt class="hdlist1">test</dt>
<dd>
<p>lanza los tests del código fuente compilado del proyecto utilizando el framework de testing disponible. Estos tests no deben necesitar que el proyecto haya sido empaquetado o desplegado</p>
</dd>
<dt class="hdlist1">package</dt>
<dd>
<p>empaqueta el código compilado del proyecto en un formato distribuible, como un JAR</p>
</dd>
<dt class="hdlist1">integration-test</dt>
<dd>
<p>procesa y despliega el paquete en un entorno en donde se pueden realizar tests de integración</p>
</dd>
<dt class="hdlist1">verify</dt>
<dd>
<p>lanza pruebas que verifican que el paquete es válido y satisface ciertos criterios de calidad
install: instala el paquete en el repositorio local, para poder ser usado como librería en otros proyectos locales</p>
</dd>
<dt class="hdlist1">deploy</dt>
<dd>
<p>realizado en un entorno de integración o de lanzamiento, copia el paquete final en el repositorio remoto para ser compartido con otros desarrolladores y otros proyectos.</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>Todas estas fases se lanzan especificándolas como parámetro en el comando <code>mvn</code>. El comando <code>mvn</code> hay que ejecutarlo estando en el directorio del proyecto. Si ejecutamos una fase, Maven se asegura que el proyecto pasa por todas las fases anteriores. Por ejemplo:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="bash session"><span class="tok-gp">$</span> mvn install</code></pre>
</div>
</div>
<div class="paragraph">
<p>Esta llamada realiza la compilación, los tests, el empaquetado los tests de integración y la instalación del paquete resultante en el repositorio local de Maven.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Para un listado completo de todas las opciones de un comando <code>mvn</code> se puede consultar la página de Apache Maven <a href="http://maven.apache.org/guides/introduction/introduction-to-the-lifecycle.html">Introduction to the Build Lifecycle</a></p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_ejecución_de_tests">2.1.10. Ejecución de  tests</h4>
<div class="paragraph">
<p>Los tests de unidad son una parte importante de cualquier metodología moderna de desarrollo, y juegan un papel fundamental en el ciclo de vida de desarrollo de Maven. Por defecto, Maven obliga a pasar los tests antes de empaquetar el proyecto. Maven permite utilizar los frameworks de prueba JUnit y TestNG. Las clases de prueba deben colocarse en el directorio <code>src/test</code>.</p>
</div>
<div class="paragraph">
<p>Para ejecutar los tests se lanza el comando <code>mvn test</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="bash session"><span class="tok-gp">$</span> mvn <span class="tok-nb">test</span>
<span class="tok-go">[INFO] Scanning for projects...</span>
<span class="tok-go">...</span>
<span class="tok-go">-------------------------------------------------------</span>
<span class="tok-go"> T E S T S</span>
<span class="tok-go">-------------------------------------------------------</span>
<span class="tok-go">Running org.expertojava.jbibrest.modelo.UsuarioTest</span>
<span class="tok-go">Tests run: 5, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 0.082 sec</span>
<span class="tok-go">Running org.expertojava.jbibrest.modelo.OperacionTest</span>
<span class="tok-go">Tests run: 5, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 0.141 sec</span>
<span class="tok-go">Tests run: 8, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 0.018 sec</span>
<span class="tok-go">Running org.expertojava.jbibrest.modelo.AvisoTest</span>
<span class="tok-go">Tests run: 1, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 0.012 sec</span>

<span class="tok-go">Results :</span>

<span class="tok-go">Tests run: 19, Failures: 0, Errors: 0, Skipped: 0</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Maven compilará los tests si es necesario. Por defecto, los tests deben colocarse en el directorio <code>src/test</code> siguiendo una estructura idéntica a la estructura de clases del proyecto. Maven ejecutará todas las clases que comiencen o terminen con <code>Test</code> o que terminen con <code>TestCase</code>.</p>
</div>
<div class="paragraph">
<p>Los resultados detallados de los tests se producen en texto y en XML y se dejan en el directorio <code>target/surefire-reports</code>. Es posible también generar los resultados en HTML utilizando el comando:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="bash session"><span class="tok-gp">$</span> mvn surefire-report:report</code></pre>
</div>
</div>
<div class="paragraph">
<p>El informe HTML se generará en el fichero <code>target/site/surefire-report.html</code>.</p>
</div>
</div>
<div class="sect3">
<h4 id="_uso_de_maven_en_intellij">2.1.11. Uso de Maven en IntelliJ</h4>
<div class="paragraph">
<p>IntelliJ reconoce los proyectos Maven a través del POM. Para importar un proyecto Maven en el IDE debes pulsar en el POM del proyecto. IntelliJ analiza el POM, descarga todas las librerías necesarias, identifica los directorios de la aplicación y los configura como directorios de fuentes, de tests, etc.</p>
</div>
<div class="paragraph">
<p>En la siguiente imagen vemos la estructura de directorios y las librerías de una versión inicial del proyecto web cargado. Podemos ver este panel en la parte superior izquierda de IntelliJ.</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="images/proyint01/estructura-directorios.png" alt="Estructura directorios" width="33%">
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Bajo el directorio raíz vemos el directorio <code>src</code> con los subdirectorios <code>main</code> y <code>test</code>. También los ficheros <code>pom.xml</code> con el POM de Maven y el fichero <code>.gitignore</code> con los patrones a ignorar en el control de versiones. Y también se encuentra el directorio <code>.idea</code> y el fichero <code>jbib-rest.iml</code> propios del IDE.</p>
</li>
<li>
<p>Debajo vemos las librerías declaradas en el POM y descargadas por Maven. IntelliJ las reconoce como librerías del proyecto y las incluirá en el paquete WAR cuando se realice el despliegue y ejecución del proyecto.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>En la parte superior derecha de IntelliJ podemos ver el panel de Maven. Desde este panel podemos interactuar con el comando Maven.</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="images/proyint01/panel-maven.png" alt="Panel Maven" width="33%">
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Para ejecutar un <em>goal</em>, por ejemplo <code>package</code>, debemos seleccionar el objetivo y pulsar en el pequeño botón <em>play</em>, o hacer un doble click sobre el objetivo. Veremos que se abre en la parte inferior de IntelliJ un panel en el que se muestra la ejecución del comando Maven. El resultado es el mismo que si abrimos un terminal, nos movemos a la raíz del proyecto (que contiene el fichero POM) y ejecutamos desde línea de comando:</p>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="bash session"><span class="tok-gp">$</span> mvn <span class="tok-nb">test</span></code></pre>
</div>
</div>
</li>
<li>
<p>El plugin <code>org.wildfly.plugins</code> proporciona <em>goals</em> adicionales relacionados con el despliegue del WAR en el servidor de aplicaciones. Los veremos más adelante.</p>
</li>
<li>
<p>El icono <em>Maven</em> sirve para abrir una ventana de diálogo en la que podemos lanzar el comando Maven de forma textual, escribiendo los parámetros adicionales que necesitemos</p>
</li>
<li>
<p>El botón de refresco sirve para recargar el POM en IntelliJ y actualizar la estructura del proyecto y sus dependencias si hemos realizado algún cambio en el fichero.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Otra característica interesante de IntelliJ es que permite añadir dependencias en el POM de forma interactiva. Desde el fichero <code>pom.xml</code> pulsamos el botón derecho y seleccionamos <em>Generate&#8230;&#8203;</em> (o pulsamos <code>Alt+Insertar</code>) y aparecerá el siguiente menú que permite modificar elementos del POM de forma interactiva:</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="images/proyint01/generate-dependency.png" alt="Generate dependency" width="25%">
</div>
</div>
<div class="paragraph">
<p>Por ejemplo, seleccionando <em>Dependency</em> aparece una herramienta de búsqueda de librerías que permite filtrar por nombre y explorar las distintas versiones de las librerías disponibles en el repositorio central de Maven:</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="images/proyint01/add-dependencies.png" alt="Add dependencies" width="66%">
</div>
</div>
</div>
<div class="sect3">
<h4 id="_maven_con_git">2.1.12. Maven con Git</h4>
<div class="paragraph">
<p>Para crear un repositorio Git con un proyecto Maven, hay que hacer lo habitual: inicializar Git en la raíz del proyecto y añadir todos sus ficheros. Hay que tener cuidado de añadir en el repositorio sólo los ficheros fuente. Todos los ficheros de artefacto que crea Maven a partir de los ficheros fuente originales deben ser ignorados. Para ello basta con ignorar el directorio <code>target</code>.</p>
</div>
<div class="paragraph">
<p>El siguiente fichero <code>.gitignore</code> contiene las reglas que determinan los ficheros ignorados en un proyecto Maven en el que trabajamos con IntelliJ. Es recomendable ignorar también el fichero <code>.idea/workspace.xml</code> que contiene el estado de trabajo del IDE (pestañas abiertas, dimensiones de la ventana actual, etc.).</p>
</div>
<div class="listingblock">
<div class="title">Fichero <code>.gitignore</code></div>
<div class="content">
<pre class="pygments highlight"><code># ignore Maven generated target folders
target

# ignore IDEA files
.idea/workspace.xml</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_cómo_crear_un_proyecto_maven_mínimo">2.1.13. Cómo crear un proyecto Maven mínimo</h4>
<div class="paragraph">
<p>Para empezar a desarrollar un proyecto con Maven necesitamos comenzar con un proyecto Maven mínimo, en el que ir añadiendo todo el código. Hemos visto que un proyecto Maven consiste en:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>un directorio de proyecto en el que se incluye un fichero POM con la descripción de las dependencias y otras características del proyecto</p>
</li>
<li>
<p>la estructura de directorios propia de los proyectos Maven vista anteriormente</p>
</li>
</ul>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
El directorio contenedor del fichero POM y de la estructura de directorios Maven puede tener cualquier nombre. El nombre del proyecto Maven sólo se define en el fichero POM. Esta característica simplifica el manejo de los proyectos Maven, haciéndolos independiente del nombre del directorio donde están contenidos.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Hay varias formas posibles de crear un proyecto Maven. A lo largo del curso utilizaremos cualquiera de estas opciones indistintamente.</p>
</div>
<div class="sect4">
<h5 id="_creación_manual_de_directorios_y_pom">Creación manual de directorios y POM</h5>
<div class="paragraph">
<p>Una forma básica de crear esta estructura mínima es crear la estructura de directorios manualmente y un fichero POM mínimo en el que se defina el nombre del proyecto. Pero esta es una forma bastante tediosa, sobre todo por el trabajo de crear a mano la estructura de directorios.</p>
</div>
</div>
<div class="sect4">
<h5 id="_utilizando_un_arquetipo">Utilizando un arquetipo</h5>
<div class="paragraph">
<p>Para crear el proyecto de forma más cómoda podemos hacerlo a partir de un <em>arquetipo Maven</em> (desde línea de comando con el comando <code>mvn archetype:generate</code>, o desde IntelliJ) o a partir de una plantilla inicial que ya tengamos creada. En el primer caso como parte del proceso de creación se pide el nombre del proyecto que estamos creando, para añadirla al fichero POM. En el segundo caso debemos de cambiar este nombre a mano en el fichero POM.</p>
</div>
<div class="paragraph">
<p>Para crear un proyecto Maven mínimo desde un arquetipo podemos usar el arquetipo <code>org.codehaus.mojo.archetypes:webapp-javaee7:1.1</code> o también el arquetipo de Adam Bien <code>com.airhacks:javaee7-essentials-archetype:1.3</code> (<a href="https://github.com/AdamBien/javaee7-essentials-archetype">enlace GitHub</a>).</p>
</div>
</div>
<div class="sect4">
<h5 id="_desde_una_plantilla_inicial_en_bitbucket">Desde una plantilla inicial en Bitbucket</h5>
<div class="paragraph">
<p>También puedes tener una plantilla básica inicial en un repositorio Git como Bitbucket. En nuestro caso puedes usar la plantilla <code>ejemplo-webapp</code> que hemos dejado <a href="https://bitbucket.org/java_ua/ejemplo-webapp/">en Bitbucket</a>. Debes descargarla y cambiar el nombre del proyecto en el POM.</p>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_paso_a_paso_creación_del_proyecto_git">2.2. Paso a paso: creación del proyecto Git</h3>
<div class="paragraph">
<p>Por hacer sencillo el proceso de creación vamos a hacer un fork del proyecto inicial que hemos dejado en Bitbucket en el que ya hemos creado la estructura de directorios y el fichero POM necesarios, junto con el fichero <code>.gitignore</code> necesario para Git.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Haz un fork en tu cuenta de Bitbucket del proyecto <code>java_ua/jbib-rest</code></p>
</li>
<li>
<p>Descarga a tu ordenador este proyecto recién copiado. Puedes usar un <code>git clone</code> desde el terminal o la opción de IntelliJ <em>Check out from Version Control &gt; Git</em>. Colócalo, por ejemplo, en el escritorio.</p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="_paso_a_paso_despliegue_con_maven">2.3. Paso a paso: despliegue con Maven</h3>
<div class="paragraph">
<p>El proyecto de aplicación web que vamos a desarrollar a lo largo del curso se compone de dos partes principales:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Una aplicación Java que se despliega en un servidor Java EE (WildFly) e implementa un API REST que proporciona la lógica de negocio</p>
</li>
<li>
<p>Una aplicación JavaScript que proporciona la interfaz de usuario que se ejecuta en el navegador</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Vamos a comenzar a construir la aplicación Java, un artefacto WAR que contendrá distintos paquetes que iremos desarrollando a lo largo de estas sesiones.</p>
</div>
<div class="paragraph">
<p>Comenzaremos con una aplicación muy básica, similar a la que has desarrollado en la asignatura de <em>Componentes Web</em>, que contiene algunos elementos iniciales básicos:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Fichero JSP con un formulario que envía una petición a un servlet</p>
</li>
<li>
<p>Servlet que procesa los parámetros de la petición y gestiona algún error e invoca a una clase del modelo</p>
</li>
<li>
<p>Clase del modelo que implementa una sencilla funcionalidad y realiza una mínima gestión de errores</p>
</li>
<li>
<p>Logging</p>
</li>
<li>
<p>Tests</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Todo esto en un proyecto Maven con un POM que permite generar el WAR y desplegarlo en el servidor WildFly.</p>
</div>
<div class="paragraph">
<p>La mayor parte de esta aplicación básica ya está preparada en el proyecto que te has descargado.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Vamos a comenzar probando que el proyecto compila correctamente y que los tests pasan. Abre un terminal, vete al directorio de proyeto  y lanza el comando <code>mvn test</code>:</p>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="bash session"><span class="tok-gp">$</span> <span class="tok-nb">cd </span>jbib-web
<span class="tok-gp">$</span> mvn <span class="tok-nb">test</span>
<span class="tok-go">...</span>
<span class="tok-go">-------------------------------------------------------</span>
<span class="tok-go"> T E S T S</span>
<span class="tok-go"> -------------------------------------------------------</span>
<span class="tok-go"> Running org.expertojava.jbibrest.modelo.NombreTest</span>
<span class="tok-go"> 06/11/2015 11:31:22 - DEBUG - Test getNombreDeberiaDevolverSraCuandoHombre</span>
<span class="tok-go"> 06/11/2015 11:31:22 - DEBUG - Creada instancia de Nombre</span>
<span class="tok-go"> 06/11/2015 11:31:22 - DEBUG - Test getNombreDeberiaDevolverSrCuandoHombre</span>
<span class="tok-go"> 06/11/2015 11:31:22 - DEBUG - Creada instancia de Nombre</span>
<span class="tok-go"> Tests run: 2, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 0.255 sec</span>

<span class="tok-go">Results :</span>

<span class="tok-go">Tests run: 2, Failures: 0, Errors: 0, Skipped: 0</span>

<span class="tok-go">[INFO] ------------------------------------------------------------------------</span>
<span class="tok-go">[INFO] BUILD SUCCESS</span>
<span class="tok-go">[INFO] ------------------------------------------------------------------------</span>
<span class="tok-go">[INFO] Total time: 3.162 s</span>
<span class="tok-go">[INFO] Finished at: 2015-11-06T11:31:22+01:00</span>
<span class="tok-go">[INFO] Final Memory: 14M/127M</span>
<span class="tok-go">[INFO] ------------------------------------------------------------------------</span></code></pre>
</div>
</div>
</li>
<li>
<p>Vamos ahora a desplegar la aplicación web desde línea de comando. Abre otro terminal y lanza WildFly con el comando:</p>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="bash session"><span class="tok-gp">$</span> standalone.sh</code></pre>
</div>
</div>
<div class="paragraph">
<p>Cuando haya arrancado WildFly, en el otro terminal ejecuta el <em>goal</em> <code>wildfly:deploy</code>. El proyecto se deberá desplegar correctamente en el servidor de aplicaciones:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="bash session"><span class="tok-gp">$</span> <span class="tok-nb">cd </span>jbibrest-expertojava
<span class="tok-gp">$</span> mvn wildfly:deploy

<span class="tok-go">...</span>
<span class="tok-go">[INFO]</span>
<span class="tok-go">[INFO] --- maven-war-plugin:2.3:war (default-war) @ jbib-rest ---</span>
<span class="tok-go">[INFO] Packaging webapp</span>
<span class="tok-go">[INFO] Assembling webapp [jbib-rest] in [/home/expertojava/Escritorio/jbib-rest0/target/jbib-rest]</span>
<span class="tok-go">[INFO] Processing war project</span>
<span class="tok-go">[INFO] Copying webapp resources [/home/expertojava/Escritorio/jbib-rest0/src/main/webapp]</span>
<span class="tok-go">[INFO] Webapp assembled in [122 msecs]</span>
<span class="tok-go">[INFO] Building war: /home/expertojava/Escritorio/jbib-rest0/target/jbib-rest.war</span>
<span class="tok-go">[INFO]</span>
<span class="tok-go">[INFO] &lt;&lt;&lt; wildfly-maven-plugin:1.0.2.Final:deploy (default-cli) &lt; package @ jbib-rest &lt;&lt;&lt;</span>
<span class="tok-go">[INFO]</span>
<span class="tok-go">[INFO] --- wildfly-maven-plugin:1.0.2.Final:deploy (default-cli) @ jbib-rest ---</span>
<span class="tok-go">nov 06, 2015 11:44:55 AM org.xnio.Xnio &lt;clinit&gt;</span>
<span class="tok-go">INFO: XNIO version 3.2.2.Final</span>
<span class="tok-go">nov 06, 2015 11:44:55 AM org.xnio.nio.NioXnio &lt;clinit&gt;</span>
<span class="tok-go">INFO: XNIO NIO Implementation Version 3.2.2.Final</span>
<span class="tok-go">nov 06, 2015 11:44:55 AM org.jboss.remoting3.EndpointImpl &lt;clinit&gt;</span>
<span class="tok-go">INFO: JBoss Remoting version 4.0.3.Final</span>
<span class="tok-go">[INFO] ------------------------------------------------------------------------</span>
<span class="tok-go">[INFO] BUILD SUCCESS</span>
<span class="tok-go">[INFO] ------------------------------------------------------------------------</span>
<span class="tok-go">[INFO] Total time: 9.782 s</span>
<span class="tok-go">[INFO] Finished at: 2015-11-06T11:44:59+01:00</span>
<span class="tok-go">[INFO] Final Memory: 18M/178M</span>
<span class="tok-go">[INFO] ------------------------------------------------------------------------</span></code></pre>
</div>
</div>
</li>
<li>
<p>Probamos ahora la aplicación desplegada. En un navegador accede a la URL <em><a href="http://localhost:8080/jbib-rest/" class="bare">http://localhost:8080/jbib-rest/</a></em> en la que estará respondiendo la aplicación. Aparecerá un sencillo formulario con el que puedes comprobar que la aplicación está funcionando. Rellénalo y pulsa <em>Enviar</em>. Verás la petición en la URL y la página resultante con un saludo.</p>
</li>
<li>
<p>Prueba a editar la URL de la petición a mano, cambiando algunos parámetros:</p>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="bash session"><span class="tok-go">http://localhost:8080/jbib-rest/holamundo?nombre=Leia&amp;edad=22&amp;genero=mujer</span></code></pre>
</div>
</div>
</li>
<li>
<p>Prueba a introducir parámetros erróneos como un género que no existe o una edad negativa. En algunos casos el servlet detectará el error y devolverá un error 400 (BAD REQUEST) y en otros el error se detectará en la clase Java que implementa la lógica de negocio y se generará una excepción en tiempo de ejecución y un mensaje en el log. El log está configurado para aparecer en la consola.</p>
</li>
<li>
<p>En IntelliJ repasa el código de la aplicación:</p>
<div class="ulist">
<ul>
<li>
<p>El fichero  <code>index.jsp</code> en <code>src/main/webapp</code></p>
</li>
<li>
<p>El servlet <code>org.expertojava.jbibrest.HolaMundo.java</code> en <code>src/main/java/</code></p>
</li>
<li>
<p>La clase de modelo <code>org.expertojava.jbibrest.modelo.Nombre</code> también en el directorio de fuentes</p>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Piensa las siguientes preguntas sobre la aplicación: ¿Quién construye la cadena de saludo? ¿Qué parámetros hay que pasar? ¿Qué prerequisitos deben cumplir esos parámetros? ¿Desde dónde se invoca a esa construcción? ¿Quién, qué códigos de error HTTP se devuelven y en qué casos?</p>
</div>
</td>
</tr>
</table>
</div>
</li>
</ul>
</div>
</li>
<li>
<p>Los tests merecen mención especial. Son muy sencillos, se encuentran en el fichero <code>org.expertojava.jbib.modelo.NombreTest.java</code> en el directorio <code>src/test/java</code>. Comprueban el método <code>getNombre()</code> del modelo.</p>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span class="tok-kn">package</span> <span class="tok-n">org</span><span class="tok-o">.</span><span class="tok-na">expertojava</span><span class="tok-o">.</span><span class="tok-na">jbibrest</span><span class="tok-o">.</span><span class="tok-na">modelo</span><span class="tok-o">;</span>

<span class="tok-kn">import</span> <span class="tok-nn">org.apache.commons.logging.Log</span><span class="tok-o">;</span>
<span class="tok-kn">import</span> <span class="tok-nn">org.apache.commons.logging.LogFactory</span><span class="tok-o">;</span>
<span class="tok-kn">import</span> <span class="tok-nn">org.junit.Test</span><span class="tok-o">;</span>

<span class="tok-kn">import</span> <span class="tok-nn">static</span> <span class="tok-n">org</span><span class="tok-o">.</span><span class="tok-na">junit</span><span class="tok-o">.</span><span class="tok-na">Assert</span><span class="tok-o">.*;</span>

<span class="tok-kd">public</span> <span class="tok-kd">class</span> <span class="tok-nc">NombreTest</span> <span class="tok-o">{</span>

    <span class="tok-kd">private</span> <span class="tok-kd">static</span> <span class="tok-n">Log</span> <span class="tok-n">logger</span> <span class="tok-o">=</span> <span class="tok-n">LogFactory</span><span class="tok-o">.</span><span class="tok-na">getLog</span><span class="tok-o">(</span><span class="tok-n">NombreTest</span><span class="tok-o">.</span><span class="tok-na">class</span><span class="tok-o">);</span>

    <span class="tok-nd">@Test</span>
    <span class="tok-kd">public</span> <span class="tok-kt">void</span> <span class="tok-nf">getNombreDeberiaDevolverSrCuandoHombre</span><span class="tok-o">()</span> <span class="tok-kd">throws</span> <span class="tok-n">Exception</span> <span class="tok-o">{</span>
        <span class="tok-n">logger</span><span class="tok-o">.</span><span class="tok-na">debug</span><span class="tok-o">(</span><span class="tok-s">&quot;Test getNombreDeberiaDevolverSrCuandoHombre&quot;</span><span class="tok-o">);</span>
        <span class="tok-n">Nombre</span> <span class="tok-n">nombre</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-nf">Nombre</span><span class="tok-o">(</span><span class="tok-s">&quot;Jack&quot;</span><span class="tok-o">,</span> <span class="tok-mi">40</span><span class="tok-o">,</span> <span class="tok-n">Genero</span><span class="tok-o">.</span><span class="tok-na">hombre</span><span class="tok-o">);</span>
        <span class="tok-n">String</span> <span class="tok-n">nombreStr</span> <span class="tok-o">=</span> <span class="tok-n">nombre</span><span class="tok-o">.</span><span class="tok-na">getNombre</span><span class="tok-o">();</span>
        <span class="tok-n">assertTrue</span><span class="tok-o">(</span><span class="tok-n">nombreStr</span><span class="tok-o">.</span><span class="tok-na">equals</span><span class="tok-o">(</span><span class="tok-s">&quot;Sr. Jack (40 años)&quot;</span><span class="tok-o">));</span>
    <span class="tok-o">}</span>

    <span class="tok-nd">@Test</span>
    <span class="tok-kd">public</span> <span class="tok-kt">void</span> <span class="tok-nf">getNombreDeberiaDevolverSraCuandoMujer</span><span class="tok-o">()</span> <span class="tok-kd">throws</span> <span class="tok-n">Exception</span> <span class="tok-o">{</span>
        <span class="tok-n">logger</span><span class="tok-o">.</span><span class="tok-na">debug</span><span class="tok-o">(</span><span class="tok-s">&quot;Test getNombreDeberiaDevolverSraCuandoHombre&quot;</span><span class="tok-o">);</span>
        <span class="tok-n">Nombre</span> <span class="tok-n">nombre</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-nf">Nombre</span><span class="tok-o">(</span><span class="tok-s">&quot;Kate&quot;</span><span class="tok-o">,</span> <span class="tok-mi">30</span><span class="tok-o">,</span> <span class="tok-n">Genero</span><span class="tok-o">.</span><span class="tok-na">mujer</span><span class="tok-o">);</span>
        <span class="tok-n">String</span> <span class="tok-n">nombreStr</span> <span class="tok-o">=</span> <span class="tok-n">nombre</span><span class="tok-o">.</span><span class="tok-na">getNombre</span><span class="tok-o">();</span>
        <span class="tok-n">assertTrue</span><span class="tok-o">(</span><span class="tok-n">nombreStr</span><span class="tok-o">.</span><span class="tok-na">equals</span><span class="tok-o">(</span><span class="tok-s">&quot;Sra. Kate (30 años)&quot;</span><span class="tok-o">));</span>
    <span class="tok-o">}</span>
<span class="tok-o">}</span></code></pre>
</div>
</div>
</li>
<li>
<p>Elimina la aplicación WAR desplegada haciendo:</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre>$ mvn wildfly:undeploy</pre>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Para comprobar si el WAR está desplegado puedes conectarte a la URL: <em><a href="http://localhost:9990/" class="bare">http://localhost:9990/</a></em>, entrar en la consola de administración del servidor y seleccionar <em>Runtime &gt; Manage Deployments</em>. Desde esa pantalla puedes gestionar las aplicaciones desplegadas.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Termina deteniendo el servidor WildFly haciendo Ctrl+c en el terminal</p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="_paso_a_paso_despliegue_con_intellij">2.4. Paso a paso: despliegue con IntelliJ</h3>
<div class="paragraph">
<p>Veamos ahora cómo hacer el despliegue de la aplicación web usando IntelliJ.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Empezamos abriendo el proyecto IntelliJ <code>jbib-rest</code>. En el repositorio Git se ha guardado también el fichero <code>.idea</code> que hay en la raíz del directorio, por lo que IntelliJ reconoce el proyecto y sus características. En el caso en que no estuviera este fichero habría que importarlo como un proyecto Maven, haciendo un doble click en el fichero POM.</p>
</li>
<li>
<p>Creamos una configuración de ejecución del tipo <em>JBoss Server &gt; Local</em>. Le ponemos como nombre <code>jbib-rest</code>, seleccionamos <em>JBoss 8.1.0.Final</em> como servidor de aplicaciones. Pulsamos en la pestaña de <em>Deployment</em> y en el símbolo <em>+</em> seleccionamos <em>Artifact&#8230;&#8203; &gt; jbib-rest:war exploded</em>. Seleccionamos también <em>Update Classes and Resources</em> para permitir desplegar <em>en caliente</em> las clases compiladas en las que hemos realizado cambios y marcamos la casilla <em>Share</em> para que se guarde en el repositorio Git la configuración de ejecución:</p>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="images/proyint01/run-configuration.png" alt="Run Configuration" width="66%">
</div>
</div>
</li>
<li>
<p>Ahora pulsamos el botón de ejecución junto al desplegable con el nombre de la configuración de ejecución. Si queremos activar los cambios en caliente debemos pulsar el botón de depuración.</p>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="images/proyint01/boton-run.png" alt="Run Configuration" width="25%">
</div>
</div>
<div class="paragraph">
<p>Veremos cómo se abre en la parte inferior el panel <em>Run</em>. Está dividido en dos zonas. En la zona derecha se muestra la consola del servidor de aplicaciones seleccionado en la configuración de ejecución (WildFly). El servidor se pone en marcha y vemos los mensajes que va escribiendo. En la parte izquierda está el panel de herramientas relacionadas con el despliegue de aplicación.</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="images/proyint01/run-intelliJ.png" alt="Run Configuration" width="66%">
</div>
</div>
<div class="paragraph">
<p>En la configuración de ejecución hemos seleccionado el artefacto <code>jbib-rest:war exploded</code>. IntelliJ compila las clases, las deja en el directorio <code>target/classes</code>, las copia en un directorio de despliegue de WildFly y abre una navegador en la página definida en la configuración de ejecución. Si todo ha funcionado bien, veremos la página con el formulario. Cuando introducimos los datos vemos el saludo.</p>
</div>
</li>
<li>
<p>Podríamos también seleccionar el artefacto <code>jbib-rest:war</code>. En este caso IntelliJ compilaría las clases y ahora las empaquetaría en el fichero <code>jbib-rest.war</code> (en el mismo directorio <code>target</code>).</p>
</li>
<li>
<p>Desde IntelliJ también podemos usar el panel de Maven y desplegar (o seleccionar cualquier otro objetivo) con él el WAR. Por ejemplo, una vez desplegado el WAR podemos pulsar en el objetivo <em>Plugins &gt; wildfly &gt; wildfly:undeploy</em> para eliminar el WAR. Cuando lo hacemos se abre una nueva pestaña en el panel de consola en la que aparece la salida del comando Maven. Podemos intentar cargar la página inicial para comprobar que la aplicación ya no está disponible. Esto sólo funciona cuando se ha escogido el artefacto <code>jbib-rest:war</code>.</p>
</li>
</ol>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Después de modificar el estado de un artefacto (desplegarla o eliminarla) con Maven, su estado no se actualiza correctamente en el panel de ejecución. Debes pulsar el botón de refresco para actualizarlo.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_caso_de_estudio_y_modelo_de_dominio">2.5. Caso de estudio y modelo de dominio</h3>
<div class="sect3">
<h4 id="_introducción">2.5.1. Introducción</h4>
<div class="paragraph">
<p>A partir de un supuesto básico de la gestión de una biblioteca, vamos a crear un caso de estudio completo que evolucionará conforme estudiemos las diferentes tecnologías de la plataforma Java Enterprise.</p>
</div>
<div class="paragraph">
<p>El objetivo de esta sesión es introducir el caso de estudio que vamos a desarrollar, obtener una visión global del proyecto, fijando los casos de uso y requisitos principales y definiendo el esqueleto inicial del problema.</p>
</div>
</div>
<div class="sect3">
<h4 id="_historias_de_usuario">2.5.2. Historias de usuario</h4>
<div class="paragraph">
<p>Un instituto de educación secundaria nos ha encargado que desarrollemos una aplicación para la gestión de los préstamos realizados en la biblioteca del centro, lo que implica tanto una gestión de los libros como de los alumnos y profesores que realizan estos prestamos.</p>
</div>
<div class="paragraph">
<p>Tras una serie de entrevistas y reuniones con diferente personal del centro, hemos decidido hacer un prototipo inicial que servirá para probar el funcionamiento de la parte de la aplicación destinada a los <em>clientes</em> de la biblioteca: profesores y alumnos que van a poder solicitar préstamos de libros a través de la aplicación.</p>
</div>
<div class="paragraph">
<p>En concreto, las características que vamos a implementar en este prototipo serán las siguientes:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>La biblioteca contiene <strong>libros</strong>. El sistema debe guardar toda la información necesaria de cada libro: su título, autor, ISBN, etc. Puede existir más de un <strong>ejemplar</strong> de un mismo libro. Se quiere también guardar la información propia de cada ejemplar: fecha de adquisición, defectos que pueda tener, etc. También contamos con <strong>recomendaciones</strong> que ligan un libro origen con otros recomendados a partir de él (y un comentario por recomendación).</p>
</li>
<li>
<p>Los <strong>usuarios</strong> de la biblioteca (profesores y alumnos) utilizarán la aplicación para realizar una serie de acciones sobre estos libros: consultar su disponibilidad, pedirlos prestados, consultar la lista de libros prestados, etc. En concreto:</p>
<div class="ulist">
<ul>
<li>
<p>Pedir prestado un ejemplar de un libro (que el personal entregará al usuario cuando éste se pase por el mostrador de la biblioteca).</p>
</li>
<li>
<p>Consultar el <strong>estado de los libros</strong> y sus ejemplares: un ejemplar puede estar prestado o disponible.</p>
</li>
<li>
<p>Consultar los libros que tiene prestados.</p>
</li>
<li>
<p>Consultar los libros de la biblioteca.</p>
</li>
</ul>
</div>
</li>
<li>
<p>La <strong>fecha de devolución del préstamo</strong> dependerá de si el usuario es alumno o profesor y empezará a contar a partir del momento en que el ejemplar se toma prestado. El número máximo de libros que puede tener en préstamo un usuario dependerá también de si es profesor o alumno. Cuando un libro se devuelve, se borra el registro del préstamo del usuario y se crea un nuevo registro en el <strong>histórico de préstamos</strong>.</p>
</li>
<li>
<p>Cuando el usuario se retrasa en la devolución de un préstamo se le creará una <strong>multa</strong>. Teniendo una multa no podrá pedir prestado ningún otro libro. Cuando termine de devolver todos los libros comenzará a descontar los días de penalización. El número de días de penalización será la suma de los retrasos en las devoluciones de todos los libros prestados. Cuando pasa la fecha de finalización, la multa se elimina del usuario y se crea un nuevo registro en el <strong>histórico de multas</strong>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Estas funcionalidades las vamos a convertir más adelante en casos de uso y las vamos a implementar a lo largo del curso, conforme vaya avanzando el proyecto de integración.</p>
</div>
</div>
<div class="sect3">
<h4 id="_requisitos_de_información_irq">2.5.3. Requisitos de información (IRQ)</h4>
<div class="paragraph">
<p>Los requisitos de información resumen la información persistente que nos interesa almacenar relacionada con el sistema.</p>
</div>
<div class="paragraph">
<p>Respecto a un <strong>usuario</strong>, nos interesa almacenar:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><em>Tipo de usuario</em>: profesor, alumno</p>
</li>
<li>
<p><em>Login</em> (obligatorio) y <em>passwod</em></p>
</li>
<li>
<p>Nombre y apellidos</p>
</li>
<li>
<p><em>Correo electrónico</em></p>
</li>
<li>
<p>Lista de <em>préstamos</em> actuales del usuario</p>
</li>
<li>
<p>Multa actual (si existe) del usuario</p>
</li>
<li>
<p>Datos referentes a su dirección, como son <em>calle</em>, <em>número</em>, <em>piso</em>, <em>ciudad</em> y <em>código postal</em></p>
</li>
<li>
<p>Si el usuario es alumno, necesitaremos guardar un <em>telefono de los padres</em></p>
</li>
<li>
<p>Si el usuario es profesor, necesitaremos el <em>nombre de su departamento</em></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Podremos obtener el <strong>estado de un usuario</strong>:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Activo</strong>: Estado por defecto, puede tomar libros prestados</p>
</li>
<li>
<p><strong>Moroso</strong>: Tiene libros fuera de plazo por devolver, no puede tomar libros prestados</p>
</li>
<li>
<p><strong>Multado</strong>: Tiene una multa actual abierta, no puede tomar libros prestados</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Respecto a un <strong>libro</strong>, nos interesa almacenar:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><em>ISBN</em> (obligatorio)</p>
</li>
<li>
<p><em>Título y autor</em></p>
</li>
<li>
<p><em>Número de páginas</em></p>
</li>
<li>
<p><em>Número de ejemplares comprados</em></p>
</li>
<li>
<p><em>Número de ejemplares disponibles</em>: cambiará conforme se presten y devuelvan ejemplares</p>
</li>
<li>
<p><em>URI de la portada</em>: dirección web de la imagen de donde se puede cargar la portada</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Queremos que la aplicación realice también recomendaciones de libros, de forma que para un libro a prestar se muestre una lista de libros relacionados. Para ello tendremos <strong>recomendaciones</strong> que relacionarán un libro origen con un libro recomendado y un comentario.</p>
</div>
<div class="paragraph">
<p>Respecto a un <strong>ejemplar</strong>, almacenaremos:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><em>Número de identificación del ejemplar</em> (obligatorio, código definido por el personal)</p>
</li>
<li>
<p><em>Identificación del libro</em> al que pertenece el ejemplar</p>
</li>
<li>
<p><em>Fecha de adquisición</em></p>
</li>
<li>
<p><em>Observaciones</em>: texto sobre el estado del ejemplar</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Un <strong>préstamo</strong> representa un ejemplar en posesión de un usuario (es un <em>préstamo activo</em>). En cada préstamo guardaremos:</p>
</div>
<div class="paragraph">
<p>_ <em>Ejemplar</em> del préstamo
_ <em>Usuario</em> del préstamo
- <em>Fecha de préstamo</em>
- <em>Fecha en la que debería devolverse</em></p>
</div>
<div class="paragraph">
<p>Cuando un usuario se retrase en la devolución de un libro, se le creará una <strong>multa</strong>. De cada multa nos interesa saber:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><em>Usuario</em> que tiene la multa</p>
</li>
<li>
<p><em>Fecha de inicio</em></p>
</li>
<li>
<p><em>Días acumulados</em> (para el caso en que se haya abierto una multa y todavía queden ejemplares por devolver)</p>
</li>
<li>
<p><em>Fecha de finalización</em></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>También queremos guardar los históricos de préstamos y de multas. Los históricos guardarán los identificadores de los ejemplares, usuarios y multas, para poder realizar consultas históricas. El histórico de préstamo guardará también la fecha de devolución del ejemplar.</p>
</div>
</div>
<div class="sect3">
<h4 id="_casos_de_uso">2.5.4. Casos de uso</h4>
<div class="paragraph">
<p>Los casos de uso son bastante sencillos. Vamos a centrarnos sólo en la parte del usuario registrado en la biblioteca, dejando para otro momento la parte de la aplicación del bibliotecario en la que se realizaría una gestión (altas, bajas y modificaciones) de los libros, ejemplares y usuarios. El siguiente esquema muestra los casos de uso de un usuario logeado en el sistema:</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="images/proyint01/casos-de-uso.png" alt="Casos de uso" width="66%">
</div>
</div>
<div class="paragraph">
<p>El <strong>usuario</strong> podrá consultar los libros disponibles en la biblioteca y obtener más información sobre aquellos en los que esté interesado, accediendo a la pantalla de detalle del libro. Desde esta pantalla de detalle podrá solicitar el préstamo del libro y ver la información de libros recomendados relacionados con el actual.</p>
</div>
<div class="paragraph">
<p>Para hacerse una idea mejor del funcionamiento de la aplicación es conveniente hacer diseños iniciales o <em>mockups</em> de estas pantallas, junto con un esquema de navegación de las mismas. Los vemos a continuación.</p>
</div>
<div class="paragraph">
<p>Esquema de navegación:</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="images/proyint01/esquema-navegacion.png" alt="Esquema de navegación" width="50%">
</div>
</div>
<div class="paragraph">
<p>Pantalla con el listado de libros:</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="images/proyint01/listado-libros.png" alt="Listado de libros" width="66%">
</div>
</div>
<div class="paragraph">
<p>Pantalla con el detalle de libro:</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="images/proyint01/detalle-libro.png" alt="Detalle del libro" width="66%">
</div>
</div>
<div class="paragraph">
<p>Pantalla con los libros que tiene prestados un usuario:</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="images/proyint01/mis-libros.png" alt="Mis libros" width="66%">
</div>
</div>
<div class="paragraph">
<p>Estos son bocetos iniciales de pantallas. A partir de ellas, del modelo de datos y de las reglas de negocio que veremos más adelante, diseñaremos el API REST con las funcionalidades que ofrecerá nuestro servicio.</p>
</div>
</div>
<div class="sect3">
<h4 id="_requisitos_de_restricción_crq">2.5.5. Requisitos de restricción (CRQ)</h4>
<div class="paragraph">
<p>Podemos resumir en la siguiente tabla las restricciones a aplicar a los casos de uso anteriores:</p>
</div>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 33%;">
<col style="width: 33%;">
<col style="width: 33%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Tipo de usuario</th>
<th class="tableblock halign-left valign-top">Número máximo de préstamos</th>
<th class="tableblock halign-left valign-top">Días de préstamo</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Alumno</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">5</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">7</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Profesor</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">8</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">30</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>El máximo de libros prestados de un alumno es 6. Los libros prestados los tiene que devolver antes de 7 días.</p>
</div>
<div class="paragraph">
<p>En el momento que un usuario tenga una demora en la devolución de un préstamo, se considerará al usuario moroso y se le impondrá una penalización del doble de días de desfase durante los cuales no podrá ni reservar ni realizar préstamos de libros.</p>
</div>
</div>
<div class="sect3">
<h4 id="_modelo_de_clases">2.5.6. Modelo de clases</h4>
<div class="paragraph">
<p>A partir de los requisitos y tras unas sesiones de modelado, hemos llegado al siguiente modelo de clases conceptual representado mediante el siguiente diagrama UML:</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="images/proyint01/diagrama-clases.png" alt="Diagrama de clases" width="66%">
</div>
</div>
<div class="paragraph">
<p>Utilizaremos un modelo de clases como punto de partida del modelo de datos. En la siguiente sesión construiremos el modelo de datos basándonos en este modelo de clases y utilizando JPA (Java Persistence API). Veremos que este enfoque se denomina ORM (Object Relational Mapping), porque permite definir una relación directa (<em>mapping</em>) entre clases Java y tablas de la base de datos. La relación entre clases Java y tablas se define por medio de anotaciones JPA añadidas en el código fuente de las clases.</p>
</div>
<div class="paragraph">
<p>Vemos que casi todas las clases tienen un atributo <code>id</code> de tipo <code>Long</code>. Será la clave primaria de la tabla asociada a la clase y será generado automáticamente por la base de datos. Durante un tiempo de la vida del objeto, antes de ser insertado en la base de datos, este identificador va a ser <code>null</code>. Tenemos que tener en cuenta esto a la hora de definir correctamente los métodos <code>equals</code> y <code>hashCode</code>.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>¿Por dónde empezamos al hacer el diseño de la aplicación? ¿Por los datos o por las clases? Podemos empezar modelando los datos o las clases, y ambos modelos serán casi semejantes. Normalmente, la elección viene dada por la destreza del analista, si se siente más seguro comenzando por los datos, o con el modelo conceptual de clases. Otra opción es el modelado en paralelo, de modo que al finalizar ambos modelos, podamos compararlos y validar si hemos comprobado todas las restricciones. Daremos más detalles en la siguiente sesión.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_relaciones_entre_entidades_por_referencias_y_por_identificador">2.5.7. Relaciones entre entidades por referencias y por identificador</h4>
<div class="paragraph">
<p>En la próxima sesión vamos a utilizar el framework JPA para hacer persistentes las entidades. JPA mapea las entidades con tablas de la base de datos y los registros de estas tablas con instancias (objetos) de las clases entidad. Así, por ejemplo, cuando hagamos una consulta a la base de datos usando JPA el framework obtendrá la lista de registros de la base de datos (por ejemplo, libros) y los convertirá automáticamente a instancias de la clase correspiendente (en el ejemplo, la clase <code>Libro</code>). Además JPA <strong>traerá a memoria</strong> automáticamente todo el grafo de objetos con los que cada instancia tiene definida una relación (veremos más adelante que esto se puede hacer de forma perezosa o <em>lazy</em>).</p>
</div>
<div class="paragraph">
<p>Para evitar que la gestión en memoria de todo el grafo de objetos penalize demasiado el redimiento de la aplicación se puede utilizar una técnica de partición del grafo de relaciones en las denominadas <strong>agregaciones</strong> (o <em>aggregates</em> en ingles). Una agregación es un conjunto de entidades que se van a cargar en memoria, formando un grafo de objetos que la aplicación debe mantener.</p>
</div>
<div class="paragraph">
<p>La separación de distintas agregaciones permitiría separar la aplicación en distintos microservicios.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_desarrollo_e_implementación_parte_guiada_0_5_puntos">2.6. Desarrollo e implementación (parte guiada, 0,5 puntos)</h3>
<div class="paragraph">
<p>El objetivo de la sesión de hoy es crear todas las clases anteriores (clases de dominio) en el paquete <code>org.expertojava.jbibrest.modelo</code> del proyecto inicial que ya te has descargado y has probado que funciona correctamente. Estas clases definirán los tipos de datos básicos que utilizaremos para trabajar con la capa de persistencia y de lógica de negocio de nuestra API REST.</p>
</div>
<div class="paragraph">
<p>A lo largo de las siguientes sesiones del proyecto construiremos nuevos módulos necesarios para el API REST con los métodos de negocio y la aplicación JavaScript que construye la interfaz de usuario.</p>
</div>
<div class="paragraph">
<p>Comentamos a continuación los pasos a seguir para desarrollar el esqueleto del dominio del proyecto, que incluye la clase Libro, algunas clases auxiliares, excepciones y pruebas. Al final de esta guía paso a paso tendrás una versión inicial del programa. Deberás entonces terminar de implementar el resto.</p>
</div>
<div class="paragraph">
<p>Es muy importante en esta parte guiada que no te limites a copiar y pegar el código, sino que reflexiones sobre lo que hace.</p>
</div>
<div class="sect3">
<h4 id="_clase_abstracta_común_a_todas_las_entidades_code_clasedominio_code">2.6.1. Clase abstracta común a todas las entidades <code>ClaseDominio</code></h4>
<div class="paragraph">
<p>Las clases de dominio representan las entidades que van a hacerse persistentes y con las que van a trabajar las capas de persistencia y de lógica de dominio de la aplicación. En las siguientes sesiones, cuando veamos JPA, veremos cómo se podrán definir la capa de persistencia de la aplicación directamente a partir de estas clases y cómo se utilizarán para encapsular los datos pasados como parámetros y devueltos por las funciones de la capa de negocio implementadas por componentes EJB.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Una entidad representa un concepto en el dominio que está definido por su identidad más que por sus atributos. Aunque la identidad de la entidad permanece fija durante toda su vida, sus atributos pueden cambiar. Una entidad debe definir una relación de igualdad basada en su identidad.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Para asegurarnos que todas las entidades de nuestro dominio tienen estas características, definimos una clase abstracta, que será la clase padre de todas las clases de dominio. Definiremos en esa clase el identificador de todas las entidades (de tipo <code>Long</code>, por simplificar) y los métodos <code>equals()</code> y <code>hashCode()</code> basados en comparar este identificador.</p>
</div>
<div class="paragraph">
<p>El código de <code>equals</code> y <code>hashCode</code> permite que los identificadores sean <code>null</code>. Si dos identificadores son <code>null</code>, <code>equals</code> devolverá <code>true</code>.</p>
</div>
<div class="listingblock">
<div class="title">org.expertojava.jbibrest.modelo.ClaseDomino</div>
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span class="tok-kn">package</span> <span class="tok-n">org</span><span class="tok-o">.</span><span class="tok-na">expertojava</span><span class="tok-o">.</span><span class="tok-na">jbibrest</span><span class="tok-o">.</span><span class="tok-na">modelo</span><span class="tok-o">;</span>

<span class="tok-kd">public</span> <span class="tok-kd">abstract</span> <span class="tok-kd">class</span> <span class="tok-nc">ClaseDominio</span> <span class="tok-o">{</span>
    <span class="tok-kd">private</span> <span class="tok-n">Long</span> <span class="tok-n">id</span><span class="tok-o">;</span>

    <span class="tok-kd">protected</span> <span class="tok-kt">void</span> <span class="tok-nf">setId</span><span class="tok-o">(</span><span class="tok-n">Long</span> <span class="tok-n">id</span><span class="tok-o">)</span> <span class="tok-o">{</span> <span class="tok-k">this</span><span class="tok-o">.</span><span class="tok-na">id</span> <span class="tok-o">=</span> <span class="tok-n">id</span><span class="tok-o">;</span> <span class="tok-o">}</span>
    <span class="tok-kd">public</span> <span class="tok-n">Long</span> <span class="tok-nf">getId</span><span class="tok-o">()</span> <span class="tok-o">{</span> <span class="tok-k">return</span> <span class="tok-n">id</span><span class="tok-o">;}</span>

    <span class="tok-nd">@Override</span>
    <span class="tok-kd">public</span> <span class="tok-kt">boolean</span> <span class="tok-nf">equals</span><span class="tok-o">(</span><span class="tok-n">Object</span> <span class="tok-n">o</span><span class="tok-o">)</span> <span class="tok-o">{</span>
        <span class="tok-k">if</span> <span class="tok-o">(</span><span class="tok-k">this</span> <span class="tok-o">==</span> <span class="tok-n">o</span><span class="tok-o">)</span> <span class="tok-k">return</span> <span class="tok-kc">true</span><span class="tok-o">;</span>
        <span class="tok-k">if</span> <span class="tok-o">(</span><span class="tok-n">o</span> <span class="tok-o">==</span> <span class="tok-kc">null</span> <span class="tok-o">||</span> <span class="tok-n">getClass</span><span class="tok-o">()</span> <span class="tok-o">!=</span> <span class="tok-n">o</span><span class="tok-o">.</span><span class="tok-na">getClass</span><span class="tok-o">())</span> <span class="tok-k">return</span> <span class="tok-kc">false</span><span class="tok-o">;</span>

        <span class="tok-n">ClaseDominio</span> <span class="tok-n">that</span> <span class="tok-o">=</span> <span class="tok-o">(</span><span class="tok-n">ClaseDominio</span><span class="tok-o">)</span> <span class="tok-n">o</span><span class="tok-o">;</span>

        <span class="tok-k">return</span> <span class="tok-o">!(</span><span class="tok-n">id</span> <span class="tok-o">!=</span> <span class="tok-kc">null</span> <span class="tok-o">?</span> <span class="tok-o">!</span><span class="tok-n">id</span><span class="tok-o">.</span><span class="tok-na">equals</span><span class="tok-o">(</span><span class="tok-n">that</span><span class="tok-o">.</span><span class="tok-na">id</span><span class="tok-o">)</span> <span class="tok-o">:</span> <span class="tok-n">that</span><span class="tok-o">.</span><span class="tok-na">id</span> <span class="tok-o">!=</span> <span class="tok-kc">null</span><span class="tok-o">);</span>

    <span class="tok-o">}</span>

    <span class="tok-nd">@Override</span>
    <span class="tok-kd">public</span> <span class="tok-kt">int</span> <span class="tok-nf">hashCode</span><span class="tok-o">()</span> <span class="tok-o">{</span>
        <span class="tok-k">return</span> <span class="tok-n">id</span> <span class="tok-o">!=</span> <span class="tok-kc">null</span> <span class="tok-o">?</span> <span class="tok-n">id</span><span class="tok-o">.</span><span class="tok-na">hashCode</span><span class="tok-o">()</span> <span class="tok-o">:</span> <span class="tok-mi">0</span><span class="tok-o">;</span>
    <span class="tok-o">}</span>

<span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Todas las entidades las vamos a definir dentro del paquete <code>org.expertojava.jbibrest.modelo</code>. Cada objeto de dominio se compone de sus atributos, relaciones y de todos los <em>getter/setter</em> que encapsulan al objeto.</p>
</div>
</div>
<div class="sect3">
<h4 id="_clases_de_domino_code_libro_code_y_code_recomendacion_code">2.6.2. Clases de domino <code>Libro</code> y <code>Recomendacion</code></h4>
<div class="paragraph">
<p>Vamos a empezar definiendo las clases <code>Libro</code> y <code>Recomendacion</code>. Empezamos por la clase <code>Libro</code>:</p>
</div>
<div class="listingblock">
<div class="title">org.expertojava.jbibrest.modelo.Libro</div>
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span class="tok-kn">package</span> <span class="tok-n">org</span><span class="tok-o">.</span><span class="tok-na">expertojava</span><span class="tok-o">.</span><span class="tok-na">jbibrest</span><span class="tok-o">.</span><span class="tok-na">modelo</span><span class="tok-o">;</span>

<span class="tok-kn">import</span> <span class="tok-nn">org.apache.commons.logging.Log</span><span class="tok-o">;</span>
<span class="tok-kn">import</span> <span class="tok-nn">org.apache.commons.logging.LogFactory</span><span class="tok-o">;</span>
<span class="tok-kn">import</span> <span class="tok-nn">java.util.HashSet</span><span class="tok-o">;</span>
<span class="tok-kn">import</span> <span class="tok-nn">java.util.Set</span><span class="tok-o">;</span>


<span class="tok-kd">public</span> <span class="tok-kd">class</span> <span class="tok-nc">Libro</span> <span class="tok-kd">extends</span> <span class="tok-n">ClaseDominio</span> <span class="tok-o">{</span>
    <span class="tok-kd">private</span> <span class="tok-n">String</span> <span class="tok-n">isbn</span><span class="tok-o">;</span>
    <span class="tok-kd">private</span> <span class="tok-n">String</span> <span class="tok-n">autor</span><span class="tok-o">;</span>
    <span class="tok-kd">private</span> <span class="tok-n">String</span> <span class="tok-n">titulo</span><span class="tok-o">;</span>
    <span class="tok-kd">private</span> <span class="tok-n">Integer</span> <span class="tok-n">numPaginas</span><span class="tok-o">;</span>
    <span class="tok-kd">private</span> <span class="tok-kt">int</span> <span class="tok-n">nEjemplares</span> <span class="tok-o">=</span> <span class="tok-mi">0</span><span class="tok-o">;</span>
    <span class="tok-kd">private</span> <span class="tok-kt">int</span> <span class="tok-n">nEjemplaresDisponibles</span> <span class="tok-o">=</span> <span class="tok-mi">0</span><span class="tok-o">;</span>
    <span class="tok-kd">private</span> <span class="tok-n">String</span> <span class="tok-n">portadaURI</span><span class="tok-o">;</span>
    <span class="tok-kd">private</span> <span class="tok-n">Set</span><span class="tok-o">&lt;</span><span class="tok-n">Recomendacion</span><span class="tok-o">&gt;</span> <span class="tok-n">recomendaciones</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">HashSet</span><span class="tok-o">&lt;</span><span class="tok-n">Recomendacion</span><span class="tok-o">&gt;();</span>

    <span class="tok-kd">private</span> <span class="tok-kd">static</span> <span class="tok-n">Log</span> <span class="tok-n">logger</span> <span class="tok-o">=</span> <span class="tok-n">LogFactory</span><span class="tok-o">.</span><span class="tok-na">getLog</span><span class="tok-o">(</span><span class="tok-n">Libro</span><span class="tok-o">.</span><span class="tok-na">class</span><span class="tok-o">);</span>

    <span class="tok-kd">public</span> <span class="tok-nf">Libro</span><span class="tok-o">(</span><span class="tok-n">String</span> <span class="tok-n">isbn</span><span class="tok-o">)</span> <span class="tok-o">{</span>
        <span class="tok-k">this</span><span class="tok-o">.</span><span class="tok-na">isbn</span> <span class="tok-o">=</span> <span class="tok-n">isbn</span><span class="tok-o">;</span>
        <span class="tok-n">logger</span><span class="tok-o">.</span><span class="tok-na">debug</span><span class="tok-o">(</span><span class="tok-s">&quot;Nueva instancia de Libro: &quot;</span> <span class="tok-o">+</span> <span class="tok-n">isbn</span><span class="tok-o">);</span>
    <span class="tok-o">}</span>

    <span class="tok-kd">public</span> <span class="tok-n">String</span> <span class="tok-nf">getIsbn</span><span class="tok-o">()</span> <span class="tok-o">{</span>
        <span class="tok-k">return</span> <span class="tok-n">isbn</span><span class="tok-o">;</span>
    <span class="tok-o">}</span>

    <span class="tok-kd">public</span> <span class="tok-kt">void</span> <span class="tok-nf">setIsbn</span><span class="tok-o">(</span><span class="tok-n">String</span> <span class="tok-n">isbn</span><span class="tok-o">)</span> <span class="tok-o">{</span>
        <span class="tok-k">this</span><span class="tok-o">.</span><span class="tok-na">isbn</span> <span class="tok-o">=</span> <span class="tok-n">isbn</span><span class="tok-o">;</span>
    <span class="tok-o">}</span>

    <span class="tok-kd">public</span> <span class="tok-n">String</span> <span class="tok-nf">getAutor</span><span class="tok-o">()</span> <span class="tok-o">{</span>
        <span class="tok-k">return</span> <span class="tok-n">autor</span><span class="tok-o">;</span>
    <span class="tok-o">}</span>

    <span class="tok-kd">public</span> <span class="tok-kt">void</span> <span class="tok-nf">setAutor</span><span class="tok-o">(</span><span class="tok-n">String</span> <span class="tok-n">autor</span><span class="tok-o">)</span> <span class="tok-o">{</span>
        <span class="tok-k">this</span><span class="tok-o">.</span><span class="tok-na">autor</span> <span class="tok-o">=</span> <span class="tok-n">autor</span><span class="tok-o">;</span>
    <span class="tok-o">}</span>

    <span class="tok-kd">public</span> <span class="tok-n">String</span> <span class="tok-nf">getTitulo</span><span class="tok-o">()</span> <span class="tok-o">{</span>
        <span class="tok-k">return</span> <span class="tok-n">titulo</span><span class="tok-o">;</span>
    <span class="tok-o">}</span>

    <span class="tok-kd">public</span> <span class="tok-kt">void</span> <span class="tok-nf">setTitulo</span><span class="tok-o">(</span><span class="tok-n">String</span> <span class="tok-n">titulo</span><span class="tok-o">)</span> <span class="tok-o">{</span>
        <span class="tok-k">this</span><span class="tok-o">.</span><span class="tok-na">titulo</span> <span class="tok-o">=</span> <span class="tok-n">titulo</span><span class="tok-o">;</span>
    <span class="tok-o">}</span>

    <span class="tok-kd">public</span> <span class="tok-n">Integer</span> <span class="tok-nf">getNumPaginas</span><span class="tok-o">()</span> <span class="tok-o">{</span>
        <span class="tok-k">return</span> <span class="tok-n">numPaginas</span><span class="tok-o">;</span>
    <span class="tok-o">}</span>

    <span class="tok-kd">public</span> <span class="tok-kt">void</span> <span class="tok-nf">setNumPaginas</span><span class="tok-o">(</span><span class="tok-n">Integer</span> <span class="tok-n">numPaginas</span><span class="tok-o">)</span> <span class="tok-o">{</span>
        <span class="tok-k">this</span><span class="tok-o">.</span><span class="tok-na">numPaginas</span> <span class="tok-o">=</span> <span class="tok-n">numPaginas</span><span class="tok-o">;</span>
    <span class="tok-o">}</span>

    <span class="tok-kd">public</span> <span class="tok-kt">int</span> <span class="tok-nf">getnEjemplares</span><span class="tok-o">()</span> <span class="tok-o">{</span>
        <span class="tok-k">return</span> <span class="tok-n">nEjemplares</span><span class="tok-o">;</span>
    <span class="tok-o">}</span>

    <span class="tok-kd">public</span> <span class="tok-kt">void</span> <span class="tok-nf">setnEjemplares</span><span class="tok-o">(</span><span class="tok-kt">int</span> <span class="tok-n">nEjemplares</span><span class="tok-o">)</span> <span class="tok-o">{</span>
        <span class="tok-k">this</span><span class="tok-o">.</span><span class="tok-na">nEjemplares</span> <span class="tok-o">=</span> <span class="tok-n">nEjemplares</span><span class="tok-o">;</span>
    <span class="tok-o">}</span>

    <span class="tok-kd">public</span> <span class="tok-kt">int</span> <span class="tok-nf">getnEjemplaresDisponibles</span><span class="tok-o">()</span> <span class="tok-o">{</span>
        <span class="tok-k">return</span> <span class="tok-n">nEjemplaresDisponibles</span><span class="tok-o">;</span>
    <span class="tok-o">}</span>

    <span class="tok-kd">public</span> <span class="tok-kt">void</span> <span class="tok-nf">setnEjemplaresDisponibles</span><span class="tok-o">(</span><span class="tok-kt">int</span> <span class="tok-n">nEjemplaresDisponibles</span><span class="tok-o">)</span> <span class="tok-o">{</span>
        <span class="tok-k">this</span><span class="tok-o">.</span><span class="tok-na">nEjemplaresDisponibles</span> <span class="tok-o">=</span> <span class="tok-n">nEjemplaresDisponibles</span><span class="tok-o">;</span>
    <span class="tok-o">}</span>

    <span class="tok-kd">public</span> <span class="tok-n">String</span> <span class="tok-nf">getPortadaURI</span><span class="tok-o">()</span> <span class="tok-o">{</span>
        <span class="tok-k">return</span> <span class="tok-n">portadaURI</span><span class="tok-o">;</span>
    <span class="tok-o">}</span>

    <span class="tok-kd">public</span> <span class="tok-kt">void</span> <span class="tok-nf">setPortadaURI</span><span class="tok-o">(</span><span class="tok-n">String</span> <span class="tok-n">portadaURI</span><span class="tok-o">)</span> <span class="tok-o">{</span>
        <span class="tok-k">this</span><span class="tok-o">.</span><span class="tok-na">portadaURI</span> <span class="tok-o">=</span> <span class="tok-n">portadaURI</span><span class="tok-o">;</span>
    <span class="tok-o">}</span>


    <span class="tok-kd">public</span> <span class="tok-n">Set</span><span class="tok-o">&lt;</span><span class="tok-n">Recomendacion</span><span class="tok-o">&gt;</span> <span class="tok-nf">getRecomendaciones</span><span class="tok-o">()</span> <span class="tok-o">{</span>
        <span class="tok-k">return</span> <span class="tok-n">recomendaciones</span><span class="tok-o">;</span>
    <span class="tok-o">}</span>

    <span class="tok-kd">public</span> <span class="tok-kt">void</span> <span class="tok-nf">setRecomendaciones</span><span class="tok-o">(</span><span class="tok-n">Set</span><span class="tok-o">&lt;</span><span class="tok-n">Recomendacion</span><span class="tok-o">&gt;</span> <span class="tok-n">recomendaciones</span><span class="tok-o">)</span> <span class="tok-o">{</span>
        <span class="tok-k">this</span><span class="tok-o">.</span><span class="tok-na">recomendaciones</span> <span class="tok-o">=</span> <span class="tok-n">recomendaciones</span><span class="tok-o">;</span>
    <span class="tok-o">}</span>

    <span class="tok-nd">@Override</span>
    <span class="tok-kd">public</span> <span class="tok-n">String</span> <span class="tok-nf">toString</span><span class="tok-o">()</span> <span class="tok-o">{</span>
        <span class="tok-k">return</span> <span class="tok-s">&quot;Libro{&quot;</span> <span class="tok-o">+</span>
                <span class="tok-s">&quot;id=&quot;</span> <span class="tok-o">+</span> <span class="tok-k">this</span><span class="tok-o">.</span><span class="tok-na">getId</span><span class="tok-o">()</span> <span class="tok-o">+</span>
                <span class="tok-s">&quot;, isbn=&#39;&quot;</span> <span class="tok-o">+</span> <span class="tok-k">this</span><span class="tok-o">.</span><span class="tok-na">getIsbn</span><span class="tok-o">()</span> <span class="tok-o">+</span> <span class="tok-sc">&#39;\&#39;&#39;</span> <span class="tok-o">+</span>
                <span class="tok-s">&quot;, autor=&#39;&quot;</span> <span class="tok-o">+</span> <span class="tok-k">this</span><span class="tok-o">.</span><span class="tok-na">getAutor</span><span class="tok-o">()</span> <span class="tok-o">+</span> <span class="tok-sc">&#39;\&#39;&#39;</span> <span class="tok-o">+</span>
                <span class="tok-s">&quot;, titulo=&#39;&quot;</span> <span class="tok-o">+</span> <span class="tok-k">this</span><span class="tok-o">.</span><span class="tok-na">getTitulo</span><span class="tok-o">()</span> <span class="tok-o">+</span> <span class="tok-sc">&#39;\&#39;&#39;</span> <span class="tok-o">+</span>
                <span class="tok-s">&quot;, numPaginas=&quot;</span> <span class="tok-o">+</span> <span class="tok-k">this</span><span class="tok-o">.</span><span class="tok-na">getNumPaginas</span><span class="tok-o">()</span> <span class="tok-o">+</span>
                <span class="tok-s">&quot;, numEjemplares=&quot;</span> <span class="tok-o">+</span> <span class="tok-k">this</span><span class="tok-o">.</span><span class="tok-na">getnEjemplares</span><span class="tok-o">()</span> <span class="tok-o">+</span>
                <span class="tok-s">&quot;, numEjemplaresDisponibles=&quot;</span> <span class="tok-o">+</span> <span class="tok-k">this</span><span class="tok-o">.</span><span class="tok-na">getnEjemplaresDisponibles</span><span class="tok-o">()</span> <span class="tok-o">+</span>
                <span class="tok-s">&quot;, portadaURI=&#39;&quot;</span> <span class="tok-o">+</span> <span class="tok-k">this</span><span class="tok-o">.</span><span class="tok-na">getPortadaURI</span><span class="tok-o">()</span> <span class="tok-o">+</span> <span class="tok-sc">&#39;\&#39;&#39;</span> <span class="tok-o">+</span>
                <span class="tok-sc">&#39;}&#39;</span><span class="tok-o">;</span>
    <span class="tok-o">}</span>
<span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Y definimos la clase <code>Recomendacion</code>:</p>
</div>
<div class="listingblock">
<div class="title">org.expertojava.jbibrest.modelo.Recomendacion</div>
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span class="tok-kn">package</span> <span class="tok-n">org</span><span class="tok-o">.</span><span class="tok-na">expertojava</span><span class="tok-o">.</span><span class="tok-na">jbibrest</span><span class="tok-o">.</span><span class="tok-na">modelo</span><span class="tok-o">;</span>

<span class="tok-kn">import</span> <span class="tok-nn">org.apache.commons.logging.Log</span><span class="tok-o">;</span>
<span class="tok-kn">import</span> <span class="tok-nn">org.apache.commons.logging.LogFactory</span><span class="tok-o">;</span>

<span class="tok-kd">public</span> <span class="tok-kd">class</span> <span class="tok-nc">Recomendacion</span> <span class="tok-kd">extends</span> <span class="tok-n">ClaseDominio</span> <span class="tok-o">{</span>
    <span class="tok-kd">private</span> <span class="tok-n">Libro</span> <span class="tok-n">libro</span><span class="tok-o">;</span>
    <span class="tok-kd">private</span> <span class="tok-n">Libro</span> <span class="tok-n">libroRelacionado</span><span class="tok-o">;</span>
    <span class="tok-kd">private</span> <span class="tok-n">String</span> <span class="tok-n">comentario</span><span class="tok-o">;</span>
    <span class="tok-kd">private</span> <span class="tok-kd">static</span> <span class="tok-n">Log</span> <span class="tok-n">logger</span> <span class="tok-o">=</span> <span class="tok-n">LogFactory</span><span class="tok-o">.</span><span class="tok-na">getLog</span><span class="tok-o">(</span><span class="tok-n">Recomendacion</span><span class="tok-o">.</span><span class="tok-na">class</span><span class="tok-o">);</span>

    <span class="tok-kd">public</span> <span class="tok-nf">Recomendacion</span><span class="tok-o">(</span><span class="tok-n">Libro</span> <span class="tok-n">libro</span><span class="tok-o">,</span> <span class="tok-n">Libro</span> <span class="tok-n">libroRelacionado</span><span class="tok-o">)</span> <span class="tok-o">{</span>
        <span class="tok-k">if</span> <span class="tok-o">(</span><span class="tok-n">libro</span> <span class="tok-o">==</span> <span class="tok-kc">null</span><span class="tok-o">)</span> <span class="tok-o">{</span>
            <span class="tok-n">logger</span><span class="tok-o">.</span><span class="tok-na">error</span><span class="tok-o">(</span><span class="tok-s">&quot;libro es null&quot;</span><span class="tok-o">);</span>
            <span class="tok-k">throw</span> <span class="tok-k">new</span> <span class="tok-nf">IllegalArgumentException</span><span class="tok-o">(</span><span class="tok-s">&quot;Error al crear recomendación: libro null&quot;</span><span class="tok-o">);</span>
        <span class="tok-o">}</span>
        <span class="tok-k">if</span> <span class="tok-o">(</span><span class="tok-n">libroRelacionado</span> <span class="tok-o">==</span> <span class="tok-kc">null</span><span class="tok-o">)</span> <span class="tok-o">{</span>
            <span class="tok-n">logger</span><span class="tok-o">.</span><span class="tok-na">error</span><span class="tok-o">(</span><span class="tok-s">&quot;libroRelacionado es null&quot;</span><span class="tok-o">);</span>
            <span class="tok-k">throw</span> <span class="tok-k">new</span> <span class="tok-nf">IllegalArgumentException</span><span class="tok-o">(</span><span class="tok-s">&quot;Error al crear recomendación: libroRelacionado null&quot;</span><span class="tok-o">);</span>
        <span class="tok-o">}</span>
        <span class="tok-k">this</span><span class="tok-o">.</span><span class="tok-na">libro</span> <span class="tok-o">=</span> <span class="tok-n">libro</span><span class="tok-o">;</span>
        <span class="tok-k">this</span><span class="tok-o">.</span><span class="tok-na">libroRelacionado</span> <span class="tok-o">=</span> <span class="tok-n">libroRelacionado</span><span class="tok-o">;</span>
    <span class="tok-o">}</span>

    <span class="tok-kd">public</span> <span class="tok-n">Libro</span> <span class="tok-nf">getLibro</span><span class="tok-o">()</span> <span class="tok-o">{</span>
        <span class="tok-k">return</span> <span class="tok-n">libro</span><span class="tok-o">;</span>
    <span class="tok-o">}</span>

    <span class="tok-kd">public</span> <span class="tok-kt">void</span> <span class="tok-nf">setLibro</span><span class="tok-o">(</span><span class="tok-n">Libro</span> <span class="tok-n">libro</span><span class="tok-o">)</span> <span class="tok-o">{</span>
        <span class="tok-k">this</span><span class="tok-o">.</span><span class="tok-na">libro</span> <span class="tok-o">=</span> <span class="tok-n">libro</span><span class="tok-o">;</span>
    <span class="tok-o">}</span>

    <span class="tok-kd">public</span> <span class="tok-n">Libro</span> <span class="tok-nf">getLibroRelacionado</span><span class="tok-o">()</span> <span class="tok-o">{</span>
        <span class="tok-k">return</span> <span class="tok-n">libroRelacionado</span><span class="tok-o">;</span>
    <span class="tok-o">}</span>

    <span class="tok-kd">public</span> <span class="tok-kt">void</span> <span class="tok-nf">setLibroRelacionado</span><span class="tok-o">(</span><span class="tok-n">Libro</span> <span class="tok-n">libroRelacionado</span><span class="tok-o">)</span> <span class="tok-o">{</span>
        <span class="tok-k">this</span><span class="tok-o">.</span><span class="tok-na">libroRelacionado</span> <span class="tok-o">=</span> <span class="tok-n">libroRelacionado</span><span class="tok-o">;</span>
    <span class="tok-o">}</span>

    <span class="tok-kd">public</span> <span class="tok-n">String</span> <span class="tok-nf">getComentario</span><span class="tok-o">()</span> <span class="tok-o">{</span>
        <span class="tok-k">return</span> <span class="tok-n">comentario</span><span class="tok-o">;</span>
    <span class="tok-o">}</span>

    <span class="tok-kd">public</span> <span class="tok-kt">void</span> <span class="tok-nf">setComentario</span><span class="tok-o">(</span><span class="tok-n">String</span> <span class="tok-n">comentario</span><span class="tok-o">)</span> <span class="tok-o">{</span>
        <span class="tok-k">this</span><span class="tok-o">.</span><span class="tok-na">comentario</span> <span class="tok-o">=</span> <span class="tok-n">comentario</span><span class="tok-o">;</span>
    <span class="tok-o">}</span>
<span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Todos los métodos se pueden generar usando el asistente de IntelliJ, con la opción <em>Generate&#8230;&#8203;</em>.</p>
</div>
<div class="sect4">
<h5 id="_logging">Logging</h5>
<div class="paragraph">
<p>La configuración de logging se define en los siguientes ficheros. Que deben estar en el directorio <code>resources</code>, tanto de la carpeta de fuentes como de la carpeta de tests. El nivel de logging está en INFO en la carpeta de fuentes y a DEBUG en la de tests.</p>
</div>
<div class="listingblock">
<div class="title">src/main/resources/commons-loggin.properties</div>
<div class="content">
<pre class="pygments highlight"><code>org.apache.commons.logging.Log=org.apache.commons.logging.impl.Log4JLogger</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">src/main/resources/log4j.properties</div>
<div class="content">
<pre class="pygments highlight"><code># Coloca el nivel root del logger en INFO (muestra mensajes de INFO hacia arriba)
log4j.rootLogger=INFO, A1

# A1 se redirige a la consola
log4j.appender.A1=org.apache.log4j.ConsoleAppender
log4j.appender.stdout.Target=System.out
log4j.appender.A1.layout=org.apache.log4j.PatternLayout
log4j.appender.A1.layout.ConversionPattern=%d{dd/MM/yyyy HH:mm:ss} - %p - %m %n</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">src/test/resources/log4j.properties</div>
<div class="content">
<pre class="pygments highlight"><code># Coloca el nivel root del logger en DEBUG (muestra mensajes de DEBUG hacia arriba)
log4j.rootLogger=DEBUG, A1

# A1 se redirige a la consola
log4j.appender.A1=org.apache.log4j.ConsoleAppender
log4j.appender.stdout.Target=System.out
log4j.appender.A1.layout=org.apache.log4j.PatternLayout
log4j.appender.A1.layout.ConversionPattern=%d{dd/MM/yyyy HH:mm:ss} - %p - %m %n</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_primeros_tests">Primeros tests</h5>
<div class="paragraph">
<p>Definimos los dos primeros test de la clase <code>org.expertojava.jbibrest.model.LibroTest</code> en el directorio <code>src/test/java</code>, con los que probamos el funcionamiento correcto de la igualdad en la clase <code>Libro</code> y el funcionamiento correcto del constructor.</p>
</div>
<div class="listingblock">
<div class="title">src/test/java/org/expertojava/jbibrest/modelo/LibroTest.java</div>
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span class="tok-kn">package</span> <span class="tok-n">org</span><span class="tok-o">.</span><span class="tok-na">expertojava</span><span class="tok-o">.</span><span class="tok-na">jbibrest</span><span class="tok-o">.</span><span class="tok-na">modelo</span><span class="tok-o">;</span>

<span class="tok-kn">import</span> <span class="tok-nn">org.junit.Test</span><span class="tok-o">;</span>

<span class="tok-kn">import</span> <span class="tok-nn">java.util.HashSet</span><span class="tok-o">;</span>

<span class="tok-kn">import</span> <span class="tok-nn">static</span> <span class="tok-n">org</span><span class="tok-o">.</span><span class="tok-na">junit</span><span class="tok-o">.</span><span class="tok-na">Assert</span><span class="tok-o">.</span><span class="tok-na">assertEquals</span><span class="tok-o">;</span>
<span class="tok-kn">import</span> <span class="tok-nn">static</span> <span class="tok-n">org</span><span class="tok-o">.</span><span class="tok-na">junit</span><span class="tok-o">.</span><span class="tok-na">Assert</span><span class="tok-o">.</span><span class="tok-na">assertFalse</span><span class="tok-o">;</span>
<span class="tok-kn">import</span> <span class="tok-nn">static</span> <span class="tok-n">org</span><span class="tok-o">.</span><span class="tok-na">junit</span><span class="tok-o">.</span><span class="tok-na">Assert</span><span class="tok-o">.</span><span class="tok-na">assertTrue</span><span class="tok-o">;</span>

<span class="tok-kd">public</span> <span class="tok-kd">class</span> <span class="tok-nc">LibroTest</span> <span class="tok-o">{</span>

    <span class="tok-nd">@Test</span>
    <span class="tok-kd">public</span> <span class="tok-kt">void</span> <span class="tok-nf">compruebaEqualsDevuelveTrueConMismoId</span><span class="tok-o">()</span> <span class="tok-o">{</span>
        <span class="tok-n">Libro</span> <span class="tok-n">libro1</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-nf">Libro</span><span class="tok-o">(</span><span class="tok-s">&quot;123456789&quot;</span><span class="tok-o">);</span>
        <span class="tok-n">Libro</span> <span class="tok-n">libro2</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-nf">Libro</span><span class="tok-o">(</span><span class="tok-s">&quot;123456789&quot;</span><span class="tok-o">);</span>
        <span class="tok-n">libro1</span><span class="tok-o">.</span><span class="tok-na">setId</span><span class="tok-o">(</span><span class="tok-mi">1L</span><span class="tok-o">);</span>
        <span class="tok-n">libro2</span><span class="tok-o">.</span><span class="tok-na">setId</span><span class="tok-o">(</span><span class="tok-mi">1L</span><span class="tok-o">);</span>
        <span class="tok-n">assertTrue</span><span class="tok-o">(</span><span class="tok-n">libro1</span><span class="tok-o">.</span><span class="tok-na">equals</span><span class="tok-o">(</span><span class="tok-n">libro2</span><span class="tok-o">));</span>
        <span class="tok-n">libro2</span><span class="tok-o">.</span><span class="tok-na">setId</span><span class="tok-o">(</span><span class="tok-mi">2L</span><span class="tok-o">);</span>
        <span class="tok-n">assertFalse</span><span class="tok-o">(</span><span class="tok-n">libro1</span><span class="tok-o">.</span><span class="tok-na">equals</span><span class="tok-o">(</span><span class="tok-n">libro2</span><span class="tok-o">));</span>
    <span class="tok-o">}</span>

    <span class="tok-nd">@Test</span>
    <span class="tok-kd">public</span> <span class="tok-kt">void</span> <span class="tok-nf">compruebaValoresPorDefectoEnNuevoLibro</span><span class="tok-o">()</span> <span class="tok-o">{</span>
        <span class="tok-n">Libro</span> <span class="tok-n">libro</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-nf">Libro</span><span class="tok-o">(</span><span class="tok-s">&quot;123456789&quot;</span><span class="tok-o">);</span>
        <span class="tok-n">assertEquals</span><span class="tok-o">(</span><span class="tok-mi">0</span><span class="tok-o">,</span> <span class="tok-n">libro</span><span class="tok-o">.</span><span class="tok-na">getnEjemplares</span><span class="tok-o">());</span>
        <span class="tok-n">assertEquals</span><span class="tok-o">(</span><span class="tok-mi">0</span><span class="tok-o">,</span> <span class="tok-n">libro</span><span class="tok-o">.</span><span class="tok-na">getnEjemplaresDisponibles</span><span class="tok-o">());</span>
        <span class="tok-n">assertEquals</span><span class="tok-o">(</span><span class="tok-mi">0</span><span class="tok-o">,</span> <span class="tok-n">libro</span><span class="tok-o">.</span><span class="tok-na">getRecomendaciones</span><span class="tok-o">().</span><span class="tok-na">size</span><span class="tok-o">());</span>
    <span class="tok-o">}</span>
<span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Ejecutamos el test con el botón derecho sobre la clase o el paquete y <em>Run tests</em>. También los podemos lanzar usando el <em>goal</em> correspondiente de Maven.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_jerarquía_de_clases_code_usuario_code_code_alumno_code_code_profesor_code">2.6.3. Jerarquía de clases <code>Usuario</code>, <code>Alumno</code>, <code>Profesor</code></h4>
<div class="paragraph">
<p>Empezamos ahora a implementar la jerarquía de clases usuario. En primer lugar la clase padre abstracta <code>Usuario</code> que hereda de <code>ClaseDominio</code> y que define los atributos comunes</p>
</div>
<div class="listingblock">
<div class="title">src/main/java/org/expertojava/jbibrest/modelo/Usuario.java</div>
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span class="tok-kn">package</span> <span class="tok-n">org</span><span class="tok-o">.</span><span class="tok-na">expertojava</span><span class="tok-o">.</span><span class="tok-na">jbibrest</span><span class="tok-o">.</span><span class="tok-na">modelo</span><span class="tok-o">;</span>

<span class="tok-kn">import</span> <span class="tok-nn">org.apache.commons.logging.Log</span><span class="tok-o">;</span>
<span class="tok-kn">import</span> <span class="tok-nn">org.apache.commons.logging.LogFactory</span><span class="tok-o">;</span>

<span class="tok-kn">import</span> <span class="tok-nn">java.util.Date</span><span class="tok-o">;</span>
<span class="tok-kn">import</span> <span class="tok-nn">java.util.HashSet</span><span class="tok-o">;</span>
<span class="tok-kn">import</span> <span class="tok-nn">java.util.Set</span><span class="tok-o">;</span>

<span class="tok-kd">public</span> <span class="tok-kd">abstract</span> <span class="tok-kd">class</span> <span class="tok-nc">Usuario</span> <span class="tok-kd">extends</span> <span class="tok-n">ClaseDominio</span> <span class="tok-o">{</span>
    <span class="tok-kd">private</span> <span class="tok-n">String</span> <span class="tok-n">login</span><span class="tok-o">;</span>
    <span class="tok-kd">private</span> <span class="tok-n">String</span> <span class="tok-n">eMail</span><span class="tok-o">;</span>
    <span class="tok-kd">private</span> <span class="tok-n">String</span> <span class="tok-n">nombre</span><span class="tok-o">;</span>
    <span class="tok-kd">private</span> <span class="tok-n">String</span> <span class="tok-n">apellido1</span><span class="tok-o">;</span>
    <span class="tok-kd">private</span> <span class="tok-n">String</span> <span class="tok-n">apellido2</span><span class="tok-o">;</span>

    <span class="tok-kd">private</span> <span class="tok-kd">static</span> <span class="tok-n">Log</span> <span class="tok-n">logger</span> <span class="tok-o">=</span> <span class="tok-n">LogFactory</span><span class="tok-o">.</span><span class="tok-na">getLog</span><span class="tok-o">(</span><span class="tok-n">Usuario</span><span class="tok-o">.</span><span class="tok-na">class</span><span class="tok-o">);</span>

    <span class="tok-kd">public</span> <span class="tok-n">String</span> <span class="tok-nf">getLogin</span><span class="tok-o">()</span> <span class="tok-o">{</span>
        <span class="tok-k">return</span> <span class="tok-n">login</span><span class="tok-o">;</span>
    <span class="tok-o">}</span>

    <span class="tok-kd">public</span> <span class="tok-kt">void</span> <span class="tok-nf">setLogin</span><span class="tok-o">(</span><span class="tok-n">String</span> <span class="tok-n">login</span><span class="tok-o">)</span> <span class="tok-o">{</span>
        <span class="tok-k">this</span><span class="tok-o">.</span><span class="tok-na">login</span> <span class="tok-o">=</span> <span class="tok-n">login</span><span class="tok-o">;</span>
    <span class="tok-o">}</span>

    <span class="tok-kd">public</span> <span class="tok-n">String</span> <span class="tok-nf">geteMail</span><span class="tok-o">()</span> <span class="tok-o">{</span>
        <span class="tok-k">return</span> <span class="tok-n">eMail</span><span class="tok-o">;</span>
    <span class="tok-o">}</span>

    <span class="tok-kd">public</span> <span class="tok-kt">void</span> <span class="tok-nf">seteMail</span><span class="tok-o">(</span><span class="tok-n">String</span> <span class="tok-n">eMail</span><span class="tok-o">)</span> <span class="tok-o">{</span>
        <span class="tok-k">this</span><span class="tok-o">.</span><span class="tok-na">eMail</span> <span class="tok-o">=</span> <span class="tok-n">eMail</span><span class="tok-o">;</span>
    <span class="tok-o">}</span>

    <span class="tok-kd">public</span> <span class="tok-n">String</span> <span class="tok-nf">getNombre</span><span class="tok-o">()</span> <span class="tok-o">{</span>
        <span class="tok-k">return</span> <span class="tok-n">nombre</span><span class="tok-o">;</span>
    <span class="tok-o">}</span>

    <span class="tok-kd">public</span> <span class="tok-kt">void</span> <span class="tok-nf">setNombre</span><span class="tok-o">(</span><span class="tok-n">String</span> <span class="tok-n">nombre</span><span class="tok-o">)</span> <span class="tok-o">{</span>
        <span class="tok-k">this</span><span class="tok-o">.</span><span class="tok-na">nombre</span> <span class="tok-o">=</span> <span class="tok-n">nombre</span><span class="tok-o">;</span>
    <span class="tok-o">}</span>

    <span class="tok-kd">public</span> <span class="tok-n">String</span> <span class="tok-nf">getApellido1</span><span class="tok-o">()</span> <span class="tok-o">{</span>
        <span class="tok-k">return</span> <span class="tok-n">apellido1</span><span class="tok-o">;</span>
    <span class="tok-o">}</span>

    <span class="tok-kd">public</span> <span class="tok-kt">void</span> <span class="tok-nf">setApellido1</span><span class="tok-o">(</span><span class="tok-n">String</span> <span class="tok-n">apellido1</span><span class="tok-o">)</span> <span class="tok-o">{</span>
        <span class="tok-k">this</span><span class="tok-o">.</span><span class="tok-na">apellido1</span> <span class="tok-o">=</span> <span class="tok-n">apellido1</span><span class="tok-o">;</span>
    <span class="tok-o">}</span>

    <span class="tok-kd">public</span> <span class="tok-n">String</span> <span class="tok-nf">getApellido2</span><span class="tok-o">()</span> <span class="tok-o">{</span>
        <span class="tok-k">return</span> <span class="tok-n">apellido2</span><span class="tok-o">;</span>
    <span class="tok-o">}</span>

    <span class="tok-kd">public</span> <span class="tok-kt">void</span> <span class="tok-nf">setApellido2</span><span class="tok-o">(</span><span class="tok-n">String</span> <span class="tok-n">apellido2</span><span class="tok-o">)</span> <span class="tok-o">{</span>
        <span class="tok-k">this</span><span class="tok-o">.</span><span class="tok-na">apellido2</span> <span class="tok-o">=</span> <span class="tok-n">apellido2</span><span class="tok-o">;</span>
    <span class="tok-o">}</span>
<span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Definimos las clases hijas, junto con su constructores:</p>
</div>
<div class="listingblock">
<div class="title">src/main/java/org/expertojava/jbibrest/modelo/Profesor.java</div>
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span class="tok-kn">package</span> <span class="tok-n">org</span><span class="tok-o">.</span><span class="tok-na">expertojava</span><span class="tok-o">.</span><span class="tok-na">jbibrest</span><span class="tok-o">.</span><span class="tok-na">modelo</span><span class="tok-o">;</span>

<span class="tok-kn">import</span> <span class="tok-nn">org.apache.commons.logging.Log</span><span class="tok-o">;</span>
<span class="tok-kn">import</span> <span class="tok-nn">org.apache.commons.logging.LogFactory</span><span class="tok-o">;</span>

<span class="tok-kd">public</span> <span class="tok-kd">class</span> <span class="tok-nc">Profesor</span> <span class="tok-kd">extends</span> <span class="tok-n">Usuario</span> <span class="tok-o">{</span>
    <span class="tok-kd">private</span> <span class="tok-n">String</span> <span class="tok-n">departamento</span><span class="tok-o">;</span>

    <span class="tok-kd">private</span> <span class="tok-kd">static</span> <span class="tok-n">Log</span> <span class="tok-n">logger</span> <span class="tok-o">=</span> <span class="tok-n">LogFactory</span><span class="tok-o">.</span><span class="tok-na">getLog</span><span class="tok-o">(</span><span class="tok-n">Profesor</span><span class="tok-o">.</span><span class="tok-na">class</span><span class="tok-o">);</span>

    <span class="tok-kd">public</span> <span class="tok-nf">Profesor</span><span class="tok-o">(</span><span class="tok-n">String</span> <span class="tok-n">login</span><span class="tok-o">)</span> <span class="tok-o">{</span>
        <span class="tok-k">this</span><span class="tok-o">.</span><span class="tok-na">setLogin</span><span class="tok-o">(</span><span class="tok-n">login</span><span class="tok-o">);</span>
    <span class="tok-o">}</span>

    <span class="tok-kd">public</span> <span class="tok-n">String</span> <span class="tok-nf">getDepartamento</span><span class="tok-o">()</span> <span class="tok-o">{</span>
        <span class="tok-k">return</span> <span class="tok-n">departamento</span><span class="tok-o">;</span>
    <span class="tok-o">}</span>

    <span class="tok-kd">public</span> <span class="tok-kt">void</span> <span class="tok-nf">setDepartamento</span><span class="tok-o">(</span><span class="tok-n">String</span> <span class="tok-n">departamento</span><span class="tok-o">)</span> <span class="tok-o">{</span>
        <span class="tok-k">this</span><span class="tok-o">.</span><span class="tok-na">departamento</span> <span class="tok-o">=</span> <span class="tok-n">departamento</span><span class="tok-o">;</span>
    <span class="tok-o">}</span>

    <span class="tok-kd">public</span> <span class="tok-n">String</span> <span class="tok-nf">toString</span><span class="tok-o">()</span> <span class="tok-o">{</span>
        <span class="tok-k">return</span> <span class="tok-k">this</span><span class="tok-o">.</span><span class="tok-na">getLogin</span><span class="tok-o">()</span> <span class="tok-o">+</span> <span class="tok-s">&quot; : &quot;</span>
                <span class="tok-o">+</span> <span class="tok-k">this</span><span class="tok-o">.</span><span class="tok-na">getNombre</span><span class="tok-o">()</span> <span class="tok-o">+</span> <span class="tok-s">&quot; &quot;</span>
                <span class="tok-o">+</span> <span class="tok-k">this</span><span class="tok-o">.</span><span class="tok-na">getApellido1</span><span class="tok-o">()</span> <span class="tok-o">+</span> <span class="tok-s">&quot; &quot;</span>
                <span class="tok-o">+</span> <span class="tok-k">this</span><span class="tok-o">.</span><span class="tok-na">getApellido2</span><span class="tok-o">()</span> <span class="tok-o">+</span> <span class="tok-s">&quot; &quot;</span>
                <span class="tok-o">+</span> <span class="tok-s">&quot;(PROFESOR)&quot;</span><span class="tok-o">;</span>
    <span class="tok-o">}</span>

<span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">src/main/java/org/expertojava/jbibrest/modelo/Alumno.java</div>
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span class="tok-kn">package</span> <span class="tok-n">org</span><span class="tok-o">.</span><span class="tok-na">expertojava</span><span class="tok-o">.</span><span class="tok-na">jbibrest</span><span class="tok-o">.</span><span class="tok-na">modelo</span><span class="tok-o">;</span>

<span class="tok-kn">import</span> <span class="tok-nn">org.apache.commons.logging.Log</span><span class="tok-o">;</span>
<span class="tok-kn">import</span> <span class="tok-nn">org.apache.commons.logging.LogFactory</span><span class="tok-o">;</span>

<span class="tok-kd">public</span> <span class="tok-kd">class</span> <span class="tok-nc">Alumno</span> <span class="tok-kd">extends</span> <span class="tok-n">Usuario</span> <span class="tok-o">{</span>
    <span class="tok-kd">private</span> <span class="tok-n">String</span> <span class="tok-n">telefonoPadres</span><span class="tok-o">;</span>

    <span class="tok-kd">private</span> <span class="tok-kd">static</span> <span class="tok-n">Log</span> <span class="tok-n">logger</span> <span class="tok-o">=</span> <span class="tok-n">LogFactory</span><span class="tok-o">.</span><span class="tok-na">getLog</span><span class="tok-o">(</span><span class="tok-n">Alumno</span><span class="tok-o">.</span><span class="tok-na">class</span><span class="tok-o">);</span>

    <span class="tok-kd">public</span> <span class="tok-nf">Alumno</span><span class="tok-o">(</span><span class="tok-n">String</span> <span class="tok-n">login</span><span class="tok-o">)</span> <span class="tok-o">{</span>
        <span class="tok-k">this</span><span class="tok-o">.</span><span class="tok-na">setLogin</span><span class="tok-o">(</span><span class="tok-n">login</span><span class="tok-o">);</span>
    <span class="tok-o">}</span>

    <span class="tok-kd">public</span> <span class="tok-n">String</span> <span class="tok-nf">getTelefonoPadres</span><span class="tok-o">()</span> <span class="tok-o">{</span>
        <span class="tok-k">return</span> <span class="tok-n">telefonoPadres</span><span class="tok-o">;</span>
    <span class="tok-o">}</span>

    <span class="tok-kd">public</span> <span class="tok-kt">void</span> <span class="tok-nf">setTelefonoPadres</span><span class="tok-o">(</span><span class="tok-n">String</span> <span class="tok-n">telefonoPadres</span><span class="tok-o">)</span> <span class="tok-o">{</span>
        <span class="tok-k">this</span><span class="tok-o">.</span><span class="tok-na">telefonoPadres</span> <span class="tok-o">=</span> <span class="tok-n">telefonoPadres</span><span class="tok-o">;</span>
    <span class="tok-o">}</span>

    <span class="tok-kd">public</span> <span class="tok-n">String</span> <span class="tok-nf">toString</span><span class="tok-o">()</span> <span class="tok-o">{</span>
        <span class="tok-k">return</span> <span class="tok-k">this</span><span class="tok-o">.</span><span class="tok-na">getLogin</span><span class="tok-o">()</span> <span class="tok-o">+</span> <span class="tok-s">&quot; : &quot;</span>
                <span class="tok-o">+</span> <span class="tok-k">this</span><span class="tok-o">.</span><span class="tok-na">getNombre</span><span class="tok-o">()</span> <span class="tok-o">+</span> <span class="tok-s">&quot; &quot;</span>
                <span class="tok-o">+</span> <span class="tok-k">this</span><span class="tok-o">.</span><span class="tok-na">getApellido1</span><span class="tok-o">()</span> <span class="tok-o">+</span> <span class="tok-s">&quot; &quot;</span>
                <span class="tok-o">+</span> <span class="tok-k">this</span><span class="tok-o">.</span><span class="tok-na">getApellido2</span><span class="tok-o">()</span> <span class="tok-o">+</span> <span class="tok-s">&quot; &quot;</span>
                <span class="tok-o">+</span> <span class="tok-s">&quot;(ALUMNO)&quot;</span><span class="tok-o">;</span>
    <span class="tok-o">}</span>
<span class="tok-o">}</span></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_gestión_de_excepciones">2.6.4. Gestión de excepciones</h4>
<div class="paragraph">
<p>Es conveniente definir una clase de excepciones para encapsular en ellas todos los errores generados en la aplicación. Vamos a definir una excepción genérica de tipo <em>unchecked</em> (<code>BibliotecaException</code>), que será la excepción padre de todas las excepciones de aplicación de la biblioteca.</p>
</div>
<div class="paragraph">
<p>En principio la definimos <em>unchecked</em> porque todos los errores que vamos a capturar tienen que ver con el mal uso del API. En general, un método debe realizar su funcionalidad y terminar correctamente cuando todo ha funcionado bien. Se lanzará una excepción si algo falla. Por ejemplo, cuando definamos un método <code>prestar(libro,usuario)</code> lanzaremos excepciones cuando no se cumplan las condiciones que hacen que el libro pueda ser prestado al usuario. Al lanzar excepciones no chequeadas permitimos que el programador chequee las condiciones antes de llamar al método y no tenga que obligatoriamente capturar una excepción que sabemos que no se va a producir. Si es necesario más adelante añadiremos una excepción <em>checked</em>.</p>
</div>
<div class="paragraph">
<p>Definimos las excepciones en el paquete <code>org.expertojava.jbibrest.utils</code>.</p>
</div>
<div class="listingblock">
<div class="title">src/main/java/org/expertojava/jbibrest/utils/BibliotecaException.java</div>
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span class="tok-kn">package</span> <span class="tok-n">org</span><span class="tok-o">.</span><span class="tok-na">expertojava</span><span class="tok-o">.</span><span class="tok-na">jbibrest</span><span class="tok-o">.</span><span class="tok-na">utils</span><span class="tok-o">;</span>

<span class="tok-kd">public</span> <span class="tok-kd">class</span> <span class="tok-nc">BibliotecaException</span> <span class="tok-kd">extends</span> <span class="tok-n">RuntimeException</span> <span class="tok-o">{</span>
    <span class="tok-kd">public</span> <span class="tok-kd">static</span> <span class="tok-kd">final</span> <span class="tok-n">String</span> <span class="tok-n">EJEMPLAR_NO_DISPONIBLE</span> <span class="tok-o">=</span> <span class="tok-s">&quot;Ejemplar no disponible&quot;</span><span class="tok-o">;</span>
    <span class="tok-kd">public</span> <span class="tok-kd">static</span> <span class="tok-kd">final</span> <span class="tok-n">String</span> <span class="tok-n">NO_HAY_EJEMPLARES_DISPONIBLES</span> <span class="tok-o">=</span> <span class="tok-s">&quot;No hay ejemplares disponibles&quot;</span><span class="tok-o">;</span>
    <span class="tok-kd">public</span> <span class="tok-kd">static</span> <span class="tok-kd">final</span> <span class="tok-n">String</span> <span class="tok-n">USUARIO_NO_EXISTENTE</span> <span class="tok-o">=</span> <span class="tok-s">&quot;Usuario no existente&quot;</span><span class="tok-o">;</span>
    <span class="tok-kd">public</span> <span class="tok-kd">static</span> <span class="tok-kd">final</span> <span class="tok-n">String</span> <span class="tok-n">EJEMPLAR_NO_EXISTENTE</span> <span class="tok-o">=</span> <span class="tok-s">&quot;Ejemplar no existente&quot;</span><span class="tok-o">;</span>
    <span class="tok-kd">public</span> <span class="tok-kd">static</span> <span class="tok-kd">final</span> <span class="tok-n">String</span> <span class="tok-n">USUARIO_NO_ACTIVO</span> <span class="tok-o">=</span> <span class="tok-s">&quot;Usuario no activo&quot;</span><span class="tok-o">;</span>
    <span class="tok-kd">public</span> <span class="tok-kd">static</span> <span class="tok-kd">final</span> <span class="tok-n">String</span> <span class="tok-n">USUARIO_NO_TIENE_EJEMPLAR</span> <span class="tok-o">=</span> <span class="tok-s">&quot;Usuario no tiene ejemplar&quot;</span><span class="tok-o">;</span>

    <span class="tok-kd">public</span> <span class="tok-nf">BibliotecaException</span><span class="tok-o">()</span> <span class="tok-o">{</span>
        <span class="tok-kd">super</span><span class="tok-o">();</span>
    <span class="tok-o">}</span>

    <span class="tok-kd">public</span> <span class="tok-nf">BibliotecaException</span><span class="tok-o">(</span><span class="tok-n">String</span> <span class="tok-n">message</span><span class="tok-o">)</span> <span class="tok-o">{</span>
        <span class="tok-kd">super</span><span class="tok-o">(</span><span class="tok-n">message</span><span class="tok-o">);</span>
    <span class="tok-o">}</span>

    <span class="tok-kd">public</span> <span class="tok-nf">BibliotecaException</span><span class="tok-o">(</span><span class="tok-n">String</span> <span class="tok-n">message</span><span class="tok-o">,</span> <span class="tok-n">Throwable</span> <span class="tok-n">cause</span><span class="tok-o">)</span> <span class="tok-o">{</span>
        <span class="tok-kd">super</span><span class="tok-o">(</span><span class="tok-n">message</span><span class="tok-o">,</span> <span class="tok-n">cause</span><span class="tok-o">);</span>
    <span class="tok-o">}</span>
<span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Podemos observar como, al sobrecargar el constructor con los parámetros <code>{String, Throwable}</code>, nuestra excepción permitirá su uso como <em>Nested Exception</em>. También que hemos definido unas constantes relacionadas con el dominio, que usaremos más adelante.</p>
</div>
</div>
<div class="sect3">
<h4 id="_métodos_de_utilidad">2.6.5. Métodos de utilidad</h4>
<div class="paragraph">
<p>Agrupamos distintos métodos de utilidad en la clase <code>Utils.java</code>. Por ahora todo son métodos relacionados con fechas.</p>
</div>
<div class="listingblock">
<div class="title">src/main/java/org/expertojava/jbibrest/utils/Utils.java</div>
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span class="tok-kn">package</span> <span class="tok-n">org</span><span class="tok-o">.</span><span class="tok-na">expertojava</span><span class="tok-o">.</span><span class="tok-na">jbibrest</span><span class="tok-o">.</span><span class="tok-na">utils</span><span class="tok-o">;</span>

<span class="tok-kn">import</span> <span class="tok-nn">java.text.ParseException</span><span class="tok-o">;</span>
<span class="tok-kn">import</span> <span class="tok-nn">java.text.SimpleDateFormat</span><span class="tok-o">;</span>
<span class="tok-kn">import</span> <span class="tok-nn">java.util.Calendar</span><span class="tok-o">;</span>
<span class="tok-kn">import</span> <span class="tok-nn">java.util.Date</span><span class="tok-o">;</span>

<span class="tok-kd">public</span> <span class="tok-kd">class</span> <span class="tok-nc">Utils</span> <span class="tok-o">{</span>

    <span class="tok-kd">static</span> <span class="tok-kd">public</span> <span class="tok-n">Date</span> <span class="tok-nf">stringToDate</span><span class="tok-o">(</span><span class="tok-n">String</span> <span class="tok-n">fechaStr</span><span class="tok-o">)</span> <span class="tok-o">{</span>
        <span class="tok-n">Date</span> <span class="tok-n">fecha</span> <span class="tok-o">=</span> <span class="tok-kc">null</span><span class="tok-o">;</span>
        <span class="tok-k">try</span> <span class="tok-o">{</span>
            <span class="tok-n">fecha</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-nf">SimpleDateFormat</span><span class="tok-o">(</span><span class="tok-s">&quot;yyyy-MM-dd&quot;</span><span class="tok-o">).</span><span class="tok-na">parse</span><span class="tok-o">(</span><span class="tok-n">fechaStr</span><span class="tok-o">);</span>
            <span class="tok-k">return</span> <span class="tok-n">fecha</span><span class="tok-o">;</span>
        <span class="tok-o">}</span> <span class="tok-k">catch</span> <span class="tok-o">(</span><span class="tok-n">ParseException</span> <span class="tok-n">e</span><span class="tok-o">)</span> <span class="tok-o">{</span>
            <span class="tok-n">e</span><span class="tok-o">.</span><span class="tok-na">printStackTrace</span><span class="tok-o">();</span>
        <span class="tok-o">}</span>
        <span class="tok-k">return</span> <span class="tok-n">fecha</span><span class="tok-o">;</span>
    <span class="tok-o">}</span>

    <span class="tok-kd">static</span> <span class="tok-kd">public</span> <span class="tok-n">Date</span> <span class="tok-nf">sumaDias</span><span class="tok-o">(</span><span class="tok-n">Date</span> <span class="tok-n">fecha</span><span class="tok-o">,</span> <span class="tok-kt">int</span> <span class="tok-n">dias</span><span class="tok-o">)</span> <span class="tok-o">{</span>
        <span class="tok-n">Calendar</span> <span class="tok-n">cal</span> <span class="tok-o">=</span> <span class="tok-n">Calendar</span><span class="tok-o">.</span><span class="tok-na">getInstance</span><span class="tok-o">();</span>
        <span class="tok-n">cal</span><span class="tok-o">.</span><span class="tok-na">setTime</span><span class="tok-o">(</span><span class="tok-n">fecha</span><span class="tok-o">);</span>
        <span class="tok-n">cal</span><span class="tok-o">.</span><span class="tok-na">add</span><span class="tok-o">(</span><span class="tok-n">Calendar</span><span class="tok-o">.</span><span class="tok-na">DATE</span><span class="tok-o">,</span> <span class="tok-n">dias</span><span class="tok-o">);</span>
        <span class="tok-k">return</span> <span class="tok-n">cal</span><span class="tok-o">.</span><span class="tok-na">getTime</span><span class="tok-o">();</span>
    <span class="tok-o">}</span>

    <span class="tok-kd">static</span> <span class="tok-kd">public</span> <span class="tok-kt">long</span> <span class="tok-nf">diferenciaDias</span><span class="tok-o">(</span><span class="tok-n">Date</span> <span class="tok-n">fecha1</span><span class="tok-o">,</span> <span class="tok-n">Date</span> <span class="tok-n">fecha2</span><span class="tok-o">)</span> <span class="tok-o">{</span>
        <span class="tok-kt">long</span> <span class="tok-n">dif</span> <span class="tok-o">=</span> <span class="tok-n">Math</span><span class="tok-o">.</span><span class="tok-na">abs</span><span class="tok-o">(</span><span class="tok-n">fecha1</span><span class="tok-o">.</span><span class="tok-na">getTime</span><span class="tok-o">()</span> <span class="tok-o">-</span> <span class="tok-n">fecha2</span><span class="tok-o">.</span><span class="tok-na">getTime</span><span class="tok-o">());</span>
        <span class="tok-kt">long</span> <span class="tok-n">difDias</span> <span class="tok-o">=</span> <span class="tok-n">dif</span> <span class="tok-o">/</span> <span class="tok-o">(</span><span class="tok-mi">24</span> <span class="tok-o">*</span> <span class="tok-mi">60</span> <span class="tok-o">*</span> <span class="tok-mi">60</span> <span class="tok-o">*</span> <span class="tok-mi">1000</span><span class="tok-o">);</span>
        <span class="tok-k">return</span> <span class="tok-n">difDias</span><span class="tok-o">;</span>
    <span class="tok-o">}</span>
<span class="tok-o">}</span></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_reglas_de_negocio">2.6.6. Reglas de negocio</h4>
<div class="paragraph">
<p>Es común agrupar las reglas de negocio de una aplicación en una o más clases (dependiendo de los diferentes subsistemas de la aplicación), para evitar que estén dispersas por la aplicación y acopladas a un gran número de clases.</p>
</div>
<div class="paragraph">
<p>En nuestro caso, vamos a crear un <em>Singleton</em>, al que llamaremos <code>BibliotecaBR</code> (BR = <em>Business Rules</em>). En principio, los valores estarán escritos directamente sobre la clase, pero en un futuro podríamos querer leer los valores de las reglas de negocio de un fichero de configuración).</p>
</div>
<div class="paragraph">
<p>El código inicial de nuestras reglas de negocio será el siguiente:</p>
</div>
<div class="listingblock">
<div class="title">src/main/java/org/expertojava/jbibrest/utils/BibliotecaBR.java</div>
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span class="tok-kn">package</span> <span class="tok-n">org</span><span class="tok-o">.</span><span class="tok-na">expertojava</span><span class="tok-o">.</span><span class="tok-na">jbibrest</span><span class="tok-o">.</span><span class="tok-na">utils</span><span class="tok-o">;</span>


<span class="tok-kn">import</span> <span class="tok-nn">org.apache.commons.logging.Log</span><span class="tok-o">;</span>
<span class="tok-kn">import</span> <span class="tok-nn">org.apache.commons.logging.LogFactory</span><span class="tok-o">;</span>
<span class="tok-kn">import</span> <span class="tok-nn">org.expertojava.jbibrest.modelo.*</span><span class="tok-o">;</span>

<span class="tok-kn">import</span> <span class="tok-nn">java.util.Date</span><span class="tok-o">;</span>

<span class="tok-cm">/**</span>
<span class="tok-cm"> * Reglas de Negocio de la Biblioteca BR = Business Rules</span>
<span class="tok-cm"> * &lt;p&gt;</span>
<span class="tok-cm"> * Lo implementamos como un singleton por si algun dia queremos leer las</span>
<span class="tok-cm"> * constantes desde un fichero de configuración, lo podemos hacer desde el</span>
<span class="tok-cm"> * constructor del singleton</span>
<span class="tok-cm"> */</span>
<span class="tok-kd">public</span> <span class="tok-kd">class</span> <span class="tok-nc">BibliotecaBR</span> <span class="tok-o">{</span>
    <span class="tok-kd">private</span> <span class="tok-kt">int</span> <span class="tok-n">numDiasPrestamoAlumno</span> <span class="tok-o">=</span> <span class="tok-mi">7</span><span class="tok-o">;</span>
    <span class="tok-kd">private</span> <span class="tok-kt">int</span> <span class="tok-n">numDiasPrestamoProfesor</span> <span class="tok-o">=</span> <span class="tok-mi">30</span><span class="tok-o">;</span>
    <span class="tok-kd">private</span> <span class="tok-kt">int</span> <span class="tok-n">cupoOperacionesAlumno</span> <span class="tok-o">=</span> <span class="tok-mi">5</span><span class="tok-o">;</span>
    <span class="tok-kd">private</span> <span class="tok-kt">int</span> <span class="tok-n">cupoOperacionesProfesor</span> <span class="tok-o">=</span> <span class="tok-mi">8</span><span class="tok-o">;</span>

    <span class="tok-kd">private</span> <span class="tok-kd">static</span> <span class="tok-n">Log</span> <span class="tok-n">logger</span> <span class="tok-o">=</span> <span class="tok-n">LogFactory</span><span class="tok-o">.</span><span class="tok-na">getLog</span><span class="tok-o">(</span><span class="tok-n">BibliotecaBR</span><span class="tok-o">.</span><span class="tok-na">class</span><span class="tok-o">);</span>

    <span class="tok-kd">private</span> <span class="tok-kd">static</span> <span class="tok-n">BibliotecaBR</span> <span class="tok-n">me</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-nf">BibliotecaBR</span><span class="tok-o">();</span>

    <span class="tok-kd">private</span> <span class="tok-nf">BibliotecaBR</span><span class="tok-o">()</span> <span class="tok-o">{</span>
        <span class="tok-n">logger</span><span class="tok-o">.</span><span class="tok-na">debug</span><span class="tok-o">(</span><span class="tok-s">&quot;Creada instancia de &quot;</span> <span class="tok-o">+</span> <span class="tok-k">this</span><span class="tok-o">.</span><span class="tok-na">getClass</span><span class="tok-o">().</span><span class="tok-na">getSimpleName</span><span class="tok-o">());</span>
    <span class="tok-o">}</span>

    <span class="tok-kd">public</span> <span class="tok-kd">static</span> <span class="tok-n">BibliotecaBR</span> <span class="tok-nf">getInstance</span><span class="tok-o">()</span> <span class="tok-o">{</span>
        <span class="tok-k">return</span> <span class="tok-n">me</span><span class="tok-o">;</span>
    <span class="tok-o">}</span>

    <span class="tok-cm">/**</span>
<span class="tok-cm">     * Devuelve el numero de dias de plazo que tienen un usuario para</span>
<span class="tok-cm">     * devolver un prestamo (Alumno = 7 , Profesor = 30)</span>
<span class="tok-cm">     *</span>
<span class="tok-cm">     * @param usuario objeto Usuario</span>
<span class="tok-cm">     * @return numero de dias del prestamo en función de la clase de</span>
<span class="tok-cm">     * Usuario, Alumno o Profesor</span>
<span class="tok-cm">     * @throws BibliotecaException el usuario no es de la clase Alumno ni Profesor</span>
<span class="tok-cm">     */</span>
    <span class="tok-kd">public</span> <span class="tok-kt">int</span> <span class="tok-nf">calculaNumDiasPrestamo</span><span class="tok-o">(</span><span class="tok-n">Usuario</span> <span class="tok-n">usuario</span><span class="tok-o">)</span>
            <span class="tok-kd">throws</span> <span class="tok-n">BibliotecaException</span> <span class="tok-o">{</span>
        <span class="tok-k">if</span> <span class="tok-o">(</span><span class="tok-n">usuario</span> <span class="tok-k">instanceof</span> <span class="tok-n">Alumno</span><span class="tok-o">)</span> <span class="tok-o">{</span>
            <span class="tok-k">return</span> <span class="tok-n">numDiasPrestamoAlumno</span><span class="tok-o">;</span>
        <span class="tok-o">}</span> <span class="tok-k">else</span> <span class="tok-nf">if</span> <span class="tok-o">(</span><span class="tok-n">usuario</span> <span class="tok-k">instanceof</span> <span class="tok-n">Profesor</span><span class="tok-o">)</span> <span class="tok-o">{</span>
            <span class="tok-k">return</span> <span class="tok-n">numDiasPrestamoProfesor</span><span class="tok-o">;</span>
        <span class="tok-o">}</span> <span class="tok-k">else</span> <span class="tok-o">{</span>
            <span class="tok-n">String</span> <span class="tok-n">msg</span> <span class="tok-o">=</span> <span class="tok-s">&quot;Solo los alumnos y profesores pueden tener &quot;</span> <span class="tok-o">+</span>
                    <span class="tok-s">&quot;libros prestados&quot;</span><span class="tok-o">;</span>
            <span class="tok-n">logger</span><span class="tok-o">.</span><span class="tok-na">error</span><span class="tok-o">(</span><span class="tok-n">msg</span><span class="tok-o">);</span>
            <span class="tok-k">throw</span> <span class="tok-k">new</span> <span class="tok-nf">BibliotecaException</span><span class="tok-o">(</span><span class="tok-n">msg</span><span class="tok-o">);</span>
        <span class="tok-o">}</span>
    <span class="tok-o">}</span>

    <span class="tok-cm">/**</span>
<span class="tok-cm">     * Valida que el número de días que se ha tardado en devolver</span>
<span class="tok-cm">     * un libro es inferior o igual que el plazo máximo</span>
<span class="tok-cm">     *</span>
<span class="tok-cm">     * @param usuario objeto Usuario</span>
<span class="tok-cm">     * @param numDias número de días sin devolver</span>
<span class="tok-cm">     * @throws BibliotecaException fuera de plazo</span>
<span class="tok-cm">     * @throws BibliotecaException el tipo del usuario no es el esperado</span>
<span class="tok-cm">     */</span>
    <span class="tok-kd">public</span> <span class="tok-kt">void</span> <span class="tok-nf">compruebaNumDiasPrestamo</span><span class="tok-o">(</span><span class="tok-n">Usuario</span> <span class="tok-n">usuario</span><span class="tok-o">,</span> <span class="tok-kt">int</span> <span class="tok-n">numDias</span><span class="tok-o">)</span>
            <span class="tok-kd">throws</span> <span class="tok-n">BibliotecaException</span> <span class="tok-o">{</span>
        <span class="tok-n">String</span> <span class="tok-n">msg</span><span class="tok-o">;</span>
        <span class="tok-k">if</span> <span class="tok-o">(!(</span><span class="tok-n">usuario</span> <span class="tok-k">instanceof</span> <span class="tok-n">Alumno</span><span class="tok-o">)</span>
                <span class="tok-o">&amp;&amp;</span> <span class="tok-o">!(</span><span class="tok-n">usuario</span> <span class="tok-k">instanceof</span> <span class="tok-n">Profesor</span><span class="tok-o">))</span> <span class="tok-o">{</span>
            <span class="tok-n">msg</span> <span class="tok-o">=</span> <span class="tok-s">&quot;Solo los alumnos y profesores pueden tener libros &quot;</span> <span class="tok-o">+</span>
                    <span class="tok-s">&quot;prestados&quot;</span><span class="tok-o">;</span>
            <span class="tok-n">logger</span><span class="tok-o">.</span><span class="tok-na">error</span><span class="tok-o">(</span><span class="tok-n">msg</span><span class="tok-o">);</span>
            <span class="tok-k">throw</span> <span class="tok-k">new</span> <span class="tok-nf">BibliotecaException</span><span class="tok-o">(</span><span class="tok-n">msg</span><span class="tok-o">);</span>
        <span class="tok-o">}</span>
        <span class="tok-k">if</span> <span class="tok-o">((</span><span class="tok-n">usuario</span> <span class="tok-k">instanceof</span> <span class="tok-n">Alumno</span> <span class="tok-o">&amp;&amp;</span> <span class="tok-n">numDias</span> <span class="tok-o">&gt;</span>
                <span class="tok-n">numDiasPrestamoAlumno</span><span class="tok-o">)</span> <span class="tok-o">||</span>
                <span class="tok-o">(</span><span class="tok-n">usuario</span> <span class="tok-k">instanceof</span> <span class="tok-n">Profesor</span> <span class="tok-o">&amp;&amp;</span> <span class="tok-n">numDias</span> <span class="tok-o">&gt;</span>
                        <span class="tok-n">numDiasPrestamoProfesor</span><span class="tok-o">))</span> <span class="tok-o">{</span>
            <span class="tok-n">msg</span> <span class="tok-o">=</span> <span class="tok-s">&quot;Devolución fuera de plazo&quot;</span><span class="tok-o">;</span>
            <span class="tok-n">logger</span><span class="tok-o">.</span><span class="tok-na">error</span><span class="tok-o">(</span><span class="tok-n">msg</span><span class="tok-o">);</span>
            <span class="tok-k">throw</span> <span class="tok-k">new</span> <span class="tok-nf">BibliotecaException</span><span class="tok-o">(</span><span class="tok-n">msg</span><span class="tok-o">);</span>
        <span class="tok-o">}</span>
    <span class="tok-o">}</span>

    <span class="tok-cm">/**</span>
<span class="tok-cm">     * Devuelve el número máximo de préstamos que</span>
<span class="tok-cm">     * puede realizar un determinado tipo de usuario</span>
<span class="tok-cm">     *</span>
<span class="tok-cm">     * @param usuario objeto UsuarioDomain</span>
<span class="tok-cm">     * @return número máximo de operaciones del tipo de usuario</span>
<span class="tok-cm">     * @throws BibliotecaException el tipo del usuario no es el esperado</span>
<span class="tok-cm">     */</span>
    <span class="tok-kd">public</span> <span class="tok-kt">int</span> <span class="tok-nf">cupoOperaciones</span><span class="tok-o">(</span><span class="tok-n">Usuario</span> <span class="tok-n">usuario</span><span class="tok-o">)</span>
            <span class="tok-kd">throws</span> <span class="tok-n">BibliotecaException</span> <span class="tok-o">{</span>
        <span class="tok-k">if</span> <span class="tok-o">(</span><span class="tok-n">usuario</span> <span class="tok-k">instanceof</span> <span class="tok-n">Alumno</span><span class="tok-o">)</span>
            <span class="tok-k">return</span> <span class="tok-n">cupoOperacionesAlumno</span><span class="tok-o">;</span>
        <span class="tok-k">else</span> <span class="tok-nf">if</span> <span class="tok-o">(</span><span class="tok-n">usuario</span> <span class="tok-k">instanceof</span> <span class="tok-n">Profesor</span><span class="tok-o">)</span>
            <span class="tok-k">return</span> <span class="tok-n">cupoOperacionesProfesor</span><span class="tok-o">;</span>
        <span class="tok-k">else</span> <span class="tok-o">{</span>
            <span class="tok-n">String</span> <span class="tok-n">msg</span> <span class="tok-o">=</span> <span class="tok-s">&quot;Solo los alumnos y profesores pueden tener libros prestados&quot;</span><span class="tok-o">;</span>
            <span class="tok-n">logger</span><span class="tok-o">.</span><span class="tok-na">error</span><span class="tok-o">(</span><span class="tok-n">msg</span><span class="tok-o">);</span>
            <span class="tok-k">throw</span> <span class="tok-k">new</span> <span class="tok-nf">BibliotecaException</span><span class="tok-o">(</span><span class="tok-n">msg</span><span class="tok-o">);</span>
        <span class="tok-o">}</span>
    <span class="tok-o">}</span>

    <span class="tok-cm">/**</span>
<span class="tok-cm">     * Valida que el número de prestamos realizadas por un determinado</span>
<span class="tok-cm">     * tipo de usuario se inferior o igual al cupo definido</span>
<span class="tok-cm">     *</span>
<span class="tok-cm">     * @param usuario objeto Usuario</span>
<span class="tok-cm">     * @param numOp   número de operación que ya tiene realizadas</span>
<span class="tok-cm">     * @throws BibliotecaException el cupo de operacion esta lleno</span>
<span class="tok-cm">     * @throws BibliotecaException el tipo del usuario no es el esperado</span>
<span class="tok-cm">     */</span>
    <span class="tok-kd">public</span> <span class="tok-kt">void</span> <span class="tok-nf">compruebaCupoOperaciones</span><span class="tok-o">(</span><span class="tok-n">Usuario</span> <span class="tok-n">usuario</span><span class="tok-o">,</span> <span class="tok-kt">int</span> <span class="tok-n">numOp</span><span class="tok-o">)</span>
            <span class="tok-kd">throws</span> <span class="tok-n">BibliotecaException</span> <span class="tok-o">{</span>
        <span class="tok-n">String</span> <span class="tok-n">msg</span><span class="tok-o">;</span>
        <span class="tok-k">if</span> <span class="tok-o">(!(</span><span class="tok-n">usuario</span> <span class="tok-k">instanceof</span> <span class="tok-n">Alumno</span><span class="tok-o">)</span>
                <span class="tok-o">&amp;&amp;</span> <span class="tok-o">!(</span><span class="tok-n">usuario</span> <span class="tok-k">instanceof</span> <span class="tok-n">Profesor</span><span class="tok-o">))</span> <span class="tok-o">{</span>
            <span class="tok-n">msg</span> <span class="tok-o">=</span> <span class="tok-s">&quot;Solo los alumnos y profesores pueden tener libros prestados&quot;</span><span class="tok-o">;</span>
            <span class="tok-n">logger</span><span class="tok-o">.</span><span class="tok-na">error</span><span class="tok-o">(</span><span class="tok-n">msg</span><span class="tok-o">);</span>
            <span class="tok-k">throw</span> <span class="tok-k">new</span> <span class="tok-nf">BibliotecaException</span><span class="tok-o">(</span><span class="tok-n">msg</span><span class="tok-o">);</span>
        <span class="tok-o">}</span>
        <span class="tok-k">if</span> <span class="tok-o">((</span><span class="tok-n">usuario</span> <span class="tok-k">instanceof</span> <span class="tok-n">Alumno</span> <span class="tok-o">&amp;&amp;</span> <span class="tok-n">numOp</span> <span class="tok-o">&gt;</span>
                <span class="tok-n">cupoOperacionesAlumno</span><span class="tok-o">)</span> <span class="tok-o">||</span>
                <span class="tok-o">(</span><span class="tok-n">usuario</span> <span class="tok-k">instanceof</span> <span class="tok-n">Profesor</span> <span class="tok-o">&amp;&amp;</span> <span class="tok-n">numOp</span> <span class="tok-o">&gt;</span> <span class="tok-n">cupoOperacionesProfesor</span><span class="tok-o">))</span> <span class="tok-o">{</span>
            <span class="tok-n">msg</span> <span class="tok-o">=</span> <span class="tok-s">&quot;El cupo de operaciones posibles esta lleno&quot;</span><span class="tok-o">;</span>
            <span class="tok-n">logger</span><span class="tok-o">.</span><span class="tok-na">error</span><span class="tok-o">(</span><span class="tok-n">msg</span><span class="tok-o">);</span>
            <span class="tok-k">throw</span> <span class="tok-k">new</span> <span class="tok-nf">BibliotecaException</span><span class="tok-o">(</span><span class="tok-n">msg</span><span class="tok-o">);</span>
        <span class="tok-o">}</span>
    <span class="tok-o">}</span>

    <span class="tok-cm">/**</span>
<span class="tok-cm">     * Devuelve una fecha de devolución de un préstamo,</span>
<span class="tok-cm">     * sumando a la fecha del parámetro el número de días de préstamo</span>
<span class="tok-cm">     * del tipo de usuario</span>
<span class="tok-cm">     */</span>
    <span class="tok-kd">public</span> <span class="tok-n">Date</span> <span class="tok-nf">fechaDevolucionPrestamo</span><span class="tok-o">(</span><span class="tok-n">Usuario</span> <span class="tok-n">usuario</span><span class="tok-o">,</span> <span class="tok-n">Date</span> <span class="tok-n">fechaActual</span><span class="tok-o">)</span> <span class="tok-o">{</span>
        <span class="tok-k">return</span> <span class="tok-n">Utils</span><span class="tok-o">.</span><span class="tok-na">sumaDias</span><span class="tok-o">(</span><span class="tok-n">fechaActual</span><span class="tok-o">,</span> <span class="tok-k">this</span><span class="tok-o">.</span><span class="tok-na">calculaNumDiasPrestamo</span><span class="tok-o">(</span><span class="tok-n">usuario</span><span class="tok-o">));</span>
    <span class="tok-o">}</span>

    <span class="tok-cm">/**</span>
<span class="tok-cm">     * Devuelve los días de penalización de un préstamo retrasado</span>
<span class="tok-cm">     */</span>
    <span class="tok-kd">public</span> <span class="tok-kt">long</span> <span class="tok-nf">diasPenalizacion</span><span class="tok-o">(</span><span class="tok-n">Prestamo</span> <span class="tok-n">prestamo</span><span class="tok-o">)</span> <span class="tok-o">{</span>
        <span class="tok-k">return</span> <span class="tok-n">Utils</span><span class="tok-o">.</span><span class="tok-na">diferenciaDias</span><span class="tok-o">(</span><span class="tok-n">prestamo</span><span class="tok-o">.</span><span class="tok-na">getDeberiaDevolverseEl</span><span class="tok-o">(),</span> <span class="tok-n">prestamo</span><span class="tok-o">.</span><span class="tok-na">getDevuelto</span><span class="tok-o">());</span>
    <span class="tok-o">}</span>

    <span class="tok-cm">/**</span>
<span class="tok-cm">     * Comprobación de si un préstamo es moroso (está pendiente de devolver y ya ha</span>
<span class="tok-cm">     * pasado la fecha de devolución</span>
<span class="tok-cm">     */</span>

    <span class="tok-kd">public</span> <span class="tok-kt">boolean</span> <span class="tok-nf">esPrestamoActivo</span><span class="tok-o">(</span><span class="tok-n">Prestamo</span> <span class="tok-n">prestamo</span><span class="tok-o">)</span> <span class="tok-o">{</span>
        <span class="tok-k">return</span> <span class="tok-n">prestamo</span><span class="tok-o">.</span><span class="tok-na">getDevuelto</span><span class="tok-o">()</span> <span class="tok-o">==</span> <span class="tok-kc">null</span><span class="tok-o">;</span>
    <span class="tok-o">}</span>

    <span class="tok-kd">public</span> <span class="tok-kt">boolean</span> <span class="tok-nf">esPrestamoRetrasado</span><span class="tok-o">(</span><span class="tok-n">Prestamo</span> <span class="tok-n">prestamo</span><span class="tok-o">,</span> <span class="tok-n">Date</span> <span class="tok-n">fechaActual</span><span class="tok-o">)</span> <span class="tok-o">{</span>
        <span class="tok-k">return</span> <span class="tok-n">prestamo</span><span class="tok-o">.</span><span class="tok-na">getDeberiaDevolverseEl</span><span class="tok-o">().</span><span class="tok-na">before</span><span class="tok-o">(</span><span class="tok-n">fechaActual</span><span class="tok-o">);</span>
    <span class="tok-o">}</span>

    <span class="tok-kd">public</span> <span class="tok-kt">boolean</span> <span class="tok-nf">esPrestamoMoroso</span><span class="tok-o">(</span><span class="tok-n">Prestamo</span> <span class="tok-n">prestamo</span><span class="tok-o">,</span> <span class="tok-n">Date</span> <span class="tok-n">fechaActual</span><span class="tok-o">)</span> <span class="tok-o">{</span>
        <span class="tok-k">return</span> <span class="tok-k">this</span><span class="tok-o">.</span><span class="tok-na">esPrestamoActivo</span><span class="tok-o">(</span><span class="tok-n">prestamo</span><span class="tok-o">)</span> <span class="tok-o">&amp;&amp;</span> <span class="tok-k">this</span><span class="tok-o">.</span><span class="tok-na">esPrestamoRetrasado</span><span class="tok-o">(</span><span class="tok-n">prestamo</span><span class="tok-o">,</span> <span class="tok-n">fechaActual</span><span class="tok-o">);</span>
    <span class="tok-o">}</span>
<span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="sect4">
<h5 id="_ampliamos_los_tests">Ampliamos los tests</h5>
<div class="paragraph">
<p>Añadimos nuevos tests que comprueban el funcionamiento de algunas reglas de negocios.</p>
</div>
<div class="listingblock">
<div class="title">src/test/java/org/expertojava/jbibrest/modelo/BibliotecaBRTest.java</div>
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span class="tok-kn">package</span> <span class="tok-n">org</span><span class="tok-o">.</span><span class="tok-na">expertojava</span><span class="tok-o">.</span><span class="tok-na">jbibrest</span><span class="tok-o">.</span><span class="tok-na">modelo</span><span class="tok-o">;</span>

<span class="tok-kn">import</span> <span class="tok-nn">org.expertojava.jbibrest.utils.BibliotecaBR</span><span class="tok-o">;</span>
<span class="tok-kn">import</span> <span class="tok-nn">org.expertojava.jbibrest.utils.BibliotecaException</span><span class="tok-o">;</span>
<span class="tok-kn">import</span> <span class="tok-nn">org.expertojava.jbibrest.utils.Utils</span><span class="tok-o">;</span>
<span class="tok-kn">import</span> <span class="tok-nn">org.junit.Test</span><span class="tok-o">;</span>

<span class="tok-kn">import</span> <span class="tok-nn">java.sql.PreparedStatement</span><span class="tok-o">;</span>
<span class="tok-kn">import</span> <span class="tok-nn">java.text.ParseException</span><span class="tok-o">;</span>
<span class="tok-kn">import</span> <span class="tok-nn">java.text.SimpleDateFormat</span><span class="tok-o">;</span>
<span class="tok-kn">import</span> <span class="tok-nn">java.util.Date</span><span class="tok-o">;</span>

<span class="tok-kn">import</span> <span class="tok-nn">static</span> <span class="tok-n">org</span><span class="tok-o">.</span><span class="tok-na">junit</span><span class="tok-o">.</span><span class="tok-na">Assert</span><span class="tok-o">.*;</span>

<span class="tok-kd">public</span> <span class="tok-kd">class</span> <span class="tok-nc">BibliotecaBRTest</span> <span class="tok-o">{</span>

    <span class="tok-c1">//</span>
    <span class="tok-c1">// Profesor</span>
    <span class="tok-c1">//</span>

    <span class="tok-nd">@Test</span>
    <span class="tok-kd">public</span> <span class="tok-kt">void</span> <span class="tok-nf">compruebaNumDiasPrestamoProfesor</span><span class="tok-o">()</span> <span class="tok-o">{</span>
        <span class="tok-kt">int</span> <span class="tok-n">diasProfesor</span> <span class="tok-o">=</span> <span class="tok-n">BibliotecaBR</span><span class="tok-o">.</span><span class="tok-na">getInstance</span><span class="tok-o">()</span>
                <span class="tok-o">.</span><span class="tok-na">calculaNumDiasPrestamo</span><span class="tok-o">(</span>
                        <span class="tok-k">new</span> <span class="tok-nf">Profesor</span><span class="tok-o">(</span><span class="tok-s">&quot;alan.turing&quot;</span><span class="tok-o">));</span>
        <span class="tok-n">assertEquals</span><span class="tok-o">(</span><span class="tok-mi">30</span><span class="tok-o">,</span> <span class="tok-n">diasProfesor</span><span class="tok-o">);</span>
    <span class="tok-o">}</span>

    <span class="tok-nd">@Test</span>
    <span class="tok-kd">public</span> <span class="tok-kt">void</span> <span class="tok-nf">compruebaCupoOperacionesProfesor</span><span class="tok-o">()</span> <span class="tok-o">{</span>
        <span class="tok-kt">int</span> <span class="tok-n">cupoProfesor</span> <span class="tok-o">=</span> <span class="tok-n">BibliotecaBR</span><span class="tok-o">.</span><span class="tok-na">getInstance</span><span class="tok-o">().</span><span class="tok-na">cupoOperaciones</span><span class="tok-o">(</span>
                <span class="tok-k">new</span> <span class="tok-nf">Profesor</span><span class="tok-o">(</span><span class="tok-s">&quot;alan.turing&quot;</span><span class="tok-o">));</span>
        <span class="tok-n">assertEquals</span><span class="tok-o">(</span><span class="tok-n">cupoProfesor</span><span class="tok-o">,</span> <span class="tok-mi">8</span><span class="tok-o">);</span>
    <span class="tok-o">}</span>

    <span class="tok-nd">@Test</span>
    <span class="tok-kd">public</span> <span class="tok-kt">void</span> <span class="tok-nf">compruebaNoSaltaExcepcionCupoOperacionesProfesorCorrecto</span><span class="tok-o">()</span> <span class="tok-o">{</span>
        <span class="tok-k">try</span> <span class="tok-o">{</span>
            <span class="tok-n">Profesor</span> <span class="tok-n">profesor</span> <span class="tok-o">=</span>
                    <span class="tok-k">new</span> <span class="tok-nf">Profesor</span><span class="tok-o">(</span><span class="tok-s">&quot;alan.turing&quot;</span><span class="tok-o">);</span>
            <span class="tok-n">BibliotecaBR</span><span class="tok-o">.</span><span class="tok-na">getInstance</span><span class="tok-o">()</span>
                    <span class="tok-o">.</span><span class="tok-na">compruebaCupoOperaciones</span><span class="tok-o">(</span><span class="tok-n">profesor</span><span class="tok-o">,</span> <span class="tok-mi">8</span><span class="tok-o">);</span>
            <span class="tok-n">BibliotecaBR</span><span class="tok-o">.</span><span class="tok-na">getInstance</span><span class="tok-o">()</span>
                    <span class="tok-o">.</span><span class="tok-na">compruebaCupoOperaciones</span><span class="tok-o">(</span><span class="tok-n">profesor</span><span class="tok-o">,</span> <span class="tok-mi">1</span><span class="tok-o">);</span>
        <span class="tok-o">}</span> <span class="tok-k">catch</span> <span class="tok-o">(</span><span class="tok-n">BibliotecaException</span> <span class="tok-n">e</span><span class="tok-o">)</span> <span class="tok-o">{</span>
            <span class="tok-n">fail</span><span class="tok-o">(</span><span class="tok-s">&quot;No debería fallar - el cupo de operaciones del&quot;</span> <span class="tok-o">+</span>
                    <span class="tok-s">&quot; PROFESOR es correcto&quot;</span><span class="tok-o">);</span>
        <span class="tok-o">}</span>
    <span class="tok-o">}</span>

    <span class="tok-nd">@Test</span><span class="tok-o">(</span><span class="tok-n">expected</span> <span class="tok-o">=</span> <span class="tok-n">BibliotecaException</span><span class="tok-o">.</span><span class="tok-na">class</span><span class="tok-o">)</span>
    <span class="tok-kd">public</span> <span class="tok-kt">void</span> <span class="tok-nf">compruebaSaltaExcepcionCupoOperacionesProfesorIncorrecto</span><span class="tok-o">()</span>
            <span class="tok-kd">throws</span> <span class="tok-n">BibliotecaException</span> <span class="tok-o">{</span>
        <span class="tok-n">BibliotecaBR</span><span class="tok-o">.</span><span class="tok-na">getInstance</span><span class="tok-o">()</span>
                <span class="tok-o">.</span><span class="tok-na">compruebaCupoOperaciones</span><span class="tok-o">(</span>
                        <span class="tok-k">new</span> <span class="tok-nf">Profesor</span><span class="tok-o">(</span><span class="tok-s">&quot;alan.turing&quot;</span><span class="tok-o">),</span> <span class="tok-mi">9</span><span class="tok-o">);</span>
    <span class="tok-o">}</span>

    <span class="tok-c1">//</span>
    <span class="tok-c1">// Alumno</span>
    <span class="tok-c1">//</span>

    <span class="tok-nd">@Test</span>
    <span class="tok-kd">public</span> <span class="tok-kt">void</span> <span class="tok-nf">compruebaNumDiasPrestamoAlumno</span><span class="tok-o">()</span> <span class="tok-o">{</span>
        <span class="tok-kt">int</span> <span class="tok-n">diasAlumno</span> <span class="tok-o">=</span> <span class="tok-n">BibliotecaBR</span><span class="tok-o">.</span><span class="tok-na">getInstance</span><span class="tok-o">().</span><span class="tok-na">calculaNumDiasPrestamo</span><span class="tok-o">(</span>
                <span class="tok-k">new</span> <span class="tok-nf">Alumno</span><span class="tok-o">(</span><span class="tok-s">&quot;juan.perez&quot;</span><span class="tok-o">));</span>
        <span class="tok-n">assertEquals</span><span class="tok-o">(</span><span class="tok-mi">7</span><span class="tok-o">,</span> <span class="tok-n">diasAlumno</span><span class="tok-o">);</span>
    <span class="tok-o">}</span>

    <span class="tok-nd">@Test</span>
    <span class="tok-kd">public</span> <span class="tok-kt">void</span> <span class="tok-nf">compruebaCupoOperacionesAlumno</span><span class="tok-o">()</span> <span class="tok-o">{</span>
        <span class="tok-kt">int</span> <span class="tok-n">cupoAlumno</span> <span class="tok-o">=</span> <span class="tok-n">BibliotecaBR</span><span class="tok-o">.</span><span class="tok-na">getInstance</span><span class="tok-o">().</span><span class="tok-na">cupoOperaciones</span><span class="tok-o">(</span>
                <span class="tok-k">new</span> <span class="tok-nf">Alumno</span><span class="tok-o">(</span><span class="tok-s">&quot;juan.perez&quot;</span><span class="tok-o">));</span>
        <span class="tok-n">assertEquals</span><span class="tok-o">(</span><span class="tok-n">cupoAlumno</span><span class="tok-o">,</span> <span class="tok-mi">5</span><span class="tok-o">);</span>
    <span class="tok-o">}</span>

    <span class="tok-nd">@Test</span>
    <span class="tok-kd">public</span> <span class="tok-kt">void</span> <span class="tok-nf">compruebaNoSaltaExcpecionCupoOperacionesAlumnoCorrecto</span><span class="tok-o">()</span> <span class="tok-o">{</span>
        <span class="tok-k">try</span> <span class="tok-o">{</span>
            <span class="tok-n">Alumno</span> <span class="tok-n">alumno</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-nf">Alumno</span><span class="tok-o">(</span><span class="tok-s">&quot;juan.perez&quot;</span><span class="tok-o">);</span>
            <span class="tok-n">BibliotecaBR</span><span class="tok-o">.</span><span class="tok-na">getInstance</span><span class="tok-o">().</span><span class="tok-na">compruebaCupoOperaciones</span><span class="tok-o">(</span><span class="tok-n">alumno</span><span class="tok-o">,</span> <span class="tok-mi">5</span><span class="tok-o">);</span>
            <span class="tok-n">BibliotecaBR</span><span class="tok-o">.</span><span class="tok-na">getInstance</span><span class="tok-o">().</span><span class="tok-na">compruebaCupoOperaciones</span><span class="tok-o">(</span><span class="tok-n">alumno</span><span class="tok-o">,</span> <span class="tok-mi">1</span><span class="tok-o">);</span>
        <span class="tok-o">}</span> <span class="tok-k">catch</span> <span class="tok-o">(</span><span class="tok-n">BibliotecaException</span> <span class="tok-n">e</span><span class="tok-o">)</span> <span class="tok-o">{</span>
            <span class="tok-n">fail</span><span class="tok-o">(</span><span class="tok-s">&quot;No debería fallar - el cupo de operaciones del ALUMNO es correcto&quot;</span><span class="tok-o">);</span>
        <span class="tok-o">}</span>
    <span class="tok-o">}</span>

    <span class="tok-nd">@Test</span><span class="tok-o">(</span><span class="tok-n">expected</span> <span class="tok-o">=</span> <span class="tok-n">BibliotecaException</span><span class="tok-o">.</span><span class="tok-na">class</span><span class="tok-o">)</span>
    <span class="tok-kd">public</span> <span class="tok-kt">void</span> <span class="tok-nf">compruebaSaltaExcepcionCupoOperacionesAlumnoIncorrecto</span><span class="tok-o">()</span>
            <span class="tok-kd">throws</span> <span class="tok-n">BibliotecaException</span> <span class="tok-o">{</span>
        <span class="tok-n">BibliotecaBR</span><span class="tok-o">.</span><span class="tok-na">getInstance</span><span class="tok-o">().</span><span class="tok-na">compruebaCupoOperaciones</span><span class="tok-o">(</span><span class="tok-k">new</span> <span class="tok-nf">Alumno</span>
                <span class="tok-o">(</span><span class="tok-s">&quot;juan.perez&quot;</span><span class="tok-o">),</span> <span class="tok-mi">6</span><span class="tok-o">);</span>
    <span class="tok-o">}</span>

    <span class="tok-c1">//</span>
    <span class="tok-c1">// Test préstamos y fechas de devolución</span>
    <span class="tok-c1">// Los tienes que implementar</span>
    <span class="tok-c1">//</span>
    <span class="tok-c1">// @Test</span>
    <span class="tok-c1">// public void compruebaFechaDevolucionPrestamoEs7DiasMasTardeParaAlumno() {}</span>
    <span class="tok-c1">//</span>
    <span class="tok-c1">// @Test</span>
    <span class="tok-c1">// public void compruebaDiasPenalizacionPrestamoEsDiasDeRetrasoPrestamo() {}</span>
    <span class="tok-c1">//</span>
    <span class="tok-c1">// @Test</span>
    <span class="tok-c1">// public void compruebaPrestamoEsMorosoCuandoFechaFinalizacionPosteriorFechaDevolucion() {}</span>
    <span class="tok-c1">//</span>
    <span class="tok-c1">// private Prestamo creaPrestamo(Usuario usuario, String fechaInicioStr) {</span>
    <span class="tok-c1">//    Date fechaInicio = Utils.stringToDate(fechaInicioStr);</span>
    <span class="tok-c1">//    Date fechaDevolucion = BibliotecaBR.getInstance().fechaDevolucionPrestamo(usuario, fechaInicio);</span>
    <span class="tok-c1">//    Ejemplar ejemplar = new Ejemplar(&quot;0001&quot;, 1L);</span>
    <span class="tok-c1">//    Prestamo prestamo = new Prestamo(usuario, ejemplar, fechaInicio, fechaDevolucion);</span>
    <span class="tok-c1">//    return prestamo;</span>
    <span class="tok-c1">// }</span>
<span class="tok-o">}</span></code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_página_web_de_prueba">2.6.7. Página web de prueba</h4>
<div class="paragraph">
<p>Como último paso de esta parte guiada del proyecto vamos a cambiar la página frontal para probar la aplicación se despliega correctamente. Modificamos la página <code>index.jsp</code> para recoger una cadena de texto que simula un ISBN de un libro</p>
</div>
<div class="listingblock">
<div class="title">src/webapp/index.jsp</div>
<div class="content">
<pre class="pygments highlight"><code data-lang="html"><span class="tok-cp">&lt;!DOCTYPE HTML PUBLIC &quot;-//W3C//DTD HTML 4.0 Transitional//EN&quot;&gt;</span>
<span class="tok-nt">&lt;html&gt;</span>
    <span class="tok-nt">&lt;head&gt;</span>
        <span class="tok-nt">&lt;title&gt;</span>Start Page<span class="tok-nt">&lt;/title&gt;</span>
        <span class="tok-nt">&lt;meta</span> <span class="tok-na">http-equiv=</span><span class="tok-s">&quot;Content-Type&quot;</span> <span class="tok-na">content=</span><span class="tok-s">&quot;text/html; charset=UTF-8&quot;</span><span class="tok-nt">&gt;</span>
    <span class="tok-nt">&lt;/head&gt;</span>
    <span class="tok-nt">&lt;body&gt;</span>
        <span class="tok-nt">&lt;h1&gt;</span>Hello World!<span class="tok-nt">&lt;/h1&gt;</span>
        <span class="tok-nt">&lt;form</span> <span class="tok-na">action=</span><span class="tok-s">&quot;&lt;%=request.getContextPath()%&gt;/holamundo&quot;</span><span class="tok-nt">&gt;</span>
        <span class="tok-nt">&lt;p&gt;</span>ISBN: <span class="tok-nt">&lt;input</span> <span class="tok-na">type=</span><span class="tok-s">&quot;text&quot;</span> <span class="tok-na">name=</span><span class="tok-s">&quot;isbn&quot;</span><span class="tok-nt">&gt;&lt;/p&gt;</span>
        <span class="tok-nt">&lt;input</span> <span class="tok-na">type=</span><span class="tok-s">&quot;submit&quot;</span> <span class="tok-na">value=</span><span class="tok-s">&quot;Enviar&quot;</span><span class="tok-nt">&gt;</span>
        <span class="tok-nt">&lt;/form&gt;</span>
    <span class="tok-nt">&lt;/body&gt;</span>
<span class="tok-nt">&lt;/html&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Y cambiamos también el servlet <code>holamundo</code> para que haga una acción muy sencilla como crear un libro y mostrarlo:</p>
</div>
<div class="listingblock">
<div class="title">src/main/java/org/expertojava/jbibrest/servlets/HolaMundo.java</div>
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span class="tok-kn">package</span> <span class="tok-n">org</span><span class="tok-o">.</span><span class="tok-na">expertojava</span><span class="tok-o">.</span><span class="tok-na">jbibrest</span><span class="tok-o">.</span><span class="tok-na">servlets</span><span class="tok-o">;</span>


<span class="tok-kn">import</span> <span class="tok-nn">org.expertojava.jbibrest.modelo.Libro</span><span class="tok-o">;</span>

<span class="tok-kn">import</span> <span class="tok-nn">javax.servlet.ServletException</span><span class="tok-o">;</span>
<span class="tok-kn">import</span> <span class="tok-nn">javax.servlet.annotation.WebServlet</span><span class="tok-o">;</span>
<span class="tok-kn">import</span> <span class="tok-nn">javax.servlet.http.HttpServlet</span><span class="tok-o">;</span>
<span class="tok-kn">import</span> <span class="tok-nn">javax.servlet.http.HttpServletRequest</span><span class="tok-o">;</span>
<span class="tok-kn">import</span> <span class="tok-nn">javax.servlet.http.HttpServletResponse</span><span class="tok-o">;</span>
<span class="tok-kn">import</span> <span class="tok-nn">java.io.IOException</span><span class="tok-o">;</span>
<span class="tok-kn">import</span> <span class="tok-nn">java.io.PrintWriter</span><span class="tok-o">;</span>

<span class="tok-nd">@WebServlet</span><span class="tok-o">(</span><span class="tok-n">name</span><span class="tok-o">=</span><span class="tok-s">&quot;holamundo&quot;</span><span class="tok-o">,</span> <span class="tok-n">urlPatterns</span><span class="tok-o">=</span><span class="tok-s">&quot;/holamundo&quot;</span><span class="tok-o">)</span>
<span class="tok-kd">public</span> <span class="tok-kd">class</span> <span class="tok-nc">HolaMundo</span> <span class="tok-kd">extends</span> <span class="tok-n">HttpServlet</span> <span class="tok-o">{</span>


    <span class="tok-kd">protected</span> <span class="tok-kt">void</span> <span class="tok-nf">doPost</span><span class="tok-o">(</span><span class="tok-n">HttpServletRequest</span> <span class="tok-n">request</span><span class="tok-o">,</span>
                          <span class="tok-n">HttpServletResponse</span> <span class="tok-n">response</span><span class="tok-o">)</span>  <span class="tok-kd">throws</span>
            <span class="tok-n">ServletException</span><span class="tok-o">,</span> <span class="tok-n">IOException</span> <span class="tok-o">{</span>

    <span class="tok-o">}</span>

    <span class="tok-kd">protected</span> <span class="tok-kt">void</span> <span class="tok-nf">doGet</span><span class="tok-o">(</span><span class="tok-n">HttpServletRequest</span> <span class="tok-n">request</span><span class="tok-o">,</span>
                         <span class="tok-n">HttpServletResponse</span> <span class="tok-n">response</span><span class="tok-o">)</span> <span class="tok-kd">throws</span>
            <span class="tok-n">ServletException</span><span class="tok-o">,</span> <span class="tok-n">IOException</span> <span class="tok-o">{</span>
        <span class="tok-n">response</span><span class="tok-o">.</span><span class="tok-na">setContentType</span><span class="tok-o">(</span><span class="tok-s">&quot;text/html&quot;</span><span class="tok-o">);</span>
        <span class="tok-n">String</span> <span class="tok-n">isbnStr</span> <span class="tok-o">=</span> <span class="tok-n">request</span><span class="tok-o">.</span><span class="tok-na">getParameter</span><span class="tok-o">(</span><span class="tok-s">&quot;isbn&quot;</span><span class="tok-o">);</span>

        <span class="tok-c1">// Comprobamos entradas no nulas</span>

        <span class="tok-kt">int</span> <span class="tok-n">errorStatus</span> <span class="tok-o">=</span> <span class="tok-mi">0</span><span class="tok-o">;</span>
        <span class="tok-n">String</span> <span class="tok-n">errorMsg</span> <span class="tok-o">=</span> <span class="tok-s">&quot;&quot;</span><span class="tok-o">;</span>


        <span class="tok-k">if</span> <span class="tok-o">(</span><span class="tok-n">isbnStr</span> <span class="tok-o">==</span> <span class="tok-kc">null</span><span class="tok-o">)</span> <span class="tok-o">{</span>
            <span class="tok-n">errorStatus</span> <span class="tok-o">=</span> <span class="tok-n">HttpServletResponse</span><span class="tok-o">.</span><span class="tok-na">SC_BAD_REQUEST</span><span class="tok-o">;</span>
            <span class="tok-n">errorMsg</span> <span class="tok-o">=</span> <span class="tok-s">&quot;Faltan parámetros en la petición&quot;</span><span class="tok-o">;</span>
        <span class="tok-o">}</span>

        <span class="tok-k">if</span> <span class="tok-o">(</span><span class="tok-n">errorStatus</span> <span class="tok-o">==</span> <span class="tok-mi">0</span><span class="tok-o">)</span> <span class="tok-o">{</span>
            <span class="tok-c1">// Llamamos al modelo para construir la respuesta</span>
            <span class="tok-n">Libro</span> <span class="tok-n">libro</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-nf">Libro</span><span class="tok-o">(</span><span class="tok-n">isbnStr</span><span class="tok-o">);</span>
            <span class="tok-n">libro</span><span class="tok-o">.</span><span class="tok-na">setAutor</span><span class="tok-o">(</span><span class="tok-s">&quot;Kent Beck&quot;</span><span class="tok-o">);</span>
            <span class="tok-n">libro</span><span class="tok-o">.</span><span class="tok-na">setTitulo</span><span class="tok-o">(</span><span class="tok-s">&quot;Extreme Programming Explained&quot;</span><span class="tok-o">);</span>
            <span class="tok-n">PrintWriter</span> <span class="tok-n">out</span> <span class="tok-o">=</span> <span class="tok-n">response</span><span class="tok-o">.</span><span class="tok-na">getWriter</span><span class="tok-o">();</span>
            <span class="tok-n">out</span><span class="tok-o">.</span><span class="tok-na">println</span><span class="tok-o">(</span><span class="tok-s">&quot;&lt;!DOCTYPE HTML PUBLIC \&quot;&quot;</span> <span class="tok-o">+</span>
                    <span class="tok-s">&quot;-//W3C//DTD HTML 4.0 &quot;</span> <span class="tok-o">+</span>
                    <span class="tok-s">&quot;Transitional//EN\&quot;&gt;&quot;</span><span class="tok-o">);</span>
            <span class="tok-n">out</span><span class="tok-o">.</span><span class="tok-na">println</span><span class="tok-o">(</span><span class="tok-s">&quot;&lt;HTML&gt;&quot;</span><span class="tok-o">);</span>
            <span class="tok-n">out</span><span class="tok-o">.</span><span class="tok-na">println</span><span class="tok-o">(</span><span class="tok-s">&quot;&lt;BODY&gt;&quot;</span><span class="tok-o">);</span>
            <span class="tok-n">out</span><span class="tok-o">.</span><span class="tok-na">println</span><span class="tok-o">(</span><span class="tok-s">&quot;&lt;h1&gt;Creado un nuevo libro&lt;/h1&gt;&quot;</span><span class="tok-o">);</span>
            <span class="tok-n">out</span><span class="tok-o">.</span><span class="tok-na">println</span><span class="tok-o">(</span><span class="tok-s">&quot;&lt;p&gt;&quot;</span><span class="tok-o">);</span>
            <span class="tok-n">out</span><span class="tok-o">.</span><span class="tok-na">println</span><span class="tok-o">(</span><span class="tok-n">libro</span><span class="tok-o">.</span><span class="tok-na">toString</span><span class="tok-o">());</span>
            <span class="tok-n">out</span><span class="tok-o">.</span><span class="tok-na">println</span><span class="tok-o">(</span><span class="tok-s">&quot;&lt;/p&gt;&quot;</span><span class="tok-o">);</span>
            <span class="tok-n">out</span><span class="tok-o">.</span><span class="tok-na">println</span><span class="tok-o">(</span><span class="tok-s">&quot;&lt;/BODY&gt;&quot;</span><span class="tok-o">);</span>
            <span class="tok-n">out</span><span class="tok-o">.</span><span class="tok-na">println</span><span class="tok-o">(</span><span class="tok-s">&quot;&lt;/HTML&quot;</span><span class="tok-o">);</span>
        <span class="tok-o">}</span>
        <span class="tok-c1">// errorStatus &gt; 0</span>
        <span class="tok-k">else</span>  <span class="tok-o">{</span>
            <span class="tok-n">response</span><span class="tok-o">.</span><span class="tok-na">setStatus</span><span class="tok-o">(</span><span class="tok-n">errorStatus</span><span class="tok-o">);</span>
            <span class="tok-n">PrintWriter</span> <span class="tok-n">out</span> <span class="tok-o">=</span> <span class="tok-n">response</span><span class="tok-o">.</span><span class="tok-na">getWriter</span><span class="tok-o">();</span>
            <span class="tok-n">out</span><span class="tok-o">.</span><span class="tok-na">println</span><span class="tok-o">(</span><span class="tok-n">errorMsg</span><span class="tok-o">);</span>
        <span class="tok-o">}</span>
    <span class="tok-o">}</span>
<span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Con esto terminamos la parte guiada.</p>
</div>
<div class="paragraph">
<p>Los tests estarán funcionando correctamente y la página web de prueba deberá mostrar el libro creado correctamente. Puedes borrar las clases <code>Nombre</code>, <code>Genero</code> y <code>NombreTest</code> del principio de la clase.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_desarrollo_e_implementación_parte_no_guiada_1_punto">2.7. Desarrollo e implementación (parte no guiada, 1 punto)</h3>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Para terminar el ejercicio debes implementar el resto del modelo de dominio:</p>
<div class="ulist">
<ul>
<li>
<p>Completa el resto de clases del dominio, ampliando la clase <code>Usuario</code> con las nuevas entidades</p>
<div class="ulist">
<ul>
<li>
<p>Las relaciones <em>X-a-muchos</em> las definimos del tipo <code>Set</code>. De esta forma nos aseguramos que no existen objetos duplicados en las relaciones. La identidad en un conjunto se define con el método <code>equals</code> de sus elementos (definido anteriormente).</p>
</li>
</ul>
</div>
</li>
<li>
<p>Define la clase <code>Direccion</code> como una clase normal (no una subclase de <code>ClaseDomino</code>)</p>
</li>
</ul>
</div>
</li>
<li>
<p>Completa los tests de las clases y de <code>BibliotecaBR</code>.</p>
<div class="paragraph">
<p>En los tests de las clases de dominio debemos comprobar las relaciones de igualdad, errores de inicialización y algunas funcionalidades relacionadas con las reglas de negocio. Por ejemplo, a continuación puedes ver el test de la clase <code>Prestamo</code>:</p>
</div>
<div class="listingblock">
<div class="title">src/test/java/org/expertojava/jbibrest/modelo/UsuarioTest.java</div>
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span class="tok-kn">package</span> <span class="tok-n">org</span><span class="tok-o">.</span><span class="tok-na">expertojava</span><span class="tok-o">.</span><span class="tok-na">jbibrest</span><span class="tok-o">.</span><span class="tok-na">modelo</span><span class="tok-o">;</span>

<span class="tok-kn">import</span> <span class="tok-nn">javafx.scene.Parent</span><span class="tok-o">;</span>
<span class="tok-kn">import</span> <span class="tok-nn">org.apache.commons.logging.Log</span><span class="tok-o">;</span>
<span class="tok-kn">import</span> <span class="tok-nn">org.apache.commons.logging.LogFactory</span><span class="tok-o">;</span>
<span class="tok-kn">import</span> <span class="tok-nn">org.expertojava.jbibrest.utils.BibliotecaBR</span><span class="tok-o">;</span>
<span class="tok-kn">import</span> <span class="tok-nn">org.expertojava.jbibrest.utils.Utils</span><span class="tok-o">;</span>
<span class="tok-kn">import</span> <span class="tok-nn">org.junit.Test</span><span class="tok-o">;</span>

<span class="tok-kn">import</span> <span class="tok-nn">java.text.ParseException</span><span class="tok-o">;</span>
<span class="tok-kn">import</span> <span class="tok-nn">java.text.SimpleDateFormat</span><span class="tok-o">;</span>
<span class="tok-kn">import</span> <span class="tok-nn">java.util.Date</span><span class="tok-o">;</span>

<span class="tok-kn">import</span> <span class="tok-nn">static</span> <span class="tok-n">org</span><span class="tok-o">.</span><span class="tok-na">junit</span><span class="tok-o">.</span><span class="tok-na">Assert</span><span class="tok-o">.</span><span class="tok-na">assertEquals</span><span class="tok-o">;</span>
<span class="tok-kn">import</span> <span class="tok-nn">static</span> <span class="tok-n">org</span><span class="tok-o">.</span><span class="tok-na">junit</span><span class="tok-o">.</span><span class="tok-na">Assert</span><span class="tok-o">.</span><span class="tok-na">assertFalse</span><span class="tok-o">;</span>
<span class="tok-kn">import</span> <span class="tok-nn">static</span> <span class="tok-n">org</span><span class="tok-o">.</span><span class="tok-na">junit</span><span class="tok-o">.</span><span class="tok-na">Assert</span><span class="tok-o">.</span><span class="tok-na">assertTrue</span><span class="tok-o">;</span>

<span class="tok-kd">public</span> <span class="tok-kd">class</span> <span class="tok-nc">UsuarioTest</span> <span class="tok-o">{</span>

    <span class="tok-kd">private</span> <span class="tok-kd">static</span> <span class="tok-n">Log</span> <span class="tok-n">logger</span> <span class="tok-o">=</span> <span class="tok-n">LogFactory</span><span class="tok-o">.</span><span class="tok-na">getLog</span><span class="tok-o">(</span><span class="tok-n">UsuarioTest</span><span class="tok-o">.</span><span class="tok-na">class</span><span class="tok-o">);</span>

    <span class="tok-nd">@Test</span>
    <span class="tok-kd">public</span> <span class="tok-kt">void</span> <span class="tok-nf">compruebaEqualsDevuelveTrueConMismoId</span><span class="tok-o">()</span> <span class="tok-o">{</span>
        <span class="tok-n">Usuario</span> <span class="tok-n">usuario1</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-nf">Alumno</span><span class="tok-o">(</span><span class="tok-s">&quot;juan.perez&quot;</span><span class="tok-o">);</span>
        <span class="tok-n">Usuario</span> <span class="tok-n">usuario2</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-nf">Alumno</span><span class="tok-o">(</span><span class="tok-s">&quot;ana.garcia&quot;</span><span class="tok-o">);</span>
        <span class="tok-n">usuario1</span><span class="tok-o">.</span><span class="tok-na">setId</span><span class="tok-o">(</span><span class="tok-mi">1L</span><span class="tok-o">);</span>
        <span class="tok-n">usuario2</span><span class="tok-o">.</span><span class="tok-na">setId</span><span class="tok-o">(</span><span class="tok-mi">1L</span><span class="tok-o">);</span>
        <span class="tok-n">assertTrue</span><span class="tok-o">(</span><span class="tok-n">usuario1</span><span class="tok-o">.</span><span class="tok-na">equals</span><span class="tok-o">(</span><span class="tok-n">usuario2</span><span class="tok-o">));</span>
        <span class="tok-n">usuario2</span><span class="tok-o">.</span><span class="tok-na">setId</span><span class="tok-o">(</span><span class="tok-mi">2L</span><span class="tok-o">);</span>
        <span class="tok-n">assertFalse</span><span class="tok-o">(</span><span class="tok-n">usuario1</span><span class="tok-o">.</span><span class="tok-na">equals</span><span class="tok-o">(</span><span class="tok-n">usuario2</span><span class="tok-o">));</span>
    <span class="tok-o">}</span>

    <span class="tok-nd">@Test</span>
    <span class="tok-kd">public</span> <span class="tok-kt">void</span> <span class="tok-nf">compruebaEqualsDevuelveFalseConDistintoTipo</span><span class="tok-o">()</span> <span class="tok-o">{</span>
        <span class="tok-n">Usuario</span> <span class="tok-n">usuario1</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-nf">Alumno</span><span class="tok-o">(</span><span class="tok-s">&quot;juan.perez&quot;</span><span class="tok-o">);</span>
        <span class="tok-n">Usuario</span> <span class="tok-n">usuario2</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-nf">Profesor</span><span class="tok-o">(</span><span class="tok-s">&quot;alan.turing&quot;</span><span class="tok-o">);</span>
        <span class="tok-n">usuario1</span><span class="tok-o">.</span><span class="tok-na">setId</span><span class="tok-o">(</span><span class="tok-mi">1L</span><span class="tok-o">);</span>
        <span class="tok-n">usuario2</span><span class="tok-o">.</span><span class="tok-na">setId</span><span class="tok-o">(</span><span class="tok-mi">1L</span><span class="tok-o">);</span>
        <span class="tok-n">assertFalse</span><span class="tok-o">(</span><span class="tok-n">usuario1</span><span class="tok-o">.</span><span class="tok-na">equals</span><span class="tok-o">(</span><span class="tok-n">usuario2</span><span class="tok-o">));</span>
    <span class="tok-o">}</span>

    <span class="tok-nd">@Test</span>
    <span class="tok-kd">public</span> <span class="tok-kt">void</span> <span class="tok-nf">compruebaGetPrestamosDevolveColeccionVacia</span><span class="tok-o">()</span> <span class="tok-o">{</span>
        <span class="tok-n">Usuario</span> <span class="tok-n">usuario</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-nf">Profesor</span><span class="tok-o">(</span><span class="tok-s">&quot;alan.turing&quot;</span><span class="tok-o">);</span>
        <span class="tok-n">assertEquals</span><span class="tok-o">(</span><span class="tok-n">usuario</span><span class="tok-o">.</span><span class="tok-na">getPrestamos</span><span class="tok-o">().</span><span class="tok-na">size</span><span class="tok-o">(),</span> <span class="tok-mi">0</span><span class="tok-o">);</span>
    <span class="tok-o">}</span>

    <span class="tok-nd">@Test</span>
    <span class="tok-kd">public</span> <span class="tok-kt">void</span> <span class="tok-nf">compruebaUsuarioConMultaTieneEstadoMultado</span><span class="tok-o">()</span> <span class="tok-o">{</span>
        <span class="tok-n">Usuario</span> <span class="tok-n">usuario</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-nf">Alumno</span><span class="tok-o">(</span><span class="tok-s">&quot;juan.perez&quot;</span><span class="tok-o">);</span>
        <span class="tok-n">Date</span> <span class="tok-n">fechaActual</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-nf">Date</span><span class="tok-o">();</span>
        <span class="tok-n">assertTrue</span><span class="tok-o">(</span><span class="tok-n">usuario</span><span class="tok-o">.</span><span class="tok-na">getEstado</span><span class="tok-o">(</span><span class="tok-n">fechaActual</span><span class="tok-o">).</span><span class="tok-na">equals</span><span class="tok-o">(</span><span class="tok-n">EstadoUsuario</span><span class="tok-o">.</span><span class="tok-na">ACTIVO</span><span class="tok-o">));</span>
        <span class="tok-n">Date</span> <span class="tok-n">fechaFutura</span> <span class="tok-o">=</span> <span class="tok-n">BibliotecaBR</span><span class="tok-o">.</span><span class="tok-na">getInstance</span><span class="tok-o">().</span><span class="tok-na">fechaDevolucionPrestamo</span><span class="tok-o">(</span><span class="tok-n">usuario</span><span class="tok-o">,</span> <span class="tok-n">fechaActual</span><span class="tok-o">);</span>
        <span class="tok-n">Multa</span> <span class="tok-n">multa</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-nf">Multa</span><span class="tok-o">(</span><span class="tok-n">usuario</span><span class="tok-o">,</span> <span class="tok-n">fechaActual</span><span class="tok-o">,</span> <span class="tok-n">fechaFutura</span><span class="tok-o">);</span>
        <span class="tok-n">usuario</span><span class="tok-o">.</span><span class="tok-na">setMulta</span><span class="tok-o">(</span><span class="tok-n">multa</span><span class="tok-o">);</span>
        <span class="tok-n">assertTrue</span><span class="tok-o">(</span><span class="tok-n">usuario</span><span class="tok-o">.</span><span class="tok-na">getEstado</span><span class="tok-o">(</span><span class="tok-n">fechaActual</span><span class="tok-o">).</span><span class="tok-na">equals</span><span class="tok-o">(</span><span class="tok-n">EstadoUsuario</span><span class="tok-o">.</span><span class="tok-na">MULTADO</span><span class="tok-o">));</span>
    <span class="tok-o">}</span>

    <span class="tok-nd">@Test</span>
    <span class="tok-kd">public</span> <span class="tok-kt">void</span> <span class="tok-nf">compruebaUsuarioConPrestamoVencidoTieneEstadoMoroso</span><span class="tok-o">()</span> <span class="tok-o">{</span>
        <span class="tok-n">Usuario</span> <span class="tok-n">usuario</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-nf">Alumno</span><span class="tok-o">(</span><span class="tok-s">&quot;juan.perez&quot;</span><span class="tok-o">);</span>
        <span class="tok-n">Prestamo</span> <span class="tok-n">prestamo</span> <span class="tok-o">=</span> <span class="tok-n">creaPrestamo</span><span class="tok-o">(</span><span class="tok-n">usuario</span><span class="tok-o">,</span> <span class="tok-s">&quot;2015-10-01&quot;</span><span class="tok-o">);</span>
        <span class="tok-c1">// La fecha de devolución será 10-01 más 7 días -&gt; 2015-10-08</span>
        <span class="tok-n">usuario</span><span class="tok-o">.</span><span class="tok-na">getPrestamos</span><span class="tok-o">().</span><span class="tok-na">add</span><span class="tok-o">(</span><span class="tok-n">prestamo</span><span class="tok-o">);</span>
        <span class="tok-c1">// Fecha actual posterior a la de devolución</span>
        <span class="tok-n">Date</span> <span class="tok-n">fechaActual</span> <span class="tok-o">=</span> <span class="tok-n">Utils</span><span class="tok-o">.</span><span class="tok-na">stringToDate</span><span class="tok-o">(</span><span class="tok-s">&quot;2015-10-10&quot;</span><span class="tok-o">);</span>
        <span class="tok-n">assertTrue</span><span class="tok-o">(</span><span class="tok-n">usuario</span><span class="tok-o">.</span><span class="tok-na">getEstado</span><span class="tok-o">(</span><span class="tok-n">fechaActual</span><span class="tok-o">).</span><span class="tok-na">equals</span><span class="tok-o">(</span><span class="tok-n">EstadoUsuario</span><span class="tok-o">.</span><span class="tok-na">MOROSO</span><span class="tok-o">));</span>
    <span class="tok-o">}</span>

    <span class="tok-kd">private</span> <span class="tok-n">Prestamo</span> <span class="tok-nf">creaPrestamo</span><span class="tok-o">(</span><span class="tok-n">Usuario</span> <span class="tok-n">usuario</span><span class="tok-o">,</span> <span class="tok-n">String</span> <span class="tok-n">fechaInicioStr</span><span class="tok-o">)</span> <span class="tok-o">{</span>
        <span class="tok-n">Date</span> <span class="tok-n">fechaInicio</span> <span class="tok-o">=</span> <span class="tok-n">Utils</span><span class="tok-o">.</span><span class="tok-na">stringToDate</span><span class="tok-o">(</span><span class="tok-n">fechaInicioStr</span><span class="tok-o">);</span>
        <span class="tok-n">Date</span> <span class="tok-n">fechaDevolucion</span> <span class="tok-o">=</span> <span class="tok-n">BibliotecaBR</span><span class="tok-o">.</span><span class="tok-na">getInstance</span><span class="tok-o">().</span><span class="tok-na">fechaDevolucionPrestamo</span><span class="tok-o">(</span><span class="tok-n">usuario</span><span class="tok-o">,</span> <span class="tok-n">fechaInicio</span><span class="tok-o">);</span>
        <span class="tok-n">Ejemplar</span> <span class="tok-n">ejemplar</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-nf">Ejemplar</span><span class="tok-o">(</span><span class="tok-s">&quot;0001&quot;</span><span class="tok-o">,</span> <span class="tok-mi">1L</span><span class="tok-o">);</span>
        <span class="tok-n">Prestamo</span> <span class="tok-n">prestamo</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-nf">Prestamo</span><span class="tok-o">(</span><span class="tok-n">usuario</span><span class="tok-o">,</span> <span class="tok-n">ejemplar</span><span class="tok-o">,</span> <span class="tok-n">fechaInicio</span><span class="tok-o">,</span> <span class="tok-n">fechaDevolucion</span><span class="tok-o">);</span>
        <span class="tok-k">return</span> <span class="tok-n">prestamo</span><span class="tok-o">;</span>
    <span class="tok-o">}</span>
<span class="tok-o">}</span></code></pre>
</div>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<p>A continuación puedes ver una imagen de cómo queda el aspecto del panel del proyecto cuando hayas terminado el ejercicio:</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="images/proyint01/proyecto-final.png" alt="Proyecto final" width="33%">
</div>
</div>
</div>
</div>
</div>
</div>
<div id="footer">
<div id="footer-text">
Last updated 2015-10-16 07:47:33 CEST
</div>
</div>
</body>
</html>