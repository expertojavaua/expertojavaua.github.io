<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<!--[if IE]><meta http-equiv="X-UA-Compatible" content="IE=edge"><![endif]-->
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 1.5.2">
<meta name="author" content="MarÃ­a Isabel Alfonso Galipienso">
<title>Servicios Rest</title>
<style>/*! normalize.css v2.1.2 | MIT License | git.io/normalize */
/* ========================================================================== HTML5 display definitions ========================================================================== */
/** Correct `block` display not defined in IE 8/9. */
article, aside, details, figcaption, figure, footer, header, hgroup, main, nav, section, summary { display: block; }

/** Correct `inline-block` display not defined in IE 8/9. */
audio, canvas, video { display: inline-block; }

/** Prevent modern browsers from displaying `audio` without controls. Remove excess height in iOS 5 devices. */
audio:not([controls]) { display: none; height: 0; }

/** Address `[hidden]` styling not present in IE 8/9. Hide the `template` element in IE, Safari, and Firefox < 22. */
[hidden], template { display: none; }

script { display: none !important; }

/* ========================================================================== Base ========================================================================== */
/** 1. Set default font family to sans-serif. 2. Prevent iOS text size adjust after orientation change, without disabling user zoom. */
html { font-family: sans-serif; /* 1 */ -ms-text-size-adjust: 100%; /* 2 */ -webkit-text-size-adjust: 100%; /* 2 */ }

/** Remove default margin. */
body { margin: 0; }

/* ========================================================================== Links ========================================================================== */
/** Remove the gray background color from active links in IE 10. */
a { background: transparent; }

/** Address `outline` inconsistency between Chrome and other browsers. */
a:focus { outline: thin dotted; }

/** Improve readability when focused and also mouse hovered in all browsers. */
a:active, a:hover { outline: 0; }

/* ========================================================================== Typography ========================================================================== */
/** Address variable `h1` font-size and margin within `section` and `article` contexts in Firefox 4+, Safari 5, and Chrome. */
h1 { font-size: 2em; margin: 0.67em 0; }

/** Address styling not present in IE 8/9, Safari 5, and Chrome. */
abbr[title] { border-bottom: 1px dotted; }

/** Address style set to `bolder` in Firefox 4+, Safari 5, and Chrome. */
b, strong { font-weight: bold; }

/** Address styling not present in Safari 5 and Chrome. */
dfn { font-style: italic; }

/** Address differences between Firefox and other browsers. */
hr { -moz-box-sizing: content-box; box-sizing: content-box; height: 0; }

/** Address styling not present in IE 8/9. */
mark { background: #ff0; color: #000; }

/** Correct font family set oddly in Safari 5 and Chrome. */
code, kbd, pre, samp { font-family: monospace, serif; font-size: 1em; }

/** Improve readability of pre-formatted text in all browsers. */
pre { white-space: pre-wrap; }

/** Set consistent quote types. */
q { quotes: "\201C" "\201D" "\2018" "\2019"; }

/** Address inconsistent and variable font size in all browsers. */
small { font-size: 80%; }

/** Prevent `sub` and `sup` affecting `line-height` in all browsers. */
sub, sup { font-size: 75%; line-height: 0; position: relative; vertical-align: baseline; }

sup { top: -0.5em; }

sub { bottom: -0.25em; }

/* ========================================================================== Embedded content ========================================================================== */
/** Remove border when inside `a` element in IE 8/9. */
img { border: 0; }

/** Correct overflow displayed oddly in IE 9. */
svg:not(:root) { overflow: hidden; }

/* ========================================================================== Figures ========================================================================== */
/** Address margin not present in IE 8/9 and Safari 5. */
figure { margin: 0; }

/* ========================================================================== Forms ========================================================================== */
/** Define consistent border, margin, and padding. */
fieldset { border: 1px solid #c0c0c0; margin: 0 2px; padding: 0.35em 0.625em 0.75em; }

/** 1. Correct `color` not being inherited in IE 8/9. 2. Remove padding so people aren't caught out if they zero out fieldsets. */
legend { border: 0; /* 1 */ padding: 0; /* 2 */ }

/** 1. Correct font family not being inherited in all browsers. 2. Correct font size not being inherited in all browsers. 3. Address margins set differently in Firefox 4+, Safari 5, and Chrome. */
button, input, select, textarea { font-family: inherit; /* 1 */ font-size: 100%; /* 2 */ margin: 0; /* 3 */ }

/** Address Firefox 4+ setting `line-height` on `input` using `!important` in the UA stylesheet. */
button, input { line-height: normal; }

/** Address inconsistent `text-transform` inheritance for `button` and `select`. All other form control elements do not inherit `text-transform` values. Correct `button` style inheritance in Chrome, Safari 5+, and IE 8+. Correct `select` style inheritance in Firefox 4+ and Opera. */
button, select { text-transform: none; }

/** 1. Avoid the WebKit bug in Android 4.0.* where (2) destroys native `audio` and `video` controls. 2. Correct inability to style clickable `input` types in iOS. 3. Improve usability and consistency of cursor style between image-type `input` and others. */
button, html input[type="button"], input[type="reset"], input[type="submit"] { -webkit-appearance: button; /* 2 */ cursor: pointer; /* 3 */ }

/** Re-set default cursor for disabled elements. */
button[disabled], html input[disabled] { cursor: default; }

/** 1. Address box sizing set to `content-box` in IE 8/9. 2. Remove excess padding in IE 8/9. */
input[type="checkbox"], input[type="radio"] { box-sizing: border-box; /* 1 */ padding: 0; /* 2 */ }

/** 1. Address `appearance` set to `searchfield` in Safari 5 and Chrome. 2. Address `box-sizing` set to `border-box` in Safari 5 and Chrome (include `-moz` to future-proof). */
input[type="search"] { -webkit-appearance: textfield; /* 1 */ -moz-box-sizing: content-box; -webkit-box-sizing: content-box; /* 2 */ box-sizing: content-box; }

/** Remove inner padding and search cancel button in Safari 5 and Chrome on OS X. */
input[type="search"]::-webkit-search-cancel-button, input[type="search"]::-webkit-search-decoration { -webkit-appearance: none; }

/** Remove inner padding and border in Firefox 4+. */
button::-moz-focus-inner, input::-moz-focus-inner { border: 0; padding: 0; }

/** 1. Remove default vertical scrollbar in IE 8/9. 2. Improve readability and alignment in all browsers. */
textarea { overflow: auto; /* 1 */ vertical-align: top; /* 2 */ }

/* ========================================================================== Tables ========================================================================== */
/** Remove most spacing between table cells. */
table { border-collapse: collapse; border-spacing: 0; }

meta.foundation-mq-small { font-family: "only screen and (min-width: 768px)"; width: 768px; }

meta.foundation-mq-medium { font-family: "only screen and (min-width:1280px)"; width: 1280px; }

meta.foundation-mq-large { font-family: "only screen and (min-width:1440px)"; width: 1440px; }

*, *:before, *:after { -moz-box-sizing: border-box; -webkit-box-sizing: border-box; box-sizing: border-box; }

html, body { font-size: 97%; }

body { background: white; color: #222222; padding: 0; margin: 0; font-family: "Helvetica Neue", "Helvetica", Helvetica, Arial, sans-serif; font-weight: normal; font-style: normal; line-height: 1; position: relative; cursor: auto; }

a:hover { cursor: pointer; }

img, object, embed { max-width: 100%; height: auto; }

object, embed { height: 100%; }

img { -ms-interpolation-mode: bicubic; }

#map_canvas img, #map_canvas embed, #map_canvas object, .map_canvas img, .map_canvas embed, .map_canvas object { max-width: none !important; }

.left { float: left !important; }

.right { float: right !important; }

.text-left { text-align: left !important; }

.text-right { text-align: right !important; }

.text-center { text-align: center !important; }

.text-justify { text-align: justify !important; }

.hide { display: none; }

.antialiased, body { -webkit-font-smoothing: antialiased; }

img { display: inline-block; vertical-align: middle; }

textarea { height: auto; min-height: 50px; }

select { width: 100%; }

p.lead, .paragraph.lead > p, #preamble > .sectionbody > .paragraph:first-of-type p { font-size: 1.21875em; line-height: 1.6; }

.subheader, .admonitionblock td.content > .title, .audioblock > .title, .exampleblock > .title, .imageblock > .title, .listingblock > .title, .literalblock > .title, .stemblock > .title, .openblock > .title, .paragraph > .title, .quoteblock > .title, table.tableblock > .title, .verseblock > .title, .videoblock > .title, .dlist > .title, .olist > .title, .ulist > .title, .qlist > .title, .hdlist > .title { line-height: 1.4; color: #6f6f6f; font-weight: 300; margin-top: 0.2em; margin-bottom: 0.5em; }

/* Typography resets */
div, dl, dt, dd, ul, ol, li, h1, h2, h3, #toctitle, .sidebarblock > .content > .title, h4, h5, h6, pre, form, p, blockquote, th, td { margin: 0; padding: 0; direction: ltr; }

/* Default Link Styles */
a { color: #1164be; text-decoration: none; line-height: inherit; }
a img { border: none; }

/* Default paragraph styles */
p { font-family: inherit; font-weight: normal; font-size: 1em; line-height: 1.4; margin-bottom: 1em; text-rendering: optimizeLegibility; }
p aside { font-size: 0.875em; line-height: 1.35; font-style: italic; }

/* Default header styles */
h1, h2, h3, #toctitle, .sidebarblock > .content > .title, h4, h5, h6 { font-family: "Helvetica Neue", "Helvetica", Helvetica, Arial, sans-serif; font-weight: bold; font-style: normal; color: #1c355e; text-rendering: optimizeLegibility; margin-top: 1em; margin-bottom: 0.5em; line-height: 1.2125em; }
h1 small, h2 small, h3 small, #toctitle small, .sidebarblock > .content > .title small, h4 small, h5 small, h6 small { font-size: 60%; color: #6f6f6f; line-height: 0; }

h1 { font-size: 2.125em; }

h2 { font-size: 1.6875em; }

h3, #toctitle, .sidebarblock > .content > .title { font-size: 1.375em; }

h4 { font-size: 1.125em; }

h5 { font-size: 1.125em; }

h6 { font-size: 1em; }

hr { border: solid #dddddd; border-width: 1px 0 0; clear: both; margin: 1.25em 0 1.1875em; height: 0; }

/* Helpful Typography Defaults */
em, i { font-style: italic; line-height: inherit; }

strong, b { font-weight: bold; line-height: inherit; }

small { font-size: 60%; line-height: inherit; }

code { font-family: Consolas, "Liberation Mono", Courier, monospace; font-weight: bold; }

/* Lists */
ul, ol, dl { font-size: 1em; line-height: 1.4; margin-bottom: 1.25em; list-style-position: outside; font-family: inherit; }

ul, ol { margin-left: 2.5em; }
ul.no-bullet, ol.no-bullet { margin-left: 1.5em; }

/* Unordered Lists */
ul li ul, ul li ol { margin-left: 1.25em; margin-bottom: 0; font-size: 1em; /* Override nested font-size change */ }
ul.square li ul, ul.circle li ul, ul.disc li ul { list-style: inherit; }
ul.square { list-style-type: square; }
ul.circle { list-style-type: circle; }
ul.disc { list-style-type: disc; }
ul.no-bullet { list-style: none; }

/* Ordered Lists */
ol li ul, ol li ol { margin-left: 1.25em; margin-bottom: 0; }

/* Definition Lists */
dl dt { margin-bottom: 0.3125em; font-weight: bold; }
dl dd { margin-bottom: 1.25em; }

/* Abbreviations */
abbr, acronym { text-transform: uppercase; font-size: 90%; color: #222222; border-bottom: 1px dotted #dddddd; cursor: help; }

abbr { text-transform: none; }

/* Blockquotes */
blockquote { margin: 0 0 1.25em; padding: 0.5625em 1.25em 0 1.1875em; border-left: 1px solid #dddddd; }
blockquote cite { display: block; font-size: 0.8125em; color: #555555; }
blockquote cite:before { content: "\2014 \0020"; }
blockquote cite a, blockquote cite a:visited { color: #555555; }

blockquote, blockquote p { line-height: 1.6; color: #6f6f6f; }

/* Microformats */
.vcard { display: inline-block; margin: 0 0 1.25em 0; border: 1px solid #dddddd; padding: 0.625em 0.75em; }
.vcard li { margin: 0; display: block; }
.vcard .fn { font-weight: bold; font-size: 0.9375em; }

.vevent .summary { font-weight: bold; }
.vevent abbr { cursor: auto; text-decoration: none; font-weight: bold; border: none; padding: 0 0.0625em; }

/*@media only screen and (min-width: 768px) { h1, h2, h3, #toctitle, .sidebarblock > .content > .title, h4, h5, h6 { line-height: 1.4; }
  h1 { font-size: 2.75em; }
  h2 { font-size: 2.3125em; }
  h3, #toctitle, .sidebarblock > .content > .title { font-size: 1.6875em; }
  h4 { font-size: 1.4375em; } }*/
/* Tables */
table { background: white; margin-bottom: 1.25em; border: solid 1px #dddddd; }
table thead, table tfoot { background: whitesmoke; font-weight: bold; }
table thead tr th, table thead tr td, table tfoot tr th, table tfoot tr td { padding: 0.5em 0.625em 0.625em; font-size: inherit; color: #222222; text-align: left; }
table tr th, table tr td { padding: 0.5625em 0.625em; font-size: inherit; color: #222222; }
table tr.even, table tr.alt, table tr:nth-of-type(even) { background: #f9f9f9; }
table thead tr th, table tfoot tr th, table tbody tr td, table tr td, table tfoot tr td { display: table-cell; line-height: 1.4; }

h1, h2, h3, #toctitle, .sidebarblock > .content > .title, h4, h5, h6 { line-height: 1.4; border-bottom: 1px solid #dddddd }

.clearfix:before, .clearfix:after, .float-group:before, .float-group:after { content: " "; display: table; }
.clearfix:after, .float-group:after { clear: both; }

*:not(pre) > code { font-size: inherit; font-style: normal !important; letter-spacing: 0; padding: 3px 2px 1px 2px; background-color: #eeeeee; border: 1px solid #dddddd; -webkit-border-radius: 0; border-radius: 0; line-height: inherit; font-weight: normal; }

pre, pre > code { line-height: 1.4; color: black; font-family: monospace, serif; font-weight: normal; }

.keyseq { color: #555555; }

kbd { display: inline-block; color: #222222; font-size: 0.75em; line-height: 1.4; background-color: #f7f7f7; border: 1px solid #ccc; -webkit-border-radius: 3px; border-radius: 3px; -webkit-box-shadow: 0 1px 0 rgba(0, 0, 0, 0.2), 0 0 0 0.1em white inset; box-shadow: 0 1px 0 rgba(0, 0, 0, 0.2), 0 0 0 0.1em white inset; margin: -0.15em 0.15em 0 0.15em; padding: 0.2em 0.6em 0.2em 0.5em; vertical-align: middle; white-space: nowrap; }

.keyseq kbd:first-child { margin-left: 0; }

.keyseq kbd:last-child { margin-right: 0; }

.menuseq, .menu { color: #090909; }

b.button:before, b.button:after { position: relative; top: -1px; font-weight: normal; }

b.button:before { content: "["; padding: 0 3px 0 2px; }

b.button:after { content: "]"; padding: 0 2px 0 3px; }

#header, #content, #footnotes, #footer { width: 100%; margin-left: auto; margin-right: auto; margin-top: 0; margin-bottom: 0; max-width: 62.5em; *zoom: 1; position: relative; padding-left: 0.9375em; padding-right: 0.9375em; }
#header:before, #header:after, #content:before, #content:after, #footnotes:before, #footnotes:after, #footer:before, #footer:after { content: " "; display: table; }
#header:after, #content:after, #footnotes:after, #footer:after { clear: both; }

#content { margin-top: 1.25em; }

#content:before { content: none; }

#header > h1:first-child { color: black; margin-top: 2.25rem; margin-bottom: 0; }
#header > h1:first-child + #toc { margin-top: 8px; border-top: 1px solid #dddddd; }
#header > h1:only-child, body.toc2 #header > h1:nth-last-child(2) { border-bottom: 1px solid #dddddd; padding-bottom: 8px; }
#header .details { border-bottom: 1px solid #dddddd; line-height: 1.45; padding-top: 0.25em; padding-bottom: 0.25em; padding-left: 0.25em; color: #555555; display: -ms-flexbox; display: -webkit-flex; display: flex; -ms-flex-flow: row wrap; -webkit-flex-flow: row wrap; flex-flow: row wrap; }
#header .details span:first-child { margin-left: -0.125em; }
#header .details span.email a { color: #6f6f6f; }
#header .details br { display: none; }
#header .details br + span:before { content: "\00a0\2013\00a0"; }
#header .details br + span.author:before { content: "\00a0\22c5\00a0"; color: #6f6f6f; }
#header .details br + span#revremark:before { content: "\00a0|\00a0"; }
#header #revnumber { text-transform: capitalize; }
#header #revnumber:after { content: "\00a0"; }

#content > h1:first-child:not([class]) { color: black; border-bottom: 1px solid #dddddd; padding-bottom: 8px; margin-top: 0; padding-top: 1rem; margin-bottom: 1.25rem; }

#floating {
  position: fixed;
  z-index: 1000;
  padding: 0.5em;
  right: 0;
  top: 0;
  background: white;
  box-shadow: 0 0 1em #777777;
  -webkit-box-shadow: 0 0 1em #777777;
  -moz-box-shadow: 0 0 1em #777777;
  -webkit-border-bottom-left-radius: 5px;
  -moz-border-radius-bottomleft: 5px;
  max-height: 80%;
  overflow: auto;
}

#floating #full { display: none; } /* Hide the full TOC by default */

#floating:hover #full{
  display: block; /* Show it on hover */
}


#toc { border-bottom: 1px solid #dddddd; padding-bottom: 0.5em; }
#toc > ul { margin-left: 0.125em; }
#toc ul.sectlevel0 > li > a { font-style: italic; }
#toc ul.sectlevel0 ul.sectlevel1 { margin: 0.5em 0; }
#toc ul { font-family: "Helvetica Neue", "Helvetica", Helvetica, Arial, sans-serif; list-style-type: none; }
#toc a { text-decoration: none; }
#toc a:active { text-decoration: underline; }

#toctitle { color: #6f6f6f; font-size: 1.2em; }

@media only screen and (min-width: 768px) { #toctitle { font-size: 1.375em; }
  body.toc2 { padding-left: 15em; padding-right: 0; }
  #toc.toc2 { margin-top: 0 !important; background-color: #f2f2f2; position: fixed; width: 15em; left: 0; top: 0; border-right: 1px solid #dddddd; border-top-width: 0 !important; border-bottom-width: 0 !important; z-index: 1000; padding: 1.25em 1em; height: 100%; overflow: auto; }
  #toc.toc2 #toctitle { margin-top: 0; font-size: 1.2em; }
  #toc.toc2 > ul { font-size: 0.9em; margin-bottom: 0; }
  #toc.toc2 ul ul { margin-left: 0; padding-left: 1em; }
  #toc.toc2 ul.sectlevel0 ul.sectlevel1 { padding-left: 0; margin-top: 0.5em; margin-bottom: 0.5em; }
  body.toc2.toc-right { padding-left: 0; padding-right: 15em; }
  body.toc2.toc-right #toc.toc2 { border-right-width: 0; border-left: 1px solid #dddddd; left: auto; right: 0; } }
@media only screen and (min-width: 1280px) { body.toc2 { padding-left: 20em; padding-right: 0; }
  #toc.toc2 { width: 20em; }
  #toc.toc2 #toctitle { font-size: 1.375em; }
  #toc.toc2 > ul { font-size: 0.95em; }
  #toc.toc2 ul ul { padding-left: 1.25em; }
  body.toc2.toc-right { padding-left: 0; padding-right: 20em; } }
#content #toc { border-style: solid; border-width: 1px; border-color: #d9d9d9; margin-bottom: 1.25em; padding: 1.25em; background: #f2f2f2; -webkit-border-radius: 0; border-radius: 0; }
#content #toc > :first-child { margin-top: 0; }
#content #toc > :last-child { margin-bottom: 0; }

#footer { max-width: 100%; background-color: #222222; padding: 1.25em; }

#footer-text { color: #dddddd; line-height: 1.44; }

.sect1 { padding-bottom: 0.625em; }

@media only screen and (min-width: 768px) { .sect1 { padding-bottom: 1.25em; } }
.sect1 + .sect1 { border-top: 1px solid #dddddd; }

#content h1 > a.anchor, h2 > a.anchor, h3 > a.anchor, #toctitle > a.anchor, .sidebarblock > .content > .title > a.anchor, h4 > a.anchor, h5 > a.anchor, h6 > a.anchor { position: absolute; z-index: 1001; width: 1.5ex; margin-left: -1.5ex; display: block; text-decoration: none !important; visibility: hidden; text-align: center; font-weight: normal; }
#content h1 > a.anchor:before, h2 > a.anchor:before, h3 > a.anchor:before, #toctitle > a.anchor:before, .sidebarblock > .content > .title > a.anchor:before, h4 > a.anchor:before, h5 > a.anchor:before, h6 > a.anchor:before { content: "\00A7"; font-size: 0.85em; display: block; padding-top: 0.1em; }
#content h1:hover > a.anchor, #content h1 > a.anchor:hover, h2:hover > a.anchor, h2 > a.anchor:hover, h3:hover > a.anchor, #toctitle:hover > a.anchor, .sidebarblock > .content > .title:hover > a.anchor, h3 > a.anchor:hover, #toctitle > a.anchor:hover, .sidebarblock > .content > .title > a.anchor:hover, h4:hover > a.anchor, h4 > a.anchor:hover, h5:hover > a.anchor, h5 > a.anchor:hover, h6:hover > a.anchor, h6 > a.anchor:hover { visibility: visible; }
#content h1 > a.link, h2 > a.link, h3 > a.link, #toctitle > a.link, .sidebarblock > .content > .title > a.link, h4 > a.link, h5 > a.link, h6 > a.link { color: #222222; text-decoration: none; }
#content h1 > a.link:hover, h2 > a.link:hover, h3 > a.link:hover, #toctitle > a.link:hover, .sidebarblock > .content > .title > a.link:hover, h4 > a.link:hover, h5 > a.link:hover, h6 > a.link:hover { color: #151515; }

.audioblock, .imageblock, .literalblock, .listingblock, .stemblock, .videoblock { margin-bottom: 1.25em; }

.admonitionblock td.content > .title, .audioblock > .title, .exampleblock > .title, .imageblock > .title, .listingblock > .title, .literalblock > .title, .stemblock > .title, .openblock > .title, .paragraph > .title, .quoteblock > .title, table.tableblock > .title, .verseblock > .title, .videoblock > .title, .dlist > .title, .olist > .title, .ulist > .title, .qlist > .title, .hdlist > .title { text-rendering: optimizeLegibility; text-align: left; }

table.tableblock > caption.title { white-space: nowrap; overflow: visible; max-width: 0; }

.paragraph.lead > p, #preamble > .sectionbody > .paragraph:first-of-type p { color: black; }

table.tableblock #preamble > .sectionbody > .paragraph:first-of-type p { font-size: inherit; }

.admonitionblock > table { border-collapse: separate; border: 0; background: none; width: 100%; }
.admonitionblock > table td.icon { text-align: center; width: 80px; }
.admonitionblock > table td.icon img { max-width: none; }
.admonitionblock > table td.icon .title { font-weight: bold; font-family: "Helvetica Neue", "Helvetica", Helvetica, Arial, sans-serif; text-transform: uppercase; }
.admonitionblock > table td.content { padding-left: 1.125em; padding-right: 1.25em; border-left: 1px solid #dddddd; color: #555555; }
.admonitionblock > table td.content > :last-child > :last-child { margin-bottom: 0; }

.exampleblock > .content { border-style: solid; border-width: 1px; border-color: #e6e6e6; margin-bottom: 1.25em; padding: 1.25em; background: white; -webkit-border-radius: 0; border-radius: 0; }
.exampleblock > .content > :first-child { margin-top: 0; }
.exampleblock > .content > :last-child { margin-bottom: 0; }

.sidebarblock { border-style: solid; border-width: 1px; border-color: #d9d9d9; margin-bottom: 1.25em; padding: 1.25em; background: #f2f2f2; -webkit-border-radius: 0; border-radius: 0; }
.sidebarblock > :first-child { margin-top: 0; }
.sidebarblock > :last-child { margin-bottom: 0; }
.sidebarblock > .content > .title { color: #6f6f6f; margin-top: 0; }

.exampleblock > .content > :last-child > :last-child, .exampleblock > .content .olist > ol > li:last-child > :last-child, .exampleblock > .content .ulist > ul > li:last-child > :last-child, .exampleblock > .content .qlist > ol > li:last-child > :last-child, .sidebarblock > .content > :last-child > :last-child, .sidebarblock > .content .olist > ol > li:last-child > :last-child, .sidebarblock > .content .ulist > ul > li:last-child > :last-child, .sidebarblock > .content .qlist > ol > li:last-child > :last-child { margin-bottom: 0; }

.literalblock pre, .listingblock pre:not(.highlight), .listingblock pre[class="highlight"], .listingblock pre[class^="highlight "], .listingblock pre.CodeRay, .listingblock pre.prettyprint { background: #eeeeee; }
.sidebarblock .literalblock pre, .sidebarblock .listingblock pre:not(.highlight), .sidebarblock .listingblock pre[class="highlight"], .sidebarblock .listingblock pre[class^="highlight "], .sidebarblock .listingblock pre.CodeRay, .sidebarblock .listingblock pre.prettyprint { background: #f2f1f1; }

.literalblock pre, .literalblock pre[class], .listingblock pre, .listingblock pre[class] { border: 1px solid #cccccc; -webkit-border-radius: 0; border-radius: 0; word-wrap: break-word; padding: 0.8em 0.8em 0.65em 0.8em; font-size: 0.8125em; }
.literalblock pre.nowrap, .literalblock pre[class].nowrap, .listingblock pre.nowrap, .listingblock pre[class].nowrap { overflow-x: auto; white-space: pre; word-wrap: normal; }
@media only screen and (min-width: 768px) { .literalblock pre, .literalblock pre[class], .listingblock pre, .listingblock pre[class] { font-size: 0.90625em; } }
@media only screen and (min-width: 1280px) { .literalblock pre, .literalblock pre[class], .listingblock pre, .listingblock pre[class] { font-size: 1em; } }

.literalblock.output pre { color: #eeeeee; background-color: black; }

.listingblock pre.highlightjs { padding: 0; }
.listingblock pre.highlightjs > code { padding: 0.8em 0.8em 0.65em 0.8em; -webkit-border-radius: 0; border-radius: 0; }

.listingblock > .content { position: relative; }

.listingblock code[data-lang]:before { display: none; content: attr(data-lang); position: absolute; font-size: 0.75em; top: 0.425rem; right: 0.5rem; line-height: 1; text-transform: uppercase; color: #999; }

.listingblock:hover code[data-lang]:before { display: block; }

.listingblock.terminal pre .command:before { content: attr(data-prompt); padding-right: 0.5em; color: #999; }

.listingblock.terminal pre .command:not([data-prompt]):before { content: "$"; }

table.pyhltable { border-collapse: separate; border: 0; margin-bottom: 0; background: none; }

table.pyhltable td { vertical-align: top; padding-top: 0; padding-bottom: 0; }

table.pyhltable td.code { padding-left: .75em; padding-right: 0; }

pre.pygments .lineno, table.pyhltable td:not(.code) { color: #999; padding-left: 0; padding-right: .5em; border-right: 1px solid #dddddd; }

pre.pygments .lineno { display: inline-block; margin-right: .25em; }

table.pyhltable .linenodiv { background: none !important; padding-right: 0 !important; }

.quoteblock { margin: 0 1em 1.25em 1.5em; display: table; }
.quoteblock > .title { margin-left: -1.5em; margin-bottom: 0.75em; }
.quoteblock blockquote, .quoteblock blockquote p { color: #6f6f6f; font-size: 1.15rem; line-height: 1.75; word-spacing: 0.1em; letter-spacing: 0; font-style: italic; text-align: justify; }
.quoteblock blockquote { margin: 0; padding: 0; border: 0; }
.quoteblock blockquote:before { content: "\201c"; float: left; font-size: 2.75em; font-weight: bold; line-height: 0.6em; margin-left: -0.6em; color: #6f6f6f; text-shadow: 0 1px 2px rgba(0, 0, 0, 0.1); }
.quoteblock blockquote > .paragraph:last-child p { margin-bottom: 0; }
.quoteblock .attribution { margin-top: 0.5em; margin-right: 0.5ex; text-align: right; }
.quoteblock .quoteblock { margin-left: 0; margin-right: 0; padding: 0.5em 0; border-left: 3px solid #555555; }
.quoteblock .quoteblock blockquote { padding: 0 0 0 0.75em; }
.quoteblock .quoteblock blockquote:before { display: none; }

.verseblock { margin: 0 1em 1.25em 1em; }
.verseblock pre { font-family: "Open Sans", "DejaVu Sans", sans; font-size: 1.15rem; color: #6f6f6f; font-weight: 300; text-rendering: optimizeLegibility; }
.verseblock pre strong { font-weight: 400; }
.verseblock .attribution { margin-top: 1.25rem; margin-left: 0.5ex; }

.quoteblock .attribution, .verseblock .attribution { font-size: 0.8125em; line-height: 1.45; font-style: italic; }
.quoteblock .attribution br, .verseblock .attribution br { display: none; }
.quoteblock .attribution cite, .verseblock .attribution cite { display: block; letter-spacing: -0.05em; color: #555555; }

.quoteblock.abstract { margin: 0 0 1.25em 0; display: block; }
.quoteblock.abstract blockquote, .quoteblock.abstract blockquote p { text-align: left; word-spacing: 0; }
.quoteblock.abstract blockquote:before, .quoteblock.abstract blockquote p:first-of-type:before { display: none; }

table.tableblock { max-width: 100%; border-collapse: separate; }
table.tableblock td > .paragraph:last-child p > p:last-child, table.tableblock th > p:last-child, table.tableblock td > p:last-child { margin-bottom: 0; }

table.spread { width: 100%; }

table.tableblock, th.tableblock, td.tableblock { border: 0 solid #dddddd; }

table.grid-all th.tableblock, table.grid-all td.tableblock { border-width: 0 1px 1px 0; }

table.grid-all tfoot > tr > th.tableblock, table.grid-all tfoot > tr > td.tableblock { border-width: 1px 1px 0 0; }

table.grid-cols th.tableblock, table.grid-cols td.tableblock { border-width: 0 1px 0 0; }

table.grid-all * > tr > .tableblock:last-child, table.grid-cols * > tr > .tableblock:last-child { border-right-width: 0; }

table.grid-rows th.tableblock, table.grid-rows td.tableblock { border-width: 0 0 1px 0; }

table.grid-all tbody > tr:last-child > th.tableblock, table.grid-all tbody > tr:last-child > td.tableblock, table.grid-all thead:last-child > tr > th.tableblock, table.grid-rows tbody > tr:last-child > th.tableblock, table.grid-rows tbody > tr:last-child > td.tableblock, table.grid-rows thead:last-child > tr > th.tableblock { border-bottom-width: 0; }

table.grid-rows tfoot > tr > th.tableblock, table.grid-rows tfoot > tr > td.tableblock { border-width: 1px 0 0 0; }

table.frame-all { border-width: 1px; }

table.frame-sides { border-width: 0 1px; }

table.frame-topbot { border-width: 1px 0; }

th.halign-left, td.halign-left { text-align: left; }

th.halign-right, td.halign-right { text-align: right; }

th.halign-center, td.halign-center { text-align: center; }

th.valign-top, td.valign-top { vertical-align: top; }

th.valign-bottom, td.valign-bottom { vertical-align: bottom; }

th.valign-middle, td.valign-middle { vertical-align: middle; }

table thead th, table tfoot th { font-weight: bold; }

tbody tr th { display: table-cell; line-height: 1.4; background: whitesmoke; }

tbody tr th, tbody tr th p, tfoot tr th, tfoot tr th p { color: #222222; font-weight: bold; }

p.tableblock > code:only-child { background: none; padding: 0; }

p.tableblock { font-size: 1em; }

td > div.verse { white-space: pre; }

ol { margin-left: 2.5em; }

ul li ol { margin-left: 1.5em; }

dl dd { margin-left: 1.125em; }

dl dd:last-child, dl dd:last-child > :last-child { margin-bottom: 0; }

ol > li p, ul > li p, ul dd, ol dd, .olist .olist, .ulist .ulist, .ulist .olist, .olist .ulist { margin-bottom: 0.625em; }

ul.unstyled, ol.unnumbered, ul.checklist, ul.none { list-style-type: none; }

ul.unstyled, ol.unnumbered, ul.checklist { margin-left: 0.625em; }

ul.checklist li > p:first-child > .fa-check-square-o:first-child, ul.checklist li > p:first-child > input[type="checkbox"]:first-child { margin-right: 0.25em; }

ul.checklist li > p:first-child > input[type="checkbox"]:first-child { position: relative; top: 1px; }

ul.inline { margin: 0 auto 0.625em auto; margin-left: -1.375em; margin-right: 0; padding: 0; list-style: none; overflow: hidden; }
ul.inline > li { list-style: none; float: left; margin-left: 1.375em; display: block; }
ul.inline > li > * { display: block; }

.unstyled dl dt { font-weight: normal; font-style: normal; }

ol.arabic { list-style-type: decimal; }

ol.decimal { list-style-type: decimal-leading-zero; }

ol.loweralpha { list-style-type: lower-alpha; }

ol.upperalpha { list-style-type: upper-alpha; }

ol.lowerroman { list-style-type: lower-roman; }

ol.upperroman { list-style-type: upper-roman; }

ol.lowergreek { list-style-type: lower-greek; }

.hdlist > table, .colist > table { border: 0; background: none; }
.hdlist > table > tbody > tr, .colist > table > tbody > tr { background: none; }

td.hdlist1 { padding-right: .75em; font-weight: bold; }

td.hdlist1, td.hdlist2 { vertical-align: top; }

.literalblock + .colist, .listingblock + .colist { margin-top: -0.5em; }

.colist > table tr > td:first-of-type { padding: 0 0.75em; line-height: 1; }
.colist > table tr > td:last-of-type { padding: 0.25em 0; }

.thumb, .th { line-height: 0; display: inline-block; border: solid 4px white; -webkit-box-shadow: 0 0 0 1px #dddddd; box-shadow: 0 0 0 1px #dddddd; }

.imageblock.left, .imageblock[style*="float: left"] { margin: 0.25em 0.625em 1.25em 0; }
.imageblock.right, .imageblock[style*="float: right"] { margin: 0.25em 0 1.25em 0.625em; }
.imageblock > .title { margin-bottom: 0; }
.imageblock.thumb, .imageblock.th { border-width: 6px; }
.imageblock.thumb > .title, .imageblock.th > .title { padding: 0 0.125em; }

.image.left, .image.right { margin-top: 0.25em; margin-bottom: 0.25em; display: inline-block; line-height: 0; }
.image.left { margin-right: 0.625em; }
.image.right { margin-left: 0.625em; }

a.image { text-decoration: none; }

span.footnote, span.footnoteref { vertical-align: super; font-size: 0.875em; }
span.footnote a, span.footnoteref a { text-decoration: none; }
span.footnote a:active, span.footnoteref a:active { text-decoration: underline; }

#footnotes { padding-top: 0.75em; padding-bottom: 0.75em; margin-bottom: 0.625em; }
#footnotes hr { width: 20%; min-width: 6.25em; margin: -.25em 0 .75em 0; border-width: 1px 0 0 0; }
#footnotes .footnote { padding: 0 0.375em; line-height: 1.3; font-size: 0.875em; margin-left: 1.2em; text-indent: -1.2em; margin-bottom: .2em; }
#footnotes .footnote a:first-of-type { font-weight: bold; text-decoration: none; }
#footnotes .footnote:last-of-type { margin-bottom: 0; }

#content #footnotes { margin-top: -0.625em; margin-bottom: 0; padding: 0.75em 0; }

.gist .file-data > table { border: 0; background: #fff; width: 100%; margin-bottom: 0; }
.gist .file-data > table td.line-data { width: 99%; }

div.unbreakable { page-break-inside: avoid; }

.big { font-size: larger; }

.small { font-size: smaller; }

.underline { text-decoration: underline; }

.overline { text-decoration: overline; }

.line-through { text-decoration: line-through; }

.aqua { color: #00bfbf; }

.aqua-background { background-color: #00fafa; }

.black { color: black; }

.black-background { background-color: black; }

.blue { color: #0000bf; }

.blue-background { background-color: #0000fa; }

.fuchsia { color: #bf00bf; }

.fuchsia-background { background-color: #fa00fa; }

.gray { color: #606060; }

.gray-background { background-color: #7d7d7d; }

.green { color: #006000; }

.green-background { background-color: #007d00; }

.lime { color: #00bf00; }

.lime-background { background-color: #00fa00; }

.maroon { color: #600000; }

.maroon-background { background-color: #7d0000; }

.navy { color: #000060; }

.navy-background { background-color: #00007d; }

.olive { color: #606000; }

.olive-background { background-color: #7d7d00; }

.purple { color: #600060; }

.purple-background { background-color: #7d007d; }

.red { color: #bf0000; }

.red-background { background-color: #fa0000; }

.silver { color: #909090; }

.silver-background { background-color: #bcbcbc; }

.teal { color: #006060; }

.teal-background { background-color: #007d7d; }

.white { color: #bfbfbf; }

.white-background { background-color: #fafafa; }

.yellow { color: #bfbf00; }

.yellow-background { background-color: #fafa00; }

span.icon > .fa { cursor: default; }

.admonitionblock td.icon [class^="fa icon-"] { font-size: 2.5em; text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.5); cursor: default; }
.admonitionblock td.icon .icon-note:before { content: "\f05a"; color: #207c98; }
.admonitionblock td.icon .icon-tip:before { content: "\f0eb"; text-shadow: 1px 1px 2px rgba(155, 155, 0, 0.8); color: #111; }
.admonitionblock td.icon .icon-warning:before { content: "\f071"; color: #bf6900; }
.admonitionblock td.icon .icon-caution:before { content: "\f06d"; color: #bf3400; }
.admonitionblock td.icon .icon-important:before { content: "\f06a"; color: #bf0000; }

.conum[data-value] { display: inline-block; color: #fff !important; background-color: #222222; -webkit-border-radius: 100px; border-radius: 100px; text-align: center; font-size: 0.75em; width: 1.67em; height: 1.67em; line-height: 1.67em; font-family: "Open Sans", "DejaVu Sans", sans-serif; font-style: normal; font-weight: bold; }
.conum[data-value] * { color: #fff !important; }
.conum[data-value] + b { display: none; }
.conum[data-value]:after { content: attr(data-value); }
pre .conum[data-value] { position: relative; top: -0.125em; }

b.conum * { color: inherit !important; }

.conum:not([data-value]):empty { display: none; }

.literalblock pre, .listingblock pre { background: #eeeeee; }

</style>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.2.0/css/font-awesome.min.css">
<style>.listingblock .pygments .hll { background-color: #ffffcc }
.listingblock .pygments  { background: #f8f8f8; }
.listingblock .pygments .tok-c { color: #408080; font-style: italic } /* Comment */
.listingblock .pygments .tok-err { border: 1px solid #FF0000 } /* Error */
.listingblock .pygments .tok-k { color: #008000; font-weight: bold } /* Keyword */
.listingblock .pygments .tok-o { color: #666666 } /* Operator */
.listingblock .pygments .tok-cm { color: #408080; font-style: italic } /* Comment.Multiline */
.listingblock .pygments .tok-cp { color: #BC7A00 } /* Comment.Preproc */
.listingblock .pygments .tok-c1 { color: #408080; font-style: italic } /* Comment.Single */
.listingblock .pygments .tok-cs { color: #408080; font-style: italic } /* Comment.Special */
.listingblock .pygments .tok-gd { color: #A00000 } /* Generic.Deleted */
.listingblock .pygments .tok-ge { font-style: italic } /* Generic.Emph */
.listingblock .pygments .tok-gr { color: #FF0000 } /* Generic.Error */
.listingblock .pygments .tok-gh { color: #000080; font-weight: bold } /* Generic.Heading */
.listingblock .pygments .tok-gi { color: #00A000 } /* Generic.Inserted */
.listingblock .pygments .tok-go { color: #888888 } /* Generic.Output */
.listingblock .pygments .tok-gp { color: #000080; font-weight: bold } /* Generic.Prompt */
.listingblock .pygments .tok-gs { font-weight: bold } /* Generic.Strong */
.listingblock .pygments .tok-gu { color: #800080; font-weight: bold } /* Generic.Subheading */
.listingblock .pygments .tok-gt { color: #0044DD } /* Generic.Traceback */
.listingblock .pygments .tok-kc { color: #008000; font-weight: bold } /* Keyword.Constant */
.listingblock .pygments .tok-kd { color: #008000; font-weight: bold } /* Keyword.Declaration */
.listingblock .pygments .tok-kn { color: #008000; font-weight: bold } /* Keyword.Namespace */
.listingblock .pygments .tok-kp { color: #008000 } /* Keyword.Pseudo */
.listingblock .pygments .tok-kr { color: #008000; font-weight: bold } /* Keyword.Reserved */
.listingblock .pygments .tok-kt { color: #B00040 } /* Keyword.Type */
.listingblock .pygments .tok-m { color: #666666 } /* Literal.Number */
.listingblock .pygments .tok-s { color: #BA2121 } /* Literal.String */
.listingblock .pygments .tok-na { color: #7D9029 } /* Name.Attribute */
.listingblock .pygments .tok-nb { color: #008000 } /* Name.Builtin */
.listingblock .pygments .tok-nc { color: #0000FF; font-weight: bold } /* Name.Class */
.listingblock .pygments .tok-no { color: #880000 } /* Name.Constant */
.listingblock .pygments .tok-nd { color: #AA22FF } /* Name.Decorator */
.listingblock .pygments .tok-ni { color: #999999; font-weight: bold } /* Name.Entity */
.listingblock .pygments .tok-ne { color: #D2413A; font-weight: bold } /* Name.Exception */
.listingblock .pygments .tok-nf { color: #0000FF } /* Name.Function */
.listingblock .pygments .tok-nl { color: #A0A000 } /* Name.Label */
.listingblock .pygments .tok-nn { color: #0000FF; font-weight: bold } /* Name.Namespace */
.listingblock .pygments .tok-nt { color: #008000; font-weight: bold } /* Name.Tag */
.listingblock .pygments .tok-nv { color: #19177C } /* Name.Variable */
.listingblock .pygments .tok-ow { color: #AA22FF; font-weight: bold } /* Operator.Word */
.listingblock .pygments .tok-w { color: #bbbbbb } /* Text.Whitespace */
.listingblock .pygments .tok-mb { color: #666666 } /* Literal.Number.Bin */
.listingblock .pygments .tok-mf { color: #666666 } /* Literal.Number.Float */
.listingblock .pygments .tok-mh { color: #666666 } /* Literal.Number.Hex */
.listingblock .pygments .tok-mi { color: #666666 } /* Literal.Number.Integer */
.listingblock .pygments .tok-mo { color: #666666 } /* Literal.Number.Oct */
.listingblock .pygments .tok-sb { color: #BA2121 } /* Literal.String.Backtick */
.listingblock .pygments .tok-sc { color: #BA2121 } /* Literal.String.Char */
.listingblock .pygments .tok-sd { color: #BA2121; font-style: italic } /* Literal.String.Doc */
.listingblock .pygments .tok-s2 { color: #BA2121 } /* Literal.String.Double */
.listingblock .pygments .tok-se { color: #BB6622; font-weight: bold } /* Literal.String.Escape */
.listingblock .pygments .tok-sh { color: #BA2121 } /* Literal.String.Heredoc */
.listingblock .pygments .tok-si { color: #BB6688; font-weight: bold } /* Literal.String.Interpol */
.listingblock .pygments .tok-sx { color: #008000 } /* Literal.String.Other */
.listingblock .pygments .tok-sr { color: #BB6688 } /* Literal.String.Regex */
.listingblock .pygments .tok-s1 { color: #BA2121 } /* Literal.String.Single */
.listingblock .pygments .tok-ss { color: #19177C } /* Literal.String.Symbol */
.listingblock .pygments .tok-bp { color: #008000 } /* Name.Builtin.Pseudo */
.listingblock .pygments .tok-vc { color: #19177C } /* Name.Variable.Class */
.listingblock .pygments .tok-vg { color: #19177C } /* Name.Variable.Global */
.listingblock .pygments .tok-vi { color: #19177C } /* Name.Variable.Instance */
.listingblock .pygments .tok-il { color: #666666 } /* Literal.Number.Integer.Long */
</style>
</head>
<body class="article toc2 toc-left">
<div id="header">
<h1>Servicios Rest</h1>
<div class="details">
<span id="author" class="author">MarÃ­a Isabel Alfonso Galipienso</span><br>
<span id="email" class="email">&lt;<a href="mailto:eli@ua.es">eli@ua.es</a>&gt;</span><br>
</div>
<div id="toc" class="toc2">
<div id="toctitle">Ãndice de contenidos</div>
<ul class="sectlevel1">
<li><a href="#sesion01">1. IntroducciÃ³n a REST. DiseÃ±o y creaciÃ³n de servicios RESTful</a>
<ul class="sectlevel2">
<li><a href="#__qu%C3%A9_es_un_servicio_web">1.1. Â¿QuÃ© es un servicio Web?</a>
<ul class="sectlevel3">
<li><a href="#_servicios_web_restful">1.1.1. Servicios Web RESTful</a></li>
</ul>
</li>
<li><a href="#_fundamentos_de_rest">1.2. Fundamentos de REST</a>
<ul class="sectlevel3">
<li><a href="#_recursos">1.2.1. Recursos</a></li>
<li><a href="#_representaci%C3%B3n_de_los_recursos">1.2.2. RepresentaciÃ³n de los recursos</a></li>
<li><a href="#_direccionabilidad_de_los_recursos_uri">1.2.3. Direccionabilidad de los recursos: URI</a></li>
<li><a href="#_uniformidad_y_restricciones_de_las_interfaces">1.2.4. Uniformidad y restricciones de las interfaces</a></li>
</ul>
</li>
<li><a href="#_dise%C3%B1o_de_servicios_web_restful">1.3. DiseÃ±o de servicios Web RESTful</a></li>
<li><a href="#_un_primer_servicio_jax_rs">1.4. Un primer servicio JAX-RS</a>
<ul class="sectlevel3">
<li><a href="#_modelo_de_objetos">1.4.1. Modelo de objetos</a></li>
<li><a href="#_modelado_de_uris">1.4.2. Modelado de URIs</a></li>
<li><a href="#_definici%C3%B3n_del_formato_de_datos">1.4.3. DefiniciÃ³n del formato de datos</a></li>
<li><a href="#_asignaci%C3%B3n_de_m%C3%A9todos_http">1.4.4. AsignaciÃ³n de mÃ©todos HTTP</a></li>
<li><a href="#_implementaci%C3%B3n_del_servicio_creaci%C3%B3n_del_proyecto_maven">1.4.5. ImplementaciÃ³n del servicio: CreaciÃ³n del proyecto Maven</a></li>
<li><a href="#_implementaci%C3%B3n_del_servicio_recursos_jax_rs">1.4.6. ImplementaciÃ³n del servicio: Recursos JAX-RS</a></li>
<li><a href="#_construcci%C3%B3n_y_despliegue_del_servicio">1.4.7. ConstrucciÃ³n y despliegue del servicio</a></li>
<li><a href="#_probando_nuestro_servicio">1.4.8. Probando nuestro servicio</a></li>
</ul>
</li>
<li><a href="#_ejercicios">1.5. Ejercicios</a>
<ul class="sectlevel3">
<li><a href="#_servicio_rest_ejemplo_0_puntos">1.5.1. Servicio REST ejemplo (0 puntos)</a></li>
<li><a href="#_servicio_rest_saludo_1_punto">1.5.2. Servicio REST saludo (1 punto)</a></li>
<li><a href="#_servicio_rest_foro_1_punto">1.5.3. Servicio REST foro (1 punto)</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#sesion02">2. Anotaciones bÃ¡sicas JAX-RS. El modelo de despliegue.</a>
<ul class="sectlevel2">
<li><a href="#__c%C3%B3mo_funciona_el_enlazado_de_m%C3%A9todos_http">2.1. Â¿CÃ³mo funciona el enlazado de mÃ©todos HTTP?</a></li>
<li><a href="#_la_anotaci%C3%B3n_path">2.2. La anotaciÃ³n @Path</a>
<ul class="sectlevel3">
<li><a href="#_expresiones_path">2.2.1. Expresiones @Path</a></li>
<li><a href="#_par%C3%A1metros_em_matrix_em_em_matrix_parameters_em">2.2.2. ParÃ¡metros <em>matrix</em> (<em>Matrix parameters</em>)</a></li>
<li><a href="#_subrecursos_em_subresource_locators_em">2.2.3. Subrecursos (<em>Subresource Locators</em>)</a></li>
</ul>
</li>
<li><a href="#_usos_de_las_anotaciones_produces_y_consumes">2.3. Usos de las anotaciones @Produces y @Consumes</a>
<ul class="sectlevel3">
<li><a href="#_anotaci%C3%B3n_consumes">2.3.1. AnotaciÃ³n @Consumes</a></li>
<li><a href="#_anotaci%C3%B3n_produces">2.3.2. AnotaciÃ³n @Produces</a></li>
</ul>
</li>
<li><a href="#_inyecci%C3%B3n_de_par%C3%A1metros_jax_rs">2.4. InyecciÃ³n de parÃ¡metros JAX-RS</a>
<ul class="sectlevel3">
<li><a href="#__javax_ws_rs_pathparam">2.4.1. @javax.ws.rs.PathParam</a></li>
<li><a href="#_interfaz_uriinfo">2.4.2. Interfaz UriInfo</a></li>
<li><a href="#__javax_ws_rs_matrixparam">2.4.3. @javax.ws.rs.MatrixParam</a></li>
<li><a href="#__javax_ws_rs_queryparam">2.4.4. @javax.ws.rs.QueryParam</a></li>
<li><a href="#__javax_ws_rs_formparam">2.4.5. @javax.ws.rs.FormParam</a></li>
<li><a href="#__javax_ws_rs_headerparam">2.4.6. @javax.ws.rs.HeaderParam</a></li>
<li><a href="#__javax_ws_rs_core_context">2.4.7. @javax.ws.rs.core.Context</a></li>
<li><a href="#__javax_ws_rs_beanparam">2.4.8. @javax.ws.rs.BeanParam</a></li>
<li><a href="#_conversi%C3%B3n_autom%C3%A1tica_de_tipos">2.4.9. ConversiÃ³n automÃ¡tica de tipos</a></li>
<li><a href="#_valores_por_defecto_defaultvalue">2.4.10. Valores por defecto (@DefaultValue)</a></li>
</ul>
</li>
<li><a href="#_configuraci%C3%B3n_y_despliegue_de_aplicaciones_jax_rs">2.5. ConfiguraciÃ³n y despliegue de aplicaciones JAX-RS</a>
<ul class="sectlevel3">
<li><a href="#_configuraci%C3%B3n_mediante_la_clase_em_application_em">2.5.1. ConfiguraciÃ³n mediante la clase <em>Application</em></a></li>
<li><a href="#_configuraci%C3%B3n_mediante_un_fichero_em_web_xml_em">2.5.2. ConfiguraciÃ³n mediante un fichero <em>web.xml</em></a></li>
<li><a href="#_configuraci%C3%B3n_en_un_contenedor_que_no_disponga_de_una_implementaci%C3%B3n_jax_rs">2.5.3. ConfiguraciÃ³n en un contenedor que no disponga de una implementaciÃ³n JAX-RS</a></li>
</ul>
</li>
<li><a href="#_ejercicios_2">2.6. Ejercicios</a>
<ul class="sectlevel3">
<li><a href="#_creaci%C3%B3n_de_un_recurso_creaci%C3%B3n_y_consulta_de_temas_en_el_foro_0_5_puntos">2.6.1. CreaciÃ³n de un recurso: creaciÃ³n y consulta de temas en el foro (0,5 puntos)</a></li>
<li><a href="#_despliegue_y_pruebas_del_recurso_0_5_puntos">2.6.2. Despliegue y pruebas del recurso (0,5 puntos)</a></li>
<li><a href="#_m%C3%BAltiples_consultas_de_los_temas_del_foro_0_5_puntos">2.6.3. MÃºltiples consultas de los temas del foro (0,5 puntos)</a></li>
<li><a href="#_creaci%C3%B3n_de_subrecursos_0_5_puntos">2.6.4. CreaciÃ³n de subrecursos (0,5 puntos)</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#sesion03">3. Manejadores de contenidos. Respuestas del servidor y manejo de excepciones.</a>
<ul class="sectlevel2">
<li><a href="#_proveedores_de_entidades">3.1. Proveedores de entidades</a>
<ul class="sectlevel3">
<li><a href="#_interfaz_javax_ws_rs_ext_messagebodyreader">3.1.1. Interfaz javax.ws.rs.ext.MessageBodyReader</a></li>
<li><a href="#_interfaz_javax_ws_rs_ext_messagebodywriter">3.1.2. Interfaz javax.ws.rs.ext.MessageBodyWriter</a></li>
</ul>
</li>
<li><a href="#_proveedores_de_entidad_est%C3%A1ndar_incluidos_en_jax_rs">3.2. Proveedores de entidad estÃ¡ndar incluidos en JAX-RS</a>
<ul class="sectlevel3">
<li><a href="#_javax_ws_rs_core_streamingoutput">3.2.1. javax.ws.rs.core.StreamingOutput</a></li>
<li><a href="#_java_io_inputstream_java_io_reader">3.2.2. java.io.InputStream, java.io.Reader</a></li>
<li><a href="#_java_io_file">3.2.3. java.io.File</a></li>
<li><a href="#_byte">3.2.4. byte[]</a></li>
<li><a href="#_string_char">3.2.5. String, char[]</a></li>
<li><a href="#_multivaluedmap_string_string_y_formularios_de_entrada">3.2.6. MultivaluedMap&lt;String, String&gt; y formularios de entrada</a></li>
</ul>
</li>
<li><a href="#_m%C3%BAltiples_representaciones_de_recursos">3.3. MÃºltiples representaciones de recursos</a></li>
<li><a href="#_introducci%C3%B3n_a_jaxb">3.4. IntroducciÃ³n a JAXB</a>
<ul class="sectlevel3">
<li><a href="#_clase_jaxbcontext">3.4.1. Clase JAXBContext</a></li>
<li><a href="#_manejadores_jax_rs_para_jaxb">3.4.2. Manejadores JAX-RS para JAXB</a></li>
<li><a href="#_jaxb_y_json">3.4.3. JAXB y JSON</a></li>
</ul>
</li>
<li><a href="#_respuestas_del_servidor">3.5. Respuestas del servidor</a>
<ul class="sectlevel3">
<li><a href="#_c%C3%B3digos_de_respuesta_por_defecto">3.5.1. CÃ³digos de respuesta por defecto</a></li>
<li><a href="#_elaboraci%C3%B3n_de_respuestas_con_la_clase_response">3.5.2. ElaboraciÃ³n de respuestas con la clase Response</a></li>
</ul>
</li>
<li><a href="#_manejadores_de_excepciones">3.6. Manejadores de excepciones</a>
<ul class="sectlevel3">
<li><a href="#_la_clase_javax_ws_rs_webapplicationexception">3.6.1. La clase javax.ws.rs.WebApplicationException</a></li>
<li><a href="#_mapeado_de_excepciones">3.6.2. Mapeado de excepciones</a></li>
<li><a href="#_jerarqu%C3%ADa_de_excepciones">3.6.3. JerarquÃ­a de excepciones</a></li>
</ul>
</li>
<li><a href="#_ejercicios_3">3.7. Ejercicios</a>
<ul class="sectlevel3">
<li><a href="#_servicio_rest_ejemplo">3.7.1. Servicio REST ejemplo</a></li>
<li><a href="#_plantillas_que_se_proporcionan">3.7.2. Plantillas que se proporcionan</a></li>
<li><a href="#_uso_de_jaxb_0_5_puntos">3.7.3. Uso de JAXB (0,5 puntos)</a></li>
<li><a href="#_uso_de_manejadores_de_contenidos_y_clase_response_0_75_puntos">3.7.4. Uso de manejadores de contenidos y clase Response (0,75 puntos)</a></li>
<li><a href="#_manejo_de_excepciones_0_75_puntos">3.7.5. Manejo de excepciones (0,75 puntos)</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#sesion04">4. HATEOAS y Seguridad</a>
<ul class="sectlevel2">
<li><a href="#__qu%C3%A9_es_hateoas">4.1. Â¿QuÃ© es HATEOAS?</a></li>
<li><a href="#_hateoas_y_servicios_web">4.2. HATEOAS y Servicios Web</a>
<ul class="sectlevel3">
<li><a href="#_enlaces_atom">4.2.1. Enlaces Atom</a></li>
<li><a href="#_ventajas_de_utilizar_hateoas_con_servicios_web">4.2.2. Ventajas de utilizar HATEOAS con Servicios Web</a></li>
<li><a href="#_enlaces_en_cabeceras_frente_a_enlaces_atom">4.2.3. Enlaces en cabeceras frente a enlaces Atom</a></li>
</ul>
</li>
<li><a href="#_hateoas_y_jax_rs">4.3. HATEOAS y JAX-RS</a>
<ul class="sectlevel3">
<li><a href="#_construcci%C3%B3n_de_uris_con_uribuilder">4.3.1. ConstrucciÃ³n de URIs con UriBuilder</a></li>
<li><a href="#_uris_relativas_mediante_el_uso_de_uriinfo">4.3.2. URIs relativas mediante el uso de UriInfo</a></li>
<li><a href="#_construcci%C3%B3n_de_enlaces_links_en_documentos_xml_y_en_cabeceras_http">4.3.3. ConstrucciÃ³n de enlaces (Links) en documentos XML y en cabeceras HTTP</a></li>
</ul>
</li>
<li><a href="#_seguridad">4.4. Seguridad</a>
<ul class="sectlevel3">
<li><a href="#_autentificaci%C3%B3n_en_jax_rs">4.4.1. AutentificaciÃ³n en JAX-RS</a></li>
<li><a href="#_autorizaci%C3%B3n_en_jax_rs">4.4.2. AutorizaciÃ³n en JAX-RS</a></li>
<li><a href="#_encriptaci%C3%B3n">4.4.3. EncriptaciÃ³n</a></li>
<li><a href="#_seguridad_programada">4.4.4. Seguridad programada</a></li>
</ul>
</li>
<li><a href="#_ejercicios_4">4.5. Ejercicios</a>
<ul class="sectlevel3">
<li><a href="#_uso_de_hateoas_1_puntos">4.5.1. Uso de Hateoas (1 puntos)</a></li>
<li><a href="#_ejercicio_seguridad_1_punto">4.5.2. Ejercicio seguridad (1 punto)</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#sesion05">5. Api cliente. Procesamiento JSON y Pruebas</a>
<ul class="sectlevel2">
<li><a href="#_api_cliente_visi%C3%B3n_general">5.1. API cliente. VisiÃ³n general</a>
<ul class="sectlevel3">
<li><a href="#_obtenemos_una_instancia_client">5.1.1. Obtenemos una instancia Client</a></li>
<li><a href="#_configuramos_el_em_target_em_del_cliente_uri">5.1.2. Configuramos el <em>target</em> del cliente (URI)</a></li>
<li><a href="#_construimos_y_realizamos_la_petici%C3%B3n">5.1.3. Construimos y Realizamos la peticiÃ³n</a></li>
<li><a href="#_manejo_de_excepciones">5.1.4. Manejo de excepciones</a></li>
</ul>
</li>
<li><a href="#_procesamiento_json">5.2. Procesamiento JSON</a></li>
<li><a href="#_modelo_de_procesamiento_basado_en_el_modelo_de_objetos">5.3. Modelo de procesamiento basado en el modelo de objetos</a>
<ul class="sectlevel3">
<li><a href="#_creaci%C3%B3n_de_un_modelos_de_objetos_desde_el_c%C3%B3digo_de_la_aplicaci%C3%B3n">5.3.1. CreaciÃ³n de un modelos de objetos desde el cÃ³digo de la aplicaciÃ³n</a></li>
<li><a href="#_navegando_por_el_modelo_de_objetos">5.3.2. Navegando por el modelo de objetos</a></li>
<li><a href="#_escritura_de_un_modelo_de_objetos_en_un_em_stream_em">5.3.3. Escritura de un modelo de objetos en un <em>stream</em></a></li>
<li><a href="#_modelo_de_procesamiento_basado_en_em_streaming_em">5.3.4. Modelo de procesamiento basado en <em>streaming</em></a></li>
</ul>
</li>
<li><a href="#_pruebas_de_servicios_rest">5.4. Pruebas de servicios REST</a>
<ul class="sectlevel3">
<li><a href="#_ciclo_de_vida_de_maven_y_tests_junit">5.4.1. Ciclo de vida de Maven y tests JUnit</a></li>
<li><a href="#_anotaciones_junit_y_aserciones_assertthat">5.4.2. Anotaciones JUnit y aserciones AssertThat</a></li>
<li><a href="#_observaciones_sobre_los_tests_y_algunos_ejemplos_de_tests">5.4.3. Observaciones sobre los tests y algunos ejemplos de tests</a></li>
</ul>
</li>
<li><a href="#_ejercicios_5">5.5. Ejercicios</a>
<ul class="sectlevel3">
<li><a href="#_tests_utilizando_el_api_cliente_y_un_mapeador_de_excepciones_1_punto">5.5.1. Tests utilizando el API cliente y un mapeador de excepciones (1 punto)</a></li>
<li><a href="#_tests_utilizando_el_api_json_y_junit_1_punto">5.5.2. Tests utilizando el API Json y JUnit (1 punto)</a></li>
<li><a href="#_implementaci%C3%B3n_de_los_tests">5.5.3. ImplementaciÃ³n de los tests</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
</div>
<div id="content">
<div id="preamble">
<div class="sectionbody">
<div style="page-break-after: always;"></div>
</div>
</div>
<div class="sect1">
<h2 id="sesion01">1. IntroducciÃ³n a REST. DiseÃ±o y creaciÃ³n de servicios RESTful</h2>
<div class="sectionbody">
<div class="paragraph">
<p>En esta sesiÃ³n vamos a introducir los conceptos de servicio Web y servicio Web RESTful, que
es el tipo de servicios con los que vamos a trabajar. Explicaremos el proceso de diseÃ±o del API
de un servicio Web RESTful, y definiremos las URIs que constituirÃ¡n los "puntos de entrada"
de nuestra aplicaciÃ³n REST. Finalmente ilustraremos los pasos para implementar, desplegar y probar
un servicio REST, utilizando <em>Maven</em>, <em>IntelliJ</em>, y el servidor de aplicaciones <em>Wildfly</em>. TambiÃ©n nos
familiarizaremos con <em>Postman</em>, una herramienta para poder probar de forma sencilla los servicios
web directamente desde el navegador.</p>
</div>
<div class="sect2">
<h3 id="__quÃ©_es_un_servicio_web">1.1. Â¿QuÃ© es un servicio Web?</h3>
<div class="paragraph">
<p>El diseÃ±o del software tiende a ser cada vez mÃ¡s modular. Las aplicaciones estÃ¡n formadas por una serie de
componentes reutilizables (<strong>servicios</strong>), que pueden encontrarse distribuidos a lo largo de una serie de mÃ¡quinas
conectadas en red.</p>
</div>
<div class="paragraph">
<p>El <strong>WC3</strong> (<em><strong>W</strong>orld <strong>W</strong>ide <strong>W</strong>eb Consortium</em>) define un servicio Web como un sistema software diseÃ±ado para soportar interacciones
mÃ¡quina a mÃ¡quina a travÃ©s de la red. Dicho de otro modo, los servicios Web proporcionan una forma estÃ¡ndar de interoperar
entre aplicaciones software que se ejecutan en diferentes plataformas. Por lo tanto, su principal caracterÃ­stica su gran
<strong>interoperabilidad</strong> y <strong>extensibilidad</strong> asÃ­ como por proporcionar informaciÃ³n fÃ¡cilmente procesable por las mÃ¡quinas gracias al
uso de XML. Los servicios Web pueden combinarse con muy bajo acoplamiento para conseguir la realizaciÃ³n de operaciones complejas.
De esta forma, las aplicaciones que proporcionan servicios simples pueden interactuar con otras para "entregar" servicios
sofisticados aÃ±adidos.</p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Historia de los servicios Web</div>
<div class="paragraph">
<p>Los servicios Web fueron "inventados" para solucionar el problema de la <strong>interoperabilidad</strong> entre las aplicaciones. Al principio
de los 90, con el desarrollo de Internet/LAN/WAN, apareciÃ³ el gran problema de integrar aplicaciones diferentes. Una aplicaciÃ³n
podÃ­a haber sido desarrollada en C++ o Java, y ejecutarse bajo Unix, un PC, o un computador mainframe. No habÃ­a una forma fÃ¡cil
de intercomunicar dichas aplicaciones. FuÃ© el desarrollo de XML el que hizo posible compartir datos entre aplicaciones con
diferentes plataformas hardware a travÃ©s de la red, o incluso a travÃ©s de Internet. La razÃ³n de que se llamasen servicios Web
es que fueron diseÃ±ados para residir en un servidor Web, y ser llamados a travÃ©s de Internet, tÃ­picamente via protocolos HTTP,
o HTTPS. De esta forma se asegura que un servicio puede ser llamado por cualquier aplicaciÃ³n, usando cualquier lenguaje de
programaciÃ³n, y bajo cualquier sistema operativo, siempre y cuÃ¡ndo, por supuesto, la conexiÃ³n a Internet estÃ© activa, y tenga
un puerto abierto HTTP/HTTPS, lo cual es cierto para casi cualquier computador que disponga de acceso a Internet.</p>
</div>
</div>
</div>
<div class="paragraph">
<p>A nivel <strong>conceptual</strong>, un servicio es un componente software proporcionado a travÃ©s de un <strong><em>endpoint</em></strong> accesible a travÃ©s de la red.
Los servicios productores y consumidores utilizan mensajes para intercambiar informaciÃ³n de invocaciones de peticiÃ³n y
respuesta en forma de documentos auto-contenidos que hacen muy pocas asunciones sobre las capacidades tecnolÃ³gicas de cada uno
de los receptores.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="title">Â¿QuÃ© es un <em>endpoint</em>?</div>
<div class="paragraph">
<p>Los servicios pueden interconectarse a travÃ©s de la red. En una arquitectura orientada a servicios, cualquier interacciÃ³n
punto a punto implica dos <strong><em>endpoints</em></strong>: uno que proporciona un servicio, y otro de lo consume. Es decir, que un <strong><em>endpoint</em></strong> es
cada uno de los "elementos", en nuestro caso nos referimos a servicios, que se sitÃºan en ambos "extremos" de la red que sirve de
canal de comunicaciÃ³n entre ellos. Cuando hablamos de servicios Web, un <em>endpoint</em> se especifica mediante una URI.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>A nivel <strong>tÃ©cnico</strong>, los servicios pueden implementarse de varias formas. En este sentido, podemos distinguir dos tipos
de servicios Web: los denominados servicios Web "grandes" (<em>"big" Web Services</em>), los llamaremos servicios Web SOAP, y
servicios "ligeros" o servicios Web RESTful.</p>
</div>
<div class="paragraph">
<p>Los servicios Web SOAP se caracterizan por utilizar mensajes XML que siguen el estÃ¡ndar SOAP (<em><strong>S</strong>imple <strong>O</strong>bject <strong>A</strong>ccess <strong>P</strong>rotocol</em>).
AdemÃ¡s contienen una descripciÃ³n de las operaciones proporcionadas por el servicio, escritas en
WSDL (<em><strong>W</strong>eb <strong>S</strong>ervices <strong>D</strong>escription <strong>L</strong>anguage</em>), un lenguaje basado en XML.</p>
</div>
<div class="paragraph">
<p>Los servicios Web RESTful, por el contrario, pueden intercambiar mensajes escritos en diferentes formatos, y no requieren el
publicar una descripciÃ³n de las operaciones que proporcionan, por lo que necesitan una menor "infraestructura" para su
implementaciÃ³n. Nosotros vamos a centrarnos en el uso de estos servicios.</p>
</div>
<div class="sect3">
<h4 id="_servicios_web_restful">1.1.1. Servicios Web RESTful</h4>
<div class="paragraph">
<p>Son un tipo de Servicios Web, que se adhieren a una serie de restricciones arquitectÃ³nicas englobadas bajo
las siglas de <strong>REST</strong>, y que utilizan estÃ¡ndares Web tales como URIs, HTTP, XML, y JSON.</p>
</div>
<div class="paragraph">
<p>El API Java para servicios Web RESTful (<strong>JAX-RS</strong>) permite desarrollar servicios Web RESTful de forma sencilla. La versiÃ³n mÃ¡s reciente
del API es la 2.0, cuya especificaciÃ³n estÃ¡ publicada en el documento <strong>JSR-339</strong>, y que podemos descargar desde <a href="https://jcp.org/en/jsr/detail?id=339" class="bare">https://jcp.org/en/jsr/detail?id=339</a>.
A lo largo de estas sesiones, veremos cÃ³mo utilizar
JAX-RS para desarrollar servicios Web RESTful. Dicho API utiliza anotaciones Java para reducir los esfuerzos de programaciÃ³n de los servicios.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_fundamentos_de_rest">1.2. Fundamentos de REST</h3>
<div class="paragraph">
<p>El tÃ©rmino REST proviene de la tesis doctoral de Roy Fielding, publicada en el aÃ±o 2000, y significa <em><strong>R</strong><strong>E</strong>presentational
  <strong>S</strong>tate <strong>T</strong>ransfer</em> (podemos acceder a la tesis original en: <a href="http://www.ics.uci.edu/~fielding/pubs/dissertation/top.htm" class="bare">http://www.ics.uci.edu/~fielding/pubs/dissertation/top.htm</a>).
  REST es un conjunto de restricciones que, cuando son aplicadas al diseÃ±o de un sistema, crean un
  estilo arquitectÃ³nico de software. Dicho estilo arquitectÃ³nico se caracteriza por seguir los siguientes
principios:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Debe ser un sistema <strong>cliente-servidor</strong></p>
</li>
<li>
<p>Tiene que ser <strong>sin estado</strong>, es decir, no hay necesidad de que los servicios guarden
las sesiones de los usuarios (cada peticiÃ³n al servicio tiene que ser independiente
de las demÃ¡s)</p>
</li>
<li>
<p>Debe soportar un sistema de <strong>cachÃ©s</strong>: la infraestructura de la red deberÃ­a soportar
cachÃ© en diferentes niveles</p>
</li>
<li>
<p>Debe ser un sistema <strong>uniformemente accesible</strong> (con una interfaz uniforme):
Esta restricciÃ³n define cÃ³mo debe ser la interfaz entre clientes y servidores. La idea
es simplificar y desacoplar la arquitectura, permitiendo que cada una de sus partes
puede evolucionar de forma independiente. Una interfaz uniforme se debe caracterizar por:</p>
<div class="ulist">
<ul>
<li>
<p>Estar basada en <strong>recursos</strong>: La
abstracciÃ³n utilizada para representar la informaciÃ³n y los datos en REST es
el <strong>recurso</strong>, y cada recurso debe poder ser
accedido mediante una URI (<strong>U</strong>niform <strong>R</strong>esource <strong>I</strong>dentifier).</p>
</li>
<li>
<p>Orientada a <strong>representaciones</strong>: La interacciÃ³n con los servicios tiene lugar a travÃ©s de las <strong><em>representaciones</em></strong> de los
<strong><em>recursos</em></strong> que conforman dicho servicio. Un <strong>recurso</strong> referenciado por una URI puede
tener diferentes formatos (<em>representaciones</em>). Diferentes plataformas requieren formatos
diferentes. Por ejemplo, los navegadores necesitan HTML, JavaScript requiere JSON
(<strong>J</strong>ava<strong>S</strong>cript <strong>O</strong>bject <strong>N</strong>otation), y una aplicaciÃ³n Java puede necesitar XML.</p>
</li>
<li>
<p>Interfaz <strong>restringida</strong>: Se utiliza un pequeÃ±o conjunto de mÃ©todos bien definidos para manipular los recursos.</p>
</li>
<li>
<p>Uso de mensajes <strong>auto-descriptivos</strong>: cada mensaje debe incluir la suficiente informaciÃ³n
como para describir cÃ³mo procesar el mensaje. Por ejemplo, se puede indicar cÃ³mo "parsear"
el mensaje indicando el tipo de contenido del mismo (xml, html, texto,&#8230;&#8203;)</p>
</li>
<li>
<p>Uso de Hipermedia como mÃ¡quina de estados de la aplicacion (<strong>HATEOAS</strong>):
Los propios formatos de los datos son los que "dirigen" las transiciones entre estados
de la aplicaciÃ³n. Como veremos mÃ¡s adelante con mÃ¡s detalle, el uso de HATEOAS
(<strong>H</strong>ypermedia <strong>A</strong>s <strong>T</strong>he <strong>E</strong>ngine <strong>O</strong>f <strong>A</strong>pplication <strong>S</strong>tate),
va a permitir transferir de forma explÃ­cita el estado de la aplicacion en los mensajes
intercambiados, y por lo tanto, realizar interacciones con estado.</p>
</li>
</ul>
</div>
</li>
<li>
<p>Tiene que ser un sistema por <strong>capas</strong>: un cliente no puede "discernir" si estÃ¡ accediendo
directamente al servidor, o a algÃºn intermediario. Las "capas" intermedias van a permitir
soportar la escalabilidad, asÃ­ como reforzar las polÃ­ticas de seguridad</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>A continuaciÃ³n analizaremos algunas de las abstracciones que constituyen un sistema RESTful: recursos, representaciones, URIs, y los
    tipos de peticiones HTTP que constituyen la interfaz uniforme utilizada en las transferencias cliente/servidor</p>
</div>
<div class="sect3">
<h4 id="_recursos">1.2.1. Recursos</h4>
<div class="paragraph">
<p>Un recurso REST es cualquier cosa que sea direccionable (y por lo tanto, accesible) a travÃ©s de la Web. Por direccionable nos referimos a recursos que
   puedan ser accedidos y transferidos entre clientes y servidores. Por lo tanto, un recurso es una <strong>correspondencia lÃ³gica y
   temporal</strong> con un concepto en el <strong>dominio</strong> del problema para el cual estamos implementando una soluciÃ³n.</p>
</div>
<div class="paragraph">
<p>Algunos ejemplos de recursos REST son:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Una noticia de un periÃ³dico</p>
</li>
<li>
<p>La temperatura de Alicante a las 4:00pm</p>
</li>
<li>
<p>Un valor de IVA almacenado en una base de datos</p>
</li>
<li>
<p>Una lista con el historial de las revisiones de cÃ³digo en un sistema CVS</p>
</li>
<li>
<p>Un estudiante en alguna aula de alguna universidad</p>
</li>
<li>
<p>El resultado de una bÃºsqueda de un Ã­tem particular en Google</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Aun cuando el mapeado de un recurso es Ãºnico, diferentes peticiones a un recurso pueden devolver la misma representaciÃ³n
   binaria almacenada en el servidor. Por ejemplo, consideremos un recurso en el contexto de un sistema de publicaciones.
   En este caso, una peticiÃ³n de la "Ãºltima revisiÃ³n publicada" y la peticiÃ³n de "la revisiÃ³n nÃºmero 12" en algÃºn momento
   de tiempo pueden devolver la misma representaciÃ³n del recurso: cuando la Ãºltima revisiÃ³n sea efectivamente la 12. Por lo
   tanto, cuando la Ãºltima revisiÃ³n publicada se incremente a la versiÃ³n 13, una peticiÃ³n a la Ãºltima revisiÃ³n devolverÃ¡ la
   versiÃ³n 13, y una peticiÃ³n de la revisiÃ³n 12, continuarÃ¡ devolviendo la versiÃ³n 12. En definitiva: cada uno de los recursos
   puede ser accedido directamente y de forma independiente, pero diferentes peticiones podrÃ­an "apuntar" al mismo dato.</p>
</div>
<div class="paragraph">
<p>Debido a que estamos utilizando HTTP para comunicarnos, podemos transferir cualquier tipo de informaciÃ³n que pueda
   transportarse entre clientes y servidores. Por ejemplo, si realizamos una peticiÃ³n de un fichero de texto de la CNN, nuestro
   navegador mostrarÃ¡ un fichero de texto. Si solicitamos una pelÃ­cula flash a YouTube, nuestro navegador recibirÃ¡ una pelÃ­cula
   flash. En ambos casos, los datos son transferidos sobre TCP/IP y el navegador conoce cÃ³mo interpretar los <em>streams</em>
   binarios debido a la cabecera de respuesta del protocolo HTTP <em>Content-Type</em>. Por lo tanto, en un sistema RESTful,
   la representaciÃ³n de un recurso depende del tipo deseado por el cliente (tipo MIME), el cual estÃ¡ especificado en la
   peticiÃ³n del protocolo de comunicaciones.</p>
</div>
</div>
<div class="sect3">
<h4 id="_representaciÃ³n_de_los_recursos">1.2.2. RepresentaciÃ³n de los recursos</h4>
<div class="paragraph">
<p>La representaciÃ³n de los recursos es lo que se envÃ­a entre los servidores y clientes. Una representaciÃ³n muestra el estado
   temporal del dato real almacenado en algÃºn dispositivo de almacenamiento en el momento de la peticiÃ³n. En tÃ©rminos generales,
   es un <em>stream</em> binario, juntamente con los metadatos que describen cÃ³mo dicho <em>stream</em> debe ser consumido
   por el cliente y/o servidor (los metadatos tambiÃ©n puden contener informaciÃ³n extra sobre el recurso, como por ejemplo
    informaciÃ³n de validaciÃ³n y encriptaciÃ³n, o cÃ³digo extra para ser ejecutado dinÃ¡micamente).</p>
</div>
<div class="paragraph">
<p>A travÃ©s del ciclo de vida de un servicio web, pueden haber varios clientes solicitando recursos. Clientes diferentes
   son capaces de consumir diferentes representaciones del mismo recurso. Por lo tanto, una representaciÃ³n puede tener
   varias formas, como por ejemplo, una imagen, un texto, un fichero XML, o un fichero JSON, pero tienen que estar disponibles
   en la misma URL.</p>
</div>
<div class="paragraph">
<p>Para respuestas generadas para humanos a travÃ©s de un navegador, una representaciÃ³n tÃ­pica tiene la forma de
   pÃ¡gina HTML. Para respuestas automÃ¡ticas de otros servicios web, la legibilidad no es importante y puede utilizarse una representaciÃ³n
   mucho mÃ¡s eficiente como por ejemplo XML.</p>
</div>
<div class="paragraph">
<p>El lenguaje para el intercambio de informaciÃ³n con el
servicio queda a elecciÃ³n del desarrollador. A continuaciÃ³n mostramos algunos formatos comunes que podemos utilizar
para intercambiar esta informaciÃ³n:</p>
</div>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 1. Ejemplos de formatos utilizados por los servicios REST</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Formato</th>
<th class="tableblock halign-left valign-top">Tipo MIME</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Texto plano</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">text/plain</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">HTML</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">text/html</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">XML</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">application/xml</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">JSON</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">application/json</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>De especial interÃ©s es el formato <strong>JSON</strong>. Se trata de un lenguaje ligero de intercambio
de informaciÃ³n, que puede utilizarse en lugar de XML (que resulta considerablemente
mÃ¡s pesado) para aplicaciones AJAX. De hecho, en Javascript puede leerse este tipo de
formato simplemente utilizando el mÃ©todo <code>eval()</code>.</p>
</div>
</div>
<div class="sect3">
<h4 id="_direccionabilidad_de_los_recursos_uri">1.2.3. Direccionabilidad de los recursos: URI</h4>
<div class="paragraph">
<p>Una URI, o <strong>Uniform Resource Identifier</strong>, en un servicio web RESTful es un hiper-enlace a un recurso, y es la
   Ãºnica forma de intercambiar representaciones entre clientes y servidores. Un
   servicio web RESTful expone un conjunto de recursos que identifican los objetivos
      de la interacciÃ³n con sus clientes.</p>
</div>
<div class="paragraph">
<p>El conjunto de restricciones REST no impone que las URIs deban ser hiper-enlaces. Simplemente hablamos de hiper-enlaces
   porque estamos utilizando la Web para crear servicios web. Si estuviÃ©semos utilizando un conjunto diferente de tecnologÃ­as
   soportadas, una URI RESTful podrÃ­a ser algo completamente diferente. Sin embargo, la idea de direccionabilidad debe permanecer.</p>
</div>
<div class="paragraph">
<p>En un sistema REST, la URI <strong>no cambia a lo largo del tiempo</strong>, ya que la implementaciÃ³n de la arquitectura es la que
  gestiona los servicios, localiza los recursos, negocia las representaciones, y envÃ­a respuestas con los recursos solicitados.
  Y lo que es mÃ¡s importante, si hubiese un cambio en la estructura del dispositivo de almacenamiento en el lado del servidor
  (por ejemplo, un cambio de servidores de bases de datos), nuestras URIs seguirÃ¡n siendo las mismas y serÃ¡n vÃ¡lidas mientras
  el servicio web siga estando "en marcha" o el contexto del recurso no cambie.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<strong>Sin</strong> las restricciones REST, los recursos se acceden por su localizaciÃ³n: las direcciones web tÃ­picas son URIs fijas. Si por
   ejemplo renombramos un fichero en el servidor, la URI serÃ¡ diferente; si movemos el fichero a un directorio diferente, la URI
   tambiÃ©n serÃ¡ diferente.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>El formato de una URI se estandariza como sigue:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>scheme://host:port/path?queryString#fragment</pre>
</div>
</div>
<div class="paragraph">
<p>En donde:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>scheme</code> es el protocolo que estamos utilizando para comunicarnos con el
servidor. Para servicios REST, normalmente el protocolo serÃ¡ <strong><em>http</em></strong> o <strong><em>https</em></strong>.</p>
</li>
<li>
<p>El tÃ©rmino <code>host</code> es un nombre DNS o una direcciÃ³n IP.</p>
</li>
<li>
<p>A continuaciÃ³n se puede indicar
de forma opcional un puerto (mediante <code>:port</code>), que es un valor numÃ©rico. El <strong><em>host</em></strong>
y el <strong><em>port</em></strong> representan la localizaciÃ³n de nuestro recurso en la red.</p>
</li>
<li>
<p>Seguidamente aparece una expresiÃ³n <code>path</code>, que es un conjunto de segmentos de texto
delimitados por el carÃ¡cter <code>\</code> (pensemos en la expresiÃ³n <em>path</em> como en una lista
de directorios de un fichero en nuestra mÃ¡quina).</p>
</li>
<li>
<p>Esta expresiÃ³n puede ir seguida, opcionalmente
por una <code>queryString</code>. El carÃ¡cter <code>?</code>) separa el <em>path</em> de la <em>queryString</em>.
Esta Ãºltima es una lista
de parÃ¡metros representados como pares nombre/valor. Cada par estÃ¡ delimitado por el
carÃ¡cter <code>&amp;</code>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>La Ãºltima parte de la URI es el <code>fragment</code>, delimitado por el carÃ¡cter <code>#</code>. Normalmente
se utiliza para "apuntar" a cierto "lugar" del documento al que estamos accediendo.</p>
</div>
<div class="paragraph">
<p>En una URI, no todos los caracteres estÃ¡n permitidos, de forma que algunos caracteres
se codificarÃ¡n de acuerdo a las siguientes reglas:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Los caracteres a-z, A-Z, 0-9, ., -, *, y _, permanecen igual</p>
</li>
<li>
<p>El caracter "espacio" se convierte en el carÃ¡cter <code>+</code></p>
</li>
<li>
<p>El resto de caracteres se codifican como una secuencia de bits siguiendo
un esquema de codificaciÃ³n hexadecimal, de forma que cada dos dÃ­gitos hexadecimales
van precedidos por el carÃ¡cter <code>%</code>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Un ejemplo de URI podrÃ­a ser Ã©ste:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml">http://expertojava.ua.es/recursos/clientes?apellido=Martinez<span class="tok-err">&amp;</span>codPostal=02115</code></pre>
</div>
</div>
<div class="paragraph">
<p>En el ejemplo anterior el <strong>host</strong> viene dado por <em>expertojava.ua.es</em>, el <strong>path</strong> o ruta
de acceso al recurso es <em>/recursos/clientes</em>, y hemos especificado los <strong>parÃ¡metros</strong> <em>apellido</em>
y <em>codPostal</em>, con los <strong>valores</strong> <em>Martinez</em> y <em>02115</em> respectivamente.</p>
</div>
<div class="paragraph">
<p>Si por ejemplo, en nuestra aplicaciÃ³n tenemos informaciÃ³n de clientes, podrÃ­amos
acceder a la lista correspondiente mediante una URL como la siguiente:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml">http://expertojava.ua.es/recursos/clientes</code></pre>
</div>
</div>
<div class="paragraph">
<p>Esto nos devolverÃ¡ la lista de clientes en el formato que el desarrollador del servicio haya decidido. Hay que
destacar, por lo tanto, que en este caso debe haber un entendimiento entre el consumidor y el productor del servicio,
de forma que el primero comprenda el lenguaje utilizado por el segundo.</p>
</div>
<div class="paragraph">
<p>La URL anterior nos podrÃ­a devolver un documento como el siguiente:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><span class="tok-cp">&lt;?xml version=&quot;1.0&quot;?&gt;</span>
<span class="tok-nt">&lt;clientes&gt;</span>
  <span class="tok-nt">&lt;cliente&gt;</span>http://expertojava.ua.es/recursos/clientes/1&quot;<span class="tok-nt">&lt;cliente/&gt;</span>
  <span class="tok-nt">&lt;cliente&gt;</span>http://expertojava.ua.es/recursos/clientes/2&quot;<span class="tok-nt">&lt;cliente/&gt;</span>
  <span class="tok-nt">&lt;cliente&gt;</span>http://expertojava.ua.es/recursos/clientes/4&quot;<span class="tok-nt">&lt;cliente/&gt;</span>
  <span class="tok-nt">&lt;cliente&gt;</span>http://expertojava.ua.es/recursos/clientes/6&quot;<span class="tok-nt">&lt;cliente/&gt;</span>
<span class="tok-nt">&lt;/clientes&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>En este documento se muestra la lista de clientes registrados en la aplicaciÃ³n, cada uno de ellos representado
tambiÃ©n por una URL. Accediendo a estas URLs, a su vez, podremos obtener informaciÃ³n sobre cada curso concreto o bien
modificarlo.</p>
</div>
</div>
<div class="sect3">
<h4 id="_uniformidad_y_restricciones_de_las_interfaces">1.2.4. Uniformidad y restricciones de las interfaces</h4>
<div class="paragraph">
<p>Ya hemos introducido los conceptos de recursos y sus representaciones. Hemos dicho que los
   <strong>recursos</strong> son correspondencias (<em>mappings</em>) de los estados reales de las entidades que son intercambiados entre los
   clientes y servidores. TambiÃ©n hemos dicho que las <strong>representaciones</strong> son negociadas entre los clientes
   y servidores a travÃ©s del protocolo de comunicaciÃ³n en tiempo de ejecuciÃ³n (a travÃ©s de HTTP).
   A continuaciÃ³n veremos con detalle lo que significa el intercambio de estas representaciones, y lo que
   implica para los clientes y servidores el realizar acciones sobre dichos recursos.</p>
</div>
<div class="paragraph">
<p>El desarrollo de servicios web REST es similar al desarrollo de aplicaciones web. Sin embargo, la diferencia
   fundamental entre el desarrollo de aplicaciones web tradicionales y las mÃ¡s modernas es cÃ³mo pensamos sobre las acciones
   a realizar sobre nuestras abstracciones de datos. De forma mÃ¡s concreta, el desarrollo moderno estÃ¡ centrado
   en el concepto de <strong>nombres</strong> (intercambio de recursos); el desarrollo tradicional estÃ¡ centrado
   en el concepto de verbos (acciones remotas a realizar sobre los datos). Con la primera forma, estamos implementando
   un servicio web RESTful; con la segunda un servicio similar a una llamada a procedimiento remoto- RPC). Y lo que es mÃ¡s,
   un servicio RESTful <strong>modifica el estado de los datos a travÃ©s de la
   representaciÃ³n de los recursos</strong> (por el contrario, una llamada a un servicio RPC, oculta la representaciÃ³n de los datos
   y en su lugar envÃ­a comandos para modificar el estado de los datos en el lado del servidor). Finalmente, en el desarrollo
   moderno de aplicaciones web limitamos la ambigÃ¼edad en el diseÃ±o y la implementaciÃ³n debido a que tenemos <strong>cuatro</strong>
   acciones especÃ­ficas que podemos realizar sobre los recursos: <em>Create, Retrieve, Update y Delete</em> (CRUD). Por otro
   lado, en el desarrollo tradicional de aplicaciones web, podemos tener otras acciones con nombres o implementaciones no estÃ¡ndar.</p>
</div>
<div class="paragraph">
<p>A continuaciÃ³n indicamos la correspondencia entre las acciones CRUD sobre los datos y los mÃ©todos HTTP asociados:</p>
</div>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 2. Operaciones REST sobre los recursos:</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">AcciÃ³n sobre los datos</th>
<th class="tableblock halign-left valign-top">Protocolo HTTP equivalente</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">CREATE</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">POST</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">RETRIEVE</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">GET</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">UPDATE</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">PUT</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">DELETE</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">DELETE</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>El principio de uniformidad de la interfaz de acceso a recursos es fundamental, y
quizÃ¡ el mÃ¡s difÃ­cil de seguir por los programadores acostumbrados al modelo RPC (<strong>R</strong>emote
<strong>P</strong>rocedure <strong>C</strong>all).
La idea subyacente es utilizar Ãºnicamente un conjunto finito y claramente establecido
de operaciones para la interacciÃ³n con los servicios. Esto significa que no tendremos
un parÃ¡metro "acciÃ³n" en nuestra URI y que sÃ³lo utilizaremos los mÃ©todos HTTP para
acceder a nuestros servicios. Cada uno de los mÃ©todos tiene un propÃ³sito y
significado especÃ­ficos, que mostramos a continuaciÃ³n:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">GET</dt>
<dd>
<p>GET es una operaciÃ³n <strong>sÃ³lo de lectura</strong>. Se utiliza para "recuperar" informaciÃ³n
especÃ­fica del servidor. TambiÃ©n se trata de una operaciÃ³n <strong>idempotente</strong> y <strong>segura</strong>.
<strong>Idempotente</strong> significa que no importa cuÃ¡ntas veces invoquemos esta operaciÃ³n, el
 resultado (que observaremos como usuarios) debe ser siempre el mismo. <strong>Segura</strong> significa que una operaciÃ³n GET no
 cambia el estado del servidor en modo alguno, es decir, no debe exhibir ningÃºn efecto
 lateral en el servidor. Por ejemplo, el hecho de "leer" un documento HTML no deberÃ­a
 cambiar el estado de dicho documento.</p>
</dd>
</dl>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">PUT</dt>
<dd>
<p>La operaciÃ³n PUT solicita al servidor el almacenar el cuerpo del mensaje enviado con
 dicha operaciÃ³n en la direcciÃ³n proporcionada en el mensaje HTTP. Normalmente se
 modela como una inserciÃ³n o actualizaciÃ³n (nosotros la utilizaremos solamente como
 actualizaciÃ³n). Es una propiedad <strong>idempotente</strong>. Cuando se utiliza PUT, el cliente
 conoce la identidad del recurso que estÃ¡ creando o actualizando. Es idempotente
 porque enviar el mismo mensaje PUT mÃ¡s de una vez no tiene ningÃºn efecto sobre el
 servicio subyacente. Una analogÃ­a podrÃ­a ser un documento de texto que estemos
 editando. No importa cuÃ¡ntas veces pulsemos el "botÃ³n" de grabar, el fichero
 que contiene el documento lÃ³gicamente serÃ¡ el mismo documento.</p>
</dd>
<dt class="hdlist1">DELETE</dt>
<dd>
<p>Esta operaciÃ³n se utiliza para eliminar recursos. TambiÃ©n es <strong>idempotente</strong></p>
</dd>
<dt class="hdlist1">POST</dt>
<dd>
<p>Post es la Ãºnica operaciÃ³n HTTP que no es idempotente ni segura. Cada peticiÃ³n
POST puede modificar el servicio de forma exclusiva. Se puede enviar, o no,
informaciÃ³n con la peticiÃ³n. TambiÃ©n podemos recibir, o no, informaciÃ³n con la
respuesta. Para implementar servicios REST, es deseable enviar informaciÃ³n con la
 peticiÃ³n y tambiÃ©n recibir informaciÃ³n con la respuesta.</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>Adicionalmente, podemos utilizar otras dos operaciones HTTP:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">HEAD</dt>
<dd>
<p>Es una operaciÃ³n exactamente igual que GET, excepto que en lugar de devolver
un "cuerpo de mensaje", solamente devuelve un cÃ³digo de respuesta y alguna
cabecera asociada con la peticiÃ³n.</p>
</dd>
<dt class="hdlist1">OPTIONS</dt>
<dd>
<p>Se utiliza para solicitar informaciÃ³n sobre las opciones disponibles sobre un
recurso en el que estamos interesados. Esto permite al cliente determinar las
capacidades del servidor y del recurso sin tener que realizar ninguna peticiÃ³n
que provoque una acciÃ³n sobre el recurso o la recuperaciÃ³n del mismo.</p>
</dd>
</dl>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">PATCH</dt>
<dd>
<p>Se utiliza para para realiza reemplazos (actualizaciones) parciales de un documento, ya que
 la operaciÃ³n PUT sÃ³lo permite una actualizaciÃ³n completa del recurso (y requiere
 indicar una representaciÃ³n completa del mismo) . Es Ãºtil cuando el recurso a modificar es
 complejo y solamente queremos actualizar parte de su contenido. En este caso solo necesitamos
 indicar la parte que queremos cambiar.</p>
</dd>
</dl>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_diseÃ±o_de_servicios_web_restful">1.3. DiseÃ±o de servicios Web RESTful</h3>
<div class="paragraph">
<p>El diseÃ±o de servicios RESTful no es muy diferente del diseÃ±o de aplicaciones web
tradicionales: tenemos requerimientos de negocio, tenemos usuarios que quieren realizar
operaciones sobre los datos, y tenemos restricciones <em>hardware</em> que van a condicionar
nuestra arquitectura <em>software</em>. La principal diferencia reside en el hecho de que
tenemos que "buscar", a partir de los requerimientos, cuÃ¡les van a ser los <strong>recursos</strong>
que van a ser accedidos a travÃ©s de los servicios, "sin preocuparnos" de quÃ© <strong>operaciones</strong> o acciones especÃ­ficas
van a poderse realizar sobre dichos recursos (el proceso de diseÃ±o depende de los
"nombres", no de los "verbos").</p>
</div>
<div class="paragraph">
<p>Podemos resumir los principios de diseÃ±o de servicios web RESTful en los siguientes
cuatro pasos:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>ElicitaciÃ³n de requerimientos y creaciÃ³n del <strong>modelo de objetos</strong>: Este paso es
similar al diseÃ±o orientado a objetos. El resultado del proceso puede ser un modelo
de clases UML</p>
</li>
<li>
<p>IdentificaciÃ³n de <strong>recursos</strong>: Este paso consiste en identificar los "objetos" de
nuestro modelo sin preocuparnos de las operaciones concretas a realizar
sobre dichos objetos</p>
</li>
<li>
<p>DefiniciÃ³n de las <strong>URIs</strong>: Para satisfacer el principio de "direccionabilidad" de los
recursos, tendremos que definir las URIs que representarÃ¡n los <em>endpoints</em> de nuestros
servicios, y que constituirÃ¡n los "puntos de entrada" de los mismos</p>
</li>
<li>
<p>DefiniciÃ³n de la <strong>representaciÃ³n de los recursos</strong>: Puesto que los
sistemas REST estÃ¡n orientados a la representaciÃ³n, tendremos que definir el formato
de los datos que utilizaremos para intercambiar informaciÃ³n entre nuestros servicios
y clientes</p>
</li>
<li>
<p>DefiniciÃ³n de los <strong>mÃ©todos de acceso</strong> a los recursos: Finalmente, tendremos que
decidir quÃ© mÃ©todos HTTP nos permitirÃ¡n acceder a las URIs que queremos exponer,
asÃ­ como quÃ© harÃ¡ cada mÃ©todo. Es muy importante que en este paso, nos ciÃ±amos a
las restricciones que definen los principios RESTful que hemos indicado en apartados
anteriores.</p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="_un_primer_servicio_jax_rs">1.4. Un primer servicio JAX-RS</h3>
<div class="paragraph">
<p>Vamos a ilustrar los pasos anteriores con un ejemplo, concretamente definiremos una interfaz
RESTful para un sistema sencillo de gestiÃ³n de pedidos de un hipotÃ©tico comercio
por internet. Los potenciales clientes de nuestro sistema, podrÃ¡n realizar compras,
modificar pedidos existentes en nuestro sistema, asÃ­ como visualizar sus datos
personales o la informaciÃ³n sobre los productos que son ofertados por el comercio.</p>
</div>
<div class="sect3">
<h4 id="_modelo_de_objetos">1.4.1. Modelo de objetos</h4>
<div class="paragraph">
<p>A partir de los requerimientos del sistema, obtenemos el modelo de objetos.
El modelo de objetos de nuestro sistema de ventas por internet es bastante sencillo.
Cada pedido en el sistema representa una Ãºnica transacciÃ³n de compra y estÃ¡ asociada
con un cliente particular. Los pedidos estarÃ¡n formados por una o mÃ¡s lÃ­neas de pedido.
Las lÃ­neas de pedido representan el tipo y el nÃºmero de unidades del producto
adquirido.</p>
</div>
<div class="paragraph">
<p>BasÃ¡ndonos en esta descripciÃ³n de nuestro sistema, podemos extraer que los objetos
de nuestro modelo son: <strong>Pedido</strong>, <strong>Cliente</strong>, <strong>LineaPedido</strong>, y <strong>Producto</strong>. Cada
 objeto de nuestro modelo tiene un identificador Ãºnico, representado por la
 propiedad <code>id</code>, dada por un valor de tipo entero. La siguiente figura muestra
 un diagrama UML de nuestro modelo:</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="images/rest01/ModeloObjetos.png" alt="Modelo de objetos del servicio RESTful" width="66%">
</div>
</div>
<div class="paragraph">
<p>Estamos interesados en consultar todos los pedidos realizados, asÃ­ como cada
 pedido de forma individual. TambiÃ©n queremos poder realizar nuevos pedidos, asÃ­
 como actualizar pedidos existentes. El objeto ServicioPedidos representa las
 operaciones que queremos realizar sobre nuestos objetos <em>Pedido</em>, <em>Cliente</em>,
 <em>LineaPedido</em> y <em>Producto</em>.</p>
</div>
</div>
<div class="sect3">
<h4 id="_modelado_de_uris">1.4.2. Modelado de URIs</h4>
<div class="paragraph">
<p>Lo primero que haremos para crear nuestra interfaz distribuida, es definir y poner
nombre a cada uno de los <em>endpoints</em> de nuestro sistema. En un sistemam RESTful,
los <em>endpoints</em> serÃ¡n los <strong>recursos</strong> del sistema, que identificaremos mediante
URIs.</p>
</div>
<div class="paragraph">
<p>En nuestro modelo de objetos queremos poder interactuar con <em>Pedidos</em>, <em>Clientes</em>, y
<em>Productos</em>. Ãstos serÃ¡n, por lo tanto, nuestros recursos de nivel mÃ¡s alto. Por
otro lado, estamos interesados en obtener una lista de cada uno de estos elementos
de alto nivel, asÃ­ como interactuar con los elementos indiduales de cada tipo. El objeto <em>LineaPedido</em>
es un objeto <em>agregado</em> del objeto <em>Pedido</em> por lo que no lo consideraremos com un
recurso de nivel superior. MÃ¡s adelante veremos que podremos exponerlo como un <strong>subrecurso</strong>
de un <em>Pedido</em> particular, pero por ahora, asumiremos que estÃ¡ "oculto" por el
formato de nuestros datos. SegÃºn esto, una posible lista de URIs que expondrÃ¡
nuestro sistema podrÃ­a ser:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>/pedidos</p>
</li>
<li>
<p>/pedidos/{id}</p>
</li>
<li>
<p>/productos</p>
</li>
<li>
<p>/productos/{id}</p>
</li>
<li>
<p>/clientes</p>
</li>
<li>
<p>/clientes/{id}</p>
</li>
</ul>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>FÃ­jate que hemos representado como URIs los <strong>nombres</strong> en nuestro modelo de objetos.
 Recuerda que las URIS no deberÃ­an utilizarse como mini-mecanismos de RPC ni deberÃ­an
 identificar operaciones. En vez de eso, tenemos que utilizar una combinaciÃ³n de
 mÃ©todos HTTP y de datos (recursos) para modelar las operaciones de nuestro sistema
 RESTful</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_definiciÃ³n_del_formato_de_datos">1.4.3. DefiniciÃ³n del formato de datos</h4>
<div class="paragraph">
<p>Una de las cosas mÃ¡s importantes que tenemos que hacer cuando definimos la interfaz
RESTful es determinar cÃ³mo se representarÃ¡n los recursos que serÃ¡n accedidos por los usuarios
de nuestro API REST. QuizÃ¡ XML sea el formato mÃ¡s popular de la web y puede ser procesado por
la mayor parte de los lenguajes de programaciÃ³n. Como veremos mÃ¡s adelante, JSON es
otro formato popular, menos "verboso" que XML, y que puede ser interpretado directamente
por <em>JavaScript</em> (lo cual es perfecto para aplicaciones Ajax por ejemplo). Por
ahora, utilizaremos el formato XML en nuestro ejemplo.</p>
</div>
<div class="paragraph">
<p>Generalmente, tendrÃ­amos que definir un esquema XML para cada representaciÃ³n que
queramos transimitir a traves de la red. Un esquema XML define la gramÃ¡tica del
formato de datos. Por simplicidad, vamos a omitir la creaciÃ³n de esquemas, asumiendo
que los ejemplos que proporcionamos se adhieren a sus correspondientes esquemas.</p>
</div>
<div class="paragraph">
<p>A continuaciÃ³n distinguiremos entre <strong>dos formatos de datos</strong>: uno para las operaciones
de lectura y actualizaciÃ³n, y otro para la operaciÃ³n de creaciÃ³n de recursos.</p>
</div>
<div class="sect4">
<h5 id="_formato_de_datos_para_operaciones_de_lectura_y_modificaciÃ³n_de_los_recursos">Formato de datos para operaciones de lectura y modificaciÃ³n de los recursos</h5>
<div class="paragraph">
<p>Las representaciones de los recursos <em>Pedido</em>, <em>Cliente</em>, y <em>Producto</em> tendrÃ¡n un <strong>elemento XML
en comÃºn</strong>, al que denominaremos <code>link</code>:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>&lt;link rel="self" href="http://org.expertojava/..."/&gt;</pre>
</div>
</div>
<div class="paragraph">
<p>El elemento (o etiqueta) <code>link</code> indica a los clientes que obtengan un documento
XML como representaciÃ³n del recurso, dÃ³nde pueden interaccionar en la red con dicho
recurso en particular. El atributo <code>self</code> le indica al cliente quÃ© relaciÃ³n tiene
dicho enlace con la URI del recurso al que apunta (informaciÃ³n contenida en el
atributo <code>href</code>). El valor <code>self</code> indica que estÃ¡ "apuntando" a sÃ­ mismo.
MÃ¡s adelante veremos la utilidad del elemento <strong><em>link</em></strong> cuando agreguemos informaciÃ³n
en documentos XML "mÃ¡s grandes".</p>
</div>
<div class="paragraph">
<p>El formato de representaciÃ³n del recurso <strong>Cliente</strong> podrÃ­a ser:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><span class="tok-nt">&lt;cliente</span> <span class="tok-na">id=</span><span class="tok-s">&quot;8&quot;</span><span class="tok-nt">&gt;</span>
   <span class="tok-nt">&lt;link</span> <span class="tok-na">rel=</span><span class="tok-s">&quot;self&quot;</span>
         <span class="tok-na">href=</span><span class="tok-s">&quot;http://org.expertojava/clientes/8&quot;</span><span class="tok-nt">/&gt;</span>
   <span class="tok-nt">&lt;nombre&gt;</span>Pedro<span class="tok-nt">&lt;/nombre&gt;</span>
   <span class="tok-nt">&lt;apellidos&gt;</span>Garcia Perez<span class="tok-nt">&lt;/apellidos&gt;</span>
   <span class="tok-nt">&lt;direccion&gt;</span>Calle del Pino, 5<span class="tok-nt">&lt;direccion&gt;</span>
   <span class="tok-nt">&lt;codPostal&gt;</span>08888<span class="tok-nt">&lt;/codPostal&gt;</span>
   <span class="tok-nt">&lt;ciudad&gt;</span>Madrid<span class="tok-nt">&lt;/ciudad&gt;</span>
<span class="tok-nt">&lt;/cliente&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>El formato de representaciÃ³n del recurso <strong>Producto</strong> podrÃ­a ser:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><span class="tok-nt">&lt;producto</span> <span class="tok-na">id=</span><span class="tok-s">&quot;34&quot;</span><span class="tok-nt">&gt;</span>
   <span class="tok-nt">&lt;link</span> <span class="tok-na">rel=</span><span class="tok-s">&quot;self&quot;</span>
         <span class="tok-na">href=</span><span class="tok-s">&quot;http://org.expertojava/productos/34&quot;</span><span class="tok-nt">/&gt;</span>
   <span class="tok-nt">&lt;nombre&gt;</span>iPhone 6<span class="tok-nt">&lt;/nombre&gt;</span>
   <span class="tok-nt">&lt;precio&gt;</span>800<span class="tok-nt">&lt;/precio&gt;</span>
   <span class="tok-nt">&lt;cantidad&gt;</span>1<span class="tok-nt">&lt;/cantidad&gt;</span>
<span class="tok-nt">&lt;/producto&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Finalmente, el formato de la representaciÃ³n del recurso <strong>Pedido</strong> podrÃ­a ser:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><span class="tok-nt">&lt;pedido</span> <span class="tok-na">id=</span><span class="tok-s">&quot;233&quot;</span><span class="tok-nt">&gt;</span>
  <span class="tok-nt">&lt;link</span> <span class="tok-na">rel=</span><span class="tok-s">&quot;self&quot;</span> <span class="tok-na">href=</span><span class="tok-s">&quot;http://org.expertojava/pedidos/233&quot;</span><span class="tok-nt">/&gt;</span>
  <span class="tok-nt">&lt;total&gt;</span>800<span class="tok-nt">&lt;/total&gt;</span>
  <span class="tok-nt">&lt;fecha&gt;</span>December 22, 2014 06:56<span class="tok-nt">&lt;/fecha&gt;</span>
  <span class="tok-nt">&lt;cliente</span> <span class="tok-na">id=</span><span class="tok-s">&quot;8&quot;</span><span class="tok-nt">&gt;</span>
     <span class="tok-nt">&lt;link</span> <span class="tok-na">rel=</span><span class="tok-s">&quot;self&quot;</span>
                <span class="tok-na">href=</span><span class="tok-s">&quot;http://org.expertojava/clientes/8&quot;</span><span class="tok-nt">/&gt;</span>
     <span class="tok-nt">&lt;nombre&gt;</span>Pedro<span class="tok-nt">&lt;/nombre&gt;</span>
     <span class="tok-nt">&lt;apellidos&gt;</span>Garcia Perez<span class="tok-nt">&lt;/apellidos&gt;</span>
     <span class="tok-nt">&lt;direccion&gt;</span>Calle del Pino, 5<span class="tok-nt">&lt;direccion&gt;</span>
     <span class="tok-nt">&lt;codPostal&gt;</span>08888<span class="tok-nt">&lt;/codPostal&gt;</span>
     <span class="tok-nt">&lt;ciudad&gt;</span>Madrid<span class="tok-nt">&lt;/ciudad&gt;</span>
  <span class="tok-nt">&lt;/cliente&gt;</span>
  <span class="tok-nt">&lt;lineasPedido&gt;</span>
    <span class="tok-nt">&lt;lineaPedido</span> <span class="tok-na">id=</span><span class="tok-s">&quot;1&quot;</span><span class="tok-nt">&gt;</span>
      <span class="tok-nt">&lt;producto</span> <span class="tok-na">id=</span><span class="tok-s">&quot;34&quot;</span><span class="tok-nt">&gt;</span>
         <span class="tok-nt">&lt;link</span> <span class="tok-na">rel=</span><span class="tok-s">&quot;self&quot;</span>
             <span class="tok-na">href=</span><span class="tok-s">&quot;http://org.expertojava/productos/34&quot;</span><span class="tok-nt">/&gt;</span>
         <span class="tok-nt">&lt;nombre&gt;</span>iPhone 6<span class="tok-nt">&lt;/nombre&gt;</span>
         <span class="tok-nt">&lt;precio&gt;</span>800<span class="tok-nt">&lt;/precio&gt;</span>
         <span class="tok-nt">&lt;cantidad&gt;</span>1<span class="tok-nt">&lt;/cantidad&gt;</span>
      <span class="tok-nt">&lt;/producto&gt;</span>
    <span class="tok-nt">&lt;lineaPedido/&gt;</span>
  <span class="tok-nt">&lt;lineasPedido/&gt;</span>
<span class="tok-nt">&lt;/pedido&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>El formato de datos de un <code>Pedido</code> tiene en un primer nivel la informaciÃ³n
del <code>total</code>, con el importe total del pedido, asÃ­ como la <code>fecha</code> en la que
se hizo dicho pedido. <em>Pedido</em> es un buen ejemplo de composiciÃ³n de datos, ya que
un pedido incluye informaciÃ³n sobre el <em>Cliente</em> y el <em>Producto/s</em>. AquÃ­ es donde
el elemento <code>&lt;link&gt;</code> puede resultar particularmente Ãºtil. Si el usuario estÃ¡
interesado en interaccionar con el <em>Cliente</em> que ha realizado el pedido, o en uno
de los <em>productos</em> del mismo, se proporciona
la URI necesaria para interactuar con cada uno de dichos recursos. De esta forma, cuando
el usuario del API consulte un pedido, podrÃ¡ ademÃ¡s, acceder a informaciÃ³n adicional
relacionada con la consulta realizada.</p>
</div>
</div>
<div class="sect4">
<h5 id="_formato_de_datos_para_operaciones_de_creaciÃ³n_de_los_recursos">Formato de datos para operaciones de creaciÃ³n de los recursos</h5>
<div class="paragraph">
<p>Cuando estamos creando nuevos <em>Pedidos</em>, <em>Clientes</em> o <em>Productos</em>, no tiene
mucho sentido incluir un atributo <strong><em>id</em></strong>  y un elemento <strong><em>link</em></strong> en nuestro
documento XML. El servidor serÃ¡ el encargado de crear los <strong><em>ids</em></strong> cuando
inserte nuestro nuevo objeto en la base de datos. Tampoco conocemos la URI
del nuevo objeto creado, ya que serÃ¡ el servidor el encargado de generarlo.
Por lo tanto, para crear un nuevo <em>Producto</em>, el formato de la informaciÃ³n
podrÃ­a ser el siguiente:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><span class="tok-nt">&lt;producto&gt;</span>
   <span class="tok-nt">&lt;link</span> <span class="tok-na">rel=</span><span class="tok-s">&quot;self&quot;</span>
         <span class="tok-na">href=</span><span class="tok-s">&quot;http://org.expertojava/clientes/8&quot;</span><span class="tok-nt">/&gt;</span>
   <span class="tok-nt">&lt;nombre&gt;</span>iPhone<span class="tok-nt">&lt;/nombre&gt;</span>
   <span class="tok-nt">&lt;precio&gt;</span>800<span class="tok-nt">&lt;/precio&gt;</span>
<span class="tok-nt">&lt;/producto&gt;</span></code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_asignaciÃ³n_de_mÃ©todos_http">1.4.4. AsignaciÃ³n de mÃ©todos HTTP</h4>
<div class="paragraph">
<p>Finalmente, tendremos que decidir quÃ© mÃ©todos HTTP expondremos en nuestro servicio
para cada uno de los recursos, asÃ­ como definir quÃ© harÃ¡n dichos mÃ©todos. Es muy
importante no asignar funcionaldad a un mÃ©todo HTTP que "sobrepase" los lÃ­mites
impuestos por la especificaciÃ³n de dicho mÃ©todo. Por ejemplo, una operaciÃ³n GET
sobre un recurso concreto deberÃ­a ser de sÃ³lo lectura. No deberÃ­a cambiar el estado
del recurso cuando invoquemos la operaciÃ³n GET sobre Ã©l. Si no seguimos de forma
estricta la semÃ¡ntica de los mÃ©todos HTTP, los clientes, asÃ­ como cualquier otra
herramienta administrativa, no pueden hacer asunciones sobre nuestros servicios, de
forma que nuestro sistema se vuelve mÃ¡s complejo.</p>
</div>
<div class="paragraph">
<p>Veamos, para cada uno de los mÃ©todos de nuestro modelo de objetos, cuales serÃ¡n
las URIs y mÃ©todos HTTP que usaremos para representarlos.</p>
</div>
<div class="sect4">
<h5 id="_visualizaciÃ³n_de_todos_los_em_pedidos_em_em_clientes_em_o_em_productos_em">VisualizaciÃ³n de todos los <em>Pedidos</em>, <em>Clientes</em> o <em>Productos</em></h5>
<div class="paragraph">
<p>Los tres objetos de nuestro modelo: <em>Pedidos</em>, <em>Clientes</em> y <em>Productos</em>, son
accedidos y manipulados de forma similar. Los usuarios pueden estar interesados
en ver <strong>todos</strong> los <em>Pedidos</em>, <em>Clientes</em> o <em>Productos</em> en el sistema. Las siguientes
URIs representan dichos objetos como un grupo:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>/pedidos</p>
</li>
<li>
<p>/productos</p>
</li>
<li>
<p>/clientes</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Para obtener una lista de <em>Pedidos</em>, <em>Clientes</em> o <em>Productos</em>, el cliente remoto
realizara una llamada al mÃ©todo HTTP GET sobre la URI que representa el grupo de
objetos. Un ejemplo de peticiÃ³n podrÃ­a ser la siguiente:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>GET /productos HTTP/1.1</pre>
</div>
</div>
<div class="paragraph">
<p>Nuestro servicio responderÃ¡ con los datos que representan todos los <em>Pedidos</em>
 de nuestro sistema. Una respuesta podrÃ­a ser Ã©sta:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml">HTTP/1.1 200 OK
Content-Type: application/xml

<span class="tok-nt">&lt;productos&gt;</span>
   <span class="tok-nt">&lt;producto</span> <span class="tok-na">id=</span><span class="tok-s">&quot;111&quot;</span><span class="tok-nt">&gt;</span>
      <span class="tok-nt">&lt;link</span> <span class="tok-na">rel=</span><span class="tok-s">&quot;self&quot;</span> <span class="tok-na">href=</span><span class="tok-s">&quot;http://org.expertojava/productos/111&quot;</span><span class="tok-nt">/&gt;</span>
      <span class="tok-nt">&lt;nombre&gt;</span>iPhone<span class="tok-nt">&lt;/nombre&gt;</span>
      <span class="tok-nt">&lt;precio&gt;</span>648.99<span class="tok-nt">&lt;/precio&gt;</span>
   <span class="tok-nt">&lt;/producto&gt;</span>
   <span class="tok-nt">&lt;producto</span> <span class="tok-na">id=</span><span class="tok-s">&quot;222&quot;</span><span class="tok-nt">&gt;</span>
      <span class="tok-nt">&lt;link</span> <span class="tok-na">rel=</span><span class="tok-s">&quot;self&quot;</span> <span class="tok-na">href=</span><span class="tok-s">&quot;http://org.expertojava/productos/222&quot;</span><span class="tok-nt">/&gt;</span>
      <span class="tok-nt">&lt;nombre&gt;</span>Macbook<span class="tok-nt">&lt;/nombre&gt;</span>
      <span class="tok-nt">&lt;precio&gt;</span>1599.99<span class="tok-nt">&lt;/precio&gt;</span>
   <span class="tok-nt">&lt;/producto&gt;</span>
    ...
<span class="tok-nt">&lt;/productos&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Un problema que puede darse con esta peticiÃ³n es que tengamos miles de <em>Pedidos</em>,
<em>Clientes</em> o <em>Productos</em> en nuestro sistema, por lo que podemos "sobrecargar" a
nuestro cliente y afectar negativamente a los tiempos de respuesta. Para mitigar
esta problema, permitiremos que el usuario especifique unos parÃ¡metros en la URI para
limitar el tamaÃ±o del conjunto de datos que se va a devolver:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="sh">GET /pedidos?startIndex<span class="tok-o">=</span>0<span class="tok-p">&amp;</span><span class="tok-nv">size</span><span class="tok-o">=</span><span class="tok-m">5</span> HTTP/1.1
GET /productos?startIndex<span class="tok-o">=</span>0<span class="tok-p">&amp;</span><span class="tok-nv">size</span><span class="tok-o">=</span><span class="tok-m">5</span> HTTP/1.1
GET /clientes?startIndex<span class="tok-o">=</span>0<span class="tok-p">&amp;</span><span class="tok-nv">size</span><span class="tok-o">=</span><span class="tok-m">5</span> HTTP/1.1</code></pre>
</div>
</div>
<div class="paragraph">
<p>En las Ã³rdenes anteriores, hemos definido dos parÃ¡metros de peticiÃ³n: <code>startIndex</code>, y
<code>size</code>. El primero de ellos es un Ã­ndice numÃ©rico que representa a partir de quÃ© posiciÃ³n en la lista de
<em>Pedidos</em>, <em>Clientes</em> o <em>Productos</em>, comenzaremos a enviar la informaciÃ³n al cliente.
El parÃ¡metro <code>size</code> especifica cuÃ¡ntos de estos objetos de la lista queremos
que nos sean devueltos.</p>
</div>
<div class="paragraph">
<p>Estos parÃ¡metros serÃ¡n opcionales, de forma que el cliente no tiene que especificarlos en su URI.</p>
</div>
</div>
<div class="sect4">
<h5 id="_obtenciÃ³n_de_em_pedidos_em_em_clientes_em_o_em_productos_em_individuales">ObtenciÃ³n de <em>Pedidos</em>, <em>Clientes</em> o <em>Productos</em> individuales</h5>
<div class="paragraph">
<p>Ya hemos comentado previamente que podrÃ­amos utilizar las siguientes URIs para obtener
<em>Pedidos</em>, <em>Clientes</em> o <em>Productos</em>:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>/pedidos/{id}</p>
</li>
<li>
<p>/productos/{id}</p>
</li>
<li>
<p>/clientes/{id}</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>En este caso usaremos el mÃ©todo HTTP GET para recuperar objetos individuales en el sistema.
Cada invocaciÃ³n GET devolverÃ¡ la informaciÃ³n del correspondiente objeto. Por ejemplo:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>GET /pedidos/233 HTTP/1.1</pre>
</div>
</div>
<div class="paragraph">
<p>Para esta peticiÃ³n, el cliente estÃ¡ interesado en obtener una representaciÃ³n del <em>Pedido</em>
 con identificador 233. Las peticiones GET para <em>Productos</em> y <em>Clientes</em> podrÃ­an funcionar
 de forma similar. El mensaje de respuesta podrÃ­a parecerse a algo como esto:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml">HTTP/1.1 200 OK
Content-Type: application/xml

<span class="tok-nt">&lt;pedido</span> <span class="tok-na">id=</span><span class="tok-s">&quot;233&quot;</span><span class="tok-nt">&gt;</span>...<span class="tok-nt">&lt;/pedido&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>El <strong>cÃ³digo de respuesta</strong> es <strong>200 OK</strong>, indicando que la peticiÃ³n ha tenido Ã©xito.
La cabecera <code>Content-Type</code> especifica el formato del cuerpo de nuestro mensaje
como XML, y finalmente obtenemos la representaciÃ³n del <em>Pedido</em> solicitado.</p>
</div>
</div>
<div class="sect4">
<h5 id="_creaciÃ³n_de_un_em_pedido_em_em_cliente_em_o_em_producto_em">CreaciÃ³n de un <em>Pedido</em>, <em>Cliente</em> o <em>Producto</em></h5>
<div class="paragraph">
<p>Para crear un <em>Pedido</em>, <em>Cliente</em> o <em>Producto</em> utilizaremos el mÃ©todo POST. En este
caso, el cliente envÃ­a una representaciÃ³n del nuevo objeto que se prentende crear
a la URI "padre" de su representaciÃ³n, y por lo tanto, podremos omitir el identificador
del recurso. Por ejemplo:</p>
</div>
<div class="listingblock">
<div class="title">PeticiÃ³n POST para crear un pedidio</div>
<div class="content">
<pre class="pygments highlight"><code data-lang="xml">POST /pedidos HTTP/1.1
Content-Type: application/xml

<span class="tok-nt">&lt;pedido&gt;</span>
   <span class="tok-nt">&lt;total&gt;</span>199.02<span class="tok-nt">&lt;/total&gt;</span>
   <span class="tok-nt">&lt;fecha&gt;</span>December 22, 2008 06:56<span class="tok-nt">&lt;/fecha&gt;</span>
   ...
<span class="tok-nt">&lt;/pedido&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>El servicio recibe el mensaje POST, procesa la XML, y crea un nuevo pedido en la base
de datos utilizando un identificador generado de forma Ãºnica. Si bien esta aproximaciÃ³n
"funciona" perfectamente, se le pueden plantear varias cuestiones al usuario. Â¿QuÃ©
ocurre si el usuario quiere visualizar, modificar o eliminar el pedido que acaba
de crear? Â¿CuÃ¡l es el identificador del nuevo recurso? Â¿CuÃ¡l es la URI que podemos
utilizar para interactuar con el nuevo recurso? Para resolver estas cuestiones, aÃ±adiremos
alguna informaciÃ³n al mensaje de respuesta HTTP. El cliente podrÃ­a recibir un mensaje
similar a Ã©ste:</p>
</div>
<div class="listingblock">
<div class="title">Respuesta de una peticiÃ³n POST para crear un pedido</div>
<div class="content">
<pre class="pygments highlight"><code data-lang="xml">HTTP/1.1 201 Created
Content-Type: application/xml
Location: http://org.expertojava/pedidos/233

<span class="tok-nt">&lt;pedido</span> <span class="tok-na">id=</span><span class="tok-s">&quot;233&quot;</span><span class="tok-nt">&gt;</span>
    <span class="tok-nt">&lt;link</span> <span class="tok-na">rel=</span><span class="tok-s">&quot;self&quot;</span> <span class="tok-na">href=</span><span class="tok-s">&quot;http://org.expertojava/pedidos/233&quot;</span><span class="tok-nt">/&gt;</span>
    <span class="tok-nt">&lt;total&gt;</span>199.02<span class="tok-nt">&lt;/total&gt;</span>
    <span class="tok-nt">&lt;fecha&gt;</span>December 22, 2008 06:56<span class="tok-nt">&lt;/fecha&gt;</span>
    ...
<span class="tok-nt">&lt;/pedido&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>HTTP requiere que si POST crea un nuevo recurso, se debe responder con un cÃ³digo
<code>201 Created</code>. TambiÃ©n se requieer que la cabecera <code>Location</code> en el mensaje de respuesta proporcione
una URI al usuario que ha hecho la peticiÃ³n para que Ã©ste pueda interactuar con la
<em>PeticiÃ³n</em> que acaba de crear (por ejemplo, para modificar dicho <em>Pedido</em>). Es
<strong>opcional</strong> por parte del servidor devolver en la respuesta la representaciÃ³n del nuevo
recurso creado. En nuestro ejemplo optamos por devolver una representaciÃ³n XML de la <em>Peticion</em>
 creada con el identificador del atributo asÃ­ como el elemento <code>link</code>.</p>
</div>
</div>
<div class="sect4">
<h5 id="_actualizaciÃ³n_de_un_em_pedido_em_em_cliente_em_o_em_producto_em">ActualizaciÃ³n de un <em>Pedido</em>, <em>Cliente</em> o <em>Producto</em></h5>
<div class="paragraph">
<p>Para realizar modificaciones sobre los recursos que ya hemos creado utilizaremos el
mÃ©todo PUT. En este caso, un ejemplo de peticiÃ³n podrÃ­a ser Ã©sta:</p>
</div>
<div class="listingblock">
<div class="title">PeticiÃ³n PUT para modificar un pedidio</div>
<div class="content">
<pre class="pygments highlight"><code data-lang="xml">PUT /pedidos/233 HTTP/1.1
Content-Type: application/xml

<span class="tok-nt">&lt;producto</span> <span class="tok-na">id=</span><span class="tok-s">&quot;111&quot;</span><span class="tok-nt">&gt;</span>
   <span class="tok-nt">&lt;nombre&gt;</span>iPhone<span class="tok-nt">&lt;/nombre&gt;</span>
   <span class="tok-nt">&lt;precio&gt;</span>649.99<span class="tok-nt">&lt;/precio&gt;</span>
<span class="tok-nt">&lt;/producto&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Tal y como he hemos indicado anteriormente, la operaciÃ³n PUT es <strong>idempotente</strong>. Lo que
significa que no importa cuÃ¡ntas veces solicitemos la peticiÃ³n PUT, el producto
subyacente sigue permaneciendo con el mismo estado final.</p>
</div>
<div class="paragraph">
<p>Cuando un recurso se modifica mediante PUT, la especificaciÃ³n HTTP requiere que el
servidor envÃ­e un cÃ³digo de respuesta <code>200 OK</code>, y un cuerpo de mensaje de respuesta,
o bien el cÃ³digo <code>204 No Content</code>, sin ningÃºn cuerpo de mensaje en la respuesta.</p>
</div>
<div class="paragraph">
<p>En nuestro caso, devolveremos un cÃ³digo de estado <strong>204</strong> y un mensaje sin cuerpo de respuesta.</p>
</div>
<div class="admonitionblock caution">
<table>
<tr>
<td class="icon">
<i class="fa icon-caution" title="Caution"></i>
</td>
<td class="content">
<div class="title">RECUERDA: Es importante NO confundir POST con PUT</div>
<div class="paragraph">
<p>Muchas veces se confunden los mÃ©todos PUT y POST. El significado de estos mÃ©todos es el siguiente:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>POST</strong>: Publica datos en un determinado recurso. El recurso debe existir previamente,
y los datos enviados son aÃ±adidos a Ã©l. Por ejemplo, para aÃ±adir nuevos pedidos con POST
hemos visto que debÃ­amos hacerlo con el recurso lista de pedidos (/pedidos), ya que la URI
del nuevo pedido todavÃ­a no existe. La operaciÃ³n <strong>NO es idempotente</strong>, es decir,
si aÃ±adimos varias veces el mismo alumno aparecerÃ¡ repetido en nuestra lista de pedidos
  con URIs distintas.</p>
</li>
<li>
<p><strong>PUT</strong>: Hace que el recurso indicado tome como contenido los datos enviados.
El recurso podrÃ­a no existir previamente, y en caso de que existiese serÃ­a sobrescrito
con la nueva informaciÃ³n. A diferencia de POST, <strong>PUT es idempotente</strong>: MÃºltiples
llamadas idÃ©nticas a la misma acciÃ³n PUT siempre dejarÃ¡n el recurso en el <strong>mismo
estado</strong>. La acciÃ³n se realiza sobre la URI concreta que queremos establecer
(por ejemplo, /pedidos/215), de forma que varias llamadas consecutivas con los
mismos datos tendrÃ¡n el mismo efecto que realizar sÃ³lo una de ellas.</p>
</li>
</ul>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="_borrado_de_un_em_pedido_em_em_cliente_em_o_em_producto_em">Borrado de un <em>Pedido</em>, <em>Cliente</em> o <em>Producto</em></h5>
<div class="paragraph">
<p>Modelaremos el borrado de los recursos utilizando el mÃ©todo HTTP DELETE. El usuario
simplemente invocarÃ¡ el mÃ©todo DELETE sobre la URI que representa el objeto que
queremos eliminar. Este mÃ©todo harÃ¡ que dicho recurso ya no exista en nuestro sistema.</p>
</div>
<div class="paragraph">
<p>Cuando eliminamos un recurso con DELETE, la especificaciÃ³n requiere que se envÃ­e
un cÃ³digo de respuesta <code>200 OK</code>, y un cuerpo de mensaje de respuesta, o bien
un cÃ³digo de respuesta <code>204 No Content</code>, sin un cuerpo de mensaje de respuesta.</p>
</div>
<div class="paragraph">
<p>En nuestro caso, devolveremos un cÃ³digo de estado <strong>204</strong> y un mensaje sin cuerpo de respuesta.</p>
</div>
</div>
<div class="sect4">
<h5 id="_cancelaciÃ³n_de_un_em_pedido_em">CancelaciÃ³n de un <em>Pedido</em></h5>
<div class="paragraph">
<p>Hasta ahora, las operaciones de nuestro modelo de objetos "encajan" bastante bien
en la especificaciÃ³n de los correspondientes mÃ©todos HTTP. Hemos utilzado GET para
leer datos, PUT para realizar modificaciones POST para crear nuevos recursos, y
DELETE para eliminarlos. En nuestro sistema, los <em>Pedidos</em> pueden eliminarse, o tambiÃ©n
cancelarse. Ya hemos comentado que el borrado de un recurso lo "elimina completamente"
de nuestra base de datos. La operaciÃ³n de cancelaciÃ³n solamente cambia el estado del
<em>Pedido</em>, y lo sigue manteniendo en el sistema. Â¿CÃ³mo podrÃ­amos modelar esta operaciÃ³n?</p>
</div>
<div class="paragraph">
<p>Cuando modelamos una interfaz RESTful para las operaciones de nuestro modelo de objetos,
deberÃ­amos plantearnos la siguiente pregunta: Â¿la operaciÃ³n es un estado del recurso?
Si la respuesta es sÃ­, entonces deberÃ­amos modelar esta operaciÃ³n "dentro" del
formato de los datos.</p>
</div>
<div class="paragraph">
<p>La cancelaciÃ³n de un pedido es un ejemplo perfecto de esto que acabamos de decir.
La clave estÃ¡ en que esta operaciÃ³n, en realidad es un estado especÃ­fico del <em>Pedido</em>: Ã©ste
puede estar cancelado o no. Cuando un usuario accede a un <em>Pedido</em>, puede desear
conocer si el <em>Pedido</em> ha sido o no cancelado. Por lo tanto, la informaciÃ³n sobre
la cancelaciÃ³n deberÃ­a formar parte del formato de datos de un <em>Pedido</em>. AsÃ­,
 aÃ±adiremos un nuevo elemento a la informaciÃ³n del <em>Pedido</em>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><span class="tok-nt">&lt;pedido</span> <span class="tok-na">id=</span><span class="tok-s">&quot;233&quot;</span><span class="tok-nt">&gt;</span>
    <span class="tok-nt">&lt;link</span> <span class="tok-na">rel=</span><span class="tok-s">&quot;self&quot;</span> <span class="tok-na">href=</span><span class="tok-s">&quot;http://org.expertojava/pedidos/233&quot;</span><span class="tok-nt">/&gt;</span>
    <span class="tok-nt">&lt;total&gt;</span>199.02<span class="tok-nt">&lt;/total&gt;</span>
    <span class="tok-nt">&lt;fecha&gt;</span>December 22, 2008 06:56<span class="tok-nt">&lt;/fecha&gt;</span>
    <span class="tok-nt">&lt;cancelado&gt;</span>false<span class="tok-nt">&lt;/cancelado&gt;</span>
    ...
<span class="tok-nt">&lt;/pedido&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Ya que el estado "cancelado" se modela en el propio formato de datos, modelaremos
la acciÃ³n de cancelaciÃ³n con una operaciÃ³n HTTP PUT, que ya conocemos:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml">PUT /pedidos/233 HTTP/1.1
Content-Type: application/xml

<span class="tok-nt">&lt;pedido</span> <span class="tok-na">id=</span><span class="tok-s">&quot;233&quot;</span><span class="tok-nt">&gt;</span>
    <span class="tok-nt">&lt;link</span> <span class="tok-na">rel=</span><span class="tok-s">&quot;self&quot;</span> <span class="tok-na">href=</span><span class="tok-s">&quot;http://org.expertojava/pedidos/233&quot;</span><span class="tok-nt">/&gt;</span>
    <span class="tok-nt">&lt;total&gt;</span>199.02<span class="tok-nt">&lt;/total&gt;</span>
    <span class="tok-nt">&lt;fecha&gt;</span>December 22, 2008 06:56<span class="tok-nt">&lt;/fecha&gt;</span>
    <span class="tok-nt">&lt;cancelado&gt;</span>true<span class="tok-nt">&lt;/cancelado&gt;</span>
    ...
<span class="tok-nt">&lt;/pedido&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>En este ejemplo, modificamos la representaciÃ³n del <em>Pedido</em> con el elemento <code>&lt;cancelado&gt;</code>
con valor <code>true</code>.</p>
</div>
<div class="paragraph">
<p>Este "patrÃ³n" de modelado, no siempre "sirve" en todos los casos. Por ejemplo,
imaginemos que queremos ampliar el sistema de forma que "borremos" del sistema
todos los pedidos cancelados. No podemos modelar esta operaciÃ³n de la misma manera
que la de cancelaciÃ³n, ya que esta operaciÃ³n no cambia el estado de nuestra aplicaciÃ³n
(no es en sÃ­ misma un estado de la aplicaciÃ³n).</p>
</div>
<div class="paragraph">
<p>Para resolver este problema, podemos modelar esta nueva operaciÃ³n como un
"subrecurso" de <em>/pedidos</em>, y realizar un borrado de los pedidos cancelados, mediante el mÃ©todo
HTTP POST de dicho subrecurso, de la siguiente forma:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>POST /pedidos/eliminacion HTTP/1.1</pre>
</div>
</div>
<div class="paragraph">
<p>Un efecto interesante de lo que acabamos de hacer es que, puesto que ahora <code>eliminacion</code>
es una URI, podemos hacer que la interfaz de nuestro servicios RESTful evolucionen
 con el tiempo. Por ejemplo, la orden <strong>GET /pedidos/eliminacion</strong> podrÃ­a devolver la Ãºltima
 fecha en la que se procediÃ³ a eliminar todos los pedidos cancelados, asÃ­ como quÃ©
 pedidos fueron cancelados. Â¿Y si queremos aÃ±adir algÃºn criterio a la hora de
 realizar el borrado de pedidos cancelados? PodrÃ­amos introducir parÃ¡metros para
 indicar que sÃ³lo queremos eliminar aquellos pedidos que estÃ©n cancelados en una
 fecha anterior a una dada. Como vemos, podemos mantener una interfaz uniforme y
 ceÃ±irnos a las operaciones HTTP tal y como estÃ¡n especificadas, y a la vez, dotar
 de una gran flexiblidad a la interfaz de nuestro sistema RESTful. Hablaremos con mÃ¡s
 detalle de los subrecursos en la siguiente sesiÃ³n.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_implementaciÃ³n_del_servicio_creaciÃ³n_del_proyecto_maven">1.4.5. ImplementaciÃ³n del servicio: CreaciÃ³n del proyecto Maven</h4>
<div class="paragraph">
<p>Vamos a utilizar Maven para crear la estructura del proyecto que contendrÃ¡ la implementaciÃ³n de nuestro
servicio Rest. Inicialmente, podemos utilizar el mismo arquetipo con el que habÃ©is trabajado en sesiones anteriores. Y
a continuaciÃ³n modificaremos la configuraciÃ³n del fichero <em>pom.xml</em>, para implementar nuestros servicios.</p>
</div>
<div class="paragraph">
<p>Una opciÃ³n es generar la estructura del proyecto directamente <strong>desde lÃ­nea de comandos</strong>. El comando es el siguiente
(recuerda que debes escribirlo en una misma lÃ­nea. Los
caracteres "\" que aparecen en el comando no forman parte del mismo, simplemente indican que no se debe
pulsar el retorno de carro):</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="sh">mvn --batch-mode archetype:generate <span class="tok-se">\</span>
      -DarchetypeGroupId<span class="tok-o">=</span>org.codehaus.mojo.archetypes <span class="tok-se">\</span>
      -DarchetypeArtifactId<span class="tok-o">=</span>webapp-javaee7 <span class="tok-se">\</span>
      -DgroupId<span class="tok-o">=</span>org.expertojava -DartifactId<span class="tok-o">=</span>ejemplo-rest</code></pre>
</div>
</div>
<div class="paragraph">
<p>En donde:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>archetypeGroupId</code> y <code>archetypeArtifactId</code> son los nombres del <em>groupId</em> y <em>artifactId</em> del
<strong>arquetipo Maven</strong> que nos va a generar la "plantilla" para nuestro proyecto</p>
</li>
<li>
<p><code>groupId</code> y <code>artifactId</code> son los nombres que asignamos como <em>groupId</em> y <em>artifactId</em> de
<strong>nuestro proyecto</strong>. En este caso hemos elegido los valores <em>org.expertojava</em> y <em>ejemplo-rest</em>,
respectivamente</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Si utilizamos IntelliJ para crear el proyecto tenemos que:</div>
<ol class="arabic">
<li>
<p>Crear un nuevo proyecto (<strong><em>New Project</em></strong>)</p>
</li>
<li>
<p>Elegir el tipo de proyecto <strong>Maven</strong></p>
</li>
<li>
<p>Crear el proyecto Maven a partir de un <strong>arquetipo</strong> con las siguientes <strong>coordenadas</strong>:</p>
<div class="ulist">
<ul>
<li>
<p>GroupId: <em>org.codehaus.mojo.archetypes</em></p>
</li>
<li>
<p>ArtifactId: <em>webapp-javaee7</em></p>
</li>
<li>
<p>Version: <em>1.1</em></p>
</li>
</ul>
</div>
</li>
<li>
<p>Indicar las <strong>coordenadas</strong> de nuestro <strong>proyecto</strong>:</p>
<div class="ulist">
<ul>
<li>
<p>GroupId: <em>org.expertojava</em></p>
</li>
<li>
<p>ArtifactId: <em>ejemplo-rest</em></p>
</li>
<li>
<p>Version: <em>1.0-SNAPSHOT</em></p>
</li>
</ul>
</div>
</li>
<li>
<p>Confirmamos los datos introducidos</p>
</li>
<li>
<p>Para finalizar, especificamos el nombre de nuestro <strong>proyecto en IntelliJ</strong>:</p>
<div class="ulist">
<ul>
<li>
<p>Project Name: <em>ejemplo-rest</em> (este valor tambiÃ©n identificarÃ¡ el nombre del
mÃ³dulo en IntelliJ)</p>
</li>
</ul>
</div>
</li>
<li>
<p>Por comodidad, marcaremos <em>Enable autoimport</em> para importar automÃ¡ticamente cualquier cambio
en el proyecto</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Una vez que hemos creado el proyecto con IntelliJ, el paso siguiente es cambiar
la configuraciÃ³n del <em>pom.mxl</em> que nos ha generado el arquetipo, para incluir las
<em>propiedades</em>, <em>dependencias</em>, <em>plugins</em>,&#8230;&#8203;, que necesitaremos para implementar nuestros
recursos REST.</p>
</div>
<div class="paragraph">
<p>Como ya sabemos, el fichero <em>pom.xml</em> contiene la configuraciÃ³n que
utiliza Maven para construir el proyecto.
A continuaciÃ³n indicamos las <strong>modificaciones en el fichero <em>pom.xml</em></strong> generado
inicialmente, para adecuarlo a nuestras necesidades particulares:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Cambiamos las <strong>propiedades</strong> del proyecto (etiqueta <code>&lt;properties&gt;</code>) por:</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="title">Propiedades del proyecto</div>
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><span class="tok-nt">&lt;properties&gt;</span>
    <span class="tok-nt">&lt;project.build.sourceEncoding&gt;</span>UTF-8<span class="tok-nt">&lt;/project.build.sourceEncoding&gt;</span>
<span class="tok-nt">&lt;/properties&gt;</span></code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Indicamos las <strong>dependencias</strong> del proyecto (etiqueta <code>&lt;dependencies&gt;</code>, en donde se
incluyen las librerÃ­as necesarias para la construcciÃ³n del proyecto).
 En nuestro caso, necesitamos incluir la librerÃ­a <code>javax:javaee-web-api:7.0</code> que contiene el api estÃ¡ndar de
 javaee 7. Marcamos el Ã¡mbito de la librerÃ­a (etiqueta <code>&lt;scope&gt;</code>) como <code>provided</code>.
 Con esto estamos indicando que sÃ³lo necesitaremos el jar
 correspondiente para "compilar" el proyecto, y por lo tanto <strong>no incluiremos</strong> dicho <em>jar</em>,
 en el fichero <strong><em>war</em></strong> generado para nuestra aplicaciÃ³n, ya que dicha librerÃ­a ya estarÃ¡
 disponible desde el servidor de aplicaciones en el que residirÃ¡ nuestra aplicaciÃ³n.</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="title">LibrerÃ­as utilizadas para construir el proyecto (dependencias)</div>
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><span class="tok-nt">&lt;dependencies&gt;</span>
  <span class="tok-nt">&lt;dependency&gt;</span>
    <span class="tok-nt">&lt;groupId&gt;</span>javax<span class="tok-nt">&lt;/groupId&gt;</span>
    <span class="tok-nt">&lt;artifactId&gt;</span>javaee-web-api<span class="tok-nt">&lt;/artifactId&gt;</span>
    <span class="tok-nt">&lt;version&gt;</span>7.0<span class="tok-nt">&lt;/version&gt;</span>
    <span class="tok-nt">&lt;scope&gt;</span>provided<span class="tok-nt">&lt;/scope&gt;</span>
  <span class="tok-nt">&lt;/dependency&gt;</span>
<span class="tok-nt">&lt;/dependencies&gt;</span></code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>A continuaciÃ³n configuramos la <strong>construcciÃ³n</strong> del proyecto (etiqueta <code>&lt;build&gt;</code>),
de la siguiente forma (cambiamos la configuraciÃ³n original por la que mostramos a continuaciÃ³n):</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="title">ConfiguraciÃ³n de la construcciÃ³n del proyecto</div>
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><span class="tok-nt">&lt;build&gt;</span>
  <span class="tok-c">&lt;!-- Especificamos el nombre del war que serÃ¡ usado como context root</span>
<span class="tok-c">       cuando despleguemos la aplicaciÃ³n --&gt;</span>
  <span class="tok-nt">&lt;finalName&gt;</span>${project.artifactId}<span class="tok-nt">&lt;/finalName&gt;</span>

  <span class="tok-nt">&lt;plugins&gt;</span>
    <span class="tok-c">&lt;!-- Compilador de java. Utilizaremos la versiÃ³n 1.7 --&gt;</span>
    <span class="tok-nt">&lt;plugin&gt;</span>
      <span class="tok-nt">&lt;groupId&gt;</span>org.apache.maven.plugins<span class="tok-nt">&lt;/groupId&gt;</span>
      <span class="tok-nt">&lt;artifactId&gt;</span>maven-compiler-plugin<span class="tok-nt">&lt;/artifactId&gt;</span>
      <span class="tok-nt">&lt;version&gt;</span>3.1<span class="tok-nt">&lt;/version&gt;</span>
        <span class="tok-nt">&lt;configuration&gt;</span>
            <span class="tok-nt">&lt;source&gt;</span>1.7<span class="tok-nt">&lt;/source&gt;</span>
            <span class="tok-nt">&lt;target&gt;</span>1.7<span class="tok-nt">&lt;/target&gt;</span>
        <span class="tok-nt">&lt;/configuration&gt;</span>
    <span class="tok-nt">&lt;/plugin&gt;</span>

    <span class="tok-c">&lt;!-- Servidor de aplicaciones wildfly --&gt;</span>
    <span class="tok-nt">&lt;plugin&gt;</span>
      <span class="tok-nt">&lt;groupId&gt;</span>org.wildfly.plugins<span class="tok-nt">&lt;/groupId&gt;</span>
      <span class="tok-nt">&lt;artifactId&gt;</span>wildfly-maven-plugin<span class="tok-nt">&lt;/artifactId&gt;</span>
      <span class="tok-nt">&lt;version&gt;</span>1.0.2.Final<span class="tok-nt">&lt;/version&gt;</span>
      <span class="tok-nt">&lt;configuration&gt;</span>
          <span class="tok-nt">&lt;hostname&gt;</span>localhost<span class="tok-nt">&lt;/hostname&gt;</span>
          <span class="tok-nt">&lt;port&gt;</span>9990<span class="tok-nt">&lt;/port&gt;</span>
      <span class="tok-nt">&lt;/configuration&gt;</span>
    <span class="tok-nt">&lt;/plugin&gt;</span>

    <span class="tok-c">&lt;!-- Cuando generamos el war no es necesario</span>
<span class="tok-c">         que el fichero web.xml estÃ© presente --&gt;</span>
    <span class="tok-nt">&lt;plugin&gt;</span>
        <span class="tok-nt">&lt;groupId&gt;</span>org.apache.maven.plugins<span class="tok-nt">&lt;/groupId&gt;</span>
        <span class="tok-nt">&lt;artifactId&gt;</span>maven-war-plugin<span class="tok-nt">&lt;/artifactId&gt;</span>
        <span class="tok-nt">&lt;version&gt;</span>2.3<span class="tok-nt">&lt;/version&gt;</span>
        <span class="tok-nt">&lt;configuration&gt;</span>
            <span class="tok-nt">&lt;failOnMissingWebXml&gt;</span>false<span class="tok-nt">&lt;/failOnMissingWebXml&gt;</span>
        <span class="tok-nt">&lt;/configuration&gt;</span>
    <span class="tok-nt">&lt;/plugin&gt;</span>
  <span class="tok-nt">&lt;/plugins&gt;</span>
<span class="tok-nt">&lt;/build&gt;</span></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_implementaciÃ³n_del_servicio_recursos_jax_rs">1.4.6. ImplementaciÃ³n del servicio: Recursos JAX-RS</h4>
<div class="paragraph">
<p>Una vez que tenemos la estructura del proyecto, implementaremos los <strong>recursos</strong>
de nuestra aplicaciÃ³n, que serÃ¡n clases Java que utilizarÃ¡n anotaciones JAX-RS
para enlazar y mapear peticiones HTTP especÃ­ficas a mÃ©todos java, los cuales
servirÃ¡n dichas peticiones. En este caso, vamos a ilustrar con un ejemplo, una posible
implementaciÃ³n para el recurso <em>Cliente</em>. Tenemos que diferenciar entre las clases
java que representarÃ¡n <strong>entidades de nuestro dominio</strong> (objetos java que representan
elementos de nuestro negocio, y que serÃ¡n almacenados tÃ­picamente en una base de
datos), de nuestros <strong>recursos JAX-RS</strong>, que tambiÃ©n serÃ¡n clases java anotadas,
y que utilizarÃ¡n objetos de nuestro dominio para llevar a cabo las operaciones
expuestas en el API RESTful que hemos diseÃ±ado.</p>
</div>
<div class="paragraph">
<p>AsÃ­, por ejemplo, implementaremos las clases:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Cliente.java</strong>: representa una entidad del dominio. Contiene atributos, y sus
correspondientes <em>getters</em> y <em>setters</em></p>
</li>
<li>
<p><strong>ClienteResource.java</strong>: representa las operaciones RESTful sobre nuestro recurso <em>Cliente</em> que hemos definido
en esta sesiÃ³n. Es una clase java con anotaciones JAX-RS que nos permitirÃ¡
insertar, modificar, borrar, consultar un cliente, asÃ­ como consultar la lista de
clientes de nuestro sistema.</p>
</li>
</ul>
</div>
<div class="sect4">
<h5 id="_clases_de_nuestro_dominio_entidades_cliente_java">Clases de nuestro dominio (entidades): Cliente.java</h5>
<div class="paragraph">
<p>La clase que representa nuestra entidad del dominio <strong>Cliente</strong> es una clase java plana,
con sus correspondientes atributos, y <em>getters</em> y <em>setters</em>.</p>
</div>
<div class="listingblock">
<div class="title">ImplementaciÃ³n del dominio: cliente.java</div>
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span class="tok-kn">package</span> <span class="tok-n">org</span><span class="tok-o">.</span><span class="tok-na">expertojava</span><span class="tok-o">.</span><span class="tok-na">domain</span><span class="tok-o">;</span>

<span class="tok-nd">@XmlRootElement</span><span class="tok-o">(</span><span class="tok-n">name</span><span class="tok-o">=</span><span class="tok-s">&quot;cliente&quot;</span><span class="tok-o">)</span>
<span class="tok-nd">@XmlAccessorType</span><span class="tok-o">(</span><span class="tok-n">XmlAccessType</span><span class="tok-o">.</span><span class="tok-na">FIELD</span><span class="tok-o">)</span>
<span class="tok-kd">public</span> <span class="tok-kd">class</span> <span class="tok-nc">Cliente</span> <span class="tok-o">{</span>
    <span class="tok-kd">private</span> <span class="tok-kt">int</span> <span class="tok-n">id</span><span class="tok-o">;</span>
    <span class="tok-kd">private</span> <span class="tok-n">String</span> <span class="tok-n">nombre</span><span class="tok-o">;</span>
    <span class="tok-kd">private</span> <span class="tok-n">String</span> <span class="tok-n">apellidos</span><span class="tok-o">;</span>
    <span class="tok-kd">private</span> <span class="tok-n">String</span> <span class="tok-n">direccion</span><span class="tok-o">;</span>
    <span class="tok-kd">private</span> <span class="tok-n">String</span> <span class="tok-n">codPostal</span><span class="tok-o">;</span>
    <span class="tok-kd">private</span> <span class="tok-n">String</span> <span class="tok-n">ciudad</span><span class="tok-o">;</span>

    <span class="tok-kd">public</span> <span class="tok-kt">int</span> <span class="tok-nf">getId</span><span class="tok-o">()</span> <span class="tok-o">{</span> <span class="tok-k">return</span> <span class="tok-n">id</span><span class="tok-o">;</span> <span class="tok-o">}</span>
    <span class="tok-kd">public</span> <span class="tok-kt">void</span> <span class="tok-nf">setId</span><span class="tok-o">(</span><span class="tok-kt">int</span> <span class="tok-n">id</span><span class="tok-o">)</span> <span class="tok-o">{</span> <span class="tok-k">this</span><span class="tok-o">.</span><span class="tok-na">id</span> <span class="tok-o">=</span> <span class="tok-n">id</span><span class="tok-o">;</span> <span class="tok-o">}</span>

    <span class="tok-kd">public</span> <span class="tok-n">String</span> <span class="tok-nf">getNombre</span><span class="tok-o">()</span> <span class="tok-o">{</span> <span class="tok-k">return</span> <span class="tok-n">nombre</span><span class="tok-o">;</span> <span class="tok-o">}</span>
    <span class="tok-kd">public</span> <span class="tok-kt">void</span> <span class="tok-nf">setNombre</span><span class="tok-o">(</span><span class="tok-n">String</span> <span class="tok-n">nom</span><span class="tok-o">)</span> <span class="tok-o">{</span> <span class="tok-k">this</span><span class="tok-o">.</span><span class="tok-na">nombre</span> <span class="tok-o">=</span> <span class="tok-n">nom</span><span class="tok-o">;</span> <span class="tok-o">}</span>

    <span class="tok-kd">public</span> <span class="tok-n">String</span> <span class="tok-nf">getApellidos</span><span class="tok-o">()</span> <span class="tok-o">{</span> <span class="tok-k">return</span> <span class="tok-n">apellidos</span><span class="tok-o">;</span> <span class="tok-o">}</span>
    <span class="tok-kd">public</span> <span class="tok-kt">void</span> <span class="tok-nf">setApellidos</span><span class="tok-o">(</span><span class="tok-n">String</span> <span class="tok-n">apellidos</span><span class="tok-o">)</span> <span class="tok-o">{</span>
        <span class="tok-k">this</span><span class="tok-o">.</span><span class="tok-na">apellidos</span> <span class="tok-o">=</span> <span class="tok-n">apellidos</span><span class="tok-o">;</span> <span class="tok-o">}</span>

    <span class="tok-kd">public</span> <span class="tok-n">String</span> <span class="tok-nf">getDireccion</span><span class="tok-o">()</span> <span class="tok-o">{</span> <span class="tok-k">return</span> <span class="tok-n">direccion</span><span class="tok-o">;</span> <span class="tok-o">}</span>
    <span class="tok-kd">public</span> <span class="tok-kt">void</span> <span class="tok-nf">setDireccion</span><span class="tok-o">(</span><span class="tok-n">String</span> <span class="tok-n">dir</span><span class="tok-o">)</span> <span class="tok-o">{</span> <span class="tok-k">this</span><span class="tok-o">.</span><span class="tok-na">direccion</span> <span class="tok-o">=</span> <span class="tok-n">dir</span><span class="tok-o">;</span> <span class="tok-o">}</span>

    <span class="tok-kd">public</span> <span class="tok-n">String</span> <span class="tok-nf">getCodPostal</span><span class="tok-o">()</span> <span class="tok-o">{</span> <span class="tok-k">return</span> <span class="tok-n">codPostal</span><span class="tok-o">;</span> <span class="tok-o">}</span>
    <span class="tok-kd">public</span> <span class="tok-kt">void</span> <span class="tok-nf">setCodPostal</span><span class="tok-o">(</span><span class="tok-n">String</span> <span class="tok-n">cp</span><span class="tok-o">)</span> <span class="tok-o">{</span> <span class="tok-k">this</span><span class="tok-o">.</span><span class="tok-na">codPostal</span> <span class="tok-o">=</span> <span class="tok-n">cp</span><span class="tok-o">;</span> <span class="tok-o">}</span>

    <span class="tok-kd">public</span> <span class="tok-n">String</span> <span class="tok-nf">getCiudad</span><span class="tok-o">()</span> <span class="tok-o">{</span> <span class="tok-k">return</span> <span class="tok-n">ciudad</span><span class="tok-o">;</span> <span class="tok-o">}</span>
    <span class="tok-kd">public</span> <span class="tok-kt">void</span> <span class="tok-nf">setCiudad</span><span class="tok-o">(</span><span class="tok-n">String</span> <span class="tok-n">ciudad</span><span class="tok-o">)</span> <span class="tok-o">{</span> <span class="tok-k">this</span><span class="tok-o">.</span><span class="tok-na">ciudad</span> <span class="tok-o">=</span> <span class="tok-n">ciudad</span><span class="tok-o">;</span> <span class="tok-o">}</span>
<span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Hemos anotado la clase <em>Cliente</em> con <code>@XmlRootElement</code> y <code>@XmlAccessorType</code>.
Hablaremos de estas anotaciones en sesiones posteriores, las cuales se encargan del serializado/deserializado
del cuerpo del mensaje (en formato xml o json) a nuestra clase java <em>Cliente</em>.</p>
</div>
</div>
<div class="sect4">
<h5 id="_clases_de_nuestro_servicio_restful_clienteresource_java">Clases de nuestro servicio RESTful: ClienteResource.java</h5>
<div class="paragraph">
<p>Una vez definido el objeto de nuestro dominio que representarÃ¡ un objeto <em>Cliente</em>,
vamos a ver cÃ³mo implementar nuestros servicio JAX-RS para que diferentes usuarios,
de forma remota, puedan interactuar con nuestra base de datos de clientes.</p>
</div>
<div class="paragraph">
<p>La implementaciÃ³n del servicio es lo que se denomina una <strong>resource class</strong>, que no es
mÃ¡s que una clase java que utiliza anotaciones JAX-RS.</p>
</div>
<div class="paragraph">
<p>Por defecto, una nueva instancia de nuestra clase de recursos se crea para <strong>cada
peticiÃ³n</strong> a ese recurso. Es lo que se conoce como un objeto <strong>per-request</strong>. Esto
implica que se crea un objeto Java para procesar <strong>cada</strong> peticiÃ³n de entrada,
y se "destruye" automÃ¡ticamente cuando la peticiÃ³n
se ha servido. <em>Per-request</em> tambiÃ©n implica "sin estado", ya que no se
guarda el estado del servicio entre peticiones.</p>
</div>
<div class="paragraph">
<p>Comencemos con la implementaciÃ³n del servicio:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span class="tok-kn">package</span> <span class="tok-n">org</span><span class="tok-o">.</span><span class="tok-na">expertojava</span><span class="tok-o">.</span><span class="tok-na">services</span><span class="tok-o">;</span>

<span class="tok-kn">import</span> <span class="tok-nn">...</span><span class="tok-o">;</span>

<span class="tok-nd">@Path</span><span class="tok-o">(</span><span class="tok-s">&quot;/clientes&quot;</span><span class="tok-o">)</span>
<span class="tok-kd">public</span> <span class="tok-kd">class</span> <span class="tok-nc">ClienteResource</span> <span class="tok-o">{</span>

    <span class="tok-kd">private</span> <span class="tok-kd">static</span> <span class="tok-n">Map</span><span class="tok-o">&lt;</span><span class="tok-n">Integer</span><span class="tok-o">,</span> <span class="tok-n">Cliente</span><span class="tok-o">&gt;</span> <span class="tok-n">clienteDB</span> <span class="tok-o">=</span>
            <span class="tok-k">new</span> <span class="tok-n">ConcurrentHashMap</span><span class="tok-o">&lt;</span><span class="tok-n">Integer</span><span class="tok-o">,</span> <span class="tok-n">Cliente</span><span class="tok-o">&gt;();</span>
    <span class="tok-kd">private</span> <span class="tok-kd">static</span> <span class="tok-n">AtomicInteger</span> <span class="tok-n">idContador</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-nf">AtomicInteger</span><span class="tok-o">();</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Podemos observar que <em>ClientResource</em> es una clase java plana,y  que no implementa
ninguna interfaz JAX-RS particular. La anotaciÃ³n <code>javax.ws.rs.Path</code> indica que
la clase <em>ClienteResource</em> es un servicio JAX-RS. Todas las clases que queramos que
sean "reconocidas" como servicios JAX-RS tienen que tener esta anotaciÃ³n. FÃ­jate que
esta anotaciÃ³n tiene el valor <code>/clientes</code>. Este valor representa la raÃ­z relativa
de la URI de nuestro servicio RESTful. Si la URI absoluta de nuestro servidor es, por
ejemplo: <em><a href="http://expertojava.org" class="bare">http://expertojava.org</a></em>, los mÃ©todos expuestos por nuestra clase <em>ClienteResource</em>
 estarÃ­an disponibles bajo la URI <em><a href="http://expertojava.org/clientes" class="bare">http://expertojava.org/clientes</a></em>.</p>
</div>
<div class="paragraph">
<p>En nuestra clase, definimos un Mapa para el campo <code>ClienteDB</code>, que almacenarÃ¡
en memoria a los objetos <em>Cliente</em> de nuestro sistema. Utilizamos un <em>java.util.concurrent.ConcurrentHashMap</em>
como tipo de <em>clienteDB</em> ya que nuestro recurso serÃ¡ accedido <strong>concurrentemente</strong>
por los usuarios de nuestro servicio rest. El campo <code>idContador</code> lo utilizaremos para
generar nuevos identificadores de nuestros objetos <em>Cliente</em> creados. El tipo de este
campo es <em>java.util.concurrent.atomic.AtomicInteger</em> para garantizar que siempre
generaremos un identificador Ãºnico aunque tengamos peticiones concurrentes.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="title">JustificaciÃ³n del caracter <strong>static</strong> de los atributos</div>
<div class="paragraph">
<p>Como nuestros objetos serÃ¡n de tipo <strong>per-request</strong>, el
runtime de JAX-RS crearÃ¡ una instancia de <em>ClienteResource</em> <strong>para cada
peciÃ³n</strong> que se realice sobre nuestro servicio. La mÃ¡quina virtual de java ejecutarÃ¡
cada peticiÃ³n a nuestro servicio en un hilo (<em>thread</em>) diferente, permitiendo asÃ­ el acceso
concurrente a nuestro recurso. Puesto que hemos decidido almacenar
en memoria la informaciÃ³n de los clientes, necesitamos que los atributos <strong>clienteDB</strong> y
<strong>idContador</strong> sean <strong>static</strong>, para que todas las instancias de <em>ClienteResource</em> tengan
acceso a la lista de clientes en memoria y no haya problemas de concurrencia. En realidad, lo que estamos haciendo con Ã©sto
es permitir que el servicio guarde el estado entre peticiones. En un sistema real,
<em>ClienteResource</em> probablemente interactÃºe con una base de datos para almacenar y recuperar la informaciÃ³n de los
clientes, y por lo tanto, no necesitaremos guardar el estado entre peticiones.</p>
</div>
<div class="paragraph">
<p>Una mejor soluciÃ³n serÃ­a no utilizar variables estÃ¡ticas, y definir nuestro servicio
como <strong>singleton</strong>. Si hacemos Ã©sto, solamente se crearÃ­a una instancia de <em>clienteResource</em>
y estarÃ­amos manteniendo el estado de las peticiones. En la siguiente sesiÃ³n
explicaremos cÃ³mo configurar un servicio como <strong>singleton</strong>. Por simplicidad, de momento
optaremos por la opciÃ³n de que los objetos RESTful sean <strong>per-request</strong>.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="_creaciÃ³n_de_clientes">CreaciÃ³n de clientes</h5>
<div class="paragraph">
<p>Para implementar la creaciÃ³n de un nuevo cliente utilizamos el mismo modelo que
hemos diseÃ±ado previamente. Una peticiÃ³n HTTP POST envÃ­a un documento XML
que representa al cliente que queremos crear.</p>
</div>
<div class="paragraph">
<p>El cÃ³digo para crear nuevos clientes en nuestro sistema podrÃ­a ser Ã©ste:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span class="tok-nd">@POST</span> <i class="conum" data-value="1"></i><b>(1)</b>
<span class="tok-nd">@Consumes</span><span class="tok-o">(</span><span class="tok-s">&quot;application/xml&quot;</span><span class="tok-o">)</span> <i class="conum" data-value="2"></i><b>(2)</b>
<span class="tok-kd">public</span> <span class="tok-n">Response</span> <span class="tok-nf">crearCliente</span><span class="tok-o">(</span><span class="tok-n">Cliente</span> <span class="tok-n">cli</span><span class="tok-o">)</span> <span class="tok-o">{</span> <i class="conum" data-value="3"></i><b>(3)</b>
  <span class="tok-c1">//el parÃ¡metro cli se instancia con los datos del cliente del body del mensaje HTTP</span>
  <span class="tok-n">idContador</span><span class="tok-o">++;</span>
  <span class="tok-n">cli</span><span class="tok-o">.</span><span class="tok-na">setId</span><span class="tok-o">(</span><span class="tok-n">idContador</span><span class="tok-o">.</span><span class="tok-na">incrementAndGet</span><span class="tok-o">());</span>
  <span class="tok-n">clienteDB</span><span class="tok-o">.</span><span class="tok-na">put</span><span class="tok-o">(</span><span class="tok-n">cli</span><span class="tok-o">.</span><span class="tok-na">getId</span><span class="tok-o">(),</span> <span class="tok-n">cli</span><span class="tok-o">);</span>   <i class="conum" data-value="4"></i><b>(4)</b>
  <span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">out</span><span class="tok-o">.</span><span class="tok-na">println</span><span class="tok-o">(</span><span class="tok-s">&quot;Cliente creado &quot;</span> <span class="tok-o">+</span> <span class="tok-n">cli</span><span class="tok-o">.</span><span class="tok-na">getId</span><span class="tok-o">());</span> <i class="conum" data-value="5"></i><b>(5)</b>
  <span class="tok-k">return</span> <span class="tok-n">Response</span><span class="tok-o">.</span><span class="tok-na">created</span><span class="tok-o">(</span><span class="tok-n">URI</span><span class="tok-o">.</span><span class="tok-na">create</span><span class="tok-o">(</span><span class="tok-s">&quot;/clientes/&quot;</span>
                <span class="tok-o">+</span> <span class="tok-n">cli</span><span class="tok-o">.</span><span class="tok-na">getId</span><span class="tok-o">())).</span><span class="tok-na">build</span><span class="tok-o">();</span>  <i class="conum" data-value="6"></i><b>(6)</b>
    <span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>se recibe una peticiÃ³n POST</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>el cuerpo de la peticiÃ³n debe tener formato xml</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>contiene la informaciÃ³n del documento xml del cuerpo de la peticiÃ³n de entrada</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>se aÃ±ade el nuevo objeto <em>Cliente</em> a nuestro "mapa" de clientes (<strong>clienteDB</strong>)</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>este mÃ©todo se ejectua en el servidor, por lo que el mensaje sÃ³lo serÃ¡ visible, por
ejemplo, si consultamos los mensajes generados por el servidor durante la ejecuciÃ³n
el mÃ©todo devuelve un cÃ³digo de respuesta <code>201 Created</code>, junto con una
cabecera <strong>Location</strong> apuntando a la URI absoluta del cliente que acabamos de crear</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Vamos a explicar la implementaciÃ³n con mÃ¡s detalle.</p>
</div>
<div class="paragraph">
<p>Para enlazar peticiones HTTP POST con el mÃ©todo <em>crearCliente()</em>, lo anotamos
con la anotaciÃ³n <code>@javax.ws.rs.POST</code>. La anotaciÃ³n <em>@Path</em>, combinada con la
anotaciÃ³n <em>@POST</em>, enlaza todas las peticiones POST dirigidas a la URI relativa
<em>/clientes</em> al mÃ©todo Java <em>crearCliente()</em>.</p>
</div>
<div class="paragraph">
<p>La anotaciÃ³n <code>javax.ws.rs.Consumes</code> aplicada a <em>crearCliente()</em> especifica quÃ©
<em>media type</em> espera el mÃ©todo en el cuerpo del mensaje HTTP de entrada. Si el cliente
incluye en su peticiÃ³n POST un <em>media type</em> diferente de XML, se envÃ­a un cÃ³digo de
error al cliente.</p>
</div>
<div class="paragraph">
<p>El mÃ©todo <em>crearCliente()</em> tiene un parÃ¡metro de tipo <em>Cliente</em>. En
JAX-RS, <strong>cualquier parÃ¡metro no anotado</strong> con anotaciones JAX-RS se considera que es
una <strong>representaciÃ³n del cuerpo del mensaje</strong> de la peticiÃ³n de entrada HTTP. Las anotaciones
que hemos introducido en la clase <em>Cliente</em> de nuestro dominio, realizan el trabajo de
"convertir" el documento xml contenido en el cuerpo de la peticiÃ³n htpp de entrada en
una instancia de nuestra clase Cliente.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Solamente UNO de los parÃ¡metros del mÃ©todo Java puede representar el cuerpo del
mensaje de la peticiÃ³n HTTP. Esto significa <strong>que el resto de parÃ¡metros</strong> deben
anotarse con alguna anotaciÃ³n JAX-RS, que veremos mÃ¡s adelante.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>El mÃ©todo <em>crearCliente()</em>
devuelve una respuesta de tipo <code>javax.ws.rs.core.Response</code>. El mÃ©todo estÃ¡tico
<code>Response.created()</code> crea un objeto <em>Response</em> que contiene un cÃ³digo de estado
<code>201 Created</code>. TambiÃ©n aÃ±ade una cabecera <strong>Location</strong> con un valor similar a:
<strong><a href="http://expertojava.org/clientes/123" class="bare">http://expertojava.org/clientes/123</a></strong>, dependiendo del valor del valor de base de
la raÃ­z de la URI del servidor y el identificador generado para el objeto <em>Cliente</em>
(en este caso se habrÃ­a generado el identificador 123). MÃ¡s adelante explicaremos
con detalle el uso de la clase <em>Response</em>.</p>
</div>
</div>
<div class="sect4">
<h5 id="_consulta_de_clientes">Consulta de clientes</h5>
<div class="paragraph">
<p>A continuaciÃ³n mostramos un posible cÃ³digo para <strong>consultar</strong> la informaciÃ³n de <strong>un cliente</strong>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span class="tok-nd">@GET</span>
<span class="tok-nd">@Path</span><span class="tok-o">(</span><span class="tok-s">&quot;{id}&quot;</span><span class="tok-o">)</span>
<span class="tok-nd">@Produces</span><span class="tok-o">(</span><span class="tok-s">&quot;application/xml&quot;</span><span class="tok-o">)</span>
<span class="tok-kd">public</span> <span class="tok-n">Cliente</span> <span class="tok-nf">recuperarClienteId</span><span class="tok-o">(</span><span class="tok-nd">@PathParam</span><span class="tok-o">(</span><span class="tok-s">&quot;id&quot;</span><span class="tok-o">)</span> <span class="tok-kt">int</span> <span class="tok-n">id</span><span class="tok-o">)</span> <span class="tok-o">{</span>
  <span class="tok-kd">final</span> <span class="tok-n">Cliente</span> <span class="tok-n">cli</span> <span class="tok-o">=</span> <span class="tok-n">clienteDB</span><span class="tok-o">.</span><span class="tok-na">get</span><span class="tok-o">(</span><span class="tok-n">id</span><span class="tok-o">);</span>
  <span class="tok-k">if</span> <span class="tok-o">(</span><span class="tok-n">cli</span> <span class="tok-o">==</span> <span class="tok-kc">null</span><span class="tok-o">)</span> <span class="tok-o">{</span>
      <span class="tok-k">throw</span> <span class="tok-k">new</span> <span class="tok-nf">WebApplicationException</span><span class="tok-o">(</span><span class="tok-n">Response</span><span class="tok-o">.</span><span class="tok-na">Status</span><span class="tok-o">.</span><span class="tok-na">NOT_FOUND</span><span class="tok-o">);</span>
  <span class="tok-o">}</span>
  <span class="tok-k">return</span> <span class="tok-k">new</span> <span class="tok-nf">Cliente</span><span class="tok-o">(</span><span class="tok-n">cli</span><span class="tok-o">.</span><span class="tok-na">getId</span><span class="tok-o">(),</span> <span class="tok-n">cli</span><span class="tok-o">.</span><span class="tok-na">getNombre</span><span class="tok-o">(),</span> <span class="tok-n">cli</span><span class="tok-o">.</span><span class="tok-na">getApellidos</span><span class="tok-o">(),</span>
              <span class="tok-n">cli</span><span class="tok-o">.</span><span class="tok-na">getDireccion</span><span class="tok-o">(),</span> <span class="tok-n">cli</span><span class="tok-o">.</span><span class="tok-na">getCodPostal</span><span class="tok-o">(),</span> <span class="tok-n">cli</span><span class="tok-o">.</span><span class="tok-na">getCiudad</span><span class="tok-o">());</span>
<span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>En este caso, anotamos el mÃ©todo <code>recuperarClienteId()</code> con la anotaciÃ³n
<code>@javax.ws.rs.GET</code> para enlazar las operaciones HTTP GET con este mÃ©todo Java.</p>
</div>
<div class="paragraph">
<p>TambiÃ©n anotamos <em>recuperarClienteId()</em> con la anotaciÃ³n <code>@javax.ws.rs.PRODUCES</code>.
Esta anotaciÃ³n indica a JAX-RS que valor tiene la cabecera HTTP <strong>Content-Type</strong> en
la respuesta proporcionada por la operaciÃ³n GET. En este caso, estamos indicando que
serÃ¡ de tipo <strong>application/xml</strong>.</p>
</div>
<div class="paragraph">
<p>En la implementaciÃ³n del mÃ©todo utilizamos el parÃ¡metro <code>id</code> para consultar si
existe un objeto <em>Cliente</em> en nuestro mapa <strong>clienteDB</strong>. Si dicho cliente no existe,
lanzaremos la excepciÃ³n <code>javax.ws.rs.WebApplictionException</code>. Esta excepciÃ³n
provocarÃ¡ que el cÃ³digo de respuesta HTTP sea <code>404 Not Found</code>, y significa que
el recurso cliente requerido no existe. Discutiremos mÃ¡s adelante el tema del
manejo de excepciones.</p>
</div>
</div>
<div class="sect4">
<h5 id="_modificaciÃ³n_de_clientes">ModificaciÃ³n de clientes</h5>
<div class="paragraph">
<p>Vamos a mostrar cÃ³mo serÃ­a el cÃ³digo para modificar un cliente:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span class="tok-nd">@PUT</span>
<span class="tok-nd">@Path</span><span class="tok-o">(</span><span class="tok-s">&quot;{id}&quot;</span><span class="tok-o">)</span>
<span class="tok-nd">@Consumes</span><span class="tok-o">(</span><span class="tok-s">&quot;application/xml&quot;</span><span class="tok-o">)</span>
<span class="tok-kd">public</span> <span class="tok-kt">void</span> <span class="tok-nf">modificarCliente</span><span class="tok-o">(</span><span class="tok-nd">@PathParam</span><span class="tok-o">(</span><span class="tok-s">&quot;id&quot;</span><span class="tok-o">)</span> <span class="tok-kt">int</span> <span class="tok-n">id</span><span class="tok-o">,</span>
                            <span class="tok-n">Cliente</span> <span class="tok-n">nuevoCli</span><span class="tok-o">)</span> <span class="tok-o">{</span>

  <span class="tok-n">Cliente</span> <span class="tok-n">actual</span> <span class="tok-o">=</span> <span class="tok-n">clienteDB</span><span class="tok-o">.</span><span class="tok-na">get</span><span class="tok-o">(</span><span class="tok-n">id</span><span class="tok-o">);</span>
  <span class="tok-k">if</span> <span class="tok-o">(</span><span class="tok-n">actual</span> <span class="tok-o">==</span> <span class="tok-kc">null</span><span class="tok-o">)</span>
      <span class="tok-k">throw</span> <span class="tok-k">new</span> <span class="tok-nf">WebApplicationException</span><span class="tok-o">(</span><span class="tok-n">Response</span><span class="tok-o">.</span><span class="tok-na">Status</span><span class="tok-o">.</span><span class="tok-na">NOT_FOUND</span><span class="tok-o">);</span>

  <span class="tok-n">actual</span><span class="tok-o">.</span><span class="tok-na">setNombre</span><span class="tok-o">(</span><span class="tok-n">nuevoCli</span><span class="tok-o">.</span><span class="tok-na">getNombre</span><span class="tok-o">());</span> <span class="tok-n">actual</span><span class="tok-o">.</span><span class="tok-na">setApellidos</span><span class="tok-o">(</span><span class="tok-n">nuevoCli</span><span class="tok-o">.</span><span class="tok-na">getApellidos</span><span class="tok-o">());</span>
  <span class="tok-n">actual</span><span class="tok-o">.</span><span class="tok-na">setDireccion</span><span class="tok-o">(</span><span class="tok-n">nuevoCli</span><span class="tok-o">.</span><span class="tok-na">getDireccion</span><span class="tok-o">());</span>
  <span class="tok-n">actual</span><span class="tok-o">.</span><span class="tok-na">setCodPostal</span><span class="tok-o">(</span><span class="tok-n">nuevoCli</span><span class="tok-o">.</span><span class="tok-na">getCodPostal</span><span class="tok-o">());</span>
  <span class="tok-n">actual</span><span class="tok-o">.</span><span class="tok-na">setCiudad</span><span class="tok-o">(</span><span class="tok-n">nuevoCli</span><span class="tok-o">.</span><span class="tok-na">getCiudad</span><span class="tok-o">());</span>
<span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Anotamos el mÃ©todo <strong>modificarCliente()</strong> con <code>@javax.ws.rs.PUT</code> para enlazar
las peticiones HTTP PUT a este mÃ©todo. Al igual que hemos hecho con
<strong>recuperarClienteId()</strong>, el mÃ©todo <strong>modificarCliente()</strong> estÃ¡ anotado adicionalmente
con <code>@Path</code>, de forma que podamos atender peticiones a travÃ©s de las URIs
<strong>/clientes/{id}</strong>.</p>
</div>
<div class="paragraph">
<p>El mÃ©todo <strong>modificarCliente()</strong> tiene dos parÃ¡metros. El primero es un parÃ¡metro
<code>id</code> que representa el objeto <em>Cliente</em> que estamos modificando. Al igual que
ocurrÃ­a con el mÃ©todo <strong>recuperarClienteId()</strong>, utilizamos la anotaciÃ³n <code>@PathParam</code>
para extraer el identificador a partir de la URI de la peticiÃ³n de entrada.
El segundo parÃ¡metro es un objeto <code>Cliente</code>, que representa
el cuerpo del mensaje de entrada, ya que no tiene ninguna anotaciÃ³n JAX-RS.</p>
</div>
<div class="paragraph">
<p>El mÃ©todo intenta encontrar un objeto <em>Cliente</em> en nuestro mapa <strong>clienteDB</strong>.
Si no existe,
provocamos una <strong>WebApplicationException</strong> que enviarÃ¡ una respuesta al usuario
con el cÃ³digo <code>404 Not Found</code>. Si el objeto <em>Cliente</em> existe, modificamos
nuestro objeto <em>Cliente</em> existente con los nuevos valores que obtenemos de la peticiÃ³n
de entrada.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_construcciÃ³n_y_despliegue_del_servicio">1.4.7. ConstrucciÃ³n y despliegue del servicio</h4>
<div class="paragraph">
<p>Una vez implementado nuestro servicio RESTful, necesitamos poner en marcha el proceso
de construcciÃ³n. El proceso de construcciÃ³n compilarÃ¡,&#8230;&#8203;, empaquetarÃ¡, &#8230;&#8203;, y finalmente
nos permitirÃ¡ desplegar nuestro servicio en el servidor de aplicaciones.</p>
</div>
<div class="paragraph">
<p>Para poder, empaquetar nuestro servicio RESTful como un <em>war</em>, que se desplegarÃ¡ en el
servidor de aplicaciones, vamos a incluir un "proveedor" de servicios JAX-RS,
en el descriptor de despliegue de nuestra aplicaciÃ³n (fichero <strong><em>web.xml</em></strong>). En la siguiente sesiÃ³n
justificaremos la existencia de dicho "proveedor" (que serÃ¡ un <em>servlet</em>)
y explicaremos el modelo de
despliegue de los servicios JAX-RS. Los pasos a seguir desde IntelliJ para <strong>configurar el
despliegue</strong> de nuestro servicio son:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>AÃ±adimos el directorio WEB-INF como subdirectorio de webapp</p>
</li>
<li>
<p>Nos vamos a File&#8594;Project Structure&#8230;&#8203;&#8594;Facets&#8594;Web, y aÃ±adimos el fichero
<em>web.xml</em> (en el panel <em>Deployment descriptors</em>, pulsamos sobre <em>+</em>, y seleccionamos <em>web.xml</em>).
Editamos este fichero para aÃ±adir el servlet que servirÃ¡ las peticiones de
nuestros servicios REST, indicando cuÃ¡l serÃ¡ la ruta en la que estarÃ¡n
disponibles dichos servicios (en nuestro ejemplo indicaremos la ruta "/rest/").
Dicha ruta es relativa a la ruta del contexto de nuestra aplicaciÃ³n,
y que por defecto, es el nombre del artefacto ".war" desplegado, que hemos indicado
en la etiqueta &lt;finalName&gt; dentro del &lt;build&gt; del fichero de configuraciÃ³n de Maven (pom.xml).</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="title">Contenido del fichero <em>web.xml</em>:</div>
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><span class="tok-nt">&lt;web-app</span> <span class="tok-na">version=</span><span class="tok-s">&quot;3.0&quot;</span> <span class="tok-na">xmlns=</span><span class="tok-s">&quot;http://java.sun.com/xml/ns/javaee&quot;</span>
        <span class="tok-na">xmlns:xsi=</span><span class="tok-s">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span>
        <span class="tok-na">xsi:schemaLocation=</span><span class="tok-s">&quot;http://java.sun.com/xml/ns/javaee</span>
<span class="tok-s">        http://java.sun.com/xml/ns/javaee/web-app_3_0.xsd&quot;</span><span class="tok-nt">&gt;</span>
    <span class="tok-c">&lt;!-- One of the way of activating REST Services is adding these lines,</span>
<span class="tok-c">    the server is responsible for adding the corresponding servlet automatically,</span>
<span class="tok-c">    if the src folder has the Annotations to receive REST invocation--&gt;</span>
    <span class="tok-nt">&lt;servlet-mapping&gt;</span>
        <span class="tok-nt">&lt;servlet-name&gt;</span>javax.ws.rs.core.Application<span class="tok-nt">&lt;/servlet-name&gt;</span>
        <span class="tok-nt">&lt;url-pattern&gt;</span>/rest/*<span class="tok-nt">&lt;/url-pattern&gt;</span>
    <span class="tok-nt">&lt;/servlet-mapping&gt;</span>
<span class="tok-nt">&lt;/web-app&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>A continuaciÃ³n ya estamos en disposiciÃ³n de iniciar la construcciÃ³n del proyecto
con Maven para compilar, empaquetar y desplegar nuestro servicio en Wildfly.</p>
</div>
<div class="paragraph">
<p><strong>Si utilizamos el terminal</strong>, la secuencia de pasos para empaquetar y desplegar nuestro
proyecto serÃ­an:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code>cd ejemplo-rest  <i class="conum" data-value="1"></i><b>(1)</b>
mvn package  <i class="conum" data-value="2"></i><b>(2)</b>
./usr/local/wildfly-8.2.1.Final/bin/standalone.sh  <i class="conum" data-value="3"></i><b>(3)</b>
mvn wildfly:deploy  <i class="conum" data-value="4"></i><b>(4)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Nos situamos en el directorio que contiene el pom.xml de nuestro proyecto</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Empaquetamos el proyecto (obtendremos el .war)</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Arrancamos el servidor wildfly</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Desplegamos el war generado en el servidor wildfly</td>
</tr>
</table>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Secuencia correcta de acciones</div>
<div class="paragraph">
<p>En ejecuciones posteriores, despuÃ©s de realizar modificaciones en nuestro
cÃ³digo, es recomendable ejecutar "mvn clean" previamente al empaquetado del proyecto.</p>
</div>
<div class="paragraph">
<p>Por lo tanto, y suponiendo que el servidor de aplicaciones <strong>ya estÃ¡ en marcha</strong>,
la secuencia de acciones (comandos maven) que deberÃ­amos realizar para asegurarnos
de que vamos a ejecutar exactamente la aplicaciÃ³n con los Ãºltimos cambios que hayamos
introducido son:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>mvn wildfly:undeploy</p>
</li>
<li>
<p>mvn clean</p>
</li>
<li>
<p>mvn package</p>
</li>
<li>
<p>mvn wildfly:deploy</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>TambiÃ©n podrÃ­amos realizar todas estas acciones con un Ãºnico comando maven:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>mvn wildfly:undeploy clean package wildfly:deploy</p>
</li>
</ul>
</div>
</div>
</div>
<div class="paragraph">
<p><strong>Si utilizamos IntelliJ</strong>, aÃ±adiremos un nuevo elemento de configuraciÃ³n de ejecuciÃ³n desde
Run&#8594;Edit Configurations. Pulsamos el icono <code>+</code> y aÃ±adimos la configuraciÃ³n de tipo
JBosss Server&#8594;Local. Podemos ponerle por ejemplo como nombre "Wilfdly start". A continuaciÃ³n configuramos la
ruta del servidor wildfly como: /usr/local/wildfly-8.2.1.Final.</p>
</div>
<div class="paragraph">
<p>Cuando lancemos este
elemento de ejecuciÃ³n desde IntelliJ, automÃ¡ticamente se construirÃ¡ el proyecto (obtendremos el war),
y arrancaremos wildfly. Para desplegar el war, utlizaremos la ventana <em>Maven Projects</em> y haremos
 doble click sobre ejemplo-rest&#8594;Plugins&#8594;wildfly&#8594;wildfly:deploy</p>
</div>
</div>
<div class="sect3">
<h4 id="_probando_nuestro_servicio">1.4.8. Probando nuestro servicio</h4>
<div class="paragraph">
<p>Podemos probar nuestro servicio de varias formas. Vamos a mostrar como hacerlo directamente
desde lÃ­nea de comandos, utilizando IntelliJ, o bien utilizando la herramienta Postman (que tenÃ©is
disponible desde el navegador Chrome).</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">InvocaciÃ³n del servicio desde lÃ­nea de comandos</dt>
<dd>
<p>Utilizaremos la herramienta <em>curl</em>. Por ejemplo, para realizar una inserciÃ³n de un cliente,
el comando serÃ­a:</p>
<div class="literalblock">
<div class="content">
<pre>curl -i -H "Accept: application/xml" -H "Content-Type: application/xml" -X POST -d @cliente.xml http://localhost:8080/ejemplo-rest/rest/clientes/</pre>
</div>
</div>
</dd>
</dl>
</div>
<div class="paragraph">
<p>En donde:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">-i</dt>
<dd>
<p>TambiÃ©n se puede utilizar la opciÃ³n equivalente <strong>--include</strong>. Indica que se debe incluir
las cabeceras HTTP en la respuesta recibida. Recuerda que la peticiÃ³n POST devuelve en
la cabecera <strong>Location</strong> el enlace del nuevo recurso creado (puede hacerlo en una cabedera <strong>Location</strong>,
 o como un campo <em>&lt;link&gt;</em> del elemento creado en el cuerpo del mensaje, lo veremos mÃ¡s adelante).
 Esta informaciÃ³n serÃ¡ necesaria
para poder consultar la informaciÃ³n del nuevo cliente creado.</p>
</dd>
<dt class="hdlist1">-H</dt>
<dd>
<p>Indica un par <em>cabecera</em>:_valor_. En nuestro caso lo utilizamos para especificar los
valores de las cabeceras HTTP <strong>Accept</strong> y <strong>Content-Type</strong></p>
</dd>
<dt class="hdlist1">-X</dt>
<dd>
<p>Indica el mÃ©todo a invocar (GET, POST, PUT,&#8230;&#8203;)</p>
</dd>
<dt class="hdlist1">-d</dt>
<dd>
<p>TambiÃ©n se puede utilizar <strong>--data</strong>. Indica cuÃ¡les son los datos enviados en el mensaje de
entrada en una peticiÃ³n POST. Si los datos especificados van precedidos por <code>@</code>, estamos
indicando que dichos datos estÃ¡n en un fichero. Por ejemplo, en la orden anterior, escribimos
en el fichero <strong>cliente.xml</strong> los datos del cliente que queremos aÃ±adir en nuestro sistema.</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>El contenido del fichero cliente.xml podrÃ­a ser Ã©ste:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><span class="tok-cp">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
<span class="tok-nt">&lt;clientes&gt;</span>
  <span class="tok-nt">&lt;cliente&gt;</span>
    <span class="tok-nt">&lt;nombre&gt;</span>Pepe <span class="tok-nt">&lt;/nombre&gt;</span>
    <span class="tok-nt">&lt;apellidos&gt;</span>Garcia Lopez<span class="tok-nt">&lt;/apellido1&gt;</span>
    <span class="tok-nt">&lt;direccion&gt;</span>Calle del pino, 3<span class="tok-nt">&lt;/apellido2&gt;</span>
    <span class="tok-nt">&lt;codPostal&gt;</span>0001<span class="tok-nt">&lt;/codPostal&gt;</span>
    <span class="tok-nt">&lt;ciudad&gt;</span>Alicante<span class="tok-nt">&lt;/ciudad&gt;</span>
  <span class="tok-nt">&lt;/cliente&gt;</span>
<span class="tok-nt">&lt;/clientes&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Finalmente, en la orden indicamos la URI a la que queremos acceder, en este caso:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>http://localhost:8080/ejemplo-rest/rest/clientes/</pre>
</div>
</div>
<div class="paragraph">
<p>Una vez insertado el cliente, podemos recuperar el cliente, utilizando el enlace
que se incluye en la cabecera de respuesta <strong>Location</strong></p>
</div>
<div class="literalblock">
<div class="content">
<pre>curl -i -H "Accept: application/xml" -H "Content-Type: application/xml" -X GET http://localhost:8080/ejemplo-rest/rest/clientes/1</pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">InvocaciÃ³n del servicio desde IntelliJ</dt>
<dd>
<p>IntelliJ nos proporciona una herramienta para probar servicios REST, desde Tools&#8594;Test RESTful Web Service
Desde esta nueva ventana podremos invocar al servicio REST indicando el tipo de
peticiÃ³n HTTP, asÃ­ como las cabeceras y cuerpo de la peticiÃ³n.</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>La siguiente figura muestra la elaboraciÃ³n de una peticiÃ³n POST a nuestro servicio REST:</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="images/rest01/test-intelliJ-POST.png" alt="PeticiÃ³n POST realizada desde Intellij" width="100%">
</div>
</div>
<div class="paragraph">
<p>A continuaciÃ³n mostramos la ejecuciÃ³n de una peticiÃ³n GET:</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="images/rest01/test-intelliJ-GET.png" alt="Resultado de ejecuciÃ³n de una peticiÃ³n GET ejecutada desde Intellij" width="100%">
</div>
</div>
<div class="paragraph">
<p>Cuando realizamos una peticiÃ³n POST debemos indicar el contenido del cuerpo del mensaje.
En la siguiente figura observamos que tenemos varias opciones disponibles, como
por ejemplo "teclear" directamente dicho contenido (opciÃ³n <em>Text</em>), o bien "subir"
dicha informaciÃ³n desde un fichero en nuestro disco duro (opciÃ³n <em>File Contents</em>).
Podemos ver que hemos elegido esta Ãºltima opciÃ³n para probar nuestro servicio.</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="images/rest01/test-intelliJ-POST.png" alt="Resultado de ejecuciÃ³n de una peticiÃ³n GET ejecutada desde Intellij" width="100%">
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">InvocaciÃ³n del servicio desde Postman</dt>
<dd>
<p>Otra alternativa sencilla para probar nuestro servicio REST es la herramienta postman, que podemos
lanzar desde el navegador, en nuestro caso: Chrome.</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>Accederemos a la aplicaciÃ³n desde la barra de marcadores, seleccionando "Aplicaciones", y
y a continuaciÃ³n, pulsaremos sobre el icono "Postman".</p>
</div>
<div class="paragraph">
<p>El aspecto de la herramienta es el que mostramos a continuaciÃ³n:</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="images/rest01/test-postman.png" alt="Resultado de ejecuciÃ³n de una peticiÃ³n GET ejecutada desde Postman" width="100%">
</div>
</div>
<div class="paragraph">
<p>Postman, a diferencia de las alternativas anteriores, nos permitirÃ¡ guardar un "historial"
de peticiones, de forma que podamos repetir la ejecuciÃ³n de nuestros tests, exactamente de la misma
forma, aunque no de forma automÃ¡tica, sino que tenemos que lanzar "manualmente" cada test
que queramos volver a ejecutar.</p>
</div>
<div class="paragraph">
<p>TambiÃ©n podemos crear "colecciones", que no son mÃ¡s que carpetas que contienen un conjunto
de peticiones de nuestro "historial". Por ejemplo, podemos crear la <strong>colecciÃ³n</strong> <em>s1-rest-ejercicio1</em>
en donde guardaremos todas las peticiones que hayamos hecho sobre el ejercicio 1 de la primera sesiÃ³n
de rest.</p>
</div>
<div class="paragraph">
<p>PodÃ©is crearos una cuenta gratuita para almacener y gestionar vuestras peticiones rest. Una vez que
tengÃ¡is creadas varias colecciones, Postman nos permite "guardarlas" en nuestro disco duro en formato json.</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="images/rest01/test-collections-postman.png" alt="Podemos guardar nuestras colecciones en formato JSON" width="100%">
</div>
</div>
<div style="page-break-after: always;"></div>
</div>
</div>
<div class="sect2">
<h3 id="_ejercicios">1.5. Ejercicios</h3>
<div class="paragraph">
<p>Antes de empezar a crear los proyectos, debes descargarte el repositorio <em>git</em>
<code>java_ua/ejercicios-rest-expertojava</code> en el que vas a implementar los ejercicios relativos a
 la asignatura de <em>Servicios REST</em>. El proceso es el mismo que el seguido en sesiones
 anteriores:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Accedemos al repositorio y realizamos un <em>Fork</em> en nuestra cuenta personal (asÃ­ podremos
tener una copia con permisos de escritura)</p>
</li>
<li>
<p>Realizamos un <em>Clone</em> en nuestra mÃ¡quina:</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="bash"><span class="tok-nv">$ </span>git clone https://bitbucket.org/&lt;alumno&gt;/ejercicios-rest-expertojava</code></pre>
</div>
</div>
<div class="paragraph">
<p>De esta forma se crea en nuestro ordenador el directorio <code>ejercicios-rest-expertojava</code> y se
descarga en Ã©l un proyecto IntelliJ en el que iremos aÃ±adiendo <strong>MÃDULOS</strong> para cada uno
 de los ejercicios. Contiene tambiÃ©n el fichero <code>gitignore</code>, asÃ­ como diferentes
 mÃ³dulos con las plantillas que vayamos a necesitar para realizar los ejercicios.</p>
</div>
<div class="paragraph">
<p>A partir de este momento se puede trabajar con dicho proyecto y realizar
 <em>Commit</em> y <em>Push</em> cuando sea oportuno:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="bash"><span class="tok-nv">$ </span><span class="tok-nb">cd </span>ejercicios-rest-expertojava
<span class="tok-nv">$ </span>git add .
<span class="tok-nv">$ </span>git commit -a -m <span class="tok-s2">&quot;Mensaje de commit&quot;</span>
<span class="tok-nv">$ </span>git push origin master</code></pre>
</div>
</div>
<div class="paragraph">
<p>Los <strong>MÃDULOS</strong> IntelliJ que iremos aÃ±adiendo, tendrÃ¡n todos el prefijo <code>sx-</code>, siendo <em>x</em>
el nÃºmero de la sesiÃ³n correspondiente (por ejemplo <em>s1-ejercicio</em>, <em>s2-otroEjercicio</em>,&#8230;&#8203;).</p>
</div>
<div class="sect3">
<h4 id="_servicio_rest_ejemplo_0_puntos">1.5.1. Servicio REST ejemplo (0 puntos)</h4>
<div class="paragraph">
<p>Para familiarizarnos con las peticiones http POST, PUT, GET, DELETE se proporciona
el <strong>MÃDULO</strong> <strong>s1-ejemplo-rest</strong>, con la implementaciÃ³n de un servicio rest que podÃ©is
probar, bien desde lÃ­nea de comandos con la utilidad <strong>curl</strong>, desde el navegador con
la herramienta <strong>postman</strong>
, o bien desde IntelliJ con el <strong>cliente REST</strong> incluido en el IDE.</p>
</div>
<div class="paragraph">
<p>En el directorio <code>src/main/resources</code> de dicho mÃ³dulo tenÃ©is un fichero de
texto (<em>instrucciones.txt</em>) con las instrucciones para construir, desplegar y probar la aplicaciÃ³n de ejemplo.</p>
</div>
</div>
<div class="sect3">
<h4 id="_servicio_rest_saludo_1_punto">1.5.2. Servicio REST saludo (1 punto)</h4>
<div class="paragraph">
<p>Vamos a implementar un primer servicio RESTful muy sencillo. Para ello
seguiremos las siguientes indicaciones:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Creamos un <strong>MÃDULO</strong> Maven con IntelliJ (desde el directorio <code>ejercicios-rest-expertojava</code>)
con el arquetipo <code>webapp-javaee7</code>, tal y como hemos visto en los apuntes de la sesiÃ³n. Las coordenadas
del <strong>artefacto Maven</strong> serÃ¡n:</p>
<div class="ulist">
<ul>
<li>
<p><em>GroupId</em>: org.expertojava</p>
</li>
<li>
<p><em>ArtifactId</em>: s1-saludo-rest</p>
</li>
<li>
<p><em>version</em>: 1.0-SNAPSHOT</p>
</li>
</ul>
</div>
</li>
<li>
<p>Configuramos el pom.mxl del proyecto para poder compilar, empaquetar y desplegar nuestro servicio.
Consulta los apuntes para ver cuÃ¡l debe ser el contenido de las etiquetas <em>&lt;properties&gt;</em>, <em>&lt;dependencies&gt;</em> y <em>&lt;build&gt;</em>.</p>
</li>
<li>
<p>Creamos la carpeta WEB-INF y aÃ±adimos el fichero de configuraciÃ³n <em>web.xml</em> tal y como hemos
visto en los apuntes (esto serÃ¡ necesario para configurar el despliegue). En este caso
queremos <em>mapear</em> los servicios REST, contenidos en el paquete
 <em>org.expertojava</em>, al directorio <em>/recursos</em> dentro de nuestro contexto (recuerda que el contexto
 de nuestra aplicaciÃ³n web vendrÃ¡ dado por el valor de la etiqueta &lt;finalName&gt;, anidada dentro de &lt;build&gt;).</p>
</li>
<li>
<p>Creamos un recurso de nombre <code>HolaMundoResource</code>, que se mapee a la direcciÃ³n <strong>/holamundo</strong>.
Implementar un mÃ©todo, de forma que al acceder a Ã©l por <strong>GET</strong> nos devuelva
en texto plano (text/plain) el mensaje "Hola mundo!".
Una vez desplegada la aplicaciÃ³n en el servidor WildFly, prueba el servicio mediante la
utilidad Postman desde Chrome.
Comprobar que la invocaciÃ³n:</p>
<div class="literalblock">
<div class="content">
<pre>GET http://localhost:8080/saludo-rest/holamundo</pre>
</div>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>Devuelve como cuerpo del mensaje: "Hola mundo!"</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Vamos a aÃ±adir un segmento variable a la ruta. Implementa un mÃ©todo GET nuevo, de forma que si
accedemos a /holamundo/nombre, aÃ±ade el nombre indicado al saludo (separado por un
espacio en blanco y seguido por "!!").</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Una vez desplegada la aplicaciÃ³n en el servidor WildFly, prueba el servicio mediante
la utilidad "Test RESTFul Web Service" de IntelliJ, o con Postman.
Comprobar que la invocaciÃ³n:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>GET http://localhost:8080/saludo-rest/holamundo/pepe</pre>
</div>
</div>
<div class="paragraph">
<p>Devuelve como cuerpo del mensaje: "Hola mundo! pepe!!"</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Hacer que se pueda cambiar el saludo mediante un mÃ©todo PUT. El nuevo saludo llegarÃ¡
tambiÃ©n como texto plano en el cuerpo de la peticiÃ³n, y posteriores invocaciones a los mÃ©todos GET utilizarÃ¡n el
nuevo saludo. Almacenaremos el nuevo saludo en una variable estÃ¡tica de nuestro recurso. Â¿QuÃ© pasa si
no lo es? (lo hemos explicado en los apuntes, puedes hacer la prueba para ver quÃ© ocurre
si la variable no es estÃ¡tica).</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Una vez desplegada la aplicaciÃ³n en el servidor WildFly, prueba el servicio
con Postman, o bien mediante la utilidad "Test RESTFul Web Service" de IntelliJ.
Realizar las siguientes invocaciones (en este orden):</p>
</div>
<div class="literalblock">
<div class="content">
<pre>PUT http://localhost:8080/saludo-rest/holamundo/
y en el cuerpo del mensaje: "Buenos dÃ­as"</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>GET http://localhost:8080/saludo-rest/holamundo
GET http://localhost:8080/saludo-rest/holamundo/pepe</pre>
</div>
</div>
<div class="paragraph">
<p>La segunda invocaciÃ³n debe devolver como cuerpo del mensaje: <code>"Buenos dias"</code>
Al ejecutar la tercera invocaciÃ³n el cuerpo del mensaje de respuesta deberÃ­a ser:
<code>"Buenos dias Pepe!!"</code></p>
</div>
</div>
<div class="sect3">
<h4 id="_servicio_rest_foro_1_punto">1.5.3. Servicio REST foro (1 punto)</h4>
<div class="paragraph">
<p>Vamos a implementar un servicio RESTful que contemple las
 cuatro operaciones bÃ¡sicas (GET, PUT, POST y DELETE). Se trata de un foro con en el que los usuarios
 pueden intervenir, de forma anÃ³nima, en diferentes conversaciones.</p>
</div>
<div class="paragraph">
<p>Primero debes crear un nuevo mÃ³dulo Maven, configurar el pom.xml, asÃ­ como el fichero <code>web.xml</code>,
de la misma forma que hemos hecho en el ejercicio anterior, pero para este
 ejercicio:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Las coordenadas del mÃ³dulo Maven serÃ¡n:</p>
<div class="ulist">
<ul>
<li>
<p><em>GroupId</em>: org.expertojava</p>
</li>
<li>
<p><em>ArtifactId</em>: s1-foro-rest</p>
</li>
<li>
<p><em>version</em>: 1.0-SNAPSHOT</p>
</li>
</ul>
</div>
</li>
<li>
<p>Nuestros servicios REST estarÃ¡n disponibles en la URI <code><a href="http://localhost:8080/s1-foro-rest/" class="bare">http://localhost:8080/s1-foro-rest/</a></code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>El foro estarÃ¡ formado por diferentes mensajes. Por lo tanto el modelo del dominio de nuestra
aplicaciÃ³n estarÃ¡ formado por la clase <code>Mensaje</code>, que contendrÃ¡ un identificador, y una
cadena de caracteres que representarÃ¡ el contenido del mensaje (recuerda que debes implementar
los correspondientes <em>getters</em> y <em>setters</em>).</p>
</div>
<div class="paragraph">
<p>Por simplicidad, vamos a almacenar los mensajes de nuestro foro en memoria. Estos estarÃ¡n
disponibles desde la clase <code>DatosEnMemoria</code>, que contendrÃ¡ la variable estÃ¡tica:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>static Map&lt;Integer, Mensaje&gt; datos = new HashMap&lt;Integer, Mensaje&gt;();</pre>
</div>
</div>
<div class="paragraph">
<p>Los servicios que proporcionarÃ¡ el foro estarÃ¡n implementados en la clase <code>MensajeResource</code>. Se
accederÃ¡ a ellos travÃ©s de la ruta relativa a la raÃ­z de nuestros servicios: "/mensajes".
Concretamente podremos realizar las siguientes operaciones:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>AÃ±adir un nuevo mensaje al foro con la URI relativa a la raÃ­z de nuestros servicios:
<code>"/mensajes"</code>. El texto del mensaje estarÃ¡ en el cuerpo de la peticiÃ³n y el tipo MIME asociado
serÃ¡ <code>text/plain</code> (contenido de la cabecera <code>Content-type</code> de la peticiÃ³n HTTP).  Nuestra respuesta
debe incluir en la cabecera <code>Location</code> de la respuesta HTTP, la URI del nuevo recurso creado.
Utiliza para ello la clase <code>Response</code> tal y como hemos mostrado en el cÃ³digo de ejemplo proporcionado
para el ejercicio anterior.
Hablaremos con detalle sobre esta clase en sesiones posteriores.</p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Recuerda que para acceder al cuerpo de la peticiÃ³n basta con definir un parÃ¡metro de tipo <em>String</em>.
JAX-RS automÃ¡ticamente lo instanciarÃ¡ a partir del cuerpo de la peticiÃ³n y lo convertirÃ¡ en
un objeto de tipo <em>String</em>.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="ulist">
<ul>
<li>
<p>Modificar un mensaje determinado con un identificador con valor <code>id</code>, a travÃ©s de la URI relativa a la raÃ­z de
nuestros servicios: <code>/mensajes/id</code> (<code>id</code> debe ser, por tanto, un segmento de ruta variable). Si no
existe ningÃºn mensaje con el identificador <code>id</code>, se lanzarÃ¡ la excepciÃ³n: <code>WebApplicationException(Response.Status.NOT_FOUND)</code></p>
</li>
<li>
<p>Borrar un mensaje determinado con un identificador con valor <code>id</code>, a travÃ©s de la URI relativa a la raÃ­z de
nuestros servicios: <code>/mensajes/id</code>. Igual que en el caso anterior, si el identificador proporcionado no
se corresponde con el de ningÃºn mensaje del foro, se lanzarÃ¡ la excepciÃ³n: <code>WebApplicationException(Response.Status.NOT_FOUND)</code></p>
</li>
<li>
<p>Consultar todos los mensajes del foro (la URI relativa serÃ¡: <code>/mensajes</code>). El resultado se mostrarÃ¡ en tantas lÃ­neas
como mensajes. Cada mensaje irÃ¡ precedido de su identificador. TambiÃ©n se informarÃ¡ del nÃºmero total de
mensajes en el foro. (La respuesta serÃ¡ una cadena de caracteres. Al final del ejercicio mostramos un ejemplo
de mensaje de respuesta para esta operaciÃ³n)</p>
</li>
<li>
<p>Consultar un mensaje determinado con un identificador con valor <code>id</code>, a travÃ©s de la URI relativa a la raÃ­z de
nuestros servicios: <code>/mensajes/id</code>. Si el identificador proporcionado no
se corresponde con el de ningÃºn mensaje del foro, se lanzarÃ¡ la excepciÃ³n: <code>WebApplicationException(Response.Status.NOT_FOUND)</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Prueba el servicio utilizando Postman, o el cliente de IntelliJ para servicios REST, con las siguientes entradas:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Crea los mensajes "Mensaje numero 1", "Mensaje numero 2", Mensaje numero 3", en este orden</p>
</li>
<li>
<p>Consulta los mensajes del foro. El resultado debe ser:</p>
<div class="paragraph">
<p>"1: Mensaje numero 1</p>
</div>
<div class="paragraph">
<p>2: Mensaje numero 2</p>
</div>
<div class="paragraph">
<p>3: Mensaje numero 3</p>
</div>
<div class="paragraph">
<p>Numero total de mensajes = 3"</p>
</div>
</li>
<li>
<p>Cambia el mensaje con identificador 2 por: "Nuevo mensaje numero 2"</p>
</li>
<li>
<p>Consulta los mensajes del foro. El resultado debe ser:</p>
<div class="paragraph">
<p>"1: Mensaje numero 1</p>
</div>
<div class="paragraph">
<p>2: Nuevo Mensaje numero 2</p>
</div>
<div class="paragraph">
<p>3: Mensaje numero 3</p>
</div>
<div class="paragraph">
<p>Numero total de mensajes = 3"</p>
</div>
</li>
<li>
<p>Borra el mensaje con identificador 3</p>
</li>
<li>
<p>Consulta el mensaje con el identificador 3. Se debe obtener una respuesta <code>404 Not Found</code></p>
</li>
<li>
<p>Consulta los mensajes del foro. El resultado debe ser:</p>
<div class="paragraph">
<p>"1: Mensaje numero 1</p>
</div>
<div class="paragraph">
<p>2: Nuevo Mensaje numero 2</p>
</div>
<div class="paragraph">
<p>Numero total de mensajes = 2"</p>
</div>
</li>
<li>
<p>AÃ±ade el mensaje "Mensaje final". Vuelve a consultar los mensajes, el resultado debe ser:</p>
<div class="paragraph">
<p>"1: Mensaje numero 1</p>
</div>
<div class="paragraph">
<p>2: Nuevo Mensaje numero 2</p>
</div>
<div class="paragraph">
<p>4: Mensaje final</p>
</div>
<div class="paragraph">
<p>Numero total de mensajes = 3"</p>
</div>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Para evitar problemas con el <em>id</em> generado si hemos borrado mensajes, lo mÃ¡s sencillo es que el identificador vaya
incrementÃ¡ndose siempre con cada nuevo mensaje. Esto puede hacer que "queden huecos"
en la numeraciÃ³n, como en el ejemplo anterior.</p>
</div>
</td>
</tr>
</table>
</div>
<div style="page-break-after: always;"></div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="sesion02">2. Anotaciones bÃ¡sicas JAX-RS. El modelo de despliegue.</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Ya hemos visto como crear un servicio REST bÃ¡sico. Ahora se trata de analizar con
mÃ¡s detalle aspectos fundamentales sobre la implementaciÃ³n de los servicios.
Comenzaremos por detallar los usos de la anotaciÃ³n @Path, que es la que nos
permite "etiquetar" una clase Java como un recurso REST sobre el que podremos realizar
las operaciones que hemos identificado en la sesiÃ³n anterior. TambiÃ©n hablaremos
algo mÃ¡s sobre las anotaciones @Produces y @Consumes que ya hemos utilizado para
implementar nuestro primer servicio.</p>
</div>
<div class="paragraph">
<p>En segundo lugar hablaremos sobre la extracciÃ³n de informaciÃ³n de las peticiones HTTP,
 y cÃ³mo podemos inyectar esa informaciÃ³n en nuestro cÃ³digo java. Esto nos permitirÃ¡
 servir las peticiones sin tener que escribir demasiado cÃ³digo adicional.</p>
</div>
<div class="paragraph">
<p>Finalmente, explicaremos mÃ¡s detenidamente cÃ³mo configurar el despliegue de
nuestra aplicaciÃ³n REST, de forma que sea portable.</p>
</div>
<div class="sect2">
<h3 id="__cÃ³mo_funciona_el_enlazado_de_mÃ©todos_http">2.1. Â¿CÃ³mo funciona el enlazado de mÃ©todos HTTP?</h3>
<div class="paragraph">
<p>JAX-RS define cinco anotaciones que se corresponden con operaciones HTTP especÃ­ficas:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>@javax.ws.rs.GET</p>
</li>
<li>
<p>@javax.ws.rs.PUT</p>
</li>
<li>
<p>@javax.ws.rs.POST</p>
</li>
<li>
<p>@javax.ws.rs.DELETE</p>
</li>
<li>
<p>@javax.ws.rs.HEAD</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>En la sesiÃ³n anterior ya hemos utilizado estas anotaciones para hacer corresponder
(enlazar) peticiones HTTP GET con un mÃ©todo Java concreto:</p>
</div>
<div class="paragraph">
<p>Por ejemplo:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span class="tok-nd">@Path</span><span class="tok-o">(</span><span class="tok-s">&quot;/clientes&quot;</span><span class="tok-o">)</span>
<span class="tok-kd">public</span> <span class="tok-kd">class</span> <span class="tok-nc">ServicioCliente</span> <span class="tok-o">{</span>

  <span class="tok-nd">@GET</span> <span class="tok-nd">@Produces</span><span class="tok-o">(</span><span class="tok-s">&quot;application/xml&quot;</span><span class="tok-o">)</span>
  <span class="tok-kd">public</span> <span class="tok-n">String</span> <span class="tok-nf">getTodosLosClientes</span><span class="tok-o">()</span> <span class="tok-o">{</span> <span class="tok-o">}</span>
<span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>En este cÃ³digo, la anotaciÃ³n @GET indica al <em>runtime</em> JAX-RS que el mÃ©todo java
<em>getTodosLosClientes()</em> atiende peticiones HTTP GET dirigidas a la URI <em>/clientes</em></p>
</div>
<div class="admonitionblock caution">
<table>
<tr>
<td class="icon">
<i class="fa icon-caution" title="Caution"></i>
</td>
<td class="content">
<div class="paragraph">
<p>SÃ³lamente se puede utilizar una de las anotaciones anteriores para un mismo mÃ©todo.
Si se aplica mÃ¡s de uno, se produce un error durante el despliegue de la aplicaciÃ³n</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Es interesante conocer que cada una de estas anotaciones, a su vez, estÃ¡ anotada con
otras anotaciones (podrÃ­amos llamarlas <em>meta anotaciones</em>). Por ejemplo, la implementaciÃ³n de
la anotaciÃ³n @GET tiene este aspecto:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span class="tok-kn">package</span> <span class="tok-n">javax</span><span class="tok-o">.</span><span class="tok-na">ws</span><span class="tok-o">.</span><span class="tok-na">rs</span><span class="tok-o">;</span>
<span class="tok-kn">import</span> <span class="tok-nn">...</span><span class="tok-o">;</span>

<span class="tok-nd">@Target</span><span class="tok-o">({</span><span class="tok-n">ElementType</span><span class="tok-o">.</span><span class="tok-na">METHOD</span><span class="tok-o">})</span>
<span class="tok-nd">@Retention</span><span class="tok-o">(</span><span class="tok-n">RetentionPolicy</span><span class="tok-o">.</span><span class="tok-na">RUNTIME</span><span class="tok-o">)</span>
<span class="tok-nd">@HttpMethod</span><span class="tok-o">(</span><span class="tok-n">HttpMethod</span><span class="tok-o">.</span><span class="tok-na">GET</span><span class="tok-o">)</span>
<span class="tok-kd">public</span> <span class="tok-nd">@interface</span> <span class="tok-n">GET</span> <span class="tok-o">{</span>
<span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>@GET, en sÃ­ mismo, no tiene ningÃºn significado especial para el proveedor JAX-RS (<em>runtime</em>
de JAX-RS). Lo que hace que la anotaciÃ³n @GET sea significativo para el <em>runtime</em> de JAX-RS
es el valor de la <em>meta anotaciÃ³n</em> @javax.ws.rs.HttpMethod (en este caso <code>HttpMethod.GET</code>).
Este valor es el que realmente "decide" que un determinado mÃ©todo Java se "enlace" con
un determinado mÃ©todo HTTP.</p>
</div>
<div class="paragraph">
<p>Â¿CuÃ¡les son las implicaciones de Ã©sto? Pues que podemos crear nuevas anotaciones que
podemos enlazar a otros mÃ©todos HTTP que no sean GET, POST, PUT, DELETE, o HEAD. De esta
 forma podrÃ­amos permitir que diferentes tipos de clientes que hacen uso de la
 operaciÃ³n HTTP LOCK, puedan ser "atendidos" por nuestro
 servicio REST (como por ejemplo un cliente WebDAV ).</p>
</div>
</div>
<div class="sect2">
<h3 id="_la_anotaciÃ³n_path">2.2. La anotaciÃ³n @Path</h3>
<div class="paragraph">
<p>La anotaciÃ³n @Path identifica la "plantilla" de <em>path</em> para la URI del recurso al
que se accede y se puede especificar a nivel de clase o a nivel de mÃ©todo de dicho recurso.</p>
</div>
<div class="paragraph">
<p>El <strong>valor</strong> de una anotaciÃ³n @Path es una <strong>expresiÃ³n</strong> que denota una URI relativa a la URI base del servidor en el que se despliega el recurso,
a la raiz del contexto de la aplicaciÃ³n, y al patrÃ³n URL al que responde el runtime de JAX-RS.</p>
</div>
<div class="paragraph">
<p>Un <strong>segmento</strong> de la URI es cada una de las subcadenas delimitadas por <code>/</code> que aparecen
 en dicha URI. Por ejemplo, la URI <em><a href="http://ejemplo.clientes.com/clientes/vip/recientes" class="bare">http://ejemplo.clientes.com/clientes/vip/recientes</a></em> contiene 4
 segmentos de ruta: <em>ejemplo.clientes.com</em>, <em>clientes</em>, <em>vip</em> y <em>recientes</em>.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>La anotaciÃ³n @Path no es necesario que contenga una ruta que empiece o termine con el carÃ¡cter <code>/</code>. El
<em>runtime</em> de JAX-RS analiza igualmente la expresiÃ³n indicada como valor de @Path</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Para que una <strong>clase Java</strong> sea identificada como una clase que puede atender peticiones HTTP,
Ã©sta tiene que estar anotada con al menos la expresiÃ³n: <code>@Path("/")</code>. Este tipo
de clases se denominan <strong>recursos JAX-RS raÃ­z</strong>.</p>
</div>
<div class="paragraph">
<p>Para recibir una peticiÃ³n, un  <strong>mÃ©todo Java</strong> debe tener al menos una anotaciÃ³n de mÃ©todo HTTP,
como por ejemplo @javax.ws.rs.GET. Este mÃ©todo no requiere tener ninguna anotaciÃ³n @Path
adicional. Por ejemplo:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span class="tok-nd">@Path</span><span class="tok-o">(</span><span class="tok-s">&quot;/pedidos&quot;</span><span class="tok-o">)</span>
<span class="tok-kd">public</span> <span class="tok-kd">class</span> <span class="tok-nc">PedidoResource</span> <span class="tok-o">{</span>
  <span class="tok-nd">@GET</span>
  <span class="tok-kd">public</span> <span class="tok-n">String</span> <span class="tok-nf">getTodosLosPedidos</span><span class="tok-o">()</span> <span class="tok-o">{</span>
    <span class="tok-o">...</span>
  <span class="tok-o">}</span>
<span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Una peticiÃ³n HTTP <strong>GET /pedidos</strong> se delegarÃ¡ en el mÃ©todo <strong>getTodosLosPedidos()</strong>.</p>
</div>
<div class="paragraph">
<p>Podemos aplicar tambiÃ©n @Path a un mÃ©todo Java. Si hacemos esto, la expresiÃ³n de la
anotaciÃ³n @Path de la clase, se concatenarÃ¡ con la expresiÃ³n de la anotaciÃ³n @Path del
mÃ©todo. Por ejemplo:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span class="tok-nd">@Path</span><span class="tok-o">(</span><span class="tok-s">&quot;/pedidos&quot;</span><span class="tok-o">)</span>
<span class="tok-kd">public</span> <span class="tok-kd">class</span> <span class="tok-nc">PedidoResource</span> <span class="tok-o">{</span>

  <span class="tok-nd">@GET</span>
  <span class="tok-nd">@Path</span><span class="tok-o">(</span><span class="tok-s">&quot;noPagados&quot;</span><span class="tok-o">)</span>
  <span class="tok-kd">public</span> <span class="tok-n">String</span> <span class="tok-nf">getPedidosNoPagados</span><span class="tok-o">()</span> <span class="tok-o">{</span>
    <span class="tok-o">...</span>
  <span class="tok-o">}</span>
<span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>De esta forma, una peticiÃ³n <strong>GET /pedidos/noPagados</strong> se delegarÃ¡ en el mÃ©todo
<strong>getPedidosNoPagados()</strong>.</p>
</div>
<div class="paragraph">
<p>Podemos tener anotaciones @Path para cada mÃ©todo, que serÃ¡n relativos a la ruta
indicada en la anotaciÃ³n  @Path de
la definiciÃ³n de la clase. Por ejemplo, la siguiente clase de recurso sirve peticiones
a la URI <strong>/pedidos</strong>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span class="tok-nd">@Path</span><span class="tok-o">(</span><span class="tok-s">&quot;/pedidos&quot;</span><span class="tok-o">)</span>
<span class="tok-kd">public</span> <span class="tok-kd">class</span> <span class="tok-nc">PedidoResource</span> <span class="tok-o">{</span>

  <span class="tok-nd">@GET</span>
  <span class="tok-kd">public</span> <span class="tok-n">String</span> <span class="tok-nf">getPedidos</span><span class="tok-o">()</span> <span class="tok-o">{</span>
    <span class="tok-o">...</span>
  <span class="tok-o">}</span>
<span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Si quisiÃ©ramos proporcionar el servicio en la URI <strong>pedidos/incidencias</strong>, por ejemplo,
no necesitamos una nueva definiciÃ³n de clase, y podrÃ­amos anotar un nuevo mÃ©todo
<em>getIncidenciasPedidos()</em> de la siguiente forma:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span class="tok-nd">@Path</span><span class="tok-o">(</span><span class="tok-s">&quot;/pedidos&quot;</span><span class="tok-o">)</span>
<span class="tok-kd">public</span> <span class="tok-kd">class</span> <span class="tok-nc">PedidoResource</span> <span class="tok-o">{</span>

  <span class="tok-nd">@GET</span>
  <span class="tok-kd">public</span> <span class="tok-n">String</span> <span class="tok-nf">getPedidos</span><span class="tok-o">()</span> <span class="tok-o">{...}</span>

  <span class="tok-nd">@GET</span>
  <span class="tok-nd">@Path</span><span class="tok-o">(</span><span class="tok-s">&quot;/incidencias&quot;</span><span class="tok-o">)</span>
  <span class="tok-kd">public</span> <span class="tok-n">String</span> <span class="tok-nf">getIncidenciasPedidos</span><span class="tok-o">()</span> <span class="tok-o">{...}</span>
<span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Ahora tenemos una clase de recurso que gestiona peticiones para <strong>/pedidos</strong>,
y para <strong>/pedidos/incidencias/</strong>.</p>
</div>
<div class="sect3">
<h4 id="_expresiones_path">2.2.1. Expresiones @Path</h4>
<div class="paragraph">
<p>El valor de una anotaciÃ³n @Path puede ser una cadena de caracteres, o tambiÃ©n puede
contener expresiones mÃ¡s complejas si es necesario, nos referiremos a ellas como
 <strong>expresiones @Path</strong></p>
</div>
<div class="paragraph">
<p>Una expresiÃ³n @Path puede incluir variables, que se indican entre llaves, que serÃ¡n sustituidas en tiempo
de ejecuciÃ³n dependiendo del valor que se indique en la llamada al recurso.
AsÃ­, por ejemplo, si tenemos la siguiente anotaciÃ³n:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span class="tok-nd">@GET</span>
<span class="tok-nd">@Path</span><span class="tok-o">(</span><span class="tok-s">&quot;/clientes/{id}&quot;</span><span class="tok-o">)</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>y el usuario realiza la llamada:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>GET http://org.expertojava/contexto/rest/clientes/Pedro</pre>
</div>
</div>
<div class="paragraph">
<p>la peticiÃ³n se delegarÃ¡ en el mÃ©todo que estÃ© anotado con las anotaciones anteriores
y el valor de {id} serÃ¡ instanciado en tiempo de ejecuciÃ³n a "Pedro".</p>
</div>
<div class="paragraph">
<p>Para obtener el valor del nombre del cliente, utilizaremos la anotaciÃ³n <code>@PathParam</code>
  en los parÃ¡metros del mÃ©todo, de la siguiente forma:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span class="tok-nd">@GET</span>
<span class="tok-nd">@Path</span><span class="tok-o">(</span><span class="tok-s">&quot;/clientes/{nombre}&quot;</span><span class="tok-o">)</span>
<span class="tok-kd">public</span> <span class="tok-n">String</span> <span class="tok-nf">getClientePorNombre</span><span class="tok-o">(</span><span class="tok-nd">@PathParam</span><span class="tok-o">(</span><span class="tok-s">&quot;nombre&quot;</span><span class="tok-o">)</span> <span class="tok-n">String</span> <span class="tok-n">nombre</span><span class="tok-o">)</span> <span class="tok-o">{</span>
    <span class="tok-o">...</span>
<span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Una expresiÃ³n @Path puede tener mÃ¡s de una variable, cada una figurarÃ¡ entre llaves.
Por ejemplo, si utilizamos la siguiente expresiÃ³n @Path:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span class="tok-nd">@Path</span><span class="tok-o">(</span><span class="tok-s">&quot;/{nombre1}/{nombre2}/&quot;</span><span class="tok-o">)</span>
<span class="tok-kd">public</span> <span class="tok-kd">class</span> <span class="tok-nc">MiResource</span> <span class="tok-o">{</span>
Â Â <span class="tok-o">...</span>
<span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>podremos atender peticiones dirigidas a URIs que respondan a la plantilla:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>http://org.expertojava/contexto/recursos/{nombre1}/{nombre2}</pre>
</div>
</div>
<div class="paragraph">
<p>como por ejemplo:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>http://org.expertojava/contexto/recursos/Pedro/Lopez</pre>
</div>
</div>
<div class="paragraph">
<p>Las expresiones @Path pueden incluir mÃ¡s de una variable para referenciar un
segmento de ruta. Por ejemplo:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span class="tok-nd">@Path</span><span class="tok-o">(</span><span class="tok-s">&quot;/&quot;</span><span class="tok-o">)</span>
<span class="tok-kd">public</span> <span class="tok-kd">class</span> <span class="tok-nc">ClienteResource</span> <span class="tok-o">{</span>
  <span class="tok-nd">@GET</span>
  <span class="tok-nd">@Path</span><span class="tok-o">(</span><span class="tok-s">&quot;clientes/{apellido1}-{apellido2}&quot;</span><span class="tok-o">)</span>
  <span class="tok-kd">public</span> <span class="tok-n">String</span> <span class="tok-nf">getCliente</span><span class="tok-o">(</span><span class="tok-nd">@PathParam</span><span class="tok-o">(</span><span class="tok-s">&quot;apellido1&quot;</span><span class="tok-o">)</span> <span class="tok-n">String</span> <span class="tok-n">ape1</span><span class="tok-o">,</span>
                           <span class="tok-nd">@PathParam</span><span class="tok-o">(</span><span class="tok-s">&quot;apellido2&quot;</span><span class="tok-o">)</span> <span class="tok-n">String</span> <span class="tok-n">ape2</span><span class="tok-o">)</span> <span class="tok-o">{</span>
    <span class="tok-o">...</span>
  <span class="tok-o">}</span>
<span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Una peticiÃ³n del tipo:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>GET http://org.expertojava/contexto/clientes/Pedro-Lopez</pre>
</div>
</div>
<div class="paragraph">
<p>serÃ¡ procesada por el mÃ©todo <strong>getCliente()</strong></p>
</div>
<div class="sect4">
<h5 id="_expresiones_regulares">Expresiones regulares</h5>
<div class="paragraph">
<p>Las anotaciones @Path pueden contener expresiones regulares (asociadas a las variables).
Por ejemplo, si
nuestro mÃ©todo <strong>getClienteId()</strong> tiene un parÃ¡metro de tipo entero, podemos restringir
las peticiones para tratar solamente aquellas URIs que contengan dÃ­gitos en el
segmento de ruta que nos interese:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span class="tok-nd">@Path</span><span class="tok-o">(</span><span class="tok-s">&quot;/clientes&quot;</span><span class="tok-o">)</span>
<span class="tok-kd">public</span> <span class="tok-kd">class</span> <span class="tok-nc">ClienteResource</span> <span class="tok-o">{</span>
  <span class="tok-nd">@GET</span>
  <span class="tok-nd">@Path</span><span class="tok-o">(</span><span class="tok-s">&quot;{id : \\d+}&quot;</span><span class="tok-o">)</span>  <span class="tok-c1">//solo soporta dÃ­gitos</span>
  <span class="tok-kd">public</span> <span class="tok-n">String</span> <span class="tok-nf">getClienteId</span><span class="tok-o">(</span><span class="tok-nd">@PathParam</span><span class="tok-o">(</span><span class="tok-s">&quot;id&quot;</span><span class="tok-o">)</span> <span class="tok-kt">int</span> <span class="tok-n">id</span><span class="tok-o">)</span> <span class="tok-o">{</span>
   <span class="tok-o">...</span>
  <span class="tok-o">}</span>
<span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Si la URI de la peticiÃ³n de entrada no satisface ninguna expresiÃ³n regular de
ninguno de los metodos del recurso, entonces se devolverÃ¡ el cÃ³digo de error: <strong>404 Not Found</strong></p>
</div>
<div class="paragraph">
<p>El formato para especificar expresiones regulares para las variables del <em>path</em> es:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>{" nombre-variable [ ":" expresion-regular ] "}</pre>
</div>
</div>
<div class="paragraph">
<p>El uso de expresiones regulares es opcional. Si no se proporciona una expresiÃ³n regular,
por defecto se admite cualquier carÃ¡cter. En tÃ©rminos de una expresiÃ³n regular, la
expresiÃ³n regular por defecto serÃ­a:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>"[^/]+?"</pre>
</div>
</div>
<div class="paragraph">
<p>Por ejemplo, si queremos aceptar solamente nombres que comiencen por una letra, y
 a continuaciÃ³n puedan contener una letra o un dÃ­gito, lo expresarÃ­amos como:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span class="tok-nd">@Path</span><span class="tok-o">(</span><span class="tok-s">&quot;/clientes&quot;</span><span class="tok-o">)</span>
<span class="tok-kd">public</span> <span class="tok-kd">class</span> <span class="tok-nc">ClienteResource</span> <span class="tok-o">{</span>
   <span class="tok-nd">@GET</span>
   <span class="tok-nd">@Path</span><span class="tok-o">(</span><span class="tok-s">&quot;{nombre : [a-zA-Z][a-zA-Z_0-9]}&quot;</span><span class="tok-o">)</span>
   <span class="tok-kd">public</span> <span class="tok-n">String</span> <span class="tok-nf">getClienteNombre</span><span class="tok-o">(</span><span class="tok-nd">@PathParam</span><span class="tok-o">(</span><span class="tok-s">&quot;nombre&quot;</span><span class="tok-o">)</span> <span class="tok-n">string</span> <span class="tok-n">nom</span><span class="tok-o">)</span> <span class="tok-o">{</span>
    <span class="tok-o">...</span>
   <span class="tok-o">}</span>
<span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>De esta forma, la URI <code>/clientes/aaa</code> no serÃ­a vÃ¡lida, la URI <code>/clientes/a9</code>
 activarÃ­a el mÃ©todo <em>getClienteNombre()</em>, y la URI <code>/clientes/89</code> activarÃ­a
 el mÃ©todo <em>getClienteId()</em>.</p>
</div>
<div class="paragraph">
<p>Las expresiones regulares no se limitan a un sÃ³lo segmento de la URI. Por ejemplo:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span class="tok-nd">@Path</span><span class="tok-o">(</span><span class="tok-s">&quot;/clientes&quot;</span><span class="tok-o">)</span>
<span class="tok-kd">public</span> <span class="tok-kd">class</span> <span class="tok-nc">ClienteResource</span> <span class="tok-o">{</span>
  <span class="tok-nd">@GET</span>
  <span class="tok-nd">@Path</span><span class="tok-o">(</span><span class="tok-s">&quot;{id : .+}&quot;</span><span class="tok-o">)</span>
  <span class="tok-kd">public</span> <span class="tok-n">String</span> <span class="tok-nf">getCliente</span><span class="tok-o">(</span><span class="tok-nd">@PathParam</span><span class="tok-o">(</span><span class="tok-s">&quot;id&quot;</span><span class="tok-o">)</span> <span class="tok-n">String</span> <span class="tok-n">id</span><span class="tok-o">)</span> <span class="tok-o">{</span>
  <span class="tok-o">...</span>
  <span class="tok-o">}</span>

  <span class="tok-nd">@GET</span>
  <span class="tok-nd">@Path</span><span class="tok-o">(</span><span class="tok-s">&quot;{id : .+}/direccion&quot;</span><span class="tok-o">)</span>
  <span class="tok-kd">public</span> <span class="tok-n">String</span> <span class="tok-nf">getDireccion</span><span class="tok-o">(</span><span class="tok-nd">@PathParam</span><span class="tok-o">(</span><span class="tok-s">&quot;id&quot;</span><span class="tok-o">)</span> <span class="tok-n">String</span> <span class="tok-n">id</span><span class="tok-o">)</span> <span class="tok-o">{</span>
  <span class="tok-o">...</span>
  <span class="tok-o">}</span>
<span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>La expresiÃ³n regular <code>.+</code> indica que estÃ¡n permitidos cualquier nÃºmero de caracteres.
AsÃ­, por ejemplo, la peticiÃ³n <code>GET /clientes/pedro/lopez</code> podrÃ­a delegarse en el mÃ©todo
<em>getClientes()</em></p>
</div>
<div class="paragraph">
<p>El mÃ©todo <em>getDireccion()</em> tiene asociada una expresiÃ³n mÃ¡s especÃ­fica, la cual puede
mapearse con cualquier cadena de caracteres que termine con <em>/direccion</em>. SegÃºn Ã©sto,
la peticiÃ³n <code>GET /clientes/pedro/lopez/direccion</code> podrÃ­a delegarse en el mÃ©todo
<em>getDireccion()</em>.</p>
</div>
</div>
<div class="sect4">
<h5 id="_reglas_de_precedencia">Reglas de precedencia</h5>
<div class="paragraph">
<p>En el ejemplo anterior, acabamos de ver que las expresiones @Path para <em>getCliente()</em> y
<em>getDireccion()</em> son ambiguas. Una peticiÃ³n <code>GET /clientes/pedro/lopez/direccion</code> podrÃ­a
mapearse con cualquiera de los dos mÃ©todos. La especificaciÃ³n JAX-RS define las siguientes
 reglas para priorizar el mapeado de expresiones regulares:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>El primer criterio para ordenar las acciones de mapeado es el nÃºmero de caracteres
literales que contiene la expresiÃ³n @Path, teniendo prioridad aquellas con un mayor
nÃºmero de caracteres literales. El patrÃ³n de la URI para el mÃ©todo
<em>getCliente()</em> tiene 10 carÃ¡cteres literales: <code>/clientes</code>. El patrÃ³n para el mÃ©todo
<em>getDireccion()</em> tiene 19: <code>clientes/direccion</code>. Por lo tanto se elegirÃ­a primero
el mÃ©todo <em>getDireccion()</em></p>
</li>
<li>
<p>El segundo criterio es el nÃºmero de variables
en expresiones @Path (por ejemplo {id}, o {id: .+}). Teniendo precedencia
las patrones con un mayor nÃºmero de variables</p>
</li>
<li>
<p>El tercer criterio es el nÃºmero de variables que tienen asociadas expresiones
regulares (tambiÃ©n en orden descendente)</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>A continuaciÃ³n mostramos una lista de expresiones @Path,
 ordenadas en orden descendente de prioridad:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>/clientes/{id}/{nombre}/direccion</p>
</li>
<li>
<p>/clientes/{id : .+}/direccion</p>
</li>
<li>
<p>/clientes/{id}/direccion</p>
</li>
<li>
<p>/clientes/{id : .+}</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Las expresiones 1..3 se analizarÃ­an primero ya que tienen mÃ¡s caracteres literales que la
expresiÃ³n nÃºmero 4. Si bien las expresiones 1..3 tienen el mismo nÃºmero de caracteres
literales. La expresiÃ³n 1 se analizarÃ­a antes que las otras dos debido a la segunda regla (tiene
mÃ¡s variables). Las expresiones 2 y 3 tienen el mismo nÃºmero de caracteres literales
y el mismo nÃºmero de variables, pero la expresiÃ³n 2 tiene una variable con una expresiÃ³n
regular asociada.</p>
</div>
<div class="paragraph">
<p>Estas reglas de ordenaciÃ³n no son perfectas. Es posible que siga habiendo ambigÃ¼edades,
pero cubren el 90% de los casos. Si el diseÃ±o de nuestra aplicaciÃ³n presenta ambigÃ¼edades
 aplicando estas reglas, es bastante probable que hayamos complicado dicho diseÃ±o y
serÃ­a conveniente revisarlo y refactorizar nuestro esquema de URIs.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_parÃ¡metros_em_matrix_em_em_matrix_parameters_em">2.2.2. ParÃ¡metros <em>matrix</em> (<em>Matrix parameters</em>)</h4>
<div class="paragraph">
<p>Los parÃ¡metros <em>matrix</em> con pares nombre-valor incluidos como parte de la URI.
Aparecen al final de un <strong>segmento</strong> de la URI (segmento de ruta) y estÃ¡n delimitados por el
carÃ¡cter <code>;</code>. Por ejemplo:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>http://ejemplo.coches.com/seat/ibiza;color=black/2006</pre>
</div>
</div>
<div class="paragraph">
<p>En la ruta anterior el parÃ¡metro <em>matrix</em> aparece despuÃ©s del segmento de ruta <em>ibiza</em>.
Su nombre es <code>color</code> y el <code>valor</code> asociado es <code>black</code>.</p>
</div>
<div class="paragraph">
<p>Un parÃ¡metro <em>matrix</em> es diferente de lo que denominamos <strong>parÃ¡metro de consulta</strong> (<em>query parameter</em>),
ya que los parÃ¡metros <em>matrix</em> representan atributos de ciertos <strong>segmentos</strong> de la URI y se utilizan
para propÃ³sitos de <strong>identificaciÃ³n</strong>. Pensemos en ellos como adjetivos. Los <strong>parÃ¡metros de consulta</strong>,
por otro lado, <strong>siempre</strong> aparecen al <strong>final</strong> de la URI, y <strong>siempre</strong>
pertenecen al recurso "completo" que estemos referenciando.</p>
</div>
<div class="paragraph">
<p>Los parÃ¡metros <em>matrix</em> son ignorados cuando el runtime de JAX-RS realiza el <em>matching</em>
 de las peticiones de entrada a mÃ©todos de recursos REST. De hecho, es "ilegal" incluir
 parÃ¡metros <em>matrix</em> en las expresiones @Path. Por ejemplo:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span class="tok-nd">@Path</span><span class="tok-o">(</span><span class="tok-s">&quot;/seat&quot;</span><span class="tok-o">)</span>
<span class="tok-kd">public</span> <span class="tok-kd">class</span> <span class="tok-nc">SeatService</span> <span class="tok-o">{</span>

   <span class="tok-nd">@GET</span>
   <span class="tok-nd">@Path</span><span class="tok-o">(</span><span class="tok-s">&quot;/ibiza/{anyo}&quot;</span><span class="tok-o">)</span>
   <span class="tok-nd">@Produces</span><span class="tok-o">(</span><span class="tok-s">&quot;image/jpeg&quot;</span><span class="tok-o">)</span>
   <span class="tok-kd">public</span> <span class="tok-n">Response</span> <span class="tok-nf">getIbizaImagen</span><span class="tok-o">(</span><span class="tok-nd">@PathParam</span><span class="tok-o">(</span><span class="tok-s">&quot;anyo&quot;</span><span class="tok-o">)</span> <span class="tok-n">String</span> <span class="tok-n">anyo</span><span class="tok-o">)</span> <span class="tok-o">{</span>
   <span class="tok-o">...</span> <span class="tok-o">}</span>
<span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Si la peticiÃ³n de entrada es: <strong>GET /seat/ibiza;color=black/2009</strong>, el mÃ©todo <em>getIbizaImagen()</em>
serÃ­a elegido por el proveedor de JAX-RS para servir la peticiÃ³n de entrada, y serÃ­a invocado.
Los parÃ¡metros <em>matrix</em> <strong>NO</strong> se consideran parte del proceso de <em>matching</em> debido a que normalmente
  son atributos variables de la peticiÃ³n.</p>
</div>
</div>
<div class="sect3">
<h4 id="_subrecursos_em_subresource_locators_em">2.2.3. Subrecursos (<em>Subresource Locators</em>)</h4>
<div class="paragraph">
<p>Acabamos de ver la capacidad de JAX-RS para hacer corresponder, de forma <strong>estÃ¡tica</strong> a
travÃ©s de la anotaciÃ³n @Path, URIs
especificadas en la entrada de la peticiÃ³n con mÃ©todos Java especÃ­ficos. JAX-RS
tambiÃ©n nos permitirÃ¡, de forma <strong>dinÃ¡mica</strong> servir nosotros mismos las peticiones a travÃ©s
de los denominados <strong><em>subresource locators</em></strong> (localizadores de subrecursos).</p>
</div>
<div class="paragraph">
<p>Los <strong><em>subresource locators</em></strong> son mÃ©todos Java anotados con @Path, pero sin anotaciones
 @GET, @PUT, &#8230;&#8203; Este tipo de mÃ©todos devuelven un objeto, que es, en sÃ­ mismo, un servicio
 JAX-RS que "sabe" cÃ³mo servir el resto de la peticiÃ³n. Vamos a describir mejor este
 concepto con un ejemplo.</p>
</div>
<div class="paragraph">
<p>Supongamos que queremos extender nuestro servicio que proporciona informaciÃ³n sobre los
clientes. Disponemos de diferentes bases de datos de clientes segÃºn regiones geogrÃ¡ficas.
Queremos aÃ±adir esta informaciÃ³n en nuestro esquema de URIs pero desacoplando
la bÃºsqueda
del servidor de base de datos, de la consulta particular de un cliente en concreto.
AÃ±adiremos la informaciÃ³n de la zona geogrÃ¡fica en la siguiente expresiÃ³n @Path:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>/clientes/{zona}-db/{clienteId}</pre>
</div>
</div>
<div class="paragraph">
<p>A continuaciÃ³n definimos la clase <strong>ZonasClienteResource</strong>, que delegarÃ¡ en la clase
 ClienteResource, que ya tenÃ­amos definida.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span class="tok-nd">@Path</span><span class="tok-o">(</span><span class="tok-s">&quot;/clientes&quot;</span><span class="tok-o">)</span>
<span class="tok-kd">public</span> <span class="tok-kd">class</span> <span class="tok-nc">ZonasClienteResource</span> <span class="tok-o">{</span>

  <span class="tok-nd">@Path</span><span class="tok-o">(</span><span class="tok-s">&quot;{zona}-db&quot;</span><span class="tok-o">)</span>
  <span class="tok-kd">public</span> <span class="tok-n">ClienteResource</span> <span class="tok-nf">getBaseDeDatos</span><span class="tok-o">(</span><span class="tok-nd">@PathParam</span><span class="tok-o">(</span><span class="tok-s">&quot;zona&quot;</span><span class="tok-o">)</span> <span class="tok-n">String</span> <span class="tok-n">db</span><span class="tok-o">)</span> <span class="tok-o">{</span>
      <span class="tok-c1">// devuelve una instancia dependiendo del parÃ¡metro db</span>
      <span class="tok-n">ClienteResource</span> <span class="tok-n">resource</span> <span class="tok-o">=</span> <span class="tok-n">localizaClienteResource</span><span class="tok-o">(</span><span class="tok-n">db</span><span class="tok-o">);</span>
      <span class="tok-k">return</span> <span class="tok-n">resource</span><span class="tok-o">;</span>
  <span class="tok-o">}</span>

  <span class="tok-kd">protected</span> <span class="tok-n">ClienteResource</span> <span class="tok-nf">localizaClienteResource</span><span class="tok-o">(</span><span class="tok-n">String</span> <span class="tok-n">db</span><span class="tok-o">)</span> <span class="tok-o">{</span>
  <span class="tok-o">...</span>
  <span class="tok-o">}</span>

<span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>La clase <strong>ZonasClienteResource</strong> es nuestro recurso raÃ­z. Dicha clase no atiende
ninguna peticiÃ³n HTTP directamente. Nuestro recurso raÃ­z procesa el segmento de URI
que hace referencia a la base de datos en donde buscar a nuestro cliente y devuelve
una instancia de dicha base de datos (o mÃ¡s propiamente dicho, del objeto con en que
accederemos a dicha base de datos). El "proveedor" de JAX-RS utiliza dicha instancia
para "servir" el resto de la peticiÃ³n:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span class="tok-kd">public</span> <span class="tok-kd">class</span> <span class="tok-nc">ClienteResource</span> <span class="tok-o">{</span>
  <span class="tok-kd">private</span> <span class="tok-n">Map</span><span class="tok-o">&lt;</span><span class="tok-n">Integer</span><span class="tok-o">,</span> <span class="tok-n">Cliente</span><span class="tok-o">&gt;</span> <span class="tok-n">clienteDB</span> <span class="tok-o">=</span>
                 <span class="tok-k">new</span> <span class="tok-n">ConcurrentHashMap</span><span class="tok-o">&lt;</span><span class="tok-n">Integer</span><span class="tok-o">,</span> <span class="tok-n">Cliente</span><span class="tok-o">&gt;();</span>
  <span class="tok-kd">private</span> <span class="tok-n">AtomicInteger</span> <span class="tok-n">idContador</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-nf">AtomicInteger</span><span class="tok-o">();</span>

  <span class="tok-kd">public</span> <span class="tok-nf">ClienteResource</span><span class="tok-o">(</span><span class="tok-n">Map</span><span class="tok-o">&lt;</span><span class="tok-n">Integer</span><span class="tok-o">,</span> <span class="tok-n">Cliente</span><span class="tok-o">&gt;</span> <span class="tok-n">clienteDB</span><span class="tok-o">)</span> <span class="tok-o">{</span>
      <span class="tok-k">this</span><span class="tok-o">.</span><span class="tok-na">clienteDB</span> <span class="tok-o">=</span> <span class="tok-n">clienteDB</span><span class="tok-o">;</span>
  <span class="tok-o">}</span>

  <span class="tok-nd">@POST</span>
  <span class="tok-nd">@Consumes</span><span class="tok-o">(</span><span class="tok-s">&quot;application/xml&quot;</span><span class="tok-o">)</span>
  <span class="tok-kd">public</span> <span class="tok-n">Response</span> <span class="tok-nf">crearCliente</span><span class="tok-o">(</span><span class="tok-n">InputStream</span> <span class="tok-n">is</span><span class="tok-o">)</span> <span class="tok-o">{</span> <span class="tok-o">...</span> <span class="tok-o">}</span>

  <span class="tok-nd">@GET</span>
  <span class="tok-nd">@Path</span><span class="tok-o">(</span><span class="tok-s">&quot;{id}&quot;</span><span class="tok-o">)</span>
  <span class="tok-nd">@Produces</span><span class="tok-o">(</span><span class="tok-s">&quot;application/xml&quot;</span><span class="tok-o">)</span>
  <span class="tok-kd">public</span> <span class="tok-n">Cliente</span> <span class="tok-nf">recuperarClienteId</span><span class="tok-o">(</span><span class="tok-nd">@PathParam</span><span class="tok-o">(</span><span class="tok-s">&quot;id&quot;</span><span class="tok-o">)</span> <span class="tok-kt">int</span> <span class="tok-n">id</span><span class="tok-o">)</span> <span class="tok-o">{</span> <span class="tok-o">...</span> <span class="tok-o">}</span>

  <span class="tok-nd">@PUT</span>
  <span class="tok-nd">@Path</span><span class="tok-o">(</span><span class="tok-s">&quot;{id}&quot;</span><span class="tok-o">)</span>
  <span class="tok-nd">@Consumes</span><span class="tok-o">(</span><span class="tok-s">&quot;application/xml&quot;</span><span class="tok-o">)</span>
  <span class="tok-kd">public</span> <span class="tok-kt">void</span> <span class="tok-nf">modificarCliente</span><span class="tok-o">(</span><span class="tok-nd">@PathParam</span><span class="tok-o">(</span><span class="tok-s">&quot;id&quot;</span><span class="tok-o">)</span> <span class="tok-kt">int</span> <span class="tok-n">id</span><span class="tok-o">,</span> <span class="tok-n">Cliente</span> <span class="tok-n">cli</span><span class="tok-o">)</span> <span class="tok-o">{</span> <span class="tok-o">...</span> <span class="tok-o">}</span>
<span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Si un usuario envÃ­a la peticiÃ³n <em>GET /clientes/norteamerica-db/333</em>, el proveedor
JAX-RS primero realizarÃ¡ un <em>matching</em> de la expresiÃ³n sobre el mÃ©todo <em>ZonasClienteResource.getBaseDeDatos()</em>.
A continuaciÃ³n procesarÃ¡ el resto de la peticiÃ³n ("/333") a travÃ©s del mÃ©todo
ClienteResource.recuperarClienteId().</p>
</div>
<div class="paragraph">
<p>Podemos observar que la nueva clase <strong>ClienteResource</strong>, ademÃ¡s de tener un nuevo constructor,
ya no estÃ¡ anotada con @Path. Esto implica que <strong>ya no es un recurso</strong> de nuestro sistema;
es un <strong>subrecurso</strong> y no debe ser registrada en el <em>runtime</em> de JAX-RS a travÃ©s de la
clase <em>Application</em> (como veremos mÃ¡s adelante).</p>
</div>
<div class="paragraph">
<p>Veamos otro ejemplo. Supongamos que tenemos un conjunto de alumnos, del que podemos
obtener el listado completo de alumnos y aÃ±adir nuevos alumnos, pero ademÃ¡s
queremos que cada alumno individual pueda consultarse, modificarse o borrarse.
Una forma sencilla de tratar esto es dividir el cÃ³digo en un <strong>recurso</strong> (lista de
alumnos) y un <strong>subrecurso</strong> (alumno individual) de la siguiente forma:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span class="tok-nd">@Path</span><span class="tok-o">(</span><span class="tok-s">&quot;/alumnos&quot;</span><span class="tok-o">)</span>
<span class="tok-kd">public</span> <span class="tok-kd">class</span> <span class="tok-nc">AlumnosResource</span> <span class="tok-o">{</span>

    <span class="tok-nd">@Context</span>
    <span class="tok-n">UriInfo</span> <span class="tok-n">uriInfo</span><span class="tok-o">;</span>

    <span class="tok-nd">@GET</span>
    <span class="tok-nd">@Produces</span><span class="tok-o">({</span><span class="tok-n">MediaType</span><span class="tok-o">.</span><span class="tok-na">APPLICATION_XML</span><span class="tok-o">,</span>
               <span class="tok-n">MediaType</span><span class="tok-o">.</span><span class="tok-na">APPLICATION_JSON</span><span class="tok-o">})</span>
    <span class="tok-kd">public</span> <span class="tok-n">List</span><span class="tok-o">&lt;</span><span class="tok-n">AlumnoBean</span><span class="tok-o">&gt;</span> <span class="tok-nf">getAlumnos</span><span class="tok-o">()</span> <span class="tok-o">{</span>
        <span class="tok-k">return</span> <span class="tok-n">FactoriaDaos</span><span class="tok-o">.</span><span class="tok-na">getAlumnoDao</span><span class="tok-o">().</span><span class="tok-na">getAlumnos</span><span class="tok-o">();</span>
    <span class="tok-o">}</span>

    <span class="tok-nd">@POST</span>
    <span class="tok-nd">@Consumes</span><span class="tok-o">(</span><span class="tok-n">MediaType</span><span class="tok-o">.</span><span class="tok-na">APPLICATION_JSON</span><span class="tok-o">)</span>
    <span class="tok-kd">public</span> <span class="tok-kt">void</span> <span class="tok-nf">addAlumno</span><span class="tok-o">(</span><span class="tok-n">AlumnoBean</span> <span class="tok-n">alumno</span><span class="tok-o">)</span> <span class="tok-kd">throws</span> <span class="tok-n">IOException</span> <span class="tok-o">{</span>
        <span class="tok-n">String</span> <span class="tok-n">dni</span> <span class="tok-o">=</span> <span class="tok-n">FactoriaDaos</span><span class="tok-o">.</span><span class="tok-na">getAlumnoDao</span><span class="tok-o">().</span><span class="tok-na">addAlumno</span><span class="tok-o">(</span><span class="tok-n">alumno</span><span class="tok-o">);</span>
        <span class="tok-n">URI</span> <span class="tok-n">uri</span> <span class="tok-o">=</span>
          <span class="tok-n">uriInfo</span><span class="tok-o">.</span><span class="tok-na">getAbsolutePathBuilder</span><span class="tok-o">().</span><span class="tok-na">path</span><span class="tok-o">(</span><span class="tok-s">&quot;{dni}&quot;</span><span class="tok-o">).</span><span class="tok-na">build</span><span class="tok-o">(</span><span class="tok-n">dni</span><span class="tok-o">);</span>
        <span class="tok-n">Response</span><span class="tok-o">.</span><span class="tok-na">created</span><span class="tok-o">(</span><span class="tok-n">uri</span><span class="tok-o">).</span><span class="tok-na">build</span><span class="tok-o">();</span>
    <span class="tok-o">}</span>

    <span class="tok-nd">@Path</span><span class="tok-o">(</span><span class="tok-s">&quot;{alumno}&quot;</span><span class="tok-o">)</span>
    <span class="tok-kd">public</span> <span class="tok-n">AlumnoResource</span> <span class="tok-nf">getAlumno</span><span class="tok-o">(</span>
                           <span class="tok-nd">@PathParam</span><span class="tok-o">(</span><span class="tok-s">&quot;alumno&quot;</span><span class="tok-o">)</span> <span class="tok-n">String</span> <span class="tok-n">dni</span><span class="tok-o">)</span> <span class="tok-o">{</span>
        <span class="tok-k">return</span> <span class="tok-k">new</span> <span class="tok-nf">AlumnoResource</span><span class="tok-o">(</span><span class="tok-n">uriInfo</span><span class="tok-o">,</span> <span class="tok-n">dni</span><span class="tok-o">);</span>
    <span class="tok-o">}</span>

<span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Vemos que en este recurso inyectamos informaciÃ³n sobre la URI solicitada como
variable de instancia (utilizando la anotaciÃ³n <code>@Context</code>, de la que hablaremos
mÃ¡s adelante). Para el conjunto de alumnos ofrecemos dos operaciones:
obtener la lista de alumnos, y aÃ±adir un nuevo alumno a la lista, la cual devuelve
como respuesta la URI que nos da acceso al recurso que acabamos de aÃ±adir.</p>
</div>
<div class="paragraph">
<p>Sin embargo, lo mÃ¡s destacable es el Ãºltimo mÃ©todo. Ãste se ejecutarÃ¡ cuando
aÃ±adamos a la ruta el identificador de un alumno (por ejemplo <code>/alumnos/15</code>).
En este caso lo que hace es devolver un subrecurso (<strong>AlumnoResource</strong>),
para asÃ­ tratar un alumno individual (destacamos que el nombre estÃ¡ en singular,
para distinguirlo del recurso anterior que representa el conjunto).</p>
</div>
<div class="paragraph">
<p>Cuando hacemos esto estamos delegando en el nuevo <em>Recurso</em> para tratar la peticiÃ³n.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span class="tok-kd">public</span> <span class="tok-kd">class</span> <span class="tok-nc">AlumnoResource</span> <span class="tok-o">{</span>

    <span class="tok-n">UriInfo</span> <span class="tok-n">uriInfo</span><span class="tok-o">;</span>

    <span class="tok-n">String</span> <span class="tok-n">dni</span><span class="tok-o">;</span>

    <span class="tok-kd">public</span> <span class="tok-nf">AlumnoResource</span><span class="tok-o">(</span><span class="tok-n">UriInfo</span> <span class="tok-n">uriInfo</span><span class="tok-o">,</span> <span class="tok-n">String</span> <span class="tok-n">dni</span><span class="tok-o">)</span> <span class="tok-o">{</span>
        <span class="tok-k">this</span><span class="tok-o">.</span><span class="tok-na">uriInfo</span> <span class="tok-o">=</span> <span class="tok-n">uriInfo</span><span class="tok-o">;</span>
        <span class="tok-k">this</span><span class="tok-o">.</span><span class="tok-na">dni</span> <span class="tok-o">=</span> <span class="tok-n">dni</span><span class="tok-o">;</span>
    <span class="tok-o">}</span>

    <span class="tok-nd">@GET</span>
    <span class="tok-nd">@Produces</span><span class="tok-o">({</span><span class="tok-n">MediaType</span><span class="tok-o">.</span><span class="tok-na">APPLICATION_XML</span><span class="tok-o">,</span><span class="tok-n">MediaType</span><span class="tok-o">.</span><span class="tok-na">APPLICATION_JSON</span><span class="tok-o">})</span>
    <span class="tok-kd">public</span> <span class="tok-n">AlumnoBean</span> <span class="tok-nf">getAlumno</span><span class="tok-o">()</span> <span class="tok-o">{</span>
        <span class="tok-n">AlumnoBean</span> <span class="tok-n">alumno</span> <span class="tok-o">=</span>
            <span class="tok-n">FactoriaDaos</span><span class="tok-o">.</span><span class="tok-na">getAlumnoDao</span><span class="tok-o">().</span><span class="tok-na">getAlumno</span><span class="tok-o">(</span><span class="tok-n">dni</span><span class="tok-o">);</span>
        <span class="tok-k">if</span><span class="tok-o">(</span><span class="tok-n">alumno</span><span class="tok-o">==</span><span class="tok-kc">null</span><span class="tok-o">)</span>
            <span class="tok-k">throw</span> <span class="tok-k">new</span> <span class="tok-nf">WebApplicationException</span><span class="tok-o">(</span><span class="tok-n">Status</span><span class="tok-o">.</span><span class="tok-na">NOT_FOUND</span><span class="tok-o">);</span>
        <span class="tok-k">return</span> <span class="tok-n">alumno</span><span class="tok-o">;</span>
    <span class="tok-o">}</span>

    <span class="tok-nd">@PUT</span>
    <span class="tok-nd">@Consumes</span><span class="tok-o">(</span><span class="tok-n">MediaType</span><span class="tok-o">.</span><span class="tok-na">APPLICATION_XML</span><span class="tok-o">)</span>
    <span class="tok-kd">public</span> <span class="tok-n">Response</span> <span class="tok-nf">setAlumno</span><span class="tok-o">(</span><span class="tok-n">AlumnoBean</span> <span class="tok-n">alumno</span><span class="tok-o">)</span> <span class="tok-o">{</span>
        <span class="tok-c1">// El DNI del alumno debe coincidir con el de la URI</span>
        <span class="tok-n">alumno</span><span class="tok-o">.</span><span class="tok-na">setDni</span><span class="tok-o">(</span><span class="tok-n">dni</span><span class="tok-o">);</span>

        <span class="tok-k">if</span><span class="tok-o">(</span><span class="tok-n">FactoriaDaos</span><span class="tok-o">.</span><span class="tok-na">getAlumnoDao</span><span class="tok-o">().</span><span class="tok-na">getAlumno</span><span class="tok-o">(</span><span class="tok-n">dni</span><span class="tok-o">)</span> <span class="tok-o">!=</span> <span class="tok-kc">null</span><span class="tok-o">)</span> <span class="tok-o">{</span>
            <span class="tok-n">FactoriaDaos</span><span class="tok-o">.</span><span class="tok-na">getAlumnoDao</span><span class="tok-o">().</span><span class="tok-na">updateAlumno</span><span class="tok-o">(</span><span class="tok-n">alumno</span><span class="tok-o">);</span>
            <span class="tok-k">return</span> <span class="tok-n">Response</span><span class="tok-o">.</span><span class="tok-na">noContent</span><span class="tok-o">().</span><span class="tok-na">build</span><span class="tok-o">();</span>
        <span class="tok-o">}</span> <span class="tok-k">else</span> <span class="tok-o">{</span>
            <span class="tok-n">FactoriaDaos</span><span class="tok-o">.</span><span class="tok-na">getAlumnoDao</span><span class="tok-o">().</span><span class="tok-na">addAlumno</span><span class="tok-o">(</span><span class="tok-n">alumno</span><span class="tok-o">);</span>
            <span class="tok-k">return</span>
                <span class="tok-n">Response</span><span class="tok-o">.</span><span class="tok-na">created</span><span class="tok-o">(</span><span class="tok-n">uriInfo</span><span class="tok-o">.</span><span class="tok-na">getAbsolutePath</span><span class="tok-o">()).</span><span class="tok-na">build</span><span class="tok-o">();</span>
        <span class="tok-o">}</span>
    <span class="tok-o">}</span>

    <span class="tok-nd">@DELETE</span>
    <span class="tok-kd">public</span> <span class="tok-kt">void</span> <span class="tok-nf">deleteAlumno</span><span class="tok-o">()</span> <span class="tok-o">{</span>
        <span class="tok-n">FactoriaDaos</span><span class="tok-o">.</span><span class="tok-na">getAlumnoDao</span><span class="tok-o">().</span><span class="tok-na">deleteAlumno</span><span class="tok-o">(</span><span class="tok-n">dni</span><span class="tok-o">);</span>
    <span class="tok-o">}</span>
<span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Este recurso ya no es un recurso raÃ­z mapeado a una ruta determinada (podemos ver
que la clase no lleva la anotaciÃ³n @Path), sino que es creado desde otro recurso.
Es, por lo tanto, un subrecurso.</p>
</div>
<div class="paragraph">
<p>Como ya hemos visto, los subrecursos nos permiten simplificar la forma
de trabajar con conjuntos de recursos, definiendo en un Ãºnico mÃ©todo la ruta de
acceso a un recurso individual, en lugar de tenerlo que hacer de forma independiente
para cada operaciÃ³n.</p>
</div>
<div class="paragraph">
<p>AdemÃ¡s, este diseÃ±o modular de los recursos nos va a permitir reutilizar determinados
recursos dentro de otros. Por ejemplo, dentro del recurso de un alumno podrÃ­amos
ver la lista de asignaturas en las que se ha matriculado, y reutilizar el subrecurso
encargado de acceder a las asignaturas para poder acceder a sus datos a partir del
recurso del alumno. No deberemos abusar de esta caracterÃ­stica, ya que si creamos
relaciones cÃ­clicas perdemos la caracterÃ­stica deseable de los servicios REST de
que cada recurso estÃ¡ asignado a una Ãºnica URI.</p>
</div>
<div class="admonitionblock caution">
<table>
<tr>
<td class="icon">
<i class="fa icon-caution" title="Caution"></i>
</td>
<td class="content">
<div class="paragraph">
<p>En un subrecurso <strong>NO</strong> podemos inyectar objetos de contexto mediante la anotaciÃ³n
<code>@Context</code>, ya que no estamos en un recurso raÃ­z. Por ese motivo en el ejemplo
hemos proporcionado el objeto <strong>UriInfo</strong> en el constructor del subrecurso. De forma
alternativa, tambiÃ©n podrÃ­amos haber inyectado este objeto como parÃ¡metro de sus
mÃ©todos, en ese caso si que habrÃ­a sido posible la inyecciÃ³n.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="sect4">
<h5 id="_carÃ¡cter_dinÃ¡mico_del_dispatching_de_peticiones">CarÃ¡cter dinÃ¡mico del "dispatching" de peticiones</h5>
<div class="paragraph">
<p>En los ejemplos anteriores hemos ilustrado el concepto de <em>subresource locator</em>, aunque no
hemos mostrado completamente su carÃ¡cter dinÃ¡mico. AsÃ­, si volvemos al primero de ellos,
el mÃ©todo <em>ZonasClienteResource.getBaseDeDatos()</em>
puede devolver <strong>cualquier</strong> instancia de <strong>cualquier clase</strong>. En tiempo de ejecuciÃ³n, el proveedor
JAX-RS "buscarÃ¡ el interior" de esta instancia mÃ©todos de recurso que puedan gestionar la
peticiÃ³n.</p>
</div>
<div class="paragraph">
<p>Supongamos que tenemos dos bases de datos de clientes con diferentes tipos de identificadores.
Una de ellas utiliza una clave numÃ©rica. La otra utiliza una clave formada por el nombre y
apellidos. Necesitamos tener dos clases diferentes para extraer la informaciÃ³n adecuada de la
 URI de la peticiÃ³n. Cambiaremos la implementaciÃ³n de la siguiente forma:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span class="tok-nd">@Path</span><span class="tok-o">(</span><span class="tok-s">&quot;/clientes&quot;</span><span class="tok-o">)</span>
<span class="tok-kd">public</span> <span class="tok-kd">class</span> <span class="tok-nc">ZonasClienteResourceResource</span> <span class="tok-o">{</span>
   <span class="tok-kd">protected</span> <span class="tok-n">ClienteResource</span> <span class="tok-n">europa</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-nf">ClienteResource</span><span class="tok-o">();</span>
   <span class="tok-kd">protected</span> <span class="tok-n">OtraClaveClienteResource</span> <span class="tok-n">norteamerica</span> <span class="tok-o">=</span>
                          <span class="tok-k">new</span> <span class="tok-nf">OtraClaveClienteResource</span><span class="tok-o">();</span>

   <span class="tok-nd">@Path</span><span class="tok-o">(</span><span class="tok-s">&quot;{zona}-db&quot;</span><span class="tok-o">)</span>
   <span class="tok-kd">public</span> <span class="tok-n">Object</span> <span class="tok-nf">getBaseDeDatos</span><span class="tok-o">(</span><span class="tok-nd">@PathParam</span><span class="tok-o">(</span><span class="tok-s">&quot;zona&quot;</span><span class="tok-o">)</span> <span class="tok-n">String</span> <span class="tok-n">db</span><span class="tok-o">)</span> <span class="tok-o">{</span>
      <span class="tok-k">if</span> <span class="tok-o">(</span><span class="tok-n">db</span><span class="tok-o">.</span><span class="tok-na">equals</span><span class="tok-o">(</span><span class="tok-s">&quot;europa&quot;</span><span class="tok-o">))</span> <span class="tok-o">{</span>
         <span class="tok-k">return</span> <span class="tok-n">europa</span><span class="tok-o">;</span>
      <span class="tok-o">}</span>
      <span class="tok-k">else</span> <span class="tok-nf">if</span> <span class="tok-o">(</span><span class="tok-n">db</span><span class="tok-o">.</span><span class="tok-na">equals</span><span class="tok-o">(</span><span class="tok-s">&quot;norteamerica&quot;</span><span class="tok-o">))</span> <span class="tok-o">{</span>
               <span class="tok-k">return</span> <span class="tok-n">northamerica</span><span class="tok-o">;</span> <span class="tok-o">}</span>
      <span class="tok-k">else</span> <span class="tok-k">return</span> <span class="tok-kc">null</span><span class="tok-o">;</span> <span class="tok-o">}</span>
<span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>En lugar de devolver una instancia de ClienteResource, el mÃ©todo getBaseDeDatos()
devuelve una instancia de <code>java.lang.Object</code>. JAX-RS analizarÃ¡ la instancia
devuelta para ver cÃ³mo procesar el resto de la peticiÃ³n.</p>
</div>
<div class="paragraph">
<p>Ahora, si un usuario envÃ­a la peticiÃ³n <em>GET /clientes/europa-db/333</em>, se utilizarÃ¡
la clase ClienteResource para servir el resto de la peticiÃ³n. Si la peticiÃ³n es
<em>GET /clientes/norteamerica-db/john-smith</em> utilizaremos el nuevo subrecurso OtraClaveClienteResource:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span class="tok-kd">public</span> <span class="tok-kd">class</span> <span class="tok-nc">OtraClaveClienteResource</span> <span class="tok-o">{</span>
   <span class="tok-kd">private</span> <span class="tok-n">Map</span><span class="tok-o">&lt;</span><span class="tok-n">String</span><span class="tok-o">,</span> <span class="tok-n">Cliente</span><span class="tok-o">&gt;</span> <span class="tok-n">clienteDB</span> <span class="tok-o">=</span>
               <span class="tok-k">new</span> <span class="tok-n">ConcurrentHashMap</span><span class="tok-o">&lt;</span><span class="tok-n">String</span><span class="tok-o">,</span> <span class="tok-n">Cliente</span><span class="tok-o">&gt;();</span>
   <span class="tok-nd">@GET</span>
   <span class="tok-nd">@Path</span><span class="tok-o">(</span><span class="tok-s">&quot;{nombre}-{apellidos}&quot;</span><span class="tok-o">)</span>
   <span class="tok-nd">@Produces</span><span class="tok-o">(</span><span class="tok-s">&quot;application/xml&quot;</span><span class="tok-o">)</span>
   <span class="tok-kd">public</span> <span class="tok-n">Cliente</span> <span class="tok-nf">getCliente</span><span class="tok-o">(</span><span class="tok-nd">@PathParam</span><span class="tok-o">(</span><span class="tok-s">&quot;nombre&quot;</span><span class="tok-o">)</span> <span class="tok-n">String</span> <span class="tok-n">nombre</span><span class="tok-o">,</span>
                              <span class="tok-nd">@PathParam</span><span class="tok-o">(</span><span class="tok-s">&quot;apellidos&quot;</span><span class="tok-o">)</span> <span class="tok-n">String</span> <span class="tok-n">apelllidos</span><span class="tok-o">)</span> <span class="tok-o">{</span>
     <span class="tok-o">...</span>
   <span class="tok-o">}</span>

   <span class="tok-nd">@PUT</span>
   <span class="tok-nd">@Path</span><span class="tok-o">(</span><span class="tok-s">&quot;{nombre}-{apellidos}&quot;</span><span class="tok-o">)</span>
   <span class="tok-nd">@Consumes</span><span class="tok-o">(</span><span class="tok-s">&quot;application/xml&quot;</span><span class="tok-o">)</span>
   <span class="tok-kd">public</span> <span class="tok-kt">void</span> <span class="tok-nf">actualizaCliente</span><span class="tok-o">()</span><span class="tok-nd">@PathParam</span><span class="tok-o">(</span><span class="tok-s">&quot;nombre&quot;</span><span class="tok-o">)</span> <span class="tok-n">String</span> <span class="tok-n">nombre</span><span class="tok-o">,</span>
                            <span class="tok-nd">@PathParam</span><span class="tok-o">(</span><span class="tok-s">&quot;apellidos&quot;</span><span class="tok-o">)</span> <span class="tok-n">String</span> <span class="tok-n">apelllidos</span><span class="tok-o">,</span>
                             <span class="tok-n">Cliente</span> <span class="tok-n">cli</span><span class="tok-o">)</span> <span class="tok-o">{</span>
     <span class="tok-o">...</span>
   <span class="tok-o">}</span>
<span class="tok-o">}</span></code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_usos_de_las_anotaciones_produces_y_consumes">2.3. Usos de las anotaciones @Produces y @Consumes</h3>
<div class="paragraph">
<p>La informaciÃ³n enviada a un recurso y posteriormente devuelta al cliente que realizÃ³
la peticiÃ³n se especifica con la cabecera HTTP <code>Media-Type</code>, tanto en la peticiÃ³n
como en la respuesta. Como ya hemos visto, podemos especificar que representaciones de
los recursos (valor de <strong>Media_Type</strong>) son capaces de aceptar y/o producir nuestros
servicios mediante las siguientes anotaciones:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>javax.ws.rs.Consumes</p>
</li>
<li>
<p>javax.ws.rs.Produces</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>La ausencia de dichas anotaciones es equivalente a incluirlas con el valor de <em>media type</em>
<code><strong>/</strong></code>, es decir, su ausencia implica que se soporta (acepta) cualquier tipo de representaciÃ³n.</p>
</div>
<div class="sect3">
<h4 id="_anotaciÃ³n_consumes">2.3.1. AnotaciÃ³n @Consumes</h4>
<div class="paragraph">
<p>Esta anotaciÃ³n funciona conjuntamente con @POST y @PUT. Le indica al framework (librerÃ­as JAX-RS)
a quÃ© mÃ©todo se debe delegar la peticiÃ³n de entrada. EspecÃ­ficamente, el cliente
fija la cabecera HTTP <code>Content-Type</code> y el framework delega la peticiÃ³n al correspondiente
mÃ©todo capaz de manejar dicho contenido. Un ejemplo de anotaciÃ³n con @PUT es la
siguiente:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span class="tok-nd">@Path</span><span class="tok-o">(</span><span class="tok-s">&quot;/pedidos&quot;</span><span class="tok-o">)</span>
<span class="tok-kd">public</span> <span class="tok-kd">class</span> <span class="tok-nc">PedidoResource</span> <span class="tok-o">{</span>
   <span class="tok-nd">@PUT</span>
   <span class="tok-nd">@Consumes</span><span class="tok-o">(</span><span class="tok-s">&quot;application/xml&quot;</span><span class="tok-o">)</span>
   <span class="tok-kd">public</span> <span class="tok-kt">void</span> <span class="tok-nf">modificarPedido</span><span class="tok-o">(</span><span class="tok-n">Pedido</span> <span class="tok-n">representation</span><span class="tok-o">)</span> <span class="tok-o">{</span> <span class="tok-o">}</span>
<span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Si @Consumes se aplica a la clase, por defecto los mÃ©todos correspondientes aceptan
los tipos especificados de tipo MIME. Si se aplica a nivel de mÃ©todo, se ignora
cualquier anotaciÃ³n @Consumes a nivel de clase para dicho mÃ©todo.</p>
</div>
<div class="paragraph">
<p>En este ejemplo, le estamos indicando al framework que el mÃ©todo <em>modificarPedido()</em>
  acepta un recurso cuya representaciÃ³n (tipo MIME) es "application/xml"
  (y que se almacenarÃ¡
  en la variable <em>representation</em>, hablaremos de ello en la siguiente sesiÃ³n). Por lo tanto, un cliente que se conecte al
  servicio web a travÃ©s de la URI <em>/pedidos</em> debe enviar una peticiÃ³n HTTP PUT
  conteniendo el valor de <code>application/xml</code> como tipo MIME de la cabecera <code>HTTP Content-Type</code>,
  y el cuerpo (<em>body</em>) del mensaje HTTP debe ser, por tanto, un documento xml vÃ¡lido.</p>
</div>
<div class="paragraph">
<p>Si no hay mÃ©todos de recurso que puedan responder al tipo MIME solicitado (tipo MIME
especificado en la anotaciÃ³n @Consumes del servicio), se le
devolverÃ¡ al cliente un cÃ³digo <strong><em>HTTP 415 ("Unsupported Media Type")</em></strong>. Si el mÃ©todo
que consume la representaciÃ³n indicada como tipo MIME no devuelve ninguna representaciÃ³n,
se enviarÃ¡ un el cÃ³digo <strong>HTTP 204 ("No content")</strong>. A continuaciÃ³n mostramos un
ejemplo en el que sucede Ã©sto:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span class="tok-nd">@POST</span>
<span class="tok-nd">@Consumes</span><span class="tok-o">(</span><span class="tok-s">&quot;application/xml&quot;</span><span class="tok-o">)</span>
<span class="tok-kd">public</span> <span class="tok-kt">void</span> <span class="tok-nf">creaPedido</span><span class="tok-o">(</span><span class="tok-n">Pedido</span> <span class="tok-n">pedido</span><span class="tok-o">)</span> <span class="tok-o">{</span>
    <span class="tok-c1">// Crea y almacena un nuevo _Pedido_</span>
<span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Podemos ver que el mÃ©todo "consume" una representaciÃ³n en texto plano, pero devuelve <strong>void</strong>,
es decir, no devuelve ninguna representaciÃ³n. En este caso, se envÃ­a el cÃ³digo de
estado  <strong>HTTP 204 No content</strong> en la respuesta.</p>
</div>
<div class="paragraph">
<p>Un recurso puede aceptar diferentes tipos de "entradas". AsÃ­, podemos utilizar la
anotaciÃ³n @PUT con mÃ¡s de un mÃ©todo para gestionar las repuestas con tipos MIME
diferentes. Por ejemplo, podrÃ­amos tener un mÃ©todo para aceptar estructuras XML,
y otro para aceptar estructuras JSON.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span class="tok-nd">@Path</span><span class="tok-o">(</span><span class="tok-s">&quot;/pedidos&quot;</span><span class="tok-o">)</span>
<span class="tok-kd">public</span> <span class="tok-kd">class</span> <span class="tok-nc">PedidoResource</span> <span class="tok-o">{</span>
Â 
Â Â Â <span class="tok-nd">@PUT</span>
Â Â Â <span class="tok-nd">@Consumes</span><span class="tok-o">(</span><span class="tok-s">&quot;application/xml&quot;</span><span class="tok-o">)</span>
Â Â Â <span class="tok-kd">public</span> <span class="tok-kt">void</span> <span class="tok-nf">modificarPedidoXML</span><span class="tok-o">(</span><span class="tok-n">InputStream</span> <span class="tok-n">pedido</span><span class="tok-o">)</span> <span class="tok-o">{</span> <span class="tok-o">}</span>
Â Â Â Â 
Â Â Â <span class="tok-nd">@PUT</span>
Â Â Â <span class="tok-nd">@Consumes</span><span class="tok-o">(</span><span class="tok-s">&quot;application/json&quot;</span><span class="tok-o">)</span>
Â Â Â <span class="tok-kd">public</span> <span class="tok-kt">void</span> <span class="tok-nf">modificarPedidoJson</span><span class="tok-o">(</span><span class="tok-n">InputStream</span> <span class="tok-n">pedido</span><span class="tok-o">)</span> <span class="tok-o">{</span> <span class="tok-o">}</span>
Â 
<span class="tok-o">}</span></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_anotaciÃ³n_produces">2.3.2. AnotaciÃ³n @Produces</h4>
<div class="paragraph">
<p>Esta anotaciÃ³n funciona conjuntamente con @GET, @POST y @PUT. Indica al <em>framework</em>
quÃ© tipo de representaciÃ³n se envÃ­a de vuelta al cliente.</p>
</div>
<div class="paragraph">
<p>De forma mÃ¡s especÃ­fica, el cliente envÃ­a una peticiÃ³n HTTP junto con una cabecera
HTTP <strong>Accept</strong> que se mapea directamente con el <strong>Content-Type</strong> que el mÃ©todo produce.
Por lo tanto, si el valor de la cabecera Accept HTTP es <strong>application/xml</strong>, el mÃ©todo
que gestiona la peticiÃ³n devuelve un stream de tipo MIME <strong>application/xml</strong>. Esta anotaciÃ³n
tambiÃ©n puede utilizarse en mÃ¡s de un mÃ©todo en la misma clase de recurso. Un ejemplo que
devuelve representaciones XML y JSON serÃ­a el siguiente:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span class="tok-nd">@Path</span><span class="tok-o">(</span><span class="tok-s">&quot;/pedidos&quot;</span><span class="tok-o">)</span>
<span class="tok-kd">public</span> <span class="tok-kd">class</span> <span class="tok-nc">PedidoResource</span> <span class="tok-o">{</span>

   <span class="tok-nd">@GET</span>
   <span class="tok-nd">@Produces</span><span class="tok-o">(</span><span class="tok-s">&quot;application/xml&quot;</span><span class="tok-o">)</span>
   <span class="tok-kd">public</span> <span class="tok-n">String</span> <span class="tok-nf">getPedidoXml</span><span class="tok-o">()</span> <span class="tok-o">{</span> <span class="tok-o">}</span>

   <span class="tok-nd">@GET</span>
   <span class="tok-nd">@Produces</span><span class="tok-o">(</span><span class="tok-s">&quot;application/json&quot;</span><span class="tok-o">)</span>
   <span class="tok-kd">public</span> <span class="tok-n">String</span> <span class="tok-nf">getPedidoJson</span><span class="tok-o">()</span> <span class="tok-o">{</span> <span class="tok-o">}</span>
<span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="admonitionblock caution">
<table>
<tr>
<td class="icon">
<i class="fa icon-caution" title="Caution"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Si un cliente solicita una peticiÃ³n a una URI con un tipo MIME no soportado por el
recurso, el <em>framework</em> JAX-RS lanza la excepciÃ³n adecuada, concretamente el runtime
de JAX-RS envÃ­a de vuelta un error <strong>HTTP 406 Not acceptable</strong></p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Se puede declarar mÃ¡s de un tipo en la misma declaraciÃ³n @Produces, como por ejemplo:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span class="tok-nd">@Produces</span><span class="tok-o">({</span><span class="tok-s">&quot;application/xml&quot;</span><span class="tok-o">,</span> <span class="tok-s">&quot;application/json&quot;</span><span class="tok-o">})</span>
<span class="tok-kd">public</span> <span class="tok-n">String</span> <span class="tok-nf">getPedidosXmlOJson</span><span class="tok-o">()</span> <span class="tok-o">{</span>
Â Â Â <span class="tok-o">...</span>
<span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>El mÃ©todo <em>getPedidosXmlOJson()</em> serÃ¡ invocado si cualquiera de los dos tipos MIME
especificados en la anotaciÃ³n @Produces son aceptables (la cabecera <strong>Accept</strong> de la
peticiÃ³n HTTP indica quÃ© representaciÃ³n es aceptable). Si ambas representaciones
son igualmente aceptables, se elegirÃ¡ la primera.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>En lugar de especificar los tipos MIME como cadenas de texto en @Consumes y @Produces,
podemos utilizar las constantes definidas en la clase <strong>javax.ws.rs.core.MediaType</strong>,
como por ejemplo <code>MediaType.APPLICATION_XML</code> o <code>MediaType.APPLICATION_JSON</code>, en lugar
de <code>application/xml</code> y <code>application/json</code>.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_inyecciÃ³n_de_parÃ¡metros_jax_rs">2.4. InyecciÃ³n de parÃ¡metros JAX-RS</h3>
<div class="paragraph">
<p>Buena parte del "trabajo" de JAX-RS es el "extraer" informaciÃ³n de una peticiÃ³n HTTP e
inyectarla en un mÃ©todo Java. Podemos estar interesados en un fragmento de la URI de
entrada, en los parÃ¡metros de peticiÃ³n,&#8230;&#8203; El cliente tambiÃ©n podrÃ­a enviar informaciÃ³n
en las cabeceras de la peticiÃ³n. A continuaciÃ³n indicamos una lista con algunas de las
anotaciones que podemos
utilizar para inyectar informaciÃ³n de las peticiones HTTP.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>@javax.ws.rs.PathParam</p>
</li>
<li>
<p>@javax.ws.rs.MatrixParam</p>
</li>
<li>
<p>@javax.ws.rs.QueryParam</p>
</li>
<li>
<p>@javax.ws.rs.FormParam</p>
</li>
<li>
<p>@javax.ws.rs.HeaderParam</p>
</li>
<li>
<p>@javax.ws.rs.Context</p>
</li>
<li>
<p>@javax.ws.rs.BeanParam</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Habitualmente, estas anotaciones se utilizan en los parÃ¡metros de un mÃ©todo de recurso JAX-RX.
Cuando el proveedor de JAX-RS recibe una peticiÃ³n HTTP, busca un mÃ©todo Java que pueda servir
dicha peticiÃ³n. Si el mÃ©todo Java tiene parÃ¡metros anotados con alguna de estas anotaciones,
extraerÃ¡ la informaciÃ³n de la peticiÃ³n HTTP y la "pasarÃ¡" como un <strong>parÃ¡metro</strong> cuando se invoque
el mÃ©todo.</p>
</div>
<div class="sect3">
<h4 id="__javax_ws_rs_pathparam">2.4.1. @javax.ws.rs.PathParam</h4>
<div class="paragraph">
<p>Ya la hemos utilizado en la sesiÃ³n anterior. @PathParam nos permite inyectar el valor de
los parÃ¡metros de la URI definidos en expresiones @Path. Recordemos el ejemplo:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span class="tok-nd">@Path</span><span class="tok-o">(</span><span class="tok-s">&quot;/clientes&quot;</span><span class="tok-o">)</span>
<span class="tok-kd">public</span> <span class="tok-kd">class</span> <span class="tok-nc">ClienteResource</span> <span class="tok-o">{</span>
  <span class="tok-o">...</span>

  <span class="tok-nd">@GET</span>
  <span class="tok-nd">@Path</span><span class="tok-o">(</span><span class="tok-s">&quot;{id}&quot;</span><span class="tok-o">)</span>
  <span class="tok-nd">@Produces</span><span class="tok-o">(</span><span class="tok-s">&quot;application/xml&quot;</span><span class="tok-o">)</span>
  <span class="tok-kd">public</span> <span class="tok-n">Cliente</span> <span class="tok-nf">recuperarClienteId</span><span class="tok-o">(</span><span class="tok-nd">@PathParam</span><span class="tok-o">(</span><span class="tok-s">&quot;id&quot;</span><span class="tok-o">)</span> <span class="tok-kt">int</span> <span class="tok-n">id</span><span class="tok-o">)</span> <span class="tok-o">{</span>
    <span class="tok-o">...</span>
  <span class="tok-o">}</span>
<span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Podemos referenciar mÃ¡s de un parÃ¡metro en el path de la URI en nuestros mÃ©todo java. Por ejemplo,
supongamos que estamos utilizando el nombre y apellidos para identificar a un cliente en
nuestra clase de recurso:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span class="tok-nd">@Path</span><span class="tok-o">(</span><span class="tok-s">&quot;/clientes&quot;</span><span class="tok-o">)</span>
<span class="tok-kd">public</span> <span class="tok-kd">class</span> <span class="tok-nc">ClienteResource</span> <span class="tok-o">{</span>
  <span class="tok-o">...</span>

  <span class="tok-nd">@GET</span>
  <span class="tok-nd">@Path</span><span class="tok-o">(</span><span class="tok-s">&quot;{nombre}-{apellidos}&quot;</span><span class="tok-o">)</span>
  <span class="tok-nd">@Produces</span><span class="tok-o">(</span><span class="tok-s">&quot;application/xml&quot;</span><span class="tok-o">)</span>
  <span class="tok-kd">public</span> <span class="tok-n">Cliente</span> <span class="tok-nf">recuperarClienteId</span><span class="tok-o">(</span><span class="tok-nd">@PathParam</span><span class="tok-o">(</span><span class="tok-s">&quot;nombre&quot;</span><span class="tok-o">)</span> <span class="tok-n">String</span> <span class="tok-n">nom</span><span class="tok-o">,</span>
                                    <span class="tok-nd">@PathParam</span><span class="tok-o">(</span><span class="tok-s">&quot;apellidos&quot;</span><span class="tok-o">)</span> <span class="tok-n">String</span> <span class="tok-n">ape</span><span class="tok-o">)</span> <span class="tok-o">{</span>
    <span class="tok-o">...</span>
  <span class="tok-o">}</span>
<span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>En ocasiones, un paramÃ©tro de path de la URI puede repetirse en diferentes expresiones @Path
que conforman el patrÃ³n de <em>matching</em> completo para un mÃ©todo de un recurso (por ejemplo
puede repetirse en la expresiÃ³n @Path de la clase y de un mÃ©todo). En estos casos, la anotaciÃ³n
@PathParam siempre referencia el parÃ¡metro path final. AsÃ­, en el siguiente cÃ³digo:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span class="tok-nd">@Path</span><span class="tok-o">(</span><span class="tok-s">&quot;/clientes/{id}&quot;</span><span class="tok-o">)</span>
<span class="tok-kd">public</span> <span class="tok-kd">class</span> <span class="tok-nc">ClienteResource</span> <span class="tok-o">{</span>
  <span class="tok-o">...</span>

  <span class="tok-nd">@GET</span>
  <span class="tok-nd">@Path</span><span class="tok-o">(</span><span class="tok-s">&quot;/direccion/{id}&quot;</span><span class="tok-o">)</span>
  <span class="tok-nd">@Produces</span><span class="tok-o">(</span><span class="tok-s">&quot;text/plain&quot;</span><span class="tok-o">)</span>
  <span class="tok-kd">public</span> <span class="tok-n">String</span> <span class="tok-nf">getDireccion</span><span class="tok-o">(</span><span class="tok-nd">@PathParam</span><span class="tok-o">(</span><span class="tok-s">&quot;id&quot;</span><span class="tok-o">)</span> <span class="tok-n">String</span> <span class="tok-n">direccionId</span><span class="tok-o">)</span> <span class="tok-o">{</span>
    <span class="tok-o">...</span>
  <span class="tok-o">}</span>
<span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Si nuestra peticiÃ³n HTTP es: <strong>GET /clientes/123/direccion/456</strong>, el parÃ¡metro <code>direccionId</code> del
mÃ©todo <em>getDireccion()</em> tendrÃ­a el valor inyectado de <strong>"456"</strong>.</p>
</div>
</div>
<div class="sect3">
<h4 id="_interfaz_uriinfo">2.4.2. Interfaz UriInfo</h4>
<div class="paragraph">
<p>Podemos disponer, ademÃ¡s, de un API mÃ¡s general para consultar y extraer informaciÃ³n sobre las
peticiones URI de entrada. Se trata de la interfaz <code>javax.ws.rs.core.UriInfo</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span class="tok-kd">public</span> <span class="tok-kd">interface</span> <span class="tok-nc">UriInfo</span> <span class="tok-o">{</span>
  <span class="tok-kd">public</span> <span class="tok-n">java</span><span class="tok-o">.</span><span class="tok-na">net</span><span class="tok-o">.</span><span class="tok-na">URI</span> <span class="tok-nf">getAbsolutePath</span><span class="tok-o">();</span>
  <span class="tok-kd">public</span> <span class="tok-n">UriBuilder</span> <span class="tok-nf">getAbsolutePathBuilder</span><span class="tok-o">();</span>

  <span class="tok-kd">public</span> <span class="tok-n">java</span><span class="tok-o">.</span><span class="tok-na">net</span><span class="tok-o">.</span><span class="tok-na">URI</span> <span class="tok-nf">getBaseUri</span><span class="tok-o">();</span>
  <span class="tok-kd">public</span> <span class="tok-n">UriBuilder</span> <span class="tok-nf">getBaseUriBuilder</span><span class="tok-o">();</span>

  <span class="tok-kd">public</span> <span class="tok-n">String</span> <span class="tok-nf">getPath</span><span class="tok-o">();</span>
  <span class="tok-kd">public</span> <span class="tok-n">List</span><span class="tok-o">&lt;</span><span class="tok-n">PathSegment</span><span class="tok-o">&gt;</span> <span class="tok-nf">getPathSegments</span><span class="tok-o">();</span>
  <span class="tok-kd">public</span> <span class="tok-n">MultivaluedMap</span><span class="tok-o">&lt;</span><span class="tok-n">String</span><span class="tok-o">,</span> <span class="tok-n">String</span><span class="tok-o">&gt;</span> <span class="tok-nf">getPathParameters</span><span class="tok-o">();</span>
  <span class="tok-o">...</span>
<span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Los mÃ©todos <strong>getAbsolutePathBuilder()</strong> y <strong>getAbsolutePath()</strong> devuelven la ruta
absoluta de la <strong>peticiÃ³n</strong> HTTP en forma de <em>UriBuilder</em> y <em>URI</em> respectivamente.</p>
</div>
<div class="paragraph">
<p>Los mÃ©todos <strong>getBaseUri()</strong> y <strong>getBaseUriBuilder()</strong> devuelven la ruta "base" de la
aplicaciÃ³n (ruta raiz de nuestros servicios rest) en forma de <em>UriBuilder</em> y <em>URI</em> respectivamente.</p>
</div>
<div class="paragraph">
<p>El mÃ©todo <strong>UriInfo.getPath()</strong> permite obtener la ruta relativa de nuestros servicios REST utilizada para
realizar el <em>matching</em> con nuestra peticiÃ³n de entrada (es la ruta de la peticiÃ³n
actual relativa a la ruta base de la peticiÃ³n rest)</p>
</div>
<div class="paragraph">
<p>El mÃ©todo <strong>UriInfo.getPathSegments()</strong> "divide" la
ruta relativa de nuestro servicio REST en una serie de objetos <em>PathSegment</em> (segmentos de ruta,
delimitados por <code>/</code>).</p>
</div>
<div class="paragraph">
<p>El mÃ©todo <strong>UriInfo.getPathParameters()</strong> devuelve un objeto de tipo <em>MultivaluedMap</em>
con todos los parÃ¡metros del path definidos en todas las expresiones @Path de nuestra
peticiÃ³n rest.</p>
</div>
<div class="paragraph">
<p>Por ejemplo, si la ruta de nuestra petciÃ³n http es: <em><a href="http://localhost:8080/contexto/rest/clientes/2" class="bare">http://localhost:8080/contexto/rest/clientes/2</a></em>
(siendo "contexto" la ruta raÃ­z del <em>war</em> desplegado, y "rest" la ruta de servicio de jax-rs):</p>
</div>
<div class="ulist">
<ul>
<li>
<p>la ruta absoluta (mÃ©todo <em>getAbsolutePath()</em>) serÃ­a <em><a href="http://localhost:8080/contexto/rest/clientes/2" class="bare">http://localhost:8080/contexto/rest/clientes/2</a></em></p>
</li>
<li>
<p>la ruta base (mÃ©todo <em>getBaseUri</em>) serÃ­a <em><a href="http://localhost:8080/contexto/rest/" class="bare">http://localhost:8080/contexto/rest/</a></em></p>
</li>
<li>
<p>la ruta relativa a la ruta base (mÃ©todo <em>getPath()</em>) serÃ­a <em>/clientes/2</em></p>
</li>
<li>
<p>el nÃºmero de segmentos de la peticiÃ³n rest (mÃ©todo <em>getPathSegments()</em>) serÃ­an 2: "clientes" y "2"</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Podemos inyectar una instancia de la interfaz <code>UriInfo</code> utilizando la anotaciÃ³n <code>@javax.ws.rs.core.Context</code>.
A continuaciÃ³n mostramos un ejemplo:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span class="tok-nd">@Path</span><span class="tok-o">(</span><span class="tok-s">&quot;/coches/{marca}&quot;</span><span class="tok-o">)</span>
<span class="tok-kd">public</span> <span class="tok-kd">class</span> <span class="tok-nc">CarResource</span> <span class="tok-o">{</span>

  <span class="tok-nd">@GET</span>
  <span class="tok-nd">@Path</span><span class="tok-o">(</span><span class="tok-s">&quot;/{modelo}/{anyo}&quot;</span><span class="tok-o">)</span>
  <span class="tok-nd">@Produces</span><span class="tok-o">(</span><span class="tok-s">&quot;image/jpeg&quot;</span><span class="tok-o">)</span>
  <span class="tok-kd">public</span> <span class="tok-n">Response</span> <span class="tok-nf">getImagen</span><span class="tok-o">(</span><span class="tok-nd">@Context</span> <span class="tok-n">UriInfo</span> <span class="tok-n">info</span><span class="tok-o">)</span> <span class="tok-o">{</span>
          <span class="tok-n">String</span> <span class="tok-n">fabricado</span> <span class="tok-o">=</span> <span class="tok-n">info</span><span class="tok-o">.</span><span class="tok-na">getPathParameters</span><span class="tok-o">().</span><span class="tok-na">getFirst</span><span class="tok-o">(</span><span class="tok-s">&quot;marca&quot;</span><span class="tok-o">);</span>
          <span class="tok-n">PathSegment</span> <span class="tok-n">modelo</span> <span class="tok-o">=</span> <span class="tok-n">info</span><span class="tok-o">.</span><span class="tok-na">getPathSegments</span><span class="tok-o">().</span><span class="tok-na">get</span><span class="tok-o">(</span><span class="tok-mi">2</span><span class="tok-o">);</span>
          <span class="tok-n">String</span> <span class="tok-n">color</span> <span class="tok-o">=</span> <span class="tok-n">modelo</span><span class="tok-o">.</span><span class="tok-na">getMatrixParameteres</span><span class="tok-o">().</span><span class="tok-na">getFirst</span><span class="tok-o">(</span><span class="tok-s">&quot;color&quot;</span><span class="tok-o">);</span>
          <span class="tok-o">...</span>
  <span class="tok-o">}</span>
<span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>En este ejemplo, inyectamos una instancia de <em>UriInfo</em> como parÃ¡metro del mÃ©todo <em>getImagen()</em>.
A continuaciÃ³n hacemos uso de dicha instancia para extraer informaciÃ³n de la URI.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Recuerda que tambiÃ©n podrÃ­amos inyectar una instancia de <em>UriInfo</em> en una variable de instancia
de la clase raÃ­z de nuestro recurso.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>El mÃ©todo <strong>CarResource.getImagen()</strong> utiliza la interfaz <code>javax.ws.rs.core.PathSegment</code> que,
como ya hemos indicado, representa un segmento de ruta.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span class="tok-kn">package</span> <span class="tok-n">javax</span><span class="tok-o">.</span><span class="tok-na">ws</span><span class="tok-o">.</span><span class="tok-na">rs</span><span class="tok-o">.</span><span class="tok-na">core</span><span class="tok-o">;</span>
<span class="tok-kd">public</span> <span class="tok-kd">interface</span> <span class="tok-nc">PathSegment</span> <span class="tok-o">{</span>
       <span class="tok-n">String</span> <span class="tok-nf">getPath</span><span class="tok-o">();</span>
       <span class="tok-n">MultivaluedMap</span><span class="tok-o">&lt;</span><span class="tok-n">String</span><span class="tok-o">,</span> <span class="tok-n">String</span><span class="tok-o">&gt;</span> <span class="tok-nf">getMatrixParameters</span><span class="tok-o">();</span>
<span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>El mÃ©todo <strong>PathSegment.getPath()</strong> devuelve el valor de la cadena de caracteres del segmento de ruta
actual, sin considerar nigÃºn parÃ¡metro matrix que pudiese contener.</p>
</div>
<div class="paragraph">
<p>El mÃ©todo <strong>PathSegment.getMatrixParameters()</strong> devuelve un "mapa" con todos los parÃ¡metros matrix
aplicados a un segmento de ruta.</p>
</div>
<div class="paragraph">
<p>Supongamos que realizamos la siguiente peticiÃ³n http para el cÃ³digo anterior (clase CarResource):</p>
</div>
<div class="literalblock">
<div class="content">
<pre>GET /coches/seat/leon;color=rojo/2015</pre>
</div>
</div>
<div class="paragraph">
<p>Esta peticiÃ³n es delegada en el mÃ©todo <em>ClarResource.getImagen()</em>. La ruta contiene 4
segmentos: <em>coches</em>, <em>seat</em>, <em>leon</em> y <em>2015. La variable _modelo</em> tomarÃ¡ el valor <em>leon</em>
y la variable <em>color</em> se instanciarÃ¡ con el valor <em>rojo</em>.</p>
</div>
</div>
<div class="sect3">
<h4 id="__javax_ws_rs_matrixparam">2.4.3. @javax.ws.rs.MatrixParam</h4>
<div class="paragraph">
<p>La especificaciÃ³n JAX-RS nos permite inyectar una matriz de valores de parÃ¡metros
a travÃ©s de la anotaciÃ³n <code>javax.ws.rs.MatrixParam</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span class="tok-nd">@Path</span><span class="tok-o">(</span><span class="tok-s">&quot;/coches/{marca}&quot;</span><span class="tok-o">)</span>
<span class="tok-kd">public</span> <span class="tok-kd">class</span> <span class="tok-nc">CarResource</span> <span class="tok-o">{</span>

  <span class="tok-nd">@GET</span>
  <span class="tok-nd">@Path</span><span class="tok-o">(</span><span class="tok-s">&quot;/{modelo}/{anyo}&quot;</span><span class="tok-o">)</span>
  <span class="tok-nd">@Produces</span><span class="tok-o">(</span><span class="tok-s">&quot;image/jpeg&quot;</span><span class="tok-o">)</span>
  <span class="tok-kd">public</span> <span class="tok-n">Response</span> <span class="tok-nf">getImagen</span><span class="tok-o">(</span><span class="tok-nd">@PathParam</span><span class="tok-o">(</span><span class="tok-s">&quot;marca&quot;</span><span class="tok-o">)</span> <span class="tok-n">String</span> <span class="tok-n">marca</span>
                        <span class="tok-nd">@PathParam</span><span class="tok-o">(</span><span class="tok-s">&quot;modelo&quot;</span><span class="tok-o">)</span> <span class="tok-n">String</span> <span class="tok-n">modelo</span>
                        <span class="tok-nd">@MatrixParam</span><span class="tok-o">(</span><span class="tok-s">&quot;color&quot;</span><span class="tok-o">)</span> <span class="tok-n">String</span> <span class="tok-n">color</span><span class="tok-o">)</span> <span class="tok-o">{</span>
  <span class="tok-o">...</span> <span class="tok-o">}</span>
<span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>El uso de la anotaciÃ³n <code>@MatrixParam</code> simplifica nuestro cÃ³digo y lo hace algo mÃ¡s
legible. Si, por ejemplo, la peticiÃ³n de entrada es:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="sh">GET /coches/seat/ibiza<span class="tok-p">;</span><span class="tok-nv">color</span><span class="tok-o">=</span>black/2009</code></pre>
</div>
</div>
<div class="paragraph">
<p>entonces el parÃ¡metro <em>color</em> del mÃ©todo <em>CarResource.getImagen()</em> tomarÃ­a el valor <em>black</em>.</p>
</div>
</div>
<div class="sect3">
<h4 id="__javax_ws_rs_queryparam">2.4.4. @javax.ws.rs.QueryParam</h4>
<div class="paragraph">
<p>La anotaciÃ³n <code>@javax.ws.rs.QueryParam</code> nos permite inyectar parÃ¡metros de consulta
(<strong><em>query parameters</em></strong>) de la
URI en los valores de los parÃ¡metros de los mÃ©todos java de nuestros recursos. Por ejemplo,
supongamos que queremos consultar informaciÃ³n de nuestros clientes y queremos recuperar
un subconjunto de clientes de nuestra base de datos. Nuestra URI de peticiÃ³n podrÃ­a ser
algo asÃ­:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>GET /clientes?inicio=0&amp;total=10</pre>
</div>
</div>
<div class="paragraph">
<p>El parÃ¡metro de consulta <code>inicio</code> representa el Ã­ndice (o posiciÃ³n) del primer cliente que
queremos consultar, y el parÃ¡metro <code>total</code> representa cuÃ¡ntos clientes en total queremos
obtener como respuesta. Una implementaciÃ³n del servicio RESTful podrÃ­a contener el
siguiente cÃ³digo:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span class="tok-nd">@Path</span><span class="tok-o">(</span><span class="tok-s">&quot;/clientes&quot;</span><span class="tok-o">)</span>
<span class="tok-kd">public</span> <span class="tok-kd">class</span> <span class="tok-nc">ClienteResource</span> <span class="tok-o">{</span>
  <span class="tok-nd">@GET</span>
  <span class="tok-nd">@Produces</span><span class="tok-o">(</span><span class="tok-s">&quot;application/xml&quot;</span><span class="tok-o">)</span>
  <span class="tok-kd">public</span> <span class="tok-n">String</span> <span class="tok-nf">getClientes</span><span class="tok-o">(</span><span class="tok-nd">@QueryParam</span><span class="tok-o">(</span><span class="tok-s">&quot;inicio&quot;</span><span class="tok-o">)</span> <span class="tok-kt">int</span> <span class="tok-n">inicio</span><span class="tok-o">,</span>
                            <span class="tok-nd">@QueryParam</span><span class="tok-o">(</span><span class="tok-s">&quot;total&quot;</span><span class="tok-o">)</span> <span class="tok-kt">int</span> <span class="tok-n">total</span><span class="tok-o">)</span>
  <span class="tok-o">...</span> <span class="tok-o">}</span>
<span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>En este ejemplo, el parÃ¡metro <code>inicio</code> tomarÃ­a el valor <code>0</code>, y el parÃ¡metro <code>total</code>
tomarÃ­a el valor <code>10</code> (JAX-RS convierte automÃ¡ticamente las cadenas de caracteres
  de los parÃ¡metros de consulta en enteros).</p>
</div>
</div>
<div class="sect3">
<h4 id="__javax_ws_rs_formparam">2.4.5. @javax.ws.rs.FormParam</h4>
<div class="paragraph">
<p>La anotaciÃ³n <code>@javax.ws.rs.FormParam</code> se utiliza para acceder al cuerpo del mensaje
de la peticiÃ³n HTTP de entrada, cuyo valor de <em>Content-Type</em> es <strong><em>application/x-www-form-urlencoded</em></strong>.
Es decir, se utiliza para acceder a entradas individuales de un formulario HTML. Por ejemplo,
supongamos que para registrar a nuevos clientes en el sistema tenemos que rellenar el
siguiente formulario:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><span class="tok-nt">&lt;FORM</span> <span class="tok-na">action=</span><span class="tok-s">&quot;http://ejemplo.com/clientes&quot;</span> <span class="tok-na">method=</span><span class="tok-s">&quot;post&quot;</span><span class="tok-nt">&gt;</span>
  <span class="tok-nt">&lt;P&gt;</span>
    Nombre: <span class="tok-nt">&lt;INPUT</span> <span class="tok-na">type=</span><span class="tok-s">&quot;text&quot;</span> <span class="tok-na">name=</span><span class="tok-s">&quot;nombre&quot;</span><span class="tok-nt">&gt;&lt;BR&gt;</span>
    Apellido: <span class="tok-nt">&lt;INPUT</span> <span class="tok-na">type=</span><span class="tok-s">&quot;text&quot;</span> <span class="tok-na">name=</span><span class="tok-s">&quot;apellido&quot;</span><span class="tok-nt">&gt;&lt;BR&gt;</span>
    <span class="tok-nt">&lt;INPUT</span> <span class="tok-na">type=</span><span class="tok-s">&quot;submit&quot;</span> <span class="tok-na">value=</span><span class="tok-s">&quot;Send&quot;</span><span class="tok-nt">&gt;</span>
  <span class="tok-nt">&lt;/P&gt;</span>
<span class="tok-nt">&lt;/FORM&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>La ejecuciÃ³n de este cÃ³digo, inyectarÃ¡ los valores del formulario como
parÃ¡metros de nuestro mÃ©todo Java que representa el servicio, de la siguiente forma:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span class="tok-nd">@Path</span><span class="tok-o">(</span><span class="tok-s">&quot;/clientes&quot;</span><span class="tok-o">)</span>
<span class="tok-kd">public</span> <span class="tok-kd">class</span> <span class="tok-nc">ClienteResource</span> <span class="tok-o">{</span>
   <span class="tok-nd">@POST</span>
   <span class="tok-kd">public</span> <span class="tok-kt">void</span> <span class="tok-nf">crearCliente</span><span class="tok-o">(</span><span class="tok-nd">@FormParam</span><span class="tok-o">(</span><span class="tok-s">&quot;nombre&quot;</span><span class="tok-o">)</span> <span class="tok-n">String</span> <span class="tok-n">nom</span><span class="tok-o">,</span>
                            <span class="tok-nd">@FormParam</span><span class="tok-o">(</span><span class="tok-s">&quot;apellido&quot;</span><span class="tok-o">)</span> <span class="tok-n">String</span> <span class="tok-n">ape</span><span class="tok-o">)</span> <span class="tok-o">{</span>
   <span class="tok-o">...</span> <span class="tok-o">}</span>
<span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>AquÃ­ estamos inyectando los valores de <code>nombre</code> y <code>apellidos</code> del formulario HTML en
los parÃ¡metors <code>nom</code> y <code>ape</code> del mÃ©todo java <em>crearCliente()</em>. Los datos del formulario
"viajan" a travÃ©s de la red codificados como <em>URL-encoded</em>. Cuando se utiliza
la anotaciÃ³n @FormParam, JAX-RS decodifica de forma automÃ¡tica las entradas del fomulario
antes de inyectar sus valores.</p>
</div>
<div class="paragraph">
<p>AsÃ­, por ejemplo, si tecleamos los valores <em>Maria Luisa</em> y_Perlado_, como valores en los
campos de texto <em>nombre</em> y <em>apellido</em> del formulario, el cuerpo de nuestro mensaje HTTP
serÃ¡ <strong>nombre=Maria%20Luisa;apellido=Perlado</strong>. Este mensaje serÃ¡ recibido por nuestro mÃ©todo, que
extraerÃ¡ los valores correspondientes y los instanciarÃ¡ en los parÃ¡metros <em>nom</em>,
y <em>ape</em> del mÃ©todo _ClienteResource.crearCliente().</p>
</div>
</div>
<div class="sect3">
<h4 id="__javax_ws_rs_headerparam">2.4.6. @javax.ws.rs.HeaderParam</h4>
<div class="paragraph">
<p>La anotaciÃ³n <code>@javax.ws.rs.HeaderParam</code> se utiliza para inyectar valores de las cabeceras de
las peticiones HTTP. Por ejemplo, si estamos interesados en la pÃ¡gina web que nos ha
referenciado o enlazado con nuestro servicio web, podrÃ­amos acceder a la cabecera HTTP
<strong>Referer</strong> utilizando la anotaciÃ³n @HeaderParam, de la siguiente forma:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span class="tok-nd">@Path</span><span class="tok-o">(</span><span class="tok-s">&quot;/miservicio&quot;</span><span class="tok-o">)</span>
<span class="tok-kd">public</span> <span class="tok-kd">class</span> <span class="tok-nc">MiServicio</span> <span class="tok-o">{</span>
  <span class="tok-nd">@GET</span>
  <span class="tok-nd">@Produces</span><span class="tok-o">(</span><span class="tok-s">&quot;text/html&quot;</span><span class="tok-o">)</span>
  <span class="tok-kd">public</span> <span class="tok-n">String</span> <span class="tok-nf">get</span><span class="tok-o">(</span><span class="tok-nd">@HeaderParam</span><span class="tok-o">(</span><span class="tok-s">&quot;Referer&quot;</span><span class="tok-o">)</span> <span class="tok-n">String</span> <span class="tok-n">referer</span><span class="tok-o">)</span> <span class="tok-o">{</span>
  <span class="tok-o">...</span> <span class="tok-o">}</span>
<span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>De forma alternativa, podemos acceder de forma programativa a todas las cabeceras de
la peticiÃ³n de entrada, utilizando la interfaz <code>javax.ws.rs.core.HttpHeaders</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span class="tok-kd">public</span> <span class="tok-kd">interface</span> <span class="tok-nc">HttpHeaders</span> <span class="tok-o">{</span>
  <span class="tok-kd">public</span> <span class="tok-n">List</span><span class="tok-o">&lt;</span><span class="tok-n">String</span><span class="tok-o">&gt;</span> <span class="tok-nf">getRequestHeader</span><span class="tok-o">(</span><span class="tok-n">String</span> <span class="tok-n">name</span><span class="tok-o">);</span>
  <span class="tok-kd">public</span> <span class="tok-n">MultivaluedMap</span><span class="tok-o">&lt;</span><span class="tok-n">String</span><span class="tok-o">,</span> <span class="tok-n">String</span><span class="tok-o">&gt;</span> <span class="tok-nf">getRequestHeaders</span><span class="tok-o">();</span>
  <span class="tok-o">...</span>
<span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>El mÃ©todo <code>getRequestHeader()</code> permite acceder a una cabecera en concreto, y el mÃ©todo
<code>getRequestHeaders()</code> nos proporciona un objeto de tipo <em>Map</em> que representa
<strong>todas</strong> las cabeceras. A continuaciÃ³n mostramos un ejemplo que accede a todas
las cabeceras de la peticiÃ³n HTTP de entrada.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span class="tok-nd">@Path</span><span class="tok-o">(</span><span class="tok-s">&quot;/miservicio&quot;</span><span class="tok-o">)</span>
<span class="tok-kd">public</span> <span class="tok-kd">class</span> <span class="tok-nc">MiServicio</span> <span class="tok-o">{</span>
  <span class="tok-nd">@GET</span>
  <span class="tok-nd">@Produces</span><span class="tok-o">(</span><span class="tok-s">&quot;text/html&quot;</span><span class="tok-o">)</span>
  <span class="tok-kd">public</span> <span class="tok-n">String</span> <span class="tok-nf">get</span><span class="tok-o">(</span><span class="tok-nd">@Context</span> <span class="tok-n">HttpHeaders</span> <span class="tok-n">cabeceras</span><span class="tok-o">)</span> <span class="tok-o">{</span>
     <span class="tok-n">String</span> <span class="tok-n">referer</span> <span class="tok-o">=</span> <span class="tok-n">headers</span><span class="tok-o">.</span><span class="tok-na">getRequestHeader</span><span class="tok-o">(</span><span class="tok-s">&quot;Referer&quot;</span><span class="tok-o">).</span><span class="tok-na">get</span><span class="tok-o">(</span><span class="tok-mi">0</span><span class="tok-o">);</span>
     <span class="tok-k">for</span> <span class="tok-o">(</span><span class="tok-n">String</span> <span class="tok-n">header</span> <span class="tok-o">:</span> <span class="tok-n">headers</span><span class="tok-o">.</span><span class="tok-na">getRequestHeaders</span><span class="tok-o">().</span><span class="tok-na">keySet</span><span class="tok-o">())</span> <span class="tok-o">{</span>
        <span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">out</span><span class="tok-o">.</span><span class="tok-na">println</span><span class="tok-o">(</span><span class="tok-s">&quot;Se ha utilizado esta cabecera : &quot;</span> <span class="tok-o">+</span> <span class="tok-n">header</span><span class="tok-o">);</span>
     <span class="tok-o">}</span>
     <span class="tok-o">...</span>
  <span class="tok-o">}</span>
<span class="tok-o">}</span></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="__javax_ws_rs_core_context">2.4.7. @javax.ws.rs.core.Context</h4>
<div class="paragraph">
<p>Dentro de nuestros recursos JAX-RS podemos inyectar determinados objetos con informaciÃ³n sobre
el contexto de JAX-RS, sobre el contexto de servlets, o sobre elementos de la peticiÃ³n recibida
desde el cliente. Para ello utilizaremos la anotaciÃ³n <code>@javax.ws.rs.core.Context</code>.</p>
</div>
<div class="paragraph">
<p>En los ejemplos de esta sesiÃ³n, ya hemos visto como utilizarla
para inyectar objetos de tipo <em>UriInfo</em> y <em>HttpHeaders</em>.</p>
</div>
<div class="paragraph">
<p>A continuaciÃ³n mostramos un ejemplo en el que podos obtener detalles sobre el contexto
del despliegue de la aplicacion, asi como del contexto de peticiones individuales
utilizando la anotacion @Context:</p>
</div>
<div class="listingblock">
<div class="title">ImplementaciÃ³n de un servicio que muestra informaciÃ³n sobre el contexto de la peticiÃ³n</div>
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span class="tok-nd">@Path</span><span class="tok-o">(</span><span class="tok-s">&quot;orders&quot;</span><span class="tok-o">)</span>
<span class="tok-kd">public</span> <span class="tok-kd">class</span> <span class="tok-nc">PedidoResource</span> <span class="tok-o">{</span>
   <span class="tok-nd">@Context</span> <span class="tok-n">Application</span> <span class="tok-n">app</span><span class="tok-o">;</span> <i class="conum" data-value="1"></i><b>(1)</b>
   <span class="tok-nd">@Context</span> <span class="tok-n">UriInfo</span> <span class="tok-n">uri</span><span class="tok-o">;</span> <i class="conum" data-value="2"></i><b>(2)</b>
   <span class="tok-nd">@Context</span> <span class="tok-n">HttpHeaders</span> <span class="tok-n">headers</span><span class="tok-o">;</span> <i class="conum" data-value="3"></i><b>(3)</b>
   <span class="tok-nd">@Context</span> <span class="tok-n">Request</span> <span class="tok-n">request</span><span class="tok-o">;</span> <i class="conum" data-value="4"></i><b>(4)</b>
   <span class="tok-nd">@Context</span> <span class="tok-n">SecurityContext</span> <span class="tok-n">security</span><span class="tok-o">;</span> <i class="conum" data-value="5"></i><b>(5)</b>
   <span class="tok-nd">@Context</span> <span class="tok-n">Providers</span> <span class="tok-n">providers</span><span class="tok-o">;</span> <i class="conum" data-value="6"></i><b>(6)</b>

   <span class="tok-nd">@GET</span>
   <span class="tok-nd">@Produces</span><span class="tok-o">(</span><span class="tok-s">&quot;application/xml&quot;</span><span class="tok-o">)</span>
   <span class="tok-kd">public</span> <span class="tok-n">List</span><span class="tok-o">&lt;</span><span class="tok-n">Order</span><span class="tok-o">&gt;</span> <span class="tok-nf">getAll</span><span class="tok-o">(</span><span class="tok-nd">@QueryParam</span><span class="tok-o">(</span><span class="tok-s">&quot;start&quot;</span><span class="tok-o">)</span><span class="tok-kt">int</span> <span class="tok-n">from</span><span class="tok-o">,</span>
   <span class="tok-nd">@QueryParam</span><span class="tok-o">(</span><span class="tok-s">&quot;end&quot;</span><span class="tok-o">)</span><span class="tok-kt">int</span> <span class="tok-n">to</span><span class="tok-o">)</span> <span class="tok-o">{</span> <span class="tok-c1">//. . .(app.getClasses());</span>
        <span class="tok-c1">//. . .(uri.getPath());</span>
        <span class="tok-c1">//. . .(headers.getRequestHeader(HttpHeaders.ACCEPT));</span>
        <span class="tok-c1">//. . .(headers.getCookies());</span>
        <span class="tok-c1">//. . .(request.getMethod());</span>
        <span class="tok-c1">//. . .(security.isSecure());</span>
        <span class="tok-c1">//. . .</span>
   <span class="tok-o">}</span>
<span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td><strong>Application</strong> proporciona acceso a la informaciÃ³n de la configuraciÃ³n de la aplicaciÃ³n (clase Application)</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td><strong>UriInfo</strong> proporciona acceso a la URI de la peticiÃ³n</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td><strong>HttpHeaders</strong> proporciona acceso a las cabeceras de la peticiÃ³n HTTP
La anotaciÃ³n @HeaderParam puede tambiÃ©n utilizarse para enlazar una cabecera HTTP a un parÃ¡metro de un mÃ©todo
de nuestro recurso, a un campo del mismo, o a una propiedad de un <em>bean</em></td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td><strong>Request</strong> se utiliza para procesar la respuestas, tÃ­picamente se usa juntamente
con la clase Response para construir la respuesta de forma dinÃ¡mica</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td><strong>SecurityContext</strong> proporciona acceso a la informaciÃ³n de la peticiÃ³n actual
relacionada con la seguridad</td>
</tr>
<tr>
<td><i class="conum" data-value="6"></i><b>6</b></td>
<td><strong>Providers</strong> proporciona informaciÃ³n sobre la bÃºsqueda del runtime de las
instancias de proveedores utilizando un conjunto de criterios de bÃºsqueda</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Con respecto a contexto de servlets, podremos inyectar informaciÃ³n de <em>ServletContext</em>,
<em>ServletConfig</em>, <em>HttpServletRequest</em>, y <em>HttpServletResponse</em>. Debemos recordar que los recursos
 JAX-RS son invocados por un servlet dentro de una aplicaciÃ³n web, por lo que podemos necesitar
 tener acceso a la informaciÃ³n del contexto de servlets. Por ejemplo, si necesitamos acceder a
 la ruta en disco donde tenemos los datos de nuestra aplicaciÃ³n web tendremos que inyectar
 el objeto @ServletContext:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span class="tok-nd">@GET</span>
<span class="tok-nd">@Produces</span><span class="tok-o">(</span><span class="tok-s">&quot;image/jpeg&quot;</span><span class="tok-o">)</span>
<span class="tok-kd">public</span> <span class="tok-n">InputStream</span> <span class="tok-nf">getImagen</span><span class="tok-o">(</span><span class="tok-nd">@Context</span> <span class="tok-n">ServletContext</span> <span class="tok-n">sc</span><span class="tok-o">)</span> <span class="tok-o">{</span>
    <span class="tok-k">return</span> <span class="tok-n">sc</span><span class="tok-o">.</span><span class="tok-na">getResourceAsStream</span><span class="tok-o">(</span><span class="tok-s">&quot;/fotos/&quot;</span> <span class="tok-o">+</span> <span class="tok-n">nif</span> <span class="tok-o">+</span> <span class="tok-s">&quot;.jpg&quot;</span><span class="tok-o">);</span>
<span class="tok-o">}</span></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="__javax_ws_rs_beanparam">2.4.8. @javax.ws.rs.BeanParam</h4>
<div class="paragraph">
<p>La anotaciÃ³n <code>@javax.ws.rs.BeanParam</code> nos permite inyectar una clase especÃ­fica cuyos
mÃ©todos o atributos estÃ©n anotados con alguna de las anotaciones de inyecciÃ³n de parÃ¡metros
<em>@xxxParam</em> que hemos visto en esta sesiÃ³n. Por ejemplo, supongamos esta clase:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span class="tok-kd">public</span> <span class="tok-kd">class</span> <span class="tok-nc">ClienteInput</span> <span class="tok-o">{</span>
   <span class="tok-nd">@FormParam</span><span class="tok-o">(</span><span class="tok-s">&quot;nombre&quot;</span><span class="tok-o">)</span>
   <span class="tok-n">String</span> <span class="tok-n">nombre</span><span class="tok-o">;</span>

   <span class="tok-nd">@FormParam</span><span class="tok-o">(</span><span class="tok-s">&quot;apellido&quot;</span><span class="tok-o">)</span>
   <span class="tok-n">String</span> <span class="tok-n">apellido</span><span class="tok-o">;</span>

   <span class="tok-nd">@HeaderParam</span><span class="tok-o">(</span><span class="tok-s">&quot;Content-Type&quot;</span><span class="tok-o">)</span>
   <span class="tok-n">String</span> <span class="tok-n">contentType</span><span class="tok-o">;</span>

   <span class="tok-kd">public</span> <span class="tok-n">String</span> <span class="tok-nf">getFirstName</span><span class="tok-o">()</span> <span class="tok-o">{...}</span>
   <span class="tok-o">...</span>
<span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>La clase <code>ClienteInput</code> es un simple POJO (Plain Old Java Object) que contiene el nombre y
apellidos de un cliente, asÃ­ como el tipo de contenido del mismo. Podemos dejar que JAX-RS
cree, inicialice, e inyecte esta clase usando la anotaciÃ³n @BeanParam de la siguiente forma:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span class="tok-nd">@Path</span><span class="tok-o">(</span><span class="tok-s">&quot;/clientes&quot;</span><span class="tok-o">)</span>
<span class="tok-kd">public</span> <span class="tok-kd">class</span> <span class="tok-nc">ClienteResource</span> <span class="tok-o">{</span>
  <span class="tok-nd">@POST</span>
  <span class="tok-kd">public</span> <span class="tok-kt">void</span> <span class="tok-nf">crearCliente</span><span class="tok-o">(</span><span class="tok-nd">@BeanParam</span> <span class="tok-n">ClienteInput</span> <span class="tok-n">newCust</span><span class="tok-o">)</span> <span class="tok-o">{</span>
  <span class="tok-o">...}</span>
<span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>El runtime de JAX-RS "analizarÃ¡" los parÃ¡metros anotados con @BeanParam para inyectar las
anotaciones correspondientes y asignar el valor que corresponda. En este ejemplo, la clase
<em>ClienteInput</em> contendrÃ¡ dos valores de un formulario de entrada, y uno de los valores de
la cabecera de la peticiÃ³n. De esta forma, nos podemos evitar una larga lista de parÃ¡metros
en el mÃ©todo <em>crearCliente()</em> (en este caso son sÃ³lo tres pero podrÃ­an ser muchos mÃ¡s).</p>
</div>
</div>
<div class="sect3">
<h4 id="_conversiÃ³n_automÃ¡tica_de_tipos">2.4.9. ConversiÃ³n automÃ¡tica de tipos</h4>
<div class="paragraph">
<p>Todas las anotaciones que hemos visto referencian varias partes de la peticiÃ³n HTTP. Todas
ellas se representan como una cadena de caracteres en dicha peticiÃ³n HTTP. JAX-RS puede
convertir esta cadena de caracteres en cualquier tipo Java, siempre y cuando se cumpla <strong>al menos
uno</strong> de estos casos:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Se trata de un tipo primitivo. Los tipos <em>int</em>, <em>short</em>, <em>float</em>, <em>double</em>, <em>byte</em>, <em>char</em>, y
<em>boolean</em>, pertenecen a esta categorÃ­a.</p>
</li>
<li>
<p>Se trata de una clase Java que tiene un constructor con un Ãºnico parÃ¡metro de tipo <em>String</em></p>
</li>
<li>
<p>Se trata de una clase Java que tiene un mÃ©todo estÃ¡tico denominado <em>valueOf()</em>, que toma un
Ãºnico <em>String</em> como argumento, y devuelve una instancia de la clase.</p>
</li>
<li>
<p>Es una clase de tipo java.util.List&lt;T&gt;, java.util.Set&lt;T&gt;, o java.util.SortedSet&lt;T&gt;, en donde
T es un tipo que satisface los criterios 2 Ã³ 3, o es un <em>String</em>. Por ejemplo, List&lt;Double&gt;,
Set&lt;String&gt;, o SortedSet&lt;Integer&gt;.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Si el runtime JAX-RS falla al convertir una cadena de caracteres en
el tipo Java especificado, se considera un error del cliente.
Si se produce este fallo durante el procesamiento de una inyecciÃ³n de tipo
@MatrixParam, @QueryParam, o @PathParam, se devuelve al cliente un error
"404 Not found". Si el fallo tiene lugar con el procesamiento de las
inyecciones @HeaderParam o @CookieParam (esta Ãºltima no la hemos visto), entonces se envÃ­a al cliente
el eror "400 Bad Request".</p>
</div>
</div>
<div class="sect3">
<h4 id="_valores_por_defecto_defaultvalue">2.4.10. Valores por defecto (@DefaultValue)</h4>
<div class="paragraph">
<p>Suele ser habitual que algunos de los parÃ¡metros proporcionados en
las peticiones a servicios RESTful sean opcionales. Cuando un cliente no
proporciona esta informaciÃ³n opcional en la peticiÃ³n, JAX-RS inyectarÃ¡ por defecto
un valor null si se trata de un objeto, o un valor cero en el caso de tipos primitivos.</p>
</div>
<div class="paragraph">
<p>Estos valores por defecto no siempre son los que necesitamos para nuestro servicio.
Para solucionar este problema, podemos definir nuestro propio valor por defecto para
los parÃ¡metros que sean opcionales, utilizando la anotaciÃ³n <code>@javax.ws.rs.DefaultValue</code>.</p>
</div>
<div class="paragraph">
<p>Consideremos el ejemplo anterior relativo a la recuperaciÃ³n de la informaciÃ³n de un
  subconjunto de clientes de nuestra base de datos. Para ello utilizÃ¡bamos dos
parÃ¡metros de consulta para indicar el Ã­ndice del primer elemento, asÃ­ como el nÃºmero
total de elementos que estamos interesados en recuperar. En este caso, no queremos
que el cliente tenga que especificar siempre estos parÃ¡metros al realizar la peticion.
Usaremos la anotaciÃ³n @DefaultValue para indicar los valores por defecto que nos
interese.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span class="tok-nd">@Path</span><span class="tok-o">(</span><span class="tok-s">&quot;/clientes&quot;</span><span class="tok-o">)</span>
<span class="tok-kd">public</span> <span class="tok-kd">class</span> <span class="tok-nc">ClienteResource</span> <span class="tok-o">{</span>
  <span class="tok-nd">@GET</span>
  <span class="tok-nd">@Produces</span><span class="tok-o">(</span><span class="tok-s">&quot;application/xml&quot;</span><span class="tok-o">)</span>
  <span class="tok-kd">public</span> <span class="tok-n">String</span> <span class="tok-nf">getClientes</span><span class="tok-o">(</span>
         <span class="tok-nd">@DefaultValue</span><span class="tok-o">(</span><span class="tok-s">&quot;0&quot;</span><span class="tok-o">)</span> <span class="tok-nd">@QueryParam</span><span class="tok-o">(</span><span class="tok-s">&quot;inicio&quot;</span><span class="tok-o">)</span> <span class="tok-kt">int</span> <span class="tok-n">inicio</span><span class="tok-o">,</span>
        <span class="tok-nd">@DefaultValue</span><span class="tok-o">(</span><span class="tok-s">&quot;10&quot;</span><span class="tok-o">)</span> <span class="tok-nd">@QueryParam</span><span class="tok-o">(</span><span class="tok-s">&quot;total&quot;</span><span class="tok-o">)</span> <span class="tok-kt">int</span> <span class="tok-n">total</span><span class="tok-o">)</span>
  <span class="tok-o">...</span> <span class="tok-o">}</span>
<span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Hemos usado @DefaultValue para especificar un Ã­ndice de comienzo con valor cero, y
un tamaÃ±o del subconjunto de los datos de la respuesta. JAX-RS utilizarÃ¡ las reglas
de conversiÃ³n de cadenas de caracteres que acabamos de indicar para convertir el
valor del parÃ¡metro en el tipo Java que especifiquemos.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_configuraciÃ³n_y_despliegue_de_aplicaciones_jax_rs">2.5. ConfiguraciÃ³n y despliegue de aplicaciones JAX-RS</h3>
<div class="paragraph">
<p>Como ya hemos visto en la sesiÃ³n anterior, implementamos nuestros servicios
 REST utilizando el API de Java JAX-RS (especificaciÃ³n JSR-339). Una aplicaciÃ³n JAX-RS
 consiste en uno o mÃ¡s <strong>recursos</strong> y cero o mÃ¡s <strong>proveedores</strong>. En este apartado vamos
 a describir ciertos aspectos aplicados a las aplicaciones JAX-RS como un todo,
  concretamente a la configuraciÃ³n y tambiÃ©n a la publicaciÃ³n de las mismas cuando utilizamos
  un servidor de aplicaciones JavaEE 7 o bien un contenedor de servlets 3.0, que incluyan
  una implementaciÃ³n del API JAX-RS. TambiÃ©n indicaremos cÃ³mo configurar el despliegue
  en el caso de no disponer como mÃ­nimo de un contenedor de <em>servlets 3.0</em>.</p>
</div>
<div class="sect3">
<h4 id="_configuraciÃ³n_mediante_la_clase_em_application_em">2.5.1. ConfiguraciÃ³n mediante la clase <em>Application</em></h4>
<div class="paragraph">
<p>Tanto los recursos (clases anotadas con @Path) como los proveedores que conforman nuestra aplicaciÃ³n JAX-RS
pueden configurarse utilizando una subclase de <strong>Application</strong>. Cuando hablamos de
configuraciÃ³n nos estamos refiriendo, en este caso, a definir los mecanismos para
localizar las clases que representan los recursos, asÃ­ como a los proveedores.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Un <strong>proveedor</strong> es una clase que implementa una o alguna de las siguientes
 interfaces JAX-RS: MesssageBodyReader, MessageBodyWriter, ContextResolver&lt;T&gt;, y
 ExceptionMapper&lt;T&gt;. Las dos primeras permiten crear <em>proveedores de entidades</em> (<em>entity providers</em>),
la tercera es un <em>proveedor de contexto</em> (<em>context provider</em>), y la Ãºltima un
 proveedor de mapeado de excepciones (<em>exception mapping provider</em>). Las clases que
 actÃºan como "proveedores" estÃ¡n anotadas con @Provider, para que puedan ser
 identificadas automÃ¡ticamente por el <em>runtime</em> JAX-RS.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>El uso de una subclase de <strong>Application</strong> para configurar nuestros servicios REST
constituye la forma mÃ¡s sencilla de desplegar los servicios JAX-RS en un servidor
de aplicaciones certificado como Java EE (en este caso, Wildfly cumple con este
requisito), o un contenedor <em>standalone</em> de <em>Servlet 3</em> (como por ejemplo Tomcat).</p>
</div>
<div class="paragraph">
<p>Pasemos a conocer la clase <code>javax.ws.rs.core.Application</code>. El uso de la clase
<em>Application</em> es la Ãºnica forma <strong>portable</strong> de "decirle" a
 JAX-RS quÃ© servicios web (clases anotadas con @Path), asÃ­ como quÃ© otros
 elementos, como filtros, interceptores,&#8230;&#8203;, queremos publicar (desplegar).</p>
</div>
<div class="paragraph">
<p>La clase <strong><em>Application</em></strong> se define como:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span class="tok-kn">package</span> <span class="tok-n">javax</span><span class="tok-o">.</span><span class="tok-na">ws</span><span class="tok-o">.</span><span class="tok-na">rs</span><span class="tok-o">.</span><span class="tok-na">core</span><span class="tok-o">;</span>

<span class="tok-kn">import</span> <span class="tok-nn">java.util.Collections</span><span class="tok-o">;</span>
<span class="tok-kn">import</span> <span class="tok-nn">java.util.Set</span><span class="tok-o">;</span>

<span class="tok-kd">public</span> <span class="tok-kd">abstract</span> <span class="tok-kd">class</span> <span class="tok-nc">Application</span> <span class="tok-o">{</span>
   <span class="tok-kd">private</span> <span class="tok-kd">static</span> <span class="tok-kd">final</span> <span class="tok-n">Set</span><span class="tok-o">&lt;</span><span class="tok-n">Object</span><span class="tok-o">&gt;</span> <span class="tok-n">emptySet</span> <span class="tok-o">=</span>
                          <span class="tok-n">Collections</span><span class="tok-o">.</span><span class="tok-na">emptySet</span><span class="tok-o">();</span>

   <span class="tok-kd">public</span> <span class="tok-kd">abstract</span> <span class="tok-n">Set</span><span class="tok-o">&lt;</span><span class="tok-n">Class</span><span class="tok-o">&lt;?&gt;&gt;</span> <span class="tok-n">getClasses</span><span class="tok-o">();</span>

   <span class="tok-kd">public</span> <span class="tok-n">Set</span><span class="tok-o">&lt;</span><span class="tok-n">Object</span><span class="tok-o">&gt;</span> <span class="tok-nf">getSingletons</span><span class="tok-o">()</span> <span class="tok-o">{</span>
      <span class="tok-k">return</span> <span class="tok-n">emptySet</span><span class="tok-o">;</span>
   <span class="tok-o">}</span>
<span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>La clase <em>Application</em> es muy simple. Como ya hemos indicado, su propÃ³sito es
proporcionar una lista de clases y objetos que "queremos" desplegar.</p>
</div>
<div class="paragraph">
<p>El mÃ©todo <code>getClasses()</code> devuelve una lista de <strong>clases</strong> de servicios web y
proveedores JAX-RS. Cualquier <strong>servicio</strong> JAX-RS devuelto por este mÃ©todo sigue
el modelo <em>per-request</em>, que ya hemos introducido en la sesiÃ³n anterior.
Cuando la implementaciÃ³n de JAX-RS determina que una peticiÃ³n HTTP necesita ser
procesada por un mÃ©todo de una de estas clases, se crearÃ¡ una instancia de dicha
clase durante la peticiÃ³n, y se "destruirÃ¡" al finalizar la misma. En este caso
estamos <strong>delegando</strong> en el <em>runtime</em> JAX-RS la <strong>creaciÃ³n de los objetos</strong>.
Las clases "proveedoras" son instanciadas por el contenedor JAX-RS y registradas
una Ãºnica vez por aplicaciÃ³n.</p>
</div>
<div class="paragraph">
<p>El mÃ©todo <code>getSingletons()</code> devuelve una lista de servicios y proveedores web JAX-RS
"ya instanciados". Nosotros, como programadores de las aplicaciones, somos responsables
de crear estos objetos. El <em>runtime</em> JAX-RS iterarÃ¡ a travÃ©s de la lista de <strong>objetos</strong>
y los registrarÃ¡ internamente.</p>
</div>
<div class="paragraph">
<p>Un ejemplo de uso de una subclase de <em>Application</em> podrÃ­a ser Ã©ste:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span class="tok-kn">package</span> <span class="tok-n">org</span><span class="tok-o">.</span><span class="tok-na">expertojava</span><span class="tok-o">;</span>

<span class="tok-kn">import</span> <span class="tok-nn">javax.ws.rs.core.Application</span><span class="tok-o">;</span>
<span class="tok-kn">import</span> <span class="tok-nn">javax.ws.rs.ApplicationPath</span><span class="tok-o">;</span>

<span class="tok-nd">@ApplicationPath</span><span class="tok-o">(</span><span class="tok-s">&quot;/rest&quot;</span><span class="tok-o">)</span>
<span class="tok-kd">public</span> <span class="tok-kd">class</span> <span class="tok-nc">ComercioApplication</span> <span class="tok-kd">extends</span> <span class="tok-n">Application</span> <span class="tok-o">{</span>

  <span class="tok-kd">public</span> <span class="tok-n">Set</span><span class="tok-o">&lt;</span><span class="tok-n">Class</span><span class="tok-o">&lt;?&gt;&gt;</span> <span class="tok-n">getClasses</span><span class="tok-o">()</span> <span class="tok-o">{</span>
      <span class="tok-n">HashSet</span><span class="tok-o">&lt;</span><span class="tok-n">Class</span><span class="tok-o">&lt;?&gt;&gt;</span> <span class="tok-n">set</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">HashSet</span><span class="tok-o">&lt;</span><span class="tok-n">Class</span><span class="tok-o">&lt;?&gt;&gt;();</span>
      <span class="tok-n">set</span><span class="tok-o">.</span><span class="tok-na">add</span><span class="tok-o">(</span><span class="tok-n">ClienteResource</span><span class="tok-o">.</span><span class="tok-na">class</span><span class="tok-o">);</span>
      <span class="tok-n">set</span><span class="tok-o">.</span><span class="tok-na">add</span><span class="tok-o">(</span><span class="tok-n">PedidoResource</span><span class="tok-o">.</span><span class="tok-na">class</span><span class="tok-o">);</span>
      <span class="tok-k">return</span> <span class="tok-n">set</span><span class="tok-o">;</span>
  <span class="tok-o">}</span>

  <span class="tok-kd">public</span> <span class="tok-n">Set</span><span class="tok-o">&lt;</span><span class="tok-n">Object</span><span class="tok-o">&gt;</span> <span class="tok-nf">getSingletons</span><span class="tok-o">()</span> <span class="tok-o">{</span>
     <span class="tok-n">JsonWriter</span> <span class="tok-n">json</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-nf">JsonWriter</span><span class="tok-o">();</span>
     <span class="tok-n">TarjetaCreditoResource</span> <span class="tok-n">servicio</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-nf">TarjetaCreditoResource</span><span class="tok-o">();</span>

     <span class="tok-n">HashSet</span><span class="tok-o">&lt;</span><span class="tok-n">Object</span><span class="tok-o">&gt;</span> <span class="tok-n">set</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-nf">HashSet</span><span class="tok-o">();</span>
     <span class="tok-n">set</span><span class="tok-o">.</span><span class="tok-na">add</span><span class="tok-o">(</span><span class="tok-n">json</span><span class="tok-o">);</span>
     <span class="tok-n">set</span><span class="tok-o">.</span><span class="tok-na">add</span><span class="tok-o">(</span><span class="tok-n">servicio</span><span class="tok-o">);</span>
     <span class="tok-k">return</span> <span class="tok-n">set</span><span class="tok-o">;</span>
   <span class="tok-o">}</span>
<span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>La anotaciÃ³n <code>@ApplicationPath</code> define la base URL de la ruta para todos nuestros
servicios JAX-RS desplegados. AsÃ­, por ejemplo, accederemos a todos nuestros servicios JAX-RS
serÃ¡n desde la ruta "/rest" cuando los ejecutemos. En el ejemplo anterior
estamos indicando que <em>ClienteResource</em> y <em>PedidoResource</em> son servicios <em>per-request</em>.
El mÃ©todo <em>getSingletons()</em> devuelve el servicio de tipo <em>TarjetaCreditoResource</em>, asÃ­ como
el proveedor <em>JsonWriter</em> (que implementa la interfaz <em>MessageBodyWriter</em>).</p>
</div>
<div class="paragraph">
<p>Si tenemos al menos una implementaciÃ³n de la clase <em>Application</em> anotada con
<em>@ApplicationPath</em>, esta serÃ¡ "detectada" y desplegada automÃ¡ticamente por el servidor
de aplicaciones.</p>
</div>
<div class="paragraph">
<p>Podemos aprovechar completamente esta capacidad para "escanear" y detectar automÃ¡ticamente
nuestros servicios si tenemos implementada una subclase de Application, pero dejamos que
<em>getSingletons()</em> devuelva el conjunto vacÃ­o, y no indicamos nada en el mÃ©todo <em>getClasses()</em>,
de esta forma:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span class="tok-kn">package</span> <span class="tok-n">org</span><span class="tok-o">.</span><span class="tok-na">expertojava</span><span class="tok-o">;</span>

<span class="tok-kn">import</span> <span class="tok-nn">javax.ws.rs.ApplicationPath</span><span class="tok-o">;</span>
<span class="tok-kn">import</span> <span class="tok-nn">javax.ws.rs.core.Application</span><span class="tok-o">;</span>

<span class="tok-nd">@ApplicationPath</span><span class="tok-o">(</span><span class="tok-s">&quot;/rest&quot;</span><span class="tok-o">)</span>
<span class="tok-kd">public</span> <span class="tok-kd">class</span> <span class="tok-nc">ComercioApplication</span> <span class="tok-kd">extends</span> <span class="tok-n">Application</span> <span class="tok-o">{</span>

<span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>En este caso, el servidor de aplicaciones se encargarÃ¡ de buscar en el directorio
<em>WEB-INF/classes</em> y en cualquier fichero <em>jar</em> dentro del directorio <em>WEB-INF/lib</em>.
A continuaciÃ³n aÃ±adirÃ¡ cualquier clase anotada con <em>@Path</em> o <em>@Provider</em> a la lista
de "cosas" que necesitan ser desplegadas y registradas en el <em>runtime</em> JAX-RS.</p>
</div>
<div class="paragraph">
<p>Los servicios REST son "atendidos" por un <em>servlet</em>, que es especÃ­fico de la implementaciÃ³n
JAX-RS utilizada por el servidor de aplicaciones. El servidor wildfly utiliza la implementaciÃ³n
de JAX-RS 2.0 denomindada <em>resteasy</em> (otra implementaciÃ³n muy utilizada es <em>jersey</em>, por ejemplo
con el servidor de aplicaciones <em>Glassfish</em>). El <em>runtime</em> de JAX-RS contiene un <em>servlet</em> inicializado
con un parÃ¡metro de inicializaciÃ³n de tipo <em>javax.ws.rs.Application</em>, cuyo valor serÃ¡
instanciado "automÃ¡ticamente" por el servidor de aplicaciones con el nombre de la subclase
de <em>Application</em> que sea detectada en el <em>war</em> de nuestra aplicaciÃ³n.</p>
</div>
</div>
<div class="sect3">
<h4 id="_configuraciÃ³n_mediante_un_fichero_em_web_xml_em">2.5.2. ConfiguraciÃ³n mediante un fichero <em>web.xml</em></h4>
<div class="paragraph">
<p>En la sesiÃ³n anterior, no hemos utilizado de forma explÃ­cita la clase <em>Application</em> para configurar el despliegue.
En su lugar, hemos indicado esta informaciÃ³n en el fichero "web.xml":</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><span class="tok-nt">&lt;web-app</span> <span class="tok-na">version=</span><span class="tok-s">&quot;3.0&quot;</span> <span class="tok-na">xmlns=</span><span class="tok-s">&quot;http://java.sun.com/xml/ns/javaee&quot;</span>
        <span class="tok-na">xmlns:xsi=</span><span class="tok-s">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span>
        <span class="tok-na">xsi:schemaLocation=</span><span class="tok-s">&quot;http://java.sun.com/xml/ns/javaee</span>
<span class="tok-s">        http://java.sun.com/xml/ns/javaee/web-app_3_0.xsd&quot;</span><span class="tok-nt">&gt;</span>
    <span class="tok-c">&lt;!-- Con estas lÃ­neas, el servidor es el responsable de</span>
<span class="tok-c">      aÃ±adir el servlet correspondiente de forma automÃ¡tica.</span>
<span class="tok-c">      Si en nuestro war, tenemos clases anotadas con anotaciones JAX-RS</span>
<span class="tok-c">      para recibir invocaciones REST, Ã©stas serÃ¡n detectadas y registradas--&gt;</span>
    <span class="tok-nt">&lt;servlet-mapping&gt;</span>
        <span class="tok-nt">&lt;servlet-name&gt;</span>javax.ws.rs.core.Application<span class="tok-nt">&lt;/servlet-name&gt;</span>
        <span class="tok-nt">&lt;url-pattern&gt;</span>/rest/*<span class="tok-nt">&lt;/url-pattern&gt;</span>
    <span class="tok-nt">&lt;/servlet-mapping&gt;</span>
<span class="tok-nt">&lt;/web-app&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Esta configuraciÃ³n es equivalente a incluir una subclase de <em>Application</em> sin
sobreescribir los mÃ©todos correspondientes. En este caso, se aÃ±ade de forma dinÃ¡mica
 el servlet que sirve las peticiones REST, con el nombre <em>javax.ws.rs.core.Application</em>,
 de forma que se detecten automÃ¡ticamente todas las clases de recursos, y clases
 proveedoras empaquetadas en el <em>war</em> de la aplicaciÃ³n.</p>
</div>
</div>
<div class="sect3">
<h4 id="_configuraciÃ³n_en_un_contenedor_que_no_disponga_de_una_implementaciÃ³n_jax_rs">2.5.3. ConfiguraciÃ³n en un contenedor que no disponga de una implementaciÃ³n JAX-RS</h4>
<div class="paragraph">
<p>Si queremos hacer el despliegue sobre servidores de aplicaciones o servidores web
que den soporte a una especificaciÃ³n de <em>servlets</em> con una versiÃ³n inferior a la <em>3.0</em>,
tendremos que configurar MANUALMENTE el fichero <em>web.xml</em> para que "cargue" el servlet
de nuestra implementaciÃ³n propietaria de JAX-RS (cuyos ficheros <em>jar</em> deberemos incluir
en el directorio <em>WEB-INF/lib</em> de nuestro war). Un ejemplo de configuraciÃ³n podrÃ­a
ser Ã©ste:</p>
</div>
<div class="listingblock">
<div class="title">ConfiguraciÃ³n del fichero web.xml (directorio de fuentes: webapp/WEB-INF/web.xml)</div>
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><span class="tok-cp">&lt;?xml version=&quot;1.0&quot;?&gt;</span>
<span class="tok-nt">&lt;web-app&gt;</span>
   <span class="tok-nt">&lt;servlet&gt;</span>
      <span class="tok-nt">&lt;servlet-name&gt;</span>JAXRS<span class="tok-nt">&lt;/servlet-name&gt;</span>
      <span class="tok-nt">&lt;servlet-class&gt;</span>
          org.jboss.resteasy.plugins.server.servlet.HttpServletDispatcher
      <span class="tok-nt">&lt;/servlet-class&gt;</span>
      <span class="tok-nt">&lt;init-param&gt;</span>
         <span class="tok-nt">&lt;param-name&gt;</span>
            javax.ws.rs.Application
         <span class="tok-nt">&lt;/param-name&gt;</span>
         <span class="tok-nt">&lt;param-value&gt;</span>
            org.expertoJava.ComercioApplication
         <span class="tok-nt">&lt;/param-value&gt;</span>
       <span class="tok-nt">&lt;/init-param&gt;</span>
   <span class="tok-nt">&lt;/servlet&gt;</span>

   <span class="tok-nt">&lt;servlet-mapping&gt;</span>
      <span class="tok-nt">&lt;servlet-name&gt;</span>JAXRS<span class="tok-nt">&lt;/servlet-name&gt;</span>
      <span class="tok-nt">&lt;url-pattern&gt;</span>/rest/*<span class="tok-nt">&lt;/url-pattern&gt;</span>
   <span class="tok-nt">&lt;/servlet-mapping&gt;</span>
<span class="tok-nt">&lt;/web-app&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>En la configuraciÃ³n anterior estamos indicando de forma explÃ­cita el <em>servlet</em>
JAX-RS que recibe las peticiones REST, que a su vez, utilizarÃ¡ la clase Application
para detectar quÃ© servicios y proveedores REST serÃ¡n desplegados en el servidor.</p>
</div>
<div class="paragraph">
<p>TambiÃ©n serÃ¡ necesario incluir la librerÃ­a con la implementaciÃ³n JAX-RS 2.0 de forma explÃ­cita en
el <em>war</em> generado (recordemos que para ello, tendremos que utilizar la etiqueta
&lt;scope&gt;compile&lt;scope&gt;, para que se aÃ±adan los <em>jar</em> correspondientes).</p>
</div>
<div class="listingblock">
<div class="title">LibrerÃ­a con la implementaciÃ³n de JAX-RS 2.0</div>
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><span class="tok-nt">&lt;dependency&gt;</span>
  <span class="tok-nt">&lt;groupId&gt;</span>javax<span class="tok-nt">&lt;/groupId&gt;</span>
  <span class="tok-nt">&lt;artifactId&gt;</span>javaee-web-api<span class="tok-nt">&lt;/artifactId&gt;</span>
  <span class="tok-nt">&lt;version&gt;</span>7.0<span class="tok-nt">&lt;/version&gt;</span>
  <span class="tok-nt">&lt;scope&gt;</span>compile<span class="tok-nt">&lt;/scope&gt;</span>
<span class="tok-nt">&lt;/dependency&gt;</span></code></pre>
</div>
</div>
<div style="page-break-after: always;"></div>
</div>
</div>
<div class="sect2">
<h3 id="_ejercicios_2">2.6. Ejercicios</h3>
<div class="paragraph">
<p>Para esta sesiÃ³n aÃ±adiremos un nuevo mÃ³dulo en el que implementaremos un servicio rest
incorporando los conceptos que hemos explicado durante la sesiÃ³n. En concreto:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Creamos un mÃ³dulo Maven con IntelliJ (desde el directorio <code>ejercicios-rest-expertojava</code>)
con el arquetipo <code>webapp-javaee7</code>, tal y como hemos visto en los apuntes de la sesiÃ³n. Las coordenadas
del <strong>artefacto Maven</strong> serÃ¡n:</p>
<div class="ulist">
<ul>
<li>
<p><em>GroupId</em>: org.expertojava</p>
</li>
<li>
<p><em>ArtifactId</em>: s2-foro-nuevo</p>
</li>
<li>
<p><em>version</em>: 1.0-SNAPSHOT</p>
</li>
</ul>
</div>
</li>
<li>
<p>Configuramos el pom.mxl del proyecto para poder compilar, empaquetar y desplegar nuestro servicio
en el servidor de aplicaciones Wildfly. Consulta los apuntes para ver cuÃ¡l debe ser el contenido de las etiquetas
<em>&lt;properties&gt;</em>, <em>&lt;dependencies&gt;</em> y <em>&lt;build&gt;</em></p>
</li>
<li>
<p>Vamos a estructurar los fuentes (directorio <strong>src/main/java</strong>) de nuestro proyecto en los
siguientes paquetes:</p>
<div class="ulist">
<ul>
<li>
<p><em>org.expertojava.datos</em>: contendrÃ¡ clases relacionadas con los datos a los que accede
nuestra aplicaciÃ³n rest. Por simplicidad, almacenaremos en memoria los datos de nuestra
 aplicaciÃ³n.</p>
</li>
<li>
<p><em>org.expertojava.modelo</em>: contiene las clases de nuestro modelo de objetos, que serÃ¡n
clases java con atributos y sus correspondientes <em>getters</em> y <em>setters</em></p>
</li>
<li>
<p><em>org.expertojava.rest</em>: contiene los recursos JAX-RS, que implementan nuestros
servicios rest, asÃ­ como las clases necesarias para automatizar el despliegue de dichos
recursos</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="sect3">
<h4 id="_creaciÃ³n_de_un_recurso_creaciÃ³n_y_consulta_de_temas_en_el_foro_0_5_puntos">2.6.1. CreaciÃ³n de un recurso: creaciÃ³n y consulta de temas en el foro (0,5 puntos)</h4>
<div class="paragraph">
<p>Vamos a crear un recurso JAX-RS al que denominaremos <code>TemasResource</code>
(en el paquete <em>org.expertojava.rest</em> ). En el siguiente ejercicio
, al configurar la aplicaciÃ³n, haremos que este recurso sea un <strong>singleton</strong>.
Nuestro recurso gestionarÃ¡ sus propios datos en memoria. Por ejemplo
 podemos utilizar un atributo <em>private</em> de tipo <em>HashMap</em> en el que almacenaremos los temas, cada uno
 con un identificador numÃ©rico como clave. TambiÃ©n necesitaremos un atributo para
 generar las claves para cada uno de los temas. Por ejemplo:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>private Map&lt;Integer, Tema&gt; temasDB = new HashMap&lt;Integer, Tema&gt;();
private int contadorTemas = 0;</pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>FÃ­jate que si utilizamos los tipos <em>HashMap</em> e <em>int</em> podemos tener problemas de
concurrencia si mÃºltiples usuarios estÃ¡n realizando peticiones para crear y/o consultar
los temas del foro. En una situaciÃ³n real deberÃ­amos utilizar en su lugar los tipos
<em>ConcurrentHasMap</em> y <em>AtomicInteger</em>, para evitar el que dos usuarios intentaran crear
un nuevo tema con la misma clave, perdiÃ©ndose asÃ­ uno de los dos temas creados. Al
tratarse de un ejercicio en el que solamente tendremos un cliente, no nos plantearÃ¡
ningÃºn problema el trabajar con <em>HashMap</em> e <em>int</em>, por lo que podÃ©is elegir cualquiera
de las dos opciones para realizar el ejercicio</p>
</div>
</td>
</tr>
</table>
</div>
<div class="ulist">
<ul>
<li>
<p>Nuestro recurso estarÃ¡ accesible en el servidor en la ruta <code>/temas</code> (relativa
a la raÃ­z del contexto de nuestra aplicaciÃ³n, y a la ruta de nuestro servlet JAX-RS,
que determinaremos con la anotaciÃ³n @ApplicationPath de nuestra clase <em>Application</em>).</p>
</li>
<li>
<p>En el paquete <em>org.expertojava.modelo</em> crearemos la clase <code>Tema</code>, con los atributos
privados:</p>
<div class="literalblock">
<div class="content">
<pre>int id;
String nombre;</pre>
</div>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>y sus correspondientes <em>getters</em> y <em>setters</em>:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>setId(), getId()
setNombre(), getNombre()</pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Implementamos un primer mÃ©todo en el recurso <code>TemasResource</code>, denominado <code>creaTema()</code>,
para poder crear un
nuevo tema en el foro. Dicho mÃ©todo atenderÃ¡ peticiones POST a nuestro servicio.
Los datos de entrada (cadena de caracteres que respresenta el nombre del tema) se pasan
a travÃ©s de un formulario html, en el que tenemos una Ãºnica entrada denominada "nombre".</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Puedes incluir el siguiente contenido en el fichero <code>index.html</code> para introducir los
datos desde el navegador:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="html"><span class="tok-cp">&lt;!DOCTYPE html&gt;</span>
<span class="tok-nt">&lt;html&gt;</span>
<span class="tok-nt">&lt;head&gt;</span>
    <span class="tok-nt">&lt;title&gt;</span>Start Page<span class="tok-nt">&lt;/title&gt;</span>
    <span class="tok-nt">&lt;meta</span> <span class="tok-na">http-equiv=</span><span class="tok-s">&quot;Content-Type&quot;</span> <span class="tok-na">content=</span><span class="tok-s">&quot;text/html; charset=UTF-8&quot;</span><span class="tok-nt">&gt;</span>
<span class="tok-nt">&lt;/head&gt;</span>
<span class="tok-nt">&lt;body&gt;</span>
<span class="tok-nt">&lt;h1&gt;</span>Alta de temas en el foro: <span class="tok-nt">&lt;/h1&gt;</span>
<span class="tok-nt">&lt;form</span> <span class="tok-na">action=</span><span class="tok-s">&quot;/s2-foro-nuevo/rest/temas&quot;</span> <span class="tok-na">method=</span><span class="tok-s">&quot;post&quot;</span><span class="tok-nt">&gt;</span>
    Nombre del tema: <span class="tok-nt">&lt;input</span> <span class="tok-na">type=</span><span class="tok-s">&quot;text&quot;</span> <span class="tok-na">name=</span><span class="tok-s">&quot;nombre&quot;</span> <span class="tok-nt">/&gt;&lt;br</span> <span class="tok-nt">/&gt;</span>

    <span class="tok-nt">&lt;input</span> <span class="tok-na">type=</span><span class="tok-s">&quot;submit&quot;</span> <span class="tok-na">value=</span><span class="tok-s">&quot;Enviar&quot;</span> <span class="tok-nt">/&gt;</span>
<span class="tok-nt">&lt;/form&gt;</span>
<span class="tok-nt">&lt;/body&gt;</span>
<span class="tok-nt">&lt;/html&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Cada nuevo <code>Tema</code> creado se aÃ±adirÃ¡ a nuestra base de datos en memoria <code>temasDB</code>
junto con un identificador numÃ©rico (que se irÃ¡ incrementando para cada nueva
instancia creada).</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Implementamos un segundo mÃ©todo para consultar los temas creados en el foro.
El mÃ©todo se denominarÃ¡ <code>verTemasTodos()</code>, y devuelve (en formato texto) todos los
temas actualmente creados. Dado que puede haber un gran nÃºmero de ellos, vamos
a permitir que el usuario decida cuÃ¡ntos elementos como mÃ¡ximo quiere consultar a partir de
una posiciÃ³n determinada. Por defecto, si no se indica esta informaciÃ³n, se
mostrarÃ¡n como mÃ¡ximo los primeros 8 temas registrados en el foro. Si el identificador a
partir del cual queremos iniciar la consulta es mayor que el nÃºmero de temas almacenados,
entonces devolveremos la cadena: "No es posible atender la consulta". Ejemplos de
URIs que acepta dicho mÃ©todo son:</p>
<div class="ulist">
<ul>
<li>
<p>/temas</p>
<div class="paragraph">
<p>en este caso, y suponiendo que hayamos creado solamente los tres temas del
apartado anterior, el resultado serÃ­a:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>"Listado de temas del 1 al 8:
1. animales
2. plantas
3. ab"</pre>
</div>
</div>
</li>
<li>
<p>/temas?inicio=2&amp;total=2</p>
<div class="paragraph">
<p>el resultado serÃ­a:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>"Listado de temas del 2 al 3:
2. plantas
3. ab"</pre>
</div>
</div>
</li>
<li>
<p>/temas?inicio=7&amp;total=1</p>
<div class="paragraph">
<p>el resultado serÃ­a:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>"No es posible atender la consulta"</pre>
</div>
</div>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Como ya hemos comentado, las URIs indicadas en este ejercicio son relativas a la
raÃ­z del contexto de nuestra aplicaciÃ³n y a la ruta especificada para nuestros servicios rest.
Recuerda que si has configurado el pom.xml como en la sesiÃ³n anterior, la raÃ­z
del contexto de la aplicaciÃ³n vendrÃ¡ dada por el valor de la etiqueta &lt;finalName&gt;,
anidada en &lt;build&gt;. En nuestro caso deberÃ­a ser "/s2-foro-nuevo". MÃ¡s adelante,
fijaremos la ruta de nuestros servicios rest como <code>/rest</code>. Por ejemplo la URI
completa para el Ãºltimo apartado serÃ­a:
 <a href="http://localhost:8080/s2-foro-nuevo/rest/temas?inicio=7&amp;total=1" class="bare">http://localhost:8080/s2-foro-nuevo/rest/temas?inicio=7&amp;total=1</a></p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_despliegue_y_pruebas_del_recurso_0_5_puntos">2.6.2. Despliegue y pruebas del recurso (0,5 puntos)</h4>
<div class="paragraph">
<p>Vamos a construir y desplegar nuestro servicio en el servidor de aplicaciones.
Para ello vamos a utilizar una subclase de <em>Application</em> que aÃ±adiremos en el
paquete <em>org.expertojava.rest</em>. La ruta en la que se van a servir nuestras peticiones rest
serÃ¡ <code>rest</code>. FÃ­jate que el recurso que hemos creado es el
encargado de gestionar (crear, modificar,&#8230;&#8203;) sus propios datos. Por lo tanto
necesitamos que nuestro recurso REST sea un <em>singleton</em>. Implementa la clase
<code>ForoApplication</code> y realiza la construcciÃ³n y despliegue del proyecto. A continuaciÃ³n
prueba el servicio utilizando postman. Puedes probar la inserciÃ³n de temas utilizando
tambiÃ©n el formulario a travÃ©s de la URI: <em><a href="http://localhost:8080/s2-foro-nuevo" class="bare">http://localhost:8080/s2-foro-nuevo</a></em>.
Podemos utilizar las entradas del apartado anterior, de forma que comprobemos que se
crean correctamente los temas "animales", "plantas", y "ab", y que
obtenemos los listados correctos tanto si no indicamos el inicio y total de elementos,
como si decidimos mostrar los temas desde el 2 hasta el 3.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Cuando utilices el cliente IntelliJ para probar mÃ©todos POST, debes proporcionar
un <strong>Request Body</strong> <strong>no vacÃ­o</strong>. En este caso, como en la propia URI incluimos
el contenido del mensaje, que es el nombre del tema que queremos aÃ±adir al foro
tendrÃ¡s que seleccionar <strong>Text</strong> aunque no rellenemos el campo correspondiente.
De no hacerlo asÃ­, obtendremos como respuesta un cuerpo de mensaje vacÃ­o, y
la cabecera de respuesta <strong>HTTP/1.1 415 Unsupported Media Type</strong></p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_mÃºltiples_consultas_de_los_temas_del_foro_0_5_puntos">2.6.3. MÃºltiples consultas de los temas del foro (0,5 puntos)</h4>
<div class="paragraph">
<p>Implementa tres nuevas consultas de los temas del foro, de forma que:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Se pueda realizar una consulta de un tema concreto a partir de su identificador
numÃ©rico (el mÃ©todo solamente debe admitir identificadores formados por uno o
mÃ¡s dÃ­gitos). Si el tema consultado no existe se debe devolver una excepciÃ³n
con la cabecera de respuesta <strong>HTTP/1.1 404 Not Found</strong>. Por ejemplo:</p>
<div class="ulist">
<ul>
<li>
<p>/temas/2</p>
<div class="paragraph">
<p>Debe devolver lo siguiente:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>"Ver el tema 2:
plantas"</pre>
</div>
</div>
</li>
<li>
<p>/temas/4</p>
<div class="paragraph">
<p>Obtenemos como respuesta un cuerpo de mensaje vacÃ­o, y
la cabecera de respuesta: <strong>HTTP/1.1 404 Not Found</strong></p>
</div>
</li>
</ul>
</div>
</li>
<li>
<p>Se pueda realizar una consulta de los temas que comiencen por uno de los
siguientes caracteres: a, b, c, Ã³ d. Por ejemplo, teniendo en cuenta que hemos
introducido los temas anteriores:</p>
<div class="ulist">
<ul>
<li>
<p>/temas/a</p>
<div class="paragraph">
<p>Debe devolver lo siguiente:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>"Listado de temas que comienzan por a:
animales"</pre>
</div>
</div>
</li>
<li>
<p>/temas/d</p>
<div class="paragraph">
<p>Debe devolver:
 "Listado de temas que comienzan por d:"</p>
</div>
</li>
</ul>
</div>
</li>
<li>
<p>Se pueda realizar una consulta de los temas que contengan una subcadena de caracteres.
Por ejemplo, teniendo en cuenta que hemos
 introducido los temas anteriores:</p>
<div class="ulist">
<ul>
<li>
<p>/temas/ma
+
Debe devolver lo siguiente:</p>
<div class="literalblock">
<div class="content">
<pre>"Listado de temas que contienen la subcadena : ma
animales"</pre>
</div>
</div>
</li>
</ul>
</div>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_creaciÃ³n_de_subrecursos_0_5_puntos">2.6.4. CreaciÃ³n de subrecursos (0,5 puntos)</h4>
<div class="paragraph">
<p>Vamos a crear el subrecurso <code>MensajesResource</code> (en el paquete <em>org.expertojava.rest</em>),
de forma que este recurso gestione la creaciÃ³n y consulta de mensajes para cada uno
 de los temas del foro. Este subrecurso debe atender peticiones desde rutas del tipo:
 <code>/temas/<em>identificadorTema</em>/mensajes</code>, siendo <em>identificadorTema</em> la clave
 numÃ©rica asociada a uno de los temas almacenados.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>En este caso, nuestro subrecurso no serÃ¡ un <em>singleton</em>, por lo que necesitaremos
almacenar los mensajes en otra clase diferente (ya que crearemos una nueva instancia
del recurso para cada peticiÃ³n). La clase <code>DatosEnMemoria</code> (en el paquete <em>org.expertojava.datos</em>)
serÃ¡ la encargada de almacenar en memoria la informaciÃ³n de los mensajes publicados
para cada tema. Por ejemplo puedes utilizar los siguientes campos <strong>estÃ¡ticos</strong> para
gestionar los mensajes:</p>
<div class="literalblock">
<div class="content">
<pre>public static Map&lt;Mensaje, String&gt; mensajesDB =
                    new HashMap&lt;Mensaje, String&gt;();</pre>
</div>
</div>
<div class="paragraph">
<p>La clave serÃ¡ el propio mensaje (objeto <em>Mensaje</em>, que se
 asociarÃ¡ al tema correspondiente)</p>
</div>
<div class="literalblock">
<div class="content">
<pre>public static int contadorMen = 0;</pre>
</div>
</div>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Como ya hemos comentado puedes usar <em>ConcurrentHashMap</em> y <em>AtomicInteger</em> en lugar de
los tipos anteriores, para evitar problemas de concurrencia.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="ulist">
<ul>
<li>
<p>En el paquete <em>org.expertojava.datos</em> crearemos la clase <code>Mensaje</code>, con los atributos
privados:</p>
<div class="literalblock">
<div class="content">
<pre>int id;
String texto;
String autor="anonimo";</pre>
</div>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>y sus correspondientes <em>getters</em> y <em>setters</em>:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>setId(), getId()
setTexto(), getTexto()
setAutor(), getAutor()</pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Vamos a crear un mÃ©todo para poder realizar la publicaciÃ³n de un mensaje de texto
en el foro, en uno de los temas ya creados. Independientemente del tipo de
peticiÃ³n realizada sobre los mensajes, si el tema indicado en la URI no existe,
lanzaremos la excepciÃ³n <em>WebApplicationException(Response.Status.NOT_FOUND)</em>.
Veamos algÃºn ejemplo:</p>
<div class="ulist">
<ul>
<li>
<p>Deberemos poder realizar una peticiÃ³n <strong>POST</strong>  a <strong>/temas/1/mensajes</strong>, con el cuerpo de mensaje =
"Mensaje numero 1". El mensaje creado, por defecto tendrÃ¡ asociado el autor "anonimo"</p>
</li>
<li>
<p>Si realizamos una peticiÃ³n para aÃ±adir un mensaje a la URI: <strong>/temas/9/mensajes</strong>,
deberÃ­amos obtener como cabecera de respuesta: <strong>HTTP/1.1 404 Not Found</strong>, independientemente
del cuerpo del mensaje</p>
</li>
</ul>
</div>
</li>
<li>
<p>Vamos a crear un mÃ©todo para realizar una consulta de todos los mensajes
publicados en un tema concreto. Por ejemplo:</p>
<div class="ulist">
<ul>
<li>
<p>Una peticiÃ³n <strong>GET</strong> a <strong>/temas/1/mensajes</strong> deberÃ­a dar como resultado:</p>
<div class="literalblock">
<div class="content">
<pre>"Lista de mensajes para el tema: animales
1. Mensaje anonimo"</pre>
</div>
</div>
</li>
<li>
<p>Si realizamos una peticiÃ³n <strong>GET</strong> a la URI: <strong>/temas/9/mensajes</strong>,
deberÃ­amos obtener como cabecera de respuesta: <strong>HTTP/1.1 404 Not Found</strong>,
independientemente del cuerpo del mensaje</p>
</li>
</ul>
</div>
</li>
<li>
<p>Finalmente vamos a aÃ±adir dos nuevos mÃ©todos para: (a) aÃ±adir un nuevo mensaje
en un tema concreto, indicando el autor del mensaje. Como restricciÃ³n, el nombre del
autor deberÃ¡ estar formado solamente por caracteres alfabÃ©ticos, utilizando mayÃºsculas
o minÃºsculas, y como mÃ­nimo tiene que tener un caracter; y (b) consultar todos los mensajes
que un determinado autor ha publicado en el foro en un tema determinado</p>
<div class="ulist">
<ul>
<li>
<p>Una peticiÃ³n <strong>POST</strong> a la URI: /temas/1/mensajes/pepe, con el cuerpo de mensaje
con valor "mensaje de pepe" deberÃ­a crear un nuevo mensaje para el tema con identificador 2,
y devolver como resultado el nuevo id (y/o la URI del nuevo recurso en la cabecera de
respuesta <em>Location</em>, si seguimos la ortodoxia REST). En caso de que devolvamos la URI del
nuevo recurso podemos utilizar la orden:</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span class="tok-k">return</span> <span class="tok-n">Response</span><span class="tok-o">.</span><span class="tok-na">created</span><span class="tok-o">(</span><span class="tok-n">uriInfo</span><span class="tok-o">.</span><span class="tok-na">getAbsolutePathBuilder</span><span class="tok-o">()</span>  <i class="conum" data-value="1"></i><b>(1)</b>
                                <span class="tok-o">.</span><span class="tok-na">segment</span><span class="tok-o">(</span><span class="tok-n">String</span><span class="tok-o">.</span><span class="tok-na">valueOf</span><span class="tok-o">(</span><span class="tok-n">id</span><span class="tok-o">))</span>  <i class="conum" data-value="2"></i><b>(2)</b>
                                <span class="tok-o">.</span><span class="tok-na">build</span><span class="tok-o">())</span>  <i class="conum" data-value="3"></i><b>(3)</b>
                        <span class="tok-o">.</span><span class="tok-na">build</span><span class="tok-o">();</span> <i class="conum" data-value="4"></i><b>(4)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Obtenemos el path absoluto de la uri que nos ha invocado</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>AÃ±adimos el identificador <em>id</em> del nuevo recurso creado</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Construimos la nueva URI</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Construimos el objeto Response.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Veremos cÃ³mo manipular objetos de tipo <em>Response</em> en sesiones posteriores.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Recuerda que para acceder al cuerpo de la peticiÃ³n basta con definir un parÃ¡metro de tipo <em>String</em>.
JAX-RS automÃ¡ticamente lo instanciarÃ¡ con el cuerpo de la peticiÃ³n como una cadena.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="ulist">
<ul>
<li>
<p>Una peticiÃ³n <strong>GET</strong> a la URI: /temas/1/mensajes/anonimo, darÃ­a como resultado:</p>
<div class="paragraph">
<p>"Lista de mensajes tema= animales ,y autor= anonimo</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Mensaje anonimo"</p>
</li>
</ol>
</div>
</li>
<li>
<p>Una peticiÃ³n <strong>GET</strong> a la URI: /temas/1/mensajes/, darÃ­a como resultado:</p>
<div class="literalblock">
<div class="content">
<pre>"Lista de mensajes para el tema: animales
1. Mensaje anonimo
2. mensaje de pepe"</pre>
</div>
</div>
</li>
<li>
<p>Una peticiÃ³n <strong>GET</strong> a la URI: /temas/1/mensajes/roberto, darÃ­a como resultado:</p>
<div class="literalblock">
<div class="content">
<pre>"Lista de mensajes tema= animales ,y autor= roberto"</pre>
</div>
</div>
</li>
</ul>
</div>
<div style="page-break-after: always;"></div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="sesion03">3. Manejadores de contenidos. Respuestas del servidor y manejo de excepciones.</h2>
<div class="sectionbody">
<div class="paragraph">
<p>En la sesiÃ³n anterior hemos hablado de cÃ³mo inyectar informaciÃ³n contenida en las
cabeceras de las peticiones HTTP, ahora nos detendremos en el cuerpo del
mensaje, tanto de la peticiÃ³n como de la respuesta. En el caso de las peticiones,
explicaremos el proceso de transformar
los datos de entrada en objetos Java, para poder ser procesados por nuestros servicios.
Con respecto a las respuestas proporcionadas por nuestros servicios, analizaremos tanto
los cÃ³digos de respuesta por defecto, como la elaboraciÃ³n de respuestas complejas y
manejo de excepciones.</p>
</div>
<div class="sect2">
<h3 id="_proveedores_de_entidades">3.1. Proveedores de entidades</h3>
<div class="paragraph">
<p>JAX-RS define lo que se denominan <strong>proveedores de entidades</strong>, que son clases que proporcionan
servicios de mapeado entre las representaciones del cuerpo del mensaje HTTP y los
correspondientes tipos java que utilizaremos en nuestros recursos (parÃ¡metros en los mÃ©todos, o
bien como tipo de la respuesta de los mismos). Las <strong>entidades</strong> tambiÃ©n se conocen con el
nombre de <strong>"message payload"</strong>, o simplemente como <strong>payload</strong>, y representan el <strong>contenido del
cuerpo</strong> del mensaje HTTP.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="title">Providers</div>
<div class="paragraph">
<p>El <em>runtime</em> de JAX-RS puede "extenderse" (ampliarse) utilizando clases "proveedoras" (<em>providers</em>)
suministradas por
nuestra aplicaciÃ³n. Concretamente, JAX-RS nos proporciona un conjunto de interfaces que
podemos implementar en nuestra aplicaciÃ³n, creando asÃ­ dichas clases "proveedoras de entidades"
(<em>entity providers</em>).
La especificaciÃ³n de JAX-RS define un <strong>proveedor</strong> como una clase que implementa una o mÃ¡s
interfaces JAX-RS (de entre un conjunto determinado) y que pueden anotarse con <code>@provider</code>
para ser "descubiertas" de forma automÃ¡tica por el <em>runtime</em> de JAX-RS.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Nuestra aplicaciÃ³n puede proporcionar su propio mapeado entre representaciones (tipos MIME)
del mensaje de entrada y tipos Java
implementando las interfaces <code>MessageBodyWriter</code> y <code>MessageBodyReader</code>, convirtiÃ©ndose asÃ­ en clases
<strong>proveedoras de entidades</strong> (<strong><em>entity providers</em></strong>). Por ejemplo, podemos tener nuestro propio proveedor
de entidades para el formato XML, o JSON, de forma que, utilizando las librerÃ­as de java
para procesamiento XML o JSON (<em>Java API for XML Processing: <a href="https://www.jcp.org/en/jsr/detail/summary?id=206">JAXP</a></em>
y <em>Java API for JSON Processing: <a href="https://jcp.org/en/jsr/detail?id=353">JSON-P</a></em>),
implementemos el serializado/deserializado del cuerpo del mensaje HTTP de entrada cuando
Ã©ste presente los tipos MIME <em>"application/xml"</em> o <em>"application_json"</em>. Las clases que realizan
dichos mapeados son clases <em>entity provider</em>.</p>
</div>
<div class="sect3">
<h4 id="_interfaz_javax_ws_rs_ext_messagebodyreader">3.1.1. Interfaz javax.ws.rs.ext.MessageBodyReader</h4>
<div class="paragraph">
<p>La interfaz <code>MessageBodyReader</code> define el contrato entre el <em>runtime</em> de JAX-RS y
los componentes que proporcionan servicios de mapeado desde diferentes representaciones
(indicadas como tipos <em>mime</em>) al
tipo Java correspondiente. Cualquier clase que quiera proporcionar dicho servicio
debe implementar la interfaz <code>MessageBodyReader</code> y debe anotarse con @Provider para
poder ser "detectada" de forma automÃ¡tica por el <em>runtime</em> de JAX-RS.</p>
</div>
<div class="paragraph">
<p>La secuencia lÃ³gica de pasos seguidos por una implementaciÃ³n de JAX-RS cuando se
mapea el cuerpo de un mensaje HTTP de entrada a un parÃ¡metro de un mÃ©todo Java es
la siguiente:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Se obtiene el <em>media type</em> de la peticiÃ³n (valor de la cabecera HTTP <code>Content-Type</code>).
Si la peticiÃ³n no contiene una cabecera <code>Content-Type</code> se usarÃ¡ <code>application/octet-stream</code></p>
</li>
<li>
<p>Se identifica el tipo java del parÃ¡metro cuyo valor serÃ¡ mapeado desde el cuerpo del mensaje</p>
</li>
<li>
<p>Se localiza la clase <code>MessageBodyReader</code> que soporta el <em>media type</em> de la peticiÃ³n y se
usa su mÃ©todo <code>readFrom()</code> para mapear el contenido del cuerpo del mensaje HTTP en el
tipo Java que corresponda</p>
</li>
<li>
<p>Si no es posible encontrar el <em>MessageBodyReader</em> adecuado se genera la excepciÃ³n
<code>NotSupportedException</code>, con el cÃ³digo 405</p>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="_interfaz_javax_ws_rs_ext_messagebodywriter">3.1.2. Interfaz javax.ws.rs.ext.MessageBodyWriter</h4>
<div class="paragraph">
<p>La interfaz <code>MessageBodyWriter</code> define el contrato entre el <em>runtime</em> de JAX-RS y
los componentes que proporcionan servicios de mapeado desde un tipo Java a una
representaciÃ³n determinada. Cualquier clase que quiera proporcionar dicho servicio
debe implementar la interfaz <code>MessageBodyWriter</code> y debe anotarse con <code>@Provider</code> para
poder ser "detectada" de forma automÃ¡tica por el <em>runtime</em> de JAX-RS.</p>
</div>
<div class="paragraph">
<p>La secuencia lÃ³gica de pasos seguidos por una implementaciÃ³n de JAX-RS cuando se
mapea un valor de retorno de un mÃ©todo del recurso a una entidad del cuerpo de un
mensaje HTTP es la siguiente:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Se obtiene el objeto que serÃ¡ mapeado a la entidad del cuerpo del mensaje</p>
</li>
<li>
<p>Se determina el <em>media type</em> de la respuesta</p>
</li>
<li>
<p>Se localiza la clase <code>MessageBodyWriter</code> que soporta el objeto que serÃ¡ mapeado
a la entidad del cuerpo del mensaje HTTP, y se utiliza su mÃ©todo <code>writeTo()</code> para
realizar dicho mapeado</p>
</li>
<li>
<p>Si no es posible encontrar el <code>MessageBodyWriter</code> adecuado se genera la excepciÃ³n
<code>InternalServerErrorException</code> (que es una subclase de <code>WebApplicationException</code>)
 con el cÃ³digo 500</p>
</li>
</ol>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_proveedores_de_entidad_estÃ¡ndar_incluidos_en_jax_rs">3.2. Proveedores de entidad estÃ¡ndar incluidos en JAX-RS</h3>
<div class="paragraph">
<p>Cualquier implementaciÃ³n de JAX-RS debe incluir un conjunto de implementaciones de
<code>MessageBodyReader</code> y <code>MessageBodyWriter</code> de forma predeterminada para ciertas
combinaciones de tipos Java y <em>media types</em>.</p>
</div>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 3. Proveedores de entidades estÃ¡ndar de una implementaciÃ³n JAX-RS</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Tipo Java</th>
<th class="tableblock halign-left valign-top">Media Type</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">byte[]</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">*/* (Cualquier <em>media type</em>)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">java.lang.String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">*/* (Cualquier <em>media type</em>)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">java.io.InputStream</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">*/* (Cualquier <em>media type</em>)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">java.io.Reader</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">*/* (Cualquier <em>media type</em>)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">java.io.File</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">*/* (Cualquier <em>media type</em>)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">javax.activation.DataSource</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">*/* (Cualquier <em>media type</em>)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">javax.xml.transform.Source</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">text/xml, application/xml, application/*+xml (tipos basados en xml)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">javax.xml.bind.JAXBElement and application-supplied JAXB classes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">text/xml, application/xml, application/*+xml (tipos basados en xml)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">MultivaluedMap&lt;String,String&gt;</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">application/x-www-form-urlencoded (Contenido de formularios)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">StreamingOutput</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">*/* (Cualquier <em>media type</em>) (SÃ³lo <code>MessageBodyWriter</code>)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">java.lang.Boolean, java.lang.Character, java.lang.Number</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">text/plain</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>A continuaciÃ³n comentaremos algunos de estos <em>proveedores de entidades</em> estÃ¡ndar,
 o "conversores" por defecto, que permiten convertir el cuerpo
del mensaje HTTP a objetos Java de diferentes tipos y viceversa.</p>
</div>
<div class="sect3">
<h4 id="_javax_ws_rs_core_streamingoutput">3.2.1. javax.ws.rs.core.StreamingOutput</h4>
<div class="paragraph">
<p><em>StreamingOutput</em> es una interfaz
<em>callback</em> que implementamos cuando queremos tratar como un flujo continuo (<em>streaming</em>) el
cuerpo de la respuesta. Constituye una alternativa "ligera" al uso de <code>MessageBodyWriter</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span class="tok-kd">public</span> <span class="tok-kd">interface</span> <span class="tok-nc">StreamingOutput</span> <span class="tok-o">{</span>
  <span class="tok-kt">void</span> <span class="tok-nf">write</span><span class="tok-o">(</span><span class="tok-n">OutputStream</span> <span class="tok-n">output</span><span class="tok-o">)</span>
     <span class="tok-kd">throws</span> <span class="tok-n">IOException</span><span class="tok-o">,</span> <span class="tok-n">WebApplicationException</span><span class="tok-o">;</span>
<span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Implementamos una instancia de esta interfaz, y la utilizamos como tipo de retorno de
nuestros mÃ©todos de recursos. Cuando el <em>runtime</em> de JAX-RS estÃ¡ listo para escribir
el cuerpo de respuesta del mensaje, se invoca al mÃ©todo <code>write()</code> de la instancia de
<code>StreamingOutput</code>. Veamos un ejemplo:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span class="tok-nd">@Path</span><span class="tok-o">(</span><span class="tok-s">&quot;/miservicio&quot;</span><span class="tok-o">)</span> <span class="tok-kd">public</span> <span class="tok-kd">class</span> <span class="tok-nc">MiServicio</span> <span class="tok-o">{</span>
  <span class="tok-nd">@GET</span>
  <span class="tok-nd">@Produces</span><span class="tok-o">(</span><span class="tok-s">&quot;text/plain&quot;</span><span class="tok-o">)</span>
  <span class="tok-n">StreamingOutput</span> <span class="tok-nf">get</span><span class="tok-o">()</span> <span class="tok-o">{</span>
    <span class="tok-k">return</span> <span class="tok-k">new</span> <span class="tok-nf">StreamingOutput</span><span class="tok-o">()</span> <span class="tok-o">{</span>
      <span class="tok-kd">public</span> <span class="tok-kt">void</span> <span class="tok-nf">write</span><span class="tok-o">(</span><span class="tok-n">OutputStream</span> <span class="tok-n">output</span><span class="tok-o">)</span>
            <span class="tok-kd">throws</span> <span class="tok-n">IOException</span><span class="tok-o">,</span> <span class="tok-n">WebApplicationException</span> <span class="tok-o">{</span>
                <span class="tok-n">output</span><span class="tok-o">.</span><span class="tok-na">write</span><span class="tok-o">(</span><span class="tok-s">&quot;hello world&quot;</span><span class="tok-o">.</span><span class="tok-na">getBytes</span><span class="tok-o">());</span>
      <span class="tok-o">}</span>
  <span class="tok-o">};</span>
<span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Hemos utilizado una clase interna anÃ³nima que implementa la interfaz <code>StreamingOutput</code>
en lugar de crear una clase pÃºblica separada. La razÃ³n de utilizar una clase interna, es
porque en este caso, al contener tan pocas lÃ­neas de cÃ³digo, resulta beneficioso mantener dicha lÃ³gica "dentro" del
mÃ©todo del recurso JAX-RS, de forma que el cÃ³digo sea mÃ¡s fÃ¡cil de "seguir". Normalmente
no tendremos necesidad de reutilizar la lÃ³gica implementada en otros mÃ©todos, por lo que
no tiene demasiado sentido crear otra clase especÃ­fica.</p>
</div>
<div class="paragraph">
<p>Â¿Y por quÃ© no inyectamos un <code>OutputStream</code> directamente? Â¿Por quÃ© necesitamos un objeto
<code>callback</code>? La razÃ³n es que asÃ­ dejamos que el runtime de JAX-RS maneje la salida de la
manera que quiera. Por ejemplo, por razones de rendimiento, puede ser conveniente que
JAX-RS utilice un <em>thread</em> para responder, diferente del <em>thread</em> de peticiÃ³n.</p>
</div>
</div>
<div class="sect3">
<h4 id="_java_io_inputstream_java_io_reader">3.2.2. java.io.InputStream, java.io.Reader</h4>
<div class="paragraph">
<p>Para leer el cuerpo de un mensaje de entrada, podemos utilizar las clases <code>InputStream</code> o
 <code>Reader</code>. Por ejemplo:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span class="tok-nd">@Path</span><span class="tok-o">(</span><span class="tok-s">&quot;/&quot;</span><span class="tok-o">)</span>
<span class="tok-kd">public</span> <span class="tok-kd">class</span> <span class="tok-nc">MiServicio</span> <span class="tok-o">{</span>
  <span class="tok-nd">@PUT</span>
  <span class="tok-nd">@Path</span><span class="tok-o">(</span><span class="tok-s">&quot;/dato&quot;</span><span class="tok-o">)</span>
  <span class="tok-kd">public</span> <span class="tok-kt">void</span> <span class="tok-nf">modificaDato</span><span class="tok-o">(</span><span class="tok-n">InputStream</span> <span class="tok-n">is</span><span class="tok-o">)</span> <span class="tok-o">{</span>
     <span class="tok-kt">byte</span><span class="tok-o">[]</span> <span class="tok-n">bytes</span> <span class="tok-o">=</span> <span class="tok-n">readFromStream</span><span class="tok-o">(</span><span class="tok-n">is</span><span class="tok-o">);</span>
     <span class="tok-n">String</span> <span class="tok-n">input</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-nf">String</span><span class="tok-o">(</span><span class="tok-n">bytes</span><span class="tok-o">);</span>
     <span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">out</span><span class="tok-o">.</span><span class="tok-na">println</span><span class="tok-o">(</span><span class="tok-n">input</span><span class="tok-o">);</span>
  <span class="tok-o">}</span>

  <span class="tok-kd">private</span> <span class="tok-kt">byte</span><span class="tok-o">[]</span> <span class="tok-nf">readFromStream</span><span class="tok-o">(</span><span class="tok-n">InputStream</span> <span class="tok-n">stream</span><span class="tok-o">)</span>
                           <span class="tok-kd">throws</span> <span class="tok-n">IOException</span> <span class="tok-o">{</span>
    <span class="tok-n">ByteArrayOutputStream</span> <span class="tok-n">baos</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-nf">ByteArrayOutputStream</span><span class="tok-o">();</span>
    <span class="tok-kt">byte</span><span class="tok-o">[]</span> <span class="tok-n">buffer</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-kt">byte</span><span class="tok-o">[</span><span class="tok-mi">1000</span><span class="tok-o">];</span>
    <span class="tok-kt">int</span> <span class="tok-n">wasRead</span> <span class="tok-o">=</span> <span class="tok-mi">0</span><span class="tok-o">;</span>
    <span class="tok-k">do</span> <span class="tok-o">{</span>
       <span class="tok-n">wasRead</span> <span class="tok-o">=</span> <span class="tok-n">stream</span><span class="tok-o">.</span><span class="tok-na">read</span><span class="tok-o">(</span><span class="tok-n">buffer</span><span class="tok-o">);</span>
       <span class="tok-k">if</span> <span class="tok-o">(</span><span class="tok-n">wasRead</span> <span class="tok-o">&gt;</span> <span class="tok-mi">0</span><span class="tok-o">)</span> <span class="tok-o">{</span>
          <span class="tok-n">baos</span><span class="tok-o">.</span><span class="tok-na">write</span><span class="tok-o">(</span><span class="tok-n">buffer</span><span class="tok-o">,</span> <span class="tok-mi">0</span><span class="tok-o">,</span> <span class="tok-n">wasRead</span><span class="tok-o">);</span>
       <span class="tok-o">}</span>
    <span class="tok-o">}</span> <span class="tok-k">while</span> <span class="tok-o">(</span><span class="tok-n">wasRead</span> <span class="tok-o">&gt;</span> <span class="tok-o">-</span><span class="tok-mi">1</span><span class="tok-o">);</span>
    <span class="tok-k">return</span> <span class="tok-n">baos</span><span class="tok-o">.</span><span class="tok-na">toByteArray</span><span class="tok-o">();</span>
  <span class="tok-o">}</span>
<span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>En este caso estamos leyendo <em>bytes</em> a partir de un <code>java.io.InputStream</code>,
para convertirlo en una cadena de caracteres que mostramos por pantalla.</p>
</div>
<div class="paragraph">
<p>En el siguiente ejemplo, creamos un <code>java.io.LineNumberReader</code> a partir de
un objeto <code>Reader</code> e imprimimos cada lÃ­nea del cuerpo del mensaje de entrada:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span class="tok-nd">@PUT</span>
<span class="tok-nd">@Path</span><span class="tok-o">(</span><span class="tok-s">&quot;/maslineas&quot;</span><span class="tok-o">)</span>
<span class="tok-kd">public</span> <span class="tok-kt">void</span> <span class="tok-nf">putMasLineas</span><span class="tok-o">(</span><span class="tok-n">Reader</span> <span class="tok-n">reader</span><span class="tok-o">)</span> <span class="tok-o">{</span>
    <span class="tok-n">LineNumberReader</span> <span class="tok-n">lineReader</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-nf">LineNumberReader</span><span class="tok-o">(</span><span class="tok-n">reader</span><span class="tok-o">);</span>
    <span class="tok-k">do</span><span class="tok-o">{</span>
        <span class="tok-n">String</span> <span class="tok-n">line</span> <span class="tok-o">=</span> <span class="tok-n">lineReader</span><span class="tok-o">.</span><span class="tok-na">readLine</span><span class="tok-o">();</span>
        <span class="tok-k">if</span> <span class="tok-o">(</span><span class="tok-n">line</span> <span class="tok-o">!=</span> <span class="tok-kc">null</span><span class="tok-o">)</span> <span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">out</span><span class="tok-o">.</span><span class="tok-na">println</span><span class="tok-o">(</span><span class="tok-n">line</span><span class="tok-o">);</span>
    <span class="tok-o">}</span> <span class="tok-k">while</span> <span class="tok-o">(</span><span class="tok-n">line</span> <span class="tok-o">!=</span> <span class="tok-kc">null</span><span class="tok-o">);</span>
<span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>No estamos limitados solamente a utilizar instancias de <code>InputStream</code> y/o <code>Reader</code>
para leer el cuerpo de los mensajes de entrada. TambiÃ©n podemos devolver dichos
objetos como respuesta. Por ejemplo:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span class="tok-nd">@Path</span><span class="tok-o">(</span><span class="tok-s">&quot;/fichero&quot;</span><span class="tok-o">)</span>
<span class="tok-kd">public</span> <span class="tok-kd">class</span> <span class="tok-nc">FicheroServicio</span> <span class="tok-o">{</span>
  <span class="tok-kd">private</span> <span class="tok-kd">static</span> <span class="tok-kd">final</span> <span class="tok-n">String</span> <span class="tok-n">basePath</span> <span class="tok-o">=</span> <span class="tok-s">&quot;...&quot;</span><span class="tok-o">;</span>

  <span class="tok-nd">@GET</span>
  <span class="tok-nd">@Path</span><span class="tok-o">(</span><span class="tok-s">&quot;{rutafichero: .*}&quot;</span><span class="tok-o">)</span>
  <span class="tok-nd">@Produces</span><span class="tok-o">(</span><span class="tok-s">&quot;text/plain&quot;</span><span class="tok-o">)</span>
  <span class="tok-kd">public</span> <span class="tok-n">InputStream</span> <span class="tok-nf">getFichero</span><span class="tok-o">(</span><span class="tok-nd">@PathParam</span><span class="tok-o">(</span><span class="tok-s">&quot;rutafichero&quot;</span><span class="tok-o">)</span>
                                 <span class="tok-n">String</span> <span class="tok-n">path</span><span class="tok-o">)</span> <span class="tok-o">{</span>
    <span class="tok-n">FileInputStream</span> <span class="tok-n">is</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-nf">FileInputStream</span><span class="tok-o">(</span><span class="tok-n">basePath</span> <span class="tok-o">+</span> <span class="tok-n">path</span><span class="tok-o">);</span>
    <span class="tok-k">return</span> <span class="tok-n">is</span><span class="tok-o">;</span>
  <span class="tok-o">}</span>
<span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>AquÃ­ estamos inyectando un valor <code>@PathParam</code> para crear una referencia a un fichero real
de nuestro disco duro. Creamos una instancia de <code>java.io.FileInputStream</code> a partir del valor
de la ruta inyectada como parÃ¡metro y la devolvemos como cuerpo de nuestro mensaje de
respuesta. La implementaciÃ³n de JAX-RS leerÃ¡ la respuesta de este <em>stream</em> de entrada
y la almacenarÃ¡ en un <em>buffer</em> para posteriormente "escribirla" de forma incremental
en el <em>stream</em> de salida de la respuesta. En este caso debemos especificar la anotaciÃ³n
@Produces para que la implementaciÃ³n de JAX-RS conozca el valor que debe asignar a la
cabecera <code>Content-Type</code> en la respuesta.</p>
</div>
</div>
<div class="sect3">
<h4 id="_java_io_file">3.2.3. java.io.File</h4>
<div class="paragraph">
<p>Se pueden utilizar instancias de la clase <code>java.io.File</code> para <strong>entrada y salida</strong> de cualquier
MIME-TYPE (especificado en <code>Content-Type</code> y/o <code>Accept</code>, y en las anotaciones <code>@Produces</code> y/o
<code>@Consumes</code>) . El siguiente cÃ³digo, por ejemplo, devuelve una referencia
a un fichero en nuestro disco:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span class="tok-nd">@Path</span><span class="tok-o">(</span><span class="tok-s">&quot;/fichero&quot;</span><span class="tok-o">)</span>
<span class="tok-kd">public</span> <span class="tok-kd">class</span> <span class="tok-nc">FicheroServicio</span> <span class="tok-o">{</span>
  <span class="tok-kd">private</span> <span class="tok-kd">static</span> <span class="tok-kd">final</span> <span class="tok-n">String</span> <span class="tok-n">baseRuta</span> <span class="tok-o">=</span> <span class="tok-s">&quot;...&quot;</span><span class="tok-o">;</span>

  <span class="tok-nd">@GET</span>
  <span class="tok-nd">@Path</span><span class="tok-o">(</span><span class="tok-s">&quot;{rutafichero: .*}&quot;</span><span class="tok-o">)</span>
  <span class="tok-nd">@Produces</span><span class="tok-o">(</span><span class="tok-s">&quot;text/plain&quot;</span><span class="tok-o">)</span>
  <span class="tok-kd">public</span> <span class="tok-n">File</span> <span class="tok-nf">getFichero</span><span class="tok-o">(</span><span class="tok-nd">@PathParam</span><span class="tok-o">(</span><span class="tok-s">&quot;rutafichero&quot;</span><span class="tok-o">)</span>
                                 <span class="tok-n">String</span> <span class="tok-n">ruta</span><span class="tok-o">)</span> <span class="tok-o">{</span>
    <span class="tok-k">return</span> <span class="tok-k">new</span> <span class="tok-nf">File</span><span class="tok-o">(</span><span class="tok-n">baseRuta</span> <span class="tok-o">+</span> <span class="tok-n">ruta</span><span class="tok-o">);</span>
  <span class="tok-o">}</span>
<span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>En este caso inyectamos el valor de la ruta del fichero con la anotaciÃ³n <code>@PathParam</code>.
A partir de dicha ruta creamos un objeto <code>java.io.File</code> y lo devolvemos como cuerpo
del mensaje de respuesta. La implementaciÃ³n JAX-RS "leerÃ¡" la informaciÃ³n "abriendo"
un <code>InputStream</code> basado en esta referencia al fichero y la "escribirÃ¡" en un <em>buffer</em>.
Posteriormente y de forma incremental, volverÃ¡ a escribir el contenido del <em>buffer</em> en
el <em>stream</em> de salida de la respuesta. Al igual que en el ejemplo anterior, debemos
especificar la anotaciÃ³n @Produces para que JAX-RS sepa cÃ³mo "rellenar" la cabecera
<code>Content-Type</code> de la respuesta.</p>
</div>
<div class="paragraph">
<p>TambiÃ©n podemos inyectar instancias de <code>java.io.File</code> a partir del cuerpo del mensaje
de la peticiÃ³n. Por ejemplo:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span class="tok-nd">@POST</span>
<span class="tok-nd">@Path</span><span class="tok-o">(</span><span class="tok-s">&quot;/masdatos&quot;</span><span class="tok-o">)</span>
<span class="tok-kd">public</span> <span class="tok-kt">void</span> <span class="tok-nf">post</span><span class="tok-o">(</span><span class="tok-n">File</span> <span class="tok-n">fichero</span><span class="tok-o">)</span> <span class="tok-o">{</span>
    <span class="tok-n">Reader</span> <span class="tok-n">reader</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-nf">Reader</span><span class="tok-o">(</span><span class="tok-k">new</span> <span class="tok-nf">FileInputStream</span><span class="tok-o">(</span><span class="tok-n">fichero</span><span class="tok-o">));</span>
    <span class="tok-n">LineNumberReader</span> <span class="tok-n">lineReader</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-nf">LineNumberReader</span><span class="tok-o">(</span><span class="tok-n">reader</span><span class="tok-o">);</span>
    <span class="tok-k">do</span><span class="tok-o">{</span>
      <span class="tok-n">String</span> <span class="tok-n">line</span> <span class="tok-o">=</span> <span class="tok-n">lineReader</span><span class="tok-o">.</span><span class="tok-na">readLine</span><span class="tok-o">();</span>
      <span class="tok-k">if</span> <span class="tok-o">(</span><span class="tok-n">line</span> <span class="tok-o">!=</span> <span class="tok-kc">null</span><span class="tok-o">)</span> <span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">out</span><span class="tok-o">.</span><span class="tok-na">println</span><span class="tok-o">(</span><span class="tok-n">line</span><span class="tok-o">);</span>
    <span class="tok-o">}</span> <span class="tok-k">while</span> <span class="tok-o">(</span><span class="tok-n">line</span> <span class="tok-o">!=</span> <span class="tok-kc">null</span><span class="tok-o">);</span>
<span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>En este caso la implementaciÃ³n de JAX-RS crea un fichero temporal en el disco
para la entrada. Lee la informaciÃ³n desde el <em>buffer</em> de la red y guarda los
<em>bytes</em> leÃ­dos en este fichero temporal. En el ejemplo, los datos leÃ­dos desde
la red estÃ¡n representados por el el objeto File inyectado por el <em>runtime</em> de JAX-RS (recuerda
que sÃ³lo puede haber un parÃ¡metro sin anotaciones en los mÃ©todos del recurso y
que Ã©ste representa el cuerpo del mensaje de la peticiÃ³n HTTP). A continuaciÃ³n,
el mÃ©todo <code>post()</code> crea un <code>java.io.FileInputStream</code> a partir del objeto <code>File</code>
inyectado. Finalmente utilizamos Ã©ste <em>stream</em> de entrada para crear un objeto
<code>LineNumberReader</code> y mostrar los datos por la consola.</p>
</div>
</div>
<div class="sect3">
<h4 id="_byte">3.2.4. byte[]</h4>
<div class="paragraph">
<p>Podemos utilizar un array de bytes como <strong>entrada y salida</strong> para cualquier tipo
especificado como <em>media-type</em>. A continuaciÃ³n mostramos un ejemplo:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span class="tok-nd">@Path</span><span class="tok-o">(</span><span class="tok-s">&quot;/&quot;</span><span class="tok-o">)</span>
<span class="tok-kd">public</span> <span class="tok-kd">class</span> <span class="tok-nc">MiServicio</span> <span class="tok-o">{</span>
   <span class="tok-nd">@GET</span>
   <span class="tok-nd">@Produces</span><span class="tok-o">(</span><span class="tok-s">&quot;text/plain&quot;</span><span class="tok-o">)</span>
   <span class="tok-kd">public</span> <span class="tok-kt">byte</span><span class="tok-o">[]</span> <span class="tok-nf">get</span><span class="tok-o">()</span> <span class="tok-o">{</span>
         <span class="tok-k">return</span> <span class="tok-s">&quot;hello world&quot;</span><span class="tok-o">.</span><span class="tok-na">getBytes</span><span class="tok-o">();</span>
   <span class="tok-o">}</span>

   <span class="tok-nd">@POST</span>
   <span class="tok-nd">@Consumes</span><span class="tok-o">(</span><span class="tok-s">&quot;text/plain&quot;</span><span class="tok-o">)</span>
   <span class="tok-kd">public</span> <span class="tok-kt">void</span> <span class="tok-nf">post</span><span class="tok-o">(</span><span class="tok-kt">byte</span><span class="tok-o">[]</span> <span class="tok-n">bytes</span><span class="tok-o">)</span> <span class="tok-o">{</span>
       <span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">out</span><span class="tok-o">.</span><span class="tok-na">println</span><span class="tok-o">(</span><span class="tok-k">new</span> <span class="tok-nf">String</span><span class="tok-o">(</span><span class="tok-n">bytes</span><span class="tok-o">));</span> <span class="tok-o">}</span>
   <span class="tok-o">}</span>
<span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Para cualquier mÃ©todo de recurso JAX-RS que devuelva un array de bytes, debemos
especificar la anotaciÃ³n @Produces para que JAX-RS sepa quÃ© valor asignar a la
cabecera <code>Content-Type</code>.</p>
</div>
</div>
<div class="sect3">
<h4 id="_string_char">3.2.5. String, char[]</h4>
<div class="paragraph">
<p>La mayor parte de formatos en internet estÃ¡n basados en texto. JAX-RS puede convertir
cualquier formato basado en texto a un <code>String</code> o a cualquier array de caracteres. Por
ejemplo:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span class="tok-nd">@Path</span><span class="tok-o">(</span><span class="tok-s">&quot;/&quot;</span><span class="tok-o">)</span>
<span class="tok-kd">public</span> <span class="tok-kd">class</span> <span class="tok-nc">MiServicio</span> <span class="tok-o">{</span>
  <span class="tok-nd">@GET</span>
  <span class="tok-nd">@Produces</span><span class="tok-o">(</span><span class="tok-s">&quot;application/xml&quot;</span><span class="tok-o">)</span>
  <span class="tok-kd">public</span> <span class="tok-n">String</span> <span class="tok-nf">get</span><span class="tok-o">()</span> <span class="tok-o">{</span>
    <span class="tok-k">return</span> <span class="tok-s">&quot;&lt;customer&gt;&lt;name&gt;Sergio Garcia&lt;/name&gt;&lt;/customer&gt;&quot;</span><span class="tok-o">;</span>
  <span class="tok-o">}</span>

  <span class="tok-nd">@POST</span>
  <span class="tok-nd">@Consumes</span><span class="tok-o">(</span><span class="tok-s">&quot;text/plain&quot;</span><span class="tok-o">)</span>
  <span class="tok-kd">public</span> <span class="tok-kt">void</span> <span class="tok-nf">post</span><span class="tok-o">(</span><span class="tok-n">String</span> <span class="tok-n">str</span><span class="tok-o">)</span> <span class="tok-o">{</span>
    <span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">out</span><span class="tok-o">.</span><span class="tok-na">println</span><span class="tok-o">(</span><span class="tok-n">str</span><span class="tok-o">);</span>
  <span class="tok-o">}</span>
<span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Para cualquier mÃ©todo de recurso JAX-RS que devuelva un <code>Sring</code> o un array de caracteres
debemos especificar la anotaciÃ³n <code>@Produces</code> para que JAX-RS sepa que valor asignar a la
cabecera <code>Content-Type</code>.</p>
</div>
</div>
<div class="sect3">
<h4 id="_multivaluedmap_string_string_y_formularios_de_entrada">3.2.6. MultivaluedMap&lt;String, String&gt; y formularios de entrada</h4>
<div class="paragraph">
<p>Los formularios HTML son usados habitualmente para enviar datos a servidores web.
Los datos del formulario estÃ¡n codificados con el <em>media type</em> <code>application/x-www-form-urlencoded</code>.
Ya hemos visto como utilizar la anotaciÃ³n <code>@FormParam</code> para inyectar parÃ¡metros individuales
de un formulario de las peticiones de entrada. TambiÃ©n podremos inyectar una instancia de
<code>MultivaluedMap&lt;String, String&gt;</code>, que representa todos los datos del formulario enviado
en la peticiÃ³n. Por ejemplo:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span class="tok-nd">@Path</span><span class="tok-o">(</span><span class="tok-s">&quot;/&quot;</span><span class="tok-o">)</span>
  <span class="tok-kd">public</span> <span class="tok-kd">class</span> <span class="tok-nc">MiServicio</span> <span class="tok-o">{</span>
    <span class="tok-nd">@POST</span> <span class="tok-nd">@Consumes</span><span class="tok-o">(</span><span class="tok-s">&quot;application/x-www-form-urlencoded&quot;</span><span class="tok-o">)</span>
    <span class="tok-nd">@Produces</span><span class="tok-o">(</span><span class="tok-s">&quot;application/x-www-form-urlencoded&quot;</span><span class="tok-o">)</span>
    <span class="tok-kd">public</span> <span class="tok-n">MultivaluedMap</span><span class="tok-o">&lt;</span><span class="tok-n">String</span><span class="tok-o">,</span><span class="tok-n">String</span><span class="tok-o">&gt;</span> <span class="tok-nf">post</span><span class="tok-o">(</span>
                       <span class="tok-n">MultivaluedMap</span><span class="tok-o">&lt;</span><span class="tok-n">String</span><span class="tok-o">,</span> <span class="tok-n">String</span><span class="tok-o">&gt;</span> <span class="tok-n">form</span><span class="tok-o">)</span> <span class="tok-o">{</span>
        <span class="tok-c1">//el formulario tiene los campos &quot;fieldName1&quot; y &quot;fieldName2&quot;</span>
        <span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">out</span><span class="tok-o">.</span><span class="tok-na">println</span><span class="tok-o">(</span><span class="tok-n">form</span><span class="tok-o">.</span><span class="tok-na">getFirst</span><span class="tok-o">(</span><span class="tok-s">&quot;fieldName1&quot;</span><span class="tok-o">));</span>
        <span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">out</span><span class="tok-o">.</span><span class="tok-na">println</span><span class="tok-o">(</span><span class="tok-n">form</span><span class="tok-o">.</span><span class="tok-na">getFirst</span><span class="tok-o">(</span><span class="tok-s">&quot;fieldName2&quot;</span><span class="tok-o">));</span>
        <span class="tok-k">return</span> <span class="tok-n">form</span><span class="tok-o">;</span> <span class="tok-o">}</span>
<span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>En este cÃ³digo, nuestro mÃ©todo <code>post()</code> acepta peticiones POST y recibe un
<code>MultivaluedMap&lt;String,String&gt;</code> que contiene todos los datos de nuestro formulario.
En este caso tambiÃ©n devolvemos una instancia de un formulario como respuesta.</p>
</div>
<div class="paragraph">
<p>Los datos del formulario pueden representarse en el cuerpo de la petciÃ³n como pares
<code>nombre=valor</code> separados por <code>&amp;</code>. Por ejemplo:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>fieldName1=valor%20con%20espacios&amp;fielName2=otroValor</pre>
</div>
</div>
<div class="paragraph">
<p>Los espacios en blanco se codifican como <code>%20</code>. No es necesario poner comillas.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_mÃºltiples_representaciones_de_recursos">3.3. MÃºltiples representaciones de recursos</h3>
<div class="paragraph">
<p>Por defecto, un recurso RESTful se produce o consume con el tipo MIME "/". Un
recurso RESTful puede restringir los <em>media types</em> que soporta, tanto en la peticiÃ³n
como en la respuesta, utilizando las anotaciones @Consumes y @Produces, respectivamente.
Estas anotaciones pueden especificarse, como ya hemos visto, a nivel de clase o de
mÃ©todo de recurso. Las anotaciones especificadas sobre el mÃ©todo prevalecen sobre
las de la clase. La ausencia de estas anotaciones es equivalente a su inclusiÃ³n
con el tipo MIME <em>("<strong>/</strong>")</em>, es decir, su ausencia implica que se soporta cualquier tipo.</p>
</div>
<div class="paragraph">
<p>A continuaciÃ³n mostramos un ejemplo en el que un <em>Pedido</em> puede "producirse" tanto
en formato xml como en formato json:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span class="tok-nd">@GET</span>
<span class="tok-nd">@Path</span><span class="tok-o">(</span><span class="tok-s">&quot;{id}&quot;</span><span class="tok-o">)</span>
<span class="tok-nd">@Produces</span><span class="tok-o">({</span><span class="tok-s">&quot;application/xml&quot;</span><span class="tok-o">,</span> <span class="tok-s">&quot;application/json&quot;</span><span class="tok-o">})</span>
<span class="tok-kd">public</span> <span class="tok-n">Pedido</span> <span class="tok-nf">getPedido</span><span class="tok-o">(</span><span class="tok-nd">@PathParam</span><span class="tok-o">(</span><span class="tok-s">&quot;id&quot;</span><span class="tok-o">)</span><span class="tok-kt">int</span> <span class="tok-n">id</span><span class="tok-o">)</span> <span class="tok-o">{</span> <span class="tok-o">.</span> <span class="tok-o">.</span> <span class="tok-o">.</span> <span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>El mÃ©todo <em>getPedido()</em> puede generar ambas representaciones para el pedido. El
tipo exacto de la respuesta viene determinado por la cabecera HTTP <strong>Accept</strong> de
la peticiÃ³n.</p>
</div>
<div class="paragraph">
<p>Otro ejemplo, en el que pueden "consumirse" varios tipos MIME, puede ser el siguiente:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span class="tok-nd">@POST</span>
<span class="tok-nd">@Path</span><span class="tok-o">(</span><span class="tok-s">&quot;{id}&quot;</span><span class="tok-o">)</span>
<span class="tok-nd">@Consumes</span><span class="tok-o">({</span><span class="tok-s">&quot;application/xml&quot;</span><span class="tok-o">,</span> <span class="tok-s">&quot;application/json&quot;</span><span class="tok-o">})</span>
<span class="tok-kd">public</span> <span class="tok-n">Pedido</span> <span class="tok-nf">addPedido</span><span class="tok-o">(</span><span class="tok-nd">@PathParam</span><span class="tok-o">(</span><span class="tok-s">&quot;id&quot;</span><span class="tok-o">)</span><span class="tok-kt">int</span> <span class="tok-n">id</span><span class="tok-o">)</span> <span class="tok-o">{</span> <span class="tok-o">.</span> <span class="tok-o">.</span> <span class="tok-o">.</span> <span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>En este caso el formato "consumido" vendrÃ¡ dado por el valor de la cabecera HTTP
<strong>Content-Type</strong> de la peticiÃ³n.</p>
</div>
<div class="paragraph">
<p>JAX-RS 2.0 nos permite indicar la preferencia por un <em>media type</em>, en el lado del
servidor, utilizando el parÃ¡metro <strong>qs</strong> (<strong>q</strong>uality on <strong>s</strong>ervice). <strong>qs</strong> toma
valores entre 0.000 y 1.000, e indica la calidad relativa de una representaciÃ³n
comparado con el resto de representaciones disponibles. Una representaciÃ³n con un
valor de <em>qs</em> de 0.000 nunca serÃ¡ elegido. Una representaciÃ³n sin valor para el parÃ¡metro
<em>qs</em> se asume que dicho valor es 1.000</p>
</div>
<div class="paragraph">
<p>Ejemplo:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span class="tok-nd">@POST</span>
<span class="tok-nd">@Path</span><span class="tok-o">(</span><span class="tok-s">&quot;{id}&quot;</span><span class="tok-o">)</span>
<span class="tok-nd">@Consumes</span><span class="tok-o">({</span><span class="tok-s">&quot;application/xml; qs=0.75&quot;</span><span class="tok-o">,</span> <span class="tok-s">&quot;application/json; qs=1&quot;</span><span class="tok-o">})</span>
<span class="tok-kd">public</span> <span class="tok-n">Pedido</span> <span class="tok-nf">addPedido</span><span class="tok-o">(</span><span class="tok-nd">@PathParam</span><span class="tok-o">(</span><span class="tok-s">&quot;id&quot;</span><span class="tok-o">)</span><span class="tok-kt">int</span> <span class="tok-n">id</span><span class="tok-o">)</span> <span class="tok-o">{</span> <span class="tok-o">.</span> <span class="tok-o">.</span> <span class="tok-o">.</span> <span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Si un cliente realiza una peticiÃ³n y no manifiesta ninguna preferencia por ninguna
representaciÃ³n en particular, o con una cabecera <strong>Accept</strong> con valor <em>application/*</em>,
entonces el servidor seleccionarÃ¡ la representaciÃ³n con el valor de <em>qs</em> mÃ¡s alto
(en este caso <em>application/json</em>). Los valores de <em>qs</em> son relativos, y como tales,
solamente son comparables con otros valores <em>qs</em> dentro de la misma instancia de
la anotaciÃ³n @Consumes (o @Produces).</p>
</div>
<div class="paragraph">
<p>Los clientes pueden indicar tambiÃ©n sus preferencias utilizando otro factor relativo
de calidad, en forma de parÃ¡metro denominado <strong>q</strong>. El valor del parÃ¡metro <strong>q</strong> se
utiliza para ordenar el conjunto de tipos aceptados. <strong>q</strong> toma
valores entre 0.000 y 1.000 (mÃ¡xima preferencia). Al igual que antes, Los valores de
<em>q</em> son relativos, y como tales,
solamente son comparables con otros valores <em>q</em> dentro de la misma cabecera <em>Accept</em>
o <em>Content-type</em>.</p>
</div>
<div class="admonitionblock caution">
<table>
<tr>
<td class="icon">
<i class="fa icon-caution" title="Caution"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Las preferencias del servidor (valores de los parÃ¡metros <strong>qs</strong>) sÃ³lo se tienen en
cuenta si el cliente acepta mÃºltiples <em>media types</em> con el <strong>mismo valor de q</strong></p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Veamos un ejemplo:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span class="tok-nd">@GET</span>
<span class="tok-nd">@Path</span><span class="tok-o">(</span><span class="tok-s">&quot;{id}&quot;</span><span class="tok-o">)</span>
<span class="tok-nd">@Produces</span><span class="tok-o">({</span><span class="tok-s">&quot;application/xml&quot;</span><span class="tok-o">;</span> <span class="tok-n">qs</span><span class="tok-o">=</span><span class="tok-mi">1</span><span class="tok-o">,</span>
           <span class="tok-s">&quot;application/json&quot;</span><span class="tok-o">;</span> <span class="tok-n">qs</span><span class="tok-o">=</span><span class="tok-mf">0.75</span><span class="tok-o">})</span>
<span class="tok-kd">public</span> <span class="tok-n">Pedido</span> <span class="tok-nf">getPedido</span><span class="tok-o">(</span><span class="tok-nd">@PathParam</span><span class="tok-o">(</span><span class="tok-s">&quot;id&quot;</span><span class="tok-o">)</span><span class="tok-kt">int</span> <span class="tok-n">id</span><span class="tok-o">)</span> <span class="tok-o">{</span> <span class="tok-o">.</span> <span class="tok-o">.</span> <span class="tok-o">.</span> <span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Supongamos que un cliente lanza una petciÃ³n GET con una valor para la cabecera
<strong>Accept</strong> de <em>application/*; q=0.5, text/html</em>. En este caso, el servidor determina
que los tipos MIME <em>application/xml</em> y <em>application/json</em> tienen la misma preferencia
por parte del cliente (con valor de 0.5), por lo tanto, el servidor elegirÃ¡ la
representaciÃ³n <em>application/json</em>, ya que tiene un valor de <em>qs</em> mayor.</p>
</div>
</div>
<div class="sect2">
<h3 id="_introducciÃ³n_a_jaxb">3.4. IntroducciÃ³n a JAXB</h3>
<div class="paragraph">
<p>JAXB (<strong>J</strong>ava <strong>A</strong>rchitecture for <strong>X</strong>ML <strong>B</strong>inding) es una especificaciÃ³n Java antigua
(<a href="https://jcp.org/aboutJava/communityprocess/mrel/jsr222/index2.html">JSR 222</a>)
y no estÃ¡ definida por JAX-RS. JAXB es un <em>framework</em> de anotaciones que mapea clases
Java a XML y esquemas XML. Es extremadamente Ãºtil debido a que, en lugar de interactuar
con una representaciÃ³n abstracta de un documento XML, podemos trabajar con objetos
Java reales que estÃ¡n mÃ¡s cercanos al dominio que estamos modelando. JAX-RS proporciona
soporte para JAXB, pero antes de revisar los manejadores de contenidos JAXB incuidos
con JAX-RS, veamos una pequeÃ±a introducciÃ³n al <em>framework</em> JAXB.</p>
</div>
<div class="paragraph">
<p>Como ya hemos dicho, si queremos mapear una clase Java existente a XML, podemos utilizar
JAXB, a travÃ©s de un conjunto de anotaciones. VeÃ¡moslo mejor con un ejemplo:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span class="tok-nd">@XmlRootElement</span><span class="tok-o">(</span><span class="tok-n">name</span><span class="tok-o">=</span><span class="tok-s">&quot;cliente&quot;</span><span class="tok-o">)</span>
<span class="tok-nd">@XmlAccessorType</span><span class="tok-o">(</span><span class="tok-n">XmlAccessType</span><span class="tok-o">.</span><span class="tok-na">FIELD</span><span class="tok-o">)</span>
<span class="tok-kd">public</span> <span class="tok-kd">class</span> <span class="tok-nc">Cliente</span> <span class="tok-o">{</span>
    <span class="tok-nd">@XmlAttribute</span>
    <span class="tok-kd">protected</span> <span class="tok-kt">int</span> <span class="tok-n">id</span><span class="tok-o">;</span>

    <span class="tok-nd">@XmlElement</span>
    <span class="tok-kd">protected</span> <span class="tok-n">String</span> <span class="tok-n">nombre</span><span class="tok-o">;</span>

    <span class="tok-kd">public</span> <span class="tok-nf">Customer</span><span class="tok-o">()</span> <span class="tok-o">{}</span>

    <span class="tok-kd">public</span> <span class="tok-kt">int</span> <span class="tok-nf">getId</span><span class="tok-o">()</span> <span class="tok-o">{</span> <span class="tok-k">return</span> <span class="tok-k">this</span><span class="tok-o">.</span><span class="tok-na">id</span><span class="tok-o">;</span> <span class="tok-o">}</span>
    <span class="tok-kd">public</span> <span class="tok-kt">void</span> <span class="tok-nf">setId</span><span class="tok-o">(</span><span class="tok-kt">int</span> <span class="tok-n">id</span><span class="tok-o">)</span> <span class="tok-o">{</span> <span class="tok-k">this</span><span class="tok-o">.</span><span class="tok-na">id</span> <span class="tok-o">=</span> <span class="tok-n">id</span><span class="tok-o">;</span> <span class="tok-o">}</span>

    <span class="tok-kd">public</span> <span class="tok-n">String</span> <span class="tok-nf">getNombre</span><span class="tok-o">()</span> <span class="tok-o">{</span> <span class="tok-k">return</span> <span class="tok-k">this</span><span class="tok-o">.</span><span class="tok-na">nombre</span><span class="tok-o">;</span> <span class="tok-o">}</span>
    <span class="tok-kd">public</span> <span class="tok-kt">void</span> <span class="tok-nf">setNombre</span><span class="tok-o">(</span><span class="tok-n">String</span> <span class="tok-n">nombre</span><span class="tok-o">}</span> <span class="tok-o">{</span> <span class="tok-k">this</span><span class="tok-o">.</span><span class="tok-na">nombre</span> <span class="tok-o">=</span> <span class="tok-n">nombre</span><span class="tok-o">;</span> <span class="tok-o">}</span>
<span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>La anotaciÃ³n <code>@javax.xml.bind.annotation.XmlRootElement</code> se utiliza en clases java
para denotar que representan elementos XML (etiqueta XML raÃ­z). En este caso estamos
diciendo que la clase Java representa un documento XML que tiene como etiqueta raÃ­z
<code>&lt;cliente&gt;</code>. Las clases java anotadas con <code>@XmlRootElement</code> se denomina
<code>beans JAXB</code>.</p>
</div>
<div class="paragraph">
<p>La anotaciÃ³n <code>@javax.xml.bind.annotation.XmlAttribute</code> la hemos asociado al campo
<code>id</code> de nuestra clase <code>Cliente</code>. Esta anotaciÃ³n indica que el campo <code>id</code> de la clase debe
mapearse como el atributo <code>id</code> del elemento raÃ­z <code>&lt;cliente&gt;</code> del documento XML.
La anotaciÃ³n <code>@XmlAttribute</code> tiene un atributo <code>name</code>, de forma que podemos especificar
el nombre exacto del atributo XML dentro del documento. Por defecto, tiene el mismo
nombre que el campo anotado.</p>
</div>
<div class="paragraph">
<p>Hemos utilizado la anotaciÃ³n <code>@javax.xml.bind.annotation.XmlElement</code> en el campo
<code>nombre</code> de la clase <code>Cliente</code>. Esta anotaciÃ³n indica a JAXB que debe mapearse el
campo <code>nombre</code> como el elemento <code>&lt;nombre&gt;</code> anidado en la etiqueta raÃ­z <code>&lt;cliente&gt;</code>.
Igual que antes, podemos especificar el nombre concreto del elememto XML. Por defecto
toma el mismo nombre que el correspondiente campo anotado.</p>
</div>
<div class="paragraph">
<p>La anotaciÃ³n <code>@javax.xml.bind.annotation.XmlAccessorType</code> permite controlar la
serializaciÃ³n por defecto de los atributos de la clase. Esta anotaciÃ³n sÃ³lo puede
ser usada conjuntamente con <code>@XmlRootElement</code> (y alguna otra anotaciÃ³n que no mostramos
aquÃ­). Hemos usado como valor <code>XmlAccessType.FIELD</code>, lo que significa que
por defecto se deben serializar <strong>todos</strong> los <strong>campos</strong> (<em>fields</em>) de la clase (estÃ©n anotados o no), y
las <strong>propiedades</strong> (<em>properties</em>) de la clase que tengan anotaciones JAXB (a menos que la anotaciÃ³n sea
<em>@XMLTransient</em>).</p>
</div>
<div class="paragraph">
<p>Si alguno de los <strong>campos</strong> de la clase no tiene anotaciones JAXB asociadas, por defecto
se serializarÃ¡n como <em>elementos</em> (<em>etiquetas</em>) en el documento XML correspondiente.
SegÃºn la <a href="https://jaxb.java.net/nonav/2.2.6/docs/api/">documentaciÃ³n</a> de JAXB,
un <em>campo</em> es una variable de instancia no estÃ¡tica (normalmente privada).</p>
</div>
<div class="paragraph">
<p>Las <strong>propiedades</strong> de la clase vienen dadas por las combinaciones getter/setter de
los atributos de la clase.
El cÃ³digo anterior tiene dos propiedades "nombre" (dado por el par <em>getNombre</em>/setNombre_)
e "id" (par <em>getId</em>/<em>setId</em>). Normalmente se anotan los mÃ©todos <em>getter</em>. Dichas
propiedades no estÃ¡n anotadas, por lo que JAXB no las serializarÃ¡.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Al proceso de serializar (convertir) un objeto Java en un documento XML se le
  denomina <strong>marshalling</strong>. El proceso inverso, la conversiÃ³n de XML a objetos Java
  se denomina <strong>unmarshalling</strong>.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Con las anotaciones anteriores, un ejemplo de una instancia de nuestra clase <code>Cliente</code>
con un <code>id</code> de 42, y el valor de <code>nombre</code> <code>Pablo Martinez</code>, tendrÃ­a el siguiente
aspecto:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><span class="tok-nt">&lt;cliente</span> <span class="tok-na">id=</span><span class="tok-s">&quot;42&quot;</span><span class="tok-nt">&gt;</span>
     <span class="tok-nt">&lt;nombreCompleto&gt;</span>Pablo Martinez<span class="tok-nt">&lt;/nombreCompleto&gt;</span>
<span class="tok-nt">&lt;/cliente&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Observamos que se han serializado los campos (variables de instancia de la clase).</p>
</div>
<div class="paragraph">
<p>Si no especificamos la anotaciÃ³n <code>@XmlAccessorType</code>, por defecto se utilizarÃ¡:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>@XmlAccessorType(XmlAccessType.PUBLIC_MEMBER)</pre>
</div>
</div>
<div class="paragraph">
<p>El valor <code>XmlAccessType.PUBLIC_MEMBER</code> indica a JAXB que se deben serializar todos
los campos pÃºblicos de la clase, todos los campos anotados, y todas las propiedades
(pares <em>getter/setter</em>), a menos que estÃ©n anotadas con <em>@XMLTransient</em>.</p>
</div>
<div class="paragraph">
<p>TambiÃ©n podrÃ­amos utilizar:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>@XmlAccessorType(XmlAccessType.NONE)</pre>
</div>
</div>
<div class="paragraph">
<p>En este caso, la anotaciÃ³n <code>XmlAccessType.NONE</code> indica sÃ³lo se deben serializar aquellas
propiedades y/o campos de la clase que estÃ©n anotados.</p>
</div>
<div class="paragraph">
<p>A continuaciÃ³n indicamos, en forma de tabla, el uso de los diferentes <code>XmlAccessType</code>:</p>
</div>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 4. Valores utilizados para <code>@XmlAccessorType()</code>, conjuntamente con <code>@XmlRootElement()</code>:</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Valor</th>
<th class="tableblock halign-left valign-top">Significado</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">XmlAccessType.PUBLIC_MEMBER</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">SerializaciÃ³n por defecto si no se especifica <code>@XmlAccessorType()</code>. Serializa las
propiedades (pares <em>getter/setter</em>) y campos pÃºblicos, a menos que estÃ©n anotados
con <code>@XMLTransient</code>. Si algÃºn campo no pÃºblico estÃ¡ anotado, tambiÃ©n se serializa.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">XmlAccessType.FIELD</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Serializa todos los campos (pÃºblicos o privados) a menos que estÃ©n anotados con <code>@XMLTransient</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">XmlAccessType.NONE</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Solamente serializa aquellos campos y propiedades que estÃ©n anotadas con anotaciones
JAXB</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">XmlAccessType.PROPERTY</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Serializa cada par <em>getter/setter</em>, a menos que estÃ©n anotados con <code>@XMLTransient</code>.
Si algÃºn
campo (no pÃºblico) estÃ¡ anotado tambiÃ©n se serializa</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Podemos utilizar la anotaciÃ³n <code>@XmlElement</code> para anidar otras clases anotadas con JAXB.
Por ejemplo, supongamos que queremos aÃ±adir una clase <code>Direccion</code> a nuestra clase <code>Cliente</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span class="tok-nd">@XmlRootElement</span><span class="tok-o">(</span><span class="tok-n">name</span><span class="tok-o">=</span><span class="tok-s">&quot;direccion&quot;</span><span class="tok-o">)</span>
<span class="tok-nd">@XmlAccessorType</span><span class="tok-o">(</span><span class="tok-n">XmlAccessType</span><span class="tok-o">.</span><span class="tok-na">FIELD</span><span class="tok-o">)</span>
<span class="tok-kd">public</span> <span class="tok-kd">class</span> <span class="tok-nc">Direccion</span> <span class="tok-o">{</span>
  <span class="tok-nd">@XmlElement</span>
  <span class="tok-kd">protected</span> <span class="tok-n">String</span> <span class="tok-n">calle</span><span class="tok-o">;</span>

  <span class="tok-nd">@XmlElement</span>
  <span class="tok-kd">protected</span> <span class="tok-n">String</span> <span class="tok-n">cludad</span><span class="tok-o">;</span>

  <span class="tok-nd">@XmlElement</span>
  <span class="tok-kd">protected</span> <span class="tok-n">String</span> <span class="tok-n">codPostal</span><span class="tok-o">;</span>

  <span class="tok-c1">// getters y setters</span>
  <span class="tok-o">...</span>
<span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Simplemente tendrÃ­amos que aÃ±adir el campo de tipo <code>Direccion</code> a nuestra clase Cliente,
 de la siguiente forma:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span class="tok-nd">@XmlRootElement</span><span class="tok-o">(</span><span class="tok-n">name</span><span class="tok-o">=</span><span class="tok-s">&quot;cliente&quot;</span><span class="tok-o">)</span>
<span class="tok-nd">@XmlAccessorType</span><span class="tok-o">(</span><span class="tok-n">XmlAccessType</span><span class="tok-o">.</span><span class="tok-na">FIELD</span><span class="tok-o">)</span>
<span class="tok-kd">public</span> <span class="tok-kd">class</span> <span class="tok-nc">Cliente</span> <span class="tok-o">{</span>
    <span class="tok-nd">@XmlAttribute</span>
    <span class="tok-kd">protected</span> <span class="tok-kt">int</span> <span class="tok-n">id</span><span class="tok-o">;</span>

    <span class="tok-nd">@XmlElement</span>
    <span class="tok-kd">protected</span> <span class="tok-n">String</span> <span class="tok-n">nombreCompleto</span><span class="tok-o">;</span>

    <span class="tok-nd">@XmlElement</span>
    <span class="tok-kd">protected</span> <span class="tok-n">Direccion</span> <span class="tok-n">direccion</span><span class="tok-o">;</span>

    <span class="tok-kd">public</span> <span class="tok-nf">Customer</span><span class="tok-o">()</span> <span class="tok-o">{}</span>

    <span class="tok-c1">// getters y setters</span>
    <span class="tok-o">...</span>
<span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>En este caso, una instancia de un <code>Cliente</code> con valores <code>id</code>=56, <code>nombre</code>="Ricardo Lopez",
<code>calle</code>="calle del oso, 35", <code>ciudad</code>="Alicante", y <code>cÃ³digo_postal</code>="01010", serÃ­a serializado
 como:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"> <span class="tok-nt">&lt;cliente</span> <span class="tok-na">id=</span><span class="tok-s">&quot;56&quot;</span><span class="tok-nt">&gt;</span>
    <span class="tok-nt">&lt;nombre&gt;</span>Ricardo Lopez<span class="tok-nt">&lt;/nombre&gt;</span>
    <span class="tok-nt">&lt;direccion&gt;</span>
       <span class="tok-nt">&lt;calle&gt;</span>calle del oso, 35<span class="tok-nt">&lt;/calle&gt;</span>
       <span class="tok-nt">&lt;ciudad&gt;</span>Alicante<span class="tok-nt">&lt;/ciudad&gt;</span>
       <span class="tok-nt">&lt;codPostal&gt;</span>01010<span class="tok-nt">&lt;/codPostal&gt;</span>
    <span class="tok-nt">&lt;/direccion&gt;</span>
 <span class="tok-nt">&lt;/cliente&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Veamos otro ejemplo. Supongamos que tenemos el recurso <code>EstadoResource</code>, con mÃ©todos
que responden a peticiones http GET y PUT:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span class="tok-nd">@Path</span><span class="tok-o">(</span><span class="tok-s">&quot;/estado&quot;</span><span class="tok-o">)</span>
<span class="tok-kd">public</span> <span class="tok-kd">class</span> <span class="tok-nc">EstadoResource</span> <span class="tok-o">{</span>

    <span class="tok-kd">private</span> <span class="tok-kd">static</span> <span class="tok-n">EstadoBean</span> <span class="tok-n">estadoBean</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-nf">EstadoBean</span><span class="tok-o">();</span>

    <span class="tok-nd">@GET</span>
    <span class="tok-nd">@Produces</span><span class="tok-o">(</span><span class="tok-s">&quot;application/xml&quot;</span><span class="tok-o">)</span>
    <span class="tok-kd">public</span> <span class="tok-n">EstadoBean</span> <span class="tok-nf">getEstado</span><span class="tok-o">()</span> <span class="tok-o">{</span>
        <span class="tok-k">return</span> <span class="tok-n">estadoBean</span><span class="tok-o">;</span>
    <span class="tok-o">}</span>

    <span class="tok-nd">@PUT</span>
    <span class="tok-nd">@Consumes</span><span class="tok-o">(</span><span class="tok-s">&quot;application/xml&quot;</span><span class="tok-o">)</span>
    <span class="tok-kd">public</span> <span class="tok-kt">void</span> <span class="tok-nf">setEstado</span><span class="tok-o">(</span><span class="tok-n">EstadoBean</span> <span class="tok-n">estado</span><span class="tok-o">)</span> <span class="tok-o">{</span>
       <span class="tok-k">this</span><span class="tok-o">.</span><span class="tok-na">estadoBean</span> <span class="tok-o">=</span> <span class="tok-n">estado</span><span class="tok-o">;</span>
    <span class="tok-o">}</span>
<span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>En este caso, la clase <code>EstadoBean</code> debe utilizar anotaciones JAXB para poder ser
convertida automÃ¡ticamente por el <em>runtime</em> de JAX-RS en un documento XML, y viceversa:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span class="tok-nd">@XmlRootElement</span><span class="tok-o">(</span><span class="tok-n">name</span> <span class="tok-o">=</span> <span class="tok-s">&quot;estadoImpresora&quot;</span><span class="tok-o">)</span>
<span class="tok-kd">public</span> <span class="tok-kd">class</span> <span class="tok-nc">EstadoBean</span> <span class="tok-o">{</span>

   <span class="tok-kd">public</span> <span class="tok-n">String</span> <span class="tok-n">estado</span> <span class="tok-o">=</span> <span class="tok-s">&quot;Idle&quot;</span><span class="tok-o">;</span>
   <span class="tok-kd">public</span> <span class="tok-kt">int</span> <span class="tok-n">tonerRestante</span> <span class="tok-o">=</span> <span class="tok-mi">25</span><span class="tok-o">;</span>
   <span class="tok-kd">public</span> <span class="tok-n">List</span><span class="tok-o">&lt;</span><span class="tok-n">TareaBean</span><span class="tok-o">&gt;</span> <span class="tok-n">tareas</span> <span class="tok-o">=</span>
             <span class="tok-k">new</span> <span class="tok-n">ArrayList</span><span class="tok-o">&lt;</span><span class="tok-n">TareaBean</span><span class="tok-o">&gt;();</span>
<span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Por defecto, la anotaciÃ³n <code>@XmlRootElement</code> realiza la serializaciÃ³n de la clase
<code>EstadoBean</code> en formato xml utilizando los campos pÃºblicos y propiedades definidas
en la clase (<code>estado</code>, <code>tonerRestante</code>, y <code>tareas</code>).
Vemos que el campo tareas, a su vez, es una colecciÃ³n de elementos de tipo <code>TareaBean</code>,
que tambiÃ©n necesitan ser serializados. A continuaciÃ³n mostramos la implementaciÃ³n de la clase
<code>TareaBean.java</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span class="tok-nd">@XmlRootElement</span><span class="tok-o">(</span><span class="tok-n">name</span> <span class="tok-o">=</span> <span class="tok-s">&quot;tarea&quot;</span><span class="tok-o">)</span>
<span class="tok-kd">public</span> <span class="tok-kd">class</span> <span class="tok-nc">TareaBean</span> <span class="tok-o">{</span>
   <span class="tok-kd">public</span> <span class="tok-n">String</span> <span class="tok-n">nombre</span><span class="tok-o">;</span>
   <span class="tok-kd">public</span> <span class="tok-n">String</span> <span class="tok-n">estado</span><span class="tok-o">;</span>
   <span class="tok-kd">public</span> <span class="tok-kt">int</span> <span class="tok-n">paginas</span><span class="tok-o">;</span>

   <span class="tok-kd">public</span> <span class="tok-nf">TareaBean</span><span class="tok-o">()</span> <span class="tok-o">{};</span> <i class="conum" data-value="1"></i><b>(1)</b>

   <span class="tok-kd">public</span> <span class="tok-nf">TareaBean</span><span class="tok-o">(</span><span class="tok-n">String</span> <span class="tok-n">nombre</span><span class="tok-o">,</span> <span class="tok-n">String</span> <span class="tok-n">estado</span><span class="tok-o">,</span>
                 <span class="tok-kt">int</span> <span class="tok-n">paginas</span><span class="tok-o">)</span> <span class="tok-o">{</span>
      <span class="tok-k">this</span><span class="tok-o">.</span><span class="tok-na">nombre</span> <span class="tok-o">=</span> <span class="tok-n">nombre</span><span class="tok-o">;</span>
      <span class="tok-k">this</span><span class="tok-o">.</span><span class="tok-na">estado</span> <span class="tok-o">=</span> <span class="tok-n">estado</span><span class="tok-o">;</span>
      <span class="tok-k">this</span><span class="tok-o">.</span><span class="tok-na">paginas</span> <span class="tok-o">=</span> <span class="tok-n">paginas</span><span class="tok-o">;</span>
   <span class="tok-o">}</span>
<span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Para serializar la clase, es necesario que la clase tenga un constructor sin parÃ¡metros</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Si accedemos al servicio anterior, nos devolverÃ¡ la informaciÃ³n sobre el estado de la siguiente forma
(resultado devuelto por el mÃ©todo <code>getEstado()</code>, anotado con @GET):</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><span class="tok-cp">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot; standalone=&quot;yes&quot;?&gt;</span>
<span class="tok-nt">&lt;estadoImpresora&gt;</span>
    <span class="tok-nt">&lt;estado&gt;</span>Idle<span class="tok-nt">&lt;/estado&gt;</span>
    <span class="tok-nt">&lt;tonerRestante&gt;</span>25<span class="tok-nt">&lt;/tonerRestante&gt;</span>
    <span class="tok-nt">&lt;tareas&gt;</span>
        <span class="tok-nt">&lt;nombre&gt;</span>texto.doc<span class="tok-nt">&lt;/nombre&gt;</span>
        <span class="tok-nt">&lt;estado&gt;</span>imprimiendo...<span class="tok-nt">&lt;/estado&gt;</span>
        <span class="tok-nt">&lt;paginas&gt;</span>13<span class="tok-nt">&lt;/paginas&gt;</span>
    <span class="tok-nt">&lt;/tareas&gt;</span>
    <span class="tok-nt">&lt;tareas&gt;</span>
        <span class="tok-nt">&lt;nombre&gt;</span>texto2.doc<span class="tok-nt">&lt;/nombre&gt;</span>
        <span class="tok-nt">&lt;estado&gt;</span>en espera...<span class="tok-nt">&lt;/estado&gt;</span>
        <span class="tok-nt">&lt;paginas&gt;</span>5<span class="tok-nt">&lt;/paginas&gt;</span>
    <span class="tok-nt">&lt;/tareas&gt;</span>
<span class="tok-nt">&lt;/estadoImpresora&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Podemos observar que se utiliza el elemento xml <em>&lt;tareas&gt;</em> para representar cada
una de las instancias de <em>TareaBean</em>, las cuales forman
parte de de la lista
del campo <em>tareas</em> de nuestra clase <em>EstadoBean</em>.</p>
</div>
<div class="paragraph">
<p>Vamos a usar las anotaciones <code>@XmlAttribute</code> y <code>@XmlElement</code> de la siguiente forma:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span class="tok-nd">@XmlRootElement</span><span class="tok-o">(</span><span class="tok-n">name</span><span class="tok-o">=</span><span class="tok-s">&quot;estadoImpresora&quot;</span><span class="tok-o">)</span>
<span class="tok-kd">public</span> <span class="tok-kd">class</span> <span class="tok-nc">EstadoBean</span> <span class="tok-o">{</span>
Â 
Â Â Â <span class="tok-nd">@XmlAttribute</span><span class="tok-o">(</span><span class="tok-n">name</span><span class="tok-o">=</span><span class="tok-s">&quot;valor&quot;</span><span class="tok-o">)</span>
Â Â Â <span class="tok-kd">public</span> <span class="tok-n">String</span> <span class="tok-n">estado</span> <span class="tok-o">=</span> <span class="tok-s">&quot;Idle&quot;</span><span class="tok-o">;</span>
Â Â Â Â 
Â Â Â <span class="tok-nd">@XmlAttribute</span><span class="tok-o">(</span><span class="tok-n">name</span><span class="tok-o">=</span><span class="tok-s">&quot;toner&quot;</span><span class="tok-o">)</span>
Â Â Â <span class="tok-kd">public</span> <span class="tok-kt">int</span> <span class="tok-n">tonerRestante</span> <span class="tok-o">=</span> <span class="tok-mi">25</span><span class="tok-o">;</span>
Â Â Â Â 
Â Â Â <span class="tok-nd">@XmlElement</span><span class="tok-o">(</span><span class="tok-n">name</span><span class="tok-o">=</span><span class="tok-s">&quot;tarea&quot;</span><span class="tok-o">)</span>
Â Â Â <span class="tok-kd">public</span> <span class="tok-n">List</span><span class="tok-o">&lt;</span><span class="tok-n">TareaBean</span><span class="tok-o">&gt;</span> <span class="tok-n">tareas</span> <span class="tok-o">=</span>
Â Â Â Â Â Â Â Â Â Â Â Â Â <span class="tok-k">new</span> <span class="tok-n">ArrayList</span><span class="tok-o">&lt;</span><span class="tok-n">TareaBean</span><span class="tok-o">&gt;();</span>
<span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>En este caso, el XML resultante quedarÃ­a de la siguiente forma:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><span class="tok-nt">&lt;estadoImpresora</span> <span class="tok-na">valor=</span><span class="tok-s">&quot;Idle&quot;</span> <span class="tok-na">toner=</span><span class="tok-s">&quot;25&quot;</span><span class="tok-nt">&gt;</span>
    <span class="tok-nt">&lt;tarea&gt;</span>
        <span class="tok-nt">&lt;nombre&gt;</span>texto.doc<span class="tok-nt">&lt;/nombre&gt;</span>
        <span class="tok-nt">&lt;estado&gt;</span>imprimiendo...<span class="tok-nt">&lt;/estado&gt;</span>
        <span class="tok-nt">&lt;paginas&gt;</span>13<span class="tok-nt">&lt;/paginas&gt;</span>
    <span class="tok-nt">&lt;/tarea&gt;</span>
    <span class="tok-nt">&lt;tarea&gt;</span>
        <span class="tok-nt">&lt;nombre&gt;</span>texto2.doc<span class="tok-nt">&lt;/nombre&gt;</span>
        <span class="tok-nt">&lt;estado&gt;</span>en espera...<span class="tok-nt">&lt;/estado&gt;</span>
        <span class="tok-nt">&lt;paginas&gt;</span>5<span class="tok-nt">&lt;/paginas&gt;</span>
    <span class="tok-nt">&lt;/tarea&gt;</span>
<span class="tok-nt">&lt;/estadoImpresora&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Si no se indica lo contrario, por defecto se convierten los campos a elementos del XML.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>En caso de que los campos no sean pÃºblicos, etiquetaremos los <em>getters</em> correspondiente
(propiedades de la clase).</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Hemos visto que para las listas el nombre que especificamos en <code>@XmlElement</code> se utiliza
para nombrar cada elemento de la lista. Si queremos que ademÃ¡s se incluya un elemento
que envuelva a toda la lista, podemos utilizar la etiqueta <code>@XmlElementWrapper</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span class="tok-nd">@XmlRootElement</span><span class="tok-o">(</span><span class="tok-n">name</span><span class="tok-o">=</span><span class="tok-s">&quot;estadoImpresora&quot;</span><span class="tok-o">)</span>
<span class="tok-kd">public</span> <span class="tok-kd">class</span> <span class="tok-nc">EstadoBean</span> <span class="tok-o">{</span>

   <span class="tok-nd">@XmlAttribute</span><span class="tok-o">(</span><span class="tok-n">name</span><span class="tok-o">=</span><span class="tok-s">&quot;valor&quot;</span><span class="tok-o">)</span>
   <span class="tok-kd">public</span> <span class="tok-n">String</span> <span class="tok-n">estado</span> <span class="tok-o">=</span> <span class="tok-s">&quot;Idle&quot;</span><span class="tok-o">;</span>

   <span class="tok-nd">@XmlAttribute</span><span class="tok-o">(</span><span class="tok-n">name</span><span class="tok-o">=</span><span class="tok-s">&quot;toner&quot;</span><span class="tok-o">)</span>
   <span class="tok-kd">public</span> <span class="tok-kt">int</span> <span class="tok-n">tonerRestante</span> <span class="tok-o">=</span> <span class="tok-mi">25</span><span class="tok-o">;</span>

   <span class="tok-nd">@XmlElementWrapper</span><span class="tok-o">(</span><span class="tok-n">name</span><span class="tok-o">=</span><span class="tok-s">&quot;tareas&quot;</span><span class="tok-o">)</span>
   <span class="tok-nd">@XmlElement</span><span class="tok-o">(</span><span class="tok-n">name</span><span class="tok-o">=</span><span class="tok-s">&quot;tarea&quot;</span><span class="tok-o">)</span>
   <span class="tok-kd">public</span> <span class="tok-n">List</span><span class="tok-o">&lt;</span><span class="tok-n">TareaBean</span><span class="tok-o">&gt;</span> <span class="tok-n">tareas</span> <span class="tok-o">=</span>
             <span class="tok-k">new</span> <span class="tok-n">ArrayList</span><span class="tok-o">&lt;</span><span class="tok-n">TareaBean</span><span class="tok-o">&gt;();</span>
<span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>En este caso tendremos un XML como el que se muestra a continuaciÃ³n:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><span class="tok-nt">&lt;estadoImpresora</span> <span class="tok-na">valor=</span><span class="tok-s">&quot;Idle&quot;</span> <span class="tok-na">toner=</span><span class="tok-s">&quot;25&quot;</span><span class="tok-nt">&gt;</span>
    <span class="tok-nt">&lt;tareas&gt;</span>
        <span class="tok-nt">&lt;tarea&gt;</span>
            <span class="tok-nt">&lt;nombre&gt;</span>texto.doc<span class="tok-nt">&lt;/nombre&gt;</span>
            <span class="tok-nt">&lt;estado&gt;</span>imprimiendo...<span class="tok-nt">&lt;/estado&gt;</span>
            <span class="tok-nt">&lt;paginas&gt;</span>13<span class="tok-nt">&lt;/paginas&gt;</span>
        <span class="tok-nt">&lt;/tarea&gt;</span>
        <span class="tok-nt">&lt;tarea&gt;</span>
            <span class="tok-nt">&lt;nombre&gt;</span>texto2.doc<span class="tok-nt">&lt;/nombre&gt;</span>
            <span class="tok-nt">&lt;estado&gt;</span>en espera...<span class="tok-nt">&lt;/estado&gt;</span>
            <span class="tok-nt">&lt;paginas&gt;</span>5<span class="tok-nt">&lt;/paginas&gt;</span>
        <span class="tok-nt">&lt;/tarea&gt;</span>
    <span class="tok-nt">&lt;/tareas&gt;</span>
<span class="tok-nt">&lt;/estadoImpresora&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Para etiquetar una lista tambiÃ©n podemos especificar distintos tipos de elemento segÃºn
el tipo de objeto contenido en la lista. Por ejemplo, supongamos que en el ejemplo anterior
la clase <code>TareaBean</code> fuese una clase abstracta que tiene dos posible subclases: <code>TareaSistemaBean</code>
y <code>TareaUsuarioBean</code>. PodrÃ­amos especificar una etiqueta distinta para cada elemento de la lista
segÃºn el tipo de objeto del que se trate con la etiqueta <code>@XmlElements</code>, de la siguiente forma:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span class="tok-nd">@XmlElementWrapper</span><span class="tok-o">(</span><span class="tok-n">name</span><span class="tok-o">=</span><span class="tok-s">&quot;tareas&quot;</span><span class="tok-o">)</span>
   <span class="tok-nd">@XmlElements</span><span class="tok-o">({</span>
       <span class="tok-nd">@XmlElement</span><span class="tok-o">(</span><span class="tok-n">name</span><span class="tok-o">=</span><span class="tok-s">&quot;usuario&quot;</span><span class="tok-o">,</span><span class="tok-n">type</span><span class="tok-o">=</span><span class="tok-n">TareaUsuarioBean</span><span class="tok-o">.</span><span class="tok-na">class</span><span class="tok-o">},</span>
       <span class="tok-nd">@XmlElement</span><span class="tok-o">(</span><span class="tok-n">name</span><span class="tok-o">=</span><span class="tok-s">&quot;sistema&quot;</span><span class="tok-o">,</span><span class="tok-n">type</span><span class="tok-o">=</span><span class="tok-n">TareaSistemaBean</span><span class="tok-o">.</span><span class="tok-na">class</span><span class="tok-o">}})</span>
   <span class="tok-kd">public</span> <span class="tok-n">List</span><span class="tok-o">&lt;</span><span class="tok-n">TareaBean</span><span class="tok-o">&gt;</span> <span class="tok-n">tareas</span> <span class="tok-o">=</span>
             <span class="tok-k">new</span> <span class="tok-n">ArrayList</span><span class="tok-o">&lt;</span><span class="tok-n">TareaBean</span><span class="tok-o">&gt;();</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>De esta forma podrÃ­amos tener un XML como el siguiente:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><span class="tok-nt">&lt;estadoImpresora</span> <span class="tok-na">valor=</span><span class="tok-s">&quot;Idle&quot;</span> <span class="tok-na">toner=</span><span class="tok-s">&quot;25&quot;</span><span class="tok-nt">&gt;</span>
    <span class="tok-nt">&lt;tareas&gt;</span>
        <span class="tok-nt">&lt;usuario&gt;</span>
            <span class="tok-nt">&lt;nombre&gt;</span>texto.doc<span class="tok-nt">&lt;/nombre&gt;</span>
            <span class="tok-nt">&lt;estado&gt;</span>imprimiendo...<span class="tok-nt">&lt;/estado&gt;</span>
            <span class="tok-nt">&lt;paginas&gt;</span>13<span class="tok-nt">&lt;/paginas&gt;</span>
        <span class="tok-nt">&lt;/usuario&gt;</span>
        <span class="tok-nt">&lt;sistema&gt;</span>
            <span class="tok-nt">&lt;nombre&gt;</span>texto2.doc<span class="tok-nt">&lt;/nombre&gt;</span>
            <span class="tok-nt">&lt;estado&gt;</span>en espera...<span class="tok-nt">&lt;/estado&gt;</span>
            <span class="tok-nt">&lt;paginas&gt;</span>5<span class="tok-nt">&lt;/paginas&gt;</span>
        <span class="tok-nt">&lt;/sistema&gt;</span>
    <span class="tok-nt">&lt;/tareas&gt;</span>
<span class="tok-nt">&lt;/estadoImpresora&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Hemos visto que por defecto se serializan todos los campos. Si queremos excluir alguno de
ellos de la serializaciÃ³n, podemos hacerlo anotÃ¡ndolo con <code>@XmlTransient</code>. Como alternativa,
podemos cambiar el comportamiento por defecto de la serializaciÃ³n de la clase etiquetÃ¡ndola con <code>@XmlAccessorType</code>.
Por ejemplo:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span class="tok-nd">@XmlAccessorType</span><span class="tok-o">(</span><span class="tok-n">NONE</span><span class="tok-o">)</span>
<span class="tok-nd">@XmlRootElement</span><span class="tok-o">(</span><span class="tok-n">name</span><span class="tok-o">=</span><span class="tok-s">&quot;estadoImpresora&quot;</span><span class="tok-o">)</span>
<span class="tok-kd">public</span> <span class="tok-kd">class</span> <span class="tok-nc">EstadoBean</span> <span class="tok-o">{</span>
    <span class="tok-o">...</span>
<span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>En este Ãºltimo caso, especificando como tipo <code>NONE</code>, no se serializarÃ¡ por defecto ningÃºn campo,
sÃ³lo aquellos que hayamos anotado explÃ­citamente con <code>@XmlElement</code> o <code>@XmlAttribute</code>.
Los campos y propiedades (<em>getters</em>) anotados con estas etiquetas se serializarÃ¡n siempre.
AdemÃ¡s de ellos, tambiÃ©n podrÃ­amos especificar que se serialicen por defecto todos los campos
pÃºblicos y los <em>getters</em> (<code>PUBLIC_MEMBER</code>), todos los <em>getters</em> (<code>PROPERTY</code>), o todos los campos,
ya sean pÃºblicos o privados (<code>FIELD</code>). Todos los que se serialicen por defecto, sin especificar
ninguna etiqueta, lo harÃ¡n como elemento.</p>
</div>
<div class="paragraph">
<p>Por Ãºltimo, si nos interesa que toda la representaciÃ³n del objeto venga dada Ãºnicamente
por el valor de uno de sus campos, podemos etiquetar dicho campo con <code>@XmlValue</code>.</p>
</div>
<div class="sect3">
<h4 id="_clase_jaxbcontext">3.4.1. Clase JAXBContext</h4>
<div class="paragraph">
<p>Para serializar clases Java a y desde XML, es necesario interactuar con la clase <code>javax.xml.bind.JAXBContext</code>.
Esta clase nos permite "inspeccionar" las clases Java para "comprender" la estructura de
nuestras clases anotadas. Dichas clases se utilizan como factorÃ­as para las interfaces
<code>javax.xml.bind.Marshaller</code>, y <code>javax.xml.bind.Unmarshaller</code>. Las instancias de
<em>Marshaller</em> se utilizan para crear documentos XML a partir de objetos Java. Las instancias de
<em>Unmarshaller</em> se utilizan para crear objetos Java a partir de documentos XML. A continuaciÃ³n
mostramos un ejemplo de uso de JAXB para convertir una instancia de la clase <code>Cliente</code>,
que hemos definido anteriormente, a formato XML, para posteriormente volver a crear
 el objeto de tipo <code>Cliente</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span class="tok-n">Cliente</span> <span class="tok-n">cliente</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-nf">Cliente</span><span class="tok-o">();</span>
<span class="tok-n">cliente</span><span class="tok-o">.</span><span class="tok-na">setId</span><span class="tok-o">(</span><span class="tok-mi">42</span><span class="tok-o">);</span>
<span class="tok-n">cliente</span><span class="tok-o">.</span><span class="tok-na">setNombre</span><span class="tok-o">(</span><span class="tok-s">&quot;Lucia Arg&quot;</span><span class="tok-o">);</span>  <i class="conum" data-value="1"></i><b>(1)</b>

<span class="tok-n">JAXBContext</span> <span class="tok-n">ctx</span> <span class="tok-o">=</span> <span class="tok-n">JAXBContext</span><span class="tok-o">.</span><span class="tok-na">newInstance</span><span class="tok-o">(</span><span class="tok-n">Cliente</span><span class="tok-o">.</span><span class="tok-na">class</span><span class="tok-o">);</span> <i class="conum" data-value="2"></i><b>(2)</b>
<span class="tok-n">StringWriter</span> <span class="tok-n">writer</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-nf">StringWriter</span><span class="tok-o">();</span>

<span class="tok-n">ctx</span><span class="tok-o">.</span><span class="tok-na">createMarshaller</span><span class="tok-o">().</span><span class="tok-na">marshal</span><span class="tok-o">(</span><span class="tok-n">cliente</span><span class="tok-o">,</span> <span class="tok-n">writer</span><span class="tok-o">);</span>
<span class="tok-n">String</span> <span class="tok-n">modString</span> <span class="tok-o">=</span> <span class="tok-n">writer</span><span class="tok-o">.</span><span class="tok-na">toString</span><span class="tok-o">();</span>   <i class="conum" data-value="3"></i><b>(3)</b>

<span class="tok-n">cliente</span> <span class="tok-o">=</span> <span class="tok-o">(</span><span class="tok-n">Cliente</span><span class="tok-o">)</span><span class="tok-n">ctx</span><span class="tok-o">.</span><span class="tok-na">createUnmarshaller</span><span class="tok-o">().</span>
                <span class="tok-n">unmarshal</span><span class="tok-o">(</span><span class="tok-k">new</span> <span class="tok-nf">StringReader</span><span class="tok-o">(</span><span class="tok-n">modString</span><span class="tok-o">));</span> <i class="conum" data-value="4"></i><b>(4)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Creamos e inicializamos una instancia de tipo <code>Cliente</code></td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Inicializamos <code>JAXBContext para que pueda "analizar" la clase `Cliente</code></td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Utilizamos una instancia de <em>Marshaller</em> para escribir el objeto <code>Cliente</code>
como un <code>String</code> de Java (<code>StringWriter</code> es un <em>stream</em> de caracteres que utilizaremos
para construir un <code>String</code>)</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Utilizamos una instancia de <em>Unmarshaller</em> para recrear el objeto <code>Cliente</code>
a partir del <code>String</code> que hemos obtenido en el paso anterior</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>La clase <code>JAXBContext</code> constituye un punto
en entrada al API JAXB para los clientes de nuestros servicios RESTful. Proporciona una
 abstracciÃ³n para gestionar el enlazado (<em>binding</em>) de informaciÃ³n XML/Java, necesaria
 para implementar las operaciones de <em>marshalling</em> y <em>unmarshalling</em></p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong><em>Unmarshalling</em></strong>: La clase <code>Unmarshaller</code> proporciona a la aplicaciÃ³n cliente la
capacidad para convertir datos XML en un "Ã¡rbol" de objetos Java.</p>
</li>
<li>
<p><strong><em>Marshalling</em></strong>: La clase <code>Marshaller</code> proporciona a la aplicaciÃ³n cliente la capacidad
para convertir un "Ã¡rbol" con contenidos Java, de nuevo en datos XML.</p>
</li>
</ul>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Una vez que hemos proporcionado una visiÃ³n general sobre cÃ³mo funciona JAXB, vamos a
ver cÃ³mo se integra con JAX-RS</p>
</div>
</div>
<div class="sect3">
<h4 id="_manejadores_jax_rs_para_jaxb">3.4.2. Manejadores JAX-RS para JAXB</h4>
<div class="paragraph">
<p>La especificaciÃ³n de JAX-RS indica que cualquier implementaciÃ³n debe soportar de
forma automÃ¡tica el proceso de <em>marshalling</em> y <em>unmarshalling</em> de clases anotadas
con <code>@XmlRootElement</code>. A continuaciÃ³n mostramos un ejemplo de la implementaciÃ³n
de un servicio que hace uso de dichos manejadores. Para ello utilizamos la clase
<em>Cliente</em> que hemos anotado previamente con @XmlRootElement y que hemos mostrado
en apartados anteriores:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span class="tok-nd">@Path</span><span class="tok-o">(</span><span class="tok-s">&quot;/clientes&quot;</span><span class="tok-o">)</span>
<span class="tok-kd">public</span> <span class="tok-kd">class</span> <span class="tok-nc">ClienteResource</span> <span class="tok-o">{</span>
  <span class="tok-nd">@GET</span>
  <span class="tok-nd">@Path</span><span class="tok-o">(</span><span class="tok-s">&quot;{id}&quot;</span><span class="tok-o">)</span>
  <span class="tok-nd">@Produces</span><span class="tok-o">(</span><span class="tok-s">&quot;application/xml&quot;</span><span class="tok-o">)</span>
  <span class="tok-kd">public</span> <span class="tok-n">Cliente</span> <span class="tok-nf">getCliente</span><span class="tok-o">(</span><span class="tok-nd">@PathParam</span><span class="tok-o">(</span><span class="tok-s">&quot;id&quot;</span><span class="tok-o">)</span> <span class="tok-kt">int</span> <span class="tok-n">id</span><span class="tok-o">)</span> <span class="tok-o">{</span>
     <span class="tok-n">Cliente</span> <span class="tok-n">cli</span> <span class="tok-o">=</span> <span class="tok-n">findCliente</span><span class="tok-o">(</span><span class="tok-n">id</span><span class="tok-o">);</span>
     <span class="tok-k">return</span> <span class="tok-n">cust</span><span class="tok-o">;</span>
  <span class="tok-o">}</span>

  <span class="tok-nd">@POST</span>
  <span class="tok-nd">@Consumes</span><span class="tok-o">(</span><span class="tok-s">&quot;application/xml&quot;</span><span class="tok-o">)</span>
  <span class="tok-kd">public</span> <span class="tok-kt">void</span> <span class="tok-nf">crearCliente</span><span class="tok-o">(</span><span class="tok-n">Cliente</span> <span class="tok-n">cli</span><span class="tok-o">)</span> <span class="tok-o">{</span>
  <span class="tok-o">...</span>
  <span class="tok-o">}</span>
<span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Como podemos ver, una vez que aplicamos las anotaciones JAXB a nuestras clases Java (
en este caso a la clase <code>Cliente</code>), es muy sencillo intercambiar documentos XML entre
el cliente y nuestro servicio web. Los manejadores JAXB incluidos en la implementaciÃ³n de
JAX-RS gestionarÃ¡n el <em>marshalling/unmarshalling</em> de cualquier clase con anotaciones
JAXB, para los valores de <code>Content-Type</code> <code>application/xml</code>, <code>text/xml</code>, o
<code>application/*+xml</code>. Por defecto, tambiÃ©n se encargan de la creaciÃ³n e inicializaciÃ³n
de instancias <code>JAXBContext</code>. Debido a que la creaciÃ³n de las instancias <code>JAXBContext</code>
puede ser "cara", la implementaciÃ³n de JAX-RS normalmente las "guarda" despuÃ©s de la
primera inicializaciÃ³n.</p>
</div>
</div>
<div class="sect3">
<h4 id="_jaxb_y_json">3.4.3. JAXB y JSON</h4>
<div class="paragraph">
<p>JAXB es lo suficientemente flexible como para soportar otros formatos ademÃ¡s de XML.
Aunque la especificaciÃ³n de JAX-RS no lo requiere, muchas implementaciones de JAX-RS
incluyen adaptadores de JAXB para soportar el formato JSON, ademÃ¡s de XML. JSON es un
formato basado en texto que puede ser interpretado directamente por Javascript. De hecho
es el formato de intercambio preferido por las aplicaciones Ajax.</p>
</div>
<div class="paragraph">
<p>JSON es un formato mucho mÃ¡s simple que XML. Los objetos estÃ¡n entre llaves, <code>{}</code>, y
contienen pares de <em>clave/valor</em> separados por comas. Los valores pueden ser cadenas de caracteres, booleanos
(<code>true</code> o <code>false</code>), valores numÃ©ricos, o <em>arrays</em> de los tipos anteriores.</p>
</div>
<div class="paragraph">
<p>Supongamos que tenemos la siguiente descripciÃ³n de un producto en formato XML:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><span class="tok-cp">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
<span class="tok-nt">&lt;producto&gt;</span>
   <span class="tok-nt">&lt;id&gt;</span>1<span class="tok-nt">&lt;/id&gt;</span>
   <span class="tok-nt">&lt;nombre&gt;</span>iPad<span class="tok-nt">&lt;/nombre&gt;</span>
   <span class="tok-nt">&lt;descripcion&gt;</span>Dispositivo mÃ³vil<span class="tok-nt">&lt;/descripcion&gt;</span>
   <span class="tok-nt">&lt;precio&gt;</span>500<span class="tok-nt">&lt;/precio&gt;</span>
<span class="tok-nt">&lt;/producto&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>La representaciÃ³n JSON equivalente serÃ­a:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="json"><span class="tok-p">{</span>
  <span class="tok-nt">&quot;id&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;1&quot;</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;nombre&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;iPad&quot;</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;descripcion&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;Dispositivo mÃ³vil&quot;</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;precio&quot;</span><span class="tok-p">:</span><span class="tok-mi">500</span>
<span class="tok-p">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>El formato JSON asociado, por ejemplo, al siguiente objeto <code>Cliente</code> :</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"> <span class="tok-nt">&lt;cliente</span> <span class="tok-na">id=</span><span class="tok-s">&quot;56&quot;</span><span class="tok-nt">&gt;</span>
    <span class="tok-nt">&lt;nombre&gt;</span>Ricardo Lopez<span class="tok-nt">&lt;/nombre&gt;</span>
    <span class="tok-nt">&lt;direccion&gt;</span>
       <span class="tok-nt">&lt;calle&gt;</span>calle del oso, 35<span class="tok-nt">&lt;/calle&gt;</span>
       <span class="tok-nt">&lt;ciudad&gt;</span>Alicante<span class="tok-nt">&lt;/ciudad&gt;</span>
       <span class="tok-nt">&lt;codPostal&gt;</span>01010<span class="tok-nt">&lt;/codPostal&gt;</span>
    <span class="tok-nt">&lt;/direccion&gt;</span>
 <span class="tok-nt">&lt;/cliente&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>quedarÃ­a como sigue:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="json"><span class="tok-p">{</span>
  <span class="tok-nt">&quot;nombre&quot;</span><span class="tok-p">:</span> <span class="tok-s2">&quot;Ricardo Lopez&quot;</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;direccion&quot;</span><span class="tok-p">:</span> <span class="tok-p">{</span> <span class="tok-nt">&quot;calle&quot;</span><span class="tok-p">:</span> <span class="tok-s2">&quot;calle del oso, 35&quot;</span><span class="tok-p">,</span>
                  <span class="tok-nt">&quot;ciudad&quot;</span><span class="tok-p">:</span> <span class="tok-s2">&quot;Alicante&quot;</span><span class="tok-p">,</span>
                  <span class="tok-nt">&quot;codPostal&quot;</span><span class="tok-p">:</span> <span class="tok-s2">&quot;01010&quot;</span>
                <span class="tok-p">}</span>
<span class="tok-p">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Como vemos en el ejemplo, el formato JSON consiste bÃ¡sicamente en objetos situados
entre llaves, los cuales estÃ¡n formados por pares clave/valor, separadas por comas.
Cada clave y valor estÃ¡ separado por ":".
Los <em>valores</em> pueden cadenas de caracteres, booleanos (<em>true</em> o <em>false</em>), valores
numÃ©ricos, o vectores de los tipos anteriores (los vectores estÃ¡n delimitados por
corchetes).</p>
</div>
<div class="paragraph">
<p>Podemos aÃ±adir el formato <code>application/json</code>, o bien <code>MediaType.APPLICATION_JSON</code> a la
anotaciÃ³n <code>@Produces</code> en nuestros mÃ©todos de recurso para generar respuestas en formato
JSON:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span class="tok-nd">@GET</span>
<span class="tok-nd">@Path</span><span class="tok-o">(</span><span class="tok-s">&quot;/get&quot;</span><span class="tok-o">)</span>
<span class="tok-nd">@Produces</span><span class="tok-o">({</span><span class="tok-s">&quot;application/xml&quot;</span><span class="tok-o">,</span><span class="tok-s">&quot;application/json&quot;</span><span class="tok-o">})</span>
<span class="tok-kd">public</span> <span class="tok-n">Producto</span> <span class="tok-nf">getProducto</span><span class="tok-o">()</span> <span class="tok-o">{</span> <span class="tok-o">...</span> <span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>En este ejemplo, se elegirÃ¡ el formato
JSON en la respuesta si el cliente realiza una peticiÃ³n GET que incluye en la cabecera:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code>Accept: application/json</code></pre>
</div>
</div>
<div class="paragraph">
<p>El tipo de respuesta es de tipo <code>Producto</code>. En este caso <code>Producto</code> debe ser un <em>bean JAXB</em>,
es decir, una clase anotada con <code>@XmlRootElement</code>.</p>
</div>
<div class="paragraph">
<p>Los mÃ©todos de recurso pueden aceptar tambiÃ©n datos JSON para clases con anotaciones JAXB:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span class="tok-nd">@POST</span>
<span class="tok-nd">@Path</span><span class="tok-o">(</span><span class="tok-s">&quot;/producto&quot;</span><span class="tok-o">)</span>
<span class="tok-nd">@Consumes</span><span class="tok-o">({</span><span class="tok-s">&quot;application/xml&quot;</span><span class="tok-o">,</span><span class="tok-s">&quot;application/json&quot;</span><span class="tok-o">})</span>
<span class="tok-kd">public</span> <span class="tok-n">Response</span> <span class="tok-nf">crearProducto</span><span class="tok-o">(</span><span class="tok-n">Producto</span> <span class="tok-n">prod</span><span class="tok-o">)</span> <span class="tok-o">{</span> <span class="tok-o">...</span> <span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>En este caso el cliente deberÃ­a incluir la siguiente cabecera cuando realice la peticiÃ³n
POST que incluya los datos JSON anteriores en el cuerpo del mensaje:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code>Content-Type: application/json</code></pre>
</div>
</div>
<div class="paragraph">
<p>Hablaremos con mÃ¡s detalle del formato JSON en una sesiÃ³n posterior.</p>
</div>
<div class="paragraph">
<p>Finalmente, y como resumen de lo anterior:</p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">JAXB</div>
<div class="paragraph">
<p>Para dar soporte al serializado y deserializado XML se utilizan beans JAXB.Por ejemplo las clases
anteriores <code>EstadoBean</code>, <code>TareaBean</code>, <code>Cliente</code> y <code>Producto</code> son ejemplos de beans JAXB.
La clase que se serializarÃ¡ como un recurso XML o JSON se tiene que anotar con <code>@XmlRootElement</code>.
Si en algÃºn elemento de un recurso se retorna un elemento de esa clase y se etiqueta con los
tipos <code>@Produces({MediaType.APPLICATION_XML,Mediatype.APPLICATION_JSON}</code>), Ã©ste se serializa
automÃ¡ticamente utilizando el tipo de representaciÃ³n aceptada por el cliente. Se puede consultar
<a href="http://www.vogella.de/articles/JAXB/article.html">el artÃ­culo de Lars Vogel</a> para mÃ¡s informaciÃ³n.</p>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_respuestas_del_servidor">3.5. Respuestas del servidor</h3>
<div class="paragraph">
<p>Vamos a explicar cuÃ¡l es el comportamiento por defecto de los mÃ©todos de
recursos JAX-RS, en particular veremos cuÃ¡les son los cÃ³digos de respuesta
HTTP por defecto teniendo en cuenta situaciones de Ã©xito, asÃ­ como de fallo.</p>
</div>
<div class="paragraph">
<p>Dado que, en ocasiones, vamos a tener que enviar cabeceras de
respuesta especÃ­ficas ante condiciones de error complejas, tambiÃ©n vamos
a explicar cÃ³mo podemos elaborar respuestas complejas utilizando el API
JAX-RS.</p>
</div>
<div class="sect3">
<h4 id="_cÃ³digos_de_respuesta_por_defecto">3.5.1. CÃ³digos de respuesta por defecto</h4>
<div class="paragraph">
<p>Los cÃ³digos de respuesta por defecto se corresponden con el comportamiento indicado
en la <a href="http://www.w3.org/Protocols/rfc2616/rfc2616-sec9.html">especificaciÃ³n</a> de la definiciÃ³n
  de los mÃ©todos HTTP 1.1. Vamos a examinar dichos cÃ³digos de respuesta con el siguiente
ejemplo de recurso JAX-RS:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span class="tok-nd">@Path</span><span class="tok-o">(</span><span class="tok-s">&quot;/clientes&quot;</span><span class="tok-o">)</span>
<span class="tok-kd">public</span> <span class="tok-kd">class</span> <span class="tok-nc">ClienteResource</span> <span class="tok-o">{</span>

  <span class="tok-nd">@Path</span><span class="tok-o">(</span><span class="tok-s">&quot;{id}&quot;</span><span class="tok-o">)</span>
  <span class="tok-nd">@GET</span>
  <span class="tok-nd">@Produces</span><span class="tok-o">(</span><span class="tok-s">&quot;application/xml&quot;</span><span class="tok-o">)</span>
  <span class="tok-kd">public</span> <span class="tok-n">Cliente</span> <span class="tok-nf">getCliente</span><span class="tok-o">(</span><span class="tok-nd">@PathParam</span><span class="tok-o">(</span><span class="tok-s">&quot;id&quot;</span><span class="tok-o">)</span> <span class="tok-kt">int</span> <span class="tok-n">id</span><span class="tok-o">)</span> <span class="tok-o">{...}</span>

  <span class="tok-nd">@POST</span>
  <span class="tok-nd">@Produces</span><span class="tok-o">(</span><span class="tok-s">&quot;application/xml&quot;</span><span class="tok-o">)</span>
  <span class="tok-nd">@Consumes</span><span class="tok-o">(</span><span class="tok-s">&quot;application/xml&quot;</span><span class="tok-o">)</span>
  <span class="tok-kd">public</span> <span class="tok-n">Cliente</span> <span class="tok-nf">crearCliente</span><span class="tok-o">(</span><span class="tok-n">Cliente</span> <span class="tok-n">nuevoCli</span><span class="tok-o">)</span> <span class="tok-o">{...}</span>

  <span class="tok-nd">@PUT</span>
  <span class="tok-nd">@Path</span><span class="tok-o">(</span><span class="tok-s">&quot;{id}&quot;</span><span class="tok-o">)</span>
  <span class="tok-nd">@Consumes</span><span class="tok-o">(</span><span class="tok-s">&quot;application/xml&quot;</span><span class="tok-o">)</span>
  <span class="tok-kd">public</span> <span class="tok-kt">void</span> <span class="tok-nf">updateCliente</span><span class="tok-o">(</span><span class="tok-nd">@PathParam</span><span class="tok-o">(</span><span class="tok-s">&quot;id&quot;</span><span class="tok-o">)</span> <span class="tok-kt">int</span> <span class="tok-n">id</span><span class="tok-o">,</span> <span class="tok-n">Cliente</span> <span class="tok-n">cli</span><span class="tok-o">)</span> <span class="tok-o">{...}</span>

  <span class="tok-nd">@Path</span><span class="tok-o">(</span><span class="tok-s">&quot;{id}&quot;</span><span class="tok-o">)</span>
  <span class="tok-nd">@DELETE</span>
  <span class="tok-kd">public</span> <span class="tok-kt">void</span> <span class="tok-nf">borrarCliente</span><span class="tok-o">(</span><span class="tok-nd">@PathParam</span><span class="tok-o">(</span><span class="tok-s">&quot;id&quot;</span><span class="tok-o">)</span> <span class="tok-kt">int</span> <span class="tok-n">id</span><span class="tok-o">)</span> <span class="tok-o">{...}</span>
<span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="sect4">
<h5 id="_respuestas_que_indican_Ã©xito">Respuestas que indican Ã©xito</h5>
<div class="paragraph">
<p>Los nÃºmeros de cÃ³digo de respuestas HTTP con Ã©xito se sitÃºan en el rango de 200
a 399:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Para los mÃ©todos <code>crearCliente()</code> y <code>getCliente()</code> se devolverÃ¡ una respuesta
HTTP con el cÃ³digo "200 OK", si el objeto <code>Cliente</code> que devuelven dichos mÃ©todos
<strong>no es <code>null</code></strong>.</p>
</li>
<li>
<p>Para los mÃ©todos <code>crearCliente()</code> y <code>getCliente()</code> se devolverÃ¡ una respuesta
HTTP con el cÃ³digo "204 No Content", si el objeto <code>Cliente</code> que devuelven dichos mÃ©todos
 es <code>null</code>. El cÃ³digo de respuesta 204 no indica una condiciÃ³n de error. Solamente
avisa al cliente de que todo ha ido bien, pero que el mensaje de respuesta no contiene
nada en el cuerpo de la misma. SegÃºn Ã©sto, si un mÃ©todo de un recurso devuelve <code>void</code>,
por defecto se devuelve el cÃ³digo de respuesta "204 No content". Este es el caso
para los mÃ©todos <code>updateCliente()</code>, y <code>borrarCliente()</code> de nuestro ejemplo.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>La especificaciÃ³n HTTP es bastante consistente para los mÃ©todos PUT, POST, GET y
DELETE. Si una respuesta exitosa HTTP contiene informaciÃ³n en el cuerpo del mensaje
de respuesta, entonces el cÃ³digo de respuesta es "200 OK". Si el cuerpo del mensaje
estÃ¡ vacÃ­o, entonces se debe devolver "204 No Content".</p>
</div>
</div>
<div class="sect4">
<h5 id="_respuestas_que_indican_una_situaciÃ³n_de_fallo">Respuestas que indican una situaciÃ³n de fallo</h5>
<div class="paragraph">
<p>Es habitual que las respuestas "fallidas" se programen de forma que se lance una
 excepciÃ³n. Lo veremos en un apartado posterior. AquÃ­ comentaremos algunas condiciones
 de error por defecto.</p>
</div>
<div class="paragraph">
<p>Los nÃºmeros de cÃ³digo de error de respuesta estÃ¡ndar en HTTP se sitÃºan en el rango
  entre 400 y 599. En nuestro ejemplo, si un cliente se equivoca tecleando la URI,
   y Ã©sta queda por ejemplo como <code><a href="http://.../cliente" class="bare">http://&#8230;&#8203;/cliente</a></code>, entonces el servidor no encontrarÃ¡ ningÃºn
   mÃ©todo del recurso que pueda servir dicha peticiÃ³n (la URI correcta serÃ­a <code><a href="http://.../clientes" class="bare">http://&#8230;&#8203;/clientes</a></code>).
   En este caso, se enviarÃ¡ como respuesta el cÃ³digo "404 Not Found".</p>
</div>
<div class="paragraph">
<p>Para los mÃ©todos <code>getCliente()</code> y <code>crearCliente()</code> de nuestro ejemplo, si el cliente
solicita una respuesta con el tipo MIME <code>text/html</code>, entonces la implementaciÃ³n de
JAX-RS devolverÃ¡ automÃ¡ticamente "406 Not Acceptable", con un mensaje de respuesta
con el cuerpo de dicho mensaje vacÃ­o. Esta respuesta indica que JAX-RS puede encontrar
una ruta de URI relativa, que coincide con la peticiÃ³n, pero no encuentra ningÃºn
mÃ©todo del recurso que devuelva la respuesta con ese tipo MIME.</p>
</div>
<div class="paragraph">
<p>Si el cliente invoca una peticiÃ³n HTTP sobre una URI vÃ¡lida, para la que no se puede
encontrar un mÃ©todo de recurso asociado, entonces el <em>runtime</em> de JAX-RS devolverÃ¡
el cÃ³digo "405 Method Not Allowed". AsÃ­, en nuestro ejemplo, si el cliente solicita
una operaciÃ³n PUT, GET, o DELETE sobre la URI <code>/clientes</code>, obtendrÃ¡ como respuesta
"405 Method Not Allowed", puesto que POST es el Ãºnico mÃ©todo HTTP que puede dar soporte
a dicha URI. La implementaciÃ³n de JAX-RS tambiÃ©n devolverÃ¡ una cabecera de respuesta
<code>Allow</code> con la lista de mÃ©todos HTTP que pueden dar soporte a dicha URI. Por lo tanto,
si nuestra aplicaciÃ³n cliente realiza la siguiente peticiÃ³n de entrada:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>GET /clientes</pre>
</div>
</div>
<div class="paragraph">
<p>el servidor devolverÃ¡ la siguiente respuesta:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="sh">HTTP/1.1 405, Method Not Allowed
Allow: POST</code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_elaboraciÃ³n_de_respuestas_con_la_clase_response">3.5.2. ElaboraciÃ³n de respuestas con la clase Response</h4>
<div class="paragraph">
<p>Como ya hemos visto, por ejemplo para peticiones GET, si todo va bien
se estarÃ¡ devolviendo un cÃ³digo de respuesta 200 (Ok), junto con el contenido especificado
en el tipo de datos utilizado en cada caso. Si devolvemos void, el cÃ³digo de respuesta
serÃ¡ 204 (No Content).</p>
</div>
<div class="paragraph">
<p>Sin embargo, en ocasiones, el servicio web que estamos diseÃ±ando no puede implementarse utilizando
el comportamiento por defecto de peticiÃ³n/respuesta inherente a JAX-RS. En estos casos
necesitaremos controlar de forma explÃ­cita la respuesta que se le envÃ­a al cliente
(cuerpo del mensaje de la respuesta HTTP). Por ejemplo, cuando creamos un nuevo recurso con POST
deberÃ­amos devolver 201 (Created). Para tener control sobre este cÃ³digo
nuestros recursos JAX-RS podrÃ¡n devolver instancias de <code>javax.ws.rs.core.Response</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span class="tok-nd">@GET</span>
<span class="tok-nd">@Produces</span><span class="tok-o">(</span><span class="tok-n">MediaType</span><span class="tok-o">.</span><span class="tok-na">APPLICATION_XML</span><span class="tok-o">)</span>
<span class="tok-kd">public</span> <span class="tok-n">Response</span> <span class="tok-nf">getClientes</span><span class="tok-o">()</span> <span class="tok-o">{</span>
  <span class="tok-n">ClientesBean</span> <span class="tok-n">clientes</span> <span class="tok-o">=</span> <span class="tok-n">obtenerClientes</span><span class="tok-o">();</span>
  <span class="tok-k">return</span> <span class="tok-n">Response</span><span class="tok-o">.</span><span class="tok-na">ok</span><span class="tok-o">(</span><span class="tok-n">clientes</span><span class="tok-o">).</span><span class="tok-na">build</span><span class="tok-o">();</span> <i class="conum" data-value="1"></i><b>(1)</b>
<span class="tok-o">}</span>

<span class="tok-nd">@POST</span>
<span class="tok-nd">@Consumes</span><span class="tok-o">(</span><span class="tok-n">MediaType</span><span class="tok-o">.</span><span class="tok-na">APPLICATION_XML</span><span class="tok-o">)</span>
<span class="tok-kd">public</span> <span class="tok-n">Response</span> <span class="tok-nf">addCliente</span><span class="tok-o">(</span><span class="tok-n">ClienteBean</span> <span class="tok-n">cliente</span><span class="tok-o">,</span>
                          <span class="tok-nd">@Context</span> <span class="tok-n">UriInfo</span> <span class="tok-n">uriInfo</span><span class="tok-o">)</span> <span class="tok-o">{</span>
  <span class="tok-n">String</span> <span class="tok-n">id</span> <span class="tok-o">=</span> <span class="tok-n">insertarCliente</span><span class="tok-o">(</span><span class="tok-n">cliente</span><span class="tok-o">);</span> <i class="conum" data-value="2"></i><b>(2)</b>
  <span class="tok-n">URI</span> <span class="tok-n">uri</span> <span class="tok-o">=</span> <span class="tok-n">uriInfo</span>
              <span class="tok-o">.</span><span class="tok-na">getAbsolutePathBuilder</span><span class="tok-o">()</span>
              <span class="tok-o">.</span><span class="tok-na">path</span><span class="tok-o">(</span><span class="tok-s">&quot;{id}&quot;</span><span class="tok-o">)</span>
              <span class="tok-o">.</span><span class="tok-na">build</span><span class="tok-o">(</span><span class="tok-n">id</span><span class="tok-o">);</span> <i class="conum" data-value="3"></i><b>(3)</b>
  <span class="tok-k">return</span> <span class="tok-n">Response</span><span class="tok-o">.</span><span class="tok-na">created</span><span class="tok-o">(</span><span class="tok-n">uri</span><span class="tok-o">).</span><span class="tok-na">build</span><span class="tok-o">();</span> <i class="conum" data-value="4"></i><b>(4)</b>
<span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Al crear una respuesta con Response, podemos especificar una entidad, que podrÃ¡ ser un
objeto de cualquiera de los tipos vistos anteriormente, y que representa los datos a
devolver como contenido. Por ejemplo, cuando indicamos <strong>ok(clientes)</strong>, estamos creando
una respuesta con cÃ³digo 200 (Ok) y con el contenido generado por nuestro bean JAXB
clientes. Esto serÃ¡ equivalente a haber devuelto directamente ClientesBean como respuesta,
pero con la ventaja de que en este caso podemos controlar el cÃ³digo de estado de la respuesta.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Insertamos una instancia de <code>ClienteBean</code> en la base de datos, y obtenemos
la clave asociada a dicho cliente.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>En la sesiÃ³n anterior hemos hablado de la interfaz <code>uriInfo</code>. Es una interfaz
inyectable que proporciona acceso a informaciÃ³n sobre la URI de la aplicaciÃ³n o la URI
de las peticiones recibidas. En este caso, estamos construyendo una nueva URI
formada por la ruta absoluta de la peticiÃ³n de entrada http POST, aÃ±adiÃ©ndole la plantilla "{id}"
y finalmente sustituyendo el parÃ¡metro de la plantilla por el valor <code>id</code>. Supongamos
que la peticiÃ³n POST contiene la uri <code><a href="http://localhost:8080/recursos/clientes" class="bare">http://localhost:8080/recursos/clientes</a></code>. Y que
el valor de <code>id</code> es 8. El valor de la variable <strong>uri</strong> serÃ¡, por tanto:
<code><a href="http://localhost:8080/recursos/clientes/8" class="bare">http://localhost:8080/recursos/clientes/8</a></code></td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Devolvemos la respuesta incluyendo la URI anterior en la cabecera HTTP `Location</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Veamos con mÃ¡s detalle la clase <code>Response</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span class="tok-kd">public</span> <span class="tok-kd">abstract</span> <span class="tok-kd">class</span> <span class="tok-nc">Response</span> <span class="tok-o">{</span>
  <span class="tok-kd">public</span> <span class="tok-kd">abstract</span> <span class="tok-n">Object</span> <span class="tok-nf">getEntity</span><span class="tok-o">();</span>  <i class="conum" data-value="1"></i><b>(1)</b>
  <span class="tok-kd">public</span> <span class="tok-kd">abstract</span> <span class="tok-kt">int</span> <span class="tok-nf">getStatus</span><span class="tok-o">();</span>  <i class="conum" data-value="2"></i><b>(2)</b>
  <span class="tok-kd">public</span> <span class="tok-kd">abstract</span> <span class="tok-n">MultivaluedMap</span><span class="tok-o">&lt;</span><span class="tok-n">String</span><span class="tok-o">,</span> <span class="tok-n">Object</span><span class="tok-o">&gt;</span> <span class="tok-nf">getMetadata</span><span class="tok-o">();</span>  <i class="conum" data-value="3"></i><b>(3)</b>
  <span class="tok-kd">public</span> <span class="tok-kd">abstract</span> <span class="tok-n">URI</span> <span class="tok-nf">getLocation</span><span class="tok-o">();</span>  <i class="conum" data-value="4"></i><b>(4)</b>
  <span class="tok-kd">public</span> <span class="tok-kd">abstract</span> <span class="tok-n">MediaType</span> <span class="tok-nf">getMediaType</span><span class="tok-o">();</span>  <i class="conum" data-value="5"></i><b>(5)</b>
  <span class="tok-kd">public</span> <span class="tok-kd">abstract</span> <span class="tok-kt">void</span> <span class="tok-nf">close</span><span class="tok-o">();</span> <i class="conum" data-value="6"></i><b>(6)</b>
   <span class="tok-o">...</span>
<span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>El mÃ©todo <code>getEntity()</code> devuelve el objeto Java correspondiente al cuerpo
del mensaje HTTP.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>El mÃ©todo <code>getStatus()</code> devuelve el cÃ³digo de respuesta HTTP.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>El mÃ©todo <code>getMetadata()</code> devuelve una instancia de tipo <code>MultivaluedMap</code> con las
cabeceras de la respuesta.</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>El mÃ©todo <code>getLocation()</code> devuelve la URI de la cabecera Location de la respuesta.</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>El mÃ©todo <code>getMediaType()</code> devuelve el <em>mediaType</em> del cuerpo de la respuesta</td>
</tr>
<tr>
<td><i class="conum" data-value="6"></i><b>6</b></td>
<td>El mÃ©todo <code>close()</code> cierra el <em>input stream</em> correspondiente a la entidad asociada
del cuerpo del mensaje (en el caso de que estÃ© disponible y "abierto"). TambiÃ©n libera
cualquier otro recurso asociado con la respuesta (como por ejemplo datos posiblemente
almacenados en un <em>buffer</em>)</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Estos mÃ©todos tÃ­picamente serÃ¡n invocados dese el cliente, tal y como veremos mÃ¡s adelante,
cuando expliquemos el API cliente.</p>
</div>
<div class="paragraph">
<p>Los objetos <code>Response</code> no pueden crearse directamente. Tienen que crearse a partir
 de instancias de <code>javax.ws.rs.core.Response.ResponseBuilder</code> devueltas por uno de
 los siguientes mÃ©todos estÃ¡ticos de <code>Response</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span class="tok-kd">public</span> <span class="tok-kd">abstract</span> <span class="tok-kd">class</span> <span class="tok-nc">Response</span> <span class="tok-o">{</span> <span class="tok-o">...</span>
  <span class="tok-kd">public</span> <span class="tok-kd">abstract</span> <span class="tok-kt">void</span> <span class="tok-nf">close</span><span class="tok-o">()</span> <span class="tok-o">{...}</span>
  <span class="tok-kd">public</span> <span class="tok-kd">static</span> <span class="tok-n">ResponseBuilder</span> <span class="tok-nf">status</span><span class="tok-o">(</span><span class="tok-n">Status</span> <span class="tok-n">status</span><span class="tok-o">)</span> <span class="tok-o">{...}</span>
  <span class="tok-kd">public</span> <span class="tok-kd">static</span> <span class="tok-n">ResponseBuilder</span> <span class="tok-nf">status</span><span class="tok-o">(</span><span class="tok-kt">int</span> <span class="tok-n">status</span><span class="tok-o">)</span> <span class="tok-o">{...}</span>
  <span class="tok-kd">public</span> <span class="tok-kd">static</span> <span class="tok-n">ResponseBuilder</span> <span class="tok-nf">ok</span><span class="tok-o">()</span> <span class="tok-o">{...}</span>
  <span class="tok-kd">public</span> <span class="tok-kd">static</span> <span class="tok-n">ResponseBuilder</span> <span class="tok-nf">ok</span><span class="tok-o">(</span><span class="tok-n">Object</span> <span class="tok-n">entity</span><span class="tok-o">)</span> <span class="tok-o">{...}</span>
  <span class="tok-kd">public</span> <span class="tok-kd">static</span> <span class="tok-n">ResponseBuilder</span> <span class="tok-nf">ok</span><span class="tok-o">(</span><span class="tok-n">Object</span> <span class="tok-n">entity</span><span class="tok-o">,</span> <span class="tok-n">MediaType</span> <span class="tok-n">type</span><span class="tok-o">)</span> <span class="tok-o">{...}</span>
  <span class="tok-kd">public</span> <span class="tok-kd">static</span> <span class="tok-n">ResponseBuilder</span> <span class="tok-nf">ok</span><span class="tok-o">(</span><span class="tok-n">Object</span> <span class="tok-n">entity</span><span class="tok-o">,</span> <span class="tok-n">String</span> <span class="tok-n">type</span><span class="tok-o">)</span> <span class="tok-o">{...}</span>
  <span class="tok-kd">public</span> <span class="tok-kd">static</span> <span class="tok-n">ResponseBuilder</span> <span class="tok-nf">ok</span><span class="tok-o">(</span><span class="tok-n">Object</span> <span class="tok-n">entity</span><span class="tok-o">,</span> <span class="tok-n">Variant</span> <span class="tok-n">var</span><span class="tok-o">)</span> <span class="tok-o">{...}</span>
  <span class="tok-kd">public</span> <span class="tok-kd">static</span> <span class="tok-n">ResponseBuilder</span> <span class="tok-nf">serverError</span><span class="tok-o">()</span> <span class="tok-o">{...}</span>
  <span class="tok-kd">public</span> <span class="tok-kd">static</span> <span class="tok-n">ResponseBuilder</span> <span class="tok-nf">created</span><span class="tok-o">(</span><span class="tok-n">URI</span> <span class="tok-n">location</span><span class="tok-o">)</span> <span class="tok-o">{...}</span>
  <span class="tok-kd">public</span> <span class="tok-kd">static</span> <span class="tok-n">ResponseBuilder</span> <span class="tok-nf">noContent</span><span class="tok-o">()</span> <span class="tok-o">{...}</span>
  <span class="tok-kd">public</span> <span class="tok-kd">static</span> <span class="tok-n">ResponseBuilder</span> <span class="tok-nf">notModified</span><span class="tok-o">()</span> <span class="tok-o">{...}</span>
  <span class="tok-kd">public</span> <span class="tok-kd">static</span> <span class="tok-n">ResponseBuilder</span> <span class="tok-nf">notModified</span><span class="tok-o">(</span><span class="tok-n">EntityTag</span> <span class="tok-n">tag</span><span class="tok-o">)</span> <span class="tok-o">{...}</span>
  <span class="tok-kd">public</span> <span class="tok-kd">static</span> <span class="tok-n">ResponseBuilder</span> <span class="tok-nf">notModified</span><span class="tok-o">(</span><span class="tok-n">String</span> <span class="tok-n">tag</span><span class="tok-o">)</span> <span class="tok-o">{...}</span>
  <span class="tok-kd">public</span> <span class="tok-kd">static</span> <span class="tok-n">ResponseBuilder</span> <span class="tok-nf">seeOther</span><span class="tok-o">(</span><span class="tok-n">URI</span> <span class="tok-n">location</span><span class="tok-o">)</span> <span class="tok-o">{...}</span>
  <span class="tok-kd">public</span> <span class="tok-kd">static</span> <span class="tok-n">ResponseBuilder</span> <span class="tok-nf">temporaryRedirect</span><span class="tok-o">(</span><span class="tok-n">URI</span> <span class="tok-n">location</span><span class="tok-o">)</span> <span class="tok-o">{...}</span>
  <span class="tok-kd">public</span> <span class="tok-kd">static</span> <span class="tok-n">ResponseBuilder</span> <span class="tok-nf">notAcceptable</span><span class="tok-o">(</span><span class="tok-n">List</span><span class="tok-o">&lt;</span><span class="tok-n">Variant</span><span class="tok-o">&gt;</span> <span class="tok-n">variants</span><span class="tok-o">)</span> <span class="tok-o">{...}</span>
  <span class="tok-kd">public</span> <span class="tok-kd">static</span> <span class="tok-n">ResponseBuilder</span> <span class="tok-nf">fromResponse</span><span class="tok-o">(</span><span class="tok-n">Response</span> <span class="tok-n">response</span><span class="tok-o">)</span> <span class="tok-o">{...}</span>
  <span class="tok-o">...</span>
<span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Veamos por ejemplo el mÃ©todo <code>ok()</code>:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>ResponseBuilder ok(Object entity, MediaType type) {...}</pre>
</div>
</div>
<div class="paragraph">
<p>Este mÃ©todo recibe como parÃ¡metros un objeto Java que queremos convertir en una respuesta
HTTP y el <code>Content-Type</code> de dicha respuesta. Como valor de retorno se obtiene una instancia de
tipo <code>ResponseBuilder</code> pre-inicializada con un cÃ³digo de estado de <code>200 OK</code>.</p>
</div>
<div class="paragraph">
<p>El mÃ©todo <code>created()</code> devuelve un <em>ResponseBuilder</em> para un recurso creado, y
asigna a la cabecera <code>Location</code> de la respuesta el valor de la URI proporionado
como parÃ¡metro.</p>
</div>
<div class="paragraph">
<p>La clase <code>ResponseBuilder</code> es una factorÃ­a utilizada para crear instancias individuales
de tipo <code>Response</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span class="tok-kd">public</span> <span class="tok-kd">static</span> <span class="tok-kd">abstract</span> <span class="tok-kd">class</span> <span class="tok-nc">ResponseBuilder</span> <span class="tok-o">{</span>
  <span class="tok-kd">public</span> <span class="tok-kd">abstract</span> <span class="tok-n">Response</span> <span class="tok-nf">build</span><span class="tok-o">();</span>
  <span class="tok-kd">public</span> <span class="tok-kd">abstract</span> <span class="tok-n">ResponseBuilder</span> <span class="tok-nf">clone</span><span class="tok-o">();</span>

  <span class="tok-kd">public</span> <span class="tok-kd">abstract</span> <span class="tok-n">ResponseBuilder</span> <span class="tok-nf">status</span><span class="tok-o">(</span><span class="tok-kt">int</span> <span class="tok-n">status</span><span class="tok-o">);</span>
  <span class="tok-kd">public</span> <span class="tok-n">ResponseBuilder</span> <span class="tok-nf">status</span><span class="tok-o">(</span><span class="tok-n">Status</span> <span class="tok-n">status</span><span class="tok-o">)</span> <span class="tok-o">{...}</span>

  <span class="tok-kd">public</span> <span class="tok-kd">abstract</span> <span class="tok-n">ResponseBuilder</span> <span class="tok-nf">entity</span><span class="tok-o">(</span><span class="tok-n">Object</span> <span class="tok-n">entity</span><span class="tok-o">);</span>
  <span class="tok-kd">public</span> <span class="tok-kd">abstract</span> <span class="tok-n">ResponseBuilder</span> <span class="tok-nf">type</span><span class="tok-o">(</span><span class="tok-n">MediaType</span> <span class="tok-n">type</span><span class="tok-o">);</span>
  <span class="tok-kd">public</span> <span class="tok-kd">abstract</span> <span class="tok-n">ResponseBuilder</span> <span class="tok-nf">type</span><span class="tok-o">(</span><span class="tok-n">String</span> <span class="tok-n">type</span><span class="tok-o">);</span>

  <span class="tok-kd">public</span> <span class="tok-kd">abstract</span> <span class="tok-n">ResponseBuilder</span> <span class="tok-nf">variant</span><span class="tok-o">(</span><span class="tok-n">Variant</span> <span class="tok-n">variant</span><span class="tok-o">);</span>
  <span class="tok-kd">public</span> <span class="tok-kd">abstract</span> <span class="tok-n">ResponseBuilder</span> <span class="tok-nf">variants</span><span class="tok-o">(</span><span class="tok-n">List</span><span class="tok-o">&lt;</span><span class="tok-n">Variant</span><span class="tok-o">&gt;</span> <span class="tok-n">variants</span><span class="tok-o">);</span>

  <span class="tok-kd">public</span> <span class="tok-kd">abstract</span> <span class="tok-n">ResponseBuilder</span> <span class="tok-nf">language</span><span class="tok-o">(</span><span class="tok-n">String</span> <span class="tok-n">language</span><span class="tok-o">);</span>
  <span class="tok-kd">public</span> <span class="tok-kd">abstract</span> <span class="tok-n">ResponseBuilder</span> <span class="tok-nf">language</span><span class="tok-o">(</span><span class="tok-n">Locale</span> <span class="tok-n">language</span><span class="tok-o">);</span>

  <span class="tok-kd">public</span> <span class="tok-kd">abstract</span> <span class="tok-n">ResponseBuilder</span> <span class="tok-nf">location</span><span class="tok-o">(</span><span class="tok-n">URI</span> <span class="tok-n">location</span><span class="tok-o">);</span>
  <span class="tok-kd">public</span> <span class="tok-kd">abstract</span> <span class="tok-n">Response</span><span class="tok-o">.</span><span class="tok-na">ResponseBuilder</span> <span class="tok-nf">header</span><span class="tok-o">(</span><span class="tok-n">String</span> <span class="tok-n">name</span><span class="tok-o">,</span> <span class="tok-n">Object</span> <span class="tok-n">value</span><span class="tok-o">)</span>
  <span class="tok-kd">public</span> <span class="tok-kd">abstract</span> <span class="tok-n">Response</span><span class="tok-o">.</span><span class="tok-na">ResponseBuilder</span> <span class="tok-nf">link</span><span class="tok-o">(</span><span class="tok-n">URI</span> <span class="tok-n">uri</span><span class="tok-o">,</span> <span class="tok-n">String</span> <span class="tok-n">rel</span><span class="tok-o">)</span>
  <span class="tok-kd">public</span> <span class="tok-kd">abstract</span> <span class="tok-n">Response</span><span class="tok-o">.</span><span class="tok-na">ResponseBuilder</span> <span class="tok-nf">link</span><span class="tok-o">(</span><span class="tok-n">String</span> <span class="tok-n">uri</span><span class="tok-o">,</span> <span class="tok-n">String</span> <span class="tok-n">rel</span><span class="tok-o">)</span>
  <span class="tok-o">...</span>
<span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Vamos a mostrar un ejemplo sobre cÃ³mo crear respuestas utilizando un objeto <code>Response</code>.
En este caso el mÃ©todo <code>getLibro()</code> devuelve un <code>String</code> que representa el libro en el que
estÃ¡ interesado nuestro cliente:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span class="tok-nd">@Path</span><span class="tok-o">(</span><span class="tok-s">&quot;/libro&quot;</span><span class="tok-o">)</span>
<span class="tok-kd">public</span> <span class="tok-kd">class</span> <span class="tok-nc">LibroServicio</span> <span class="tok-o">{</span>
  <span class="tok-nd">@GET</span>
  <span class="tok-nd">@Path</span><span class="tok-o">(</span><span class="tok-s">&quot;/restfuljava&quot;</span><span class="tok-o">)</span>
  <span class="tok-nd">@Produces</span><span class="tok-o">(</span><span class="tok-s">&quot;text/plain&quot;</span><span class="tok-o">)</span>
  <span class="tok-kd">public</span> <span class="tok-n">Response</span> <span class="tok-nf">getLibro</span><span class="tok-o">()</span> <span class="tok-o">{</span>
    <span class="tok-n">String</span> <span class="tok-n">libro</span> <span class="tok-o">=</span> <span class="tok-o">...;</span> <i class="conum" data-value="1"></i><b>(1)</b>
    <span class="tok-n">ResponseBuilder</span> <span class="tok-n">builder</span> <span class="tok-o">=</span> <span class="tok-n">Response</span><span class="tok-o">.</span><span class="tok-na">ok</span><span class="tok-o">(</span><span class="tok-n">libro</span><span class="tok-o">);</span> <i class="conum" data-value="2"></i><b>(2)</b>
    <span class="tok-n">builder</span><span class="tok-o">.</span><span class="tok-na">language</span><span class="tok-o">(</span><span class="tok-s">&quot;fr&quot;</span><span class="tok-o">).</span><span class="tok-na">header</span><span class="tok-o">(</span><span class="tok-s">&quot;Some-Header&quot;</span><span class="tok-o">,</span> <span class="tok-s">&quot;some value&quot;</span><span class="tok-o">);</span> <i class="conum" data-value="3"></i><b>(3)</b>
    <span class="tok-k">return</span> <span class="tok-n">builder</span><span class="tok-o">.</span><span class="tok-na">build</span><span class="tok-o">();</span> <i class="conum" data-value="4"></i><b>(4)</b>
  <span class="tok-o">}</span>
<span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Recuperamos los datos del libro solicitado. En este caso vamos a devolver
una cadena de caracteres que representa el libro en el que estamos interesados.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Inicializamos el cuerpo de la respuesta utilizando
el mÃ©todo <code>Response.ok()</code>. El cÃ³digo de estado de <code>ResponseBuilder</code> se inicializa
de forma automÃ¡tica con 200.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Usamos el mÃ©todo <code>ResponseBuilder.language()</code> para
asignar el valor de la cabecera <code>Content-Languaje</code> a <em>francÃ©s</em>. TambiÃ©n usamos el mÃ©todo
<code>ResponseBuilder.header()</code> para asignar un valor concreto a otra cabecera.</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Finalmente, creamos y devolvemos el objeto <code>Response</code> usando el mÃ©todo <code>ResponseBuilder.build()</code>.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Un detalle que es interesante destacar en este cÃ³digo es que <strong>no</strong> indicamos ningÃºn
 valor para el <code>Content-Type</code> de la respuesta. Debido a que ya hemos especificado esta
 informaciÃ³n en la anotaciÃ³n <code>@Produces</code> del mÃ©todo, el <em>runtime</em> de JAX-RS devolverÃ¡
 el valor adecuado del <em>media type</em> de la respuesta por nosotros.</p>
</div>
<div class="sect4">
<h5 id="_inclusiÃ³n_de_em_cookies_em_en_la_respuesta">InclusiÃ³n de <em>cookies</em> en la respuesta</h5>
<div class="paragraph">
<p>JAX-RS proporciona la clase <code>javax.ws.rs.core.NewCookie</code>, que utilizaremos para
crear nuevos valores de <em>cookies</em> y enviarlos en las respuestas.</p>
</div>
<div class="paragraph">
<p>Para poder incluir las <em>cookies</em> en nuestro objeto <code>Response</code>, primero crearemos las
instancias correspondientes de tipo <code>NewCookie</code> las pasaremos al mÃ©todo <code>ResponseBuilder.cookie()</code>.
Por ejemplo:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span class="tok-nd">@Path</span><span class="tok-o">(</span><span class="tok-s">&quot;/myservice&quot;</span><span class="tok-o">)</span>
<span class="tok-kd">public</span> <span class="tok-kd">class</span> <span class="tok-nc">MyService</span> <span class="tok-o">{</span>
  <span class="tok-nd">@GET</span>
  <span class="tok-kd">public</span> <span class="tok-n">Response</span> <span class="tok-nf">get</span><span class="tok-o">()</span> <span class="tok-o">{</span>
     <span class="tok-n">NewCookie</span> <span class="tok-n">cookie</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-nf">NewCookie</span><span class="tok-o">(</span><span class="tok-s">&quot;nombre&quot;</span><span class="tok-o">,</span> <span class="tok-s">&quot;pepe&quot;</span><span class="tok-o">);</span> <i class="conum" data-value="1"></i><b>(1)</b>
     <span class="tok-n">ResponseBuilder</span> <span class="tok-n">builder</span> <span class="tok-o">=</span> <span class="tok-n">Response</span><span class="tok-o">.</span><span class="tok-na">ok</span><span class="tok-o">(</span><span class="tok-s">&quot;hola&quot;</span><span class="tok-o">,</span> <span class="tok-s">&quot;text/plain&quot;</span><span class="tok-o">);</span> <i class="conum" data-value="2"></i><b>(2)</b>
     <span class="tok-k">return</span> <span class="tok-n">builder</span><span class="tok-o">.</span><span class="tok-na">cookie</span><span class="tok-o">(</span><span class="tok-n">cookie</span><span class="tok-o">).</span><span class="tok-na">build</span><span class="tok-o">();</span>
<span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Creamos una nueva <em>cookie</em> con el nombre de clave <code>nombre</code> y le asignamos el
valor <code>pepe</code></td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>En este caso, al no indicar el tipo mime de la respuesta con la anotaciÃ³n @Produces,
necesitamos indicarlo (en este caso como un parÃ¡metro del mÃ©todo <code>ok()</code>)</td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="_el_tipo_enumerado_de_cÃ³digos_de_estado">El tipo enumerado de cÃ³digos de estado</h5>
<div class="paragraph">
<p>JAX-RS proporciona el tipo enumerado <code>javax.ws.rs.core.Status</code> para representar cÃ³digos de respuesta
especÃ­ficos:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span class="tok-kd">public</span> <span class="tok-kd">enum</span> <span class="tok-n">Status</span> <span class="tok-o">{</span>
  <span class="tok-n">OK</span><span class="tok-o">(</span><span class="tok-mi">200</span><span class="tok-o">,</span> <span class="tok-s">&quot;OK&quot;</span><span class="tok-o">),</span>
  <span class="tok-n">CREATED</span><span class="tok-o">(</span><span class="tok-mi">201</span><span class="tok-o">,</span> <span class="tok-s">&quot;Created&quot;</span><span class="tok-o">),</span>
  <span class="tok-n">ACCEPTED</span><span class="tok-o">(</span><span class="tok-mi">202</span><span class="tok-o">,</span> <span class="tok-s">&quot;Accepted&quot;</span><span class="tok-o">),</span>
  <span class="tok-n">NO_CONTENT</span><span class="tok-o">(</span><span class="tok-mi">204</span><span class="tok-o">,</span> <span class="tok-s">&quot;No Content&quot;</span><span class="tok-o">),</span>
  <span class="tok-n">MOVED_PERMANENTLY</span><span class="tok-o">(</span><span class="tok-mi">301</span><span class="tok-o">,</span> <span class="tok-s">&quot;Moved Permanently&quot;</span><span class="tok-o">),</span>
  <span class="tok-n">SEE_OTHER</span><span class="tok-o">(</span><span class="tok-mi">303</span><span class="tok-o">,</span> <span class="tok-s">&quot;See Other&quot;</span><span class="tok-o">),</span>
  <span class="tok-n">NOT_MODIFIED</span><span class="tok-o">(</span><span class="tok-mi">304</span><span class="tok-o">,</span> <span class="tok-s">&quot;Not Modified&quot;</span><span class="tok-o">),</span>
  <span class="tok-n">TEMPORARY_REDIRECT</span><span class="tok-o">(</span><span class="tok-mi">307</span><span class="tok-o">,</span> <span class="tok-s">&quot;Temporary Redirect&quot;</span><span class="tok-o">),</span>
  <span class="tok-n">BAD_REQUEST</span><span class="tok-o">(</span><span class="tok-mi">400</span><span class="tok-o">,</span> <span class="tok-s">&quot;Bad Request&quot;</span><span class="tok-o">),</span>
  <span class="tok-n">UNAUTHORIZED</span><span class="tok-o">(</span><span class="tok-mi">401</span><span class="tok-o">,</span> <span class="tok-s">&quot;Unauthorized&quot;</span><span class="tok-o">),</span>
  <span class="tok-n">FORBIDDEN</span><span class="tok-o">(</span><span class="tok-mi">403</span><span class="tok-o">,</span> <span class="tok-s">&quot;Forbidden&quot;</span><span class="tok-o">),</span>
  <span class="tok-n">NOT_FOUND</span><span class="tok-o">(</span><span class="tok-mi">404</span><span class="tok-o">,</span> <span class="tok-s">&quot;Not Found&quot;</span><span class="tok-o">),</span>
  <span class="tok-n">NOT_ACCEPTABLE</span><span class="tok-o">(</span><span class="tok-mi">406</span><span class="tok-o">,</span> <span class="tok-s">&quot;Not Acceptable&quot;</span><span class="tok-o">),</span>
  <span class="tok-n">CONFLICT</span><span class="tok-o">(</span><span class="tok-mi">409</span><span class="tok-o">,</span> <span class="tok-s">&quot;Conflict&quot;</span><span class="tok-o">),</span>
  <span class="tok-n">GONE</span><span class="tok-o">(</span><span class="tok-mi">410</span><span class="tok-o">,</span> <span class="tok-s">&quot;Gone&quot;</span><span class="tok-o">),</span>
  <span class="tok-n">PRECONDITION_FAILED</span><span class="tok-o">(</span><span class="tok-mi">412</span><span class="tok-o">,</span> <span class="tok-s">&quot;Precondition Failed&quot;</span><span class="tok-o">),</span>
  <span class="tok-n">UNSUPPORTED_MEDIA_TYPE</span><span class="tok-o">(</span><span class="tok-mi">415</span><span class="tok-o">,</span> <span class="tok-s">&quot;Unsupported Media Type&quot;</span><span class="tok-o">),</span>
  <span class="tok-n">INTERNAL_SERVER_ERROR</span><span class="tok-o">(</span><span class="tok-mi">500</span><span class="tok-o">,</span> <span class="tok-s">&quot;Internal Server Error&quot;</span><span class="tok-o">),</span>
  <span class="tok-n">NOT_IMPLEMENTED</span><span class="tok-o">(</span><span class="tok-mi">501</span><span class="tok-o">,</span> <span class="tok-s">&quot;Not Implemented&quot;</span><span class="tok-o">),</span>
  <span class="tok-n">SERVICE_UNAVAILABLE</span><span class="tok-o">(</span><span class="tok-mi">503</span><span class="tok-o">,</span> <span class="tok-s">&quot;Service Unavailable&quot;</span><span class="tok-o">);</span>
  <span class="tok-kd">public</span> <span class="tok-kd">enum</span> <span class="tok-n">Family</span> <span class="tok-o">{</span>
     <span class="tok-n">INFORMATIONAL</span><span class="tok-o">,</span> <span class="tok-n">SUCCESSFUL</span><span class="tok-o">,</span> <span class="tok-n">REDIRECTION</span><span class="tok-o">,</span>
     <span class="tok-n">CLIENT_ERROR</span><span class="tok-o">,</span> <span class="tok-n">SERVER_ERROR</span><span class="tok-o">,</span> <span class="tok-n">OTHER</span>
  <span class="tok-o">}</span>

  <span class="tok-kd">public</span> <span class="tok-n">Family</span> <span class="tok-nf">getFamily</span><span class="tok-o">()</span>
  <span class="tok-kd">public</span> <span class="tok-kt">int</span> <span class="tok-nf">getStatusCode</span><span class="tok-o">()</span>
  <span class="tok-kd">public</span> <span class="tok-kd">static</span> <span class="tok-n">Status</span> <span class="tok-nf">fromStatusCode</span><span class="tok-o">(</span><span class="tok-kd">final</span> <span class="tok-kt">int</span> <span class="tok-n">statusCode</span><span class="tok-o">)</span>
<span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Cada valor del tipo <code>Status</code> se asocia con una familia especÃ­fica de cÃ³digos
de respuesta HTTP. Estas familias se identifican por el enumerado <code>Status.Family</code>:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Los cÃ³digos en el rango del <strong>100</strong> se consideran <strong>informacionales</strong></p>
</li>
<li>
<p>Los cÃ³digos en el rango del <strong>200</strong> se consideran <strong>exitosos</strong></p>
</li>
<li>
<p>Los cÃ³digos en el rango del <strong>300</strong> son cÃ³digos con Ã©xito pero dentro de la
categorÃ­a <strong>redirecciÃ³n</strong></p>
</li>
<li>
<p>Los cÃ³digos de error pertenecen a los ragos 400 y 500. En el rango de <strong>400</strong> se
consideran <strong>errores del cliente</strong> y en el rango de <strong>500</strong> son <strong>errores del servidor</strong></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Tanto el mÃ©todo <code>Response.status()</code> como <code>ResponseBuilder.status()</code> pueden aceptar
un valor enumerado de tipo <code>Status</code>. Por ejemplo:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span class="tok-nd">@DELETE</span>
<span class="tok-n">Response</span> <span class="tok-nf">delete</span><span class="tok-o">()</span> <span class="tok-o">{</span>
  <span class="tok-o">...</span>
  <span class="tok-k">return</span> <span class="tok-n">Response</span><span class="tok-o">.</span><span class="tok-na">status</span><span class="tok-o">(</span><span class="tok-n">Status</span><span class="tok-o">.</span><span class="tok-na">GONE</span><span class="tok-o">).</span><span class="tok-na">build</span><span class="tok-o">();</span>
<span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>En este caso, estamos indicando al cliente que lo que queremos borrar ya no existe (410).</p>
</div>
</div>
<div class="sect4">
<h5 id="_la_clase_javax_ws_rs_core_genericentity">La clase javax.ws.rs.core.GenericEntity</h5>
<div class="paragraph">
<p>Cuando estamos creando objetos de tipo <code>Response</code>, se nos plantea un problema cuando
queremos devolver tipos genÃ©ricos, ya que el manejador JAXB necesita extraer la
informaciÃ³n del tipo parametrizado de la respuesta en tiempo de ejecuciÃ³n. Para estos
casos, JAX-RS proporciona la clase <code>javax.ws.rs.core.GenericEntity</code>. Veamos su uso con
un ejemplo:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span class="tok-nd">@GET</span>
<span class="tok-nd">@Produces</span><span class="tok-o">(</span><span class="tok-s">&quot;application/xml&quot;</span><span class="tok-o">)</span>
<span class="tok-kd">public</span> <span class="tok-n">Response</span> <span class="tok-nf">getListaClientes</span><span class="tok-o">()</span> <span class="tok-o">{</span>
  <span class="tok-n">List</span><span class="tok-o">&lt;</span><span class="tok-n">Cliente</span><span class="tok-o">&gt;</span> <span class="tok-n">list</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">ArrayList</span><span class="tok-o">&lt;</span><span class="tok-n">Cliente</span><span class="tok-o">&gt;();</span>
  <span class="tok-n">list</span><span class="tok-o">.</span><span class="tok-na">add</span><span class="tok-o">(</span><span class="tok-k">new</span> <span class="tok-nf">Cliente</span><span class="tok-o">(...));</span>

  <span class="tok-n">GenericEntity</span> <span class="tok-n">entity</span> <span class="tok-o">=</span>
    <span class="tok-k">new</span> <span class="tok-n">GenericEntity</span><span class="tok-o">&lt;</span><span class="tok-n">List</span><span class="tok-o">&lt;</span><span class="tok-n">Cliente</span><span class="tok-o">&gt;&gt;(</span><span class="tok-n">list</span><span class="tok-o">){};</span> <i class="conum" data-value="1"></i><b>(1)</b>

  <span class="tok-k">return</span> <span class="tok-n">Response</span><span class="tok-o">.</span><span class="tok-na">ok</span><span class="tok-o">(</span><span class="tok-n">entity</span><span class="tok-o">).</span><span class="tok-na">build</span><span class="tok-o">();</span>
<span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>La clase <code>GenericEntity</code> es tambiÃ©n una clase genÃ©rica. Lo que hacemos es crear
una clase anÃ³nima que extiende <code>GenericEntity</code>, inicializando la "plantilla" de
<code>GenericEntity</code> con el tipo genÃ©rico que estemos utilizando.</td>
</tr>
</table>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_manejadores_de_excepciones">3.6. Manejadores de excepciones</h3>
<div class="paragraph">
<p>Vamos a explicar cÃ³mo podemos tratar las excepciones en nuestros servicios
RESTful.</p>
</div>
<div class="paragraph">
<p>Los errores pueden enviarse al cliente, bien creando y devolviendo el objeto
<code>Response</code> adecuado, o lanzando una excepciÃ³n. Podemos lanzar cualquier tipo de excepciÃ³n,
tanto las denominadas <em>checked</em> (clases que heredan de <code>java.lang.Exception</code>), como las
excepciones <em>unchecked</em> (clases que extienden <code>java.lang.RuntimeException</code>).
Las excepciones generadas son manejadas por el <em>runtime</em> de JAX-RS si tenemos registrado
un <em>mapper</em> de excepciones. Dichos <em>mappers</em> (o mapeadores) de excepciones pueden convertir
una excepciÃ³n en una respuesta HTTP. Si las excepciones no estÃ¡n gestionadas por un
<em>mapper</em>, Ã©stas se propagan y se gestionan por el contenedor (de <em>servlets</em>)
en el que se estÃ¡ ejecutando JAX-RS. JAX-RS proporciona tambiÃ©n la clase
<code>javax.ws.rs.WebApplicationException</code>. Esta excepciÃ³n puede lanzarse por el cÃ³digo
de nuestra aplicaciÃ³n y serÃ¡ procesado automÃ¡ticamente por JAX-RS sin necesidad de
disponer de forma explÃ­cita de ningÃºn <em>mapper</em>. Vamos a ver cÃ³mo utilizar esta clase.</p>
</div>
<div class="sect3">
<h4 id="_la_clase_javax_ws_rs_webapplicationexception">3.6.1. La clase javax.ws.rs.WebApplicationException</h4>
<div class="paragraph">
<p>JAX-RS incluye una excepciÃ³n <em>unchecked</em> que podemos lanzar desde nuestra aplicaciÃ³n
RESTful (ver la documentaciÃ³n del
<a href="http://docs.oracle.com/javaee/7/api/javax/ws/rs/WebApplicationException.html" class="bare">http://docs.oracle.com/javaee/7/api/javax/ws/rs/WebApplicationException.html</a> [API]).
Esta excepciÃ³n se puede pre-inicializar con un objeto <code>Response</code>, o con
un cÃ³digo de estado particular:</p>
</div>
<div class="listingblock">
<div class="title">Clase javax.ws.rs.WebApplicationException</div>
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span class="tok-kd">public</span> <span class="tok-kd">class</span> <span class="tok-nc">WebApplicationException</span> <span class="tok-kd">extends</span> <span class="tok-n">RuntimeException</span> <span class="tok-o">{</span>
  <span class="tok-c1">//Constructores</span>
  <span class="tok-kd">public</span> <span class="tok-nf">WebApplicationException</span><span class="tok-o">()</span> <span class="tok-o">{...}</span>
  <span class="tok-kd">public</span> <span class="tok-nf">WebApplicationException</span><span class="tok-o">(</span><span class="tok-n">Response</span> <span class="tok-n">response</span><span class="tok-o">)</span> <span class="tok-o">{...}</span> <i class="conum" data-value="1"></i><b>(1)</b>
  <span class="tok-kd">public</span> <span class="tok-nf">WebApplicationException</span><span class="tok-o">(</span><span class="tok-kt">int</span> <span class="tok-n">status</span><span class="tok-o">)</span> <span class="tok-o">{...}</span>
  <span class="tok-kd">public</span> <span class="tok-nf">WebApplicationException</span><span class="tok-o">(</span><span class="tok-n">Response</span><span class="tok-o">.</span><span class="tok-na">Status</span> <span class="tok-n">status</span><span class="tok-o">)</span> <span class="tok-o">{...}</span> <i class="conum" data-value="2"></i><b>(2)</b>
  <span class="tok-kd">public</span> <span class="tok-nf">WebApplicationException</span><span class="tok-o">(</span><span class="tok-n">String</span> <span class="tok-n">message</span><span class="tok-o">)</span> <i class="conum" data-value="3"></i><b>(3)</b>
  <span class="tok-kd">public</span> <span class="tok-nf">WebApplicationException</span><span class="tok-o">(</span><span class="tok-n">Throwable</span> <span class="tok-n">cause</span><span class="tok-o">)</span> <span class="tok-o">{...}</span>
  <span class="tok-kd">public</span> <span class="tok-nf">WebApplicationException</span><span class="tok-o">(</span><span class="tok-n">Throwable</span> <span class="tok-n">cause</span><span class="tok-o">,</span> <span class="tok-n">Response</span> <span class="tok-n">response</span><span class="tok-o">)</span> <span class="tok-o">{...}</span>
  <span class="tok-kd">public</span> <span class="tok-nf">WebApplicationException</span><span class="tok-o">(</span><span class="tok-n">Throwable</span> <span class="tok-n">cause</span><span class="tok-o">,</span> <span class="tok-kt">int</span> <span class="tok-n">status</span><span class="tok-o">)</span> <span class="tok-o">{...}</span>
  <span class="tok-kd">public</span> <span class="tok-nf">WebApplicationException</span><span class="tok-o">(</span><span class="tok-n">Throwable</span> <span class="tok-n">cause</span><span class="tok-o">,</span> <span class="tok-n">Response</span><span class="tok-o">.</span><span class="tok-na">Status</span> <span class="tok-n">status</span><span class="tok-o">)</span> <span class="tok-o">{...}</span>

  <span class="tok-kd">public</span> <span class="tok-n">Response</span> <span class="tok-nf">getResponse</span><span class="tok-o">()</span> <span class="tok-o">{...]</span>
<span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Podemos crear una instancia a partir de un objeto Response</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>CreaciÃ³n de una instancia a partir de un cÃ³digo de estado</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>CreaciÃ³n de una instancia a partir de un <em>String</em>. Por defecto se incluye el
cÃ³digo de estado 500. El <em>String</em> que se pasa como parÃ¡metro se almacena para su
posterior recuperaciÃ³n a travÃ©s del mensaje `getMessage()</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Cuando JAX-RS detecta que se ha lanzado la excepciÃ³n <code>WebApplicationException</code>,
la captura y realiza una llamada al mÃ©todo <code>WebApplicationException.getResponse()</code>
para obtener un objeto
<code>Response</code> que enviarÃ¡ al cliente. Si la aplicaciÃ³n ha inicializado la excepciÃ³n
<code>WebApplicationException</code> con un cÃ³digo de estado, o un objeto <code>Response</code>, dicho
cÃ³digo o <code>Response</code> se utilizarÃ¡n para crear la respuesta HTTP real. En otro caso,
la excepciÃ³n <code>WebApplicationException</code> devolverÃ¡ el cliente el cÃ³digo de respuesta
"500 Internal Server Error".</p>
</div>
<div class="paragraph">
<p>Por ejemplo, supongamos que tenemos un servicio web que permite a los usuarios
solicitar informaciÃ³n de nuestros clientes, utilizando una representaciÃ³n XML:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span class="tok-nd">@Path</span><span class="tok-o">(</span><span class="tok-s">&quot;/clientes&quot;</span><span class="tok-o">)</span>
<span class="tok-kd">public</span> <span class="tok-kd">class</span> <span class="tok-nc">ClienteResource</span> <span class="tok-o">{</span>
  <span class="tok-nd">@GET</span>
  <span class="tok-nd">@Path</span><span class="tok-o">(</span><span class="tok-s">&quot;{id}&quot;</span><span class="tok-o">)</span>
  <span class="tok-nd">@Produces</span><span class="tok-o">(</span><span class="tok-s">&quot;application/xml&quot;</span><span class="tok-o">)</span>
  <span class="tok-kd">public</span> <span class="tok-n">Cliente</span> <span class="tok-nf">getCliente</span><span class="tok-o">(</span><span class="tok-nd">@PathParam</span><span class="tok-o">(</span><span class="tok-s">&quot;id&quot;</span><span class="tok-o">)</span> <span class="tok-kt">int</span> <span class="tok-n">id</span><span class="tok-o">)</span> <span class="tok-o">{</span>
     <span class="tok-n">Cliente</span> <span class="tok-n">cli</span> <span class="tok-o">=</span> <span class="tok-n">recuperarCliente</span><span class="tok-o">(</span><span class="tok-n">id</span><span class="tok-o">);</span>
     <span class="tok-k">if</span> <span class="tok-o">(</span><span class="tok-n">cli</span> <span class="tok-o">==</span> <span class="tok-kc">null</span><span class="tok-o">)</span> <span class="tok-o">{</span>
          <span class="tok-k">throw</span> <span class="tok-k">new</span> <span class="tok-nf">WebApplicationException</span><span class="tok-o">(</span><span class="tok-n">Response</span><span class="tok-o">.</span><span class="tok-na">Status</span><span class="tok-o">.</span><span class="tok-na">NOT_FOUND</span><span class="tok-o">);</span>
     <span class="tok-o">}</span>
     <span class="tok-k">return</span> <span class="tok-n">cli</span><span class="tok-o">;</span>
  <span class="tok-o">}</span>
<span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>En este ejemplo, si no encontramos una instancia de <code>Cliente</code> con el <code>id</code>
proporcionado, lanzaremos una <code>WebApplicationException</code> que provocarÃ¡ que
se le envÃ­e al cliente como cÃ³digo de respuesta "404 Not Found".</p>
</div>
</div>
<div class="sect3">
<h4 id="_mapeado_de_excepciones">3.6.2. Mapeado de excepciones</h4>
<div class="paragraph">
<p>Normalmente, las aplicaciones tienen que "tratar" con multitud de excepciones
lanzadas desde nuestro cÃ³digo de aplicaciÃ³n o por <em>frameworks</em> de terceros.
Dejar que el <em>servlet</em> JAX-RS que reside en el servidor maneje la excepciÃ³n no nos
proporciona demasiada flexibilidad. Si capturamos y "redirigimos" todas
estas excepciones a <code>WebApplicationException</code> podrÃ­a resultar bastante tedioso.
De forma alternativa, podemos implementar y registrar instancias de <code>javax.ws.rs.ext.ExceptionMapper</code>.
Estos objetos "saben" cÃ³mo mapear una excepciÃ³n lanzada por la aplicaciÃ³n a un
objeto <code>Response</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span class="tok-kd">public</span> <span class="tok-kd">interface</span> <span class="tok-nc">ExceptionMapper</span><span class="tok-o">&lt;</span><span class="tok-n">E</span> <span class="tok-kd">extends</span> <span class="tok-n">Throwable</span><span class="tok-o">&gt;</span> <span class="tok-o">{</span>
<span class="tok-o">{</span>
   <span class="tok-n">Response</span> <span class="tok-nf">toResponse</span><span class="tok-o">(</span><span class="tok-n">E</span> <span class="tok-n">exception</span><span class="tok-o">);</span>
<span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Las clases que implementan la interfaz <code>ExceptionMapper&lt;T&gt;</code> son
 "proveedores de mappings de excepciones" (<em>Exception Mapping Providers</em>) y
mapean una excepciÃ³n <em>runtime</em> o <em>checked</em> a una instancia de <code>Response</code>.</p>
</div>
<div class="paragraph">
<p>Cuando un recurso JAX-RS lanza una excepciÃ³n para la que existe un proveedor de
mapping de excepciones, Ã©ste Ãºltimo se utiliza para devolver una instancia de <code>Response</code>.
 Esta respuesta resultante se procesa como si hubiese sido generada por el recurso.</p>
</div>
<div class="paragraph">
<p>Por ejemplo, una excepciÃ³n bastante utilizada por aplicaciones de bases de datos
que utilizan JPA (<strong>J</strong>ava <strong>P</strong>ersistence <strong>A</strong>pi) es <code>javax.persistence.EntityNotFoundException</code>.
Esta excepciÃ³n se lanza cuando JPA no puede encontrar un objeto particular en la base
de datos. En lugar de escribir cÃ³digo que maneje dicha excepciÃ³n de forma explÃ­cita,
podemos escribir un <code>ExceptionMapper</code> para que gestione dicha excepciÃ³n por nosotros.
VeÃ¡mos cÃ³mo:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span class="tok-nd">@Provider</span> <i class="conum" data-value="1"></i><b>(1)</b>
<span class="tok-kd">public</span> <span class="tok-kd">class</span> <span class="tok-nc">EntityNotFoundMapper</span>
         <span class="tok-kd">implements</span> <span class="tok-n">ExceptionMapper</span><span class="tok-o">&lt;</span><span class="tok-n">EntityNotFoundException</span><span class="tok-o">&gt;</span> <span class="tok-o">{</span>  <i class="conum" data-value="2"></i><b>(2)</b>
   <span class="tok-kd">public</span> <span class="tok-n">Response</span> <span class="tok-nf">toResponse</span><span class="tok-o">(</span><span class="tok-n">EntityNotFoundException</span> <span class="tok-n">e</span><span class="tok-o">)</span> <span class="tok-o">{</span>  <i class="conum" data-value="3"></i><b>(3)</b>
      <span class="tok-k">return</span> <span class="tok-n">Response</span><span class="tok-o">.</span><span class="tok-na">status</span><span class="tok-o">(</span><span class="tok-n">Response</span><span class="tok-o">.</span><span class="tok-na">Status</span><span class="tok-o">.</span><span class="tok-na">NOT_FOUND</span><span class="tok-o">).</span><span class="tok-na">build</span><span class="tok-o">();</span>  <i class="conum" data-value="4"></i><b>(4)</b>
   <span class="tok-o">}</span>
<span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Nuestra implementaciÃ³n de <code>ExceptionMapper</code> debe anotarse con <code>@Provider</code>. Esto
le indica al <em>runtime</em> de JAX-RS que esta clase es un componente REST.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>La clase que implementa <code>ExceptionMapper</code> debe proporcionar el tipo que
se quiere parametrizar. JAX-RS utiliza esta informaciÃ³n para emparejar las
excepciones de tipo <code>EntityNotFoundException</code> con nuestra clase <code>EntityNotFoundMapper</code></td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>El mÃ©todo <code>toResponse()</code> recibe la excepciÃ³n lanzada y</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>crea un objeto <code>Response</code> que se utilizarÃ¡ para construir la respuesta HTTP</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Otro ejemplo es la excepciÃ³n <em>EJBException</em>, lanzada por aplicaciones que utilizan
EJBs.</p>
</div>
</div>
<div class="sect3">
<h4 id="_jerarquÃ­a_de_excepciones">3.6.3. JerarquÃ­a de excepciones</h4>
<div class="paragraph">
<p>JAX-RS 2.0 proporciona una jerarquÃ­a de excepciones para varias condiciones de
error para las peticiones HTTP. La idea es que, en lugar de crear una instancia
de <code>WebApplicationException</code> e inicializarla con un cÃ³digo de estado especÃ­fico,
podemos uilizar en su lugar una de las excepciones de la jeraquÃ­a (clases que heredan
de la clase <em>WebApplicationException</em>). Por ejemplo,
podemos cambiar el
cÃ³digo anterior que utilizaba <code>WebApplicationException</code>, y en su lugar, usar <code>javax.ws.rs.NotFoundException</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span class="tok-nd">@Path</span><span class="tok-o">(</span><span class="tok-s">&quot;/clientes&quot;</span><span class="tok-o">)</span>
<span class="tok-kd">public</span> <span class="tok-kd">class</span> <span class="tok-nc">ClienteResource</span> <span class="tok-o">{</span>
  <span class="tok-nd">@GET</span>
  <span class="tok-nd">@Path</span><span class="tok-o">(</span><span class="tok-s">&quot;{id}&quot;</span><span class="tok-o">)</span>
  <span class="tok-nd">@Produces</span><span class="tok-o">(</span><span class="tok-s">&quot;application/xml&quot;</span><span class="tok-o">)</span>
  <span class="tok-kd">public</span> <span class="tok-n">Cliente</span> <span class="tok-nf">getCliente</span><span class="tok-o">(</span><span class="tok-nd">@PathParam</span><span class="tok-o">(</span><span class="tok-s">&quot;id&quot;</span><span class="tok-o">)</span> <span class="tok-kt">int</span> <span class="tok-n">id</span><span class="tok-o">)</span> <span class="tok-o">{</span>
     <span class="tok-n">Cliente</span> <span class="tok-n">cli</span> <span class="tok-o">=</span> <span class="tok-n">recuperarCliente</span><span class="tok-o">(</span><span class="tok-n">id</span><span class="tok-o">);</span>
     <span class="tok-k">if</span> <span class="tok-o">(</span><span class="tok-n">cli</span> <span class="tok-o">==</span> <span class="tok-kc">null</span><span class="tok-o">)</span> <span class="tok-o">{</span>
          <span class="tok-k">throw</span> <span class="tok-k">new</span> <span class="tok-nf">NotFoundException</span><span class="tok-o">();</span>
     <span class="tok-o">}</span>
     <span class="tok-k">return</span> <span class="tok-n">cli</span><span class="tok-o">;</span>
  <span class="tok-o">}</span>
<span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Al igual que el resto de excepciones de la jerarquÃ­a, la excepciÃ³n <code>NotFoundException</code>
hereda de <code>WebApplicationException</code>. La siguiente tabla muestra algunas excepciones
que podemos utilizar, todas ellas del paquete <code>javax.ws.rs</code>. Las que incluyen un cÃ³digo de estado
en el rango de 400, son subclases de <code>ClientErrorException</code>, y como ya hemos indicado,
representan errores en las peticiones. Las que presentan un
cÃ³digo de estado en el rango de 500, son subclases de <code>ServerErrorException</code>, y representan
errores del servidor.</p>
</div>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 5. JerarquÃ­a de excepciones JAX-RS:</caption>
<colgroup>
<col style="width: 33%;">
<col style="width: 33%;">
<col style="width: 33%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">ExcepciÃ³n</th>
<th class="tableblock halign-left valign-top">CÃ³digo de estado</th>
<th class="tableblock halign-left valign-top">DescripciÃ³n</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">BadRequestException</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">400</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Mensaje mal formado</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">NotAuthorizedException</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">401</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Fallo de autenticaciÃ³n</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ForbiddenException</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">403</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Acceso no permitido</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">NotFoundException</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">404</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No se ha podido encontrar el recurso</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">NotAllowedException</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">405</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">MÃ©todo HTTP no soportado</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">NotAcceptableException</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">406</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>Media type</em> solicitado por el cliente no soportado (cabecera <strong>Accept</strong> de la
peticion)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">NotSupportedException</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">415</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">El cliente ha incluido un <em>Media type</em> no soportado (cabecera <strong>Content-Type</strong> de la
peticion)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">InternalServerErrorException</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">500</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Error general del servidor</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ServiceUnavailableException</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">503</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">El servidor estÃ¡ ocupado o temporalmente fuera de servicio</p></td>
</tr>
</tbody>
</table>
<div class="ulist">
<ul>
<li>
<p>La excepciÃ³n <code>BadRequestException</code> se utiliza cuando el cliente envÃ­a algo al servidor
que Ã©ste no puede interpretar. Ejemplos de escenarios concretos que provocan que el
<em>runtime</em> JAX-RS son: cuando una peticiÃ³n PUT o POST contiene un cuerpo del mensaje con
un documento XML o JSON mal formado, de forma que falle el "parsing" del documento, o cuando
no puede convertir un valor especificado en la cabecera o <em>cookie</em> al tipo deseado.
Por ejemplo:</p>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span class="tok-nd">@HeaderParam</span><span class="tok-o">(</span><span class="tok-s">&quot;Cabecera-Particular&quot;</span><span class="tok-o">)</span> <span class="tok-kt">int</span> <span class="tok-n">cabecera</span><span class="tok-o">;</span>
<span class="tok-nd">@CookieParam</span><span class="tok-o">(</span><span class="tok-s">&quot;miCookie&quot;</span><span class="tok-o">)</span> <span class="tok-kt">int</span> <span class="tok-n">cookie</span><span class="tok-o">;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Si el valor de la cabecera HTTP de la peticiÃ³n o el valor <code>miCookie</code> no puede
convertirse en un entero, se lanzarÃ¡ la excepciÃ³n <code>BadRequestException</code>.</p>
</div>
</li>
<li>
<p>La excepciÃ³n <code>NotAuthorizedException</code> (cÃ³digo <strong>401</strong>), se usa cuando queremos
escribir nuestros propios
protocolos de autorizaciÃ³n, y queremos indicar al cliente que Ã©ste necesita
autenticarse con el servidor.</p>
</li>
<li>
<p>La excepciÃ³n <code>ForbiddenException</code> (cÃ³digo <strong>403</strong>),se usa generalmente cuando el cliente realiza
una invocaciÃ³n para la que no tiene permisos de acceso. Esto  ocurre normalmente
debido a que el cliente no tiene el rol requerido.</p>
</li>
<li>
<p>La excepciÃ³n <code>NotFoundException</code> (cÃ³digo <strong>404</strong>), se usa cuando queremos comunicar al cliente que el
recurso que estÃ¡ solicitando no existe. Esta excepciÃ³n tambiÃ©n se generarÃ¡ de
forma automÃ¡tica por el <em>runtime</em> de JAX-RS cuando a Ã©ste no le sea posible
inyectar un valor en un @PathParam, @QueryParam, o @MatrixParam. Al igual que hemos
comentado para <code>BadRequestException</code> esto puede ocurrir si intentamos convertir
el valor del parÃ¡metro a un tipo que no admite esta conversiÃ³n.</p>
</li>
<li>
<p>La excepciÃ³n <code>NotAllowedException</code> (cÃ³digo <strong>405</strong>), se usa cuando el mÃ©todo HTTP que el cliente estÃ¡
intentando invocar no estÃ¡ soportado por el recurso al que el cliente estÃ¡ accediendo.
El <em>runtime</em> de JAX-RS lanza automÃ¡ticamente esta excepciÃ³n si no encuentra ningÃºn
mÃ©todo que pueda "emparejar" con el mÃ©todo HTTP invocado.</p>
</li>
<li>
<p>La excepciÃ³n <code>NotAcceptableException</code> (cÃ³digo <strong>406</strong>), se usa cuando un cliente estÃ¡ solicitando un
formato especÃ­fico a travÃ©s de la cabecera <code>Accept</code>. El <em>runtime</em> de JAX-RS lanza
automÃ¡ticamente esta excepciÃ³n si no hay un mÃ©todo con una anotaciÃ³n @Produces
que sea compatible con la cabecera <code>Accept</code> del cliente.</p>
</li>
<li>
<p>La excepciÃ³n <code>NotSupportedException</code> (cÃ³digo <strong>415</strong>),se usa cuando un cliente estÃ¡ enviando una
representaciÃ³n que el servidor no "comprende". El <em>runtime</em> de JAX-RS lanza
automÃ¡ticamente esta excepciÃ³n si no hay un mÃ©todo con una anotaciÃ³n @Consumes
que coincida con el valor de la cabecera <code>Content-Type</code> de la peticiÃ³n.</p>
</li>
<li>
<p>La excepciÃ³n <code>InternalServerErrorException</code> (cÃ³digo <strong>500</strong>),es una excepciÃ³n de propÃ³sito general
lanzada por el servidor. Si en nuestra aplicaciÃ³n queremos lanzar esta excepciÃ³n
deberÃ­amos hacerlo si se ha producido una condiciÃ³n de error que realmente no
"encaja" en ninguna de las situaciones que hemos visto. El <em>runtime</em> de JAX-RS lanza
automÃ¡ticamente esta excepciÃ³n si falla un <code>MessageBodyWriter</code> o si se lanza
alguna excepciÃ³n desde algÃºn <code>ExceptionMapper</code>.</p>
</li>
<li>
<p>La excepciÃ³n <code>ServiceUnavailableException</code> (cÃ³digo <strong>503</strong>),se usa cuando el servidor estÃ¡ ocupado
o temporalmente fuera de servicio. En la mayorÃ­a de los casos, es suficiente con que
el cliente vuelva a intentar realizar la llamada un tiempo mÃ¡s tarde.</p>
</li>
</ul>
</div>
<div style="page-break-after: always;"></div>
</div>
</div>
<div class="sect2">
<h3 id="_ejercicios_3">3.7. Ejercicios</h3>
<div class="sect3">
<h4 id="_servicio_rest_ejemplo">3.7.1. Servicio REST ejemplo</h4>
<div class="paragraph">
<p>Para familiarizarnos con las el uso de diferentes manejadores de contenidos y
manejo de excepciones proporcionamos el mÃ³dulo
el <strong>MÃDULO</strong> <strong>s3-ejemplo-rest</strong>, con la implementaciÃ³n de un servicio rest sencillo que podÃ©is
probar con la herramienta <strong>postman</strong>.</p>
</div>
<div class="paragraph">
<p>En el directorio <code>src/main/resources</code> de dicho mÃ³dulo tenÃ©is un fichero de
texto con las instrucciones (<em>instrucciones.txt</em>) para construir, desplegar y probar la aplicaciÃ³n de ejemplo.</p>
</div>
</div>
<div class="sect3">
<h4 id="_plantillas_que_se_proporcionan">3.7.2. Plantillas que se proporcionan</h4>
<div class="paragraph">
<p>Para esta sesiÃ³n proporcionamos un proyecto como plantilla con el nombre <code>s3-filmoteca</code>
que tendrÃ¡s utilizar como punto de partida para aplicar lo que hemos aprendido en esta
sesiÃ³n.</p>
</div>
<div class="paragraph">
<p>Se trata de una implementaciÃ³n parcial para gestionar una filmoteca con informaciÃ³n de
pelÃ­culas y actores.</p>
</div>
<div class="paragraph">
<p>La estructura lÃ³gica del proyecto proporcionado es la siguiente:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Paquete <code>org.expertojava.domain</code>: es la capa que contiene los objetos del dominio de la
aplicaciÃ³n.
  Por simplicidad, no usamos una base de datos real, sino que trabajamos con datos en
  memoria.</p>
</li>
<li>
<p>Paquete <code>org.expertojava.service</code>: contiene la implementaciÃ³n de los servicios de nuestra
aplicaciÃ³n, que serÃ¡n accedidos desde la capa rest</p>
</li>
<li>
<p>Paquete <code>org.expertojava.rest</code>: constituye la capa rest de nuestra aplicaciÃ³n. Esta capa es
cliente de la capa de servicios.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>En la carpeta <code>src/main/resources</code> tenÃ©is un fichero de texto (<em>instrucciones.txt</em>) con
informaciÃ³n detallada sobre el API rest implementado.</p>
</div>
</div>
<div class="sect3">
<h4 id="_uso_de_jaxb_0_5_puntos">3.7.3. Uso de JAXB (0,5 puntos)</h4>
<div class="paragraph">
<p>Utiliza las anotaciones JAXB oportunas para realizar el serializado de las entidades
java a xml y json, de forma que la lista de pelÃ­culas de la filmoteca en formato xml sea:</p>
</div>
<div class="listingblock">
<div class="title">PeticiÃ³n rest: GET /peliculas</div>
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span class="tok-o">&lt;?</span><span class="tok-n">xml</span> <span class="tok-n">version</span><span class="tok-o">=</span><span class="tok-s">&quot;1.0&quot;</span> <span class="tok-n">encoding</span><span class="tok-o">=</span><span class="tok-s">&quot;UTF-8&quot;</span> <span class="tok-n">standalone</span><span class="tok-o">=</span><span class="tok-s">&quot;yes&quot;</span><span class="tok-o">?&gt;</span>
<span class="tok-o">&lt;</span><span class="tok-n">peliculas</span><span class="tok-o">&gt;</span>
   <span class="tok-o">&lt;</span><span class="tok-n">pelicula</span> <span class="tok-n">duracion</span><span class="tok-o">=</span><span class="tok-s">&quot;120&quot;</span> <span class="tok-n">estreno</span><span class="tok-o">=</span><span class="tok-s">&quot;2015-12-08T00:00:00+01:00&quot;</span> <span class="tok-n">id</span><span class="tok-o">=</span><span class="tok-s">&quot;1&quot;</span><span class="tok-o">&gt;</span>
     <span class="tok-o">&lt;</span><span class="tok-n">director</span><span class="tok-o">&gt;</span><span class="tok-n">Stanley</span> <span class="tok-n">Kubrick</span><span class="tok-o">&lt;/</span><span class="tok-n">director</span><span class="tok-o">&gt;</span>
     <span class="tok-o">&lt;</span><span class="tok-n">titulo</span><span class="tok-o">&gt;</span><span class="tok-n">El</span> <span class="tok-n">resplandor</span><span class="tok-o">&lt;/</span><span class="tok-n">titulo</span><span class="tok-o">&gt;</span>
   <span class="tok-o">&lt;/</span><span class="tok-n">pelicula</span><span class="tok-o">&gt;</span>
   <span class="tok-o">&lt;</span><span class="tok-n">pelicula</span> <span class="tok-n">duracion</span><span class="tok-o">=</span><span class="tok-s">&quot;155&quot;</span> <span class="tok-n">estreno</span><span class="tok-o">=</span><span class="tok-s">&quot;2015-18-07T00:00:00+01:00&quot;</span> <span class="tok-n">id</span><span class="tok-o">=</span><span class="tok-s">&quot;2&quot;</span><span class="tok-o">&gt;</span>
     <span class="tok-o">&lt;</span><span class="tok-n">director</span><span class="tok-o">&gt;</span><span class="tok-n">Director</span> <span class="tok-mi">2</span><span class="tok-o">&lt;/</span><span class="tok-n">director</span><span class="tok-o">&gt;</span>
     <span class="tok-o">&lt;</span><span class="tok-n">titulo</span><span class="tok-o">&gt;</span><span class="tok-n">Pelicula</span> <span class="tok-mi">2</span><span class="tok-o">&lt;/</span><span class="tok-n">titulo</span><span class="tok-o">&gt;</span>
   <span class="tok-o">&lt;/</span><span class="tok-n">pelicula</span><span class="tok-o">&gt;</span>
<span class="tok-o">&lt;/</span><span class="tok-n">peliculas</span><span class="tok-o">&gt;</span></code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Por defecto, JAXB serializa los tipos <code>Date</code> con el formato <a href="https://es.wikipedia.org/wiki/ISO_8601">ISO 8061</a>
para los contenidos en el cuerpo de la petiÃ³n/respuesta. Dicho formato es YYYY-MM-DD (seguido de HH:MM:SS).
Por otro lado, si aÃ±adimos actores a las pelÃ­culas, Ã©stos deberÃ¡n mostrarse bajo la etiqueta <em>&lt;actores&gt;</em>, tal y como
mostramos en el siguiente ejemplo.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Los datos mostrados para una pelÃ­cula en formato xml tienen que presentar el siguiente aspecto:</p>
</div>
<div class="paragraph">
<p>source,java]
.PeticiÃ³n rest: GET /peliculas/1</p>
</div>
<div class="listingblock">
<div class="content">
<pre>&lt;?xml version="1.0" encoding="UTF-8" standalone="yes"?&gt;
&lt;pelicula duracion="120" estreno="2015-12-08T00:00:00+01:00" id="1"&gt;
    &lt;actores&gt;
        &lt;actor nombre="Jack Nicholson" personaje="Jack Torrance"/&gt;
    &lt;/actores&gt;
    &lt;director&gt;Stanley Kubrick&lt;/director&gt;
    &lt;titulo&gt;El resplandor&lt;/titulo&gt;
&lt;/pelicula&gt;</pre>
</div>
</div>
<div class="paragraph">
<p>Puedes comprobar si has hecho bien el ejercicio utilizando Postman.</p>
</div>
</div>
<div class="sect3">
<h4 id="_uso_de_manejadores_de_contenidos_y_clase_response_0_75_puntos">3.7.4. Uso de manejadores de contenidos y clase Response (0,75 puntos)</h4>
<div class="paragraph">
<p><strong>Implementa una nueva peticiÃ³n POST</strong> que reciba los datos de una nueva pelÃ­cula desde
un formulario. Recuerda que los datos de un formulario pueden ponerse en el cuerpo
de la peticiÃ³n HTTP como pares <code>nombre=valor</code> separados por <code>&amp;</code>. Los espacios
en blanco se codifican como <code>%20</code>. No es necesario poner comillas. Por ejemplo:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>nombre1=valor%20con%20espacios&amp;nombre2=valor</pre>
</div>
</div>
<div class="paragraph">
<p>Se proporciona el fichero index.html con un formulario para utilizarlo como
alternativa a postman. Para acceder al formulario usaremos <em><a href="http://localhost:8080/s3-filmoteca/" class="bare">http://localhost:8080/s3-filmoteca/</a></em></p>
</div>
<div class="paragraph">
<p><strong>Modifica las peticiones POST</strong> sobre <code>pelÃ­culas</code> y <code>actores</code> de forma que devuelvan en la cabecera
Location la URI del nuevo recurso creado. Por ejemplo</p>
</div>
<div class="literalblock">
<div class="content">
<pre>http://localhost:8080/s3-filmoteca/peliculas/3</pre>
</div>
</div>
<div class="paragraph">
<p>en el caso de una nueva pelÃ­cula, y</p>
</div>
<div class="literalblock">
<div class="content">
<pre>http://localhost:8080/s3-filmoteca/peliculas/3/actores/Sigourney%20Weaver</pre>
</div>
</div>
<div class="paragraph">
<p>si por ejemplo hemos aÃ±adido un nuevo actor a la pelÃ­cula con id=3.</p>
</div>
<div class="paragraph">
<p><strong>Modifica los mÃ©todos GET</strong> para que devuelvan el estado: 204 No Content
en los casos en los que la pelÃ­cula y/o actor consultado no exista.</p>
</div>
<div class="paragraph">
<p><strong>Modifica los mÃ©todos GET</strong> para que devuelvan el estado: 404 Not Found,
en los casos en los que las listas de pelÃ­culas y/o actores estÃ©n vacÃ­as.</p>
</div>
<div class="paragraph">
<p><strong>Implementa</strong> el cÃ³digo para aÃ±adir un nuevo actor. TendrÃ¡s que obtener la informaciÃ³n
de la pelÃ­cula y nombre del actor de la URI de la peticiÃ³n.</p>
</div>
<div class="paragraph">
<p>Puedes comprobar si has hecho bien el ejercicio utilizando Postman.</p>
</div>
</div>
<div class="sect3">
<h4 id="_manejo_de_excepciones_0_75_puntos">3.7.5. Manejo de excepciones (0,75 puntos)</h4>
<div class="paragraph">
<p><strong>Modifica el mÃ©todo</strong> <code>addPelicula</code> de la capa de servicio (paquete <em>org.expertojava.service</em>) para que
lance una excepciÃ³n de tipo <em>ServiceException</em> con el mensaje "El tÃ­tulo de la pelÃ­cula
no puede ser nulo ni vacÃ­o"
cuando se intente aÃ±adir una pelÃ­cula con un tÃ­tulo con valor <em>null</em>, o vacÃ­o.</p>
</div>
<div class="paragraph">
<p>El mÃ©todo <code>addPelicula</code> debe lanzar tambiÃ©n una excepciÃ³n de tipo <em>ServiceException</em>
con el mensaje "La pelÃ­cula ya existe",
cuando se intente aÃ±adir una pelÃ­cula con un tÃ­tulo que ya existe.</p>
</div>
<div class="paragraph">
<p><strong>Modifica el mÃ©todo</strong> <code>addActor</code> de la capa de servicio para que lance las excepciones de tipo
<em>ServiceException</em> con los mensajes "El tÃ­tulo de la pelÃ­cula no puede ser nulo ni vacÃ­o"
cuando se intente aÃ±adir un actor a una pelÃ­cula cuyo tÃ­tulo no existe, o bien el mensaje
"EL actor ya existe" si
intentamos aÃ±adir un actor a una pelÃ­cula que ya habÃ­amos aÃ±adido previamente.</p>
</div>
<div class="paragraph">
<p><strong>Implementa</strong> un <em>mapper</em> para capturar las excepciones de la capa de servicio, de forma
que se devuelva el
estado 500, "Internal Server error", y como entidad del cuerpo de la respuesta el mensaje
asociado a las excepciones generadas por el
servicio (<em>"El tÃ­tulo de la pelÃ­cula no puede ser nulo ni vacÃ­o"</em>,
<em>"EL actor ya existe"</em>, &#8230;&#8203;). La nueva clase
pertencerÃ¡ a la capa "rest". Puedes ponerle el nombre <em>ServiceExceptionMapper</em>.</p>
</div>
<div class="paragraph">
<p>Puedes comprobar si has hecho bien el ejercicio utilizando Postman.</p>
</div>
<div style="page-break-after: always;"></div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="sesion04">4. HATEOAS y Seguridad</h2>
<div class="sectionbody">
<div class="paragraph">
<p>En esta sesiÃ³n trataremos uno de los principios REST de obligado cumplimiento
para poder hablar de un servicio RESTful. Nos referimos a HATEOAS. Hasta ahora hemos
visto cÃ³mo los clientes pueden cambiar el estado de los recursos (el nombre del
recurso se especifica en la URI de la peticiÃ³n) a travÃ©s de los contenidos
del cuerpo del mensaje, o utilizando parÃ¡metros, o cabeceras de peticiÃ³n. A su vez,
los servicios comunican el estado resultante de la peticiÃ³n a los clientes a travÃ©s
del contenido del cuerpo del mensaje, cÃ³digos de respuesta, y cabeceras de respuesta.
Pues bien, teniendo en cuenta lo anterior, HATEOAS hace referencia a que, cuando
sea necesario, tambiÃ©n
deben incluirse los enlaces a los recursos (URI) en el cuerpo de la respuesta
(o en las cabeceras), para asÃ­ poder recuperar el recurso en cuestiÃ³n, o los
recursos relacionados.</p>
</div>
<div class="paragraph">
<p>En esta sesiÃ³n tambiÃ©n explicaremos algunos conceptos bÃ¡sicos para poder dotar de seguridad a
nuestros servicios REST</p>
</div>
<div class="sect2">
<h3 id="__quÃ©_es_hateoas">4.1. Â¿QuÃ© es HATEOAS?</h3>
<div class="paragraph">
<p>ComÃºnmente se hace referencia a Internet como "la <em>Web</em>" (<em>web</em> significa red,
telaraÃ±a), debido a que la informaciÃ³n estÃ¡ interconectada mediante una serie de
hiperenlaces embebidos dentro de los documentos HTML. Estos enlaces crean una
especie de "hilos" o "hebras" entre los sitios web relacionados en Internet.
 Una consecuencia de ello es que los humanos pueden "navegar" por la Web buscando
 elementos de informaciÃ³n relacionados de su interÃ©s, haciendo "click" en los
 diferentes enlaces desde sus navegadores. Los motores de bÃºsqueda pueden "trepar"
 o "desplazarse" por estos enlaces y crear Ã­ndices enormes de datos susceptibles de
 ser "buscados". Sin ellos, Internet no podrÃ­a tener la propiedad de ser escalable.
 No habrÃ­a forma de indexar fÃ¡cilmente la informaciÃ³n, y el registro de sitios web
 serÃ­a un proceso manual bastante tedioso.</p>
</div>
<div class="paragraph">
<p>AdemÃ¡s de los enlaces (<em>links</em>), otra caracterÃ­stica fundamental de Internet es
 HTML. En ocasiones, un sitio web nos solicita que "rellenemos" alguna informaciÃ³n
 para comprar algo o registrarnos en algÃºn servicio. El servidor nos indica a nosotros
 como clientes quÃ© informaciÃ³n necesitamos proporcionar para completar una acciÃ³n
 descrita en la pÃ¡gina web que estamos viendo. El navegador nos muestra la pÃ¡gina web
 en un formado que podemos entender fÃ¡cilmente. Nosotros leemos la pÃ¡gina web y
 rellenamos y enviamos el formulario. Un formulario HTML es un formato de datos
 interesante debido a que auto-describe la interacciÃ³n entre el cliente y el servidor.</p>
</div>
<div class="paragraph">
<p>El principio arquitectÃ³nico que describe el proceso de enlazado (<em>linking</em>) y
 el envÃ­o de formularios se denomina <strong>HATEOAS</strong>. Las siglas del tÃ©rmino HATEOAS
  significan <strong>H</strong>ypermedia <strong>A</strong>s <strong>T</strong>he <strong>E</strong>ngine <strong>O</strong>f <strong>A</strong>pplication
  <strong>S</strong>tate (es decir, el uso de Hipermedia como mecanismo de mÃ¡quina de estados de
  la aplicaciÃ³n). La idea de HATEOAS es que el formato de los datos proporciona
  informaciÃ³n extra sobre cÃ³mo cambiar el estado de nuestra aplicaciÃ³n. En la Web,
  los enlaces HTML nos permiten cambiar el estado de nuestro navegador. Por ejemplo
  cuando estamos leyendo una pÃ¡gina web, un enlace nos indica quÃ© posibles documentos
   (estados) podemos ver a continuaciÃ³n. Cuando hacemos "click" sobre un enlace,
   el estado del navegador cambia al visitar y mostrar una nueva pÃ¡gina web.
   Los formularios HTML, por otra parte, nos proporcionan una forma de cambiar el
   estado de un recurso especÃ­fico de nuestro servidor. Por Ãºltimo, cuando compramos algo en
   Internet, por ejemplo, estamos creando dos nuevos recursos en el servicio: una
   transacciÃ³n con tarjeta de crÃ©dito y una orden de compra.</p>
</div>
</div>
<div class="sect2">
<h3 id="_hateoas_y_servicios_web">4.2. HATEOAS y Servicios Web</h3>
<div class="paragraph">
<p>Cuando aplicamos HATEOAS a los servicios web la idea es incluir enlaces en nuestros
documentos XML o JSON. La mayorÃ­a de las aplicaciones RESTful basadas en XML utilizan
el formato <a href="http://www.w3.org/2005/Atom"><strong><em>Atom Syndication Format</em></strong></a> para implementar HATEOAS.</p>
</div>
<div class="sect3">
<h4 id="_enlaces_atom">4.2.1. Enlaces Atom</h4>
<div class="paragraph">
<p>Los enlaces Atom constituyen un mecanismo estÃ¡ndar para incluir enlaces (<em>links</em>) en
nuestros documentos XML. Veamos un ejemplo:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><span class="tok-nt">&lt;clientes&gt;</span>
   <span class="tok-nt">&lt;link</span> <span class="tok-na">rel=</span><span class="tok-s">&quot;next&quot;</span>
         <span class="tok-na">href=</span><span class="tok-s">&quot;http://ejemplo.com/clientes?inicio=2&amp;total=2&quot;</span>
        <span class="tok-na">type=</span><span class="tok-s">&quot;application/xml&quot;</span><span class="tok-nt">/&gt;</span>
   <span class="tok-nt">&lt;cliente</span> <span class="tok-na">id=</span><span class="tok-s">&quot;123&quot;</span><span class="tok-nt">&gt;</span>
      <span class="tok-nt">&lt;nombre&gt;</span>Juan Garcia<span class="tok-nt">&lt;/nombre&gt;</span>
   <span class="tok-nt">&lt;/cliente&gt;</span>
   <span class="tok-nt">&lt;cliente</span> <span class="tok-na">id=</span><span class="tok-s">&quot;332&quot;</span><span class="tok-nt">&gt;</span>
      <span class="tok-nt">&lt;nombre&gt;</span>Pablo Bozo<span class="tok-nt">&lt;/nombre&gt;</span>
   <span class="tok-nt">&lt;/cliente&gt;</span>
<span class="tok-nt">&lt;/clientes&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>El documento anterior representa una lista de clientes, y el elemento <code>&lt;link&gt;</code>
, que contiene un enlace, indica la forma de obtener los siguientes clientes de la lista.</p>
</div>
<div class="paragraph">
<p>Un enlace Atom es simplemente un elemento XML (elemento <code>&lt;link&gt;</code>) con unos atributos especÃ­ficos.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>El atributo <code>rel</code> Se utiliza para indicar la relaciÃ³n del enlace con el elemento XML en el que
 anidamos dicho enlace.
Es el <strong>nombre lÃ³gico</strong> utilizado para referenciar el enlace. Este atributo tiene
el mismo significado para la URL que estamos enlazando, que la etiqueta HTML
&lt;a&gt; tiene para la URL sobre la que estamos haciendo <em>click</em> con el ratÃ³n en el navegador.
Si el enlace hace referencia al propio elemento XML en el que incluimos el enlace,
entonces asignaremos el valor del atributo <code>self</code></p>
</li>
<li>
<p>El atributo <code>href</code> es la <strong>URL</strong> a la que podemos acceder para obtener nueva informaciÃ³n
o cambiar el estado de nuestra aplicaciÃ³n</p>
</li>
<li>
<p>El atributo <code>type</code> indica el <em>media type</em> asociado con el recurso al que apunta la URL</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Cuando un cliente recibe un documento con enlaces Atom, Ã©ste busca la relaciÃ³n en la que
estÃ¡ interesado (atributo <code>rel</code>) e invoca la URI indicada en el atributo <code>href</code>.</p>
</div>
</div>
<div class="sect3">
<h4 id="_ventajas_de_utilizar_hateoas_con_servicios_web">4.2.2. Ventajas de utilizar HATEOAS con Servicios Web</h4>
<div class="paragraph">
<p>Resulta bastante obvio por quÃ© los enlaces y los formularios tienen mucho que ver en la
prevalencia de la Web. Con un navegador, tenemos una "ventana" a todo un mundo de informaciÃ³n y
servicios. Las mÃ¡quinas de bÃºsqueda "rastrean" Internet e indexan sitios web para que todos
los datos estÃ©n al alcance de nuestros "dedos". Esto es posible debido a que la Web es
auto-descriptiva. Cuando accedemos a un documento, conocemos cÃ³mo recuperar informaciÃ³n
adicional "siguiendo" los enlaces situados en dicho documento. Por ejemplo, conocemos cÃ³mo
realizar una compra en Amazon, debido a que los formularios HTML nos indican cÃ³mo hacerlo.</p>
</div>
<div class="paragraph">
<p>Cuando los clientes son "mÃ¡quinas" en lugar de personas (los servicios Web tambiÃ©n se
conocen como "Web para mÃ¡quinas", frente a la "Web para humanos" proporcionada por
el acceso a un servidor web a travÃ©s de un navegador) el tema es algo diferente, puesto
que las mÃ¡quinas no pueden tomar decisiones "sobre la marcha", cosa que los humanos sÃ­
pueden hacer. Las mÃ¡quinas requieren que los programadores les digan cÃ³mo interpretar los
datos recibidos desde un servicio y cÃ³mo realizar transiciones entre estados como resultado
de las interacciones entre clientes y servidores.</p>
</div>
<div class="paragraph">
<p>En este sentido, HATEOAS proporciona algunas ventajas importantes para contribuir a que los
clientes sepan cÃ³mo utilizar los servicios a la vez que acceden a los mismos. Vamos a comentar
algunas de ellas.</p>
</div>
<div class="sect4">
<h5 id="_transparencia_en_la_localizaciÃ³n">Transparencia en la localizaciÃ³n</h5>
<div class="paragraph">
<p>En un sistema RESTful, gracias a HATEOAS, sÃ³lo es necesario hacer pÃºblicas unas pocas
 URIs. Los servicios y la informaciÃ³n son representados con enlaces que estÃ¡n "embebidos"
 en los formatos de los datos devueltos por las URIs pÃºblicas. Los clientes necesitan
 conocer los nombres lÃ³gicos de los enlaces para "buscar" a travÃ©s de ellos, pero no necesitan
 conocer las ubicaciones reales en la red de los servicios a los que acceden.</p>
</div>
<div class="paragraph">
<p>Los enlaces proporcionan un nivel de indirecciÃ³n, de forma que los servicios subyacentes
pueden cambiar sus localizaciones en la red sin alterar la lÃ³gica ni el cÃ³digo del cliente.</p>
</div>
</div>
<div class="sect4">
<h5 id="_desacoplamiento_de_los_detalles_de_la_interacciÃ³n">Desacoplamiento de los detalles de la interacciÃ³n</h5>
<div class="paragraph">
<p>Consideremos una peticiÃ³n que nos devuelve una lista de clientes en una base de datos:
<code>GET /clientes</code>. Si nuestra base de datos tiene miles de datos, probablemente no querremos
devolver todos ellos de una sÃ³la vez. Lo que podemos hacer es definir una vista en
nuestra base de datos utilizando parÃ¡metros de consulta, por ejemplo:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>/customers?inicio={indiceInicio}&amp;total={numeroElementosDevueltos}</pre>
</div>
</div>
<div class="paragraph">
<p>El parÃ¡metro <code>inicio</code> identifica el Ã­ndice inicial de nuestra lista de clientes. El parÃ¡metro
<code>total</code> especifica cuÃ¡ntos clientes queremos que nos sean devueltos como respuesta.</p>
</div>
<div class="paragraph">
<p>Lo que estamos haciendo, en realidad, es incrementar la cantidad de conocimiento
que el cliente debe tener predefinido para interactuar con el servicio (es decir, no sÃ³lo
necesita saber la URI, sino ademÃ¡s conocer la existencia de estos parÃ¡metros).
Supongamos que en el futuro, el servidor decide que necesita cambiar la forma en la que
se accede al nÃºmero de datos solicitados por el cliente. Si el servidor cambia la
interfaz, los clientes "antiguos" dejarÃ¡n de funcionar a menos que cambien su cÃ³digo.</p>
</div>
<div class="paragraph">
<p>En lugar de publicar la interfaz REST anterior para obtener datos de los clientes,
podemos incluir dicha informaciÃ³n en el documento de respuesta, por ejemplo:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><span class="tok-nt">&lt;clientes&gt;</span>
   <span class="tok-nt">&lt;link</span> <span class="tok-na">rel=</span><span class="tok-s">&quot;next&quot;</span>
         <span class="tok-na">href=</span><span class="tok-s">&quot;http://ejemplo.com/clientes?inicio=2&amp;total=2&quot;</span>
        <span class="tok-na">type=</span><span class="tok-s">&quot;application/xml&quot;</span><span class="tok-nt">/&gt;</span>
   <span class="tok-nt">&lt;cliente</span> <span class="tok-na">id=</span><span class="tok-s">&quot;123&quot;</span><span class="tok-nt">&gt;</span>
      <span class="tok-nt">&lt;nombre&gt;</span>Juan Garcia<span class="tok-nt">&lt;/nombre&gt;</span>
   <span class="tok-nt">&lt;/cliente&gt;</span>
   <span class="tok-nt">&lt;cliente</span> <span class="tok-na">id=</span><span class="tok-s">&quot;332&quot;</span><span class="tok-nt">&gt;</span>
      <span class="tok-nt">&lt;nombre&gt;</span>Pablo Bozo<span class="tok-nt">&lt;/nombre&gt;</span>
   <span class="tok-nt">&lt;/cliente&gt;</span>
<span class="tok-nt">&lt;/clientes&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Cuando incluimos un enlace Atom en un documento, estamos asignando un <strong>nombre lÃ³gico</strong>
a una <strong>transiciÃ³n de estados</strong>. En el ejemplo anterior, la transiciÃ³n de estados es el
siguiente conjunto de clientes a los que podemos acceder. En lugar de tener que
recordar cuÃ¡les son los parÃ¡metros de la URI que tenemos que utilizar en la siguiente
invocaciÃ³n para obtener mÃ¡s clientes, lo Ãºnico que tenemos que hacer es "seguir"
el enlace proporcionado. El cliente no tiene que "contabilizar" en ningÃºn sitio la
interacciÃ³n, ni tiene que recordar quÃ© "secciÃ³n" de la base de datos estamos consultando
actualmente.</p>
</div>
<div class="paragraph">
<p>AdemÃ¡s, el XML devuelto es auto-contenido. Â¿QuÃ© pasa si tenemos que "pasar" este
documento a un tercero? TendrÃ­amos que "decirle" que se trata de una vista parcial
de la base de datos y especificar el Ã­dice de inicio. Al incluir el enlace en el
documento, ya no es necesario proporcionar dicha informaciÃ³n adicional, ya que forma
parte del propio documento</p>
</div>
</div>
<div class="sect4">
<h5 id="_reducciÃ³n_de_errores_de_transiciÃ³n_de_estados">ReducciÃ³n de errores de transiciÃ³n de estados</h5>
<div class="paragraph">
<p>Los enlaces no se utilizan solamente como un mecanismo para agregar informaciÃ³n de
"navegaciÃ³n". TambiÃ©n se utilizan para cambiar el estado de los recursos. Pensemos
en una aplicaciÃ³n de comercio web a la que podemos acceder con la URI <code>pedidos/333</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><span class="tok-nt">&lt;pedido</span> <span class="tok-na">id=</span><span class="tok-s">&quot;333&quot;</span><span class="tok-nt">&gt;</span>
   <span class="tok-nt">&lt;cliente</span> <span class="tok-na">id=</span><span class="tok-s">&quot;123&quot;</span><span class="tok-nt">&gt;</span>...<span class="tok-nt">&lt;/cliente&gt;</span>
   <span class="tok-nt">&lt;importe&gt;</span>99.99<span class="tok-nt">&lt;/importe&gt;</span>
   <span class="tok-nt">&lt;lineas-pedido&gt;</span>
     ...
   <span class="tok-nt">&lt;/lineas-pedido&gt;</span>
<span class="tok-nt">&lt;/pedido&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Supongamos que un cliente quiere cancelar su pedido. PodrÃ­a simplemente invocar
la peticiÃ³n HTTP <code>DELETE /pedidos/333</code>. Esta no es siempre la mejor opciÃ³n, ya que
normalmente el sistema necesitarÃ¡ "retener" el pedido para propÃ³sitos de almacenaje.
Por ello, podrÃ­amos considerar una nueva representaciÃ³n del pedido con un elemento
<code>cancelado</code> a true:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml">PUT /pedidos/333 HTTP/1.1
Content-Type: application/xml
<span class="tok-nt">&lt;pedido</span> <span class="tok-na">id=</span><span class="tok-s">&quot;333&quot;</span><span class="tok-nt">&gt;</span>
   <span class="tok-nt">&lt;cliente</span> <span class="tok-na">id=</span><span class="tok-s">&quot;123&quot;</span><span class="tok-nt">&gt;</span>...<span class="tok-nt">&lt;/cliente&gt;</span>
   <span class="tok-nt">&lt;importe&gt;</span>99.99<span class="tok-nt">&lt;/importe&gt;</span>
   <span class="tok-nt">&lt;cancelado&gt;</span>true<span class="tok-nt">&lt;/cancelado&gt;</span>
   <span class="tok-nt">&lt;lineas-pedido&gt;</span>
        ...
   <span class="tok-nt">&lt;/lineas-pedido&gt;</span>
<span class="tok-nt">&lt;/pedido&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Pero, Â¿quÃ© ocurre si el pedido no puede cancelarse? Podemos tener un cierto estado en
nuestro proceso de pedidos en donde esta acciÃ³n no estÃ¡ permitida. Por  ejemplo, si el
pedido ya ha sido enviado, entonces no puede cancelarse. En este caso, realmente no
hay nigÃºn cÃ³digo de estado HTTP de respuesta que represente esta situaciÃ³n. Una mejor
aproximaciÃ³n es incluir un enlace para poder realizar la cancelaciÃ³n:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><span class="tok-nt">&lt;pedido</span> <span class="tok-na">id=</span><span class="tok-s">&quot;333&quot;</span><span class="tok-nt">&gt;</span>
   <span class="tok-nt">&lt;cliente</span> <span class="tok-na">id=</span><span class="tok-s">&quot;123&quot;</span><span class="tok-nt">&gt;</span>...<span class="tok-nt">&lt;/cliente&gt;</span>
   <span class="tok-nt">&lt;importe&gt;</span>99.99<span class="tok-nt">&lt;/importe&gt;</span>
   <span class="tok-nt">&lt;cancelado&gt;</span>false<span class="tok-nt">&lt;/cancelado&gt;</span>
   <span class="tok-nt">&lt;link</span> <span class="tok-na">rel=</span><span class="tok-s">&quot;cancelar&quot;</span>
        <span class="tok-na">href=</span><span class="tok-s">&quot;http://ejemplo.com/pedidos/333/cancelado&quot;</span><span class="tok-nt">/&gt;</span>
   <span class="tok-nt">&lt;lineas-pedido&gt;</span>
           ...
   <span class="tok-nt">&lt;/lineas-pedido&gt;</span>
<span class="tok-nt">&lt;/pedido&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>El cliente podrÃ­a invocar la orden: <code>GET /pedidos/333</code> y obtener el documento XML
que representa el pedido. Si el documento contiene el enlace <strong>cancelar</strong>, entonces
el cliente puede cambiar el estado del pedido a "cancelado" enviando una orden PUT vacÃ­a
a la URI referenciada en el enlace. Si el documento no contiene el enlace, el cliente
sabe que esta operaciÃ³n no es posible. Esto permite que el servicio web controle en
tiempo real la forma en la que el cliente interactua con el sistema.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_enlaces_en_cabeceras_frente_a_enlaces_atom">4.2.3. Enlaces en cabeceras frente a enlaces Atom</h4>
<div class="paragraph">
<p>Una alternativa al uso de enlaces Atom en el cuerpo de la respuesta, es utilizar
enlaces en las cabeceras de la respuesta (<a href="http://tools.ietf.org/html/rfc5988" class="bare">http://tools.ietf.org/html/rfc5988</a>). Vamos
a explicar Ã©sto con un ejemplo.</p>
</div>
<div class="paragraph">
<p>Consideremos el ejemplo de cancelaciÃ³n de un pedido que acabamos de ver.
En lugar de utilizar un enlace Atom para especificar si se permite o no la cancelaciÃ³n
del pedido, podemos utilizar la cabecera <code>Link</code> (es uno de los posibles campos que podemos
incluir como cabecera en una respuesta HTTP)).
De esta forma, si un usuario
envÃ­a la peticiÃ³n <code>GET /pedidos/333</code>, recibirÃ¡ la siguiente respuesta HTTP:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="sh">HTTP/1.1 <span class="tok-m">200</span> OK
Content-Type: application/xml
Link: &lt;http://ejemplo.com/pedidos/333/cancelado&gt;<span class="tok-p">;</span> <span class="tok-nv">rel</span><span class="tok-o">=</span>cancel

&lt;pedido <span class="tok-nv">id</span><span class="tok-o">=</span><span class="tok-s2">&quot;333&quot;</span>&gt;
   ...
&lt;/pedido&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>La cabecera <code>Link</code> tiene las mismas caracterÃ­sticas que un enlace Atom. La URI
estÃ¡ entre los signos <code>&lt;</code> y <code>&gt;</code> y estÃ¡ seguida por uno o mÃ¡s atributos delimitados
 por <code>;</code>. El atributo <code>rel</code> es obligatorio y tiene el mismo significado que el
 correspondiente atributo Atom com el mismo nombre. En el ejemplo no se muestra,
  pero podrÃ­amos especificar el <em>media type</em> utilizando el atributo <code>type</code>.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_hateoas_y_jax_rs">4.3. HATEOAS y JAX-RS</h3>
<div class="paragraph">
<p>JAX-RS no proporciona mucho soporte para implementar HATEOAS. HATEOAS se define por
 la aplicaciÃ³n, por lo que no hay mucho que pueda aportar ningÃºn <em>framework</em>. Lo que
 sÃ­ proporciona JAX-RS son algunas clases que podemos utilizar para construir las URIs
 de los enlaces HATEOAS.</p>
</div>
<div class="sect3">
<h4 id="_construcciÃ³n_de_uris_con_uribuilder">4.3.1. ConstrucciÃ³n de URIs con UriBuilder</h4>
<div class="paragraph">
<p>Una clase que podemos utilizar es <code>javax.ws.rs.core.UriBuilder</code>. Esta clase nos permite
construir URIs elemento a elemento, y tambiÃ©n permite incluir plantillas de parÃ¡metros
(segmentos de ruta variables).</p>
</div>
<div class="listingblock">
<div class="title">Clase UriBuilder: mÃ©todos para instanciar objetos de la clase</div>
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span class="tok-kd">public</span> <span class="tok-kd">abstract</span> <span class="tok-kd">class</span> <span class="tok-nc">UriBuilder</span> <span class="tok-o">{</span>
  <span class="tok-kd">public</span> <span class="tok-kd">static</span> <span class="tok-n">UriBuilder</span> <span class="tok-nf">fromUri</span><span class="tok-o">(</span><span class="tok-n">URI</span> <span class="tok-n">uri</span><span class="tok-o">)</span>
                <span class="tok-kd">throws</span> <span class="tok-n">IllegalArgumentException</span>
  <span class="tok-kd">public</span> <span class="tok-kd">static</span> <span class="tok-n">UriBuilder</span> <span class="tok-nf">fromUri</span><span class="tok-o">(</span><span class="tok-n">String</span> <span class="tok-n">uri</span><span class="tok-o">)</span>
                <span class="tok-kd">throws</span> <span class="tok-n">IllegalArgumentException</span>
  <span class="tok-kd">public</span> <span class="tok-kd">static</span> <span class="tok-n">UriBuilder</span> <span class="tok-nf">fromPath</span><span class="tok-o">(</span><span class="tok-n">String</span> <span class="tok-n">path</span><span class="tok-o">)</span>
                <span class="tok-kd">throws</span> <span class="tok-n">IllegalArgumentException</span>
  <span class="tok-kd">public</span> <span class="tok-kd">static</span> <span class="tok-n">UriBuilder</span> <span class="tok-nf">fromResource</span><span class="tok-o">(</span><span class="tok-n">Class</span><span class="tok-o">&lt;?&gt;</span> <span class="tok-n">resource</span><span class="tok-o">)</span>
                <span class="tok-kd">throws</span> <span class="tok-n">IllegalArgumentException</span>
  <span class="tok-kd">public</span> <span class="tok-kd">static</span> <span class="tok-n">UriBuilder</span> <span class="tok-nf">fromLink</span><span class="tok-o">(</span><span class="tok-n">Link</span> <span class="tok-n">link</span><span class="tok-o">)</span>
                <span class="tok-kd">throws</span> <span class="tok-n">IllegalArgumentException</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Las <strong>instancias</strong> de <code>UriBuilder</code> se obtienen a partir de mÃ©todos estÃ¡ticos con la forma
<code>fromXXX()</code>. Podemos inicializarlas a partir de una URI, una cadena de caracteres, o
la anotaciÃ³n @Path de una clase de recurso.</p>
</div>
<div class="paragraph">
<p>Para extraer, modificar y/o componer una URI, se pueden utilizar mÃ©todos como:</p>
</div>
<div class="listingblock">
<div class="title">Clase UriBuilder: mÃ©todos para "manipular" las URIs</div>
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span class="tok-kd">public</span> <span class="tok-kd">abstract</span> <span class="tok-n">UriBuilder</span> <span class="tok-nf">clone</span><span class="tok-o">();</span> <span class="tok-c1">// crea una copia</span>

<span class="tok-c1">// crea una copia con la informaciÃ³n de un objeto URI</span>
<span class="tok-kd">public</span> <span class="tok-kd">abstract</span> <span class="tok-n">UriBuilder</span> <span class="tok-nf">uri</span><span class="tok-o">(</span><span class="tok-n">URI</span> <span class="tok-n">uri</span><span class="tok-o">)</span>
                  <span class="tok-kd">throws</span> <span class="tok-n">IllegalArgumentException</span><span class="tok-o">;</span>

<span class="tok-c1">// mÃ©todos para asignar/modificar valores de</span>
<span class="tok-c1">// los atributos de los objetos UriBuilder</span>
<span class="tok-kd">public</span> <span class="tok-kd">abstract</span> <span class="tok-n">UriBuilder</span> <span class="tok-nf">scheme</span><span class="tok-o">(</span><span class="tok-n">String</span> <span class="tok-n">scheme</span><span class="tok-o">)</span>
                  <span class="tok-kd">throws</span> <span class="tok-n">IllegalArgumentException</span><span class="tok-o">;</span>
<span class="tok-kd">public</span> <span class="tok-kd">abstract</span> <span class="tok-n">UriBuilder</span> <span class="tok-nf">userInfo</span><span class="tok-o">(</span><span class="tok-n">String</span> <span class="tok-n">ui</span><span class="tok-o">);</span>
<span class="tok-kd">public</span> <span class="tok-kd">abstract</span> <span class="tok-n">UriBuilder</span> <span class="tok-nf">host</span><span class="tok-o">(</span><span class="tok-n">String</span> <span class="tok-n">host</span><span class="tok-o">)</span>
                  <span class="tok-kd">throws</span> <span class="tok-n">IllegalArgumentException</span><span class="tok-o">;</span>
<span class="tok-kd">public</span> <span class="tok-kd">abstract</span> <span class="tok-n">UriBuilder</span> <span class="tok-nf">port</span><span class="tok-o">(</span><span class="tok-kt">int</span> <span class="tok-n">port</span><span class="tok-o">)</span>
                  <span class="tok-kd">throws</span> <span class="tok-n">IllegalArgumentException</span><span class="tok-o">;</span>
<span class="tok-kd">public</span> <span class="tok-kd">abstract</span> <span class="tok-n">UriBuilder</span> <span class="tok-nf">replacePath</span><span class="tok-o">(</span><span class="tok-n">String</span> <span class="tok-n">path</span><span class="tok-o">);</span>

<span class="tok-c1">// mÃ©todos que aÃ±aden elementos a nuestra URI</span>
<span class="tok-kd">public</span> <span class="tok-kd">abstract</span> <span class="tok-n">UriBuilder</span> <span class="tok-nf">path</span><span class="tok-o">(</span><span class="tok-n">String</span> <span class="tok-n">path</span><span class="tok-o">)</span>
<span class="tok-kd">public</span> <span class="tok-kd">abstract</span> <span class="tok-n">UriBuilder</span> <span class="tok-nf">segment</span><span class="tok-o">(</span><span class="tok-n">String</span><span class="tok-o">...</span> <span class="tok-n">segments</span><span class="tok-o">)</span>
<span class="tok-kd">public</span> <span class="tok-kd">abstract</span> <span class="tok-n">UriBuilder</span> <span class="tok-nf">matrixParam</span><span class="tok-o">(</span><span class="tok-n">String</span> <span class="tok-n">name</span><span class="tok-o">,</span>
                                       <span class="tok-n">Object</span><span class="tok-o">...</span> <span class="tok-n">values</span><span class="tok-o">)</span>
<span class="tok-kd">public</span> <span class="tok-kd">abstract</span> <span class="tok-n">UriBuilder</span> <span class="tok-nf">queryParam</span><span class="tok-o">(</span><span class="tok-n">String</span> <span class="tok-n">name</span><span class="tok-o">,</span>
                                      <span class="tok-n">Object</span><span class="tok-o">...</span> <span class="tok-n">values</span><span class="tok-o">)</span>

<span class="tok-c1">// mÃ©todo que instancia el valor de una plantilla de la URI</span>
<span class="tok-kd">public</span> <span class="tok-kd">abstract</span> <span class="tok-n">UriBuilder</span> <span class="tok-nf">resolveTemplate</span><span class="tok-o">(</span><span class="tok-n">String</span> <span class="tok-n">name</span><span class="tok-o">,</span>
                                      <span class="tok-n">Object</span> <span class="tok-n">value</span><span class="tok-o">)</span>
<span class="tok-err">ï¿¼</span><span class="tok-o">...</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Los mÃ©todos <code>build()</code> construyen la URI. Ãsta puede contener plantillas de parÃ¡metros (
segmentos de ruta variables), que deberemos inicializar utilizando pares nombre/valor,
o bien una lista de valores que reemplazarÃ¡n a los parÃ¡metros de la plantilla en el orden
 en el que aparezcan.</p>
</div>
<div class="listingblock">
<div class="title">Clase UriBuilder: mÃ©todos buildXXX() para construir las URIs</div>
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span class="tok-kd">public</span> <span class="tok-kd">abstract</span> <span class="tok-n">URI</span> <span class="tok-nf">buildFromMap</span><span class="tok-o">(</span><span class="tok-n">Map</span><span class="tok-o">&lt;</span><span class="tok-n">String</span><span class="tok-o">,</span> <span class="tok-o">?</span> <span class="tok-kd">extends</span> <span class="tok-n">Object</span><span class="tok-o">&gt;</span> <span class="tok-n">values</span><span class="tok-o">)</span>
                <span class="tok-kd">throws</span> <span class="tok-n">IllegalArgumentException</span><span class="tok-o">,</span> <span class="tok-n">UriBuilderException</span><span class="tok-o">;</span>

<span class="tok-kd">public</span> <span class="tok-kd">abstract</span> <span class="tok-n">URI</span> <span class="tok-nf">build</span><span class="tok-o">(</span><span class="tok-n">Object</span><span class="tok-o">...</span> <span class="tok-n">values</span><span class="tok-o">)</span>
                <span class="tok-kd">throws</span> <span class="tok-n">IllegalArgumentException</span><span class="tok-o">,</span> <span class="tok-n">UriBuilderException</span><span class="tok-o">;</span>
<span class="tok-o">...</span>
<span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Veamos algÃºn ejemplo que muestra cÃ³mo crear, inicializar, componer y construir una URI
utilizando un <code>UriBuilder</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span class="tok-n">UriBuilder</span> <span class="tok-n">builder</span> <span class="tok-o">=</span> <span class="tok-n">UriBuilder</span><span class="tok-o">.</span><span class="tok-na">fromPath</span><span class="tok-o">(</span><span class="tok-s">&quot;/clientes/{id}&quot;</span><span class="tok-o">);</span>
<span class="tok-n">builder</span><span class="tok-o">.</span><span class="tok-na">scheme</span><span class="tok-o">(</span><span class="tok-s">&quot;http&quot;</span><span class="tok-o">)</span>
       <span class="tok-o">.</span><span class="tok-na">host</span><span class="tok-o">(</span><span class="tok-s">&quot;{hostname}&quot;</span><span class="tok-o">)</span>
       <span class="tok-o">.</span><span class="tok-na">queryParam</span><span class="tok-o">(</span><span class="tok-s">&quot;param={param}&quot;</span><span class="tok-o">);</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Con este cÃ³digo, estamos definiendo una URI como:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>http://{hostname}/clientes/{id}?param={param}</pre>
</div>
</div>
<div class="paragraph">
<p>Puesto que tenemos plantillas de parÃ¡metros, necesitamos inicializarlos con
 valores que pasaremos como argumentos para crear la URI final. Si queremos
 reutilizar la URI que contiene las plantillas, deberÃ­amos realizar una llamada a
  <code>clone()</code> antes de llamar al mÃ©todo <code>build()</code>, ya que Ã©ste reemplazarÃ¡ los parÃ¡metros
  de las plantillas en la estructura interna del objeto:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span class="tok-n">UriBuilder</span> <span class="tok-n">clone</span> <span class="tok-o">=</span> <span class="tok-n">builder</span><span class="tok-o">.</span><span class="tok-na">clone</span><span class="tok-o">();</span>
<span class="tok-n">URI</span> <span class="tok-n">uri</span> <span class="tok-o">=</span> <span class="tok-n">clone</span><span class="tok-o">.</span><span class="tok-na">build</span><span class="tok-o">(</span><span class="tok-s">&quot;ejemplo.com&quot;</span><span class="tok-o">,</span> <span class="tok-s">&quot;333&quot;</span><span class="tok-o">,</span> <span class="tok-s">&quot;valor&quot;</span><span class="tok-o">);</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>El cÃ³digo anterior darÃ­a lugar a la siguiente URI:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>http://ejemplo.com/clientes/333?param=valor</pre>
</div>
</div>
<div class="paragraph">
<p>TambiÃ©n podemos definir un objeto de tipo <code>Map</code> que contenga los valores de las
plantillas:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span class="tok-n">Map</span><span class="tok-o">&lt;</span><span class="tok-n">String</span><span class="tok-o">,</span> <span class="tok-n">Object</span><span class="tok-o">&gt;</span> <span class="tok-n">map</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">HashMap</span><span class="tok-o">&lt;</span><span class="tok-n">String</span><span class="tok-o">,</span> <span class="tok-n">Object</span><span class="tok-o">&gt;();</span>
<span class="tok-n">map</span><span class="tok-o">.</span><span class="tok-na">put</span><span class="tok-o">(</span><span class="tok-s">&quot;hostname&quot;</span><span class="tok-o">,</span> <span class="tok-s">&quot;ejemplo.com&quot;</span><span class="tok-o">);</span>
<span class="tok-n">map</span><span class="tok-o">.</span><span class="tok-na">put</span><span class="tok-o">(</span><span class="tok-s">&quot;id&quot;</span><span class="tok-o">,</span> <span class="tok-mi">333</span><span class="tok-o">);</span>
<span class="tok-n">map</span><span class="tok-o">.</span><span class="tok-na">put</span><span class="tok-o">(</span><span class="tok-s">&quot;param&quot;</span><span class="tok-o">,</span> <span class="tok-s">&quot;valor&quot;</span><span class="tok-o">);</span>
<span class="tok-n">UriBuilder</span> <span class="tok-n">clone</span> <span class="tok-o">=</span> <span class="tok-n">builder</span><span class="tok-o">.</span><span class="tok-na">clone</span><span class="tok-o">();</span>
<span class="tok-n">URI</span> <span class="tok-n">uri</span> <span class="tok-o">=</span> <span class="tok-n">clone</span><span class="tok-o">.</span><span class="tok-na">buildFromMap</span><span class="tok-o">(</span><span class="tok-n">map</span><span class="tok-o">);</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Otro ejemplo interesante es el de crear una URI a partir de las expresiones @Path
definidas en las clases JAX-RS anotadas. A continuaciÃ³n mostramos el cÃ³digo:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span class="tok-nd">@Path</span><span class="tok-o">(</span><span class="tok-s">&quot;/clientes&quot;</span><span class="tok-o">)</span>
<span class="tok-kd">public</span> <span class="tok-kd">class</span> <span class="tok-nc">ServicioClientes</span> <span class="tok-o">{</span>

   <span class="tok-nd">@Path</span><span class="tok-o">(</span><span class="tok-s">&quot;{id}&quot;</span><span class="tok-o">)</span>
   <span class="tok-kd">public</span> <span class="tok-n">Cliente</span> <span class="tok-nf">getCliente</span><span class="tok-o">(</span><span class="tok-nd">@PathParam</span><span class="tok-o">(</span><span class="tok-s">&quot;id&quot;</span><span class="tok-o">)</span> <span class="tok-kt">int</span> <span class="tok-n">id</span><span class="tok-o">)</span> <span class="tok-o">{...}</span>
<span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Podemos referenciar esta clase y el mÃ©todo <code>getCliente()</code> a travÃ©s de la clase
<code>UriBuilder</code> de la siguiente forma:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span class="tok-n">UriBuilder</span> <span class="tok-n">builder</span> <span class="tok-o">=</span> <span class="tok-n">UriBuilder</span><span class="tok-o">.</span><span class="tok-na">fromResource</span><span class="tok-o">(</span><span class="tok-n">ServicioClientes</span><span class="tok-o">.</span><span class="tok-na">class</span><span class="tok-o">);</span>
<span class="tok-n">builder</span><span class="tok-o">.</span><span class="tok-na">host</span><span class="tok-o">(</span><span class="tok-s">&quot;{hostname}&quot;</span><span class="tok-o">)</span>
<span class="tok-n">builder</span><span class="tok-o">.</span><span class="tok-na">path</span><span class="tok-o">(</span><span class="tok-n">ServicioClientes</span><span class="tok-o">.</span><span class="tok-na">class</span><span class="tok-o">,</span> <span class="tok-s">&quot;getCliente&quot;</span><span class="tok-o">);</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>El cÃ³digo anterior define la siguiente plantilla para la URI:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>http://{hostname}/clientes/{id}</pre>
</div>
</div>
<div class="paragraph">
<p>A partir de esta plantilla, podremos construir la URI utilizando alguno de los
mÃ©todos `buildXXX().</p>
</div>
<div class="paragraph">
<p>TambiÃ©n podemos querer utilizar UriBuilder para crear URIS a partir de plantillas. Para ello disponemos
de mÃ©todos <code>resolveTemplateXXX()</code>, que nos facilitan el trabajo:</p>
</div>
<div class="listingblock">
<div class="title">Clase UriBuilder: mÃ©todos resolveTemplateXXX() para crear URIs a partir de plantillas</div>
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span class="tok-kd">public</span> <span class="tok-kd">abstract</span> <span class="tok-n">UriBuilder</span> <span class="tok-nf">resolveTemplate</span><span class="tok-o">(</span><span class="tok-n">String</span> <span class="tok-n">name</span><span class="tok-o">,</span> <span class="tok-n">Object</span> <span class="tok-n">value</span><span class="tok-o">);</span>
<span class="tok-kd">public</span> <span class="tok-kd">abstract</span> <span class="tok-n">UriBuilder</span> <span class="tok-nf">resolveTemplate</span><span class="tok-o">(</span><span class="tok-n">String</span> <span class="tok-n">name</span><span class="tok-o">,</span> <span class="tok-n">Object</span> <span class="tok-n">value</span><span class="tok-o">,</span>
                                          <span class="tok-kt">boolean</span> <span class="tok-n">encodeSlashInPath</span><span class="tok-o">);</span>
<span class="tok-kd">public</span> <span class="tok-kd">abstract</span> <span class="tok-n">UriBuilder</span> <span class="tok-nf">resolveTemplateFromEncoded</span><span class="tok-o">(</span><span class="tok-n">String</span> <span class="tok-n">name</span><span class="tok-o">,</span><span class="tok-n">Object</span> <span class="tok-n">value</span><span class="tok-o">);</span>
<span class="tok-kd">public</span> <span class="tok-kd">abstract</span> <span class="tok-n">UriBuilder</span> <span class="tok-nf">resolveTemplates</span><span class="tok-o">(</span><span class="tok-n">Map</span><span class="tok-o">&lt;</span><span class="tok-n">String</span><span class="tok-o">,</span> <span class="tok-n">Object</span><span class="tok-o">&gt;</span> <span class="tok-n">templateValues</span><span class="tok-o">);</span>
<span class="tok-kd">public</span> <span class="tok-kd">abstract</span> <span class="tok-n">UriBuilder</span> <span class="tok-nf">resolveTemplates</span><span class="tok-o">(</span>
              <span class="tok-n">Map</span><span class="tok-o">&lt;</span><span class="tok-n">String</span><span class="tok-o">,</span><span class="tok-n">Object</span><span class="tok-o">&gt;</span> <span class="tok-n">templateValues</span><span class="tok-o">,</span> <span class="tok-kt">boolean</span> <span class="tok-n">encodeSlashInPath</span><span class="tok-o">)</span>
                                          <span class="tok-kd">throws</span> <span class="tok-n">IllegalArgumentException</span><span class="tok-o">;</span>
<span class="tok-kd">public</span> <span class="tok-kd">abstract</span> <span class="tok-n">UriBuilder</span> <span class="tok-nf">resolveTemplatesFromEncoded</span><span class="tok-o">(</span>
                                 <span class="tok-n">Map</span><span class="tok-o">&lt;</span><span class="tok-n">String</span><span class="tok-o">,</span> <span class="tok-n">Object</span><span class="tok-o">&gt;</span> <span class="tok-n">templateValues</span><span class="tok-o">);</span>
<span class="tok-c1">// Devuelve la URI de la plantilla como una cadena de caracteres</span>
<span class="tok-kd">public</span> <span class="tok-kd">abstract</span> <span class="tok-n">String</span> <span class="tok-nf">toTemplate</span><span class="tok-o">()</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Funcionan de forma similar a los mÃ©todos <code>build()</code> y se utilizan para resolver
parcialmente las plantillas contenidas en la URI. Cada uno de los mÃ©todos devuelve
una nueva instancia de UriBuilder, de forma que podemos "encadenar" varias llamadas
para resolver todas las plantillas de la URI. Finalmente, usaremos el mÃ©todo <code>toTemplate()</code>
para obtener la nueva plantilla en forma de <code>String</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span class="tok-n">String</span> <span class="tok-n">original</span> <span class="tok-o">=</span> <span class="tok-s">&quot;http://{host}/{id}&quot;</span><span class="tok-o">;</span>
<span class="tok-n">String</span> <span class="tok-n">nuevaPlantilla</span> <span class="tok-o">=</span> <span class="tok-n">UriBuilder</span><span class="tok-o">.</span><span class="tok-na">fromUri</span><span class="tok-o">(</span><span class="tok-n">original</span><span class="tok-o">)</span>
                        <span class="tok-o">.</span><span class="tok-na">resolveTemplate</span><span class="tok-o">(</span><span class="tok-s">&quot;host&quot;</span><span class="tok-o">,</span> <span class="tok-s">&quot;localhost&quot;</span><span class="tok-o">)</span>
                        <span class="tok-o">.</span><span class="tok-na">toTemplate</span><span class="tok-o">();</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>El valor de <em>nuevaPlantilla</em> para el cÃ³digo anterior serÃ­a: "http://localhost/{id}"</p>
</div>
</div>
<div class="sect3">
<h4 id="_uris_relativas_mediante_el_uso_de_uriinfo">4.3.2. URIs relativas mediante el uso de UriInfo</h4>
<div class="paragraph">
<p>Cuando estamos escribiendo servicios que "distribuyen" enlaces, hay cierta informaciÃ³n
que probablemente no conozcamos cuando estamos escribiendo el cÃ³digo. Por ejemplo,
podemos no conocer todavÃ­a los <em>hostnames</em> de los enlaces, o incluso los <em>base paths</em>
de las URIs, en el caso de que estemos enlazando con otros servicios REST.</p>
</div>
<div class="paragraph">
<p>JAX-RS proporciona una forma sencilla de solucionar estos problemas utilizando la
interfaz <code>javax.ws.rs.core.UriInfo</code>. Ya hemos introducido algunas caracterÃ­sticas de
esta interfaz en sesiones anteriores. AdemÃ¡s de poder consultar informaciÃ³n bÃ¡sica de la
ruta, tambiÃ©n podemos obtener instancias de UriBuilder preinicializadas con la URI
base utilizada para definir los servicios JAX-RS, o la URI utilizada para invocar
la peticiÃ³n HTTP actual:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span class="tok-kd">public</span> <span class="tok-kd">interface</span> <span class="tok-nc">UriInfo</span> <span class="tok-o">{</span>
  <span class="tok-kd">public</span> <span class="tok-n">URI</span> <span class="tok-nf">getRequestUri</span><span class="tok-o">();</span>
  <span class="tok-kd">public</span> <span class="tok-n">UriBuilder</span> <span class="tok-nf">getRequestUriBuilder</span><span class="tok-o">();</span>
  <span class="tok-kd">public</span> <span class="tok-n">URI</span> <span class="tok-nf">getAbsolutePath</span><span class="tok-o">();</span>
  <span class="tok-kd">public</span> <span class="tok-n">UriBuilder</span> <span class="tok-nf">getAbsolutePathBuilder</span><span class="tok-o">();</span>
  <span class="tok-kd">public</span> <span class="tok-n">URI</span> <span class="tok-nf">getBaseUri</span><span class="tok-o">();</span>
  <span class="tok-kd">public</span> <span class="tok-n">UriBuilder</span> <span class="tok-nf">getBaseUriBuilder</span><span class="tok-o">();</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Por ejemplo, supongamos que tenemos un servicio que permite acceder a Clientes desde una
base de datos. En lugar de tener una URI base que devuelva todos los clientes en un
Ãºnico documento, podemos incluir los enlaces <code>previo</code> y <code>sigiente</code>, de forma que podamos
"navegar" por los datos. Vamos a mostrar cÃ³mo crear estos enlaces utilizando la URI para
 invocar la peticiÃ³n:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span class="tok-nd">@Path</span><span class="tok-o">(</span><span class="tok-s">&quot;/clientes&quot;</span><span class="tok-o">)</span>
<span class="tok-kd">public</span> <span class="tok-kd">class</span> <span class="tok-nc">ServicioClientes</span> <span class="tok-o">{</span>
  <span class="tok-nd">@GET</span>
  <span class="tok-nd">@Produces</span><span class="tok-o">(</span><span class="tok-s">&quot;application/xml&quot;</span><span class="tok-o">)</span>
  <span class="tok-kd">public</span> <span class="tok-n">String</span> <span class="tok-nf">getCustomers</span><span class="tok-o">(</span><span class="tok-nd">@Context</span> <span class="tok-n">UriInfo</span> <span class="tok-n">uriInfo</span><span class="tok-o">)</span> <span class="tok-o">{</span> <i class="conum" data-value="1"></i><b>(1)</b>
    <span class="tok-n">UriBuilder</span> <span class="tok-n">nextLinkBuilder</span> <span class="tok-o">=</span> <span class="tok-n">uriInfo</span><span class="tok-o">.</span><span class="tok-na">getAbsolutePathBuilder</span><span class="tok-o">();</span> <i class="conum" data-value="2"></i><b>(2)</b>
    <span class="tok-n">nextLinkBuilder</span><span class="tok-o">.</span><span class="tok-na">queryParam</span><span class="tok-o">(</span><span class="tok-s">&quot;inicio&quot;</span><span class="tok-o">,</span> <span class="tok-mi">5</span><span class="tok-o">);</span>
    <span class="tok-n">nextLinkBuilder</span><span class="tok-o">.</span><span class="tok-na">queryParam</span><span class="tok-o">(</span><span class="tok-s">&quot;total&quot;</span><span class="tok-o">,</span> <span class="tok-mi">10</span><span class="tok-o">);</span>
    <span class="tok-n">URI</span> <span class="tok-n">next</span> <span class="tok-o">=</span> <span class="tok-n">nextLinkBuilder</span><span class="tok-o">.</span><span class="tok-na">build</span><span class="tok-o">();</span>
    <span class="tok-c1">//... rellenar el resto del documento ...</span>
  <span class="tok-o">}</span>
 <span class="tok-o">...</span>
<span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Para acceder a la instancia <code>UriInfo</code> que representa al peticiÃ³n, usamos la anotaciÃ³n
<code>javax.ws.rs.core.Context</code>, para inyectarla como un parÃ¡metro del mÃ©todo del recurso REST</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Obtenemos un <code>UriBuilder</code> preininicializado con la URI utilizada para acceder al
servicio</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Para el cÃ³digo anterior, y dependiendo de cÃ³mo se despliegue el servicio, la URI creada
podrÃ­a ser:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>http://org.expertojava/jaxrs/clientes?inicio=5&amp;total=10</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_construcciÃ³n_de_enlaces_links_en_documentos_xml_y_en_cabeceras_http">4.3.3. ConstrucciÃ³n de enlaces (Links) en documentos XML y en cabeceras HTTP</h4>
<div class="paragraph">
<p>JAX-RS proporciona cierto soporte para construir los enlaces y devolverlos en las
 cabeceras de respuesta, o bien incluirlos
en los documentos XML. Para ello podemos utilizar las clases <code>java.ws.rs.core.Link</code>
y <code>java.ws.rs.core.Link.Builder</code>.</p>
</div>
<div class="listingblock">
<div class="title">Clase abstracta javax.ws.rs.core.Link</div>
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span class="tok-kd">public</span> <span class="tok-kd">abstract</span> <span class="tok-kd">class</span> <span class="tok-nc">Link</span> <span class="tok-o">{</span>
  <span class="tok-kd">public</span> <span class="tok-kd">abstract</span> <span class="tok-n">URI</span> <span class="tok-nf">getUri</span><span class="tok-o">();</span>
  <span class="tok-kd">public</span> <span class="tok-kd">abstract</span> <span class="tok-n">UriBuilder</span> <span class="tok-nf">getUriBuilder</span><span class="tok-o">();</span>
  <span class="tok-kd">public</span> <span class="tok-kd">abstract</span> <span class="tok-n">String</span> <span class="tok-nf">getRel</span><span class="tok-o">();</span>
  <span class="tok-kd">public</span> <span class="tok-kd">abstract</span> <span class="tok-n">List</span><span class="tok-o">&lt;</span><span class="tok-n">String</span><span class="tok-o">&gt;</span> <span class="tok-nf">getRels</span><span class="tok-o">();</span>
  <span class="tok-kd">public</span> <span class="tok-kd">abstract</span> <span class="tok-n">String</span> <span class="tok-nf">getTitle</span><span class="tok-o">();</span>
  <span class="tok-kd">public</span> <span class="tok-kd">abstract</span> <span class="tok-n">String</span> <span class="tok-nf">getType</span><span class="tok-o">();</span>
  <span class="tok-kd">public</span> <span class="tok-kd">abstract</span> <span class="tok-n">Map</span><span class="tok-o">&lt;</span><span class="tok-n">String</span><span class="tok-o">,</span> <span class="tok-n">String</span><span class="tok-o">&gt;</span> <span class="tok-nf">getParams</span><span class="tok-o">();</span>
  <span class="tok-kd">public</span> <span class="tok-kd">abstract</span> <span class="tok-n">String</span> <span class="tok-nf">toString</span><span class="tok-o">();</span>
<span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p><code>Link</code> es una clase abstracta que representa todos los metadatos contenidos en una
cabecera o en un enlace Atom. El mÃ©todo <code>getUri()</code> representa el atributo <code>href</code> del enlace
Atom. El mÃ©todo <code>getRel()</code> representa el atributo <code>rel</code>, y asÃ­ sucesivamente. Podemos
referenciar a todos los atributos a travÃ©s del mÃ©todo <code>getParams()</code>. Finalmente,
el mÃ©todo <code>toString()</code> convertirÃ¡ la instancia <code>Link</code> en una cadena de caracteres con
el formato de una cabecera <code>Link</code>.</p>
</div>
<div class="paragraph">
<p>Para crear instancias de <code>Link</code> utilizaremos un <code>Link.Builder</code>, que crearemos con
alguno de estos mÃ©todos:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span class="tok-kd">public</span> <span class="tok-kd">abstract</span> <span class="tok-kd">class</span> <span class="tok-nc">Link</span> <span class="tok-o">{</span>
   <span class="tok-kd">public</span> <span class="tok-kd">static</span> <span class="tok-n">Builder</span> <span class="tok-nf">fromUri</span><span class="tok-o">(</span><span class="tok-n">URI</span> <span class="tok-n">uri</span><span class="tok-o">)</span>
   <span class="tok-kd">public</span> <span class="tok-kd">static</span> <span class="tok-n">Builder</span> <span class="tok-nf">fromUri</span><span class="tok-o">(</span><span class="tok-n">String</span> <span class="tok-n">uri</span><span class="tok-o">)</span>
   <span class="tok-kd">public</span> <span class="tok-kd">static</span> <span class="tok-n">Builder</span> <span class="tok-nf">fromUriBuilder</span><span class="tok-o">(</span><span class="tok-n">UriBuilder</span> <span class="tok-n">uriBuilder</span><span class="tok-o">)</span>
   <span class="tok-kd">public</span> <span class="tok-kd">static</span> <span class="tok-n">Builder</span> <span class="tok-nf">fromLink</span><span class="tok-o">(</span><span class="tok-n">Link</span> <span class="tok-n">link</span><span class="tok-o">)</span>
   <span class="tok-kd">public</span> <span class="tok-kd">static</span> <span class="tok-n">Builder</span> <span class="tok-nf">fromPath</span><span class="tok-o">(</span><span class="tok-n">String</span> <span class="tok-n">path</span><span class="tok-o">)</span>
   <span class="tok-kd">public</span> <span class="tok-kd">static</span> <span class="tok-n">Builder</span> <span class="tok-nf">fromResource</span><span class="tok-o">(</span><span class="tok-n">Class</span><span class="tok-o">&lt;?&gt;</span> <span class="tok-n">resource</span><span class="tok-o">)</span>
   <span class="tok-kd">public</span> <span class="tok-kd">static</span> <span class="tok-n">Builder</span> <span class="tok-nf">fromMethod</span><span class="tok-o">(</span><span class="tok-n">Class</span><span class="tok-o">&lt;?&gt;</span> <span class="tok-n">resource</span><span class="tok-o">,</span> <span class="tok-n">String</span> <span class="tok-n">method</span><span class="tok-o">)</span>
   <span class="tok-o">...</span>
<span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Los mÃ©todos <code>fromXXX()</code> funcionan de forma similar a <code>UriBuilder.fromXXX()</code>.
Todos inicializan el <code>UriBuilder</code> subyacente  que utilizaremos para construir el atributo
<code>href</code> del enlace.</p>
</div>
<div class="paragraph">
<p>Los mÃ©todos <code>link()</code>, <code>uri()</code>, y <code>uriBuilder()</code> nos permiten sobreescribir la
URI subyacente del enlace que estamos creando:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span class="tok-kd">public</span> <span class="tok-kd">abstract</span> <span class="tok-kd">class</span> <span class="tok-nc">Link</span> <span class="tok-o">{</span>
  <span class="tok-kd">interface</span> <span class="tok-nc">Builder</span> <span class="tok-o">{</span>
      <span class="tok-kd">public</span> <span class="tok-n">Builder</span> <span class="tok-nf">link</span><span class="tok-o">(</span><span class="tok-n">Link</span> <span class="tok-n">link</span><span class="tok-o">);</span>
      <span class="tok-kd">public</span> <span class="tok-n">Builder</span> <span class="tok-nf">link</span><span class="tok-o">(</span><span class="tok-n">String</span> <span class="tok-n">link</span><span class="tok-o">);</span>
      <span class="tok-kd">public</span> <span class="tok-n">Builder</span> <span class="tok-nf">uri</span><span class="tok-o">(</span><span class="tok-n">URI</span> <span class="tok-n">uri</span><span class="tok-o">);</span>
      <span class="tok-kd">public</span> <span class="tok-n">Builder</span> <span class="tok-nf">uri</span><span class="tok-o">(</span><span class="tok-n">String</span> <span class="tok-n">uri</span><span class="tok-o">);</span>
      <span class="tok-kd">public</span> <span class="tok-n">Builder</span> <span class="tok-nf">uriBuilder</span><span class="tok-o">(</span><span class="tok-n">UriBuilder</span> <span class="tok-n">uriBuilder</span><span class="tok-o">);</span>
      <span class="tok-o">...</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Los siguientes mÃ©todos nos permiten asignar valores a varios atributos del enlace
que estamos construyendo:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java">      <span class="tok-o">...</span>
      <span class="tok-kd">public</span> <span class="tok-n">Builder</span> <span class="tok-nf">rel</span><span class="tok-o">(</span><span class="tok-n">String</span> <span class="tok-n">rel</span><span class="tok-o">);</span>
      <span class="tok-kd">public</span> <span class="tok-n">Builder</span> <span class="tok-nf">title</span><span class="tok-o">(</span><span class="tok-n">String</span> <span class="tok-n">title</span><span class="tok-o">);</span>
      <span class="tok-kd">public</span> <span class="tok-n">Builder</span> <span class="tok-nf">type</span><span class="tok-o">(</span><span class="tok-n">String</span> <span class="tok-n">type</span><span class="tok-o">);</span>
      <span class="tok-kd">public</span> <span class="tok-n">Builder</span> <span class="tok-nf">param</span><span class="tok-o">(</span><span class="tok-n">String</span> <span class="tok-n">name</span><span class="tok-o">,</span> <span class="tok-n">String</span> <span class="tok-n">value</span><span class="tok-o">);</span>
      <span class="tok-o">...</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Finalmente, Ã©l mÃ©todo <code>build()</code> nos permitirÃ¡ construir el enlace:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span class="tok-kd">public</span> <span class="tok-n">Link</span> <span class="tok-nf">build</span><span class="tok-o">(</span><span class="tok-n">Object</span><span class="tok-o">...</span> <span class="tok-n">values</span><span class="tok-o">);</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>El objeto <code>Link.Builder</code> tiene asociado una <code>UriBuilder</code> subyacente. Los valores
pasados como parÃ¡metros del mÃ©todo <code>build()</code> son utilizados por el <code>UriBuilder</code> para
crear una URI para el enlace. Veamos un ejemplo:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span class="tok-n">Link</span> <span class="tok-n">link</span> <span class="tok-o">=</span> <span class="tok-n">Link</span><span class="tok-o">.</span><span class="tok-na">fromUri</span><span class="tok-o">(</span><span class="tok-s">&quot;http://{host}/raiz/clientes/{id}&quot;</span><span class="tok-o">)</span>
                <span class="tok-o">.</span><span class="tok-na">rel</span><span class="tok-o">(</span><span class="tok-s">&quot;update&quot;</span><span class="tok-o">).</span><span class="tok-na">type</span><span class="tok-o">(</span><span class="tok-s">&quot;text/plain&quot;</span><span class="tok-o">)</span>
                <span class="tok-o">.</span><span class="tok-na">build</span><span class="tok-o">(</span><span class="tok-s">&quot;localhost&quot;</span><span class="tok-o">,</span> <span class="tok-s">&quot;1234&quot;</span><span class="tok-o">);</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Si realizamos una llamada a <code>toString()</code> sobre la instancia del enlace (<code>link</code>),
obtendremos lo siguiente:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml">http://localhost/raiz/clientes/1234&gt;; rel=&quot;update&quot;; type=&quot;text/plain&quot;</code></pre>
</div>
</div>
<div class="paragraph">
<p>A continuaciÃ³n mostramos dos ejemplos que muestran cÃ³mo crear instancias <code>Link</code> en
las cabeceras, y en el cuerpo de la respuesta como un enlace Atom:</p>
</div>
<div class="listingblock">
<div class="title">Escritura de enlaces en cabeceras HTTP</div>
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span class="tok-nd">@Path</span>
<span class="tok-nd">@GET</span>
<span class="tok-n">Response</span> <span class="tok-nf">get</span><span class="tok-o">()</span> <span class="tok-o">{</span>
    <span class="tok-n">Link</span> <span class="tok-n">link</span> <span class="tok-o">=</span> <span class="tok-n">Link</span><span class="tok-o">.</span><span class="tok-na">fromUri</span><span class="tok-o">(</span><span class="tok-s">&quot;a/b/c&quot;</span><span class="tok-o">).</span><span class="tok-na">build</span><span class="tok-o">();</span>
    <span class="tok-n">Response</span> <span class="tok-n">response</span> <span class="tok-o">=</span> <span class="tok-n">Response</span><span class="tok-o">.</span><span class="tok-na">noContent</span><span class="tok-o">()</span>
                                <span class="tok-o">.</span><span class="tok-na">links</span><span class="tok-o">(</span><span class="tok-n">link</span><span class="tok-o">)</span>
                                <span class="tok-o">.</span><span class="tok-na">build</span><span class="tok-o">();</span>
    <span class="tok-k">return</span> <span class="tok-n">response</span><span class="tok-o">;</span> <span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">InclusiÃ³n de un enlace Atom en el documento XMl de respuesta</div>
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span class="tok-kn">import</span> <span class="tok-nn">javax.ws.rs.core.Link</span><span class="tok-o">;</span>

<span class="tok-nd">@XmlRootElement</span>
<span class="tok-kd">public</span> <span class="tok-kd">class</span> <span class="tok-nc">Cliente</span> <span class="tok-o">{</span>
  <span class="tok-kd">private</span> <span class="tok-n">String</span> <span class="tok-n">nombre</span><span class="tok-o">;</span>
  <span class="tok-kd">private</span> <span class="tok-n">List</span><span class="tok-o">&lt;</span><span class="tok-n">Link</span><span class="tok-o">&gt;</span> <span class="tok-n">enlaces</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">ArrayList</span><span class="tok-o">&lt;</span><span class="tok-n">Link</span><span class="tok-o">&gt;();</span>

  <span class="tok-nd">@XmlElement</span>
  <span class="tok-kd">public</span> <span class="tok-n">String</span> <span class="tok-nf">getNombre</span><span class="tok-o">()</span> <span class="tok-o">{</span>
    <span class="tok-k">return</span> <span class="tok-n">nombre</span><span class="tok-o">;</span>
  <span class="tok-o">}</span>

  <span class="tok-kd">public</span> <span class="tok-kt">void</span> <span class="tok-nf">setNombre</span><span class="tok-o">(</span><span class="tok-n">String</span> <span class="tok-n">nom</span><span class="tok-o">)</span> <span class="tok-o">{</span>
    <span class="tok-k">this</span><span class="tok-o">.</span><span class="tok-na">nombre</span> <span class="tok-o">=</span> <span class="tok-n">nom</span><span class="tok-o">;</span>
  <span class="tok-o">}</span>

  <span class="tok-nd">@XmlElement</span><span class="tok-o">(</span><span class="tok-n">name</span> <span class="tok-o">=</span> <span class="tok-s">&quot;enlace&quot;</span><span class="tok-o">)</span>
  <span class="tok-nd">@XmlJavaTypeAdapter</span><span class="tok-o">(</span><span class="tok-n">Link</span><span class="tok-o">.</span><span class="tok-na">JaxbAdapter</span><span class="tok-o">.</span><span class="tok-na">class</span><span class="tok-o">)</span> <i class="conum" data-value="1"></i><b>(1)</b>
  <span class="tok-kd">public</span> <span class="tok-n">List</span><span class="tok-o">&lt;</span><span class="tok-n">Link</span><span class="tok-o">&gt;</span> <span class="tok-nf">getEnlaces</span><span class="tok-o">()</span> <span class="tok-o">{</span>
    <span class="tok-k">return</span> <span class="tok-n">enlaces</span><span class="tok-o">;</span> <span class="tok-o">}</span>
  <span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>La clase <code>Link</code> contiene tambiÃ©n un <code>JaxbAdapter</code>, con una implementaciÃ³n de
la clase JAXB <code>XmlAdapter</code>, que "mapea" los objetos JAX-RS de tipo <code>Link</code> a un
valor que puede ser serializado y deserializado por JAXB</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>El cÃ³digo de este ejemplo permite construir cualquier enlace y aÃ±adirlo a la clase
<code>Cliente</code> de nuestro dominio. Los enlaces serÃ¡n convertidos a elementos XML, que se
incluirÃ¡n en el documento XML de respuesta.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_seguridad">4.4. Seguridad</h3>
<div class="paragraph">
<p>Es importante que los servicios rest permitan un acceso seguro a los datos
y funcionalidades que proporcionan. Especialmente para servicios que permiten la
realizaciÃ³n de actualizaciones en los datos. TambiÃ©n es interesante asegurarnos de
que terceros no lean nuestros mensajes, e incluso permitir que ciertos usuarios
accedan a determinadas funcionalidades pero a otras no.</p>
</div>
<div class="paragraph">
<p>AdemÃ¡s de la especificaciÃ³n JAX-RS, podemos aprovechar los servicios de seguridad
que nos ofrece la web y Java EE, y utilizarla en nuestros servicios REST. Estos
incluyen:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">AutentificaciÃ³n</dt>
<dd>
<p>Hace referencia a la validaciÃ³n de la <strong>identidad</strong> del cliente que accede a los
servicios. Normalmente implica la comprobaciÃ³n de si el cliente ha proporcionado unos
credenciales vÃ¡lidos, tales como el <em>password</em>. En este sentido, podemos utilizar los
mecanismos que nos proporciona la web, y las facilidades del contenedor de servlets
de Java EE, para configurar los protocolos de autentificaciÃ³n.</p>
</dd>
<dt class="hdlist1">AutorizaciÃ³n</dt>
<dd>
<p>Una vea que el cliente se ha autenticado (ha validado su identidad), querrÃ¡ interactuar
con nuestro servicio REST. La autorizaciÃ³n hace referencia a decidir si un cierto usuario
puede acceder e invocar un determinado mÃ©todo sobre una determinada URI. Por ejemplo,
podemos habilitar el acceso a operaciones PUT/POST/DELETE para ciertos usuarios, pero para
 otros no. En este caso, utilizaremos las facilidades que nos propociona el contenedor
 de servlets de Java EE, para realizar autorizaciones.</p>
</dd>
<dt class="hdlist1">Encriptado</dt>
<dd>
<p>Cuando un cliente estÃ¡ interaccionando con un servicio REST, es posible que alguien
intercepte los mensajes y los "lea", si la conexiÃ³n HTTP no es segura. Los datos "sensibles"
deberÃ­an protegerse con servicios criptogrÃ¡ficos, tales como SSL.</p>
</dd>
</dl>
</div>
<div class="sect3">
<h4 id="_autentificaciÃ³n_en_jax_rs">4.4.1. AutentificaciÃ³n en JAX-RS</h4>
<div class="paragraph">
<p>Hay varios protocolos de autentificaciÃ³n. En este caso, vamos a ver cÃ³mo realizar una
autenticaciÃ³n bÃ¡sica sobre HTTP (y que ya habÃ©is utilizado para <em>servlets</em>). Este tipo
de autentificaciÃ³n requiere enviar un nombre de usuario y password, codificados como Base-64,
en una cabecera de la peticiÃ³n al servidor. El servidor comprueba si existe dicho usuario
en el sistema y verifica el password enviado. VeÃ¡moslo con un ejemplo:</p>
</div>
<div class="paragraph">
<p>Supongamos que un cliente no autorizado quiere acceder a nuestros servicios REST:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code>GET /clientes/333 HTTP/1.1</code></pre>
</div>
</div>
<div class="paragraph">
<p>Ya que la peticiÃ³n no contiene informaciÃ³n de autentificaciÃ³n, el servidor deberÃ­a
responder la siguiente respuesta:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code>HTTP/1.1 401 Unauthorized
WWW-Autenticate: Basic realm="Cliente Realm"</code></pre>
</div>
</div>
<div class="paragraph">
<p>La respuesta <code>401</code> nos indica que el cliente no estÃ¡ autorizado a acceder a dicha URI.
La cabecera <code>WWW-Autenticate</code> especifica quÃ© protocolo de autentificaciÃ³n se deberÃ­a usar.
En este caso, <code>Basic</code> significa que se deberÃ­a utilizar una autentificaciÃ³n de tipo
<code>Basic</code>. El atributo <code>realm</code> identifica una colecciÃ³n de recursos seguros en un sitio web.
En este ejemplo, indica que solamente estÃ¡n autorizados a acceder al mÃ©todo GET a travÃ©s
de la URI anterior, todos aquellos uarios que pertenezcan al realm <code>Cliente Realm</code>, y
serÃ¡n autentificados por el servidor mediante una autentificaciÃ³n bÃ¡sica.</p>
</div>
<div class="paragraph">
<p>Para poder realizar la autentificaciÃ³n, el cliente debe enviar una peticiÃ³n que
incluya la cabecera <code>Authorization</code>, cuyo valor sea <code>Basic</code>, seguido de la siguiente cadena de
caracteres <em>login:password</em> codificada en Base64 (el valor de <em>login</em> y <em>password</em>
representa el login y password del usuario). Por ejemplo, supongamos que el nombre del
usuario es <code>felipe</code> y el password es <code>locking</code>, la cadena <code>felipe:locking</code> codificada
como Base64 es <code>ZmVsaXBlOmxvY2tpbmc=</code>. Por lo tanto, nuestra peticiÃ³n deberÃ­a ser
la siguiente:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code>GET /clientes/333 HTTP/1.1
Authorization: Basic ZmVsaXBlOmxvY2tpbmc=</code></pre>
</div>
</div>
<div class="paragraph">
<p>El cliente deberÃ­a enviar esta cabecera con todas y cada una de las peticiones
que haga al servidor.</p>
</div>
<div class="paragraph">
<p>El inconveniente de esta aproximaciÃ³n es que si la peticiÃ³n es interceptada
por alguna entidad "hostil" en la red, el <em>hacker</em> puede obtner fÃ¡cilmente
el usuario y el passwork y utilizarlos para hacer sus propias peticiones.
Utilizando una conexiÃ³n HTTP encriptada (HTTPS), se soluciona este problema.</p>
</div>
<div class="sect4">
<h5 id="_creaciÃ³n_de_usuarios_y_roles">CreaciÃ³n de usuarios y roles</h5>
<div class="paragraph">
<p>Para poder utilizar la autentificaciÃ³n bÃ¡sica necesitamos tener creados previamente los
<em>realms</em> en el servidor de aplicaciones Wildfly, y registrar los usuarios que pertenecen a dichos
<em>realms</em>. La forma de hacerlo es idÃ©ntica a lo que ya habÃ©is visto en la asignatura
de Componentes Web (a travÃ©s del comando <code>add-user.sh</code>).</p>
</div>
<div class="paragraph">
<p>Utilizaremos el realm por defecto "ApplicationRealm" de Wildfly, que nos permitirÃ¡
ademÃ¡s, controlar la autorizaciÃ³n mediante la asignaciÃ³n de roles a usuarios.</p>
</div>
<div class="paragraph">
<p>Lo Ãºnico que tendremos que hacer es aÃ±adir los usuarios a dicho realm, a travÃ©s de
la herramienta <code>$WILDFLY_HOME/bin/add-user.sh</code></p>
</div>
<div class="paragraph">
<p>Al ejecutarla desde lÃ­nea de comandos, deberemos elegir el ream "ApplicationRealm"
e introducir los datos para cada nuevo usuario que queramos aÃ±adir, indicando su
login, password, y el grupo (rol) al que queremos que pertenezca dicho usuario.</p>
</div>
<div class="paragraph">
<p>Los datos sobre los nuevos usuarios creados se almacenan en los ficheros:
<code>application-users.properties</code> y <code>application-roles.properties</code>, tanto en el
directorio <code>$WILDFLY_HOME/standalone/configuration/</code>, como en
<code>$WILDFLY_HOME/domain/configuration/</code></p>
</div>
<div class="paragraph">
<p>Una vez creados los usuarios, tendremos que incluir en el fichero de
configuraciÃ³n <code>web.xml</code>, la siguiente informaciÃ³n:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><span class="tok-nt">&lt;web-app&gt;</span>
  ...
  <span class="tok-nt">&lt;login-config&gt;</span> <i class="conum" data-value="1"></i><b>(1)</b>
    <span class="tok-nt">&lt;auth-method&gt;</span>BASIC<span class="tok-nt">&lt;/auth-method&gt;</span>
    <span class="tok-nt">&lt;realm-name&gt;</span>ApplicationRealm<span class="tok-nt">&lt;/realm-name&gt;</span> <i class="conum" data-value="2"></i><b>(2)</b>
  <span class="tok-nt">&lt;/login-config&gt;</span>

  <span class="tok-nt">&lt;security-constraint&gt;</span>
    <span class="tok-nt">&lt;web-resource-collection&gt;</span>
       <span class="tok-nt">&lt;web-resource-name&gt;</span>customer creation<span class="tok-nt">&lt;/web-resource-name&gt;</span>
       <span class="tok-nt">&lt;url-pattern&gt;</span>/rest/resources<span class="tok-nt">&lt;/url-pattern&gt;</span> <i class="conum" data-value="3"></i><b>(3)</b>
       <span class="tok-nt">&lt;http-method&gt;</span>POST<span class="tok-nt">&lt;/http-method&gt;</span> <i class="conum" data-value="4"></i><b>(4)</b>
    <span class="tok-nt">&lt;/web-resource-collection&gt;</span>
    ...
  <span class="tok-nt">&lt;/security-constraint&gt;</span>
  ...
<span class="tok-nt">&lt;/web-app&gt;</span></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>El elemento &lt;login-config&gt; define cÃ³mo queremos autentificar
nuestro despliegue. El subelemento &lt;auth-method&gt; puede tomar los valores
<code>BASIC</code>, <code>DIGEST</code>, or <code>CLIENT_CERT</code>, correspondiÃ©ndose con la autentificaciÃ³n <em>Basic</em>,
<em>Digest</em>, y <em>Client Certificate</em>, respectivamente.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>El valor de la etiqueta <code>&lt;realm-name&gt;</code> es el que se mostrarÃ¡ como valor del atributo
<strong>realm</strong> de la cabecera <code>WWW-Autenticate</code>, si intentamos acceder al recurso sin
incluir nuestras credenciales en la peticiÃ³n.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>El elemento <code>&lt;login-config&gt;</code> realmente NO "activa" la autentificaciÃ³n. Por defecto,
cualquier cliente puede acceder a cualquier URL proporcionada por nuestra aplicaciÃ³n
web sin restricciones. Para <strong>forzar</strong> la autentificaciÃ³n, debemos especificar el
patrÃ³n URL que queremos asegurar (elemento <code>&lt;url-pattern&gt;</code>)</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>El elemento <code>&lt;http-method&gt;</code> nos indica que solamente queremos asegurar las peticiones
<code>POST</code> sobre esta URL. Si no incluimos el elemento <code>&lt;http-method&gt;</code>, todos los mÃ©todos
HTTP serÃ¡n seguros. En este ejemplo, solamente queremos asegurar los mÃ©todos <code>POST</code>
dirigidos a la URL <code>/rest/resources</code></td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_autorizaciÃ³n_en_jax_rs">4.4.2. AutorizaciÃ³n en JAX-RS</h4>
<div class="paragraph">
<p>Mientras que la autentificaciÃ³n hacer referencia a establecer y verificar la identidad
del usuario, la autorizaciÃ³n tiene que ver con los permisos. Â¿El usuario X estÃ¡
autorizado para acceder a un determinado recurso REST?</p>
</div>
<div class="paragraph">
<p>JAX-RS se basa en las especificaciones Java EE y de servlets para definir
 la forma de autorizar a los usuarios. En Java EE, la autorizaciÃ³n se realiza asociando
 uno o mÃ¡s roles con un usuario dado y, a continuaciÃ³n asignando permisos basados
 en dicho rol. Ejemplos de roles pueden ser: <code>administrador</code>, <code>empleado</code>. Cada rol
 tiene asignando unos permisos de acceso a determinados recursos, por lo que asignaremos
 los permisos utilizando cada uno de los roles.</p>
</div>
<div class="paragraph">
<p>Para poder realizar la autorizaciÃ³n, tendremos que incluir determinadas etiquetas
en el fichero de configuraciÃ³n <code>web.xml</code> (tal y como ya habÃ©is visto en la asignatura de
Componentes Web). VeÃ¡moslo con un ejemplo (en el que tambiÃ©n incluiremos autentificaciÃ³n):</p>
</div>
<div class="paragraph">
<p>Volvamos a nuestra aplicaciÃ³n de venta de productos por internet. En esta aplicaciÃ³n, es
 posible crear nuevos clientes enviando la informaciÃ³n en formato XML a un recurso JAX-RS
 localizado por la anotaciÃ³n <code>@Path("/clientes")</code>. El servicio REST es desplegado y
 escaneado por la clase <code>Application</code> anotada con <code>@ApplicationPath("/servicios")</code>,
 de forma que la URI completa es <code>/servicios/clientes</code>. Queremos proporcionar seguridad
 a nuestro servicio de clientes de forma que solamente los administradores puedan crear
 nuevos clientes. Veamos cuÃ¡l serÃ­a el contenido del fichero <code>web.xml</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><span class="tok-cp">&lt;?xml version=&quot;1.0&quot;?&gt;</span>
<span class="tok-nt">&lt;web-app&gt;</span>
  <span class="tok-nt">&lt;security-constraint&gt;</span>
    <span class="tok-nt">&lt;web-resource-collection&gt;</span>
       <span class="tok-nt">&lt;web-resource-name&gt;</span>creacion de clientes<span class="tok-nt">&lt;/web-resource-name&gt;</span>
       <span class="tok-nt">&lt;url-pattern&gt;</span>/servicios/clientes/*<span class="tok-nt">&lt;/url-pattern&gt;</span>
       <span class="tok-nt">&lt;http-method&gt;</span>POST<span class="tok-nt">&lt;/http-method&gt;</span>
    <span class="tok-nt">&lt;/web-resource-collection&gt;</span>
    <span class="tok-nt">&lt;auth-constraint&gt;</span> <i class="conum" data-value="1"></i><b>(1)</b>
       <span class="tok-nt">&lt;role-name&gt;</span>admin<span class="tok-nt">&lt;/role-name&gt;</span>
    <span class="tok-nt">&lt;/auth-constraint&gt;</span>
  <span class="tok-nt">&lt;/security-constraint&gt;</span>

  <span class="tok-nt">&lt;login-config&gt;</span>
        <span class="tok-nt">&lt;auth-method&gt;</span>BASIC<span class="tok-nt">&lt;/auth-method&gt;</span>
        <span class="tok-nt">&lt;realm-name&gt;</span>ApplicationRealm<span class="tok-nt">&lt;/realm-name&gt;</span>
  <span class="tok-nt">&lt;/login-config&gt;</span>

  <span class="tok-nt">&lt;security-role&gt;</span> <i class="conum" data-value="2"></i><b>(2)</b>
    <span class="tok-nt">&lt;role-name&gt;</span>admin<span class="tok-nt">&lt;/role-name&gt;</span>
  <span class="tok-nt">&lt;/security-role&gt;</span>
<span class="tok-nt">&lt;/web-app&gt;</span></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Especificamos quÃ© roles tienen permiso para acceder mediante POST a la URL
<code>/services/customers</code>. Para ello utilizamos el elemento <code>&lt;auth-constraint&gt;</code> dentro de
<code>&lt;security-constraint&gt;</code>. Este elemento tiene uno o mÃ¡s subelementos <code>&lt;role-name&gt;</code>,
que definen quÃ© roles tienen permisos de acceso definidos por <code>&lt;security-constraint&gt;</code>.
En nuestro ejemplo, estamos dando al rol <code>admin</code> permisos para acceder a la
URL <code>/services/customers/</code> con el mÃ©todo POST. Si en su lugar indicamos un <code>&lt;role-name&gt;</code> con
el valor <code>*</code>, cualquier usuario podrÃ­a acceder a dicha URL. En otras palabras, un <code>&lt;role-name&gt;</code>
con el valor <code>*</code> significa que cualquier usuario que sea capaz de autentificarse, puede
acceder al recurso.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Para cada <code>&lt;role-name&gt;</code> que usemos en nuestras declaraciones <code>&lt;auth-constraints&gt;</code>, debemos
definir el correspondiente <code>&lt;security-role&gt;</code> en el descriptor de despliegue.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Una limitaciÃ³n cuando estamos declarando las <code>&lt;security-contraints&gt;</code> para los recursos
JAX-RS es que el elemento <code>&lt;url-pattern&gt;</code> solamente soporta el uso de <code>*</code> en el patrÃ³n url
 especificado. Por ejemplo: <code>/*</code>, <code>/rest/*</code>, <code>\*.txt</code>.</p>
</div>
</div>
<div class="sect3">
<h4 id="_encriptaciÃ³n">4.4.3. EncriptaciÃ³n</h4>
<div class="paragraph">
<p>Por defecto, la especificaciÃ³n de servlets no requiere un acceso a travÃ©s de HTTPS.
Si queremos forzar un acceso HTTPS, podemos especificar un elemento <code>&lt;user-data-constraint&gt;</code>
como parte de nuestra definiciÃ³n de restricciones de seguridad (<code>&lt;security-constraint&gt;</code>).
Vamos a modificar nuestro ejemplo anterior para forzar un acceso a travÃ©s de HTTPS:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><span class="tok-nt">&lt;web-app&gt;</span>
...
  <span class="tok-nt">&lt;security-constraint&gt;</span>

    <span class="tok-nt">&lt;web-resource-collection&gt;</span>
       <span class="tok-nt">&lt;web-resource-name&gt;</span>creacion de clientes<span class="tok-nt">&lt;/web-resource-name&gt;</span>
       <span class="tok-nt">&lt;url-pattern&gt;</span>/servicios/clientes/*<span class="tok-nt">&lt;/url-pattern&gt;</span>
       <span class="tok-nt">&lt;http-method&gt;</span>POST<span class="tok-nt">&lt;/http-method&gt;</span>
    <span class="tok-nt">&lt;/web-resource-collection&gt;</span>

    <span class="tok-nt">&lt;auth-constraint&gt;</span>
       <span class="tok-nt">&lt;role-name&gt;</span>admin<span class="tok-nt">&lt;/role-name&gt;</span>
    <span class="tok-nt">&lt;/auth-constraint&gt;</span>

    <span class="tok-nt">&lt;user-data-constraint&gt;</span>
      <span class="tok-nt">&lt;transport-guarantee&gt;</span>CONFIDENTIAL<span class="tok-nt">&lt;/transport-guarantee&gt;</span> <i class="conum" data-value="1"></i><b>(1)</b>
    <span class="tok-nt">&lt;/user-data-constraint&gt;</span>
  <span class="tok-nt">&lt;/security-constraint&gt;</span>
...
<span class="tok-nt">&lt;/web-app&gt;</span></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Todo lo que tenemos que hacer es declarar un elemento <code>&lt;transport-guarantee&gt;</code>
dentro de <code>&lt;user-data-constraint&gt;</code> con el valor <code>CONFIDENTIAL</code>. Si un usuario intenta
acceder a una URL con el patrÃ³n especificado a travÃ©s de HTTP, serÃ¡ redirigido a
una URL basada en HTTPS.</td>
</tr>
</table>
</div>
<div class="sect4">
<h5 id="_anotaciones_jax_rs_para_autorizaciÃ³n">Anotaciones JAX-RS para autorizaciÃ³n</h5>
<div class="paragraph">
<p>Java EE define un conjunto de anotaciones para definir metadatos de autorizaciÃ³n. La
especificaciÃ³n JAX-RS sugiere, aunque no es obligatorio, que las implementaciones
 por diferentes vendedores den soporte a dichas anotaciones. Ãstas se encuentran en
  el paquete <code>javax.annotation.security</code> y son: @RolesAllowed, @DenyAll, @PermitAll, y @RunAs.</p>
</div>
<div class="paragraph">
<p>La anotaciÃ³n <code>@RolesAllowed</code> define los roles permitidos para ejecutar una determinada
 operaciÃ³n. Si anotamos una clase JAX-RS, define el acceso para todas las operaciones
 HTTP definidas en la clase JAX-RS. Si anotamos un mÃ©todo JAX-RS, la restricciÃ³n se
 aplica solamente al mÃ©todo que se estÃ¡ anotando.</p>
</div>
<div class="paragraph">
<p>La anotaciÃ³n @PermitAll especifica que cualquier usuario autentificado puede invocar
a nuestras operaciones. Al igual que @RolesAllowed, esta anotaciÃ³n puede usarse en la
clase, para definir el comportamiento por defecto de toda la clase, o podemos usarla en
cada uno de los mÃ©todos. Veamos un ejemplo:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span class="tok-nd">@Path</span><span class="tok-o">(</span><span class="tok-s">&quot;/clientes&quot;</span><span class="tok-o">)</span>
<span class="tok-nd">@RolesAllowed</span><span class="tok-o">({</span><span class="tok-s">&quot;ADMIN&quot;</span><span class="tok-o">,</span> <span class="tok-s">&quot;CLIENTE&quot;</span><span class="tok-o">})</span> <i class="conum" data-value="1"></i><b>(1)</b>
<span class="tok-kd">public</span> <span class="tok-kd">class</span> <span class="tok-nc">ClienteResource</span> <span class="tok-o">{</span>

  <span class="tok-nd">@GET</span>
  <span class="tok-nd">@Path</span><span class="tok-o">(</span><span class="tok-s">&quot;{id}&quot;</span><span class="tok-o">)</span>
  <span class="tok-nd">@Produces</span><span class="tok-o">(</span><span class="tok-s">&quot;application/xml&quot;</span><span class="tok-o">)</span>
  <span class="tok-kd">public</span> <span class="tok-n">Cliente</span> <span class="tok-nf">getClienter</span><span class="tok-o">(</span><span class="tok-nd">@PathParam</span><span class="tok-o">(</span><span class="tok-s">&quot;id&quot;</span><span class="tok-o">)</span> <span class="tok-kt">int</span> <span class="tok-n">id</span><span class="tok-o">)</span> <span class="tok-o">{...}</span>

  <span class="tok-nd">@RolesAllowed</span><span class="tok-o">(</span><span class="tok-s">&quot;ADMIN&quot;</span><span class="tok-o">)</span> <i class="conum" data-value="2"></i><b>(2)</b>
  <span class="tok-nd">@POST</span>
  <span class="tok-nd">@Consumes</span><span class="tok-o">(</span><span class="tok-s">&quot;application/xml&quot;</span><span class="tok-o">)</span>
  <span class="tok-kd">public</span> <span class="tok-kt">void</span> <span class="tok-nf">crearCliente</span><span class="tok-o">(</span><span class="tok-n">Customer</span> <span class="tok-n">cust</span><span class="tok-o">)</span> <span class="tok-o">{...}</span>

  <span class="tok-nd">@PermitAll</span> <i class="conum" data-value="3"></i><b>(3)</b>
  <span class="tok-nd">@GET</span>
  <span class="tok-nd">@Produces</span><span class="tok-o">(</span><span class="tok-s">&quot;application/xml&quot;</span><span class="tok-o">)</span>
  <span class="tok-kd">public</span> <span class="tok-n">Customer</span><span class="tok-o">[]</span> <span class="tok-nf">getClientes</span><span class="tok-o">()</span> <span class="tok-o">{}</span>
<span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Por defecto, solamente los usuarios con rol ADMIN y CLIENTE pueden ejecutar
los mÃ©todos HTTP definidos en la clase ClienteResource</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Sobreescribimos el comportamiento por defecto. Para el mÃ©todo <code>crearCliente()</code>
solamente permitimos peticiones de usuarios con rol ADMIN</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Sobreescribimos el comportamiento por defecto. Para el mÃ©todo <code>getClientes()</code>
de forma que cualquier usuario autentificado puede acceder a esta operaciÃ³n a travÃ©s
de la URI correspondiente, con el mÃ©todo GET.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>La ventaja de utilizar anotaciones es que nos permite una mayor flexibilidad que
el uso del fichero de configuraciÃ³n <code>web.xml</code>, pudiendo definir diferentes autorizaciones
a nivel de mÃ©todo.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_seguridad_programada">4.4.4. Seguridad programada</h4>
<div class="paragraph">
<p>Hemos visto como utilizar una seguridad declarativa, es decir, basÃ¡ndonos en meta-datos
definidos estÃ¡ticamente antes de que la aplicaciÃ³n se ejecute. JAX-RS proporciona una forma
de obtener informaciÃ³n de seguridad que nos permite implementar seguridad de forma
programada en nuestras aplicaciones.</p>
</div>
<div class="paragraph">
<p>Podemos utilizar la interfaz <code>javax.ws.rs.core.SecurityContext</code> para determinar la
 identidad del usuario que realiza la invocaciÃ³n al mÃ©todo proporcionando sus credenciales.
 TambiÃ©n podemos comprobar si el usuario pertenece o no a un determinado rol:
Esto nos permite implementar seguridad de forma programada en nuestras aplicaciones.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span class="tok-kd">public</span> <span class="tok-kd">interface</span> <span class="tok-nc">SecurityContext</span> <span class="tok-o">{</span>
   <span class="tok-kd">public</span> <span class="tok-n">Principal</span> <span class="tok-nf">getUserPrincipal</span><span class="tok-o">();</span>
   <span class="tok-kd">public</span> <span class="tok-kt">boolean</span> <span class="tok-nf">isUserInRole</span><span class="tok-o">(</span><span class="tok-n">String</span> <span class="tok-n">role</span><span class="tok-o">);</span>
   <span class="tok-kd">public</span> <span class="tok-kt">boolean</span> <span class="tok-nf">isSecure</span><span class="tok-o">();</span>
  <span class="tok-kd">public</span> <span class="tok-n">String</span> <span class="tok-nf">getAuthenticationScheme</span><span class="tok-o">();</span>
<span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>El mÃ©todo <code>getUserPrincipal()</code> devuelve un objeto de tipo <code>javax.security.Principal</code>,
que representa al usuario que actualmente estÃ¡ realizando la peticiÃ³n HTTP</p>
</div>
<div class="paragraph">
<p>El mÃ©todo <code>isUserInRole()</code> nos permite determinar si el usuario que realiza
la llamada actual pertenece a un determinado rol.</p>
</div>
<div class="paragraph">
<p>El mÃ©todo <code>isSecure()</code> devuelve cierto si la peticiÃ³n actual es una conexiÃ³n segura.</p>
</div>
<div class="paragraph">
<p>El mÃ©todo <code>getAuthenticationScheme()</code> nos indica quÃ© mecanismo de autentificaciÃ³n se
ha utilizado para asegurar la peticiÃ³n (valores tÃ­picos devueltos por el mÃ©todo
son: <code>BASIC</code>, <code>DIGEST</code>, <code>CLIENT_CERT</code>, y <code>FORM</code>).</p>
</div>
<div class="paragraph">
<p>Podemos acceder a una instancia de SecurityContext inyectÃ¡ndola en un campo,
mÃ©todo <em>setter</em>, o un parÃ¡metro de un recurso, utilizando la anotaciÃ³n <code>@Context</code>.
Veamos un ejemplo. Supongamos que queremos obtener un fichero de log con todos
los accesos a nuestra base de datos de clientes hechas por usuarios que no son
 administradores:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span class="tok-nd">@Path</span><span class="tok-o">(</span><span class="tok-s">&quot;/clientes&quot;</span><span class="tok-o">)</span>
<span class="tok-kd">public</span> <span class="tok-kd">class</span> <span class="tok-nc">CustomerService</span> <span class="tok-o">{</span>
  <span class="tok-nd">@GET</span>
  <span class="tok-nd">@Produces</span><span class="tok-o">(</span><span class="tok-s">&quot;application/xml&quot;</span><span class="tok-o">)</span>
  <span class="tok-kd">public</span> <span class="tok-n">Cliente</span><span class="tok-o">[]</span> <span class="tok-nf">getClientes</span><span class="tok-o">(</span><span class="tok-nd">@Context</span> <span class="tok-n">SecurityContext</span> <span class="tok-n">sec</span><span class="tok-o">)</span> <span class="tok-o">{</span>
    <span class="tok-k">if</span> <span class="tok-o">(</span><span class="tok-n">sec</span><span class="tok-o">.</span><span class="tok-na">isSecure</span><span class="tok-o">()</span> <span class="tok-o">&amp;&amp;</span> <span class="tok-o">!</span><span class="tok-n">sec</span><span class="tok-o">.</span><span class="tok-na">isUserInRole</span><span class="tok-o">(</span><span class="tok-s">&quot;ADMIN&quot;</span><span class="tok-o">))</span> <span class="tok-o">{</span>
        <span class="tok-n">logger</span><span class="tok-o">.</span><span class="tok-na">log</span><span class="tok-o">(</span><span class="tok-n">sec</span><span class="tok-o">.</span><span class="tok-na">getUserPrincipal</span><span class="tok-o">()</span>
            <span class="tok-o">+</span> <span class="tok-s">&quot; ha accedido a la base de datos de clientes&quot;</span><span class="tok-o">);</span>
    <span class="tok-o">}</span>
    <span class="tok-o">...</span>
  <span class="tok-o">}</span>
<span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>En este ejemplo, inyectamos una instancia de <code>SecurityContext</code> como un parÃ¡metro del
mÃ©todo <code>getClientes()</code>. Utilizamos el mÃ©todo <code>SecurityContext.isSecure()</code> para determinar
si se trata de una peticiÃ³n realizada a travÃ©s de un canal seguro (como HTTPS). A continuaciÃ³n utilizamos el mÃ©todo
<code>SecurityContext.isUserInRole()</code> para determinar si el usuario que realiza la llamada
tiene el rol ADMIN o no. Finalmente, imprimimos el resultado en nuestro fichero de logs.</p>
</div>
<div class="paragraph">
<p>Con la introducciÃ³n del API de filtros en JAX-RS 2.0, podemos implementar la
interfaz <code>SecurityContext</code> y sobreescribir la peticiÃ³n actual sobre <code>SecurityContext</code>,
utilizando el mÃ©todo <code>ContainerRequestContext.setSecurityContext()</code>. Lo interesante de
esto es que podemos implementar nuestros propios protocolos de seguridad. Por ejemplo:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span class="tok-kn">import</span> <span class="tok-nn">javax.ws.rs.container.ContainerRequestContext</span><span class="tok-o">;</span>
<span class="tok-kn">import</span> <span class="tok-nn">javax.ws.rs.container.ContainerRequestFilter</span><span class="tok-o">;</span>
<span class="tok-kn">import</span> <span class="tok-nn">javax.ws.rs.container.PreMatching</span><span class="tok-o">;</span>
<span class="tok-kn">import</span> <span class="tok-nn">javax.ws.rs.core.SecurityContext</span><span class="tok-o">;</span>
<span class="tok-kn">import</span> <span class="tok-nn">javax.ws.rs.core.HttpHeaders</span><span class="tok-o">;</span>

<span class="tok-nd">@PreMatching</span>
<span class="tok-kd">public</span> <span class="tok-kd">class</span> <span class="tok-nc">CustomAuth</span> <span class="tok-kd">implements</span> <span class="tok-n">ContainerRequestFilter</span> <span class="tok-o">{</span>
  <span class="tok-kd">protected</span> <span class="tok-n">MyCustomerProtocolHandler</span> <span class="tok-n">customProtocol</span> <span class="tok-o">=</span> <span class="tok-o">...;</span>

  <span class="tok-kd">public</span> <span class="tok-kt">void</span> <span class="tok-nf">filter</span><span class="tok-o">(</span><span class="tok-n">ContainerRequestContext</span> <span class="tok-n">requestContext</span><span class="tok-o">)</span>
                                        <span class="tok-kd">throws</span> <span class="tok-n">IOException</span> <span class="tok-o">{</span>
     <span class="tok-n">String</span> <span class="tok-n">authHeader</span> <span class="tok-o">=</span> <span class="tok-n">request</span><span class="tok-o">.</span><span class="tok-na">getHeaderString</span><span class="tok-o">(</span><span class="tok-n">HttpHeaders</span><span class="tok-o">.</span><span class="tok-na">AUTHORIZATION</span><span class="tok-o">);</span>
     <span class="tok-n">SecurityContext</span> <span class="tok-n">newSecurityContext</span> <span class="tok-o">=</span> <span class="tok-n">customProtocol</span><span class="tok-o">.</span><span class="tok-na">validate</span><span class="tok-o">(</span><span class="tok-n">authHeader</span><span class="tok-o">);</span>
     <span class="tok-n">requestContext</span><span class="tok-o">.</span><span class="tok-na">setSecurityContext</span><span class="tok-o">(</span><span class="tok-n">authHeader</span><span class="tok-o">);</span>
  <span class="tok-o">}</span>
<span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Este filtro no muestra todos los detalles, pero sÃ­ la idea. Extrae la cabecera
<code>Authorization</code> de la peticiÃ³n y la pasa a nuestro propio servicio <code>customerProtocol</code>.
Ãste devuelve una implementaciÃ³n de <code>SecurityContext</code>. Finalmente sobreescribimos
el SecurityContext por defecto utilizando la nueva implementaciÃ³n.</p>
</div>
<div class="paragraph">
<p>No vamos a explicar el API de filtros de JAS-RS 2.0. Como ya habÃ©is visto en la asignatura
de Componentes Web, los filtros son objetos que se "interponen" entre el procesamiento
de las peticiones, tanto del servidor como del cliente.</p>
</div>
<div class="paragraph">
<p>El filtro mostrado en el ejemplo es un filtro <strong>de peticiÃ³n</strong> en la parte del <strong>servidor</strong>.
Este tipo de filtros se ejecuta antes de que se invoque a un mÃ©todo
JAX-RS.</p>
</div>
<div style="page-break-after: always;"></div>
</div>
</div>
<div class="sect2">
<h3 id="_ejercicios_4">4.5. Ejercicios</h3>
<div class="paragraph">
<p>Para los ejercicios de esta sesiÃ³n proporcionamos el <strong>MÃDULO s4-foroAvanzado</strong>, que tendrÃ©is
que usar como plantilla para realizar las tareas planteadas.</p>
</div>
<div class="paragraph">
<p>El proyecto estÃ¡ estructurado lÃ³gicamente en los siguientes paquetes:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>org.expertojava.negocio</p>
</li>
<li>
<p>org.expertojava.rest</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>A su vez, cada uno de ellos contiene los subpaquetes <code>api</code> y <code>modelo</code>, con las clases
relacionadas con los servicios proporcionados, y los datos utilizados por los servicios, respectivamente.</p>
</div>
<div class="paragraph">
<p>El API rest implementado es el siguiente:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Recurso <em>UsuariosResource.java</em></p>
<div class="ulist">
<ul>
<li>
<p>GET /usuarios, proporciona un listado con los usuarios del foro</p>
</li>
</ul>
</div>
</li>
<li>
<p>Subrecurso <em>UsuarioResource.java</em></p>
<div class="ulist">
<ul>
<li>
<p>GET /usuarios/login, proporciona informaciÃ³n sobre el usuario cuyo login es "login"</p>
</li>
<li>
<p>PUT /usuarios/login, actualiza los datos de un usuario</p>
</li>
<li>
<p>DELETE /usuarios/login, borra los datos de un usuario</p>
</li>
<li>
<p>GET /usuarios/login/mensajes, obtiene un listado de los mensajes de un usuario</p>
</li>
</ul>
</div>
</li>
<li>
<p>Recurso <em>MensajesResource.java</em></p>
<div class="ulist">
<ul>
<li>
<p>GET /mensajes, proporciona un listado con los mensajes del foro</p>
</li>
<li>
<p>POST /mensajes, aÃ±ade un mensaje nuevo en el foro</p>
</li>
<li>
<p>GET /mensajes/id, proporciona informaciÃ³n sobre el mensaje cuyo id es "id"</p>
</li>
<li>
<p>PUT /mensajes/id, modifica un mensaje</p>
</li>
<li>
<p>DELETE /mensajes/id, borra un mensaje</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>Una vez desplegada la aplicaciÃ³n, podÃ©is aÃ±adir datos a la base de datos del foro, utilizando
los datos del fichero /src/main/resources/foro.sql. Para ello simplemente tendrÃ©is que invocar
la goal Maven correspondiente desde la ventana <em>Maven Projects &gt; s4-foroAvanzado &gt; Plugins &gt;
sql &gt; sql:execute</em></p>
</div>
<div class="paragraph">
<p>En el directorio <code>src/main/resources</code> tenÃ©is un fichero de texto (<code>instrucciones.txt</code>)
con informaciÃ³n adicional sobre la implementaciÃ³n proporcionada.</p>
</div>
<div class="paragraph">
<p>A partir de las plantillas, se pide:</p>
</div>
<div class="sect3">
<h4 id="_uso_de_hateoas_1_puntos">4.5.1. Uso de Hateoas (1 puntos)</h4>
<div class="paragraph">
<p>Vamos a aÃ±adir a los servicios enlaces a las operaciones que podemos realizar con
cada recurso, siguiendo el estilo Hateoas.</p>
</div>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Para los usuarios:</p>
<div class="ulist">
<ul>
<li>
<p>En el listado de usuarios aÃ±adir a cada usuario un enlace con relaciÃ³n <code>self</code> que
apunte a la direcciÃ³n a la que estÃ¡ mapeado el usuario individual.</p>
</li>
<li>
<p>En la operaciÃ³n de obtenciÃ³n de un usuario individual, incluir los enlaces para
ver el propio usuario (self), modificarlo (usuario/modificar), borrarlo (usuario/borrar),
o ver los mensajes que enviÃ³ el usuario (usuario/mensajes).</p>
</li>
</ul>
</div>
</li>
<li>
<p>Para los mensajes:</p>
<div class="ulist">
<ul>
<li>
<p>En el listado de mensajes aÃ±adir a cada mensaje un enlace con relaciÃ³n <code>self</code> que
apunte a la direcciÃ³n a la que estÃ¡ mapeado el mensaje individual.</p>
</li>
<li>
<p>En la operaciÃ³n de obtenciÃ³n de un mensaje individual, incluir los enlaces para
ver el propio mensaje (self), modificarlo (mensaje/modificar), borrarlo (mensaje/borrar),
o ver los datos del usuario que enviÃ³ el mensaje (mensaje/usuario).</p>
</li>
</ul>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<p>Utiliza postman para comprobar las modificaciones realizadas.</p>
</div>
</div>
<div class="sect3">
<h4 id="_ejercicio_seguridad_1_punto">4.5.2. Ejercicio seguridad (1 punto)</h4>
<div class="paragraph">
<p>Vamos ahora a restringir el acceso al servicio para que sÃ³lo usuarios registrados puedan realizar modificaciones.
Se pide:</p>
</div>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>AÃ±adir al usuario "pepe" en el "ApplicationRealm" de wildfly, con la contraseÃ±a "pepe", y perteneciente
al grupo (rol) "registrado"</p>
</li>
<li>
<p>Configurar, mediante seguridad declarativa, para que las operaciones de modificaciÃ³n
(POST, PUT y DELETE) sÃ³lo la puedan realizar los usuarios con rol <strong>registrado</strong>.
Utilizar autentificaciÃ³n de tipo BASIC.</p>
</li>
<li>
<p>Ahora vamos a hacer que la modificaciÃ³n o borrado de usuarios sÃ³lo pueda
realizarlas el mismo usuario que va a modificarse o borrarse. Para ello utilizaremos seguridad
programada. En el caso de que el usuario que va a realizar la modificaciÃ³n o borrado
quiera borrar/modificar otros usuarios lanzaremos la excepciÃ³n <code>WebApplicationException(Status.FORBIDDEN)</code></p>
</li>
<li>
<p>Vamos a hacer lo mismo con los mensajes. SÃ³lo podrÃ¡ modificar y borrar mensajes
el mismo usuario que los creÃ³, y al publicar un nuevo mensaje, forzaremos que el
login del mensaje sea el del usuario que hay autentificado en el sistema.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Utiliza postman para comprobar las modificaciones realizadas.</p>
</div>
<div style="page-break-after: always;"></div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="sesion05">5. Api cliente. Procesamiento JSON y Pruebas</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Hasta ahora hemos hablado sobre la creaciÃ³n de servicios web RESTful y hemos "probado"
nuestros servicios utilizando el cliente que nos proporciona IntelliJ, curl, o Postman, para realizar
peticiones y observar las respuestas. JAX-RS 2.0 proporciona un API cliente para facilitar
la programaciÃ³n de clientes REST, que presentaremos en esta sesiÃ³n.</p>
</div>
<div class="paragraph">
<p>En sesiones anteriores, hemos
trabajado con representaciones de texto y xml, fundamentalmente. AquÃ­ hablaremos con mÃ¡s
detalle de JSON, que constituye otra forma de representar los datos de las peticiones y
respuestas de servicios REST muy extendida.</p>
</div>
<div class="paragraph">
<p>Finalmente, veremos cÃ³mo implementar pruebas sobre nuestro servicio utilizando el API cliente y
el <em>framework</em> <em>junit</em>.</p>
</div>
<div class="sect2">
<h3 id="_api_cliente_visiÃ³n_general">5.1. API cliente. VisiÃ³n general</h3>
<div class="paragraph">
<p>La especificaciÃ³n JAX-RS 2.0 incorpora un API cliente HTTP, que facilita enormemente
la implementaciÃ³n de nuestros clientes RESTful, y constituye una clara alternativa
al uso de clases Java como <code>java.net.URL</code>, librerÃ­as externas (como la de Apache) u
otras soluciones propietarias.</p>
</div>
<div class="paragraph">
<p>El API cliente estÃ¡ contenido en el paquete <code>javax.ws.rs.client</code>, y estÃ¡ diseÃ±ado para
que se pueda utilizar de forma "fluida" (<em>fluent</em>). Esto
significa, como ya hemos visto, que lo utilizaremos "encadenando" una sucesiÃ³n de
llamadas a mÃ©todos del API, permitiÃ©ndonos asÃ­ escribir menos lÃ­neas de cÃ³digo. BÃ¡sicamente
estÃ¡ formado por tres clases principales: <strong>Client</strong>, <strong>WebTarget</strong> y <strong>Response</strong> (ya hemos hablado
de esta Ãºltima en sesiones anteriores).</p>
</div>
<div class="paragraph">
<p>Para acceder a un recurso REST mediante el API cliente es necesario seguir los siguientes
pasos:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Obtener una instancia de la interfaz <code>Client</code></p>
</li>
<li>
<p>Configurar la instancia <code>Client</code> a travÃ©s de un <em>target</em> (instancia de <code>WebTarget</code>)</p>
</li>
<li>
<p>Crear una peticiÃ³n basada en el <em>target</em> anterior</p>
</li>
<li>
<p>Invocar la peticiÃ³n</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Vamos a mostrar un cÃ³digo ejemplo para ilustrar los pasos anteriores. En este
caso vamos a invocar peticiones POST y GET sobre una URL (<em>target</em>) para crear
y posteriormente consultar un objeto <code>Cliente</code> que representaremos en formato XML:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span class="tok-o">...</span>
<span class="tok-n">Client</span> <span class="tok-n">client</span> <span class="tok-o">=</span> <span class="tok-n">ClientBuilder</span><span class="tok-o">.</span><span class="tok-na">newClient</span><span class="tok-o">();</span> <i class="conum" data-value="1"></i><b>(1)</b>

<span class="tok-n">WebTarget</span> <span class="tok-n">target</span> <span class="tok-o">=</span>
      <span class="tok-n">client</span><span class="tok-o">.</span><span class="tok-na">target</span><span class="tok-o">(</span><span class="tok-s">&quot;http://expertojava.org/clientes&quot;</span><span class="tok-o">);</span> <i class="conum" data-value="2"></i><b>(2)</b>

<span class="tok-n">Response</span> <span class="tok-n">response</span> <span class="tok-o">=</span>
      <span class="tok-n">target</span>
        <span class="tok-o">.</span><span class="tok-na">request</span><span class="tok-o">()</span>  <i class="conum" data-value="3"></i><b>(3)</b>
        <span class="tok-o">.</span><span class="tok-na">post</span><span class="tok-o">(</span><span class="tok-n">Entity</span><span class="tok-o">.</span><span class="tok-na">xml</span><span class="tok-o">(</span><span class="tok-k">new</span> <span class="tok-nf">Cliente</span><span class="tok-o">(</span><span class="tok-s">&quot;Alvaro&quot;</span><span class="tok-o">,</span> <span class="tok-s">&quot;Gomez&quot;</span><span class="tok-o">)));</span> <i class="conum" data-value="4"></i><b>(4)</b>

<span class="tok-n">response</span><span class="tok-o">.</span><span class="tok-na">close</span><span class="tok-o">();</span> <i class="conum" data-value="5"></i><b>(5)</b>

<span class="tok-n">Cliente</span> <span class="tok-n">cliente</span> <span class="tok-o">=</span> <span class="tok-n">target</span><span class="tok-o">.</span><span class="tok-na">queryParam</span><span class="tok-o">(</span><span class="tok-s">&quot;nombre&quot;</span><span class="tok-o">,</span> <span class="tok-s">&quot;Alvaro Gomez&quot;</span><span class="tok-o">)</span>
                        <span class="tok-o">.</span><span class="tok-na">request</span><span class="tok-o">()</span>
                        <span class="tok-o">.</span><span class="tok-na">get</span><span class="tok-o">(</span><span class="tok-n">Cliente</span><span class="tok-o">.</span><span class="tok-na">class</span><span class="tok-o">);</span>  <i class="conum" data-value="6"></i><b>(6)</b>
<span class="tok-n">client</span><span class="tok-o">.</span><span class="tok-na">close</span><span class="tok-o">();</span>
<span class="tok-o">...</span></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Obtenemos una instancia <code>javax.ws.rs.client.Client</code></td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Creamos un <code>WebTarget</code></td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Creamos la peticiÃ³n</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Realizamos una invocaciÃ³n POST</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>Cerramos (liberamos) el <em>input stream</em> para esta respuesta (en el caso de que estÃ© disponible y
abierto). Es una operaciÃ³n <em>idempotente</em>, es decir, podemos invocarla mÃºltiples veces con
el mismo efecto</td>
</tr>
<tr>
<td><i class="conum" data-value="6"></i><b>6</b></td>
<td>A partir de un <code>WebTarget</code>, establecemos los valores de los <code>queryParams</code> de la
URI de la peticiÃ³n, creamos la peticiÃ³n, y realizamos una invocaciÃ³n GET</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>A continuaciÃ³n explicaremos con detalle los pasos a seguir para implementar un cliente utilizando el API de JAX-RS.</p>
</div>
<div class="sect3">
<h4 id="_obtenemos_una_instancia_client">5.1.1. Obtenemos una instancia Client</h4>
<div class="paragraph">
<p>La interfaz <code>javax.ws.rs.client.Client</code> es el principal punto de entrada del API Cliente.
Dicha interfaz define las acciones e infraestructura necesarias requeridas por un cliente
REST para "consumir" un servicio web RESTful. Los objetos <code>Client</code> se crean a partir de la
clase <code>ClientBuilder</code>:</p>
</div>
<div class="listingblock">
<div class="title">Clase <em>ClientBuilder</em>: utilizada para crear objetos <em>Client</em></div>
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span class="tok-kd">public</span> <span class="tok-kd">abstract</span> <span class="tok-kd">class</span> <span class="tok-nc">ClientBuilder</span> <span class="tok-kd">implements</span> <span class="tok-n">Configurable</span><span class="tok-o">&lt;</span><span class="tok-n">ClientBuilder</span><span class="tok-o">&gt;</span> <span class="tok-o">{</span>
  <span class="tok-kd">public</span> <span class="tok-kd">static</span> <span class="tok-n">Client</span> <span class="tok-nf">newClient</span><span class="tok-o">()</span> <span class="tok-o">{...}</span>
  <span class="tok-kd">public</span> <span class="tok-kd">static</span> <span class="tok-n">Client</span> <span class="tok-nf">newClient</span><span class="tok-o">(</span><span class="tok-kd">final</span> <span class="tok-n">Configuration</span> <span class="tok-n">configuration</span><span class="tok-o">)</span> <span class="tok-o">{...}</span>

  <span class="tok-kd">public</span> <span class="tok-kd">static</span> <span class="tok-n">ClientBuilder</span> <span class="tok-nf">newBuilder</span><span class="tok-o">()</span> <span class="tok-o">{...}</span>

  <span class="tok-kd">public</span> <span class="tok-kd">abstract</span> <span class="tok-n">ClientBuilder</span> <span class="tok-nf">sslContext</span><span class="tok-o">(</span><span class="tok-kd">final</span> <span class="tok-n">SSLContext</span> <span class="tok-n">sslContext</span><span class="tok-o">);</span>
  <span class="tok-kd">public</span> <span class="tok-kd">abstract</span> <span class="tok-n">ClientBuilder</span> <span class="tok-nf">keyStore</span><span class="tok-o">(</span><span class="tok-kd">final</span> <span class="tok-n">KeyStore</span> <span class="tok-n">keyStore</span><span class="tok-o">,</span>
                                          <span class="tok-kd">final</span> <span class="tok-kt">char</span><span class="tok-o">[]</span> <span class="tok-n">password</span><span class="tok-o">);</span>
  <span class="tok-kd">public</span> <span class="tok-n">ClientBuilder</span> <span class="tok-nf">keyStore</span><span class="tok-o">(</span><span class="tok-kd">final</span> <span class="tok-n">KeyStore</span> <span class="tok-n">keyStore</span><span class="tok-o">,</span>
                                <span class="tok-kd">final</span> <span class="tok-n">String</span> <span class="tok-n">password</span><span class="tok-o">)</span> <span class="tok-o">{}</span>
  <span class="tok-kd">public</span> <span class="tok-kd">abstract</span> <span class="tok-n">ClientBuilder</span> <span class="tok-nf">trustStore</span><span class="tok-o">(</span><span class="tok-kd">final</span> <span class="tok-n">KeyStore</span> <span class="tok-n">trustStore</span><span class="tok-o">);</span>
  <span class="tok-kd">public</span> <span class="tok-kd">abstract</span> <span class="tok-n">ClientBuilder</span> <span class="tok-nf">hostnameVerifier</span><span class="tok-o">(</span><span class="tok-kd">final</span> <span class="tok-n">HostnameVerifier</span> <span class="tok-n">verifier</span><span class="tok-o">);</span>

  <span class="tok-kd">public</span> <span class="tok-kd">abstract</span> <span class="tok-n">Client</span> <span class="tok-nf">build</span><span class="tok-o">();</span>
<span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>La forma mÃ¡s sencilla de crear un objeto <code>Client</code> es mediante <code>ClientBuilder.newClient()</code>.
Este mÃ©todo proporciona una instancia pre-inicializada de tipo <code>Client</code> lista para ser usada.
La clase <em>ClientBuilder</em> nos proporciona mÃ©todos adicionales, con los que podremos configurar
diferentes propiedades del objeto.</p>
</div>
<div class="paragraph">
<p>Veamos un ejemplo de uso de <code>ClientBuilder.newBuilder()</code> utilizando ademÃ¡s alguno de los mÃ©todos
proporcionados para configurar nuestra instancia de tipo <code>Client</code> que vamos a crear. Los mÃ©todos
<code>register()</code> y <code>property()</code> son mÃ©todos de la interfaz <em>Configurable</em> (y que son implementados por
<em>ClientBuilder</em>).</p>
</div>
<div class="listingblock">
<div class="title">Ejemplo de uso de <em>ClientBuilder</em></div>
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span class="tok-n">Client</span> <span class="tok-n">cliente</span> <span class="tok-o">=</span> <span class="tok-n">ClientBuilder</span><span class="tok-o">.</span><span class="tok-na">newBuilder</span><span class="tok-o">()</span> <i class="conum" data-value="1"></i><b>(1)</b>
                      <span class="tok-o">.</span><span class="tok-na">property</span><span class="tok-o">(</span><span class="tok-s">&quot;connection.timeout&quot;</span><span class="tok-o">,</span> <span class="tok-mi">100</span><span class="tok-o">)</span> <i class="conum" data-value="2"></i><b>(2)</b>
                      <span class="tok-o">.</span><span class="tok-na">sslContext</span><span class="tok-o">(</span><span class="tok-n">sslContext</span><span class="tok-o">)</span> <i class="conum" data-value="3"></i><b>(3)</b>
                      <span class="tok-o">.</span><span class="tok-na">register</span><span class="tok-o">(</span><span class="tok-n">JacksonJsonProvider</span><span class="tok-o">.</span><span class="tok-na">class</span><span class="tok-o">)</span> <i class="conum" data-value="4"></i><b>(4)</b>
                      <span class="tok-o">.</span><span class="tok-na">build</span><span class="tok-o">();</span> <i class="conum" data-value="5"></i><b>(5)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Creamos un <code>ClientBuilder</code> invocando al mÃ©todo estÃ¡tico <code>ClientBuilder.newBuilder()</code></td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Asignamos una propiedad especÃ­fica de la implementaciÃ³n concreta de JAX-RS
que estemos utilizando que controla el <em>timeout</em> de las conexiones de los <em>sockets</em></td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Especificamos el <em>sslContext</em> que queremos utilizar para gestionar las conexiones HTTP</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Registramos a travÃ©s del mÃ©todo <code>register()</code> (de la interfaz <em>Configurable</em>) una clase anotada con <code>@Provider</code>. Dicha
clase "conoce" cÃ³mo serializar objetos Java a JSON y viceversa</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>Finalmente, realizamos una llamada a <code>build()</code> para crear la instancia <code>Client</code></td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Las instancias de <code>Client</code> gestionan conexiones con el cliente utilizando <em>sockets</em> y son
objetos bastante <em>pesados</em>. Se deberÃ­an reutilizar las instancias de esta interfaz en la medida de lo
posible, ya que la inicializaciÃ³n y destrucciÃ³n de dichas instancias consume mucho tiempo. Por lo tanto,
por razones de rendimiento, debemos limitar el nÃºmero de instancias <code>Client</code> en nuestra
aplicaciÃ³n.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span class="tok-n">Client</span> <span class="tok-n">client</span> <span class="tok-o">=</span> <span class="tok-n">ClientBuilder</span><span class="tok-o">.</span><span class="tok-na">newClient</span><span class="tok-o">();</span> <i class="conum" data-value="1"></i><b>(1)</b>
<span class="tok-o">...</span>
<span class="tok-n">client</span><span class="tok-o">.</span><span class="tok-na">close</span><span class="tok-o">();</span> <i class="conum" data-value="2"></i><b>(2)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Obtenemos una instancia de tipo <code>Client</code> invocando al mÃ©todo <code>ClientBuilder.newClient()</code></td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Utilizamos el mÃ©todo <code>close()</code> para "cerrar" la instancia <code>Client</code> despuÃ©s de
 realizar todas las invocaciones sobre el <em>target</em> del recurso. De esta forma, "cerramos"
la conexiÃ³n de forma que se liberan sus recursos, y ya no podremos seguir usÃ¡ndola.</td>
</tr>
</table>
</div>
<div class="admonitionblock caution">
<table>
<tr>
<td class="icon">
<i class="fa icon-caution" title="Caution"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Recuerda siempre invocar el mÃ©todo <code>close()</code> sobre nuestros objetos <code>Client</code> despuÃ©s de
que hayamos realizado todas las invocaciones sobre el <em>target</em> del/los recurso/s REST.
A menudo, los objetos <code>Client</code> reutilizan conexiones por razones de rendimiento.
Si no los cerramos despuÃ©s de utilizarlos, estaremos desaprovechando recursos del
sistema muy "valiosos". <strong>Cerrar la conexiÃ³n implica cerrar el socket</strong></p>
</div>
<div class="paragraph">
<p>Igualmente, si el resultado de una invocaciÃ³n a un servicio rest es una instancia de
<code>Response</code> debemos invocar el mÃ©todo <code>close()</code> sobre dichos objetos <code>Response</code> para
liberar la conexiÃ³n. Liberar una conexion significa permitir que Ã©sta estÃ© disponible
para otro uso por una instancia <em>Client</em>. <strong>Liberar la conexiÃ³n no implica cerrar el socket</strong>.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>La interfaz <code>Client</code> es una sub-interfaz de <code>Configurable</code>. Esto
nos permitirÃ¡ utililizar los mÃ©todos <code>property()</code> y <code>register()</code> para cambiar la
configuraciÃ³n y registrar componentes en la parte del cliente
en tiempo de ejecuciÃ³n.</p>
</div>
<div class="listingblock">
<div class="title">Interfaz <em>Client</em> (es una subinterfaz de <em>Configurable</em>)</div>
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span class="tok-kd">public</span> <span class="tok-kd">interface</span> <span class="tok-nc">Client</span> <span class="tok-kd">extends</span> <span class="tok-n">Configurable</span><span class="tok-o">&lt;</span><span class="tok-n">Client</span><span class="tok-o">&gt;</span> <span class="tok-o">{</span>

   <span class="tok-kd">public</span> <span class="tok-kt">void</span> <span class="tok-nf">close</span><span class="tok-o">();</span>

   <span class="tok-kd">public</span> <span class="tok-n">WebTarget</span> <span class="tok-nf">target</span><span class="tok-o">(</span><span class="tok-n">String</span> <span class="tok-n">uri</span><span class="tok-o">);</span>
   <span class="tok-kd">public</span> <span class="tok-n">WebTarget</span> <span class="tok-nf">target</span><span class="tok-o">(</span><span class="tok-n">URI</span> <span class="tok-n">uri</span><span class="tok-o">);</span>
   <span class="tok-kd">public</span> <span class="tok-n">WebTarget</span> <span class="tok-nf">target</span><span class="tok-o">(</span><span class="tok-n">UriBuilder</span> <span class="tok-n">uriBuilder</span><span class="tok-o">);</span>
   <span class="tok-kd">public</span> <span class="tok-n">WebTarget</span> <span class="tok-nf">target</span><span class="tok-o">(</span><span class="tok-n">Link</span> <span class="tok-n">link</span><span class="tok-o">);</span>
   <span class="tok-o">...</span>
<span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Sin embargo, el principal propÃ³sito de <code>Client</code> es crear
instancias de <code>WebTarget</code>, como veremos a continuaciÃ³n.</p>
</div>
</div>
<div class="sect3">
<h4 id="_configuramos_el_em_target_em_del_cliente_uri">5.1.2. Configuramos el <em>target</em> del cliente (URI)</h4>
<div class="paragraph">
<p>La interfaz <code>javax.ws.rs.client.WebTarget</code> <strong>representa la URI</strong> especÃ­fica que queremos
invocar para acceder a un recurso REST particular.</p>
</div>
<div class="listingblock">
<div class="title">Interfaz WebTarget (es una subinterfaz de <em>Configurable</em>)</div>
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span class="tok-kd">public</span> <span class="tok-kd">interface</span> <span class="tok-nc">WebTarget</span> <span class="tok-kd">extends</span> <span class="tok-n">Configurable</span><span class="tok-o">&lt;</span><span class="tok-n">WebTarget</span><span class="tok-o">&gt;</span> <span class="tok-o">{</span>

  <span class="tok-kd">public</span> <span class="tok-n">URI</span> <span class="tok-nf">getUri</span><span class="tok-o">();</span>
  <span class="tok-kd">public</span> <span class="tok-n">UriBuilder</span> <span class="tok-nf">getUriBuilder</span><span class="tok-o">();</span>

  <span class="tok-kd">public</span> <span class="tok-n">WebTarget</span> <span class="tok-nf">path</span><span class="tok-o">(</span><span class="tok-n">String</span> <span class="tok-n">path</span><span class="tok-o">);</span>
  <span class="tok-kd">public</span> <span class="tok-n">WebTarget</span> <span class="tok-nf">resolveTemplate</span><span class="tok-o">(</span><span class="tok-n">String</span> <span class="tok-n">name</span><span class="tok-o">,</span> <span class="tok-n">Object</span> <span class="tok-n">value</span><span class="tok-o">);</span>
  <span class="tok-o">...</span>
  <span class="tok-kd">public</span> <span class="tok-n">WebTarget</span> <span class="tok-nf">resolveTemplates</span><span class="tok-o">(</span><span class="tok-n">Map</span><span class="tok-o">&lt;</span><span class="tok-n">String</span><span class="tok-o">,</span> <span class="tok-n">Object</span><span class="tok-o">&gt;</span> <span class="tok-n">templateValues</span><span class="tok-o">);</span>
  <span class="tok-o">...</span>
  <span class="tok-kd">public</span> <span class="tok-n">WebTarget</span> <span class="tok-nf">matrixParam</span><span class="tok-o">(</span><span class="tok-n">String</span> <span class="tok-n">name</span><span class="tok-o">,</span> <span class="tok-n">Object</span><span class="tok-o">...</span> <span class="tok-n">values</span><span class="tok-o">);</span>
  <span class="tok-kd">public</span> <span class="tok-n">WebTarget</span> <span class="tok-nf">queryParam</span><span class="tok-o">(</span><span class="tok-n">String</span> <span class="tok-n">name</span><span class="tok-o">,</span> <span class="tok-n">Object</span><span class="tok-o">...</span> <span class="tok-n">values</span><span class="tok-o">);</span>
  <span class="tok-o">...</span>
<span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>La interfaz <code>WebTarget</code> tiene mÃ©todos para extender la URI inicial que hayamos
construido. Podemos aÃ±adir, por ejemplo, segmentos de <em>path</em> o parÃ¡metros de
consulta invocando
a los mÃ©todos <code>WebTarget.path()</code>, o <code>WebTarget.queryParam()</code>, respectivamente.
Si la instancia de <code>WebTarget</code> contiene plantillas de parÃ¡metros, los mÃ©todos
<code>WebTarget.resolveTemplate()</code> pueden asignar valores a las variables correspondientes.
Por ejemplo:</p>
</div>
<div class="listingblock">
<div class="title">Ejemplo para crear la URI <a href="http://ejemplo.com/clientes/123?verboso=true" class="bare">http://ejemplo.com/clientes/123?verboso=true</a></div>
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span class="tok-n">WebTarget</span> <span class="tok-n">target</span> <span class="tok-o">=</span>
        <span class="tok-n">client</span>
           <span class="tok-o">.</span><span class="tok-na">target</span><span class="tok-o">(</span><span class="tok-s">&quot;http://ejemplo.com/clientes/{id}&quot;</span><span class="tok-o">)</span> <i class="conum" data-value="1"></i><b>(1)</b>
           <span class="tok-o">.</span><span class="tok-na">resolveTemplate</span><span class="tok-o">(</span><span class="tok-s">&quot;id&quot;</span><span class="tok-o">,</span> <span class="tok-s">&quot;123&quot;</span><span class="tok-o">)</span> <i class="conum" data-value="2"></i><b>(2)</b>
           <span class="tok-o">.</span><span class="tok-na">queryParam</span><span class="tok-o">(</span><span class="tok-s">&quot;verboso&quot;</span><span class="tok-o">,</span> <span class="tok-kc">true</span><span class="tok-o">);</span> <i class="conum" data-value="3"></i><b>(3)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Inicializamos un <code>WebTarget</code> con una URI que contiene una plantilla
con un parÃ¡metro: <code>{id}</code>. El objeto <code>client</code> es una instancia de la clase `Client</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>El mÃ©todo <code>resolveTemplate()</code> "rellena" la expresiÃ³n <code>id</code> con el valor "123"</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Finalmente aÃ±adimos a la URI un parÃ¡metro de consulta: <code>?verboso=true</code></td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Las instancias de <code>WebTarget</code> son <strong>inmutables</strong> con respecto a la URI que contienen.
Esto significa que los mÃ©todos para especificar segmentos de <code>path</code> adicionales y
parÃ¡metros devuelven <strong>una nueva instancia</strong> de <code>WebTarget</code>. Sin embargo, las instancias
de WebTarget son <strong>mutables</strong> respecto a su configuraciÃ³n. Por lo tanto, la configuraciÃ³n
de objetos <code>WebTarget</code> <strong>no crea nuevas instancias</strong>.</p>
</div>
<div class="paragraph">
<p>Veamos otro ejemplo:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span class="tok-n">WebTarget</span> <span class="tok-n">base</span> <span class="tok-o">=</span> <span class="tok-n">cliente</span><span class="tok-o">.</span><span class="tok-na">target</span><span class="tok-o">(</span><span class="tok-s">&quot;http://expertojava.org/&quot;</span><span class="tok-o">);</span> <i class="conum" data-value="1"></i><b>(1)</b>
<span class="tok-n">WebTarget</span> <span class="tok-n">clienteURI</span> <span class="tok-o">=</span> <span class="tok-n">base</span><span class="tok-o">.</span><span class="tok-na">path</span><span class="tok-o">(</span><span class="tok-s">&quot;cliente&quot;</span><span class="tok-o">);</span> <i class="conum" data-value="2"></i><b>(2)</b>
<span class="tok-n">clienteURI</span><span class="tok-o">.</span><span class="tok-na">register</span><span class="tok-o">(</span><span class="tok-n">MyProvider</span><span class="tok-o">.</span><span class="tok-na">class</span><span class="tok-o">);</span> <i class="conum" data-value="3"></i><b>(3)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td><code>base</code> es una instancia de <code>WebTarget</code> con el valor de URI <code><a href="http://exertojava.org/" class="bare">http://exertojava.org/</a></code></td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td><code>clienteURI</code> es una instancia de <code>WebTarget</code> con el valor de URI <code><a href="http://exertojava.org/cliente" class="bare">http://exertojava.org/cliente</a></code></td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Configuramos <code>clienteURI</code> registrando la clase <code>MyProvider</code></td>
</tr>
</table>
</div>
<div class="paragraph">
<p>En este ejemplo creamos dos instancias de <code>WebTarget</code>. La instancia <code>clienteURI</code> hereda
la configuraciÃ³n de <code>base</code> y posteriormente modificamos la configuramos registrando una clase
<code>Provider</code>. Los cambios sobre la configuraciÃ³n de <code>clienteURI</code> no afectan a la
configuraciÃ³n de <code>base</code>, ni tampoco se crea una nueva instancia de <code>WebTarget</code>.</p>
</div>
<div class="paragraph">
<p>Los beneficios del uso de <code>WebTarget</code> se hacen evidentes cuando construimos URIs
complejas, por ejemplo cuando extendemos nuestra URI base con segmentos de <code>path</code>
adicionales o plantillas. El siguiente ejemplo ilustra estas situaciones:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span class="tok-n">WebTarget</span> <span class="tok-n">base</span> <span class="tok-o">=</span> <span class="tok-n">cliente</span><span class="tok-o">.</span><span class="tok-na">target</span><span class="tok-o">(</span><span class="tok-s">&quot;http://expertojava.org/&quot;</span><span class="tok-o">);</span> <i class="conum" data-value="1"></i><b>(1)</b>
<span class="tok-n">WebTarget</span> <span class="tok-n">saludo</span> <span class="tok-o">=</span> <span class="tok-n">base</span><span class="tok-o">.</span><span class="tok-na">path</span><span class="tok-o">(</span><span class="tok-s">&quot;hola&quot;</span><span class="tok-o">).</span><span class="tok-na">path</span><span class="tok-o">(</span><span class="tok-s">&quot;{quien}&quot;</span><span class="tok-o">);</span> <i class="conum" data-value="2"></i><b>(2)</b>
<span class="tok-n">Response</span> <span class="tok-n">res</span> <span class="tok-o">=</span> <span class="tok-n">saludo</span><span class="tok-o">.</span><span class="tok-na">resolveTemplate</span><span class="tok-o">(</span><span class="tok-s">&quot;quien&quot;</span><span class="tok-o">,</span> <span class="tok-s">&quot;mundo&quot;</span><span class="tok-o">).</span><span class="tok-na">request</span><span class="tok-o">().</span><span class="tok-na">get</span><span class="tok-o">();</span></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td><code>base</code> representa la URI: <code><a href="http://expertojava.org" class="bare">http://expertojava.org</a></code></td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td><code>saludo</code> representa la URI: <code><a href="http://expertojava/hola/%7Bquien%7D" class="bare">http://expertojava/hola/{quien}</a></code></td>
</tr>
</table>
</div>
<div class="paragraph">
<p>En el siguiente ejemplo, utilizamos una URI base, y a partir de ella
construimos otras URIs que representan servicios diferentes proporcionados por
nuestro recurso REST.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span class="tok-n">Client</span> <span class="tok-n">cli</span> <span class="tok-o">=</span> <span class="tok-n">ClientBuilder</span><span class="tok-o">.</span><span class="tok-na">newClient</span><span class="tok-o">();</span>
<span class="tok-n">WebTarget</span> <span class="tok-n">base</span> <span class="tok-o">=</span> <span class="tok-n">client</span><span class="tok-o">.</span><span class="tok-na">target</span><span class="tok-o">(</span><span class="tok-s">&quot;http://ejemplo/webapi&quot;</span><span class="tok-o">);</span>
<span class="tok-n">WebTarget</span> <span class="tok-n">lectura</span> <span class="tok-o">=</span> <span class="tok-n">base</span><span class="tok-o">.</span><span class="tok-na">path</span><span class="tok-o">(</span><span class="tok-s">&quot;leer&quot;</span><span class="tok-o">);</span> <i class="conum" data-value="1"></i><b>(1)</b>
<span class="tok-n">WebTarget</span> <span class="tok-n">escritura</span> <span class="tok-o">=</span> <span class="tok-n">base</span><span class="tok-o">.</span><span class="tok-na">path</span><span class="tok-o">(</span><span class="tok-s">&quot;escribir&quot;</span><span class="tok-o">);</span> <i class="conum" data-value="2"></i><b>(2)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td><code>lectura</code> representa la uri: <code><a href="http://ejemplo/webapi/leer" class="bare">http://ejemplo/webapi/leer</a></code></td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td><code>escritura</code> representa la uri: <code><a href="http://ejemplo/webapi/escribir" class="bare">http://ejemplo/webapi/escribir</a></code></td>
</tr>
</table>
</div>
<div class="paragraph">
<p>El mÃ©todo <code>WebTarget.path()</code> crea una nueva instancia de <code>WebTarget</code> aÃ±adiendo a la URI actual
el segmento de ruta que se pasa como parÃ¡metro.</p>
</div>
</div>
<div class="sect3">
<h4 id="_construimos_y_realizamos_la_peticiÃ³n">5.1.3. Construimos y Realizamos la peticiÃ³n</h4>
<div class="paragraph">
<p>Una vez que hemos creado y configurado convenientemente el <code>WebTarget</code>, que
 representa la URI que queremos invocar, tenemos que construir
la peticiÃ³n y finalmente realizarla.</p>
</div>
<div class="paragraph">
<p>Para <strong>construir la peticiÃ³n</strong> podemos Utilizar uno de los mÃ©todos <code>WebTarget.request()</code>,
que mostramos a continuaciÃ³n:</p>
</div>
<div class="listingblock">
<div class="title">Interfaz WebTarget: mÃ©todos para comenzar a construir la peticiÃ³n</div>
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span class="tok-kd">public</span> <span class="tok-kd">interface</span> <span class="tok-nc">WebTarget</span> <span class="tok-kd">extends</span> <span class="tok-n">Configurable</span><span class="tok-o">&lt;</span><span class="tok-n">WebTarget</span><span class="tok-o">&gt;</span> <span class="tok-o">{</span>
  <span class="tok-o">...</span>
  <span class="tok-kd">public</span> <span class="tok-n">Invocation</span><span class="tok-o">.</span><span class="tok-na">Builder</span> <span class="tok-nf">request</span><span class="tok-o">();</span>
  <span class="tok-kd">public</span> <span class="tok-n">Invocation</span><span class="tok-o">.</span><span class="tok-na">Builder</span> <span class="tok-nf">request</span><span class="tok-o">(</span><span class="tok-n">String</span><span class="tok-o">...</span> <span class="tok-n">acceptedResponseTypes</span><span class="tok-o">);</span>
  <span class="tok-kd">public</span> <span class="tok-n">Invocation</span><span class="tok-o">.</span><span class="tok-na">Builder</span> <span class="tok-nf">request</span><span class="tok-o">(</span><span class="tok-n">MediaType</span><span class="tok-o">...</span> <span class="tok-n">acceptedResponseTypes</span><span class="tok-o">);</span>
<span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Normalmente invocaremos <code>WebTarget.request()</code> pasando como parÃ¡metro el <code>media type</code>
aceptado como respuesta, en forma de <code>String</code> o utilizando una de las constantes de
<code>javax.ws.rs.core.MediaType</code>. Los mÃ©todos <code>WebTarget.request()</code> devuelven una instancia
de <code>Invocation.Builder</code>, una interfaz que proporciona mÃ©todos para preparar la
peticiÃ³n del cliente y tambiÃ©n para invocarla.</p>
</div>
<div class="paragraph">
<p>La interface <em>Invocation.Builder</em> Contiene un conjunto de mÃ©todos que nos permiten construir
diferentes tipos de cabeceras de peticiones. AsÃ­, por ejemplo, proporciona varios mÃ©todos
<code>acceptXXX()</code> para indicar diferentes tipos MIME, lenguajes, o "encoding" aceptados.
TambiÃ©n proporciona mÃ©todos <code>cookie()</code> para especificar <em>cookies</em> para enviar al
servidor. Finalmente proporciona mÃ©todos <code>header()</code> para especificar diferentes valores
de cabeceras.</p>
</div>
<div class="paragraph">
<p>Ejemplos de uso de esta interfaz para construir la peticiÃ³n:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span class="tok-n">Client</span> <span class="tok-n">cli</span> <span class="tok-o">=</span> <span class="tok-n">ClientBuilder</span><span class="tok-o">.</span><span class="tok-na">newClient</span><span class="tok-o">();</span>
<span class="tok-n">cli</span><span class="tok-o">.</span><span class="tok-na">invocation</span><span class="tok-o">(</span><span class="tok-n">Link</span><span class="tok-o">.</span><span class="tok-na">valueOf</span><span class="tok-o">(</span><span class="tok-s">&quot;http://ejemplo/rest&quot;</span><span class="tok-o">)).</span><span class="tok-na">accept</span><span class="tok-o">(</span><span class="tok-s">&quot;application/json&quot;</span><span class="tok-o">).</span><span class="tok-na">get</span><span class="tok-o">();</span>
<span class="tok-c1">//si no utilizamos el mÃ©todo invocation, podemos hacerlo asÃ­:</span>
<span class="tok-n">cli</span><span class="tok-o">.</span><span class="tok-na">target</span><span class="tok-o">(</span><span class="tok-s">&quot;http://ejemplo/rest&quot;</span><span class="tok-o">).</span><span class="tok-na">request</span><span class="tok-o">(</span><span class="tok-s">&quot;application/json&quot;</span><span class="tok-o">).</span><span class="tok-na">get</span><span class="tok-o">();</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span class="tok-n">Client</span> <span class="tok-n">cliente</span> <span class="tok-o">=</span> <span class="tok-n">ClientBuilder</span><span class="tok-o">.</span><span class="tok-na">newClient</span><span class="tok-o">();</span>
<span class="tok-n">WebTarget</span> <span class="tok-n">miRecurso</span> <span class="tok-o">=</span> <span class="tok-n">client</span><span class="tok-o">.</span><span class="tok-na">target</span><span class="tok-o">(</span><span class="tok-s">&quot;http://ejemplo/webapi/mensaje&quot;</span><span class="tok-o">)</span>
 <span class="tok-o">.</span><span class="tok-na">request</span><span class="tok-o">(</span><span class="tok-n">MediaType</span><span class="tok-o">.</span><span class="tok-na">TEXT_PLAIN</span><span class="tok-o">);</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>El uso de una constante <code>MediaType</code> es equivalente a utilizar el <code>String</code> que define
el tipo MIME:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span class="tok-n">Invocation</span><span class="tok-o">.</span><span class="tok-na">Builder</span> <span class="tok-n">builder</span> <span class="tok-o">=</span> <span class="tok-n">miRecurso</span><span class="tok-o">.</span><span class="tok-na">request</span><span class="tok-o">(</span><span class="tok-s">&quot;text/plain&quot;</span><span class="tok-o">);</span></code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Hemos visto que <em>WebTarget</em> implementa mÃ©todos <em>request()</em> cuyos parÃ¡metros especifican
el tipo MIME de la cabecera <em>Accept</em> de la peticiÃ³n. El cÃ³digo puede resultar mÃ¡s "legible"
si usamos en su lugar el mÃ©todo <em>Invocation.Builder.accept()</em>. En cualquier caso es una
cuestiÃ³n de gustos personales.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>DespuÃ©s de determinar el <em>media type</em> de la respuesta, <strong>invocamos la peticiÃ³n</strong> realizando
una llamada a uno de los mÃ©todos de la instancia de <code>Invocation.Builder</code> que se
corresponde con el tipo de peticiÃ³n HTTP esperado por el recurso REST, al que va dirigido
dicha peticiÃ³n. Estos mÃ©todos son:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>get()</code></p>
</li>
<li>
<p><code>post()</code></p>
</li>
<li>
<p><code>delete()</code></p>
</li>
<li>
<p><code>put()</code></p>
</li>
<li>
<p><code>head()</code></p>
</li>
<li>
<p><code>options()</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>La interfaz <em>Invocation.Builder</em> es una subinterfaz de la interfaz <em>SyncInvoker</em>, y es la
que especifica los mÃ©todos anteriores (get, post, &#8230;&#8203;) para realizar peticiones
<strong>sÃ­ncronas</strong>, es decir, que hasta que no nos conteste el servidor, no podremos
continuar procesando el cÃ³digo en la parte del cliente.</p>
</div>
<div class="paragraph">
<p>Las peticiones <strong>GET</strong> tienen los siguientes prototipos:</p>
</div>
<div class="listingblock">
<div class="title">Interface SyncInvoker: peticiones GET sÃ­ncronas</div>
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span class="tok-kd">public</span> <span class="tok-kd">interface</span> <span class="tok-nc">SyncInvoker</span> <span class="tok-o">{</span>
  <span class="tok-o">...</span>
  <span class="tok-o">&lt;</span><span class="tok-n">T</span><span class="tok-o">&gt;</span> <span class="tok-n">T</span> <span class="tok-nf">get</span><span class="tok-o">(</span><span class="tok-n">Class</span><span class="tok-o">&lt;</span><span class="tok-n">T</span><span class="tok-o">&gt;</span> <span class="tok-n">responseType</span><span class="tok-o">);</span>
  <span class="tok-o">&lt;</span><span class="tok-n">T</span><span class="tok-o">&gt;</span> <span class="tok-n">T</span> <span class="tok-nf">get</span><span class="tok-o">(</span><span class="tok-n">GenericType</span><span class="tok-o">&lt;</span><span class="tok-n">T</span><span class="tok-o">&gt;</span> <span class="tok-n">responseType</span><span class="tok-o">);</span>
  <span class="tok-n">Response</span> <span class="tok-nf">get</span><span class="tok-o">();</span>
  <span class="tok-o">...</span>
<span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Los primeros dos mÃ©todos genÃ©ricos convertirÃ¡n una respuesta HTTP con Ã©xito a tipos
Java especÃ­ficos indicados como parÃ¡metros del mÃ©todo.
El tercero devuelve una instancia de tipo <em>Response</em>. Por ejemplo:</p>
</div>
<div class="listingblock">
<div class="title">Ejemplos de peticiones GET utilizando el API cliente jasx-rx 2.0</div>
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span class="tok-n">Client</span> <span class="tok-n">cli</span> <span class="tok-o">=</span> <span class="tok-n">ClientBuilder</span><span class="tok-o">.</span><span class="tok-na">newClient</span><span class="tok-o">();</span>

<span class="tok-c1">//peticiÃ³n get que devuelve una instancia de Cliente</span>
<span class="tok-n">Cliente</span> <span class="tok-n">cliRespuesta</span> <span class="tok-o">=</span> <span class="tok-n">cli</span><span class="tok-o">.</span><span class="tok-na">target</span><span class="tok-o">(</span><span class="tok-s">&quot;http://ejemplo/clientes/123&quot;</span><span class="tok-o">)</span>
                          <span class="tok-o">.</span><span class="tok-na">request</span><span class="tok-o">(</span><span class="tok-s">&quot;application/json&quot;</span><span class="tok-o">)</span>
                          <span class="tok-o">.</span><span class="tok-na">get</span><span class="tok-o">(</span><span class="tok-n">Cliente</span><span class="tok-o">.</span><span class="tok-na">class</span><span class="tok-o">);</span> <i class="conum" data-value="1"></i><b>(1)</b>

<span class="tok-c1">//peticiÃ³n get que devuelve una lista de objetos Cliente</span>
<span class="tok-n">List</span><span class="tok-o">&lt;</span><span class="tok-n">Cliente</span><span class="tok-o">&gt;</span> <span class="tok-n">cliRespuesta2</span> <span class="tok-o">=</span>
                 <span class="tok-n">cli</span><span class="tok-o">.</span><span class="tok-na">target</span><span class="tok-o">(</span><span class="tok-s">&quot;http://ejemplo/clientes&quot;</span><span class="tok-o">)</span>
                    <span class="tok-o">.</span><span class="tok-na">request</span><span class="tok-o">(</span><span class="tok-s">&quot;application/xml&quot;</span><span class="tok-o">)</span>
                    <span class="tok-o">.</span><span class="tok-na">get</span><span class="tok-o">(</span><span class="tok-k">new</span> <span class="tok-n">GenericType</span><span class="tok-o">&lt;</span><span class="tok-n">List</span><span class="tok-o">&lt;</span><span class="tok-n">Cliente</span><span class="tok-o">&gt;&gt;()</span> <span class="tok-o">{});</span> <i class="conum" data-value="2"></i><b>(2)</b>

<span class="tok-c1">//peticiÃ³n get que devuelve un objeto de tipo Response</span>
<span class="tok-n">Response</span> <span class="tok-n">respuesta</span> <span class="tok-o">=</span>
              <span class="tok-n">cli</span><span class="tok-o">.</span><span class="tok-na">target</span><span class="tok-o">(</span><span class="tok-s">&quot;http://ejemplo/clientes/245&quot;</span><span class="tok-o">)</span>
                 <span class="tok-o">.</span><span class="tok-na">request</span><span class="tok-o">(</span><span class="tok-s">&quot;application/json&quot;</span><span class="tok-o">)</span>
                 <span class="tok-o">.</span><span class="tok-na">get</span><span class="tok-o">();</span>  <i class="conum" data-value="3"></i><b>(3)</b>
<span class="tok-k">try</span> <span class="tok-o">{</span>
  <span class="tok-k">if</span> <span class="tok-o">(</span><span class="tok-n">respuesta</span><span class="tok-o">.</span><span class="tok-na">getStatus</span><span class="tok-o">()</span> <span class="tok-o">==</span> <span class="tok-mi">200</span><span class="tok-o">)</span> <span class="tok-o">{</span>
     <span class="tok-n">Cliente</span> <span class="tok-n">cliRespuesta</span> <span class="tok-o">=</span>
                <span class="tok-n">respuesta</span><span class="tok-o">.</span><span class="tok-na">readEntity</span><span class="tok-o">(</span><span class="tok-n">Cliente</span><span class="tok-o">.</span><span class="tok-na">class</span><span class="tok-o">);</span> <i class="conum" data-value="4"></i><b>(4)</b>
  <span class="tok-o">}</span>
<span class="tok-o">}</span> <span class="tok-k">finally</span> <span class="tok-o">{</span>
    <span class="tok-n">respuesta</span><span class="tok-o">.</span><span class="tok-na">close</span><span class="tok-o">();</span>
<span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>En la primera peticiÃ³n queremos que el servidor nos devuelva la respuesta en
formato JSON, y posteriormente la convertiremos en el tipo <code>Cliente</code> utilizando un
de los componentes <code>MessageBodyReader</code> registrados.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>En la segunda peticiÃ³n utilizamos la clase <code>javax.ws.rs.core.GenericType</code> para
informar al correspondiente <code>MessageBodyReader</code> del tipo de objetos de nuestra Lista.
Para ello creamos una clase anÃ³nima a la que le pasamos como parÃ¡metro el tipo
genÃ©rico que queremos obtener.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>En la tercera peticiÃ³n obtenemos una instancia de <em>Response</em>, a partir de la
cual podemos obtener el cuerpo del mensaje de respuesta del servidor</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>El mÃ©todo <em>readEntity()</em> asocia el tipo Java solicitado (en este caso el tipo java <em>Cliente</em>)
y el contenido de la respuesta recibida con el correspondiente proveedor de entidades
(de tipo <em>MessageBodyReader</em>) para obtener dicho tipo Java a partir de la respuesta HTTP
recibida.
ï¿¼
En sesiones anteriores hemos utilizado la clase Response desde el servicio REST, para
construir la respuesta que se envÃ­a al cliente.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Recordemos algunos de los mÃ©todos que podemos utilizar desde el cliente para analizar
la respuesta que hemos obtenido:</p>
</div>
<div class="listingblock">
<div class="title">MÃ©todos de la clase Response que utilizaremos desde el cliente</div>
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span class="tok-kd">public</span> <span class="tok-kd">abstract</span> <span class="tok-kd">class</span> <span class="tok-nc">Response</span> <span class="tok-o">{</span>
  <span class="tok-kd">public</span> <span class="tok-kd">abstract</span> <span class="tok-n">Object</span> <span class="tok-nf">getEntity</span><span class="tok-o">();</span>  <i class="conum" data-value="1"></i><b>(1)</b>
  <span class="tok-kd">public</span> <span class="tok-kd">abstract</span> <span class="tok-kt">int</span> <span class="tok-nf">getStatus</span><span class="tok-o">();</span>  <i class="conum" data-value="2"></i><b>(2)</b>
  <span class="tok-kd">public</span> <span class="tok-kd">abstract</span> <span class="tok-n">Response</span><span class="tok-o">.</span><span class="tok-na">StatusType</span> <span class="tok-nf">getStatusInfo</span><span class="tok-o">()</span> <i class="conum" data-value="3"></i><b>(3)</b>
  <span class="tok-kd">public</span> <span class="tok-kd">abstract</span> <span class="tok-n">MultivaluedMap</span><span class="tok-o">&lt;</span><span class="tok-n">String</span><span class="tok-o">,</span> <span class="tok-n">Object</span><span class="tok-o">&gt;</span> <span class="tok-nf">getMetadata</span><span class="tok-o">();</span>  <i class="conum" data-value="4"></i><b>(4)</b>
  <span class="tok-kd">public</span> <span class="tok-kd">abstract</span> <span class="tok-n">URI</span> <span class="tok-nf">getLocation</span><span class="tok-o">();</span>  <i class="conum" data-value="5"></i><b>(5)</b>
  <span class="tok-kd">public</span> <span class="tok-kd">abstract</span> <span class="tok-n">MediaType</span> <span class="tok-nf">getMediaType</span><span class="tok-o">();</span>  <i class="conum" data-value="6"></i><b>(6)</b>
  <span class="tok-kd">public</span> <span class="tok-n">MultivaluedMap</span><span class="tok-o">&lt;</span><span class="tok-n">String</span><span class="tok-o">,</span><span class="tok-n">Object</span><span class="tok-o">&gt;</span> <span class="tok-nf">getHeaders</span><span class="tok-o">();</span> <i class="conum" data-value="7"></i><b>(7)</b>
  <span class="tok-kd">public</span> <span class="tok-kd">abstract</span> <span class="tok-o">&lt;</span><span class="tok-n">T</span><span class="tok-o">&gt;</span> <span class="tok-n">T</span> <span class="tok-nf">readEntity</span><span class="tok-o">(</span><span class="tok-n">Class</span><span class="tok-o">&lt;</span><span class="tok-n">T</span><span class="tok-o">&gt;</span> <span class="tok-n">entityType</span><span class="tok-o">);</span> <i class="conum" data-value="8"></i><b>(8)</b>
  <span class="tok-kd">public</span> <span class="tok-kd">abstract</span> <span class="tok-o">&lt;</span><span class="tok-n">T</span><span class="tok-o">&gt;</span> <span class="tok-n">T</span> <span class="tok-nf">readEntity</span><span class="tok-o">(</span><span class="tok-n">GenericType</span><span class="tok-o">&lt;</span><span class="tok-n">T</span><span class="tok-o">&gt;</span> <span class="tok-n">entityType</span><span class="tok-o">);</span> <i class="conum" data-value="9"></i><b>(9)</b>
  <span class="tok-kd">public</span> <span class="tok-kd">abstract</span> <span class="tok-kt">void</span> <span class="tok-nf">close</span><span class="tok-o">();</span> <i class="conum" data-value="10"></i><b>(10)</b>
   <span class="tok-o">...</span>
<span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>El mÃ©todo <code>getEntity()</code> devuelve el objeto Java correspondiente al cuerpo
del mensaje HTTP.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>El mÃ©todo <code>getStatus()</code> devuelve el cÃ³digo de respuesta HTTP.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>El mÃ©todo <code>getStatusInfo()</code> devuelve la informaciÃ³n de estado asociada con la respuesta.</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>El mÃ©todo <code>getMetadata()</code> devuelve una instancia de tipo <code>MultivaluedMap</code> con las
cabeceras de la respuesta.</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>El mÃ©todo <code>getLocation()</code> devuelve la URI de la cabecera Location de la respuesta.</td>
</tr>
<tr>
<td><i class="conum" data-value="6"></i><b>6</b></td>
<td>El mÃ©todo <code>getMediaType()</code> devuelve el <em>mediaType</em> del cuerpo de la respuesta</td>
</tr>
<tr>
<td><i class="conum" data-value="7"></i><b>7</b></td>
<td>El mÃ©todo <code>getHeaders()</code> devuelve las cabeceras de respuesta con sus valores correspondientes.</td>
</tr>
<tr>
<td><i class="conum" data-value="8"></i><b>8</b></td>
<td>El mÃ©todo <code>readEntity()</code> devuelve la entidad del cuerpo del mensaje utilizando un
<em>MessageBodyReader</em> que soporte el mapeado del <em>inputStream</em> de la entidad a la clase
Java especificada como parÃ¡metro.</td>
</tr>
<tr>
<td><i class="conum" data-value="9"></i><b>9</b></td>
<td>El mÃ©todo <code>readEntity()</code> tambiÃ©n puede devolver una clase genÃ©rica si se dispone del
<em>MessageBodyReader</em> correspondiente.</td>
</tr>
<tr>
<td><i class="conum" data-value="10"></i><b>10</b></td>
<td>El mÃ©todo <code>close()</code> cierra el <em>input stream</em> correspondiente a la entidad asociada
del cuerpo del mensaje (en el caso de que estÃ© disponible y "abierto"). TambiÃ©n libera
cualquier otro recurso asociado con la respuesta (como por ejemplo datos posiblemente
almacenados en un <em>buffer</em>).</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Veamos otro ejemmplo. Si el recurso REST espera una peticiÃ³n HTTP GET, invocaremos el mÃ©todo
<code>Invocation.Builder.get()</code>. El tipo de retorno del mÃ©todo deberÃ­a corresponderse con
la entidad devuelta por el recurso REST que atenderÃ¡ la peticiÃ³n.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span class="tok-n">Client</span> <span class="tok-n">cliente</span> <span class="tok-o">=</span> <span class="tok-n">ClientBuilder</span><span class="tok-o">.</span><span class="tok-na">newClient</span><span class="tok-o">();</span>
<span class="tok-n">WebTarget</span> <span class="tok-n">miRecurso</span> <span class="tok-o">=</span> <span class="tok-n">cliente</span><span class="tok-o">.</span><span class="tok-na">target</span><span class="tok-o">(</span><span class="tok-s">&quot;http://ejemplo/webapi/lectura&quot;</span><span class="tok-o">);</span>
<span class="tok-n">String</span> <span class="tok-n">respuesta</span> <span class="tok-o">=</span> <span class="tok-n">miRecurso</span><span class="tok-o">.</span><span class="tok-na">request</span><span class="tok-o">(</span><span class="tok-n">MediaType</span><span class="tok-o">.</span><span class="tok-na">TEXT_PLAIN</span><span class="tok-o">)</span>
                            <span class="tok-o">.</span><span class="tok-na">get</span><span class="tok-o">(</span><span class="tok-n">String</span><span class="tok-o">.</span><span class="tok-na">class</span><span class="tok-o">);</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>O tambiÃ©n podrÃ­amos codificarlo como:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span class="tok-n">Client</span> <span class="tok-n">cliente</span> <span class="tok-o">=</span> <span class="tok-n">ClientBuilder</span><span class="tok-o">.</span><span class="tok-na">newClient</span><span class="tok-o">();</span>
<span class="tok-n">String</span> <span class="tok-n">respuesta</span> <span class="tok-o">=</span> <span class="tok-n">cliente</span>
                     <span class="tok-o">.</span><span class="tok-na">target</span><span class="tok-o">(</span><span class="tok-s">&quot;http://ejemplo/webapi/lectura&quot;</span><span class="tok-o">)</span>
                     <span class="tok-o">.</span><span class="tok-na">request</span><span class="tok-o">(</span><span class="tok-n">MediaType</span><span class="tok-o">.</span><span class="tok-na">TEXT_PLAIN</span><span class="tok-o">)</span>
                     <span class="tok-o">.</span><span class="tok-na">get</span><span class="tok-o">(</span><span class="tok-n">String</span><span class="tok-o">.</span><span class="tok-na">class</span><span class="tok-o">);</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Si el tipo de retorno de la peticiÃ³n GET es una colecciÃ³n, usaremos <code>javax.ws.rs.core.GenericType&lt;T&gt;</code>
como parÃ¡metro del mÃ©todo, en donde <code>T</code> es el tipo de la colecciÃ³n:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span class="tok-n">List</span><span class="tok-o">&lt;</span><span class="tok-n">PedidoAlmacen</span><span class="tok-o">&gt;</span> <span class="tok-n">pedidos</span> <span class="tok-o">=</span> <span class="tok-n">client</span>
                              <span class="tok-o">.</span><span class="tok-na">target</span><span class="tok-o">(</span><span class="tok-s">&quot;http://ejemplo/webapi/lectura&quot;</span><span class="tok-o">)</span>
                              <span class="tok-o">.</span><span class="tok-na">path</span><span class="tok-o">(</span><span class="tok-s">&quot;pedidos&quot;</span><span class="tok-o">)</span>
                              <span class="tok-o">.</span><span class="tok-na">request</span><span class="tok-o">(</span><span class="tok-n">MediaType</span><span class="tok-o">.</span><span class="tok-na">APPLICATION_XML</span><span class="tok-o">)</span>
                              <span class="tok-o">.</span><span class="tok-na">get</span><span class="tok-o">(</span><span class="tok-k">new</span> <span class="tok-n">GenericType</span><span class="tok-o">&lt;</span><span class="tok-n">List</span><span class="tok-o">&lt;</span><span class="tok-n">PedidoAlmacen</span><span class="tok-o">&gt;&gt;()</span> <span class="tok-o">{});</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Si el recurso REST destinatario de la peticiÃ³n espera una peticiÃ³n de tipo HTTP POST,
invocaremos el mÃ©todo <code>Invocation.Builder.post()</code>.</p>
</div>
<div class="paragraph">
<p>Las peticiones <strong>POST</strong> tienen los siguientes prototipos:</p>
</div>
<div class="listingblock">
<div class="title">Interface SyncInvoker: peticiones POST sÃ­ncronas</div>
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span class="tok-kd">public</span> <span class="tok-kd">interface</span> <span class="tok-nc">SyncInvoker</span> <span class="tok-o">{</span>
  <span class="tok-o">...</span>
  <span class="tok-o">&lt;</span><span class="tok-n">T</span><span class="tok-o">&gt;</span> <span class="tok-n">T</span> <span class="tok-nf">post</span><span class="tok-o">(</span><span class="tok-n">Entity</span><span class="tok-o">&lt;?&gt;</span> <span class="tok-n">entity</span><span class="tok-o">,</span> <span class="tok-n">Class</span><span class="tok-o">&lt;</span><span class="tok-n">T</span><span class="tok-o">&gt;</span> <span class="tok-n">responseType</span><span class="tok-o">);</span>
  <span class="tok-o">&lt;</span><span class="tok-n">T</span><span class="tok-o">&gt;</span> <span class="tok-n">T</span> <span class="tok-nf">post</span><span class="tok-o">(</span><span class="tok-n">Entity</span><span class="tok-o">&lt;?&gt;</span> <span class="tok-n">entity</span><span class="tok-o">,</span> <span class="tok-n">GenericType</span><span class="tok-o">&lt;</span><span class="tok-n">T</span><span class="tok-o">&gt;</span> <span class="tok-n">responseType</span><span class="tok-o">)</span>
  <span class="tok-n">Response</span> <span class="tok-nf">post</span><span class="tok-o">(</span><span class="tok-n">Entity</span><span class="tok-o">&lt;?&gt;</span> <span class="tok-n">entity</span><span class="tok-o">);</span>
  <span class="tok-o">...</span>
<span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Los primeros dos mÃ©todos genÃ©ricos envÃ­an una entidad (clase java + tipo MIME asociado),
indicada como primer parÃ¡metro del mÃ©todo, y como segundo parÃ¡metro se indica el tipo java
al que se convertirÃ¡ la respuesta recibida. El tercero envÃ­a una entidad y devuelve
una instancia de tipo <em>Response</em>. Por ejemplo:</p>
</div>
<div class="paragraph">
<p>Veamos un ejemplo de invocaciÃ³n de peticiones POST.</p>
</div>
<div class="listingblock">
<div class="title">Ejemplo de peticiÃ³n POST utilizando el API cliente jasx-rx 2.0</div>
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span class="tok-n">Client</span> <span class="tok-n">cli</span> <span class="tok-o">=</span> <span class="tok-n">ClientBuilder</span><span class="tok-o">.</span><span class="tok-na">newClient</span><span class="tok-o">();</span>
<span class="tok-n">Pedido</span> <span class="tok-n">pe</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-nf">PedidoAlmacen</span><span class="tok-o">(...);</span>
<span class="tok-n">Pedido</span> <span class="tok-n">peRespuesta</span> <span class="tok-o">=</span> <span class="tok-n">cli</span>
            <span class="tok-o">.</span><span class="tok-na">target</span><span class="tok-o">(...)</span>
            <span class="tok-o">.</span><span class="tok-na">request</span><span class="tok-o">()</span>
            <span class="tok-o">.</span><span class="tok-na">post</span><span class="tok-o">(</span><span class="tok-n">Entity</span><span class="tok-o">.</span><span class="tok-na">entity</span><span class="tok-o">(</span><span class="tok-k">new</span> <span class="tok-nf">Pedido</span><span class="tok-o">(),</span> <span class="tok-s">&quot;application/json&quot;</span><span class="tok-o">),</span>
                  <span class="tok-n">Pedido</span><span class="tok-o">.</span><span class="tok-na">class</span><span class="tok-o">);</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>En este caso estamos realizando una peticiÃ³n POST. Como <em>payload</em> del mensaje
enviamos un objeto <em>Pedido</em> representado en formato json. La entidad esperada como
respuesta debe ser de tipo Pedido.</p>
</div>
<div class="paragraph">
<p>Esto implica que en el lado del servidor, el mÃ©todo que atiende la peticiÃ³n @Post
tendrÃ¡ un parÃ¡metro de tipo Pedido y se deberÃ¡n serializar los objetos de tipo
Pedido a json, ya que es el tipo MIME asociado a esta entidad (
especificado en la cabera <em>Content-Type</em> de la peticiÃ³n HTTP).</p>
</div>
<div class="paragraph">
<p>La clase <em>Entity</em> encapsula los objetos Java que queremos enviar con las peticiones
GET o POST. No tiene un constructor pÃºblico. En su lugar tenemos que invocar uno de
sus mÃ©todos estÃ¡ticos:</p>
</div>
<div class="listingblock">
<div class="title">Clase javax.ws.rs.client.Entity</div>
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span class="tok-kd">public</span> <span class="tok-kd">final</span> <span class="tok-kd">class</span> <span class="tok-nc">Entity</span><span class="tok-o">&lt;</span><span class="tok-n">T</span><span class="tok-o">&gt;</span> <span class="tok-o">{</span>
   <span class="tok-o">...</span>
   <span class="tok-kd">public</span> <span class="tok-kd">static</span> <span class="tok-o">&lt;</span><span class="tok-n">T</span><span class="tok-o">&gt;</span> <span class="tok-n">Entity</span><span class="tok-o">&lt;</span><span class="tok-n">T</span><span class="tok-o">&gt;</span> <span class="tok-nf">entity</span><span class="tok-o">(</span><span class="tok-n">T</span> <span class="tok-n">entity</span><span class="tok-o">,</span> <span class="tok-n">String</span> <span class="tok-n">mediaType</span><span class="tok-o">)</span> <i class="conum" data-value="1"></i><b>(1)</b>
   <span class="tok-kd">public</span> <span class="tok-kd">static</span> <span class="tok-o">&lt;</span><span class="tok-n">T</span><span class="tok-o">&gt;</span> <span class="tok-n">Entity</span><span class="tok-o">&lt;</span><span class="tok-n">T</span><span class="tok-o">&gt;</span> <span class="tok-nf">entity</span><span class="tok-o">(</span><span class="tok-n">T</span> <span class="tok-n">entity</span><span class="tok-o">,</span> <span class="tok-n">MediaType</span> <span class="tok-n">mediaType</span><span class="tok-o">)</span> <i class="conum" data-value="2"></i><b>(2)</b>
   <span class="tok-kd">public</span> <span class="tok-kd">static</span> <span class="tok-o">&lt;</span><span class="tok-n">T</span><span class="tok-o">&gt;</span> <span class="tok-n">Entity</span><span class="tok-o">&lt;</span><span class="tok-n">T</span><span class="tok-o">&gt;</span> <span class="tok-nf">xml</span><span class="tok-o">(</span><span class="tok-kd">final</span> <span class="tok-n">T</span> <span class="tok-n">entity</span><span class="tok-o">)</span> <span class="tok-o">{</span> <span class="tok-o">}</span> <i class="conum" data-value="3"></i><b>(3)</b>
   <span class="tok-kd">public</span> <span class="tok-kd">static</span> <span class="tok-o">&lt;</span><span class="tok-n">T</span><span class="tok-o">&gt;</span> <span class="tok-n">Entity</span><span class="tok-o">&lt;</span><span class="tok-n">T</span><span class="tok-o">&gt;</span> <span class="tok-nf">json</span><span class="tok-o">(</span><span class="tok-kd">final</span> <span class="tok-n">T</span> <span class="tok-n">entity</span><span class="tok-o">)</span> <span class="tok-o">{</span> <span class="tok-o">}</span> <i class="conum" data-value="4"></i><b>(4)</b>
   <span class="tok-kd">public</span> <span class="tok-kd">static</span> <span class="tok-o">&lt;</span><span class="tok-n">T</span><span class="tok-o">&gt;</span> <span class="tok-n">Entity</span><span class="tok-o">&lt;</span><span class="tok-n">T</span><span class="tok-o">&gt;</span> <span class="tok-nf">text</span><span class="tok-o">(</span><span class="tok-n">T</span> <span class="tok-n">entity</span><span class="tok-o">)</span> <span class="tok-o">{</span> <span class="tok-o">}</span> <i class="conum" data-value="5"></i><b>(5)</b>
   <span class="tok-kd">public</span> <span class="tok-kd">static</span> <span class="tok-n">Entity</span><span class="tok-o">&lt;</span><span class="tok-n">Form</span><span class="tok-o">&gt;</span> <span class="tok-nf">form</span><span class="tok-o">(</span><span class="tok-kd">final</span> <span class="tok-n">Form</span> <span class="tok-n">form</span><span class="tok-o">)</span> <span class="tok-o">{</span> <span class="tok-o">}</span> <i class="conum" data-value="6"></i><b>(6)</b>
   <span class="tok-o">...</span>
<span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>El mÃ©todo estÃ¡tico <em>entity()</em> crea una entidad (clase Java) con un tipo MIME
asociado dado por la cadena de caracteres <em>mediaType</em></td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>El mÃ©todo estÃ¡tico <em>entity()</em> crea una entidad (clase Java) con un tipo MIME
indicado en <em>mediaType</em></td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>El mÃ©todo <em>xml</em> crea una entidad (clase Java) con el tipo MIME "application/xml"</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>El mÃ©todo <em>json</em> crea una entidad (clase Java) con el tipo MIME "application/jsom"</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>El mÃ©todo <em>text</em> crea una entidad (clase Java) con el tipo MIME "text/plain"</td>
</tr>
<tr>
<td><i class="conum" data-value="6"></i><b>6</b></td>
<td>El mÃ©todo <em>form</em> crea una entidad (clase Java) con el tipo MIME "application/x-www-form-urlencoded"</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Veamos otro ejemplo de invocaciÃ³n POST que utiliza la clase <em>Entity</em>:</p>
</div>
<div class="listingblock">
<div class="title">Ejemplo de peticiÃ³n POST y uso de clase Entity</div>
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span class="tok-n">NumSeguimiento</span> <span class="tok-n">numSeg</span> <span class="tok-o">=</span> <span class="tok-n">client</span>
          <span class="tok-o">.</span><span class="tok-na">target</span><span class="tok-o">(</span><span class="tok-s">&quot;http://ejemplo/webapi/escritura&quot;</span><span class="tok-o">)</span>
          <span class="tok-o">.</span><span class="tok-na">request</span><span class="tok-o">(</span><span class="tok-n">MediaType</span><span class="tok-o">.</span><span class="tok-na">APPLICATION_XML</span><span class="tok-o">)</span>  <i class="conum" data-value="1"></i><b>(1)</b>
          <span class="tok-o">.</span><span class="tok-na">post</span><span class="tok-o">(</span><span class="tok-n">Entity</span><span class="tok-o">.</span><span class="tok-na">xml</span><span class="tok-o">(</span><span class="tok-n">pedido</span><span class="tok-o">),</span> <span class="tok-n">NumeroSeguimiento</span><span class="tok-o">.</span><span class="tok-na">class</span><span class="tok-o">);</span> <i class="conum" data-value="2"></i><b>(2)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Especificamos como parÃ¡metro de la peticiÃ³n <em>request()</em> el
tipo MIME que aceptamos en la respuesta (cabecera HTTP <em>Accept</em>).</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Realizamos una peticiÃ³n POST. El cuerpo del mensaje se crea con la
llamada <code>Entity.xml(pedido)</code>. El tipo Entity encapsula la entidad del
mensaje (tipo Java <em>Pedido</em>) y el tipo MIME asociado (tipo MIME <em>application/xml</em>) .</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Veamos un ejemplo en el que enviamos parÃ¡metros de un formulario en una
 peticiÃ³n POST:</p>
</div>
<div class="listingblock">
<div class="title">Ejemplo de envÃ­o de datos de un formulario en una peticiÃ³n POST</div>
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span class="tok-n">Form</span> <span class="tok-n">form</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-nf">Form</span><span class="tok-o">().</span><span class="tok-na">param</span><span class="tok-o">(</span><span class="tok-s">&quot;nombre&quot;</span><span class="tok-o">,</span> <span class="tok-s">&quot;Pedro&quot;</span><span class="tok-o">)</span>
                      <span class="tok-o">.</span><span class="tok-na">param</span><span class="tok-o">(</span><span class="tok-s">&quot;apellido&quot;</span><span class="tok-o">,</span> <span class="tok-s">&quot;Garcia&quot;</span><span class="tok-o">);</span>
<span class="tok-o">...</span>
<span class="tok-n">Response</span> <span class="tok-n">response</span> <span class="tok-o">=</span> <span class="tok-n">client</span><span class="tok-o">.</span><span class="tok-na">target</span><span class="tok-o">(</span><span class="tok-s">&quot;http://ejemplo/clientes&quot;</span><span class="tok-o">)</span>
                    <span class="tok-o">.</span><span class="tok-na">request</span><span class="tok-o">().</span>
                    <span class="tok-o">.</span><span class="tok-na">post</span><span class="tok-o">(</span><span class="tok-n">Entity</span><span class="tok-o">.</span><span class="tok-na">form</span><span class="tok-o">(</span><span class="tok-n">form</span><span class="tok-o">));</span>
<span class="tok-n">response</span><span class="tok-o">.</span><span class="tok-na">close</span><span class="tok-o">();</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>La peticiÃ³n POST del cÃ³digo anterior envÃ­a los datos del formulario, y espera
recibir como respuesta una entidad de tipo <em>Response</em>.</p>
</div>
<div class="paragraph">
<p>El cÃ³digo en el lado del servidor serÃ¡ similar a Ã©ste:</p>
</div>
<div class="listingblock">
<div class="title">Servicio rest que sirve una peticiÃ³n POST a partir de datos de un formulario</div>
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span class="tok-o">...</span>
<span class="tok-nd">@POST</span>
<span class="tok-nd">@Path</span><span class="tok-o">(</span><span class="tok-s">&quot;/clientes&quot;</span><span class="tok-o">)</span>
<span class="tok-nd">@Produces</span><span class="tok-o">(</span><span class="tok-s">&quot;text/html&quot;</span><span class="tok-o">)</span>
<span class="tok-kd">public</span> <span class="tok-n">Response</span> <span class="tok-nf">crearCliente</span><span class="tok-o">(</span><span class="tok-nd">@FormParam</span><span class="tok-o">(</span><span class="tok-s">&quot;nombre&quot;</span><span class="tok-o">)</span><span class="tok-n">String</span> <span class="tok-n">nom</span><span class="tok-o">,</span>
            <span class="tok-nd">@FormParam</span><span class="tok-o">(</span><span class="tok-s">&quot;apellido&quot;</span><span class="tok-o">)</span><span class="tok-n">String</span> <span class="tok-n">ape</span><span class="tok-o">)</span>
<span class="tok-o">{</span>
    <span class="tok-o">...</span> <span class="tok-c1">//creamos el nuevo cliente</span>
    <span class="tok-k">return</span> <span class="tok-n">Response</span><span class="tok-o">.</span><span class="tok-na">ok</span><span class="tok-o">(</span><span class="tok-n">RESPONSE_OK</span><span class="tok-o">).</span><span class="tok-na">build</span><span class="tok-o">();</span>
<span class="tok-o">}</span></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_manejo_de_excepciones">5.1.4. Manejo de excepciones</h4>
<div class="paragraph">
<p>Veamos quÃ© ocurre si se produce una excepciÃ³n cuando utilizamos una forma de invocaciÃ³n que automÃ¡ticamente
convierte la respuesta en el tipo especificado. Supongamos el siguiente ejemplo:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span class="tok-n">Cliente</span> <span class="tok-n">cli</span> <span class="tok-o">=</span> <span class="tok-n">client</span><span class="tok-o">.</span><span class="tok-na">target</span><span class="tok-o">(</span><span class="tok-s">&quot;http://tienda.com/clientes/123&quot;</span><span class="tok-o">)</span>
                    <span class="tok-o">.</span><span class="tok-na">request</span><span class="tok-o">(</span><span class="tok-s">&quot;application/json&quot;</span><span class="tok-o">)</span>
                    <span class="tok-o">.</span><span class="tok-na">get</span><span class="tok-o">(</span><span class="tok-n">Cliente</span><span class="tok-o">.</span><span class="tok-na">class</span><span class="tok-o">);</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>En este escenario, el <em>framework</em> del cliente convierte cualquier cÃ³digo de error
HTTP en una de las excepciones que aÃ±ade JAX-RS 2.0 (BadRequesException, ForbiddenException&#8230;&#8203;)
y que ya hemos visto. Podemos capturar dichas excepciones en nuestro cÃ³digo para
tratarlas adecuadamente:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span class="tok-k">try</span> <span class="tok-o">{</span>
  <span class="tok-n">Cliente</span> <span class="tok-n">cli</span> <span class="tok-o">=</span> <span class="tok-n">client</span><span class="tok-o">.</span><span class="tok-na">target</span><span class="tok-o">(</span><span class="tok-s">&quot;http://tienda.com/clientes/123&quot;</span><span class="tok-o">)</span>
                      <span class="tok-o">.</span><span class="tok-na">request</span><span class="tok-o">(</span><span class="tok-s">&quot;application/json&quot;</span><span class="tok-o">)</span>
                      <span class="tok-o">.</span><span class="tok-na">get</span><span class="tok-o">(</span><span class="tok-n">Cliente</span><span class="tok-o">.</span><span class="tok-na">class</span><span class="tok-o">);</span>
<span class="tok-o">}</span> <span class="tok-k">catch</span> <span class="tok-o">(</span><span class="tok-n">NotAcceptableException</span> <span class="tok-n">notAcceptable</span><span class="tok-o">)</span> <span class="tok-o">{</span>
      <span class="tok-o">...</span>
<span class="tok-o">}</span> <span class="tok-k">catch</span> <span class="tok-o">(</span><span class="tok-n">NotFoundException</span> <span class="tok-n">notFound</span><span class="tok-o">)</span> <span class="tok-o">{</span>
      <span class="tok-o">...</span>
<span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Si el servidor responde con un error HTTP no cubierto por alguna excepciÃ³n especÃ­fica
JAX-RS, entonces se lanza una excepciÃ³n de propÃ³sito general. La clase
<code>ClientErrorException</code> cubre cualquier cÃ³digo de error en la franja del 400.
La clase
<code>ServerErrorException</code> cubre cualquier cÃ³digo de error en la franja del 500.</p>
</div>
<div class="paragraph">
<p>Si el servidor envÃ­a alguna de los cÃ³digos de respuesta HTTP 3xx (clasificados como
cÃ³digos de la categorÃ­a <em>redirecciÃ³n</em>), el API cliente lanza una
 <code>RedirectionException</code>, a partir de la cual podemos obtener la URL para poder
 tratar la redirecciÃ³n nosotros mismos. Por ejemplo:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span class="tok-n">WebTarget</span> <span class="tok-n">target</span> <span class="tok-o">=</span> <span class="tok-n">client</span><span class="tok-o">.</span><span class="tok-na">target</span><span class="tok-o">(</span><span class="tok-s">&quot;http://tienda.com/clientes/123&quot;</span><span class="tok-o">);</span>
<span class="tok-kt">boolean</span> <span class="tok-n">redirected</span> <span class="tok-o">=</span> <span class="tok-kc">false</span><span class="tok-o">;</span>

<span class="tok-n">Cliente</span> <span class="tok-n">cli</span> <span class="tok-o">=</span> <span class="tok-kc">null</span><span class="tok-o">;</span>
<span class="tok-k">do</span> <span class="tok-o">{</span>
     <span class="tok-k">try</span> <span class="tok-o">{</span>
          <span class="tok-n">cli</span> <span class="tok-o">=</span> <span class="tok-n">target</span><span class="tok-o">.</span><span class="tok-na">request</span><span class="tok-o">(</span><span class="tok-s">&quot;application/json&quot;</span><span class="tok-o">)</span>
                      <span class="tok-o">.</span><span class="tok-na">get</span><span class="tok-o">(</span><span class="tok-n">Cliente</span><span class="tok-o">.</span><span class="tok-na">class</span><span class="tok-o">);</span>
     <span class="tok-o">}</span> <span class="tok-k">catch</span> <span class="tok-o">(</span><span class="tok-n">RedirectionException</span> <span class="tok-n">redirect</span><span class="tok-o">)</span> <span class="tok-o">{</span>
          <span class="tok-k">if</span> <span class="tok-o">(</span><span class="tok-n">redirected</span><span class="tok-o">)</span> <span class="tok-k">throw</span> <span class="tok-n">redirect</span><span class="tok-o">;</span>
          <span class="tok-n">redirected</span> <span class="tok-o">=</span> <span class="tok-kc">true</span><span class="tok-o">;</span>
          <span class="tok-n">target</span> <span class="tok-o">=</span> <span class="tok-n">client</span><span class="tok-o">.</span><span class="tok-na">target</span><span class="tok-o">(</span><span class="tok-n">redirect</span><span class="tok-o">.</span><span class="tok-na">getLocation</span><span class="tok-o">());</span>
   <span class="tok-o">}</span>
<span class="tok-o">}</span> <span class="tok-k">while</span> <span class="tok-o">(</span><span class="tok-n">cli</span> <span class="tok-o">==</span> <span class="tok-kc">null</span><span class="tok-o">);</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>En este ejemplo, volvemos a iterar si recibimos un cÃ³digo de respuesta 3xx. El
cÃ³digo se asegura de que sÃ³lo permitimos un cÃ³digo de este tipo, cambiando el valor
de la variable <code>redirect</code> en el bloque en el que capturamos la exceptiÃ³n.
A continuaciÃ³n cambiamos el <code>WebTarget</code> (en el bloque <code>catch</code>) al valor de la cabecera <code>Location</code>
de la respuesta del servidor.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Los cÃ³digos de estado HTTP 3xx indican que es neceario realizar alguna acciÃ³n
adicional para que el servidor pueda completar la peticiÃ³n. La acciÃ³n requerida
puede llevarse a cabo sin necesidad de interactuar con el cliente sÃ³lo si el
mÃ©todo utilizado en la segunda peticiÃ³n es GET o HEAD
(ver <a href="http://www.w3.org/Protocols/rfc2616/rfc2616-sec10.html" class="bare">http://www.w3.org/Protocols/rfc2616/rfc2616-sec10.html</a>)</p>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_procesamiento_json">5.2. Procesamiento JSON</h3>
<div class="paragraph">
<p>JSON (<strong>J</strong>ava<strong>S</strong>cript <strong>O</strong>bject <strong>N</strong>otation) es un formato para el intercambio
de datos basado en texto, derivado de Javascript (Javascript disponde de una funciÃ³n
nativa: <code>eval()</code> para convertir <em>streams</em> JSON en objetos con propiedades que son
accesibles sin necesidad de manipular ninguna cadena de caracteres).</p>
</div>
<div class="paragraph">
<p>La especificaciÃ³n
<a href="https://jcp.org/aboutJava/communityprocess/final/jsr353/index.html"><strong>JSR 353</strong></a>
proporciona un API para el procesamiento de datos JSON (<em>parsing</em>, transformaciÃ³n y consultas).</p>
</div>
<div class="paragraph">
<p>La gramÃ¡tica de los objetos JSON es bastante simple. SÃ³lo se requieren dos estructuras:
objetos y <em>arrays</em>. Un <strong>objeto</strong> es un conjunto de pares <em>nombre-valor</em>, y un <strong><em>array</em></strong>
es una lista de valores. JSON define siete tipos de valores: <code>string</code>, <code>number</code>,
<code>object</code>, <code>array</code>, <code>true</code>, <code>false</code>, y <code>null</code>.</p>
</div>
<div class="paragraph">
<p>El siguiente ejemplo muestra datos JSON para un objeto que contiene pares <em>nombre-valor</em>:</p>
</div>
<div class="listingblock">
<div class="title">Ejemplo formato JSON</div>
<div class="content">
<pre class="pygments highlight"><code data-lang="json"><span class="tok-p">{</span> <span class="tok-nt">&quot;nombre&quot;</span><span class="tok-p">:</span> <span class="tok-s2">&quot;John&quot;</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;apellidos&quot;</span><span class="tok-p">:</span> <span class="tok-s2">&quot;Smith&quot;</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;edad&quot;</span><span class="tok-p">:</span> <span class="tok-mi">25</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;direccion&quot;</span><span class="tok-p">:</span> <span class="tok-p">{</span> <span class="tok-nt">&quot;calle&quot;</span><span class="tok-p">:</span> <span class="tok-s2">&quot;21 2nd Street&quot;</span><span class="tok-p">,</span>
                 <span class="tok-nt">&quot;ciudad&quot;</span><span class="tok-p">:</span> <span class="tok-s2">&quot;New York&quot;</span><span class="tok-p">,</span>
                 <span class="tok-nt">&quot;codPostal&quot;</span><span class="tok-p">:</span> <span class="tok-s2">&quot;10021&quot;</span>
               <span class="tok-p">},</span>
  <span class="tok-nt">&quot;telefonos&quot;</span><span class="tok-p">:</span> <span class="tok-p">[</span>
         <span class="tok-p">{</span> <span class="tok-nt">&quot;tipo&quot;</span><span class="tok-p">:</span> <span class="tok-s2">&quot;fijo&quot;</span><span class="tok-p">,</span>
           <span class="tok-nt">&quot;numero&quot;</span><span class="tok-p">:</span> <span class="tok-s2">&quot;212 555-1234&quot;</span>
         <span class="tok-p">},</span>
         <span class="tok-p">{</span>
           <span class="tok-nt">&quot;tipo&quot;</span><span class="tok-p">:</span> <span class="tok-s2">&quot;movil&quot;</span><span class="tok-p">,</span>
           <span class="tok-nt">&quot;numero&quot;</span><span class="tok-p">:</span> <span class="tok-s2">&quot;646 555-4567&quot;</span>
         <span class="tok-p">}</span>
  <span class="tok-p">]</span>
 <span class="tok-p">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>El objeto anterior tiene cinco pares <em>nombre-valor</em>:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Los dos primeros son <code>nombre</code> y <code>apellidos</code>, con el valor de tipo <code>String</code></p>
</li>
<li>
<p>El tercero es <code>edad</code>, con el valor de tipo <code>number</code></p>
</li>
<li>
<p>El cuarto es <code>direccion</code>, con el valor de tipo <code>object</code></p>
</li>
<li>
<p>El quinto es <code>telefonos</code>, cuyo valor es de tipo <code>array</code>, con dos objetos</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>JSON tiene la siguiente <strong>sintaxis</strong>:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Los <strong>objetos</strong> estÃ¡n rodeados por llaves <code>{}</code>, sus <strong>pares de elementos</strong> <em>nombre-valor</em> estÃ¡n
separados por una coma <code>,</code>, y el <em>nombre</em> y el <em>valor</em> de cada par estÃ¡n separados
por dos puntos <code>:</code>. Los <strong>nombres</strong> en un objeto son de tipo <code>String</code>, mientras que sus <strong>valores</strong>
pueden ser cualquiera de los siete tipos que ya hemos indicado, incluyendo a otro
objeto, u otro array.</p>
</li>
<li>
<p>Los <strong>arrays</strong> estÃ¡n rodeados por corchetes <code>[]</code>, y sus valores estÃ¡n separados por
una coma <code>,</code>. Cada valor en un <em>array</em> puede ser de un tipo diferente, incluyendo a
otro objeto o array.</p>
</li>
<li>
<p>Cuando los objetos y arrays contienen otros objetos y/o arrays, los datos adquieren
una <strong>estructura de Ã¡rbol</strong></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Los servicios web RESTful utilizan JSON habitualmente tanto en las peticiones, como en las respuestas.
La cabecera HTTP utilizada para indicar que el contenido de una peticiÃ³n o una respuesta
es JSON es la siguiente:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code>Content-Type: application/json</code></pre>
</div>
</div>
<div class="paragraph">
<p>La representaciÃ³n JSON es normalmente mÃ¡s compacta que las representaciones XML debido
a que JSON no tiene <em>etiquetas de cierre</em>. A diferencia de XML, JSON no tiene un "esquema"
de definiciÃ³n y validaciÃ³n de datos ampliamente aceptado.</p>
</div>
<div class="paragraph">
<p>Actualmente, las aplicaciones Java utilizan diferentes librerÃ­as para producir/consumir
JSON, que tienen que incluirse junto con el cÃ³digo de la aplicaciÃ³n, incrementando asÃ­ el
tamaÃ±o del archivo desplegado. El API de Java para procesamiento JSON proporciona un API estÃ¡ndar para analizar y
generar JSON, de forma que las aplicaciones que utilicen dicho API sean mÃ¡s "ligeras" y
portables.</p>
</div>
<div class="paragraph">
<p>Para generar y parsear datos JSON, hay dos modelos de programaciÃ³n, que son similares
a los usados para documentos XML:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>El modelo de objetos: crea un Ã¡rbol en memoria que representa los datos JSON</p>
</li>
<li>
<p>El modelo basado en <em>streaming</em>: utiliza un <em>parser</em> que lee los datos JSON elemento a
elemento (uno cada vez).</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Java EE incluye soporte para JSR 353, de forma que el API de java para procesamiento JSON se
encuentra en los siguientes paquetes:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>El paquete <code>javax.json</code> contiene interfaces para leer, escribir y construir datos JSON,
segÃºn el modelo de objetos, asÃ­ como otras utilidades.</p>
</li>
<li>
<p>El paquete <code>javax.json.stream</code> contiene una interfaz para parsear y generar datos JSON
para el modelo <em>streaming</em></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Vamos a ver cÃ³mo producir y consumir datos JSON utilizando cada uno de los modelos.</p>
</div>
</div>
<div class="sect2">
<h3 id="_modelo_de_procesamiento_basado_en_el_modelo_de_objetos">5.3. Modelo de procesamiento basado en el modelo de objetos</h3>
<div class="paragraph">
<p>En este caso se crea un Ã¡rbol en memoria que representa los datos JSON (todos los datos).
Una vez construido el Ã¡rbol, se puede navegar por Ã©l, analizarlo, o modificarlo. Esta
aproximaciÃ³n es muy flexible y permite un procesamiento que requiera acceder al contenido
completo del Ã¡rbol. En contrapartida, normalmente es mÃ¡s lento que el modelo de <em>streaming</em>
y requiere utilizar mÃ¡s memoria. El modelo de objetos genera una salida JSON navegando por el
Ã¡rbol entero de una vez.</p>
</div>
<div class="paragraph">
<p>El siguiente cÃ³digo muestra cÃ³mo crear un modelo de objetos a partir de datos JSON
desde un fichero de texto:</p>
</div>
<div class="listingblock">
<div class="title">CreaciÃ³n de un modelos de objetos a partir de datos JSON</div>
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span class="tok-kn">import</span> <span class="tok-nn">java.io.FileReader</span><span class="tok-o">;</span>
<span class="tok-kn">import</span> <span class="tok-nn">javax.json.Json</span><span class="tok-o">;</span>
<span class="tok-kn">import</span> <span class="tok-nn">javax.json.JsonReader</span><span class="tok-o">;</span>
<span class="tok-kn">import</span> <span class="tok-nn">javax.json.JsonStructure</span><span class="tok-o">;</span>
<span class="tok-o">...</span>
<span class="tok-n">JsonReader</span> <span class="tok-n">reader</span> <span class="tok-o">=</span> <span class="tok-n">Json</span><span class="tok-o">.</span><span class="tok-na">createReader</span><span class="tok-o">(</span><span class="tok-k">new</span> <span class="tok-nf">FileReader</span><span class="tok-o">(</span><span class="tok-s">&quot;datosjson.txt&quot;</span><span class="tok-o">));</span>
<span class="tok-n">JsonStructure</span> <span class="tok-n">jsonst</span> <span class="tok-o">=</span> <span class="tok-n">reader</span><span class="tok-o">.</span><span class="tok-na">read</span><span class="tok-o">();</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>El objeto <code>jsonst</code> puede ser de tipo <code>JsonObject</code> o de tipo <code>JsonArray</code>, dependiendo
de los contenidos del fichero. <code>JsonObject</code> y <code>JsonArray</code> son subtipos de
<code>JsonStructure</code>. Este objeto representa la raÃ­z del Ã¡rbol y puede utilizarse para
navegar por el Ã¡rbol o escribirlo en un <em>stream</em> como datos JSON.</p>
</div>
<div class="paragraph">
<p>Vamos a mostrar algÃºn ejemplo en el que utilicemos un <code>StringReader</code>.</p>
</div>
<div class="listingblock">
<div class="title">Objeto JSON con dos pares <em>nombre-valor</em></div>
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span class="tok-n">jsonReader</span> <span class="tok-o">=</span> <span class="tok-n">Json</span><span class="tok-o">.</span><span class="tok-na">createReader</span><span class="tok-o">(</span><span class="tok-k">new</span> <span class="tok-nf">StringReader</span><span class="tok-o">(</span><span class="tok-s">&quot;{&quot;</span>
                      <span class="tok-o">+</span> <span class="tok-s">&quot;  \&quot;manzana\&quot;:\&quot;roja\&quot;,&quot;</span>
                      <span class="tok-o">+</span> <span class="tok-s">&quot;  \&quot;plÃ¡tano\&quot;:\&quot;amarillo\&quot;&quot;</span>
                      <span class="tok-o">+</span> <span class="tok-s">&quot;}&quot;</span><span class="tok-o">));</span>
<span class="tok-n">JsonObject</span> <span class="tok-n">json</span> <span class="tok-o">=</span> <span class="tok-n">jsonReader</span><span class="tok-o">.</span><span class="tok-na">readObject</span><span class="tok-o">();</span>
<span class="tok-n">json</span><span class="tok-o">.</span><span class="tok-na">getString</span><span class="tok-o">(</span><span class="tok-s">&quot;manzana&quot;</span><span class="tok-o">);</span> <i class="conum" data-value="1"></i><b>(1)</b>
<span class="tok-n">json</span><span class="tok-o">.</span><span class="tok-na">getString</span><span class="tok-o">(</span><span class="tok-s">&quot;plÃ¡tano&quot;</span><span class="tok-o">);</span></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>El mÃ©todo <code>getString()</code> devuelve el valor del <em>string</em> para la clave especificada como
parÃ¡metro. Pueden utilizarse otros mÃ©todos <code>getXXX()</code> para acceder al valor correspondiente
de la clave en funciÃ³n del tipo de dicho objeto.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Un <em>array</em> con dos objetos, cada uno de ellos con un par <em>nombre-valor</em> puede
leerse como:</p>
</div>
<div class="listingblock">
<div class="title">Array con dos objetos</div>
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span class="tok-n">jsonReader</span> <span class="tok-o">=</span> <span class="tok-n">Json</span><span class="tok-o">.</span><span class="tok-na">createReader</span><span class="tok-o">(</span><span class="tok-k">new</span> <span class="tok-nf">StringReader</span><span class="tok-o">(</span><span class="tok-s">&quot;[&quot;</span>
                        <span class="tok-o">+</span> <span class="tok-s">&quot;  { \&quot;manzana\&quot;:\&quot;rojo\&quot; },&quot;</span>
                        <span class="tok-o">+</span> <span class="tok-s">&quot;  { \&quot;plÃ¡tano\&quot;:\&quot;amarillo\&quot; }&quot;</span>
                        <span class="tok-o">+</span> <span class="tok-s">&quot;]&quot;</span><span class="tok-o">));</span>
<span class="tok-n">JsonArray</span> <span class="tok-n">jsonArray</span> <span class="tok-o">=</span> <span class="tok-n">jsonReader</span><span class="tok-o">.</span><span class="tok-na">readArray</span><span class="tok-o">();</span> <i class="conum" data-value="1"></i><b>(1)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>La interfaz JsonArray tambiÃ©n tiene mÃ©todos <code>get</code> para valores de tipo
<code>boolean</code>, <code>integer</code>, y <code>String</code> en el Ã­ndice especificado (esta interfaz hereda
de java.util.List)</td>
</tr>
</table>
</div>
<div class="sect3">
<h4 id="_creaciÃ³n_de_un_modelos_de_objetos_desde_el_cÃ³digo_de_la_aplicaciÃ³n">5.3.1. CreaciÃ³n de un modelos de objetos desde el cÃ³digo de la aplicaciÃ³n</h4>
<div class="paragraph">
<p>A continuaciÃ³n mostramos un ejemplo de cÃ³digo para crear un modelo de objetos
mediante programaciÃ³n:</p>
</div>
<div class="listingblock">
<div class="title">Ejemplo de creaciÃ³n de un modelo de objetos JSON desde programaciÃ³n</div>
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span class="tok-kn">import</span> <span class="tok-nn">javax.json.Json</span><span class="tok-o">;</span>
<span class="tok-kn">import</span> <span class="tok-nn">javax.json.JsonObject</span><span class="tok-o">;</span>
<span class="tok-o">...</span>
<span class="tok-n">JsonObject</span> <span class="tok-n">modelo</span> <span class="tok-o">=</span>
    <span class="tok-n">Json</span><span class="tok-o">.</span><span class="tok-na">createObjectBuilder</span><span class="tok-o">()</span> <i class="conum" data-value="1"></i><b>(1)</b>
        <span class="tok-o">.</span><span class="tok-na">add</span><span class="tok-o">(</span><span class="tok-s">&quot;nombre&quot;</span><span class="tok-o">,</span> <span class="tok-s">&quot;Duke&quot;</span><span class="tok-o">)</span>
        <span class="tok-o">.</span><span class="tok-na">add</span><span class="tok-o">(</span><span class="tok-s">&quot;apellidos&quot;</span><span class="tok-o">,</span> <span class="tok-s">&quot;Java&quot;</span><span class="tok-o">)</span>
        <span class="tok-o">.</span><span class="tok-na">add</span><span class="tok-o">(</span><span class="tok-s">&quot;edad&quot;</span><span class="tok-o">,</span> <span class="tok-mi">18</span><span class="tok-o">)</span>
        <span class="tok-o">.</span><span class="tok-na">add</span><span class="tok-o">(</span><span class="tok-s">&quot;calle&quot;</span><span class="tok-o">,</span> <span class="tok-s">&quot;100 Internet Dr&quot;</span><span class="tok-o">)</span>
        <span class="tok-o">.</span><span class="tok-na">add</span><span class="tok-o">(</span><span class="tok-s">&quot;ciudad&quot;</span><span class="tok-o">,</span> <span class="tok-s">&quot;JavaTown&quot;</span><span class="tok-o">)</span>
        <span class="tok-o">.</span><span class="tok-na">add</span><span class="tok-o">(</span><span class="tok-s">&quot;codPostal&quot;</span><span class="tok-o">,</span> <span class="tok-s">&quot;12345&quot;</span><span class="tok-o">)</span>
        <span class="tok-o">.</span><span class="tok-na">add</span><span class="tok-o">(</span><span class="tok-s">&quot;telefonos&quot;</span><span class="tok-o">,</span>
              <span class="tok-n">Json</span><span class="tok-o">.</span><span class="tok-na">createArrayBuilder</span><span class="tok-o">()</span> <i class="conum" data-value="2"></i><b>(2)</b>
                  <span class="tok-o">.</span><span class="tok-na">add</span><span class="tok-o">(</span><span class="tok-n">Json</span><span class="tok-o">.</span><span class="tok-na">createObjectBuilder</span><span class="tok-o">()</span>
                           <span class="tok-o">.</span><span class="tok-na">add</span><span class="tok-o">(</span><span class="tok-s">&quot;tipo&quot;</span><span class="tok-o">,</span> <span class="tok-s">&quot;casa&quot;</span><span class="tok-o">)</span>
                           <span class="tok-o">.</span><span class="tok-na">add</span><span class="tok-o">(</span><span class="tok-s">&quot;numero&quot;</span><span class="tok-o">,</span> <span class="tok-s">&quot;111-111-1111&quot;</span><span class="tok-o">))</span>
                  <span class="tok-o">.</span><span class="tok-na">add</span><span class="tok-o">(</span><span class="tok-n">Json</span><span class="tok-o">.</span><span class="tok-na">createObjectBuilder</span><span class="tok-o">()</span>
                           <span class="tok-o">.</span><span class="tok-na">add</span><span class="tok-o">(</span><span class="tok-s">&quot;tipo&quot;</span><span class="tok-o">,</span> <span class="tok-s">&quot;movil&quot;</span><span class="tok-o">)</span>
                           <span class="tok-o">.</span><span class="tok-na">add</span><span class="tok-o">(</span><span class="tok-s">&quot;numero&quot;</span><span class="tok-o">,</span> <span class="tok-s">&quot;222-222-2222&quot;</span><span class="tok-o">)))</span>
            <span class="tok-o">.</span><span class="tok-na">build</span><span class="tok-o">();</span></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>El tipo <code>JsonObject</code> representa un objeto JSON. El mÃ©todo <code>Json.createObjectBuilder()</code>
crea un modelo de objetos en memoria aÃ±adiendo elementos desde el cÃ³digo de nuestra
aplicaciÃ³n</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>El mÃ©todo <code>Json.createArrayBuilder()</code> crea un modelo de arrays en memoria aÃ±adiendo
elementos desde el cÃ³digo de nuestra aplicaciÃ³n</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>El objeto <code>modelo</code>, de tipo <code>JsonObject</code> representa la raÃ­z del Ã¡rbol, que es
creado anidando llamadas
a mÃ©todos Â´add()Â´, y construyendo el Ã¡rbol a travÃ©s del mÃ©todo <code>build()</code>.</p>
</div>
<div class="paragraph">
<p>La estructura JSON generada es la siguiente:</p>
</div>
<div class="listingblock">
<div class="title">Ejemplo formato JSON generado mediante programaciÃ³n</div>
<div class="content">
<pre class="pygments highlight"><code data-lang="json"><span class="tok-p">{</span> <span class="tok-nt">&quot;nombre&quot;</span><span class="tok-p">:</span> <span class="tok-s2">&quot;Duke&quot;</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;apellidos&quot;</span><span class="tok-p">:</span> <span class="tok-s2">&quot;Java&quot;</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;edad&quot;</span><span class="tok-p">:</span> <span class="tok-mi">18</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;calle&quot;</span><span class="tok-p">:</span> <span class="tok-s2">&quot;100 Internet Dr&quot;</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;ciudad&quot;</span><span class="tok-p">:</span> <span class="tok-s2">&quot;JavaTown&quot;</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;codPostal&quot;</span><span class="tok-p">:</span> <span class="tok-s2">&quot;12345&quot;</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;telefonos&quot;</span><span class="tok-p">:</span> <span class="tok-p">[</span>
         <span class="tok-p">{</span> <span class="tok-nt">&quot;tipo&quot;</span><span class="tok-p">:</span> <span class="tok-s2">&quot;casa&quot;</span><span class="tok-p">,</span>
           <span class="tok-nt">&quot;numero&quot;</span><span class="tok-p">:</span> <span class="tok-s2">&quot;111-111-1111&quot;</span>
         <span class="tok-p">},</span>
         <span class="tok-p">{</span>
           <span class="tok-nt">&quot;tipo&quot;</span><span class="tok-p">:</span> <span class="tok-s2">&quot;movil&quot;</span><span class="tok-p">,</span>
           <span class="tok-nt">&quot;numero&quot;</span><span class="tok-p">:</span> <span class="tok-s2">&quot;222-222-2222&quot;</span>
         <span class="tok-p">}</span>
  <span class="tok-p">]</span>
 <span class="tok-p">}</span></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_navegando_por_el_modelo_de_objetos">5.3.2. Navegando por el modelo de objetos</h4>
<div class="paragraph">
<p>A continuaciÃ³n mostramos un cÃ³digo de ejemplo para navegar por el modelo de objetos:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span class="tok-kn">import</span> <span class="tok-nn">javax.json.JsonValue</span><span class="tok-o">;</span>
<span class="tok-kn">import</span> <span class="tok-nn">javax.json.JsonObject</span><span class="tok-o">;</span>
<span class="tok-kn">import</span> <span class="tok-nn">javax.json.JsonArray</span><span class="tok-o">;</span>
<span class="tok-kn">import</span> <span class="tok-nn">javax.json.JsonNumber</span><span class="tok-o">;</span>
<span class="tok-kn">import</span> <span class="tok-nn">javax.json.JsonString</span><span class="tok-o">;</span>
<span class="tok-o">...</span>
<span class="tok-kd">public</span> <span class="tok-kd">static</span> <span class="tok-kt">void</span> <span class="tok-nf">navegarPorElArbol</span><span class="tok-o">(</span><span class="tok-n">JsonValue</span> <span class="tok-n">arbol</span><span class="tok-o">,</span> <span class="tok-n">String</span> <span class="tok-n">clave</span><span class="tok-o">)</span> <span class="tok-o">{</span>
  <span class="tok-k">if</span> <span class="tok-o">(</span><span class="tok-n">clave</span> <span class="tok-o">!=</span> <span class="tok-kc">null</span><span class="tok-o">)</span>
    <span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">out</span><span class="tok-o">.</span><span class="tok-na">print</span><span class="tok-o">(</span><span class="tok-s">&quot;Clave &quot;</span> <span class="tok-o">+</span> <span class="tok-n">clave</span> <span class="tok-o">+</span> <span class="tok-s">&quot;: &quot;</span><span class="tok-o">);</span>
  <span class="tok-k">switch</span><span class="tok-o">(</span><span class="tok-n">arbol</span><span class="tok-o">.</span><span class="tok-na">getValueType</span><span class="tok-o">())</span> <span class="tok-o">{</span>
    <span class="tok-k">case</span> <span class="tok-nl">OBJECT:</span>
       <span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">out</span><span class="tok-o">.</span><span class="tok-na">println</span><span class="tok-o">(</span><span class="tok-s">&quot;OBJETO&quot;</span><span class="tok-o">);</span>
       <span class="tok-n">JsonObject</span> <span class="tok-n">objeto</span> <span class="tok-o">=</span> <span class="tok-o">(</span><span class="tok-n">JsonObject</span><span class="tok-o">)</span> <span class="tok-n">arbol</span><span class="tok-o">;</span>
       <span class="tok-k">for</span> <span class="tok-o">(</span><span class="tok-n">String</span> <span class="tok-n">nombre</span> <span class="tok-o">:</span> <span class="tok-n">object</span><span class="tok-o">.</span><span class="tok-na">keySet</span><span class="tok-o">())</span>
          <span class="tok-n">navegarPorElArbol</span><span class="tok-o">(</span><span class="tok-n">object</span><span class="tok-o">.</span><span class="tok-na">get</span><span class="tok-o">(</span><span class="tok-n">nombre</span><span class="tok-o">),</span> <span class="tok-n">name</span><span class="tok-o">);</span>
       <span class="tok-k">break</span><span class="tok-o">;</span>
    <span class="tok-k">case</span> <span class="tok-nl">ARRAY:</span>
       <span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">out</span><span class="tok-o">.</span><span class="tok-na">println</span><span class="tok-o">(</span><span class="tok-s">&quot;ARRAY&quot;</span><span class="tok-o">);</span>
       <span class="tok-n">JsonArray</span> <span class="tok-n">array</span> <span class="tok-o">=</span> <span class="tok-o">(</span><span class="tok-n">JsonArray</span><span class="tok-o">)</span> <span class="tok-n">arbol</span><span class="tok-o">;</span>
       <span class="tok-k">for</span> <span class="tok-o">(</span><span class="tok-n">JsonValue</span> <span class="tok-n">val</span> <span class="tok-o">:</span> <span class="tok-n">array</span><span class="tok-o">)</span>
         <span class="tok-n">navegarPorElArbol</span><span class="tok-o">(</span><span class="tok-n">val</span><span class="tok-o">,</span> <span class="tok-kc">null</span><span class="tok-o">);</span>
       <span class="tok-k">break</span><span class="tok-o">;</span>
    <span class="tok-k">case</span> <span class="tok-nl">STRING:</span>
       <span class="tok-n">JsonString</span> <span class="tok-n">st</span> <span class="tok-o">=</span> <span class="tok-o">(</span><span class="tok-n">JsonString</span><span class="tok-o">)</span> <span class="tok-n">arbol</span><span class="tok-o">;</span>
       <span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">out</span><span class="tok-o">.</span><span class="tok-na">println</span><span class="tok-o">(</span><span class="tok-s">&quot;STRING &quot;</span> <span class="tok-o">+</span> <span class="tok-n">st</span><span class="tok-o">.</span><span class="tok-na">getString</span><span class="tok-o">());</span>
       <span class="tok-k">break</span><span class="tok-o">;</span>
    <span class="tok-k">case</span> <span class="tok-nl">NUMBER:</span>
       <span class="tok-n">JsonNumber</span> <span class="tok-n">num</span> <span class="tok-o">=</span> <span class="tok-o">(</span><span class="tok-n">JsonNumber</span><span class="tok-o">)</span> <span class="tok-n">arbol</span><span class="tok-o">;</span>
       <span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">out</span><span class="tok-o">.</span><span class="tok-na">println</span><span class="tok-o">(</span><span class="tok-s">&quot;NUMBER &quot;</span> <span class="tok-o">+</span> <span class="tok-n">num</span><span class="tok-o">.</span><span class="tok-na">toString</span><span class="tok-o">());</span>
       <span class="tok-k">break</span><span class="tok-o">;</span>
    <span class="tok-k">case</span> <span class="tok-nl">TRUE:</span>
    <span class="tok-k">case</span> <span class="tok-nl">FALSE:</span>
    <span class="tok-k">case</span> <span class="tok-nl">NULL:</span>
       <span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">out</span><span class="tok-o">.</span><span class="tok-na">println</span><span class="tok-o">(</span><span class="tok-n">arbol</span><span class="tok-o">.</span><span class="tok-na">getValueType</span><span class="tok-o">().</span><span class="tok-na">toString</span><span class="tok-o">());</span>
       <span class="tok-k">break</span><span class="tok-o">;</span>
    <span class="tok-o">}</span>
<span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>El mÃ©todo <code>navegarPorElArbol()</code> podemos usarlo con el ejemplo
anterior de la siguiente forma:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>navegarPorElArbol(modelo, "OBJECT");</pre>
</div>
</div>
<div class="paragraph">
<p>El mÃ©todo <code>navegarPorElArbol()</code> tiene dos argumentos: un elemento JSON y una clave.
La clave se utiliza para imprimir los pares <em>clave-valor</em> dentro de los objetos.
Los elementos en el Ã¡rbol se representan por el tipo <code>JsonValue</code>. Si el elemento
es un <strong>objeto</strong> o un <strong>array</strong>, se realiza una nueva llamada a este mÃ©todo es invocada
para cada elemento contenido en el <em>objeto</em> o el <em>array</em>. Si el elemento es un <strong>valor</strong>,
Ã©ste se imprime en la salida estÃ¡ndar.</p>
</div>
<div class="paragraph">
<p>El mÃ©todo <code>JsonValue.getValueType()</code> identifica el elemento como un <em>objeto</em>, un
<em>array</em>, o un <em>valor</em>. Para los objetos, el mÃ©todo <code>JsonObject.keySet()</code> devuelve
un conjunto de <code>Strings</code> que contienene las claves de los objetos, y el mÃ©todo
<code>JsonObject.get(String nombre)</code> devuelve el valor del elemento cuya <em>clave</em> es
<code>nombre</code>. Para los <em>arrays</em>, <code>JsonArray</code> implementa la interfaz <code>List&lt;JsonValue&gt;</code>.
Podemos utilizar bucles <code>for</code> mejorados, con el valor de <code>Set&lt;String&gt;</code> devuelto por
<code>JsonObject.keySet()</code>, y con instancias de <code>JsonArray</code>, tal y como hemos mostrado
en el ejemplo.</p>
</div>
</div>
<div class="sect3">
<h4 id="_escritura_de_un_modelo_de_objetos_en_un_em_stream_em">5.3.3. Escritura de un modelo de objetos en un <em>stream</em></h4>
<div class="paragraph">
<p>Los modelos de objetos creados en los ejemplos anteriores, pueden "escribirse" en un
<em>stream</em>, utilizando la clase <code>JsonWriter</code>, de la siguiente forma:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span class="tok-kn">import</span> <span class="tok-nn">java.io.StringWriter</span><span class="tok-o">;</span>
<span class="tok-kn">import</span> <span class="tok-nn">javax.json.JsonWriter</span><span class="tok-o">;</span>
<span class="tok-o">...</span>
<span class="tok-n">StringWriter</span> <span class="tok-n">stWriter</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-nf">StringWriter</span><span class="tok-o">();</span>
<span class="tok-n">JsonWriter</span> <span class="tok-n">jsonWriter</span> <span class="tok-o">=</span> <span class="tok-n">Json</span><span class="tok-o">.</span><span class="tok-na">createWriter</span><span class="tok-o">(</span><span class="tok-n">stWriter</span><span class="tok-o">);</span> <i class="conum" data-value="1"></i><b>(1)</b>
<span class="tok-n">jsonWriter</span><span class="tok-o">.</span><span class="tok-na">writeObject</span><span class="tok-o">(</span><span class="tok-n">modelo</span><span class="tok-o">);</span> <i class="conum" data-value="2"></i><b>(2)</b>
<span class="tok-n">jsonWriter</span><span class="tok-o">.</span><span class="tok-na">close</span><span class="tok-o">();</span> <i class="conum" data-value="3"></i><b>(3)</b>

<span class="tok-n">String</span> <span class="tok-n">datosJson</span> <span class="tok-o">=</span> <span class="tok-n">stWriter</span><span class="tok-o">.</span><span class="tok-na">toString</span><span class="tok-o">();</span>
<span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">out</span><span class="tok-o">.</span><span class="tok-na">println</span><span class="tok-o">(</span><span class="tok-n">datosJson</span><span class="tok-o">);</span></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>El mÃ©todo <code>Json.createWriter()</code> toma como parÃ¡metro un <code>OutputStream</code></td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>El mÃ©todo <code>JsonWriter.writeObject()</code> "escribe" el objeto <code>JsonObject</code> en el <em>stream</em></td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>El mÃ©todo <code>JsonWriter.close()</code> cierra el <em>stream</em> de salida</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_modelo_de_procesamiento_basado_en_em_streaming_em">5.3.4. Modelo de procesamiento basado en <em>streaming</em></h4>
<div class="paragraph">
<p>El modelo de <em>streaming</em> utiliza un parser basado en eventos que va leyendo los datos JSON
de uno en uno. El parser genera eventos y detiene el procesamiento cuando un objeto o
array comienza o termina, cuando encuentra una clave, o encuentra un valor. Cada elemento
puede ser procesado o rechazado por el cÃ³digo de la aplicaciÃ³n, y a continuaciÃ³n el parser
continÃºa con el siguiente evento. Esta aproximaciÃ³n es adecuada para un procesamiento local,
en el cual el procesamiento de un elemento no requiere informaciÃ³n del resto de los datos.
El modelo de <em>streaming</em> genera una salida JSON para un determinado <em>stream</em> realizando una
llamada a una funciÃ³n con un elemento cada vez.</p>
</div>
<div class="paragraph">
<p>A continuaciÃ³n veamos con ejemplos cÃ³mo utilizar el API para el modelo de <em>streaming</em>:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Para leer datos JSON utilizando un <em>parser</em> (<em>JsonParser</em>)</p>
</li>
<li>
<p>Para escribir datos JSON utilizando un <em>generador</em> (<em>JsonGenerator</em>)</p>
</li>
</ul>
</div>
<div class="sect4">
<h5 id="_lectura_de_datos_json">Lectura de datos JSON</h5>
<div class="paragraph">
<p>El API para el modelo <em>streaming</em> es la aproximaciÃ³n mÃ¡s eficiente para "parsear" datos
JSON utilizando eventos:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span class="tok-kn">import</span> <span class="tok-nn">javax.json.Json</span><span class="tok-o">;</span>
<span class="tok-kn">import</span> <span class="tok-nn">javax.json.stream.JsonParser</span><span class="tok-o">;</span>
<span class="tok-o">...</span>
<span class="tok-n">JsonParser</span> <span class="tok-n">parser</span> <span class="tok-o">=</span> <span class="tok-n">Json</span><span class="tok-o">.</span><span class="tok-na">createParser</span><span class="tok-o">(</span><span class="tok-k">new</span> <span class="tok-nf">StringReader</span><span class="tok-o">(</span><span class="tok-n">datosJson</span><span class="tok-o">));</span>
<span class="tok-k">while</span> <span class="tok-o">(</span><span class="tok-n">parser</span><span class="tok-o">.</span><span class="tok-na">hasNext</span><span class="tok-o">())</span> <span class="tok-o">{</span>
  <span class="tok-n">JsonParser</span><span class="tok-o">.</span><span class="tok-na">Event</span> <span class="tok-n">evento</span> <span class="tok-o">=</span> <span class="tok-n">parser</span><span class="tok-o">.</span><span class="tok-na">next</span><span class="tok-o">();</span>
  <span class="tok-k">switch</span><span class="tok-o">(</span><span class="tok-n">evento</span><span class="tok-o">)</span> <span class="tok-o">{</span>
    <span class="tok-k">case</span> <span class="tok-nl">START_ARRAY:</span>
    <span class="tok-k">case</span> <span class="tok-nl">END_ARRAY:</span>
    <span class="tok-k">case</span> <span class="tok-nl">START_OBJECT:</span>
    <span class="tok-k">case</span> <span class="tok-nl">END_OBJECT:</span>
    <span class="tok-k">case</span> <span class="tok-nl">VALUE_FALSE:</span>
    <span class="tok-k">case</span> <span class="tok-nl">VALUE_NULL:</span>
    <span class="tok-k">case</span> <span class="tok-nl">VALUE_TRUE:</span>
        <span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">out</span><span class="tok-o">.</span><span class="tok-na">println</span><span class="tok-o">(</span><span class="tok-n">evento</span><span class="tok-o">.</span><span class="tok-na">toString</span><span class="tok-o">());</span>
        <span class="tok-k">break</span><span class="tok-o">;</span>
    <span class="tok-k">case</span> <span class="tok-nl">KEY_NAME:</span>
        <span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">out</span><span class="tok-o">.</span><span class="tok-na">print</span><span class="tok-o">(</span><span class="tok-n">evento</span><span class="tok-o">.</span><span class="tok-na">toString</span><span class="tok-o">()</span> <span class="tok-o">+</span> <span class="tok-s">&quot; &quot;</span> <span class="tok-o">+</span> <span class="tok-n">parser</span><span class="tok-o">.</span><span class="tok-na">getString</span><span class="tok-o">()</span> <span class="tok-o">+</span> <span class="tok-s">&quot; - &quot;</span><span class="tok-o">);</span>
        <span class="tok-k">break</span><span class="tok-o">;</span>
    <span class="tok-k">case</span> <span class="tok-nl">VALUE_STRING:</span>
    <span class="tok-k">case</span> <span class="tok-nl">VALUE_NUMBER:</span>
        <span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">out</span><span class="tok-o">.</span><span class="tok-na">println</span><span class="tok-o">(</span><span class="tok-n">evento</span><span class="tok-o">.</span><span class="tok-na">toString</span><span class="tok-o">()</span> <span class="tok-o">+</span> <span class="tok-s">&quot; &quot;</span> <span class="tok-o">+</span> <span class="tok-n">parser</span><span class="tok-o">.</span><span class="tok-na">getString</span><span class="tok-o">());</span>
        <span class="tok-k">break</span><span class="tok-o">;</span>
  <span class="tok-o">}</span>
<span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>El ejemplo consta de tres pasos:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Obtener una instancia de un parser invocando el mÃ©todo estÃ¡tico <code>Json.createParser()</code></p>
</li>
<li>
<p>Iterar sobre los eventos del parser utilizando los mÃ©todos <code>JsonParser.hasNext()</code> y
<code>JsonParser.next()</code></p>
</li>
<li>
<p>Realizar un procesamiento local para cada elemento</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>El ejemplo muestra los diez posibles tipos de eventos del parser.
El mÃ©todo <code>JsonParser.next()</code>
"avanza" al siguiente evento. Para los tipos de eventos <code>KEY_NAME</code>, <code>VALUE_STRING</code>,
y <code>VALUE_NUMBER</code>, podemos obtener el contenido del elemento invocando al
mÃ©todo <code>JsonParser.getString()</code>. Para los eventos <code>VALUE_NUMBER</code>, podemos tambiÃ©n
usar los siguientes mÃ©todos:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>JsonParser.isIntegralNumber</code></p>
</li>
<li>
<p><code>JsonParser.getInt</code></p>
</li>
<li>
<p><code>JsonParser.getLong</code></p>
</li>
<li>
<p><code>JsonParser.getBigDecimal</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>El parser genera los eventos <code>START_OBJECT</code> y <code>END_OBJECT</code> para un objeto JSON vacÃ­o:
<code>{ }</code>.</p>
</div>
<div class="paragraph">
<p>Para un objeto con dos pares <em>nombre-valor</em>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="json"><span class="tok-p">{</span>
  <span class="tok-nt">&quot;manzaja&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;roja&quot;</span><span class="tok-p">,</span> <span class="tok-nt">&quot;plÃ¡tano&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;amarillo&quot;</span>
<span class="tok-p">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Mostramos los eventos generados:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="sh"><span class="tok-o">{</span>START_OBJECT
   <span class="tok-s2">&quot;manzaja&quot;</span>KEY_NAME:<span class="tok-s2">&quot;roja&quot;</span>VALUE_STRING,
   <span class="tok-s2">&quot;plÃ¡tano&quot;</span>KEY_NAME:<span class="tok-s2">&quot;amarillo&quot;</span>VALUE_STRING
<span class="tok-o">}</span>END_OBJECT</code></pre>
</div>
</div>
<div class="paragraph">
<p>Los eventos generados para un <em>array</em> con dos objetos JSON serÃ­an los siguientes:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="sh"><span class="tok-o">[</span>START_ARRAY
  <span class="tok-o">{</span>START_OBJECT <span class="tok-s2">&quot;manzaja&quot;</span>KEY_NAME:<span class="tok-s2">&quot;roja&quot;</span>VALUE_STRING <span class="tok-o">}</span>END_OBJECT,
  <span class="tok-o">{</span>START_OBJECT <span class="tok-s2">&quot;plÃ¡tano&quot;</span>KEY_NAME:<span class="tok-s2">&quot;amarillo&quot;</span>VALUE_STRING <span class="tok-o">}</span>END_OBJECT
<span class="tok-o">]</span>END_ARRAY</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_escritura_de_datos_json">Escritura de datos JSON</h5>
<div class="paragraph">
<p>El siguiente cÃ³digo muestra cÃ³mo escribir datos JSON en un fichero utilizando el
API para el modelo de <em>streaming</em>:</p>
</div>
<div class="listingblock">
<div class="title">Ejemplo de escritura de datos JSON con el modelo de streaming</div>
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span class="tok-n">FileWriter</span> <span class="tok-n">writer</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-nf">FileWriter</span><span class="tok-o">(</span><span class="tok-s">&quot;test.txt&quot;</span><span class="tok-o">);</span>
<span class="tok-n">JsonGenerator</span> <span class="tok-n">gen</span> <span class="tok-o">=</span> <span class="tok-n">Json</span><span class="tok-o">.</span><span class="tok-na">createGenerator</span><span class="tok-o">(</span><span class="tok-n">writer</span><span class="tok-o">);</span>
<span class="tok-n">gen</span><span class="tok-o">.</span><span class="tok-na">writeStartObject</span><span class="tok-o">()</span>
   <span class="tok-o">.</span><span class="tok-na">write</span><span class="tok-o">(</span><span class="tok-s">&quot;nombre&quot;</span><span class="tok-o">,</span> <span class="tok-s">&quot;Duke&quot;</span><span class="tok-o">)</span>
   <span class="tok-o">.</span><span class="tok-na">write</span><span class="tok-o">(</span><span class="tok-s">&quot;apellidos&quot;</span><span class="tok-o">,</span> <span class="tok-s">&quot;Java&quot;</span><span class="tok-o">)</span>
   <span class="tok-o">.</span><span class="tok-na">write</span><span class="tok-o">(</span><span class="tok-s">&quot;edad&quot;</span><span class="tok-o">,</span> <span class="tok-mi">18</span><span class="tok-o">)</span>
   <span class="tok-o">.</span><span class="tok-na">write</span><span class="tok-o">(</span><span class="tok-s">&quot;calle&quot;</span><span class="tok-o">,</span> <span class="tok-s">&quot;100 Internet Dr&quot;</span><span class="tok-o">)</span>
   <span class="tok-o">.</span><span class="tok-na">write</span><span class="tok-o">(</span><span class="tok-s">&quot;ciudad&quot;</span><span class="tok-o">,</span> <span class="tok-s">&quot;JavaTown&quot;</span><span class="tok-o">)</span>
   <span class="tok-o">.</span><span class="tok-na">write</span><span class="tok-o">(</span><span class="tok-s">&quot;codPostal&quot;</span><span class="tok-o">,</span> <span class="tok-s">&quot;12345&quot;</span><span class="tok-o">)</span>
   <span class="tok-o">.</span><span class="tok-na">writeStartArray</span><span class="tok-o">(</span><span class="tok-s">&quot;telefonos&quot;</span><span class="tok-o">)</span>
      <span class="tok-o">.</span><span class="tok-na">writeStartObject</span><span class="tok-o">()</span>
         <span class="tok-o">.</span><span class="tok-na">write</span><span class="tok-o">(</span><span class="tok-s">&quot;tipo&quot;</span><span class="tok-o">,</span> <span class="tok-s">&quot;casa&quot;</span><span class="tok-o">)</span>
         <span class="tok-o">.</span><span class="tok-na">write</span><span class="tok-o">(</span><span class="tok-s">&quot;numero&quot;</span><span class="tok-o">,</span> <span class="tok-s">&quot;111-111-1111&quot;</span><span class="tok-o">)</span>
      <span class="tok-o">.</span><span class="tok-na">writeEnd</span><span class="tok-o">()</span>
      <span class="tok-o">.</span><span class="tok-na">writeStartObject</span><span class="tok-o">()</span>
         <span class="tok-o">.</span><span class="tok-na">write</span><span class="tok-o">(</span><span class="tok-s">&quot;tipo&quot;</span><span class="tok-o">,</span> <span class="tok-s">&quot;movil&quot;</span><span class="tok-o">)</span>
         <span class="tok-o">.</span><span class="tok-na">write</span><span class="tok-o">(</span><span class="tok-s">&quot;numero&quot;</span><span class="tok-o">,</span> <span class="tok-s">&quot;222-222-2222&quot;</span><span class="tok-o">)</span>
      <span class="tok-o">.</span><span class="tok-na">writeEnd</span><span class="tok-o">()</span>
   <span class="tok-o">.</span><span class="tok-na">writeEnd</span><span class="tok-o">()</span>
   <span class="tok-o">.</span><span class="tok-na">writeEnd</span><span class="tok-o">();</span>
<span class="tok-n">gen</span><span class="tok-o">.</span><span class="tok-na">close</span><span class="tok-o">();</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Este ejemplo obtiene un generador JSON invocando al mÃ©todo estÃ¡tico <code>Json.createGenerator()</code>,
que toma como parÃ¡metro un <em>output stream</em> o un <em>writer stream</em>. El ejemplo escribe
los datos JSON en el fichero <code>text.txt</code> anidando llamadas a los mÃ©todos <code>write()</code>,
<code>writeStartArray()</code>, <code>writeStartObject()</code>, and <code>writeEnd()</code>. El mÃ©todo
<code>JsonGenerator.close()</code> cierra el <em>output stream</em> o <em>writer stream</em> subyacente.</p>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_pruebas_de_servicios_rest">5.4. Pruebas de servicios REST</h3>
<div class="paragraph">
<p>Hasta ahora hemos visto varias formas de "probar" nuestros servicios REST: desde
lÃ­nea de comandos con <em>Curl</em>, desde IntelliJ con la herramienta <em>Test RESTFul Web
Service</em>, y desde el navegador <em>Chrome</em>, con <em>Postman</em> (siendo esta Ãºltima la que
mÃ¡s hemos utilizado).</p>
</div>
<div class="paragraph">
<p>Vamos a ver cÃ³mo implementar tests para nuestros servicios REST utilizando Maven y
JUnit. Para ello repasaremos algunas cuestiones bÃ¡sicas sobre los
<a href="https://maven.apache.org/ref/3.3.3/maven-core/lifecycles.html">ciclos de vida de Maven</a>.</p>
</div>
<div class="sect3">
<h4 id="_ciclo_de_vida_de_maven_y_tests_junit">5.4.1. Ciclo de vida de Maven y tests JUnit</h4>
<div class="paragraph">
<p>Un ciclo de vida en Maven <strong>es una secuencia de acciones determinada</strong>, que define el proceso
de construcciÃ³n de un proyecto en concreto. Como resultado del proceso de construcciÃ³n de un
proyecto obtendremos un <em>artefacto</em> (fichero), de un cierto tipo (por ejemplo .jar, .war, .ear,&#8230;&#8203;).
Por lo tanto, podrÃ­amos decir que un ciclo de vida estÃ¡ formado por las acciones necesarias para
convertir nuestros archivos fuente que constituyen el proyecto en, por ejemplo un .jar, un .war,&#8230;&#8203;</p>
</div>
<div class="paragraph">
<p>Maven propone 3 ciclos de vida, es decir, tres posibles secuencias de acciones, que podemos
utilizar (y modificar a nuestra conveniencia) para construir nuestro proyecto.
Dichos ciclos de vida son: <em>clean</em>, <em>site</em> y el denominado <em>default-lifecycle</em>.</p>
</div>
<div class="paragraph">
<p>Cada ciclo de vida estÃ¡ formado por <strong>fases</strong>. Una fase es un concepto abstracto, y define el tipo
de acciones que se deberÃ­an llevar a cabo. Por ejemplo una fase del ciclo de vida por defecto es
<em>compile</em>, para referirse a las acciones que nos permiten convertir los ficheros <em>.java</em> en los ficheros <em>.class</em>
correspondientes.</p>
</div>
<div class="paragraph">
<p>Cada fase estÃ¡ formada por un conjunto de <strong>goals</strong>, que son las acciones que se llevarÃ¡n a cabo en cada
una de las fases. Las <strong>goals</strong> no "viven" de forma independiente, sino que cualquier <em>goal</em> siempre
forma parte de un <strong>plugin</strong> Maven. PodrÃ­amos decir que un <em>plugin</em>, por lo tanto, es una agrupaciÃ³n lÃ³gica de una
serie de <em>goals</em> relacionadas. Por ejemplo, el <em>plugin</em> wildfly, contiene una serie de <em>goals</em>
para <em>desplegar</em>, <em>re-desplegar</em>, <em>deshacer-el-despliegue</em>, <em>arrancar el servidor</em>, etc., es decir, agrupa las
acciones que podemos realizar sobre el servidor wildfly. Una goal se especifica siempre anteponiendo el nombre
del <em>plugin</em> al que pertenece seguido de dos puntos, por ejemplo <strong>wildfly:deploy</strong> indica que se trata de la <em>goal</em>
<em>deploy</em>, que pertenece al plugin <em>wildfly</em> de maven.</p>
</div>
<div class="paragraph">
<p>Pues bien, por defecto, Maven asocia ciertas <em>goals</em> a las fases de los tres ciclos de vida. Cuando se ejecuta
una fase de un ciclo de vida, por ejemplo <strong>mvn package</strong> se ejecutan todas las <em>goals</em> asociadas a todas las fases
anteriores a la fase <strong>package</strong>, en orden, y finalmente las <em>goals</em> asociadas a la fase <strong>package</strong>.
Por supuesto, podemos alterar en cualquier momento este comportamiento por defecto, incluyendo los plugins
y goals correspondientes dentro de la etiqueta <em>&lt;build&gt;</em> en nuestro fichero de configuraciÃ³n <em>pom.xml</em>.</p>
</div>
<div class="paragraph">
<p>Vamos a implementar tests JUnit. Los tests, como ya habÃ©is visto en sesiones anteriores, en el
directorio <strong>src/test</strong>. Algunas normas importantes son: que los tests pertenezcan al mismo paquete lÃ³gico al
que pertencen las clases Java que estamos probando. Por ejemplo, si estamos haciendo pruebas sobre las clases del
paquete <em>org.expertojava.rest</em>, los tests deberÃ­an pertenecer al mismo paquete, aunque fÃ­sicamente el cÃ³digo fuente y
sus pruebas estarÃ¡n separados (el cÃ³digo fuente estarÃ¡ en src/main, y los tests en src/test).</p>
</div>
<div class="paragraph">
<p>Para realizar pruebas sobre nuestros servicios REST, necesitamos que el servidor Wilfly estÃ© en marcha.
TambiÃ©n necesitamos empaquetar el cÃ³digo en un fichero <strong>war</strong> y desplegarlo en el servidor, todo esto ANTES
de ejecutar los tests.</p>
</div>
<div class="paragraph">
<p>Las acciones para arrancar el servidor Wilfly y desplegar nuestra aplicaciÃ³n en Ã©l, NO forman parte de las
acciones (o <em>goals</em>) incluidas por defecto en el ciclo de vida por defecto de Maven, cuando nuestro proyecto
tiene que empaquetarse como un <strong>war</strong> (etiqueta <em>&lt;packaging&gt;</em> de nuestro <em>pom.xml</em>). PodÃ©is consultar
<a href="https://maven.apache.org/ref/3.3.3/maven-core/default-bindings.html#Plugin_bindings_for_war_packaging">aquÃ­</a> la
lista de <em>goals</em> asociadas a las fases del ciclo de vida por defecto de Maven.</p>
</div>
<div class="paragraph">
<p>Por otro lado, en el ciclo de vida por defecto, se incluye una <em>goal</em> para ejecutar los tests, asociada a la
fase <em>test</em>. Dicha goal es <strong>surefire:test</strong>. El problema es que, por defecto, la fase <em>test</em> se ejecuta ANTES
de la fase <em>package</em> y por lo tanto, antes de empaquetar y desplegar nuestra aplicaciÃ³n en Wildfly.</p>
</div>
<div class="paragraph">
<p>Por lo tanto, tendremos que "alterar" convenientemente este comportamiento por defecto para que se ejecuten las acciones
de nuestro proceso de construcciÃ³n que necesitemos, y en el orden en el que lo necesitemos. Como ya hemos
indicado antes, esto lo haremos incluyendo dichas acciones en la etiqueta <em>&lt;build&gt;</em> de nuestro <em>pom.xml</em>,
y configurandolas convenientemente para asegurarnos que el orden en el que se ejecutan es el que queremos.</p>
</div>
<div class="paragraph">
<p>La siguiente figura muestra parte de la secuencia de fases llevadas a cabo por Maven en su ciclo de vida por
defecto. Para conseguir nuestros propÃ³sitos, simplemente aÃ±adiremos la "goals" <strong>wildfly:deploy</strong>, y la asociaremos
a la fase <em>pre-integration-test</em>, y "cambiaremos" la fase a la que estÃ¡ asociada la goal <strong>surefire:test</strong> para
que los tests se ejecuten DESPUÃS de haber desplegado el <em>war</em> en Wildfly.</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="images/rest05/maven-lifecycle.png" alt="ConfiguraciÃ³n del pom.xml para ejecutar los tests REST" width="66%">
</div>
</div>
<div class="paragraph">
<p>A continuaciÃ³n mostramos los cambios que tenemos que realizar en el fichero de configuraciÃ³n <strong>pom.xml</strong></p>
</div>
<div class="listingblock">
<div class="title">AdiciÃ³n de las goals wildfly:deploy y surefire:test a las fases pre-integration-test y surefire:test respectivamente</div>
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><span class="tok-c">&lt;!-- forzamos el despliegue del war generado durante la fase pre-integration-test,</span>
<span class="tok-c">     justo despuÃ©s de obtener dicho .war--&gt;</span>
<span class="tok-nt">&lt;plugin&gt;</span>
  <span class="tok-nt">&lt;groupId&gt;</span>org.wildfly.plugins<span class="tok-nt">&lt;/groupId&gt;</span>
  <span class="tok-nt">&lt;artifactId&gt;</span>wildfly-maven-plugin<span class="tok-nt">&lt;/artifactId&gt;</span>
  <span class="tok-nt">&lt;version&gt;</span>1.0.2.Final<span class="tok-nt">&lt;/version&gt;</span>
  <span class="tok-nt">&lt;configuration&gt;</span>
    <span class="tok-nt">&lt;hostname&gt;</span>localhost<span class="tok-nt">&lt;/hostname&gt;</span>
    <span class="tok-nt">&lt;port&gt;</span>9990<span class="tok-nt">&lt;/port&gt;</span>
  <span class="tok-nt">&lt;/configuration&gt;</span>

  <span class="tok-nt">&lt;executions&gt;</span>
    <span class="tok-nt">&lt;execution&gt;</span>
      <span class="tok-nt">&lt;id&gt;</span>wildfly-deploy<span class="tok-nt">&lt;/id&gt;</span>
      <span class="tok-nt">&lt;phase&gt;</span>pre-integration-test<span class="tok-nt">&lt;/phase&gt;</span>
      <span class="tok-nt">&lt;goals&gt;</span>
        <span class="tok-nt">&lt;goal&gt;</span>deploy<span class="tok-nt">&lt;/goal&gt;</span>
      <span class="tok-nt">&lt;/goals&gt;</span>
      <span class="tok-nt">&lt;/execution&gt;</span>
  <span class="tok-nt">&lt;/executions&gt;</span>
<span class="tok-nt">&lt;/plugin&gt;</span>

<span class="tok-c">&lt;!--ejecutaremos los test JUnit en la fase integration-test,</span>
<span class="tok-c">    inmediatamente despuÃ©s de la fase pre-integration-test, y antes</span>
<span class="tok-c">    de la fase verify--&gt;</span>
<span class="tok-nt">&lt;plugin&gt;</span>
   <span class="tok-nt">&lt;groupId&gt;</span>org.apache.maven.plugins<span class="tok-nt">&lt;/groupId&gt;</span>
   <span class="tok-nt">&lt;artifactId&gt;</span>maven-surefire-plugin<span class="tok-nt">&lt;/artifactId&gt;</span>
   <span class="tok-nt">&lt;version&gt;</span>2.18<span class="tok-nt">&lt;/version&gt;</span>
   <span class="tok-nt">&lt;configuration&gt;</span>
        <span class="tok-nt">&lt;skip&gt;</span>true<span class="tok-nt">&lt;/skip&gt;</span>
   <span class="tok-nt">&lt;/configuration&gt;</span>
   <span class="tok-nt">&lt;executions&gt;</span>
      <span class="tok-nt">&lt;execution&gt;</span>
        <span class="tok-nt">&lt;id&gt;</span>surefire-it<span class="tok-nt">&lt;/id&gt;</span>
        <span class="tok-nt">&lt;phase&gt;</span>integration-test<span class="tok-nt">&lt;/phase&gt;</span>
        <span class="tok-nt">&lt;goals&gt;</span>
          <span class="tok-nt">&lt;goal&gt;</span>test<span class="tok-nt">&lt;/goal&gt;</span>
        <span class="tok-nt">&lt;/goals&gt;</span>
        <span class="tok-nt">&lt;configuration&gt;</span>
          <span class="tok-nt">&lt;skip&gt;</span>false<span class="tok-nt">&lt;/skip&gt;</span>
        <span class="tok-nt">&lt;/configuration&gt;</span>
      <span class="tok-nt">&lt;/execution&gt;</span>
    <span class="tok-nt">&lt;/executions&gt;</span>
<span class="tok-nt">&lt;/plugin&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>TambiÃ©n necesitamos incluir en el pom.xml las librerÃ­as de las que depende el cÃ³digo de pruebas
de nuestro proyecto (clases <strong>XXXXTest</strong> situadas en <strong>src/test</strong>): librerÃ­a JUnit, JAXB y el API cliente de JAX-RS.
Por lo que aÃ±adimos en el las dependencias correspondientes:</p>
</div>
<div class="listingblock">
<div class="title">Dependencias del cÃ³digo src/test con JUnit y API cliente de JAX-RS</div>
<div class="content">
<pre class="pygments highlight"><code data-lang="xml">...
<span class="tok-nt">&lt;dependency&gt;</span>
  <span class="tok-nt">&lt;groupId&gt;</span>junit<span class="tok-nt">&lt;/groupId&gt;</span>
  <span class="tok-nt">&lt;artifactId&gt;</span>junit<span class="tok-nt">&lt;/artifactId&gt;</span>
  <span class="tok-nt">&lt;version&gt;</span>4.12<span class="tok-nt">&lt;/version&gt;</span>
  <span class="tok-nt">&lt;scope&gt;</span>test<span class="tok-nt">&lt;/scope&gt;</span>
<span class="tok-nt">&lt;/dependency&gt;</span>
<span class="tok-nt">&lt;dependency&gt;</span>
  <span class="tok-nt">&lt;groupId&gt;</span>org.jboss.resteasy<span class="tok-nt">&lt;/groupId&gt;</span>
  <span class="tok-nt">&lt;artifactId&gt;</span>resteasy-client<span class="tok-nt">&lt;/artifactId&gt;</span>
  <span class="tok-nt">&lt;version&gt;</span>3.0.13.Final<span class="tok-nt">&lt;/version&gt;</span>
  <span class="tok-nt">&lt;scope&gt;</span>test<span class="tok-nt">&lt;/scope&gt;</span>
<span class="tok-nt">&lt;/dependency&gt;</span>
<span class="tok-nt">&lt;dependency&gt;</span>
  <span class="tok-nt">&lt;groupId&gt;</span>org.jboss.resteasy<span class="tok-nt">&lt;/groupId&gt;</span>
  <span class="tok-nt">&lt;artifactId&gt;</span>resteasy-jaxb-provider<span class="tok-nt">&lt;/artifactId&gt;</span>
  <span class="tok-nt">&lt;version&gt;</span>3.0.13.Final<span class="tok-nt">&lt;/version&gt;</span>
<span class="tok-nt">&lt;/dependency&gt;</span>
...</code></pre>
</div>
</div>
<div class="paragraph">
<p>Dado que vamos a trabajar con el API Json, y dado que ejecutaremos los tests desde la mÃ¡quina
virtual de Java, y no dentro del servidor WildFly, necesitamos aÃ±adir tambiÃ©n las siguientes
librerÃ­as:</p>
</div>
<div class="listingblock">
<div class="title">Dependencias del cÃ³digo src/test con el API Json de jaxrs</div>
<div class="content">
<pre class="pygments highlight"><code data-lang="xml">...
<span class="tok-c">&lt;!--LibrerÃ­as para serializar/deserializar json --&gt;</span>
<span class="tok-nt">&lt;dependency&gt;</span>
  <span class="tok-nt">&lt;groupId&gt;</span>org.jboss.resteasy<span class="tok-nt">&lt;/groupId&gt;</span>
  <span class="tok-nt">&lt;artifactId&gt;</span>resteasy-jackson-provider<span class="tok-nt">&lt;/artifactId&gt;</span>
  <span class="tok-nt">&lt;version&gt;</span>3.0.13.Final<span class="tok-nt">&lt;/version&gt;</span>
<span class="tok-nt">&lt;/dependency&gt;</span>

<span class="tok-c">&lt;!--Jaxrs API json --&gt;</span>
<span class="tok-nt">&lt;dependency&gt;</span>
  <span class="tok-nt">&lt;groupId&gt;</span>org.jboss.resteasy<span class="tok-nt">&lt;/groupId&gt;</span>
  <span class="tok-nt">&lt;artifactId&gt;</span>resteasy-json-p-provider<span class="tok-nt">&lt;/artifactId&gt;</span>
  <span class="tok-nt">&lt;version&gt;</span>3.0.13.Final<span class="tok-nt">&lt;/version&gt;</span>
<span class="tok-nt">&lt;/dependency&gt;</span>
...</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>No hemos incluido en el pom.xml la orden para arrancar Wildfly. Vamos a hacer esto
desde IntelliJ en un perfil de ejecuciÃ³n, como ya habÃ©is hecho en sesiones anteriores.
De esta forma, podremos ver desde IntelliJ la consola de logs del servidor. En este
caso, podemos crear un perfil solamente para arrancar el servidor Wildfly (no es necesario
que se incluya el despliegue del war generado, puesto que lo haremos desde la ventana
<em>Maven Projects</em>).
Antes de iniciar el proceso de construcciÃ³n, por lo tanto, tendremos que asegurarnos
de que hemos arrancado Wildlfly.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Con estos cambios en el pom.xml, y ejecutando el comando <code>mvn verify</code> se
llevarÃ¡n a cabo las siguientes acciones, en este orden:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>DespuÃ©s de compilar el proyecto, obtenemos el <code>.war</code> (fase <code>package</code>)</p>
</li>
<li>
<p>El <code>.war</code> generado se despliega en el servidor de aplicaciones Wilfly (fase <code>pre-integration-test</code>)</p>
</li>
<li>
<p>Se ejecutan los test JUnit sobre la aplicaciÃ³n desplegada en el servidor (fase <code>integration-test</code>)</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_anotaciones_junit_y_aserciones_assertthat">5.4.2. Anotaciones JUnit y aserciones AssertThat</h4>
<div class="paragraph">
<p>JUnit 4 proporciona anotaciones para forzar a que los mÃ©todos anotados con @Test se ejecuten
en el orden que nos interese (por defecto no estÃ¡ garantizado que se ejecuten en el orden en el
que se escriben).</p>
</div>
<div class="paragraph">
<p>En principio, debemos programar los tests para que sean totalmente independientes unos de otros,
y por lo tanto, el orden de ejecuciÃ³n no influya para nada en el resultado de su ejecuciÃ³n, tanto si se
ejecuta el primero, como a mitad, o el Ãºltimo. El no hacer los tests independientes hace que el proceso
de testing "se alargue" y complique innecesariamente, ya que puede ser que unos tests "enmascaren" en
resultado de otros, o que no podamos "saber" si ciertas partes del cÃ³digo estÃ¡n bien o mal implementadas
hasta que los tests de los que dependemos se hayan superado con Ã©xito.</p>
</div>
<div class="paragraph">
<p>AÃºn asÃ­, y dado que muchas veces se obtienen errores por hacer asunciones en el orden de la ejecuciÃ³n
de los tests, JUnit nos permite fijar dicho orden. Para ello utilizaremos la anotaciÃ³n
<code>@FixMethodOrder</code>, indicando el tipo de ordenaciÃ³n, como por ejemplo <code>MethodSorters.NAME_ASCENDING</code>,
de forma que se ejecutarÃ¡n los tests por orden lexicogrÃ¡fico.</p>
</div>
<div class="paragraph">
<p>Por ejemplo:</p>
</div>
<div class="listingblock">
<div class="title">Ejemplo para forzar el orden de ejecuciÃ³n de los test (orden lexicogrÃ¡fico)</div>
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span class="tok-nd">@FixMethodOrder</span><span class="tok-o">(</span><span class="tok-n">MethodSorters</span><span class="tok-o">.</span><span class="tok-na">NAME_ASCENDING</span><span class="tok-o">)</span>
<span class="tok-kd">public</span> <span class="tok-kd">class</span> <span class="tok-nc">TestMethodOrder</span> <span class="tok-o">{</span>

    <span class="tok-nd">@Test</span>
    <span class="tok-kd">public</span> <span class="tok-kt">void</span> <span class="tok-nf">testB</span><span class="tok-o">()</span> <span class="tok-o">{</span>
       <span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">out</span><span class="tok-o">.</span><span class="tok-na">println</span><span class="tok-o">(</span><span class="tok-s">&quot;second&quot;</span><span class="tok-o">);</span>
     <span class="tok-o">}</span>

    <span class="tok-nd">@Test</span>
    <span class="tok-kd">public</span> <span class="tok-kt">void</span> <span class="tok-nf">testA</span><span class="tok-o">()</span> <span class="tok-o">{</span>
        <span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">out</span><span class="tok-o">.</span><span class="tok-na">println</span><span class="tok-o">(</span><span class="tok-s">&quot;first&quot;</span><span class="tok-o">);</span>
    <span class="tok-o">}</span>

    <span class="tok-nd">@Test</span>
    <span class="tok-kd">public</span> <span class="tok-kt">void</span> <span class="tok-nf">testC</span><span class="tok-o">()</span> <span class="tok-o">{</span>
        <span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">out</span><span class="tok-o">.</span><span class="tok-na">println</span><span class="tok-o">(</span><span class="tok-s">&quot;third&quot;</span><span class="tok-o">);</span>
    <span class="tok-o">}</span>
<span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>En ese caso, el orden de ejecuciÃ³n serÃ¡: <code>testA()</code>, a continuaciÃ³n <code>testB()</code>, y
finalmente <code>testC()</code>.</p>
</div>
<div class="paragraph">
<p>Otra aportaciÃ³n de JUnit 4 es la incorporaciÃ³n de aserciones de tipo <code>assertThat</code>.
En sesiones anteriores habÃ©is utilizado aserciones con mÃ©todos <code>Assert.assertEquals(resultado_esperado, resultado_real)</code>.
Los nuevos mÃ©todos <code>Assert.assertThat()</code> permiten una mayor flexibilidad a la hora de
expresar las aserciones realizadas en nuestros tests, asÃ­ como una mayor legibilidad
de los mismos. El prototipo general de las aserciones de este tipo es:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>assertThat([value], [matcher statement]);</pre>
</div>
</div>
<div class="paragraph">
<p>en donde <code>[value]</code> es el resultado real (valor sobre el que se quiere afirmar algo),
 y <code>[matcher statement]</code> es un <code>Matcher</code> u objeto que realiza operaciones de "emparejamiento"
 sobre una secuencia de caracteres segÃºn un determinado patrÃ³n.</p>
</div>
<div class="paragraph">
<p>Por ejemplo:</p>
</div>
<div class="listingblock">
<div class="title">Ejemplos de sentencias assertThat</div>
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span class="tok-n">assertThat</span><span class="tok-o">(</span><span class="tok-n">x</span><span class="tok-o">,</span> <span class="tok-n">is</span><span class="tok-o">(</span><span class="tok-n">not</span><span class="tok-o">(</span><span class="tok-mi">4</span><span class="tok-o">)));</span>  <i class="conum" data-value="1"></i><b>(1)</b>
<span class="tok-n">assertThat</span><span class="tok-o">(</span><span class="tok-n">responseStringJson</span><span class="tok-o">,</span> <span class="tok-n">either</span><span class="tok-o">(</span><span class="tok-n">containsString</span><span class="tok-o">(</span><span class="tok-s">&quot;nombre&quot;</span><span class="tok-o">)).</span><span class="tok-na">and</span><span class="tok-o">(</span><span class="tok-n">containsString</span><span class="tok-o">(</span><span class="tok-s">&quot;apellido&quot;</span><span class="tok-o">)));</span> <i class="conum" data-value="2"></i><b>(2)</b>
<span class="tok-n">assertThat</span><span class="tok-o">(</span><span class="tok-n">myList</span><span class="tok-o">,</span> <span class="tok-n">hasItem</span><span class="tok-o">(</span><span class="tok-s">&quot;3&quot;</span><span class="tok-o">));</span> <i class="conum" data-value="3"></i><b>(3)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>AquÃ­ utilizamos un <em>matcher</em> con el patrÃ³n "4", esta sentencia devuelve <em>false</em> si x != "4"</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Podemos "combinar" varios <em>matchers</em>, de forma que se tengan que satisfacer mÃ¡s de uno</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>En este caso aplicamos el <em>matcher</em> sobre un conjunto de elementos</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Hay varias librerÃ­as que implementan <em>Matchers</em>. JUnit incluye parte de los <em>matchers</em> de
<em>Hamcrest</em> (<em>Hamcrest</em> es un <em>framework</em> para escribir objetos <em>matcher</em> permitiendo
definir reglas de <em>matching</em> de forma declarativa). Otra librerÃ­a interesante para realizar
testing de servicios rest que utilizan representaciones Json es la librerÃ­a: <code>hamcrest-json</code>,
que podemos utilizar para realizar aserciones sobre dos objetos Json.</p>
</div>
<div class="paragraph">
<p>Por ejemplo, supongamos que nuestro objeto Json contiene una lista de enlaces Hateoas, de tipo
<code>Link</code>. Los objetos <code>Link</code> serÃ¡n serializados/deserializados (Wildfly utiliza <em>Jackson</em> para realizar
estas tareas) convenientemente. Cuando serializamos un objeto <code>Link</code> (obtenemos su representaciÃ³n
Json), veremos, ademÃ¡s de los objetos "uri": "valor", "type": "valor" y "rel": "valor", que son los que bÃ¡sicamente
utilizamos al crear los enlaces Hateoas, otros como "uriBuilder": {&#8230;&#8203;}, "params":{&#8230;&#8203;}, que puede
que no nos interese consultar, o incluso que no les hayamos asignado ningÃºn valor.</p>
</div>
<div class="paragraph">
<p>Si en nuestro test, queremos comprobar que el objeto Json que nos devuelve el servicio (resultado real) se corresponde
con el valor esperado, tendremos que "comparar" ambas representaciones. Ahora bien, puede que solamente
nos interese comparar ciertos valores contenidos en el objeto Json, no el objeto "completo".</p>
</div>
<div class="paragraph">
<p>Hacer esta comprobaciÃ³n "elemento a elemento" es bastante tedioso. La librerÃ­a <code>hamcrest-json</code> nos proporciona
lo que estamos buscando, con los mÃ©todos <code>sameJSONAs()</code>,<code>allowingExtraUnexpectedFields()</code>, y
<code>allowingAnyArrayOrdering()</code>, de la siguiente forma:</p>
</div>
<div class="listingblock">
<div class="title">MÃ©todo para comparar dos representaciones Json. Clase uk.co.datumedge.hamcrest.json.SameJSONAs</div>
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span class="tok-n">Assert</span><span class="tok-o">.</span><span class="tok-na">assertThat</span><span class="tok-o">(</span><span class="tok-s">&quot;{\&quot;age\&quot;:43, \&quot;friend_ids\&quot;:[16, 52, 23]}&quot;</span><span class="tok-o">,</span>
                  <span class="tok-n">sameJSONAs</span><span class="tok-o">(</span><span class="tok-s">&quot;{\&quot;friend_ids\&quot;:[52, 23, 16]}&quot;</span><span class="tok-o">)</span>
                            <span class="tok-o">.</span><span class="tok-na">allowingExtraUnexpectedFields</span><span class="tok-o">()</span>
                            <span class="tok-o">.</span><span class="tok-na">allowingAnyArrayOrdering</span><span class="tok-o">());</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>En este cÃ³digo tenemos una representaciÃ³n formada por dos objetos, uno de los cuales tiene como valor un
array de enteros. Si el servicio rest devuelve un objeto Json con mÃ¡s elementos, o en otro orden, en este caso
el resultado de la sentencia <em>assertThat</em> es <em>true</em>. Volviendo al ejemplo anterior de un objeto Json que
contiene enlaces Hatehoas, podrÃ­amos realizar la siguiente comparaciÃ³n:</p>
</div>
<div class="listingblock">
<div class="title">Comparamos dos objetos Json que contienen hiperenlaces Hateoas (objetos Link)</div>
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span class="tok-n">JsonObject</span> <span class="tok-n">json_object</span> <span class="tok-o">=</span>
    <span class="tok-n">client</span><span class="tok-o">.</span><span class="tok-na">target</span><span class="tok-o">(</span><span class="tok-s">&quot;http://localhost:8080/foro/usuarios&quot;</span><span class="tok-o">)</span>
          <span class="tok-o">.</span><span class="tok-na">request</span><span class="tok-o">(</span><span class="tok-n">MediaType</span><span class="tok-o">.</span><span class="tok-na">APPLICATION_JSON</span><span class="tok-o">)</span>
          <span class="tok-o">.</span><span class="tok-na">get</span><span class="tok-o">(</span><span class="tok-n">JsonObject</span><span class="tok-o">.</span><span class="tok-na">class</span><span class="tok-o">);</span>   <i class="conum" data-value="1"></i><b>(1)</b>

<span class="tok-n">String</span> <span class="tok-n">json_string</span> <span class="tok-o">=</span> <span class="tok-n">json_object</span><span class="tok-o">.</span><span class="tok-na">toString</span><span class="tok-o">();</span>  <i class="conum" data-value="2"></i><b>(2)</b>

<span class="tok-n">JsonObject</span> <span class="tok-n">usuarios</span> <span class="tok-o">=</span>
   <span class="tok-n">Json</span><span class="tok-o">.</span><span class="tok-na">createObjectBuilder</span><span class="tok-o">()</span>
       <span class="tok-o">.</span><span class="tok-na">add</span><span class="tok-o">(</span><span class="tok-s">&quot;usuarios&quot;</span><span class="tok-o">,</span>
           <span class="tok-n">Json</span><span class="tok-o">.</span><span class="tok-na">createArrayBuilder</span><span class="tok-o">()</span>
              <span class="tok-o">.</span><span class="tok-na">add</span><span class="tok-o">(</span><span class="tok-n">Json</span><span class="tok-o">.</span><span class="tok-na">createObjectBuilder</span><span class="tok-o">()</span>
                  <span class="tok-o">.</span><span class="tok-na">add</span><span class="tok-o">(</span><span class="tok-s">&quot;nombre&quot;</span><span class="tok-o">,</span> <span class="tok-s">&quot;Pepe Lopez&quot;</span><span class="tok-o">)</span>
                  <span class="tok-o">.</span><span class="tok-na">add</span><span class="tok-o">(</span><span class="tok-s">&quot;links&quot;</span><span class="tok-o">,</span>
                      <span class="tok-n">Json</span><span class="tok-o">.</span><span class="tok-na">createArrayBuilder</span><span class="tok-o">()</span>
                        <span class="tok-o">.</span><span class="tok-na">add</span><span class="tok-o">(</span><span class="tok-n">Json</span><span class="tok-o">.</span><span class="tok-na">createObjectBuilder</span><span class="tok-o">()</span>
                        <span class="tok-o">.</span><span class="tok-na">add</span><span class="tok-o">(</span><span class="tok-s">&quot;uri&quot;</span><span class="tok-o">,</span> <span class="tok-s">&quot;http://localhost:8080/foro/usuarios/pepe&quot;</span><span class="tok-o">)</span>
                        <span class="tok-o">.</span><span class="tok-na">add</span><span class="tok-o">(</span><span class="tok-s">&quot;type&quot;</span><span class="tok-o">,</span> <span class="tok-s">&quot;application/xml,application/json&quot;</span><span class="tok-o">)</span>
                        <span class="tok-o">.</span><span class="tok-na">add</span><span class="tok-o">(</span><span class="tok-s">&quot;rel&quot;</span><span class="tok-o">,</span> <span class="tok-s">&quot;self&quot;</span><span class="tok-o">))))</span>
              <span class="tok-o">.</span><span class="tok-na">add</span><span class="tok-o">(</span><span class="tok-n">Json</span><span class="tok-o">.</span><span class="tok-na">createObjectBuilder</span><span class="tok-o">()</span>
                  <span class="tok-o">.</span><span class="tok-na">add</span><span class="tok-o">(</span><span class="tok-s">&quot;nombre&quot;</span><span class="tok-o">,</span> <span class="tok-s">&quot;Ana Garcia&quot;</span><span class="tok-o">)</span>
                  <span class="tok-o">.</span><span class="tok-na">add</span><span class="tok-o">(</span><span class="tok-s">&quot;links&quot;</span><span class="tok-o">,</span>
                      <span class="tok-n">Json</span><span class="tok-o">.</span><span class="tok-na">createArrayBuilder</span><span class="tok-o">()</span>
                        <span class="tok-o">.</span><span class="tok-na">add</span><span class="tok-o">(</span><span class="tok-n">Json</span><span class="tok-o">.</span><span class="tok-na">createObjectBuilder</span><span class="tok-o">()</span>
                        <span class="tok-o">.</span><span class="tok-na">add</span><span class="tok-o">(</span><span class="tok-s">&quot;uri&quot;</span><span class="tok-o">,</span> <span class="tok-s">&quot;http://localhost:8080/foro/usuarios/ana&quot;</span><span class="tok-o">)</span>
                        <span class="tok-o">.</span><span class="tok-na">add</span><span class="tok-o">(</span><span class="tok-s">&quot;type&quot;</span><span class="tok-o">,</span> <span class="tok-s">&quot;application/xml,application/json&quot;</span><span class="tok-o">)</span>
                        <span class="tok-o">.</span><span class="tok-na">add</span><span class="tok-o">(</span><span class="tok-s">&quot;rel&quot;</span><span class="tok-o">,</span> <span class="tok-s">&quot;self&quot;</span><span class="tok-o">)))))</span>
    <span class="tok-o">.</span><span class="tok-na">build</span><span class="tok-o">();</span>   <i class="conum" data-value="3"></i><b>(3)</b>

<span class="tok-n">Assert</span><span class="tok-o">.</span><span class="tok-na">assertThat</span><span class="tok-o">(</span><span class="tok-n">json_string</span><span class="tok-o">,</span>
                  <span class="tok-n">sameJSONAs</span><span class="tok-o">(</span><span class="tok-n">usuarios</span><span class="tok-o">.</span><span class="tok-na">toString</span><span class="tok-o">())</span>
                      <span class="tok-o">.</span><span class="tok-na">allowingExtraUnexpectedFields</span><span class="tok-o">()</span>
                      <span class="tok-o">.</span><span class="tok-na">allowingAnyArrayOrdering</span><span class="tok-o">());</span> <i class="conum" data-value="4"></i><b>(4)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Realizamos la llamada al servicio REST y recibimos como respuesta un objeto Json. En
este caso nuestro objeto Json estÃ¡ formado por una lista de objetos.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Obtenemos la representaciÃ³n de nuestro objeto Json (resultado real) en forma de cadena de caracteres</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Creamos un nuevo objeto Json con el resultado esperado</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Comparamos ambos objetos. Si el resultado real incluye mÃ¡s elementos que los contenidos
en <code>json_string</code> o en otro orden consideraremos que hemos obtenido la respuesta correcta.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Para utilizar esta librerÃ­a en nuestro proyecto, simplemente tendremos que aÃ±adirla como
dependencia en la configuraciÃ³n de nuestro pom.xml:</p>
</div>
<div class="listingblock">
<div class="title">LibrerÃ­a para comparar objetos Json en los tests</div>
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><span class="tok-c">&lt;!--Hamcrest Json --&gt;</span>
<span class="tok-nt">&lt;dependency&gt;</span>
    <span class="tok-nt">&lt;groupId&gt;</span>uk.co.datumedge<span class="tok-nt">&lt;/groupId&gt;</span>
    <span class="tok-nt">&lt;artifactId&gt;</span>hamcrest-json<span class="tok-nt">&lt;/artifactId&gt;</span>
    <span class="tok-nt">&lt;version&gt;</span>0.2<span class="tok-nt">&lt;/version&gt;</span>
<span class="tok-nt">&lt;/dependency&gt;</span></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_observaciones_sobre_los_tests_y_algunos_ejemplos_de_tests">5.4.3. Observaciones sobre los tests y algunos ejemplos de tests</h4>
<div class="paragraph">
<p>Recuerda que para utilizar el API cliente, necesitas utilizar instancias <code>javax.ws.rs.client.Client</code>,
que debemos "cerrar" siempre despuÃ©s de su uso para cerrar el socket asociado a la conexiÃ³n.</p>
</div>
<div class="paragraph">
<p>Para ello podemos optar por:
* Crear una Ãºnica instancia Client "antes" de ejecutar cualquier test (mÃ©todo @BeforeClass),
 y cerrar el socket despuÃ©s de ejecutar todos los tests (mÃ©todo @AfterClass)
* Crear una Ãºnica instancia Client "antes" de ejecutar CADA test (mÃ©todo @Before),
y cerrar el socket despuÃ©s de ejecutar CADA tests (mÃ©todo @After)</p>
</div>
<div class="paragraph">
<p>Si el resultado de una invocaciÃ³n sobre la instancia <em>Client</em> es de tipo <code>javax.ws.rs.core.Response</code>,
debemos liberar de forma explÃ­cita la conexiÃ³n para que pueda ser usada de nuevo por dicha instancia <em>Client</em>.</p>
</div>
<div class="paragraph">
<p>Por ejemplo, supongamos que queremos realizar un test en el que realizamos una operaciÃ³n POST, y a continuaciÃ³n
una operaciÃ³n GET para verificar que el nuevo recurso se ha aÃ±adidido correctamente:</p>
</div>
<div class="listingblock">
<div class="title">Ejemplo de Test que utiliza una instancia <em>Client</em> para todos los tests</div>
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span class="tok-kd">public</span> <span class="tok-kd">class</span> <span class="tok-nc">TestRESTServices</span> <span class="tok-o">{</span>
  <span class="tok-kd">private</span> <span class="tok-kd">static</span> <span class="tok-kd">final</span> <span class="tok-n">String</span> <span class="tok-n">BASE_URL</span> <span class="tok-o">=</span> <span class="tok-s">&quot;http://localhost:8080/rest/&quot;</span><span class="tok-o">;</span>
  <span class="tok-kd">private</span> <span class="tok-kd">static</span> <span class="tok-n">URI</span> <span class="tok-n">uri</span> <span class="tok-o">=</span> <span class="tok-n">UriBuilder</span><span class="tok-o">.</span><span class="tok-na">fromUri</span><span class="tok-o">(</span><span class="tok-n">BASE_URL</span><span class="tok-o">).</span><span class="tok-na">build</span><span class="tok-o">();</span>
  <span class="tok-kd">private</span> <span class="tok-kd">static</span> <span class="tok-n">Client</span> <span class="tok-n">client</span><span class="tok-o">;</span>

  <span class="tok-nd">@BeforeClass</span>
  <span class="tok-kd">public</span> <span class="tok-kd">static</span> <span class="tok-kt">void</span> <span class="tok-nf">initClient</span><span class="tok-o">()</span> <span class="tok-o">{</span>
    <span class="tok-n">client</span> <span class="tok-o">=</span> <span class="tok-n">ClientBuilder</span><span class="tok-o">.</span><span class="tok-na">newClient</span><span class="tok-o">();</span> <i class="conum" data-value="1"></i><b>(1)</b>
  <span class="tok-o">}</span>

  <span class="tok-nd">@AfterClass</span>
  <span class="tok-kd">public</span> <span class="tok-kd">static</span> <span class="tok-kt">void</span> <span class="tok-nf">closeClient</span><span class="tok-o">()</span> <span class="tok-o">{</span>
    <span class="tok-n">client</span><span class="tok-o">.</span><span class="tok-na">close</span><span class="tok-o">();</span> <i class="conum" data-value="2"></i><b>(2)</b>
  <span class="tok-o">}</span>

  <span class="tok-nd">@Test</span>
  <span class="tok-kd">public</span> <span class="tok-kt">void</span> <span class="tok-nf">createAndRetrieveACustomer</span><span class="tok-o">()</span> <span class="tok-o">{</span>

    <span class="tok-n">Customer</span> <span class="tok-n">customer</span> <span class="tok-o">=</span> <span class="tok-o">...</span> <span class="tok-c1">//Creamos un nuevo cliente</span>
    <span class="tok-n">Response</span> <span class="tok-n">response</span> <span class="tok-o">=</span> <span class="tok-n">client</span><span class="tok-o">.</span><span class="tok-na">target</span><span class="tok-o">(</span><span class="tok-n">uri</span><span class="tok-o">)</span>
                          <span class="tok-o">.</span><span class="tok-na">request</span><span class="tok-o">()</span>
                          <span class="tok-o">.</span><span class="tok-na">post</span><span class="tok-o">(</span><span class="tok-n">Entity</span><span class="tok-o">.</span><span class="tok-na">entity</span><span class="tok-o">(</span><span class="tok-n">customer</span><span class="tok-o">,</span> <span class="tok-n">MediaType</span><span class="tok-o">.</span><span class="tok-na">APPLICATION_JSON</span><span class="tok-o">));</span>
    <span class="tok-n">assertEquals</span><span class="tok-o">(</span><span class="tok-n">Response</span><span class="tok-o">.</span><span class="tok-na">Status</span><span class="tok-o">.</span><span class="tok-na">CREATED</span><span class="tok-o">,</span> <span class="tok-n">response</span><span class="tok-o">.</span><span class="tok-na">getStatusInfo</span><span class="tok-o">());</span>
    <span class="tok-n">URI</span> <span class="tok-n">referenceURI</span> <span class="tok-o">=</span> <span class="tok-n">response</span><span class="tok-o">.</span><span class="tok-na">getLocation</span><span class="tok-o">();</span>
    <span class="tok-n">response</span><span class="tok-o">.</span><span class="tok-na">close</span><span class="tok-o">();</span> <i class="conum" data-value="3"></i><b>(3)</b>

    <span class="tok-c1">// Obtenemos el recurso que hemos aÃ±adido</span>
    <span class="tok-n">response</span> <span class="tok-o">=</span> <span class="tok-n">client</span><span class="tok-o">.</span><span class="tok-na">target</span><span class="tok-o">(</span><span class="tok-n">referenceURI</span><span class="tok-o">).</span><span class="tok-na">request</span><span class="tok-o">().</span><span class="tok-na">get</span><span class="tok-o">();</span>

    <span class="tok-n">Customer</span> <span class="tok-n">retrieved_customer</span> <span class="tok-o">=</span> <span class="tok-n">response</span><span class="tok-o">.</span><span class="tok-na">readEntity</span><span class="tok-o">(</span><span class="tok-n">Customer</span><span class="tok-o">.</span><span class="tok-na">class</span><span class="tok-o">);</span>
    <span class="tok-n">assertEquals</span><span class="tok-o">(</span><span class="tok-n">Response</span><span class="tok-o">.</span><span class="tok-na">Status</span><span class="tok-o">.</span><span class="tok-na">OK</span><span class="tok-o">,</span> <span class="tok-n">response</span><span class="tok-o">.</span><span class="tok-na">getStatusInfo</span><span class="tok-o">());</span>
    <span class="tok-n">assertEquals</span><span class="tok-o">(</span><span class="tok-n">retreivedRef</span><span class="tok-o">.</span><span class="tok-na">getName</span><span class="tok-o">(),</span> <span class="tok-n">r</span><span class="tok-o">.</span><span class="tok-na">getName</span><span class="tok-o">());</span>
    <span class="tok-n">response</span><span class="tok-o">.</span><span class="tok-na">close</span><span class="tok-o">();</span> <i class="conum" data-value="4"></i><b>(4)</b>
  <span class="tok-o">}</span>
<span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Creamos una instancia <em>Client</em> ANTES de ejecutar cualquier test</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Cerramos el socket asociado a la conexiÃ³n DESPUÃS de ejecutar TODOS los tests</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Liberamos la conexiÃ³n para poder reutilizarla</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Liberamos la conexiÃ³n para poder reutilizarla</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Ahora veamos otro ejemplo en el que utilizamos una instancia <em>Client</em> para cada test:</p>
</div>
<div class="listingblock">
<div class="title">Ejemplo de Test que utiliza una instancia <em>Client</em> para CADA test</div>
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span class="tok-kd">public</span> <span class="tok-kd">class</span> <span class="tok-nc">TestRESTServices</span> <span class="tok-o">{</span>

  <span class="tok-kd">private</span> <span class="tok-n">Client</span> <span class="tok-n">client</span><span class="tok-o">;</span>

  <span class="tok-nd">@Before</span>
  <span class="tok-kd">public</span> <span class="tok-kt">void</span> <span class="tok-nf">setUp</span><span class="tok-o">()</span> <span class="tok-o">{</span>
      <span class="tok-k">this</span><span class="tok-o">.</span><span class="tok-na">client</span> <span class="tok-o">=</span> <span class="tok-n">ClientBuilder</span><span class="tok-o">.</span><span class="tok-na">newClient</span><span class="tok-o">();</span> <i class="conum" data-value="1"></i><b>(1)</b>
  <span class="tok-o">}</span>

  <span class="tok-nd">@After</span>
  <span class="tok-kd">public</span> <span class="tok-kt">void</span> <span class="tok-nf">tearDown</span><span class="tok-o">()</span> <span class="tok-o">{</span>
      <span class="tok-k">this</span><span class="tok-o">.</span><span class="tok-na">client</span><span class="tok-o">.</span><span class="tok-na">close</span><span class="tok-o">();</span>  <i class="conum" data-value="2"></i><b>(2)</b>
  <span class="tok-o">}</span>

  <span class="tok-nd">@Test</span>
  <span class="tok-kd">public</span> <span class="tok-kt">void</span> <span class="tok-nf">getAllCustomersAsJson</span><span class="tok-o">()</span> <span class="tok-o">{</span>
     <span class="tok-n">String</span> <span class="tok-n">uriString</span> <span class="tok-o">=</span> <span class="tok-s">&quot;http://localhost:8080/rest/customers&quot;</span><span class="tok-o">;</span>
     <span class="tok-n">JsonArray</span> <span class="tok-n">json_array</span> <span class="tok-o">=</span> <span class="tok-n">client</span>
                <span class="tok-o">.</span><span class="tok-na">target</span><span class="tok-o">(</span><span class="tok-n">uriString</span><span class="tok-o">)</span>
                <span class="tok-o">.</span><span class="tok-na">request</span><span class="tok-o">(</span><span class="tok-n">MediaType</span><span class="tok-o">.</span><span class="tok-na">APPLICATION_JSON</span><span class="tok-o">)</span>
                <span class="tok-o">.</span><span class="tok-na">accept</span><span class="tok-o">(</span><span class="tok-n">MediaType</span><span class="tok-o">.</span><span class="tok-na">APPLICATION_JSON</span><span class="tok-o">)</span>
                <span class="tok-o">.</span><span class="tok-na">get</span><span class="tok-o">(</span><span class="tok-n">JsonArray</span><span class="tok-o">.</span><span class="tok-na">class</span><span class="tok-o">);</span>

     <span class="tok-n">Assert</span><span class="tok-o">.</span><span class="tok-na">assertEquals</span><span class="tok-o">(</span><span class="tok-mi">2</span><span class="tok-o">,</span> <span class="tok-n">json_array</span><span class="tok-o">.</span><span class="tok-na">size</span><span class="tok-o">());</span>
   <span class="tok-o">}</span>

   <span class="tok-nd">@Test</span>
   <span class="tok-kd">public</span> <span class="tok-kt">void</span> <span class="tok-nf">getAllCustomers</span><span class="tok-o">()</span> <span class="tok-o">{</span>
    <span class="tok-n">String</span> <span class="tok-n">uriString</span> <span class="tok-o">=</span> <span class="tok-s">&quot;http://localhost:8080/rest/customers&quot;</span><span class="tok-o">;</span>
    <span class="tok-c1">//Consultamos los datos de todos los customers</span>
    <span class="tok-n">List</span><span class="tok-o">&lt;</span><span class="tok-n">Customer</span><span class="tok-o">&gt;</span> <span class="tok-n">lista_usuarios</span> <span class="tok-o">=</span> <span class="tok-n">client</span><span class="tok-o">.</span><span class="tok-na">target</span><span class="tok-o">(</span><span class="tok-n">uriString</span><span class="tok-o">)</span>
                <span class="tok-o">.</span><span class="tok-na">request</span><span class="tok-o">(</span><span class="tok-s">&quot;application/json&quot;</span><span class="tok-o">)</span>
                <span class="tok-o">.</span><span class="tok-na">get</span><span class="tok-o">(</span><span class="tok-k">new</span> <span class="tok-n">GenericType</span><span class="tok-o">&lt;</span><span class="tok-n">List</span><span class="tok-o">&lt;</span><span class="tok-n">Customer</span><span class="tok-o">&gt;&gt;()</span> <span class="tok-o">{});</span>
    <span class="tok-n">Assert</span><span class="tok-o">.</span><span class="tok-na">assertEquals</span><span class="tok-o">(</span><span class="tok-mi">2</span><span class="tok-o">,</span> <span class="tok-n">lista_usuarios</span><span class="tok-o">.</span><span class="tok-na">size</span><span class="tok-o">());</span>
  <span class="tok-o">}</span>
<span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Creamos una instancia <em>Client</em> ANTES de ejecutar CADA test</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Cerramos el socket asociado a la conexiÃ³n DESPUÃS de ejecutar CADA los tests</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Podemos ver en este Ãºltimo ejemplo que no es necesario liberar la conexiÃ³n
entre usos sucesivos de la instancia <em>Client</em>, si no utilizamos la clase <em>Response</em>.
En este caso el proceso se realiza de forma automÃ¡tica por el sistema.</p>
</div>
<div class="paragraph">
<p>Finalmente comentaremos que, debido a un bug en la especificaciÃ³n JAX-RS, el deserializado del
de los objetos Link no se realiza, por lo que obendremos una lista
de Links vacÃ­a (ver <a href="http://kingsfleet.blogspot.com.es/2014/05/reading-and-writing-jax-rs-link-objects.html" class="bare">http://kingsfleet.blogspot.com.es/2014/05/reading-and-writing-jax-rs-link-objects.html</a>).
Podemos comprobar que, si obtenemos la representaciÃ³n en formato texto de la entidad del mensaje,
dicha lista de objetos tendrÃ¡ el valor correcto.</p>
</div>
<div class="paragraph">
<p>Si no utilizamos la soluciÃ³n propuesta en el enlace anterior, deberemos usar
la anotaciÃ³n <code>@JsonIgnoreProperties(ignoreUnknown = true)</code>. De esta forma, ignoraremos el
deserializado de los objetos Link, pero tendremos que utilizar la representaciÃ³n en formato de
cadena de caracteres del recurso json, en lugar del objeto java <em>Link</em> asociado.</p>
</div>
<div class="paragraph">
<p>AsÃ­, por ejemplo, si nuestro recurso <em>Customer</em> tiene asociado una lista de objetos <em>Link</em>,
para poder utilizar el API Cliente y acceder a la lista de enlaces, usaremos la anotaciÃ³n
anterior en la implementaciÃ³n de la clase <em>Customer</em>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span class="tok-nd">@JsonIgnoreProperties</span><span class="tok-o">(</span><span class="tok-n">ignoreUnknown</span> <span class="tok-o">=</span> <span class="tok-kc">true</span><span class="tok-o">)</span>
<span class="tok-nd">@XmlRootElement</span><span class="tok-o">(</span><span class="tok-n">name</span><span class="tok-o">=</span><span class="tok-s">&quot;customer&quot;</span><span class="tok-o">)</span>
<span class="tok-kd">public</span> <span class="tok-kd">class</span> <span class="tok-nc">Customer</span> <span class="tok-o">{</span>
  <span class="tok-kt">int</span> <span class="tok-n">id</span><span class="tok-o">;</span>
  <span class="tok-n">String</span> <span class="tok-n">name</span><span class="tok-o">;</span>
  <span class="tok-o">...</span>
  <span class="tok-n">List</span><span class="tok-o">&lt;</span><span class="tok-n">Link</span><span class="tok-o">&gt;</span> <span class="tok-n">links</span><span class="tok-o">;</span>
  <span class="tok-o">...</span>
<span class="tok-o">}</span></code></pre>
</div>
</div>
<div style="page-break-after: always;"></div>
</div>
</div>
<div class="sect2">
<h3 id="_ejercicios_5">5.5. Ejercicios</h3>
<div class="sect3">
<h4 id="_tests_utilizando_el_api_cliente_y_un_mapeador_de_excepciones_1_punto">5.5.1. Tests utilizando el API cliente y un mapeador de excepciones (1 punto)</h4>
<div class="paragraph">
<p>Se proporciona como plantilla el MÃDULO IntelliJ "s5-tienda" con una implementaciÃ³n parcial
de una tienda de clientes on-line. Este proyecto ya contiene varios tests implementados, a modo
de ejemplo.</p>
</div>
<div class="paragraph">
<p>Los recursos rest implementados lanzan excepciones de tipo <code>RestException</code> si, por ejemplo se
intenta realizar una consulta sobre un producto y/o usuario que no existe.</p>
</div>
<div class="paragraph">
<p>Se ha implementado un mapeador de excepciones <code>RestExceptionMapper</code> que captura
excepciones de tipo <code>RuntimeException</code>, y devuelve una respuesta de tipo <code>ErrorMensajeBean</code> que
serÃ¡ serializada a formato json y/o formato
xml (dependiendo del valor de la cabecera <em>Accept</em> de la peticiÃ³n), con informaciÃ³n sobre el
error producido.</p>
</div>
<div class="paragraph">
<p>Implementa los siguientes dos tests:
* <code>test7recuperarTodosLosUsuarios()</code>, en el que realizamos una invocaciÃ³n GET sobre
"http://localhost:8080/s5-tienda/rest/clientes/". Esta URI podrÃ­a corresponderse con un
mÃ©todo anotado con @GET y que devolviese una lista de todos los clientes de la tienda.
Sin embargo, no existe tal mÃ©todo en nuestro recursos rest. Verifica que dicha invocaciÃ³n
devuelve el cÃ³digo de estado "500" (Internal Server Error), y que en el cuerpo del mensaje
se recibe "Servicio no disponible"</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>test8recuperarClienteQueNoExiste()</code>, en el que intentamos recuperar la informaciÃ³n de
un cliente que no exista en nuestra base de datos. En este caso, debemos verificar que el mensaje
obtenido en formato json es el siguiente:</p>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="json"><span class="tok-p">{</span>
  <span class="tok-nt">&quot;status&quot;</span><span class="tok-p">:</span> <span class="tok-s2">&quot;Not Found&quot;</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;code&quot;</span><span class="tok-p">:</span> <span class="tok-mi">404</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;message&quot;</span><span class="tok-p">:</span> <span class="tok-s2">&quot;El producto no se encuentra en la base de datos&quot;</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;developerMessage&quot;</span><span class="tok-p">:</span> <span class="tok-s2">&quot;error&quot;</span>
<span class="tok-p">}</span></code></pre>
</div>
</div>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_tests_utilizando_el_api_json_y_junit_1_punto">5.5.2. Tests utilizando el API Json y JUnit (1 punto)</h4>
<div class="paragraph">
<p>Vamos a seguir usando el proyecto s4-foroAvanzado con el que hemos trabajado en la
sesiÃ³n anterior.</p>
</div>
<div class="paragraph">
<p>Vamos a implementar algunos tests con JUnit en los que utilizaremos, ademÃ¡s del
API cliente, el API Json, que nos proporciona jaxrs.</p>
</div>
<div class="paragraph">
<p>Para ejecutar los tests necesitamos modificar el pom.xml aÃ±adiendo las dependencias
correspondientes que hemos visto a lo largo de la sesiÃ³n, y aÃ±adiendo las goals para
que se ejecuten los tests despuÃ©s de desplegar la aplicaciÃ³n en Wildfly.</p>
</div>
<div class="paragraph">
<p>Proporcionamos el contenido del <em>pom.xml</em> con las librerÃ­as y plugins que necesitarÃ¡s (aunque como
ejercicio deberÃ­as intentar modificar la configuraciÃ³n tÃº mismo, y luego puedes comprobar el
resultado con el <em>pom.xml</em> que se proporciona). El contenido del nuevo pom.xml lo tienes en
/src/test/resources/nuevo-pom.mxl.</p>
</div>
<div class="sect4">
<h5 id="_inicializaciÃ³n_de_los_datos_para_los_tests">InicializaciÃ³n de los datos para los tests</h5>
<div class="paragraph">
<p>Vamos a utilizar DBUnit para inicializar la BD para realizar los tests. Para ello tendrÃ¡s que
aÃ±adir en el pom.xml las dependencias necesarias (ya estÃ¡n aÃ±adidas en el fichero de
configuraciÃ³n proporcionado). En el fichero <em>src/test/resources/foro-inicial.xml</em> encontrarÃ©is
el conjunto de datos con el que inicializaremos la base de datos para ejecutar nuestros tests.</p>
</div>
<div class="paragraph">
<p>No es necesario (aunque es una muy buena prÃ¡ctica) que inicialicemos la BD para cada test.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_implementaciÃ³n_de_los_tests">5.5.3. ImplementaciÃ³n de los tests</h4>
<div class="paragraph">
<p>Vamos a implementar los siguientes tests (que se ejecutarÃ¡n en en este mismo orden):</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>test1ConsultaTodosUsuarios()</code>: recuperamos los datos de todos los usuarios del foro. Recuerda
que previamente tienes que haber inicializado la BD con los datos del fichero <em>foro-inicial.xml</em>.
Recupera los datos en forma de JsonObject y comprueba que el nÃºmero de usuarios es el correcto.
TambiÃ©n debes comprobar que tanto el login, como los enlaces hatehoas para cada usuario estÃ¡n
bien creados. En concreto, para cada usuario, debes verificar que la uri ("uri"), el tipo mime ("type"),
y el tipo de enlace ("rel") son los correctos.</p>
</li>
<li>
<p><code>test2CreamosMensajeDePepe()</code>: crearemos un nuevo mensaje del usuario con login "pepe". Recuerda
que este usuario tiene el rol "registrado". El mensaje tendrÃ¡ el asunto "cena", y el texto serÃ¡:
"Mejor me voy al cine". En este caso, deberÃ¡s comprobar el valor de estado (debe ser 201), y
debes recuperar (consultar con una peticiÃ³n REST) el mensaje para comprobar que la operaciÃ³n de
insertar el mensaje ha tenido Ã©xito.</p>
</li>
<li>
<p><code>test3CreamosMensajeDeUsuarioNoAutorizado()</code>: creamos un nuevo mensaje de un usuario que no estÃ¡
autorizado (por ejemplo, de un usuario con login "juan"). En este caso el mensaje tendrÃ¡ el asunto
"cena", y el mensaje puede ser: "Pues yo tampoco voy". El resultado debe ser el cÃ³digo de estado 401 (
Unauthorized)</p>
</li>
<li>
<p><code>test4ConsultaUsuario()</code>: Consultamos los datos del usuario "pepe". Recuperaremos los datos como
un JsonObject, y comprobaremos que el valor de la "uri" para el tipo de relaciÃ³n "self" del enlace
<em>Link</em> asociado es el correcto</p>
</li>
</ul>
</div>
</div>
</div>
</div>
</div>
</div>
<div id="footer">
<div id="footer-text">
Last updated 2015-10-15 10:06:27 CEST
</div>
</div>
</body>
</html>