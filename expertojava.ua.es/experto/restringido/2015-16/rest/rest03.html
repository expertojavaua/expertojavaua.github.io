<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<!--[if IE]><meta http-equiv="X-UA-Compatible" content="IE=edge"><![endif]-->
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 1.5.2">
<meta name="author" content="MarÃ­a Isabel Alfonso Galipienso">
<title>Servicios Rest</title>
<style>/*! normalize.css v2.1.2 | MIT License | git.io/normalize */
/* ========================================================================== HTML5 display definitions ========================================================================== */
/** Correct `block` display not defined in IE 8/9. */
article, aside, details, figcaption, figure, footer, header, hgroup, main, nav, section, summary { display: block; }

/** Correct `inline-block` display not defined in IE 8/9. */
audio, canvas, video { display: inline-block; }

/** Prevent modern browsers from displaying `audio` without controls. Remove excess height in iOS 5 devices. */
audio:not([controls]) { display: none; height: 0; }

/** Address `[hidden]` styling not present in IE 8/9. Hide the `template` element in IE, Safari, and Firefox < 22. */
[hidden], template { display: none; }

script { display: none !important; }

/* ========================================================================== Base ========================================================================== */
/** 1. Set default font family to sans-serif. 2. Prevent iOS text size adjust after orientation change, without disabling user zoom. */
html { font-family: sans-serif; /* 1 */ -ms-text-size-adjust: 100%; /* 2 */ -webkit-text-size-adjust: 100%; /* 2 */ }

/** Remove default margin. */
body { margin: 0; }

/* ========================================================================== Links ========================================================================== */
/** Remove the gray background color from active links in IE 10. */
a { background: transparent; }

/** Address `outline` inconsistency between Chrome and other browsers. */
a:focus { outline: thin dotted; }

/** Improve readability when focused and also mouse hovered in all browsers. */
a:active, a:hover { outline: 0; }

/* ========================================================================== Typography ========================================================================== */
/** Address variable `h1` font-size and margin within `section` and `article` contexts in Firefox 4+, Safari 5, and Chrome. */
h1 { font-size: 2em; margin: 0.67em 0; }

/** Address styling not present in IE 8/9, Safari 5, and Chrome. */
abbr[title] { border-bottom: 1px dotted; }

/** Address style set to `bolder` in Firefox 4+, Safari 5, and Chrome. */
b, strong { font-weight: bold; }

/** Address styling not present in Safari 5 and Chrome. */
dfn { font-style: italic; }

/** Address differences between Firefox and other browsers. */
hr { -moz-box-sizing: content-box; box-sizing: content-box; height: 0; }

/** Address styling not present in IE 8/9. */
mark { background: #ff0; color: #000; }

/** Correct font family set oddly in Safari 5 and Chrome. */
code, kbd, pre, samp { font-family: monospace, serif; font-size: 1em; }

/** Improve readability of pre-formatted text in all browsers. */
pre { white-space: pre-wrap; }

/** Set consistent quote types. */
q { quotes: "\201C" "\201D" "\2018" "\2019"; }

/** Address inconsistent and variable font size in all browsers. */
small { font-size: 80%; }

/** Prevent `sub` and `sup` affecting `line-height` in all browsers. */
sub, sup { font-size: 75%; line-height: 0; position: relative; vertical-align: baseline; }

sup { top: -0.5em; }

sub { bottom: -0.25em; }

/* ========================================================================== Embedded content ========================================================================== */
/** Remove border when inside `a` element in IE 8/9. */
img { border: 0; }

/** Correct overflow displayed oddly in IE 9. */
svg:not(:root) { overflow: hidden; }

/* ========================================================================== Figures ========================================================================== */
/** Address margin not present in IE 8/9 and Safari 5. */
figure { margin: 0; }

/* ========================================================================== Forms ========================================================================== */
/** Define consistent border, margin, and padding. */
fieldset { border: 1px solid #c0c0c0; margin: 0 2px; padding: 0.35em 0.625em 0.75em; }

/** 1. Correct `color` not being inherited in IE 8/9. 2. Remove padding so people aren't caught out if they zero out fieldsets. */
legend { border: 0; /* 1 */ padding: 0; /* 2 */ }

/** 1. Correct font family not being inherited in all browsers. 2. Correct font size not being inherited in all browsers. 3. Address margins set differently in Firefox 4+, Safari 5, and Chrome. */
button, input, select, textarea { font-family: inherit; /* 1 */ font-size: 100%; /* 2 */ margin: 0; /* 3 */ }

/** Address Firefox 4+ setting `line-height` on `input` using `!important` in the UA stylesheet. */
button, input { line-height: normal; }

/** Address inconsistent `text-transform` inheritance for `button` and `select`. All other form control elements do not inherit `text-transform` values. Correct `button` style inheritance in Chrome, Safari 5+, and IE 8+. Correct `select` style inheritance in Firefox 4+ and Opera. */
button, select { text-transform: none; }

/** 1. Avoid the WebKit bug in Android 4.0.* where (2) destroys native `audio` and `video` controls. 2. Correct inability to style clickable `input` types in iOS. 3. Improve usability and consistency of cursor style between image-type `input` and others. */
button, html input[type="button"], input[type="reset"], input[type="submit"] { -webkit-appearance: button; /* 2 */ cursor: pointer; /* 3 */ }

/** Re-set default cursor for disabled elements. */
button[disabled], html input[disabled] { cursor: default; }

/** 1. Address box sizing set to `content-box` in IE 8/9. 2. Remove excess padding in IE 8/9. */
input[type="checkbox"], input[type="radio"] { box-sizing: border-box; /* 1 */ padding: 0; /* 2 */ }

/** 1. Address `appearance` set to `searchfield` in Safari 5 and Chrome. 2. Address `box-sizing` set to `border-box` in Safari 5 and Chrome (include `-moz` to future-proof). */
input[type="search"] { -webkit-appearance: textfield; /* 1 */ -moz-box-sizing: content-box; -webkit-box-sizing: content-box; /* 2 */ box-sizing: content-box; }

/** Remove inner padding and search cancel button in Safari 5 and Chrome on OS X. */
input[type="search"]::-webkit-search-cancel-button, input[type="search"]::-webkit-search-decoration { -webkit-appearance: none; }

/** Remove inner padding and border in Firefox 4+. */
button::-moz-focus-inner, input::-moz-focus-inner { border: 0; padding: 0; }

/** 1. Remove default vertical scrollbar in IE 8/9. 2. Improve readability and alignment in all browsers. */
textarea { overflow: auto; /* 1 */ vertical-align: top; /* 2 */ }

/* ========================================================================== Tables ========================================================================== */
/** Remove most spacing between table cells. */
table { border-collapse: collapse; border-spacing: 0; }

meta.foundation-mq-small { font-family: "only screen and (min-width: 768px)"; width: 768px; }

meta.foundation-mq-medium { font-family: "only screen and (min-width:1280px)"; width: 1280px; }

meta.foundation-mq-large { font-family: "only screen and (min-width:1440px)"; width: 1440px; }

*, *:before, *:after { -moz-box-sizing: border-box; -webkit-box-sizing: border-box; box-sizing: border-box; }

html, body { font-size: 97%; }

body { background: white; color: #222222; padding: 0; margin: 0; font-family: "Helvetica Neue", "Helvetica", Helvetica, Arial, sans-serif; font-weight: normal; font-style: normal; line-height: 1; position: relative; cursor: auto; }

a:hover { cursor: pointer; }

img, object, embed { max-width: 100%; height: auto; }

object, embed { height: 100%; }

img { -ms-interpolation-mode: bicubic; }

#map_canvas img, #map_canvas embed, #map_canvas object, .map_canvas img, .map_canvas embed, .map_canvas object { max-width: none !important; }

.left { float: left !important; }

.right { float: right !important; }

.text-left { text-align: left !important; }

.text-right { text-align: right !important; }

.text-center { text-align: center !important; }

.text-justify { text-align: justify !important; }

.hide { display: none; }

.antialiased, body { -webkit-font-smoothing: antialiased; }

img { display: inline-block; vertical-align: middle; }

textarea { height: auto; min-height: 50px; }

select { width: 100%; }

p.lead, .paragraph.lead > p, #preamble > .sectionbody > .paragraph:first-of-type p { font-size: 1.21875em; line-height: 1.6; }

.subheader, .admonitionblock td.content > .title, .audioblock > .title, .exampleblock > .title, .imageblock > .title, .listingblock > .title, .literalblock > .title, .stemblock > .title, .openblock > .title, .paragraph > .title, .quoteblock > .title, table.tableblock > .title, .verseblock > .title, .videoblock > .title, .dlist > .title, .olist > .title, .ulist > .title, .qlist > .title, .hdlist > .title { line-height: 1.4; color: #6f6f6f; font-weight: 300; margin-top: 0.2em; margin-bottom: 0.5em; }

/* Typography resets */
div, dl, dt, dd, ul, ol, li, h1, h2, h3, #toctitle, .sidebarblock > .content > .title, h4, h5, h6, pre, form, p, blockquote, th, td { margin: 0; padding: 0; direction: ltr; }

/* Default Link Styles */
a { color: #1164be; text-decoration: none; line-height: inherit; }
a img { border: none; }

/* Default paragraph styles */
p { font-family: inherit; font-weight: normal; font-size: 1em; line-height: 1.4; margin-bottom: 1em; text-rendering: optimizeLegibility; }
p aside { font-size: 0.875em; line-height: 1.35; font-style: italic; }

/* Default header styles */
h1, h2, h3, #toctitle, .sidebarblock > .content > .title, h4, h5, h6 { font-family: "Helvetica Neue", "Helvetica", Helvetica, Arial, sans-serif; font-weight: bold; font-style: normal; color: #1c355e; text-rendering: optimizeLegibility; margin-top: 1em; margin-bottom: 0.5em; line-height: 1.2125em; }
h1 small, h2 small, h3 small, #toctitle small, .sidebarblock > .content > .title small, h4 small, h5 small, h6 small { font-size: 60%; color: #6f6f6f; line-height: 0; }

h1 { font-size: 2.125em; }

h2 { font-size: 1.6875em; }

h3, #toctitle, .sidebarblock > .content > .title { font-size: 1.375em; }

h4 { font-size: 1.125em; }

h5 { font-size: 1.125em; }

h6 { font-size: 1em; }

hr { border: solid #dddddd; border-width: 1px 0 0; clear: both; margin: 1.25em 0 1.1875em; height: 0; }

/* Helpful Typography Defaults */
em, i { font-style: italic; line-height: inherit; }

strong, b { font-weight: bold; line-height: inherit; }

small { font-size: 60%; line-height: inherit; }

code { font-family: Consolas, "Liberation Mono", Courier, monospace; font-weight: bold; }

/* Lists */
ul, ol, dl { font-size: 1em; line-height: 1.4; margin-bottom: 1.25em; list-style-position: outside; font-family: inherit; }

ul, ol { margin-left: 2.5em; }
ul.no-bullet, ol.no-bullet { margin-left: 1.5em; }

/* Unordered Lists */
ul li ul, ul li ol { margin-left: 1.25em; margin-bottom: 0; font-size: 1em; /* Override nested font-size change */ }
ul.square li ul, ul.circle li ul, ul.disc li ul { list-style: inherit; }
ul.square { list-style-type: square; }
ul.circle { list-style-type: circle; }
ul.disc { list-style-type: disc; }
ul.no-bullet { list-style: none; }

/* Ordered Lists */
ol li ul, ol li ol { margin-left: 1.25em; margin-bottom: 0; }

/* Definition Lists */
dl dt { margin-bottom: 0.3125em; font-weight: bold; }
dl dd { margin-bottom: 1.25em; }

/* Abbreviations */
abbr, acronym { text-transform: uppercase; font-size: 90%; color: #222222; border-bottom: 1px dotted #dddddd; cursor: help; }

abbr { text-transform: none; }

/* Blockquotes */
blockquote { margin: 0 0 1.25em; padding: 0.5625em 1.25em 0 1.1875em; border-left: 1px solid #dddddd; }
blockquote cite { display: block; font-size: 0.8125em; color: #555555; }
blockquote cite:before { content: "\2014 \0020"; }
blockquote cite a, blockquote cite a:visited { color: #555555; }

blockquote, blockquote p { line-height: 1.6; color: #6f6f6f; }

/* Microformats */
.vcard { display: inline-block; margin: 0 0 1.25em 0; border: 1px solid #dddddd; padding: 0.625em 0.75em; }
.vcard li { margin: 0; display: block; }
.vcard .fn { font-weight: bold; font-size: 0.9375em; }

.vevent .summary { font-weight: bold; }
.vevent abbr { cursor: auto; text-decoration: none; font-weight: bold; border: none; padding: 0 0.0625em; }

/*@media only screen and (min-width: 768px) { h1, h2, h3, #toctitle, .sidebarblock > .content > .title, h4, h5, h6 { line-height: 1.4; }
  h1 { font-size: 2.75em; }
  h2 { font-size: 2.3125em; }
  h3, #toctitle, .sidebarblock > .content > .title { font-size: 1.6875em; }
  h4 { font-size: 1.4375em; } }*/
/* Tables */
table { background: white; margin-bottom: 1.25em; border: solid 1px #dddddd; }
table thead, table tfoot { background: whitesmoke; font-weight: bold; }
table thead tr th, table thead tr td, table tfoot tr th, table tfoot tr td { padding: 0.5em 0.625em 0.625em; font-size: inherit; color: #222222; text-align: left; }
table tr th, table tr td { padding: 0.5625em 0.625em; font-size: inherit; color: #222222; }
table tr.even, table tr.alt, table tr:nth-of-type(even) { background: #f9f9f9; }
table thead tr th, table tfoot tr th, table tbody tr td, table tr td, table tfoot tr td { display: table-cell; line-height: 1.4; }

h1, h2, h3, #toctitle, .sidebarblock > .content > .title, h4, h5, h6 { line-height: 1.4; border-bottom: 1px solid #dddddd }

.clearfix:before, .clearfix:after, .float-group:before, .float-group:after { content: " "; display: table; }
.clearfix:after, .float-group:after { clear: both; }

*:not(pre) > code { font-size: inherit; font-style: normal !important; letter-spacing: 0; padding: 3px 2px 1px 2px; background-color: #eeeeee; border: 1px solid #dddddd; -webkit-border-radius: 0; border-radius: 0; line-height: inherit; font-weight: normal; }

pre, pre > code { line-height: 1.4; color: black; font-family: monospace, serif; font-weight: normal; }

.keyseq { color: #555555; }

kbd { display: inline-block; color: #222222; font-size: 0.75em; line-height: 1.4; background-color: #f7f7f7; border: 1px solid #ccc; -webkit-border-radius: 3px; border-radius: 3px; -webkit-box-shadow: 0 1px 0 rgba(0, 0, 0, 0.2), 0 0 0 0.1em white inset; box-shadow: 0 1px 0 rgba(0, 0, 0, 0.2), 0 0 0 0.1em white inset; margin: -0.15em 0.15em 0 0.15em; padding: 0.2em 0.6em 0.2em 0.5em; vertical-align: middle; white-space: nowrap; }

.keyseq kbd:first-child { margin-left: 0; }

.keyseq kbd:last-child { margin-right: 0; }

.menuseq, .menu { color: #090909; }

b.button:before, b.button:after { position: relative; top: -1px; font-weight: normal; }

b.button:before { content: "["; padding: 0 3px 0 2px; }

b.button:after { content: "]"; padding: 0 2px 0 3px; }

#header, #content, #footnotes, #footer { width: 100%; margin-left: auto; margin-right: auto; margin-top: 0; margin-bottom: 0; max-width: 62.5em; *zoom: 1; position: relative; padding-left: 0.9375em; padding-right: 0.9375em; }
#header:before, #header:after, #content:before, #content:after, #footnotes:before, #footnotes:after, #footer:before, #footer:after { content: " "; display: table; }
#header:after, #content:after, #footnotes:after, #footer:after { clear: both; }

#content { margin-top: 1.25em; }

#content:before { content: none; }

#header > h1:first-child { color: black; margin-top: 2.25rem; margin-bottom: 0; }
#header > h1:first-child + #toc { margin-top: 8px; border-top: 1px solid #dddddd; }
#header > h1:only-child, body.toc2 #header > h1:nth-last-child(2) { border-bottom: 1px solid #dddddd; padding-bottom: 8px; }
#header .details { border-bottom: 1px solid #dddddd; line-height: 1.45; padding-top: 0.25em; padding-bottom: 0.25em; padding-left: 0.25em; color: #555555; display: -ms-flexbox; display: -webkit-flex; display: flex; -ms-flex-flow: row wrap; -webkit-flex-flow: row wrap; flex-flow: row wrap; }
#header .details span:first-child { margin-left: -0.125em; }
#header .details span.email a { color: #6f6f6f; }
#header .details br { display: none; }
#header .details br + span:before { content: "\00a0\2013\00a0"; }
#header .details br + span.author:before { content: "\00a0\22c5\00a0"; color: #6f6f6f; }
#header .details br + span#revremark:before { content: "\00a0|\00a0"; }
#header #revnumber { text-transform: capitalize; }
#header #revnumber:after { content: "\00a0"; }

#content > h1:first-child:not([class]) { color: black; border-bottom: 1px solid #dddddd; padding-bottom: 8px; margin-top: 0; padding-top: 1rem; margin-bottom: 1.25rem; }

#floating {
  position: fixed;
  z-index: 1000;
  padding: 0.5em;
  right: 0;
  top: 0;
  background: white;
  box-shadow: 0 0 1em #777777;
  -webkit-box-shadow: 0 0 1em #777777;
  -moz-box-shadow: 0 0 1em #777777;
  -webkit-border-bottom-left-radius: 5px;
  -moz-border-radius-bottomleft: 5px;
  max-height: 80%;
  overflow: auto;
}

#floating #full { display: none; } /* Hide the full TOC by default */

#floating:hover #full{
  display: block; /* Show it on hover */
}


#toc { border-bottom: 1px solid #dddddd; padding-bottom: 0.5em; }
#toc > ul { margin-left: 0.125em; }
#toc ul.sectlevel0 > li > a { font-style: italic; }
#toc ul.sectlevel0 ul.sectlevel1 { margin: 0.5em 0; }
#toc ul { font-family: "Helvetica Neue", "Helvetica", Helvetica, Arial, sans-serif; list-style-type: none; }
#toc a { text-decoration: none; }
#toc a:active { text-decoration: underline; }

#toctitle { color: #6f6f6f; font-size: 1.2em; }

@media only screen and (min-width: 768px) { #toctitle { font-size: 1.375em; }
  body.toc2 { padding-left: 15em; padding-right: 0; }
  #toc.toc2 { margin-top: 0 !important; background-color: #f2f2f2; position: fixed; width: 15em; left: 0; top: 0; border-right: 1px solid #dddddd; border-top-width: 0 !important; border-bottom-width: 0 !important; z-index: 1000; padding: 1.25em 1em; height: 100%; overflow: auto; }
  #toc.toc2 #toctitle { margin-top: 0; font-size: 1.2em; }
  #toc.toc2 > ul { font-size: 0.9em; margin-bottom: 0; }
  #toc.toc2 ul ul { margin-left: 0; padding-left: 1em; }
  #toc.toc2 ul.sectlevel0 ul.sectlevel1 { padding-left: 0; margin-top: 0.5em; margin-bottom: 0.5em; }
  body.toc2.toc-right { padding-left: 0; padding-right: 15em; }
  body.toc2.toc-right #toc.toc2 { border-right-width: 0; border-left: 1px solid #dddddd; left: auto; right: 0; } }
@media only screen and (min-width: 1280px) { body.toc2 { padding-left: 20em; padding-right: 0; }
  #toc.toc2 { width: 20em; }
  #toc.toc2 #toctitle { font-size: 1.375em; }
  #toc.toc2 > ul { font-size: 0.95em; }
  #toc.toc2 ul ul { padding-left: 1.25em; }
  body.toc2.toc-right { padding-left: 0; padding-right: 20em; } }
#content #toc { border-style: solid; border-width: 1px; border-color: #d9d9d9; margin-bottom: 1.25em; padding: 1.25em; background: #f2f2f2; -webkit-border-radius: 0; border-radius: 0; }
#content #toc > :first-child { margin-top: 0; }
#content #toc > :last-child { margin-bottom: 0; }

#footer { max-width: 100%; background-color: #222222; padding: 1.25em; }

#footer-text { color: #dddddd; line-height: 1.44; }

.sect1 { padding-bottom: 0.625em; }

@media only screen and (min-width: 768px) { .sect1 { padding-bottom: 1.25em; } }
.sect1 + .sect1 { border-top: 1px solid #dddddd; }

#content h1 > a.anchor, h2 > a.anchor, h3 > a.anchor, #toctitle > a.anchor, .sidebarblock > .content > .title > a.anchor, h4 > a.anchor, h5 > a.anchor, h6 > a.anchor { position: absolute; z-index: 1001; width: 1.5ex; margin-left: -1.5ex; display: block; text-decoration: none !important; visibility: hidden; text-align: center; font-weight: normal; }
#content h1 > a.anchor:before, h2 > a.anchor:before, h3 > a.anchor:before, #toctitle > a.anchor:before, .sidebarblock > .content > .title > a.anchor:before, h4 > a.anchor:before, h5 > a.anchor:before, h6 > a.anchor:before { content: "\00A7"; font-size: 0.85em; display: block; padding-top: 0.1em; }
#content h1:hover > a.anchor, #content h1 > a.anchor:hover, h2:hover > a.anchor, h2 > a.anchor:hover, h3:hover > a.anchor, #toctitle:hover > a.anchor, .sidebarblock > .content > .title:hover > a.anchor, h3 > a.anchor:hover, #toctitle > a.anchor:hover, .sidebarblock > .content > .title > a.anchor:hover, h4:hover > a.anchor, h4 > a.anchor:hover, h5:hover > a.anchor, h5 > a.anchor:hover, h6:hover > a.anchor, h6 > a.anchor:hover { visibility: visible; }
#content h1 > a.link, h2 > a.link, h3 > a.link, #toctitle > a.link, .sidebarblock > .content > .title > a.link, h4 > a.link, h5 > a.link, h6 > a.link { color: #222222; text-decoration: none; }
#content h1 > a.link:hover, h2 > a.link:hover, h3 > a.link:hover, #toctitle > a.link:hover, .sidebarblock > .content > .title > a.link:hover, h4 > a.link:hover, h5 > a.link:hover, h6 > a.link:hover { color: #151515; }

.audioblock, .imageblock, .literalblock, .listingblock, .stemblock, .videoblock { margin-bottom: 1.25em; }

.admonitionblock td.content > .title, .audioblock > .title, .exampleblock > .title, .imageblock > .title, .listingblock > .title, .literalblock > .title, .stemblock > .title, .openblock > .title, .paragraph > .title, .quoteblock > .title, table.tableblock > .title, .verseblock > .title, .videoblock > .title, .dlist > .title, .olist > .title, .ulist > .title, .qlist > .title, .hdlist > .title { text-rendering: optimizeLegibility; text-align: left; }

table.tableblock > caption.title { white-space: nowrap; overflow: visible; max-width: 0; }

.paragraph.lead > p, #preamble > .sectionbody > .paragraph:first-of-type p { color: black; }

table.tableblock #preamble > .sectionbody > .paragraph:first-of-type p { font-size: inherit; }

.admonitionblock > table { border-collapse: separate; border: 0; background: none; width: 100%; }
.admonitionblock > table td.icon { text-align: center; width: 80px; }
.admonitionblock > table td.icon img { max-width: none; }
.admonitionblock > table td.icon .title { font-weight: bold; font-family: "Helvetica Neue", "Helvetica", Helvetica, Arial, sans-serif; text-transform: uppercase; }
.admonitionblock > table td.content { padding-left: 1.125em; padding-right: 1.25em; border-left: 1px solid #dddddd; color: #555555; }
.admonitionblock > table td.content > :last-child > :last-child { margin-bottom: 0; }

.exampleblock > .content { border-style: solid; border-width: 1px; border-color: #e6e6e6; margin-bottom: 1.25em; padding: 1.25em; background: white; -webkit-border-radius: 0; border-radius: 0; }
.exampleblock > .content > :first-child { margin-top: 0; }
.exampleblock > .content > :last-child { margin-bottom: 0; }

.sidebarblock { border-style: solid; border-width: 1px; border-color: #d9d9d9; margin-bottom: 1.25em; padding: 1.25em; background: #f2f2f2; -webkit-border-radius: 0; border-radius: 0; }
.sidebarblock > :first-child { margin-top: 0; }
.sidebarblock > :last-child { margin-bottom: 0; }
.sidebarblock > .content > .title { color: #6f6f6f; margin-top: 0; }

.exampleblock > .content > :last-child > :last-child, .exampleblock > .content .olist > ol > li:last-child > :last-child, .exampleblock > .content .ulist > ul > li:last-child > :last-child, .exampleblock > .content .qlist > ol > li:last-child > :last-child, .sidebarblock > .content > :last-child > :last-child, .sidebarblock > .content .olist > ol > li:last-child > :last-child, .sidebarblock > .content .ulist > ul > li:last-child > :last-child, .sidebarblock > .content .qlist > ol > li:last-child > :last-child { margin-bottom: 0; }

.literalblock pre, .listingblock pre:not(.highlight), .listingblock pre[class="highlight"], .listingblock pre[class^="highlight "], .listingblock pre.CodeRay, .listingblock pre.prettyprint { background: #eeeeee; }
.sidebarblock .literalblock pre, .sidebarblock .listingblock pre:not(.highlight), .sidebarblock .listingblock pre[class="highlight"], .sidebarblock .listingblock pre[class^="highlight "], .sidebarblock .listingblock pre.CodeRay, .sidebarblock .listingblock pre.prettyprint { background: #f2f1f1; }

.literalblock pre, .literalblock pre[class], .listingblock pre, .listingblock pre[class] { border: 1px solid #cccccc; -webkit-border-radius: 0; border-radius: 0; word-wrap: break-word; padding: 0.8em 0.8em 0.65em 0.8em; font-size: 0.8125em; }
.literalblock pre.nowrap, .literalblock pre[class].nowrap, .listingblock pre.nowrap, .listingblock pre[class].nowrap { overflow-x: auto; white-space: pre; word-wrap: normal; }
@media only screen and (min-width: 768px) { .literalblock pre, .literalblock pre[class], .listingblock pre, .listingblock pre[class] { font-size: 0.90625em; } }
@media only screen and (min-width: 1280px) { .literalblock pre, .literalblock pre[class], .listingblock pre, .listingblock pre[class] { font-size: 1em; } }

.literalblock.output pre { color: #eeeeee; background-color: black; }

.listingblock pre.highlightjs { padding: 0; }
.listingblock pre.highlightjs > code { padding: 0.8em 0.8em 0.65em 0.8em; -webkit-border-radius: 0; border-radius: 0; }

.listingblock > .content { position: relative; }

.listingblock code[data-lang]:before { display: none; content: attr(data-lang); position: absolute; font-size: 0.75em; top: 0.425rem; right: 0.5rem; line-height: 1; text-transform: uppercase; color: #999; }

.listingblock:hover code[data-lang]:before { display: block; }

.listingblock.terminal pre .command:before { content: attr(data-prompt); padding-right: 0.5em; color: #999; }

.listingblock.terminal pre .command:not([data-prompt]):before { content: "$"; }

table.pyhltable { border-collapse: separate; border: 0; margin-bottom: 0; background: none; }

table.pyhltable td { vertical-align: top; padding-top: 0; padding-bottom: 0; }

table.pyhltable td.code { padding-left: .75em; padding-right: 0; }

pre.pygments .lineno, table.pyhltable td:not(.code) { color: #999; padding-left: 0; padding-right: .5em; border-right: 1px solid #dddddd; }

pre.pygments .lineno { display: inline-block; margin-right: .25em; }

table.pyhltable .linenodiv { background: none !important; padding-right: 0 !important; }

.quoteblock { margin: 0 1em 1.25em 1.5em; display: table; }
.quoteblock > .title { margin-left: -1.5em; margin-bottom: 0.75em; }
.quoteblock blockquote, .quoteblock blockquote p { color: #6f6f6f; font-size: 1.15rem; line-height: 1.75; word-spacing: 0.1em; letter-spacing: 0; font-style: italic; text-align: justify; }
.quoteblock blockquote { margin: 0; padding: 0; border: 0; }
.quoteblock blockquote:before { content: "\201c"; float: left; font-size: 2.75em; font-weight: bold; line-height: 0.6em; margin-left: -0.6em; color: #6f6f6f; text-shadow: 0 1px 2px rgba(0, 0, 0, 0.1); }
.quoteblock blockquote > .paragraph:last-child p { margin-bottom: 0; }
.quoteblock .attribution { margin-top: 0.5em; margin-right: 0.5ex; text-align: right; }
.quoteblock .quoteblock { margin-left: 0; margin-right: 0; padding: 0.5em 0; border-left: 3px solid #555555; }
.quoteblock .quoteblock blockquote { padding: 0 0 0 0.75em; }
.quoteblock .quoteblock blockquote:before { display: none; }

.verseblock { margin: 0 1em 1.25em 1em; }
.verseblock pre { font-family: "Open Sans", "DejaVu Sans", sans; font-size: 1.15rem; color: #6f6f6f; font-weight: 300; text-rendering: optimizeLegibility; }
.verseblock pre strong { font-weight: 400; }
.verseblock .attribution { margin-top: 1.25rem; margin-left: 0.5ex; }

.quoteblock .attribution, .verseblock .attribution { font-size: 0.8125em; line-height: 1.45; font-style: italic; }
.quoteblock .attribution br, .verseblock .attribution br { display: none; }
.quoteblock .attribution cite, .verseblock .attribution cite { display: block; letter-spacing: -0.05em; color: #555555; }

.quoteblock.abstract { margin: 0 0 1.25em 0; display: block; }
.quoteblock.abstract blockquote, .quoteblock.abstract blockquote p { text-align: left; word-spacing: 0; }
.quoteblock.abstract blockquote:before, .quoteblock.abstract blockquote p:first-of-type:before { display: none; }

table.tableblock { max-width: 100%; border-collapse: separate; }
table.tableblock td > .paragraph:last-child p > p:last-child, table.tableblock th > p:last-child, table.tableblock td > p:last-child { margin-bottom: 0; }

table.spread { width: 100%; }

table.tableblock, th.tableblock, td.tableblock { border: 0 solid #dddddd; }

table.grid-all th.tableblock, table.grid-all td.tableblock { border-width: 0 1px 1px 0; }

table.grid-all tfoot > tr > th.tableblock, table.grid-all tfoot > tr > td.tableblock { border-width: 1px 1px 0 0; }

table.grid-cols th.tableblock, table.grid-cols td.tableblock { border-width: 0 1px 0 0; }

table.grid-all * > tr > .tableblock:last-child, table.grid-cols * > tr > .tableblock:last-child { border-right-width: 0; }

table.grid-rows th.tableblock, table.grid-rows td.tableblock { border-width: 0 0 1px 0; }

table.grid-all tbody > tr:last-child > th.tableblock, table.grid-all tbody > tr:last-child > td.tableblock, table.grid-all thead:last-child > tr > th.tableblock, table.grid-rows tbody > tr:last-child > th.tableblock, table.grid-rows tbody > tr:last-child > td.tableblock, table.grid-rows thead:last-child > tr > th.tableblock { border-bottom-width: 0; }

table.grid-rows tfoot > tr > th.tableblock, table.grid-rows tfoot > tr > td.tableblock { border-width: 1px 0 0 0; }

table.frame-all { border-width: 1px; }

table.frame-sides { border-width: 0 1px; }

table.frame-topbot { border-width: 1px 0; }

th.halign-left, td.halign-left { text-align: left; }

th.halign-right, td.halign-right { text-align: right; }

th.halign-center, td.halign-center { text-align: center; }

th.valign-top, td.valign-top { vertical-align: top; }

th.valign-bottom, td.valign-bottom { vertical-align: bottom; }

th.valign-middle, td.valign-middle { vertical-align: middle; }

table thead th, table tfoot th { font-weight: bold; }

tbody tr th { display: table-cell; line-height: 1.4; background: whitesmoke; }

tbody tr th, tbody tr th p, tfoot tr th, tfoot tr th p { color: #222222; font-weight: bold; }

p.tableblock > code:only-child { background: none; padding: 0; }

p.tableblock { font-size: 1em; }

td > div.verse { white-space: pre; }

ol { margin-left: 2.5em; }

ul li ol { margin-left: 1.5em; }

dl dd { margin-left: 1.125em; }

dl dd:last-child, dl dd:last-child > :last-child { margin-bottom: 0; }

ol > li p, ul > li p, ul dd, ol dd, .olist .olist, .ulist .ulist, .ulist .olist, .olist .ulist { margin-bottom: 0.625em; }

ul.unstyled, ol.unnumbered, ul.checklist, ul.none { list-style-type: none; }

ul.unstyled, ol.unnumbered, ul.checklist { margin-left: 0.625em; }

ul.checklist li > p:first-child > .fa-check-square-o:first-child, ul.checklist li > p:first-child > input[type="checkbox"]:first-child { margin-right: 0.25em; }

ul.checklist li > p:first-child > input[type="checkbox"]:first-child { position: relative; top: 1px; }

ul.inline { margin: 0 auto 0.625em auto; margin-left: -1.375em; margin-right: 0; padding: 0; list-style: none; overflow: hidden; }
ul.inline > li { list-style: none; float: left; margin-left: 1.375em; display: block; }
ul.inline > li > * { display: block; }

.unstyled dl dt { font-weight: normal; font-style: normal; }

ol.arabic { list-style-type: decimal; }

ol.decimal { list-style-type: decimal-leading-zero; }

ol.loweralpha { list-style-type: lower-alpha; }

ol.upperalpha { list-style-type: upper-alpha; }

ol.lowerroman { list-style-type: lower-roman; }

ol.upperroman { list-style-type: upper-roman; }

ol.lowergreek { list-style-type: lower-greek; }

.hdlist > table, .colist > table { border: 0; background: none; }
.hdlist > table > tbody > tr, .colist > table > tbody > tr { background: none; }

td.hdlist1 { padding-right: .75em; font-weight: bold; }

td.hdlist1, td.hdlist2 { vertical-align: top; }

.literalblock + .colist, .listingblock + .colist { margin-top: -0.5em; }

.colist > table tr > td:first-of-type { padding: 0 0.75em; line-height: 1; }
.colist > table tr > td:last-of-type { padding: 0.25em 0; }

.thumb, .th { line-height: 0; display: inline-block; border: solid 4px white; -webkit-box-shadow: 0 0 0 1px #dddddd; box-shadow: 0 0 0 1px #dddddd; }

.imageblock.left, .imageblock[style*="float: left"] { margin: 0.25em 0.625em 1.25em 0; }
.imageblock.right, .imageblock[style*="float: right"] { margin: 0.25em 0 1.25em 0.625em; }
.imageblock > .title { margin-bottom: 0; }
.imageblock.thumb, .imageblock.th { border-width: 6px; }
.imageblock.thumb > .title, .imageblock.th > .title { padding: 0 0.125em; }

.image.left, .image.right { margin-top: 0.25em; margin-bottom: 0.25em; display: inline-block; line-height: 0; }
.image.left { margin-right: 0.625em; }
.image.right { margin-left: 0.625em; }

a.image { text-decoration: none; }

span.footnote, span.footnoteref { vertical-align: super; font-size: 0.875em; }
span.footnote a, span.footnoteref a { text-decoration: none; }
span.footnote a:active, span.footnoteref a:active { text-decoration: underline; }

#footnotes { padding-top: 0.75em; padding-bottom: 0.75em; margin-bottom: 0.625em; }
#footnotes hr { width: 20%; min-width: 6.25em; margin: -.25em 0 .75em 0; border-width: 1px 0 0 0; }
#footnotes .footnote { padding: 0 0.375em; line-height: 1.3; font-size: 0.875em; margin-left: 1.2em; text-indent: -1.2em; margin-bottom: .2em; }
#footnotes .footnote a:first-of-type { font-weight: bold; text-decoration: none; }
#footnotes .footnote:last-of-type { margin-bottom: 0; }

#content #footnotes { margin-top: -0.625em; margin-bottom: 0; padding: 0.75em 0; }

.gist .file-data > table { border: 0; background: #fff; width: 100%; margin-bottom: 0; }
.gist .file-data > table td.line-data { width: 99%; }

div.unbreakable { page-break-inside: avoid; }

.big { font-size: larger; }

.small { font-size: smaller; }

.underline { text-decoration: underline; }

.overline { text-decoration: overline; }

.line-through { text-decoration: line-through; }

.aqua { color: #00bfbf; }

.aqua-background { background-color: #00fafa; }

.black { color: black; }

.black-background { background-color: black; }

.blue { color: #0000bf; }

.blue-background { background-color: #0000fa; }

.fuchsia { color: #bf00bf; }

.fuchsia-background { background-color: #fa00fa; }

.gray { color: #606060; }

.gray-background { background-color: #7d7d7d; }

.green { color: #006000; }

.green-background { background-color: #007d00; }

.lime { color: #00bf00; }

.lime-background { background-color: #00fa00; }

.maroon { color: #600000; }

.maroon-background { background-color: #7d0000; }

.navy { color: #000060; }

.navy-background { background-color: #00007d; }

.olive { color: #606000; }

.olive-background { background-color: #7d7d00; }

.purple { color: #600060; }

.purple-background { background-color: #7d007d; }

.red { color: #bf0000; }

.red-background { background-color: #fa0000; }

.silver { color: #909090; }

.silver-background { background-color: #bcbcbc; }

.teal { color: #006060; }

.teal-background { background-color: #007d7d; }

.white { color: #bfbfbf; }

.white-background { background-color: #fafafa; }

.yellow { color: #bfbf00; }

.yellow-background { background-color: #fafa00; }

span.icon > .fa { cursor: default; }

.admonitionblock td.icon [class^="fa icon-"] { font-size: 2.5em; text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.5); cursor: default; }
.admonitionblock td.icon .icon-note:before { content: "\f05a"; color: #207c98; }
.admonitionblock td.icon .icon-tip:before { content: "\f0eb"; text-shadow: 1px 1px 2px rgba(155, 155, 0, 0.8); color: #111; }
.admonitionblock td.icon .icon-warning:before { content: "\f071"; color: #bf6900; }
.admonitionblock td.icon .icon-caution:before { content: "\f06d"; color: #bf3400; }
.admonitionblock td.icon .icon-important:before { content: "\f06a"; color: #bf0000; }

.conum[data-value] { display: inline-block; color: #fff !important; background-color: #222222; -webkit-border-radius: 100px; border-radius: 100px; text-align: center; font-size: 0.75em; width: 1.67em; height: 1.67em; line-height: 1.67em; font-family: "Open Sans", "DejaVu Sans", sans-serif; font-style: normal; font-weight: bold; }
.conum[data-value] * { color: #fff !important; }
.conum[data-value] + b { display: none; }
.conum[data-value]:after { content: attr(data-value); }
pre .conum[data-value] { position: relative; top: -0.125em; }

b.conum * { color: inherit !important; }

.conum:not([data-value]):empty { display: none; }

.literalblock pre, .listingblock pre { background: #eeeeee; }

</style>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.2.0/css/font-awesome.min.css">
<style>.listingblock .pygments .hll { background-color: #ffffcc }
.listingblock .pygments  { background: #f8f8f8; }
.listingblock .pygments .tok-c { color: #408080; font-style: italic } /* Comment */
.listingblock .pygments .tok-err { border: 1px solid #FF0000 } /* Error */
.listingblock .pygments .tok-k { color: #008000; font-weight: bold } /* Keyword */
.listingblock .pygments .tok-o { color: #666666 } /* Operator */
.listingblock .pygments .tok-cm { color: #408080; font-style: italic } /* Comment.Multiline */
.listingblock .pygments .tok-cp { color: #BC7A00 } /* Comment.Preproc */
.listingblock .pygments .tok-c1 { color: #408080; font-style: italic } /* Comment.Single */
.listingblock .pygments .tok-cs { color: #408080; font-style: italic } /* Comment.Special */
.listingblock .pygments .tok-gd { color: #A00000 } /* Generic.Deleted */
.listingblock .pygments .tok-ge { font-style: italic } /* Generic.Emph */
.listingblock .pygments .tok-gr { color: #FF0000 } /* Generic.Error */
.listingblock .pygments .tok-gh { color: #000080; font-weight: bold } /* Generic.Heading */
.listingblock .pygments .tok-gi { color: #00A000 } /* Generic.Inserted */
.listingblock .pygments .tok-go { color: #888888 } /* Generic.Output */
.listingblock .pygments .tok-gp { color: #000080; font-weight: bold } /* Generic.Prompt */
.listingblock .pygments .tok-gs { font-weight: bold } /* Generic.Strong */
.listingblock .pygments .tok-gu { color: #800080; font-weight: bold } /* Generic.Subheading */
.listingblock .pygments .tok-gt { color: #0044DD } /* Generic.Traceback */
.listingblock .pygments .tok-kc { color: #008000; font-weight: bold } /* Keyword.Constant */
.listingblock .pygments .tok-kd { color: #008000; font-weight: bold } /* Keyword.Declaration */
.listingblock .pygments .tok-kn { color: #008000; font-weight: bold } /* Keyword.Namespace */
.listingblock .pygments .tok-kp { color: #008000 } /* Keyword.Pseudo */
.listingblock .pygments .tok-kr { color: #008000; font-weight: bold } /* Keyword.Reserved */
.listingblock .pygments .tok-kt { color: #B00040 } /* Keyword.Type */
.listingblock .pygments .tok-m { color: #666666 } /* Literal.Number */
.listingblock .pygments .tok-s { color: #BA2121 } /* Literal.String */
.listingblock .pygments .tok-na { color: #7D9029 } /* Name.Attribute */
.listingblock .pygments .tok-nb { color: #008000 } /* Name.Builtin */
.listingblock .pygments .tok-nc { color: #0000FF; font-weight: bold } /* Name.Class */
.listingblock .pygments .tok-no { color: #880000 } /* Name.Constant */
.listingblock .pygments .tok-nd { color: #AA22FF } /* Name.Decorator */
.listingblock .pygments .tok-ni { color: #999999; font-weight: bold } /* Name.Entity */
.listingblock .pygments .tok-ne { color: #D2413A; font-weight: bold } /* Name.Exception */
.listingblock .pygments .tok-nf { color: #0000FF } /* Name.Function */
.listingblock .pygments .tok-nl { color: #A0A000 } /* Name.Label */
.listingblock .pygments .tok-nn { color: #0000FF; font-weight: bold } /* Name.Namespace */
.listingblock .pygments .tok-nt { color: #008000; font-weight: bold } /* Name.Tag */
.listingblock .pygments .tok-nv { color: #19177C } /* Name.Variable */
.listingblock .pygments .tok-ow { color: #AA22FF; font-weight: bold } /* Operator.Word */
.listingblock .pygments .tok-w { color: #bbbbbb } /* Text.Whitespace */
.listingblock .pygments .tok-mb { color: #666666 } /* Literal.Number.Bin */
.listingblock .pygments .tok-mf { color: #666666 } /* Literal.Number.Float */
.listingblock .pygments .tok-mh { color: #666666 } /* Literal.Number.Hex */
.listingblock .pygments .tok-mi { color: #666666 } /* Literal.Number.Integer */
.listingblock .pygments .tok-mo { color: #666666 } /* Literal.Number.Oct */
.listingblock .pygments .tok-sb { color: #BA2121 } /* Literal.String.Backtick */
.listingblock .pygments .tok-sc { color: #BA2121 } /* Literal.String.Char */
.listingblock .pygments .tok-sd { color: #BA2121; font-style: italic } /* Literal.String.Doc */
.listingblock .pygments .tok-s2 { color: #BA2121 } /* Literal.String.Double */
.listingblock .pygments .tok-se { color: #BB6622; font-weight: bold } /* Literal.String.Escape */
.listingblock .pygments .tok-sh { color: #BA2121 } /* Literal.String.Heredoc */
.listingblock .pygments .tok-si { color: #BB6688; font-weight: bold } /* Literal.String.Interpol */
.listingblock .pygments .tok-sx { color: #008000 } /* Literal.String.Other */
.listingblock .pygments .tok-sr { color: #BB6688 } /* Literal.String.Regex */
.listingblock .pygments .tok-s1 { color: #BA2121 } /* Literal.String.Single */
.listingblock .pygments .tok-ss { color: #19177C } /* Literal.String.Symbol */
.listingblock .pygments .tok-bp { color: #008000 } /* Name.Builtin.Pseudo */
.listingblock .pygments .tok-vc { color: #19177C } /* Name.Variable.Class */
.listingblock .pygments .tok-vg { color: #19177C } /* Name.Variable.Global */
.listingblock .pygments .tok-vi { color: #19177C } /* Name.Variable.Instance */
.listingblock .pygments .tok-il { color: #666666 } /* Literal.Number.Integer.Long */
</style>
</head>
<body class="article toc2 toc-left">
<div id="header">
<h1>Servicios Rest</h1>
<div class="details">
<span id="author" class="author">MarÃ­a Isabel Alfonso Galipienso</span><br>
<span id="email" class="email">&lt;<a href="mailto:eli@ua.es">eli@ua.es</a>&gt;</span><br>
</div>
<div id="toc" class="toc2">
<div id="toctitle">Ãndice de contenidos</div>
<ul class="sectlevel1">
<li><a href="#sesion03">3. Manejadores de contenidos. Respuestas del servidor y manejo de excepciones.</a>
<ul class="sectlevel2">
<li><a href="#_proveedores_de_entidades">3.1. Proveedores de entidades</a>
<ul class="sectlevel3">
<li><a href="#_interfaz_javax_ws_rs_ext_messagebodyreader">3.1.1. Interfaz javax.ws.rs.ext.MessageBodyReader</a></li>
<li><a href="#_interfaz_javax_ws_rs_ext_messagebodywriter">3.1.2. Interfaz javax.ws.rs.ext.MessageBodyWriter</a></li>
</ul>
</li>
<li><a href="#_proveedores_de_entidad_est%C3%A1ndar_incluidos_en_jax_rs">3.2. Proveedores de entidad estÃ¡ndar incluidos en JAX-RS</a>
<ul class="sectlevel3">
<li><a href="#_javax_ws_rs_core_streamingoutput">3.2.1. javax.ws.rs.core.StreamingOutput</a></li>
<li><a href="#_java_io_inputstream_java_io_reader">3.2.2. java.io.InputStream, java.io.Reader</a></li>
<li><a href="#_java_io_file">3.2.3. java.io.File</a></li>
<li><a href="#_byte">3.2.4. byte[]</a></li>
<li><a href="#_string_char">3.2.5. String, char[]</a></li>
<li><a href="#_multivaluedmap_string_string_y_formularios_de_entrada">3.2.6. MultivaluedMap&lt;String, String&gt; y formularios de entrada</a></li>
</ul>
</li>
<li><a href="#_m%C3%BAltiples_representaciones_de_recursos">3.3. MÃºltiples representaciones de recursos</a></li>
<li><a href="#_introducci%C3%B3n_a_jaxb">3.4. IntroducciÃ³n a JAXB</a>
<ul class="sectlevel3">
<li><a href="#_clase_jaxbcontext">3.4.1. Clase JAXBContext</a></li>
<li><a href="#_manejadores_jax_rs_para_jaxb">3.4.2. Manejadores JAX-RS para JAXB</a></li>
<li><a href="#_jaxb_y_json">3.4.3. JAXB y JSON</a></li>
</ul>
</li>
<li><a href="#_respuestas_del_servidor">3.5. Respuestas del servidor</a>
<ul class="sectlevel3">
<li><a href="#_c%C3%B3digos_de_respuesta_por_defecto">3.5.1. CÃ³digos de respuesta por defecto</a></li>
<li><a href="#_elaboraci%C3%B3n_de_respuestas_con_la_clase_response">3.5.2. ElaboraciÃ³n de respuestas con la clase Response</a></li>
</ul>
</li>
<li><a href="#_manejadores_de_excepciones">3.6. Manejadores de excepciones</a>
<ul class="sectlevel3">
<li><a href="#_la_clase_javax_ws_rs_webapplicationexception">3.6.1. La clase javax.ws.rs.WebApplicationException</a></li>
<li><a href="#_mapeado_de_excepciones">3.6.2. Mapeado de excepciones</a></li>
<li><a href="#_jerarqu%C3%ADa_de_excepciones">3.6.3. JerarquÃ­a de excepciones</a></li>
</ul>
</li>
<li><a href="#_ejercicios">3.7. Ejercicios</a>
<ul class="sectlevel3">
<li><a href="#_servicio_rest_ejemplo">3.7.1. Servicio REST ejemplo</a></li>
<li><a href="#_plantillas_que_se_proporcionan">3.7.2. Plantillas que se proporcionan</a></li>
<li><a href="#_uso_de_jaxb_0_5_puntos">3.7.3. Uso de JAXB (0,5 puntos)</a></li>
<li><a href="#_uso_de_manejadores_de_contenidos_y_clase_response_0_75_puntos">3.7.4. Uso de manejadores de contenidos y clase Response (0,75 puntos)</a></li>
<li><a href="#_manejo_de_excepciones_0_75_puntos">3.7.5. Manejo de excepciones (0,75 puntos)</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
</div>
<div id="content">
<div id="preamble">
<div class="sectionbody">
<div style="page-break-after: always;"></div>
</div>
</div>
<div class="sect1">
<h2 id="sesion03">3. Manejadores de contenidos. Respuestas del servidor y manejo de excepciones.</h2>
<div class="sectionbody">
<div class="paragraph">
<p>En la sesiÃ³n anterior hemos hablado de cÃ³mo inyectar informaciÃ³n contenida en las
cabeceras de las peticiones HTTP, ahora nos detendremos en el cuerpo del
mensaje, tanto de la peticiÃ³n como de la respuesta. En el caso de las peticiones,
explicaremos el proceso de transformar
los datos de entrada en objetos Java, para poder ser procesados por nuestros servicios.
Con respecto a las respuestas proporcionadas por nuestros servicios, analizaremos tanto
los cÃ³digos de respuesta por defecto, como la elaboraciÃ³n de respuestas complejas y
manejo de excepciones.</p>
</div>
<div class="sect2">
<h3 id="_proveedores_de_entidades">3.1. Proveedores de entidades</h3>
<div class="paragraph">
<p>JAX-RS define lo que se denominan <strong>proveedores de entidades</strong>, que son clases que proporcionan
servicios de mapeado entre las representaciones del cuerpo del mensaje HTTP y los
correspondientes tipos java que utilizaremos en nuestros recursos (parÃ¡metros en los mÃ©todos, o
bien como tipo de la respuesta de los mismos). Las <strong>entidades</strong> tambiÃ©n se conocen con el
nombre de <strong>"message payload"</strong>, o simplemente como <strong>payload</strong>, y representan el <strong>contenido del
cuerpo</strong> del mensaje HTTP.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="title">Providers</div>
<div class="paragraph">
<p>El <em>runtime</em> de JAX-RS puede "extenderse" (ampliarse) utilizando clases "proveedoras" (<em>providers</em>)
suministradas por
nuestra aplicaciÃ³n. Concretamente, JAX-RS nos proporciona un conjunto de interfaces que
podemos implementar en nuestra aplicaciÃ³n, creando asÃ­ dichas clases "proveedoras de entidades"
(<em>entity providers</em>).
La especificaciÃ³n de JAX-RS define un <strong>proveedor</strong> como una clase que implementa una o mÃ¡s
interfaces JAX-RS (de entre un conjunto determinado) y que pueden anotarse con <code>@provider</code>
para ser "descubiertas" de forma automÃ¡tica por el <em>runtime</em> de JAX-RS.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Nuestra aplicaciÃ³n puede proporcionar su propio mapeado entre representaciones (tipos MIME)
del mensaje de entrada y tipos Java
implementando las interfaces <code>MessageBodyWriter</code> y <code>MessageBodyReader</code>, convirtiÃ©ndose asÃ­ en clases
<strong>proveedoras de entidades</strong> (<strong><em>entity providers</em></strong>). Por ejemplo, podemos tener nuestro propio proveedor
de entidades para el formato XML, o JSON, de forma que, utilizando las librerÃ­as de java
para procesamiento XML o JSON (<em>Java API for XML Processing: <a href="https://www.jcp.org/en/jsr/detail/summary?id=206">JAXP</a></em>
y <em>Java API for JSON Processing: <a href="https://jcp.org/en/jsr/detail?id=353">JSON-P</a></em>),
implementemos el serializado/deserializado del cuerpo del mensaje HTTP de entrada cuando
Ã©ste presente los tipos MIME <em>"application/xml"</em> o <em>"application_json"</em>. Las clases que realizan
dichos mapeados son clases <em>entity provider</em>.</p>
</div>
<div class="sect3">
<h4 id="_interfaz_javax_ws_rs_ext_messagebodyreader">3.1.1. Interfaz javax.ws.rs.ext.MessageBodyReader</h4>
<div class="paragraph">
<p>La interfaz <code>MessageBodyReader</code> define el contrato entre el <em>runtime</em> de JAX-RS y
los componentes que proporcionan servicios de mapeado desde diferentes representaciones
(indicadas como tipos <em>mime</em>) al
tipo Java correspondiente. Cualquier clase que quiera proporcionar dicho servicio
debe implementar la interfaz <code>MessageBodyReader</code> y debe anotarse con @Provider para
poder ser "detectada" de forma automÃ¡tica por el <em>runtime</em> de JAX-RS.</p>
</div>
<div class="paragraph">
<p>La secuencia lÃ³gica de pasos seguidos por una implementaciÃ³n de JAX-RS cuando se
mapea el cuerpo de un mensaje HTTP de entrada a un parÃ¡metro de un mÃ©todo Java es
la siguiente:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Se obtiene el <em>media type</em> de la peticiÃ³n (valor de la cabecera HTTP <code>Content-Type</code>).
Si la peticiÃ³n no contiene una cabecera <code>Content-Type</code> se usarÃ¡ <code>application/octet-stream</code></p>
</li>
<li>
<p>Se identifica el tipo java del parÃ¡metro cuyo valor serÃ¡ mapeado desde el cuerpo del mensaje</p>
</li>
<li>
<p>Se localiza la clase <code>MessageBodyReader</code> que soporta el <em>media type</em> de la peticiÃ³n y se
usa su mÃ©todo <code>readFrom()</code> para mapear el contenido del cuerpo del mensaje HTTP en el
tipo Java que corresponda</p>
</li>
<li>
<p>Si no es posible encontrar el <em>MessageBodyReader</em> adecuado se genera la excepciÃ³n
<code>NotSupportedException</code>, con el cÃ³digo 405</p>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="_interfaz_javax_ws_rs_ext_messagebodywriter">3.1.2. Interfaz javax.ws.rs.ext.MessageBodyWriter</h4>
<div class="paragraph">
<p>La interfaz <code>MessageBodyWriter</code> define el contrato entre el <em>runtime</em> de JAX-RS y
los componentes que proporcionan servicios de mapeado desde un tipo Java a una
representaciÃ³n determinada. Cualquier clase que quiera proporcionar dicho servicio
debe implementar la interfaz <code>MessageBodyWriter</code> y debe anotarse con <code>@Provider</code> para
poder ser "detectada" de forma automÃ¡tica por el <em>runtime</em> de JAX-RS.</p>
</div>
<div class="paragraph">
<p>La secuencia lÃ³gica de pasos seguidos por una implementaciÃ³n de JAX-RS cuando se
mapea un valor de retorno de un mÃ©todo del recurso a una entidad del cuerpo de un
mensaje HTTP es la siguiente:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Se obtiene el objeto que serÃ¡ mapeado a la entidad del cuerpo del mensaje</p>
</li>
<li>
<p>Se determina el <em>media type</em> de la respuesta</p>
</li>
<li>
<p>Se localiza la clase <code>MessageBodyWriter</code> que soporta el objeto que serÃ¡ mapeado
a la entidad del cuerpo del mensaje HTTP, y se utiliza su mÃ©todo <code>writeTo()</code> para
realizar dicho mapeado</p>
</li>
<li>
<p>Si no es posible encontrar el <code>MessageBodyWriter</code> adecuado se genera la excepciÃ³n
<code>InternalServerErrorException</code> (que es una subclase de <code>WebApplicationException</code>)
 con el cÃ³digo 500</p>
</li>
</ol>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_proveedores_de_entidad_estÃ¡ndar_incluidos_en_jax_rs">3.2. Proveedores de entidad estÃ¡ndar incluidos en JAX-RS</h3>
<div class="paragraph">
<p>Cualquier implementaciÃ³n de JAX-RS debe incluir un conjunto de implementaciones de
<code>MessageBodyReader</code> y <code>MessageBodyWriter</code> de forma predeterminada para ciertas
combinaciones de tipos Java y <em>media types</em>.</p>
</div>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 1. Proveedores de entidades estÃ¡ndar de una implementaciÃ³n JAX-RS</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Tipo Java</th>
<th class="tableblock halign-left valign-top">Media Type</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">byte[]</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">*/* (Cualquier <em>media type</em>)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">java.lang.String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">*/* (Cualquier <em>media type</em>)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">java.io.InputStream</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">*/* (Cualquier <em>media type</em>)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">java.io.Reader</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">*/* (Cualquier <em>media type</em>)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">java.io.File</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">*/* (Cualquier <em>media type</em>)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">javax.activation.DataSource</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">*/* (Cualquier <em>media type</em>)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">javax.xml.transform.Source</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">text/xml, application/xml, application/*+xml (tipos basados en xml)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">javax.xml.bind.JAXBElement and application-supplied JAXB classes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">text/xml, application/xml, application/*+xml (tipos basados en xml)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">MultivaluedMap&lt;String,String&gt;</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">application/x-www-form-urlencoded (Contenido de formularios)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">StreamingOutput</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">*/* (Cualquier <em>media type</em>) (SÃ³lo <code>MessageBodyWriter</code>)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">java.lang.Boolean, java.lang.Character, java.lang.Number</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">text/plain</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>A continuaciÃ³n comentaremos algunos de estos <em>proveedores de entidades</em> estÃ¡ndar,
 o "conversores" por defecto, que permiten convertir el cuerpo
del mensaje HTTP a objetos Java de diferentes tipos y viceversa.</p>
</div>
<div class="sect3">
<h4 id="_javax_ws_rs_core_streamingoutput">3.2.1. javax.ws.rs.core.StreamingOutput</h4>
<div class="paragraph">
<p><em>StreamingOutput</em> es una interfaz
<em>callback</em> que implementamos cuando queremos tratar como un flujo continuo (<em>streaming</em>) el
cuerpo de la respuesta. Constituye una alternativa "ligera" al uso de <code>MessageBodyWriter</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span class="tok-kd">public</span> <span class="tok-kd">interface</span> <span class="tok-nc">StreamingOutput</span> <span class="tok-o">{</span>
  <span class="tok-kt">void</span> <span class="tok-nf">write</span><span class="tok-o">(</span><span class="tok-n">OutputStream</span> <span class="tok-n">output</span><span class="tok-o">)</span>
     <span class="tok-kd">throws</span> <span class="tok-n">IOException</span><span class="tok-o">,</span> <span class="tok-n">WebApplicationException</span><span class="tok-o">;</span>
<span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Implementamos una instancia de esta interfaz, y la utilizamos como tipo de retorno de
nuestros mÃ©todos de recursos. Cuando el <em>runtime</em> de JAX-RS estÃ¡ listo para escribir
el cuerpo de respuesta del mensaje, se invoca al mÃ©todo <code>write()</code> de la instancia de
<code>StreamingOutput</code>. Veamos un ejemplo:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span class="tok-nd">@Path</span><span class="tok-o">(</span><span class="tok-s">&quot;/miservicio&quot;</span><span class="tok-o">)</span> <span class="tok-kd">public</span> <span class="tok-kd">class</span> <span class="tok-nc">MiServicio</span> <span class="tok-o">{</span>
  <span class="tok-nd">@GET</span>
  <span class="tok-nd">@Produces</span><span class="tok-o">(</span><span class="tok-s">&quot;text/plain&quot;</span><span class="tok-o">)</span>
  <span class="tok-n">StreamingOutput</span> <span class="tok-nf">get</span><span class="tok-o">()</span> <span class="tok-o">{</span>
    <span class="tok-k">return</span> <span class="tok-k">new</span> <span class="tok-nf">StreamingOutput</span><span class="tok-o">()</span> <span class="tok-o">{</span>
      <span class="tok-kd">public</span> <span class="tok-kt">void</span> <span class="tok-nf">write</span><span class="tok-o">(</span><span class="tok-n">OutputStream</span> <span class="tok-n">output</span><span class="tok-o">)</span>
            <span class="tok-kd">throws</span> <span class="tok-n">IOException</span><span class="tok-o">,</span> <span class="tok-n">WebApplicationException</span> <span class="tok-o">{</span>
                <span class="tok-n">output</span><span class="tok-o">.</span><span class="tok-na">write</span><span class="tok-o">(</span><span class="tok-s">&quot;hello world&quot;</span><span class="tok-o">.</span><span class="tok-na">getBytes</span><span class="tok-o">());</span>
      <span class="tok-o">}</span>
  <span class="tok-o">};</span>
<span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Hemos utilizado una clase interna anÃ³nima que implementa la interfaz <code>StreamingOutput</code>
en lugar de crear una clase pÃºblica separada. La razÃ³n de utilizar una clase interna, es
porque en este caso, al contener tan pocas lÃ­neas de cÃ³digo, resulta beneficioso mantener dicha lÃ³gica "dentro" del
mÃ©todo del recurso JAX-RS, de forma que el cÃ³digo sea mÃ¡s fÃ¡cil de "seguir". Normalmente
no tendremos necesidad de reutilizar la lÃ³gica implementada en otros mÃ©todos, por lo que
no tiene demasiado sentido crear otra clase especÃ­fica.</p>
</div>
<div class="paragraph">
<p>Â¿Y por quÃ© no inyectamos un <code>OutputStream</code> directamente? Â¿Por quÃ© necesitamos un objeto
<code>callback</code>? La razÃ³n es que asÃ­ dejamos que el runtime de JAX-RS maneje la salida de la
manera que quiera. Por ejemplo, por razones de rendimiento, puede ser conveniente que
JAX-RS utilice un <em>thread</em> para responder, diferente del <em>thread</em> de peticiÃ³n.</p>
</div>
</div>
<div class="sect3">
<h4 id="_java_io_inputstream_java_io_reader">3.2.2. java.io.InputStream, java.io.Reader</h4>
<div class="paragraph">
<p>Para leer el cuerpo de un mensaje de entrada, podemos utilizar las clases <code>InputStream</code> o
 <code>Reader</code>. Por ejemplo:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span class="tok-nd">@Path</span><span class="tok-o">(</span><span class="tok-s">&quot;/&quot;</span><span class="tok-o">)</span>
<span class="tok-kd">public</span> <span class="tok-kd">class</span> <span class="tok-nc">MiServicio</span> <span class="tok-o">{</span>
  <span class="tok-nd">@PUT</span>
  <span class="tok-nd">@Path</span><span class="tok-o">(</span><span class="tok-s">&quot;/dato&quot;</span><span class="tok-o">)</span>
  <span class="tok-kd">public</span> <span class="tok-kt">void</span> <span class="tok-nf">modificaDato</span><span class="tok-o">(</span><span class="tok-n">InputStream</span> <span class="tok-n">is</span><span class="tok-o">)</span> <span class="tok-o">{</span>
     <span class="tok-kt">byte</span><span class="tok-o">[]</span> <span class="tok-n">bytes</span> <span class="tok-o">=</span> <span class="tok-n">readFromStream</span><span class="tok-o">(</span><span class="tok-n">is</span><span class="tok-o">);</span>
     <span class="tok-n">String</span> <span class="tok-n">input</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-nf">String</span><span class="tok-o">(</span><span class="tok-n">bytes</span><span class="tok-o">);</span>
     <span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">out</span><span class="tok-o">.</span><span class="tok-na">println</span><span class="tok-o">(</span><span class="tok-n">input</span><span class="tok-o">);</span>
  <span class="tok-o">}</span>

  <span class="tok-kd">private</span> <span class="tok-kt">byte</span><span class="tok-o">[]</span> <span class="tok-nf">readFromStream</span><span class="tok-o">(</span><span class="tok-n">InputStream</span> <span class="tok-n">stream</span><span class="tok-o">)</span>
                           <span class="tok-kd">throws</span> <span class="tok-n">IOException</span> <span class="tok-o">{</span>
    <span class="tok-n">ByteArrayOutputStream</span> <span class="tok-n">baos</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-nf">ByteArrayOutputStream</span><span class="tok-o">();</span>
    <span class="tok-kt">byte</span><span class="tok-o">[]</span> <span class="tok-n">buffer</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-kt">byte</span><span class="tok-o">[</span><span class="tok-mi">1000</span><span class="tok-o">];</span>
    <span class="tok-kt">int</span> <span class="tok-n">wasRead</span> <span class="tok-o">=</span> <span class="tok-mi">0</span><span class="tok-o">;</span>
    <span class="tok-k">do</span> <span class="tok-o">{</span>
       <span class="tok-n">wasRead</span> <span class="tok-o">=</span> <span class="tok-n">stream</span><span class="tok-o">.</span><span class="tok-na">read</span><span class="tok-o">(</span><span class="tok-n">buffer</span><span class="tok-o">);</span>
       <span class="tok-k">if</span> <span class="tok-o">(</span><span class="tok-n">wasRead</span> <span class="tok-o">&gt;</span> <span class="tok-mi">0</span><span class="tok-o">)</span> <span class="tok-o">{</span>
          <span class="tok-n">baos</span><span class="tok-o">.</span><span class="tok-na">write</span><span class="tok-o">(</span><span class="tok-n">buffer</span><span class="tok-o">,</span> <span class="tok-mi">0</span><span class="tok-o">,</span> <span class="tok-n">wasRead</span><span class="tok-o">);</span>
       <span class="tok-o">}</span>
    <span class="tok-o">}</span> <span class="tok-k">while</span> <span class="tok-o">(</span><span class="tok-n">wasRead</span> <span class="tok-o">&gt;</span> <span class="tok-o">-</span><span class="tok-mi">1</span><span class="tok-o">);</span>
    <span class="tok-k">return</span> <span class="tok-n">baos</span><span class="tok-o">.</span><span class="tok-na">toByteArray</span><span class="tok-o">();</span>
  <span class="tok-o">}</span>
<span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>En este caso estamos leyendo <em>bytes</em> a partir de un <code>java.io.InputStream</code>,
para convertirlo en una cadena de caracteres que mostramos por pantalla.</p>
</div>
<div class="paragraph">
<p>En el siguiente ejemplo, creamos un <code>java.io.LineNumberReader</code> a partir de
un objeto <code>Reader</code> e imprimimos cada lÃ­nea del cuerpo del mensaje de entrada:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span class="tok-nd">@PUT</span>
<span class="tok-nd">@Path</span><span class="tok-o">(</span><span class="tok-s">&quot;/maslineas&quot;</span><span class="tok-o">)</span>
<span class="tok-kd">public</span> <span class="tok-kt">void</span> <span class="tok-nf">putMasLineas</span><span class="tok-o">(</span><span class="tok-n">Reader</span> <span class="tok-n">reader</span><span class="tok-o">)</span> <span class="tok-o">{</span>
    <span class="tok-n">LineNumberReader</span> <span class="tok-n">lineReader</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-nf">LineNumberReader</span><span class="tok-o">(</span><span class="tok-n">reader</span><span class="tok-o">);</span>
    <span class="tok-k">do</span><span class="tok-o">{</span>
        <span class="tok-n">String</span> <span class="tok-n">line</span> <span class="tok-o">=</span> <span class="tok-n">lineReader</span><span class="tok-o">.</span><span class="tok-na">readLine</span><span class="tok-o">();</span>
        <span class="tok-k">if</span> <span class="tok-o">(</span><span class="tok-n">line</span> <span class="tok-o">!=</span> <span class="tok-kc">null</span><span class="tok-o">)</span> <span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">out</span><span class="tok-o">.</span><span class="tok-na">println</span><span class="tok-o">(</span><span class="tok-n">line</span><span class="tok-o">);</span>
    <span class="tok-o">}</span> <span class="tok-k">while</span> <span class="tok-o">(</span><span class="tok-n">line</span> <span class="tok-o">!=</span> <span class="tok-kc">null</span><span class="tok-o">);</span>
<span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>No estamos limitados solamente a utilizar instancias de <code>InputStream</code> y/o <code>Reader</code>
para leer el cuerpo de los mensajes de entrada. TambiÃ©n podemos devolver dichos
objetos como respuesta. Por ejemplo:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span class="tok-nd">@Path</span><span class="tok-o">(</span><span class="tok-s">&quot;/fichero&quot;</span><span class="tok-o">)</span>
<span class="tok-kd">public</span> <span class="tok-kd">class</span> <span class="tok-nc">FicheroServicio</span> <span class="tok-o">{</span>
  <span class="tok-kd">private</span> <span class="tok-kd">static</span> <span class="tok-kd">final</span> <span class="tok-n">String</span> <span class="tok-n">basePath</span> <span class="tok-o">=</span> <span class="tok-s">&quot;...&quot;</span><span class="tok-o">;</span>

  <span class="tok-nd">@GET</span>
  <span class="tok-nd">@Path</span><span class="tok-o">(</span><span class="tok-s">&quot;{rutafichero: .*}&quot;</span><span class="tok-o">)</span>
  <span class="tok-nd">@Produces</span><span class="tok-o">(</span><span class="tok-s">&quot;text/plain&quot;</span><span class="tok-o">)</span>
  <span class="tok-kd">public</span> <span class="tok-n">InputStream</span> <span class="tok-nf">getFichero</span><span class="tok-o">(</span><span class="tok-nd">@PathParam</span><span class="tok-o">(</span><span class="tok-s">&quot;rutafichero&quot;</span><span class="tok-o">)</span>
                                 <span class="tok-n">String</span> <span class="tok-n">path</span><span class="tok-o">)</span> <span class="tok-o">{</span>
    <span class="tok-n">FileInputStream</span> <span class="tok-n">is</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-nf">FileInputStream</span><span class="tok-o">(</span><span class="tok-n">basePath</span> <span class="tok-o">+</span> <span class="tok-n">path</span><span class="tok-o">);</span>
    <span class="tok-k">return</span> <span class="tok-n">is</span><span class="tok-o">;</span>
  <span class="tok-o">}</span>
<span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>AquÃ­ estamos inyectando un valor <code>@PathParam</code> para crear una referencia a un fichero real
de nuestro disco duro. Creamos una instancia de <code>java.io.FileInputStream</code> a partir del valor
de la ruta inyectada como parÃ¡metro y la devolvemos como cuerpo de nuestro mensaje de
respuesta. La implementaciÃ³n de JAX-RS leerÃ¡ la respuesta de este <em>stream</em> de entrada
y la almacenarÃ¡ en un <em>buffer</em> para posteriormente "escribirla" de forma incremental
en el <em>stream</em> de salida de la respuesta. En este caso debemos especificar la anotaciÃ³n
@Produces para que la implementaciÃ³n de JAX-RS conozca el valor que debe asignar a la
cabecera <code>Content-Type</code> en la respuesta.</p>
</div>
</div>
<div class="sect3">
<h4 id="_java_io_file">3.2.3. java.io.File</h4>
<div class="paragraph">
<p>Se pueden utilizar instancias de la clase <code>java.io.File</code> para <strong>entrada y salida</strong> de cualquier
MIME-TYPE (especificado en <code>Content-Type</code> y/o <code>Accept</code>, y en las anotaciones <code>@Produces</code> y/o
<code>@Consumes</code>) . El siguiente cÃ³digo, por ejemplo, devuelve una referencia
a un fichero en nuestro disco:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span class="tok-nd">@Path</span><span class="tok-o">(</span><span class="tok-s">&quot;/fichero&quot;</span><span class="tok-o">)</span>
<span class="tok-kd">public</span> <span class="tok-kd">class</span> <span class="tok-nc">FicheroServicio</span> <span class="tok-o">{</span>
  <span class="tok-kd">private</span> <span class="tok-kd">static</span> <span class="tok-kd">final</span> <span class="tok-n">String</span> <span class="tok-n">baseRuta</span> <span class="tok-o">=</span> <span class="tok-s">&quot;...&quot;</span><span class="tok-o">;</span>

  <span class="tok-nd">@GET</span>
  <span class="tok-nd">@Path</span><span class="tok-o">(</span><span class="tok-s">&quot;{rutafichero: .*}&quot;</span><span class="tok-o">)</span>
  <span class="tok-nd">@Produces</span><span class="tok-o">(</span><span class="tok-s">&quot;text/plain&quot;</span><span class="tok-o">)</span>
  <span class="tok-kd">public</span> <span class="tok-n">File</span> <span class="tok-nf">getFichero</span><span class="tok-o">(</span><span class="tok-nd">@PathParam</span><span class="tok-o">(</span><span class="tok-s">&quot;rutafichero&quot;</span><span class="tok-o">)</span>
                                 <span class="tok-n">String</span> <span class="tok-n">ruta</span><span class="tok-o">)</span> <span class="tok-o">{</span>
    <span class="tok-k">return</span> <span class="tok-k">new</span> <span class="tok-nf">File</span><span class="tok-o">(</span><span class="tok-n">baseRuta</span> <span class="tok-o">+</span> <span class="tok-n">ruta</span><span class="tok-o">);</span>
  <span class="tok-o">}</span>
<span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>En este caso inyectamos el valor de la ruta del fichero con la anotaciÃ³n <code>@PathParam</code>.
A partir de dicha ruta creamos un objeto <code>java.io.File</code> y lo devolvemos como cuerpo
del mensaje de respuesta. La implementaciÃ³n JAX-RS "leerÃ¡" la informaciÃ³n "abriendo"
un <code>InputStream</code> basado en esta referencia al fichero y la "escribirÃ¡" en un <em>buffer</em>.
Posteriormente y de forma incremental, volverÃ¡ a escribir el contenido del <em>buffer</em> en
el <em>stream</em> de salida de la respuesta. Al igual que en el ejemplo anterior, debemos
especificar la anotaciÃ³n @Produces para que JAX-RS sepa cÃ³mo "rellenar" la cabecera
<code>Content-Type</code> de la respuesta.</p>
</div>
<div class="paragraph">
<p>TambiÃ©n podemos inyectar instancias de <code>java.io.File</code> a partir del cuerpo del mensaje
de la peticiÃ³n. Por ejemplo:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span class="tok-nd">@POST</span>
<span class="tok-nd">@Path</span><span class="tok-o">(</span><span class="tok-s">&quot;/masdatos&quot;</span><span class="tok-o">)</span>
<span class="tok-kd">public</span> <span class="tok-kt">void</span> <span class="tok-nf">post</span><span class="tok-o">(</span><span class="tok-n">File</span> <span class="tok-n">fichero</span><span class="tok-o">)</span> <span class="tok-o">{</span>
    <span class="tok-n">Reader</span> <span class="tok-n">reader</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-nf">Reader</span><span class="tok-o">(</span><span class="tok-k">new</span> <span class="tok-nf">FileInputStream</span><span class="tok-o">(</span><span class="tok-n">fichero</span><span class="tok-o">));</span>
    <span class="tok-n">LineNumberReader</span> <span class="tok-n">lineReader</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-nf">LineNumberReader</span><span class="tok-o">(</span><span class="tok-n">reader</span><span class="tok-o">);</span>
    <span class="tok-k">do</span><span class="tok-o">{</span>
      <span class="tok-n">String</span> <span class="tok-n">line</span> <span class="tok-o">=</span> <span class="tok-n">lineReader</span><span class="tok-o">.</span><span class="tok-na">readLine</span><span class="tok-o">();</span>
      <span class="tok-k">if</span> <span class="tok-o">(</span><span class="tok-n">line</span> <span class="tok-o">!=</span> <span class="tok-kc">null</span><span class="tok-o">)</span> <span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">out</span><span class="tok-o">.</span><span class="tok-na">println</span><span class="tok-o">(</span><span class="tok-n">line</span><span class="tok-o">);</span>
    <span class="tok-o">}</span> <span class="tok-k">while</span> <span class="tok-o">(</span><span class="tok-n">line</span> <span class="tok-o">!=</span> <span class="tok-kc">null</span><span class="tok-o">);</span>
<span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>En este caso la implementaciÃ³n de JAX-RS crea un fichero temporal en el disco
para la entrada. Lee la informaciÃ³n desde el <em>buffer</em> de la red y guarda los
<em>bytes</em> leÃ­dos en este fichero temporal. En el ejemplo, los datos leÃ­dos desde
la red estÃ¡n representados por el el objeto File inyectado por el <em>runtime</em> de JAX-RS (recuerda
que sÃ³lo puede haber un parÃ¡metro sin anotaciones en los mÃ©todos del recurso y
que Ã©ste representa el cuerpo del mensaje de la peticiÃ³n HTTP). A continuaciÃ³n,
el mÃ©todo <code>post()</code> crea un <code>java.io.FileInputStream</code> a partir del objeto <code>File</code>
inyectado. Finalmente utilizamos Ã©ste <em>stream</em> de entrada para crear un objeto
<code>LineNumberReader</code> y mostrar los datos por la consola.</p>
</div>
</div>
<div class="sect3">
<h4 id="_byte">3.2.4. byte[]</h4>
<div class="paragraph">
<p>Podemos utilizar un array de bytes como <strong>entrada y salida</strong> para cualquier tipo
especificado como <em>media-type</em>. A continuaciÃ³n mostramos un ejemplo:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span class="tok-nd">@Path</span><span class="tok-o">(</span><span class="tok-s">&quot;/&quot;</span><span class="tok-o">)</span>
<span class="tok-kd">public</span> <span class="tok-kd">class</span> <span class="tok-nc">MiServicio</span> <span class="tok-o">{</span>
   <span class="tok-nd">@GET</span>
   <span class="tok-nd">@Produces</span><span class="tok-o">(</span><span class="tok-s">&quot;text/plain&quot;</span><span class="tok-o">)</span>
   <span class="tok-kd">public</span> <span class="tok-kt">byte</span><span class="tok-o">[]</span> <span class="tok-nf">get</span><span class="tok-o">()</span> <span class="tok-o">{</span>
         <span class="tok-k">return</span> <span class="tok-s">&quot;hello world&quot;</span><span class="tok-o">.</span><span class="tok-na">getBytes</span><span class="tok-o">();</span>
   <span class="tok-o">}</span>

   <span class="tok-nd">@POST</span>
   <span class="tok-nd">@Consumes</span><span class="tok-o">(</span><span class="tok-s">&quot;text/plain&quot;</span><span class="tok-o">)</span>
   <span class="tok-kd">public</span> <span class="tok-kt">void</span> <span class="tok-nf">post</span><span class="tok-o">(</span><span class="tok-kt">byte</span><span class="tok-o">[]</span> <span class="tok-n">bytes</span><span class="tok-o">)</span> <span class="tok-o">{</span>
       <span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">out</span><span class="tok-o">.</span><span class="tok-na">println</span><span class="tok-o">(</span><span class="tok-k">new</span> <span class="tok-nf">String</span><span class="tok-o">(</span><span class="tok-n">bytes</span><span class="tok-o">));</span> <span class="tok-o">}</span>
   <span class="tok-o">}</span>
<span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Para cualquier mÃ©todo de recurso JAX-RS que devuelva un array de bytes, debemos
especificar la anotaciÃ³n @Produces para que JAX-RS sepa quÃ© valor asignar a la
cabecera <code>Content-Type</code>.</p>
</div>
</div>
<div class="sect3">
<h4 id="_string_char">3.2.5. String, char[]</h4>
<div class="paragraph">
<p>La mayor parte de formatos en internet estÃ¡n basados en texto. JAX-RS puede convertir
cualquier formato basado en texto a un <code>String</code> o a cualquier array de caracteres. Por
ejemplo:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span class="tok-nd">@Path</span><span class="tok-o">(</span><span class="tok-s">&quot;/&quot;</span><span class="tok-o">)</span>
<span class="tok-kd">public</span> <span class="tok-kd">class</span> <span class="tok-nc">MiServicio</span> <span class="tok-o">{</span>
  <span class="tok-nd">@GET</span>
  <span class="tok-nd">@Produces</span><span class="tok-o">(</span><span class="tok-s">&quot;application/xml&quot;</span><span class="tok-o">)</span>
  <span class="tok-kd">public</span> <span class="tok-n">String</span> <span class="tok-nf">get</span><span class="tok-o">()</span> <span class="tok-o">{</span>
    <span class="tok-k">return</span> <span class="tok-s">&quot;&lt;customer&gt;&lt;name&gt;Sergio Garcia&lt;/name&gt;&lt;/customer&gt;&quot;</span><span class="tok-o">;</span>
  <span class="tok-o">}</span>

  <span class="tok-nd">@POST</span>
  <span class="tok-nd">@Consumes</span><span class="tok-o">(</span><span class="tok-s">&quot;text/plain&quot;</span><span class="tok-o">)</span>
  <span class="tok-kd">public</span> <span class="tok-kt">void</span> <span class="tok-nf">post</span><span class="tok-o">(</span><span class="tok-n">String</span> <span class="tok-n">str</span><span class="tok-o">)</span> <span class="tok-o">{</span>
    <span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">out</span><span class="tok-o">.</span><span class="tok-na">println</span><span class="tok-o">(</span><span class="tok-n">str</span><span class="tok-o">);</span>
  <span class="tok-o">}</span>
<span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Para cualquier mÃ©todo de recurso JAX-RS que devuelva un <code>Sring</code> o un array de caracteres
debemos especificar la anotaciÃ³n <code>@Produces</code> para que JAX-RS sepa que valor asignar a la
cabecera <code>Content-Type</code>.</p>
</div>
</div>
<div class="sect3">
<h4 id="_multivaluedmap_string_string_y_formularios_de_entrada">3.2.6. MultivaluedMap&lt;String, String&gt; y formularios de entrada</h4>
<div class="paragraph">
<p>Los formularios HTML son usados habitualmente para enviar datos a servidores web.
Los datos del formulario estÃ¡n codificados con el <em>media type</em> <code>application/x-www-form-urlencoded</code>.
Ya hemos visto como utilizar la anotaciÃ³n <code>@FormParam</code> para inyectar parÃ¡metros individuales
de un formulario de las peticiones de entrada. TambiÃ©n podremos inyectar una instancia de
<code>MultivaluedMap&lt;String, String&gt;</code>, que representa todos los datos del formulario enviado
en la peticiÃ³n. Por ejemplo:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span class="tok-nd">@Path</span><span class="tok-o">(</span><span class="tok-s">&quot;/&quot;</span><span class="tok-o">)</span>
  <span class="tok-kd">public</span> <span class="tok-kd">class</span> <span class="tok-nc">MiServicio</span> <span class="tok-o">{</span>
    <span class="tok-nd">@POST</span> <span class="tok-nd">@Consumes</span><span class="tok-o">(</span><span class="tok-s">&quot;application/x-www-form-urlencoded&quot;</span><span class="tok-o">)</span>
    <span class="tok-nd">@Produces</span><span class="tok-o">(</span><span class="tok-s">&quot;application/x-www-form-urlencoded&quot;</span><span class="tok-o">)</span>
    <span class="tok-kd">public</span> <span class="tok-n">MultivaluedMap</span><span class="tok-o">&lt;</span><span class="tok-n">String</span><span class="tok-o">,</span><span class="tok-n">String</span><span class="tok-o">&gt;</span> <span class="tok-nf">post</span><span class="tok-o">(</span>
                       <span class="tok-n">MultivaluedMap</span><span class="tok-o">&lt;</span><span class="tok-n">String</span><span class="tok-o">,</span> <span class="tok-n">String</span><span class="tok-o">&gt;</span> <span class="tok-n">form</span><span class="tok-o">)</span> <span class="tok-o">{</span>
        <span class="tok-c1">//el formulario tiene los campos &quot;fieldName1&quot; y &quot;fieldName2&quot;</span>
        <span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">out</span><span class="tok-o">.</span><span class="tok-na">println</span><span class="tok-o">(</span><span class="tok-n">form</span><span class="tok-o">.</span><span class="tok-na">getFirst</span><span class="tok-o">(</span><span class="tok-s">&quot;fieldName1&quot;</span><span class="tok-o">));</span>
        <span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">out</span><span class="tok-o">.</span><span class="tok-na">println</span><span class="tok-o">(</span><span class="tok-n">form</span><span class="tok-o">.</span><span class="tok-na">getFirst</span><span class="tok-o">(</span><span class="tok-s">&quot;fieldName2&quot;</span><span class="tok-o">));</span>
        <span class="tok-k">return</span> <span class="tok-n">form</span><span class="tok-o">;</span> <span class="tok-o">}</span>
<span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>En este cÃ³digo, nuestro mÃ©todo <code>post()</code> acepta peticiones POST y recibe un
<code>MultivaluedMap&lt;String,String&gt;</code> que contiene todos los datos de nuestro formulario.
En este caso tambiÃ©n devolvemos una instancia de un formulario como respuesta.</p>
</div>
<div class="paragraph">
<p>Los datos del formulario pueden representarse en el cuerpo de la petciÃ³n como pares
<code>nombre=valor</code> separados por <code>&amp;</code>. Por ejemplo:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>fieldName1=valor%20con%20espacios&amp;fielName2=otroValor</pre>
</div>
</div>
<div class="paragraph">
<p>Los espacios en blanco se codifican como <code>%20</code>. No es necesario poner comillas.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_mÃºltiples_representaciones_de_recursos">3.3. MÃºltiples representaciones de recursos</h3>
<div class="paragraph">
<p>Por defecto, un recurso RESTful se produce o consume con el tipo MIME "/". Un
recurso RESTful puede restringir los <em>media types</em> que soporta, tanto en la peticiÃ³n
como en la respuesta, utilizando las anotaciones @Consumes y @Produces, respectivamente.
Estas anotaciones pueden especificarse, como ya hemos visto, a nivel de clase o de
mÃ©todo de recurso. Las anotaciones especificadas sobre el mÃ©todo prevalecen sobre
las de la clase. La ausencia de estas anotaciones es equivalente a su inclusiÃ³n
con el tipo MIME <em>("<strong>/</strong>")</em>, es decir, su ausencia implica que se soporta cualquier tipo.</p>
</div>
<div class="paragraph">
<p>A continuaciÃ³n mostramos un ejemplo en el que un <em>Pedido</em> puede "producirse" tanto
en formato xml como en formato json:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span class="tok-nd">@GET</span>
<span class="tok-nd">@Path</span><span class="tok-o">(</span><span class="tok-s">&quot;{id}&quot;</span><span class="tok-o">)</span>
<span class="tok-nd">@Produces</span><span class="tok-o">({</span><span class="tok-s">&quot;application/xml&quot;</span><span class="tok-o">,</span> <span class="tok-s">&quot;application/json&quot;</span><span class="tok-o">})</span>
<span class="tok-kd">public</span> <span class="tok-n">Pedido</span> <span class="tok-nf">getPedido</span><span class="tok-o">(</span><span class="tok-nd">@PathParam</span><span class="tok-o">(</span><span class="tok-s">&quot;id&quot;</span><span class="tok-o">)</span><span class="tok-kt">int</span> <span class="tok-n">id</span><span class="tok-o">)</span> <span class="tok-o">{</span> <span class="tok-o">.</span> <span class="tok-o">.</span> <span class="tok-o">.</span> <span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>El mÃ©todo <em>getPedido()</em> puede generar ambas representaciones para el pedido. El
tipo exacto de la respuesta viene determinado por la cabecera HTTP <strong>Accept</strong> de
la peticiÃ³n.</p>
</div>
<div class="paragraph">
<p>Otro ejemplo, en el que pueden "consumirse" varios tipos MIME, puede ser el siguiente:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span class="tok-nd">@POST</span>
<span class="tok-nd">@Path</span><span class="tok-o">(</span><span class="tok-s">&quot;{id}&quot;</span><span class="tok-o">)</span>
<span class="tok-nd">@Consumes</span><span class="tok-o">({</span><span class="tok-s">&quot;application/xml&quot;</span><span class="tok-o">,</span> <span class="tok-s">&quot;application/json&quot;</span><span class="tok-o">})</span>
<span class="tok-kd">public</span> <span class="tok-n">Pedido</span> <span class="tok-nf">addPedido</span><span class="tok-o">(</span><span class="tok-nd">@PathParam</span><span class="tok-o">(</span><span class="tok-s">&quot;id&quot;</span><span class="tok-o">)</span><span class="tok-kt">int</span> <span class="tok-n">id</span><span class="tok-o">)</span> <span class="tok-o">{</span> <span class="tok-o">.</span> <span class="tok-o">.</span> <span class="tok-o">.</span> <span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>En este caso el formato "consumido" vendrÃ¡ dado por el valor de la cabecera HTTP
<strong>Content-Type</strong> de la peticiÃ³n.</p>
</div>
<div class="paragraph">
<p>JAX-RS 2.0 nos permite indicar la preferencia por un <em>media type</em>, en el lado del
servidor, utilizando el parÃ¡metro <strong>qs</strong> (<strong>q</strong>uality on <strong>s</strong>ervice). <strong>qs</strong> toma
valores entre 0.000 y 1.000, e indica la calidad relativa de una representaciÃ³n
comparado con el resto de representaciones disponibles. Una representaciÃ³n con un
valor de <em>qs</em> de 0.000 nunca serÃ¡ elegido. Una representaciÃ³n sin valor para el parÃ¡metro
<em>qs</em> se asume que dicho valor es 1.000</p>
</div>
<div class="paragraph">
<p>Ejemplo:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span class="tok-nd">@POST</span>
<span class="tok-nd">@Path</span><span class="tok-o">(</span><span class="tok-s">&quot;{id}&quot;</span><span class="tok-o">)</span>
<span class="tok-nd">@Consumes</span><span class="tok-o">({</span><span class="tok-s">&quot;application/xml; qs=0.75&quot;</span><span class="tok-o">,</span> <span class="tok-s">&quot;application/json; qs=1&quot;</span><span class="tok-o">})</span>
<span class="tok-kd">public</span> <span class="tok-n">Pedido</span> <span class="tok-nf">addPedido</span><span class="tok-o">(</span><span class="tok-nd">@PathParam</span><span class="tok-o">(</span><span class="tok-s">&quot;id&quot;</span><span class="tok-o">)</span><span class="tok-kt">int</span> <span class="tok-n">id</span><span class="tok-o">)</span> <span class="tok-o">{</span> <span class="tok-o">.</span> <span class="tok-o">.</span> <span class="tok-o">.</span> <span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Si un cliente realiza una peticiÃ³n y no manifiesta ninguna preferencia por ninguna
representaciÃ³n en particular, o con una cabecera <strong>Accept</strong> con valor <em>application/*</em>,
entonces el servidor seleccionarÃ¡ la representaciÃ³n con el valor de <em>qs</em> mÃ¡s alto
(en este caso <em>application/json</em>). Los valores de <em>qs</em> son relativos, y como tales,
solamente son comparables con otros valores <em>qs</em> dentro de la misma instancia de
la anotaciÃ³n @Consumes (o @Produces).</p>
</div>
<div class="paragraph">
<p>Los clientes pueden indicar tambiÃ©n sus preferencias utilizando otro factor relativo
de calidad, en forma de parÃ¡metro denominado <strong>q</strong>. El valor del parÃ¡metro <strong>q</strong> se
utiliza para ordenar el conjunto de tipos aceptados. <strong>q</strong> toma
valores entre 0.000 y 1.000 (mÃ¡xima preferencia). Al igual que antes, Los valores de
<em>q</em> son relativos, y como tales,
solamente son comparables con otros valores <em>q</em> dentro de la misma cabecera <em>Accept</em>
o <em>Content-type</em>.</p>
</div>
<div class="admonitionblock caution">
<table>
<tr>
<td class="icon">
<i class="fa icon-caution" title="Caution"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Las preferencias del servidor (valores de los parÃ¡metros <strong>qs</strong>) sÃ³lo se tienen en
cuenta si el cliente acepta mÃºltiples <em>media types</em> con el <strong>mismo valor de q</strong></p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Veamos un ejemplo:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span class="tok-nd">@GET</span>
<span class="tok-nd">@Path</span><span class="tok-o">(</span><span class="tok-s">&quot;{id}&quot;</span><span class="tok-o">)</span>
<span class="tok-nd">@Produces</span><span class="tok-o">({</span><span class="tok-s">&quot;application/xml&quot;</span><span class="tok-o">;</span> <span class="tok-n">qs</span><span class="tok-o">=</span><span class="tok-mi">1</span><span class="tok-o">,</span>
           <span class="tok-s">&quot;application/json&quot;</span><span class="tok-o">;</span> <span class="tok-n">qs</span><span class="tok-o">=</span><span class="tok-mf">0.75</span><span class="tok-o">})</span>
<span class="tok-kd">public</span> <span class="tok-n">Pedido</span> <span class="tok-nf">getPedido</span><span class="tok-o">(</span><span class="tok-nd">@PathParam</span><span class="tok-o">(</span><span class="tok-s">&quot;id&quot;</span><span class="tok-o">)</span><span class="tok-kt">int</span> <span class="tok-n">id</span><span class="tok-o">)</span> <span class="tok-o">{</span> <span class="tok-o">.</span> <span class="tok-o">.</span> <span class="tok-o">.</span> <span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Supongamos que un cliente lanza una petciÃ³n GET con una valor para la cabecera
<strong>Accept</strong> de <em>application/*; q=0.5, text/html</em>. En este caso, el servidor determina
que los tipos MIME <em>application/xml</em> y <em>application/json</em> tienen la misma preferencia
por parte del cliente (con valor de 0.5), por lo tanto, el servidor elegirÃ¡ la
representaciÃ³n <em>application/json</em>, ya que tiene un valor de <em>qs</em> mayor.</p>
</div>
</div>
<div class="sect2">
<h3 id="_introducciÃ³n_a_jaxb">3.4. IntroducciÃ³n a JAXB</h3>
<div class="paragraph">
<p>JAXB (<strong>J</strong>ava <strong>A</strong>rchitecture for <strong>X</strong>ML <strong>B</strong>inding) es una especificaciÃ³n Java antigua
(<a href="https://jcp.org/aboutJava/communityprocess/mrel/jsr222/index2.html">JSR 222</a>)
y no estÃ¡ definida por JAX-RS. JAXB es un <em>framework</em> de anotaciones que mapea clases
Java a XML y esquemas XML. Es extremadamente Ãºtil debido a que, en lugar de interactuar
con una representaciÃ³n abstracta de un documento XML, podemos trabajar con objetos
Java reales que estÃ¡n mÃ¡s cercanos al dominio que estamos modelando. JAX-RS proporciona
soporte para JAXB, pero antes de revisar los manejadores de contenidos JAXB incuidos
con JAX-RS, veamos una pequeÃ±a introducciÃ³n al <em>framework</em> JAXB.</p>
</div>
<div class="paragraph">
<p>Como ya hemos dicho, si queremos mapear una clase Java existente a XML, podemos utilizar
JAXB, a travÃ©s de un conjunto de anotaciones. VeÃ¡moslo mejor con un ejemplo:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span class="tok-nd">@XmlRootElement</span><span class="tok-o">(</span><span class="tok-n">name</span><span class="tok-o">=</span><span class="tok-s">&quot;cliente&quot;</span><span class="tok-o">)</span>
<span class="tok-nd">@XmlAccessorType</span><span class="tok-o">(</span><span class="tok-n">XmlAccessType</span><span class="tok-o">.</span><span class="tok-na">FIELD</span><span class="tok-o">)</span>
<span class="tok-kd">public</span> <span class="tok-kd">class</span> <span class="tok-nc">Cliente</span> <span class="tok-o">{</span>
    <span class="tok-nd">@XmlAttribute</span>
    <span class="tok-kd">protected</span> <span class="tok-kt">int</span> <span class="tok-n">id</span><span class="tok-o">;</span>

    <span class="tok-nd">@XmlElement</span>
    <span class="tok-kd">protected</span> <span class="tok-n">String</span> <span class="tok-n">nombre</span><span class="tok-o">;</span>

    <span class="tok-kd">public</span> <span class="tok-nf">Customer</span><span class="tok-o">()</span> <span class="tok-o">{}</span>

    <span class="tok-kd">public</span> <span class="tok-kt">int</span> <span class="tok-nf">getId</span><span class="tok-o">()</span> <span class="tok-o">{</span> <span class="tok-k">return</span> <span class="tok-k">this</span><span class="tok-o">.</span><span class="tok-na">id</span><span class="tok-o">;</span> <span class="tok-o">}</span>
    <span class="tok-kd">public</span> <span class="tok-kt">void</span> <span class="tok-nf">setId</span><span class="tok-o">(</span><span class="tok-kt">int</span> <span class="tok-n">id</span><span class="tok-o">)</span> <span class="tok-o">{</span> <span class="tok-k">this</span><span class="tok-o">.</span><span class="tok-na">id</span> <span class="tok-o">=</span> <span class="tok-n">id</span><span class="tok-o">;</span> <span class="tok-o">}</span>

    <span class="tok-kd">public</span> <span class="tok-n">String</span> <span class="tok-nf">getNombre</span><span class="tok-o">()</span> <span class="tok-o">{</span> <span class="tok-k">return</span> <span class="tok-k">this</span><span class="tok-o">.</span><span class="tok-na">nombre</span><span class="tok-o">;</span> <span class="tok-o">}</span>
    <span class="tok-kd">public</span> <span class="tok-kt">void</span> <span class="tok-nf">setNombre</span><span class="tok-o">(</span><span class="tok-n">String</span> <span class="tok-n">nombre</span><span class="tok-o">}</span> <span class="tok-o">{</span> <span class="tok-k">this</span><span class="tok-o">.</span><span class="tok-na">nombre</span> <span class="tok-o">=</span> <span class="tok-n">nombre</span><span class="tok-o">;</span> <span class="tok-o">}</span>
<span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>La anotaciÃ³n <code>@javax.xml.bind.annotation.XmlRootElement</code> se utiliza en clases java
para denotar que representan elementos XML (etiqueta XML raÃ­z). En este caso estamos
diciendo que la clase Java representa un documento XML que tiene como etiqueta raÃ­z
<code>&lt;cliente&gt;</code>. Las clases java anotadas con <code>@XmlRootElement</code> se denomina
<code>beans JAXB</code>.</p>
</div>
<div class="paragraph">
<p>La anotaciÃ³n <code>@javax.xml.bind.annotation.XmlAttribute</code> la hemos asociado al campo
<code>id</code> de nuestra clase <code>Cliente</code>. Esta anotaciÃ³n indica que el campo <code>id</code> de la clase debe
mapearse como el atributo <code>id</code> del elemento raÃ­z <code>&lt;cliente&gt;</code> del documento XML.
La anotaciÃ³n <code>@XmlAttribute</code> tiene un atributo <code>name</code>, de forma que podemos especificar
el nombre exacto del atributo XML dentro del documento. Por defecto, tiene el mismo
nombre que el campo anotado.</p>
</div>
<div class="paragraph">
<p>Hemos utilizado la anotaciÃ³n <code>@javax.xml.bind.annotation.XmlElement</code> en el campo
<code>nombre</code> de la clase <code>Cliente</code>. Esta anotaciÃ³n indica a JAXB que debe mapearse el
campo <code>nombre</code> como el elemento <code>&lt;nombre&gt;</code> anidado en la etiqueta raÃ­z <code>&lt;cliente&gt;</code>.
Igual que antes, podemos especificar el nombre concreto del elememto XML. Por defecto
toma el mismo nombre que el correspondiente campo anotado.</p>
</div>
<div class="paragraph">
<p>La anotaciÃ³n <code>@javax.xml.bind.annotation.XmlAccessorType</code> permite controlar la
serializaciÃ³n por defecto de los atributos de la clase. Esta anotaciÃ³n sÃ³lo puede
ser usada conjuntamente con <code>@XmlRootElement</code> (y alguna otra anotaciÃ³n que no mostramos
aquÃ­). Hemos usado como valor <code>XmlAccessType.FIELD</code>, lo que significa que
por defecto se deben serializar <strong>todos</strong> los <strong>campos</strong> (<em>fields</em>) de la clase (estÃ©n anotados o no), y
las <strong>propiedades</strong> (<em>properties</em>) de la clase que tengan anotaciones JAXB (a menos que la anotaciÃ³n sea
<em>@XMLTransient</em>).</p>
</div>
<div class="paragraph">
<p>Si alguno de los <strong>campos</strong> de la clase no tiene anotaciones JAXB asociadas, por defecto
se serializarÃ¡n como <em>elementos</em> (<em>etiquetas</em>) en el documento XML correspondiente.
SegÃºn la <a href="https://jaxb.java.net/nonav/2.2.6/docs/api/">documentaciÃ³n</a> de JAXB,
un <em>campo</em> es una variable de instancia no estÃ¡tica (normalmente privada).</p>
</div>
<div class="paragraph">
<p>Las <strong>propiedades</strong> de la clase vienen dadas por las combinaciones getter/setter de
los atributos de la clase.
El cÃ³digo anterior tiene dos propiedades "nombre" (dado por el par <em>getNombre</em>/setNombre_)
e "id" (par <em>getId</em>/<em>setId</em>). Normalmente se anotan los mÃ©todos <em>getter</em>. Dichas
propiedades no estÃ¡n anotadas, por lo que JAXB no las serializarÃ¡.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Al proceso de serializar (convertir) un objeto Java en un documento XML se le
  denomina <strong>marshalling</strong>. El proceso inverso, la conversiÃ³n de XML a objetos Java
  se denomina <strong>unmarshalling</strong>.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Con las anotaciones anteriores, un ejemplo de una instancia de nuestra clase <code>Cliente</code>
con un <code>id</code> de 42, y el valor de <code>nombre</code> <code>Pablo Martinez</code>, tendrÃ­a el siguiente
aspecto:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><span class="tok-nt">&lt;cliente</span> <span class="tok-na">id=</span><span class="tok-s">&quot;42&quot;</span><span class="tok-nt">&gt;</span>
     <span class="tok-nt">&lt;nombreCompleto&gt;</span>Pablo Martinez<span class="tok-nt">&lt;/nombreCompleto&gt;</span>
<span class="tok-nt">&lt;/cliente&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Observamos que se han serializado los campos (variables de instancia de la clase).</p>
</div>
<div class="paragraph">
<p>Si no especificamos la anotaciÃ³n <code>@XmlAccessorType</code>, por defecto se utilizarÃ¡:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>@XmlAccessorType(XmlAccessType.PUBLIC_MEMBER)</pre>
</div>
</div>
<div class="paragraph">
<p>El valor <code>XmlAccessType.PUBLIC_MEMBER</code> indica a JAXB que se deben serializar todos
los campos pÃºblicos de la clase, todos los campos anotados, y todas las propiedades
(pares <em>getter/setter</em>), a menos que estÃ©n anotadas con <em>@XMLTransient</em>.</p>
</div>
<div class="paragraph">
<p>TambiÃ©n podrÃ­amos utilizar:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>@XmlAccessorType(XmlAccessType.NONE)</pre>
</div>
</div>
<div class="paragraph">
<p>En este caso, la anotaciÃ³n <code>XmlAccessType.NONE</code> indica sÃ³lo se deben serializar aquellas
propiedades y/o campos de la clase que estÃ©n anotados.</p>
</div>
<div class="paragraph">
<p>A continuaciÃ³n indicamos, en forma de tabla, el uso de los diferentes <code>XmlAccessType</code>:</p>
</div>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 2. Valores utilizados para <code>@XmlAccessorType()</code>, conjuntamente con <code>@XmlRootElement()</code>:</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Valor</th>
<th class="tableblock halign-left valign-top">Significado</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">XmlAccessType.PUBLIC_MEMBER</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">SerializaciÃ³n por defecto si no se especifica <code>@XmlAccessorType()</code>. Serializa las
propiedades (pares <em>getter/setter</em>) y campos pÃºblicos, a menos que estÃ©n anotados
con <code>@XMLTransient</code>. Si algÃºn campo no pÃºblico estÃ¡ anotado, tambiÃ©n se serializa.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">XmlAccessType.FIELD</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Serializa todos los campos (pÃºblicos o privados) a menos que estÃ©n anotados con <code>@XMLTransient</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">XmlAccessType.NONE</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Solamente serializa aquellos campos y propiedades que estÃ©n anotadas con anotaciones
JAXB</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">XmlAccessType.PROPERTY</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Serializa cada par <em>getter/setter</em>, a menos que estÃ©n anotados con <code>@XMLTransient</code>.
Si algÃºn
campo (no pÃºblico) estÃ¡ anotado tambiÃ©n se serializa</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Podemos utilizar la anotaciÃ³n <code>@XmlElement</code> para anidar otras clases anotadas con JAXB.
Por ejemplo, supongamos que queremos aÃ±adir una clase <code>Direccion</code> a nuestra clase <code>Cliente</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span class="tok-nd">@XmlRootElement</span><span class="tok-o">(</span><span class="tok-n">name</span><span class="tok-o">=</span><span class="tok-s">&quot;direccion&quot;</span><span class="tok-o">)</span>
<span class="tok-nd">@XmlAccessorType</span><span class="tok-o">(</span><span class="tok-n">XmlAccessType</span><span class="tok-o">.</span><span class="tok-na">FIELD</span><span class="tok-o">)</span>
<span class="tok-kd">public</span> <span class="tok-kd">class</span> <span class="tok-nc">Direccion</span> <span class="tok-o">{</span>
  <span class="tok-nd">@XmlElement</span>
  <span class="tok-kd">protected</span> <span class="tok-n">String</span> <span class="tok-n">calle</span><span class="tok-o">;</span>

  <span class="tok-nd">@XmlElement</span>
  <span class="tok-kd">protected</span> <span class="tok-n">String</span> <span class="tok-n">cludad</span><span class="tok-o">;</span>

  <span class="tok-nd">@XmlElement</span>
  <span class="tok-kd">protected</span> <span class="tok-n">String</span> <span class="tok-n">codPostal</span><span class="tok-o">;</span>

  <span class="tok-c1">// getters y setters</span>
  <span class="tok-o">...</span>
<span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Simplemente tendrÃ­amos que aÃ±adir el campo de tipo <code>Direccion</code> a nuestra clase Cliente,
 de la siguiente forma:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span class="tok-nd">@XmlRootElement</span><span class="tok-o">(</span><span class="tok-n">name</span><span class="tok-o">=</span><span class="tok-s">&quot;cliente&quot;</span><span class="tok-o">)</span>
<span class="tok-nd">@XmlAccessorType</span><span class="tok-o">(</span><span class="tok-n">XmlAccessType</span><span class="tok-o">.</span><span class="tok-na">FIELD</span><span class="tok-o">)</span>
<span class="tok-kd">public</span> <span class="tok-kd">class</span> <span class="tok-nc">Cliente</span> <span class="tok-o">{</span>
    <span class="tok-nd">@XmlAttribute</span>
    <span class="tok-kd">protected</span> <span class="tok-kt">int</span> <span class="tok-n">id</span><span class="tok-o">;</span>

    <span class="tok-nd">@XmlElement</span>
    <span class="tok-kd">protected</span> <span class="tok-n">String</span> <span class="tok-n">nombreCompleto</span><span class="tok-o">;</span>

    <span class="tok-nd">@XmlElement</span>
    <span class="tok-kd">protected</span> <span class="tok-n">Direccion</span> <span class="tok-n">direccion</span><span class="tok-o">;</span>

    <span class="tok-kd">public</span> <span class="tok-nf">Customer</span><span class="tok-o">()</span> <span class="tok-o">{}</span>

    <span class="tok-c1">// getters y setters</span>
    <span class="tok-o">...</span>
<span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>En este caso, una instancia de un <code>Cliente</code> con valores <code>id</code>=56, <code>nombre</code>="Ricardo Lopez",
<code>calle</code>="calle del oso, 35", <code>ciudad</code>="Alicante", y <code>cÃ³digo_postal</code>="01010", serÃ­a serializado
 como:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"> <span class="tok-nt">&lt;cliente</span> <span class="tok-na">id=</span><span class="tok-s">&quot;56&quot;</span><span class="tok-nt">&gt;</span>
    <span class="tok-nt">&lt;nombre&gt;</span>Ricardo Lopez<span class="tok-nt">&lt;/nombre&gt;</span>
    <span class="tok-nt">&lt;direccion&gt;</span>
       <span class="tok-nt">&lt;calle&gt;</span>calle del oso, 35<span class="tok-nt">&lt;/calle&gt;</span>
       <span class="tok-nt">&lt;ciudad&gt;</span>Alicante<span class="tok-nt">&lt;/ciudad&gt;</span>
       <span class="tok-nt">&lt;codPostal&gt;</span>01010<span class="tok-nt">&lt;/codPostal&gt;</span>
    <span class="tok-nt">&lt;/direccion&gt;</span>
 <span class="tok-nt">&lt;/cliente&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Veamos otro ejemplo. Supongamos que tenemos el recurso <code>EstadoResource</code>, con mÃ©todos
que responden a peticiones http GET y PUT:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span class="tok-nd">@Path</span><span class="tok-o">(</span><span class="tok-s">&quot;/estado&quot;</span><span class="tok-o">)</span>
<span class="tok-kd">public</span> <span class="tok-kd">class</span> <span class="tok-nc">EstadoResource</span> <span class="tok-o">{</span>

    <span class="tok-kd">private</span> <span class="tok-kd">static</span> <span class="tok-n">EstadoBean</span> <span class="tok-n">estadoBean</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-nf">EstadoBean</span><span class="tok-o">();</span>

    <span class="tok-nd">@GET</span>
    <span class="tok-nd">@Produces</span><span class="tok-o">(</span><span class="tok-s">&quot;application/xml&quot;</span><span class="tok-o">)</span>
    <span class="tok-kd">public</span> <span class="tok-n">EstadoBean</span> <span class="tok-nf">getEstado</span><span class="tok-o">()</span> <span class="tok-o">{</span>
        <span class="tok-k">return</span> <span class="tok-n">estadoBean</span><span class="tok-o">;</span>
    <span class="tok-o">}</span>

    <span class="tok-nd">@PUT</span>
    <span class="tok-nd">@Consumes</span><span class="tok-o">(</span><span class="tok-s">&quot;application/xml&quot;</span><span class="tok-o">)</span>
    <span class="tok-kd">public</span> <span class="tok-kt">void</span> <span class="tok-nf">setEstado</span><span class="tok-o">(</span><span class="tok-n">EstadoBean</span> <span class="tok-n">estado</span><span class="tok-o">)</span> <span class="tok-o">{</span>
       <span class="tok-k">this</span><span class="tok-o">.</span><span class="tok-na">estadoBean</span> <span class="tok-o">=</span> <span class="tok-n">estado</span><span class="tok-o">;</span>
    <span class="tok-o">}</span>
<span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>En este caso, la clase <code>EstadoBean</code> debe utilizar anotaciones JAXB para poder ser
convertida automÃ¡ticamente por el <em>runtime</em> de JAX-RS en un documento XML, y viceversa:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span class="tok-nd">@XmlRootElement</span><span class="tok-o">(</span><span class="tok-n">name</span> <span class="tok-o">=</span> <span class="tok-s">&quot;estadoImpresora&quot;</span><span class="tok-o">)</span>
<span class="tok-kd">public</span> <span class="tok-kd">class</span> <span class="tok-nc">EstadoBean</span> <span class="tok-o">{</span>

   <span class="tok-kd">public</span> <span class="tok-n">String</span> <span class="tok-n">estado</span> <span class="tok-o">=</span> <span class="tok-s">&quot;Idle&quot;</span><span class="tok-o">;</span>
   <span class="tok-kd">public</span> <span class="tok-kt">int</span> <span class="tok-n">tonerRestante</span> <span class="tok-o">=</span> <span class="tok-mi">25</span><span class="tok-o">;</span>
   <span class="tok-kd">public</span> <span class="tok-n">List</span><span class="tok-o">&lt;</span><span class="tok-n">TareaBean</span><span class="tok-o">&gt;</span> <span class="tok-n">tareas</span> <span class="tok-o">=</span>
             <span class="tok-k">new</span> <span class="tok-n">ArrayList</span><span class="tok-o">&lt;</span><span class="tok-n">TareaBean</span><span class="tok-o">&gt;();</span>
<span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Por defecto, la anotaciÃ³n <code>@XmlRootElement</code> realiza la serializaciÃ³n de la clase
<code>EstadoBean</code> en formato xml utilizando los campos pÃºblicos y propiedades definidas
en la clase (<code>estado</code>, <code>tonerRestante</code>, y <code>tareas</code>).
Vemos que el campo tareas, a su vez, es una colecciÃ³n de elementos de tipo <code>TareaBean</code>,
que tambiÃ©n necesitan ser serializados. A continuaciÃ³n mostramos la implementaciÃ³n de la clase
<code>TareaBean.java</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span class="tok-nd">@XmlRootElement</span><span class="tok-o">(</span><span class="tok-n">name</span> <span class="tok-o">=</span> <span class="tok-s">&quot;tarea&quot;</span><span class="tok-o">)</span>
<span class="tok-kd">public</span> <span class="tok-kd">class</span> <span class="tok-nc">TareaBean</span> <span class="tok-o">{</span>
   <span class="tok-kd">public</span> <span class="tok-n">String</span> <span class="tok-n">nombre</span><span class="tok-o">;</span>
   <span class="tok-kd">public</span> <span class="tok-n">String</span> <span class="tok-n">estado</span><span class="tok-o">;</span>
   <span class="tok-kd">public</span> <span class="tok-kt">int</span> <span class="tok-n">paginas</span><span class="tok-o">;</span>

   <span class="tok-kd">public</span> <span class="tok-nf">TareaBean</span><span class="tok-o">()</span> <span class="tok-o">{};</span> <i class="conum" data-value="1"></i><b>(1)</b>

   <span class="tok-kd">public</span> <span class="tok-nf">TareaBean</span><span class="tok-o">(</span><span class="tok-n">String</span> <span class="tok-n">nombre</span><span class="tok-o">,</span> <span class="tok-n">String</span> <span class="tok-n">estado</span><span class="tok-o">,</span>
                 <span class="tok-kt">int</span> <span class="tok-n">paginas</span><span class="tok-o">)</span> <span class="tok-o">{</span>
      <span class="tok-k">this</span><span class="tok-o">.</span><span class="tok-na">nombre</span> <span class="tok-o">=</span> <span class="tok-n">nombre</span><span class="tok-o">;</span>
      <span class="tok-k">this</span><span class="tok-o">.</span><span class="tok-na">estado</span> <span class="tok-o">=</span> <span class="tok-n">estado</span><span class="tok-o">;</span>
      <span class="tok-k">this</span><span class="tok-o">.</span><span class="tok-na">paginas</span> <span class="tok-o">=</span> <span class="tok-n">paginas</span><span class="tok-o">;</span>
   <span class="tok-o">}</span>
<span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Para serializar la clase, es necesario que la clase tenga un constructor sin parÃ¡metros</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Si accedemos al servicio anterior, nos devolverÃ¡ la informaciÃ³n sobre el estado de la siguiente forma
(resultado devuelto por el mÃ©todo <code>getEstado()</code>, anotado con @GET):</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><span class="tok-cp">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot; standalone=&quot;yes&quot;?&gt;</span>
<span class="tok-nt">&lt;estadoImpresora&gt;</span>
    <span class="tok-nt">&lt;estado&gt;</span>Idle<span class="tok-nt">&lt;/estado&gt;</span>
    <span class="tok-nt">&lt;tonerRestante&gt;</span>25<span class="tok-nt">&lt;/tonerRestante&gt;</span>
    <span class="tok-nt">&lt;tareas&gt;</span>
        <span class="tok-nt">&lt;nombre&gt;</span>texto.doc<span class="tok-nt">&lt;/nombre&gt;</span>
        <span class="tok-nt">&lt;estado&gt;</span>imprimiendo...<span class="tok-nt">&lt;/estado&gt;</span>
        <span class="tok-nt">&lt;paginas&gt;</span>13<span class="tok-nt">&lt;/paginas&gt;</span>
    <span class="tok-nt">&lt;/tareas&gt;</span>
    <span class="tok-nt">&lt;tareas&gt;</span>
        <span class="tok-nt">&lt;nombre&gt;</span>texto2.doc<span class="tok-nt">&lt;/nombre&gt;</span>
        <span class="tok-nt">&lt;estado&gt;</span>en espera...<span class="tok-nt">&lt;/estado&gt;</span>
        <span class="tok-nt">&lt;paginas&gt;</span>5<span class="tok-nt">&lt;/paginas&gt;</span>
    <span class="tok-nt">&lt;/tareas&gt;</span>
<span class="tok-nt">&lt;/estadoImpresora&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Podemos observar que se utiliza el elemento xml <em>&lt;tareas&gt;</em> para representar cada
una de las instancias de <em>TareaBean</em>, las cuales forman
parte de de la lista
del campo <em>tareas</em> de nuestra clase <em>EstadoBean</em>.</p>
</div>
<div class="paragraph">
<p>Vamos a usar las anotaciones <code>@XmlAttribute</code> y <code>@XmlElement</code> de la siguiente forma:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span class="tok-nd">@XmlRootElement</span><span class="tok-o">(</span><span class="tok-n">name</span><span class="tok-o">=</span><span class="tok-s">&quot;estadoImpresora&quot;</span><span class="tok-o">)</span>
<span class="tok-kd">public</span> <span class="tok-kd">class</span> <span class="tok-nc">EstadoBean</span> <span class="tok-o">{</span>
Â 
Â Â Â <span class="tok-nd">@XmlAttribute</span><span class="tok-o">(</span><span class="tok-n">name</span><span class="tok-o">=</span><span class="tok-s">&quot;valor&quot;</span><span class="tok-o">)</span>
Â Â Â <span class="tok-kd">public</span> <span class="tok-n">String</span> <span class="tok-n">estado</span> <span class="tok-o">=</span> <span class="tok-s">&quot;Idle&quot;</span><span class="tok-o">;</span>
Â Â Â Â 
Â Â Â <span class="tok-nd">@XmlAttribute</span><span class="tok-o">(</span><span class="tok-n">name</span><span class="tok-o">=</span><span class="tok-s">&quot;toner&quot;</span><span class="tok-o">)</span>
Â Â Â <span class="tok-kd">public</span> <span class="tok-kt">int</span> <span class="tok-n">tonerRestante</span> <span class="tok-o">=</span> <span class="tok-mi">25</span><span class="tok-o">;</span>
Â Â Â Â 
Â Â Â <span class="tok-nd">@XmlElement</span><span class="tok-o">(</span><span class="tok-n">name</span><span class="tok-o">=</span><span class="tok-s">&quot;tarea&quot;</span><span class="tok-o">)</span>
Â Â Â <span class="tok-kd">public</span> <span class="tok-n">List</span><span class="tok-o">&lt;</span><span class="tok-n">TareaBean</span><span class="tok-o">&gt;</span> <span class="tok-n">tareas</span> <span class="tok-o">=</span>
Â Â Â Â Â Â Â Â Â Â Â Â Â <span class="tok-k">new</span> <span class="tok-n">ArrayList</span><span class="tok-o">&lt;</span><span class="tok-n">TareaBean</span><span class="tok-o">&gt;();</span>
<span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>En este caso, el XML resultante quedarÃ­a de la siguiente forma:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><span class="tok-nt">&lt;estadoImpresora</span> <span class="tok-na">valor=</span><span class="tok-s">&quot;Idle&quot;</span> <span class="tok-na">toner=</span><span class="tok-s">&quot;25&quot;</span><span class="tok-nt">&gt;</span>
    <span class="tok-nt">&lt;tarea&gt;</span>
        <span class="tok-nt">&lt;nombre&gt;</span>texto.doc<span class="tok-nt">&lt;/nombre&gt;</span>
        <span class="tok-nt">&lt;estado&gt;</span>imprimiendo...<span class="tok-nt">&lt;/estado&gt;</span>
        <span class="tok-nt">&lt;paginas&gt;</span>13<span class="tok-nt">&lt;/paginas&gt;</span>
    <span class="tok-nt">&lt;/tarea&gt;</span>
    <span class="tok-nt">&lt;tarea&gt;</span>
        <span class="tok-nt">&lt;nombre&gt;</span>texto2.doc<span class="tok-nt">&lt;/nombre&gt;</span>
        <span class="tok-nt">&lt;estado&gt;</span>en espera...<span class="tok-nt">&lt;/estado&gt;</span>
        <span class="tok-nt">&lt;paginas&gt;</span>5<span class="tok-nt">&lt;/paginas&gt;</span>
    <span class="tok-nt">&lt;/tarea&gt;</span>
<span class="tok-nt">&lt;/estadoImpresora&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Si no se indica lo contrario, por defecto se convierten los campos a elementos del XML.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>En caso de que los campos no sean pÃºblicos, etiquetaremos los <em>getters</em> correspondiente
(propiedades de la clase).</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Hemos visto que para las listas el nombre que especificamos en <code>@XmlElement</code> se utiliza
para nombrar cada elemento de la lista. Si queremos que ademÃ¡s se incluya un elemento
que envuelva a toda la lista, podemos utilizar la etiqueta <code>@XmlElementWrapper</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span class="tok-nd">@XmlRootElement</span><span class="tok-o">(</span><span class="tok-n">name</span><span class="tok-o">=</span><span class="tok-s">&quot;estadoImpresora&quot;</span><span class="tok-o">)</span>
<span class="tok-kd">public</span> <span class="tok-kd">class</span> <span class="tok-nc">EstadoBean</span> <span class="tok-o">{</span>

   <span class="tok-nd">@XmlAttribute</span><span class="tok-o">(</span><span class="tok-n">name</span><span class="tok-o">=</span><span class="tok-s">&quot;valor&quot;</span><span class="tok-o">)</span>
   <span class="tok-kd">public</span> <span class="tok-n">String</span> <span class="tok-n">estado</span> <span class="tok-o">=</span> <span class="tok-s">&quot;Idle&quot;</span><span class="tok-o">;</span>

   <span class="tok-nd">@XmlAttribute</span><span class="tok-o">(</span><span class="tok-n">name</span><span class="tok-o">=</span><span class="tok-s">&quot;toner&quot;</span><span class="tok-o">)</span>
   <span class="tok-kd">public</span> <span class="tok-kt">int</span> <span class="tok-n">tonerRestante</span> <span class="tok-o">=</span> <span class="tok-mi">25</span><span class="tok-o">;</span>

   <span class="tok-nd">@XmlElementWrapper</span><span class="tok-o">(</span><span class="tok-n">name</span><span class="tok-o">=</span><span class="tok-s">&quot;tareas&quot;</span><span class="tok-o">)</span>
   <span class="tok-nd">@XmlElement</span><span class="tok-o">(</span><span class="tok-n">name</span><span class="tok-o">=</span><span class="tok-s">&quot;tarea&quot;</span><span class="tok-o">)</span>
   <span class="tok-kd">public</span> <span class="tok-n">List</span><span class="tok-o">&lt;</span><span class="tok-n">TareaBean</span><span class="tok-o">&gt;</span> <span class="tok-n">tareas</span> <span class="tok-o">=</span>
             <span class="tok-k">new</span> <span class="tok-n">ArrayList</span><span class="tok-o">&lt;</span><span class="tok-n">TareaBean</span><span class="tok-o">&gt;();</span>
<span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>En este caso tendremos un XML como el que se muestra a continuaciÃ³n:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><span class="tok-nt">&lt;estadoImpresora</span> <span class="tok-na">valor=</span><span class="tok-s">&quot;Idle&quot;</span> <span class="tok-na">toner=</span><span class="tok-s">&quot;25&quot;</span><span class="tok-nt">&gt;</span>
    <span class="tok-nt">&lt;tareas&gt;</span>
        <span class="tok-nt">&lt;tarea&gt;</span>
            <span class="tok-nt">&lt;nombre&gt;</span>texto.doc<span class="tok-nt">&lt;/nombre&gt;</span>
            <span class="tok-nt">&lt;estado&gt;</span>imprimiendo...<span class="tok-nt">&lt;/estado&gt;</span>
            <span class="tok-nt">&lt;paginas&gt;</span>13<span class="tok-nt">&lt;/paginas&gt;</span>
        <span class="tok-nt">&lt;/tarea&gt;</span>
        <span class="tok-nt">&lt;tarea&gt;</span>
            <span class="tok-nt">&lt;nombre&gt;</span>texto2.doc<span class="tok-nt">&lt;/nombre&gt;</span>
            <span class="tok-nt">&lt;estado&gt;</span>en espera...<span class="tok-nt">&lt;/estado&gt;</span>
            <span class="tok-nt">&lt;paginas&gt;</span>5<span class="tok-nt">&lt;/paginas&gt;</span>
        <span class="tok-nt">&lt;/tarea&gt;</span>
    <span class="tok-nt">&lt;/tareas&gt;</span>
<span class="tok-nt">&lt;/estadoImpresora&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Para etiquetar una lista tambiÃ©n podemos especificar distintos tipos de elemento segÃºn
el tipo de objeto contenido en la lista. Por ejemplo, supongamos que en el ejemplo anterior
la clase <code>TareaBean</code> fuese una clase abstracta que tiene dos posible subclases: <code>TareaSistemaBean</code>
y <code>TareaUsuarioBean</code>. PodrÃ­amos especificar una etiqueta distinta para cada elemento de la lista
segÃºn el tipo de objeto del que se trate con la etiqueta <code>@XmlElements</code>, de la siguiente forma:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span class="tok-nd">@XmlElementWrapper</span><span class="tok-o">(</span><span class="tok-n">name</span><span class="tok-o">=</span><span class="tok-s">&quot;tareas&quot;</span><span class="tok-o">)</span>
   <span class="tok-nd">@XmlElements</span><span class="tok-o">({</span>
       <span class="tok-nd">@XmlElement</span><span class="tok-o">(</span><span class="tok-n">name</span><span class="tok-o">=</span><span class="tok-s">&quot;usuario&quot;</span><span class="tok-o">,</span><span class="tok-n">type</span><span class="tok-o">=</span><span class="tok-n">TareaUsuarioBean</span><span class="tok-o">.</span><span class="tok-na">class</span><span class="tok-o">},</span>
       <span class="tok-nd">@XmlElement</span><span class="tok-o">(</span><span class="tok-n">name</span><span class="tok-o">=</span><span class="tok-s">&quot;sistema&quot;</span><span class="tok-o">,</span><span class="tok-n">type</span><span class="tok-o">=</span><span class="tok-n">TareaSistemaBean</span><span class="tok-o">.</span><span class="tok-na">class</span><span class="tok-o">}})</span>
   <span class="tok-kd">public</span> <span class="tok-n">List</span><span class="tok-o">&lt;</span><span class="tok-n">TareaBean</span><span class="tok-o">&gt;</span> <span class="tok-n">tareas</span> <span class="tok-o">=</span>
             <span class="tok-k">new</span> <span class="tok-n">ArrayList</span><span class="tok-o">&lt;</span><span class="tok-n">TareaBean</span><span class="tok-o">&gt;();</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>De esta forma podrÃ­amos tener un XML como el siguiente:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><span class="tok-nt">&lt;estadoImpresora</span> <span class="tok-na">valor=</span><span class="tok-s">&quot;Idle&quot;</span> <span class="tok-na">toner=</span><span class="tok-s">&quot;25&quot;</span><span class="tok-nt">&gt;</span>
    <span class="tok-nt">&lt;tareas&gt;</span>
        <span class="tok-nt">&lt;usuario&gt;</span>
            <span class="tok-nt">&lt;nombre&gt;</span>texto.doc<span class="tok-nt">&lt;/nombre&gt;</span>
            <span class="tok-nt">&lt;estado&gt;</span>imprimiendo...<span class="tok-nt">&lt;/estado&gt;</span>
            <span class="tok-nt">&lt;paginas&gt;</span>13<span class="tok-nt">&lt;/paginas&gt;</span>
        <span class="tok-nt">&lt;/usuario&gt;</span>
        <span class="tok-nt">&lt;sistema&gt;</span>
            <span class="tok-nt">&lt;nombre&gt;</span>texto2.doc<span class="tok-nt">&lt;/nombre&gt;</span>
            <span class="tok-nt">&lt;estado&gt;</span>en espera...<span class="tok-nt">&lt;/estado&gt;</span>
            <span class="tok-nt">&lt;paginas&gt;</span>5<span class="tok-nt">&lt;/paginas&gt;</span>
        <span class="tok-nt">&lt;/sistema&gt;</span>
    <span class="tok-nt">&lt;/tareas&gt;</span>
<span class="tok-nt">&lt;/estadoImpresora&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Hemos visto que por defecto se serializan todos los campos. Si queremos excluir alguno de
ellos de la serializaciÃ³n, podemos hacerlo anotÃ¡ndolo con <code>@XmlTransient</code>. Como alternativa,
podemos cambiar el comportamiento por defecto de la serializaciÃ³n de la clase etiquetÃ¡ndola con <code>@XmlAccessorType</code>.
Por ejemplo:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span class="tok-nd">@XmlAccessorType</span><span class="tok-o">(</span><span class="tok-n">NONE</span><span class="tok-o">)</span>
<span class="tok-nd">@XmlRootElement</span><span class="tok-o">(</span><span class="tok-n">name</span><span class="tok-o">=</span><span class="tok-s">&quot;estadoImpresora&quot;</span><span class="tok-o">)</span>
<span class="tok-kd">public</span> <span class="tok-kd">class</span> <span class="tok-nc">EstadoBean</span> <span class="tok-o">{</span>
    <span class="tok-o">...</span>
<span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>En este Ãºltimo caso, especificando como tipo <code>NONE</code>, no se serializarÃ¡ por defecto ningÃºn campo,
sÃ³lo aquellos que hayamos anotado explÃ­citamente con <code>@XmlElement</code> o <code>@XmlAttribute</code>.
Los campos y propiedades (<em>getters</em>) anotados con estas etiquetas se serializarÃ¡n siempre.
AdemÃ¡s de ellos, tambiÃ©n podrÃ­amos especificar que se serialicen por defecto todos los campos
pÃºblicos y los <em>getters</em> (<code>PUBLIC_MEMBER</code>), todos los <em>getters</em> (<code>PROPERTY</code>), o todos los campos,
ya sean pÃºblicos o privados (<code>FIELD</code>). Todos los que se serialicen por defecto, sin especificar
ninguna etiqueta, lo harÃ¡n como elemento.</p>
</div>
<div class="paragraph">
<p>Por Ãºltimo, si nos interesa que toda la representaciÃ³n del objeto venga dada Ãºnicamente
por el valor de uno de sus campos, podemos etiquetar dicho campo con <code>@XmlValue</code>.</p>
</div>
<div class="sect3">
<h4 id="_clase_jaxbcontext">3.4.1. Clase JAXBContext</h4>
<div class="paragraph">
<p>Para serializar clases Java a y desde XML, es necesario interactuar con la clase <code>javax.xml.bind.JAXBContext</code>.
Esta clase nos permite "inspeccionar" las clases Java para "comprender" la estructura de
nuestras clases anotadas. Dichas clases se utilizan como factorÃ­as para las interfaces
<code>javax.xml.bind.Marshaller</code>, y <code>javax.xml.bind.Unmarshaller</code>. Las instancias de
<em>Marshaller</em> se utilizan para crear documentos XML a partir de objetos Java. Las instancias de
<em>Unmarshaller</em> se utilizan para crear objetos Java a partir de documentos XML. A continuaciÃ³n
mostramos un ejemplo de uso de JAXB para convertir una instancia de la clase <code>Cliente</code>,
que hemos definido anteriormente, a formato XML, para posteriormente volver a crear
 el objeto de tipo <code>Cliente</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span class="tok-n">Cliente</span> <span class="tok-n">cliente</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-nf">Cliente</span><span class="tok-o">();</span>
<span class="tok-n">cliente</span><span class="tok-o">.</span><span class="tok-na">setId</span><span class="tok-o">(</span><span class="tok-mi">42</span><span class="tok-o">);</span>
<span class="tok-n">cliente</span><span class="tok-o">.</span><span class="tok-na">setNombre</span><span class="tok-o">(</span><span class="tok-s">&quot;Lucia Arg&quot;</span><span class="tok-o">);</span>  <i class="conum" data-value="1"></i><b>(1)</b>

<span class="tok-n">JAXBContext</span> <span class="tok-n">ctx</span> <span class="tok-o">=</span> <span class="tok-n">JAXBContext</span><span class="tok-o">.</span><span class="tok-na">newInstance</span><span class="tok-o">(</span><span class="tok-n">Cliente</span><span class="tok-o">.</span><span class="tok-na">class</span><span class="tok-o">);</span> <i class="conum" data-value="2"></i><b>(2)</b>
<span class="tok-n">StringWriter</span> <span class="tok-n">writer</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-nf">StringWriter</span><span class="tok-o">();</span>

<span class="tok-n">ctx</span><span class="tok-o">.</span><span class="tok-na">createMarshaller</span><span class="tok-o">().</span><span class="tok-na">marshal</span><span class="tok-o">(</span><span class="tok-n">cliente</span><span class="tok-o">,</span> <span class="tok-n">writer</span><span class="tok-o">);</span>
<span class="tok-n">String</span> <span class="tok-n">modString</span> <span class="tok-o">=</span> <span class="tok-n">writer</span><span class="tok-o">.</span><span class="tok-na">toString</span><span class="tok-o">();</span>   <i class="conum" data-value="3"></i><b>(3)</b>

<span class="tok-n">cliente</span> <span class="tok-o">=</span> <span class="tok-o">(</span><span class="tok-n">Cliente</span><span class="tok-o">)</span><span class="tok-n">ctx</span><span class="tok-o">.</span><span class="tok-na">createUnmarshaller</span><span class="tok-o">().</span>
                <span class="tok-n">unmarshal</span><span class="tok-o">(</span><span class="tok-k">new</span> <span class="tok-nf">StringReader</span><span class="tok-o">(</span><span class="tok-n">modString</span><span class="tok-o">));</span> <i class="conum" data-value="4"></i><b>(4)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Creamos e inicializamos una instancia de tipo <code>Cliente</code></td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Inicializamos <code>JAXBContext para que pueda "analizar" la clase `Cliente</code></td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Utilizamos una instancia de <em>Marshaller</em> para escribir el objeto <code>Cliente</code>
como un <code>String</code> de Java (<code>StringWriter</code> es un <em>stream</em> de caracteres que utilizaremos
para construir un <code>String</code>)</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Utilizamos una instancia de <em>Unmarshaller</em> para recrear el objeto <code>Cliente</code>
a partir del <code>String</code> que hemos obtenido en el paso anterior</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>La clase <code>JAXBContext</code> constituye un punto
en entrada al API JAXB para los clientes de nuestros servicios RESTful. Proporciona una
 abstracciÃ³n para gestionar el enlazado (<em>binding</em>) de informaciÃ³n XML/Java, necesaria
 para implementar las operaciones de <em>marshalling</em> y <em>unmarshalling</em></p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong><em>Unmarshalling</em></strong>: La clase <code>Unmarshaller</code> proporciona a la aplicaciÃ³n cliente la
capacidad para convertir datos XML en un "Ã¡rbol" de objetos Java.</p>
</li>
<li>
<p><strong><em>Marshalling</em></strong>: La clase <code>Marshaller</code> proporciona a la aplicaciÃ³n cliente la capacidad
para convertir un "Ã¡rbol" con contenidos Java, de nuevo en datos XML.</p>
</li>
</ul>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Una vez que hemos proporcionado una visiÃ³n general sobre cÃ³mo funciona JAXB, vamos a
ver cÃ³mo se integra con JAX-RS</p>
</div>
</div>
<div class="sect3">
<h4 id="_manejadores_jax_rs_para_jaxb">3.4.2. Manejadores JAX-RS para JAXB</h4>
<div class="paragraph">
<p>La especificaciÃ³n de JAX-RS indica que cualquier implementaciÃ³n debe soportar de
forma automÃ¡tica el proceso de <em>marshalling</em> y <em>unmarshalling</em> de clases anotadas
con <code>@XmlRootElement</code>. A continuaciÃ³n mostramos un ejemplo de la implementaciÃ³n
de un servicio que hace uso de dichos manejadores. Para ello utilizamos la clase
<em>Cliente</em> que hemos anotado previamente con @XmlRootElement y que hemos mostrado
en apartados anteriores:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span class="tok-nd">@Path</span><span class="tok-o">(</span><span class="tok-s">&quot;/clientes&quot;</span><span class="tok-o">)</span>
<span class="tok-kd">public</span> <span class="tok-kd">class</span> <span class="tok-nc">ClienteResource</span> <span class="tok-o">{</span>
  <span class="tok-nd">@GET</span>
  <span class="tok-nd">@Path</span><span class="tok-o">(</span><span class="tok-s">&quot;{id}&quot;</span><span class="tok-o">)</span>
  <span class="tok-nd">@Produces</span><span class="tok-o">(</span><span class="tok-s">&quot;application/xml&quot;</span><span class="tok-o">)</span>
  <span class="tok-kd">public</span> <span class="tok-n">Cliente</span> <span class="tok-nf">getCliente</span><span class="tok-o">(</span><span class="tok-nd">@PathParam</span><span class="tok-o">(</span><span class="tok-s">&quot;id&quot;</span><span class="tok-o">)</span> <span class="tok-kt">int</span> <span class="tok-n">id</span><span class="tok-o">)</span> <span class="tok-o">{</span>
     <span class="tok-n">Cliente</span> <span class="tok-n">cli</span> <span class="tok-o">=</span> <span class="tok-n">findCliente</span><span class="tok-o">(</span><span class="tok-n">id</span><span class="tok-o">);</span>
     <span class="tok-k">return</span> <span class="tok-n">cust</span><span class="tok-o">;</span>
  <span class="tok-o">}</span>

  <span class="tok-nd">@POST</span>
  <span class="tok-nd">@Consumes</span><span class="tok-o">(</span><span class="tok-s">&quot;application/xml&quot;</span><span class="tok-o">)</span>
  <span class="tok-kd">public</span> <span class="tok-kt">void</span> <span class="tok-nf">crearCliente</span><span class="tok-o">(</span><span class="tok-n">Cliente</span> <span class="tok-n">cli</span><span class="tok-o">)</span> <span class="tok-o">{</span>
  <span class="tok-o">...</span>
  <span class="tok-o">}</span>
<span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Como podemos ver, una vez que aplicamos las anotaciones JAXB a nuestras clases Java (
en este caso a la clase <code>Cliente</code>), es muy sencillo intercambiar documentos XML entre
el cliente y nuestro servicio web. Los manejadores JAXB incluidos en la implementaciÃ³n de
JAX-RS gestionarÃ¡n el <em>marshalling/unmarshalling</em> de cualquier clase con anotaciones
JAXB, para los valores de <code>Content-Type</code> <code>application/xml</code>, <code>text/xml</code>, o
<code>application/*+xml</code>. Por defecto, tambiÃ©n se encargan de la creaciÃ³n e inicializaciÃ³n
de instancias <code>JAXBContext</code>. Debido a que la creaciÃ³n de las instancias <code>JAXBContext</code>
puede ser "cara", la implementaciÃ³n de JAX-RS normalmente las "guarda" despuÃ©s de la
primera inicializaciÃ³n.</p>
</div>
</div>
<div class="sect3">
<h4 id="_jaxb_y_json">3.4.3. JAXB y JSON</h4>
<div class="paragraph">
<p>JAXB es lo suficientemente flexible como para soportar otros formatos ademÃ¡s de XML.
Aunque la especificaciÃ³n de JAX-RS no lo requiere, muchas implementaciones de JAX-RS
incluyen adaptadores de JAXB para soportar el formato JSON, ademÃ¡s de XML. JSON es un
formato basado en texto que puede ser interpretado directamente por Javascript. De hecho
es el formato de intercambio preferido por las aplicaciones Ajax.</p>
</div>
<div class="paragraph">
<p>JSON es un formato mucho mÃ¡s simple que XML. Los objetos estÃ¡n entre llaves, <code>{}</code>, y
contienen pares de <em>clave/valor</em> separados por comas. Los valores pueden ser cadenas de caracteres, booleanos
(<code>true</code> o <code>false</code>), valores numÃ©ricos, o <em>arrays</em> de los tipos anteriores.</p>
</div>
<div class="paragraph">
<p>Supongamos que tenemos la siguiente descripciÃ³n de un producto en formato XML:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><span class="tok-cp">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
<span class="tok-nt">&lt;producto&gt;</span>
   <span class="tok-nt">&lt;id&gt;</span>1<span class="tok-nt">&lt;/id&gt;</span>
   <span class="tok-nt">&lt;nombre&gt;</span>iPad<span class="tok-nt">&lt;/nombre&gt;</span>
   <span class="tok-nt">&lt;descripcion&gt;</span>Dispositivo mÃ³vil<span class="tok-nt">&lt;/descripcion&gt;</span>
   <span class="tok-nt">&lt;precio&gt;</span>500<span class="tok-nt">&lt;/precio&gt;</span>
<span class="tok-nt">&lt;/producto&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>La representaciÃ³n JSON equivalente serÃ­a:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="json"><span class="tok-p">{</span>
  <span class="tok-nt">&quot;id&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;1&quot;</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;nombre&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;iPad&quot;</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;descripcion&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;Dispositivo mÃ³vil&quot;</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;precio&quot;</span><span class="tok-p">:</span><span class="tok-mi">500</span>
<span class="tok-p">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>El formato JSON asociado, por ejemplo, al siguiente objeto <code>Cliente</code> :</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"> <span class="tok-nt">&lt;cliente</span> <span class="tok-na">id=</span><span class="tok-s">&quot;56&quot;</span><span class="tok-nt">&gt;</span>
    <span class="tok-nt">&lt;nombre&gt;</span>Ricardo Lopez<span class="tok-nt">&lt;/nombre&gt;</span>
    <span class="tok-nt">&lt;direccion&gt;</span>
       <span class="tok-nt">&lt;calle&gt;</span>calle del oso, 35<span class="tok-nt">&lt;/calle&gt;</span>
       <span class="tok-nt">&lt;ciudad&gt;</span>Alicante<span class="tok-nt">&lt;/ciudad&gt;</span>
       <span class="tok-nt">&lt;codPostal&gt;</span>01010<span class="tok-nt">&lt;/codPostal&gt;</span>
    <span class="tok-nt">&lt;/direccion&gt;</span>
 <span class="tok-nt">&lt;/cliente&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>quedarÃ­a como sigue:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="json"><span class="tok-p">{</span>
  <span class="tok-nt">&quot;nombre&quot;</span><span class="tok-p">:</span> <span class="tok-s2">&quot;Ricardo Lopez&quot;</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;direccion&quot;</span><span class="tok-p">:</span> <span class="tok-p">{</span> <span class="tok-nt">&quot;calle&quot;</span><span class="tok-p">:</span> <span class="tok-s2">&quot;calle del oso, 35&quot;</span><span class="tok-p">,</span>
                  <span class="tok-nt">&quot;ciudad&quot;</span><span class="tok-p">:</span> <span class="tok-s2">&quot;Alicante&quot;</span><span class="tok-p">,</span>
                  <span class="tok-nt">&quot;codPostal&quot;</span><span class="tok-p">:</span> <span class="tok-s2">&quot;01010&quot;</span>
                <span class="tok-p">}</span>
<span class="tok-p">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Como vemos en el ejemplo, el formato JSON consiste bÃ¡sicamente en objetos situados
entre llaves, los cuales estÃ¡n formados por pares clave/valor, separadas por comas.
Cada clave y valor estÃ¡ separado por ":".
Los <em>valores</em> pueden cadenas de caracteres, booleanos (<em>true</em> o <em>false</em>), valores
numÃ©ricos, o vectores de los tipos anteriores (los vectores estÃ¡n delimitados por
corchetes).</p>
</div>
<div class="paragraph">
<p>Podemos aÃ±adir el formato <code>application/json</code>, o bien <code>MediaType.APPLICATION_JSON</code> a la
anotaciÃ³n <code>@Produces</code> en nuestros mÃ©todos de recurso para generar respuestas en formato
JSON:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span class="tok-nd">@GET</span>
<span class="tok-nd">@Path</span><span class="tok-o">(</span><span class="tok-s">&quot;/get&quot;</span><span class="tok-o">)</span>
<span class="tok-nd">@Produces</span><span class="tok-o">({</span><span class="tok-s">&quot;application/xml&quot;</span><span class="tok-o">,</span><span class="tok-s">&quot;application/json&quot;</span><span class="tok-o">})</span>
<span class="tok-kd">public</span> <span class="tok-n">Producto</span> <span class="tok-nf">getProducto</span><span class="tok-o">()</span> <span class="tok-o">{</span> <span class="tok-o">...</span> <span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>En este ejemplo, se elegirÃ¡ el formato
JSON en la respuesta si el cliente realiza una peticiÃ³n GET que incluye en la cabecera:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code>Accept: application/json</code></pre>
</div>
</div>
<div class="paragraph">
<p>El tipo de respuesta es de tipo <code>Producto</code>. En este caso <code>Producto</code> debe ser un <em>bean JAXB</em>,
es decir, una clase anotada con <code>@XmlRootElement</code>.</p>
</div>
<div class="paragraph">
<p>Los mÃ©todos de recurso pueden aceptar tambiÃ©n datos JSON para clases con anotaciones JAXB:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span class="tok-nd">@POST</span>
<span class="tok-nd">@Path</span><span class="tok-o">(</span><span class="tok-s">&quot;/producto&quot;</span><span class="tok-o">)</span>
<span class="tok-nd">@Consumes</span><span class="tok-o">({</span><span class="tok-s">&quot;application/xml&quot;</span><span class="tok-o">,</span><span class="tok-s">&quot;application/json&quot;</span><span class="tok-o">})</span>
<span class="tok-kd">public</span> <span class="tok-n">Response</span> <span class="tok-nf">crearProducto</span><span class="tok-o">(</span><span class="tok-n">Producto</span> <span class="tok-n">prod</span><span class="tok-o">)</span> <span class="tok-o">{</span> <span class="tok-o">...</span> <span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>En este caso el cliente deberÃ­a incluir la siguiente cabecera cuando realice la peticiÃ³n
POST que incluya los datos JSON anteriores en el cuerpo del mensaje:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code>Content-Type: application/json</code></pre>
</div>
</div>
<div class="paragraph">
<p>Hablaremos con mÃ¡s detalle del formato JSON en una sesiÃ³n posterior.</p>
</div>
<div class="paragraph">
<p>Finalmente, y como resumen de lo anterior:</p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">JAXB</div>
<div class="paragraph">
<p>Para dar soporte al serializado y deserializado XML se utilizan beans JAXB.Por ejemplo las clases
anteriores <code>EstadoBean</code>, <code>TareaBean</code>, <code>Cliente</code> y <code>Producto</code> son ejemplos de beans JAXB.
La clase que se serializarÃ¡ como un recurso XML o JSON se tiene que anotar con <code>@XmlRootElement</code>.
Si en algÃºn elemento de un recurso se retorna un elemento de esa clase y se etiqueta con los
tipos <code>@Produces({MediaType.APPLICATION_XML,Mediatype.APPLICATION_JSON}</code>), Ã©ste se serializa
automÃ¡ticamente utilizando el tipo de representaciÃ³n aceptada por el cliente. Se puede consultar
<a href="http://www.vogella.de/articles/JAXB/article.html">el artÃ­culo de Lars Vogel</a> para mÃ¡s informaciÃ³n.</p>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_respuestas_del_servidor">3.5. Respuestas del servidor</h3>
<div class="paragraph">
<p>Vamos a explicar cuÃ¡l es el comportamiento por defecto de los mÃ©todos de
recursos JAX-RS, en particular veremos cuÃ¡les son los cÃ³digos de respuesta
HTTP por defecto teniendo en cuenta situaciones de Ã©xito, asÃ­ como de fallo.</p>
</div>
<div class="paragraph">
<p>Dado que, en ocasiones, vamos a tener que enviar cabeceras de
respuesta especÃ­ficas ante condiciones de error complejas, tambiÃ©n vamos
a explicar cÃ³mo podemos elaborar respuestas complejas utilizando el API
JAX-RS.</p>
</div>
<div class="sect3">
<h4 id="_cÃ³digos_de_respuesta_por_defecto">3.5.1. CÃ³digos de respuesta por defecto</h4>
<div class="paragraph">
<p>Los cÃ³digos de respuesta por defecto se corresponden con el comportamiento indicado
en la <a href="http://www.w3.org/Protocols/rfc2616/rfc2616-sec9.html">especificaciÃ³n</a> de la definiciÃ³n
  de los mÃ©todos HTTP 1.1. Vamos a examinar dichos cÃ³digos de respuesta con el siguiente
ejemplo de recurso JAX-RS:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span class="tok-nd">@Path</span><span class="tok-o">(</span><span class="tok-s">&quot;/clientes&quot;</span><span class="tok-o">)</span>
<span class="tok-kd">public</span> <span class="tok-kd">class</span> <span class="tok-nc">ClienteResource</span> <span class="tok-o">{</span>

  <span class="tok-nd">@Path</span><span class="tok-o">(</span><span class="tok-s">&quot;{id}&quot;</span><span class="tok-o">)</span>
  <span class="tok-nd">@GET</span>
  <span class="tok-nd">@Produces</span><span class="tok-o">(</span><span class="tok-s">&quot;application/xml&quot;</span><span class="tok-o">)</span>
  <span class="tok-kd">public</span> <span class="tok-n">Cliente</span> <span class="tok-nf">getCliente</span><span class="tok-o">(</span><span class="tok-nd">@PathParam</span><span class="tok-o">(</span><span class="tok-s">&quot;id&quot;</span><span class="tok-o">)</span> <span class="tok-kt">int</span> <span class="tok-n">id</span><span class="tok-o">)</span> <span class="tok-o">{...}</span>

  <span class="tok-nd">@POST</span>
  <span class="tok-nd">@Produces</span><span class="tok-o">(</span><span class="tok-s">&quot;application/xml&quot;</span><span class="tok-o">)</span>
  <span class="tok-nd">@Consumes</span><span class="tok-o">(</span><span class="tok-s">&quot;application/xml&quot;</span><span class="tok-o">)</span>
  <span class="tok-kd">public</span> <span class="tok-n">Cliente</span> <span class="tok-nf">crearCliente</span><span class="tok-o">(</span><span class="tok-n">Cliente</span> <span class="tok-n">nuevoCli</span><span class="tok-o">)</span> <span class="tok-o">{...}</span>

  <span class="tok-nd">@PUT</span>
  <span class="tok-nd">@Path</span><span class="tok-o">(</span><span class="tok-s">&quot;{id}&quot;</span><span class="tok-o">)</span>
  <span class="tok-nd">@Consumes</span><span class="tok-o">(</span><span class="tok-s">&quot;application/xml&quot;</span><span class="tok-o">)</span>
  <span class="tok-kd">public</span> <span class="tok-kt">void</span> <span class="tok-nf">updateCliente</span><span class="tok-o">(</span><span class="tok-nd">@PathParam</span><span class="tok-o">(</span><span class="tok-s">&quot;id&quot;</span><span class="tok-o">)</span> <span class="tok-kt">int</span> <span class="tok-n">id</span><span class="tok-o">,</span> <span class="tok-n">Cliente</span> <span class="tok-n">cli</span><span class="tok-o">)</span> <span class="tok-o">{...}</span>

  <span class="tok-nd">@Path</span><span class="tok-o">(</span><span class="tok-s">&quot;{id}&quot;</span><span class="tok-o">)</span>
  <span class="tok-nd">@DELETE</span>
  <span class="tok-kd">public</span> <span class="tok-kt">void</span> <span class="tok-nf">borrarCliente</span><span class="tok-o">(</span><span class="tok-nd">@PathParam</span><span class="tok-o">(</span><span class="tok-s">&quot;id&quot;</span><span class="tok-o">)</span> <span class="tok-kt">int</span> <span class="tok-n">id</span><span class="tok-o">)</span> <span class="tok-o">{...}</span>
<span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="sect4">
<h5 id="_respuestas_que_indican_Ã©xito">Respuestas que indican Ã©xito</h5>
<div class="paragraph">
<p>Los nÃºmeros de cÃ³digo de respuestas HTTP con Ã©xito se sitÃºan en el rango de 200
a 399:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Para los mÃ©todos <code>crearCliente()</code> y <code>getCliente()</code> se devolverÃ¡ una respuesta
HTTP con el cÃ³digo "200 OK", si el objeto <code>Cliente</code> que devuelven dichos mÃ©todos
<strong>no es <code>null</code></strong>.</p>
</li>
<li>
<p>Para los mÃ©todos <code>crearCliente()</code> y <code>getCliente()</code> se devolverÃ¡ una respuesta
HTTP con el cÃ³digo "204 No Content", si el objeto <code>Cliente</code> que devuelven dichos mÃ©todos
 es <code>null</code>. El cÃ³digo de respuesta 204 no indica una condiciÃ³n de error. Solamente
avisa al cliente de que todo ha ido bien, pero que el mensaje de respuesta no contiene
nada en el cuerpo de la misma. SegÃºn Ã©sto, si un mÃ©todo de un recurso devuelve <code>void</code>,
por defecto se devuelve el cÃ³digo de respuesta "204 No content". Este es el caso
para los mÃ©todos <code>updateCliente()</code>, y <code>borrarCliente()</code> de nuestro ejemplo.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>La especificaciÃ³n HTTP es bastante consistente para los mÃ©todos PUT, POST, GET y
DELETE. Si una respuesta exitosa HTTP contiene informaciÃ³n en el cuerpo del mensaje
de respuesta, entonces el cÃ³digo de respuesta es "200 OK". Si el cuerpo del mensaje
estÃ¡ vacÃ­o, entonces se debe devolver "204 No Content".</p>
</div>
</div>
<div class="sect4">
<h5 id="_respuestas_que_indican_una_situaciÃ³n_de_fallo">Respuestas que indican una situaciÃ³n de fallo</h5>
<div class="paragraph">
<p>Es habitual que las respuestas "fallidas" se programen de forma que se lance una
 excepciÃ³n. Lo veremos en un apartado posterior. AquÃ­ comentaremos algunas condiciones
 de error por defecto.</p>
</div>
<div class="paragraph">
<p>Los nÃºmeros de cÃ³digo de error de respuesta estÃ¡ndar en HTTP se sitÃºan en el rango
  entre 400 y 599. En nuestro ejemplo, si un cliente se equivoca tecleando la URI,
   y Ã©sta queda por ejemplo como <code><a href="http://.../cliente" class="bare">http://&#8230;&#8203;/cliente</a></code>, entonces el servidor no encontrarÃ¡ ningÃºn
   mÃ©todo del recurso que pueda servir dicha peticiÃ³n (la URI correcta serÃ­a <code><a href="http://.../clientes" class="bare">http://&#8230;&#8203;/clientes</a></code>).
   En este caso, se enviarÃ¡ como respuesta el cÃ³digo "404 Not Found".</p>
</div>
<div class="paragraph">
<p>Para los mÃ©todos <code>getCliente()</code> y <code>crearCliente()</code> de nuestro ejemplo, si el cliente
solicita una respuesta con el tipo MIME <code>text/html</code>, entonces la implementaciÃ³n de
JAX-RS devolverÃ¡ automÃ¡ticamente "406 Not Acceptable", con un mensaje de respuesta
con el cuerpo de dicho mensaje vacÃ­o. Esta respuesta indica que JAX-RS puede encontrar
una ruta de URI relativa, que coincide con la peticiÃ³n, pero no encuentra ningÃºn
mÃ©todo del recurso que devuelva la respuesta con ese tipo MIME.</p>
</div>
<div class="paragraph">
<p>Si el cliente invoca una peticiÃ³n HTTP sobre una URI vÃ¡lida, para la que no se puede
encontrar un mÃ©todo de recurso asociado, entonces el <em>runtime</em> de JAX-RS devolverÃ¡
el cÃ³digo "405 Method Not Allowed". AsÃ­, en nuestro ejemplo, si el cliente solicita
una operaciÃ³n PUT, GET, o DELETE sobre la URI <code>/clientes</code>, obtendrÃ¡ como respuesta
"405 Method Not Allowed", puesto que POST es el Ãºnico mÃ©todo HTTP que puede dar soporte
a dicha URI. La implementaciÃ³n de JAX-RS tambiÃ©n devolverÃ¡ una cabecera de respuesta
<code>Allow</code> con la lista de mÃ©todos HTTP que pueden dar soporte a dicha URI. Por lo tanto,
si nuestra aplicaciÃ³n cliente realiza la siguiente peticiÃ³n de entrada:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>GET /clientes</pre>
</div>
</div>
<div class="paragraph">
<p>el servidor devolverÃ¡ la siguiente respuesta:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="sh">HTTP/1.1 405, Method Not Allowed
Allow: POST</code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_elaboraciÃ³n_de_respuestas_con_la_clase_response">3.5.2. ElaboraciÃ³n de respuestas con la clase Response</h4>
<div class="paragraph">
<p>Como ya hemos visto, por ejemplo para peticiones GET, si todo va bien
se estarÃ¡ devolviendo un cÃ³digo de respuesta 200 (Ok), junto con el contenido especificado
en el tipo de datos utilizado en cada caso. Si devolvemos void, el cÃ³digo de respuesta
serÃ¡ 204 (No Content).</p>
</div>
<div class="paragraph">
<p>Sin embargo, en ocasiones, el servicio web que estamos diseÃ±ando no puede implementarse utilizando
el comportamiento por defecto de peticiÃ³n/respuesta inherente a JAX-RS. En estos casos
necesitaremos controlar de forma explÃ­cita la respuesta que se le envÃ­a al cliente
(cuerpo del mensaje de la respuesta HTTP). Por ejemplo, cuando creamos un nuevo recurso con POST
deberÃ­amos devolver 201 (Created). Para tener control sobre este cÃ³digo
nuestros recursos JAX-RS podrÃ¡n devolver instancias de <code>javax.ws.rs.core.Response</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span class="tok-nd">@GET</span>
<span class="tok-nd">@Produces</span><span class="tok-o">(</span><span class="tok-n">MediaType</span><span class="tok-o">.</span><span class="tok-na">APPLICATION_XML</span><span class="tok-o">)</span>
<span class="tok-kd">public</span> <span class="tok-n">Response</span> <span class="tok-nf">getClientes</span><span class="tok-o">()</span> <span class="tok-o">{</span>
  <span class="tok-n">ClientesBean</span> <span class="tok-n">clientes</span> <span class="tok-o">=</span> <span class="tok-n">obtenerClientes</span><span class="tok-o">();</span>
  <span class="tok-k">return</span> <span class="tok-n">Response</span><span class="tok-o">.</span><span class="tok-na">ok</span><span class="tok-o">(</span><span class="tok-n">clientes</span><span class="tok-o">).</span><span class="tok-na">build</span><span class="tok-o">();</span> <i class="conum" data-value="1"></i><b>(1)</b>
<span class="tok-o">}</span>

<span class="tok-nd">@POST</span>
<span class="tok-nd">@Consumes</span><span class="tok-o">(</span><span class="tok-n">MediaType</span><span class="tok-o">.</span><span class="tok-na">APPLICATION_XML</span><span class="tok-o">)</span>
<span class="tok-kd">public</span> <span class="tok-n">Response</span> <span class="tok-nf">addCliente</span><span class="tok-o">(</span><span class="tok-n">ClienteBean</span> <span class="tok-n">cliente</span><span class="tok-o">,</span>
                          <span class="tok-nd">@Context</span> <span class="tok-n">UriInfo</span> <span class="tok-n">uriInfo</span><span class="tok-o">)</span> <span class="tok-o">{</span>
  <span class="tok-n">String</span> <span class="tok-n">id</span> <span class="tok-o">=</span> <span class="tok-n">insertarCliente</span><span class="tok-o">(</span><span class="tok-n">cliente</span><span class="tok-o">);</span> <i class="conum" data-value="2"></i><b>(2)</b>
  <span class="tok-n">URI</span> <span class="tok-n">uri</span> <span class="tok-o">=</span> <span class="tok-n">uriInfo</span>
              <span class="tok-o">.</span><span class="tok-na">getAbsolutePathBuilder</span><span class="tok-o">()</span>
              <span class="tok-o">.</span><span class="tok-na">path</span><span class="tok-o">(</span><span class="tok-s">&quot;{id}&quot;</span><span class="tok-o">)</span>
              <span class="tok-o">.</span><span class="tok-na">build</span><span class="tok-o">(</span><span class="tok-n">id</span><span class="tok-o">);</span> <i class="conum" data-value="3"></i><b>(3)</b>
  <span class="tok-k">return</span> <span class="tok-n">Response</span><span class="tok-o">.</span><span class="tok-na">created</span><span class="tok-o">(</span><span class="tok-n">uri</span><span class="tok-o">).</span><span class="tok-na">build</span><span class="tok-o">();</span> <i class="conum" data-value="4"></i><b>(4)</b>
<span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Al crear una respuesta con Response, podemos especificar una entidad, que podrÃ¡ ser un
objeto de cualquiera de los tipos vistos anteriormente, y que representa los datos a
devolver como contenido. Por ejemplo, cuando indicamos <strong>ok(clientes)</strong>, estamos creando
una respuesta con cÃ³digo 200 (Ok) y con el contenido generado por nuestro bean JAXB
clientes. Esto serÃ¡ equivalente a haber devuelto directamente ClientesBean como respuesta,
pero con la ventaja de que en este caso podemos controlar el cÃ³digo de estado de la respuesta.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Insertamos una instancia de <code>ClienteBean</code> en la base de datos, y obtenemos
la clave asociada a dicho cliente.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>En la sesiÃ³n anterior hemos hablado de la interfaz <code>uriInfo</code>. Es una interfaz
inyectable que proporciona acceso a informaciÃ³n sobre la URI de la aplicaciÃ³n o la URI
de las peticiones recibidas. En este caso, estamos construyendo una nueva URI
formada por la ruta absoluta de la peticiÃ³n de entrada http POST, aÃ±adiÃ©ndole la plantilla "{id}"
y finalmente sustituyendo el parÃ¡metro de la plantilla por el valor <code>id</code>. Supongamos
que la peticiÃ³n POST contiene la uri <code><a href="http://localhost:8080/recursos/clientes" class="bare">http://localhost:8080/recursos/clientes</a></code>. Y que
el valor de <code>id</code> es 8. El valor de la variable <strong>uri</strong> serÃ¡, por tanto:
<code><a href="http://localhost:8080/recursos/clientes/8" class="bare">http://localhost:8080/recursos/clientes/8</a></code></td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Devolvemos la respuesta incluyendo la URI anterior en la cabecera HTTP `Location</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Veamos con mÃ¡s detalle la clase <code>Response</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span class="tok-kd">public</span> <span class="tok-kd">abstract</span> <span class="tok-kd">class</span> <span class="tok-nc">Response</span> <span class="tok-o">{</span>
  <span class="tok-kd">public</span> <span class="tok-kd">abstract</span> <span class="tok-n">Object</span> <span class="tok-nf">getEntity</span><span class="tok-o">();</span>  <i class="conum" data-value="1"></i><b>(1)</b>
  <span class="tok-kd">public</span> <span class="tok-kd">abstract</span> <span class="tok-kt">int</span> <span class="tok-nf">getStatus</span><span class="tok-o">();</span>  <i class="conum" data-value="2"></i><b>(2)</b>
  <span class="tok-kd">public</span> <span class="tok-kd">abstract</span> <span class="tok-n">MultivaluedMap</span><span class="tok-o">&lt;</span><span class="tok-n">String</span><span class="tok-o">,</span> <span class="tok-n">Object</span><span class="tok-o">&gt;</span> <span class="tok-nf">getMetadata</span><span class="tok-o">();</span>  <i class="conum" data-value="3"></i><b>(3)</b>
  <span class="tok-kd">public</span> <span class="tok-kd">abstract</span> <span class="tok-n">URI</span> <span class="tok-nf">getLocation</span><span class="tok-o">();</span>  <i class="conum" data-value="4"></i><b>(4)</b>
  <span class="tok-kd">public</span> <span class="tok-kd">abstract</span> <span class="tok-n">MediaType</span> <span class="tok-nf">getMediaType</span><span class="tok-o">();</span>  <i class="conum" data-value="5"></i><b>(5)</b>
  <span class="tok-kd">public</span> <span class="tok-kd">abstract</span> <span class="tok-kt">void</span> <span class="tok-nf">close</span><span class="tok-o">();</span> <i class="conum" data-value="6"></i><b>(6)</b>
   <span class="tok-o">...</span>
<span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>El mÃ©todo <code>getEntity()</code> devuelve el objeto Java correspondiente al cuerpo
del mensaje HTTP.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>El mÃ©todo <code>getStatus()</code> devuelve el cÃ³digo de respuesta HTTP.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>El mÃ©todo <code>getMetadata()</code> devuelve una instancia de tipo <code>MultivaluedMap</code> con las
cabeceras de la respuesta.</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>El mÃ©todo <code>getLocation()</code> devuelve la URI de la cabecera Location de la respuesta.</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>El mÃ©todo <code>getMediaType()</code> devuelve el <em>mediaType</em> del cuerpo de la respuesta</td>
</tr>
<tr>
<td><i class="conum" data-value="6"></i><b>6</b></td>
<td>El mÃ©todo <code>close()</code> cierra el <em>input stream</em> correspondiente a la entidad asociada
del cuerpo del mensaje (en el caso de que estÃ© disponible y "abierto"). TambiÃ©n libera
cualquier otro recurso asociado con la respuesta (como por ejemplo datos posiblemente
almacenados en un <em>buffer</em>)</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Estos mÃ©todos tÃ­picamente serÃ¡n invocados dese el cliente, tal y como veremos mÃ¡s adelante,
cuando expliquemos el API cliente.</p>
</div>
<div class="paragraph">
<p>Los objetos <code>Response</code> no pueden crearse directamente. Tienen que crearse a partir
 de instancias de <code>javax.ws.rs.core.Response.ResponseBuilder</code> devueltas por uno de
 los siguientes mÃ©todos estÃ¡ticos de <code>Response</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span class="tok-kd">public</span> <span class="tok-kd">abstract</span> <span class="tok-kd">class</span> <span class="tok-nc">Response</span> <span class="tok-o">{</span> <span class="tok-o">...</span>
  <span class="tok-kd">public</span> <span class="tok-kd">abstract</span> <span class="tok-kt">void</span> <span class="tok-nf">close</span><span class="tok-o">()</span> <span class="tok-o">{...}</span>
  <span class="tok-kd">public</span> <span class="tok-kd">static</span> <span class="tok-n">ResponseBuilder</span> <span class="tok-nf">status</span><span class="tok-o">(</span><span class="tok-n">Status</span> <span class="tok-n">status</span><span class="tok-o">)</span> <span class="tok-o">{...}</span>
  <span class="tok-kd">public</span> <span class="tok-kd">static</span> <span class="tok-n">ResponseBuilder</span> <span class="tok-nf">status</span><span class="tok-o">(</span><span class="tok-kt">int</span> <span class="tok-n">status</span><span class="tok-o">)</span> <span class="tok-o">{...}</span>
  <span class="tok-kd">public</span> <span class="tok-kd">static</span> <span class="tok-n">ResponseBuilder</span> <span class="tok-nf">ok</span><span class="tok-o">()</span> <span class="tok-o">{...}</span>
  <span class="tok-kd">public</span> <span class="tok-kd">static</span> <span class="tok-n">ResponseBuilder</span> <span class="tok-nf">ok</span><span class="tok-o">(</span><span class="tok-n">Object</span> <span class="tok-n">entity</span><span class="tok-o">)</span> <span class="tok-o">{...}</span>
  <span class="tok-kd">public</span> <span class="tok-kd">static</span> <span class="tok-n">ResponseBuilder</span> <span class="tok-nf">ok</span><span class="tok-o">(</span><span class="tok-n">Object</span> <span class="tok-n">entity</span><span class="tok-o">,</span> <span class="tok-n">MediaType</span> <span class="tok-n">type</span><span class="tok-o">)</span> <span class="tok-o">{...}</span>
  <span class="tok-kd">public</span> <span class="tok-kd">static</span> <span class="tok-n">ResponseBuilder</span> <span class="tok-nf">ok</span><span class="tok-o">(</span><span class="tok-n">Object</span> <span class="tok-n">entity</span><span class="tok-o">,</span> <span class="tok-n">String</span> <span class="tok-n">type</span><span class="tok-o">)</span> <span class="tok-o">{...}</span>
  <span class="tok-kd">public</span> <span class="tok-kd">static</span> <span class="tok-n">ResponseBuilder</span> <span class="tok-nf">ok</span><span class="tok-o">(</span><span class="tok-n">Object</span> <span class="tok-n">entity</span><span class="tok-o">,</span> <span class="tok-n">Variant</span> <span class="tok-n">var</span><span class="tok-o">)</span> <span class="tok-o">{...}</span>
  <span class="tok-kd">public</span> <span class="tok-kd">static</span> <span class="tok-n">ResponseBuilder</span> <span class="tok-nf">serverError</span><span class="tok-o">()</span> <span class="tok-o">{...}</span>
  <span class="tok-kd">public</span> <span class="tok-kd">static</span> <span class="tok-n">ResponseBuilder</span> <span class="tok-nf">created</span><span class="tok-o">(</span><span class="tok-n">URI</span> <span class="tok-n">location</span><span class="tok-o">)</span> <span class="tok-o">{...}</span>
  <span class="tok-kd">public</span> <span class="tok-kd">static</span> <span class="tok-n">ResponseBuilder</span> <span class="tok-nf">noContent</span><span class="tok-o">()</span> <span class="tok-o">{...}</span>
  <span class="tok-kd">public</span> <span class="tok-kd">static</span> <span class="tok-n">ResponseBuilder</span> <span class="tok-nf">notModified</span><span class="tok-o">()</span> <span class="tok-o">{...}</span>
  <span class="tok-kd">public</span> <span class="tok-kd">static</span> <span class="tok-n">ResponseBuilder</span> <span class="tok-nf">notModified</span><span class="tok-o">(</span><span class="tok-n">EntityTag</span> <span class="tok-n">tag</span><span class="tok-o">)</span> <span class="tok-o">{...}</span>
  <span class="tok-kd">public</span> <span class="tok-kd">static</span> <span class="tok-n">ResponseBuilder</span> <span class="tok-nf">notModified</span><span class="tok-o">(</span><span class="tok-n">String</span> <span class="tok-n">tag</span><span class="tok-o">)</span> <span class="tok-o">{...}</span>
  <span class="tok-kd">public</span> <span class="tok-kd">static</span> <span class="tok-n">ResponseBuilder</span> <span class="tok-nf">seeOther</span><span class="tok-o">(</span><span class="tok-n">URI</span> <span class="tok-n">location</span><span class="tok-o">)</span> <span class="tok-o">{...}</span>
  <span class="tok-kd">public</span> <span class="tok-kd">static</span> <span class="tok-n">ResponseBuilder</span> <span class="tok-nf">temporaryRedirect</span><span class="tok-o">(</span><span class="tok-n">URI</span> <span class="tok-n">location</span><span class="tok-o">)</span> <span class="tok-o">{...}</span>
  <span class="tok-kd">public</span> <span class="tok-kd">static</span> <span class="tok-n">ResponseBuilder</span> <span class="tok-nf">notAcceptable</span><span class="tok-o">(</span><span class="tok-n">List</span><span class="tok-o">&lt;</span><span class="tok-n">Variant</span><span class="tok-o">&gt;</span> <span class="tok-n">variants</span><span class="tok-o">)</span> <span class="tok-o">{...}</span>
  <span class="tok-kd">public</span> <span class="tok-kd">static</span> <span class="tok-n">ResponseBuilder</span> <span class="tok-nf">fromResponse</span><span class="tok-o">(</span><span class="tok-n">Response</span> <span class="tok-n">response</span><span class="tok-o">)</span> <span class="tok-o">{...}</span>
  <span class="tok-o">...</span>
<span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Veamos por ejemplo el mÃ©todo <code>ok()</code>:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>ResponseBuilder ok(Object entity, MediaType type) {...}</pre>
</div>
</div>
<div class="paragraph">
<p>Este mÃ©todo recibe como parÃ¡metros un objeto Java que queremos convertir en una respuesta
HTTP y el <code>Content-Type</code> de dicha respuesta. Como valor de retorno se obtiene una instancia de
tipo <code>ResponseBuilder</code> pre-inicializada con un cÃ³digo de estado de <code>200 OK</code>.</p>
</div>
<div class="paragraph">
<p>El mÃ©todo <code>created()</code> devuelve un <em>ResponseBuilder</em> para un recurso creado, y
asigna a la cabecera <code>Location</code> de la respuesta el valor de la URI proporionado
como parÃ¡metro.</p>
</div>
<div class="paragraph">
<p>La clase <code>ResponseBuilder</code> es una factorÃ­a utilizada para crear instancias individuales
de tipo <code>Response</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span class="tok-kd">public</span> <span class="tok-kd">static</span> <span class="tok-kd">abstract</span> <span class="tok-kd">class</span> <span class="tok-nc">ResponseBuilder</span> <span class="tok-o">{</span>
  <span class="tok-kd">public</span> <span class="tok-kd">abstract</span> <span class="tok-n">Response</span> <span class="tok-nf">build</span><span class="tok-o">();</span>
  <span class="tok-kd">public</span> <span class="tok-kd">abstract</span> <span class="tok-n">ResponseBuilder</span> <span class="tok-nf">clone</span><span class="tok-o">();</span>

  <span class="tok-kd">public</span> <span class="tok-kd">abstract</span> <span class="tok-n">ResponseBuilder</span> <span class="tok-nf">status</span><span class="tok-o">(</span><span class="tok-kt">int</span> <span class="tok-n">status</span><span class="tok-o">);</span>
  <span class="tok-kd">public</span> <span class="tok-n">ResponseBuilder</span> <span class="tok-nf">status</span><span class="tok-o">(</span><span class="tok-n">Status</span> <span class="tok-n">status</span><span class="tok-o">)</span> <span class="tok-o">{...}</span>

  <span class="tok-kd">public</span> <span class="tok-kd">abstract</span> <span class="tok-n">ResponseBuilder</span> <span class="tok-nf">entity</span><span class="tok-o">(</span><span class="tok-n">Object</span> <span class="tok-n">entity</span><span class="tok-o">);</span>
  <span class="tok-kd">public</span> <span class="tok-kd">abstract</span> <span class="tok-n">ResponseBuilder</span> <span class="tok-nf">type</span><span class="tok-o">(</span><span class="tok-n">MediaType</span> <span class="tok-n">type</span><span class="tok-o">);</span>
  <span class="tok-kd">public</span> <span class="tok-kd">abstract</span> <span class="tok-n">ResponseBuilder</span> <span class="tok-nf">type</span><span class="tok-o">(</span><span class="tok-n">String</span> <span class="tok-n">type</span><span class="tok-o">);</span>

  <span class="tok-kd">public</span> <span class="tok-kd">abstract</span> <span class="tok-n">ResponseBuilder</span> <span class="tok-nf">variant</span><span class="tok-o">(</span><span class="tok-n">Variant</span> <span class="tok-n">variant</span><span class="tok-o">);</span>
  <span class="tok-kd">public</span> <span class="tok-kd">abstract</span> <span class="tok-n">ResponseBuilder</span> <span class="tok-nf">variants</span><span class="tok-o">(</span><span class="tok-n">List</span><span class="tok-o">&lt;</span><span class="tok-n">Variant</span><span class="tok-o">&gt;</span> <span class="tok-n">variants</span><span class="tok-o">);</span>

  <span class="tok-kd">public</span> <span class="tok-kd">abstract</span> <span class="tok-n">ResponseBuilder</span> <span class="tok-nf">language</span><span class="tok-o">(</span><span class="tok-n">String</span> <span class="tok-n">language</span><span class="tok-o">);</span>
  <span class="tok-kd">public</span> <span class="tok-kd">abstract</span> <span class="tok-n">ResponseBuilder</span> <span class="tok-nf">language</span><span class="tok-o">(</span><span class="tok-n">Locale</span> <span class="tok-n">language</span><span class="tok-o">);</span>

  <span class="tok-kd">public</span> <span class="tok-kd">abstract</span> <span class="tok-n">ResponseBuilder</span> <span class="tok-nf">location</span><span class="tok-o">(</span><span class="tok-n">URI</span> <span class="tok-n">location</span><span class="tok-o">);</span>
  <span class="tok-kd">public</span> <span class="tok-kd">abstract</span> <span class="tok-n">Response</span><span class="tok-o">.</span><span class="tok-na">ResponseBuilder</span> <span class="tok-nf">header</span><span class="tok-o">(</span><span class="tok-n">String</span> <span class="tok-n">name</span><span class="tok-o">,</span> <span class="tok-n">Object</span> <span class="tok-n">value</span><span class="tok-o">)</span>
  <span class="tok-kd">public</span> <span class="tok-kd">abstract</span> <span class="tok-n">Response</span><span class="tok-o">.</span><span class="tok-na">ResponseBuilder</span> <span class="tok-nf">link</span><span class="tok-o">(</span><span class="tok-n">URI</span> <span class="tok-n">uri</span><span class="tok-o">,</span> <span class="tok-n">String</span> <span class="tok-n">rel</span><span class="tok-o">)</span>
  <span class="tok-kd">public</span> <span class="tok-kd">abstract</span> <span class="tok-n">Response</span><span class="tok-o">.</span><span class="tok-na">ResponseBuilder</span> <span class="tok-nf">link</span><span class="tok-o">(</span><span class="tok-n">String</span> <span class="tok-n">uri</span><span class="tok-o">,</span> <span class="tok-n">String</span> <span class="tok-n">rel</span><span class="tok-o">)</span>
  <span class="tok-o">...</span>
<span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Vamos a mostrar un ejemplo sobre cÃ³mo crear respuestas utilizando un objeto <code>Response</code>.
En este caso el mÃ©todo <code>getLibro()</code> devuelve un <code>String</code> que representa el libro en el que
estÃ¡ interesado nuestro cliente:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span class="tok-nd">@Path</span><span class="tok-o">(</span><span class="tok-s">&quot;/libro&quot;</span><span class="tok-o">)</span>
<span class="tok-kd">public</span> <span class="tok-kd">class</span> <span class="tok-nc">LibroServicio</span> <span class="tok-o">{</span>
  <span class="tok-nd">@GET</span>
  <span class="tok-nd">@Path</span><span class="tok-o">(</span><span class="tok-s">&quot;/restfuljava&quot;</span><span class="tok-o">)</span>
  <span class="tok-nd">@Produces</span><span class="tok-o">(</span><span class="tok-s">&quot;text/plain&quot;</span><span class="tok-o">)</span>
  <span class="tok-kd">public</span> <span class="tok-n">Response</span> <span class="tok-nf">getLibro</span><span class="tok-o">()</span> <span class="tok-o">{</span>
    <span class="tok-n">String</span> <span class="tok-n">libro</span> <span class="tok-o">=</span> <span class="tok-o">...;</span> <i class="conum" data-value="1"></i><b>(1)</b>
    <span class="tok-n">ResponseBuilder</span> <span class="tok-n">builder</span> <span class="tok-o">=</span> <span class="tok-n">Response</span><span class="tok-o">.</span><span class="tok-na">ok</span><span class="tok-o">(</span><span class="tok-n">libro</span><span class="tok-o">);</span> <i class="conum" data-value="2"></i><b>(2)</b>
    <span class="tok-n">builder</span><span class="tok-o">.</span><span class="tok-na">language</span><span class="tok-o">(</span><span class="tok-s">&quot;fr&quot;</span><span class="tok-o">).</span><span class="tok-na">header</span><span class="tok-o">(</span><span class="tok-s">&quot;Some-Header&quot;</span><span class="tok-o">,</span> <span class="tok-s">&quot;some value&quot;</span><span class="tok-o">);</span> <i class="conum" data-value="3"></i><b>(3)</b>
    <span class="tok-k">return</span> <span class="tok-n">builder</span><span class="tok-o">.</span><span class="tok-na">build</span><span class="tok-o">();</span> <i class="conum" data-value="4"></i><b>(4)</b>
  <span class="tok-o">}</span>
<span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Recuperamos los datos del libro solicitado. En este caso vamos a devolver
una cadena de caracteres que representa el libro en el que estamos interesados.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Inicializamos el cuerpo de la respuesta utilizando
el mÃ©todo <code>Response.ok()</code>. El cÃ³digo de estado de <code>ResponseBuilder</code> se inicializa
de forma automÃ¡tica con 200.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Usamos el mÃ©todo <code>ResponseBuilder.language()</code> para
asignar el valor de la cabecera <code>Content-Languaje</code> a <em>francÃ©s</em>. TambiÃ©n usamos el mÃ©todo
<code>ResponseBuilder.header()</code> para asignar un valor concreto a otra cabecera.</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Finalmente, creamos y devolvemos el objeto <code>Response</code> usando el mÃ©todo <code>ResponseBuilder.build()</code>.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Un detalle que es interesante destacar en este cÃ³digo es que <strong>no</strong> indicamos ningÃºn
 valor para el <code>Content-Type</code> de la respuesta. Debido a que ya hemos especificado esta
 informaciÃ³n en la anotaciÃ³n <code>@Produces</code> del mÃ©todo, el <em>runtime</em> de JAX-RS devolverÃ¡
 el valor adecuado del <em>media type</em> de la respuesta por nosotros.</p>
</div>
<div class="sect4">
<h5 id="_inclusiÃ³n_de_em_cookies_em_en_la_respuesta">InclusiÃ³n de <em>cookies</em> en la respuesta</h5>
<div class="paragraph">
<p>JAX-RS proporciona la clase <code>javax.ws.rs.core.NewCookie</code>, que utilizaremos para
crear nuevos valores de <em>cookies</em> y enviarlos en las respuestas.</p>
</div>
<div class="paragraph">
<p>Para poder incluir las <em>cookies</em> en nuestro objeto <code>Response</code>, primero crearemos las
instancias correspondientes de tipo <code>NewCookie</code> las pasaremos al mÃ©todo <code>ResponseBuilder.cookie()</code>.
Por ejemplo:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span class="tok-nd">@Path</span><span class="tok-o">(</span><span class="tok-s">&quot;/myservice&quot;</span><span class="tok-o">)</span>
<span class="tok-kd">public</span> <span class="tok-kd">class</span> <span class="tok-nc">MyService</span> <span class="tok-o">{</span>
  <span class="tok-nd">@GET</span>
  <span class="tok-kd">public</span> <span class="tok-n">Response</span> <span class="tok-nf">get</span><span class="tok-o">()</span> <span class="tok-o">{</span>
     <span class="tok-n">NewCookie</span> <span class="tok-n">cookie</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-nf">NewCookie</span><span class="tok-o">(</span><span class="tok-s">&quot;nombre&quot;</span><span class="tok-o">,</span> <span class="tok-s">&quot;pepe&quot;</span><span class="tok-o">);</span> <i class="conum" data-value="1"></i><b>(1)</b>
     <span class="tok-n">ResponseBuilder</span> <span class="tok-n">builder</span> <span class="tok-o">=</span> <span class="tok-n">Response</span><span class="tok-o">.</span><span class="tok-na">ok</span><span class="tok-o">(</span><span class="tok-s">&quot;hola&quot;</span><span class="tok-o">,</span> <span class="tok-s">&quot;text/plain&quot;</span><span class="tok-o">);</span> <i class="conum" data-value="2"></i><b>(2)</b>
     <span class="tok-k">return</span> <span class="tok-n">builder</span><span class="tok-o">.</span><span class="tok-na">cookie</span><span class="tok-o">(</span><span class="tok-n">cookie</span><span class="tok-o">).</span><span class="tok-na">build</span><span class="tok-o">();</span>
<span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Creamos una nueva <em>cookie</em> con el nombre de clave <code>nombre</code> y le asignamos el
valor <code>pepe</code></td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>En este caso, al no indicar el tipo mime de la respuesta con la anotaciÃ³n @Produces,
necesitamos indicarlo (en este caso como un parÃ¡metro del mÃ©todo <code>ok()</code>)</td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="_el_tipo_enumerado_de_cÃ³digos_de_estado">El tipo enumerado de cÃ³digos de estado</h5>
<div class="paragraph">
<p>JAX-RS proporciona el tipo enumerado <code>javax.ws.rs.core.Status</code> para representar cÃ³digos de respuesta
especÃ­ficos:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span class="tok-kd">public</span> <span class="tok-kd">enum</span> <span class="tok-n">Status</span> <span class="tok-o">{</span>
  <span class="tok-n">OK</span><span class="tok-o">(</span><span class="tok-mi">200</span><span class="tok-o">,</span> <span class="tok-s">&quot;OK&quot;</span><span class="tok-o">),</span>
  <span class="tok-n">CREATED</span><span class="tok-o">(</span><span class="tok-mi">201</span><span class="tok-o">,</span> <span class="tok-s">&quot;Created&quot;</span><span class="tok-o">),</span>
  <span class="tok-n">ACCEPTED</span><span class="tok-o">(</span><span class="tok-mi">202</span><span class="tok-o">,</span> <span class="tok-s">&quot;Accepted&quot;</span><span class="tok-o">),</span>
  <span class="tok-n">NO_CONTENT</span><span class="tok-o">(</span><span class="tok-mi">204</span><span class="tok-o">,</span> <span class="tok-s">&quot;No Content&quot;</span><span class="tok-o">),</span>
  <span class="tok-n">MOVED_PERMANENTLY</span><span class="tok-o">(</span><span class="tok-mi">301</span><span class="tok-o">,</span> <span class="tok-s">&quot;Moved Permanently&quot;</span><span class="tok-o">),</span>
  <span class="tok-n">SEE_OTHER</span><span class="tok-o">(</span><span class="tok-mi">303</span><span class="tok-o">,</span> <span class="tok-s">&quot;See Other&quot;</span><span class="tok-o">),</span>
  <span class="tok-n">NOT_MODIFIED</span><span class="tok-o">(</span><span class="tok-mi">304</span><span class="tok-o">,</span> <span class="tok-s">&quot;Not Modified&quot;</span><span class="tok-o">),</span>
  <span class="tok-n">TEMPORARY_REDIRECT</span><span class="tok-o">(</span><span class="tok-mi">307</span><span class="tok-o">,</span> <span class="tok-s">&quot;Temporary Redirect&quot;</span><span class="tok-o">),</span>
  <span class="tok-n">BAD_REQUEST</span><span class="tok-o">(</span><span class="tok-mi">400</span><span class="tok-o">,</span> <span class="tok-s">&quot;Bad Request&quot;</span><span class="tok-o">),</span>
  <span class="tok-n">UNAUTHORIZED</span><span class="tok-o">(</span><span class="tok-mi">401</span><span class="tok-o">,</span> <span class="tok-s">&quot;Unauthorized&quot;</span><span class="tok-o">),</span>
  <span class="tok-n">FORBIDDEN</span><span class="tok-o">(</span><span class="tok-mi">403</span><span class="tok-o">,</span> <span class="tok-s">&quot;Forbidden&quot;</span><span class="tok-o">),</span>
  <span class="tok-n">NOT_FOUND</span><span class="tok-o">(</span><span class="tok-mi">404</span><span class="tok-o">,</span> <span class="tok-s">&quot;Not Found&quot;</span><span class="tok-o">),</span>
  <span class="tok-n">NOT_ACCEPTABLE</span><span class="tok-o">(</span><span class="tok-mi">406</span><span class="tok-o">,</span> <span class="tok-s">&quot;Not Acceptable&quot;</span><span class="tok-o">),</span>
  <span class="tok-n">CONFLICT</span><span class="tok-o">(</span><span class="tok-mi">409</span><span class="tok-o">,</span> <span class="tok-s">&quot;Conflict&quot;</span><span class="tok-o">),</span>
  <span class="tok-n">GONE</span><span class="tok-o">(</span><span class="tok-mi">410</span><span class="tok-o">,</span> <span class="tok-s">&quot;Gone&quot;</span><span class="tok-o">),</span>
  <span class="tok-n">PRECONDITION_FAILED</span><span class="tok-o">(</span><span class="tok-mi">412</span><span class="tok-o">,</span> <span class="tok-s">&quot;Precondition Failed&quot;</span><span class="tok-o">),</span>
  <span class="tok-n">UNSUPPORTED_MEDIA_TYPE</span><span class="tok-o">(</span><span class="tok-mi">415</span><span class="tok-o">,</span> <span class="tok-s">&quot;Unsupported Media Type&quot;</span><span class="tok-o">),</span>
  <span class="tok-n">INTERNAL_SERVER_ERROR</span><span class="tok-o">(</span><span class="tok-mi">500</span><span class="tok-o">,</span> <span class="tok-s">&quot;Internal Server Error&quot;</span><span class="tok-o">),</span>
  <span class="tok-n">NOT_IMPLEMENTED</span><span class="tok-o">(</span><span class="tok-mi">501</span><span class="tok-o">,</span> <span class="tok-s">&quot;Not Implemented&quot;</span><span class="tok-o">),</span>
  <span class="tok-n">SERVICE_UNAVAILABLE</span><span class="tok-o">(</span><span class="tok-mi">503</span><span class="tok-o">,</span> <span class="tok-s">&quot;Service Unavailable&quot;</span><span class="tok-o">);</span>
  <span class="tok-kd">public</span> <span class="tok-kd">enum</span> <span class="tok-n">Family</span> <span class="tok-o">{</span>
     <span class="tok-n">INFORMATIONAL</span><span class="tok-o">,</span> <span class="tok-n">SUCCESSFUL</span><span class="tok-o">,</span> <span class="tok-n">REDIRECTION</span><span class="tok-o">,</span>
     <span class="tok-n">CLIENT_ERROR</span><span class="tok-o">,</span> <span class="tok-n">SERVER_ERROR</span><span class="tok-o">,</span> <span class="tok-n">OTHER</span>
  <span class="tok-o">}</span>

  <span class="tok-kd">public</span> <span class="tok-n">Family</span> <span class="tok-nf">getFamily</span><span class="tok-o">()</span>
  <span class="tok-kd">public</span> <span class="tok-kt">int</span> <span class="tok-nf">getStatusCode</span><span class="tok-o">()</span>
  <span class="tok-kd">public</span> <span class="tok-kd">static</span> <span class="tok-n">Status</span> <span class="tok-nf">fromStatusCode</span><span class="tok-o">(</span><span class="tok-kd">final</span> <span class="tok-kt">int</span> <span class="tok-n">statusCode</span><span class="tok-o">)</span>
<span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Cada valor del tipo <code>Status</code> se asocia con una familia especÃ­fica de cÃ³digos
de respuesta HTTP. Estas familias se identifican por el enumerado <code>Status.Family</code>:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Los cÃ³digos en el rango del <strong>100</strong> se consideran <strong>informacionales</strong></p>
</li>
<li>
<p>Los cÃ³digos en el rango del <strong>200</strong> se consideran <strong>exitosos</strong></p>
</li>
<li>
<p>Los cÃ³digos en el rango del <strong>300</strong> son cÃ³digos con Ã©xito pero dentro de la
categorÃ­a <strong>redirecciÃ³n</strong></p>
</li>
<li>
<p>Los cÃ³digos de error pertenecen a los ragos 400 y 500. En el rango de <strong>400</strong> se
consideran <strong>errores del cliente</strong> y en el rango de <strong>500</strong> son <strong>errores del servidor</strong></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Tanto el mÃ©todo <code>Response.status()</code> como <code>ResponseBuilder.status()</code> pueden aceptar
un valor enumerado de tipo <code>Status</code>. Por ejemplo:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span class="tok-nd">@DELETE</span>
<span class="tok-n">Response</span> <span class="tok-nf">delete</span><span class="tok-o">()</span> <span class="tok-o">{</span>
  <span class="tok-o">...</span>
  <span class="tok-k">return</span> <span class="tok-n">Response</span><span class="tok-o">.</span><span class="tok-na">status</span><span class="tok-o">(</span><span class="tok-n">Status</span><span class="tok-o">.</span><span class="tok-na">GONE</span><span class="tok-o">).</span><span class="tok-na">build</span><span class="tok-o">();</span>
<span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>En este caso, estamos indicando al cliente que lo que queremos borrar ya no existe (410).</p>
</div>
</div>
<div class="sect4">
<h5 id="_la_clase_javax_ws_rs_core_genericentity">La clase javax.ws.rs.core.GenericEntity</h5>
<div class="paragraph">
<p>Cuando estamos creando objetos de tipo <code>Response</code>, se nos plantea un problema cuando
queremos devolver tipos genÃ©ricos, ya que el manejador JAXB necesita extraer la
informaciÃ³n del tipo parametrizado de la respuesta en tiempo de ejecuciÃ³n. Para estos
casos, JAX-RS proporciona la clase <code>javax.ws.rs.core.GenericEntity</code>. Veamos su uso con
un ejemplo:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span class="tok-nd">@GET</span>
<span class="tok-nd">@Produces</span><span class="tok-o">(</span><span class="tok-s">&quot;application/xml&quot;</span><span class="tok-o">)</span>
<span class="tok-kd">public</span> <span class="tok-n">Response</span> <span class="tok-nf">getListaClientes</span><span class="tok-o">()</span> <span class="tok-o">{</span>
  <span class="tok-n">List</span><span class="tok-o">&lt;</span><span class="tok-n">Cliente</span><span class="tok-o">&gt;</span> <span class="tok-n">list</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">ArrayList</span><span class="tok-o">&lt;</span><span class="tok-n">Cliente</span><span class="tok-o">&gt;();</span>
  <span class="tok-n">list</span><span class="tok-o">.</span><span class="tok-na">add</span><span class="tok-o">(</span><span class="tok-k">new</span> <span class="tok-nf">Cliente</span><span class="tok-o">(...));</span>

  <span class="tok-n">GenericEntity</span> <span class="tok-n">entity</span> <span class="tok-o">=</span>
    <span class="tok-k">new</span> <span class="tok-n">GenericEntity</span><span class="tok-o">&lt;</span><span class="tok-n">List</span><span class="tok-o">&lt;</span><span class="tok-n">Cliente</span><span class="tok-o">&gt;&gt;(</span><span class="tok-n">list</span><span class="tok-o">){};</span> <i class="conum" data-value="1"></i><b>(1)</b>

  <span class="tok-k">return</span> <span class="tok-n">Response</span><span class="tok-o">.</span><span class="tok-na">ok</span><span class="tok-o">(</span><span class="tok-n">entity</span><span class="tok-o">).</span><span class="tok-na">build</span><span class="tok-o">();</span>
<span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>La clase <code>GenericEntity</code> es tambiÃ©n una clase genÃ©rica. Lo que hacemos es crear
una clase anÃ³nima que extiende <code>GenericEntity</code>, inicializando la "plantilla" de
<code>GenericEntity</code> con el tipo genÃ©rico que estemos utilizando.</td>
</tr>
</table>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_manejadores_de_excepciones">3.6. Manejadores de excepciones</h3>
<div class="paragraph">
<p>Vamos a explicar cÃ³mo podemos tratar las excepciones en nuestros servicios
RESTful.</p>
</div>
<div class="paragraph">
<p>Los errores pueden enviarse al cliente, bien creando y devolviendo el objeto
<code>Response</code> adecuado, o lanzando una excepciÃ³n. Podemos lanzar cualquier tipo de excepciÃ³n,
tanto las denominadas <em>checked</em> (clases que heredan de <code>java.lang.Exception</code>), como las
excepciones <em>unchecked</em> (clases que extienden <code>java.lang.RuntimeException</code>).
Las excepciones generadas son manejadas por el <em>runtime</em> de JAX-RS si tenemos registrado
un <em>mapper</em> de excepciones. Dichos <em>mappers</em> (o mapeadores) de excepciones pueden convertir
una excepciÃ³n en una respuesta HTTP. Si las excepciones no estÃ¡n gestionadas por un
<em>mapper</em>, Ã©stas se propagan y se gestionan por el contenedor (de <em>servlets</em>)
en el que se estÃ¡ ejecutando JAX-RS. JAX-RS proporciona tambiÃ©n la clase
<code>javax.ws.rs.WebApplicationException</code>. Esta excepciÃ³n puede lanzarse por el cÃ³digo
de nuestra aplicaciÃ³n y serÃ¡ procesado automÃ¡ticamente por JAX-RS sin necesidad de
disponer de forma explÃ­cita de ningÃºn <em>mapper</em>. Vamos a ver cÃ³mo utilizar esta clase.</p>
</div>
<div class="sect3">
<h4 id="_la_clase_javax_ws_rs_webapplicationexception">3.6.1. La clase javax.ws.rs.WebApplicationException</h4>
<div class="paragraph">
<p>JAX-RS incluye una excepciÃ³n <em>unchecked</em> que podemos lanzar desde nuestra aplicaciÃ³n
RESTful (ver la documentaciÃ³n del
<a href="http://docs.oracle.com/javaee/7/api/javax/ws/rs/WebApplicationException.html" class="bare">http://docs.oracle.com/javaee/7/api/javax/ws/rs/WebApplicationException.html</a> [API]).
Esta excepciÃ³n se puede pre-inicializar con un objeto <code>Response</code>, o con
un cÃ³digo de estado particular:</p>
</div>
<div class="listingblock">
<div class="title">Clase javax.ws.rs.WebApplicationException</div>
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span class="tok-kd">public</span> <span class="tok-kd">class</span> <span class="tok-nc">WebApplicationException</span> <span class="tok-kd">extends</span> <span class="tok-n">RuntimeException</span> <span class="tok-o">{</span>
  <span class="tok-c1">//Constructores</span>
  <span class="tok-kd">public</span> <span class="tok-nf">WebApplicationException</span><span class="tok-o">()</span> <span class="tok-o">{...}</span>
  <span class="tok-kd">public</span> <span class="tok-nf">WebApplicationException</span><span class="tok-o">(</span><span class="tok-n">Response</span> <span class="tok-n">response</span><span class="tok-o">)</span> <span class="tok-o">{...}</span> <i class="conum" data-value="1"></i><b>(1)</b>
  <span class="tok-kd">public</span> <span class="tok-nf">WebApplicationException</span><span class="tok-o">(</span><span class="tok-kt">int</span> <span class="tok-n">status</span><span class="tok-o">)</span> <span class="tok-o">{...}</span>
  <span class="tok-kd">public</span> <span class="tok-nf">WebApplicationException</span><span class="tok-o">(</span><span class="tok-n">Response</span><span class="tok-o">.</span><span class="tok-na">Status</span> <span class="tok-n">status</span><span class="tok-o">)</span> <span class="tok-o">{...}</span> <i class="conum" data-value="2"></i><b>(2)</b>
  <span class="tok-kd">public</span> <span class="tok-nf">WebApplicationException</span><span class="tok-o">(</span><span class="tok-n">String</span> <span class="tok-n">message</span><span class="tok-o">)</span> <i class="conum" data-value="3"></i><b>(3)</b>
  <span class="tok-kd">public</span> <span class="tok-nf">WebApplicationException</span><span class="tok-o">(</span><span class="tok-n">Throwable</span> <span class="tok-n">cause</span><span class="tok-o">)</span> <span class="tok-o">{...}</span>
  <span class="tok-kd">public</span> <span class="tok-nf">WebApplicationException</span><span class="tok-o">(</span><span class="tok-n">Throwable</span> <span class="tok-n">cause</span><span class="tok-o">,</span> <span class="tok-n">Response</span> <span class="tok-n">response</span><span class="tok-o">)</span> <span class="tok-o">{...}</span>
  <span class="tok-kd">public</span> <span class="tok-nf">WebApplicationException</span><span class="tok-o">(</span><span class="tok-n">Throwable</span> <span class="tok-n">cause</span><span class="tok-o">,</span> <span class="tok-kt">int</span> <span class="tok-n">status</span><span class="tok-o">)</span> <span class="tok-o">{...}</span>
  <span class="tok-kd">public</span> <span class="tok-nf">WebApplicationException</span><span class="tok-o">(</span><span class="tok-n">Throwable</span> <span class="tok-n">cause</span><span class="tok-o">,</span> <span class="tok-n">Response</span><span class="tok-o">.</span><span class="tok-na">Status</span> <span class="tok-n">status</span><span class="tok-o">)</span> <span class="tok-o">{...}</span>

  <span class="tok-kd">public</span> <span class="tok-n">Response</span> <span class="tok-nf">getResponse</span><span class="tok-o">()</span> <span class="tok-o">{...]</span>
<span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Podemos crear una instancia a partir de un objeto Response</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>CreaciÃ³n de una instancia a partir de un cÃ³digo de estado</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>CreaciÃ³n de una instancia a partir de un <em>String</em>. Por defecto se incluye el
cÃ³digo de estado 500. El <em>String</em> que se pasa como parÃ¡metro se almacena para su
posterior recuperaciÃ³n a travÃ©s del mensaje `getMessage()</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Cuando JAX-RS detecta que se ha lanzado la excepciÃ³n <code>WebApplicationException</code>,
la captura y realiza una llamada al mÃ©todo <code>WebApplicationException.getResponse()</code>
para obtener un objeto
<code>Response</code> que enviarÃ¡ al cliente. Si la aplicaciÃ³n ha inicializado la excepciÃ³n
<code>WebApplicationException</code> con un cÃ³digo de estado, o un objeto <code>Response</code>, dicho
cÃ³digo o <code>Response</code> se utilizarÃ¡n para crear la respuesta HTTP real. En otro caso,
la excepciÃ³n <code>WebApplicationException</code> devolverÃ¡ el cliente el cÃ³digo de respuesta
"500 Internal Server Error".</p>
</div>
<div class="paragraph">
<p>Por ejemplo, supongamos que tenemos un servicio web que permite a los usuarios
solicitar informaciÃ³n de nuestros clientes, utilizando una representaciÃ³n XML:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span class="tok-nd">@Path</span><span class="tok-o">(</span><span class="tok-s">&quot;/clientes&quot;</span><span class="tok-o">)</span>
<span class="tok-kd">public</span> <span class="tok-kd">class</span> <span class="tok-nc">ClienteResource</span> <span class="tok-o">{</span>
  <span class="tok-nd">@GET</span>
  <span class="tok-nd">@Path</span><span class="tok-o">(</span><span class="tok-s">&quot;{id}&quot;</span><span class="tok-o">)</span>
  <span class="tok-nd">@Produces</span><span class="tok-o">(</span><span class="tok-s">&quot;application/xml&quot;</span><span class="tok-o">)</span>
  <span class="tok-kd">public</span> <span class="tok-n">Cliente</span> <span class="tok-nf">getCliente</span><span class="tok-o">(</span><span class="tok-nd">@PathParam</span><span class="tok-o">(</span><span class="tok-s">&quot;id&quot;</span><span class="tok-o">)</span> <span class="tok-kt">int</span> <span class="tok-n">id</span><span class="tok-o">)</span> <span class="tok-o">{</span>
     <span class="tok-n">Cliente</span> <span class="tok-n">cli</span> <span class="tok-o">=</span> <span class="tok-n">recuperarCliente</span><span class="tok-o">(</span><span class="tok-n">id</span><span class="tok-o">);</span>
     <span class="tok-k">if</span> <span class="tok-o">(</span><span class="tok-n">cli</span> <span class="tok-o">==</span> <span class="tok-kc">null</span><span class="tok-o">)</span> <span class="tok-o">{</span>
          <span class="tok-k">throw</span> <span class="tok-k">new</span> <span class="tok-nf">WebApplicationException</span><span class="tok-o">(</span><span class="tok-n">Response</span><span class="tok-o">.</span><span class="tok-na">Status</span><span class="tok-o">.</span><span class="tok-na">NOT_FOUND</span><span class="tok-o">);</span>
     <span class="tok-o">}</span>
     <span class="tok-k">return</span> <span class="tok-n">cli</span><span class="tok-o">;</span>
  <span class="tok-o">}</span>
<span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>En este ejemplo, si no encontramos una instancia de <code>Cliente</code> con el <code>id</code>
proporcionado, lanzaremos una <code>WebApplicationException</code> que provocarÃ¡ que
se le envÃ­e al cliente como cÃ³digo de respuesta "404 Not Found".</p>
</div>
</div>
<div class="sect3">
<h4 id="_mapeado_de_excepciones">3.6.2. Mapeado de excepciones</h4>
<div class="paragraph">
<p>Normalmente, las aplicaciones tienen que "tratar" con multitud de excepciones
lanzadas desde nuestro cÃ³digo de aplicaciÃ³n o por <em>frameworks</em> de terceros.
Dejar que el <em>servlet</em> JAX-RS que reside en el servidor maneje la excepciÃ³n no nos
proporciona demasiada flexibilidad. Si capturamos y "redirigimos" todas
estas excepciones a <code>WebApplicationException</code> podrÃ­a resultar bastante tedioso.
De forma alternativa, podemos implementar y registrar instancias de <code>javax.ws.rs.ext.ExceptionMapper</code>.
Estos objetos "saben" cÃ³mo mapear una excepciÃ³n lanzada por la aplicaciÃ³n a un
objeto <code>Response</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span class="tok-kd">public</span> <span class="tok-kd">interface</span> <span class="tok-nc">ExceptionMapper</span><span class="tok-o">&lt;</span><span class="tok-n">E</span> <span class="tok-kd">extends</span> <span class="tok-n">Throwable</span><span class="tok-o">&gt;</span> <span class="tok-o">{</span>
<span class="tok-o">{</span>
   <span class="tok-n">Response</span> <span class="tok-nf">toResponse</span><span class="tok-o">(</span><span class="tok-n">E</span> <span class="tok-n">exception</span><span class="tok-o">);</span>
<span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Las clases que implementan la interfaz <code>ExceptionMapper&lt;T&gt;</code> son
 "proveedores de mappings de excepciones" (<em>Exception Mapping Providers</em>) y
mapean una excepciÃ³n <em>runtime</em> o <em>checked</em> a una instancia de <code>Response</code>.</p>
</div>
<div class="paragraph">
<p>Cuando un recurso JAX-RS lanza una excepciÃ³n para la que existe un proveedor de
mapping de excepciones, Ã©ste Ãºltimo se utiliza para devolver una instancia de <code>Response</code>.
 Esta respuesta resultante se procesa como si hubiese sido generada por el recurso.</p>
</div>
<div class="paragraph">
<p>Por ejemplo, una excepciÃ³n bastante utilizada por aplicaciones de bases de datos
que utilizan JPA (<strong>J</strong>ava <strong>P</strong>ersistence <strong>A</strong>pi) es <code>javax.persistence.EntityNotFoundException</code>.
Esta excepciÃ³n se lanza cuando JPA no puede encontrar un objeto particular en la base
de datos. En lugar de escribir cÃ³digo que maneje dicha excepciÃ³n de forma explÃ­cita,
podemos escribir un <code>ExceptionMapper</code> para que gestione dicha excepciÃ³n por nosotros.
VeÃ¡mos cÃ³mo:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span class="tok-nd">@Provider</span> <i class="conum" data-value="1"></i><b>(1)</b>
<span class="tok-kd">public</span> <span class="tok-kd">class</span> <span class="tok-nc">EntityNotFoundMapper</span>
         <span class="tok-kd">implements</span> <span class="tok-n">ExceptionMapper</span><span class="tok-o">&lt;</span><span class="tok-n">EntityNotFoundException</span><span class="tok-o">&gt;</span> <span class="tok-o">{</span>  <i class="conum" data-value="2"></i><b>(2)</b>
   <span class="tok-kd">public</span> <span class="tok-n">Response</span> <span class="tok-nf">toResponse</span><span class="tok-o">(</span><span class="tok-n">EntityNotFoundException</span> <span class="tok-n">e</span><span class="tok-o">)</span> <span class="tok-o">{</span>  <i class="conum" data-value="3"></i><b>(3)</b>
      <span class="tok-k">return</span> <span class="tok-n">Response</span><span class="tok-o">.</span><span class="tok-na">status</span><span class="tok-o">(</span><span class="tok-n">Response</span><span class="tok-o">.</span><span class="tok-na">Status</span><span class="tok-o">.</span><span class="tok-na">NOT_FOUND</span><span class="tok-o">).</span><span class="tok-na">build</span><span class="tok-o">();</span>  <i class="conum" data-value="4"></i><b>(4)</b>
   <span class="tok-o">}</span>
<span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Nuestra implementaciÃ³n de <code>ExceptionMapper</code> debe anotarse con <code>@Provider</code>. Esto
le indica al <em>runtime</em> de JAX-RS que esta clase es un componente REST.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>La clase que implementa <code>ExceptionMapper</code> debe proporcionar el tipo que
se quiere parametrizar. JAX-RS utiliza esta informaciÃ³n para emparejar las
excepciones de tipo <code>EntityNotFoundException</code> con nuestra clase <code>EntityNotFoundMapper</code></td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>El mÃ©todo <code>toResponse()</code> recibe la excepciÃ³n lanzada y</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>crea un objeto <code>Response</code> que se utilizarÃ¡ para construir la respuesta HTTP</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Otro ejemplo es la excepciÃ³n <em>EJBException</em>, lanzada por aplicaciones que utilizan
EJBs.</p>
</div>
</div>
<div class="sect3">
<h4 id="_jerarquÃ­a_de_excepciones">3.6.3. JerarquÃ­a de excepciones</h4>
<div class="paragraph">
<p>JAX-RS 2.0 proporciona una jerarquÃ­a de excepciones para varias condiciones de
error para las peticiones HTTP. La idea es que, en lugar de crear una instancia
de <code>WebApplicationException</code> e inicializarla con un cÃ³digo de estado especÃ­fico,
podemos uilizar en su lugar una de las excepciones de la jeraquÃ­a (clases que heredan
de la clase <em>WebApplicationException</em>). Por ejemplo,
podemos cambiar el
cÃ³digo anterior que utilizaba <code>WebApplicationException</code>, y en su lugar, usar <code>javax.ws.rs.NotFoundException</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span class="tok-nd">@Path</span><span class="tok-o">(</span><span class="tok-s">&quot;/clientes&quot;</span><span class="tok-o">)</span>
<span class="tok-kd">public</span> <span class="tok-kd">class</span> <span class="tok-nc">ClienteResource</span> <span class="tok-o">{</span>
  <span class="tok-nd">@GET</span>
  <span class="tok-nd">@Path</span><span class="tok-o">(</span><span class="tok-s">&quot;{id}&quot;</span><span class="tok-o">)</span>
  <span class="tok-nd">@Produces</span><span class="tok-o">(</span><span class="tok-s">&quot;application/xml&quot;</span><span class="tok-o">)</span>
  <span class="tok-kd">public</span> <span class="tok-n">Cliente</span> <span class="tok-nf">getCliente</span><span class="tok-o">(</span><span class="tok-nd">@PathParam</span><span class="tok-o">(</span><span class="tok-s">&quot;id&quot;</span><span class="tok-o">)</span> <span class="tok-kt">int</span> <span class="tok-n">id</span><span class="tok-o">)</span> <span class="tok-o">{</span>
     <span class="tok-n">Cliente</span> <span class="tok-n">cli</span> <span class="tok-o">=</span> <span class="tok-n">recuperarCliente</span><span class="tok-o">(</span><span class="tok-n">id</span><span class="tok-o">);</span>
     <span class="tok-k">if</span> <span class="tok-o">(</span><span class="tok-n">cli</span> <span class="tok-o">==</span> <span class="tok-kc">null</span><span class="tok-o">)</span> <span class="tok-o">{</span>
          <span class="tok-k">throw</span> <span class="tok-k">new</span> <span class="tok-nf">NotFoundException</span><span class="tok-o">();</span>
     <span class="tok-o">}</span>
     <span class="tok-k">return</span> <span class="tok-n">cli</span><span class="tok-o">;</span>
  <span class="tok-o">}</span>
<span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Al igual que el resto de excepciones de la jerarquÃ­a, la excepciÃ³n <code>NotFoundException</code>
hereda de <code>WebApplicationException</code>. La siguiente tabla muestra algunas excepciones
que podemos utilizar, todas ellas del paquete <code>javax.ws.rs</code>. Las que incluyen un cÃ³digo de estado
en el rango de 400, son subclases de <code>ClientErrorException</code>, y como ya hemos indicado,
representan errores en las peticiones. Las que presentan un
cÃ³digo de estado en el rango de 500, son subclases de <code>ServerErrorException</code>, y representan
errores del servidor.</p>
</div>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 3. JerarquÃ­a de excepciones JAX-RS:</caption>
<colgroup>
<col style="width: 33%;">
<col style="width: 33%;">
<col style="width: 33%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">ExcepciÃ³n</th>
<th class="tableblock halign-left valign-top">CÃ³digo de estado</th>
<th class="tableblock halign-left valign-top">DescripciÃ³n</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">BadRequestException</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">400</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Mensaje mal formado</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">NotAuthorizedException</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">401</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Fallo de autenticaciÃ³n</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ForbiddenException</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">403</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Acceso no permitido</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">NotFoundException</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">404</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No se ha podido encontrar el recurso</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">NotAllowedException</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">405</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">MÃ©todo HTTP no soportado</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">NotAcceptableException</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">406</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>Media type</em> solicitado por el cliente no soportado (cabecera <strong>Accept</strong> de la
peticion)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">NotSupportedException</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">415</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">El cliente ha incluido un <em>Media type</em> no soportado (cabecera <strong>Content-Type</strong> de la
peticion)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">InternalServerErrorException</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">500</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Error general del servidor</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ServiceUnavailableException</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">503</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">El servidor estÃ¡ ocupado o temporalmente fuera de servicio</p></td>
</tr>
</tbody>
</table>
<div class="ulist">
<ul>
<li>
<p>La excepciÃ³n <code>BadRequestException</code> se utiliza cuando el cliente envÃ­a algo al servidor
que Ã©ste no puede interpretar. Ejemplos de escenarios concretos que provocan que el
<em>runtime</em> JAX-RS son: cuando una peticiÃ³n PUT o POST contiene un cuerpo del mensaje con
un documento XML o JSON mal formado, de forma que falle el "parsing" del documento, o cuando
no puede convertir un valor especificado en la cabecera o <em>cookie</em> al tipo deseado.
Por ejemplo:</p>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span class="tok-nd">@HeaderParam</span><span class="tok-o">(</span><span class="tok-s">&quot;Cabecera-Particular&quot;</span><span class="tok-o">)</span> <span class="tok-kt">int</span> <span class="tok-n">cabecera</span><span class="tok-o">;</span>
<span class="tok-nd">@CookieParam</span><span class="tok-o">(</span><span class="tok-s">&quot;miCookie&quot;</span><span class="tok-o">)</span> <span class="tok-kt">int</span> <span class="tok-n">cookie</span><span class="tok-o">;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Si el valor de la cabecera HTTP de la peticiÃ³n o el valor <code>miCookie</code> no puede
convertirse en un entero, se lanzarÃ¡ la excepciÃ³n <code>BadRequestException</code>.</p>
</div>
</li>
<li>
<p>La excepciÃ³n <code>NotAuthorizedException</code> (cÃ³digo <strong>401</strong>), se usa cuando queremos
escribir nuestros propios
protocolos de autorizaciÃ³n, y queremos indicar al cliente que Ã©ste necesita
autenticarse con el servidor.</p>
</li>
<li>
<p>La excepciÃ³n <code>ForbiddenException</code> (cÃ³digo <strong>403</strong>),se usa generalmente cuando el cliente realiza
una invocaciÃ³n para la que no tiene permisos de acceso. Esto  ocurre normalmente
debido a que el cliente no tiene el rol requerido.</p>
</li>
<li>
<p>La excepciÃ³n <code>NotFoundException</code> (cÃ³digo <strong>404</strong>), se usa cuando queremos comunicar al cliente que el
recurso que estÃ¡ solicitando no existe. Esta excepciÃ³n tambiÃ©n se generarÃ¡ de
forma automÃ¡tica por el <em>runtime</em> de JAX-RS cuando a Ã©ste no le sea posible
inyectar un valor en un @PathParam, @QueryParam, o @MatrixParam. Al igual que hemos
comentado para <code>BadRequestException</code> esto puede ocurrir si intentamos convertir
el valor del parÃ¡metro a un tipo que no admite esta conversiÃ³n.</p>
</li>
<li>
<p>La excepciÃ³n <code>NotAllowedException</code> (cÃ³digo <strong>405</strong>), se usa cuando el mÃ©todo HTTP que el cliente estÃ¡
intentando invocar no estÃ¡ soportado por el recurso al que el cliente estÃ¡ accediendo.
El <em>runtime</em> de JAX-RS lanza automÃ¡ticamente esta excepciÃ³n si no encuentra ningÃºn
mÃ©todo que pueda "emparejar" con el mÃ©todo HTTP invocado.</p>
</li>
<li>
<p>La excepciÃ³n <code>NotAcceptableException</code> (cÃ³digo <strong>406</strong>), se usa cuando un cliente estÃ¡ solicitando un
formato especÃ­fico a travÃ©s de la cabecera <code>Accept</code>. El <em>runtime</em> de JAX-RS lanza
automÃ¡ticamente esta excepciÃ³n si no hay un mÃ©todo con una anotaciÃ³n @Produces
que sea compatible con la cabecera <code>Accept</code> del cliente.</p>
</li>
<li>
<p>La excepciÃ³n <code>NotSupportedException</code> (cÃ³digo <strong>415</strong>),se usa cuando un cliente estÃ¡ enviando una
representaciÃ³n que el servidor no "comprende". El <em>runtime</em> de JAX-RS lanza
automÃ¡ticamente esta excepciÃ³n si no hay un mÃ©todo con una anotaciÃ³n @Consumes
que coincida con el valor de la cabecera <code>Content-Type</code> de la peticiÃ³n.</p>
</li>
<li>
<p>La excepciÃ³n <code>InternalServerErrorException</code> (cÃ³digo <strong>500</strong>),es una excepciÃ³n de propÃ³sito general
lanzada por el servidor. Si en nuestra aplicaciÃ³n queremos lanzar esta excepciÃ³n
deberÃ­amos hacerlo si se ha producido una condiciÃ³n de error que realmente no
"encaja" en ninguna de las situaciones que hemos visto. El <em>runtime</em> de JAX-RS lanza
automÃ¡ticamente esta excepciÃ³n si falla un <code>MessageBodyWriter</code> o si se lanza
alguna excepciÃ³n desde algÃºn <code>ExceptionMapper</code>.</p>
</li>
<li>
<p>La excepciÃ³n <code>ServiceUnavailableException</code> (cÃ³digo <strong>503</strong>),se usa cuando el servidor estÃ¡ ocupado
o temporalmente fuera de servicio. En la mayorÃ­a de los casos, es suficiente con que
el cliente vuelva a intentar realizar la llamada un tiempo mÃ¡s tarde.</p>
</li>
</ul>
</div>
<div style="page-break-after: always;"></div>
</div>
</div>
<div class="sect2">
<h3 id="_ejercicios">3.7. Ejercicios</h3>
<div class="sect3">
<h4 id="_servicio_rest_ejemplo">3.7.1. Servicio REST ejemplo</h4>
<div class="paragraph">
<p>Para familiarizarnos con las el uso de diferentes manejadores de contenidos y
manejo de excepciones proporcionamos el mÃ³dulo
el <strong>MÃDULO</strong> <strong>s3-ejemplo-rest</strong>, con la implementaciÃ³n de un servicio rest sencillo que podÃ©is
probar con la herramienta <strong>postman</strong>.</p>
</div>
<div class="paragraph">
<p>En el directorio <code>src/main/resources</code> de dicho mÃ³dulo tenÃ©is un fichero de
texto con las instrucciones (<em>instrucciones.txt</em>) para construir, desplegar y probar la aplicaciÃ³n de ejemplo.</p>
</div>
</div>
<div class="sect3">
<h4 id="_plantillas_que_se_proporcionan">3.7.2. Plantillas que se proporcionan</h4>
<div class="paragraph">
<p>Para esta sesiÃ³n proporcionamos un proyecto como plantilla con el nombre <code>s3-filmoteca</code>
que tendrÃ¡s utilizar como punto de partida para aplicar lo que hemos aprendido en esta
sesiÃ³n.</p>
</div>
<div class="paragraph">
<p>Se trata de una implementaciÃ³n parcial para gestionar una filmoteca con informaciÃ³n de
pelÃ­culas y actores.</p>
</div>
<div class="paragraph">
<p>La estructura lÃ³gica del proyecto proporcionado es la siguiente:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Paquete <code>org.expertojava.domain</code>: es la capa que contiene los objetos del dominio de la
aplicaciÃ³n.
  Por simplicidad, no usamos una base de datos real, sino que trabajamos con datos en
  memoria.</p>
</li>
<li>
<p>Paquete <code>org.expertojava.service</code>: contiene la implementaciÃ³n de los servicios de nuestra
aplicaciÃ³n, que serÃ¡n accedidos desde la capa rest</p>
</li>
<li>
<p>Paquete <code>org.expertojava.rest</code>: constituye la capa rest de nuestra aplicaciÃ³n. Esta capa es
cliente de la capa de servicios.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>En la carpeta <code>src/main/resources</code> tenÃ©is un fichero de texto (<em>instrucciones.txt</em>) con
informaciÃ³n detallada sobre el API rest implementado.</p>
</div>
</div>
<div class="sect3">
<h4 id="_uso_de_jaxb_0_5_puntos">3.7.3. Uso de JAXB (0,5 puntos)</h4>
<div class="paragraph">
<p>Utiliza las anotaciones JAXB oportunas para realizar el serializado de las entidades
java a xml y json, de forma que la lista de pelÃ­culas de la filmoteca en formato xml sea:</p>
</div>
<div class="listingblock">
<div class="title">PeticiÃ³n rest: GET /peliculas</div>
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span class="tok-o">&lt;?</span><span class="tok-n">xml</span> <span class="tok-n">version</span><span class="tok-o">=</span><span class="tok-s">&quot;1.0&quot;</span> <span class="tok-n">encoding</span><span class="tok-o">=</span><span class="tok-s">&quot;UTF-8&quot;</span> <span class="tok-n">standalone</span><span class="tok-o">=</span><span class="tok-s">&quot;yes&quot;</span><span class="tok-o">?&gt;</span>
<span class="tok-o">&lt;</span><span class="tok-n">peliculas</span><span class="tok-o">&gt;</span>
   <span class="tok-o">&lt;</span><span class="tok-n">pelicula</span> <span class="tok-n">duracion</span><span class="tok-o">=</span><span class="tok-s">&quot;120&quot;</span> <span class="tok-n">estreno</span><span class="tok-o">=</span><span class="tok-s">&quot;2015-12-08T00:00:00+01:00&quot;</span> <span class="tok-n">id</span><span class="tok-o">=</span><span class="tok-s">&quot;1&quot;</span><span class="tok-o">&gt;</span>
     <span class="tok-o">&lt;</span><span class="tok-n">director</span><span class="tok-o">&gt;</span><span class="tok-n">Stanley</span> <span class="tok-n">Kubrick</span><span class="tok-o">&lt;/</span><span class="tok-n">director</span><span class="tok-o">&gt;</span>
     <span class="tok-o">&lt;</span><span class="tok-n">titulo</span><span class="tok-o">&gt;</span><span class="tok-n">El</span> <span class="tok-n">resplandor</span><span class="tok-o">&lt;/</span><span class="tok-n">titulo</span><span class="tok-o">&gt;</span>
   <span class="tok-o">&lt;/</span><span class="tok-n">pelicula</span><span class="tok-o">&gt;</span>
   <span class="tok-o">&lt;</span><span class="tok-n">pelicula</span> <span class="tok-n">duracion</span><span class="tok-o">=</span><span class="tok-s">&quot;155&quot;</span> <span class="tok-n">estreno</span><span class="tok-o">=</span><span class="tok-s">&quot;2015-18-07T00:00:00+01:00&quot;</span> <span class="tok-n">id</span><span class="tok-o">=</span><span class="tok-s">&quot;2&quot;</span><span class="tok-o">&gt;</span>
     <span class="tok-o">&lt;</span><span class="tok-n">director</span><span class="tok-o">&gt;</span><span class="tok-n">Director</span> <span class="tok-mi">2</span><span class="tok-o">&lt;/</span><span class="tok-n">director</span><span class="tok-o">&gt;</span>
     <span class="tok-o">&lt;</span><span class="tok-n">titulo</span><span class="tok-o">&gt;</span><span class="tok-n">Pelicula</span> <span class="tok-mi">2</span><span class="tok-o">&lt;/</span><span class="tok-n">titulo</span><span class="tok-o">&gt;</span>
   <span class="tok-o">&lt;/</span><span class="tok-n">pelicula</span><span class="tok-o">&gt;</span>
<span class="tok-o">&lt;/</span><span class="tok-n">peliculas</span><span class="tok-o">&gt;</span></code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Por defecto, JAXB serializa los tipos <code>Date</code> con el formato <a href="https://es.wikipedia.org/wiki/ISO_8601">ISO 8061</a>
para los contenidos en el cuerpo de la petiÃ³n/respuesta. Dicho formato es YYYY-MM-DD (seguido de HH:MM:SS).
Por otro lado, si aÃ±adimos actores a las pelÃ­culas, Ã©stos deberÃ¡n mostrarse bajo la etiqueta <em>&lt;actores&gt;</em>, tal y como
mostramos en el siguiente ejemplo.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Los datos mostrados para una pelÃ­cula en formato xml tienen que presentar el siguiente aspecto:</p>
</div>
<div class="paragraph">
<p>source,java]
.PeticiÃ³n rest: GET /peliculas/1</p>
</div>
<div class="listingblock">
<div class="content">
<pre>&lt;?xml version="1.0" encoding="UTF-8" standalone="yes"?&gt;
&lt;pelicula duracion="120" estreno="2015-12-08T00:00:00+01:00" id="1"&gt;
    &lt;actores&gt;
        &lt;actor nombre="Jack Nicholson" personaje="Jack Torrance"/&gt;
    &lt;/actores&gt;
    &lt;director&gt;Stanley Kubrick&lt;/director&gt;
    &lt;titulo&gt;El resplandor&lt;/titulo&gt;
&lt;/pelicula&gt;</pre>
</div>
</div>
<div class="paragraph">
<p>Puedes comprobar si has hecho bien el ejercicio utilizando Postman.</p>
</div>
</div>
<div class="sect3">
<h4 id="_uso_de_manejadores_de_contenidos_y_clase_response_0_75_puntos">3.7.4. Uso de manejadores de contenidos y clase Response (0,75 puntos)</h4>
<div class="paragraph">
<p><strong>Implementa una nueva peticiÃ³n POST</strong> que reciba los datos de una nueva pelÃ­cula desde
un formulario. Recuerda que los datos de un formulario pueden ponerse en el cuerpo
de la peticiÃ³n HTTP como pares <code>nombre=valor</code> separados por <code>&amp;</code>. Los espacios
en blanco se codifican como <code>%20</code>. No es necesario poner comillas. Por ejemplo:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>nombre1=valor%20con%20espacios&amp;nombre2=valor</pre>
</div>
</div>
<div class="paragraph">
<p>Se proporciona el fichero index.html con un formulario para utilizarlo como
alternativa a postman. Para acceder al formulario usaremos <em><a href="http://localhost:8080/s3-filmoteca/" class="bare">http://localhost:8080/s3-filmoteca/</a></em></p>
</div>
<div class="paragraph">
<p><strong>Modifica las peticiones POST</strong> sobre <code>pelÃ­culas</code> y <code>actores</code> de forma que devuelvan en la cabecera
Location la URI del nuevo recurso creado. Por ejemplo</p>
</div>
<div class="literalblock">
<div class="content">
<pre>http://localhost:8080/s3-filmoteca/peliculas/3</pre>
</div>
</div>
<div class="paragraph">
<p>en el caso de una nueva pelÃ­cula, y</p>
</div>
<div class="literalblock">
<div class="content">
<pre>http://localhost:8080/s3-filmoteca/peliculas/3/actores/Sigourney%20Weaver</pre>
</div>
</div>
<div class="paragraph">
<p>si por ejemplo hemos aÃ±adido un nuevo actor a la pelÃ­cula con id=3.</p>
</div>
<div class="paragraph">
<p><strong>Modifica los mÃ©todos GET</strong> para que devuelvan el estado: 204 No Content
en los casos en los que la pelÃ­cula y/o actor consultado no exista.</p>
</div>
<div class="paragraph">
<p><strong>Modifica los mÃ©todos GET</strong> para que devuelvan el estado: 404 Not Found,
en los casos en los que las listas de pelÃ­culas y/o actores estÃ©n vacÃ­as.</p>
</div>
<div class="paragraph">
<p><strong>Implementa</strong> el cÃ³digo para aÃ±adir un nuevo actor. TendrÃ¡s que obtener la informaciÃ³n
de la pelÃ­cula y nombre del actor de la URI de la peticiÃ³n.</p>
</div>
<div class="paragraph">
<p>Puedes comprobar si has hecho bien el ejercicio utilizando Postman.</p>
</div>
</div>
<div class="sect3">
<h4 id="_manejo_de_excepciones_0_75_puntos">3.7.5. Manejo de excepciones (0,75 puntos)</h4>
<div class="paragraph">
<p><strong>Modifica el mÃ©todo</strong> <code>addPelicula</code> de la capa de servicio (paquete <em>org.expertojava.service</em>) para que
lance una excepciÃ³n de tipo <em>ServiceException</em> con el mensaje "El tÃ­tulo de la pelÃ­cula
no puede ser nulo ni vacÃ­o"
cuando se intente aÃ±adir una pelÃ­cula con un tÃ­tulo con valor <em>null</em>, o vacÃ­o.</p>
</div>
<div class="paragraph">
<p>El mÃ©todo <code>addPelicula</code> debe lanzar tambiÃ©n una excepciÃ³n de tipo <em>ServiceException</em>
con el mensaje "La pelÃ­cula ya existe",
cuando se intente aÃ±adir una pelÃ­cula con un tÃ­tulo que ya existe.</p>
</div>
<div class="paragraph">
<p><strong>Modifica el mÃ©todo</strong> <code>addActor</code> de la capa de servicio para que lance las excepciones de tipo
<em>ServiceException</em> con los mensajes "El tÃ­tulo de la pelÃ­cula no puede ser nulo ni vacÃ­o"
cuando se intente aÃ±adir un actor a una pelÃ­cula cuyo tÃ­tulo no existe, o bien el mensaje
"EL actor ya existe" si
intentamos aÃ±adir un actor a una pelÃ­cula que ya habÃ­amos aÃ±adido previamente.</p>
</div>
<div class="paragraph">
<p><strong>Implementa</strong> un <em>mapper</em> para capturar las excepciones de la capa de servicio, de forma
que se devuelva el
estado 500, "Internal Server error", y como entidad del cuerpo de la respuesta el mensaje
asociado a las excepciones generadas por el
servicio (<em>"El tÃ­tulo de la pelÃ­cula no puede ser nulo ni vacÃ­o"</em>,
<em>"EL actor ya existe"</em>, &#8230;&#8203;). La nueva clase
pertencerÃ¡ a la capa "rest". Puedes ponerle el nombre <em>ServiceExceptionMapper</em>.</p>
</div>
<div class="paragraph">
<p>Puedes comprobar si has hecho bien el ejercicio utilizando Postman.</p>
</div>
</div>
</div>
</div>
</div>
</div>
<div id="footer">
<div id="footer-text">
Last updated 2015-10-15 10:06:27 CEST
</div>
</div>
</body>
</html>