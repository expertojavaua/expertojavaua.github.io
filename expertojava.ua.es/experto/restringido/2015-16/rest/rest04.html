<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<!--[if IE]><meta http-equiv="X-UA-Compatible" content="IE=edge"><![endif]-->
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 1.5.2">
<meta name="author" content="MarÃ­a Isabel Alfonso Galipienso">
<title>Servicios Rest</title>
<style>/*! normalize.css v2.1.2 | MIT License | git.io/normalize */
/* ========================================================================== HTML5 display definitions ========================================================================== */
/** Correct `block` display not defined in IE 8/9. */
article, aside, details, figcaption, figure, footer, header, hgroup, main, nav, section, summary { display: block; }

/** Correct `inline-block` display not defined in IE 8/9. */
audio, canvas, video { display: inline-block; }

/** Prevent modern browsers from displaying `audio` without controls. Remove excess height in iOS 5 devices. */
audio:not([controls]) { display: none; height: 0; }

/** Address `[hidden]` styling not present in IE 8/9. Hide the `template` element in IE, Safari, and Firefox < 22. */
[hidden], template { display: none; }

script { display: none !important; }

/* ========================================================================== Base ========================================================================== */
/** 1. Set default font family to sans-serif. 2. Prevent iOS text size adjust after orientation change, without disabling user zoom. */
html { font-family: sans-serif; /* 1 */ -ms-text-size-adjust: 100%; /* 2 */ -webkit-text-size-adjust: 100%; /* 2 */ }

/** Remove default margin. */
body { margin: 0; }

/* ========================================================================== Links ========================================================================== */
/** Remove the gray background color from active links in IE 10. */
a { background: transparent; }

/** Address `outline` inconsistency between Chrome and other browsers. */
a:focus { outline: thin dotted; }

/** Improve readability when focused and also mouse hovered in all browsers. */
a:active, a:hover { outline: 0; }

/* ========================================================================== Typography ========================================================================== */
/** Address variable `h1` font-size and margin within `section` and `article` contexts in Firefox 4+, Safari 5, and Chrome. */
h1 { font-size: 2em; margin: 0.67em 0; }

/** Address styling not present in IE 8/9, Safari 5, and Chrome. */
abbr[title] { border-bottom: 1px dotted; }

/** Address style set to `bolder` in Firefox 4+, Safari 5, and Chrome. */
b, strong { font-weight: bold; }

/** Address styling not present in Safari 5 and Chrome. */
dfn { font-style: italic; }

/** Address differences between Firefox and other browsers. */
hr { -moz-box-sizing: content-box; box-sizing: content-box; height: 0; }

/** Address styling not present in IE 8/9. */
mark { background: #ff0; color: #000; }

/** Correct font family set oddly in Safari 5 and Chrome. */
code, kbd, pre, samp { font-family: monospace, serif; font-size: 1em; }

/** Improve readability of pre-formatted text in all browsers. */
pre { white-space: pre-wrap; }

/** Set consistent quote types. */
q { quotes: "\201C" "\201D" "\2018" "\2019"; }

/** Address inconsistent and variable font size in all browsers. */
small { font-size: 80%; }

/** Prevent `sub` and `sup` affecting `line-height` in all browsers. */
sub, sup { font-size: 75%; line-height: 0; position: relative; vertical-align: baseline; }

sup { top: -0.5em; }

sub { bottom: -0.25em; }

/* ========================================================================== Embedded content ========================================================================== */
/** Remove border when inside `a` element in IE 8/9. */
img { border: 0; }

/** Correct overflow displayed oddly in IE 9. */
svg:not(:root) { overflow: hidden; }

/* ========================================================================== Figures ========================================================================== */
/** Address margin not present in IE 8/9 and Safari 5. */
figure { margin: 0; }

/* ========================================================================== Forms ========================================================================== */
/** Define consistent border, margin, and padding. */
fieldset { border: 1px solid #c0c0c0; margin: 0 2px; padding: 0.35em 0.625em 0.75em; }

/** 1. Correct `color` not being inherited in IE 8/9. 2. Remove padding so people aren't caught out if they zero out fieldsets. */
legend { border: 0; /* 1 */ padding: 0; /* 2 */ }

/** 1. Correct font family not being inherited in all browsers. 2. Correct font size not being inherited in all browsers. 3. Address margins set differently in Firefox 4+, Safari 5, and Chrome. */
button, input, select, textarea { font-family: inherit; /* 1 */ font-size: 100%; /* 2 */ margin: 0; /* 3 */ }

/** Address Firefox 4+ setting `line-height` on `input` using `!important` in the UA stylesheet. */
button, input { line-height: normal; }

/** Address inconsistent `text-transform` inheritance for `button` and `select`. All other form control elements do not inherit `text-transform` values. Correct `button` style inheritance in Chrome, Safari 5+, and IE 8+. Correct `select` style inheritance in Firefox 4+ and Opera. */
button, select { text-transform: none; }

/** 1. Avoid the WebKit bug in Android 4.0.* where (2) destroys native `audio` and `video` controls. 2. Correct inability to style clickable `input` types in iOS. 3. Improve usability and consistency of cursor style between image-type `input` and others. */
button, html input[type="button"], input[type="reset"], input[type="submit"] { -webkit-appearance: button; /* 2 */ cursor: pointer; /* 3 */ }

/** Re-set default cursor for disabled elements. */
button[disabled], html input[disabled] { cursor: default; }

/** 1. Address box sizing set to `content-box` in IE 8/9. 2. Remove excess padding in IE 8/9. */
input[type="checkbox"], input[type="radio"] { box-sizing: border-box; /* 1 */ padding: 0; /* 2 */ }

/** 1. Address `appearance` set to `searchfield` in Safari 5 and Chrome. 2. Address `box-sizing` set to `border-box` in Safari 5 and Chrome (include `-moz` to future-proof). */
input[type="search"] { -webkit-appearance: textfield; /* 1 */ -moz-box-sizing: content-box; -webkit-box-sizing: content-box; /* 2 */ box-sizing: content-box; }

/** Remove inner padding and search cancel button in Safari 5 and Chrome on OS X. */
input[type="search"]::-webkit-search-cancel-button, input[type="search"]::-webkit-search-decoration { -webkit-appearance: none; }

/** Remove inner padding and border in Firefox 4+. */
button::-moz-focus-inner, input::-moz-focus-inner { border: 0; padding: 0; }

/** 1. Remove default vertical scrollbar in IE 8/9. 2. Improve readability and alignment in all browsers. */
textarea { overflow: auto; /* 1 */ vertical-align: top; /* 2 */ }

/* ========================================================================== Tables ========================================================================== */
/** Remove most spacing between table cells. */
table { border-collapse: collapse; border-spacing: 0; }

meta.foundation-mq-small { font-family: "only screen and (min-width: 768px)"; width: 768px; }

meta.foundation-mq-medium { font-family: "only screen and (min-width:1280px)"; width: 1280px; }

meta.foundation-mq-large { font-family: "only screen and (min-width:1440px)"; width: 1440px; }

*, *:before, *:after { -moz-box-sizing: border-box; -webkit-box-sizing: border-box; box-sizing: border-box; }

html, body { font-size: 97%; }

body { background: white; color: #222222; padding: 0; margin: 0; font-family: "Helvetica Neue", "Helvetica", Helvetica, Arial, sans-serif; font-weight: normal; font-style: normal; line-height: 1; position: relative; cursor: auto; }

a:hover { cursor: pointer; }

img, object, embed { max-width: 100%; height: auto; }

object, embed { height: 100%; }

img { -ms-interpolation-mode: bicubic; }

#map_canvas img, #map_canvas embed, #map_canvas object, .map_canvas img, .map_canvas embed, .map_canvas object { max-width: none !important; }

.left { float: left !important; }

.right { float: right !important; }

.text-left { text-align: left !important; }

.text-right { text-align: right !important; }

.text-center { text-align: center !important; }

.text-justify { text-align: justify !important; }

.hide { display: none; }

.antialiased, body { -webkit-font-smoothing: antialiased; }

img { display: inline-block; vertical-align: middle; }

textarea { height: auto; min-height: 50px; }

select { width: 100%; }

p.lead, .paragraph.lead > p, #preamble > .sectionbody > .paragraph:first-of-type p { font-size: 1.21875em; line-height: 1.6; }

.subheader, .admonitionblock td.content > .title, .audioblock > .title, .exampleblock > .title, .imageblock > .title, .listingblock > .title, .literalblock > .title, .stemblock > .title, .openblock > .title, .paragraph > .title, .quoteblock > .title, table.tableblock > .title, .verseblock > .title, .videoblock > .title, .dlist > .title, .olist > .title, .ulist > .title, .qlist > .title, .hdlist > .title { line-height: 1.4; color: #6f6f6f; font-weight: 300; margin-top: 0.2em; margin-bottom: 0.5em; }

/* Typography resets */
div, dl, dt, dd, ul, ol, li, h1, h2, h3, #toctitle, .sidebarblock > .content > .title, h4, h5, h6, pre, form, p, blockquote, th, td { margin: 0; padding: 0; direction: ltr; }

/* Default Link Styles */
a { color: #1164be; text-decoration: none; line-height: inherit; }
a img { border: none; }

/* Default paragraph styles */
p { font-family: inherit; font-weight: normal; font-size: 1em; line-height: 1.4; margin-bottom: 1em; text-rendering: optimizeLegibility; }
p aside { font-size: 0.875em; line-height: 1.35; font-style: italic; }

/* Default header styles */
h1, h2, h3, #toctitle, .sidebarblock > .content > .title, h4, h5, h6 { font-family: "Helvetica Neue", "Helvetica", Helvetica, Arial, sans-serif; font-weight: bold; font-style: normal; color: #1c355e; text-rendering: optimizeLegibility; margin-top: 1em; margin-bottom: 0.5em; line-height: 1.2125em; }
h1 small, h2 small, h3 small, #toctitle small, .sidebarblock > .content > .title small, h4 small, h5 small, h6 small { font-size: 60%; color: #6f6f6f; line-height: 0; }

h1 { font-size: 2.125em; }

h2 { font-size: 1.6875em; }

h3, #toctitle, .sidebarblock > .content > .title { font-size: 1.375em; }

h4 { font-size: 1.125em; }

h5 { font-size: 1.125em; }

h6 { font-size: 1em; }

hr { border: solid #dddddd; border-width: 1px 0 0; clear: both; margin: 1.25em 0 1.1875em; height: 0; }

/* Helpful Typography Defaults */
em, i { font-style: italic; line-height: inherit; }

strong, b { font-weight: bold; line-height: inherit; }

small { font-size: 60%; line-height: inherit; }

code { font-family: Consolas, "Liberation Mono", Courier, monospace; font-weight: bold; }

/* Lists */
ul, ol, dl { font-size: 1em; line-height: 1.4; margin-bottom: 1.25em; list-style-position: outside; font-family: inherit; }

ul, ol { margin-left: 2.5em; }
ul.no-bullet, ol.no-bullet { margin-left: 1.5em; }

/* Unordered Lists */
ul li ul, ul li ol { margin-left: 1.25em; margin-bottom: 0; font-size: 1em; /* Override nested font-size change */ }
ul.square li ul, ul.circle li ul, ul.disc li ul { list-style: inherit; }
ul.square { list-style-type: square; }
ul.circle { list-style-type: circle; }
ul.disc { list-style-type: disc; }
ul.no-bullet { list-style: none; }

/* Ordered Lists */
ol li ul, ol li ol { margin-left: 1.25em; margin-bottom: 0; }

/* Definition Lists */
dl dt { margin-bottom: 0.3125em; font-weight: bold; }
dl dd { margin-bottom: 1.25em; }

/* Abbreviations */
abbr, acronym { text-transform: uppercase; font-size: 90%; color: #222222; border-bottom: 1px dotted #dddddd; cursor: help; }

abbr { text-transform: none; }

/* Blockquotes */
blockquote { margin: 0 0 1.25em; padding: 0.5625em 1.25em 0 1.1875em; border-left: 1px solid #dddddd; }
blockquote cite { display: block; font-size: 0.8125em; color: #555555; }
blockquote cite:before { content: "\2014 \0020"; }
blockquote cite a, blockquote cite a:visited { color: #555555; }

blockquote, blockquote p { line-height: 1.6; color: #6f6f6f; }

/* Microformats */
.vcard { display: inline-block; margin: 0 0 1.25em 0; border: 1px solid #dddddd; padding: 0.625em 0.75em; }
.vcard li { margin: 0; display: block; }
.vcard .fn { font-weight: bold; font-size: 0.9375em; }

.vevent .summary { font-weight: bold; }
.vevent abbr { cursor: auto; text-decoration: none; font-weight: bold; border: none; padding: 0 0.0625em; }

/*@media only screen and (min-width: 768px) { h1, h2, h3, #toctitle, .sidebarblock > .content > .title, h4, h5, h6 { line-height: 1.4; }
  h1 { font-size: 2.75em; }
  h2 { font-size: 2.3125em; }
  h3, #toctitle, .sidebarblock > .content > .title { font-size: 1.6875em; }
  h4 { font-size: 1.4375em; } }*/
/* Tables */
table { background: white; margin-bottom: 1.25em; border: solid 1px #dddddd; }
table thead, table tfoot { background: whitesmoke; font-weight: bold; }
table thead tr th, table thead tr td, table tfoot tr th, table tfoot tr td { padding: 0.5em 0.625em 0.625em; font-size: inherit; color: #222222; text-align: left; }
table tr th, table tr td { padding: 0.5625em 0.625em; font-size: inherit; color: #222222; }
table tr.even, table tr.alt, table tr:nth-of-type(even) { background: #f9f9f9; }
table thead tr th, table tfoot tr th, table tbody tr td, table tr td, table tfoot tr td { display: table-cell; line-height: 1.4; }

h1, h2, h3, #toctitle, .sidebarblock > .content > .title, h4, h5, h6 { line-height: 1.4; border-bottom: 1px solid #dddddd }

.clearfix:before, .clearfix:after, .float-group:before, .float-group:after { content: " "; display: table; }
.clearfix:after, .float-group:after { clear: both; }

*:not(pre) > code { font-size: inherit; font-style: normal !important; letter-spacing: 0; padding: 3px 2px 1px 2px; background-color: #eeeeee; border: 1px solid #dddddd; -webkit-border-radius: 0; border-radius: 0; line-height: inherit; font-weight: normal; }

pre, pre > code { line-height: 1.4; color: black; font-family: monospace, serif; font-weight: normal; }

.keyseq { color: #555555; }

kbd { display: inline-block; color: #222222; font-size: 0.75em; line-height: 1.4; background-color: #f7f7f7; border: 1px solid #ccc; -webkit-border-radius: 3px; border-radius: 3px; -webkit-box-shadow: 0 1px 0 rgba(0, 0, 0, 0.2), 0 0 0 0.1em white inset; box-shadow: 0 1px 0 rgba(0, 0, 0, 0.2), 0 0 0 0.1em white inset; margin: -0.15em 0.15em 0 0.15em; padding: 0.2em 0.6em 0.2em 0.5em; vertical-align: middle; white-space: nowrap; }

.keyseq kbd:first-child { margin-left: 0; }

.keyseq kbd:last-child { margin-right: 0; }

.menuseq, .menu { color: #090909; }

b.button:before, b.button:after { position: relative; top: -1px; font-weight: normal; }

b.button:before { content: "["; padding: 0 3px 0 2px; }

b.button:after { content: "]"; padding: 0 2px 0 3px; }

#header, #content, #footnotes, #footer { width: 100%; margin-left: auto; margin-right: auto; margin-top: 0; margin-bottom: 0; max-width: 62.5em; *zoom: 1; position: relative; padding-left: 0.9375em; padding-right: 0.9375em; }
#header:before, #header:after, #content:before, #content:after, #footnotes:before, #footnotes:after, #footer:before, #footer:after { content: " "; display: table; }
#header:after, #content:after, #footnotes:after, #footer:after { clear: both; }

#content { margin-top: 1.25em; }

#content:before { content: none; }

#header > h1:first-child { color: black; margin-top: 2.25rem; margin-bottom: 0; }
#header > h1:first-child + #toc { margin-top: 8px; border-top: 1px solid #dddddd; }
#header > h1:only-child, body.toc2 #header > h1:nth-last-child(2) { border-bottom: 1px solid #dddddd; padding-bottom: 8px; }
#header .details { border-bottom: 1px solid #dddddd; line-height: 1.45; padding-top: 0.25em; padding-bottom: 0.25em; padding-left: 0.25em; color: #555555; display: -ms-flexbox; display: -webkit-flex; display: flex; -ms-flex-flow: row wrap; -webkit-flex-flow: row wrap; flex-flow: row wrap; }
#header .details span:first-child { margin-left: -0.125em; }
#header .details span.email a { color: #6f6f6f; }
#header .details br { display: none; }
#header .details br + span:before { content: "\00a0\2013\00a0"; }
#header .details br + span.author:before { content: "\00a0\22c5\00a0"; color: #6f6f6f; }
#header .details br + span#revremark:before { content: "\00a0|\00a0"; }
#header #revnumber { text-transform: capitalize; }
#header #revnumber:after { content: "\00a0"; }

#content > h1:first-child:not([class]) { color: black; border-bottom: 1px solid #dddddd; padding-bottom: 8px; margin-top: 0; padding-top: 1rem; margin-bottom: 1.25rem; }

#floating {
  position: fixed;
  z-index: 1000;
  padding: 0.5em;
  right: 0;
  top: 0;
  background: white;
  box-shadow: 0 0 1em #777777;
  -webkit-box-shadow: 0 0 1em #777777;
  -moz-box-shadow: 0 0 1em #777777;
  -webkit-border-bottom-left-radius: 5px;
  -moz-border-radius-bottomleft: 5px;
  max-height: 80%;
  overflow: auto;
}

#floating #full { display: none; } /* Hide the full TOC by default */

#floating:hover #full{
  display: block; /* Show it on hover */
}


#toc { border-bottom: 1px solid #dddddd; padding-bottom: 0.5em; }
#toc > ul { margin-left: 0.125em; }
#toc ul.sectlevel0 > li > a { font-style: italic; }
#toc ul.sectlevel0 ul.sectlevel1 { margin: 0.5em 0; }
#toc ul { font-family: "Helvetica Neue", "Helvetica", Helvetica, Arial, sans-serif; list-style-type: none; }
#toc a { text-decoration: none; }
#toc a:active { text-decoration: underline; }

#toctitle { color: #6f6f6f; font-size: 1.2em; }

@media only screen and (min-width: 768px) { #toctitle { font-size: 1.375em; }
  body.toc2 { padding-left: 15em; padding-right: 0; }
  #toc.toc2 { margin-top: 0 !important; background-color: #f2f2f2; position: fixed; width: 15em; left: 0; top: 0; border-right: 1px solid #dddddd; border-top-width: 0 !important; border-bottom-width: 0 !important; z-index: 1000; padding: 1.25em 1em; height: 100%; overflow: auto; }
  #toc.toc2 #toctitle { margin-top: 0; font-size: 1.2em; }
  #toc.toc2 > ul { font-size: 0.9em; margin-bottom: 0; }
  #toc.toc2 ul ul { margin-left: 0; padding-left: 1em; }
  #toc.toc2 ul.sectlevel0 ul.sectlevel1 { padding-left: 0; margin-top: 0.5em; margin-bottom: 0.5em; }
  body.toc2.toc-right { padding-left: 0; padding-right: 15em; }
  body.toc2.toc-right #toc.toc2 { border-right-width: 0; border-left: 1px solid #dddddd; left: auto; right: 0; } }
@media only screen and (min-width: 1280px) { body.toc2 { padding-left: 20em; padding-right: 0; }
  #toc.toc2 { width: 20em; }
  #toc.toc2 #toctitle { font-size: 1.375em; }
  #toc.toc2 > ul { font-size: 0.95em; }
  #toc.toc2 ul ul { padding-left: 1.25em; }
  body.toc2.toc-right { padding-left: 0; padding-right: 20em; } }
#content #toc { border-style: solid; border-width: 1px; border-color: #d9d9d9; margin-bottom: 1.25em; padding: 1.25em; background: #f2f2f2; -webkit-border-radius: 0; border-radius: 0; }
#content #toc > :first-child { margin-top: 0; }
#content #toc > :last-child { margin-bottom: 0; }

#footer { max-width: 100%; background-color: #222222; padding: 1.25em; }

#footer-text { color: #dddddd; line-height: 1.44; }

.sect1 { padding-bottom: 0.625em; }

@media only screen and (min-width: 768px) { .sect1 { padding-bottom: 1.25em; } }
.sect1 + .sect1 { border-top: 1px solid #dddddd; }

#content h1 > a.anchor, h2 > a.anchor, h3 > a.anchor, #toctitle > a.anchor, .sidebarblock > .content > .title > a.anchor, h4 > a.anchor, h5 > a.anchor, h6 > a.anchor { position: absolute; z-index: 1001; width: 1.5ex; margin-left: -1.5ex; display: block; text-decoration: none !important; visibility: hidden; text-align: center; font-weight: normal; }
#content h1 > a.anchor:before, h2 > a.anchor:before, h3 > a.anchor:before, #toctitle > a.anchor:before, .sidebarblock > .content > .title > a.anchor:before, h4 > a.anchor:before, h5 > a.anchor:before, h6 > a.anchor:before { content: "\00A7"; font-size: 0.85em; display: block; padding-top: 0.1em; }
#content h1:hover > a.anchor, #content h1 > a.anchor:hover, h2:hover > a.anchor, h2 > a.anchor:hover, h3:hover > a.anchor, #toctitle:hover > a.anchor, .sidebarblock > .content > .title:hover > a.anchor, h3 > a.anchor:hover, #toctitle > a.anchor:hover, .sidebarblock > .content > .title > a.anchor:hover, h4:hover > a.anchor, h4 > a.anchor:hover, h5:hover > a.anchor, h5 > a.anchor:hover, h6:hover > a.anchor, h6 > a.anchor:hover { visibility: visible; }
#content h1 > a.link, h2 > a.link, h3 > a.link, #toctitle > a.link, .sidebarblock > .content > .title > a.link, h4 > a.link, h5 > a.link, h6 > a.link { color: #222222; text-decoration: none; }
#content h1 > a.link:hover, h2 > a.link:hover, h3 > a.link:hover, #toctitle > a.link:hover, .sidebarblock > .content > .title > a.link:hover, h4 > a.link:hover, h5 > a.link:hover, h6 > a.link:hover { color: #151515; }

.audioblock, .imageblock, .literalblock, .listingblock, .stemblock, .videoblock { margin-bottom: 1.25em; }

.admonitionblock td.content > .title, .audioblock > .title, .exampleblock > .title, .imageblock > .title, .listingblock > .title, .literalblock > .title, .stemblock > .title, .openblock > .title, .paragraph > .title, .quoteblock > .title, table.tableblock > .title, .verseblock > .title, .videoblock > .title, .dlist > .title, .olist > .title, .ulist > .title, .qlist > .title, .hdlist > .title { text-rendering: optimizeLegibility; text-align: left; }

table.tableblock > caption.title { white-space: nowrap; overflow: visible; max-width: 0; }

.paragraph.lead > p, #preamble > .sectionbody > .paragraph:first-of-type p { color: black; }

table.tableblock #preamble > .sectionbody > .paragraph:first-of-type p { font-size: inherit; }

.admonitionblock > table { border-collapse: separate; border: 0; background: none; width: 100%; }
.admonitionblock > table td.icon { text-align: center; width: 80px; }
.admonitionblock > table td.icon img { max-width: none; }
.admonitionblock > table td.icon .title { font-weight: bold; font-family: "Helvetica Neue", "Helvetica", Helvetica, Arial, sans-serif; text-transform: uppercase; }
.admonitionblock > table td.content { padding-left: 1.125em; padding-right: 1.25em; border-left: 1px solid #dddddd; color: #555555; }
.admonitionblock > table td.content > :last-child > :last-child { margin-bottom: 0; }

.exampleblock > .content { border-style: solid; border-width: 1px; border-color: #e6e6e6; margin-bottom: 1.25em; padding: 1.25em; background: white; -webkit-border-radius: 0; border-radius: 0; }
.exampleblock > .content > :first-child { margin-top: 0; }
.exampleblock > .content > :last-child { margin-bottom: 0; }

.sidebarblock { border-style: solid; border-width: 1px; border-color: #d9d9d9; margin-bottom: 1.25em; padding: 1.25em; background: #f2f2f2; -webkit-border-radius: 0; border-radius: 0; }
.sidebarblock > :first-child { margin-top: 0; }
.sidebarblock > :last-child { margin-bottom: 0; }
.sidebarblock > .content > .title { color: #6f6f6f; margin-top: 0; }

.exampleblock > .content > :last-child > :last-child, .exampleblock > .content .olist > ol > li:last-child > :last-child, .exampleblock > .content .ulist > ul > li:last-child > :last-child, .exampleblock > .content .qlist > ol > li:last-child > :last-child, .sidebarblock > .content > :last-child > :last-child, .sidebarblock > .content .olist > ol > li:last-child > :last-child, .sidebarblock > .content .ulist > ul > li:last-child > :last-child, .sidebarblock > .content .qlist > ol > li:last-child > :last-child { margin-bottom: 0; }

.literalblock pre, .listingblock pre:not(.highlight), .listingblock pre[class="highlight"], .listingblock pre[class^="highlight "], .listingblock pre.CodeRay, .listingblock pre.prettyprint { background: #eeeeee; }
.sidebarblock .literalblock pre, .sidebarblock .listingblock pre:not(.highlight), .sidebarblock .listingblock pre[class="highlight"], .sidebarblock .listingblock pre[class^="highlight "], .sidebarblock .listingblock pre.CodeRay, .sidebarblock .listingblock pre.prettyprint { background: #f2f1f1; }

.literalblock pre, .literalblock pre[class], .listingblock pre, .listingblock pre[class] { border: 1px solid #cccccc; -webkit-border-radius: 0; border-radius: 0; word-wrap: break-word; padding: 0.8em 0.8em 0.65em 0.8em; font-size: 0.8125em; }
.literalblock pre.nowrap, .literalblock pre[class].nowrap, .listingblock pre.nowrap, .listingblock pre[class].nowrap { overflow-x: auto; white-space: pre; word-wrap: normal; }
@media only screen and (min-width: 768px) { .literalblock pre, .literalblock pre[class], .listingblock pre, .listingblock pre[class] { font-size: 0.90625em; } }
@media only screen and (min-width: 1280px) { .literalblock pre, .literalblock pre[class], .listingblock pre, .listingblock pre[class] { font-size: 1em; } }

.literalblock.output pre { color: #eeeeee; background-color: black; }

.listingblock pre.highlightjs { padding: 0; }
.listingblock pre.highlightjs > code { padding: 0.8em 0.8em 0.65em 0.8em; -webkit-border-radius: 0; border-radius: 0; }

.listingblock > .content { position: relative; }

.listingblock code[data-lang]:before { display: none; content: attr(data-lang); position: absolute; font-size: 0.75em; top: 0.425rem; right: 0.5rem; line-height: 1; text-transform: uppercase; color: #999; }

.listingblock:hover code[data-lang]:before { display: block; }

.listingblock.terminal pre .command:before { content: attr(data-prompt); padding-right: 0.5em; color: #999; }

.listingblock.terminal pre .command:not([data-prompt]):before { content: "$"; }

table.pyhltable { border-collapse: separate; border: 0; margin-bottom: 0; background: none; }

table.pyhltable td { vertical-align: top; padding-top: 0; padding-bottom: 0; }

table.pyhltable td.code { padding-left: .75em; padding-right: 0; }

pre.pygments .lineno, table.pyhltable td:not(.code) { color: #999; padding-left: 0; padding-right: .5em; border-right: 1px solid #dddddd; }

pre.pygments .lineno { display: inline-block; margin-right: .25em; }

table.pyhltable .linenodiv { background: none !important; padding-right: 0 !important; }

.quoteblock { margin: 0 1em 1.25em 1.5em; display: table; }
.quoteblock > .title { margin-left: -1.5em; margin-bottom: 0.75em; }
.quoteblock blockquote, .quoteblock blockquote p { color: #6f6f6f; font-size: 1.15rem; line-height: 1.75; word-spacing: 0.1em; letter-spacing: 0; font-style: italic; text-align: justify; }
.quoteblock blockquote { margin: 0; padding: 0; border: 0; }
.quoteblock blockquote:before { content: "\201c"; float: left; font-size: 2.75em; font-weight: bold; line-height: 0.6em; margin-left: -0.6em; color: #6f6f6f; text-shadow: 0 1px 2px rgba(0, 0, 0, 0.1); }
.quoteblock blockquote > .paragraph:last-child p { margin-bottom: 0; }
.quoteblock .attribution { margin-top: 0.5em; margin-right: 0.5ex; text-align: right; }
.quoteblock .quoteblock { margin-left: 0; margin-right: 0; padding: 0.5em 0; border-left: 3px solid #555555; }
.quoteblock .quoteblock blockquote { padding: 0 0 0 0.75em; }
.quoteblock .quoteblock blockquote:before { display: none; }

.verseblock { margin: 0 1em 1.25em 1em; }
.verseblock pre { font-family: "Open Sans", "DejaVu Sans", sans; font-size: 1.15rem; color: #6f6f6f; font-weight: 300; text-rendering: optimizeLegibility; }
.verseblock pre strong { font-weight: 400; }
.verseblock .attribution { margin-top: 1.25rem; margin-left: 0.5ex; }

.quoteblock .attribution, .verseblock .attribution { font-size: 0.8125em; line-height: 1.45; font-style: italic; }
.quoteblock .attribution br, .verseblock .attribution br { display: none; }
.quoteblock .attribution cite, .verseblock .attribution cite { display: block; letter-spacing: -0.05em; color: #555555; }

.quoteblock.abstract { margin: 0 0 1.25em 0; display: block; }
.quoteblock.abstract blockquote, .quoteblock.abstract blockquote p { text-align: left; word-spacing: 0; }
.quoteblock.abstract blockquote:before, .quoteblock.abstract blockquote p:first-of-type:before { display: none; }

table.tableblock { max-width: 100%; border-collapse: separate; }
table.tableblock td > .paragraph:last-child p > p:last-child, table.tableblock th > p:last-child, table.tableblock td > p:last-child { margin-bottom: 0; }

table.spread { width: 100%; }

table.tableblock, th.tableblock, td.tableblock { border: 0 solid #dddddd; }

table.grid-all th.tableblock, table.grid-all td.tableblock { border-width: 0 1px 1px 0; }

table.grid-all tfoot > tr > th.tableblock, table.grid-all tfoot > tr > td.tableblock { border-width: 1px 1px 0 0; }

table.grid-cols th.tableblock, table.grid-cols td.tableblock { border-width: 0 1px 0 0; }

table.grid-all * > tr > .tableblock:last-child, table.grid-cols * > tr > .tableblock:last-child { border-right-width: 0; }

table.grid-rows th.tableblock, table.grid-rows td.tableblock { border-width: 0 0 1px 0; }

table.grid-all tbody > tr:last-child > th.tableblock, table.grid-all tbody > tr:last-child > td.tableblock, table.grid-all thead:last-child > tr > th.tableblock, table.grid-rows tbody > tr:last-child > th.tableblock, table.grid-rows tbody > tr:last-child > td.tableblock, table.grid-rows thead:last-child > tr > th.tableblock { border-bottom-width: 0; }

table.grid-rows tfoot > tr > th.tableblock, table.grid-rows tfoot > tr > td.tableblock { border-width: 1px 0 0 0; }

table.frame-all { border-width: 1px; }

table.frame-sides { border-width: 0 1px; }

table.frame-topbot { border-width: 1px 0; }

th.halign-left, td.halign-left { text-align: left; }

th.halign-right, td.halign-right { text-align: right; }

th.halign-center, td.halign-center { text-align: center; }

th.valign-top, td.valign-top { vertical-align: top; }

th.valign-bottom, td.valign-bottom { vertical-align: bottom; }

th.valign-middle, td.valign-middle { vertical-align: middle; }

table thead th, table tfoot th { font-weight: bold; }

tbody tr th { display: table-cell; line-height: 1.4; background: whitesmoke; }

tbody tr th, tbody tr th p, tfoot tr th, tfoot tr th p { color: #222222; font-weight: bold; }

p.tableblock > code:only-child { background: none; padding: 0; }

p.tableblock { font-size: 1em; }

td > div.verse { white-space: pre; }

ol { margin-left: 2.5em; }

ul li ol { margin-left: 1.5em; }

dl dd { margin-left: 1.125em; }

dl dd:last-child, dl dd:last-child > :last-child { margin-bottom: 0; }

ol > li p, ul > li p, ul dd, ol dd, .olist .olist, .ulist .ulist, .ulist .olist, .olist .ulist { margin-bottom: 0.625em; }

ul.unstyled, ol.unnumbered, ul.checklist, ul.none { list-style-type: none; }

ul.unstyled, ol.unnumbered, ul.checklist { margin-left: 0.625em; }

ul.checklist li > p:first-child > .fa-check-square-o:first-child, ul.checklist li > p:first-child > input[type="checkbox"]:first-child { margin-right: 0.25em; }

ul.checklist li > p:first-child > input[type="checkbox"]:first-child { position: relative; top: 1px; }

ul.inline { margin: 0 auto 0.625em auto; margin-left: -1.375em; margin-right: 0; padding: 0; list-style: none; overflow: hidden; }
ul.inline > li { list-style: none; float: left; margin-left: 1.375em; display: block; }
ul.inline > li > * { display: block; }

.unstyled dl dt { font-weight: normal; font-style: normal; }

ol.arabic { list-style-type: decimal; }

ol.decimal { list-style-type: decimal-leading-zero; }

ol.loweralpha { list-style-type: lower-alpha; }

ol.upperalpha { list-style-type: upper-alpha; }

ol.lowerroman { list-style-type: lower-roman; }

ol.upperroman { list-style-type: upper-roman; }

ol.lowergreek { list-style-type: lower-greek; }

.hdlist > table, .colist > table { border: 0; background: none; }
.hdlist > table > tbody > tr, .colist > table > tbody > tr { background: none; }

td.hdlist1 { padding-right: .75em; font-weight: bold; }

td.hdlist1, td.hdlist2 { vertical-align: top; }

.literalblock + .colist, .listingblock + .colist { margin-top: -0.5em; }

.colist > table tr > td:first-of-type { padding: 0 0.75em; line-height: 1; }
.colist > table tr > td:last-of-type { padding: 0.25em 0; }

.thumb, .th { line-height: 0; display: inline-block; border: solid 4px white; -webkit-box-shadow: 0 0 0 1px #dddddd; box-shadow: 0 0 0 1px #dddddd; }

.imageblock.left, .imageblock[style*="float: left"] { margin: 0.25em 0.625em 1.25em 0; }
.imageblock.right, .imageblock[style*="float: right"] { margin: 0.25em 0 1.25em 0.625em; }
.imageblock > .title { margin-bottom: 0; }
.imageblock.thumb, .imageblock.th { border-width: 6px; }
.imageblock.thumb > .title, .imageblock.th > .title { padding: 0 0.125em; }

.image.left, .image.right { margin-top: 0.25em; margin-bottom: 0.25em; display: inline-block; line-height: 0; }
.image.left { margin-right: 0.625em; }
.image.right { margin-left: 0.625em; }

a.image { text-decoration: none; }

span.footnote, span.footnoteref { vertical-align: super; font-size: 0.875em; }
span.footnote a, span.footnoteref a { text-decoration: none; }
span.footnote a:active, span.footnoteref a:active { text-decoration: underline; }

#footnotes { padding-top: 0.75em; padding-bottom: 0.75em; margin-bottom: 0.625em; }
#footnotes hr { width: 20%; min-width: 6.25em; margin: -.25em 0 .75em 0; border-width: 1px 0 0 0; }
#footnotes .footnote { padding: 0 0.375em; line-height: 1.3; font-size: 0.875em; margin-left: 1.2em; text-indent: -1.2em; margin-bottom: .2em; }
#footnotes .footnote a:first-of-type { font-weight: bold; text-decoration: none; }
#footnotes .footnote:last-of-type { margin-bottom: 0; }

#content #footnotes { margin-top: -0.625em; margin-bottom: 0; padding: 0.75em 0; }

.gist .file-data > table { border: 0; background: #fff; width: 100%; margin-bottom: 0; }
.gist .file-data > table td.line-data { width: 99%; }

div.unbreakable { page-break-inside: avoid; }

.big { font-size: larger; }

.small { font-size: smaller; }

.underline { text-decoration: underline; }

.overline { text-decoration: overline; }

.line-through { text-decoration: line-through; }

.aqua { color: #00bfbf; }

.aqua-background { background-color: #00fafa; }

.black { color: black; }

.black-background { background-color: black; }

.blue { color: #0000bf; }

.blue-background { background-color: #0000fa; }

.fuchsia { color: #bf00bf; }

.fuchsia-background { background-color: #fa00fa; }

.gray { color: #606060; }

.gray-background { background-color: #7d7d7d; }

.green { color: #006000; }

.green-background { background-color: #007d00; }

.lime { color: #00bf00; }

.lime-background { background-color: #00fa00; }

.maroon { color: #600000; }

.maroon-background { background-color: #7d0000; }

.navy { color: #000060; }

.navy-background { background-color: #00007d; }

.olive { color: #606000; }

.olive-background { background-color: #7d7d00; }

.purple { color: #600060; }

.purple-background { background-color: #7d007d; }

.red { color: #bf0000; }

.red-background { background-color: #fa0000; }

.silver { color: #909090; }

.silver-background { background-color: #bcbcbc; }

.teal { color: #006060; }

.teal-background { background-color: #007d7d; }

.white { color: #bfbfbf; }

.white-background { background-color: #fafafa; }

.yellow { color: #bfbf00; }

.yellow-background { background-color: #fafa00; }

span.icon > .fa { cursor: default; }

.admonitionblock td.icon [class^="fa icon-"] { font-size: 2.5em; text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.5); cursor: default; }
.admonitionblock td.icon .icon-note:before { content: "\f05a"; color: #207c98; }
.admonitionblock td.icon .icon-tip:before { content: "\f0eb"; text-shadow: 1px 1px 2px rgba(155, 155, 0, 0.8); color: #111; }
.admonitionblock td.icon .icon-warning:before { content: "\f071"; color: #bf6900; }
.admonitionblock td.icon .icon-caution:before { content: "\f06d"; color: #bf3400; }
.admonitionblock td.icon .icon-important:before { content: "\f06a"; color: #bf0000; }

.conum[data-value] { display: inline-block; color: #fff !important; background-color: #222222; -webkit-border-radius: 100px; border-radius: 100px; text-align: center; font-size: 0.75em; width: 1.67em; height: 1.67em; line-height: 1.67em; font-family: "Open Sans", "DejaVu Sans", sans-serif; font-style: normal; font-weight: bold; }
.conum[data-value] * { color: #fff !important; }
.conum[data-value] + b { display: none; }
.conum[data-value]:after { content: attr(data-value); }
pre .conum[data-value] { position: relative; top: -0.125em; }

b.conum * { color: inherit !important; }

.conum:not([data-value]):empty { display: none; }

.literalblock pre, .listingblock pre { background: #eeeeee; }

</style>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.2.0/css/font-awesome.min.css">
<style>.listingblock .pygments .hll { background-color: #ffffcc }
.listingblock .pygments  { background: #f8f8f8; }
.listingblock .pygments .tok-c { color: #408080; font-style: italic } /* Comment */
.listingblock .pygments .tok-err { border: 1px solid #FF0000 } /* Error */
.listingblock .pygments .tok-k { color: #008000; font-weight: bold } /* Keyword */
.listingblock .pygments .tok-o { color: #666666 } /* Operator */
.listingblock .pygments .tok-cm { color: #408080; font-style: italic } /* Comment.Multiline */
.listingblock .pygments .tok-cp { color: #BC7A00 } /* Comment.Preproc */
.listingblock .pygments .tok-c1 { color: #408080; font-style: italic } /* Comment.Single */
.listingblock .pygments .tok-cs { color: #408080; font-style: italic } /* Comment.Special */
.listingblock .pygments .tok-gd { color: #A00000 } /* Generic.Deleted */
.listingblock .pygments .tok-ge { font-style: italic } /* Generic.Emph */
.listingblock .pygments .tok-gr { color: #FF0000 } /* Generic.Error */
.listingblock .pygments .tok-gh { color: #000080; font-weight: bold } /* Generic.Heading */
.listingblock .pygments .tok-gi { color: #00A000 } /* Generic.Inserted */
.listingblock .pygments .tok-go { color: #888888 } /* Generic.Output */
.listingblock .pygments .tok-gp { color: #000080; font-weight: bold } /* Generic.Prompt */
.listingblock .pygments .tok-gs { font-weight: bold } /* Generic.Strong */
.listingblock .pygments .tok-gu { color: #800080; font-weight: bold } /* Generic.Subheading */
.listingblock .pygments .tok-gt { color: #0044DD } /* Generic.Traceback */
.listingblock .pygments .tok-kc { color: #008000; font-weight: bold } /* Keyword.Constant */
.listingblock .pygments .tok-kd { color: #008000; font-weight: bold } /* Keyword.Declaration */
.listingblock .pygments .tok-kn { color: #008000; font-weight: bold } /* Keyword.Namespace */
.listingblock .pygments .tok-kp { color: #008000 } /* Keyword.Pseudo */
.listingblock .pygments .tok-kr { color: #008000; font-weight: bold } /* Keyword.Reserved */
.listingblock .pygments .tok-kt { color: #B00040 } /* Keyword.Type */
.listingblock .pygments .tok-m { color: #666666 } /* Literal.Number */
.listingblock .pygments .tok-s { color: #BA2121 } /* Literal.String */
.listingblock .pygments .tok-na { color: #7D9029 } /* Name.Attribute */
.listingblock .pygments .tok-nb { color: #008000 } /* Name.Builtin */
.listingblock .pygments .tok-nc { color: #0000FF; font-weight: bold } /* Name.Class */
.listingblock .pygments .tok-no { color: #880000 } /* Name.Constant */
.listingblock .pygments .tok-nd { color: #AA22FF } /* Name.Decorator */
.listingblock .pygments .tok-ni { color: #999999; font-weight: bold } /* Name.Entity */
.listingblock .pygments .tok-ne { color: #D2413A; font-weight: bold } /* Name.Exception */
.listingblock .pygments .tok-nf { color: #0000FF } /* Name.Function */
.listingblock .pygments .tok-nl { color: #A0A000 } /* Name.Label */
.listingblock .pygments .tok-nn { color: #0000FF; font-weight: bold } /* Name.Namespace */
.listingblock .pygments .tok-nt { color: #008000; font-weight: bold } /* Name.Tag */
.listingblock .pygments .tok-nv { color: #19177C } /* Name.Variable */
.listingblock .pygments .tok-ow { color: #AA22FF; font-weight: bold } /* Operator.Word */
.listingblock .pygments .tok-w { color: #bbbbbb } /* Text.Whitespace */
.listingblock .pygments .tok-mb { color: #666666 } /* Literal.Number.Bin */
.listingblock .pygments .tok-mf { color: #666666 } /* Literal.Number.Float */
.listingblock .pygments .tok-mh { color: #666666 } /* Literal.Number.Hex */
.listingblock .pygments .tok-mi { color: #666666 } /* Literal.Number.Integer */
.listingblock .pygments .tok-mo { color: #666666 } /* Literal.Number.Oct */
.listingblock .pygments .tok-sb { color: #BA2121 } /* Literal.String.Backtick */
.listingblock .pygments .tok-sc { color: #BA2121 } /* Literal.String.Char */
.listingblock .pygments .tok-sd { color: #BA2121; font-style: italic } /* Literal.String.Doc */
.listingblock .pygments .tok-s2 { color: #BA2121 } /* Literal.String.Double */
.listingblock .pygments .tok-se { color: #BB6622; font-weight: bold } /* Literal.String.Escape */
.listingblock .pygments .tok-sh { color: #BA2121 } /* Literal.String.Heredoc */
.listingblock .pygments .tok-si { color: #BB6688; font-weight: bold } /* Literal.String.Interpol */
.listingblock .pygments .tok-sx { color: #008000 } /* Literal.String.Other */
.listingblock .pygments .tok-sr { color: #BB6688 } /* Literal.String.Regex */
.listingblock .pygments .tok-s1 { color: #BA2121 } /* Literal.String.Single */
.listingblock .pygments .tok-ss { color: #19177C } /* Literal.String.Symbol */
.listingblock .pygments .tok-bp { color: #008000 } /* Name.Builtin.Pseudo */
.listingblock .pygments .tok-vc { color: #19177C } /* Name.Variable.Class */
.listingblock .pygments .tok-vg { color: #19177C } /* Name.Variable.Global */
.listingblock .pygments .tok-vi { color: #19177C } /* Name.Variable.Instance */
.listingblock .pygments .tok-il { color: #666666 } /* Literal.Number.Integer.Long */
</style>
</head>
<body class="article toc2 toc-left">
<div id="header">
<h1>Servicios Rest</h1>
<div class="details">
<span id="author" class="author">MarÃ­a Isabel Alfonso Galipienso</span><br>
<span id="email" class="email">&lt;<a href="mailto:eli@ua.es">eli@ua.es</a>&gt;</span><br>
</div>
<div id="toc" class="toc2">
<div id="toctitle">Ãndice de contenidos</div>
<ul class="sectlevel1">
<li><a href="#sesion04">4. HATEOAS y Seguridad</a>
<ul class="sectlevel2">
<li><a href="#__qu%C3%A9_es_hateoas">4.1. Â¿QuÃ© es HATEOAS?</a></li>
<li><a href="#_hateoas_y_servicios_web">4.2. HATEOAS y Servicios Web</a>
<ul class="sectlevel3">
<li><a href="#_enlaces_atom">4.2.1. Enlaces Atom</a></li>
<li><a href="#_ventajas_de_utilizar_hateoas_con_servicios_web">4.2.2. Ventajas de utilizar HATEOAS con Servicios Web</a></li>
<li><a href="#_enlaces_en_cabeceras_frente_a_enlaces_atom">4.2.3. Enlaces en cabeceras frente a enlaces Atom</a></li>
</ul>
</li>
<li><a href="#_hateoas_y_jax_rs">4.3. HATEOAS y JAX-RS</a>
<ul class="sectlevel3">
<li><a href="#_construcci%C3%B3n_de_uris_con_uribuilder">4.3.1. ConstrucciÃ³n de URIs con UriBuilder</a></li>
<li><a href="#_uris_relativas_mediante_el_uso_de_uriinfo">4.3.2. URIs relativas mediante el uso de UriInfo</a></li>
<li><a href="#_construcci%C3%B3n_de_enlaces_links_en_documentos_xml_y_en_cabeceras_http">4.3.3. ConstrucciÃ³n de enlaces (Links) en documentos XML y en cabeceras HTTP</a></li>
</ul>
</li>
<li><a href="#_seguridad">4.4. Seguridad</a>
<ul class="sectlevel3">
<li><a href="#_autentificaci%C3%B3n_en_jax_rs">4.4.1. AutentificaciÃ³n en JAX-RS</a></li>
<li><a href="#_autorizaci%C3%B3n_en_jax_rs">4.4.2. AutorizaciÃ³n en JAX-RS</a></li>
<li><a href="#_encriptaci%C3%B3n">4.4.3. EncriptaciÃ³n</a></li>
<li><a href="#_seguridad_programada">4.4.4. Seguridad programada</a></li>
</ul>
</li>
<li><a href="#_ejercicios">4.5. Ejercicios</a>
<ul class="sectlevel3">
<li><a href="#_uso_de_hateoas_1_puntos">4.5.1. Uso de Hateoas (1 puntos)</a></li>
<li><a href="#_ejercicio_seguridad_1_punto">4.5.2. Ejercicio seguridad (1 punto)</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
</div>
<div id="content">
<div id="preamble">
<div class="sectionbody">
<div style="page-break-after: always;"></div>
</div>
</div>
<div class="sect1">
<h2 id="sesion04">4. HATEOAS y Seguridad</h2>
<div class="sectionbody">
<div class="paragraph">
<p>En esta sesiÃ³n trataremos uno de los principios REST de obligado cumplimiento
para poder hablar de un servicio RESTful. Nos referimos a HATEOAS. Hasta ahora hemos
visto cÃ³mo los clientes pueden cambiar el estado de los recursos (el nombre del
recurso se especifica en la URI de la peticiÃ³n) a travÃ©s de los contenidos
del cuerpo del mensaje, o utilizando parÃ¡metros, o cabeceras de peticiÃ³n. A su vez,
los servicios comunican el estado resultante de la peticiÃ³n a los clientes a travÃ©s
del contenido del cuerpo del mensaje, cÃ³digos de respuesta, y cabeceras de respuesta.
Pues bien, teniendo en cuenta lo anterior, HATEOAS hace referencia a que, cuando
sea necesario, tambiÃ©n
deben incluirse los enlaces a los recursos (URI) en el cuerpo de la respuesta
(o en las cabeceras), para asÃ­ poder recuperar el recurso en cuestiÃ³n, o los
recursos relacionados.</p>
</div>
<div class="paragraph">
<p>En esta sesiÃ³n tambiÃ©n explicaremos algunos conceptos bÃ¡sicos para poder dotar de seguridad a
nuestros servicios REST</p>
</div>
<div class="sect2">
<h3 id="__quÃ©_es_hateoas">4.1. Â¿QuÃ© es HATEOAS?</h3>
<div class="paragraph">
<p>ComÃºnmente se hace referencia a Internet como "la <em>Web</em>" (<em>web</em> significa red,
telaraÃ±a), debido a que la informaciÃ³n estÃ¡ interconectada mediante una serie de
hiperenlaces embebidos dentro de los documentos HTML. Estos enlaces crean una
especie de "hilos" o "hebras" entre los sitios web relacionados en Internet.
 Una consecuencia de ello es que los humanos pueden "navegar" por la Web buscando
 elementos de informaciÃ³n relacionados de su interÃ©s, haciendo "click" en los
 diferentes enlaces desde sus navegadores. Los motores de bÃºsqueda pueden "trepar"
 o "desplazarse" por estos enlaces y crear Ã­ndices enormes de datos susceptibles de
 ser "buscados". Sin ellos, Internet no podrÃ­a tener la propiedad de ser escalable.
 No habrÃ­a forma de indexar fÃ¡cilmente la informaciÃ³n, y el registro de sitios web
 serÃ­a un proceso manual bastante tedioso.</p>
</div>
<div class="paragraph">
<p>AdemÃ¡s de los enlaces (<em>links</em>), otra caracterÃ­stica fundamental de Internet es
 HTML. En ocasiones, un sitio web nos solicita que "rellenemos" alguna informaciÃ³n
 para comprar algo o registrarnos en algÃºn servicio. El servidor nos indica a nosotros
 como clientes quÃ© informaciÃ³n necesitamos proporcionar para completar una acciÃ³n
 descrita en la pÃ¡gina web que estamos viendo. El navegador nos muestra la pÃ¡gina web
 en un formado que podemos entender fÃ¡cilmente. Nosotros leemos la pÃ¡gina web y
 rellenamos y enviamos el formulario. Un formulario HTML es un formato de datos
 interesante debido a que auto-describe la interacciÃ³n entre el cliente y el servidor.</p>
</div>
<div class="paragraph">
<p>El principio arquitectÃ³nico que describe el proceso de enlazado (<em>linking</em>) y
 el envÃ­o de formularios se denomina <strong>HATEOAS</strong>. Las siglas del tÃ©rmino HATEOAS
  significan <strong>H</strong>ypermedia <strong>A</strong>s <strong>T</strong>he <strong>E</strong>ngine <strong>O</strong>f <strong>A</strong>pplication
  <strong>S</strong>tate (es decir, el uso de Hipermedia como mecanismo de mÃ¡quina de estados de
  la aplicaciÃ³n). La idea de HATEOAS es que el formato de los datos proporciona
  informaciÃ³n extra sobre cÃ³mo cambiar el estado de nuestra aplicaciÃ³n. En la Web,
  los enlaces HTML nos permiten cambiar el estado de nuestro navegador. Por ejemplo
  cuando estamos leyendo una pÃ¡gina web, un enlace nos indica quÃ© posibles documentos
   (estados) podemos ver a continuaciÃ³n. Cuando hacemos "click" sobre un enlace,
   el estado del navegador cambia al visitar y mostrar una nueva pÃ¡gina web.
   Los formularios HTML, por otra parte, nos proporcionan una forma de cambiar el
   estado de un recurso especÃ­fico de nuestro servidor. Por Ãºltimo, cuando compramos algo en
   Internet, por ejemplo, estamos creando dos nuevos recursos en el servicio: una
   transacciÃ³n con tarjeta de crÃ©dito y una orden de compra.</p>
</div>
</div>
<div class="sect2">
<h3 id="_hateoas_y_servicios_web">4.2. HATEOAS y Servicios Web</h3>
<div class="paragraph">
<p>Cuando aplicamos HATEOAS a los servicios web la idea es incluir enlaces en nuestros
documentos XML o JSON. La mayorÃ­a de las aplicaciones RESTful basadas en XML utilizan
el formato <a href="http://www.w3.org/2005/Atom"><strong><em>Atom Syndication Format</em></strong></a> para implementar HATEOAS.</p>
</div>
<div class="sect3">
<h4 id="_enlaces_atom">4.2.1. Enlaces Atom</h4>
<div class="paragraph">
<p>Los enlaces Atom constituyen un mecanismo estÃ¡ndar para incluir enlaces (<em>links</em>) en
nuestros documentos XML. Veamos un ejemplo:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><span class="tok-nt">&lt;clientes&gt;</span>
   <span class="tok-nt">&lt;link</span> <span class="tok-na">rel=</span><span class="tok-s">&quot;next&quot;</span>
         <span class="tok-na">href=</span><span class="tok-s">&quot;http://ejemplo.com/clientes?inicio=2&amp;total=2&quot;</span>
        <span class="tok-na">type=</span><span class="tok-s">&quot;application/xml&quot;</span><span class="tok-nt">/&gt;</span>
   <span class="tok-nt">&lt;cliente</span> <span class="tok-na">id=</span><span class="tok-s">&quot;123&quot;</span><span class="tok-nt">&gt;</span>
      <span class="tok-nt">&lt;nombre&gt;</span>Juan Garcia<span class="tok-nt">&lt;/nombre&gt;</span>
   <span class="tok-nt">&lt;/cliente&gt;</span>
   <span class="tok-nt">&lt;cliente</span> <span class="tok-na">id=</span><span class="tok-s">&quot;332&quot;</span><span class="tok-nt">&gt;</span>
      <span class="tok-nt">&lt;nombre&gt;</span>Pablo Bozo<span class="tok-nt">&lt;/nombre&gt;</span>
   <span class="tok-nt">&lt;/cliente&gt;</span>
<span class="tok-nt">&lt;/clientes&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>El documento anterior representa una lista de clientes, y el elemento <code>&lt;link&gt;</code>
, que contiene un enlace, indica la forma de obtener los siguientes clientes de la lista.</p>
</div>
<div class="paragraph">
<p>Un enlace Atom es simplemente un elemento XML (elemento <code>&lt;link&gt;</code>) con unos atributos especÃ­ficos.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>El atributo <code>rel</code> Se utiliza para indicar la relaciÃ³n del enlace con el elemento XML en el que
 anidamos dicho enlace.
Es el <strong>nombre lÃ³gico</strong> utilizado para referenciar el enlace. Este atributo tiene
el mismo significado para la URL que estamos enlazando, que la etiqueta HTML
&lt;a&gt; tiene para la URL sobre la que estamos haciendo <em>click</em> con el ratÃ³n en el navegador.
Si el enlace hace referencia al propio elemento XML en el que incluimos el enlace,
entonces asignaremos el valor del atributo <code>self</code></p>
</li>
<li>
<p>El atributo <code>href</code> es la <strong>URL</strong> a la que podemos acceder para obtener nueva informaciÃ³n
o cambiar el estado de nuestra aplicaciÃ³n</p>
</li>
<li>
<p>El atributo <code>type</code> indica el <em>media type</em> asociado con el recurso al que apunta la URL</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Cuando un cliente recibe un documento con enlaces Atom, Ã©ste busca la relaciÃ³n en la que
estÃ¡ interesado (atributo <code>rel</code>) e invoca la URI indicada en el atributo <code>href</code>.</p>
</div>
</div>
<div class="sect3">
<h4 id="_ventajas_de_utilizar_hateoas_con_servicios_web">4.2.2. Ventajas de utilizar HATEOAS con Servicios Web</h4>
<div class="paragraph">
<p>Resulta bastante obvio por quÃ© los enlaces y los formularios tienen mucho que ver en la
prevalencia de la Web. Con un navegador, tenemos una "ventana" a todo un mundo de informaciÃ³n y
servicios. Las mÃ¡quinas de bÃºsqueda "rastrean" Internet e indexan sitios web para que todos
los datos estÃ©n al alcance de nuestros "dedos". Esto es posible debido a que la Web es
auto-descriptiva. Cuando accedemos a un documento, conocemos cÃ³mo recuperar informaciÃ³n
adicional "siguiendo" los enlaces situados en dicho documento. Por ejemplo, conocemos cÃ³mo
realizar una compra en Amazon, debido a que los formularios HTML nos indican cÃ³mo hacerlo.</p>
</div>
<div class="paragraph">
<p>Cuando los clientes son "mÃ¡quinas" en lugar de personas (los servicios Web tambiÃ©n se
conocen como "Web para mÃ¡quinas", frente a la "Web para humanos" proporcionada por
el acceso a un servidor web a travÃ©s de un navegador) el tema es algo diferente, puesto
que las mÃ¡quinas no pueden tomar decisiones "sobre la marcha", cosa que los humanos sÃ­
pueden hacer. Las mÃ¡quinas requieren que los programadores les digan cÃ³mo interpretar los
datos recibidos desde un servicio y cÃ³mo realizar transiciones entre estados como resultado
de las interacciones entre clientes y servidores.</p>
</div>
<div class="paragraph">
<p>En este sentido, HATEOAS proporciona algunas ventajas importantes para contribuir a que los
clientes sepan cÃ³mo utilizar los servicios a la vez que acceden a los mismos. Vamos a comentar
algunas de ellas.</p>
</div>
<div class="sect4">
<h5 id="_transparencia_en_la_localizaciÃ³n">Transparencia en la localizaciÃ³n</h5>
<div class="paragraph">
<p>En un sistema RESTful, gracias a HATEOAS, sÃ³lo es necesario hacer pÃºblicas unas pocas
 URIs. Los servicios y la informaciÃ³n son representados con enlaces que estÃ¡n "embebidos"
 en los formatos de los datos devueltos por las URIs pÃºblicas. Los clientes necesitan
 conocer los nombres lÃ³gicos de los enlaces para "buscar" a travÃ©s de ellos, pero no necesitan
 conocer las ubicaciones reales en la red de los servicios a los que acceden.</p>
</div>
<div class="paragraph">
<p>Los enlaces proporcionan un nivel de indirecciÃ³n, de forma que los servicios subyacentes
pueden cambiar sus localizaciones en la red sin alterar la lÃ³gica ni el cÃ³digo del cliente.</p>
</div>
</div>
<div class="sect4">
<h5 id="_desacoplamiento_de_los_detalles_de_la_interacciÃ³n">Desacoplamiento de los detalles de la interacciÃ³n</h5>
<div class="paragraph">
<p>Consideremos una peticiÃ³n que nos devuelve una lista de clientes en una base de datos:
<code>GET /clientes</code>. Si nuestra base de datos tiene miles de datos, probablemente no querremos
devolver todos ellos de una sÃ³la vez. Lo que podemos hacer es definir una vista en
nuestra base de datos utilizando parÃ¡metros de consulta, por ejemplo:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>/customers?inicio={indiceInicio}&amp;total={numeroElementosDevueltos}</pre>
</div>
</div>
<div class="paragraph">
<p>El parÃ¡metro <code>inicio</code> identifica el Ã­ndice inicial de nuestra lista de clientes. El parÃ¡metro
<code>total</code> especifica cuÃ¡ntos clientes queremos que nos sean devueltos como respuesta.</p>
</div>
<div class="paragraph">
<p>Lo que estamos haciendo, en realidad, es incrementar la cantidad de conocimiento
que el cliente debe tener predefinido para interactuar con el servicio (es decir, no sÃ³lo
necesita saber la URI, sino ademÃ¡s conocer la existencia de estos parÃ¡metros).
Supongamos que en el futuro, el servidor decide que necesita cambiar la forma en la que
se accede al nÃºmero de datos solicitados por el cliente. Si el servidor cambia la
interfaz, los clientes "antiguos" dejarÃ¡n de funcionar a menos que cambien su cÃ³digo.</p>
</div>
<div class="paragraph">
<p>En lugar de publicar la interfaz REST anterior para obtener datos de los clientes,
podemos incluir dicha informaciÃ³n en el documento de respuesta, por ejemplo:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><span class="tok-nt">&lt;clientes&gt;</span>
   <span class="tok-nt">&lt;link</span> <span class="tok-na">rel=</span><span class="tok-s">&quot;next&quot;</span>
         <span class="tok-na">href=</span><span class="tok-s">&quot;http://ejemplo.com/clientes?inicio=2&amp;total=2&quot;</span>
        <span class="tok-na">type=</span><span class="tok-s">&quot;application/xml&quot;</span><span class="tok-nt">/&gt;</span>
   <span class="tok-nt">&lt;cliente</span> <span class="tok-na">id=</span><span class="tok-s">&quot;123&quot;</span><span class="tok-nt">&gt;</span>
      <span class="tok-nt">&lt;nombre&gt;</span>Juan Garcia<span class="tok-nt">&lt;/nombre&gt;</span>
   <span class="tok-nt">&lt;/cliente&gt;</span>
   <span class="tok-nt">&lt;cliente</span> <span class="tok-na">id=</span><span class="tok-s">&quot;332&quot;</span><span class="tok-nt">&gt;</span>
      <span class="tok-nt">&lt;nombre&gt;</span>Pablo Bozo<span class="tok-nt">&lt;/nombre&gt;</span>
   <span class="tok-nt">&lt;/cliente&gt;</span>
<span class="tok-nt">&lt;/clientes&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Cuando incluimos un enlace Atom en un documento, estamos asignando un <strong>nombre lÃ³gico</strong>
a una <strong>transiciÃ³n de estados</strong>. En el ejemplo anterior, la transiciÃ³n de estados es el
siguiente conjunto de clientes a los que podemos acceder. En lugar de tener que
recordar cuÃ¡les son los parÃ¡metros de la URI que tenemos que utilizar en la siguiente
invocaciÃ³n para obtener mÃ¡s clientes, lo Ãºnico que tenemos que hacer es "seguir"
el enlace proporcionado. El cliente no tiene que "contabilizar" en ningÃºn sitio la
interacciÃ³n, ni tiene que recordar quÃ© "secciÃ³n" de la base de datos estamos consultando
actualmente.</p>
</div>
<div class="paragraph">
<p>AdemÃ¡s, el XML devuelto es auto-contenido. Â¿QuÃ© pasa si tenemos que "pasar" este
documento a un tercero? TendrÃ­amos que "decirle" que se trata de una vista parcial
de la base de datos y especificar el Ã­dice de inicio. Al incluir el enlace en el
documento, ya no es necesario proporcionar dicha informaciÃ³n adicional, ya que forma
parte del propio documento</p>
</div>
</div>
<div class="sect4">
<h5 id="_reducciÃ³n_de_errores_de_transiciÃ³n_de_estados">ReducciÃ³n de errores de transiciÃ³n de estados</h5>
<div class="paragraph">
<p>Los enlaces no se utilizan solamente como un mecanismo para agregar informaciÃ³n de
"navegaciÃ³n". TambiÃ©n se utilizan para cambiar el estado de los recursos. Pensemos
en una aplicaciÃ³n de comercio web a la que podemos acceder con la URI <code>pedidos/333</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><span class="tok-nt">&lt;pedido</span> <span class="tok-na">id=</span><span class="tok-s">&quot;333&quot;</span><span class="tok-nt">&gt;</span>
   <span class="tok-nt">&lt;cliente</span> <span class="tok-na">id=</span><span class="tok-s">&quot;123&quot;</span><span class="tok-nt">&gt;</span>...<span class="tok-nt">&lt;/cliente&gt;</span>
   <span class="tok-nt">&lt;importe&gt;</span>99.99<span class="tok-nt">&lt;/importe&gt;</span>
   <span class="tok-nt">&lt;lineas-pedido&gt;</span>
     ...
   <span class="tok-nt">&lt;/lineas-pedido&gt;</span>
<span class="tok-nt">&lt;/pedido&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Supongamos que un cliente quiere cancelar su pedido. PodrÃ­a simplemente invocar
la peticiÃ³n HTTP <code>DELETE /pedidos/333</code>. Esta no es siempre la mejor opciÃ³n, ya que
normalmente el sistema necesitarÃ¡ "retener" el pedido para propÃ³sitos de almacenaje.
Por ello, podrÃ­amos considerar una nueva representaciÃ³n del pedido con un elemento
<code>cancelado</code> a true:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml">PUT /pedidos/333 HTTP/1.1
Content-Type: application/xml
<span class="tok-nt">&lt;pedido</span> <span class="tok-na">id=</span><span class="tok-s">&quot;333&quot;</span><span class="tok-nt">&gt;</span>
   <span class="tok-nt">&lt;cliente</span> <span class="tok-na">id=</span><span class="tok-s">&quot;123&quot;</span><span class="tok-nt">&gt;</span>...<span class="tok-nt">&lt;/cliente&gt;</span>
   <span class="tok-nt">&lt;importe&gt;</span>99.99<span class="tok-nt">&lt;/importe&gt;</span>
   <span class="tok-nt">&lt;cancelado&gt;</span>true<span class="tok-nt">&lt;/cancelado&gt;</span>
   <span class="tok-nt">&lt;lineas-pedido&gt;</span>
        ...
   <span class="tok-nt">&lt;/lineas-pedido&gt;</span>
<span class="tok-nt">&lt;/pedido&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Pero, Â¿quÃ© ocurre si el pedido no puede cancelarse? Podemos tener un cierto estado en
nuestro proceso de pedidos en donde esta acciÃ³n no estÃ¡ permitida. Por  ejemplo, si el
pedido ya ha sido enviado, entonces no puede cancelarse. En este caso, realmente no
hay nigÃºn cÃ³digo de estado HTTP de respuesta que represente esta situaciÃ³n. Una mejor
aproximaciÃ³n es incluir un enlace para poder realizar la cancelaciÃ³n:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><span class="tok-nt">&lt;pedido</span> <span class="tok-na">id=</span><span class="tok-s">&quot;333&quot;</span><span class="tok-nt">&gt;</span>
   <span class="tok-nt">&lt;cliente</span> <span class="tok-na">id=</span><span class="tok-s">&quot;123&quot;</span><span class="tok-nt">&gt;</span>...<span class="tok-nt">&lt;/cliente&gt;</span>
   <span class="tok-nt">&lt;importe&gt;</span>99.99<span class="tok-nt">&lt;/importe&gt;</span>
   <span class="tok-nt">&lt;cancelado&gt;</span>false<span class="tok-nt">&lt;/cancelado&gt;</span>
   <span class="tok-nt">&lt;link</span> <span class="tok-na">rel=</span><span class="tok-s">&quot;cancelar&quot;</span>
        <span class="tok-na">href=</span><span class="tok-s">&quot;http://ejemplo.com/pedidos/333/cancelado&quot;</span><span class="tok-nt">/&gt;</span>
   <span class="tok-nt">&lt;lineas-pedido&gt;</span>
           ...
   <span class="tok-nt">&lt;/lineas-pedido&gt;</span>
<span class="tok-nt">&lt;/pedido&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>El cliente podrÃ­a invocar la orden: <code>GET /pedidos/333</code> y obtener el documento XML
que representa el pedido. Si el documento contiene el enlace <strong>cancelar</strong>, entonces
el cliente puede cambiar el estado del pedido a "cancelado" enviando una orden PUT vacÃ­a
a la URI referenciada en el enlace. Si el documento no contiene el enlace, el cliente
sabe que esta operaciÃ³n no es posible. Esto permite que el servicio web controle en
tiempo real la forma en la que el cliente interactua con el sistema.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_enlaces_en_cabeceras_frente_a_enlaces_atom">4.2.3. Enlaces en cabeceras frente a enlaces Atom</h4>
<div class="paragraph">
<p>Una alternativa al uso de enlaces Atom en el cuerpo de la respuesta, es utilizar
enlaces en las cabeceras de la respuesta (<a href="http://tools.ietf.org/html/rfc5988" class="bare">http://tools.ietf.org/html/rfc5988</a>). Vamos
a explicar Ã©sto con un ejemplo.</p>
</div>
<div class="paragraph">
<p>Consideremos el ejemplo de cancelaciÃ³n de un pedido que acabamos de ver.
En lugar de utilizar un enlace Atom para especificar si se permite o no la cancelaciÃ³n
del pedido, podemos utilizar la cabecera <code>Link</code> (es uno de los posibles campos que podemos
incluir como cabecera en una respuesta HTTP)).
De esta forma, si un usuario
envÃ­a la peticiÃ³n <code>GET /pedidos/333</code>, recibirÃ¡ la siguiente respuesta HTTP:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="sh">HTTP/1.1 <span class="tok-m">200</span> OK
Content-Type: application/xml
Link: &lt;http://ejemplo.com/pedidos/333/cancelado&gt;<span class="tok-p">;</span> <span class="tok-nv">rel</span><span class="tok-o">=</span>cancel

&lt;pedido <span class="tok-nv">id</span><span class="tok-o">=</span><span class="tok-s2">&quot;333&quot;</span>&gt;
   ...
&lt;/pedido&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>La cabecera <code>Link</code> tiene las mismas caracterÃ­sticas que un enlace Atom. La URI
estÃ¡ entre los signos <code>&lt;</code> y <code>&gt;</code> y estÃ¡ seguida por uno o mÃ¡s atributos delimitados
 por <code>;</code>. El atributo <code>rel</code> es obligatorio y tiene el mismo significado que el
 correspondiente atributo Atom com el mismo nombre. En el ejemplo no se muestra,
  pero podrÃ­amos especificar el <em>media type</em> utilizando el atributo <code>type</code>.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_hateoas_y_jax_rs">4.3. HATEOAS y JAX-RS</h3>
<div class="paragraph">
<p>JAX-RS no proporciona mucho soporte para implementar HATEOAS. HATEOAS se define por
 la aplicaciÃ³n, por lo que no hay mucho que pueda aportar ningÃºn <em>framework</em>. Lo que
 sÃ­ proporciona JAX-RS son algunas clases que podemos utilizar para construir las URIs
 de los enlaces HATEOAS.</p>
</div>
<div class="sect3">
<h4 id="_construcciÃ³n_de_uris_con_uribuilder">4.3.1. ConstrucciÃ³n de URIs con UriBuilder</h4>
<div class="paragraph">
<p>Una clase que podemos utilizar es <code>javax.ws.rs.core.UriBuilder</code>. Esta clase nos permite
construir URIs elemento a elemento, y tambiÃ©n permite incluir plantillas de parÃ¡metros
(segmentos de ruta variables).</p>
</div>
<div class="listingblock">
<div class="title">Clase UriBuilder: mÃ©todos para instanciar objetos de la clase</div>
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span class="tok-kd">public</span> <span class="tok-kd">abstract</span> <span class="tok-kd">class</span> <span class="tok-nc">UriBuilder</span> <span class="tok-o">{</span>
  <span class="tok-kd">public</span> <span class="tok-kd">static</span> <span class="tok-n">UriBuilder</span> <span class="tok-nf">fromUri</span><span class="tok-o">(</span><span class="tok-n">URI</span> <span class="tok-n">uri</span><span class="tok-o">)</span>
                <span class="tok-kd">throws</span> <span class="tok-n">IllegalArgumentException</span>
  <span class="tok-kd">public</span> <span class="tok-kd">static</span> <span class="tok-n">UriBuilder</span> <span class="tok-nf">fromUri</span><span class="tok-o">(</span><span class="tok-n">String</span> <span class="tok-n">uri</span><span class="tok-o">)</span>
                <span class="tok-kd">throws</span> <span class="tok-n">IllegalArgumentException</span>
  <span class="tok-kd">public</span> <span class="tok-kd">static</span> <span class="tok-n">UriBuilder</span> <span class="tok-nf">fromPath</span><span class="tok-o">(</span><span class="tok-n">String</span> <span class="tok-n">path</span><span class="tok-o">)</span>
                <span class="tok-kd">throws</span> <span class="tok-n">IllegalArgumentException</span>
  <span class="tok-kd">public</span> <span class="tok-kd">static</span> <span class="tok-n">UriBuilder</span> <span class="tok-nf">fromResource</span><span class="tok-o">(</span><span class="tok-n">Class</span><span class="tok-o">&lt;?&gt;</span> <span class="tok-n">resource</span><span class="tok-o">)</span>
                <span class="tok-kd">throws</span> <span class="tok-n">IllegalArgumentException</span>
  <span class="tok-kd">public</span> <span class="tok-kd">static</span> <span class="tok-n">UriBuilder</span> <span class="tok-nf">fromLink</span><span class="tok-o">(</span><span class="tok-n">Link</span> <span class="tok-n">link</span><span class="tok-o">)</span>
                <span class="tok-kd">throws</span> <span class="tok-n">IllegalArgumentException</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Las <strong>instancias</strong> de <code>UriBuilder</code> se obtienen a partir de mÃ©todos estÃ¡ticos con la forma
<code>fromXXX()</code>. Podemos inicializarlas a partir de una URI, una cadena de caracteres, o
la anotaciÃ³n @Path de una clase de recurso.</p>
</div>
<div class="paragraph">
<p>Para extraer, modificar y/o componer una URI, se pueden utilizar mÃ©todos como:</p>
</div>
<div class="listingblock">
<div class="title">Clase UriBuilder: mÃ©todos para "manipular" las URIs</div>
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span class="tok-kd">public</span> <span class="tok-kd">abstract</span> <span class="tok-n">UriBuilder</span> <span class="tok-nf">clone</span><span class="tok-o">();</span> <span class="tok-c1">// crea una copia</span>

<span class="tok-c1">// crea una copia con la informaciÃ³n de un objeto URI</span>
<span class="tok-kd">public</span> <span class="tok-kd">abstract</span> <span class="tok-n">UriBuilder</span> <span class="tok-nf">uri</span><span class="tok-o">(</span><span class="tok-n">URI</span> <span class="tok-n">uri</span><span class="tok-o">)</span>
                  <span class="tok-kd">throws</span> <span class="tok-n">IllegalArgumentException</span><span class="tok-o">;</span>

<span class="tok-c1">// mÃ©todos para asignar/modificar valores de</span>
<span class="tok-c1">// los atributos de los objetos UriBuilder</span>
<span class="tok-kd">public</span> <span class="tok-kd">abstract</span> <span class="tok-n">UriBuilder</span> <span class="tok-nf">scheme</span><span class="tok-o">(</span><span class="tok-n">String</span> <span class="tok-n">scheme</span><span class="tok-o">)</span>
                  <span class="tok-kd">throws</span> <span class="tok-n">IllegalArgumentException</span><span class="tok-o">;</span>
<span class="tok-kd">public</span> <span class="tok-kd">abstract</span> <span class="tok-n">UriBuilder</span> <span class="tok-nf">userInfo</span><span class="tok-o">(</span><span class="tok-n">String</span> <span class="tok-n">ui</span><span class="tok-o">);</span>
<span class="tok-kd">public</span> <span class="tok-kd">abstract</span> <span class="tok-n">UriBuilder</span> <span class="tok-nf">host</span><span class="tok-o">(</span><span class="tok-n">String</span> <span class="tok-n">host</span><span class="tok-o">)</span>
                  <span class="tok-kd">throws</span> <span class="tok-n">IllegalArgumentException</span><span class="tok-o">;</span>
<span class="tok-kd">public</span> <span class="tok-kd">abstract</span> <span class="tok-n">UriBuilder</span> <span class="tok-nf">port</span><span class="tok-o">(</span><span class="tok-kt">int</span> <span class="tok-n">port</span><span class="tok-o">)</span>
                  <span class="tok-kd">throws</span> <span class="tok-n">IllegalArgumentException</span><span class="tok-o">;</span>
<span class="tok-kd">public</span> <span class="tok-kd">abstract</span> <span class="tok-n">UriBuilder</span> <span class="tok-nf">replacePath</span><span class="tok-o">(</span><span class="tok-n">String</span> <span class="tok-n">path</span><span class="tok-o">);</span>

<span class="tok-c1">// mÃ©todos que aÃ±aden elementos a nuestra URI</span>
<span class="tok-kd">public</span> <span class="tok-kd">abstract</span> <span class="tok-n">UriBuilder</span> <span class="tok-nf">path</span><span class="tok-o">(</span><span class="tok-n">String</span> <span class="tok-n">path</span><span class="tok-o">)</span>
<span class="tok-kd">public</span> <span class="tok-kd">abstract</span> <span class="tok-n">UriBuilder</span> <span class="tok-nf">segment</span><span class="tok-o">(</span><span class="tok-n">String</span><span class="tok-o">...</span> <span class="tok-n">segments</span><span class="tok-o">)</span>
<span class="tok-kd">public</span> <span class="tok-kd">abstract</span> <span class="tok-n">UriBuilder</span> <span class="tok-nf">matrixParam</span><span class="tok-o">(</span><span class="tok-n">String</span> <span class="tok-n">name</span><span class="tok-o">,</span>
                                       <span class="tok-n">Object</span><span class="tok-o">...</span> <span class="tok-n">values</span><span class="tok-o">)</span>
<span class="tok-kd">public</span> <span class="tok-kd">abstract</span> <span class="tok-n">UriBuilder</span> <span class="tok-nf">queryParam</span><span class="tok-o">(</span><span class="tok-n">String</span> <span class="tok-n">name</span><span class="tok-o">,</span>
                                      <span class="tok-n">Object</span><span class="tok-o">...</span> <span class="tok-n">values</span><span class="tok-o">)</span>

<span class="tok-c1">// mÃ©todo que instancia el valor de una plantilla de la URI</span>
<span class="tok-kd">public</span> <span class="tok-kd">abstract</span> <span class="tok-n">UriBuilder</span> <span class="tok-nf">resolveTemplate</span><span class="tok-o">(</span><span class="tok-n">String</span> <span class="tok-n">name</span><span class="tok-o">,</span>
                                      <span class="tok-n">Object</span> <span class="tok-n">value</span><span class="tok-o">)</span>
<span class="tok-err">ï¿¼</span><span class="tok-o">...</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Los mÃ©todos <code>build()</code> construyen la URI. Ãsta puede contener plantillas de parÃ¡metros (
segmentos de ruta variables), que deberemos inicializar utilizando pares nombre/valor,
o bien una lista de valores que reemplazarÃ¡n a los parÃ¡metros de la plantilla en el orden
 en el que aparezcan.</p>
</div>
<div class="listingblock">
<div class="title">Clase UriBuilder: mÃ©todos buildXXX() para construir las URIs</div>
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span class="tok-kd">public</span> <span class="tok-kd">abstract</span> <span class="tok-n">URI</span> <span class="tok-nf">buildFromMap</span><span class="tok-o">(</span><span class="tok-n">Map</span><span class="tok-o">&lt;</span><span class="tok-n">String</span><span class="tok-o">,</span> <span class="tok-o">?</span> <span class="tok-kd">extends</span> <span class="tok-n">Object</span><span class="tok-o">&gt;</span> <span class="tok-n">values</span><span class="tok-o">)</span>
                <span class="tok-kd">throws</span> <span class="tok-n">IllegalArgumentException</span><span class="tok-o">,</span> <span class="tok-n">UriBuilderException</span><span class="tok-o">;</span>

<span class="tok-kd">public</span> <span class="tok-kd">abstract</span> <span class="tok-n">URI</span> <span class="tok-nf">build</span><span class="tok-o">(</span><span class="tok-n">Object</span><span class="tok-o">...</span> <span class="tok-n">values</span><span class="tok-o">)</span>
                <span class="tok-kd">throws</span> <span class="tok-n">IllegalArgumentException</span><span class="tok-o">,</span> <span class="tok-n">UriBuilderException</span><span class="tok-o">;</span>
<span class="tok-o">...</span>
<span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Veamos algÃºn ejemplo que muestra cÃ³mo crear, inicializar, componer y construir una URI
utilizando un <code>UriBuilder</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span class="tok-n">UriBuilder</span> <span class="tok-n">builder</span> <span class="tok-o">=</span> <span class="tok-n">UriBuilder</span><span class="tok-o">.</span><span class="tok-na">fromPath</span><span class="tok-o">(</span><span class="tok-s">&quot;/clientes/{id}&quot;</span><span class="tok-o">);</span>
<span class="tok-n">builder</span><span class="tok-o">.</span><span class="tok-na">scheme</span><span class="tok-o">(</span><span class="tok-s">&quot;http&quot;</span><span class="tok-o">)</span>
       <span class="tok-o">.</span><span class="tok-na">host</span><span class="tok-o">(</span><span class="tok-s">&quot;{hostname}&quot;</span><span class="tok-o">)</span>
       <span class="tok-o">.</span><span class="tok-na">queryParam</span><span class="tok-o">(</span><span class="tok-s">&quot;param={param}&quot;</span><span class="tok-o">);</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Con este cÃ³digo, estamos definiendo una URI como:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>http://{hostname}/clientes/{id}?param={param}</pre>
</div>
</div>
<div class="paragraph">
<p>Puesto que tenemos plantillas de parÃ¡metros, necesitamos inicializarlos con
 valores que pasaremos como argumentos para crear la URI final. Si queremos
 reutilizar la URI que contiene las plantillas, deberÃ­amos realizar una llamada a
  <code>clone()</code> antes de llamar al mÃ©todo <code>build()</code>, ya que Ã©ste reemplazarÃ¡ los parÃ¡metros
  de las plantillas en la estructura interna del objeto:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span class="tok-n">UriBuilder</span> <span class="tok-n">clone</span> <span class="tok-o">=</span> <span class="tok-n">builder</span><span class="tok-o">.</span><span class="tok-na">clone</span><span class="tok-o">();</span>
<span class="tok-n">URI</span> <span class="tok-n">uri</span> <span class="tok-o">=</span> <span class="tok-n">clone</span><span class="tok-o">.</span><span class="tok-na">build</span><span class="tok-o">(</span><span class="tok-s">&quot;ejemplo.com&quot;</span><span class="tok-o">,</span> <span class="tok-s">&quot;333&quot;</span><span class="tok-o">,</span> <span class="tok-s">&quot;valor&quot;</span><span class="tok-o">);</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>El cÃ³digo anterior darÃ­a lugar a la siguiente URI:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>http://ejemplo.com/clientes/333?param=valor</pre>
</div>
</div>
<div class="paragraph">
<p>TambiÃ©n podemos definir un objeto de tipo <code>Map</code> que contenga los valores de las
plantillas:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span class="tok-n">Map</span><span class="tok-o">&lt;</span><span class="tok-n">String</span><span class="tok-o">,</span> <span class="tok-n">Object</span><span class="tok-o">&gt;</span> <span class="tok-n">map</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">HashMap</span><span class="tok-o">&lt;</span><span class="tok-n">String</span><span class="tok-o">,</span> <span class="tok-n">Object</span><span class="tok-o">&gt;();</span>
<span class="tok-n">map</span><span class="tok-o">.</span><span class="tok-na">put</span><span class="tok-o">(</span><span class="tok-s">&quot;hostname&quot;</span><span class="tok-o">,</span> <span class="tok-s">&quot;ejemplo.com&quot;</span><span class="tok-o">);</span>
<span class="tok-n">map</span><span class="tok-o">.</span><span class="tok-na">put</span><span class="tok-o">(</span><span class="tok-s">&quot;id&quot;</span><span class="tok-o">,</span> <span class="tok-mi">333</span><span class="tok-o">);</span>
<span class="tok-n">map</span><span class="tok-o">.</span><span class="tok-na">put</span><span class="tok-o">(</span><span class="tok-s">&quot;param&quot;</span><span class="tok-o">,</span> <span class="tok-s">&quot;valor&quot;</span><span class="tok-o">);</span>
<span class="tok-n">UriBuilder</span> <span class="tok-n">clone</span> <span class="tok-o">=</span> <span class="tok-n">builder</span><span class="tok-o">.</span><span class="tok-na">clone</span><span class="tok-o">();</span>
<span class="tok-n">URI</span> <span class="tok-n">uri</span> <span class="tok-o">=</span> <span class="tok-n">clone</span><span class="tok-o">.</span><span class="tok-na">buildFromMap</span><span class="tok-o">(</span><span class="tok-n">map</span><span class="tok-o">);</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Otro ejemplo interesante es el de crear una URI a partir de las expresiones @Path
definidas en las clases JAX-RS anotadas. A continuaciÃ³n mostramos el cÃ³digo:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span class="tok-nd">@Path</span><span class="tok-o">(</span><span class="tok-s">&quot;/clientes&quot;</span><span class="tok-o">)</span>
<span class="tok-kd">public</span> <span class="tok-kd">class</span> <span class="tok-nc">ServicioClientes</span> <span class="tok-o">{</span>

   <span class="tok-nd">@Path</span><span class="tok-o">(</span><span class="tok-s">&quot;{id}&quot;</span><span class="tok-o">)</span>
   <span class="tok-kd">public</span> <span class="tok-n">Cliente</span> <span class="tok-nf">getCliente</span><span class="tok-o">(</span><span class="tok-nd">@PathParam</span><span class="tok-o">(</span><span class="tok-s">&quot;id&quot;</span><span class="tok-o">)</span> <span class="tok-kt">int</span> <span class="tok-n">id</span><span class="tok-o">)</span> <span class="tok-o">{...}</span>
<span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Podemos referenciar esta clase y el mÃ©todo <code>getCliente()</code> a travÃ©s de la clase
<code>UriBuilder</code> de la siguiente forma:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span class="tok-n">UriBuilder</span> <span class="tok-n">builder</span> <span class="tok-o">=</span> <span class="tok-n">UriBuilder</span><span class="tok-o">.</span><span class="tok-na">fromResource</span><span class="tok-o">(</span><span class="tok-n">ServicioClientes</span><span class="tok-o">.</span><span class="tok-na">class</span><span class="tok-o">);</span>
<span class="tok-n">builder</span><span class="tok-o">.</span><span class="tok-na">host</span><span class="tok-o">(</span><span class="tok-s">&quot;{hostname}&quot;</span><span class="tok-o">)</span>
<span class="tok-n">builder</span><span class="tok-o">.</span><span class="tok-na">path</span><span class="tok-o">(</span><span class="tok-n">ServicioClientes</span><span class="tok-o">.</span><span class="tok-na">class</span><span class="tok-o">,</span> <span class="tok-s">&quot;getCliente&quot;</span><span class="tok-o">);</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>El cÃ³digo anterior define la siguiente plantilla para la URI:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>http://{hostname}/clientes/{id}</pre>
</div>
</div>
<div class="paragraph">
<p>A partir de esta plantilla, podremos construir la URI utilizando alguno de los
mÃ©todos `buildXXX().</p>
</div>
<div class="paragraph">
<p>TambiÃ©n podemos querer utilizar UriBuilder para crear URIS a partir de plantillas. Para ello disponemos
de mÃ©todos <code>resolveTemplateXXX()</code>, que nos facilitan el trabajo:</p>
</div>
<div class="listingblock">
<div class="title">Clase UriBuilder: mÃ©todos resolveTemplateXXX() para crear URIs a partir de plantillas</div>
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span class="tok-kd">public</span> <span class="tok-kd">abstract</span> <span class="tok-n">UriBuilder</span> <span class="tok-nf">resolveTemplate</span><span class="tok-o">(</span><span class="tok-n">String</span> <span class="tok-n">name</span><span class="tok-o">,</span> <span class="tok-n">Object</span> <span class="tok-n">value</span><span class="tok-o">);</span>
<span class="tok-kd">public</span> <span class="tok-kd">abstract</span> <span class="tok-n">UriBuilder</span> <span class="tok-nf">resolveTemplate</span><span class="tok-o">(</span><span class="tok-n">String</span> <span class="tok-n">name</span><span class="tok-o">,</span> <span class="tok-n">Object</span> <span class="tok-n">value</span><span class="tok-o">,</span>
                                          <span class="tok-kt">boolean</span> <span class="tok-n">encodeSlashInPath</span><span class="tok-o">);</span>
<span class="tok-kd">public</span> <span class="tok-kd">abstract</span> <span class="tok-n">UriBuilder</span> <span class="tok-nf">resolveTemplateFromEncoded</span><span class="tok-o">(</span><span class="tok-n">String</span> <span class="tok-n">name</span><span class="tok-o">,</span><span class="tok-n">Object</span> <span class="tok-n">value</span><span class="tok-o">);</span>
<span class="tok-kd">public</span> <span class="tok-kd">abstract</span> <span class="tok-n">UriBuilder</span> <span class="tok-nf">resolveTemplates</span><span class="tok-o">(</span><span class="tok-n">Map</span><span class="tok-o">&lt;</span><span class="tok-n">String</span><span class="tok-o">,</span> <span class="tok-n">Object</span><span class="tok-o">&gt;</span> <span class="tok-n">templateValues</span><span class="tok-o">);</span>
<span class="tok-kd">public</span> <span class="tok-kd">abstract</span> <span class="tok-n">UriBuilder</span> <span class="tok-nf">resolveTemplates</span><span class="tok-o">(</span>
              <span class="tok-n">Map</span><span class="tok-o">&lt;</span><span class="tok-n">String</span><span class="tok-o">,</span><span class="tok-n">Object</span><span class="tok-o">&gt;</span> <span class="tok-n">templateValues</span><span class="tok-o">,</span> <span class="tok-kt">boolean</span> <span class="tok-n">encodeSlashInPath</span><span class="tok-o">)</span>
                                          <span class="tok-kd">throws</span> <span class="tok-n">IllegalArgumentException</span><span class="tok-o">;</span>
<span class="tok-kd">public</span> <span class="tok-kd">abstract</span> <span class="tok-n">UriBuilder</span> <span class="tok-nf">resolveTemplatesFromEncoded</span><span class="tok-o">(</span>
                                 <span class="tok-n">Map</span><span class="tok-o">&lt;</span><span class="tok-n">String</span><span class="tok-o">,</span> <span class="tok-n">Object</span><span class="tok-o">&gt;</span> <span class="tok-n">templateValues</span><span class="tok-o">);</span>
<span class="tok-c1">// Devuelve la URI de la plantilla como una cadena de caracteres</span>
<span class="tok-kd">public</span> <span class="tok-kd">abstract</span> <span class="tok-n">String</span> <span class="tok-nf">toTemplate</span><span class="tok-o">()</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Funcionan de forma similar a los mÃ©todos <code>build()</code> y se utilizan para resolver
parcialmente las plantillas contenidas en la URI. Cada uno de los mÃ©todos devuelve
una nueva instancia de UriBuilder, de forma que podemos "encadenar" varias llamadas
para resolver todas las plantillas de la URI. Finalmente, usaremos el mÃ©todo <code>toTemplate()</code>
para obtener la nueva plantilla en forma de <code>String</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span class="tok-n">String</span> <span class="tok-n">original</span> <span class="tok-o">=</span> <span class="tok-s">&quot;http://{host}/{id}&quot;</span><span class="tok-o">;</span>
<span class="tok-n">String</span> <span class="tok-n">nuevaPlantilla</span> <span class="tok-o">=</span> <span class="tok-n">UriBuilder</span><span class="tok-o">.</span><span class="tok-na">fromUri</span><span class="tok-o">(</span><span class="tok-n">original</span><span class="tok-o">)</span>
                        <span class="tok-o">.</span><span class="tok-na">resolveTemplate</span><span class="tok-o">(</span><span class="tok-s">&quot;host&quot;</span><span class="tok-o">,</span> <span class="tok-s">&quot;localhost&quot;</span><span class="tok-o">)</span>
                        <span class="tok-o">.</span><span class="tok-na">toTemplate</span><span class="tok-o">();</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>El valor de <em>nuevaPlantilla</em> para el cÃ³digo anterior serÃ­a: "http://localhost/{id}"</p>
</div>
</div>
<div class="sect3">
<h4 id="_uris_relativas_mediante_el_uso_de_uriinfo">4.3.2. URIs relativas mediante el uso de UriInfo</h4>
<div class="paragraph">
<p>Cuando estamos escribiendo servicios que "distribuyen" enlaces, hay cierta informaciÃ³n
que probablemente no conozcamos cuando estamos escribiendo el cÃ³digo. Por ejemplo,
podemos no conocer todavÃ­a los <em>hostnames</em> de los enlaces, o incluso los <em>base paths</em>
de las URIs, en el caso de que estemos enlazando con otros servicios REST.</p>
</div>
<div class="paragraph">
<p>JAX-RS proporciona una forma sencilla de solucionar estos problemas utilizando la
interfaz <code>javax.ws.rs.core.UriInfo</code>. Ya hemos introducido algunas caracterÃ­sticas de
esta interfaz en sesiones anteriores. AdemÃ¡s de poder consultar informaciÃ³n bÃ¡sica de la
ruta, tambiÃ©n podemos obtener instancias de UriBuilder preinicializadas con la URI
base utilizada para definir los servicios JAX-RS, o la URI utilizada para invocar
la peticiÃ³n HTTP actual:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span class="tok-kd">public</span> <span class="tok-kd">interface</span> <span class="tok-nc">UriInfo</span> <span class="tok-o">{</span>
  <span class="tok-kd">public</span> <span class="tok-n">URI</span> <span class="tok-nf">getRequestUri</span><span class="tok-o">();</span>
  <span class="tok-kd">public</span> <span class="tok-n">UriBuilder</span> <span class="tok-nf">getRequestUriBuilder</span><span class="tok-o">();</span>
  <span class="tok-kd">public</span> <span class="tok-n">URI</span> <span class="tok-nf">getAbsolutePath</span><span class="tok-o">();</span>
  <span class="tok-kd">public</span> <span class="tok-n">UriBuilder</span> <span class="tok-nf">getAbsolutePathBuilder</span><span class="tok-o">();</span>
  <span class="tok-kd">public</span> <span class="tok-n">URI</span> <span class="tok-nf">getBaseUri</span><span class="tok-o">();</span>
  <span class="tok-kd">public</span> <span class="tok-n">UriBuilder</span> <span class="tok-nf">getBaseUriBuilder</span><span class="tok-o">();</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Por ejemplo, supongamos que tenemos un servicio que permite acceder a Clientes desde una
base de datos. En lugar de tener una URI base que devuelva todos los clientes en un
Ãºnico documento, podemos incluir los enlaces <code>previo</code> y <code>sigiente</code>, de forma que podamos
"navegar" por los datos. Vamos a mostrar cÃ³mo crear estos enlaces utilizando la URI para
 invocar la peticiÃ³n:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span class="tok-nd">@Path</span><span class="tok-o">(</span><span class="tok-s">&quot;/clientes&quot;</span><span class="tok-o">)</span>
<span class="tok-kd">public</span> <span class="tok-kd">class</span> <span class="tok-nc">ServicioClientes</span> <span class="tok-o">{</span>
  <span class="tok-nd">@GET</span>
  <span class="tok-nd">@Produces</span><span class="tok-o">(</span><span class="tok-s">&quot;application/xml&quot;</span><span class="tok-o">)</span>
  <span class="tok-kd">public</span> <span class="tok-n">String</span> <span class="tok-nf">getCustomers</span><span class="tok-o">(</span><span class="tok-nd">@Context</span> <span class="tok-n">UriInfo</span> <span class="tok-n">uriInfo</span><span class="tok-o">)</span> <span class="tok-o">{</span> <i class="conum" data-value="1"></i><b>(1)</b>
    <span class="tok-n">UriBuilder</span> <span class="tok-n">nextLinkBuilder</span> <span class="tok-o">=</span> <span class="tok-n">uriInfo</span><span class="tok-o">.</span><span class="tok-na">getAbsolutePathBuilder</span><span class="tok-o">();</span> <i class="conum" data-value="2"></i><b>(2)</b>
    <span class="tok-n">nextLinkBuilder</span><span class="tok-o">.</span><span class="tok-na">queryParam</span><span class="tok-o">(</span><span class="tok-s">&quot;inicio&quot;</span><span class="tok-o">,</span> <span class="tok-mi">5</span><span class="tok-o">);</span>
    <span class="tok-n">nextLinkBuilder</span><span class="tok-o">.</span><span class="tok-na">queryParam</span><span class="tok-o">(</span><span class="tok-s">&quot;total&quot;</span><span class="tok-o">,</span> <span class="tok-mi">10</span><span class="tok-o">);</span>
    <span class="tok-n">URI</span> <span class="tok-n">next</span> <span class="tok-o">=</span> <span class="tok-n">nextLinkBuilder</span><span class="tok-o">.</span><span class="tok-na">build</span><span class="tok-o">();</span>
    <span class="tok-c1">//... rellenar el resto del documento ...</span>
  <span class="tok-o">}</span>
 <span class="tok-o">...</span>
<span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Para acceder a la instancia <code>UriInfo</code> que representa al peticiÃ³n, usamos la anotaciÃ³n
<code>javax.ws.rs.core.Context</code>, para inyectarla como un parÃ¡metro del mÃ©todo del recurso REST</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Obtenemos un <code>UriBuilder</code> preininicializado con la URI utilizada para acceder al
servicio</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Para el cÃ³digo anterior, y dependiendo de cÃ³mo se despliegue el servicio, la URI creada
podrÃ­a ser:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>http://org.expertojava/jaxrs/clientes?inicio=5&amp;total=10</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_construcciÃ³n_de_enlaces_links_en_documentos_xml_y_en_cabeceras_http">4.3.3. ConstrucciÃ³n de enlaces (Links) en documentos XML y en cabeceras HTTP</h4>
<div class="paragraph">
<p>JAX-RS proporciona cierto soporte para construir los enlaces y devolverlos en las
 cabeceras de respuesta, o bien incluirlos
en los documentos XML. Para ello podemos utilizar las clases <code>java.ws.rs.core.Link</code>
y <code>java.ws.rs.core.Link.Builder</code>.</p>
</div>
<div class="listingblock">
<div class="title">Clase abstracta javax.ws.rs.core.Link</div>
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span class="tok-kd">public</span> <span class="tok-kd">abstract</span> <span class="tok-kd">class</span> <span class="tok-nc">Link</span> <span class="tok-o">{</span>
  <span class="tok-kd">public</span> <span class="tok-kd">abstract</span> <span class="tok-n">URI</span> <span class="tok-nf">getUri</span><span class="tok-o">();</span>
  <span class="tok-kd">public</span> <span class="tok-kd">abstract</span> <span class="tok-n">UriBuilder</span> <span class="tok-nf">getUriBuilder</span><span class="tok-o">();</span>
  <span class="tok-kd">public</span> <span class="tok-kd">abstract</span> <span class="tok-n">String</span> <span class="tok-nf">getRel</span><span class="tok-o">();</span>
  <span class="tok-kd">public</span> <span class="tok-kd">abstract</span> <span class="tok-n">List</span><span class="tok-o">&lt;</span><span class="tok-n">String</span><span class="tok-o">&gt;</span> <span class="tok-nf">getRels</span><span class="tok-o">();</span>
  <span class="tok-kd">public</span> <span class="tok-kd">abstract</span> <span class="tok-n">String</span> <span class="tok-nf">getTitle</span><span class="tok-o">();</span>
  <span class="tok-kd">public</span> <span class="tok-kd">abstract</span> <span class="tok-n">String</span> <span class="tok-nf">getType</span><span class="tok-o">();</span>
  <span class="tok-kd">public</span> <span class="tok-kd">abstract</span> <span class="tok-n">Map</span><span class="tok-o">&lt;</span><span class="tok-n">String</span><span class="tok-o">,</span> <span class="tok-n">String</span><span class="tok-o">&gt;</span> <span class="tok-nf">getParams</span><span class="tok-o">();</span>
  <span class="tok-kd">public</span> <span class="tok-kd">abstract</span> <span class="tok-n">String</span> <span class="tok-nf">toString</span><span class="tok-o">();</span>
<span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p><code>Link</code> es una clase abstracta que representa todos los metadatos contenidos en una
cabecera o en un enlace Atom. El mÃ©todo <code>getUri()</code> representa el atributo <code>href</code> del enlace
Atom. El mÃ©todo <code>getRel()</code> representa el atributo <code>rel</code>, y asÃ­ sucesivamente. Podemos
referenciar a todos los atributos a travÃ©s del mÃ©todo <code>getParams()</code>. Finalmente,
el mÃ©todo <code>toString()</code> convertirÃ¡ la instancia <code>Link</code> en una cadena de caracteres con
el formato de una cabecera <code>Link</code>.</p>
</div>
<div class="paragraph">
<p>Para crear instancias de <code>Link</code> utilizaremos un <code>Link.Builder</code>, que crearemos con
alguno de estos mÃ©todos:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span class="tok-kd">public</span> <span class="tok-kd">abstract</span> <span class="tok-kd">class</span> <span class="tok-nc">Link</span> <span class="tok-o">{</span>
   <span class="tok-kd">public</span> <span class="tok-kd">static</span> <span class="tok-n">Builder</span> <span class="tok-nf">fromUri</span><span class="tok-o">(</span><span class="tok-n">URI</span> <span class="tok-n">uri</span><span class="tok-o">)</span>
   <span class="tok-kd">public</span> <span class="tok-kd">static</span> <span class="tok-n">Builder</span> <span class="tok-nf">fromUri</span><span class="tok-o">(</span><span class="tok-n">String</span> <span class="tok-n">uri</span><span class="tok-o">)</span>
   <span class="tok-kd">public</span> <span class="tok-kd">static</span> <span class="tok-n">Builder</span> <span class="tok-nf">fromUriBuilder</span><span class="tok-o">(</span><span class="tok-n">UriBuilder</span> <span class="tok-n">uriBuilder</span><span class="tok-o">)</span>
   <span class="tok-kd">public</span> <span class="tok-kd">static</span> <span class="tok-n">Builder</span> <span class="tok-nf">fromLink</span><span class="tok-o">(</span><span class="tok-n">Link</span> <span class="tok-n">link</span><span class="tok-o">)</span>
   <span class="tok-kd">public</span> <span class="tok-kd">static</span> <span class="tok-n">Builder</span> <span class="tok-nf">fromPath</span><span class="tok-o">(</span><span class="tok-n">String</span> <span class="tok-n">path</span><span class="tok-o">)</span>
   <span class="tok-kd">public</span> <span class="tok-kd">static</span> <span class="tok-n">Builder</span> <span class="tok-nf">fromResource</span><span class="tok-o">(</span><span class="tok-n">Class</span><span class="tok-o">&lt;?&gt;</span> <span class="tok-n">resource</span><span class="tok-o">)</span>
   <span class="tok-kd">public</span> <span class="tok-kd">static</span> <span class="tok-n">Builder</span> <span class="tok-nf">fromMethod</span><span class="tok-o">(</span><span class="tok-n">Class</span><span class="tok-o">&lt;?&gt;</span> <span class="tok-n">resource</span><span class="tok-o">,</span> <span class="tok-n">String</span> <span class="tok-n">method</span><span class="tok-o">)</span>
   <span class="tok-o">...</span>
<span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Los mÃ©todos <code>fromXXX()</code> funcionan de forma similar a <code>UriBuilder.fromXXX()</code>.
Todos inicializan el <code>UriBuilder</code> subyacente  que utilizaremos para construir el atributo
<code>href</code> del enlace.</p>
</div>
<div class="paragraph">
<p>Los mÃ©todos <code>link()</code>, <code>uri()</code>, y <code>uriBuilder()</code> nos permiten sobreescribir la
URI subyacente del enlace que estamos creando:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span class="tok-kd">public</span> <span class="tok-kd">abstract</span> <span class="tok-kd">class</span> <span class="tok-nc">Link</span> <span class="tok-o">{</span>
  <span class="tok-kd">interface</span> <span class="tok-nc">Builder</span> <span class="tok-o">{</span>
      <span class="tok-kd">public</span> <span class="tok-n">Builder</span> <span class="tok-nf">link</span><span class="tok-o">(</span><span class="tok-n">Link</span> <span class="tok-n">link</span><span class="tok-o">);</span>
      <span class="tok-kd">public</span> <span class="tok-n">Builder</span> <span class="tok-nf">link</span><span class="tok-o">(</span><span class="tok-n">String</span> <span class="tok-n">link</span><span class="tok-o">);</span>
      <span class="tok-kd">public</span> <span class="tok-n">Builder</span> <span class="tok-nf">uri</span><span class="tok-o">(</span><span class="tok-n">URI</span> <span class="tok-n">uri</span><span class="tok-o">);</span>
      <span class="tok-kd">public</span> <span class="tok-n">Builder</span> <span class="tok-nf">uri</span><span class="tok-o">(</span><span class="tok-n">String</span> <span class="tok-n">uri</span><span class="tok-o">);</span>
      <span class="tok-kd">public</span> <span class="tok-n">Builder</span> <span class="tok-nf">uriBuilder</span><span class="tok-o">(</span><span class="tok-n">UriBuilder</span> <span class="tok-n">uriBuilder</span><span class="tok-o">);</span>
      <span class="tok-o">...</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Los siguientes mÃ©todos nos permiten asignar valores a varios atributos del enlace
que estamos construyendo:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java">      <span class="tok-o">...</span>
      <span class="tok-kd">public</span> <span class="tok-n">Builder</span> <span class="tok-nf">rel</span><span class="tok-o">(</span><span class="tok-n">String</span> <span class="tok-n">rel</span><span class="tok-o">);</span>
      <span class="tok-kd">public</span> <span class="tok-n">Builder</span> <span class="tok-nf">title</span><span class="tok-o">(</span><span class="tok-n">String</span> <span class="tok-n">title</span><span class="tok-o">);</span>
      <span class="tok-kd">public</span> <span class="tok-n">Builder</span> <span class="tok-nf">type</span><span class="tok-o">(</span><span class="tok-n">String</span> <span class="tok-n">type</span><span class="tok-o">);</span>
      <span class="tok-kd">public</span> <span class="tok-n">Builder</span> <span class="tok-nf">param</span><span class="tok-o">(</span><span class="tok-n">String</span> <span class="tok-n">name</span><span class="tok-o">,</span> <span class="tok-n">String</span> <span class="tok-n">value</span><span class="tok-o">);</span>
      <span class="tok-o">...</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Finalmente, Ã©l mÃ©todo <code>build()</code> nos permitirÃ¡ construir el enlace:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span class="tok-kd">public</span> <span class="tok-n">Link</span> <span class="tok-nf">build</span><span class="tok-o">(</span><span class="tok-n">Object</span><span class="tok-o">...</span> <span class="tok-n">values</span><span class="tok-o">);</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>El objeto <code>Link.Builder</code> tiene asociado una <code>UriBuilder</code> subyacente. Los valores
pasados como parÃ¡metros del mÃ©todo <code>build()</code> son utilizados por el <code>UriBuilder</code> para
crear una URI para el enlace. Veamos un ejemplo:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span class="tok-n">Link</span> <span class="tok-n">link</span> <span class="tok-o">=</span> <span class="tok-n">Link</span><span class="tok-o">.</span><span class="tok-na">fromUri</span><span class="tok-o">(</span><span class="tok-s">&quot;http://{host}/raiz/clientes/{id}&quot;</span><span class="tok-o">)</span>
                <span class="tok-o">.</span><span class="tok-na">rel</span><span class="tok-o">(</span><span class="tok-s">&quot;update&quot;</span><span class="tok-o">).</span><span class="tok-na">type</span><span class="tok-o">(</span><span class="tok-s">&quot;text/plain&quot;</span><span class="tok-o">)</span>
                <span class="tok-o">.</span><span class="tok-na">build</span><span class="tok-o">(</span><span class="tok-s">&quot;localhost&quot;</span><span class="tok-o">,</span> <span class="tok-s">&quot;1234&quot;</span><span class="tok-o">);</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Si realizamos una llamada a <code>toString()</code> sobre la instancia del enlace (<code>link</code>),
obtendremos lo siguiente:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml">http://localhost/raiz/clientes/1234&gt;; rel=&quot;update&quot;; type=&quot;text/plain&quot;</code></pre>
</div>
</div>
<div class="paragraph">
<p>A continuaciÃ³n mostramos dos ejemplos que muestran cÃ³mo crear instancias <code>Link</code> en
las cabeceras, y en el cuerpo de la respuesta como un enlace Atom:</p>
</div>
<div class="listingblock">
<div class="title">Escritura de enlaces en cabeceras HTTP</div>
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span class="tok-nd">@Path</span>
<span class="tok-nd">@GET</span>
<span class="tok-n">Response</span> <span class="tok-nf">get</span><span class="tok-o">()</span> <span class="tok-o">{</span>
    <span class="tok-n">Link</span> <span class="tok-n">link</span> <span class="tok-o">=</span> <span class="tok-n">Link</span><span class="tok-o">.</span><span class="tok-na">fromUri</span><span class="tok-o">(</span><span class="tok-s">&quot;a/b/c&quot;</span><span class="tok-o">).</span><span class="tok-na">build</span><span class="tok-o">();</span>
    <span class="tok-n">Response</span> <span class="tok-n">response</span> <span class="tok-o">=</span> <span class="tok-n">Response</span><span class="tok-o">.</span><span class="tok-na">noContent</span><span class="tok-o">()</span>
                                <span class="tok-o">.</span><span class="tok-na">links</span><span class="tok-o">(</span><span class="tok-n">link</span><span class="tok-o">)</span>
                                <span class="tok-o">.</span><span class="tok-na">build</span><span class="tok-o">();</span>
    <span class="tok-k">return</span> <span class="tok-n">response</span><span class="tok-o">;</span> <span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">InclusiÃ³n de un enlace Atom en el documento XMl de respuesta</div>
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span class="tok-kn">import</span> <span class="tok-nn">javax.ws.rs.core.Link</span><span class="tok-o">;</span>

<span class="tok-nd">@XmlRootElement</span>
<span class="tok-kd">public</span> <span class="tok-kd">class</span> <span class="tok-nc">Cliente</span> <span class="tok-o">{</span>
  <span class="tok-kd">private</span> <span class="tok-n">String</span> <span class="tok-n">nombre</span><span class="tok-o">;</span>
  <span class="tok-kd">private</span> <span class="tok-n">List</span><span class="tok-o">&lt;</span><span class="tok-n">Link</span><span class="tok-o">&gt;</span> <span class="tok-n">enlaces</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">ArrayList</span><span class="tok-o">&lt;</span><span class="tok-n">Link</span><span class="tok-o">&gt;();</span>

  <span class="tok-nd">@XmlElement</span>
  <span class="tok-kd">public</span> <span class="tok-n">String</span> <span class="tok-nf">getNombre</span><span class="tok-o">()</span> <span class="tok-o">{</span>
    <span class="tok-k">return</span> <span class="tok-n">nombre</span><span class="tok-o">;</span>
  <span class="tok-o">}</span>

  <span class="tok-kd">public</span> <span class="tok-kt">void</span> <span class="tok-nf">setNombre</span><span class="tok-o">(</span><span class="tok-n">String</span> <span class="tok-n">nom</span><span class="tok-o">)</span> <span class="tok-o">{</span>
    <span class="tok-k">this</span><span class="tok-o">.</span><span class="tok-na">nombre</span> <span class="tok-o">=</span> <span class="tok-n">nom</span><span class="tok-o">;</span>
  <span class="tok-o">}</span>

  <span class="tok-nd">@XmlElement</span><span class="tok-o">(</span><span class="tok-n">name</span> <span class="tok-o">=</span> <span class="tok-s">&quot;enlace&quot;</span><span class="tok-o">)</span>
  <span class="tok-nd">@XmlJavaTypeAdapter</span><span class="tok-o">(</span><span class="tok-n">Link</span><span class="tok-o">.</span><span class="tok-na">JaxbAdapter</span><span class="tok-o">.</span><span class="tok-na">class</span><span class="tok-o">)</span> <i class="conum" data-value="1"></i><b>(1)</b>
  <span class="tok-kd">public</span> <span class="tok-n">List</span><span class="tok-o">&lt;</span><span class="tok-n">Link</span><span class="tok-o">&gt;</span> <span class="tok-nf">getEnlaces</span><span class="tok-o">()</span> <span class="tok-o">{</span>
    <span class="tok-k">return</span> <span class="tok-n">enlaces</span><span class="tok-o">;</span> <span class="tok-o">}</span>
  <span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>La clase <code>Link</code> contiene tambiÃ©n un <code>JaxbAdapter</code>, con una implementaciÃ³n de
la clase JAXB <code>XmlAdapter</code>, que "mapea" los objetos JAX-RS de tipo <code>Link</code> a un
valor que puede ser serializado y deserializado por JAXB</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>El cÃ³digo de este ejemplo permite construir cualquier enlace y aÃ±adirlo a la clase
<code>Cliente</code> de nuestro dominio. Los enlaces serÃ¡n convertidos a elementos XML, que se
incluirÃ¡n en el documento XML de respuesta.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_seguridad">4.4. Seguridad</h3>
<div class="paragraph">
<p>Es importante que los servicios rest permitan un acceso seguro a los datos
y funcionalidades que proporcionan. Especialmente para servicios que permiten la
realizaciÃ³n de actualizaciones en los datos. TambiÃ©n es interesante asegurarnos de
que terceros no lean nuestros mensajes, e incluso permitir que ciertos usuarios
accedan a determinadas funcionalidades pero a otras no.</p>
</div>
<div class="paragraph">
<p>AdemÃ¡s de la especificaciÃ³n JAX-RS, podemos aprovechar los servicios de seguridad
que nos ofrece la web y Java EE, y utilizarla en nuestros servicios REST. Estos
incluyen:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">AutentificaciÃ³n</dt>
<dd>
<p>Hace referencia a la validaciÃ³n de la <strong>identidad</strong> del cliente que accede a los
servicios. Normalmente implica la comprobaciÃ³n de si el cliente ha proporcionado unos
credenciales vÃ¡lidos, tales como el <em>password</em>. En este sentido, podemos utilizar los
mecanismos que nos proporciona la web, y las facilidades del contenedor de servlets
de Java EE, para configurar los protocolos de autentificaciÃ³n.</p>
</dd>
<dt class="hdlist1">AutorizaciÃ³n</dt>
<dd>
<p>Una vea que el cliente se ha autenticado (ha validado su identidad), querrÃ¡ interactuar
con nuestro servicio REST. La autorizaciÃ³n hace referencia a decidir si un cierto usuario
puede acceder e invocar un determinado mÃ©todo sobre una determinada URI. Por ejemplo,
podemos habilitar el acceso a operaciones PUT/POST/DELETE para ciertos usuarios, pero para
 otros no. En este caso, utilizaremos las facilidades que nos propociona el contenedor
 de servlets de Java EE, para realizar autorizaciones.</p>
</dd>
<dt class="hdlist1">Encriptado</dt>
<dd>
<p>Cuando un cliente estÃ¡ interaccionando con un servicio REST, es posible que alguien
intercepte los mensajes y los "lea", si la conexiÃ³n HTTP no es segura. Los datos "sensibles"
deberÃ­an protegerse con servicios criptogrÃ¡ficos, tales como SSL.</p>
</dd>
</dl>
</div>
<div class="sect3">
<h4 id="_autentificaciÃ³n_en_jax_rs">4.4.1. AutentificaciÃ³n en JAX-RS</h4>
<div class="paragraph">
<p>Hay varios protocolos de autentificaciÃ³n. En este caso, vamos a ver cÃ³mo realizar una
autenticaciÃ³n bÃ¡sica sobre HTTP (y que ya habÃ©is utilizado para <em>servlets</em>). Este tipo
de autentificaciÃ³n requiere enviar un nombre de usuario y password, codificados como Base-64,
en una cabecera de la peticiÃ³n al servidor. El servidor comprueba si existe dicho usuario
en el sistema y verifica el password enviado. VeÃ¡moslo con un ejemplo:</p>
</div>
<div class="paragraph">
<p>Supongamos que un cliente no autorizado quiere acceder a nuestros servicios REST:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code>GET /clientes/333 HTTP/1.1</code></pre>
</div>
</div>
<div class="paragraph">
<p>Ya que la peticiÃ³n no contiene informaciÃ³n de autentificaciÃ³n, el servidor deberÃ­a
responder la siguiente respuesta:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code>HTTP/1.1 401 Unauthorized
WWW-Autenticate: Basic realm="Cliente Realm"</code></pre>
</div>
</div>
<div class="paragraph">
<p>La respuesta <code>401</code> nos indica que el cliente no estÃ¡ autorizado a acceder a dicha URI.
La cabecera <code>WWW-Autenticate</code> especifica quÃ© protocolo de autentificaciÃ³n se deberÃ­a usar.
En este caso, <code>Basic</code> significa que se deberÃ­a utilizar una autentificaciÃ³n de tipo
<code>Basic</code>. El atributo <code>realm</code> identifica una colecciÃ³n de recursos seguros en un sitio web.
En este ejemplo, indica que solamente estÃ¡n autorizados a acceder al mÃ©todo GET a travÃ©s
de la URI anterior, todos aquellos uarios que pertenezcan al realm <code>Cliente Realm</code>, y
serÃ¡n autentificados por el servidor mediante una autentificaciÃ³n bÃ¡sica.</p>
</div>
<div class="paragraph">
<p>Para poder realizar la autentificaciÃ³n, el cliente debe enviar una peticiÃ³n que
incluya la cabecera <code>Authorization</code>, cuyo valor sea <code>Basic</code>, seguido de la siguiente cadena de
caracteres <em>login:password</em> codificada en Base64 (el valor de <em>login</em> y <em>password</em>
representa el login y password del usuario). Por ejemplo, supongamos que el nombre del
usuario es <code>felipe</code> y el password es <code>locking</code>, la cadena <code>felipe:locking</code> codificada
como Base64 es <code>ZmVsaXBlOmxvY2tpbmc=</code>. Por lo tanto, nuestra peticiÃ³n deberÃ­a ser
la siguiente:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code>GET /clientes/333 HTTP/1.1
Authorization: Basic ZmVsaXBlOmxvY2tpbmc=</code></pre>
</div>
</div>
<div class="paragraph">
<p>El cliente deberÃ­a enviar esta cabecera con todas y cada una de las peticiones
que haga al servidor.</p>
</div>
<div class="paragraph">
<p>El inconveniente de esta aproximaciÃ³n es que si la peticiÃ³n es interceptada
por alguna entidad "hostil" en la red, el <em>hacker</em> puede obtner fÃ¡cilmente
el usuario y el passwork y utilizarlos para hacer sus propias peticiones.
Utilizando una conexiÃ³n HTTP encriptada (HTTPS), se soluciona este problema.</p>
</div>
<div class="sect4">
<h5 id="_creaciÃ³n_de_usuarios_y_roles">CreaciÃ³n de usuarios y roles</h5>
<div class="paragraph">
<p>Para poder utilizar la autentificaciÃ³n bÃ¡sica necesitamos tener creados previamente los
<em>realms</em> en el servidor de aplicaciones Wildfly, y registrar los usuarios que pertenecen a dichos
<em>realms</em>. La forma de hacerlo es idÃ©ntica a lo que ya habÃ©is visto en la asignatura
de Componentes Web (a travÃ©s del comando <code>add-user.sh</code>).</p>
</div>
<div class="paragraph">
<p>Utilizaremos el realm por defecto "ApplicationRealm" de Wildfly, que nos permitirÃ¡
ademÃ¡s, controlar la autorizaciÃ³n mediante la asignaciÃ³n de roles a usuarios.</p>
</div>
<div class="paragraph">
<p>Lo Ãºnico que tendremos que hacer es aÃ±adir los usuarios a dicho realm, a travÃ©s de
la herramienta <code>$WILDFLY_HOME/bin/add-user.sh</code></p>
</div>
<div class="paragraph">
<p>Al ejecutarla desde lÃ­nea de comandos, deberemos elegir el ream "ApplicationRealm"
e introducir los datos para cada nuevo usuario que queramos aÃ±adir, indicando su
login, password, y el grupo (rol) al que queremos que pertenezca dicho usuario.</p>
</div>
<div class="paragraph">
<p>Los datos sobre los nuevos usuarios creados se almacenan en los ficheros:
<code>application-users.properties</code> y <code>application-roles.properties</code>, tanto en el
directorio <code>$WILDFLY_HOME/standalone/configuration/</code>, como en
<code>$WILDFLY_HOME/domain/configuration/</code></p>
</div>
<div class="paragraph">
<p>Una vez creados los usuarios, tendremos que incluir en el fichero de
configuraciÃ³n <code>web.xml</code>, la siguiente informaciÃ³n:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><span class="tok-nt">&lt;web-app&gt;</span>
  ...
  <span class="tok-nt">&lt;login-config&gt;</span> <i class="conum" data-value="1"></i><b>(1)</b>
    <span class="tok-nt">&lt;auth-method&gt;</span>BASIC<span class="tok-nt">&lt;/auth-method&gt;</span>
    <span class="tok-nt">&lt;realm-name&gt;</span>ApplicationRealm<span class="tok-nt">&lt;/realm-name&gt;</span> <i class="conum" data-value="2"></i><b>(2)</b>
  <span class="tok-nt">&lt;/login-config&gt;</span>

  <span class="tok-nt">&lt;security-constraint&gt;</span>
    <span class="tok-nt">&lt;web-resource-collection&gt;</span>
       <span class="tok-nt">&lt;web-resource-name&gt;</span>customer creation<span class="tok-nt">&lt;/web-resource-name&gt;</span>
       <span class="tok-nt">&lt;url-pattern&gt;</span>/rest/resources<span class="tok-nt">&lt;/url-pattern&gt;</span> <i class="conum" data-value="3"></i><b>(3)</b>
       <span class="tok-nt">&lt;http-method&gt;</span>POST<span class="tok-nt">&lt;/http-method&gt;</span> <i class="conum" data-value="4"></i><b>(4)</b>
    <span class="tok-nt">&lt;/web-resource-collection&gt;</span>
    ...
  <span class="tok-nt">&lt;/security-constraint&gt;</span>
  ...
<span class="tok-nt">&lt;/web-app&gt;</span></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>El elemento &lt;login-config&gt; define cÃ³mo queremos autentificar
nuestro despliegue. El subelemento &lt;auth-method&gt; puede tomar los valores
<code>BASIC</code>, <code>DIGEST</code>, or <code>CLIENT_CERT</code>, correspondiÃ©ndose con la autentificaciÃ³n <em>Basic</em>,
<em>Digest</em>, y <em>Client Certificate</em>, respectivamente.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>El valor de la etiqueta <code>&lt;realm-name&gt;</code> es el que se mostrarÃ¡ como valor del atributo
<strong>realm</strong> de la cabecera <code>WWW-Autenticate</code>, si intentamos acceder al recurso sin
incluir nuestras credenciales en la peticiÃ³n.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>El elemento <code>&lt;login-config&gt;</code> realmente NO "activa" la autentificaciÃ³n. Por defecto,
cualquier cliente puede acceder a cualquier URL proporcionada por nuestra aplicaciÃ³n
web sin restricciones. Para <strong>forzar</strong> la autentificaciÃ³n, debemos especificar el
patrÃ³n URL que queremos asegurar (elemento <code>&lt;url-pattern&gt;</code>)</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>El elemento <code>&lt;http-method&gt;</code> nos indica que solamente queremos asegurar las peticiones
<code>POST</code> sobre esta URL. Si no incluimos el elemento <code>&lt;http-method&gt;</code>, todos los mÃ©todos
HTTP serÃ¡n seguros. En este ejemplo, solamente queremos asegurar los mÃ©todos <code>POST</code>
dirigidos a la URL <code>/rest/resources</code></td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_autorizaciÃ³n_en_jax_rs">4.4.2. AutorizaciÃ³n en JAX-RS</h4>
<div class="paragraph">
<p>Mientras que la autentificaciÃ³n hacer referencia a establecer y verificar la identidad
del usuario, la autorizaciÃ³n tiene que ver con los permisos. Â¿El usuario X estÃ¡
autorizado para acceder a un determinado recurso REST?</p>
</div>
<div class="paragraph">
<p>JAX-RS se basa en las especificaciones Java EE y de servlets para definir
 la forma de autorizar a los usuarios. En Java EE, la autorizaciÃ³n se realiza asociando
 uno o mÃ¡s roles con un usuario dado y, a continuaciÃ³n asignando permisos basados
 en dicho rol. Ejemplos de roles pueden ser: <code>administrador</code>, <code>empleado</code>. Cada rol
 tiene asignando unos permisos de acceso a determinados recursos, por lo que asignaremos
 los permisos utilizando cada uno de los roles.</p>
</div>
<div class="paragraph">
<p>Para poder realizar la autorizaciÃ³n, tendremos que incluir determinadas etiquetas
en el fichero de configuraciÃ³n <code>web.xml</code> (tal y como ya habÃ©is visto en la asignatura de
Componentes Web). VeÃ¡moslo con un ejemplo (en el que tambiÃ©n incluiremos autentificaciÃ³n):</p>
</div>
<div class="paragraph">
<p>Volvamos a nuestra aplicaciÃ³n de venta de productos por internet. En esta aplicaciÃ³n, es
 posible crear nuevos clientes enviando la informaciÃ³n en formato XML a un recurso JAX-RS
 localizado por la anotaciÃ³n <code>@Path("/clientes")</code>. El servicio REST es desplegado y
 escaneado por la clase <code>Application</code> anotada con <code>@ApplicationPath("/servicios")</code>,
 de forma que la URI completa es <code>/servicios/clientes</code>. Queremos proporcionar seguridad
 a nuestro servicio de clientes de forma que solamente los administradores puedan crear
 nuevos clientes. Veamos cuÃ¡l serÃ­a el contenido del fichero <code>web.xml</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><span class="tok-cp">&lt;?xml version=&quot;1.0&quot;?&gt;</span>
<span class="tok-nt">&lt;web-app&gt;</span>
  <span class="tok-nt">&lt;security-constraint&gt;</span>
    <span class="tok-nt">&lt;web-resource-collection&gt;</span>
       <span class="tok-nt">&lt;web-resource-name&gt;</span>creacion de clientes<span class="tok-nt">&lt;/web-resource-name&gt;</span>
       <span class="tok-nt">&lt;url-pattern&gt;</span>/servicios/clientes/*<span class="tok-nt">&lt;/url-pattern&gt;</span>
       <span class="tok-nt">&lt;http-method&gt;</span>POST<span class="tok-nt">&lt;/http-method&gt;</span>
    <span class="tok-nt">&lt;/web-resource-collection&gt;</span>
    <span class="tok-nt">&lt;auth-constraint&gt;</span> <i class="conum" data-value="1"></i><b>(1)</b>
       <span class="tok-nt">&lt;role-name&gt;</span>admin<span class="tok-nt">&lt;/role-name&gt;</span>
    <span class="tok-nt">&lt;/auth-constraint&gt;</span>
  <span class="tok-nt">&lt;/security-constraint&gt;</span>

  <span class="tok-nt">&lt;login-config&gt;</span>
        <span class="tok-nt">&lt;auth-method&gt;</span>BASIC<span class="tok-nt">&lt;/auth-method&gt;</span>
        <span class="tok-nt">&lt;realm-name&gt;</span>ApplicationRealm<span class="tok-nt">&lt;/realm-name&gt;</span>
  <span class="tok-nt">&lt;/login-config&gt;</span>

  <span class="tok-nt">&lt;security-role&gt;</span> <i class="conum" data-value="2"></i><b>(2)</b>
    <span class="tok-nt">&lt;role-name&gt;</span>admin<span class="tok-nt">&lt;/role-name&gt;</span>
  <span class="tok-nt">&lt;/security-role&gt;</span>
<span class="tok-nt">&lt;/web-app&gt;</span></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Especificamos quÃ© roles tienen permiso para acceder mediante POST a la URL
<code>/services/customers</code>. Para ello utilizamos el elemento <code>&lt;auth-constraint&gt;</code> dentro de
<code>&lt;security-constraint&gt;</code>. Este elemento tiene uno o mÃ¡s subelementos <code>&lt;role-name&gt;</code>,
que definen quÃ© roles tienen permisos de acceso definidos por <code>&lt;security-constraint&gt;</code>.
En nuestro ejemplo, estamos dando al rol <code>admin</code> permisos para acceder a la
URL <code>/services/customers/</code> con el mÃ©todo POST. Si en su lugar indicamos un <code>&lt;role-name&gt;</code> con
el valor <code>*</code>, cualquier usuario podrÃ­a acceder a dicha URL. En otras palabras, un <code>&lt;role-name&gt;</code>
con el valor <code>*</code> significa que cualquier usuario que sea capaz de autentificarse, puede
acceder al recurso.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Para cada <code>&lt;role-name&gt;</code> que usemos en nuestras declaraciones <code>&lt;auth-constraints&gt;</code>, debemos
definir el correspondiente <code>&lt;security-role&gt;</code> en el descriptor de despliegue.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Una limitaciÃ³n cuando estamos declarando las <code>&lt;security-contraints&gt;</code> para los recursos
JAX-RS es que el elemento <code>&lt;url-pattern&gt;</code> solamente soporta el uso de <code>*</code> en el patrÃ³n url
 especificado. Por ejemplo: <code>/*</code>, <code>/rest/*</code>, <code>\*.txt</code>.</p>
</div>
</div>
<div class="sect3">
<h4 id="_encriptaciÃ³n">4.4.3. EncriptaciÃ³n</h4>
<div class="paragraph">
<p>Por defecto, la especificaciÃ³n de servlets no requiere un acceso a travÃ©s de HTTPS.
Si queremos forzar un acceso HTTPS, podemos especificar un elemento <code>&lt;user-data-constraint&gt;</code>
como parte de nuestra definiciÃ³n de restricciones de seguridad (<code>&lt;security-constraint&gt;</code>).
Vamos a modificar nuestro ejemplo anterior para forzar un acceso a travÃ©s de HTTPS:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><span class="tok-nt">&lt;web-app&gt;</span>
...
  <span class="tok-nt">&lt;security-constraint&gt;</span>

    <span class="tok-nt">&lt;web-resource-collection&gt;</span>
       <span class="tok-nt">&lt;web-resource-name&gt;</span>creacion de clientes<span class="tok-nt">&lt;/web-resource-name&gt;</span>
       <span class="tok-nt">&lt;url-pattern&gt;</span>/servicios/clientes/*<span class="tok-nt">&lt;/url-pattern&gt;</span>
       <span class="tok-nt">&lt;http-method&gt;</span>POST<span class="tok-nt">&lt;/http-method&gt;</span>
    <span class="tok-nt">&lt;/web-resource-collection&gt;</span>

    <span class="tok-nt">&lt;auth-constraint&gt;</span>
       <span class="tok-nt">&lt;role-name&gt;</span>admin<span class="tok-nt">&lt;/role-name&gt;</span>
    <span class="tok-nt">&lt;/auth-constraint&gt;</span>

    <span class="tok-nt">&lt;user-data-constraint&gt;</span>
      <span class="tok-nt">&lt;transport-guarantee&gt;</span>CONFIDENTIAL<span class="tok-nt">&lt;/transport-guarantee&gt;</span> <i class="conum" data-value="1"></i><b>(1)</b>
    <span class="tok-nt">&lt;/user-data-constraint&gt;</span>
  <span class="tok-nt">&lt;/security-constraint&gt;</span>
...
<span class="tok-nt">&lt;/web-app&gt;</span></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Todo lo que tenemos que hacer es declarar un elemento <code>&lt;transport-guarantee&gt;</code>
dentro de <code>&lt;user-data-constraint&gt;</code> con el valor <code>CONFIDENTIAL</code>. Si un usuario intenta
acceder a una URL con el patrÃ³n especificado a travÃ©s de HTTP, serÃ¡ redirigido a
una URL basada en HTTPS.</td>
</tr>
</table>
</div>
<div class="sect4">
<h5 id="_anotaciones_jax_rs_para_autorizaciÃ³n">Anotaciones JAX-RS para autorizaciÃ³n</h5>
<div class="paragraph">
<p>Java EE define un conjunto de anotaciones para definir metadatos de autorizaciÃ³n. La
especificaciÃ³n JAX-RS sugiere, aunque no es obligatorio, que las implementaciones
 por diferentes vendedores den soporte a dichas anotaciones. Ãstas se encuentran en
  el paquete <code>javax.annotation.security</code> y son: @RolesAllowed, @DenyAll, @PermitAll, y @RunAs.</p>
</div>
<div class="paragraph">
<p>La anotaciÃ³n <code>@RolesAllowed</code> define los roles permitidos para ejecutar una determinada
 operaciÃ³n. Si anotamos una clase JAX-RS, define el acceso para todas las operaciones
 HTTP definidas en la clase JAX-RS. Si anotamos un mÃ©todo JAX-RS, la restricciÃ³n se
 aplica solamente al mÃ©todo que se estÃ¡ anotando.</p>
</div>
<div class="paragraph">
<p>La anotaciÃ³n @PermitAll especifica que cualquier usuario autentificado puede invocar
a nuestras operaciones. Al igual que @RolesAllowed, esta anotaciÃ³n puede usarse en la
clase, para definir el comportamiento por defecto de toda la clase, o podemos usarla en
cada uno de los mÃ©todos. Veamos un ejemplo:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span class="tok-nd">@Path</span><span class="tok-o">(</span><span class="tok-s">&quot;/clientes&quot;</span><span class="tok-o">)</span>
<span class="tok-nd">@RolesAllowed</span><span class="tok-o">({</span><span class="tok-s">&quot;ADMIN&quot;</span><span class="tok-o">,</span> <span class="tok-s">&quot;CLIENTE&quot;</span><span class="tok-o">})</span> <i class="conum" data-value="1"></i><b>(1)</b>
<span class="tok-kd">public</span> <span class="tok-kd">class</span> <span class="tok-nc">ClienteResource</span> <span class="tok-o">{</span>

  <span class="tok-nd">@GET</span>
  <span class="tok-nd">@Path</span><span class="tok-o">(</span><span class="tok-s">&quot;{id}&quot;</span><span class="tok-o">)</span>
  <span class="tok-nd">@Produces</span><span class="tok-o">(</span><span class="tok-s">&quot;application/xml&quot;</span><span class="tok-o">)</span>
  <span class="tok-kd">public</span> <span class="tok-n">Cliente</span> <span class="tok-nf">getClienter</span><span class="tok-o">(</span><span class="tok-nd">@PathParam</span><span class="tok-o">(</span><span class="tok-s">&quot;id&quot;</span><span class="tok-o">)</span> <span class="tok-kt">int</span> <span class="tok-n">id</span><span class="tok-o">)</span> <span class="tok-o">{...}</span>

  <span class="tok-nd">@RolesAllowed</span><span class="tok-o">(</span><span class="tok-s">&quot;ADMIN&quot;</span><span class="tok-o">)</span> <i class="conum" data-value="2"></i><b>(2)</b>
  <span class="tok-nd">@POST</span>
  <span class="tok-nd">@Consumes</span><span class="tok-o">(</span><span class="tok-s">&quot;application/xml&quot;</span><span class="tok-o">)</span>
  <span class="tok-kd">public</span> <span class="tok-kt">void</span> <span class="tok-nf">crearCliente</span><span class="tok-o">(</span><span class="tok-n">Customer</span> <span class="tok-n">cust</span><span class="tok-o">)</span> <span class="tok-o">{...}</span>

  <span class="tok-nd">@PermitAll</span> <i class="conum" data-value="3"></i><b>(3)</b>
  <span class="tok-nd">@GET</span>
  <span class="tok-nd">@Produces</span><span class="tok-o">(</span><span class="tok-s">&quot;application/xml&quot;</span><span class="tok-o">)</span>
  <span class="tok-kd">public</span> <span class="tok-n">Customer</span><span class="tok-o">[]</span> <span class="tok-nf">getClientes</span><span class="tok-o">()</span> <span class="tok-o">{}</span>
<span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Por defecto, solamente los usuarios con rol ADMIN y CLIENTE pueden ejecutar
los mÃ©todos HTTP definidos en la clase ClienteResource</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Sobreescribimos el comportamiento por defecto. Para el mÃ©todo <code>crearCliente()</code>
solamente permitimos peticiones de usuarios con rol ADMIN</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Sobreescribimos el comportamiento por defecto. Para el mÃ©todo <code>getClientes()</code>
de forma que cualquier usuario autentificado puede acceder a esta operaciÃ³n a travÃ©s
de la URI correspondiente, con el mÃ©todo GET.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>La ventaja de utilizar anotaciones es que nos permite una mayor flexibilidad que
el uso del fichero de configuraciÃ³n <code>web.xml</code>, pudiendo definir diferentes autorizaciones
a nivel de mÃ©todo.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_seguridad_programada">4.4.4. Seguridad programada</h4>
<div class="paragraph">
<p>Hemos visto como utilizar una seguridad declarativa, es decir, basÃ¡ndonos en meta-datos
definidos estÃ¡ticamente antes de que la aplicaciÃ³n se ejecute. JAX-RS proporciona una forma
de obtener informaciÃ³n de seguridad que nos permite implementar seguridad de forma
programada en nuestras aplicaciones.</p>
</div>
<div class="paragraph">
<p>Podemos utilizar la interfaz <code>javax.ws.rs.core.SecurityContext</code> para determinar la
 identidad del usuario que realiza la invocaciÃ³n al mÃ©todo proporcionando sus credenciales.
 TambiÃ©n podemos comprobar si el usuario pertenece o no a un determinado rol:
Esto nos permite implementar seguridad de forma programada en nuestras aplicaciones.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span class="tok-kd">public</span> <span class="tok-kd">interface</span> <span class="tok-nc">SecurityContext</span> <span class="tok-o">{</span>
   <span class="tok-kd">public</span> <span class="tok-n">Principal</span> <span class="tok-nf">getUserPrincipal</span><span class="tok-o">();</span>
   <span class="tok-kd">public</span> <span class="tok-kt">boolean</span> <span class="tok-nf">isUserInRole</span><span class="tok-o">(</span><span class="tok-n">String</span> <span class="tok-n">role</span><span class="tok-o">);</span>
   <span class="tok-kd">public</span> <span class="tok-kt">boolean</span> <span class="tok-nf">isSecure</span><span class="tok-o">();</span>
  <span class="tok-kd">public</span> <span class="tok-n">String</span> <span class="tok-nf">getAuthenticationScheme</span><span class="tok-o">();</span>
<span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>El mÃ©todo <code>getUserPrincipal()</code> devuelve un objeto de tipo <code>javax.security.Principal</code>,
que representa al usuario que actualmente estÃ¡ realizando la peticiÃ³n HTTP</p>
</div>
<div class="paragraph">
<p>El mÃ©todo <code>isUserInRole()</code> nos permite determinar si el usuario que realiza
la llamada actual pertenece a un determinado rol.</p>
</div>
<div class="paragraph">
<p>El mÃ©todo <code>isSecure()</code> devuelve cierto si la peticiÃ³n actual es una conexiÃ³n segura.</p>
</div>
<div class="paragraph">
<p>El mÃ©todo <code>getAuthenticationScheme()</code> nos indica quÃ© mecanismo de autentificaciÃ³n se
ha utilizado para asegurar la peticiÃ³n (valores tÃ­picos devueltos por el mÃ©todo
son: <code>BASIC</code>, <code>DIGEST</code>, <code>CLIENT_CERT</code>, y <code>FORM</code>).</p>
</div>
<div class="paragraph">
<p>Podemos acceder a una instancia de SecurityContext inyectÃ¡ndola en un campo,
mÃ©todo <em>setter</em>, o un parÃ¡metro de un recurso, utilizando la anotaciÃ³n <code>@Context</code>.
Veamos un ejemplo. Supongamos que queremos obtener un fichero de log con todos
los accesos a nuestra base de datos de clientes hechas por usuarios que no son
 administradores:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span class="tok-nd">@Path</span><span class="tok-o">(</span><span class="tok-s">&quot;/clientes&quot;</span><span class="tok-o">)</span>
<span class="tok-kd">public</span> <span class="tok-kd">class</span> <span class="tok-nc">CustomerService</span> <span class="tok-o">{</span>
  <span class="tok-nd">@GET</span>
  <span class="tok-nd">@Produces</span><span class="tok-o">(</span><span class="tok-s">&quot;application/xml&quot;</span><span class="tok-o">)</span>
  <span class="tok-kd">public</span> <span class="tok-n">Cliente</span><span class="tok-o">[]</span> <span class="tok-nf">getClientes</span><span class="tok-o">(</span><span class="tok-nd">@Context</span> <span class="tok-n">SecurityContext</span> <span class="tok-n">sec</span><span class="tok-o">)</span> <span class="tok-o">{</span>
    <span class="tok-k">if</span> <span class="tok-o">(</span><span class="tok-n">sec</span><span class="tok-o">.</span><span class="tok-na">isSecure</span><span class="tok-o">()</span> <span class="tok-o">&amp;&amp;</span> <span class="tok-o">!</span><span class="tok-n">sec</span><span class="tok-o">.</span><span class="tok-na">isUserInRole</span><span class="tok-o">(</span><span class="tok-s">&quot;ADMIN&quot;</span><span class="tok-o">))</span> <span class="tok-o">{</span>
        <span class="tok-n">logger</span><span class="tok-o">.</span><span class="tok-na">log</span><span class="tok-o">(</span><span class="tok-n">sec</span><span class="tok-o">.</span><span class="tok-na">getUserPrincipal</span><span class="tok-o">()</span>
            <span class="tok-o">+</span> <span class="tok-s">&quot; ha accedido a la base de datos de clientes&quot;</span><span class="tok-o">);</span>
    <span class="tok-o">}</span>
    <span class="tok-o">...</span>
  <span class="tok-o">}</span>
<span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>En este ejemplo, inyectamos una instancia de <code>SecurityContext</code> como un parÃ¡metro del
mÃ©todo <code>getClientes()</code>. Utilizamos el mÃ©todo <code>SecurityContext.isSecure()</code> para determinar
si se trata de una peticiÃ³n realizada a travÃ©s de un canal seguro (como HTTPS). A continuaciÃ³n utilizamos el mÃ©todo
<code>SecurityContext.isUserInRole()</code> para determinar si el usuario que realiza la llamada
tiene el rol ADMIN o no. Finalmente, imprimimos el resultado en nuestro fichero de logs.</p>
</div>
<div class="paragraph">
<p>Con la introducciÃ³n del API de filtros en JAX-RS 2.0, podemos implementar la
interfaz <code>SecurityContext</code> y sobreescribir la peticiÃ³n actual sobre <code>SecurityContext</code>,
utilizando el mÃ©todo <code>ContainerRequestContext.setSecurityContext()</code>. Lo interesante de
esto es que podemos implementar nuestros propios protocolos de seguridad. Por ejemplo:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span class="tok-kn">import</span> <span class="tok-nn">javax.ws.rs.container.ContainerRequestContext</span><span class="tok-o">;</span>
<span class="tok-kn">import</span> <span class="tok-nn">javax.ws.rs.container.ContainerRequestFilter</span><span class="tok-o">;</span>
<span class="tok-kn">import</span> <span class="tok-nn">javax.ws.rs.container.PreMatching</span><span class="tok-o">;</span>
<span class="tok-kn">import</span> <span class="tok-nn">javax.ws.rs.core.SecurityContext</span><span class="tok-o">;</span>
<span class="tok-kn">import</span> <span class="tok-nn">javax.ws.rs.core.HttpHeaders</span><span class="tok-o">;</span>

<span class="tok-nd">@PreMatching</span>
<span class="tok-kd">public</span> <span class="tok-kd">class</span> <span class="tok-nc">CustomAuth</span> <span class="tok-kd">implements</span> <span class="tok-n">ContainerRequestFilter</span> <span class="tok-o">{</span>
  <span class="tok-kd">protected</span> <span class="tok-n">MyCustomerProtocolHandler</span> <span class="tok-n">customProtocol</span> <span class="tok-o">=</span> <span class="tok-o">...;</span>

  <span class="tok-kd">public</span> <span class="tok-kt">void</span> <span class="tok-nf">filter</span><span class="tok-o">(</span><span class="tok-n">ContainerRequestContext</span> <span class="tok-n">requestContext</span><span class="tok-o">)</span>
                                        <span class="tok-kd">throws</span> <span class="tok-n">IOException</span> <span class="tok-o">{</span>
     <span class="tok-n">String</span> <span class="tok-n">authHeader</span> <span class="tok-o">=</span> <span class="tok-n">request</span><span class="tok-o">.</span><span class="tok-na">getHeaderString</span><span class="tok-o">(</span><span class="tok-n">HttpHeaders</span><span class="tok-o">.</span><span class="tok-na">AUTHORIZATION</span><span class="tok-o">);</span>
     <span class="tok-n">SecurityContext</span> <span class="tok-n">newSecurityContext</span> <span class="tok-o">=</span> <span class="tok-n">customProtocol</span><span class="tok-o">.</span><span class="tok-na">validate</span><span class="tok-o">(</span><span class="tok-n">authHeader</span><span class="tok-o">);</span>
     <span class="tok-n">requestContext</span><span class="tok-o">.</span><span class="tok-na">setSecurityContext</span><span class="tok-o">(</span><span class="tok-n">authHeader</span><span class="tok-o">);</span>
  <span class="tok-o">}</span>
<span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Este filtro no muestra todos los detalles, pero sÃ­ la idea. Extrae la cabecera
<code>Authorization</code> de la peticiÃ³n y la pasa a nuestro propio servicio <code>customerProtocol</code>.
Ãste devuelve una implementaciÃ³n de <code>SecurityContext</code>. Finalmente sobreescribimos
el SecurityContext por defecto utilizando la nueva implementaciÃ³n.</p>
</div>
<div class="paragraph">
<p>No vamos a explicar el API de filtros de JAS-RS 2.0. Como ya habÃ©is visto en la asignatura
de Componentes Web, los filtros son objetos que se "interponen" entre el procesamiento
de las peticiones, tanto del servidor como del cliente.</p>
</div>
<div class="paragraph">
<p>El filtro mostrado en el ejemplo es un filtro <strong>de peticiÃ³n</strong> en la parte del <strong>servidor</strong>.
Este tipo de filtros se ejecuta antes de que se invoque a un mÃ©todo
JAX-RS.</p>
</div>
<div style="page-break-after: always;"></div>
</div>
</div>
<div class="sect2">
<h3 id="_ejercicios">4.5. Ejercicios</h3>
<div class="paragraph">
<p>Para los ejercicios de esta sesiÃ³n proporcionamos el <strong>MÃDULO s4-foroAvanzado</strong>, que tendrÃ©is
que usar como plantilla para realizar las tareas planteadas.</p>
</div>
<div class="paragraph">
<p>El proyecto estÃ¡ estructurado lÃ³gicamente en los siguientes paquetes:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>org.expertojava.negocio</p>
</li>
<li>
<p>org.expertojava.rest</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>A su vez, cada uno de ellos contiene los subpaquetes <code>api</code> y <code>modelo</code>, con las clases
relacionadas con los servicios proporcionados, y los datos utilizados por los servicios, respectivamente.</p>
</div>
<div class="paragraph">
<p>El API rest implementado es el siguiente:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Recurso <em>UsuariosResource.java</em></p>
<div class="ulist">
<ul>
<li>
<p>GET /usuarios, proporciona un listado con los usuarios del foro</p>
</li>
</ul>
</div>
</li>
<li>
<p>Subrecurso <em>UsuarioResource.java</em></p>
<div class="ulist">
<ul>
<li>
<p>GET /usuarios/login, proporciona informaciÃ³n sobre el usuario cuyo login es "login"</p>
</li>
<li>
<p>PUT /usuarios/login, actualiza los datos de un usuario</p>
</li>
<li>
<p>DELETE /usuarios/login, borra los datos de un usuario</p>
</li>
<li>
<p>GET /usuarios/login/mensajes, obtiene un listado de los mensajes de un usuario</p>
</li>
</ul>
</div>
</li>
<li>
<p>Recurso <em>MensajesResource.java</em></p>
<div class="ulist">
<ul>
<li>
<p>GET /mensajes, proporciona un listado con los mensajes del foro</p>
</li>
<li>
<p>POST /mensajes, aÃ±ade un mensaje nuevo en el foro</p>
</li>
<li>
<p>GET /mensajes/id, proporciona informaciÃ³n sobre el mensaje cuyo id es "id"</p>
</li>
<li>
<p>PUT /mensajes/id, modifica un mensaje</p>
</li>
<li>
<p>DELETE /mensajes/id, borra un mensaje</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>Una vez desplegada la aplicaciÃ³n, podÃ©is aÃ±adir datos a la base de datos del foro, utilizando
los datos del fichero /src/main/resources/foro.sql. Para ello simplemente tendrÃ©is que invocar
la goal Maven correspondiente desde la ventana <em>Maven Projects &gt; s4-foroAvanzado &gt; Plugins &gt;
sql &gt; sql:execute</em></p>
</div>
<div class="paragraph">
<p>En el directorio <code>src/main/resources</code> tenÃ©is un fichero de texto (<code>instrucciones.txt</code>)
con informaciÃ³n adicional sobre la implementaciÃ³n proporcionada.</p>
</div>
<div class="paragraph">
<p>A partir de las plantillas, se pide:</p>
</div>
<div class="sect3">
<h4 id="_uso_de_hateoas_1_puntos">4.5.1. Uso de Hateoas (1 puntos)</h4>
<div class="paragraph">
<p>Vamos a aÃ±adir a los servicios enlaces a las operaciones que podemos realizar con
cada recurso, siguiendo el estilo Hateoas.</p>
</div>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Para los usuarios:</p>
<div class="ulist">
<ul>
<li>
<p>En el listado de usuarios aÃ±adir a cada usuario un enlace con relaciÃ³n <code>self</code> que
apunte a la direcciÃ³n a la que estÃ¡ mapeado el usuario individual.</p>
</li>
<li>
<p>En la operaciÃ³n de obtenciÃ³n de un usuario individual, incluir los enlaces para
ver el propio usuario (self), modificarlo (usuario/modificar), borrarlo (usuario/borrar),
o ver los mensajes que enviÃ³ el usuario (usuario/mensajes).</p>
</li>
</ul>
</div>
</li>
<li>
<p>Para los mensajes:</p>
<div class="ulist">
<ul>
<li>
<p>En el listado de mensajes aÃ±adir a cada mensaje un enlace con relaciÃ³n <code>self</code> que
apunte a la direcciÃ³n a la que estÃ¡ mapeado el mensaje individual.</p>
</li>
<li>
<p>En la operaciÃ³n de obtenciÃ³n de un mensaje individual, incluir los enlaces para
ver el propio mensaje (self), modificarlo (mensaje/modificar), borrarlo (mensaje/borrar),
o ver los datos del usuario que enviÃ³ el mensaje (mensaje/usuario).</p>
</li>
</ul>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<p>Utiliza postman para comprobar las modificaciones realizadas.</p>
</div>
</div>
<div class="sect3">
<h4 id="_ejercicio_seguridad_1_punto">4.5.2. Ejercicio seguridad (1 punto)</h4>
<div class="paragraph">
<p>Vamos ahora a restringir el acceso al servicio para que sÃ³lo usuarios registrados puedan realizar modificaciones.
Se pide:</p>
</div>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>AÃ±adir al usuario "pepe" en el "ApplicationRealm" de wildfly, con la contraseÃ±a "pepe", y perteneciente
al grupo (rol) "registrado"</p>
</li>
<li>
<p>Configurar, mediante seguridad declarativa, para que las operaciones de modificaciÃ³n
(POST, PUT y DELETE) sÃ³lo la puedan realizar los usuarios con rol <strong>registrado</strong>.
Utilizar autentificaciÃ³n de tipo BASIC.</p>
</li>
<li>
<p>Ahora vamos a hacer que la modificaciÃ³n o borrado de usuarios sÃ³lo pueda
realizarlas el mismo usuario que va a modificarse o borrarse. Para ello utilizaremos seguridad
programada. En el caso de que el usuario que va a realizar la modificaciÃ³n o borrado
quiera borrar/modificar otros usuarios lanzaremos la excepciÃ³n <code>WebApplicationException(Status.FORBIDDEN)</code></p>
</li>
<li>
<p>Vamos a hacer lo mismo con los mensajes. SÃ³lo podrÃ¡ modificar y borrar mensajes
el mismo usuario que los creÃ³, y al publicar un nuevo mensaje, forzaremos que el
login del mensaje sea el del usuario que hay autentificado en el sistema.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Utiliza postman para comprobar las modificaciones realizadas.</p>
</div>
</div>
</div>
</div>
</div>
</div>
<div id="footer">
<div id="footer-text">
Last updated 2015-10-15 10:06:27 CEST
</div>
</div>
</body>
</html>