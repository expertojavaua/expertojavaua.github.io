<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<!--[if IE]><meta http-equiv="X-UA-Compatible" content="IE=edge"><![endif]-->
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 1.5.2">
<meta name="author" content="María Isabel Alfonso Galipienso">
<title>Servicios Rest</title>
<style>/*! normalize.css v2.1.2 | MIT License | git.io/normalize */
/* ========================================================================== HTML5 display definitions ========================================================================== */
/** Correct `block` display not defined in IE 8/9. */
article, aside, details, figcaption, figure, footer, header, hgroup, main, nav, section, summary { display: block; }

/** Correct `inline-block` display not defined in IE 8/9. */
audio, canvas, video { display: inline-block; }

/** Prevent modern browsers from displaying `audio` without controls. Remove excess height in iOS 5 devices. */
audio:not([controls]) { display: none; height: 0; }

/** Address `[hidden]` styling not present in IE 8/9. Hide the `template` element in IE, Safari, and Firefox < 22. */
[hidden], template { display: none; }

script { display: none !important; }

/* ========================================================================== Base ========================================================================== */
/** 1. Set default font family to sans-serif. 2. Prevent iOS text size adjust after orientation change, without disabling user zoom. */
html { font-family: sans-serif; /* 1 */ -ms-text-size-adjust: 100%; /* 2 */ -webkit-text-size-adjust: 100%; /* 2 */ }

/** Remove default margin. */
body { margin: 0; }

/* ========================================================================== Links ========================================================================== */
/** Remove the gray background color from active links in IE 10. */
a { background: transparent; }

/** Address `outline` inconsistency between Chrome and other browsers. */
a:focus { outline: thin dotted; }

/** Improve readability when focused and also mouse hovered in all browsers. */
a:active, a:hover { outline: 0; }

/* ========================================================================== Typography ========================================================================== */
/** Address variable `h1` font-size and margin within `section` and `article` contexts in Firefox 4+, Safari 5, and Chrome. */
h1 { font-size: 2em; margin: 0.67em 0; }

/** Address styling not present in IE 8/9, Safari 5, and Chrome. */
abbr[title] { border-bottom: 1px dotted; }

/** Address style set to `bolder` in Firefox 4+, Safari 5, and Chrome. */
b, strong { font-weight: bold; }

/** Address styling not present in Safari 5 and Chrome. */
dfn { font-style: italic; }

/** Address differences between Firefox and other browsers. */
hr { -moz-box-sizing: content-box; box-sizing: content-box; height: 0; }

/** Address styling not present in IE 8/9. */
mark { background: #ff0; color: #000; }

/** Correct font family set oddly in Safari 5 and Chrome. */
code, kbd, pre, samp { font-family: monospace, serif; font-size: 1em; }

/** Improve readability of pre-formatted text in all browsers. */
pre { white-space: pre-wrap; }

/** Set consistent quote types. */
q { quotes: "\201C" "\201D" "\2018" "\2019"; }

/** Address inconsistent and variable font size in all browsers. */
small { font-size: 80%; }

/** Prevent `sub` and `sup` affecting `line-height` in all browsers. */
sub, sup { font-size: 75%; line-height: 0; position: relative; vertical-align: baseline; }

sup { top: -0.5em; }

sub { bottom: -0.25em; }

/* ========================================================================== Embedded content ========================================================================== */
/** Remove border when inside `a` element in IE 8/9. */
img { border: 0; }

/** Correct overflow displayed oddly in IE 9. */
svg:not(:root) { overflow: hidden; }

/* ========================================================================== Figures ========================================================================== */
/** Address margin not present in IE 8/9 and Safari 5. */
figure { margin: 0; }

/* ========================================================================== Forms ========================================================================== */
/** Define consistent border, margin, and padding. */
fieldset { border: 1px solid #c0c0c0; margin: 0 2px; padding: 0.35em 0.625em 0.75em; }

/** 1. Correct `color` not being inherited in IE 8/9. 2. Remove padding so people aren't caught out if they zero out fieldsets. */
legend { border: 0; /* 1 */ padding: 0; /* 2 */ }

/** 1. Correct font family not being inherited in all browsers. 2. Correct font size not being inherited in all browsers. 3. Address margins set differently in Firefox 4+, Safari 5, and Chrome. */
button, input, select, textarea { font-family: inherit; /* 1 */ font-size: 100%; /* 2 */ margin: 0; /* 3 */ }

/** Address Firefox 4+ setting `line-height` on `input` using `!important` in the UA stylesheet. */
button, input { line-height: normal; }

/** Address inconsistent `text-transform` inheritance for `button` and `select`. All other form control elements do not inherit `text-transform` values. Correct `button` style inheritance in Chrome, Safari 5+, and IE 8+. Correct `select` style inheritance in Firefox 4+ and Opera. */
button, select { text-transform: none; }

/** 1. Avoid the WebKit bug in Android 4.0.* where (2) destroys native `audio` and `video` controls. 2. Correct inability to style clickable `input` types in iOS. 3. Improve usability and consistency of cursor style between image-type `input` and others. */
button, html input[type="button"], input[type="reset"], input[type="submit"] { -webkit-appearance: button; /* 2 */ cursor: pointer; /* 3 */ }

/** Re-set default cursor for disabled elements. */
button[disabled], html input[disabled] { cursor: default; }

/** 1. Address box sizing set to `content-box` in IE 8/9. 2. Remove excess padding in IE 8/9. */
input[type="checkbox"], input[type="radio"] { box-sizing: border-box; /* 1 */ padding: 0; /* 2 */ }

/** 1. Address `appearance` set to `searchfield` in Safari 5 and Chrome. 2. Address `box-sizing` set to `border-box` in Safari 5 and Chrome (include `-moz` to future-proof). */
input[type="search"] { -webkit-appearance: textfield; /* 1 */ -moz-box-sizing: content-box; -webkit-box-sizing: content-box; /* 2 */ box-sizing: content-box; }

/** Remove inner padding and search cancel button in Safari 5 and Chrome on OS X. */
input[type="search"]::-webkit-search-cancel-button, input[type="search"]::-webkit-search-decoration { -webkit-appearance: none; }

/** Remove inner padding and border in Firefox 4+. */
button::-moz-focus-inner, input::-moz-focus-inner { border: 0; padding: 0; }

/** 1. Remove default vertical scrollbar in IE 8/9. 2. Improve readability and alignment in all browsers. */
textarea { overflow: auto; /* 1 */ vertical-align: top; /* 2 */ }

/* ========================================================================== Tables ========================================================================== */
/** Remove most spacing between table cells. */
table { border-collapse: collapse; border-spacing: 0; }

meta.foundation-mq-small { font-family: "only screen and (min-width: 768px)"; width: 768px; }

meta.foundation-mq-medium { font-family: "only screen and (min-width:1280px)"; width: 1280px; }

meta.foundation-mq-large { font-family: "only screen and (min-width:1440px)"; width: 1440px; }

*, *:before, *:after { -moz-box-sizing: border-box; -webkit-box-sizing: border-box; box-sizing: border-box; }

html, body { font-size: 97%; }

body { background: white; color: #222222; padding: 0; margin: 0; font-family: "Helvetica Neue", "Helvetica", Helvetica, Arial, sans-serif; font-weight: normal; font-style: normal; line-height: 1; position: relative; cursor: auto; }

a:hover { cursor: pointer; }

img, object, embed { max-width: 100%; height: auto; }

object, embed { height: 100%; }

img { -ms-interpolation-mode: bicubic; }

#map_canvas img, #map_canvas embed, #map_canvas object, .map_canvas img, .map_canvas embed, .map_canvas object { max-width: none !important; }

.left { float: left !important; }

.right { float: right !important; }

.text-left { text-align: left !important; }

.text-right { text-align: right !important; }

.text-center { text-align: center !important; }

.text-justify { text-align: justify !important; }

.hide { display: none; }

.antialiased, body { -webkit-font-smoothing: antialiased; }

img { display: inline-block; vertical-align: middle; }

textarea { height: auto; min-height: 50px; }

select { width: 100%; }

p.lead, .paragraph.lead > p, #preamble > .sectionbody > .paragraph:first-of-type p { font-size: 1.21875em; line-height: 1.6; }

.subheader, .admonitionblock td.content > .title, .audioblock > .title, .exampleblock > .title, .imageblock > .title, .listingblock > .title, .literalblock > .title, .stemblock > .title, .openblock > .title, .paragraph > .title, .quoteblock > .title, table.tableblock > .title, .verseblock > .title, .videoblock > .title, .dlist > .title, .olist > .title, .ulist > .title, .qlist > .title, .hdlist > .title { line-height: 1.4; color: #6f6f6f; font-weight: 300; margin-top: 0.2em; margin-bottom: 0.5em; }

/* Typography resets */
div, dl, dt, dd, ul, ol, li, h1, h2, h3, #toctitle, .sidebarblock > .content > .title, h4, h5, h6, pre, form, p, blockquote, th, td { margin: 0; padding: 0; direction: ltr; }

/* Default Link Styles */
a { color: #1164be; text-decoration: none; line-height: inherit; }
a img { border: none; }

/* Default paragraph styles */
p { font-family: inherit; font-weight: normal; font-size: 1em; line-height: 1.4; margin-bottom: 1em; text-rendering: optimizeLegibility; }
p aside { font-size: 0.875em; line-height: 1.35; font-style: italic; }

/* Default header styles */
h1, h2, h3, #toctitle, .sidebarblock > .content > .title, h4, h5, h6 { font-family: "Helvetica Neue", "Helvetica", Helvetica, Arial, sans-serif; font-weight: bold; font-style: normal; color: #1c355e; text-rendering: optimizeLegibility; margin-top: 1em; margin-bottom: 0.5em; line-height: 1.2125em; }
h1 small, h2 small, h3 small, #toctitle small, .sidebarblock > .content > .title small, h4 small, h5 small, h6 small { font-size: 60%; color: #6f6f6f; line-height: 0; }

h1 { font-size: 2.125em; }

h2 { font-size: 1.6875em; }

h3, #toctitle, .sidebarblock > .content > .title { font-size: 1.375em; }

h4 { font-size: 1.125em; }

h5 { font-size: 1.125em; }

h6 { font-size: 1em; }

hr { border: solid #dddddd; border-width: 1px 0 0; clear: both; margin: 1.25em 0 1.1875em; height: 0; }

/* Helpful Typography Defaults */
em, i { font-style: italic; line-height: inherit; }

strong, b { font-weight: bold; line-height: inherit; }

small { font-size: 60%; line-height: inherit; }

code { font-family: Consolas, "Liberation Mono", Courier, monospace; font-weight: bold; }

/* Lists */
ul, ol, dl { font-size: 1em; line-height: 1.4; margin-bottom: 1.25em; list-style-position: outside; font-family: inherit; }

ul, ol { margin-left: 2.5em; }
ul.no-bullet, ol.no-bullet { margin-left: 1.5em; }

/* Unordered Lists */
ul li ul, ul li ol { margin-left: 1.25em; margin-bottom: 0; font-size: 1em; /* Override nested font-size change */ }
ul.square li ul, ul.circle li ul, ul.disc li ul { list-style: inherit; }
ul.square { list-style-type: square; }
ul.circle { list-style-type: circle; }
ul.disc { list-style-type: disc; }
ul.no-bullet { list-style: none; }

/* Ordered Lists */
ol li ul, ol li ol { margin-left: 1.25em; margin-bottom: 0; }

/* Definition Lists */
dl dt { margin-bottom: 0.3125em; font-weight: bold; }
dl dd { margin-bottom: 1.25em; }

/* Abbreviations */
abbr, acronym { text-transform: uppercase; font-size: 90%; color: #222222; border-bottom: 1px dotted #dddddd; cursor: help; }

abbr { text-transform: none; }

/* Blockquotes */
blockquote { margin: 0 0 1.25em; padding: 0.5625em 1.25em 0 1.1875em; border-left: 1px solid #dddddd; }
blockquote cite { display: block; font-size: 0.8125em; color: #555555; }
blockquote cite:before { content: "\2014 \0020"; }
blockquote cite a, blockquote cite a:visited { color: #555555; }

blockquote, blockquote p { line-height: 1.6; color: #6f6f6f; }

/* Microformats */
.vcard { display: inline-block; margin: 0 0 1.25em 0; border: 1px solid #dddddd; padding: 0.625em 0.75em; }
.vcard li { margin: 0; display: block; }
.vcard .fn { font-weight: bold; font-size: 0.9375em; }

.vevent .summary { font-weight: bold; }
.vevent abbr { cursor: auto; text-decoration: none; font-weight: bold; border: none; padding: 0 0.0625em; }

/*@media only screen and (min-width: 768px) { h1, h2, h3, #toctitle, .sidebarblock > .content > .title, h4, h5, h6 { line-height: 1.4; }
  h1 { font-size: 2.75em; }
  h2 { font-size: 2.3125em; }
  h3, #toctitle, .sidebarblock > .content > .title { font-size: 1.6875em; }
  h4 { font-size: 1.4375em; } }*/
/* Tables */
table { background: white; margin-bottom: 1.25em; border: solid 1px #dddddd; }
table thead, table tfoot { background: whitesmoke; font-weight: bold; }
table thead tr th, table thead tr td, table tfoot tr th, table tfoot tr td { padding: 0.5em 0.625em 0.625em; font-size: inherit; color: #222222; text-align: left; }
table tr th, table tr td { padding: 0.5625em 0.625em; font-size: inherit; color: #222222; }
table tr.even, table tr.alt, table tr:nth-of-type(even) { background: #f9f9f9; }
table thead tr th, table tfoot tr th, table tbody tr td, table tr td, table tfoot tr td { display: table-cell; line-height: 1.4; }

h1, h2, h3, #toctitle, .sidebarblock > .content > .title, h4, h5, h6 { line-height: 1.4; border-bottom: 1px solid #dddddd }

.clearfix:before, .clearfix:after, .float-group:before, .float-group:after { content: " "; display: table; }
.clearfix:after, .float-group:after { clear: both; }

*:not(pre) > code { font-size: inherit; font-style: normal !important; letter-spacing: 0; padding: 3px 2px 1px 2px; background-color: #eeeeee; border: 1px solid #dddddd; -webkit-border-radius: 0; border-radius: 0; line-height: inherit; font-weight: normal; }

pre, pre > code { line-height: 1.4; color: black; font-family: monospace, serif; font-weight: normal; }

.keyseq { color: #555555; }

kbd { display: inline-block; color: #222222; font-size: 0.75em; line-height: 1.4; background-color: #f7f7f7; border: 1px solid #ccc; -webkit-border-radius: 3px; border-radius: 3px; -webkit-box-shadow: 0 1px 0 rgba(0, 0, 0, 0.2), 0 0 0 0.1em white inset; box-shadow: 0 1px 0 rgba(0, 0, 0, 0.2), 0 0 0 0.1em white inset; margin: -0.15em 0.15em 0 0.15em; padding: 0.2em 0.6em 0.2em 0.5em; vertical-align: middle; white-space: nowrap; }

.keyseq kbd:first-child { margin-left: 0; }

.keyseq kbd:last-child { margin-right: 0; }

.menuseq, .menu { color: #090909; }

b.button:before, b.button:after { position: relative; top: -1px; font-weight: normal; }

b.button:before { content: "["; padding: 0 3px 0 2px; }

b.button:after { content: "]"; padding: 0 2px 0 3px; }

#header, #content, #footnotes, #footer { width: 100%; margin-left: auto; margin-right: auto; margin-top: 0; margin-bottom: 0; max-width: 62.5em; *zoom: 1; position: relative; padding-left: 0.9375em; padding-right: 0.9375em; }
#header:before, #header:after, #content:before, #content:after, #footnotes:before, #footnotes:after, #footer:before, #footer:after { content: " "; display: table; }
#header:after, #content:after, #footnotes:after, #footer:after { clear: both; }

#content { margin-top: 1.25em; }

#content:before { content: none; }

#header > h1:first-child { color: black; margin-top: 2.25rem; margin-bottom: 0; }
#header > h1:first-child + #toc { margin-top: 8px; border-top: 1px solid #dddddd; }
#header > h1:only-child, body.toc2 #header > h1:nth-last-child(2) { border-bottom: 1px solid #dddddd; padding-bottom: 8px; }
#header .details { border-bottom: 1px solid #dddddd; line-height: 1.45; padding-top: 0.25em; padding-bottom: 0.25em; padding-left: 0.25em; color: #555555; display: -ms-flexbox; display: -webkit-flex; display: flex; -ms-flex-flow: row wrap; -webkit-flex-flow: row wrap; flex-flow: row wrap; }
#header .details span:first-child { margin-left: -0.125em; }
#header .details span.email a { color: #6f6f6f; }
#header .details br { display: none; }
#header .details br + span:before { content: "\00a0\2013\00a0"; }
#header .details br + span.author:before { content: "\00a0\22c5\00a0"; color: #6f6f6f; }
#header .details br + span#revremark:before { content: "\00a0|\00a0"; }
#header #revnumber { text-transform: capitalize; }
#header #revnumber:after { content: "\00a0"; }

#content > h1:first-child:not([class]) { color: black; border-bottom: 1px solid #dddddd; padding-bottom: 8px; margin-top: 0; padding-top: 1rem; margin-bottom: 1.25rem; }

#floating {
  position: fixed;
  z-index: 1000;
  padding: 0.5em;
  right: 0;
  top: 0;
  background: white;
  box-shadow: 0 0 1em #777777;
  -webkit-box-shadow: 0 0 1em #777777;
  -moz-box-shadow: 0 0 1em #777777;
  -webkit-border-bottom-left-radius: 5px;
  -moz-border-radius-bottomleft: 5px;
  max-height: 80%;
  overflow: auto;
}

#floating #full { display: none; } /* Hide the full TOC by default */

#floating:hover #full{
  display: block; /* Show it on hover */
}


#toc { border-bottom: 1px solid #dddddd; padding-bottom: 0.5em; }
#toc > ul { margin-left: 0.125em; }
#toc ul.sectlevel0 > li > a { font-style: italic; }
#toc ul.sectlevel0 ul.sectlevel1 { margin: 0.5em 0; }
#toc ul { font-family: "Helvetica Neue", "Helvetica", Helvetica, Arial, sans-serif; list-style-type: none; }
#toc a { text-decoration: none; }
#toc a:active { text-decoration: underline; }

#toctitle { color: #6f6f6f; font-size: 1.2em; }

@media only screen and (min-width: 768px) { #toctitle { font-size: 1.375em; }
  body.toc2 { padding-left: 15em; padding-right: 0; }
  #toc.toc2 { margin-top: 0 !important; background-color: #f2f2f2; position: fixed; width: 15em; left: 0; top: 0; border-right: 1px solid #dddddd; border-top-width: 0 !important; border-bottom-width: 0 !important; z-index: 1000; padding: 1.25em 1em; height: 100%; overflow: auto; }
  #toc.toc2 #toctitle { margin-top: 0; font-size: 1.2em; }
  #toc.toc2 > ul { font-size: 0.9em; margin-bottom: 0; }
  #toc.toc2 ul ul { margin-left: 0; padding-left: 1em; }
  #toc.toc2 ul.sectlevel0 ul.sectlevel1 { padding-left: 0; margin-top: 0.5em; margin-bottom: 0.5em; }
  body.toc2.toc-right { padding-left: 0; padding-right: 15em; }
  body.toc2.toc-right #toc.toc2 { border-right-width: 0; border-left: 1px solid #dddddd; left: auto; right: 0; } }
@media only screen and (min-width: 1280px) { body.toc2 { padding-left: 20em; padding-right: 0; }
  #toc.toc2 { width: 20em; }
  #toc.toc2 #toctitle { font-size: 1.375em; }
  #toc.toc2 > ul { font-size: 0.95em; }
  #toc.toc2 ul ul { padding-left: 1.25em; }
  body.toc2.toc-right { padding-left: 0; padding-right: 20em; } }
#content #toc { border-style: solid; border-width: 1px; border-color: #d9d9d9; margin-bottom: 1.25em; padding: 1.25em; background: #f2f2f2; -webkit-border-radius: 0; border-radius: 0; }
#content #toc > :first-child { margin-top: 0; }
#content #toc > :last-child { margin-bottom: 0; }

#footer { max-width: 100%; background-color: #222222; padding: 1.25em; }

#footer-text { color: #dddddd; line-height: 1.44; }

.sect1 { padding-bottom: 0.625em; }

@media only screen and (min-width: 768px) { .sect1 { padding-bottom: 1.25em; } }
.sect1 + .sect1 { border-top: 1px solid #dddddd; }

#content h1 > a.anchor, h2 > a.anchor, h3 > a.anchor, #toctitle > a.anchor, .sidebarblock > .content > .title > a.anchor, h4 > a.anchor, h5 > a.anchor, h6 > a.anchor { position: absolute; z-index: 1001; width: 1.5ex; margin-left: -1.5ex; display: block; text-decoration: none !important; visibility: hidden; text-align: center; font-weight: normal; }
#content h1 > a.anchor:before, h2 > a.anchor:before, h3 > a.anchor:before, #toctitle > a.anchor:before, .sidebarblock > .content > .title > a.anchor:before, h4 > a.anchor:before, h5 > a.anchor:before, h6 > a.anchor:before { content: "\00A7"; font-size: 0.85em; display: block; padding-top: 0.1em; }
#content h1:hover > a.anchor, #content h1 > a.anchor:hover, h2:hover > a.anchor, h2 > a.anchor:hover, h3:hover > a.anchor, #toctitle:hover > a.anchor, .sidebarblock > .content > .title:hover > a.anchor, h3 > a.anchor:hover, #toctitle > a.anchor:hover, .sidebarblock > .content > .title > a.anchor:hover, h4:hover > a.anchor, h4 > a.anchor:hover, h5:hover > a.anchor, h5 > a.anchor:hover, h6:hover > a.anchor, h6 > a.anchor:hover { visibility: visible; }
#content h1 > a.link, h2 > a.link, h3 > a.link, #toctitle > a.link, .sidebarblock > .content > .title > a.link, h4 > a.link, h5 > a.link, h6 > a.link { color: #222222; text-decoration: none; }
#content h1 > a.link:hover, h2 > a.link:hover, h3 > a.link:hover, #toctitle > a.link:hover, .sidebarblock > .content > .title > a.link:hover, h4 > a.link:hover, h5 > a.link:hover, h6 > a.link:hover { color: #151515; }

.audioblock, .imageblock, .literalblock, .listingblock, .stemblock, .videoblock { margin-bottom: 1.25em; }

.admonitionblock td.content > .title, .audioblock > .title, .exampleblock > .title, .imageblock > .title, .listingblock > .title, .literalblock > .title, .stemblock > .title, .openblock > .title, .paragraph > .title, .quoteblock > .title, table.tableblock > .title, .verseblock > .title, .videoblock > .title, .dlist > .title, .olist > .title, .ulist > .title, .qlist > .title, .hdlist > .title { text-rendering: optimizeLegibility; text-align: left; }

table.tableblock > caption.title { white-space: nowrap; overflow: visible; max-width: 0; }

.paragraph.lead > p, #preamble > .sectionbody > .paragraph:first-of-type p { color: black; }

table.tableblock #preamble > .sectionbody > .paragraph:first-of-type p { font-size: inherit; }

.admonitionblock > table { border-collapse: separate; border: 0; background: none; width: 100%; }
.admonitionblock > table td.icon { text-align: center; width: 80px; }
.admonitionblock > table td.icon img { max-width: none; }
.admonitionblock > table td.icon .title { font-weight: bold; font-family: "Helvetica Neue", "Helvetica", Helvetica, Arial, sans-serif; text-transform: uppercase; }
.admonitionblock > table td.content { padding-left: 1.125em; padding-right: 1.25em; border-left: 1px solid #dddddd; color: #555555; }
.admonitionblock > table td.content > :last-child > :last-child { margin-bottom: 0; }

.exampleblock > .content { border-style: solid; border-width: 1px; border-color: #e6e6e6; margin-bottom: 1.25em; padding: 1.25em; background: white; -webkit-border-radius: 0; border-radius: 0; }
.exampleblock > .content > :first-child { margin-top: 0; }
.exampleblock > .content > :last-child { margin-bottom: 0; }

.sidebarblock { border-style: solid; border-width: 1px; border-color: #d9d9d9; margin-bottom: 1.25em; padding: 1.25em; background: #f2f2f2; -webkit-border-radius: 0; border-radius: 0; }
.sidebarblock > :first-child { margin-top: 0; }
.sidebarblock > :last-child { margin-bottom: 0; }
.sidebarblock > .content > .title { color: #6f6f6f; margin-top: 0; }

.exampleblock > .content > :last-child > :last-child, .exampleblock > .content .olist > ol > li:last-child > :last-child, .exampleblock > .content .ulist > ul > li:last-child > :last-child, .exampleblock > .content .qlist > ol > li:last-child > :last-child, .sidebarblock > .content > :last-child > :last-child, .sidebarblock > .content .olist > ol > li:last-child > :last-child, .sidebarblock > .content .ulist > ul > li:last-child > :last-child, .sidebarblock > .content .qlist > ol > li:last-child > :last-child { margin-bottom: 0; }

.literalblock pre, .listingblock pre:not(.highlight), .listingblock pre[class="highlight"], .listingblock pre[class^="highlight "], .listingblock pre.CodeRay, .listingblock pre.prettyprint { background: #eeeeee; }
.sidebarblock .literalblock pre, .sidebarblock .listingblock pre:not(.highlight), .sidebarblock .listingblock pre[class="highlight"], .sidebarblock .listingblock pre[class^="highlight "], .sidebarblock .listingblock pre.CodeRay, .sidebarblock .listingblock pre.prettyprint { background: #f2f1f1; }

.literalblock pre, .literalblock pre[class], .listingblock pre, .listingblock pre[class] { border: 1px solid #cccccc; -webkit-border-radius: 0; border-radius: 0; word-wrap: break-word; padding: 0.8em 0.8em 0.65em 0.8em; font-size: 0.8125em; }
.literalblock pre.nowrap, .literalblock pre[class].nowrap, .listingblock pre.nowrap, .listingblock pre[class].nowrap { overflow-x: auto; white-space: pre; word-wrap: normal; }
@media only screen and (min-width: 768px) { .literalblock pre, .literalblock pre[class], .listingblock pre, .listingblock pre[class] { font-size: 0.90625em; } }
@media only screen and (min-width: 1280px) { .literalblock pre, .literalblock pre[class], .listingblock pre, .listingblock pre[class] { font-size: 1em; } }

.literalblock.output pre { color: #eeeeee; background-color: black; }

.listingblock pre.highlightjs { padding: 0; }
.listingblock pre.highlightjs > code { padding: 0.8em 0.8em 0.65em 0.8em; -webkit-border-radius: 0; border-radius: 0; }

.listingblock > .content { position: relative; }

.listingblock code[data-lang]:before { display: none; content: attr(data-lang); position: absolute; font-size: 0.75em; top: 0.425rem; right: 0.5rem; line-height: 1; text-transform: uppercase; color: #999; }

.listingblock:hover code[data-lang]:before { display: block; }

.listingblock.terminal pre .command:before { content: attr(data-prompt); padding-right: 0.5em; color: #999; }

.listingblock.terminal pre .command:not([data-prompt]):before { content: "$"; }

table.pyhltable { border-collapse: separate; border: 0; margin-bottom: 0; background: none; }

table.pyhltable td { vertical-align: top; padding-top: 0; padding-bottom: 0; }

table.pyhltable td.code { padding-left: .75em; padding-right: 0; }

pre.pygments .lineno, table.pyhltable td:not(.code) { color: #999; padding-left: 0; padding-right: .5em; border-right: 1px solid #dddddd; }

pre.pygments .lineno { display: inline-block; margin-right: .25em; }

table.pyhltable .linenodiv { background: none !important; padding-right: 0 !important; }

.quoteblock { margin: 0 1em 1.25em 1.5em; display: table; }
.quoteblock > .title { margin-left: -1.5em; margin-bottom: 0.75em; }
.quoteblock blockquote, .quoteblock blockquote p { color: #6f6f6f; font-size: 1.15rem; line-height: 1.75; word-spacing: 0.1em; letter-spacing: 0; font-style: italic; text-align: justify; }
.quoteblock blockquote { margin: 0; padding: 0; border: 0; }
.quoteblock blockquote:before { content: "\201c"; float: left; font-size: 2.75em; font-weight: bold; line-height: 0.6em; margin-left: -0.6em; color: #6f6f6f; text-shadow: 0 1px 2px rgba(0, 0, 0, 0.1); }
.quoteblock blockquote > .paragraph:last-child p { margin-bottom: 0; }
.quoteblock .attribution { margin-top: 0.5em; margin-right: 0.5ex; text-align: right; }
.quoteblock .quoteblock { margin-left: 0; margin-right: 0; padding: 0.5em 0; border-left: 3px solid #555555; }
.quoteblock .quoteblock blockquote { padding: 0 0 0 0.75em; }
.quoteblock .quoteblock blockquote:before { display: none; }

.verseblock { margin: 0 1em 1.25em 1em; }
.verseblock pre { font-family: "Open Sans", "DejaVu Sans", sans; font-size: 1.15rem; color: #6f6f6f; font-weight: 300; text-rendering: optimizeLegibility; }
.verseblock pre strong { font-weight: 400; }
.verseblock .attribution { margin-top: 1.25rem; margin-left: 0.5ex; }

.quoteblock .attribution, .verseblock .attribution { font-size: 0.8125em; line-height: 1.45; font-style: italic; }
.quoteblock .attribution br, .verseblock .attribution br { display: none; }
.quoteblock .attribution cite, .verseblock .attribution cite { display: block; letter-spacing: -0.05em; color: #555555; }

.quoteblock.abstract { margin: 0 0 1.25em 0; display: block; }
.quoteblock.abstract blockquote, .quoteblock.abstract blockquote p { text-align: left; word-spacing: 0; }
.quoteblock.abstract blockquote:before, .quoteblock.abstract blockquote p:first-of-type:before { display: none; }

table.tableblock { max-width: 100%; border-collapse: separate; }
table.tableblock td > .paragraph:last-child p > p:last-child, table.tableblock th > p:last-child, table.tableblock td > p:last-child { margin-bottom: 0; }

table.spread { width: 100%; }

table.tableblock, th.tableblock, td.tableblock { border: 0 solid #dddddd; }

table.grid-all th.tableblock, table.grid-all td.tableblock { border-width: 0 1px 1px 0; }

table.grid-all tfoot > tr > th.tableblock, table.grid-all tfoot > tr > td.tableblock { border-width: 1px 1px 0 0; }

table.grid-cols th.tableblock, table.grid-cols td.tableblock { border-width: 0 1px 0 0; }

table.grid-all * > tr > .tableblock:last-child, table.grid-cols * > tr > .tableblock:last-child { border-right-width: 0; }

table.grid-rows th.tableblock, table.grid-rows td.tableblock { border-width: 0 0 1px 0; }

table.grid-all tbody > tr:last-child > th.tableblock, table.grid-all tbody > tr:last-child > td.tableblock, table.grid-all thead:last-child > tr > th.tableblock, table.grid-rows tbody > tr:last-child > th.tableblock, table.grid-rows tbody > tr:last-child > td.tableblock, table.grid-rows thead:last-child > tr > th.tableblock { border-bottom-width: 0; }

table.grid-rows tfoot > tr > th.tableblock, table.grid-rows tfoot > tr > td.tableblock { border-width: 1px 0 0 0; }

table.frame-all { border-width: 1px; }

table.frame-sides { border-width: 0 1px; }

table.frame-topbot { border-width: 1px 0; }

th.halign-left, td.halign-left { text-align: left; }

th.halign-right, td.halign-right { text-align: right; }

th.halign-center, td.halign-center { text-align: center; }

th.valign-top, td.valign-top { vertical-align: top; }

th.valign-bottom, td.valign-bottom { vertical-align: bottom; }

th.valign-middle, td.valign-middle { vertical-align: middle; }

table thead th, table tfoot th { font-weight: bold; }

tbody tr th { display: table-cell; line-height: 1.4; background: whitesmoke; }

tbody tr th, tbody tr th p, tfoot tr th, tfoot tr th p { color: #222222; font-weight: bold; }

p.tableblock > code:only-child { background: none; padding: 0; }

p.tableblock { font-size: 1em; }

td > div.verse { white-space: pre; }

ol { margin-left: 2.5em; }

ul li ol { margin-left: 1.5em; }

dl dd { margin-left: 1.125em; }

dl dd:last-child, dl dd:last-child > :last-child { margin-bottom: 0; }

ol > li p, ul > li p, ul dd, ol dd, .olist .olist, .ulist .ulist, .ulist .olist, .olist .ulist { margin-bottom: 0.625em; }

ul.unstyled, ol.unnumbered, ul.checklist, ul.none { list-style-type: none; }

ul.unstyled, ol.unnumbered, ul.checklist { margin-left: 0.625em; }

ul.checklist li > p:first-child > .fa-check-square-o:first-child, ul.checklist li > p:first-child > input[type="checkbox"]:first-child { margin-right: 0.25em; }

ul.checklist li > p:first-child > input[type="checkbox"]:first-child { position: relative; top: 1px; }

ul.inline { margin: 0 auto 0.625em auto; margin-left: -1.375em; margin-right: 0; padding: 0; list-style: none; overflow: hidden; }
ul.inline > li { list-style: none; float: left; margin-left: 1.375em; display: block; }
ul.inline > li > * { display: block; }

.unstyled dl dt { font-weight: normal; font-style: normal; }

ol.arabic { list-style-type: decimal; }

ol.decimal { list-style-type: decimal-leading-zero; }

ol.loweralpha { list-style-type: lower-alpha; }

ol.upperalpha { list-style-type: upper-alpha; }

ol.lowerroman { list-style-type: lower-roman; }

ol.upperroman { list-style-type: upper-roman; }

ol.lowergreek { list-style-type: lower-greek; }

.hdlist > table, .colist > table { border: 0; background: none; }
.hdlist > table > tbody > tr, .colist > table > tbody > tr { background: none; }

td.hdlist1 { padding-right: .75em; font-weight: bold; }

td.hdlist1, td.hdlist2 { vertical-align: top; }

.literalblock + .colist, .listingblock + .colist { margin-top: -0.5em; }

.colist > table tr > td:first-of-type { padding: 0 0.75em; line-height: 1; }
.colist > table tr > td:last-of-type { padding: 0.25em 0; }

.thumb, .th { line-height: 0; display: inline-block; border: solid 4px white; -webkit-box-shadow: 0 0 0 1px #dddddd; box-shadow: 0 0 0 1px #dddddd; }

.imageblock.left, .imageblock[style*="float: left"] { margin: 0.25em 0.625em 1.25em 0; }
.imageblock.right, .imageblock[style*="float: right"] { margin: 0.25em 0 1.25em 0.625em; }
.imageblock > .title { margin-bottom: 0; }
.imageblock.thumb, .imageblock.th { border-width: 6px; }
.imageblock.thumb > .title, .imageblock.th > .title { padding: 0 0.125em; }

.image.left, .image.right { margin-top: 0.25em; margin-bottom: 0.25em; display: inline-block; line-height: 0; }
.image.left { margin-right: 0.625em; }
.image.right { margin-left: 0.625em; }

a.image { text-decoration: none; }

span.footnote, span.footnoteref { vertical-align: super; font-size: 0.875em; }
span.footnote a, span.footnoteref a { text-decoration: none; }
span.footnote a:active, span.footnoteref a:active { text-decoration: underline; }

#footnotes { padding-top: 0.75em; padding-bottom: 0.75em; margin-bottom: 0.625em; }
#footnotes hr { width: 20%; min-width: 6.25em; margin: -.25em 0 .75em 0; border-width: 1px 0 0 0; }
#footnotes .footnote { padding: 0 0.375em; line-height: 1.3; font-size: 0.875em; margin-left: 1.2em; text-indent: -1.2em; margin-bottom: .2em; }
#footnotes .footnote a:first-of-type { font-weight: bold; text-decoration: none; }
#footnotes .footnote:last-of-type { margin-bottom: 0; }

#content #footnotes { margin-top: -0.625em; margin-bottom: 0; padding: 0.75em 0; }

.gist .file-data > table { border: 0; background: #fff; width: 100%; margin-bottom: 0; }
.gist .file-data > table td.line-data { width: 99%; }

div.unbreakable { page-break-inside: avoid; }

.big { font-size: larger; }

.small { font-size: smaller; }

.underline { text-decoration: underline; }

.overline { text-decoration: overline; }

.line-through { text-decoration: line-through; }

.aqua { color: #00bfbf; }

.aqua-background { background-color: #00fafa; }

.black { color: black; }

.black-background { background-color: black; }

.blue { color: #0000bf; }

.blue-background { background-color: #0000fa; }

.fuchsia { color: #bf00bf; }

.fuchsia-background { background-color: #fa00fa; }

.gray { color: #606060; }

.gray-background { background-color: #7d7d7d; }

.green { color: #006000; }

.green-background { background-color: #007d00; }

.lime { color: #00bf00; }

.lime-background { background-color: #00fa00; }

.maroon { color: #600000; }

.maroon-background { background-color: #7d0000; }

.navy { color: #000060; }

.navy-background { background-color: #00007d; }

.olive { color: #606000; }

.olive-background { background-color: #7d7d00; }

.purple { color: #600060; }

.purple-background { background-color: #7d007d; }

.red { color: #bf0000; }

.red-background { background-color: #fa0000; }

.silver { color: #909090; }

.silver-background { background-color: #bcbcbc; }

.teal { color: #006060; }

.teal-background { background-color: #007d7d; }

.white { color: #bfbfbf; }

.white-background { background-color: #fafafa; }

.yellow { color: #bfbf00; }

.yellow-background { background-color: #fafa00; }

span.icon > .fa { cursor: default; }

.admonitionblock td.icon [class^="fa icon-"] { font-size: 2.5em; text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.5); cursor: default; }
.admonitionblock td.icon .icon-note:before { content: "\f05a"; color: #207c98; }
.admonitionblock td.icon .icon-tip:before { content: "\f0eb"; text-shadow: 1px 1px 2px rgba(155, 155, 0, 0.8); color: #111; }
.admonitionblock td.icon .icon-warning:before { content: "\f071"; color: #bf6900; }
.admonitionblock td.icon .icon-caution:before { content: "\f06d"; color: #bf3400; }
.admonitionblock td.icon .icon-important:before { content: "\f06a"; color: #bf0000; }

.conum[data-value] { display: inline-block; color: #fff !important; background-color: #222222; -webkit-border-radius: 100px; border-radius: 100px; text-align: center; font-size: 0.75em; width: 1.67em; height: 1.67em; line-height: 1.67em; font-family: "Open Sans", "DejaVu Sans", sans-serif; font-style: normal; font-weight: bold; }
.conum[data-value] * { color: #fff !important; }
.conum[data-value] + b { display: none; }
.conum[data-value]:after { content: attr(data-value); }
pre .conum[data-value] { position: relative; top: -0.125em; }

b.conum * { color: inherit !important; }

.conum:not([data-value]):empty { display: none; }

.literalblock pre, .listingblock pre { background: #eeeeee; }

</style>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.2.0/css/font-awesome.min.css">
<style>.listingblock .pygments .hll { background-color: #ffffcc }
.listingblock .pygments  { background: #f8f8f8; }
.listingblock .pygments .tok-c { color: #408080; font-style: italic } /* Comment */
.listingblock .pygments .tok-err { border: 1px solid #FF0000 } /* Error */
.listingblock .pygments .tok-k { color: #008000; font-weight: bold } /* Keyword */
.listingblock .pygments .tok-o { color: #666666 } /* Operator */
.listingblock .pygments .tok-cm { color: #408080; font-style: italic } /* Comment.Multiline */
.listingblock .pygments .tok-cp { color: #BC7A00 } /* Comment.Preproc */
.listingblock .pygments .tok-c1 { color: #408080; font-style: italic } /* Comment.Single */
.listingblock .pygments .tok-cs { color: #408080; font-style: italic } /* Comment.Special */
.listingblock .pygments .tok-gd { color: #A00000 } /* Generic.Deleted */
.listingblock .pygments .tok-ge { font-style: italic } /* Generic.Emph */
.listingblock .pygments .tok-gr { color: #FF0000 } /* Generic.Error */
.listingblock .pygments .tok-gh { color: #000080; font-weight: bold } /* Generic.Heading */
.listingblock .pygments .tok-gi { color: #00A000 } /* Generic.Inserted */
.listingblock .pygments .tok-go { color: #888888 } /* Generic.Output */
.listingblock .pygments .tok-gp { color: #000080; font-weight: bold } /* Generic.Prompt */
.listingblock .pygments .tok-gs { font-weight: bold } /* Generic.Strong */
.listingblock .pygments .tok-gu { color: #800080; font-weight: bold } /* Generic.Subheading */
.listingblock .pygments .tok-gt { color: #0044DD } /* Generic.Traceback */
.listingblock .pygments .tok-kc { color: #008000; font-weight: bold } /* Keyword.Constant */
.listingblock .pygments .tok-kd { color: #008000; font-weight: bold } /* Keyword.Declaration */
.listingblock .pygments .tok-kn { color: #008000; font-weight: bold } /* Keyword.Namespace */
.listingblock .pygments .tok-kp { color: #008000 } /* Keyword.Pseudo */
.listingblock .pygments .tok-kr { color: #008000; font-weight: bold } /* Keyword.Reserved */
.listingblock .pygments .tok-kt { color: #B00040 } /* Keyword.Type */
.listingblock .pygments .tok-m { color: #666666 } /* Literal.Number */
.listingblock .pygments .tok-s { color: #BA2121 } /* Literal.String */
.listingblock .pygments .tok-na { color: #7D9029 } /* Name.Attribute */
.listingblock .pygments .tok-nb { color: #008000 } /* Name.Builtin */
.listingblock .pygments .tok-nc { color: #0000FF; font-weight: bold } /* Name.Class */
.listingblock .pygments .tok-no { color: #880000 } /* Name.Constant */
.listingblock .pygments .tok-nd { color: #AA22FF } /* Name.Decorator */
.listingblock .pygments .tok-ni { color: #999999; font-weight: bold } /* Name.Entity */
.listingblock .pygments .tok-ne { color: #D2413A; font-weight: bold } /* Name.Exception */
.listingblock .pygments .tok-nf { color: #0000FF } /* Name.Function */
.listingblock .pygments .tok-nl { color: #A0A000 } /* Name.Label */
.listingblock .pygments .tok-nn { color: #0000FF; font-weight: bold } /* Name.Namespace */
.listingblock .pygments .tok-nt { color: #008000; font-weight: bold } /* Name.Tag */
.listingblock .pygments .tok-nv { color: #19177C } /* Name.Variable */
.listingblock .pygments .tok-ow { color: #AA22FF; font-weight: bold } /* Operator.Word */
.listingblock .pygments .tok-w { color: #bbbbbb } /* Text.Whitespace */
.listingblock .pygments .tok-mb { color: #666666 } /* Literal.Number.Bin */
.listingblock .pygments .tok-mf { color: #666666 } /* Literal.Number.Float */
.listingblock .pygments .tok-mh { color: #666666 } /* Literal.Number.Hex */
.listingblock .pygments .tok-mi { color: #666666 } /* Literal.Number.Integer */
.listingblock .pygments .tok-mo { color: #666666 } /* Literal.Number.Oct */
.listingblock .pygments .tok-sb { color: #BA2121 } /* Literal.String.Backtick */
.listingblock .pygments .tok-sc { color: #BA2121 } /* Literal.String.Char */
.listingblock .pygments .tok-sd { color: #BA2121; font-style: italic } /* Literal.String.Doc */
.listingblock .pygments .tok-s2 { color: #BA2121 } /* Literal.String.Double */
.listingblock .pygments .tok-se { color: #BB6622; font-weight: bold } /* Literal.String.Escape */
.listingblock .pygments .tok-sh { color: #BA2121 } /* Literal.String.Heredoc */
.listingblock .pygments .tok-si { color: #BB6688; font-weight: bold } /* Literal.String.Interpol */
.listingblock .pygments .tok-sx { color: #008000 } /* Literal.String.Other */
.listingblock .pygments .tok-sr { color: #BB6688 } /* Literal.String.Regex */
.listingblock .pygments .tok-s1 { color: #BA2121 } /* Literal.String.Single */
.listingblock .pygments .tok-ss { color: #19177C } /* Literal.String.Symbol */
.listingblock .pygments .tok-bp { color: #008000 } /* Name.Builtin.Pseudo */
.listingblock .pygments .tok-vc { color: #19177C } /* Name.Variable.Class */
.listingblock .pygments .tok-vg { color: #19177C } /* Name.Variable.Global */
.listingblock .pygments .tok-vi { color: #19177C } /* Name.Variable.Instance */
.listingblock .pygments .tok-il { color: #666666 } /* Literal.Number.Integer.Long */
</style>
</head>
<body class="article toc2 toc-left">
<div id="header">
<h1>Servicios Rest</h1>
<div class="details">
<span id="author" class="author">María Isabel Alfonso Galipienso</span><br>
<span id="email" class="email">&lt;<a href="mailto:eli@ua.es">eli@ua.es</a>&gt;</span><br>
</div>
<div id="toc" class="toc2">
<div id="toctitle">Índice de contenidos</div>
<ul class="sectlevel1">
<li><a href="#sesion05">5. Api cliente. Procesamiento JSON y Pruebas</a>
<ul class="sectlevel2">
<li><a href="#_api_cliente_visi%C3%B3n_general">5.1. API cliente. Visión general</a>
<ul class="sectlevel3">
<li><a href="#_obtenemos_una_instancia_client">5.1.1. Obtenemos una instancia Client</a></li>
<li><a href="#_configuramos_el_em_target_em_del_cliente_uri">5.1.2. Configuramos el <em>target</em> del cliente (URI)</a></li>
<li><a href="#_construimos_y_realizamos_la_petici%C3%B3n">5.1.3. Construimos y Realizamos la petición</a></li>
<li><a href="#_manejo_de_excepciones">5.1.4. Manejo de excepciones</a></li>
</ul>
</li>
<li><a href="#_procesamiento_json">5.2. Procesamiento JSON</a></li>
<li><a href="#_modelo_de_procesamiento_basado_en_el_modelo_de_objetos">5.3. Modelo de procesamiento basado en el modelo de objetos</a>
<ul class="sectlevel3">
<li><a href="#_creaci%C3%B3n_de_un_modelos_de_objetos_desde_el_c%C3%B3digo_de_la_aplicaci%C3%B3n">5.3.1. Creación de un modelos de objetos desde el código de la aplicación</a></li>
<li><a href="#_navegando_por_el_modelo_de_objetos">5.3.2. Navegando por el modelo de objetos</a></li>
<li><a href="#_escritura_de_un_modelo_de_objetos_en_un_em_stream_em">5.3.3. Escritura de un modelo de objetos en un <em>stream</em></a></li>
<li><a href="#_modelo_de_procesamiento_basado_en_em_streaming_em">5.3.4. Modelo de procesamiento basado en <em>streaming</em></a></li>
</ul>
</li>
<li><a href="#_pruebas_de_servicios_rest">5.4. Pruebas de servicios REST</a>
<ul class="sectlevel3">
<li><a href="#_ciclo_de_vida_de_maven_y_tests_junit">5.4.1. Ciclo de vida de Maven y tests JUnit</a></li>
<li><a href="#_anotaciones_junit_y_aserciones_assertthat">5.4.2. Anotaciones JUnit y aserciones AssertThat</a></li>
<li><a href="#_observaciones_sobre_los_tests_y_algunos_ejemplos_de_tests">5.4.3. Observaciones sobre los tests y algunos ejemplos de tests</a></li>
</ul>
</li>
<li><a href="#_ejercicios">5.5. Ejercicios</a>
<ul class="sectlevel3">
<li><a href="#_tests_utilizando_el_api_cliente_y_un_mapeador_de_excepciones_1_punto">5.5.1. Tests utilizando el API cliente y un mapeador de excepciones (1 punto)</a></li>
<li><a href="#_tests_utilizando_el_api_json_y_junit_1_punto">5.5.2. Tests utilizando el API Json y JUnit (1 punto)</a></li>
<li><a href="#_implementaci%C3%B3n_de_los_tests">5.5.3. Implementación de los tests</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
</div>
<div id="content">
<div id="preamble">
<div class="sectionbody">
<div style="page-break-after: always;"></div>
</div>
</div>
<div class="sect1">
<h2 id="sesion05">5. Api cliente. Procesamiento JSON y Pruebas</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Hasta ahora hemos hablado sobre la creación de servicios web RESTful y hemos "probado"
nuestros servicios utilizando el cliente que nos proporciona IntelliJ, curl, o Postman, para realizar
peticiones y observar las respuestas. JAX-RS 2.0 proporciona un API cliente para facilitar
la programación de clientes REST, que presentaremos en esta sesión.</p>
</div>
<div class="paragraph">
<p>En sesiones anteriores, hemos
trabajado con representaciones de texto y xml, fundamentalmente. Aquí hablaremos con más
detalle de JSON, que constituye otra forma de representar los datos de las peticiones y
respuestas de servicios REST muy extendida.</p>
</div>
<div class="paragraph">
<p>Finalmente, veremos cómo implementar pruebas sobre nuestro servicio utilizando el API cliente y
el <em>framework</em> <em>junit</em>.</p>
</div>
<div class="sect2">
<h3 id="_api_cliente_visión_general">5.1. API cliente. Visión general</h3>
<div class="paragraph">
<p>La especificación JAX-RS 2.0 incorpora un API cliente HTTP, que facilita enormemente
la implementación de nuestros clientes RESTful, y constituye una clara alternativa
al uso de clases Java como <code>java.net.URL</code>, librerías externas (como la de Apache) u
otras soluciones propietarias.</p>
</div>
<div class="paragraph">
<p>El API cliente está contenido en el paquete <code>javax.ws.rs.client</code>, y está diseñado para
que se pueda utilizar de forma "fluida" (<em>fluent</em>). Esto
significa, como ya hemos visto, que lo utilizaremos "encadenando" una sucesión de
llamadas a métodos del API, permitiéndonos así escribir menos líneas de código. Básicamente
está formado por tres clases principales: <strong>Client</strong>, <strong>WebTarget</strong> y <strong>Response</strong> (ya hemos hablado
de esta última en sesiones anteriores).</p>
</div>
<div class="paragraph">
<p>Para acceder a un recurso REST mediante el API cliente es necesario seguir los siguientes
pasos:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Obtener una instancia de la interfaz <code>Client</code></p>
</li>
<li>
<p>Configurar la instancia <code>Client</code> a través de un <em>target</em> (instancia de <code>WebTarget</code>)</p>
</li>
<li>
<p>Crear una petición basada en el <em>target</em> anterior</p>
</li>
<li>
<p>Invocar la petición</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Vamos a mostrar un código ejemplo para ilustrar los pasos anteriores. En este
caso vamos a invocar peticiones POST y GET sobre una URL (<em>target</em>) para crear
y posteriormente consultar un objeto <code>Cliente</code> que representaremos en formato XML:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span class="tok-o">...</span>
<span class="tok-n">Client</span> <span class="tok-n">client</span> <span class="tok-o">=</span> <span class="tok-n">ClientBuilder</span><span class="tok-o">.</span><span class="tok-na">newClient</span><span class="tok-o">();</span> <i class="conum" data-value="1"></i><b>(1)</b>

<span class="tok-n">WebTarget</span> <span class="tok-n">target</span> <span class="tok-o">=</span>
      <span class="tok-n">client</span><span class="tok-o">.</span><span class="tok-na">target</span><span class="tok-o">(</span><span class="tok-s">&quot;http://expertojava.org/clientes&quot;</span><span class="tok-o">);</span> <i class="conum" data-value="2"></i><b>(2)</b>

<span class="tok-n">Response</span> <span class="tok-n">response</span> <span class="tok-o">=</span>
      <span class="tok-n">target</span>
        <span class="tok-o">.</span><span class="tok-na">request</span><span class="tok-o">()</span>  <i class="conum" data-value="3"></i><b>(3)</b>
        <span class="tok-o">.</span><span class="tok-na">post</span><span class="tok-o">(</span><span class="tok-n">Entity</span><span class="tok-o">.</span><span class="tok-na">xml</span><span class="tok-o">(</span><span class="tok-k">new</span> <span class="tok-nf">Cliente</span><span class="tok-o">(</span><span class="tok-s">&quot;Alvaro&quot;</span><span class="tok-o">,</span> <span class="tok-s">&quot;Gomez&quot;</span><span class="tok-o">)));</span> <i class="conum" data-value="4"></i><b>(4)</b>

<span class="tok-n">response</span><span class="tok-o">.</span><span class="tok-na">close</span><span class="tok-o">();</span> <i class="conum" data-value="5"></i><b>(5)</b>

<span class="tok-n">Cliente</span> <span class="tok-n">cliente</span> <span class="tok-o">=</span> <span class="tok-n">target</span><span class="tok-o">.</span><span class="tok-na">queryParam</span><span class="tok-o">(</span><span class="tok-s">&quot;nombre&quot;</span><span class="tok-o">,</span> <span class="tok-s">&quot;Alvaro Gomez&quot;</span><span class="tok-o">)</span>
                        <span class="tok-o">.</span><span class="tok-na">request</span><span class="tok-o">()</span>
                        <span class="tok-o">.</span><span class="tok-na">get</span><span class="tok-o">(</span><span class="tok-n">Cliente</span><span class="tok-o">.</span><span class="tok-na">class</span><span class="tok-o">);</span>  <i class="conum" data-value="6"></i><b>(6)</b>
<span class="tok-n">client</span><span class="tok-o">.</span><span class="tok-na">close</span><span class="tok-o">();</span>
<span class="tok-o">...</span></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Obtenemos una instancia <code>javax.ws.rs.client.Client</code></td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Creamos un <code>WebTarget</code></td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Creamos la petición</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Realizamos una invocación POST</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>Cerramos (liberamos) el <em>input stream</em> para esta respuesta (en el caso de que esté disponible y
abierto). Es una operación <em>idempotente</em>, es decir, podemos invocarla múltiples veces con
el mismo efecto</td>
</tr>
<tr>
<td><i class="conum" data-value="6"></i><b>6</b></td>
<td>A partir de un <code>WebTarget</code>, establecemos los valores de los <code>queryParams</code> de la
URI de la petición, creamos la petición, y realizamos una invocación GET</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>A continuación explicaremos con detalle los pasos a seguir para implementar un cliente utilizando el API de JAX-RS.</p>
</div>
<div class="sect3">
<h4 id="_obtenemos_una_instancia_client">5.1.1. Obtenemos una instancia Client</h4>
<div class="paragraph">
<p>La interfaz <code>javax.ws.rs.client.Client</code> es el principal punto de entrada del API Cliente.
Dicha interfaz define las acciones e infraestructura necesarias requeridas por un cliente
REST para "consumir" un servicio web RESTful. Los objetos <code>Client</code> se crean a partir de la
clase <code>ClientBuilder</code>:</p>
</div>
<div class="listingblock">
<div class="title">Clase <em>ClientBuilder</em>: utilizada para crear objetos <em>Client</em></div>
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span class="tok-kd">public</span> <span class="tok-kd">abstract</span> <span class="tok-kd">class</span> <span class="tok-nc">ClientBuilder</span> <span class="tok-kd">implements</span> <span class="tok-n">Configurable</span><span class="tok-o">&lt;</span><span class="tok-n">ClientBuilder</span><span class="tok-o">&gt;</span> <span class="tok-o">{</span>
  <span class="tok-kd">public</span> <span class="tok-kd">static</span> <span class="tok-n">Client</span> <span class="tok-nf">newClient</span><span class="tok-o">()</span> <span class="tok-o">{...}</span>
  <span class="tok-kd">public</span> <span class="tok-kd">static</span> <span class="tok-n">Client</span> <span class="tok-nf">newClient</span><span class="tok-o">(</span><span class="tok-kd">final</span> <span class="tok-n">Configuration</span> <span class="tok-n">configuration</span><span class="tok-o">)</span> <span class="tok-o">{...}</span>

  <span class="tok-kd">public</span> <span class="tok-kd">static</span> <span class="tok-n">ClientBuilder</span> <span class="tok-nf">newBuilder</span><span class="tok-o">()</span> <span class="tok-o">{...}</span>

  <span class="tok-kd">public</span> <span class="tok-kd">abstract</span> <span class="tok-n">ClientBuilder</span> <span class="tok-nf">sslContext</span><span class="tok-o">(</span><span class="tok-kd">final</span> <span class="tok-n">SSLContext</span> <span class="tok-n">sslContext</span><span class="tok-o">);</span>
  <span class="tok-kd">public</span> <span class="tok-kd">abstract</span> <span class="tok-n">ClientBuilder</span> <span class="tok-nf">keyStore</span><span class="tok-o">(</span><span class="tok-kd">final</span> <span class="tok-n">KeyStore</span> <span class="tok-n">keyStore</span><span class="tok-o">,</span>
                                          <span class="tok-kd">final</span> <span class="tok-kt">char</span><span class="tok-o">[]</span> <span class="tok-n">password</span><span class="tok-o">);</span>
  <span class="tok-kd">public</span> <span class="tok-n">ClientBuilder</span> <span class="tok-nf">keyStore</span><span class="tok-o">(</span><span class="tok-kd">final</span> <span class="tok-n">KeyStore</span> <span class="tok-n">keyStore</span><span class="tok-o">,</span>
                                <span class="tok-kd">final</span> <span class="tok-n">String</span> <span class="tok-n">password</span><span class="tok-o">)</span> <span class="tok-o">{}</span>
  <span class="tok-kd">public</span> <span class="tok-kd">abstract</span> <span class="tok-n">ClientBuilder</span> <span class="tok-nf">trustStore</span><span class="tok-o">(</span><span class="tok-kd">final</span> <span class="tok-n">KeyStore</span> <span class="tok-n">trustStore</span><span class="tok-o">);</span>
  <span class="tok-kd">public</span> <span class="tok-kd">abstract</span> <span class="tok-n">ClientBuilder</span> <span class="tok-nf">hostnameVerifier</span><span class="tok-o">(</span><span class="tok-kd">final</span> <span class="tok-n">HostnameVerifier</span> <span class="tok-n">verifier</span><span class="tok-o">);</span>

  <span class="tok-kd">public</span> <span class="tok-kd">abstract</span> <span class="tok-n">Client</span> <span class="tok-nf">build</span><span class="tok-o">();</span>
<span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>La forma más sencilla de crear un objeto <code>Client</code> es mediante <code>ClientBuilder.newClient()</code>.
Este método proporciona una instancia pre-inicializada de tipo <code>Client</code> lista para ser usada.
La clase <em>ClientBuilder</em> nos proporciona métodos adicionales, con los que podremos configurar
diferentes propiedades del objeto.</p>
</div>
<div class="paragraph">
<p>Veamos un ejemplo de uso de <code>ClientBuilder.newBuilder()</code> utilizando además alguno de los métodos
proporcionados para configurar nuestra instancia de tipo <code>Client</code> que vamos a crear. Los métodos
<code>register()</code> y <code>property()</code> son métodos de la interfaz <em>Configurable</em> (y que son implementados por
<em>ClientBuilder</em>).</p>
</div>
<div class="listingblock">
<div class="title">Ejemplo de uso de <em>ClientBuilder</em></div>
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span class="tok-n">Client</span> <span class="tok-n">cliente</span> <span class="tok-o">=</span> <span class="tok-n">ClientBuilder</span><span class="tok-o">.</span><span class="tok-na">newBuilder</span><span class="tok-o">()</span> <i class="conum" data-value="1"></i><b>(1)</b>
                      <span class="tok-o">.</span><span class="tok-na">property</span><span class="tok-o">(</span><span class="tok-s">&quot;connection.timeout&quot;</span><span class="tok-o">,</span> <span class="tok-mi">100</span><span class="tok-o">)</span> <i class="conum" data-value="2"></i><b>(2)</b>
                      <span class="tok-o">.</span><span class="tok-na">sslContext</span><span class="tok-o">(</span><span class="tok-n">sslContext</span><span class="tok-o">)</span> <i class="conum" data-value="3"></i><b>(3)</b>
                      <span class="tok-o">.</span><span class="tok-na">register</span><span class="tok-o">(</span><span class="tok-n">JacksonJsonProvider</span><span class="tok-o">.</span><span class="tok-na">class</span><span class="tok-o">)</span> <i class="conum" data-value="4"></i><b>(4)</b>
                      <span class="tok-o">.</span><span class="tok-na">build</span><span class="tok-o">();</span> <i class="conum" data-value="5"></i><b>(5)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Creamos un <code>ClientBuilder</code> invocando al método estático <code>ClientBuilder.newBuilder()</code></td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Asignamos una propiedad específica de la implementación concreta de JAX-RS
que estemos utilizando que controla el <em>timeout</em> de las conexiones de los <em>sockets</em></td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Especificamos el <em>sslContext</em> que queremos utilizar para gestionar las conexiones HTTP</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Registramos a través del método <code>register()</code> (de la interfaz <em>Configurable</em>) una clase anotada con <code>@Provider</code>. Dicha
clase "conoce" cómo serializar objetos Java a JSON y viceversa</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>Finalmente, realizamos una llamada a <code>build()</code> para crear la instancia <code>Client</code></td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Las instancias de <code>Client</code> gestionan conexiones con el cliente utilizando <em>sockets</em> y son
objetos bastante <em>pesados</em>. Se deberían reutilizar las instancias de esta interfaz en la medida de lo
posible, ya que la inicialización y destrucción de dichas instancias consume mucho tiempo. Por lo tanto,
por razones de rendimiento, debemos limitar el número de instancias <code>Client</code> en nuestra
aplicación.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span class="tok-n">Client</span> <span class="tok-n">client</span> <span class="tok-o">=</span> <span class="tok-n">ClientBuilder</span><span class="tok-o">.</span><span class="tok-na">newClient</span><span class="tok-o">();</span> <i class="conum" data-value="1"></i><b>(1)</b>
<span class="tok-o">...</span>
<span class="tok-n">client</span><span class="tok-o">.</span><span class="tok-na">close</span><span class="tok-o">();</span> <i class="conum" data-value="2"></i><b>(2)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Obtenemos una instancia de tipo <code>Client</code> invocando al método <code>ClientBuilder.newClient()</code></td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Utilizamos el método <code>close()</code> para "cerrar" la instancia <code>Client</code> después de
 realizar todas las invocaciones sobre el <em>target</em> del recurso. De esta forma, "cerramos"
la conexión de forma que se liberan sus recursos, y ya no podremos seguir usándola.</td>
</tr>
</table>
</div>
<div class="admonitionblock caution">
<table>
<tr>
<td class="icon">
<i class="fa icon-caution" title="Caution"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Recuerda siempre invocar el método <code>close()</code> sobre nuestros objetos <code>Client</code> después de
que hayamos realizado todas las invocaciones sobre el <em>target</em> del/los recurso/s REST.
A menudo, los objetos <code>Client</code> reutilizan conexiones por razones de rendimiento.
Si no los cerramos después de utilizarlos, estaremos desaprovechando recursos del
sistema muy "valiosos". <strong>Cerrar la conexión implica cerrar el socket</strong></p>
</div>
<div class="paragraph">
<p>Igualmente, si el resultado de una invocación a un servicio rest es una instancia de
<code>Response</code> debemos invocar el método <code>close()</code> sobre dichos objetos <code>Response</code> para
liberar la conexión. Liberar una conexion significa permitir que ésta esté disponible
para otro uso por una instancia <em>Client</em>. <strong>Liberar la conexión no implica cerrar el socket</strong>.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>La interfaz <code>Client</code> es una sub-interfaz de <code>Configurable</code>. Esto
nos permitirá utililizar los métodos <code>property()</code> y <code>register()</code> para cambiar la
configuración y registrar componentes en la parte del cliente
en tiempo de ejecución.</p>
</div>
<div class="listingblock">
<div class="title">Interfaz <em>Client</em> (es una subinterfaz de <em>Configurable</em>)</div>
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span class="tok-kd">public</span> <span class="tok-kd">interface</span> <span class="tok-nc">Client</span> <span class="tok-kd">extends</span> <span class="tok-n">Configurable</span><span class="tok-o">&lt;</span><span class="tok-n">Client</span><span class="tok-o">&gt;</span> <span class="tok-o">{</span>

   <span class="tok-kd">public</span> <span class="tok-kt">void</span> <span class="tok-nf">close</span><span class="tok-o">();</span>

   <span class="tok-kd">public</span> <span class="tok-n">WebTarget</span> <span class="tok-nf">target</span><span class="tok-o">(</span><span class="tok-n">String</span> <span class="tok-n">uri</span><span class="tok-o">);</span>
   <span class="tok-kd">public</span> <span class="tok-n">WebTarget</span> <span class="tok-nf">target</span><span class="tok-o">(</span><span class="tok-n">URI</span> <span class="tok-n">uri</span><span class="tok-o">);</span>
   <span class="tok-kd">public</span> <span class="tok-n">WebTarget</span> <span class="tok-nf">target</span><span class="tok-o">(</span><span class="tok-n">UriBuilder</span> <span class="tok-n">uriBuilder</span><span class="tok-o">);</span>
   <span class="tok-kd">public</span> <span class="tok-n">WebTarget</span> <span class="tok-nf">target</span><span class="tok-o">(</span><span class="tok-n">Link</span> <span class="tok-n">link</span><span class="tok-o">);</span>
   <span class="tok-o">...</span>
<span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Sin embargo, el principal propósito de <code>Client</code> es crear
instancias de <code>WebTarget</code>, como veremos a continuación.</p>
</div>
</div>
<div class="sect3">
<h4 id="_configuramos_el_em_target_em_del_cliente_uri">5.1.2. Configuramos el <em>target</em> del cliente (URI)</h4>
<div class="paragraph">
<p>La interfaz <code>javax.ws.rs.client.WebTarget</code> <strong>representa la URI</strong> específica que queremos
invocar para acceder a un recurso REST particular.</p>
</div>
<div class="listingblock">
<div class="title">Interfaz WebTarget (es una subinterfaz de <em>Configurable</em>)</div>
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span class="tok-kd">public</span> <span class="tok-kd">interface</span> <span class="tok-nc">WebTarget</span> <span class="tok-kd">extends</span> <span class="tok-n">Configurable</span><span class="tok-o">&lt;</span><span class="tok-n">WebTarget</span><span class="tok-o">&gt;</span> <span class="tok-o">{</span>

  <span class="tok-kd">public</span> <span class="tok-n">URI</span> <span class="tok-nf">getUri</span><span class="tok-o">();</span>
  <span class="tok-kd">public</span> <span class="tok-n">UriBuilder</span> <span class="tok-nf">getUriBuilder</span><span class="tok-o">();</span>

  <span class="tok-kd">public</span> <span class="tok-n">WebTarget</span> <span class="tok-nf">path</span><span class="tok-o">(</span><span class="tok-n">String</span> <span class="tok-n">path</span><span class="tok-o">);</span>
  <span class="tok-kd">public</span> <span class="tok-n">WebTarget</span> <span class="tok-nf">resolveTemplate</span><span class="tok-o">(</span><span class="tok-n">String</span> <span class="tok-n">name</span><span class="tok-o">,</span> <span class="tok-n">Object</span> <span class="tok-n">value</span><span class="tok-o">);</span>
  <span class="tok-o">...</span>
  <span class="tok-kd">public</span> <span class="tok-n">WebTarget</span> <span class="tok-nf">resolveTemplates</span><span class="tok-o">(</span><span class="tok-n">Map</span><span class="tok-o">&lt;</span><span class="tok-n">String</span><span class="tok-o">,</span> <span class="tok-n">Object</span><span class="tok-o">&gt;</span> <span class="tok-n">templateValues</span><span class="tok-o">);</span>
  <span class="tok-o">...</span>
  <span class="tok-kd">public</span> <span class="tok-n">WebTarget</span> <span class="tok-nf">matrixParam</span><span class="tok-o">(</span><span class="tok-n">String</span> <span class="tok-n">name</span><span class="tok-o">,</span> <span class="tok-n">Object</span><span class="tok-o">...</span> <span class="tok-n">values</span><span class="tok-o">);</span>
  <span class="tok-kd">public</span> <span class="tok-n">WebTarget</span> <span class="tok-nf">queryParam</span><span class="tok-o">(</span><span class="tok-n">String</span> <span class="tok-n">name</span><span class="tok-o">,</span> <span class="tok-n">Object</span><span class="tok-o">...</span> <span class="tok-n">values</span><span class="tok-o">);</span>
  <span class="tok-o">...</span>
<span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>La interfaz <code>WebTarget</code> tiene métodos para extender la URI inicial que hayamos
construido. Podemos añadir, por ejemplo, segmentos de <em>path</em> o parámetros de
consulta invocando
a los métodos <code>WebTarget.path()</code>, o <code>WebTarget.queryParam()</code>, respectivamente.
Si la instancia de <code>WebTarget</code> contiene plantillas de parámetros, los métodos
<code>WebTarget.resolveTemplate()</code> pueden asignar valores a las variables correspondientes.
Por ejemplo:</p>
</div>
<div class="listingblock">
<div class="title">Ejemplo para crear la URI <a href="http://ejemplo.com/clientes/123?verboso=true" class="bare">http://ejemplo.com/clientes/123?verboso=true</a></div>
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span class="tok-n">WebTarget</span> <span class="tok-n">target</span> <span class="tok-o">=</span>
        <span class="tok-n">client</span>
           <span class="tok-o">.</span><span class="tok-na">target</span><span class="tok-o">(</span><span class="tok-s">&quot;http://ejemplo.com/clientes/{id}&quot;</span><span class="tok-o">)</span> <i class="conum" data-value="1"></i><b>(1)</b>
           <span class="tok-o">.</span><span class="tok-na">resolveTemplate</span><span class="tok-o">(</span><span class="tok-s">&quot;id&quot;</span><span class="tok-o">,</span> <span class="tok-s">&quot;123&quot;</span><span class="tok-o">)</span> <i class="conum" data-value="2"></i><b>(2)</b>
           <span class="tok-o">.</span><span class="tok-na">queryParam</span><span class="tok-o">(</span><span class="tok-s">&quot;verboso&quot;</span><span class="tok-o">,</span> <span class="tok-kc">true</span><span class="tok-o">);</span> <i class="conum" data-value="3"></i><b>(3)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Inicializamos un <code>WebTarget</code> con una URI que contiene una plantilla
con un parámetro: <code>{id}</code>. El objeto <code>client</code> es una instancia de la clase `Client</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>El método <code>resolveTemplate()</code> "rellena" la expresión <code>id</code> con el valor "123"</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Finalmente añadimos a la URI un parámetro de consulta: <code>?verboso=true</code></td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Las instancias de <code>WebTarget</code> son <strong>inmutables</strong> con respecto a la URI que contienen.
Esto significa que los métodos para especificar segmentos de <code>path</code> adicionales y
parámetros devuelven <strong>una nueva instancia</strong> de <code>WebTarget</code>. Sin embargo, las instancias
de WebTarget son <strong>mutables</strong> respecto a su configuración. Por lo tanto, la configuración
de objetos <code>WebTarget</code> <strong>no crea nuevas instancias</strong>.</p>
</div>
<div class="paragraph">
<p>Veamos otro ejemplo:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span class="tok-n">WebTarget</span> <span class="tok-n">base</span> <span class="tok-o">=</span> <span class="tok-n">cliente</span><span class="tok-o">.</span><span class="tok-na">target</span><span class="tok-o">(</span><span class="tok-s">&quot;http://expertojava.org/&quot;</span><span class="tok-o">);</span> <i class="conum" data-value="1"></i><b>(1)</b>
<span class="tok-n">WebTarget</span> <span class="tok-n">clienteURI</span> <span class="tok-o">=</span> <span class="tok-n">base</span><span class="tok-o">.</span><span class="tok-na">path</span><span class="tok-o">(</span><span class="tok-s">&quot;cliente&quot;</span><span class="tok-o">);</span> <i class="conum" data-value="2"></i><b>(2)</b>
<span class="tok-n">clienteURI</span><span class="tok-o">.</span><span class="tok-na">register</span><span class="tok-o">(</span><span class="tok-n">MyProvider</span><span class="tok-o">.</span><span class="tok-na">class</span><span class="tok-o">);</span> <i class="conum" data-value="3"></i><b>(3)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td><code>base</code> es una instancia de <code>WebTarget</code> con el valor de URI <code><a href="http://exertojava.org/" class="bare">http://exertojava.org/</a></code></td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td><code>clienteURI</code> es una instancia de <code>WebTarget</code> con el valor de URI <code><a href="http://exertojava.org/cliente" class="bare">http://exertojava.org/cliente</a></code></td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Configuramos <code>clienteURI</code> registrando la clase <code>MyProvider</code></td>
</tr>
</table>
</div>
<div class="paragraph">
<p>En este ejemplo creamos dos instancias de <code>WebTarget</code>. La instancia <code>clienteURI</code> hereda
la configuración de <code>base</code> y posteriormente modificamos la configuramos registrando una clase
<code>Provider</code>. Los cambios sobre la configuración de <code>clienteURI</code> no afectan a la
configuración de <code>base</code>, ni tampoco se crea una nueva instancia de <code>WebTarget</code>.</p>
</div>
<div class="paragraph">
<p>Los beneficios del uso de <code>WebTarget</code> se hacen evidentes cuando construimos URIs
complejas, por ejemplo cuando extendemos nuestra URI base con segmentos de <code>path</code>
adicionales o plantillas. El siguiente ejemplo ilustra estas situaciones:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span class="tok-n">WebTarget</span> <span class="tok-n">base</span> <span class="tok-o">=</span> <span class="tok-n">cliente</span><span class="tok-o">.</span><span class="tok-na">target</span><span class="tok-o">(</span><span class="tok-s">&quot;http://expertojava.org/&quot;</span><span class="tok-o">);</span> <i class="conum" data-value="1"></i><b>(1)</b>
<span class="tok-n">WebTarget</span> <span class="tok-n">saludo</span> <span class="tok-o">=</span> <span class="tok-n">base</span><span class="tok-o">.</span><span class="tok-na">path</span><span class="tok-o">(</span><span class="tok-s">&quot;hola&quot;</span><span class="tok-o">).</span><span class="tok-na">path</span><span class="tok-o">(</span><span class="tok-s">&quot;{quien}&quot;</span><span class="tok-o">);</span> <i class="conum" data-value="2"></i><b>(2)</b>
<span class="tok-n">Response</span> <span class="tok-n">res</span> <span class="tok-o">=</span> <span class="tok-n">saludo</span><span class="tok-o">.</span><span class="tok-na">resolveTemplate</span><span class="tok-o">(</span><span class="tok-s">&quot;quien&quot;</span><span class="tok-o">,</span> <span class="tok-s">&quot;mundo&quot;</span><span class="tok-o">).</span><span class="tok-na">request</span><span class="tok-o">().</span><span class="tok-na">get</span><span class="tok-o">();</span></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td><code>base</code> representa la URI: <code><a href="http://expertojava.org" class="bare">http://expertojava.org</a></code></td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td><code>saludo</code> representa la URI: <code><a href="http://expertojava/hola/%7Bquien%7D" class="bare">http://expertojava/hola/{quien}</a></code></td>
</tr>
</table>
</div>
<div class="paragraph">
<p>En el siguiente ejemplo, utilizamos una URI base, y a partir de ella
construimos otras URIs que representan servicios diferentes proporcionados por
nuestro recurso REST.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span class="tok-n">Client</span> <span class="tok-n">cli</span> <span class="tok-o">=</span> <span class="tok-n">ClientBuilder</span><span class="tok-o">.</span><span class="tok-na">newClient</span><span class="tok-o">();</span>
<span class="tok-n">WebTarget</span> <span class="tok-n">base</span> <span class="tok-o">=</span> <span class="tok-n">client</span><span class="tok-o">.</span><span class="tok-na">target</span><span class="tok-o">(</span><span class="tok-s">&quot;http://ejemplo/webapi&quot;</span><span class="tok-o">);</span>
<span class="tok-n">WebTarget</span> <span class="tok-n">lectura</span> <span class="tok-o">=</span> <span class="tok-n">base</span><span class="tok-o">.</span><span class="tok-na">path</span><span class="tok-o">(</span><span class="tok-s">&quot;leer&quot;</span><span class="tok-o">);</span> <i class="conum" data-value="1"></i><b>(1)</b>
<span class="tok-n">WebTarget</span> <span class="tok-n">escritura</span> <span class="tok-o">=</span> <span class="tok-n">base</span><span class="tok-o">.</span><span class="tok-na">path</span><span class="tok-o">(</span><span class="tok-s">&quot;escribir&quot;</span><span class="tok-o">);</span> <i class="conum" data-value="2"></i><b>(2)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td><code>lectura</code> representa la uri: <code><a href="http://ejemplo/webapi/leer" class="bare">http://ejemplo/webapi/leer</a></code></td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td><code>escritura</code> representa la uri: <code><a href="http://ejemplo/webapi/escribir" class="bare">http://ejemplo/webapi/escribir</a></code></td>
</tr>
</table>
</div>
<div class="paragraph">
<p>El método <code>WebTarget.path()</code> crea una nueva instancia de <code>WebTarget</code> añadiendo a la URI actual
el segmento de ruta que se pasa como parámetro.</p>
</div>
</div>
<div class="sect3">
<h4 id="_construimos_y_realizamos_la_petición">5.1.3. Construimos y Realizamos la petición</h4>
<div class="paragraph">
<p>Una vez que hemos creado y configurado convenientemente el <code>WebTarget</code>, que
 representa la URI que queremos invocar, tenemos que construir
la petición y finalmente realizarla.</p>
</div>
<div class="paragraph">
<p>Para <strong>construir la petición</strong> podemos Utilizar uno de los métodos <code>WebTarget.request()</code>,
que mostramos a continuación:</p>
</div>
<div class="listingblock">
<div class="title">Interfaz WebTarget: métodos para comenzar a construir la petición</div>
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span class="tok-kd">public</span> <span class="tok-kd">interface</span> <span class="tok-nc">WebTarget</span> <span class="tok-kd">extends</span> <span class="tok-n">Configurable</span><span class="tok-o">&lt;</span><span class="tok-n">WebTarget</span><span class="tok-o">&gt;</span> <span class="tok-o">{</span>
  <span class="tok-o">...</span>
  <span class="tok-kd">public</span> <span class="tok-n">Invocation</span><span class="tok-o">.</span><span class="tok-na">Builder</span> <span class="tok-nf">request</span><span class="tok-o">();</span>
  <span class="tok-kd">public</span> <span class="tok-n">Invocation</span><span class="tok-o">.</span><span class="tok-na">Builder</span> <span class="tok-nf">request</span><span class="tok-o">(</span><span class="tok-n">String</span><span class="tok-o">...</span> <span class="tok-n">acceptedResponseTypes</span><span class="tok-o">);</span>
  <span class="tok-kd">public</span> <span class="tok-n">Invocation</span><span class="tok-o">.</span><span class="tok-na">Builder</span> <span class="tok-nf">request</span><span class="tok-o">(</span><span class="tok-n">MediaType</span><span class="tok-o">...</span> <span class="tok-n">acceptedResponseTypes</span><span class="tok-o">);</span>
<span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Normalmente invocaremos <code>WebTarget.request()</code> pasando como parámetro el <code>media type</code>
aceptado como respuesta, en forma de <code>String</code> o utilizando una de las constantes de
<code>javax.ws.rs.core.MediaType</code>. Los métodos <code>WebTarget.request()</code> devuelven una instancia
de <code>Invocation.Builder</code>, una interfaz que proporciona métodos para preparar la
petición del cliente y también para invocarla.</p>
</div>
<div class="paragraph">
<p>La interface <em>Invocation.Builder</em> Contiene un conjunto de métodos que nos permiten construir
diferentes tipos de cabeceras de peticiones. Así, por ejemplo, proporciona varios métodos
<code>acceptXXX()</code> para indicar diferentes tipos MIME, lenguajes, o "encoding" aceptados.
También proporciona métodos <code>cookie()</code> para especificar <em>cookies</em> para enviar al
servidor. Finalmente proporciona métodos <code>header()</code> para especificar diferentes valores
de cabeceras.</p>
</div>
<div class="paragraph">
<p>Ejemplos de uso de esta interfaz para construir la petición:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span class="tok-n">Client</span> <span class="tok-n">cli</span> <span class="tok-o">=</span> <span class="tok-n">ClientBuilder</span><span class="tok-o">.</span><span class="tok-na">newClient</span><span class="tok-o">();</span>
<span class="tok-n">cli</span><span class="tok-o">.</span><span class="tok-na">invocation</span><span class="tok-o">(</span><span class="tok-n">Link</span><span class="tok-o">.</span><span class="tok-na">valueOf</span><span class="tok-o">(</span><span class="tok-s">&quot;http://ejemplo/rest&quot;</span><span class="tok-o">)).</span><span class="tok-na">accept</span><span class="tok-o">(</span><span class="tok-s">&quot;application/json&quot;</span><span class="tok-o">).</span><span class="tok-na">get</span><span class="tok-o">();</span>
<span class="tok-c1">//si no utilizamos el método invocation, podemos hacerlo así:</span>
<span class="tok-n">cli</span><span class="tok-o">.</span><span class="tok-na">target</span><span class="tok-o">(</span><span class="tok-s">&quot;http://ejemplo/rest&quot;</span><span class="tok-o">).</span><span class="tok-na">request</span><span class="tok-o">(</span><span class="tok-s">&quot;application/json&quot;</span><span class="tok-o">).</span><span class="tok-na">get</span><span class="tok-o">();</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span class="tok-n">Client</span> <span class="tok-n">cliente</span> <span class="tok-o">=</span> <span class="tok-n">ClientBuilder</span><span class="tok-o">.</span><span class="tok-na">newClient</span><span class="tok-o">();</span>
<span class="tok-n">WebTarget</span> <span class="tok-n">miRecurso</span> <span class="tok-o">=</span> <span class="tok-n">client</span><span class="tok-o">.</span><span class="tok-na">target</span><span class="tok-o">(</span><span class="tok-s">&quot;http://ejemplo/webapi/mensaje&quot;</span><span class="tok-o">)</span>
 <span class="tok-o">.</span><span class="tok-na">request</span><span class="tok-o">(</span><span class="tok-n">MediaType</span><span class="tok-o">.</span><span class="tok-na">TEXT_PLAIN</span><span class="tok-o">);</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>El uso de una constante <code>MediaType</code> es equivalente a utilizar el <code>String</code> que define
el tipo MIME:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span class="tok-n">Invocation</span><span class="tok-o">.</span><span class="tok-na">Builder</span> <span class="tok-n">builder</span> <span class="tok-o">=</span> <span class="tok-n">miRecurso</span><span class="tok-o">.</span><span class="tok-na">request</span><span class="tok-o">(</span><span class="tok-s">&quot;text/plain&quot;</span><span class="tok-o">);</span></code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Hemos visto que <em>WebTarget</em> implementa métodos <em>request()</em> cuyos parámetros especifican
el tipo MIME de la cabecera <em>Accept</em> de la petición. El código puede resultar más "legible"
si usamos en su lugar el método <em>Invocation.Builder.accept()</em>. En cualquier caso es una
cuestión de gustos personales.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Después de determinar el <em>media type</em> de la respuesta, <strong>invocamos la petición</strong> realizando
una llamada a uno de los métodos de la instancia de <code>Invocation.Builder</code> que se
corresponde con el tipo de petición HTTP esperado por el recurso REST, al que va dirigido
dicha petición. Estos métodos son:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>get()</code></p>
</li>
<li>
<p><code>post()</code></p>
</li>
<li>
<p><code>delete()</code></p>
</li>
<li>
<p><code>put()</code></p>
</li>
<li>
<p><code>head()</code></p>
</li>
<li>
<p><code>options()</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>La interfaz <em>Invocation.Builder</em> es una subinterfaz de la interfaz <em>SyncInvoker</em>, y es la
que especifica los métodos anteriores (get, post, &#8230;&#8203;) para realizar peticiones
<strong>síncronas</strong>, es decir, que hasta que no nos conteste el servidor, no podremos
continuar procesando el código en la parte del cliente.</p>
</div>
<div class="paragraph">
<p>Las peticiones <strong>GET</strong> tienen los siguientes prototipos:</p>
</div>
<div class="listingblock">
<div class="title">Interface SyncInvoker: peticiones GET síncronas</div>
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span class="tok-kd">public</span> <span class="tok-kd">interface</span> <span class="tok-nc">SyncInvoker</span> <span class="tok-o">{</span>
  <span class="tok-o">...</span>
  <span class="tok-o">&lt;</span><span class="tok-n">T</span><span class="tok-o">&gt;</span> <span class="tok-n">T</span> <span class="tok-nf">get</span><span class="tok-o">(</span><span class="tok-n">Class</span><span class="tok-o">&lt;</span><span class="tok-n">T</span><span class="tok-o">&gt;</span> <span class="tok-n">responseType</span><span class="tok-o">);</span>
  <span class="tok-o">&lt;</span><span class="tok-n">T</span><span class="tok-o">&gt;</span> <span class="tok-n">T</span> <span class="tok-nf">get</span><span class="tok-o">(</span><span class="tok-n">GenericType</span><span class="tok-o">&lt;</span><span class="tok-n">T</span><span class="tok-o">&gt;</span> <span class="tok-n">responseType</span><span class="tok-o">);</span>
  <span class="tok-n">Response</span> <span class="tok-nf">get</span><span class="tok-o">();</span>
  <span class="tok-o">...</span>
<span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Los primeros dos métodos genéricos convertirán una respuesta HTTP con éxito a tipos
Java específicos indicados como parámetros del método.
El tercero devuelve una instancia de tipo <em>Response</em>. Por ejemplo:</p>
</div>
<div class="listingblock">
<div class="title">Ejemplos de peticiones GET utilizando el API cliente jasx-rx 2.0</div>
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span class="tok-n">Client</span> <span class="tok-n">cli</span> <span class="tok-o">=</span> <span class="tok-n">ClientBuilder</span><span class="tok-o">.</span><span class="tok-na">newClient</span><span class="tok-o">();</span>

<span class="tok-c1">//petición get que devuelve una instancia de Cliente</span>
<span class="tok-n">Cliente</span> <span class="tok-n">cliRespuesta</span> <span class="tok-o">=</span> <span class="tok-n">cli</span><span class="tok-o">.</span><span class="tok-na">target</span><span class="tok-o">(</span><span class="tok-s">&quot;http://ejemplo/clientes/123&quot;</span><span class="tok-o">)</span>
                          <span class="tok-o">.</span><span class="tok-na">request</span><span class="tok-o">(</span><span class="tok-s">&quot;application/json&quot;</span><span class="tok-o">)</span>
                          <span class="tok-o">.</span><span class="tok-na">get</span><span class="tok-o">(</span><span class="tok-n">Cliente</span><span class="tok-o">.</span><span class="tok-na">class</span><span class="tok-o">);</span> <i class="conum" data-value="1"></i><b>(1)</b>

<span class="tok-c1">//petición get que devuelve una lista de objetos Cliente</span>
<span class="tok-n">List</span><span class="tok-o">&lt;</span><span class="tok-n">Cliente</span><span class="tok-o">&gt;</span> <span class="tok-n">cliRespuesta2</span> <span class="tok-o">=</span>
                 <span class="tok-n">cli</span><span class="tok-o">.</span><span class="tok-na">target</span><span class="tok-o">(</span><span class="tok-s">&quot;http://ejemplo/clientes&quot;</span><span class="tok-o">)</span>
                    <span class="tok-o">.</span><span class="tok-na">request</span><span class="tok-o">(</span><span class="tok-s">&quot;application/xml&quot;</span><span class="tok-o">)</span>
                    <span class="tok-o">.</span><span class="tok-na">get</span><span class="tok-o">(</span><span class="tok-k">new</span> <span class="tok-n">GenericType</span><span class="tok-o">&lt;</span><span class="tok-n">List</span><span class="tok-o">&lt;</span><span class="tok-n">Cliente</span><span class="tok-o">&gt;&gt;()</span> <span class="tok-o">{});</span> <i class="conum" data-value="2"></i><b>(2)</b>

<span class="tok-c1">//petición get que devuelve un objeto de tipo Response</span>
<span class="tok-n">Response</span> <span class="tok-n">respuesta</span> <span class="tok-o">=</span>
              <span class="tok-n">cli</span><span class="tok-o">.</span><span class="tok-na">target</span><span class="tok-o">(</span><span class="tok-s">&quot;http://ejemplo/clientes/245&quot;</span><span class="tok-o">)</span>
                 <span class="tok-o">.</span><span class="tok-na">request</span><span class="tok-o">(</span><span class="tok-s">&quot;application/json&quot;</span><span class="tok-o">)</span>
                 <span class="tok-o">.</span><span class="tok-na">get</span><span class="tok-o">();</span>  <i class="conum" data-value="3"></i><b>(3)</b>
<span class="tok-k">try</span> <span class="tok-o">{</span>
  <span class="tok-k">if</span> <span class="tok-o">(</span><span class="tok-n">respuesta</span><span class="tok-o">.</span><span class="tok-na">getStatus</span><span class="tok-o">()</span> <span class="tok-o">==</span> <span class="tok-mi">200</span><span class="tok-o">)</span> <span class="tok-o">{</span>
     <span class="tok-n">Cliente</span> <span class="tok-n">cliRespuesta</span> <span class="tok-o">=</span>
                <span class="tok-n">respuesta</span><span class="tok-o">.</span><span class="tok-na">readEntity</span><span class="tok-o">(</span><span class="tok-n">Cliente</span><span class="tok-o">.</span><span class="tok-na">class</span><span class="tok-o">);</span> <i class="conum" data-value="4"></i><b>(4)</b>
  <span class="tok-o">}</span>
<span class="tok-o">}</span> <span class="tok-k">finally</span> <span class="tok-o">{</span>
    <span class="tok-n">respuesta</span><span class="tok-o">.</span><span class="tok-na">close</span><span class="tok-o">();</span>
<span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>En la primera petición queremos que el servidor nos devuelva la respuesta en
formato JSON, y posteriormente la convertiremos en el tipo <code>Cliente</code> utilizando un
de los componentes <code>MessageBodyReader</code> registrados.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>En la segunda petición utilizamos la clase <code>javax.ws.rs.core.GenericType</code> para
informar al correspondiente <code>MessageBodyReader</code> del tipo de objetos de nuestra Lista.
Para ello creamos una clase anónima a la que le pasamos como parámetro el tipo
genérico que queremos obtener.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>En la tercera petición obtenemos una instancia de <em>Response</em>, a partir de la
cual podemos obtener el cuerpo del mensaje de respuesta del servidor</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>El método <em>readEntity()</em> asocia el tipo Java solicitado (en este caso el tipo java <em>Cliente</em>)
y el contenido de la respuesta recibida con el correspondiente proveedor de entidades
(de tipo <em>MessageBodyReader</em>) para obtener dicho tipo Java a partir de la respuesta HTTP
recibida.
￼
En sesiones anteriores hemos utilizado la clase Response desde el servicio REST, para
construir la respuesta que se envía al cliente.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Recordemos algunos de los métodos que podemos utilizar desde el cliente para analizar
la respuesta que hemos obtenido:</p>
</div>
<div class="listingblock">
<div class="title">Métodos de la clase Response que utilizaremos desde el cliente</div>
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span class="tok-kd">public</span> <span class="tok-kd">abstract</span> <span class="tok-kd">class</span> <span class="tok-nc">Response</span> <span class="tok-o">{</span>
  <span class="tok-kd">public</span> <span class="tok-kd">abstract</span> <span class="tok-n">Object</span> <span class="tok-nf">getEntity</span><span class="tok-o">();</span>  <i class="conum" data-value="1"></i><b>(1)</b>
  <span class="tok-kd">public</span> <span class="tok-kd">abstract</span> <span class="tok-kt">int</span> <span class="tok-nf">getStatus</span><span class="tok-o">();</span>  <i class="conum" data-value="2"></i><b>(2)</b>
  <span class="tok-kd">public</span> <span class="tok-kd">abstract</span> <span class="tok-n">Response</span><span class="tok-o">.</span><span class="tok-na">StatusType</span> <span class="tok-nf">getStatusInfo</span><span class="tok-o">()</span> <i class="conum" data-value="3"></i><b>(3)</b>
  <span class="tok-kd">public</span> <span class="tok-kd">abstract</span> <span class="tok-n">MultivaluedMap</span><span class="tok-o">&lt;</span><span class="tok-n">String</span><span class="tok-o">,</span> <span class="tok-n">Object</span><span class="tok-o">&gt;</span> <span class="tok-nf">getMetadata</span><span class="tok-o">();</span>  <i class="conum" data-value="4"></i><b>(4)</b>
  <span class="tok-kd">public</span> <span class="tok-kd">abstract</span> <span class="tok-n">URI</span> <span class="tok-nf">getLocation</span><span class="tok-o">();</span>  <i class="conum" data-value="5"></i><b>(5)</b>
  <span class="tok-kd">public</span> <span class="tok-kd">abstract</span> <span class="tok-n">MediaType</span> <span class="tok-nf">getMediaType</span><span class="tok-o">();</span>  <i class="conum" data-value="6"></i><b>(6)</b>
  <span class="tok-kd">public</span> <span class="tok-n">MultivaluedMap</span><span class="tok-o">&lt;</span><span class="tok-n">String</span><span class="tok-o">,</span><span class="tok-n">Object</span><span class="tok-o">&gt;</span> <span class="tok-nf">getHeaders</span><span class="tok-o">();</span> <i class="conum" data-value="7"></i><b>(7)</b>
  <span class="tok-kd">public</span> <span class="tok-kd">abstract</span> <span class="tok-o">&lt;</span><span class="tok-n">T</span><span class="tok-o">&gt;</span> <span class="tok-n">T</span> <span class="tok-nf">readEntity</span><span class="tok-o">(</span><span class="tok-n">Class</span><span class="tok-o">&lt;</span><span class="tok-n">T</span><span class="tok-o">&gt;</span> <span class="tok-n">entityType</span><span class="tok-o">);</span> <i class="conum" data-value="8"></i><b>(8)</b>
  <span class="tok-kd">public</span> <span class="tok-kd">abstract</span> <span class="tok-o">&lt;</span><span class="tok-n">T</span><span class="tok-o">&gt;</span> <span class="tok-n">T</span> <span class="tok-nf">readEntity</span><span class="tok-o">(</span><span class="tok-n">GenericType</span><span class="tok-o">&lt;</span><span class="tok-n">T</span><span class="tok-o">&gt;</span> <span class="tok-n">entityType</span><span class="tok-o">);</span> <i class="conum" data-value="9"></i><b>(9)</b>
  <span class="tok-kd">public</span> <span class="tok-kd">abstract</span> <span class="tok-kt">void</span> <span class="tok-nf">close</span><span class="tok-o">();</span> <i class="conum" data-value="10"></i><b>(10)</b>
   <span class="tok-o">...</span>
<span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>El método <code>getEntity()</code> devuelve el objeto Java correspondiente al cuerpo
del mensaje HTTP.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>El método <code>getStatus()</code> devuelve el código de respuesta HTTP.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>El método <code>getStatusInfo()</code> devuelve la información de estado asociada con la respuesta.</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>El método <code>getMetadata()</code> devuelve una instancia de tipo <code>MultivaluedMap</code> con las
cabeceras de la respuesta.</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>El método <code>getLocation()</code> devuelve la URI de la cabecera Location de la respuesta.</td>
</tr>
<tr>
<td><i class="conum" data-value="6"></i><b>6</b></td>
<td>El método <code>getMediaType()</code> devuelve el <em>mediaType</em> del cuerpo de la respuesta</td>
</tr>
<tr>
<td><i class="conum" data-value="7"></i><b>7</b></td>
<td>El método <code>getHeaders()</code> devuelve las cabeceras de respuesta con sus valores correspondientes.</td>
</tr>
<tr>
<td><i class="conum" data-value="8"></i><b>8</b></td>
<td>El método <code>readEntity()</code> devuelve la entidad del cuerpo del mensaje utilizando un
<em>MessageBodyReader</em> que soporte el mapeado del <em>inputStream</em> de la entidad a la clase
Java especificada como parámetro.</td>
</tr>
<tr>
<td><i class="conum" data-value="9"></i><b>9</b></td>
<td>El método <code>readEntity()</code> también puede devolver una clase genérica si se dispone del
<em>MessageBodyReader</em> correspondiente.</td>
</tr>
<tr>
<td><i class="conum" data-value="10"></i><b>10</b></td>
<td>El método <code>close()</code> cierra el <em>input stream</em> correspondiente a la entidad asociada
del cuerpo del mensaje (en el caso de que esté disponible y "abierto"). También libera
cualquier otro recurso asociado con la respuesta (como por ejemplo datos posiblemente
almacenados en un <em>buffer</em>).</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Veamos otro ejemmplo. Si el recurso REST espera una petición HTTP GET, invocaremos el método
<code>Invocation.Builder.get()</code>. El tipo de retorno del método debería corresponderse con
la entidad devuelta por el recurso REST que atenderá la petición.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span class="tok-n">Client</span> <span class="tok-n">cliente</span> <span class="tok-o">=</span> <span class="tok-n">ClientBuilder</span><span class="tok-o">.</span><span class="tok-na">newClient</span><span class="tok-o">();</span>
<span class="tok-n">WebTarget</span> <span class="tok-n">miRecurso</span> <span class="tok-o">=</span> <span class="tok-n">cliente</span><span class="tok-o">.</span><span class="tok-na">target</span><span class="tok-o">(</span><span class="tok-s">&quot;http://ejemplo/webapi/lectura&quot;</span><span class="tok-o">);</span>
<span class="tok-n">String</span> <span class="tok-n">respuesta</span> <span class="tok-o">=</span> <span class="tok-n">miRecurso</span><span class="tok-o">.</span><span class="tok-na">request</span><span class="tok-o">(</span><span class="tok-n">MediaType</span><span class="tok-o">.</span><span class="tok-na">TEXT_PLAIN</span><span class="tok-o">)</span>
                            <span class="tok-o">.</span><span class="tok-na">get</span><span class="tok-o">(</span><span class="tok-n">String</span><span class="tok-o">.</span><span class="tok-na">class</span><span class="tok-o">);</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>O también podríamos codificarlo como:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span class="tok-n">Client</span> <span class="tok-n">cliente</span> <span class="tok-o">=</span> <span class="tok-n">ClientBuilder</span><span class="tok-o">.</span><span class="tok-na">newClient</span><span class="tok-o">();</span>
<span class="tok-n">String</span> <span class="tok-n">respuesta</span> <span class="tok-o">=</span> <span class="tok-n">cliente</span>
                     <span class="tok-o">.</span><span class="tok-na">target</span><span class="tok-o">(</span><span class="tok-s">&quot;http://ejemplo/webapi/lectura&quot;</span><span class="tok-o">)</span>
                     <span class="tok-o">.</span><span class="tok-na">request</span><span class="tok-o">(</span><span class="tok-n">MediaType</span><span class="tok-o">.</span><span class="tok-na">TEXT_PLAIN</span><span class="tok-o">)</span>
                     <span class="tok-o">.</span><span class="tok-na">get</span><span class="tok-o">(</span><span class="tok-n">String</span><span class="tok-o">.</span><span class="tok-na">class</span><span class="tok-o">);</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Si el tipo de retorno de la petición GET es una colección, usaremos <code>javax.ws.rs.core.GenericType&lt;T&gt;</code>
como parámetro del método, en donde <code>T</code> es el tipo de la colección:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span class="tok-n">List</span><span class="tok-o">&lt;</span><span class="tok-n">PedidoAlmacen</span><span class="tok-o">&gt;</span> <span class="tok-n">pedidos</span> <span class="tok-o">=</span> <span class="tok-n">client</span>
                              <span class="tok-o">.</span><span class="tok-na">target</span><span class="tok-o">(</span><span class="tok-s">&quot;http://ejemplo/webapi/lectura&quot;</span><span class="tok-o">)</span>
                              <span class="tok-o">.</span><span class="tok-na">path</span><span class="tok-o">(</span><span class="tok-s">&quot;pedidos&quot;</span><span class="tok-o">)</span>
                              <span class="tok-o">.</span><span class="tok-na">request</span><span class="tok-o">(</span><span class="tok-n">MediaType</span><span class="tok-o">.</span><span class="tok-na">APPLICATION_XML</span><span class="tok-o">)</span>
                              <span class="tok-o">.</span><span class="tok-na">get</span><span class="tok-o">(</span><span class="tok-k">new</span> <span class="tok-n">GenericType</span><span class="tok-o">&lt;</span><span class="tok-n">List</span><span class="tok-o">&lt;</span><span class="tok-n">PedidoAlmacen</span><span class="tok-o">&gt;&gt;()</span> <span class="tok-o">{});</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Si el recurso REST destinatario de la petición espera una petición de tipo HTTP POST,
invocaremos el método <code>Invocation.Builder.post()</code>.</p>
</div>
<div class="paragraph">
<p>Las peticiones <strong>POST</strong> tienen los siguientes prototipos:</p>
</div>
<div class="listingblock">
<div class="title">Interface SyncInvoker: peticiones POST síncronas</div>
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span class="tok-kd">public</span> <span class="tok-kd">interface</span> <span class="tok-nc">SyncInvoker</span> <span class="tok-o">{</span>
  <span class="tok-o">...</span>
  <span class="tok-o">&lt;</span><span class="tok-n">T</span><span class="tok-o">&gt;</span> <span class="tok-n">T</span> <span class="tok-nf">post</span><span class="tok-o">(</span><span class="tok-n">Entity</span><span class="tok-o">&lt;?&gt;</span> <span class="tok-n">entity</span><span class="tok-o">,</span> <span class="tok-n">Class</span><span class="tok-o">&lt;</span><span class="tok-n">T</span><span class="tok-o">&gt;</span> <span class="tok-n">responseType</span><span class="tok-o">);</span>
  <span class="tok-o">&lt;</span><span class="tok-n">T</span><span class="tok-o">&gt;</span> <span class="tok-n">T</span> <span class="tok-nf">post</span><span class="tok-o">(</span><span class="tok-n">Entity</span><span class="tok-o">&lt;?&gt;</span> <span class="tok-n">entity</span><span class="tok-o">,</span> <span class="tok-n">GenericType</span><span class="tok-o">&lt;</span><span class="tok-n">T</span><span class="tok-o">&gt;</span> <span class="tok-n">responseType</span><span class="tok-o">)</span>
  <span class="tok-n">Response</span> <span class="tok-nf">post</span><span class="tok-o">(</span><span class="tok-n">Entity</span><span class="tok-o">&lt;?&gt;</span> <span class="tok-n">entity</span><span class="tok-o">);</span>
  <span class="tok-o">...</span>
<span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Los primeros dos métodos genéricos envían una entidad (clase java + tipo MIME asociado),
indicada como primer parámetro del método, y como segundo parámetro se indica el tipo java
al que se convertirá la respuesta recibida. El tercero envía una entidad y devuelve
una instancia de tipo <em>Response</em>. Por ejemplo:</p>
</div>
<div class="paragraph">
<p>Veamos un ejemplo de invocación de peticiones POST.</p>
</div>
<div class="listingblock">
<div class="title">Ejemplo de petición POST utilizando el API cliente jasx-rx 2.0</div>
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span class="tok-n">Client</span> <span class="tok-n">cli</span> <span class="tok-o">=</span> <span class="tok-n">ClientBuilder</span><span class="tok-o">.</span><span class="tok-na">newClient</span><span class="tok-o">();</span>
<span class="tok-n">Pedido</span> <span class="tok-n">pe</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-nf">PedidoAlmacen</span><span class="tok-o">(...);</span>
<span class="tok-n">Pedido</span> <span class="tok-n">peRespuesta</span> <span class="tok-o">=</span> <span class="tok-n">cli</span>
            <span class="tok-o">.</span><span class="tok-na">target</span><span class="tok-o">(...)</span>
            <span class="tok-o">.</span><span class="tok-na">request</span><span class="tok-o">()</span>
            <span class="tok-o">.</span><span class="tok-na">post</span><span class="tok-o">(</span><span class="tok-n">Entity</span><span class="tok-o">.</span><span class="tok-na">entity</span><span class="tok-o">(</span><span class="tok-k">new</span> <span class="tok-nf">Pedido</span><span class="tok-o">(),</span> <span class="tok-s">&quot;application/json&quot;</span><span class="tok-o">),</span>
                  <span class="tok-n">Pedido</span><span class="tok-o">.</span><span class="tok-na">class</span><span class="tok-o">);</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>En este caso estamos realizando una petición POST. Como <em>payload</em> del mensaje
enviamos un objeto <em>Pedido</em> representado en formato json. La entidad esperada como
respuesta debe ser de tipo Pedido.</p>
</div>
<div class="paragraph">
<p>Esto implica que en el lado del servidor, el método que atiende la petición @Post
tendrá un parámetro de tipo Pedido y se deberán serializar los objetos de tipo
Pedido a json, ya que es el tipo MIME asociado a esta entidad (
especificado en la cabera <em>Content-Type</em> de la petición HTTP).</p>
</div>
<div class="paragraph">
<p>La clase <em>Entity</em> encapsula los objetos Java que queremos enviar con las peticiones
GET o POST. No tiene un constructor público. En su lugar tenemos que invocar uno de
sus métodos estáticos:</p>
</div>
<div class="listingblock">
<div class="title">Clase javax.ws.rs.client.Entity</div>
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span class="tok-kd">public</span> <span class="tok-kd">final</span> <span class="tok-kd">class</span> <span class="tok-nc">Entity</span><span class="tok-o">&lt;</span><span class="tok-n">T</span><span class="tok-o">&gt;</span> <span class="tok-o">{</span>
   <span class="tok-o">...</span>
   <span class="tok-kd">public</span> <span class="tok-kd">static</span> <span class="tok-o">&lt;</span><span class="tok-n">T</span><span class="tok-o">&gt;</span> <span class="tok-n">Entity</span><span class="tok-o">&lt;</span><span class="tok-n">T</span><span class="tok-o">&gt;</span> <span class="tok-nf">entity</span><span class="tok-o">(</span><span class="tok-n">T</span> <span class="tok-n">entity</span><span class="tok-o">,</span> <span class="tok-n">String</span> <span class="tok-n">mediaType</span><span class="tok-o">)</span> <i class="conum" data-value="1"></i><b>(1)</b>
   <span class="tok-kd">public</span> <span class="tok-kd">static</span> <span class="tok-o">&lt;</span><span class="tok-n">T</span><span class="tok-o">&gt;</span> <span class="tok-n">Entity</span><span class="tok-o">&lt;</span><span class="tok-n">T</span><span class="tok-o">&gt;</span> <span class="tok-nf">entity</span><span class="tok-o">(</span><span class="tok-n">T</span> <span class="tok-n">entity</span><span class="tok-o">,</span> <span class="tok-n">MediaType</span> <span class="tok-n">mediaType</span><span class="tok-o">)</span> <i class="conum" data-value="2"></i><b>(2)</b>
   <span class="tok-kd">public</span> <span class="tok-kd">static</span> <span class="tok-o">&lt;</span><span class="tok-n">T</span><span class="tok-o">&gt;</span> <span class="tok-n">Entity</span><span class="tok-o">&lt;</span><span class="tok-n">T</span><span class="tok-o">&gt;</span> <span class="tok-nf">xml</span><span class="tok-o">(</span><span class="tok-kd">final</span> <span class="tok-n">T</span> <span class="tok-n">entity</span><span class="tok-o">)</span> <span class="tok-o">{</span> <span class="tok-o">}</span> <i class="conum" data-value="3"></i><b>(3)</b>
   <span class="tok-kd">public</span> <span class="tok-kd">static</span> <span class="tok-o">&lt;</span><span class="tok-n">T</span><span class="tok-o">&gt;</span> <span class="tok-n">Entity</span><span class="tok-o">&lt;</span><span class="tok-n">T</span><span class="tok-o">&gt;</span> <span class="tok-nf">json</span><span class="tok-o">(</span><span class="tok-kd">final</span> <span class="tok-n">T</span> <span class="tok-n">entity</span><span class="tok-o">)</span> <span class="tok-o">{</span> <span class="tok-o">}</span> <i class="conum" data-value="4"></i><b>(4)</b>
   <span class="tok-kd">public</span> <span class="tok-kd">static</span> <span class="tok-o">&lt;</span><span class="tok-n">T</span><span class="tok-o">&gt;</span> <span class="tok-n">Entity</span><span class="tok-o">&lt;</span><span class="tok-n">T</span><span class="tok-o">&gt;</span> <span class="tok-nf">text</span><span class="tok-o">(</span><span class="tok-n">T</span> <span class="tok-n">entity</span><span class="tok-o">)</span> <span class="tok-o">{</span> <span class="tok-o">}</span> <i class="conum" data-value="5"></i><b>(5)</b>
   <span class="tok-kd">public</span> <span class="tok-kd">static</span> <span class="tok-n">Entity</span><span class="tok-o">&lt;</span><span class="tok-n">Form</span><span class="tok-o">&gt;</span> <span class="tok-nf">form</span><span class="tok-o">(</span><span class="tok-kd">final</span> <span class="tok-n">Form</span> <span class="tok-n">form</span><span class="tok-o">)</span> <span class="tok-o">{</span> <span class="tok-o">}</span> <i class="conum" data-value="6"></i><b>(6)</b>
   <span class="tok-o">...</span>
<span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>El método estático <em>entity()</em> crea una entidad (clase Java) con un tipo MIME
asociado dado por la cadena de caracteres <em>mediaType</em></td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>El método estático <em>entity()</em> crea una entidad (clase Java) con un tipo MIME
indicado en <em>mediaType</em></td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>El método <em>xml</em> crea una entidad (clase Java) con el tipo MIME "application/xml"</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>El método <em>json</em> crea una entidad (clase Java) con el tipo MIME "application/jsom"</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>El método <em>text</em> crea una entidad (clase Java) con el tipo MIME "text/plain"</td>
</tr>
<tr>
<td><i class="conum" data-value="6"></i><b>6</b></td>
<td>El método <em>form</em> crea una entidad (clase Java) con el tipo MIME "application/x-www-form-urlencoded"</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Veamos otro ejemplo de invocación POST que utiliza la clase <em>Entity</em>:</p>
</div>
<div class="listingblock">
<div class="title">Ejemplo de petición POST y uso de clase Entity</div>
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span class="tok-n">NumSeguimiento</span> <span class="tok-n">numSeg</span> <span class="tok-o">=</span> <span class="tok-n">client</span>
          <span class="tok-o">.</span><span class="tok-na">target</span><span class="tok-o">(</span><span class="tok-s">&quot;http://ejemplo/webapi/escritura&quot;</span><span class="tok-o">)</span>
          <span class="tok-o">.</span><span class="tok-na">request</span><span class="tok-o">(</span><span class="tok-n">MediaType</span><span class="tok-o">.</span><span class="tok-na">APPLICATION_XML</span><span class="tok-o">)</span>  <i class="conum" data-value="1"></i><b>(1)</b>
          <span class="tok-o">.</span><span class="tok-na">post</span><span class="tok-o">(</span><span class="tok-n">Entity</span><span class="tok-o">.</span><span class="tok-na">xml</span><span class="tok-o">(</span><span class="tok-n">pedido</span><span class="tok-o">),</span> <span class="tok-n">NumeroSeguimiento</span><span class="tok-o">.</span><span class="tok-na">class</span><span class="tok-o">);</span> <i class="conum" data-value="2"></i><b>(2)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Especificamos como parámetro de la petición <em>request()</em> el
tipo MIME que aceptamos en la respuesta (cabecera HTTP <em>Accept</em>).</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Realizamos una petición POST. El cuerpo del mensaje se crea con la
llamada <code>Entity.xml(pedido)</code>. El tipo Entity encapsula la entidad del
mensaje (tipo Java <em>Pedido</em>) y el tipo MIME asociado (tipo MIME <em>application/xml</em>) .</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Veamos un ejemplo en el que enviamos parámetros de un formulario en una
 petición POST:</p>
</div>
<div class="listingblock">
<div class="title">Ejemplo de envío de datos de un formulario en una petición POST</div>
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span class="tok-n">Form</span> <span class="tok-n">form</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-nf">Form</span><span class="tok-o">().</span><span class="tok-na">param</span><span class="tok-o">(</span><span class="tok-s">&quot;nombre&quot;</span><span class="tok-o">,</span> <span class="tok-s">&quot;Pedro&quot;</span><span class="tok-o">)</span>
                      <span class="tok-o">.</span><span class="tok-na">param</span><span class="tok-o">(</span><span class="tok-s">&quot;apellido&quot;</span><span class="tok-o">,</span> <span class="tok-s">&quot;Garcia&quot;</span><span class="tok-o">);</span>
<span class="tok-o">...</span>
<span class="tok-n">Response</span> <span class="tok-n">response</span> <span class="tok-o">=</span> <span class="tok-n">client</span><span class="tok-o">.</span><span class="tok-na">target</span><span class="tok-o">(</span><span class="tok-s">&quot;http://ejemplo/clientes&quot;</span><span class="tok-o">)</span>
                    <span class="tok-o">.</span><span class="tok-na">request</span><span class="tok-o">().</span>
                    <span class="tok-o">.</span><span class="tok-na">post</span><span class="tok-o">(</span><span class="tok-n">Entity</span><span class="tok-o">.</span><span class="tok-na">form</span><span class="tok-o">(</span><span class="tok-n">form</span><span class="tok-o">));</span>
<span class="tok-n">response</span><span class="tok-o">.</span><span class="tok-na">close</span><span class="tok-o">();</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>La petición POST del código anterior envía los datos del formulario, y espera
recibir como respuesta una entidad de tipo <em>Response</em>.</p>
</div>
<div class="paragraph">
<p>El código en el lado del servidor será similar a éste:</p>
</div>
<div class="listingblock">
<div class="title">Servicio rest que sirve una petición POST a partir de datos de un formulario</div>
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span class="tok-o">...</span>
<span class="tok-nd">@POST</span>
<span class="tok-nd">@Path</span><span class="tok-o">(</span><span class="tok-s">&quot;/clientes&quot;</span><span class="tok-o">)</span>
<span class="tok-nd">@Produces</span><span class="tok-o">(</span><span class="tok-s">&quot;text/html&quot;</span><span class="tok-o">)</span>
<span class="tok-kd">public</span> <span class="tok-n">Response</span> <span class="tok-nf">crearCliente</span><span class="tok-o">(</span><span class="tok-nd">@FormParam</span><span class="tok-o">(</span><span class="tok-s">&quot;nombre&quot;</span><span class="tok-o">)</span><span class="tok-n">String</span> <span class="tok-n">nom</span><span class="tok-o">,</span>
            <span class="tok-nd">@FormParam</span><span class="tok-o">(</span><span class="tok-s">&quot;apellido&quot;</span><span class="tok-o">)</span><span class="tok-n">String</span> <span class="tok-n">ape</span><span class="tok-o">)</span>
<span class="tok-o">{</span>
    <span class="tok-o">...</span> <span class="tok-c1">//creamos el nuevo cliente</span>
    <span class="tok-k">return</span> <span class="tok-n">Response</span><span class="tok-o">.</span><span class="tok-na">ok</span><span class="tok-o">(</span><span class="tok-n">RESPONSE_OK</span><span class="tok-o">).</span><span class="tok-na">build</span><span class="tok-o">();</span>
<span class="tok-o">}</span></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_manejo_de_excepciones">5.1.4. Manejo de excepciones</h4>
<div class="paragraph">
<p>Veamos qué ocurre si se produce una excepción cuando utilizamos una forma de invocación que automáticamente
convierte la respuesta en el tipo especificado. Supongamos el siguiente ejemplo:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span class="tok-n">Cliente</span> <span class="tok-n">cli</span> <span class="tok-o">=</span> <span class="tok-n">client</span><span class="tok-o">.</span><span class="tok-na">target</span><span class="tok-o">(</span><span class="tok-s">&quot;http://tienda.com/clientes/123&quot;</span><span class="tok-o">)</span>
                    <span class="tok-o">.</span><span class="tok-na">request</span><span class="tok-o">(</span><span class="tok-s">&quot;application/json&quot;</span><span class="tok-o">)</span>
                    <span class="tok-o">.</span><span class="tok-na">get</span><span class="tok-o">(</span><span class="tok-n">Cliente</span><span class="tok-o">.</span><span class="tok-na">class</span><span class="tok-o">);</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>En este escenario, el <em>framework</em> del cliente convierte cualquier código de error
HTTP en una de las excepciones que añade JAX-RS 2.0 (BadRequesException, ForbiddenException&#8230;&#8203;)
y que ya hemos visto. Podemos capturar dichas excepciones en nuestro código para
tratarlas adecuadamente:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span class="tok-k">try</span> <span class="tok-o">{</span>
  <span class="tok-n">Cliente</span> <span class="tok-n">cli</span> <span class="tok-o">=</span> <span class="tok-n">client</span><span class="tok-o">.</span><span class="tok-na">target</span><span class="tok-o">(</span><span class="tok-s">&quot;http://tienda.com/clientes/123&quot;</span><span class="tok-o">)</span>
                      <span class="tok-o">.</span><span class="tok-na">request</span><span class="tok-o">(</span><span class="tok-s">&quot;application/json&quot;</span><span class="tok-o">)</span>
                      <span class="tok-o">.</span><span class="tok-na">get</span><span class="tok-o">(</span><span class="tok-n">Cliente</span><span class="tok-o">.</span><span class="tok-na">class</span><span class="tok-o">);</span>
<span class="tok-o">}</span> <span class="tok-k">catch</span> <span class="tok-o">(</span><span class="tok-n">NotAcceptableException</span> <span class="tok-n">notAcceptable</span><span class="tok-o">)</span> <span class="tok-o">{</span>
      <span class="tok-o">...</span>
<span class="tok-o">}</span> <span class="tok-k">catch</span> <span class="tok-o">(</span><span class="tok-n">NotFoundException</span> <span class="tok-n">notFound</span><span class="tok-o">)</span> <span class="tok-o">{</span>
      <span class="tok-o">...</span>
<span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Si el servidor responde con un error HTTP no cubierto por alguna excepción específica
JAX-RS, entonces se lanza una excepción de propósito general. La clase
<code>ClientErrorException</code> cubre cualquier código de error en la franja del 400.
La clase
<code>ServerErrorException</code> cubre cualquier código de error en la franja del 500.</p>
</div>
<div class="paragraph">
<p>Si el servidor envía alguna de los códigos de respuesta HTTP 3xx (clasificados como
códigos de la categoría <em>redirección</em>), el API cliente lanza una
 <code>RedirectionException</code>, a partir de la cual podemos obtener la URL para poder
 tratar la redirección nosotros mismos. Por ejemplo:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span class="tok-n">WebTarget</span> <span class="tok-n">target</span> <span class="tok-o">=</span> <span class="tok-n">client</span><span class="tok-o">.</span><span class="tok-na">target</span><span class="tok-o">(</span><span class="tok-s">&quot;http://tienda.com/clientes/123&quot;</span><span class="tok-o">);</span>
<span class="tok-kt">boolean</span> <span class="tok-n">redirected</span> <span class="tok-o">=</span> <span class="tok-kc">false</span><span class="tok-o">;</span>

<span class="tok-n">Cliente</span> <span class="tok-n">cli</span> <span class="tok-o">=</span> <span class="tok-kc">null</span><span class="tok-o">;</span>
<span class="tok-k">do</span> <span class="tok-o">{</span>
     <span class="tok-k">try</span> <span class="tok-o">{</span>
          <span class="tok-n">cli</span> <span class="tok-o">=</span> <span class="tok-n">target</span><span class="tok-o">.</span><span class="tok-na">request</span><span class="tok-o">(</span><span class="tok-s">&quot;application/json&quot;</span><span class="tok-o">)</span>
                      <span class="tok-o">.</span><span class="tok-na">get</span><span class="tok-o">(</span><span class="tok-n">Cliente</span><span class="tok-o">.</span><span class="tok-na">class</span><span class="tok-o">);</span>
     <span class="tok-o">}</span> <span class="tok-k">catch</span> <span class="tok-o">(</span><span class="tok-n">RedirectionException</span> <span class="tok-n">redirect</span><span class="tok-o">)</span> <span class="tok-o">{</span>
          <span class="tok-k">if</span> <span class="tok-o">(</span><span class="tok-n">redirected</span><span class="tok-o">)</span> <span class="tok-k">throw</span> <span class="tok-n">redirect</span><span class="tok-o">;</span>
          <span class="tok-n">redirected</span> <span class="tok-o">=</span> <span class="tok-kc">true</span><span class="tok-o">;</span>
          <span class="tok-n">target</span> <span class="tok-o">=</span> <span class="tok-n">client</span><span class="tok-o">.</span><span class="tok-na">target</span><span class="tok-o">(</span><span class="tok-n">redirect</span><span class="tok-o">.</span><span class="tok-na">getLocation</span><span class="tok-o">());</span>
   <span class="tok-o">}</span>
<span class="tok-o">}</span> <span class="tok-k">while</span> <span class="tok-o">(</span><span class="tok-n">cli</span> <span class="tok-o">==</span> <span class="tok-kc">null</span><span class="tok-o">);</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>En este ejemplo, volvemos a iterar si recibimos un código de respuesta 3xx. El
código se asegura de que sólo permitimos un código de este tipo, cambiando el valor
de la variable <code>redirect</code> en el bloque en el que capturamos la exceptión.
A continuación cambiamos el <code>WebTarget</code> (en el bloque <code>catch</code>) al valor de la cabecera <code>Location</code>
de la respuesta del servidor.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Los códigos de estado HTTP 3xx indican que es neceario realizar alguna acción
adicional para que el servidor pueda completar la petición. La acción requerida
puede llevarse a cabo sin necesidad de interactuar con el cliente sólo si el
método utilizado en la segunda petición es GET o HEAD
(ver <a href="http://www.w3.org/Protocols/rfc2616/rfc2616-sec10.html" class="bare">http://www.w3.org/Protocols/rfc2616/rfc2616-sec10.html</a>)</p>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_procesamiento_json">5.2. Procesamiento JSON</h3>
<div class="paragraph">
<p>JSON (<strong>J</strong>ava<strong>S</strong>cript <strong>O</strong>bject <strong>N</strong>otation) es un formato para el intercambio
de datos basado en texto, derivado de Javascript (Javascript disponde de una función
nativa: <code>eval()</code> para convertir <em>streams</em> JSON en objetos con propiedades que son
accesibles sin necesidad de manipular ninguna cadena de caracteres).</p>
</div>
<div class="paragraph">
<p>La especificación
<a href="https://jcp.org/aboutJava/communityprocess/final/jsr353/index.html"><strong>JSR 353</strong></a>
proporciona un API para el procesamiento de datos JSON (<em>parsing</em>, transformación y consultas).</p>
</div>
<div class="paragraph">
<p>La gramática de los objetos JSON es bastante simple. Sólo se requieren dos estructuras:
objetos y <em>arrays</em>. Un <strong>objeto</strong> es un conjunto de pares <em>nombre-valor</em>, y un <strong><em>array</em></strong>
es una lista de valores. JSON define siete tipos de valores: <code>string</code>, <code>number</code>,
<code>object</code>, <code>array</code>, <code>true</code>, <code>false</code>, y <code>null</code>.</p>
</div>
<div class="paragraph">
<p>El siguiente ejemplo muestra datos JSON para un objeto que contiene pares <em>nombre-valor</em>:</p>
</div>
<div class="listingblock">
<div class="title">Ejemplo formato JSON</div>
<div class="content">
<pre class="pygments highlight"><code data-lang="json"><span class="tok-p">{</span> <span class="tok-nt">&quot;nombre&quot;</span><span class="tok-p">:</span> <span class="tok-s2">&quot;John&quot;</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;apellidos&quot;</span><span class="tok-p">:</span> <span class="tok-s2">&quot;Smith&quot;</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;edad&quot;</span><span class="tok-p">:</span> <span class="tok-mi">25</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;direccion&quot;</span><span class="tok-p">:</span> <span class="tok-p">{</span> <span class="tok-nt">&quot;calle&quot;</span><span class="tok-p">:</span> <span class="tok-s2">&quot;21 2nd Street&quot;</span><span class="tok-p">,</span>
                 <span class="tok-nt">&quot;ciudad&quot;</span><span class="tok-p">:</span> <span class="tok-s2">&quot;New York&quot;</span><span class="tok-p">,</span>
                 <span class="tok-nt">&quot;codPostal&quot;</span><span class="tok-p">:</span> <span class="tok-s2">&quot;10021&quot;</span>
               <span class="tok-p">},</span>
  <span class="tok-nt">&quot;telefonos&quot;</span><span class="tok-p">:</span> <span class="tok-p">[</span>
         <span class="tok-p">{</span> <span class="tok-nt">&quot;tipo&quot;</span><span class="tok-p">:</span> <span class="tok-s2">&quot;fijo&quot;</span><span class="tok-p">,</span>
           <span class="tok-nt">&quot;numero&quot;</span><span class="tok-p">:</span> <span class="tok-s2">&quot;212 555-1234&quot;</span>
         <span class="tok-p">},</span>
         <span class="tok-p">{</span>
           <span class="tok-nt">&quot;tipo&quot;</span><span class="tok-p">:</span> <span class="tok-s2">&quot;movil&quot;</span><span class="tok-p">,</span>
           <span class="tok-nt">&quot;numero&quot;</span><span class="tok-p">:</span> <span class="tok-s2">&quot;646 555-4567&quot;</span>
         <span class="tok-p">}</span>
  <span class="tok-p">]</span>
 <span class="tok-p">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>El objeto anterior tiene cinco pares <em>nombre-valor</em>:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Los dos primeros son <code>nombre</code> y <code>apellidos</code>, con el valor de tipo <code>String</code></p>
</li>
<li>
<p>El tercero es <code>edad</code>, con el valor de tipo <code>number</code></p>
</li>
<li>
<p>El cuarto es <code>direccion</code>, con el valor de tipo <code>object</code></p>
</li>
<li>
<p>El quinto es <code>telefonos</code>, cuyo valor es de tipo <code>array</code>, con dos objetos</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>JSON tiene la siguiente <strong>sintaxis</strong>:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Los <strong>objetos</strong> están rodeados por llaves <code>{}</code>, sus <strong>pares de elementos</strong> <em>nombre-valor</em> están
separados por una coma <code>,</code>, y el <em>nombre</em> y el <em>valor</em> de cada par están separados
por dos puntos <code>:</code>. Los <strong>nombres</strong> en un objeto son de tipo <code>String</code>, mientras que sus <strong>valores</strong>
pueden ser cualquiera de los siete tipos que ya hemos indicado, incluyendo a otro
objeto, u otro array.</p>
</li>
<li>
<p>Los <strong>arrays</strong> están rodeados por corchetes <code>[]</code>, y sus valores están separados por
una coma <code>,</code>. Cada valor en un <em>array</em> puede ser de un tipo diferente, incluyendo a
otro objeto o array.</p>
</li>
<li>
<p>Cuando los objetos y arrays contienen otros objetos y/o arrays, los datos adquieren
una <strong>estructura de árbol</strong></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Los servicios web RESTful utilizan JSON habitualmente tanto en las peticiones, como en las respuestas.
La cabecera HTTP utilizada para indicar que el contenido de una petición o una respuesta
es JSON es la siguiente:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code>Content-Type: application/json</code></pre>
</div>
</div>
<div class="paragraph">
<p>La representación JSON es normalmente más compacta que las representaciones XML debido
a que JSON no tiene <em>etiquetas de cierre</em>. A diferencia de XML, JSON no tiene un "esquema"
de definición y validación de datos ampliamente aceptado.</p>
</div>
<div class="paragraph">
<p>Actualmente, las aplicaciones Java utilizan diferentes librerías para producir/consumir
JSON, que tienen que incluirse junto con el código de la aplicación, incrementando así el
tamaño del archivo desplegado. El API de Java para procesamiento JSON proporciona un API estándar para analizar y
generar JSON, de forma que las aplicaciones que utilicen dicho API sean más "ligeras" y
portables.</p>
</div>
<div class="paragraph">
<p>Para generar y parsear datos JSON, hay dos modelos de programación, que son similares
a los usados para documentos XML:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>El modelo de objetos: crea un árbol en memoria que representa los datos JSON</p>
</li>
<li>
<p>El modelo basado en <em>streaming</em>: utiliza un <em>parser</em> que lee los datos JSON elemento a
elemento (uno cada vez).</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Java EE incluye soporte para JSR 353, de forma que el API de java para procesamiento JSON se
encuentra en los siguientes paquetes:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>El paquete <code>javax.json</code> contiene interfaces para leer, escribir y construir datos JSON,
según el modelo de objetos, así como otras utilidades.</p>
</li>
<li>
<p>El paquete <code>javax.json.stream</code> contiene una interfaz para parsear y generar datos JSON
para el modelo <em>streaming</em></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Vamos a ver cómo producir y consumir datos JSON utilizando cada uno de los modelos.</p>
</div>
</div>
<div class="sect2">
<h3 id="_modelo_de_procesamiento_basado_en_el_modelo_de_objetos">5.3. Modelo de procesamiento basado en el modelo de objetos</h3>
<div class="paragraph">
<p>En este caso se crea un árbol en memoria que representa los datos JSON (todos los datos).
Una vez construido el árbol, se puede navegar por él, analizarlo, o modificarlo. Esta
aproximación es muy flexible y permite un procesamiento que requiera acceder al contenido
completo del árbol. En contrapartida, normalmente es más lento que el modelo de <em>streaming</em>
y requiere utilizar más memoria. El modelo de objetos genera una salida JSON navegando por el
árbol entero de una vez.</p>
</div>
<div class="paragraph">
<p>El siguiente código muestra cómo crear un modelo de objetos a partir de datos JSON
desde un fichero de texto:</p>
</div>
<div class="listingblock">
<div class="title">Creación de un modelos de objetos a partir de datos JSON</div>
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span class="tok-kn">import</span> <span class="tok-nn">java.io.FileReader</span><span class="tok-o">;</span>
<span class="tok-kn">import</span> <span class="tok-nn">javax.json.Json</span><span class="tok-o">;</span>
<span class="tok-kn">import</span> <span class="tok-nn">javax.json.JsonReader</span><span class="tok-o">;</span>
<span class="tok-kn">import</span> <span class="tok-nn">javax.json.JsonStructure</span><span class="tok-o">;</span>
<span class="tok-o">...</span>
<span class="tok-n">JsonReader</span> <span class="tok-n">reader</span> <span class="tok-o">=</span> <span class="tok-n">Json</span><span class="tok-o">.</span><span class="tok-na">createReader</span><span class="tok-o">(</span><span class="tok-k">new</span> <span class="tok-nf">FileReader</span><span class="tok-o">(</span><span class="tok-s">&quot;datosjson.txt&quot;</span><span class="tok-o">));</span>
<span class="tok-n">JsonStructure</span> <span class="tok-n">jsonst</span> <span class="tok-o">=</span> <span class="tok-n">reader</span><span class="tok-o">.</span><span class="tok-na">read</span><span class="tok-o">();</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>El objeto <code>jsonst</code> puede ser de tipo <code>JsonObject</code> o de tipo <code>JsonArray</code>, dependiendo
de los contenidos del fichero. <code>JsonObject</code> y <code>JsonArray</code> son subtipos de
<code>JsonStructure</code>. Este objeto representa la raíz del árbol y puede utilizarse para
navegar por el árbol o escribirlo en un <em>stream</em> como datos JSON.</p>
</div>
<div class="paragraph">
<p>Vamos a mostrar algún ejemplo en el que utilicemos un <code>StringReader</code>.</p>
</div>
<div class="listingblock">
<div class="title">Objeto JSON con dos pares <em>nombre-valor</em></div>
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span class="tok-n">jsonReader</span> <span class="tok-o">=</span> <span class="tok-n">Json</span><span class="tok-o">.</span><span class="tok-na">createReader</span><span class="tok-o">(</span><span class="tok-k">new</span> <span class="tok-nf">StringReader</span><span class="tok-o">(</span><span class="tok-s">&quot;{&quot;</span>
                      <span class="tok-o">+</span> <span class="tok-s">&quot;  \&quot;manzana\&quot;:\&quot;roja\&quot;,&quot;</span>
                      <span class="tok-o">+</span> <span class="tok-s">&quot;  \&quot;plátano\&quot;:\&quot;amarillo\&quot;&quot;</span>
                      <span class="tok-o">+</span> <span class="tok-s">&quot;}&quot;</span><span class="tok-o">));</span>
<span class="tok-n">JsonObject</span> <span class="tok-n">json</span> <span class="tok-o">=</span> <span class="tok-n">jsonReader</span><span class="tok-o">.</span><span class="tok-na">readObject</span><span class="tok-o">();</span>
<span class="tok-n">json</span><span class="tok-o">.</span><span class="tok-na">getString</span><span class="tok-o">(</span><span class="tok-s">&quot;manzana&quot;</span><span class="tok-o">);</span> <i class="conum" data-value="1"></i><b>(1)</b>
<span class="tok-n">json</span><span class="tok-o">.</span><span class="tok-na">getString</span><span class="tok-o">(</span><span class="tok-s">&quot;plátano&quot;</span><span class="tok-o">);</span></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>El método <code>getString()</code> devuelve el valor del <em>string</em> para la clave especificada como
parámetro. Pueden utilizarse otros métodos <code>getXXX()</code> para acceder al valor correspondiente
de la clave en función del tipo de dicho objeto.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Un <em>array</em> con dos objetos, cada uno de ellos con un par <em>nombre-valor</em> puede
leerse como:</p>
</div>
<div class="listingblock">
<div class="title">Array con dos objetos</div>
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span class="tok-n">jsonReader</span> <span class="tok-o">=</span> <span class="tok-n">Json</span><span class="tok-o">.</span><span class="tok-na">createReader</span><span class="tok-o">(</span><span class="tok-k">new</span> <span class="tok-nf">StringReader</span><span class="tok-o">(</span><span class="tok-s">&quot;[&quot;</span>
                        <span class="tok-o">+</span> <span class="tok-s">&quot;  { \&quot;manzana\&quot;:\&quot;rojo\&quot; },&quot;</span>
                        <span class="tok-o">+</span> <span class="tok-s">&quot;  { \&quot;plátano\&quot;:\&quot;amarillo\&quot; }&quot;</span>
                        <span class="tok-o">+</span> <span class="tok-s">&quot;]&quot;</span><span class="tok-o">));</span>
<span class="tok-n">JsonArray</span> <span class="tok-n">jsonArray</span> <span class="tok-o">=</span> <span class="tok-n">jsonReader</span><span class="tok-o">.</span><span class="tok-na">readArray</span><span class="tok-o">();</span> <i class="conum" data-value="1"></i><b>(1)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>La interfaz JsonArray también tiene métodos <code>get</code> para valores de tipo
<code>boolean</code>, <code>integer</code>, y <code>String</code> en el índice especificado (esta interfaz hereda
de java.util.List)</td>
</tr>
</table>
</div>
<div class="sect3">
<h4 id="_creación_de_un_modelos_de_objetos_desde_el_código_de_la_aplicación">5.3.1. Creación de un modelos de objetos desde el código de la aplicación</h4>
<div class="paragraph">
<p>A continuación mostramos un ejemplo de código para crear un modelo de objetos
mediante programación:</p>
</div>
<div class="listingblock">
<div class="title">Ejemplo de creación de un modelo de objetos JSON desde programación</div>
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span class="tok-kn">import</span> <span class="tok-nn">javax.json.Json</span><span class="tok-o">;</span>
<span class="tok-kn">import</span> <span class="tok-nn">javax.json.JsonObject</span><span class="tok-o">;</span>
<span class="tok-o">...</span>
<span class="tok-n">JsonObject</span> <span class="tok-n">modelo</span> <span class="tok-o">=</span>
    <span class="tok-n">Json</span><span class="tok-o">.</span><span class="tok-na">createObjectBuilder</span><span class="tok-o">()</span> <i class="conum" data-value="1"></i><b>(1)</b>
        <span class="tok-o">.</span><span class="tok-na">add</span><span class="tok-o">(</span><span class="tok-s">&quot;nombre&quot;</span><span class="tok-o">,</span> <span class="tok-s">&quot;Duke&quot;</span><span class="tok-o">)</span>
        <span class="tok-o">.</span><span class="tok-na">add</span><span class="tok-o">(</span><span class="tok-s">&quot;apellidos&quot;</span><span class="tok-o">,</span> <span class="tok-s">&quot;Java&quot;</span><span class="tok-o">)</span>
        <span class="tok-o">.</span><span class="tok-na">add</span><span class="tok-o">(</span><span class="tok-s">&quot;edad&quot;</span><span class="tok-o">,</span> <span class="tok-mi">18</span><span class="tok-o">)</span>
        <span class="tok-o">.</span><span class="tok-na">add</span><span class="tok-o">(</span><span class="tok-s">&quot;calle&quot;</span><span class="tok-o">,</span> <span class="tok-s">&quot;100 Internet Dr&quot;</span><span class="tok-o">)</span>
        <span class="tok-o">.</span><span class="tok-na">add</span><span class="tok-o">(</span><span class="tok-s">&quot;ciudad&quot;</span><span class="tok-o">,</span> <span class="tok-s">&quot;JavaTown&quot;</span><span class="tok-o">)</span>
        <span class="tok-o">.</span><span class="tok-na">add</span><span class="tok-o">(</span><span class="tok-s">&quot;codPostal&quot;</span><span class="tok-o">,</span> <span class="tok-s">&quot;12345&quot;</span><span class="tok-o">)</span>
        <span class="tok-o">.</span><span class="tok-na">add</span><span class="tok-o">(</span><span class="tok-s">&quot;telefonos&quot;</span><span class="tok-o">,</span>
              <span class="tok-n">Json</span><span class="tok-o">.</span><span class="tok-na">createArrayBuilder</span><span class="tok-o">()</span> <i class="conum" data-value="2"></i><b>(2)</b>
                  <span class="tok-o">.</span><span class="tok-na">add</span><span class="tok-o">(</span><span class="tok-n">Json</span><span class="tok-o">.</span><span class="tok-na">createObjectBuilder</span><span class="tok-o">()</span>
                           <span class="tok-o">.</span><span class="tok-na">add</span><span class="tok-o">(</span><span class="tok-s">&quot;tipo&quot;</span><span class="tok-o">,</span> <span class="tok-s">&quot;casa&quot;</span><span class="tok-o">)</span>
                           <span class="tok-o">.</span><span class="tok-na">add</span><span class="tok-o">(</span><span class="tok-s">&quot;numero&quot;</span><span class="tok-o">,</span> <span class="tok-s">&quot;111-111-1111&quot;</span><span class="tok-o">))</span>
                  <span class="tok-o">.</span><span class="tok-na">add</span><span class="tok-o">(</span><span class="tok-n">Json</span><span class="tok-o">.</span><span class="tok-na">createObjectBuilder</span><span class="tok-o">()</span>
                           <span class="tok-o">.</span><span class="tok-na">add</span><span class="tok-o">(</span><span class="tok-s">&quot;tipo&quot;</span><span class="tok-o">,</span> <span class="tok-s">&quot;movil&quot;</span><span class="tok-o">)</span>
                           <span class="tok-o">.</span><span class="tok-na">add</span><span class="tok-o">(</span><span class="tok-s">&quot;numero&quot;</span><span class="tok-o">,</span> <span class="tok-s">&quot;222-222-2222&quot;</span><span class="tok-o">)))</span>
            <span class="tok-o">.</span><span class="tok-na">build</span><span class="tok-o">();</span></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>El tipo <code>JsonObject</code> representa un objeto JSON. El método <code>Json.createObjectBuilder()</code>
crea un modelo de objetos en memoria añadiendo elementos desde el código de nuestra
aplicación</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>El método <code>Json.createArrayBuilder()</code> crea un modelo de arrays en memoria añadiendo
elementos desde el código de nuestra aplicación</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>El objeto <code>modelo</code>, de tipo <code>JsonObject</code> representa la raíz del árbol, que es
creado anidando llamadas
a métodos ´add()´, y construyendo el árbol a través del método <code>build()</code>.</p>
</div>
<div class="paragraph">
<p>La estructura JSON generada es la siguiente:</p>
</div>
<div class="listingblock">
<div class="title">Ejemplo formato JSON generado mediante programación</div>
<div class="content">
<pre class="pygments highlight"><code data-lang="json"><span class="tok-p">{</span> <span class="tok-nt">&quot;nombre&quot;</span><span class="tok-p">:</span> <span class="tok-s2">&quot;Duke&quot;</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;apellidos&quot;</span><span class="tok-p">:</span> <span class="tok-s2">&quot;Java&quot;</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;edad&quot;</span><span class="tok-p">:</span> <span class="tok-mi">18</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;calle&quot;</span><span class="tok-p">:</span> <span class="tok-s2">&quot;100 Internet Dr&quot;</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;ciudad&quot;</span><span class="tok-p">:</span> <span class="tok-s2">&quot;JavaTown&quot;</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;codPostal&quot;</span><span class="tok-p">:</span> <span class="tok-s2">&quot;12345&quot;</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;telefonos&quot;</span><span class="tok-p">:</span> <span class="tok-p">[</span>
         <span class="tok-p">{</span> <span class="tok-nt">&quot;tipo&quot;</span><span class="tok-p">:</span> <span class="tok-s2">&quot;casa&quot;</span><span class="tok-p">,</span>
           <span class="tok-nt">&quot;numero&quot;</span><span class="tok-p">:</span> <span class="tok-s2">&quot;111-111-1111&quot;</span>
         <span class="tok-p">},</span>
         <span class="tok-p">{</span>
           <span class="tok-nt">&quot;tipo&quot;</span><span class="tok-p">:</span> <span class="tok-s2">&quot;movil&quot;</span><span class="tok-p">,</span>
           <span class="tok-nt">&quot;numero&quot;</span><span class="tok-p">:</span> <span class="tok-s2">&quot;222-222-2222&quot;</span>
         <span class="tok-p">}</span>
  <span class="tok-p">]</span>
 <span class="tok-p">}</span></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_navegando_por_el_modelo_de_objetos">5.3.2. Navegando por el modelo de objetos</h4>
<div class="paragraph">
<p>A continuación mostramos un código de ejemplo para navegar por el modelo de objetos:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span class="tok-kn">import</span> <span class="tok-nn">javax.json.JsonValue</span><span class="tok-o">;</span>
<span class="tok-kn">import</span> <span class="tok-nn">javax.json.JsonObject</span><span class="tok-o">;</span>
<span class="tok-kn">import</span> <span class="tok-nn">javax.json.JsonArray</span><span class="tok-o">;</span>
<span class="tok-kn">import</span> <span class="tok-nn">javax.json.JsonNumber</span><span class="tok-o">;</span>
<span class="tok-kn">import</span> <span class="tok-nn">javax.json.JsonString</span><span class="tok-o">;</span>
<span class="tok-o">...</span>
<span class="tok-kd">public</span> <span class="tok-kd">static</span> <span class="tok-kt">void</span> <span class="tok-nf">navegarPorElArbol</span><span class="tok-o">(</span><span class="tok-n">JsonValue</span> <span class="tok-n">arbol</span><span class="tok-o">,</span> <span class="tok-n">String</span> <span class="tok-n">clave</span><span class="tok-o">)</span> <span class="tok-o">{</span>
  <span class="tok-k">if</span> <span class="tok-o">(</span><span class="tok-n">clave</span> <span class="tok-o">!=</span> <span class="tok-kc">null</span><span class="tok-o">)</span>
    <span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">out</span><span class="tok-o">.</span><span class="tok-na">print</span><span class="tok-o">(</span><span class="tok-s">&quot;Clave &quot;</span> <span class="tok-o">+</span> <span class="tok-n">clave</span> <span class="tok-o">+</span> <span class="tok-s">&quot;: &quot;</span><span class="tok-o">);</span>
  <span class="tok-k">switch</span><span class="tok-o">(</span><span class="tok-n">arbol</span><span class="tok-o">.</span><span class="tok-na">getValueType</span><span class="tok-o">())</span> <span class="tok-o">{</span>
    <span class="tok-k">case</span> <span class="tok-nl">OBJECT:</span>
       <span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">out</span><span class="tok-o">.</span><span class="tok-na">println</span><span class="tok-o">(</span><span class="tok-s">&quot;OBJETO&quot;</span><span class="tok-o">);</span>
       <span class="tok-n">JsonObject</span> <span class="tok-n">objeto</span> <span class="tok-o">=</span> <span class="tok-o">(</span><span class="tok-n">JsonObject</span><span class="tok-o">)</span> <span class="tok-n">arbol</span><span class="tok-o">;</span>
       <span class="tok-k">for</span> <span class="tok-o">(</span><span class="tok-n">String</span> <span class="tok-n">nombre</span> <span class="tok-o">:</span> <span class="tok-n">object</span><span class="tok-o">.</span><span class="tok-na">keySet</span><span class="tok-o">())</span>
          <span class="tok-n">navegarPorElArbol</span><span class="tok-o">(</span><span class="tok-n">object</span><span class="tok-o">.</span><span class="tok-na">get</span><span class="tok-o">(</span><span class="tok-n">nombre</span><span class="tok-o">),</span> <span class="tok-n">name</span><span class="tok-o">);</span>
       <span class="tok-k">break</span><span class="tok-o">;</span>
    <span class="tok-k">case</span> <span class="tok-nl">ARRAY:</span>
       <span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">out</span><span class="tok-o">.</span><span class="tok-na">println</span><span class="tok-o">(</span><span class="tok-s">&quot;ARRAY&quot;</span><span class="tok-o">);</span>
       <span class="tok-n">JsonArray</span> <span class="tok-n">array</span> <span class="tok-o">=</span> <span class="tok-o">(</span><span class="tok-n">JsonArray</span><span class="tok-o">)</span> <span class="tok-n">arbol</span><span class="tok-o">;</span>
       <span class="tok-k">for</span> <span class="tok-o">(</span><span class="tok-n">JsonValue</span> <span class="tok-n">val</span> <span class="tok-o">:</span> <span class="tok-n">array</span><span class="tok-o">)</span>
         <span class="tok-n">navegarPorElArbol</span><span class="tok-o">(</span><span class="tok-n">val</span><span class="tok-o">,</span> <span class="tok-kc">null</span><span class="tok-o">);</span>
       <span class="tok-k">break</span><span class="tok-o">;</span>
    <span class="tok-k">case</span> <span class="tok-nl">STRING:</span>
       <span class="tok-n">JsonString</span> <span class="tok-n">st</span> <span class="tok-o">=</span> <span class="tok-o">(</span><span class="tok-n">JsonString</span><span class="tok-o">)</span> <span class="tok-n">arbol</span><span class="tok-o">;</span>
       <span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">out</span><span class="tok-o">.</span><span class="tok-na">println</span><span class="tok-o">(</span><span class="tok-s">&quot;STRING &quot;</span> <span class="tok-o">+</span> <span class="tok-n">st</span><span class="tok-o">.</span><span class="tok-na">getString</span><span class="tok-o">());</span>
       <span class="tok-k">break</span><span class="tok-o">;</span>
    <span class="tok-k">case</span> <span class="tok-nl">NUMBER:</span>
       <span class="tok-n">JsonNumber</span> <span class="tok-n">num</span> <span class="tok-o">=</span> <span class="tok-o">(</span><span class="tok-n">JsonNumber</span><span class="tok-o">)</span> <span class="tok-n">arbol</span><span class="tok-o">;</span>
       <span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">out</span><span class="tok-o">.</span><span class="tok-na">println</span><span class="tok-o">(</span><span class="tok-s">&quot;NUMBER &quot;</span> <span class="tok-o">+</span> <span class="tok-n">num</span><span class="tok-o">.</span><span class="tok-na">toString</span><span class="tok-o">());</span>
       <span class="tok-k">break</span><span class="tok-o">;</span>
    <span class="tok-k">case</span> <span class="tok-nl">TRUE:</span>
    <span class="tok-k">case</span> <span class="tok-nl">FALSE:</span>
    <span class="tok-k">case</span> <span class="tok-nl">NULL:</span>
       <span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">out</span><span class="tok-o">.</span><span class="tok-na">println</span><span class="tok-o">(</span><span class="tok-n">arbol</span><span class="tok-o">.</span><span class="tok-na">getValueType</span><span class="tok-o">().</span><span class="tok-na">toString</span><span class="tok-o">());</span>
       <span class="tok-k">break</span><span class="tok-o">;</span>
    <span class="tok-o">}</span>
<span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>El método <code>navegarPorElArbol()</code> podemos usarlo con el ejemplo
anterior de la siguiente forma:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>navegarPorElArbol(modelo, "OBJECT");</pre>
</div>
</div>
<div class="paragraph">
<p>El método <code>navegarPorElArbol()</code> tiene dos argumentos: un elemento JSON y una clave.
La clave se utiliza para imprimir los pares <em>clave-valor</em> dentro de los objetos.
Los elementos en el árbol se representan por el tipo <code>JsonValue</code>. Si el elemento
es un <strong>objeto</strong> o un <strong>array</strong>, se realiza una nueva llamada a este método es invocada
para cada elemento contenido en el <em>objeto</em> o el <em>array</em>. Si el elemento es un <strong>valor</strong>,
éste se imprime en la salida estándar.</p>
</div>
<div class="paragraph">
<p>El método <code>JsonValue.getValueType()</code> identifica el elemento como un <em>objeto</em>, un
<em>array</em>, o un <em>valor</em>. Para los objetos, el método <code>JsonObject.keySet()</code> devuelve
un conjunto de <code>Strings</code> que contienene las claves de los objetos, y el método
<code>JsonObject.get(String nombre)</code> devuelve el valor del elemento cuya <em>clave</em> es
<code>nombre</code>. Para los <em>arrays</em>, <code>JsonArray</code> implementa la interfaz <code>List&lt;JsonValue&gt;</code>.
Podemos utilizar bucles <code>for</code> mejorados, con el valor de <code>Set&lt;String&gt;</code> devuelto por
<code>JsonObject.keySet()</code>, y con instancias de <code>JsonArray</code>, tal y como hemos mostrado
en el ejemplo.</p>
</div>
</div>
<div class="sect3">
<h4 id="_escritura_de_un_modelo_de_objetos_en_un_em_stream_em">5.3.3. Escritura de un modelo de objetos en un <em>stream</em></h4>
<div class="paragraph">
<p>Los modelos de objetos creados en los ejemplos anteriores, pueden "escribirse" en un
<em>stream</em>, utilizando la clase <code>JsonWriter</code>, de la siguiente forma:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span class="tok-kn">import</span> <span class="tok-nn">java.io.StringWriter</span><span class="tok-o">;</span>
<span class="tok-kn">import</span> <span class="tok-nn">javax.json.JsonWriter</span><span class="tok-o">;</span>
<span class="tok-o">...</span>
<span class="tok-n">StringWriter</span> <span class="tok-n">stWriter</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-nf">StringWriter</span><span class="tok-o">();</span>
<span class="tok-n">JsonWriter</span> <span class="tok-n">jsonWriter</span> <span class="tok-o">=</span> <span class="tok-n">Json</span><span class="tok-o">.</span><span class="tok-na">createWriter</span><span class="tok-o">(</span><span class="tok-n">stWriter</span><span class="tok-o">);</span> <i class="conum" data-value="1"></i><b>(1)</b>
<span class="tok-n">jsonWriter</span><span class="tok-o">.</span><span class="tok-na">writeObject</span><span class="tok-o">(</span><span class="tok-n">modelo</span><span class="tok-o">);</span> <i class="conum" data-value="2"></i><b>(2)</b>
<span class="tok-n">jsonWriter</span><span class="tok-o">.</span><span class="tok-na">close</span><span class="tok-o">();</span> <i class="conum" data-value="3"></i><b>(3)</b>

<span class="tok-n">String</span> <span class="tok-n">datosJson</span> <span class="tok-o">=</span> <span class="tok-n">stWriter</span><span class="tok-o">.</span><span class="tok-na">toString</span><span class="tok-o">();</span>
<span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">out</span><span class="tok-o">.</span><span class="tok-na">println</span><span class="tok-o">(</span><span class="tok-n">datosJson</span><span class="tok-o">);</span></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>El método <code>Json.createWriter()</code> toma como parámetro un <code>OutputStream</code></td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>El método <code>JsonWriter.writeObject()</code> "escribe" el objeto <code>JsonObject</code> en el <em>stream</em></td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>El método <code>JsonWriter.close()</code> cierra el <em>stream</em> de salida</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_modelo_de_procesamiento_basado_en_em_streaming_em">5.3.4. Modelo de procesamiento basado en <em>streaming</em></h4>
<div class="paragraph">
<p>El modelo de <em>streaming</em> utiliza un parser basado en eventos que va leyendo los datos JSON
de uno en uno. El parser genera eventos y detiene el procesamiento cuando un objeto o
array comienza o termina, cuando encuentra una clave, o encuentra un valor. Cada elemento
puede ser procesado o rechazado por el código de la aplicación, y a continuación el parser
continúa con el siguiente evento. Esta aproximación es adecuada para un procesamiento local,
en el cual el procesamiento de un elemento no requiere información del resto de los datos.
El modelo de <em>streaming</em> genera una salida JSON para un determinado <em>stream</em> realizando una
llamada a una función con un elemento cada vez.</p>
</div>
<div class="paragraph">
<p>A continuación veamos con ejemplos cómo utilizar el API para el modelo de <em>streaming</em>:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Para leer datos JSON utilizando un <em>parser</em> (<em>JsonParser</em>)</p>
</li>
<li>
<p>Para escribir datos JSON utilizando un <em>generador</em> (<em>JsonGenerator</em>)</p>
</li>
</ul>
</div>
<div class="sect4">
<h5 id="_lectura_de_datos_json">Lectura de datos JSON</h5>
<div class="paragraph">
<p>El API para el modelo <em>streaming</em> es la aproximación más eficiente para "parsear" datos
JSON utilizando eventos:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span class="tok-kn">import</span> <span class="tok-nn">javax.json.Json</span><span class="tok-o">;</span>
<span class="tok-kn">import</span> <span class="tok-nn">javax.json.stream.JsonParser</span><span class="tok-o">;</span>
<span class="tok-o">...</span>
<span class="tok-n">JsonParser</span> <span class="tok-n">parser</span> <span class="tok-o">=</span> <span class="tok-n">Json</span><span class="tok-o">.</span><span class="tok-na">createParser</span><span class="tok-o">(</span><span class="tok-k">new</span> <span class="tok-nf">StringReader</span><span class="tok-o">(</span><span class="tok-n">datosJson</span><span class="tok-o">));</span>
<span class="tok-k">while</span> <span class="tok-o">(</span><span class="tok-n">parser</span><span class="tok-o">.</span><span class="tok-na">hasNext</span><span class="tok-o">())</span> <span class="tok-o">{</span>
  <span class="tok-n">JsonParser</span><span class="tok-o">.</span><span class="tok-na">Event</span> <span class="tok-n">evento</span> <span class="tok-o">=</span> <span class="tok-n">parser</span><span class="tok-o">.</span><span class="tok-na">next</span><span class="tok-o">();</span>
  <span class="tok-k">switch</span><span class="tok-o">(</span><span class="tok-n">evento</span><span class="tok-o">)</span> <span class="tok-o">{</span>
    <span class="tok-k">case</span> <span class="tok-nl">START_ARRAY:</span>
    <span class="tok-k">case</span> <span class="tok-nl">END_ARRAY:</span>
    <span class="tok-k">case</span> <span class="tok-nl">START_OBJECT:</span>
    <span class="tok-k">case</span> <span class="tok-nl">END_OBJECT:</span>
    <span class="tok-k">case</span> <span class="tok-nl">VALUE_FALSE:</span>
    <span class="tok-k">case</span> <span class="tok-nl">VALUE_NULL:</span>
    <span class="tok-k">case</span> <span class="tok-nl">VALUE_TRUE:</span>
        <span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">out</span><span class="tok-o">.</span><span class="tok-na">println</span><span class="tok-o">(</span><span class="tok-n">evento</span><span class="tok-o">.</span><span class="tok-na">toString</span><span class="tok-o">());</span>
        <span class="tok-k">break</span><span class="tok-o">;</span>
    <span class="tok-k">case</span> <span class="tok-nl">KEY_NAME:</span>
        <span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">out</span><span class="tok-o">.</span><span class="tok-na">print</span><span class="tok-o">(</span><span class="tok-n">evento</span><span class="tok-o">.</span><span class="tok-na">toString</span><span class="tok-o">()</span> <span class="tok-o">+</span> <span class="tok-s">&quot; &quot;</span> <span class="tok-o">+</span> <span class="tok-n">parser</span><span class="tok-o">.</span><span class="tok-na">getString</span><span class="tok-o">()</span> <span class="tok-o">+</span> <span class="tok-s">&quot; - &quot;</span><span class="tok-o">);</span>
        <span class="tok-k">break</span><span class="tok-o">;</span>
    <span class="tok-k">case</span> <span class="tok-nl">VALUE_STRING:</span>
    <span class="tok-k">case</span> <span class="tok-nl">VALUE_NUMBER:</span>
        <span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">out</span><span class="tok-o">.</span><span class="tok-na">println</span><span class="tok-o">(</span><span class="tok-n">evento</span><span class="tok-o">.</span><span class="tok-na">toString</span><span class="tok-o">()</span> <span class="tok-o">+</span> <span class="tok-s">&quot; &quot;</span> <span class="tok-o">+</span> <span class="tok-n">parser</span><span class="tok-o">.</span><span class="tok-na">getString</span><span class="tok-o">());</span>
        <span class="tok-k">break</span><span class="tok-o">;</span>
  <span class="tok-o">}</span>
<span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>El ejemplo consta de tres pasos:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Obtener una instancia de un parser invocando el método estático <code>Json.createParser()</code></p>
</li>
<li>
<p>Iterar sobre los eventos del parser utilizando los métodos <code>JsonParser.hasNext()</code> y
<code>JsonParser.next()</code></p>
</li>
<li>
<p>Realizar un procesamiento local para cada elemento</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>El ejemplo muestra los diez posibles tipos de eventos del parser.
El método <code>JsonParser.next()</code>
"avanza" al siguiente evento. Para los tipos de eventos <code>KEY_NAME</code>, <code>VALUE_STRING</code>,
y <code>VALUE_NUMBER</code>, podemos obtener el contenido del elemento invocando al
método <code>JsonParser.getString()</code>. Para los eventos <code>VALUE_NUMBER</code>, podemos también
usar los siguientes métodos:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>JsonParser.isIntegralNumber</code></p>
</li>
<li>
<p><code>JsonParser.getInt</code></p>
</li>
<li>
<p><code>JsonParser.getLong</code></p>
</li>
<li>
<p><code>JsonParser.getBigDecimal</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>El parser genera los eventos <code>START_OBJECT</code> y <code>END_OBJECT</code> para un objeto JSON vacío:
<code>{ }</code>.</p>
</div>
<div class="paragraph">
<p>Para un objeto con dos pares <em>nombre-valor</em>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="json"><span class="tok-p">{</span>
  <span class="tok-nt">&quot;manzaja&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;roja&quot;</span><span class="tok-p">,</span> <span class="tok-nt">&quot;plátano&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;amarillo&quot;</span>
<span class="tok-p">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Mostramos los eventos generados:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="sh"><span class="tok-o">{</span>START_OBJECT
   <span class="tok-s2">&quot;manzaja&quot;</span>KEY_NAME:<span class="tok-s2">&quot;roja&quot;</span>VALUE_STRING,
   <span class="tok-s2">&quot;plátano&quot;</span>KEY_NAME:<span class="tok-s2">&quot;amarillo&quot;</span>VALUE_STRING
<span class="tok-o">}</span>END_OBJECT</code></pre>
</div>
</div>
<div class="paragraph">
<p>Los eventos generados para un <em>array</em> con dos objetos JSON serían los siguientes:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="sh"><span class="tok-o">[</span>START_ARRAY
  <span class="tok-o">{</span>START_OBJECT <span class="tok-s2">&quot;manzaja&quot;</span>KEY_NAME:<span class="tok-s2">&quot;roja&quot;</span>VALUE_STRING <span class="tok-o">}</span>END_OBJECT,
  <span class="tok-o">{</span>START_OBJECT <span class="tok-s2">&quot;plátano&quot;</span>KEY_NAME:<span class="tok-s2">&quot;amarillo&quot;</span>VALUE_STRING <span class="tok-o">}</span>END_OBJECT
<span class="tok-o">]</span>END_ARRAY</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_escritura_de_datos_json">Escritura de datos JSON</h5>
<div class="paragraph">
<p>El siguiente código muestra cómo escribir datos JSON en un fichero utilizando el
API para el modelo de <em>streaming</em>:</p>
</div>
<div class="listingblock">
<div class="title">Ejemplo de escritura de datos JSON con el modelo de streaming</div>
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span class="tok-n">FileWriter</span> <span class="tok-n">writer</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-nf">FileWriter</span><span class="tok-o">(</span><span class="tok-s">&quot;test.txt&quot;</span><span class="tok-o">);</span>
<span class="tok-n">JsonGenerator</span> <span class="tok-n">gen</span> <span class="tok-o">=</span> <span class="tok-n">Json</span><span class="tok-o">.</span><span class="tok-na">createGenerator</span><span class="tok-o">(</span><span class="tok-n">writer</span><span class="tok-o">);</span>
<span class="tok-n">gen</span><span class="tok-o">.</span><span class="tok-na">writeStartObject</span><span class="tok-o">()</span>
   <span class="tok-o">.</span><span class="tok-na">write</span><span class="tok-o">(</span><span class="tok-s">&quot;nombre&quot;</span><span class="tok-o">,</span> <span class="tok-s">&quot;Duke&quot;</span><span class="tok-o">)</span>
   <span class="tok-o">.</span><span class="tok-na">write</span><span class="tok-o">(</span><span class="tok-s">&quot;apellidos&quot;</span><span class="tok-o">,</span> <span class="tok-s">&quot;Java&quot;</span><span class="tok-o">)</span>
   <span class="tok-o">.</span><span class="tok-na">write</span><span class="tok-o">(</span><span class="tok-s">&quot;edad&quot;</span><span class="tok-o">,</span> <span class="tok-mi">18</span><span class="tok-o">)</span>
   <span class="tok-o">.</span><span class="tok-na">write</span><span class="tok-o">(</span><span class="tok-s">&quot;calle&quot;</span><span class="tok-o">,</span> <span class="tok-s">&quot;100 Internet Dr&quot;</span><span class="tok-o">)</span>
   <span class="tok-o">.</span><span class="tok-na">write</span><span class="tok-o">(</span><span class="tok-s">&quot;ciudad&quot;</span><span class="tok-o">,</span> <span class="tok-s">&quot;JavaTown&quot;</span><span class="tok-o">)</span>
   <span class="tok-o">.</span><span class="tok-na">write</span><span class="tok-o">(</span><span class="tok-s">&quot;codPostal&quot;</span><span class="tok-o">,</span> <span class="tok-s">&quot;12345&quot;</span><span class="tok-o">)</span>
   <span class="tok-o">.</span><span class="tok-na">writeStartArray</span><span class="tok-o">(</span><span class="tok-s">&quot;telefonos&quot;</span><span class="tok-o">)</span>
      <span class="tok-o">.</span><span class="tok-na">writeStartObject</span><span class="tok-o">()</span>
         <span class="tok-o">.</span><span class="tok-na">write</span><span class="tok-o">(</span><span class="tok-s">&quot;tipo&quot;</span><span class="tok-o">,</span> <span class="tok-s">&quot;casa&quot;</span><span class="tok-o">)</span>
         <span class="tok-o">.</span><span class="tok-na">write</span><span class="tok-o">(</span><span class="tok-s">&quot;numero&quot;</span><span class="tok-o">,</span> <span class="tok-s">&quot;111-111-1111&quot;</span><span class="tok-o">)</span>
      <span class="tok-o">.</span><span class="tok-na">writeEnd</span><span class="tok-o">()</span>
      <span class="tok-o">.</span><span class="tok-na">writeStartObject</span><span class="tok-o">()</span>
         <span class="tok-o">.</span><span class="tok-na">write</span><span class="tok-o">(</span><span class="tok-s">&quot;tipo&quot;</span><span class="tok-o">,</span> <span class="tok-s">&quot;movil&quot;</span><span class="tok-o">)</span>
         <span class="tok-o">.</span><span class="tok-na">write</span><span class="tok-o">(</span><span class="tok-s">&quot;numero&quot;</span><span class="tok-o">,</span> <span class="tok-s">&quot;222-222-2222&quot;</span><span class="tok-o">)</span>
      <span class="tok-o">.</span><span class="tok-na">writeEnd</span><span class="tok-o">()</span>
   <span class="tok-o">.</span><span class="tok-na">writeEnd</span><span class="tok-o">()</span>
   <span class="tok-o">.</span><span class="tok-na">writeEnd</span><span class="tok-o">();</span>
<span class="tok-n">gen</span><span class="tok-o">.</span><span class="tok-na">close</span><span class="tok-o">();</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Este ejemplo obtiene un generador JSON invocando al método estático <code>Json.createGenerator()</code>,
que toma como parámetro un <em>output stream</em> o un <em>writer stream</em>. El ejemplo escribe
los datos JSON en el fichero <code>text.txt</code> anidando llamadas a los métodos <code>write()</code>,
<code>writeStartArray()</code>, <code>writeStartObject()</code>, and <code>writeEnd()</code>. El método
<code>JsonGenerator.close()</code> cierra el <em>output stream</em> o <em>writer stream</em> subyacente.</p>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_pruebas_de_servicios_rest">5.4. Pruebas de servicios REST</h3>
<div class="paragraph">
<p>Hasta ahora hemos visto varias formas de "probar" nuestros servicios REST: desde
línea de comandos con <em>Curl</em>, desde IntelliJ con la herramienta <em>Test RESTFul Web
Service</em>, y desde el navegador <em>Chrome</em>, con <em>Postman</em> (siendo esta última la que
más hemos utilizado).</p>
</div>
<div class="paragraph">
<p>Vamos a ver cómo implementar tests para nuestros servicios REST utilizando Maven y
JUnit. Para ello repasaremos algunas cuestiones básicas sobre los
<a href="https://maven.apache.org/ref/3.3.3/maven-core/lifecycles.html">ciclos de vida de Maven</a>.</p>
</div>
<div class="sect3">
<h4 id="_ciclo_de_vida_de_maven_y_tests_junit">5.4.1. Ciclo de vida de Maven y tests JUnit</h4>
<div class="paragraph">
<p>Un ciclo de vida en Maven <strong>es una secuencia de acciones determinada</strong>, que define el proceso
de construcción de un proyecto en concreto. Como resultado del proceso de construcción de un
proyecto obtendremos un <em>artefacto</em> (fichero), de un cierto tipo (por ejemplo .jar, .war, .ear,&#8230;&#8203;).
Por lo tanto, podríamos decir que un ciclo de vida está formado por las acciones necesarias para
convertir nuestros archivos fuente que constituyen el proyecto en, por ejemplo un .jar, un .war,&#8230;&#8203;</p>
</div>
<div class="paragraph">
<p>Maven propone 3 ciclos de vida, es decir, tres posibles secuencias de acciones, que podemos
utilizar (y modificar a nuestra conveniencia) para construir nuestro proyecto.
Dichos ciclos de vida son: <em>clean</em>, <em>site</em> y el denominado <em>default-lifecycle</em>.</p>
</div>
<div class="paragraph">
<p>Cada ciclo de vida está formado por <strong>fases</strong>. Una fase es un concepto abstracto, y define el tipo
de acciones que se deberían llevar a cabo. Por ejemplo una fase del ciclo de vida por defecto es
<em>compile</em>, para referirse a las acciones que nos permiten convertir los ficheros <em>.java</em> en los ficheros <em>.class</em>
correspondientes.</p>
</div>
<div class="paragraph">
<p>Cada fase está formada por un conjunto de <strong>goals</strong>, que son las acciones que se llevarán a cabo en cada
una de las fases. Las <strong>goals</strong> no "viven" de forma independiente, sino que cualquier <em>goal</em> siempre
forma parte de un <strong>plugin</strong> Maven. Podríamos decir que un <em>plugin</em>, por lo tanto, es una agrupación lógica de una
serie de <em>goals</em> relacionadas. Por ejemplo, el <em>plugin</em> wildfly, contiene una serie de <em>goals</em>
para <em>desplegar</em>, <em>re-desplegar</em>, <em>deshacer-el-despliegue</em>, <em>arrancar el servidor</em>, etc., es decir, agrupa las
acciones que podemos realizar sobre el servidor wildfly. Una goal se especifica siempre anteponiendo el nombre
del <em>plugin</em> al que pertenece seguido de dos puntos, por ejemplo <strong>wildfly:deploy</strong> indica que se trata de la <em>goal</em>
<em>deploy</em>, que pertenece al plugin <em>wildfly</em> de maven.</p>
</div>
<div class="paragraph">
<p>Pues bien, por defecto, Maven asocia ciertas <em>goals</em> a las fases de los tres ciclos de vida. Cuando se ejecuta
una fase de un ciclo de vida, por ejemplo <strong>mvn package</strong> se ejecutan todas las <em>goals</em> asociadas a todas las fases
anteriores a la fase <strong>package</strong>, en orden, y finalmente las <em>goals</em> asociadas a la fase <strong>package</strong>.
Por supuesto, podemos alterar en cualquier momento este comportamiento por defecto, incluyendo los plugins
y goals correspondientes dentro de la etiqueta <em>&lt;build&gt;</em> en nuestro fichero de configuración <em>pom.xml</em>.</p>
</div>
<div class="paragraph">
<p>Vamos a implementar tests JUnit. Los tests, como ya habéis visto en sesiones anteriores, en el
directorio <strong>src/test</strong>. Algunas normas importantes son: que los tests pertenezcan al mismo paquete lógico al
que pertencen las clases Java que estamos probando. Por ejemplo, si estamos haciendo pruebas sobre las clases del
paquete <em>org.expertojava.rest</em>, los tests deberían pertenecer al mismo paquete, aunque físicamente el código fuente y
sus pruebas estarán separados (el código fuente estará en src/main, y los tests en src/test).</p>
</div>
<div class="paragraph">
<p>Para realizar pruebas sobre nuestros servicios REST, necesitamos que el servidor Wilfly esté en marcha.
También necesitamos empaquetar el código en un fichero <strong>war</strong> y desplegarlo en el servidor, todo esto ANTES
de ejecutar los tests.</p>
</div>
<div class="paragraph">
<p>Las acciones para arrancar el servidor Wilfly y desplegar nuestra aplicación en él, NO forman parte de las
acciones (o <em>goals</em>) incluidas por defecto en el ciclo de vida por defecto de Maven, cuando nuestro proyecto
tiene que empaquetarse como un <strong>war</strong> (etiqueta <em>&lt;packaging&gt;</em> de nuestro <em>pom.xml</em>). Podéis consultar
<a href="https://maven.apache.org/ref/3.3.3/maven-core/default-bindings.html#Plugin_bindings_for_war_packaging">aquí</a> la
lista de <em>goals</em> asociadas a las fases del ciclo de vida por defecto de Maven.</p>
</div>
<div class="paragraph">
<p>Por otro lado, en el ciclo de vida por defecto, se incluye una <em>goal</em> para ejecutar los tests, asociada a la
fase <em>test</em>. Dicha goal es <strong>surefire:test</strong>. El problema es que, por defecto, la fase <em>test</em> se ejecuta ANTES
de la fase <em>package</em> y por lo tanto, antes de empaquetar y desplegar nuestra aplicación en Wildfly.</p>
</div>
<div class="paragraph">
<p>Por lo tanto, tendremos que "alterar" convenientemente este comportamiento por defecto para que se ejecuten las acciones
de nuestro proceso de construcción que necesitemos, y en el orden en el que lo necesitemos. Como ya hemos
indicado antes, esto lo haremos incluyendo dichas acciones en la etiqueta <em>&lt;build&gt;</em> de nuestro <em>pom.xml</em>,
y configurandolas convenientemente para asegurarnos que el orden en el que se ejecutan es el que queremos.</p>
</div>
<div class="paragraph">
<p>La siguiente figura muestra parte de la secuencia de fases llevadas a cabo por Maven en su ciclo de vida por
defecto. Para conseguir nuestros propósitos, simplemente añadiremos la "goals" <strong>wildfly:deploy</strong>, y la asociaremos
a la fase <em>pre-integration-test</em>, y "cambiaremos" la fase a la que está asociada la goal <strong>surefire:test</strong> para
que los tests se ejecuten DESPUÉS de haber desplegado el <em>war</em> en Wildfly.</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="images/rest05/maven-lifecycle.png" alt="Configuración del pom.xml para ejecutar los tests REST" width="66%">
</div>
</div>
<div class="paragraph">
<p>A continuación mostramos los cambios que tenemos que realizar en el fichero de configuración <strong>pom.xml</strong></p>
</div>
<div class="listingblock">
<div class="title">Adición de las goals wildfly:deploy y surefire:test a las fases pre-integration-test y surefire:test respectivamente</div>
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><span class="tok-c">&lt;!-- forzamos el despliegue del war generado durante la fase pre-integration-test,</span>
<span class="tok-c">     justo después de obtener dicho .war--&gt;</span>
<span class="tok-nt">&lt;plugin&gt;</span>
  <span class="tok-nt">&lt;groupId&gt;</span>org.wildfly.plugins<span class="tok-nt">&lt;/groupId&gt;</span>
  <span class="tok-nt">&lt;artifactId&gt;</span>wildfly-maven-plugin<span class="tok-nt">&lt;/artifactId&gt;</span>
  <span class="tok-nt">&lt;version&gt;</span>1.0.2.Final<span class="tok-nt">&lt;/version&gt;</span>
  <span class="tok-nt">&lt;configuration&gt;</span>
    <span class="tok-nt">&lt;hostname&gt;</span>localhost<span class="tok-nt">&lt;/hostname&gt;</span>
    <span class="tok-nt">&lt;port&gt;</span>9990<span class="tok-nt">&lt;/port&gt;</span>
  <span class="tok-nt">&lt;/configuration&gt;</span>

  <span class="tok-nt">&lt;executions&gt;</span>
    <span class="tok-nt">&lt;execution&gt;</span>
      <span class="tok-nt">&lt;id&gt;</span>wildfly-deploy<span class="tok-nt">&lt;/id&gt;</span>
      <span class="tok-nt">&lt;phase&gt;</span>pre-integration-test<span class="tok-nt">&lt;/phase&gt;</span>
      <span class="tok-nt">&lt;goals&gt;</span>
        <span class="tok-nt">&lt;goal&gt;</span>deploy<span class="tok-nt">&lt;/goal&gt;</span>
      <span class="tok-nt">&lt;/goals&gt;</span>
      <span class="tok-nt">&lt;/execution&gt;</span>
  <span class="tok-nt">&lt;/executions&gt;</span>
<span class="tok-nt">&lt;/plugin&gt;</span>

<span class="tok-c">&lt;!--ejecutaremos los test JUnit en la fase integration-test,</span>
<span class="tok-c">    inmediatamente después de la fase pre-integration-test, y antes</span>
<span class="tok-c">    de la fase verify--&gt;</span>
<span class="tok-nt">&lt;plugin&gt;</span>
   <span class="tok-nt">&lt;groupId&gt;</span>org.apache.maven.plugins<span class="tok-nt">&lt;/groupId&gt;</span>
   <span class="tok-nt">&lt;artifactId&gt;</span>maven-surefire-plugin<span class="tok-nt">&lt;/artifactId&gt;</span>
   <span class="tok-nt">&lt;version&gt;</span>2.18<span class="tok-nt">&lt;/version&gt;</span>
   <span class="tok-nt">&lt;configuration&gt;</span>
        <span class="tok-nt">&lt;skip&gt;</span>true<span class="tok-nt">&lt;/skip&gt;</span>
   <span class="tok-nt">&lt;/configuration&gt;</span>
   <span class="tok-nt">&lt;executions&gt;</span>
      <span class="tok-nt">&lt;execution&gt;</span>
        <span class="tok-nt">&lt;id&gt;</span>surefire-it<span class="tok-nt">&lt;/id&gt;</span>
        <span class="tok-nt">&lt;phase&gt;</span>integration-test<span class="tok-nt">&lt;/phase&gt;</span>
        <span class="tok-nt">&lt;goals&gt;</span>
          <span class="tok-nt">&lt;goal&gt;</span>test<span class="tok-nt">&lt;/goal&gt;</span>
        <span class="tok-nt">&lt;/goals&gt;</span>
        <span class="tok-nt">&lt;configuration&gt;</span>
          <span class="tok-nt">&lt;skip&gt;</span>false<span class="tok-nt">&lt;/skip&gt;</span>
        <span class="tok-nt">&lt;/configuration&gt;</span>
      <span class="tok-nt">&lt;/execution&gt;</span>
    <span class="tok-nt">&lt;/executions&gt;</span>
<span class="tok-nt">&lt;/plugin&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>También necesitamos incluir en el pom.xml las librerías de las que depende el código de pruebas
de nuestro proyecto (clases <strong>XXXXTest</strong> situadas en <strong>src/test</strong>): librería JUnit, JAXB y el API cliente de JAX-RS.
Por lo que añadimos en el las dependencias correspondientes:</p>
</div>
<div class="listingblock">
<div class="title">Dependencias del código src/test con JUnit y API cliente de JAX-RS</div>
<div class="content">
<pre class="pygments highlight"><code data-lang="xml">...
<span class="tok-nt">&lt;dependency&gt;</span>
  <span class="tok-nt">&lt;groupId&gt;</span>junit<span class="tok-nt">&lt;/groupId&gt;</span>
  <span class="tok-nt">&lt;artifactId&gt;</span>junit<span class="tok-nt">&lt;/artifactId&gt;</span>
  <span class="tok-nt">&lt;version&gt;</span>4.12<span class="tok-nt">&lt;/version&gt;</span>
  <span class="tok-nt">&lt;scope&gt;</span>test<span class="tok-nt">&lt;/scope&gt;</span>
<span class="tok-nt">&lt;/dependency&gt;</span>
<span class="tok-nt">&lt;dependency&gt;</span>
  <span class="tok-nt">&lt;groupId&gt;</span>org.jboss.resteasy<span class="tok-nt">&lt;/groupId&gt;</span>
  <span class="tok-nt">&lt;artifactId&gt;</span>resteasy-client<span class="tok-nt">&lt;/artifactId&gt;</span>
  <span class="tok-nt">&lt;version&gt;</span>3.0.13.Final<span class="tok-nt">&lt;/version&gt;</span>
  <span class="tok-nt">&lt;scope&gt;</span>test<span class="tok-nt">&lt;/scope&gt;</span>
<span class="tok-nt">&lt;/dependency&gt;</span>
<span class="tok-nt">&lt;dependency&gt;</span>
  <span class="tok-nt">&lt;groupId&gt;</span>org.jboss.resteasy<span class="tok-nt">&lt;/groupId&gt;</span>
  <span class="tok-nt">&lt;artifactId&gt;</span>resteasy-jaxb-provider<span class="tok-nt">&lt;/artifactId&gt;</span>
  <span class="tok-nt">&lt;version&gt;</span>3.0.13.Final<span class="tok-nt">&lt;/version&gt;</span>
<span class="tok-nt">&lt;/dependency&gt;</span>
...</code></pre>
</div>
</div>
<div class="paragraph">
<p>Dado que vamos a trabajar con el API Json, y dado que ejecutaremos los tests desde la máquina
virtual de Java, y no dentro del servidor WildFly, necesitamos añadir también las siguientes
librerías:</p>
</div>
<div class="listingblock">
<div class="title">Dependencias del código src/test con el API Json de jaxrs</div>
<div class="content">
<pre class="pygments highlight"><code data-lang="xml">...
<span class="tok-c">&lt;!--Librerías para serializar/deserializar json --&gt;</span>
<span class="tok-nt">&lt;dependency&gt;</span>
  <span class="tok-nt">&lt;groupId&gt;</span>org.jboss.resteasy<span class="tok-nt">&lt;/groupId&gt;</span>
  <span class="tok-nt">&lt;artifactId&gt;</span>resteasy-jackson-provider<span class="tok-nt">&lt;/artifactId&gt;</span>
  <span class="tok-nt">&lt;version&gt;</span>3.0.13.Final<span class="tok-nt">&lt;/version&gt;</span>
<span class="tok-nt">&lt;/dependency&gt;</span>

<span class="tok-c">&lt;!--Jaxrs API json --&gt;</span>
<span class="tok-nt">&lt;dependency&gt;</span>
  <span class="tok-nt">&lt;groupId&gt;</span>org.jboss.resteasy<span class="tok-nt">&lt;/groupId&gt;</span>
  <span class="tok-nt">&lt;artifactId&gt;</span>resteasy-json-p-provider<span class="tok-nt">&lt;/artifactId&gt;</span>
  <span class="tok-nt">&lt;version&gt;</span>3.0.13.Final<span class="tok-nt">&lt;/version&gt;</span>
<span class="tok-nt">&lt;/dependency&gt;</span>
...</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>No hemos incluido en el pom.xml la orden para arrancar Wildfly. Vamos a hacer esto
desde IntelliJ en un perfil de ejecución, como ya habéis hecho en sesiones anteriores.
De esta forma, podremos ver desde IntelliJ la consola de logs del servidor. En este
caso, podemos crear un perfil solamente para arrancar el servidor Wildfly (no es necesario
que se incluya el despliegue del war generado, puesto que lo haremos desde la ventana
<em>Maven Projects</em>).
Antes de iniciar el proceso de construcción, por lo tanto, tendremos que asegurarnos
de que hemos arrancado Wildlfly.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Con estos cambios en el pom.xml, y ejecutando el comando <code>mvn verify</code> se
llevarán a cabo las siguientes acciones, en este orden:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Después de compilar el proyecto, obtenemos el <code>.war</code> (fase <code>package</code>)</p>
</li>
<li>
<p>El <code>.war</code> generado se despliega en el servidor de aplicaciones Wilfly (fase <code>pre-integration-test</code>)</p>
</li>
<li>
<p>Se ejecutan los test JUnit sobre la aplicación desplegada en el servidor (fase <code>integration-test</code>)</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_anotaciones_junit_y_aserciones_assertthat">5.4.2. Anotaciones JUnit y aserciones AssertThat</h4>
<div class="paragraph">
<p>JUnit 4 proporciona anotaciones para forzar a que los métodos anotados con @Test se ejecuten
en el orden que nos interese (por defecto no está garantizado que se ejecuten en el orden en el
que se escriben).</p>
</div>
<div class="paragraph">
<p>En principio, debemos programar los tests para que sean totalmente independientes unos de otros,
y por lo tanto, el orden de ejecución no influya para nada en el resultado de su ejecución, tanto si se
ejecuta el primero, como a mitad, o el último. El no hacer los tests independientes hace que el proceso
de testing "se alargue" y complique innecesariamente, ya que puede ser que unos tests "enmascaren" en
resultado de otros, o que no podamos "saber" si ciertas partes del código están bien o mal implementadas
hasta que los tests de los que dependemos se hayan superado con éxito.</p>
</div>
<div class="paragraph">
<p>Aún así, y dado que muchas veces se obtienen errores por hacer asunciones en el orden de la ejecución
de los tests, JUnit nos permite fijar dicho orden. Para ello utilizaremos la anotación
<code>@FixMethodOrder</code>, indicando el tipo de ordenación, como por ejemplo <code>MethodSorters.NAME_ASCENDING</code>,
de forma que se ejecutarán los tests por orden lexicográfico.</p>
</div>
<div class="paragraph">
<p>Por ejemplo:</p>
</div>
<div class="listingblock">
<div class="title">Ejemplo para forzar el orden de ejecución de los test (orden lexicográfico)</div>
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span class="tok-nd">@FixMethodOrder</span><span class="tok-o">(</span><span class="tok-n">MethodSorters</span><span class="tok-o">.</span><span class="tok-na">NAME_ASCENDING</span><span class="tok-o">)</span>
<span class="tok-kd">public</span> <span class="tok-kd">class</span> <span class="tok-nc">TestMethodOrder</span> <span class="tok-o">{</span>

    <span class="tok-nd">@Test</span>
    <span class="tok-kd">public</span> <span class="tok-kt">void</span> <span class="tok-nf">testB</span><span class="tok-o">()</span> <span class="tok-o">{</span>
       <span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">out</span><span class="tok-o">.</span><span class="tok-na">println</span><span class="tok-o">(</span><span class="tok-s">&quot;second&quot;</span><span class="tok-o">);</span>
     <span class="tok-o">}</span>

    <span class="tok-nd">@Test</span>
    <span class="tok-kd">public</span> <span class="tok-kt">void</span> <span class="tok-nf">testA</span><span class="tok-o">()</span> <span class="tok-o">{</span>
        <span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">out</span><span class="tok-o">.</span><span class="tok-na">println</span><span class="tok-o">(</span><span class="tok-s">&quot;first&quot;</span><span class="tok-o">);</span>
    <span class="tok-o">}</span>

    <span class="tok-nd">@Test</span>
    <span class="tok-kd">public</span> <span class="tok-kt">void</span> <span class="tok-nf">testC</span><span class="tok-o">()</span> <span class="tok-o">{</span>
        <span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">out</span><span class="tok-o">.</span><span class="tok-na">println</span><span class="tok-o">(</span><span class="tok-s">&quot;third&quot;</span><span class="tok-o">);</span>
    <span class="tok-o">}</span>
<span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>En ese caso, el orden de ejecución será: <code>testA()</code>, a continuación <code>testB()</code>, y
finalmente <code>testC()</code>.</p>
</div>
<div class="paragraph">
<p>Otra aportación de JUnit 4 es la incorporación de aserciones de tipo <code>assertThat</code>.
En sesiones anteriores habéis utilizado aserciones con métodos <code>Assert.assertEquals(resultado_esperado, resultado_real)</code>.
Los nuevos métodos <code>Assert.assertThat()</code> permiten una mayor flexibilidad a la hora de
expresar las aserciones realizadas en nuestros tests, así como una mayor legibilidad
de los mismos. El prototipo general de las aserciones de este tipo es:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>assertThat([value], [matcher statement]);</pre>
</div>
</div>
<div class="paragraph">
<p>en donde <code>[value]</code> es el resultado real (valor sobre el que se quiere afirmar algo),
 y <code>[matcher statement]</code> es un <code>Matcher</code> u objeto que realiza operaciones de "emparejamiento"
 sobre una secuencia de caracteres según un determinado patrón.</p>
</div>
<div class="paragraph">
<p>Por ejemplo:</p>
</div>
<div class="listingblock">
<div class="title">Ejemplos de sentencias assertThat</div>
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span class="tok-n">assertThat</span><span class="tok-o">(</span><span class="tok-n">x</span><span class="tok-o">,</span> <span class="tok-n">is</span><span class="tok-o">(</span><span class="tok-n">not</span><span class="tok-o">(</span><span class="tok-mi">4</span><span class="tok-o">)));</span>  <i class="conum" data-value="1"></i><b>(1)</b>
<span class="tok-n">assertThat</span><span class="tok-o">(</span><span class="tok-n">responseStringJson</span><span class="tok-o">,</span> <span class="tok-n">either</span><span class="tok-o">(</span><span class="tok-n">containsString</span><span class="tok-o">(</span><span class="tok-s">&quot;nombre&quot;</span><span class="tok-o">)).</span><span class="tok-na">and</span><span class="tok-o">(</span><span class="tok-n">containsString</span><span class="tok-o">(</span><span class="tok-s">&quot;apellido&quot;</span><span class="tok-o">)));</span> <i class="conum" data-value="2"></i><b>(2)</b>
<span class="tok-n">assertThat</span><span class="tok-o">(</span><span class="tok-n">myList</span><span class="tok-o">,</span> <span class="tok-n">hasItem</span><span class="tok-o">(</span><span class="tok-s">&quot;3&quot;</span><span class="tok-o">));</span> <i class="conum" data-value="3"></i><b>(3)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Aquí utilizamos un <em>matcher</em> con el patrón "4", esta sentencia devuelve <em>false</em> si x != "4"</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Podemos "combinar" varios <em>matchers</em>, de forma que se tengan que satisfacer más de uno</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>En este caso aplicamos el <em>matcher</em> sobre un conjunto de elementos</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Hay varias librerías que implementan <em>Matchers</em>. JUnit incluye parte de los <em>matchers</em> de
<em>Hamcrest</em> (<em>Hamcrest</em> es un <em>framework</em> para escribir objetos <em>matcher</em> permitiendo
definir reglas de <em>matching</em> de forma declarativa). Otra librería interesante para realizar
testing de servicios rest que utilizan representaciones Json es la librería: <code>hamcrest-json</code>,
que podemos utilizar para realizar aserciones sobre dos objetos Json.</p>
</div>
<div class="paragraph">
<p>Por ejemplo, supongamos que nuestro objeto Json contiene una lista de enlaces Hateoas, de tipo
<code>Link</code>. Los objetos <code>Link</code> serán serializados/deserializados (Wildfly utiliza <em>Jackson</em> para realizar
estas tareas) convenientemente. Cuando serializamos un objeto <code>Link</code> (obtenemos su representación
Json), veremos, además de los objetos "uri": "valor", "type": "valor" y "rel": "valor", que son los que básicamente
utilizamos al crear los enlaces Hateoas, otros como "uriBuilder": {&#8230;&#8203;}, "params":{&#8230;&#8203;}, que puede
que no nos interese consultar, o incluso que no les hayamos asignado ningún valor.</p>
</div>
<div class="paragraph">
<p>Si en nuestro test, queremos comprobar que el objeto Json que nos devuelve el servicio (resultado real) se corresponde
con el valor esperado, tendremos que "comparar" ambas representaciones. Ahora bien, puede que solamente
nos interese comparar ciertos valores contenidos en el objeto Json, no el objeto "completo".</p>
</div>
<div class="paragraph">
<p>Hacer esta comprobación "elemento a elemento" es bastante tedioso. La librería <code>hamcrest-json</code> nos proporciona
lo que estamos buscando, con los métodos <code>sameJSONAs()</code>,<code>allowingExtraUnexpectedFields()</code>, y
<code>allowingAnyArrayOrdering()</code>, de la siguiente forma:</p>
</div>
<div class="listingblock">
<div class="title">Método para comparar dos representaciones Json. Clase uk.co.datumedge.hamcrest.json.SameJSONAs</div>
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span class="tok-n">Assert</span><span class="tok-o">.</span><span class="tok-na">assertThat</span><span class="tok-o">(</span><span class="tok-s">&quot;{\&quot;age\&quot;:43, \&quot;friend_ids\&quot;:[16, 52, 23]}&quot;</span><span class="tok-o">,</span>
                  <span class="tok-n">sameJSONAs</span><span class="tok-o">(</span><span class="tok-s">&quot;{\&quot;friend_ids\&quot;:[52, 23, 16]}&quot;</span><span class="tok-o">)</span>
                            <span class="tok-o">.</span><span class="tok-na">allowingExtraUnexpectedFields</span><span class="tok-o">()</span>
                            <span class="tok-o">.</span><span class="tok-na">allowingAnyArrayOrdering</span><span class="tok-o">());</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>En este código tenemos una representación formada por dos objetos, uno de los cuales tiene como valor un
array de enteros. Si el servicio rest devuelve un objeto Json con más elementos, o en otro orden, en este caso
el resultado de la sentencia <em>assertThat</em> es <em>true</em>. Volviendo al ejemplo anterior de un objeto Json que
contiene enlaces Hatehoas, podríamos realizar la siguiente comparación:</p>
</div>
<div class="listingblock">
<div class="title">Comparamos dos objetos Json que contienen hiperenlaces Hateoas (objetos Link)</div>
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span class="tok-n">JsonObject</span> <span class="tok-n">json_object</span> <span class="tok-o">=</span>
    <span class="tok-n">client</span><span class="tok-o">.</span><span class="tok-na">target</span><span class="tok-o">(</span><span class="tok-s">&quot;http://localhost:8080/foro/usuarios&quot;</span><span class="tok-o">)</span>
          <span class="tok-o">.</span><span class="tok-na">request</span><span class="tok-o">(</span><span class="tok-n">MediaType</span><span class="tok-o">.</span><span class="tok-na">APPLICATION_JSON</span><span class="tok-o">)</span>
          <span class="tok-o">.</span><span class="tok-na">get</span><span class="tok-o">(</span><span class="tok-n">JsonObject</span><span class="tok-o">.</span><span class="tok-na">class</span><span class="tok-o">);</span>   <i class="conum" data-value="1"></i><b>(1)</b>

<span class="tok-n">String</span> <span class="tok-n">json_string</span> <span class="tok-o">=</span> <span class="tok-n">json_object</span><span class="tok-o">.</span><span class="tok-na">toString</span><span class="tok-o">();</span>  <i class="conum" data-value="2"></i><b>(2)</b>

<span class="tok-n">JsonObject</span> <span class="tok-n">usuarios</span> <span class="tok-o">=</span>
   <span class="tok-n">Json</span><span class="tok-o">.</span><span class="tok-na">createObjectBuilder</span><span class="tok-o">()</span>
       <span class="tok-o">.</span><span class="tok-na">add</span><span class="tok-o">(</span><span class="tok-s">&quot;usuarios&quot;</span><span class="tok-o">,</span>
           <span class="tok-n">Json</span><span class="tok-o">.</span><span class="tok-na">createArrayBuilder</span><span class="tok-o">()</span>
              <span class="tok-o">.</span><span class="tok-na">add</span><span class="tok-o">(</span><span class="tok-n">Json</span><span class="tok-o">.</span><span class="tok-na">createObjectBuilder</span><span class="tok-o">()</span>
                  <span class="tok-o">.</span><span class="tok-na">add</span><span class="tok-o">(</span><span class="tok-s">&quot;nombre&quot;</span><span class="tok-o">,</span> <span class="tok-s">&quot;Pepe Lopez&quot;</span><span class="tok-o">)</span>
                  <span class="tok-o">.</span><span class="tok-na">add</span><span class="tok-o">(</span><span class="tok-s">&quot;links&quot;</span><span class="tok-o">,</span>
                      <span class="tok-n">Json</span><span class="tok-o">.</span><span class="tok-na">createArrayBuilder</span><span class="tok-o">()</span>
                        <span class="tok-o">.</span><span class="tok-na">add</span><span class="tok-o">(</span><span class="tok-n">Json</span><span class="tok-o">.</span><span class="tok-na">createObjectBuilder</span><span class="tok-o">()</span>
                        <span class="tok-o">.</span><span class="tok-na">add</span><span class="tok-o">(</span><span class="tok-s">&quot;uri&quot;</span><span class="tok-o">,</span> <span class="tok-s">&quot;http://localhost:8080/foro/usuarios/pepe&quot;</span><span class="tok-o">)</span>
                        <span class="tok-o">.</span><span class="tok-na">add</span><span class="tok-o">(</span><span class="tok-s">&quot;type&quot;</span><span class="tok-o">,</span> <span class="tok-s">&quot;application/xml,application/json&quot;</span><span class="tok-o">)</span>
                        <span class="tok-o">.</span><span class="tok-na">add</span><span class="tok-o">(</span><span class="tok-s">&quot;rel&quot;</span><span class="tok-o">,</span> <span class="tok-s">&quot;self&quot;</span><span class="tok-o">))))</span>
              <span class="tok-o">.</span><span class="tok-na">add</span><span class="tok-o">(</span><span class="tok-n">Json</span><span class="tok-o">.</span><span class="tok-na">createObjectBuilder</span><span class="tok-o">()</span>
                  <span class="tok-o">.</span><span class="tok-na">add</span><span class="tok-o">(</span><span class="tok-s">&quot;nombre&quot;</span><span class="tok-o">,</span> <span class="tok-s">&quot;Ana Garcia&quot;</span><span class="tok-o">)</span>
                  <span class="tok-o">.</span><span class="tok-na">add</span><span class="tok-o">(</span><span class="tok-s">&quot;links&quot;</span><span class="tok-o">,</span>
                      <span class="tok-n">Json</span><span class="tok-o">.</span><span class="tok-na">createArrayBuilder</span><span class="tok-o">()</span>
                        <span class="tok-o">.</span><span class="tok-na">add</span><span class="tok-o">(</span><span class="tok-n">Json</span><span class="tok-o">.</span><span class="tok-na">createObjectBuilder</span><span class="tok-o">()</span>
                        <span class="tok-o">.</span><span class="tok-na">add</span><span class="tok-o">(</span><span class="tok-s">&quot;uri&quot;</span><span class="tok-o">,</span> <span class="tok-s">&quot;http://localhost:8080/foro/usuarios/ana&quot;</span><span class="tok-o">)</span>
                        <span class="tok-o">.</span><span class="tok-na">add</span><span class="tok-o">(</span><span class="tok-s">&quot;type&quot;</span><span class="tok-o">,</span> <span class="tok-s">&quot;application/xml,application/json&quot;</span><span class="tok-o">)</span>
                        <span class="tok-o">.</span><span class="tok-na">add</span><span class="tok-o">(</span><span class="tok-s">&quot;rel&quot;</span><span class="tok-o">,</span> <span class="tok-s">&quot;self&quot;</span><span class="tok-o">)))))</span>
    <span class="tok-o">.</span><span class="tok-na">build</span><span class="tok-o">();</span>   <i class="conum" data-value="3"></i><b>(3)</b>

<span class="tok-n">Assert</span><span class="tok-o">.</span><span class="tok-na">assertThat</span><span class="tok-o">(</span><span class="tok-n">json_string</span><span class="tok-o">,</span>
                  <span class="tok-n">sameJSONAs</span><span class="tok-o">(</span><span class="tok-n">usuarios</span><span class="tok-o">.</span><span class="tok-na">toString</span><span class="tok-o">())</span>
                      <span class="tok-o">.</span><span class="tok-na">allowingExtraUnexpectedFields</span><span class="tok-o">()</span>
                      <span class="tok-o">.</span><span class="tok-na">allowingAnyArrayOrdering</span><span class="tok-o">());</span> <i class="conum" data-value="4"></i><b>(4)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Realizamos la llamada al servicio REST y recibimos como respuesta un objeto Json. En
este caso nuestro objeto Json está formado por una lista de objetos.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Obtenemos la representación de nuestro objeto Json (resultado real) en forma de cadena de caracteres</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Creamos un nuevo objeto Json con el resultado esperado</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Comparamos ambos objetos. Si el resultado real incluye más elementos que los contenidos
en <code>json_string</code> o en otro orden consideraremos que hemos obtenido la respuesta correcta.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Para utilizar esta librería en nuestro proyecto, simplemente tendremos que añadirla como
dependencia en la configuración de nuestro pom.xml:</p>
</div>
<div class="listingblock">
<div class="title">Librería para comparar objetos Json en los tests</div>
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><span class="tok-c">&lt;!--Hamcrest Json --&gt;</span>
<span class="tok-nt">&lt;dependency&gt;</span>
    <span class="tok-nt">&lt;groupId&gt;</span>uk.co.datumedge<span class="tok-nt">&lt;/groupId&gt;</span>
    <span class="tok-nt">&lt;artifactId&gt;</span>hamcrest-json<span class="tok-nt">&lt;/artifactId&gt;</span>
    <span class="tok-nt">&lt;version&gt;</span>0.2<span class="tok-nt">&lt;/version&gt;</span>
<span class="tok-nt">&lt;/dependency&gt;</span></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_observaciones_sobre_los_tests_y_algunos_ejemplos_de_tests">5.4.3. Observaciones sobre los tests y algunos ejemplos de tests</h4>
<div class="paragraph">
<p>Recuerda que para utilizar el API cliente, necesitas utilizar instancias <code>javax.ws.rs.client.Client</code>,
que debemos "cerrar" siempre después de su uso para cerrar el socket asociado a la conexión.</p>
</div>
<div class="paragraph">
<p>Para ello podemos optar por:
* Crear una única instancia Client "antes" de ejecutar cualquier test (método @BeforeClass),
 y cerrar el socket después de ejecutar todos los tests (método @AfterClass)
* Crear una única instancia Client "antes" de ejecutar CADA test (método @Before),
y cerrar el socket después de ejecutar CADA tests (método @After)</p>
</div>
<div class="paragraph">
<p>Si el resultado de una invocación sobre la instancia <em>Client</em> es de tipo <code>javax.ws.rs.core.Response</code>,
debemos liberar de forma explícita la conexión para que pueda ser usada de nuevo por dicha instancia <em>Client</em>.</p>
</div>
<div class="paragraph">
<p>Por ejemplo, supongamos que queremos realizar un test en el que realizamos una operación POST, y a continuación
una operación GET para verificar que el nuevo recurso se ha añadidido correctamente:</p>
</div>
<div class="listingblock">
<div class="title">Ejemplo de Test que utiliza una instancia <em>Client</em> para todos los tests</div>
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span class="tok-kd">public</span> <span class="tok-kd">class</span> <span class="tok-nc">TestRESTServices</span> <span class="tok-o">{</span>
  <span class="tok-kd">private</span> <span class="tok-kd">static</span> <span class="tok-kd">final</span> <span class="tok-n">String</span> <span class="tok-n">BASE_URL</span> <span class="tok-o">=</span> <span class="tok-s">&quot;http://localhost:8080/rest/&quot;</span><span class="tok-o">;</span>
  <span class="tok-kd">private</span> <span class="tok-kd">static</span> <span class="tok-n">URI</span> <span class="tok-n">uri</span> <span class="tok-o">=</span> <span class="tok-n">UriBuilder</span><span class="tok-o">.</span><span class="tok-na">fromUri</span><span class="tok-o">(</span><span class="tok-n">BASE_URL</span><span class="tok-o">).</span><span class="tok-na">build</span><span class="tok-o">();</span>
  <span class="tok-kd">private</span> <span class="tok-kd">static</span> <span class="tok-n">Client</span> <span class="tok-n">client</span><span class="tok-o">;</span>

  <span class="tok-nd">@BeforeClass</span>
  <span class="tok-kd">public</span> <span class="tok-kd">static</span> <span class="tok-kt">void</span> <span class="tok-nf">initClient</span><span class="tok-o">()</span> <span class="tok-o">{</span>
    <span class="tok-n">client</span> <span class="tok-o">=</span> <span class="tok-n">ClientBuilder</span><span class="tok-o">.</span><span class="tok-na">newClient</span><span class="tok-o">();</span> <i class="conum" data-value="1"></i><b>(1)</b>
  <span class="tok-o">}</span>

  <span class="tok-nd">@AfterClass</span>
  <span class="tok-kd">public</span> <span class="tok-kd">static</span> <span class="tok-kt">void</span> <span class="tok-nf">closeClient</span><span class="tok-o">()</span> <span class="tok-o">{</span>
    <span class="tok-n">client</span><span class="tok-o">.</span><span class="tok-na">close</span><span class="tok-o">();</span> <i class="conum" data-value="2"></i><b>(2)</b>
  <span class="tok-o">}</span>

  <span class="tok-nd">@Test</span>
  <span class="tok-kd">public</span> <span class="tok-kt">void</span> <span class="tok-nf">createAndRetrieveACustomer</span><span class="tok-o">()</span> <span class="tok-o">{</span>

    <span class="tok-n">Customer</span> <span class="tok-n">customer</span> <span class="tok-o">=</span> <span class="tok-o">...</span> <span class="tok-c1">//Creamos un nuevo cliente</span>
    <span class="tok-n">Response</span> <span class="tok-n">response</span> <span class="tok-o">=</span> <span class="tok-n">client</span><span class="tok-o">.</span><span class="tok-na">target</span><span class="tok-o">(</span><span class="tok-n">uri</span><span class="tok-o">)</span>
                          <span class="tok-o">.</span><span class="tok-na">request</span><span class="tok-o">()</span>
                          <span class="tok-o">.</span><span class="tok-na">post</span><span class="tok-o">(</span><span class="tok-n">Entity</span><span class="tok-o">.</span><span class="tok-na">entity</span><span class="tok-o">(</span><span class="tok-n">customer</span><span class="tok-o">,</span> <span class="tok-n">MediaType</span><span class="tok-o">.</span><span class="tok-na">APPLICATION_JSON</span><span class="tok-o">));</span>
    <span class="tok-n">assertEquals</span><span class="tok-o">(</span><span class="tok-n">Response</span><span class="tok-o">.</span><span class="tok-na">Status</span><span class="tok-o">.</span><span class="tok-na">CREATED</span><span class="tok-o">,</span> <span class="tok-n">response</span><span class="tok-o">.</span><span class="tok-na">getStatusInfo</span><span class="tok-o">());</span>
    <span class="tok-n">URI</span> <span class="tok-n">referenceURI</span> <span class="tok-o">=</span> <span class="tok-n">response</span><span class="tok-o">.</span><span class="tok-na">getLocation</span><span class="tok-o">();</span>
    <span class="tok-n">response</span><span class="tok-o">.</span><span class="tok-na">close</span><span class="tok-o">();</span> <i class="conum" data-value="3"></i><b>(3)</b>

    <span class="tok-c1">// Obtenemos el recurso que hemos añadido</span>
    <span class="tok-n">response</span> <span class="tok-o">=</span> <span class="tok-n">client</span><span class="tok-o">.</span><span class="tok-na">target</span><span class="tok-o">(</span><span class="tok-n">referenceURI</span><span class="tok-o">).</span><span class="tok-na">request</span><span class="tok-o">().</span><span class="tok-na">get</span><span class="tok-o">();</span>

    <span class="tok-n">Customer</span> <span class="tok-n">retrieved_customer</span> <span class="tok-o">=</span> <span class="tok-n">response</span><span class="tok-o">.</span><span class="tok-na">readEntity</span><span class="tok-o">(</span><span class="tok-n">Customer</span><span class="tok-o">.</span><span class="tok-na">class</span><span class="tok-o">);</span>
    <span class="tok-n">assertEquals</span><span class="tok-o">(</span><span class="tok-n">Response</span><span class="tok-o">.</span><span class="tok-na">Status</span><span class="tok-o">.</span><span class="tok-na">OK</span><span class="tok-o">,</span> <span class="tok-n">response</span><span class="tok-o">.</span><span class="tok-na">getStatusInfo</span><span class="tok-o">());</span>
    <span class="tok-n">assertEquals</span><span class="tok-o">(</span><span class="tok-n">retreivedRef</span><span class="tok-o">.</span><span class="tok-na">getName</span><span class="tok-o">(),</span> <span class="tok-n">r</span><span class="tok-o">.</span><span class="tok-na">getName</span><span class="tok-o">());</span>
    <span class="tok-n">response</span><span class="tok-o">.</span><span class="tok-na">close</span><span class="tok-o">();</span> <i class="conum" data-value="4"></i><b>(4)</b>
  <span class="tok-o">}</span>
<span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Creamos una instancia <em>Client</em> ANTES de ejecutar cualquier test</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Cerramos el socket asociado a la conexión DESPUÉS de ejecutar TODOS los tests</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Liberamos la conexión para poder reutilizarla</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Liberamos la conexión para poder reutilizarla</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Ahora veamos otro ejemplo en el que utilizamos una instancia <em>Client</em> para cada test:</p>
</div>
<div class="listingblock">
<div class="title">Ejemplo de Test que utiliza una instancia <em>Client</em> para CADA test</div>
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span class="tok-kd">public</span> <span class="tok-kd">class</span> <span class="tok-nc">TestRESTServices</span> <span class="tok-o">{</span>

  <span class="tok-kd">private</span> <span class="tok-n">Client</span> <span class="tok-n">client</span><span class="tok-o">;</span>

  <span class="tok-nd">@Before</span>
  <span class="tok-kd">public</span> <span class="tok-kt">void</span> <span class="tok-nf">setUp</span><span class="tok-o">()</span> <span class="tok-o">{</span>
      <span class="tok-k">this</span><span class="tok-o">.</span><span class="tok-na">client</span> <span class="tok-o">=</span> <span class="tok-n">ClientBuilder</span><span class="tok-o">.</span><span class="tok-na">newClient</span><span class="tok-o">();</span> <i class="conum" data-value="1"></i><b>(1)</b>
  <span class="tok-o">}</span>

  <span class="tok-nd">@After</span>
  <span class="tok-kd">public</span> <span class="tok-kt">void</span> <span class="tok-nf">tearDown</span><span class="tok-o">()</span> <span class="tok-o">{</span>
      <span class="tok-k">this</span><span class="tok-o">.</span><span class="tok-na">client</span><span class="tok-o">.</span><span class="tok-na">close</span><span class="tok-o">();</span>  <i class="conum" data-value="2"></i><b>(2)</b>
  <span class="tok-o">}</span>

  <span class="tok-nd">@Test</span>
  <span class="tok-kd">public</span> <span class="tok-kt">void</span> <span class="tok-nf">getAllCustomersAsJson</span><span class="tok-o">()</span> <span class="tok-o">{</span>
     <span class="tok-n">String</span> <span class="tok-n">uriString</span> <span class="tok-o">=</span> <span class="tok-s">&quot;http://localhost:8080/rest/customers&quot;</span><span class="tok-o">;</span>
     <span class="tok-n">JsonArray</span> <span class="tok-n">json_array</span> <span class="tok-o">=</span> <span class="tok-n">client</span>
                <span class="tok-o">.</span><span class="tok-na">target</span><span class="tok-o">(</span><span class="tok-n">uriString</span><span class="tok-o">)</span>
                <span class="tok-o">.</span><span class="tok-na">request</span><span class="tok-o">(</span><span class="tok-n">MediaType</span><span class="tok-o">.</span><span class="tok-na">APPLICATION_JSON</span><span class="tok-o">)</span>
                <span class="tok-o">.</span><span class="tok-na">accept</span><span class="tok-o">(</span><span class="tok-n">MediaType</span><span class="tok-o">.</span><span class="tok-na">APPLICATION_JSON</span><span class="tok-o">)</span>
                <span class="tok-o">.</span><span class="tok-na">get</span><span class="tok-o">(</span><span class="tok-n">JsonArray</span><span class="tok-o">.</span><span class="tok-na">class</span><span class="tok-o">);</span>

     <span class="tok-n">Assert</span><span class="tok-o">.</span><span class="tok-na">assertEquals</span><span class="tok-o">(</span><span class="tok-mi">2</span><span class="tok-o">,</span> <span class="tok-n">json_array</span><span class="tok-o">.</span><span class="tok-na">size</span><span class="tok-o">());</span>
   <span class="tok-o">}</span>

   <span class="tok-nd">@Test</span>
   <span class="tok-kd">public</span> <span class="tok-kt">void</span> <span class="tok-nf">getAllCustomers</span><span class="tok-o">()</span> <span class="tok-o">{</span>
    <span class="tok-n">String</span> <span class="tok-n">uriString</span> <span class="tok-o">=</span> <span class="tok-s">&quot;http://localhost:8080/rest/customers&quot;</span><span class="tok-o">;</span>
    <span class="tok-c1">//Consultamos los datos de todos los customers</span>
    <span class="tok-n">List</span><span class="tok-o">&lt;</span><span class="tok-n">Customer</span><span class="tok-o">&gt;</span> <span class="tok-n">lista_usuarios</span> <span class="tok-o">=</span> <span class="tok-n">client</span><span class="tok-o">.</span><span class="tok-na">target</span><span class="tok-o">(</span><span class="tok-n">uriString</span><span class="tok-o">)</span>
                <span class="tok-o">.</span><span class="tok-na">request</span><span class="tok-o">(</span><span class="tok-s">&quot;application/json&quot;</span><span class="tok-o">)</span>
                <span class="tok-o">.</span><span class="tok-na">get</span><span class="tok-o">(</span><span class="tok-k">new</span> <span class="tok-n">GenericType</span><span class="tok-o">&lt;</span><span class="tok-n">List</span><span class="tok-o">&lt;</span><span class="tok-n">Customer</span><span class="tok-o">&gt;&gt;()</span> <span class="tok-o">{});</span>
    <span class="tok-n">Assert</span><span class="tok-o">.</span><span class="tok-na">assertEquals</span><span class="tok-o">(</span><span class="tok-mi">2</span><span class="tok-o">,</span> <span class="tok-n">lista_usuarios</span><span class="tok-o">.</span><span class="tok-na">size</span><span class="tok-o">());</span>
  <span class="tok-o">}</span>
<span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Creamos una instancia <em>Client</em> ANTES de ejecutar CADA test</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Cerramos el socket asociado a la conexión DESPUÉS de ejecutar CADA los tests</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Podemos ver en este último ejemplo que no es necesario liberar la conexión
entre usos sucesivos de la instancia <em>Client</em>, si no utilizamos la clase <em>Response</em>.
En este caso el proceso se realiza de forma automática por el sistema.</p>
</div>
<div class="paragraph">
<p>Finalmente comentaremos que, debido a un bug en la especificación JAX-RS, el deserializado del
de los objetos Link no se realiza, por lo que obendremos una lista
de Links vacía (ver <a href="http://kingsfleet.blogspot.com.es/2014/05/reading-and-writing-jax-rs-link-objects.html" class="bare">http://kingsfleet.blogspot.com.es/2014/05/reading-and-writing-jax-rs-link-objects.html</a>).
Podemos comprobar que, si obtenemos la representación en formato texto de la entidad del mensaje,
dicha lista de objetos tendrá el valor correcto.</p>
</div>
<div class="paragraph">
<p>Si no utilizamos la solución propuesta en el enlace anterior, deberemos usar
la anotación <code>@JsonIgnoreProperties(ignoreUnknown = true)</code>. De esta forma, ignoraremos el
deserializado de los objetos Link, pero tendremos que utilizar la representación en formato de
cadena de caracteres del recurso json, en lugar del objeto java <em>Link</em> asociado.</p>
</div>
<div class="paragraph">
<p>Así, por ejemplo, si nuestro recurso <em>Customer</em> tiene asociado una lista de objetos <em>Link</em>,
para poder utilizar el API Cliente y acceder a la lista de enlaces, usaremos la anotación
anterior en la implementación de la clase <em>Customer</em>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span class="tok-nd">@JsonIgnoreProperties</span><span class="tok-o">(</span><span class="tok-n">ignoreUnknown</span> <span class="tok-o">=</span> <span class="tok-kc">true</span><span class="tok-o">)</span>
<span class="tok-nd">@XmlRootElement</span><span class="tok-o">(</span><span class="tok-n">name</span><span class="tok-o">=</span><span class="tok-s">&quot;customer&quot;</span><span class="tok-o">)</span>
<span class="tok-kd">public</span> <span class="tok-kd">class</span> <span class="tok-nc">Customer</span> <span class="tok-o">{</span>
  <span class="tok-kt">int</span> <span class="tok-n">id</span><span class="tok-o">;</span>
  <span class="tok-n">String</span> <span class="tok-n">name</span><span class="tok-o">;</span>
  <span class="tok-o">...</span>
  <span class="tok-n">List</span><span class="tok-o">&lt;</span><span class="tok-n">Link</span><span class="tok-o">&gt;</span> <span class="tok-n">links</span><span class="tok-o">;</span>
  <span class="tok-o">...</span>
<span class="tok-o">}</span></code></pre>
</div>
</div>
<div style="page-break-after: always;"></div>
</div>
</div>
<div class="sect2">
<h3 id="_ejercicios">5.5. Ejercicios</h3>
<div class="sect3">
<h4 id="_tests_utilizando_el_api_cliente_y_un_mapeador_de_excepciones_1_punto">5.5.1. Tests utilizando el API cliente y un mapeador de excepciones (1 punto)</h4>
<div class="paragraph">
<p>Se proporciona como plantilla el MÓDULO IntelliJ "s5-tienda" con una implementación parcial
de una tienda de clientes on-line. Este proyecto ya contiene varios tests implementados, a modo
de ejemplo.</p>
</div>
<div class="paragraph">
<p>Los recursos rest implementados lanzan excepciones de tipo <code>RestException</code> si, por ejemplo se
intenta realizar una consulta sobre un producto y/o usuario que no existe.</p>
</div>
<div class="paragraph">
<p>Se ha implementado un mapeador de excepciones <code>RestExceptionMapper</code> que captura
excepciones de tipo <code>RuntimeException</code>, y devuelve una respuesta de tipo <code>ErrorMensajeBean</code> que
será serializada a formato json y/o formato
xml (dependiendo del valor de la cabecera <em>Accept</em> de la petición), con información sobre el
error producido.</p>
</div>
<div class="paragraph">
<p>Implementa los siguientes dos tests:
* <code>test7recuperarTodosLosUsuarios()</code>, en el que realizamos una invocación GET sobre
"http://localhost:8080/s5-tienda/rest/clientes/". Esta URI podría corresponderse con un
método anotado con @GET y que devolviese una lista de todos los clientes de la tienda.
Sin embargo, no existe tal método en nuestro recursos rest. Verifica que dicha invocación
devuelve el código de estado "500" (Internal Server Error), y que en el cuerpo del mensaje
se recibe "Servicio no disponible"</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>test8recuperarClienteQueNoExiste()</code>, en el que intentamos recuperar la información de
un cliente que no exista en nuestra base de datos. En este caso, debemos verificar que el mensaje
obtenido en formato json es el siguiente:</p>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="json"><span class="tok-p">{</span>
  <span class="tok-nt">&quot;status&quot;</span><span class="tok-p">:</span> <span class="tok-s2">&quot;Not Found&quot;</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;code&quot;</span><span class="tok-p">:</span> <span class="tok-mi">404</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;message&quot;</span><span class="tok-p">:</span> <span class="tok-s2">&quot;El producto no se encuentra en la base de datos&quot;</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;developerMessage&quot;</span><span class="tok-p">:</span> <span class="tok-s2">&quot;error&quot;</span>
<span class="tok-p">}</span></code></pre>
</div>
</div>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_tests_utilizando_el_api_json_y_junit_1_punto">5.5.2. Tests utilizando el API Json y JUnit (1 punto)</h4>
<div class="paragraph">
<p>Vamos a seguir usando el proyecto s4-foroAvanzado con el que hemos trabajado en la
sesión anterior.</p>
</div>
<div class="paragraph">
<p>Vamos a implementar algunos tests con JUnit en los que utilizaremos, además del
API cliente, el API Json, que nos proporciona jaxrs.</p>
</div>
<div class="paragraph">
<p>Para ejecutar los tests necesitamos modificar el pom.xml añadiendo las dependencias
correspondientes que hemos visto a lo largo de la sesión, y añadiendo las goals para
que se ejecuten los tests después de desplegar la aplicación en Wildfly.</p>
</div>
<div class="paragraph">
<p>Proporcionamos el contenido del <em>pom.xml</em> con las librerías y plugins que necesitarás (aunque como
ejercicio deberías intentar modificar la configuración tú mismo, y luego puedes comprobar el
resultado con el <em>pom.xml</em> que se proporciona). El contenido del nuevo pom.xml lo tienes en
/src/test/resources/nuevo-pom.mxl.</p>
</div>
<div class="sect4">
<h5 id="_inicialización_de_los_datos_para_los_tests">Inicialización de los datos para los tests</h5>
<div class="paragraph">
<p>Vamos a utilizar DBUnit para inicializar la BD para realizar los tests. Para ello tendrás que
añadir en el pom.xml las dependencias necesarias (ya están añadidas en el fichero de
configuración proporcionado). En el fichero <em>src/test/resources/foro-inicial.xml</em> encontraréis
el conjunto de datos con el que inicializaremos la base de datos para ejecutar nuestros tests.</p>
</div>
<div class="paragraph">
<p>No es necesario (aunque es una muy buena práctica) que inicialicemos la BD para cada test.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_implementación_de_los_tests">5.5.3. Implementación de los tests</h4>
<div class="paragraph">
<p>Vamos a implementar los siguientes tests (que se ejecutarán en en este mismo orden):</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>test1ConsultaTodosUsuarios()</code>: recuperamos los datos de todos los usuarios del foro. Recuerda
que previamente tienes que haber inicializado la BD con los datos del fichero <em>foro-inicial.xml</em>.
Recupera los datos en forma de JsonObject y comprueba que el número de usuarios es el correcto.
También debes comprobar que tanto el login, como los enlaces hatehoas para cada usuario están
bien creados. En concreto, para cada usuario, debes verificar que la uri ("uri"), el tipo mime ("type"),
y el tipo de enlace ("rel") son los correctos.</p>
</li>
<li>
<p><code>test2CreamosMensajeDePepe()</code>: crearemos un nuevo mensaje del usuario con login "pepe". Recuerda
que este usuario tiene el rol "registrado". El mensaje tendrá el asunto "cena", y el texto será:
"Mejor me voy al cine". En este caso, deberás comprobar el valor de estado (debe ser 201), y
debes recuperar (consultar con una petición REST) el mensaje para comprobar que la operación de
insertar el mensaje ha tenido éxito.</p>
</li>
<li>
<p><code>test3CreamosMensajeDeUsuarioNoAutorizado()</code>: creamos un nuevo mensaje de un usuario que no está
autorizado (por ejemplo, de un usuario con login "juan"). En este caso el mensaje tendrá el asunto
"cena", y el mensaje puede ser: "Pues yo tampoco voy". El resultado debe ser el código de estado 401 (
Unauthorized)</p>
</li>
<li>
<p><code>test4ConsultaUsuario()</code>: Consultamos los datos del usuario "pepe". Recuperaremos los datos como
un JsonObject, y comprobaremos que el valor de la "uri" para el tipo de relación "self" del enlace
<em>Link</em> asociado es el correcto</p>
</li>
</ul>
</div>
</div>
</div>
</div>
</div>
</div>
<div id="footer">
<div id="footer-text">
Last updated 2015-10-15 10:06:27 CEST
</div>
</div>
</body>
</html>