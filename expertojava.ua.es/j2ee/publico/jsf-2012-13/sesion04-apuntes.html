<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<META http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta content="Apache Forrest" name="Generator">
<meta name="Forrest-version" content="0.7">
<meta name="Forrest-skin-name" content="pelt">
<title>Internacionalizaci&oacute;n. Menajes Flash. RichFaces: una librer&iacute;a de componentes profesional</title>
<link type="text/css" href="skin/highlight/shCore.css" rel="stylesheet">
<link type="text/css" href="skin/highlight/shThemeEclipse.css" rel="stylesheet">
<script src="skin/highlight/shCore.js" type="text/javascript"></script><script src="skin/highlight/shAutoloader.js" type="text/javascript"></script>
<link type="text/css" href="skin/basic.css" rel="stylesheet">
<link media="screen" type="text/css" href="skin/screen.css" rel="stylesheet">
<link media="print" type="text/css" href="skin/print.css" rel="stylesheet">
<link type="text/css" href="skin/profile.css" rel="stylesheet">
<script src="skin/getBlank.js" language="javascript" type="text/javascript"></script><script src="skin/getMenu.js" language="javascript" type="text/javascript"></script><script src="skin/fontsize.js" language="javascript" type="text/javascript"></script>
<link rel="shortcut icon" href="">
</head>
<body onload="init()">
<script type="text/javascript">ndeSetTextSize();</script>
<div id="top">
<div class="header">
<div class="grouplogo">
<a href="http://web.ua.es/especialistajava"><img class="logoImage" alt="jtech" src="images/baner_j2ee_izq.gif" title="Experto Universitario Java Enterprise"></a>
</div>
<div class="projectlogoA1">
<a href="../../../../www.jtech.ua.es/index.html"><img class="logoImage" alt="Componentes de presentaci&oacute;n" src="images/baner_j2ee_der.gif" title="Componentes de presentaci&oacute;n"></a>
</div>
<ul id="tabs">
<li>
<a class="base-not-selected" href="javascript:location.href='../index.html'">Home</a>
</li>
<li>
<a class="base-not-selected" href="javascript:location.href='../aplic-web.html'">Aplicaciones Web</a>
</li>
<li>
<a class="base-not-selected" href="javascript:location.href='../aplic-ent.html'">Aplicaciones Enterprise</a>
</li>
<li>
<a class="base-not-selected" href="javascript:location.href='../proy-int/index.html'">Proyecto</a>
</li>
<li class="current">
<a class="base-selected" href="index.html">JSF</a>
</li>
</ul>
</div>
</div>
<div id="main">
<div id="publishedStrip">
<div id="level2tabs"></div>
<script type="text/javascript"><!--
document.write("<text>Last Published:</text> " + document.lastModified);
//  --></script>
</div>
<div class="breadtrail">
             
             &nbsp;
           </div>
<div id="menu">
<div onclick="SwitchMenu('menu_selected_1.1', 'skin/')" id="menu_selected_1.1Title" class="menutitle" style="background-image: url('skin/images/chapter_open.gif');">Componentes de presentacion</div>
<div id="menu_selected_1.1" class="selectedmenuitemgroup" style="display: block;">
<div class="menuitem">
<a href="index.html" title="Componentes de presentaci&oacute;n">&Iacute;ndice</a>
</div>
<div onclick="SwitchMenu('menu_selected_1.1.2', 'skin/')" id="menu_selected_1.1.2Title" class="menutitle" style="background-image: url('skin/images/chapter_open.gif');">Teor&iacute;a</div>
<div id="menu_selected_1.1.2" class="selectedmenuitemgroup" style="display: block;">
<div class="menuitem">
<a href="sesion01-apuntes.html">Sesion 1</a>
</div>
<div class="menuitem">
<a href="sesion02-apuntes.html">Sesion 2</a>
</div>
<div class="menuitem">
<a href="sesion03-apuntes.html">Sesion 3</a>
</div>
<div class="menupage">
<div class="menupagetitle">Sesion 4</div>
</div>
</div>
<div onclick="SwitchMenu('menu_1.1.3', 'skin/')" id="menu_1.1.3Title" class="menutitle">Ejercicios</div>
<div id="menu_1.1.3" class="menuitemgroup">
<div class="menuitem">
<a href="sesion01-ejercicios.html">Sesion 1</a>
</div>
<div class="menuitem">
<a href="sesion02-ejercicios.html">Sesion 2</a>
</div>
<div class="menuitem">
<a href="sesion03-ejercicios.html">Sesion 3</a>
</div>
<div class="menuitem">
<a href="sesion04-ejercicios.html">Sesion 4</a>
</div>
</div>
</div>
<div id="credit"></div>
<div id="roundbottom">
<img style="display: none" class="corner" height="15" width="15" alt="" src="skin/images/rc-b-l-15-1body-2menu-3menu.png"></div>
<div id="credit2"></div>
</div>
<div id="content">
<div title="Portable Document Format" class="pdflink">
<a class="dida" href="sesion04-apuntes.pdf"><img alt="PDF -icon" src="skin/images/pdfdoc.gif" class="skin"><br>
        PDF</a>
</div>
<h1>Internacionalizaci&oacute;n. Menajes Flash. RichFaces: una librer&iacute;a de componentes profesional</h1>
<div id="minitoc-area">
<ul class="minitoc">
<li>
<a href="#Mensajes+e+internacionalizaci%C3%B3n">Mensajes e internacionalizaci&oacute;n</a>
<ul class="minitoc">
<li>
<a href="#Mensajes+con+partes+variables">Mensajes con partes variables</a>
</li>
<li>
<a href="#A%C3%B1adiendo+un+segundo+idioma">A&ntilde;adiendo un segundo idioma</a>
</li>
<li>
<a href="#Cambiando+de+idioma">Cambiando de idioma</a>
</li>
</ul>
</li>
<li>
<a href="#Mensajes+Flash">Mensajes Flash</a>
</li>
<li>
<a href="#Introducci%C3%B3n+a+RichFaces">Introducci&oacute;n a RichFaces</a>
</li>
<li>
<a href="#Skins">Skins</a>
</li>
<li>
<a href="#Peticiones+Ajax+y+ciclo+de+vida">Peticiones Ajax y ciclo de vida</a>
<ul class="minitoc">
<li>
<a href="#Componentes+Ajax">Componentes Ajax</a>
</li>
<li>
<a href="#Redibujado+de+componentes">Redibujado de componentes</a>
</li>
</ul>
</li>
<li>
<a href="#Algunos+ejemplos+de+componentes">Algunos ejemplos de componentes </a>
<ul class="minitoc">
<li>
<a href="#Pick+List">Pick List</a>
</li>
<li>
<a href="#Panel+modal">Panel modal</a>
</li>
<li>
<a href="#Data+Grid">Data Grid</a>
</li>
<li>
<a href="#Google+map">Google map</a>
</li>
<li>
<a href="#Tab+panel">Tab panel</a>
</li>
</ul>
</li>
<li>
<a href="#Referencias">Referencias</a>
</li>
</ul>
</div>


<a name="N1000C"></a><a name="Mensajes+e+internacionalizaci%C3%B3n"></a>
<h2 class="underlined_10">Mensajes e internacionalizaci&oacute;n</h2>
<div class="section">
<p>Cuando creamos una aplicaci&oacute;n web, es una buena idea colocar todos los mensajes en una mima 
	localizaci&oacute;n central. Este proceso hace que sea m&aacute;s facil, entre otras cosas, internacionalizar 
	la aplicaci&oacute;n a otros idiomas.</p>
<p>Estos mensajes se guardar&aacute;n en un fichero <span class="codefrag">properties</span>, guardando las cadenas 
	de una forma ya conocida por todos a estas alturas del curso:</p>
<pre class="brush:java;">login_nombre=Nombre de usuario: 
login_password=Contrase&ntilde;a: </pre>
<p>Este fichero se puede guardar donde sea, pero es muy importante que tenga la extensi&oacute;n 
	<span class="codefrag">.properties</span> (ej: <span class="codefrag">src/es/ua/jtech/i18n/messages.properties</span>)</p>
<p>Para indicar el fichero de recursos que vamos a emplear, podemos hacerlo de dos maneras. La m&aacute;s 
	f&aacute;cil es indicarlo en el fichero <span class="codefrag">faces-config.xml</span>, dentro del directorio <span class="codefrag">WEB-INF</span>, 
	de la siguiente manera: </p>
<pre class="brush:xml;">&lt;?xml version="1.0"?&gt;
&lt;faces-config xmlns="http://java.sun.com/xml/ns/javaee"
   xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" 
   xsi:schemaLocation="http://java.sun.com/xml/ns/javaee
      http://java.sun.com/xml/ns/javaee/web-facesconfig_2_0.xsd" version="2.0"&gt;
  &lt;application&gt;
    &lt;resource-bundle&gt;
      &lt;base-name&gt;es.ua.jtech.i18n.messages&lt;/base-name&gt; 
      &lt;var&gt;msgs&lt;/var&gt;
    &lt;/resource-bundle&gt;
  &lt;/application&gt;
  &lt;/faces-config&gt;</pre>
<p>En lugar de usar una declaraci&oacute;n global del fichero de recursos, podemos a&ntilde;adir el elemento 
  <span class="codefrag">f:loadBundle</span> a cada p&aacute;gina JSF que necesite acceso a los recursos. Ejemplo:</p>
<pre class="brush:xml;">&lt;f:loadBundle basename="es.ua.jtech.messages" var="msgs"/&gt;</pre>
<p>En cualquiera de los casos, los mensajes son accesibles a trav&eacute;s de un mapa, con el nombre <span class="codefrag">msgs</span>.</p>
<p>A partir de este momento, podremos usar expresiones como <span class="codefrag">#{msgs.login_nombre}</span> para acceder a las cadenas de los mensajes.</p>
<a name="N1004E"></a><a name="Mensajes+con+partes+variables"></a>
<h3 class="underlined_5">Mensajes con partes variables</h3>
<p>Muchas veces, los mensajes tienen partes variables que no se pueden rellenar a la hora de declarrar 
  	el fichero de recursos. Imaginemos por ejemplo un marcador de puntuaci&oacute;n con la frase <em>Tienes <strong>n</strong> puntos</em>, donde <em>n</em> 
  	es un valor devuelto por un bean. En este caso, en nuestro fichero de recursos haremos un String con un <em>placeholder</em>:</p>
<pre class="brush:java;">tuPuntuacion=Tienes {0} puntos.</pre>
<p>Los <em>placeholders</em> se numeran partiendo del cero. En nuestra p&aacute;gina JSF, usaremos el tag 
  	<span class="codefrag">h:outputFormat</span>, introduciendo como hijos tantos <span class="codefrag">f:param</span> como placeholders haya:</p>
<pre class="brush:xml;">&lt;h:outputFormat value="#{msgs.tuPuntuacion}"&gt;
   &lt;f:param value="#{marcadorBean.puntos}"/&gt;
&lt;/h:outputFormat&gt;</pre>
<p>El tag <span class="codefrag">h:outputFormat</span> usa la clase MessageFormat de la librer&iacute;a est&aacute;ndar para formatear 
	el mensaje.</p>
<a name="N10080"></a><a name="A%C3%B1adiendo+un+segundo+idioma"></a>
<h3 class="underlined_5">A&ntilde;adiendo un segundo idioma</h3>
<p>Cuando localizamos un fichero de recursos, debemos a&ntilde;adir un sufijo de <em>locales</em> al nombre del fichero: 
  	un gui&oacute;n bajo seguido del c&oacute;digo de dos letras ISO-639 en min&uacute;sculas. Por ejemplo, las cadenas en ingl&eacute;s estar&iacute;an en 
  	el fichero <span class="codefrag">messages_en.properties</span> y las cadenas en alem&aacute;n en el fichero <span class="codefrag">messages_de.properties</span>.</p>
<p>Como parte del soporte de internacionalizaci&oacute;n en Java, el fichero de recursos que coincida con 
  	el locale actual se cargar&aacute; autom&aacute;ticamente. El fichero por defecto sin sufijo de locale se usar&aacute; como alternativa si no hay 
  	un locale espec&iacute;fico para un idioma dado</p>
<a name="N10096"></a><a name="Cambiando+de+idioma"></a>
<h3 class="underlined_5">Cambiando de idioma</h3>
<p>Ahora que ya sabemos que podemos tener un fichero de recursos por idioma y c&oacute;mo introducir variables en 
  	determinados mensajes, tenemos que decidir c&oacute;mo establecer el locale de nuestra aplicaci&oacute;n. Tenemos tres opciones:</p>
<ol>
  		
<li>Podemos dejar al navegador que escoja el locale. Estableceremos el locale por defecto y los idiomas soportados en el fichero <span class="codefrag">WEB-INF/faces-config.xml:</span>
  		
<pre class="brush:xml;">&lt;faces-config&gt;
  &lt;application&gt;
    &lt;locale-config&gt;
      &lt;default-locale&gt;en&lt;/default-locale&gt;
      &lt;supported-locale&gt;de&lt;/supported-locale&gt;
    &lt;/locale-config&gt;
  &lt;/application&gt;
&lt;/faces-config&gt;</pre>
		Cuando el navegador se conecta a nuestra aplicaci&oacute;n, normalemente incluye un valor <span class="codefrag">Accept-Language</span> 
		en las cabeceras HTTP. La implementaci&oacute;n de JSF lee este header y averigua la que mejor casa de entre 
		la lista de idiomas soportados. Esta caracter&iacute;stica se puede probar f&aacute;cilmente si cambias el idioma 
		predeterminado en tu navegador web.
  		</li>
  		
  		
<li>Tambi&eacute;n podemos establecer el idioma de manera programada. Esto se consigue llamando al 
  		m&eacute;todo <span class="codefrag">setLocale</span> del objeto<span class="codefrag">UIViewRoot</span>.
  		<pre class="brush:java;">UIViewRoot viewRoot = FacesContext.getCurrentInstance().getViewRoot(); 
viewRoot.setLocale(new Locale("de"));</pre>
  		
</li>
  		
  		
<li>Por &uacute;ltimo, podemos establecer el idioma de una p&aacute;gina determinada si usamos el elemento 
  		<span class="codefrag">f:view</span> con un atributo <span class="codefrag">locale</span>. Por ejemplo:
  		<pre class="brush:xml;">&lt;f:view locale="de"&gt;</pre>
  		Podemos convertirlo en algo din&aacute;mico si el atributo <span class="codefrag">locale</span> se vincula a una variable:
  		<pre class="brush:xml;">&lt;f:view locale="#{langController.lang}"&gt;</pre>
  		Esta &uacute;ltima opci&oacute;n es muy &uacute;til en aquellas aplicaciones en que dejamos al usuario elegir un idioma determinado.
  		</li>
  	
</ol>
<div class="frame warning">
<div class="label">Aviso</div>
<div class="content">Si optamos por este &uacute;ltimo m&eacute;todo, tendremos que meter toda nuestra p&aacute;gina dentro de <span class="codefrag">f:view</span>
</div>
</div>
</div>

<p class="pageBreakAfter"></p>

<a name="N100DE"></a><a name="Mensajes+Flash"></a>
<h2 class="underlined_10">Mensajes Flash</h2>
<div class="section">
<p>Desde JSF 2.0, se ha incluido un objeto <em>flash</em>, que puede declararse en una petici&oacute;n 
	y ser usado en la siguiente. Este concepto se ha tomado prestado del <em>framework</em> Ruby on Rails. 
	Un uso com&uacute;n que se le da al objeto flash es para el paso de mensajes. Por ejemplo: un controlador puede poner 
	un mensaje en el flash:</p>
<pre class="brush:java;">ExternalContext.getFlash().put("message", "Campo actualizado correctamente");</pre>
<p>El m&eacute;todo <span class="codefrag">ExternalContext.getFlash()</span> devuelve un objeto de la clase <span class="codefrag">Flash</span> que implementa un <span class="codefrag">Map&lt;String, Object&gt;</span>
</p>
<p>En nuestra p&aacute;gina JSF, podemos referenciar el objeto flash mediante la variable <span class="codefrag">flash</span>. 
	Por ejemplo, podemos mostrar el mensaje de la siguiente manera: </p>
<pre class="brush:xml;">#{flash.message}</pre>
<p>Una vez el mensaje se ha renderizado y la vista ha sido enviada al cliente, la cadena se elimina autom&aacute;ticamente del flash.</p>
<p>Si queremos mantener el valor del flash para m&aacute;s de una petici&oacute;n, podemos hacerlo invoc&aacute;ndolo de la siguiente manera:</p>
<pre class="brush:xml;">#{flash.keep.message}</pre>
<p>De esta manera, el valor de mensaje se a&ntilde;adir&aacute; nuevamente al flash, pudiendo ser utilizado en la pr&oacute;xima petici&oacute;n.</p>
</div>


<a name="N10117"></a><a name="Introducci%C3%B3n+a+RichFaces"></a>
<h2 class="underlined_10">Introducci&oacute;n a RichFaces</h2>
<div class="section">
<p>RichFaces surgi&oacute; como un framework desarrollado por la compa&ntilde;&iacute;a
Exadel orientado a introducir Ajax en JSF. De hecho, su primer nombre
fue Ajax2jsf y ahora algunas etiquetas tienen el
prefijo <span class="codefrag">a4j</span>. Exadel lanz&oacute; el framework en marzo de
2006. A finales de a&ntilde;o, el framework se dividi&oacute; en 2 partes
llamados <em>Rich Faces</em>, que define los componentes propiamente
dichos, y <em>Ajax4jsf</em>, que define las etiquetas espec&iacute;ficas que
dan soporte a Ajax. La primera parte se hizo comercial y la segunda se
convirti&oacute; en un proyecto opensource en Java.net.</p>
<p>En marzo de 2007, JBoss (ahora parte de Red Hat) y Exadel firmaron
un acuerdo por el que ambos frameworks ser&iacute;an distribuidos y
utilizados por JBoss y ser&iacute;an gratuitos y opensource. En septiembre de
2007, JBoss y Exadel decidieron unirlos en un &uacute;nico producto llamado
RichFaces. Esta decisi&oacute;n ha facilitado el mantenimiento de ambos
productos y el lanzamiento de nuevas versiones.</p>
<p>En la actualidad, RichFaces es una parte fundamental del framework
Seam propuesto por JBoss. Este framework incluye un <em>stack</em> de
tecn&oacute;log&iacute;as Java EE formado por JSF, JPA, EJB 3.0 y BPM (Business
Pocess Management) adem&aacute;s de plug-ins para Eclipse para facilitar su
desarrollo.</p>
<p>Entrando en algo de detalle sobre sus caracter&iacute;sticas t&eacute;cnicas,
podemos decir que trabaja sobre JSF, ampliando su ciclo de vida y sus
funcionalidades de conversi&oacute;n y de validaci&oacute;n mediante la introducci&oacute;n
de Ajax. Los componentes RichFaces llevan incluido soporte Ajax y un
look-and-feel altamente customizable que puede ser f&aacute;cilmente
integrado en la aplicaci&oacute;n JSF. Las caracter&iacute;sticas m&aacute;s importantes
son:</p>
<ul>
   
<li>Integraci&oacute;n de Ajax en el ciclo de vida JSF. Mientras que otros
   frameworks s&oacute;lo utilizan las funcionalidades de JSF de acceso a los
   beans gestionados, RichFaces utiliza la gesti&oacute;n de eventos de JSF para
   integrar Ajax. En concreto, hace posible la invocaci&oacute;n de
   validadores y conversores en el lado del cliente cuando se utiliza
   Ajax en los manejadores de eventos de acci&oacute;n y eventos de cambio de
   valor.</li>

   
<li>Posibilidad de a&ntilde;adir capacidades de Ajax a las aplicaciones
   JSF existentes. El framework proporciona dos librer&iacute;as de
   componentes: Core Ajax y UI. La librer&iacute;a de Core Ajax permite
   utilizar las funcionalidades de Ajax en las p&aacute;ginas existentes, de
   forma que no hay necesidad de escribir nada de c&oacute;digo Javascript ni
   de reemplazar los componentes existentes con los nuevos componentes
   Ajax. RichFaces permite soporte de Ajax a nivel de p&aacute;gina, en lugar
   del tradicional soporte a nivel de componente y ello hace posible
   definir los eventos en la p&aacute;gina. Un evento invoca una petici&oacute;n
   Ajax al servidor, se ejecuta esta petici&oacute;n y se cambian ciertos
   valores del modelo y es posible indicar qu&eacute; partes de la p&aacute;gina (y
   del &aacute;rbol de componentes) deben ser renderizados de nuevo. </li>

   
<li>Posiblidad de crear vistas complejas creadas a partir de un
   amplio conjunto de componentes listos para ser utilizados. Se
   extiende el n&uacute;cleo de componentes JSF con una amplia librer&iacute;a de
   componentes con capacidades Ajax que incluyen tambi&eacute;n soporte para
   definir skins. Adem&aacute;s, los componentes JSF est&aacute;n dise&ntilde;ados para
   poder ser utilizados con componentes de terceros en la misma
   p&aacute;gina.</li>

   
<li>Soporte para la creaci&oacute;n de componentes con Ajax
   incorporado. RichFaces pone a disposici&oacute;n de los desarrolladores
   el <em>Component Development Kit</em> (CDK) utilizado para la
   creaci&oacute;n de los componentes de la librer&iacute;a. El CDK incluye una
   herramienta de generaci&oacute;n de c&oacute;digo y una utilidad de templates con
   una sintaxis similar a JSP. </li>

   
<li>Los recursos se empaquetan junto con las clases Java de la
   aplicaci&oacute;n. Adem&aacute;s de sus funcionalidades b&aacute;sicas, las facilidades
   de Ajax de RichFaces proporcionan la posibilidad de gestionar tres
   tipos de recursos: im&aacute;genes, c&oacute;digo Javascript y hojas de estilo
   CSS. El framework de recursos hace posible empaquetar estos
   recursos en ficheros Jar junto con el c&oacute;digo de los componentes de
   la aplicaci&oacute;n.</li>

   
<li>Facilidades para generar recursos en caliente. El framework de
   recursos puede generar im&aacute;genes, sonidos, hojas de c&aacute;lculo Excel,
   etc. en caliente, a partir de datos proporcionados por el
   usuario.</li>

   
<li>
<strong>Skins</strong>. RichFaces proporciona la posibilidad de
   configurar los componentes en base a skins que agrupan
   caracter&iacute;sticas visuales como fuentes o esquemas de color. Es
   posible tambi&eacute;n acceder a los par&aacute;metros del skin a partir del
   c&oacute;digo Java y de la configuraci&oacute;n de la p&aacute;gina. RichFaces
   proporciona un conjunto de skins predefinidos, pero es posible
   ampliarlos con skins creados por nosotros. </li>

</ul>
</div>


<a name="N10153"></a><a name="Skins"></a>
<h2 class="underlined_10">Skins</h2>
<div class="section">
<p>Una de las funcionalidades de RichFaces son los skins. Es posible
modificar el aspecto de todos los componentes cambiando una &uacute;nica
constante del framework. En concreto, el skin a utilizar en la
aplicaci&oacute;n se define en el fichero <span class="codefrag">web.xml</span> con el
par&aacute;metro <span class="codefrag">org.richfaces.SKIN</span>:</p>
<pre class="brush:xml;">&lt;context-param&gt;
   &lt;param-name&gt;org.richfaces.SKIN&lt;/param-name&gt;
   &lt;param-value&gt;wine&lt;/param-value&gt;
&lt;/context-param&gt;</pre>
<p>Los posibles valores de este par&aacute;metro son:</p>
<pre class="brush:text plain;">DEFAULT
plain
emeraldTown
blueSky
wine
japanCherry
ruby
classic
deepMarine</pre>
<p>Los skins definen el color y los fuentes tipogr&aacute;ficos de los
componentes aplicando valores a constantes que se aplican con hojas de
estilo a las p&aacute;ginas HTML resultantes. Estas constantes est&aacute;n bastante
bien pensadas, y dan coherencia al aspecto de todos los
componentes. Por ejemplo, la
constante <span class="codefrag">headerGradientColor</span> define el color de
gradiente de todas las cabeceras y <span class="codefrag">generalTextColor</span>
define el color por defecto del texto de todos los componentes.</p>
<p>Para m&aacute;s informaci&oacute;n sobre las caracter&iacute;sticas de los skins, c&oacute;mo
utilizarlos y c&oacute;mo definir nuevos, se puede consultar
el <a href="http://docs.jboss.org/richfaces/latest_3_3_X/en/devguide/html/ArchitectureOverview.html">apartado
sobre skins</a> de la gu&iacute;a de desarrollo (versi&oacute;n 3.0).</p>
</div>


<a name="N10180"></a><a name="Peticiones+Ajax+y+ciclo+de+vida"></a>
<h2 class="underlined_10">Peticiones Ajax y ciclo de vida</h2>
<div class="section">
<p>Una de las caracter&iacute;sticas fundamentales de RichFaces es la forma
de tratar los eventos JavaScript y de incorporarlos en el ciclo de
vida JSF.</p>
<p>Con el soporte Ajax de JSF es posible lanzar peticiones Ajax al
ciclo de vida JSF desde cualquier componente, no s&oacute;lo desde los
componentes <span class="codefrag">&lt;command&gt;</span>. A diferencia de una petici&oacute;n
JSF, una petici&oacute;n Ajax hace que el navegador redibuje todos los
componentes de la p&aacute;gina actual, sino s&oacute;lo los que nos interesan.</p>
<p>La figura siguiente muestra el ciclo de proceso de una petici&oacute;n Ajax:</p>
<p>

<img alt="" content-width="10cm" src="imagenes/tema04/richfaces-ciclo-vida.png" width="600">
</p>
<ol>
   
<li>La p&aacute;gina o el componente genera un evento JavaScript que es
   capturado por el motor de Ajax y por el manejador que definimos en
   la p&aacute;gina.</li>

   
<li>Se env&iacute;a la petici&oacute;n al servidor, con todos los atributos
   existentes en la p&aacute;gina, como una petici&oacute;n JSF normal.</li>

   
<li>En el servidor se lanzan todas las fases del ciclo de vida JSF
   (conversi&oacute;n, validaci&oacute;n, actualizaci&oacute;n del modelo y lanzamiento de
   acciones y el redibujado de la respuesta), pero la respuesta no se
   devuelve al navegador, sino al motor de Ajax.</li>

   
<li>El motor de Ajax actualiza s&oacute;lo aquellas partes de la p&aacute;gina
   del navegador que le hemos indicando, modific&aacute;ndolas con las partes
   obtenidas en la respuesta JSF.</li>

</ol>
<a name="N101AA"></a><a name="Componentes+Ajax"></a>
<h3 class="underlined_5">Componentes Ajax</h3>
<p>Existen bastantes componentes RichFaces con distintos
comportamientos. Los m&aacute;s usados para enviar peticiones Ajax
son <span class="codefrag">&lt;a4j:commandButton&gt;</span>
y <span class="codefrag">&lt;a4j:commandLink&gt;</span>, que env&iacute;an una petici&oacute;n cuando
el usuario pulsa un bot&oacute;n (similares a los <span class="codefrag">h:command</span>)
y <span class="codefrag">&lt;a4j:support&gt;</span> que se incluye en otro componente
JSF y permite enviar una petici&oacute;n Ajax al servidor cuando sucede un
determinado evento Javascript en el componente.</p>
<p>El siguiente c&oacute;digo muestra un ejemplo de uso
de <span class="codefrag">a4j:commandButton</span>:</p>
<pre class="brush:xml;">&lt;a4j:commandButton value="Enviar" action="#{bean.doAction}"/&gt;</pre>
<p>Vemos que es id&eacute;ntico al
componente <span class="codefrag">h:commandButton</span>. El
atributo <span class="codefrag">value</span> define el texto que aparece en el bot&oacute;n. Y
el atributo <span class="codefrag">action</span> apunta al m&eacute;todo <span class="codefrag">doAction</span>
del bean hace de controlador. La diferencia con
el <span class="codefrag">h:commandButton</span> es la comentada anteriormente. En una
petici&oacute;n est&aacute;ndar JSF la p&aacute;gina resultante se devuelve al navegador y
&eacute;ste la vuelve a pintar por completo. En una petici&oacute;n Ajax, el
servidor devuelve la p&aacute;gina resultante al motor Ajax, y es &eacute;ste el que
decide lo que hay que pintar en la p&aacute;gina.</p>
<p>En el apartado siguiente explicaremos c&oacute;mo decidir qu&eacute; partes de la
p&aacute;gina se deben pintar de nuevo con la petici&oacute;n Ajax.</p>
<p>Otro componente Ajax muy usado
es <span class="codefrag">&lt;a4j:support&gt;</span>. Se puede definir dentro de
cualquier componente JSF y permite capturar los eventos Javascript
HTML soportados por ese componente y generar una petici&oacute;n Ajax. Por
ejemplo:</p>
<pre class="brush:xml;">&lt;h:inputText value="#{user.name}"&gt;
    &lt;a4j:support event="onkeyup" action="#{bean.doAction}"/&gt;
&lt;/h:inputText&gt;</pre>
<p>En este caso se captura el evento Javascript <span class="codefrag">onkeyup</span>
del <span class="codefrag">&lt;h:inputText&gt;</span> y se env&iacute;a la petici&oacute;n Ajax al
servidor para ejecutar el m&eacute;todo <span class="codefrag">doAction</span> del bean.</p>
<p>Los eventos soportados por <span class="codefrag">&lt;a4j:support&gt;</span> son los
posibles eventos javascript del componente padre:</p>
<ul>
   
<li>
<strong><span class="codefrag">onblur</span></strong>: evento generado cuando el
   elemento pierde el foco.</li>

   
<li>
<strong><span class="codefrag">onchange</span></strong>: evento generado cuando
   el elemento pierdo el foco y se ha modificado su valor.</li>

   
<li>
<strong><span class="codefrag">onclick</span></strong>: evento generado cuando
   se hace un click con el rat&oacute;n sobre el elemento.</li>

   
<li>
<strong><span class="codefrag">ondblclick</span></strong>: evento generado
   cuando se hace un doble click con el rat&oacute;n sobre el elemento.</li>

   
<li>
<strong><span class="codefrag">onfocus</span></strong>: evento generado cuando
   el elemento recibe el foco.</li>

   
<li>
<strong><span class="codefrag">onkeydown</span></strong>: evento generado cuando
   se pulsa una tecla sobre el elemento.</li>

   
<li>
<strong><span class="codefrag">onkeypress</span></strong>: evento generado
   cuando se pulsa y se suelta una tecla sobre el elemento.</li>

   
<li>
<strong><span class="codefrag">onkeyup</span></strong>: evento generado cuando
   se suelta una tecla sobre el elemento.</li>

   
<li>
<strong><span class="codefrag">onmousedown</span></strong>: evento generado
   cuando se pulsa el rat&oacute;n sobre el elemento.</li>

   
<li>
<strong><span class="codefrag">onmousemove</span></strong>: evento generado
   cuando se mueve el rat&oacute;n dentro del elemento.</li>

   
<li>
<strong><span class="codefrag">onmouseout</span></strong>: evento generado
   cuando se saca el rat&oacute;n fuera del elemento.</li>

   
<li>
<strong><span class="codefrag">onmouseover</span></strong>: evento generado
   cuando se entra con el rat&oacute;n dentro del elemento.</li>

   
<li>
<strong><span class="codefrag">onmouseup</span></strong>: evento generado cuando
   el bot&oacute;n del rat&oacute;n se suelta dentro del elemento.</li>

   
<li>
<strong><span class="codefrag">onselect</span></strong>: evento generado cuando
   se selecciona texto dentro del elemento.</li>

</ul>
<p>Adem&aacute;s de los dos componentes vistos anteriormente, RichFaces
proporciona otros componentes que generan eventos Ajax. En
la <a href="http://www.jboss.org/richfaces/docs.html">gu&iacute;a
de desarrollo de RichFaces</a> se encuentra una explicaci&oacute;n detallada
de su uso.</p>
<ul>
   
<li>
<strong><span class="codefrag">&lt;a4j:ajaxListener&gt;</span></strong>: se
   utiliza dentro de otro componente Ajax para declarar manejadores de
   eventos de JSF igual que <span class="codefrag">&lt;f:actionListener&gt;</span>
   o <span class="codefrag">&lt;f:valueChangeListener&gt;</span>.</li>
	
   
<li>
<strong><span class="codefrag">&lt;a4j:keepAlive&gt;</span></strong>: permite
   mantener el estado de los beans entre distintas peticiones.</li>

   
<li>
<strong><span class="codefrag">&lt;a4j:actionparam&gt;</span></strong>: combina
   la funcionalidad de <span class="codefrag">&lt;f:param&gt;</span>
   y <span class="codefrag">&lt;f:actionListener&gt;</span>.</li>

   
<li>
<strong><span class="codefrag">&lt;a4j:form&gt;</span></strong>: es muy similar
   al mismo componente de la librer&iacute;a HTML de JSF, proporcionando
   adem&aacute;s las funcionalidades de generaci&oacute;n de enlaces y la
   posibilidad de petici&oacute;n Ajax por defecto.</li>

   
<li>
<strong><span class="codefrag">&lt;a4j:htmlCommandLink&gt;</span></strong>: es
   muy similar al mismo componente JSF HTML, pero resuelve algunos de
   sus problemas cuando se usa con Ajax.</li>

   
<li>
<strong><span class="codefrag">&lt;a4j:jsFunction&gt;</span></strong>: permite
   obtener datos del en el servidor en forma de objetos JSON y lanzar
   una funci&oacute;n Javascript con ellos.</li>

   
<li>
<strong><span class="codefrag">&lt;a4j:include&gt;</span></strong>: se usa para
   incluir c&oacute;digo HTML en las p&aacute;ginas.</li>

   
<li>
<strong><span class="codefrag">&lt;a4j:loadBundle&gt;</span></strong>: se usa
   para cargar un conjunto de recursos.</li>

   
<li>
<strong><span class="codefrag">&lt;a4j:log&gt;</span></strong>: abre una ventana
   con la informaci&oacute;n del evento Javascript producido en el
   cliente.</li>

   
<li>
<strong><span class="codefrag">&lt;a4j:mediaOutput&gt;</span></strong>: permite
   generar im&aacute;genes, v&iacute;deo, sonidos y otros recursos en caliente
   (<em>on-the-fly</em>).</li>

   
<li>
<strong><span class="codefrag">&lt;a4j:outputPanel&gt;</span></strong>: similar
   al componente JSF HTML, pero incluyendo facilidades para su uso con
   Ajax como la posibilidad de insertar elementos no presentes en el
   &aacute;rbol de componentes o la posibilidad de guardar el estado de
   elementos.</li>

   
<li>
<strong><span class="codefrag">&lt;a4j:poll&gt;</span></strong>: permite enviar
   eventos Ajax peri&oacute;dicos al servidor.</li>

   
<li>
<strong><span class="codefrag">&lt;a4j:push&gt;</span></strong>: permite enviar
   peticiones Ajax peri&oacute;dicas al servidor, para simular un
   comportamiento <em>push</em>.</li>

   
<li>
<strong><span class="codefrag">&lt;a4j:region&gt;</span></strong>: define el
   &aacute;rea que es redibujada despu&eacute;s de la petici&oacute;n Ajax.</li>

</ul>
<a name="N102C4"></a><a name="Redibujado+de+componentes"></a>
<h3 class="underlined_5">Redibujado de componentes</h3>
<p>Por ejemplo, uno de los atributos m&aacute;s importantes
es <span class="codefrag">reRender</span>, con el que se puede conseguir que JSF s&oacute;lo
renderice una parte de la p&aacute;gina actual, la indicada por el valor del
atributo. En el siguiente caso, se indica que s&oacute;lo se debe volver a
pintar el bloque marcado con el identificador <span class="codefrag">miBloque</span>,
correspondiente a un <span class="codefrag">h:panelGrid</span>:</p>
<pre class="brush:xml;">...
&lt;a4j:commandButton value="Actualizar" reRender="miBloque"/&gt;
...
&lt;h:panelGrid id="miBloque"&gt;
...
&lt;/h:panelGrid&gt;
...</pre>
<p>Vemos que en el ejemplo no se define ning&uacute;n evento de acci&oacute;n, sino
que &uacute;nicamente se env&iacute;a la petici&oacute;n JSF para que se ejecute el ciclo
de vida con la vista actual y se renderice &uacute;nicamente
el <span class="codefrag">panelGrid</span> identificado por <span class="codefrag">miBloque</span>. Si
queremos actualizar m&aacute;s de un componente bastar&iacute;a con denominarlo con
el identificador <span class="codefrag">miBloque</span>, o ponerle otra identificador y
a&ntilde;adirlo al atributo <span class="codefrag">reRender</span>:</p>
<pre class="brush:xml;">&lt;a4j:commandButton value="Actualizar" reRender="miBloque1, miBloque2"/&gt;</pre>
<p>Hay que tener cuidado cuando se utiliza el atributo reRender para
redibujar un componente que ya tiene el
atributo <span class="codefrag">rendered</span>. En el caso en que esa condici&oacute;n
devuelva falso, no es posible hacer el redibujado, ya que JSF no
incluye el componente en la p&aacute;gina resultante y el m&oacute;dulo de Ajax no
puede localizarlo para redibujar el DOM. Una forma de solucionar el
problema es incluir el componente en un <span class="codefrag">&lt;a4j:outputPanel
layout="none"&gt;</span>. El atributo <span class="codefrag">ajaxRendered</span>
del <span class="codefrag">outputPanel</span> hace que el &aacute;rea de la p&aacute;gina sea
redibujada, incluso si no se apunta a ella expl&iacute;citamente, cuando se
produzca cualquier petici&oacute;n Ajax. Por ejemplo, el siguiente c&oacute;digo
redibuja los mensajes de error:</p>
<pre class="brush:xml;">...
&lt;a4j:outputPanel ajaxRendered="true"&gt;
   &lt;h:messages /&gt;
&lt;/a4j:outputPanel&gt;
...</pre>
<p>Es posible desactivar este comportamiento con el atributo <span class="codefrag">limitToList</span>
</p>
<pre class="brush:xml;">...
&lt;h:form&gt;
   &lt;h:inputText value="#{person.name}"&gt;
      &lt;a4j:support event="onkeyup" reRender="test" limitToList="true"/&gt;
   &lt;/h:inputText&gt;
   &lt;h:outputText value="#{person.name}" id="test"/&gt;
&lt;/h:form&gt;
...</pre>
</div>



<a name="N1030F"></a><a name="Algunos+ejemplos+de+componentes"></a>
<h2 class="underlined_10">Algunos ejemplos de componentes </h2>
<div class="section">
<p>Ejemplos sacados de la
demostraci&oacute;n <a href="http://jboss.org/richfaces/demos.html">RichFaces
Showcase</a>. La puedes consultar
en <a href="http://www.jtech.ua.es/richfaces-showcase">http://www.jtech.ua.es/richfaces-showcase</a>
</p>
<a name="N1031F"></a><a name="Pick+List"></a>
<h3 class="underlined_5">Pick List</h3>
<p>
<img alt="" content-width="8cm" src="imagenes/tema04/pick-list.png" width="404"></p>
<pre class="brush:xml;">&lt;rich:pickList&gt;
   &lt;f:selectItem itemLabel="Option 1" itemValue="1"/&gt;
   &lt;f:selectItem itemLabel="Option 2" itemValue="2"/&gt;
   &lt;f:selectItem itemLabel="Option 3" itemValue="3"/&gt;
   &lt;f:selectItem itemLabel="Option 4" itemValue="4"/&gt;
   &lt;f:selectItem itemLabel="Option 5" itemValue="5"/&gt;
&lt;/rich:pickList&gt;</pre>
<a name="N10332"></a><a name="Panel+modal"></a>
<h3 class="underlined_5">Panel modal</h3>
<p>
<img alt="" content-width="8cm" src="imagenes/tema04/panel-modal.png" width="389"></p>
<pre class="brush:xml;">&lt;rich:modalPanel id="panel" width="350" height="100"&gt;
   &lt;f:facet name="header"&gt;
      &lt;h:panelGroup&gt;
         &lt;h:outputText value="Modal Panel"&gt;&lt;/h:outputText&gt;
      &lt;/h:panelGroup&gt;
   &lt;/f:facet&gt;
   &lt;f:facet name="controls"&gt;
      &lt;h:panelGroup&gt;
         &lt;h:graphicImage value="/images/modal/close.png"
            styleClass="hidelink" id="hidelink" /&gt;
         &lt;rich:componentControl for="panel" attachTo="hidelink"
            operation="hide" event="onclick" /&gt;
      &lt;/h:panelGroup&gt;
   &lt;/f:facet&gt;
   &lt;h:outputText
      value="This panel is called using Component Control Component"/&gt;
   &lt;br /&gt;
   &lt;h:outputText
      value="Closure link (X) works also through Component Control"/&gt;
&lt;/rich:modalPanel&gt;
&lt;h:outputLink value="#" id="link"&gt;
   Show Modal Panel 
   &lt;rich:componentControl for="panel" attachTo="link" 
                          operation="show" event="onclick" /&gt;
&lt;/h:outputLink&gt;</pre>
<a name="N10345"></a><a name="Data+Grid"></a>
<h3 class="underlined_5">Data Grid</h3>
<p>
<img alt="" content-width="8cm" src="imagenes/tema04/data-grid.png" width="500"></p>
<pre class="brush:xml;">&lt;rich:panel&gt;
   &lt;f:facet name="header"&gt;
      &lt;h:outputText value="Car Store"&gt;&lt;/h:outputText&gt;
   &lt;/f:facet&gt;
   &lt;h:form&gt;
      &lt;rich:dataGrid value="#{dataTableScrollerBean.allCars}"
         var="car" columns="3" elements="9" width="600px"&gt;
         &lt;rich:panel bodyClass="pbody"&gt;
            &lt;f:facet name="header"&gt;
               &lt;h:outputText value="#{car.make} #{car.model}"&gt;
               &lt;/h:outputText&gt;
            &lt;/f:facet&gt;
            &lt;h:panelGrid columns="2"&gt;
               &lt;h:outputText value="Price:" styleClass="label"/&gt;
               &lt;h:outputText value="#{car.price}" /&gt;
               &lt;h:outputText value="Mileage:" styleClass="label"/&gt;
               &lt;h:outputText value="#{car.mileage}" /&gt;
               &lt;h:outputText value="VIN:" styleClass="label"/&gt;
               &lt;h:outputText value="#{car.vin}" /&gt;
               &lt;h:outputText value="Stock:" styleClass="label"/&gt;
               &lt;h:outputText value="#{car.stock}" /&gt;
            &lt;/h:panelGrid&gt;
         &lt;/rich:panel&gt;
         &lt;f:facet name="footer"&gt;
            &lt;rich:datascroller&gt;&lt;/rich:datascroller&gt;
         &lt;/f:facet&gt;
      &lt;/rich:dataGrid&gt;
   &lt;/h:form&gt;
&lt;/rich:panel&gt;</pre>
<a name="N10358"></a><a name="Google+map"></a>
<h3 class="underlined_5">Google map</h3>
<p>
<img alt="" content-width="8cm" src="imagenes/tema04/google-map.png" width="408"></p>
<pre class="brush:xml;">&lt;rich:gmap  
   gmapVar="map" zoom="16"  style="width:400px;height:400px" 
   gmapKey="ABQIAAAA5SzcCLDOLK2VPhx3P-poFxQDT1fstRCWND9TPh4
            hnvi3n3eSLhQH-hQAsES9VPnDb0M9QRvXK83_Lw"
   lat="38.38463"
   lng="-0.51287"/&gt;</pre>
<a name="N1036B"></a><a name="Tab+panel"></a>
<h3 class="underlined_5">Tab panel</h3>
<p>
<img alt="" content-width="8cm" src="imagenes/tema04/tab-panel.png" width="361"></p>
<pre class="brush:xml;">&lt;rich:tabPanel switchType="ajax" width="350" height="400"&gt;
   &lt;rich:tab label="Using Google Map API"&gt;
      &lt;h:panelGrid columns="2" columnClasses="optionList"&gt;
         &lt;h:outputText value="Controls:" /&gt;
         &lt;h:panelGroup&gt;
            &lt;a href="javascript: void 0" onclick=
	map.hideControls();&gt;Hide&lt;/a&gt;
            &lt;a href="javascript: void 0" onclick=
	map.showControls();&gt;Show&lt;/a&gt;
            &lt;br/&gt;
         &lt;/h:panelGroup&gt;

         &lt;h:outputText value="Zoom:" /&gt;
         &lt;rich:inputNumberSlider id="zoom" showInput="false"
            minValue="1" maxValue="18" value="#{gmBean.zoom}"
            onchange="map.setZoom(this.value)" /&gt;

         &lt;h:outputText value="Map Type:" /&gt;
         &lt;h:panelGroup&gt;
            &lt;a href="javascript: void 0"
               onclick=
	map.setMapType(G_NORMAL_MAP);&gt;Normal&lt;/a&gt;
            &lt;a href="javascript: void 0"
               onclick=
	map.setMapType(G_SATELLITE_MAP);&gt;Satellite&lt;/a&gt;
            &lt;a href="javascript: void 0"
               onclick=
	map.setMapType(G_HYBRID_MAP);&gt;Hybrid&lt;/a&gt;
            &lt;br/&gt;
         &lt;/h:panelGroup&gt;

      &lt;/h:panelGrid&gt;
   &lt;/rich:tab&gt;

   &lt;rich:tab label="Using Ajax with JSON"&gt;
      &lt;rich:dataGrid var="place" value="#{gmBean.point}" columns="2"&gt;
         &lt;h:graphicImage onclick="showPlace('#{place.id}')"
            style="cursor:pointer" value="resource://#{place.pic}" /&gt;
      &lt;/rich:dataGrid&gt;
   &lt;/rich:tab&gt;
&lt;/rich:tabPanel&gt;</pre>
</div>


<a name="N1037F"></a><a name="Referencias"></a>
<h2 class="underlined_10">Referencias</h2>
<div class="section">
<ul>
   
<li>
<a href="http://jboss.org/jbossrichfaces/">P&aacute;gina principal de
   RichFaces en JBoss</a>
</li>
   
<li>
<a href="https://www.jboss.org/richfaces/docs.html">Documentaci&oacute;n
   de RichFaces</a>
</li>
   
<li>
<a href="http://community.jboss.org/wiki/RichFacesWikiHomePage">RichFaces</a>,
   documento sobre RichFaces en el Wiki de JBoss, con bastantes
   enlaces interesantes.</li>
   
<li>
<a href="http://community.jboss.org/wiki/RichFaces40ReleaseCenter">Road map de versiones de RichFaces</a>
</li>
   
<li>
<a href="https://hudson.jboss.org/hudson/view/Richfaces/">Servidor
   Hudson de RichFaces</a>
</li>

</ul>
</div>


<p class="pageBreakAfter"></p>

</div>
<div class="clearboth">&nbsp;</div>
</div>
<div id="footer">
<div class="lastmodified">
<script type="text/javascript"><!--
document.write("<text>Last Published:</text> " + document.lastModified);
//  --></script>
</div>
<div class="copyright">
        Copyright &copy;
         2012-2013 Dept. Ciencia de la Computaci&oacute;n e IA</div>
</div>
<script type="text/javascript">
     
         SyntaxHighlighter.defaults['toolbar'] = false;
         SyntaxHighlighter.autoloader(
  		     'java                   skin/highlight/shBrushJava.js',
  		     'xml xhtml xslt html    skin/highlight/shBrushXml.js',
  		     'js jscript javascript  skin/highlight/shBrushJScript.js',
  		     'groovy                 skin/highlight/shBrushGroovy.js',
  		     'bash shell             skin/highlight/shBrushBash.js',
  		     'php                    skin/highlight/shBrushPhp.js',
  		     'css                    skin/highlight/shBrushCss.js',
  		     'sql                    skin/highlight/shBrushSql.js',
  		     'objc                   skin/highlight/shBrushObjC.js',
  		     'cpp c                  skin/highlight/shBrushCpp.js',
  		     'text plain             skin/highlight/shBrushPlain.js'
         );
         SyntaxHighlighter.all();
     </script><a href="skin/highlight/shBrushJava.js"></a><a href="skin/highlight/shBrushXml.js"></a><a href="skin/highlight/shBrushJScript.js"></a><a href="skin/highlight/shBrushGroovy.js"></a><a href="skin/highlight/shBrushBash.js"></a><a href="skin/highlight/shBrushPhp.js"></a><a href="skin/highlight/shBrushCss.js"></a><a href="skin/highlight/shBrushSql.js"></a><a href="skin/highlight/shBrushObjC.js"></a><a href="skin/highlight/shBrushCpp.js"></a><a href="skin/highlight/shBrushPlain.js"></a>
</body>
</html>
