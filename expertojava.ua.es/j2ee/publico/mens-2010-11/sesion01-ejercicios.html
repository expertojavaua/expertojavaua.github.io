<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<META http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta content="Apache Forrest" name="Generator">
<meta name="Forrest-version" content="0.7">
<meta name="Forrest-skin-name" content="pelt">
<title>Ejercicios de Introducci&oacute;n a JMS</title>
<link type="text/css" href="skin/basic.css" rel="stylesheet">
<link media="screen" type="text/css" href="skin/screen.css" rel="stylesheet">
<link media="print" type="text/css" href="skin/print.css" rel="stylesheet">
<link type="text/css" href="skin/profile.css" rel="stylesheet">
<script src="skin/getBlank.js" language="javascript" type="text/javascript"></script><script src="skin/getMenu.js" language="javascript" type="text/javascript"></script><script src="skin/fontsize.js" language="javascript" type="text/javascript"></script>
<link rel="shortcut icon" href="">
</head>
<body onload="init()">
<script type="text/javascript">ndeSetTextSize();</script>
<div id="top">
<div class="header">
<div class="grouplogo">
<a href="http://web.ua.es/especialistajava"><img class="logoImage" alt="jtech" src="images/baner_j2ee_izq.gif" title="Especialista Universitario Java Enterprise"></a>
</div>
<div class="projectlogoA1">
<a href="http://www.dccia.ua.es/"><img class="logoImage" alt="Servicios de Mensajes con JMS" src="images/baner_j2ee_der.gif" title="Servicios de Mensajes con JMS"></a>
</div>
<ul id="tabs">
<li>
<a class="base-not-selected" href="javascript:location.href='../index.html'">Home</a>
</li>
<li>
<a class="base-not-selected" href="javascript:location.href='../aplic-web.html'">Aplicaciones Web</a>
</li>
<li>
<a class="base-not-selected" href="javascript:location.href='../aplic-ent.html'">Aplicaciones Enterprise</a>
</li>
<li>
<a class="base-not-selected" href="javascript:location.href='../charlas.html'">Charlas</a>
</li>
<li>
<a class="base-not-selected" href="javascript:location.href='../proy-int/index.html'">Proyecto</a>
</li>
<li class="current">
<a class="base-selected" href="index.html">Servicios de Mensajes con JMS</a>
</li>
</ul>
</div>
</div>
<div id="main">
<div id="publishedStrip">
<div id="level2tabs"></div>
<script type="text/javascript"><!--
document.write("<text>Last Published:</text> " + document.lastModified);
//  --></script>
</div>
<div class="breadtrail">
             
             &nbsp;
           </div>
<div id="menu">
<div onclick="SwitchMenu('menu_selected_1.1', 'skin/')" id="menu_selected_1.1Title" class="menutitle" style="background-image: url('skin/images/chapter_open.gif');">Servicios de Mensajes con JMS</div>
<div id="menu_selected_1.1" class="selectedmenuitemgroup" style="display: block;">
<div class="menuitem">
<a href="index.html" title="Servicios de Mensajes con JMS">&Iacute;ndice</a>
</div>
<div onclick="SwitchMenu('menu_1.1.2', 'skin/')" id="menu_1.1.2Title" class="menutitle">Teor&iacute;a</div>
<div id="menu_1.1.2" class="menuitemgroup">
<div class="menuitem">
<a href="sesion01-apuntes.html" title="1. Introducci&oacute;n a JMS">Sesi&oacute;n 1</a>
</div>
<div class="menuitem">
<a href="sesion02-apuntes.html" title="2. Mensajes. Robustez en JMS">Sesi&oacute;n 2</a>
</div>
<div class="menuitem">
<a href="sesion03-apuntes.html" title="3. Durable Subscribers y Transacciones. JMS y JavaEE">Sesi&oacute;n 3</a>
</div>
<div class="menuitem">
<a href="sesion04-apuntes.html" title="4. Message Driven Beans">Sesi&oacute;n 4</a>
</div>
</div>
<div onclick="SwitchMenu('menu_selected_1.1.3', 'skin/')" id="menu_selected_1.1.3Title" class="menutitle" style="background-image: url('skin/images/chapter_open.gif');">Ejercicios</div>
<div id="menu_selected_1.1.3" class="selectedmenuitemgroup" style="display: block;">
<div class="menupage">
<div class="menupagetitle">Sesi&oacute;n 1</div>
</div>
<div class="menuitem">
<a href="sesion02-ejercicios.html" title="2. Mensajes. Robustez en JMS">Sesi&oacute;n 2</a>
</div>
<div class="menuitem">
<a href="sesion03-ejercicios.html" title="3. Durable Subscribers y Transacciones. JMS y JavaEE">Sesi&oacute;n 3</a>
</div>
<div class="menuitem">
<a href="sesion04-ejercicios.html" title="4. Message Driven Beans">Sesi&oacute;n 4</a>
</div>
</div>
</div>
<div id="credit"></div>
<div id="roundbottom">
<img style="display: none" class="corner" height="15" width="15" alt="" src="skin/images/rc-b-l-15-1body-2menu-3menu.png"></div>
<div id="credit2"></div>
</div>
<div id="content">
<div title="Portable Document Format" class="pdflink">
<a class="dida" href="sesion01-ejercicios.pdf"><img alt="PDF -icon" src="skin/images/pdfdoc.gif" class="skin"><br>
        PDF</a>
</div>
<h1>Ejercicios de Introducci&oacute;n a JMS</h1>
<div id="minitoc-area">
<ul class="minitoc">
<li>
<a href="#Dominio+JMS">Dominio JMS</a>
</li>
<li>
<a href="#Primeros+Ejemplos+%281p%29">Primeros Ejemplos (1p)</a>
</li>
<li>
<a href="#Ejemplos+con+Clases+Espec%C3%ADficas+%281p%29">Ejemplos con Clases Espec&iacute;ficas (1p)</a>
</li>
<li>
<a href="#Sem%C3%A1foro+Hipotecario+%282p%29">Sem&aacute;foro Hipotecario (2p)</a>
<ul class="minitoc">
<li>
<a href="#jms-banco">jms-banco</a>
</li>
<li>
<a href="#jms-semaforo">jms-semaforo</a>
</li>
<li>
<a href="#Enviando+y+parseando+la+informaci%C3%B3n">Enviando y parseando la informaci&oacute;n</a>
</li>
</ul>
</li>
</ul>
</div>


<a name="N1000C"></a><a name="Dominio+JMS"></a>
<h2 class="underlined_10">Dominio JMS</h2>
<div class="section">
<p>Para que todas las factorias sean independientes del resto de m&oacute;dulos, vamos a crear un nuevo dominio. Para ello, crearemos desde Netbeans un nuevo servidor al que denominaremos <strong>'GlassFish Server 3 - JMS'</strong>. Al crear el servidor crearemos un nuevo dominio personal que llamaremos <span class="codefrag">domain-jms</span> el cual situaremos dentro de la carpeta de dominios de Glassfish, es decir, en <span class="codefrag">/home/especialista/glassfish-v2.1/domains/domain-jms</span>.</p>
<p>Todos los ejercicios de este m&oacute;dulo utilizar&aacute;n este dominio.</p>
</div>


<a name="N10022"></a><a name="Primeros+Ejemplos+%281p%29"></a>
<h2 class="underlined_10">Primeros Ejemplos (1p)</h2>
<div class="section">
<p>Se plantea como ejercicio la creaci&oacute;n de los ejemplos PTP y Pub/Sub vistos en los apuntes.</p>
<p>Antes de nada habr&aacute; que crear en <em>Glassfish</em> tanto la factor&iacute;a de conexiones como los recursos de cola y t&oacute;pico vistos en los apuntes.</p>
<p>En cuanto a los clientes, crearemos un proyecto de aplicaci&oacute;n cliente para cada elemento de cada dominio. As&iacute; pues, tendremos los proyectos <span class="codefrag">jms-productor</span>, <span class="codefrag">jms-consumidor-sync</span>, <span class="codefrag">jms-consumidor-async</span>, <span class="codefrag">jms-publicador</span>, <span class="codefrag">jms-subscriptor-sync</span> y <span class="codefrag">jms-subscriptor-async</span>.</p>
</div>


<a name="N10047"></a><a name="Ejemplos+con+Clases+Espec%C3%ADficas+%281p%29"></a>
<h2 class="underlined_10">Ejemplos con Clases Espec&iacute;ficas (1p)</h2>
<div class="section">
<p>Los ejemplos que hab&eacute;is hecho en el primer ejercicio se basan en los interfaces JMS de m&aacute;s alto nivel. As&iacute;, cuando estamos accediendo a una cola, hemos utilizado las clases <span class="codefrag">ConnectionFactory</span>, <span class="codefrag">Connection</span>, <span class="codefrag">Session</span>, <span class="codefrag">MessageConsumer</span>, etc...</p>
<p>Se plantea como ejercicio rescribir los 6 proyectos y que cada clase utilice las clases espec&iacute;ficas de cada dominio. Es decir, en el caso de la cola, utilizaremos <span class="codefrag">QueueConnectionFactory</span>, <span class="codefrag">QueueConnection</span>, <span class="codefrag">QueueSession</span>, <span class="codefrag">QueueReceiver</span>, etc...</p>
<p>Las nuevas clases se situar&aacute;n en los mismos proyectos, pero nombrando a las clases con el sufijo <span class="codefrag">Especifico</span>. Por ejemplo, la nueva clase <span class="codefrag">Consumidor</span> se llamar&aacute; <span class="codefrag">ConsumidorEspecifico</span>.</p>
<p>Para tener m&aacute;s claro las relaciones de las clases se recomienda consultar los javadocs del API de JMS: <a href="http://java.sun.com/javaee/6/docs/api/javax/jms/package-summary.html">java.sun.com/javaee/6/docs/api/javax/jms/package-summary.html</a>
</p>
</div>


<a name="N1007E"></a><a name="Sem%C3%A1foro+Hipotecario+%282p%29"></a>
<h2 class="underlined_10">Sem&aacute;foro Hipotecario (2p)</h2>
<div class="section">
<p>Vamos a hacer un peque&ntilde;o proyecto para este m&oacute;dulo que va a simular un sem&aacute;foro hipotecario.</p>
<p>El sem&aacute;foro va a recibir peticiones sobre hipotecas, y dependiendo del riesgo que conllevan, responder&aacute; con Rojo (denegar), Naranja (previo an&aacute;lisis de un consultor financiero) o Verde (aceptar).</p>
<p>El sem&aacute;foro recibir&aacute; los siguientes par&aacute;metros:</p>
<ul>
	
<li>Nombre de la entidad financiera</li>
	
<li>Cuant&iacute;a de la hipoteca</li>
	
<li>A&ntilde;os de la hipoteca</li>
	
<li>Tipo de inter&eacute;s anual hipotecario</li>
	
<li>N&oacute;mina mensual del cliente (neta, sin retenciones). Suponemos que cobra 12 nominas al a&ntilde;o.</li>

</ul>
<p>Las reglas asociadas al sem&aacute;foro para responder con uno u otro color dependiendo de la cuota mensual de la hipoteca ser&aacute;n:</p>
<ul>
	
<li>Si la cuota mensual supone menos del 30% de la nomina del cliente, devolver&aacute; verde.</li>
	
<li>Si la cuota mensual supone entre el 30% y el 40% de la nomina, devolver&aacute; naranja.</li>
	
<li>Si la cuota mensual supone m&aacute;s del 40% de la nomina, devolver&aacute; rojo.</li>

</ul>
<p>Para calcular la cuota mensual, ten&eacute;is la formula en la wikipedia : <a href="http://es.wikipedia.org/wiki/Contrato_de_Hipoteca">es.wikipedia.org/wiki/Contrato_de_Hipoteca</a>.</p>
<a name="N100B5"></a><a name="jms-banco"></a>
<h3 class="underlined_5">jms-banco</h3>
<p>Para realizar esta aplicaci&oacute;n necesitar&eacute;is crear 2 proyectos. Un proyecto productor de mensajes (<span class="codefrag">jms-banco</span>), el cual enviar&aacute; mensajes a una cola, la cual llamaremos <span class="codefrag">SemaforoHipotecarioRequestQueue</span>.</p>
<p>Todo esto lo haremos dentro de una clase <span class="codefrag">Banco</span> dentro de <span class="codefrag">org.especialistajee.jms</span>.</p>
<p>El mensaje se enviar&aacute; desde un m&eacute;todo con la siguiente firma:</p>
<pre class="code">void enviaHipoteca(String banco, double cuantia, int anyos, double interes, double nomina);</pre>
<a name="N100D5"></a><a name="jms-semaforo"></a>
<h3 class="underlined_5">jms-semaforo</h3>
<p>El segundo proyecto (<span class="codefrag">jms-semaforo</span>) se encarga de escuchar los mensajes de forma as&iacute;ncrona y devolver uno de los tres colores comentados anteriormente en la cola de respuesta. La consumici&oacute;n del mensaje se realizar&aacute; en un m&eacute;todo con la siguiente firma:</p>
<pre class="code">void analizaHipoteca();</pre>
<p>Este m&eacute;todo obtendr&aacute; el color de la hipoteca (y de momento, lo sacar&aacute; por consola).</p>
<p>Para facilitaros el trabajo, se os da comenzada una clase de prueba para comprobar la <strong>l&oacute;gica de negocio</strong> del sem&aacute;foro (deb&eacute;is completar la prueba para que abarque la mayor casu&iacute;stica posible):</p>
<pre class="code">package es.ua.jtech.jms;

// imports
public class <strong>SemaforoBRTest</strong> {

    private SemaforoBR sbr = null;

    public SemaforoBRTest() {
        sbr = SemaforoBR.getInstance();
    }

    @Test
    public void <strong>devuelveVerde</strong>() {
       String color = "Verde";

       Assert.assertTrue("Deberia ser " + color,
        sbr.obtenerColorHipoteca("BBVA", 100000, 30, 5, 1800).equals(color));
       Assert.assertTrue("Deberia ser " + color,
        sbr.obtenerColorHipoteca("BBVA", 50000, 20, 5, 1800).equals(color));

       Assert.assertTrue("Deberia ser " + color,
        sbr.obtenerColorHipoteca("Banesto", 100000, 40, 4, 1500).equals(color));
       Assert.assertTrue("Deberia ser " + color,
        sbr.obtenerColorHipoteca("Banesto", 100000, 35, 3, 1500).equals(color));
    
    // Resto de m&eacute;todos de prueba....
}
</pre>
<p>Adem&aacute;s, tambi&eacute;n ten&eacute;is el esqueleto para crear la l&oacute;gica de negocio del sem&aacute;foro:</p>
<pre class="code">package es.ua.jtech.jms;

public class <strong>SemaforoBR</strong> {
    private static SemaforoBR me = new SemaforoBR();

    public final static String ROJO = "Rojo";
    public final static String VERDE = "Verde";
    public final static String NARANJA = "Naranja";

    private SemaforoBR() { }

    public static SemaforoBR getInstance() {
        return me;
    }

    <strong>public String obtenerColorHipoteca(
            String banco, double cuantia, int anyos, double interes, double nomina) {</strong>
        String result = null;

        double interesMensual = interes / 12;
        int plazo = anyos * 12;

        double cuota = (cuantia * interesMensual) /
            (100 * (1 - Math.pow(1 + (interesMensual / 100), -plazo)));
        double ratio = (cuota / nomina) * 100;
        
        // TODO Completar logica de negocio     
    }
}
</pre>
<a name="N10106"></a><a name="Enviando+y+parseando+la+informaci%C3%B3n"></a>
<h3 class="underlined_5">Enviando y parseando la informaci&oacute;n</h3>
<p>En cuanto al env&iacute;o y recepci&oacute;n de la informaci&oacute;n mediante un mensaje de texto, tendremos que agrupar la informaci&oacute;n para luego parsearla. Para ello, vamos a utilizar el car&aacute;cter '<span class="codefrag">#</span>' para unir cada campo. Para construir el mensaje haremos algo similar a:</p>
<pre class="code">String miMensaje = banco + "#" + cuantia + "#" + anyos + "#" + interes + "#" + nomina;</pre>
<p>Y para parsearlo, utilizaremos el m&eacute;todo <span class="codefrag">split</span> de <span class="codefrag">String</span>, tal que as&iacute;:</p>
<pre class="code">String[] tokens = miMensaje.split("#");

String banco = tokens[0];
double cuantia = Double.parseDouble(tokens[1]);
int anyos = Integer.parseInt(tokens[2]);
double interes = Double.parseDouble(tokens[3]);
double nomina = Double.parseDouble(tokens[4]);
</pre>
</div>


<p class="pageBreakAfter"></p>

</div>
<div class="clearboth">&nbsp;</div>
</div>
<div id="footer">
<div class="lastmodified">
<script type="text/javascript"><!--
document.write("<text>Last Published:</text> " + document.lastModified);
//  --></script>
</div>
<div class="copyright">
        Copyright &copy;
         2010-2011 Dept. Ciencia de la Computaci&oacute;n e IA</div>
</div>
</body>
</html>
