<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<META http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta content="Apache Forrest" name="Generator">
<meta name="Forrest-version" content="0.7">
<meta name="Forrest-skin-name" content="pelt">
<title>Ejercicios. Creaci&oacute;n de Servicios Web SOAP</title>
<link type="text/css" href="skin/highlight/shCore.css" rel="stylesheet">
<link type="text/css" href="skin/highlight/shThemeEclipse.css" rel="stylesheet">
<script src="skin/highlight/shCore.js" type="text/javascript"></script><script src="skin/highlight/shAutoloader.js" type="text/javascript"></script>
<link type="text/css" href="skin/basic.css" rel="stylesheet">
<link media="screen" type="text/css" href="skin/screen.css" rel="stylesheet">
<link media="print" type="text/css" href="skin/print.css" rel="stylesheet">
<link type="text/css" href="skin/profile.css" rel="stylesheet">
<script src="skin/getBlank.js" language="javascript" type="text/javascript"></script><script src="skin/getMenu.js" language="javascript" type="text/javascript"></script><script src="skin/fontsize.js" language="javascript" type="text/javascript"></script>
<link rel="shortcut icon" href="">
</head>
<body onload="init()">
<script type="text/javascript">ndeSetTextSize();</script>
<div id="top">
<div class="header">
<div class="grouplogo">
<a href="http://web.ua.es/especialistajava"><img class="logoImage" alt="jtech" src="images/baner_j2ee_izq.gif" title="Especialista Universitario Java Enterprise"></a>
</div>
<div class="projectlogoA1">
<a href="http://www.dccia.ua.es/"><img class="logoImage" alt="Servicios Web y SOA" src="images/baner_j2ee_der.gif" title="Servicios Web y SOA"></a>
</div>
<ul id="tabs">
<li>
<a class="base-not-selected" href="javascript:location.href='../index.html'">Home</a>
</li>
<li>
<a class="base-not-selected" href="javascript:location.href='../aplic-web.html'">Aplicaciones Web</a>
</li>
<li>
<a class="base-not-selected" href="javascript:location.href='../aplic-ent.html'">Aplicaciones Enterprise</a>
</li>
<li>
<a class="base-not-selected" href="javascript:location.href='../proy-int/index.html'">Proyecto</a>
</li>
<li class="current">
<a class="base-selected" href="index.html">Servicios Web</a>
</li>
</ul>
</div>
</div>
<div id="main">
<div id="publishedStrip">
<div id="level2tabs"></div>
<script type="text/javascript"><!--
document.write("<text>Last Published:</text> " + document.lastModified);
//  --></script>
</div>
<div class="breadtrail">
             
             &nbsp;
           </div>
<div id="menu">
<div onclick="SwitchMenu('menu_selected_1.1', 'skin/')" id="menu_selected_1.1Title" class="menutitle" style="background-image: url('skin/images/chapter_open.gif');">Servicios Web</div>
<div id="menu_selected_1.1" class="selectedmenuitemgroup" style="display: block;">
<div class="menuitem">
<a href="index.html" title="Servicios Web">&Iacute;ndice</a>
</div>
<div onclick="SwitchMenu('menu_1.1.2', 'skin/')" id="menu_1.1.2Title" class="menutitle">Teor&iacute;a</div>
<div id="menu_1.1.2" class="menuitemgroup">
<div class="menuitem">
<a href="sesion01-apuntes.html">Sesion 1</a>
</div>
<div class="menuitem">
<a href="sesion02-apuntes.html">Sesion 2</a>
</div>
<div class="menuitem">
<a href="sesion03-apuntes.html">Sesion 3</a>
</div>
<div class="menuitem">
<a href="sesion04-apuntes.html">Sesion 4</a>
</div>
</div>
<div onclick="SwitchMenu('menu_selected_1.1.3', 'skin/')" id="menu_selected_1.1.3Title" class="menutitle" style="background-image: url('skin/images/chapter_open.gif');">Ejercicios</div>
<div id="menu_selected_1.1.3" class="selectedmenuitemgroup" style="display: block;">
<div class="menuitem">
<a href="sesion01-ejercicios.html">Sesion 1</a>
</div>
<div class="menupage">
<div class="menupagetitle">Sesion 2</div>
</div>
<div class="menuitem">
<a href="sesion03-ejercicios.html">Sesion 3</a>
</div>
<div class="menuitem">
<a href="sesion04-ejercicios.html">Sesion 4</a>
</div>
</div>
</div>
<div id="credit"></div>
<div id="roundbottom">
<img style="display: none" class="corner" height="15" width="15" alt="" src="skin/images/rc-b-l-15-1body-2menu-3menu.png"></div>
<div id="credit2"></div>
</div>
<div id="content">
<div title="Portable Document Format" class="pdflink">
<a class="dida" href="sesion02-ejercicios.pdf"><img alt="PDF -icon" src="skin/images/pdfdoc.gif" class="skin"><br>
        PDF</a>
</div>
<h1>Ejercicios. Creaci&oacute;n de Servicios Web SOAP</h1>
<div id="minitoc-area">
<ul class="minitoc">
<li>
<a href="#Creaci%C3%B3n+de+un+servicio+web+b%C3%A1sico">Creaci&oacute;n de un servicio web b&aacute;sico</a>
</li>
<li>
<a href="#Validaci%C3%B3n+de+NIFs">Validaci&oacute;n de NIFs</a>
</li>
<li>
<a href="#Tienda+de+DVDs">Tienda de DVDs</a>
</li>
</ul>
</div>



<a name="N1000C"></a><a name="Creaci%C3%B3n+de+un+servicio+web+b%C3%A1sico"></a>
<h2 class="underlined_10">Creaci&oacute;n de un servicio web b&aacute;sico</h2>
<div class="section">
<p>Vamos a comenzar creando un servicio web b&aacute;sico JAX-WS con Maven 
(ver apartado Creaci&oacute;n de un servicio Web JAX-WS con Maven).
Este servicio web ser&aacute; un <em>Hola
Mundo</em> en forma de servicio. La clase que implementar&aacute; el servicio tendr&aacute; como nombre <span class="codefrag">HolaMundo</span> y 
una &uacute;nica operaci&oacute;n <span class="codefrag">String saluda(nombre)</span>, que nos devolver&aacute; un mensaje
de saludo incluyendo el nombre proporcionado. Por ejemplo, si al par&aacute;metro de entrada 
<span class="codefrag">nombre</span> le damos como valor <span class="codefrag">"Miguel"</span>, como salida producir&aacute; la cadena
<span class="codefrag">"Hola Miguel, &iquest;Que tal?"</span>.</p>
<p>Cuando crees el arquetipo de Maven, utiliza los siguientes nombres para:</p>
<ul>
  
<li>groupId: expertoJava</li>
  
<li>artifactId: Sesion2-HolaMundoWS</li>

</ul>
<p>Configurar la raiz del contexto como "HolaMundoWS" en el fichero <em>glassfish-web.xml</em>.
   El nombre del servicio ser&aacute; <em>Hola</em> (valor del atributo <em>serviceName</em> de la anotaci&oacute;n
   @WebService).</p>
<p>Crea un cliente web Maven con Netbeans para probar el funcionamiento de dicho servicio Web. 
  El nombre del proyecto ser&aacute; "Sesion2-hola-WS-client  (1 punto)</p>
</div>



<a name="N10043"></a><a name="Validaci%C3%B3n+de+NIFs"></a>
<h2 class="underlined_10">Validaci&oacute;n de NIFs</h2>
<div class="section">
<p>Vamos a implementar un servicio web Maven (con Netbeans) con una serie de m&eacute;todos que nos permitan validar 
un NIF. El servicio tendr&aacute; como nombre <span class="codefrag">ValidaDniWS</span>, y estar&aacute; dentro
de un proyecto Maven Netbeans con nombre <span class="codefrag">Sesion2-dni-WS</span>. Se pide:</p>
<p>
<em>a)</em> Implementar la siguiente operaci&oacute;n (0,25 puntos):</p>
<pre class="code">boolean validarDni(String dni)</pre>
<p>Esta funci&oacute;n tomar&aacute; como entrada un DNI, y como salida nos dir&aacute; si es correcto 
o no. El resultado ser&aacute; <span class="codefrag">true</span> si el DNI es correcto (est&aacute; formado por 
8 d&iacute;gitos), y <span class="codefrag">false</span> en caso contrario. Podemos utilizar un c&oacute;digo
similar al siguiente para validar el DNI:</p>
<pre class="code">Pattern pattern =  Pattern.compile("[0-9]{8,8}");
Matcher matcher = pattern.matcher(dni);
return matcher.matches();</pre>
<p>
<em>b)</em> Implementar la siguiente operaci&oacute;n (0,25 puntos):</p>
<pre class="code">char obtenerLetra(String dni) throws DniFault</pre>
<p>Esta funci&oacute;n tomar&aacute; como entrada un DNI, y como salida nos dir&aacute; la letra que 
corresponde a dicho DNI. Lo primero que deber&aacute; hacer es validar el DNI (puede 
utilizar para ello el m&eacute;todo definido en el apartado anterior), y en caso de 
no ser correcto lanzar&aacute; una excepci&oacute;n de tipo <span class="codefrag">DniFault</span> (que deberemos crear previamente)
indicando el mensaje de error "El DNI no es valido". Una vez validado, calcularemos 
la letra que corresponda al DNI. Para ello deberemos:</p>
<ul>

<li>Obtener el &iacute;ndice de la letra correspondiente con:</li>

</ul>
<pre class="code">dni % 23</pre>
<ul>

<li>La letra ser&aacute; el car&aacute;cter de la siguiente cadena que est&eacute; en la posici&oacute;n 
obtenida anteriormente:</li>

</ul>
<pre class="code">"TRWAGMYFPDXBNJZSQVHLCKE"</pre>
<div class="frame note">
<div class="label">Nota</div>
<div class="content">El cliente de prueba no trata correctamente la recepci&oacute;n de un 
<em>SOAP Fault</em> como respuesta, ya que la excepci&oacute;n que genera &eacute;ste hace que
falle la misma aplicaci&oacute;n de pruebas. Para poder tratar la excepci&oacute;n de forma correcta
deberemos hacerlo con un cliente propio, que se implementar&aacute; en el apartado (d). </div>
</div>
<p>
<em>c)</em> Implementar la siguiente operaci&oacute;n (0,25 puntos):</p>
<pre class="code">boolean validarNif(String nif)</pre>
<p>Esta funci&oacute;n tomar&aacute; como entrada un NIF, y como salida nos dir&aacute; si es correcto 
o no. El resultado ser&aacute; <span class="codefrag">true</span> si el NIF es correcto (est&aacute; formado por 
8 d&iacute;gitos seguidos de la letra correcta), y <span class="codefrag">false</span> en caso contrario. 
Para hacer esta comprobaci&oacute;n se pueden utilizar las dos funciones anteriores: se 
comprobar&aacute;n los 8 primeros caracteres con la funci&oacute;n <span class="codefrag">validarDni</span> y 
posteriormente se comprobar&aacute; si la letra es la correcta utilizando la funci&oacute;n 
<span class="codefrag">obtenerLetra</span>.</p>
<p>
<em>d)</em> Implementar un cliente Maven Java con Netbeans que acceda a dicho servicio e invoque la operaci&oacute;n <em>obtenerLetra</em>. 
El cliente deber&aacute; crearse en un proyecto con nombre <span class="codefrag">Sesion2-dni-WS-client</span>. Tened en cuenta que deb&eacute;is capturar la
excepci&oacute;n que hemos definido en el apartado (b). La clase correspondiente del <em>stub</em> la pod&eacute;is ver en <em>Files</em>, dentro
del directorio <em>target/generated-sources/wsimport</em>, con el sufijo <em>_Exception</em>.
Concretamente pod&eacute;is ver que la excepci&oacute;n es de tipo DniFault_Exception. Prueba con un DNI
v&aacute;lido, y haz una segunda llamada con un DNI inv&aacute;lido para comprobar que se lanza la excepci&oacute;n (0,25 puntos).</p>
</div>




<a name="N100C2"></a><a name="Tienda+de+DVDs"></a>
<h2 class="underlined_10">Tienda de DVDs</h2>
<div class="section">
<p>
  Nuestro negocio consiste en una tienda que 
  vende pel&iacute;culas en DVD a trav&eacute;s de Internet. Para dar una mayor 
  difusi&oacute;n a nuestro cat&aacute;logo de pel&iacute;culas, decidimos implantar 
  una serie de Servicios Web para acceder a informaci&oacute;n sobre las pel&iacute;culas 
  que vendemos.</p>
<p>De cada pel&iacute;cula ofreceremos informaci&oacute;n sobre su t&iacute;tulo, 
  su director y su precio. Esta informaci&oacute;n podemos codificarla en una 
  clase <span class="codefrag">PeliculaTO</span> como la siguiente:</p>
<pre class="code">public class <strong>PeliculaTO</strong> {
  private String titulo;
  private String director;
  private float precio;
   
  public PeliculaTO() {}
   
  public PeliculaTO(String titulo, String director, float precio) {
    this.titulo = titulo;
    this.director = director;
    this.precio = precio;
  }

  // Getters y setters
  ...
}</pre>
<p>Vamos a permitir que se busquen pel&iacute;culas proporcionando el nombre de 
  su director. Por lo tanto, el servicio ofrecer&aacute; una operaci&oacute;n 
  como la siguiente:</p>
<pre class="code">List&lt;PeliculaTO&gt; <strong>buscaDirector</strong>(String director)</pre>
<p>Proporcionaremos el nombre del director, y nos devolver&aacute; la lista de 
  pel&iacute;culas disponibles dirigidas por este director.</p>
<p>En un principio, podemos crear una lista est&aacute;tica de pel&iacute;culas 
  dentro del c&oacute;digo de nuestro servicio, como por ejemplo:</p>
<pre class="code">final static PeliculaTO[] peliculas = {
    new PeliculaTO("Mulholland Drive", "David Lynch", 26.96f),
    new PeliculaTO("Carretera perdida", "David Lynch", 18.95f),
    new PeliculaTO("Twin Peaks", "David Lynch", 46.95f),
    new PeliculaTO("Telefono rojo", "Stanley Kubrick", 15.95f),
    new PeliculaTO("Barry Lyndon", "Stanley Kubrick", 24.95f),
    new PeliculaTO("La naranja mec&aacute;nica", "Stanley Kubrick", 22.95f) 
};</pre>
<p>Se pide:</p>
<p>
  
<em>a)</em> Implementar el servicio utilizando Netbeans. El servicio se llamar&aacute; 
  <span class="codefrag">TiendaDvdWS</span>, y estar&aacute; dentro de un proyecto Maven con nombre 
  <span class="codefrag">Sesion2-tienda-WS</span>.
  </p>
<p>Para construir una lista con las pel&iacute;culas cuyo director coincida con 
  el nombre del director que se ha solicitado, podemos utilizar un c&oacute;digo 
  similar al siguiente, donde se ha proporcionado un par&aacute;metro <span class="codefrag">director</span>:</p>
<pre class="code">director = director.toLowerCase();
   
ArrayList&lt;PeliculaTO&gt; list = new ArrayList&lt;PeliculaTO&gt;();
   
for (PeliculaTO pelicula : peliculas) {
  if (pelicula.getDirector().toLowerCase().indexOf(director) != -1) {
    list.add(pelicula);
  }
}
      
return list;</pre>
<p>Una vez implementado el servicio, desplegarlo en Glassfish y probarlo mediante 
el cliente de prueba generado. Observar los tipos de datos definidos en el documento 
WSDL generado y los mensajes SOAP para la invocaci&oacute;n del servicio. (0,5 puntos)</p>
<p>
  
<em>b)</em> Implementar un cliente java maven utilizando Netbeans. El cliente se llamar&aacute; 
  <span class="codefrag">Sesion2-tienda-WS-client</span>, y realizar&aacute; una llamada al servicio mostrando, para 
  cada pel&iacute;cula del director "kubrick", el t&iacute;tulo, el nombre del director y el precio. (0,5 puntos)
  </p>
</div>



<p class="pageBreakAfter"></p>


</div>
<div class="clearboth">&nbsp;</div>
</div>
<div id="footer">
<div class="lastmodified">
<script type="text/javascript"><!--
document.write("<text>Last Published:</text> " + document.lastModified);
//  --></script>
</div>
<div class="copyright">
        Copyright &copy;
         2012-2013 Dept. Ciencia de la Computaci&oacute;n e IA</div>
</div>
<script type="text/javascript">
     
         SyntaxHighlighter.defaults['toolbar'] = false;
         SyntaxHighlighter.autoloader(
  		     'java                   skin/highlight/shBrushJava.js',
  		     'xml xhtml xslt html    skin/highlight/shBrushXml.js',
  		     'js jscript javascript  skin/highlight/shBrushJScript.js',
  		     'groovy                 skin/highlight/shBrushGroovy.js',
  		     'bash shell             skin/highlight/shBrushBash.js',
  		     'php                    skin/highlight/shBrushPhp.js',
  		     'css                    skin/highlight/shBrushCss.js',
  		     'sql                    skin/highlight/shBrushSql.js',
  		     'objc                   skin/highlight/shBrushObjC.js',
  		     'cpp c                  skin/highlight/shBrushCpp.js',
  		     'text plain             skin/highlight/shBrushPlain.js'
         );
         SyntaxHighlighter.all();
     </script><a href="skin/highlight/shBrushJava.js"></a><a href="skin/highlight/shBrushXml.js"></a><a href="skin/highlight/shBrushJScript.js"></a><a href="skin/highlight/shBrushGroovy.js"></a><a href="skin/highlight/shBrushBash.js"></a><a href="skin/highlight/shBrushPhp.js"></a><a href="skin/highlight/shBrushCss.js"></a><a href="skin/highlight/shBrushSql.js"></a><a href="skin/highlight/shBrushObjC.js"></a><a href="skin/highlight/shBrushCpp.js"></a><a href="skin/highlight/shBrushPlain.js"></a>
</body>
</html>
