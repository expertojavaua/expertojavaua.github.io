<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<META http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta content="Apache Forrest" name="Generator">
<meta name="Forrest-version" content="0.7">
<meta name="Forrest-skin-name" content="pelt">
<title>Introducci&oacute;n a Struts 2</title>
<link type="text/css" href="skin/basic.css" rel="stylesheet">
<link media="screen" type="text/css" href="skin/screen.css" rel="stylesheet">
<link media="print" type="text/css" href="skin/print.css" rel="stylesheet">
<link type="text/css" href="skin/profile.css" rel="stylesheet">
<script src="skin/getBlank.js" language="javascript" type="text/javascript"></script><script src="skin/getMenu.js" language="javascript" type="text/javascript"></script><script src="skin/fontsize.js" language="javascript" type="text/javascript"></script>
<link rel="shortcut icon" href="">
</head>
<body onload="init()">
<script type="text/javascript">ndeSetTextSize();</script>
<div id="top">
<div class="header">
<div class="grouplogo">
<a href="http://web.ua.es/especialistajava"><img class="logoImage" alt="jtech" src="images/baner_j2ee_izq.gif" title="Especialista Universitario Java Enterprise"></a>
</div>
<div class="projectlogoA1">
<a href="http://www.dccia.ua.es/"><img class="logoImage" alt="Struts" src="images/baner_j2ee_der.gif" title="Struts"></a>
</div>
<ul id="tabs">
<li>
<a class="base-not-selected" href="javascript:location.href='../index.html'">Home</a>
</li>
<li>
<a class="base-not-selected" href="javascript:location.href='../aplic-web.html'">Aplicaciones Web</a>
</li>
<li>
<a class="base-not-selected" href="javascript:location.href='../aplic-ent.html'">Aplicaciones Enterprise</a>
</li>
<li>
<a class="base-not-selected" href="javascript:location.href='../charlas.html'">Charlas</a>
</li>
<li>
<a class="base-not-selected" href="javascript:location.href='../proy-int/index.html'">Proyecto</a>
</li>
<li class="current">
<a class="base-selected" href="index.html">Struts</a>
</li>
</ul>
</div>
</div>
<div id="main">
<div id="publishedStrip">
<div id="level2tabs"></div>
<script type="text/javascript"><!--
document.write("<text>Last Published:</text> " + document.lastModified);
//  --></script>
</div>
<div class="breadtrail">
             
             &nbsp;
           </div>
<div id="menu">
<div onclick="SwitchMenu('menu_selected_1.1', 'skin/')" id="menu_selected_1.1Title" class="menutitle" style="background-image: url('skin/images/chapter_open.gif');">Struts</div>
<div id="menu_selected_1.1" class="selectedmenuitemgroup" style="display: block;">
<div class="menuitem">
<a href="index.html" title="Struts">&Iacute;ndice</a>
</div>
<div onclick="SwitchMenu('menu_selected_1.1.2', 'skin/')" id="menu_selected_1.1.2Title" class="menutitle" style="background-image: url('skin/images/chapter_open.gif');">Teor&iacute;a</div>
<div id="menu_selected_1.1.2" class="selectedmenuitemgroup" style="display: block;">
<div class="menuitem">
<a href="sesion01-struts-apuntes.html">Sesion 1</a>
</div>
<div class="menuitem">
<a href="sesion02-struts-apuntes.html">Sesion 2</a>
</div>
<div class="menuitem">
<a href="sesion03-struts-apuntes.html">Sesion 3</a>
</div>
<div class="menupage">
<div class="menupagetitle">Sesion 4</div>
</div>
</div>
<div onclick="SwitchMenu('menu_1.1.3', 'skin/')" id="menu_1.1.3Title" class="menutitle">Ejercicios</div>
<div id="menu_1.1.3" class="menuitemgroup">
<div class="menuitem">
<a href="sesion01-struts-ejercicios.html">Sesion 1</a>
</div>
<div class="menuitem">
<a href="sesion02-struts-ejercicios.html">Sesion 2</a>
</div>
<div class="menuitem">
<a href="sesion03-struts-ejercicios.html">Sesion 3</a>
</div>
<div class="menuitem">
<a href="sesion04-struts-ejercicios.html">Sesion 4</a>
</div>
</div>
</div>
<div id="credit"></div>
<div id="roundbottom">
<img style="display: none" class="corner" height="15" width="15" alt="" src="skin/images/rc-b-l-15-1body-2menu-3menu.png"></div>
<div id="credit2"></div>
</div>
<div id="content">
<div title="Portable Document Format" class="pdflink">
<a class="dida" href="sesion04-struts-apuntes.pdf"><img alt="PDF -icon" src="skin/images/pdfdoc.gif" class="skin"><br>
        PDF</a>
</div>
<h1>Introducci&oacute;n a Struts 2</h1>
<div id="minitoc-area">
<ul class="minitoc">
<li>
<a href="#Configuraci%C3%B3n">Configuraci&oacute;n</a>
</li>
<li>
<a href="#De+Struts+1.x+a+Struts+2">De Struts 1.x a Struts 2</a>
<ul class="minitoc">
<li>
<a href="#Acciones">Acciones</a>
</li>
<li>
<a href="#El+ocaso+de+los+ActionForms">El ocaso de los ActionForms</a>
</li>
<li>
<a href="#Taglibs">Taglibs</a>
</li>
<li>
<a href="#Internacionalizaci%C3%B3n">Internacionalizaci&oacute;n</a>
</li>
<li>
<a href="#Validaci%C3%B3n">Validaci&oacute;n</a>
</li>
</ul>
</li>
<li>
<a href="#Conceptos+nuevos+en+Struts+2">Conceptos nuevos en Struts 2</a>
<ul class="minitoc">
<li>
<a href="#Interceptores">Interceptores</a>
</li>
<li>
<a href="#OGNL+y+value+stack">OGNL y value stack</a>
</li>
</ul>
</li>
</ul>
</div>

<p>Con el paso de los a&ntilde;os, Struts se ha convertido en EL framework MVC para JavaEE por excelencia. No obstante,  
tambi&eacute;n se ha quedado un poco anticuado. Nacido en otra &eacute;poca, el dise&ntilde;o original de Struts no respeta principios que hoy
se consideran b&aacute;sicos en JavaEE, como el uso de APIs "no invasivos" que minimicen las dependencias en nuestro c&oacute;digo de los APIs del framework, o la facilidad para hacer pruebas unitarias. 
</p>

<p>Struts 2 es la "siguiente generaci&oacute;n"
de Struts, dise&ntilde;ado desde el comienzo con estos principios b&aacute;sicos en mente. Vamos a ver en esta 
sesi&oacute;n una introducci&oacute;n r&aacute;pida a las ideas fundamentales de la versi&oacute;n 2. Dadas las limitaciones
de tiempo y espacio, y la suposici&oacute;n previa de que se conoce Struts 1.x, comenzaremos por los cambios fundamentales introducidos en la versi&oacute;n 2
con respecto a la 1.x, seguida de una breve introducci&oacute;n a ciertas ideas (interceptores, <em>value stack</em>,
etc), que aun siendo b&aacute;sicas en Struts 2 no exist&iacute;an en la versi&oacute;n 1.x. Para abordar Struts 2
 partiendo de cero seguir&iacute;amos un orden distinto en la introducci&oacute;n de conceptos.</p>

<a name="N10015"></a><a name="Configuraci%C3%B3n"></a>
<h2 class="underlined_10">Configuraci&oacute;n</h2>
<div class="section">
<p>Lo primero es copiar los JARs de Struts 2 en nuestro proyecto. En la web del framework se incluye una plantilla
de ejemplo con los JARs necesarios. Como m&iacute;nimo necesitaremos las versiones correspondientes
de <span class="codefrag">struts-core</span>,
<span class="codefrag">xwork</span>, <span class="codefrag">ognl</span>, <span class="codefrag">freemarker</span> y <span class="codefrag">commons-logging</span>.</p>
<p>Al igual que en Struts 1.x debemos hacer que todas las peticiones se redirijan al servlet
que hace de controlador. En el <span class="codefrag">web.xml</span> de la aplicaci&oacute;n haremos:</p>
<pre class="code">
&lt;filter&gt;
   &lt;filter-name&gt;struts2&lt;/filter-name&gt;
   &lt;filter-class&gt;org.apache.struts2.dispatcher.FilterDispatcher&lt;/filter-class&gt;
&lt;/filter&gt;
&lt;filter-mapping&gt;
   &lt;filter-name&gt;struts2&lt;/filter-name&gt;
   &lt;url-pattern&gt;/*&lt;/url-pattern&gt;
&lt;/filter-mapping&gt;
</pre>
<p>N&oacute;tese que en Struts 2 el mapeo de las peticiones se hace con un filtro de servlets
en lugar de con un <span class="codefrag">servlet-mapping</span>.</p>
<p>El fichero de configuraci&oacute;n XML cambia de formato, haci&eacute;ndose m&aacute;s conciso. Adem&aacute;s, por defecto pasa
a llamarse <span class="codefrag">struts.xml</span> en lugar de <span class="codefrag">struts-config.xml</span> y a residir
en el CLASSPATH en lugar de en <span class="codefrag">WEB-INF</span>. Su estructura b&aacute;sica es:
</p>
<pre class="code">
&lt;!DOCTYPE struts PUBLIC
    "-//Apache Software Foundation//DTD Struts Configuration 2.0//EN"
    "http://struts.apache.org/dtds/struts-2.0.dtd"&gt;
&lt;struts&gt;
  &lt;package name="default" extends="struts-default"&gt;
    &lt;action ...&gt;
        &lt;result&gt;...&lt;/result&gt;
    &lt;/action&gt;
		...        
  &lt;/package&gt;
&lt;/struts&gt;
</pre>
<p>Donde cada <span class="codefrag">package</span> define un conjunto de acciones, heredando su 
configuraci&oacute;n de alg&uacute;n otro <span class="codefrag">package</span>. En todos los ejemplos
usaremos el <span class="codefrag">struts-default</span>, que se define en la distribuci&oacute;n est&aacute;ndar, 
e incluye una serie de elementos b&aacute;sicos para el trabajo con el framework.</p>
<p>Siguiendo las "tendencias" actuales en JavaEE, el fichero de configuraci&oacute;n
puede ser sustituido casi totalmente por el uso de anotaciones, aunque dadas las limitaciones
de tiempo y espacio de la sesi&oacute;n aqu&iacute; usaremos el XML, por ser la forma m&aacute;s similar a Struts 1.x.</p>
</div>

<a name="N1005D"></a><a name="De+Struts+1.x+a+Struts+2"></a>
<h2 class="underlined_10">De Struts 1.x a Struts 2</h2>
<div class="section">
<p>Veamos de forma r&aacute;pida c&oacute;mo han cambiado en la versi&oacute;n 2 los 
principales componentes de una aplicaci&oacute;n
Struts: acciones, actionforms y taglibs.</p>
<a name="N10066"></a><a name="Acciones"></a>
<h3 class="underlined_5">Acciones</h3>
<p>El c&oacute;digo de una acci&oacute;n de Struts 1.x tiene fuertes dependencias  del API de Struts y del API de servlets.
Recordemos el primer ejemplo de acci&oacute;n que vimos en la sesi&oacute;n 1, donde se destacan en negrita las dependencias:</p>
<pre class="code">
package acciones;
<strong>
import javax.servlet.http.*;
import org.apache.struts.action.*;
</strong>
public class AccionLogin <strong>extends Action</strong> 
   <strong>public ActionForward execute(ActionMapping mapping, ActionForm form,
			HttpServletRequest request, HttpServletResponse response) 
			throws Exception {</strong>
	boolean usuarioOK;
	//obtener login y password y autentificar al usuario
	//si es correcto, poner usuarioOK a 'true'
	...
	//dirigirnos a la vista adecuada seg&uacute;n el resultado
	if (usuarioOK)
	   return <strong>mapping.findForward("OK")</strong>;
	else
	   return <strong>mapping.findForward("errorUsuario")</strong>;
   }
}
</pre>
<p> Estas dependencias  son una "molestia" a la hora de hacer pruebas unitarias. Para probar nuestra acci&oacute;n
necesitamos tener Struts y el contenedor de servlets en marcha. Adem&aacute;s dificultan la portabilidad
de nuestro c&oacute;digo a otro framework MVC distinto de Struts.</p>
<p> La tendencia
actual en JavaEE es el uso de APIs "no invasivos", que no necesitan de dependencias expl&iacute;citas en el c&oacute;digo. Siguiendo
esta filosof&iacute;a, en Struts 2 una
acci&oacute;n es una clase java convencional, que no es necesario que herede de ninguna clase especial:</p>
<pre class="code">
package acciones;

public class AccionLogin {
	public String execute() {
	  boolean usuarioOK;
	  //obtener login y password y autentificar al usuario
	  //si es correcto, poner usuarioOK a 'true'
	  ...
	  //dirigirnos a la vista adecuada seg&uacute;n el resultado
	  if (usuarioOK)
	     return "OK";
	  else
	     return "errorUsuario";
	}
}

</pre>
<p>N&oacute;tese que las dependencias de APIs externos al c&oacute;digo se han reducido a cero (luego veremos
c&oacute;mo obtener los par&aacute;metros HTTP y otra informaci&oacute;n de contexto). As&iacute;, nuestra acci&oacute;n se puede probar
f&aacute;cilmente y portarla a otro framework MVC es tambi&eacute;n mucho m&aacute;s sencillo.</p>
<div class="frame warning">
<div class="label">Aviso</div>
<div class="content">Aunque no hay dependencias directas del API de Struts, el "formato" de nuestra acci&oacute;n no 
es totalmente libre. Por defecto, el m&eacute;todo que ejecuta la acci&oacute;n debe llamarse <span class="codefrag">execute</span>, no tener 
par&aacute;metros y devolver un String.</div>
</div>
<p>Por supuesto, sigue siendo necesario mapear una determinada URL con la acci&oacute;n y asociar los resultados
con la vista a mostrar. Esto se hace en el <span class="codefrag">struts.xml</span> (o de manera alternativa
con anotaciones):</p>
<pre class="code">
&lt;!DOCTYPE struts PUBLIC
    "-//Apache Software Foundation//DTD Struts Configuration 2.0//EN"
    "http://struts.apache.org/dtds/struts-2.0.dtd"&gt;
&lt;struts&gt;
   &lt;package name="default" extends="struts-default"&gt;
      <strong>&lt;action name="login" class="acciones.AccionLogin"&gt;
         &lt;result name="OK"&gt;/usuario.jsp&lt;/result&gt;
         &lt;result name="errorUsuario"&gt;/error.jsp&lt;/result&gt;
      &lt;/action&gt;</strong>  
   &lt;/package&gt;
&lt;/struts&gt;
</pre>
<p>Por defecto, la acci&oacute;n se asocia con una URL igual a su <span class="codefrag">name</span> seguida del sufijo ".action". En 
este caso "login.action" ser&iacute;a la que dispara la acci&oacute;n.</p>
<p>Por conveniencia Struts 2 ofrece una clase llamada <span class="codefrag">ActionSupport</span> de la que
pueden heredar nuestras acciones. Una de las ventajas de usar <span class="codefrag">ActionSupport</span>
es disponer de una serie de constantes predefinidas con posibles resultados de la acci&oacute;n,
en lugar de usar Strings arbitrarios como en el ejemplo anterior.</p>
<pre class="code">
package acciones;

<strong>import com.opensymphony.xwork2.ActionSupport;</strong>

public class AccionLogin <strong>extends ActionSupport</strong> {
	
  @Override
  <strong>public String execute() throws Exception</strong> {
    boolean usuarioOK;
    //obtener login y password y autentificar al usuario
    //si es correcto, poner usuarioOK a 'true'
    ...
    //dirigirnos a la vista adecuada seg&uacute;n el resultado
    if (usuarioOK)
	  return <strong>SUCCESS</strong>;
    else
      return <strong>ERROR</strong>;
  }
}
</pre>
<a name="N100C5"></a><a name="El+ocaso+de+los+ActionForms"></a>
<h3 class="underlined_5">El ocaso de los ActionForms</h3>
<p>Los ActionForms son uno de los puntos m&aacute;s d&eacute;biles de Struts 1.x, presentando una serie
de problemas:</p>
<ul>

<li>Dependencia del API de Struts, ya que deben heredar de clases propias del framework</li>

<li>Como los campos deben poder acomodar datos de tipo incorrecto, al final todos acaban siendo de
tipo String. Esto implica que no podemos usar los ActionForms como objetos de negocio, llevando a:
<ul>

<li>La multiplicaci&oacute;n del n&uacute;mero de clases necesarias</li>

<li>La necesidad de convertir los valores al tipo apropiado</li>

<li>La necesidad de copiar los valores al objeto de negocio</li>

</ul>

</li>

</ul>
<p>Aunque librer&iacute;as como BeanUtils alivian en parte los dos &uacute;ltimos problemas, es evidente que ser&iacute;a mejor
que todo estuviera integrado en el propio framework antes que tener que usar herramientas
adicionales.</p>
<p>Por todo ello, en Struts 2 se ha tomado la decisi&oacute;n de eliminar los ActionForms como tales. Por
supuesto, las acciones seguir&aacute;n necesitando acceso a beans Java para hacer su trabajo, pero
ser&aacute;n clases java convencionales sin ning&uacute;n requisito especial. Veamos c&oacute;mo podr&iacute;a obtener la acci&oacute;n
de login los datos necesarios para comprobar usuario/contrase&ntilde;a. Antes que nada, necesitamos
un bean para almacenarlos</p>
<pre class="code">
package modelo;

public class Usuario {
	private String login;
	private String password;
	
	public String getLogin() {
		return login;
	}
	public void setLogin(String login) {
		this.login = login;
	}
	public String getPassword() {
		return password;
	}
	public void setPassword(String password) {
		this.password = password;
	}	
}
</pre>
<p>N&oacute;tese que la clase anterior es un JavaBean convencional que no depende del API de Struts.</p>
<p> Ahora
la acci&oacute;n recibir&aacute; el bean mediante <em>inyecci&oacute;n de dependencias</em>. Esta es una filosof&iacute;a
de trabajo muy habitual actualmente en JavaEE en la que se asume que alguien externo (Struts
en este caso) le pasar&aacute; a nuestro c&oacute;digo el/los objetos necesarios para hacer su trabajo. En
nuestra acci&oacute;n estamos asumiendo que antes de llamar a <span class="codefrag">execute</span>, Struts
habr&aacute; instanciado la variable <span class="codefrag">usuario</span> llamando al m&eacute;todo <span class="codefrag">setUsuario</span>.</p>
<pre class="code">
package acciones;

import modelo.Usuario;

public class LoginAccion {
	<strong>private Usuario usuario;
		
	public Usuario getUsuario() {
		return usuario;
	}

	public void setUsuario(Usuario usuario) {
		this.usuario = usuario;
	}</strong>

	public String execute() {
		String login = usuario.getLogin();
		...
	}
}
</pre>
<p>N&oacute;tese la diferencia fundamental con Struts 1.x: en &eacute;ste, el bean (ActionForm) se recib&iacute;a como 
un par&aacute;metro del <span class="codefrag">execute</span>. En Struts 2 se recibe a trav&eacute;s del <em>setter</em>.</p>
<p>Todo esto est&aacute; muy bien, pero &iquest;de d&oacute;nde salen los datos del objeto <span class="codefrag">Usuario</span>?. Resulta
que si usamos las taglibs de Struts 2 para nuestros JSP, sus valores se rellenar&aacute;n autom&aacute;ticamente,
igual que pasaba con los ActionForms en Struts 1.x.</p>
<a name="N10116"></a><a name="Taglibs"></a>
<h3 class="underlined_5">Taglibs</h3>
<p>Al igual que Struts 1.x, la versi&oacute;n 2 incluye varias taglibs propias. Adem&aacute;s de haberse
mejorado, sobre todo se ha simplificado su uso. Por ejemplo, supongamos
que queremos generar el siguiente formulario y asociar sus
campos a un bean de tipo usuario. Adem&aacute;s queremos mostrar los errores de validaci&oacute;n, si
los hay</p>
<p>

<img alt="formulario" content-width="10cm" src="img/sesion4/form.gif">
</p>
<p>Podemos hacerlo con el siguiente HTML</p>
<pre class="code">
<strong>&lt;%@taglib prefix="s2" uri="/struts-tags" %&gt;</strong>
&lt;html&gt;
&lt;head&gt;
  &lt;title&gt;Ejemplo de taglib HTML en Struts 2&lt;/title&gt;
&lt;/head&gt;
&lt;body&gt;<strong>
  Entrar en la aplicaci&oacute;n:&lt;br/&gt;  
  &lt;s2:form action="login"&gt;
    &lt;s2:textfield label="usuario" name="usuario.login"/&gt;
    &lt;s2:password label="contrase&ntilde;a" name="usuario.password"/&gt;
    &lt;s2:submit value="login"/&gt;
  &lt;/s2:form&gt;</strong>
&lt;/body&gt;
&lt;/html&gt;
</pre>
<p>A partir del ejemplo, podemos ver que ha habido varios cambios con respecto a 
Struts 1.x:</p>
<ul>

<li>Algunas etiquetas han cambiado: por ejemplo, <span class="codefrag">textfield</span>
era <span class="codefrag">text</span> en Struts 1.x</li>

<li>Los campos de formulario generan tambi&eacute;n un r&oacute;tulo con texto precedi&eacute;ndolos ("Usuario" y "Contrase&ntilde;a"). En Struts 1.x
hab&iacute;a que ponerlos manualmente. Tampoco hay que formatear expl&iacute;citamente los campos para que aparezcan
uno debajo del otro.</li>

<li>Podemos asociar un campo a una propiedad de un bean sin m&aacute;s que poner <span class="codefrag">nombre_bean.nombre_propiedad</span>.
Las taglibs de Struts 2 usan un lenguaje de expresiones similar al EL de JSP denominado OGNL.</li>

<li>No es necesario poner etiquetas para mostrar los errores de forma expl&iacute;cita. Si activamos la validaci&oacute;n (veremos
posteriormente c&oacute;mo hacerlo), al lado de cada campo aparecer&aacute; el mensaje de error correspondiente.</li>

</ul>
<p>Como vemos, la cantidad de HTML introducida por las etiquetas de Struts 2 es sensiblemente
superior a la de sus equivalentes en 1.x. Este HTML es configurable , ya que Struts 2 usa plantillas
predefinidas de <em>freemarker</em> para generarlo, que podemos cambiar por otras o adaptar a nuestras
necesidades.</p>
<a name="N10155"></a><a name="Internacionalizaci%C3%B3n"></a>
<h3 class="underlined_5">Internacionalizaci&oacute;n</h3>
<p>Al igual que las tags de Struts 1.x, las de Struts 2 soportan internacionalizaci&oacute;n. Los mensajes
se sacan tambi&eacute;n de ficheros .properties.  En nuestro ejemplo usaremos el fichero "global"
de .properties, cuyo nombre
se define en el archivo <span class="codefrag">struts.properties</span>, en la ra&iacute;z del CLASSPATH. Recordar que en struts 1.x este fichero
se defin&iacute;a en el XML de configuraci&oacute;n con la etiqueta <span class="codefrag">message-resources</span>. Nuestro
<span class="codefrag">struts.properties</span> contendr&iacute;a una l&iacute;nea con:</p>
<pre class="code">
struts.custom.i18n.resources=mensajes
</pre>
<p>Definiendo por tanto <span class="codefrag">mensajes.properties</span>, en la ra&iacute;z del CLASSPATH, como
nuestro fichero de mensajes. Para aumentar la modularidad, Struts 2 permite definir ficheros de mensajes
propios de una acci&oacute;n o globales solo a un <span class="codefrag">package</span> java (entre otras opciones), aunque no veremos
aqu&iacute; como definirlos.</p>
<p>Nuestro <span class="codefrag">mensajes_es.properties</span>, para idioma espa&ntilde;ol, podr&iacute;a contener:</p>
<pre class="code">
loginTitle=Entrar en la aplicaci&oacute;n
login=Usuario
password=Contrase&ntilde;a
enter=Entrar
</pre>
<p>Habr&iacute;a que cambiar las tags de Struts para que hagan uso del fichero de mensajes</p>
<pre class="code">
<strong>&lt;%@taglib prefix="s2" uri="/struts-tags" %&gt;</strong>
&lt;html&gt;
&lt;head&gt;
  &lt;title&gt;Ejemplo de taglib HTML en Struts 2&lt;/title&gt;
&lt;/head&gt;
&lt;body&gt;<strong>
  &lt;s2:label key="loginTitle"/&gt;</strong>  
  &lt;s2:form action="login"&gt;
    &lt;s2:textfield <strong>key="login"</strong> name="usuario.login"/&gt;
    &lt;s2:password <strong>key="password"</strong> name="usuario.password"/&gt;
    &lt;s2:submit <strong>key="enter"</strong>/&gt;
  &lt;/s2:form&gt;
&lt;/body&gt;
&lt;/html&gt;
</pre>
<a name="N10194"></a><a name="Validaci%C3%B3n"></a>
<h3 class="underlined_5">Validaci&oacute;n</h3>
<p>Struts 2 tambi&eacute;n permite validaci&oacute;n declarativa, aunque ya no usa el <em>commons validator</em>. De
este modo se puede usar una sintaxis m&aacute;s concisa y adaptada a las necesidades del framework.</p>
<p>La pr&aacute;ctica recomendada en Struts 2 es definir la validaci&oacute;n
de cada acci&oacute;n en un XML separado. Por convenci&oacute;n el fichero debe tener el mismo nombre que la
clase que define la acci&oacute;n, con el sufijo <span class="codefrag">-validation</span>. Es decir, para la 
clase <span class="codefrag">LoginAccion</span> debe ser <span class="codefrag">LoginAccion-validation.xml</span>, en el mismo
paquete java que la clase de la acci&oacute;n. Veamos un ejemplo, suponiendo que queremos que login sea obligatorio</p>
<pre class="code">
&lt;!DOCTYPE validators PUBLIC 
"-//OpenSymphony Group//XWork Validator 1.0.2//EN" 
"http://www.opensymphony.com/xwork/xwork-validator-1.0.2.dtd"&gt;
&lt;validators&gt;
    &lt;field name="usuario.login"&gt;
        &lt;field-validator type="requiredstring"&gt;
            &lt;message&gt;Login no puede estar vac&iacute;o&lt;/message&gt;
        &lt;/field-validator&gt;
    &lt;/field&gt;
&lt;/validators&gt;
</pre>
<p>Como se ve, la sintaxis se simplifica bastante con respecto a Struts 1.x. Aunque en el ejemplo
el mensaje de error est&aacute; fijo en el XML, para simplificar, por supuesto se puede externalizar a un properties.</p>
<p>Para que nuestra acci&oacute;n soporte validaci&oacute;n, debe implementar el interfaz <span class="codefrag">ValidationAware</span>.
Dicho interfaz define varios m&eacute;todos, para gestionar los errores producidos. Afortunadamente
no es necesario implementarlos si nuestra acci&oacute;n hereda de <span class="codefrag">ActionSupport</span>.</p>
<div class="frame warning">
<div class="label">Aviso</div>
<div class="content">Si la acci&oacute;n no hereda de ActionSupport (o implementa los m&eacute;todos del interfaz ValidationAware), la
validaci&oacute;n declarativa no funcionar&aacute;</div>
</div>
<p>En el XML de configuraci&oacute;n un error de validaci&oacute;n se asocia con un resultado "input" (por "herencia"
de la palabra clave usada en Struts 1.x). As&iacute;, el <span class="codefrag">action</span> del struts.xml quedar&iacute;a:</p>
<pre class="code">
&lt;action name="login" class="es.ua.jtech.struts2.prueba.acciones.LoginAccion"&gt;
  &lt;result name="ok"&gt;/usuario.jsp&lt;/result&gt;
  <strong>&lt;result name="input"&gt;/index.jsp&lt;/result&gt;</strong>
&lt;/action&gt;
</pre>
<p>En <span class="codefrag">ActionSupport</span> se define la constante <span class="codefrag">INPUT</span> con el valor <span class="codefrag">"input"</span>,
de modo que en el c&oacute;digo java de la acci&oacute;n har&iacute;amos un <span class="codefrag">return INPUT</span> si tuvi&eacute;ramos
que validar alguna condici&oacute;n manualmente en el <span class="codefrag">execute()</span> de la acci&oacute;n.</p>
</div>

<a name="N101E0"></a><a name="Conceptos+nuevos+en+Struts+2"></a>
<h2 class="underlined_10">Conceptos nuevos en Struts 2</h2>
<div class="section">
<p>Por lo visto en los apartados anteriores puede dar la impresi&oacute;n de que, aunque Struts
se ha mejorado y simplificado su uso, sigue siendo el mismo framework "por dentro". Nada m&aacute;s lejos de la realidad,
su arquitectura y funcionamiento interno han cambiado completamente. De ah&iacute; que haya conceptos
totalmente nuevos que no tienen equivalencia en la versi&oacute;n 1. Veremos aqu&iacute; muy brevemente algunos de
ellos</p>
<a name="N101E9"></a><a name="Interceptores"></a>
<h3 class="underlined_5">Interceptores</h3>
<p>Los interceptores son elementos que interceptan
la petici&oacute;n antes de que se ejecute la acci&oacute;n de destino. De este modo se pueden realizar
tareas sin tener que modificar el c&oacute;digo de la acci&oacute;n. Podemos decir que desempe&ntilde;an un papel
muy similar al de los filtros de servlets pero con relaci&oacute;n a las acciones. La configuraci&oacute;n por defecto
de Struts incluye una pila completa de interceptores activos para todas las peticiones. De hecho,
la inyecci&oacute;n de dependencias que ve&iacute;amos en el ejemplo de acci&oacute;n es responsabilidad de un interceptor. Y
tambi&eacute;n la validaci&oacute;n de campos, entre otras muchas tareas.</p>
<p>Pese a su importancia, es raro que el desarrollador de Struts tenga que "v&eacute;rselas" directamente
con los interceptores. Como mucho, tendremos que hacer que nuestras acciones implementen alg&uacute;n interfaz
o hereden de alguna clase para interactuar con el interceptor. De hecho, recordemos que para la validaci&oacute;n
deb&iacute;amos implementar el interfaz <span class="codefrag">ValidationAware</span> (o heredar de <span class="codefrag">ActionSupport</span>).
</p>
<a name="N101FC"></a><a name="OGNL+y+value+stack"></a>
<h3 class="underlined_5">OGNL y value stack</h3>
<p>El <em>value stack</em>, como su nombre sugiere, es una pila donde se colocan objetos a
los que podemos necesitar acceso en un momento dado. Struts coloca en esta pila, 
entre otros, la acci&oacute;n a ejecutar y los &aacute;mbitos de aplicaci&oacute;n, sesi&oacute;n, petici&oacute;n,...</p>
<p> OGNL es
un lenguaje de expresiones que se usa para referenciar elementos en esta pila. Su sintaxis
es similar a la del EL de JSP, aunque bastante m&aacute;s potente. En una aplicaci&oacute;n Struts,
es en las tags propias del framework donde se usa habitualmente OGNL. Cuando en un ejemplo
anterior pon&iacute;amos la expresi&oacute;n OGNL <span class="codefrag">usuario.login</span>, la est&aacute;bamos buscando en la
pila de valores. Como hemos dicho, la acci&oacute;n se coloca autom&aacute;ticamente en esta pila. OGNL nos permite
ir navegando por objetos relacionados entre s&iacute; (de hecho significa
 <em>Object Graph Navigation Language</em>). De este modo podemos acceder a la
 propiedad <span class="codefrag">usuario</span> de la acci&oacute;n y dentro de ella a la propiedad <span class="codefrag">login</span>.
 Al igual que en EL, cuando ponemos <span class="codefrag">objeto.propiedad</span>, se asume que accedemos
 a &eacute;sta a trav&eacute;s de m&eacute;todos get/set.</p>
</div>


 
<p class="pageBreakAfter"></p>
 
 
</div>
<div class="clearboth">&nbsp;</div>
</div>
<div id="footer">
<div class="lastmodified">
<script type="text/javascript"><!--
document.write("<text>Last Published:</text> " + document.lastModified);
//  --></script>
</div>
<div class="copyright">
        Copyright &copy;
         2010-2011 Dept. Ciencia de la Computaci&oacute;n e IA</div>
</div>
</body>
</html>
