<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<META http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta content="Apache Forrest" name="Generator">
<meta name="Forrest-version" content="0.7">
<meta name="Forrest-skin-name" content="pelt">
<title>Sesi&oacute;n 3 de ejercicios EJB - Beans de sesi&oacute;n sin estado con BEA Workshop</title>
<link type="text/css" href="skin/basic.css" rel="stylesheet">
<link media="screen" type="text/css" href="skin/screen.css" rel="stylesheet">
<link media="print" type="text/css" href="skin/print.css" rel="stylesheet">
<link type="text/css" href="skin/profile.css" rel="stylesheet">
<script src="skin/getBlank.js" language="javascript" type="text/javascript"></script><script src="skin/getMenu.js" language="javascript" type="text/javascript"></script><script src="skin/fontsize.js" language="javascript" type="text/javascript"></script>
<link rel="shortcut icon" href="">
</head>
<body onload="init()">
<script type="text/javascript">ndeSetTextSize();</script>
<div id="top">
<div class="header">
<div class="grouplogo">
<a href="http://www.jtech.ua.es/j2ee"><img class="logoImage" alt="J2EE" src="images/baner_j2ee_izq.gif" title="Curso Especialista Universitario J2EE"></a>
</div>
<div class="projectlogoA1">
<a href="http://www.dccia.ua.es/"><img class="logoImage" alt="Componentes EJB" src="images/baner_j2ee_der.gif" title="Componentes EJB"></a>
</div>
<ul id="tabs">
<li>
<a class="base-not-selected" href="../index.html">M&oacute;dulos</a>
</li>
<li class="current">
<a class="base-selected" href="index.html">Componentes EJB</a>
</li>
</ul>
</div>
</div>
<div id="main">
<div id="publishedStrip">
<div id="level2tabs"></div>
<script type="text/javascript"><!--
document.write("<text>Last Published:</text> " + document.lastModified);
//  --></script>
</div>
<div class="breadtrail">
             
             &nbsp;
           </div>
<div id="menu">
<div onclick="SwitchMenu('menu_selected_1.1', 'skin/')" id="menu_selected_1.1Title" class="menutitle" style="background-image: url('skin/images/chapter_open.gif');">Materiales</div>
<div id="menu_selected_1.1" class="selectedmenuitemgroup" style="display: block;">
<div class="menuitem">
<a href="index.html" title="Componentes EJB">&Iacute;ndice</a>
</div>
<div onclick="SwitchMenu('menu_1.1.2', 'skin/')" id="menu_1.1.2Title" class="menutitle">Teor&iacute;a</div>
<div id="menu_1.1.2" class="menuitemgroup">
<div class="menuitem">
<a href="sesion01-apuntes.html" title="Introducci&oacute;n a los Enterprise Beans">Sesi&oacute;n 1</a>
</div>
<div class="menuitem">
<a href="sesion02-apuntes.html" title="Beans de sesi&oacute;n">Sesi&oacute;n 2</a>
</div>
<div class="menuitem">
<a href="sesion03-apuntes.html" title="Beans de sesi&oacute;n">Sesi&oacute;n 3</a>
</div>
<div class="menuitem">
<a href="sesion04-apuntes.html" title="Beans de sesi&oacute;n">Sesi&oacute;n 4</a>
</div>
<div class="menuitem">
<a href="sesion05-apuntes.html" title="Seguridad">Sesi&oacute;n 5</a>
</div>
<div class="menuitem">
<a href="sesion06-apuntes.html" title="Transacciones">Sesi&oacute;n 6</a>
</div>
<div class="menuitem">
<a href="sesion07-apuntes.html" title="EJB 3.0">Sesi&oacute;n 7</a>
</div>
<div class="menuitem">
<a href="sesion08-apuntes.html" title="JPA">Sesi&oacute;n 8</a>
</div>
<div class="menuitem">
<a href="roadmap.html" title="Roadmap EJB">Roadmap</a>
</div>
</div>
<div onclick="SwitchMenu('menu_selected_1.1.3', 'skin/')" id="menu_selected_1.1.3Title" class="menutitle" style="background-image: url('skin/images/chapter_open.gif');">Ejercicios</div>
<div id="menu_selected_1.1.3" class="selectedmenuitemgroup" style="display: block;">
<div class="menuitem">
<a href="sesion01-ejercicios.html" title="Introducci&oacute;n a los Enterprise Beans">Sesi&oacute;n 1</a>
</div>
<div class="menuitem">
<a href="sesion02-ejercicios.html" title="Beans de sesi&oacute;n">Sesi&oacute;n 2</a>
</div>
<div class="menupage">
<div class="menupagetitle">Sesi&oacute;n 3</div>
</div>
<div class="menuitem">
<a href="sesion04-ejercicios.html" title="Beans de sesi&oacute;n con estado">Sesi&oacute;n 4</a>
</div>
<div class="menuitem">
<a href="sesion05-ejercicios.html" title="Seguridad">Sesi&oacute;n 5</a>
</div>
<div class="menuitem">
<a href="sesion06-ejercicios.html" title="Transacciones">Sesi&oacute;n 6</a>
</div>
<div class="menuitem">
<a href="sesion07-ejercicios.html" title="EJB 3.0">Sesi&oacute;n 7</a>
</div>
<div class="menuitem">
<a href="sesion08-ejercicios.html" title="JPA">Sesi&oacute;n 8</a>
</div>
</div>
</div>
<div id="credit"></div>
<div id="roundbottom">
<img style="display: none" class="corner" height="15" width="15" alt="" src="skin/images/rc-b-l-15-1body-2menu-3menu.png"></div>
<div id="credit2"></div>
</div>
<div id="content">
<div title="Portable Document Format" class="pdflink">
<a class="dida" href="sesion03-ejercicios.pdf"><img alt="PDF -icon" src="skin/images/pdfdoc.gif" class="skin"><br>
        PDF</a>
</div>
<h1>Sesi&oacute;n 3 de ejercicios EJB - Beans de sesi&oacute;n sin estado con BEA Workshop</h1>
<div id="minitoc-area">
<ul class="minitoc">
<li>
<a href="#Instalaci%C3%B3n+y+puesta+en+marcha+del+servidor">Instalaci&oacute;n y puesta en marcha del servidor </a>
</li>
<li>
<a href="#Proyecto+cliente">Proyecto cliente</a>
</li>
<li>
<a href="#Creaci%C3%B3n+del+enterprise+bean+Saludo">Creaci&oacute;n del enterprise bean Saludo</a>
</li>
<li>
<a href="#Prueba+de+los+clientes+del+bean">Prueba de los clientes del bean</a>
</li>
<li>
<a href="#%28*%29+Creaci%C3%B3n+de+la+aplicaci%C3%B3n+Web">(*) Creaci&oacute;n de la aplicaci&oacute;n Web</a>
</li>
<li>
<a href="#%28*%29+Creaci%C3%B3n+y+despliegue+del+EAR">(*) Creaci&oacute;n y despliegue del EAR</a>
</li>
</ul>
</div>


<p>En esta sesi&oacute;n de ejercicios vamos a crear el mismo ejb de sesi&oacute;n que en la clase pasada, pero utilizando el entorno de desarrollo BEA Workshop y el servidor de aplicaciones BEA WebLogic.</p>


<p>WebLogic permite, ya en la versi&oacute;n 2.1, el uso de anotaciones propias en el fichero de implementaci&oacute;n del enterprise bean. Estas anotaciones son procesdas por las herramientas de despliegue de WebLogic y el EJB se construye de forma autom&aacute;tica a partir de ellas. La especificaci&oacute;n EJB 3.0 utiliza una estrategia similar, pero con anotaciones est&aacute;ndar. </p>


<p>Pasar de la forma de trabajar con WebLogic a la especificaci&oacute;n 3.0 es inmediato.</p>


<a name="N10015"></a><a name="Instalaci%C3%B3n+y+puesta+en+marcha+del+servidor"></a>
<h2 class="underlined_10">Instalaci&oacute;n y puesta en marcha del servidor </h2>
<div class="section">
<p>1. Lanza el Workshop y crea el espacio de trabajo <span class="codefrag">Workshop</span> en el directorio que desees. Ese va a ser el espacio de trabajo en el que vas a desarrollar los proyectos en lo que queda de m&oacute;dulo.</p>
<p>2. A&ntilde;ade el <em>Runtime</em> de BEA Weblogic 9.2 con la opci&oacute;n "Window &gt; Preferences &gt; Server &gt; Installed Runtimes &gt; Add...". Selecciona el runtime que aparece:</p>
<p>

<img alt="" content-width="9cm" src="imagenes/ejercicios03/img1.png">
</p>
<p>3. Una vez a&ntilde;adido el runtime, pulsa el bot&oacute;n derecho en el panel de servidores para a&ntilde;adir un nuevo servidor ("Bot&oacute;n derecho &gt; New &gt; Server"). Introduce el dominio "ejb" que creaste en los ejercicios anteriores ("Next &gt; Enter Domain home (Browse...)  C:\bea\user_projects\domains\ejb"). Pulsa "Finish".</p>
<p>Pulsa en el bot&oacute;n "Play" para poner en marcha el servidor. Debe quedar en estado de "Started":</p>
<p>

<img alt="" content-width="9cm" src="imagenes/ejercicios03/img2.png">
</p>
<p>Aparecer&aacute; un terminal en el que se muestra la salida est&aacute;ndar del servidor de aplicaciones:</p>
<p>

<img alt="" content-width="9cm" src="imagenes/ejercicios03/img3.png">
</p>
</div>


<a name="N10049"></a><a name="Proyecto+cliente"></a>
<h2 class="underlined_10">Proyecto cliente</h2>
<div class="section">
<p>Vamos ahora a importar el proyecto cliente de la sesi&oacute;n anterior (creado con Eclipse) al entorno de trabajo Workhsop.</p>
<p>1. Copia la carpeta <span class="codefrag">ejb-cliente-saludo</span> de la carpeta donde est&aacute; el espacio de trabajo de Eclipse a la carpeta donde has creado el espacio de trabajo de Workshop.</p>
<p>2. Ya en Workshop, crea un nuevo proyecto java ("New &gt; Project... &gt; Java &gt; Java Project"). Introduce como nombre del proyecto el mismo del proyecto que has copiado (<span class="codefrag">ejb-cliente-saludo</span>). Aparecer&aacute; un mensaje en el que el Workshop te informa de que el proyecto ya existe y que va a intentar configurar el build path. Pulsa "Finish" y cambia a la perspectiva de Java. El entorno mostrar&aacute; el siguiente aspecto:</p>
<p>

<img alt="" content-width="13cm" src="imagenes/ejercicios03/img4.png">
</p>
<p>3. Aparece un error debido a que no se encuentran las librer&iacute;as de JUnit. Haz que Workshop las instale autom&aacute;ticamente creando un nuevo test y cancelando su creaci&oacute;n despu&eacute;s de haber a&ntilde;adido la librer&iacute;a al build path. El aspecto del proyecto debe ser el siguiente:</p>
<p>

<img alt="" content-width="4cm" src="imagenes/ejercicios03/img5.png">
</p>
<p>4. Prueba ahora a ejecutar el cliente y el test de JUnit. Ver&aacute;s que aparece un error, debido a que el enterprise bean no est&aacute; desplegado en el servidor.</p>
<p>

<img alt="" content-width="13cm" src="imagenes/ejercicios03/img6.png">
</p>
<div class="frame warning">
<div class="label">Aviso</div>
<div class="content">Puede ser que el bean haya quedado desplegado de la sesi&oacute;n anterior. En ese caso, elim&iacute;nalo utilizando la consola de administraci&oacute;n.</div>
</div>
</div>


<a name="N10080"></a><a name="Creaci%C3%B3n+del+enterprise+bean+Saludo"></a>
<h2 class="underlined_10">Creaci&oacute;n del enterprise bean Saludo</h2>
<div class="section">
<p>Una vez instalado el servidor de aplicaciones y el proyecto cliente vamos a crear y desplegar el bean Saludo.</p>
<p>1. Comenzamos creando un proyecto EJB WebLogic ("Bot&oacute;n derecho en el panel del explorador de proyectos &gt; New &gt; Project... &gt; EJB &gt; WebLogic EJB Project"). Escribimos como nombre de proyecto <span class="codefrag">ejb-saludo</span> terminamos ("Next &gt; Finish"). El entorno cambia a la perspectiva Workshop.</p>
<p>2. Creamos el paquete <span class="codefrag">es.ua.jtech.ejb.beans</span> y en &eacute;l creamos un WebLogic SessionBean ("Bot&oacute;n derecho sobre el paquete &gt; New &gt; WebLogic SessionBean"). Ponemos como nombre de fichero <span class="codefrag">SaludoBean</span>:</p>
<p>

<img alt="" content-width="13cm" src="imagenes/ejercicios03/img7.png">
</p>
<p>3. Vamos a escribir el c&oacute;digo del bean de sesi&oacute;n. Ser&aacute; el mismo que ten&iacute;a el fichero de implementaci&oacute;n del proyecto Eclipse, a&ntilde;adi&eacute;ndole algunas anotaciones. Abre el fichero <span class="codefrag">SaludoBean.java</span> del proyecto Eclipse ("File &gt; Open File &gt; ...") y copia la definici&oacute;n del array de saludos y los m&eacute;todos <span class="codefrag">saluda()</span> y <span class="codefrag">getSaludo()</span>. No tienes que copiar los m&eacute;todos vac&iacute;os que implementan la interfaz <span class="codefrag">SessionBean</span> porque ya est&aacute;n implementados en la clase <span class="codefrag">GenericSessionBean</span> extendida por la clase <span class="codefrag">SaludoBean</span>.</p>
<p>4. Arregla los errores del build path importando las clases necesarias (<span class="codefrag">java.util.Date</span> y <span class="codefrag">java.util.ArrayList</span>).</p>
<p>5. Crea la clase <span class="codefrag">SaludoTO</span> en el mismo paquete que el bean y copia su contenido del fichero del proyecto Eclipse.</p>
<p>6. Vamos ahora a modificar las anotaciones, para adaptarlas a los nombres que usamos en las sesiones anteriores. En primer lugar, en la clase <span class="codefrag">SaludoBean</span>, debe aparecer como nombre remoto JNDI <span class="codefrag">SaludoBean</span>:</p>
<pre class="code">@JndiName(remote="SaludoBean")</pre>
<p>Despu&eacute;s, los nombres de las interfaces remota y home debemos cambiarlos a "Saludo" y "SaludoHome":</p>
<pre class="code">
@FileGeneration(...
                remoteClassName="Saludo",
                remoteHomeName="SaludoHome")
                </pre>
<p>Por &uacute;ltimo, anota los m&eacute;todos <span class="codefrag">saluda()</span> y <span class="codefrag">getSaludo()</span> con la anotaci&oacute;n <span class="codefrag">@RemoteMethod()</span>
</p>
<p>Con esto ya est&aacute; definido el enterprise bean.</p>
<p>7. Antes de desplegar el bean, vamos a definir el nombre del fichero cliente ejbjar necesario para acceder al bean desde un cliente remoto. Pulsa "Bot&oacute;n derecho en ejb-saludo &gt; Properties &gt; WebLogic EJB"). Quita el <em>tic</em> "Use default" y escribe el nombre <span class="codefrag">ejb-saludo-clientjar.jar</span>.</p>
<p>

<img alt="" content-width="8cm" src="imagenes/ejercicios03/img8.png">
</p>
<p>8. Vamos ya a desplegar el bean. Pulsa en el servidor BEA WebLogic con el bot&oacute;n derecho y escoge la opci&oacute;n "Add and Remove Projects...". Ver&aacute;s el proyecto <span class="codefrag">ejb-saludo</span>. A&ntilde;&aacute;delo y finaliza el despliegue. El entorno debe quedar con el siguiente aspecto:</p>
<p>

<img alt="" content-width="13cm" src="imagenes/ejercicios03/img9.png">
</p>
<p>9. Abre la consola de administraci&oacute;n y comprueba que el bean est&aacute; deplegado.</p>
</div>


<a name="N10109"></a><a name="Prueba+de+los+clientes+del+bean"></a>
<h2 class="underlined_10">Prueba de los clientes del bean</h2>
<div class="section">
<p>1. Actualiza la librer&iacute;a clientjar del bean. Para ello borra la librer&iacute;a <span class="codefrag">ejb-saludo-clientjar.jar</span> del proyecto cliente con la opci&oacute;n "Bot&oacute;n derecho &gt; Build Path &gt; Remove from Build Path". Copia el fichero <span class="codefrag">ejb-saludo-clientjar.jar</span> del proyecto EJB al proyecto cliente y a&ntilde;&aacute;dela al build path ("Bot&oacute;n derecho &gt; Build Path &gt; Add to Build Path"). </p>
<p>2. Limpia el proyecto cliente y prueba la aplicaci&oacute;n cliente y los tests de JUnit.</p>
</div>


<a name="N1011C"></a><a name="%28*%29+Creaci%C3%B3n+de+la+aplicaci%C3%B3n+Web"></a>
<h2 class="underlined_10">(*) Creaci&oacute;n de la aplicaci&oacute;n Web</h2>
<div class="section">
<p>Vamos ahora a crear la aplicaci&oacute;n web que se conecta al bean de forma local. Para ello deberemos:</p>
<ul>

<li>Crear el proyecto Web</li>

<li>Modificar el proyecto EJB para a&ntilde;adir las interfaces locales al bean</li>

</ul>
<p>Vamos a ello.</p>
<p>1. Crea un nuevo proyecto Web ("New &gt; Projet... &gt; Web &gt; Dynamic Web Project") con el nombre de <span class="codefrag">ejb-saludoWar</span>. Pulsa "Next" y deja marcadas s&oacute;lo las opciones "Dynamic Web Module" y "Java" (ver figura). Pulsa "Finish" para finalizar.</p>
<p>

<img alt="" content-width="8cm" src="imagenes/ejercicios03/img11.png">
</p>
<p>2. Crea el paquete <span class="codefrag">es.ua.jtech.ejb.delegates</span> en el que copiar&aacute;s el JavaBean que acceder&aacute; al EJB. Para ello crea la clase <span class="codefrag">SaludoBean</span> en el paquete y copia el contenido de la clase <span class="codefrag">SaludoBean</span> del proyecto Eclipse.</p>
<p>3. Arregla los errores de librer&iacute;as a&ntilde;adiendo el proyecto EJB en el build path ("Build Path &gt; Configure Build Path" y en la pesta&ntilde;a "Projects" pulsar "Add... ejb-saludo").</p>
<p>4. Para a&ntilde;adir el car&aacute;cter local al EJB basta con a&ntilde;adir las siguientes anotaciones:</p>
<ul>

<li>En la definici&oacute;n de la clase <span class="codefrag">SaludoBean</span>, a&ntilde;ade el nombre local JNDI y los nombres de las clases locales:

<pre class="code">@JndiName(...
                  local="SaludoBeanLocal")
@FileGeneration(...
                localClass=TRUE
                localClassName="SaludoLocal"
                localHome=TRUE
                localHomeName="SaludoLocalHome")</pre>
</li>


<li>En los m&eacute;todos <span class="codefrag">saluda()</span> y <span class="codefrag">getSaludo()</span> a&ntilde;ade la anotaci&oacute;n <span class="codefrag">@LocalMethod()</span>.</li>

</ul>
<p>5. Graba el bean y ver&aacute;s c&oacute;mo desaparecen los errores en ejb-saludoWar (no hace falta crear de nuevo el ejbjar cliente porque se va acceder al bean de forma local y los ficheros class est&aacute;n disponibles en el servidor).</p>
<p>6. Copia el fichero <span class="codefrag">index.jsp</span> del proyecto Eclipse al directorio WebContent.</p>
</div>


<a name="N10173"></a><a name="%28*%29+Creaci%C3%B3n+y+despliegue+del+EAR"></a>
<h2 class="underlined_10">(*) Creaci&oacute;n y despliegue del EAR</h2>
<div class="section">
<p>Una vez creado el proyecto War vamos a guardar ambos en un proyecto EAR y a desplegarlos en el servidor de aplicaciones.</p>
<p>1. Creamos un proyecto EAR ("New &gt; Project &gt; J2EE &gt; Enterprise Application Project") con el nombre de <span class="codefrag">ejb-saludoWebEAR</span>. A&ntilde;adimos al proyecto los m&oacute;dulos EJB (<span class="codefrag">ejb-saludo</span>) y WAR (<span class="codefrag">ejb-saludoWar</span>):</p>
<p>

<img alt="" content-width="7cm" src="imagenes/ejercicios03/img12.png">
</p>
<p>2. Elimina el m&oacute;dulo EJB del servidor.</p>
<p>3. A&ntilde;ade el m&oacute;dulo EAR <span class="codefrag">ejb-saludoWebEAR</span> al servidor.</p>
<p>

<img alt="" content-width="13cm" src="imagenes/ejercicios03/img14.png">
</p>
<p>4. Comprueba que funciona la aplicaci&oacute;n Web conect&aacute;ndote a la URL <span class="codefrag">http://localhost:7001/ejb-saludoWar/</span>:</p>
<p>

<img alt="" content-width="8cm" src="imagenes/ejercicios03/img17.png">
</p>
<p>5. Por &uacute;ltimo, prueba el cliente remoto y el test JUnit para comprobar que la interfaz remota del EJB sigue funcionando.</p>
</div>


<p class="pageBreakAfter"></p>

</div>
<div class="clearboth">&nbsp;</div>
</div>
<div id="footer">
<div class="lastmodified">
<script type="text/javascript"><!--
document.write("<text>Last Published:</text> " + document.lastModified);
//  --></script>
</div>
<div class="copyright">
        Copyright &copy;
         2006-2007 Depto. CCIA</div>
</div>
</body>
</html>
