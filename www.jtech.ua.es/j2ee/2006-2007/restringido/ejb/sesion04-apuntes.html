<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<META http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta content="Apache Forrest" name="Generator">
<meta name="Forrest-version" content="0.7">
<meta name="Forrest-skin-name" content="pelt">
<title>Los Enterprise JavaBeans de sesi&oacute;n con estado</title>
<link type="text/css" href="skin/basic.css" rel="stylesheet">
<link media="screen" type="text/css" href="skin/screen.css" rel="stylesheet">
<link media="print" type="text/css" href="skin/print.css" rel="stylesheet">
<link type="text/css" href="skin/profile.css" rel="stylesheet">
<script src="skin/getBlank.js" language="javascript" type="text/javascript"></script><script src="skin/getMenu.js" language="javascript" type="text/javascript"></script><script src="skin/fontsize.js" language="javascript" type="text/javascript"></script>
<link rel="shortcut icon" href="">
</head>
<body onload="init()">
<script type="text/javascript">ndeSetTextSize();</script>
<div id="top">
<div class="header">
<div class="grouplogo">
<a href="http://www.jtech.ua.es/j2ee"><img class="logoImage" alt="J2EE" src="images/baner_j2ee_izq.gif" title="Curso Especialista Universitario J2EE"></a>
</div>
<div class="projectlogoA1">
<a href="http://www.dccia.ua.es/"><img class="logoImage" alt="Componentes EJB" src="images/baner_j2ee_der.gif" title="Componentes EJB"></a>
</div>
<ul id="tabs">
<li>
<a class="base-not-selected" href="../index.html">M&oacute;dulos</a>
</li>
<li class="current">
<a class="base-selected" href="index.html">Componentes EJB</a>
</li>
</ul>
</div>
</div>
<div id="main">
<div id="publishedStrip">
<div id="level2tabs"></div>
<script type="text/javascript"><!--
document.write("<text>Last Published:</text> " + document.lastModified);
//  --></script>
</div>
<div class="breadtrail">
             
             &nbsp;
           </div>
<div id="menu">
<div onclick="SwitchMenu('menu_selected_1.1', 'skin/')" id="menu_selected_1.1Title" class="menutitle" style="background-image: url('skin/images/chapter_open.gif');">Materiales</div>
<div id="menu_selected_1.1" class="selectedmenuitemgroup" style="display: block;">
<div class="menuitem">
<a href="index.html" title="Componentes EJB">&Iacute;ndice</a>
</div>
<div onclick="SwitchMenu('menu_selected_1.1.2', 'skin/')" id="menu_selected_1.1.2Title" class="menutitle" style="background-image: url('skin/images/chapter_open.gif');">Teor&iacute;a</div>
<div id="menu_selected_1.1.2" class="selectedmenuitemgroup" style="display: block;">
<div class="menuitem">
<a href="sesion01-apuntes.html" title="Introducci&oacute;n a los Enterprise Beans">Sesi&oacute;n 1</a>
</div>
<div class="menuitem">
<a href="sesion02-apuntes.html" title="Beans de sesi&oacute;n">Sesi&oacute;n 2</a>
</div>
<div class="menuitem">
<a href="sesion03-apuntes.html" title="Beans de sesi&oacute;n">Sesi&oacute;n 3</a>
</div>
<div class="menupage">
<div class="menupagetitle">Sesi&oacute;n 4</div>
</div>
<div class="menuitem">
<a href="sesion05-apuntes.html" title="Seguridad">Sesi&oacute;n 5</a>
</div>
<div class="menuitem">
<a href="sesion06-apuntes.html" title="Transacciones">Sesi&oacute;n 6</a>
</div>
<div class="menuitem">
<a href="sesion07-apuntes.html" title="EJB 3.0">Sesi&oacute;n 7</a>
</div>
<div class="menuitem">
<a href="sesion08-apuntes.html" title="JPA">Sesi&oacute;n 8</a>
</div>
<div class="menuitem">
<a href="roadmap.html" title="Roadmap EJB">Roadmap</a>
</div>
</div>
<div onclick="SwitchMenu('menu_1.1.3', 'skin/')" id="menu_1.1.3Title" class="menutitle">Ejercicios</div>
<div id="menu_1.1.3" class="menuitemgroup">
<div class="menuitem">
<a href="sesion01-ejercicios.html" title="Introducci&oacute;n a los Enterprise Beans">Sesi&oacute;n 1</a>
</div>
<div class="menuitem">
<a href="sesion02-ejercicios.html" title="Beans de sesi&oacute;n">Sesi&oacute;n 2</a>
</div>
<div class="menuitem">
<a href="sesion03-ejercicios.html" title="Beans de sesi&oacute;n">Sesi&oacute;n 3</a>
</div>
<div class="menuitem">
<a href="sesion04-ejercicios.html" title="Beans de sesi&oacute;n con estado">Sesi&oacute;n 4</a>
</div>
<div class="menuitem">
<a href="sesion05-ejercicios.html" title="Seguridad">Sesi&oacute;n 5</a>
</div>
<div class="menuitem">
<a href="sesion06-ejercicios.html" title="Transacciones">Sesi&oacute;n 6</a>
</div>
<div class="menuitem">
<a href="sesion07-ejercicios.html" title="EJB 3.0">Sesi&oacute;n 7</a>
</div>
<div class="menuitem">
<a href="sesion08-ejercicios.html" title="JPA">Sesi&oacute;n 8</a>
</div>
</div>
</div>
<div id="credit"></div>
<div id="roundbottom">
<img style="display: none" class="corner" height="15" width="15" alt="" src="skin/images/rc-b-l-15-1body-2menu-3menu.png"></div>
<div id="credit2"></div>
</div>
<div id="content">
<div title="Portable Document Format" class="pdflink">
<a class="dida" href="sesion04-apuntes.pdf"><img alt="PDF -icon" src="skin/images/pdfdoc.gif" class="skin"><br>
        PDF</a>
</div>
<h1>Los Enterprise JavaBeans de sesi&oacute;n con estado</h1>
<div id="minitoc-area">
<ul class="minitoc">
<li>
<a href="#Implementaci%C3%B3n+de+los+beans+de+sesi%C3%B3n+con+estado">Implementaci&oacute;n de los beans de sesi&oacute;n con estado</a>
<ul class="minitoc">
<li>
<a href="#La+clase+bean+de+sesi%C3%B3n">La clase bean de sesi&oacute;n</a>
<ul class="minitoc">
<li>
<a href="#Las+variables+de+instancia">Las variables de instancia</a>
</li>
<li>
<a href="#La+interfaz+SessionBean">La interfaz SessionBean</a>
</li>
<li>
<a href="#Los+m%C3%A9todos+ejbCreate">Los m&eacute;todos ejbCreate</a>
</li>
<li>
<a href="#M%C3%A9todos+de+negocio">M&eacute;todos de negocio</a>
</li>
</ul>
</li>
<li>
<a href="#La+interfaz+home">La interfaz home</a>
</li>
<li>
<a href="#Interfaz+componente">Interfaz componente</a>
</li>
<li>
<a href="#Los+ficheros+descriptores+de+despliegue">Los ficheros descriptores de despliegue</a>
</li>
<li>
<a href="#Clases+de+apoyo">Clases de apoyo</a>
</li>
</ul>
</li>
</ul>
</div>


<a name="N1000C"></a><a name="Implementaci%C3%B3n+de+los+beans+de+sesi%C3%B3n+con+estado"></a>
<h2 class="underlined_10">Implementaci&oacute;n de los beans de sesi&oacute;n con estado</h2>
<div class="section">
<p>Vamos a construir ahora un ejemplo completo de bean de sesi&oacute;n con estado. En concreto, vamos a implementar el bean, <span class="codefrag">CartBean</span>, que define un carrito de la compra de una librer&iacute;a on-line. El cliente del bean podr&aacute; a&ntilde;adir un libro al carrito, eliminar un libro o consultar el contenido del carrito.  Tal y como hemos visto en las sesiones anteriores, para construir el enterprise bean <span class="codefrag">CartBean</span>, se necesitan los siguientes ficheros:</p>
<ul>

<li>Clase de implementaci&oacute;n bean (<span class="codefrag">CartBean</span>)</li>

<li>Interface home (<span class="codefrag">CartHome</span>)</li>

<li>Interface componente (<span class="codefrag">Cart</span>)</li>

</ul>
<p>El estado del bean va a estar definido por sus variables de instancias. Estas variables de instancia deben declararse en la clase <span class="codefrag">CartBean</span> que implementa la l&oacute;gica de negocio, y ser&aacute;n actualizadas por los m&eacute;todos del bean, como consencuencia de la invocaci&oacute;n del cliente.</p>
<p>Adem&aacute;s de estas clases, vamos a usar las clases adicionales <span class="codefrag">BookException</span> con la que definimos excepciones relacionadas con la aplicaci&oacute;n y <span class="codefrag">BookVO</span> que implementa un <em>value object</em> y sirve para pasar la informaci&oacute;n entre las distintas capas de la aplicaci&oacute;n.</p>
<p>Tal y como vimos en las sesiones anteriores, los m&eacute;todos de las tres clases que definen el bean est&aacute;n relacionados. La siguiente tabla muestra un resumen con los m&eacute;todos que debemos relacionar en estas clases. Recordemos que cada clase define los siguientes m&eacute;todos:</p>
<ul>

<li>Interfaz componente: definici&oacute;n (sin implementar) de m&eacute;todos de negocio,</li>

<li>Interfaz home: definici&oacute;n (sin implementar) de los m&eacute;todos de creaci&oacute;n, busqueda y borrado de beans</li>

<li>Clase bean: definici&oacute;n de la implementaci&oacute;n de los m&eacute;todos de negocio y de creaci&oacute;n, b&uacute;squeda y borrado de beans.</li>

</ul>
<table class="ForrestTable" cellspacing="1" cellpadding="4">

<tr>

<th colspan="1" rowspan="1"></th>
<th colspan="1" rowspan="1">Interfaz home</th>
<th colspan="1" rowspan="1">Interfaz componente</th>
<th colspan="1" rowspan="1">Clase bean</th>

</tr>


<tr>

<td colspan="1" rowspan="1">Extiende o implementa la interfaz</td>
<td colspan="1" rowspan="1">Extiende <span class="codefrag">EJBHome</span> o <span class="codefrag">EJBLocalHome</span></td>
<td colspan="1" rowspan="1">Extiende <span class="codefrag">EJBObject</span> o <span class="codefrag">EJBLocalObject</span></td>
<td colspan="1" rowspan="1">Implementa <span class="codefrag">SessionBean</span></td>

</tr>


<tr>

<td colspan="1" rowspan="1">Creaci&oacute;n</td>
<td colspan="1" rowspan="1"><span class="codefrag">Cart create(args) throws CreateException, RemoteException;</span></td>
<td colspan="1" rowspan="1">No disponible</td>
<td colspan="1" rowspan="1"><span class="codefrag">public void ejbCreate(args)</span></td>

</tr>


<tr>

<td colspan="1" rowspan="1">Uso</td>
<td colspan="1" rowspan="1">No disponible</td>
<td colspan="1" rowspan="1">M&eacute;todos de negocio (deben arojar la excepci&oacute;n RemoteException)</td>
<td colspan="1" rowspan="1">M&eacute;todos de negocio con la misma signatura (no deben declarar RemoteException: 
<em>las instancias de la clase SessionBean no son objetos remotos, lo
son los "cortafuegos" EJBObject y EJBHome</em>)</td> 

</tr>


<tr>

<td colspan="1" rowspan="1">Borrado</td>
<td colspan="1" rowspan="1"><span class="codefrag">public void remove();</span></td>
<td colspan="1" rowspan="1"><span class="codefrag">public void remove()</span></td>
<td colspan="1" rowspan="1"><span class="codefrag">public void ejbRemove();</span></td>

</tr>

</table>
<p>Vamos a definir una implemetaci&oacute;n remota del bean. Para hacer una versi&oacute;n local bastar&iacute;a con sustituir las clases que <span class="codefrag">EJBObject</span> y <span class="codefrag">EJBHome</span> por <span class="codefrag">EJBLocalObject</span> y <span class="codefrag">EJBLocalHome</span>.</p>
<p>El c&oacute;digo fuente de este ejemplo est&aacute; en el fichero <span class="codefrag">sesion03-ejercicios.zip</span>en la p&aacute;gina web del m&oacute;dulo de EJB.</p>
<a name="N100EF"></a><a name="La+clase+bean+de+sesi%C3%B3n"></a>
<h3 class="underlined_5">La clase bean de sesi&oacute;n</h3>
<p>Siguiendo las indicaciones de nomenclatura que comentamos en la sesi&oacute;n pasada, la clase bean se llama <span class="codefrag">CartBean</span>. Esta clase implementa la l&oacute;gica de negocio del bean, y debe cumplir los siguientes requisitos:</p>
<ul>

<li>Implementa la interfaz <span class="codefrag">SessionBean</span>.</li>

<li>La clase se define como <span class="codefrag">public</span>.</li>

<li>La clase no puede definirse como <span class="codefrag">abstract</span> ni <span class="codefrag">final</span>.</li>

<li>Implementa uno o m&aacute;s m&eacute;todos <span class="codefrag">ejbCreate</span>.</li>

<li>Implementa los m&eacute;todos remotos definidos en la interfaz componente del bean.</li>

<li>Contiene un constructor <span class="codefrag">public</span> sin par&aacute;metros.</li>

</ul>
<p>El c&oacute;digo fuente de la clase <span class="codefrag">SessionBean</span> sigue a continuaci&oacute;n:</p>
<pre class="code">package sesion3.beans;

import java.util.*;
import javax.ejb.*;

import sesion3.datos.BookVO;

public class CartBean implements SessionBean {

	private static final long serialVersionUID = 1L;
	String customerName;
	String customerId;
	Collection&lt;BookVO&gt; contents;

	double precio;

	public void ejbCreate(String person) throws CreateException {
		if (person == null) {
			throw new CreateException("Null person not allowed.");
		} else {
			customerName = person;
		}
		customerId = "0";
		contents = new ArrayList&lt;BookVO&gt;();
		System.out.println("CartBean creado");
	}

	public void ejbCreate(String person, String id) throws CreateException {
		if (person == null) {
			throw new CreateException("Null person not allowed.");
		} else {
			customerName = person;
		}
		contents = new ArrayList&lt;BookVO&gt;();
		System.out.println("CartBean creado");
	}

	public void addBook(BookVO book) throws BookException {
		contents.add(book);
		System.out.println("A&ntilde;adido libro: " + book.getTitle());
	}

	public void removeBook(BookVO book) throws BookException {
		boolean result = false;
		String title = book.getTitle();
		Iterator it = contents.iterator();
		while (it.hasNext()) {
			BookVO bookIt = (BookVO) it.next();
			if (title.equals(bookIt.getTitle())) {
				it.remove();
				result = true;
				System.out.println("Borrado libro: " + book.getTitle());
				break;
			}
		}
		if (result == false) {
			throw new BookException(title + " not in cart.");
		}
	}

	public ArrayList&lt;BookVO&gt; getAllBooks() {
		return (ArrayList&lt;BookVO&gt;) contents;
	}

	public double getOrderPrice() {
		double price = 0.0;
		Iterator it = contents.iterator();
		while (it.hasNext()) {
			BookVO book = (BookVO) it.next();
			price = price + book.getPrice();
		}
		return price;
	}

	public CartBean() {
	}

	public void ejbRemove() {
		System.out.println("Objeto CartBean borrado");
	}

	public void ejbActivate() {
	}

	public void ejbPassivate() {
	}

	public void setSessionContext(SessionContext sc) {
	}
}</pre>
<a name="N1012C"></a><a name="Las+variables+de+instancia"></a>
<h4>Las variables de instancia</h4>
<p>Las variables de instancia definen el estado de una instancia de enterprise bean. En este caso son</p>
<ul>

<li>
<span class="codefrag">String customerName</span>
</li>

<li>
<span class="codefrag">String customerId</span>
</li>

<li>
<span class="codefrag">Collection&lt;BookVO&gt; contents</span>
</li>

</ul>
<p>Las variables de instancia se inicializan al crearse una instancia del bean, copi&aacute;ndose en ellas los argumentos del m&eacute;todo <span class="codefrag">ejbCreate</span>. Despu&eacute;s son modificadas por las llamadas de los clientes a los m&eacute;todos de negocio <span class="codefrag">addBook()</span> y <span class="codefrag">removeBook()</span>.</p>
<a name="N10151"></a><a name="La+interfaz+SessionBean"></a>
<h4>La interfaz SessionBean</h4>
<p>La interfaz <span class="codefrag">SessionBean</span> extiende la interfaz <span class="codefrag">EnterpriseBean</span>, que a su vez extiende el interfaz <span class="codefrag">Serializable</span>. La interfaz <span class="codefrag">SessionBean</span> declara los m&eacute;todos <span class="codefrag">ejbRemove</span>, <span class="codefrag">ejbActivate</span>, <span class="codefrag">ejbPassivate</span>, y <span class="codefrag">setSessionContext</span>. Estos m&eacute;todos se llaman desde el contenedor EJB cuando el bean va pasando de un estado a otro en su ciclo de vida. La clase <span class="codefrag">CartBean</span> no usa estos m&eacute;todos, pero debe implementarlos porque est&aacute;n declarados en la interfaz <span class="codefrag">SessionBean</span>.</p>
<a name="N10179"></a><a name="Los+m%C3%A9todos+ejbCreate"></a>
<h4>Los m&eacute;todos ejbCreate</h4>
<p>Como vimos en la sesi&oacute;n pasada un cliente no puede instanciar directamente un bean, ya que &eacute;ste reside en el contenedor EJB. La forma de solicitar que se ejecuten m&eacute;todos en del bean es a trav&eacute;s de los objetos remotos <span class="codefrag">EJBObject</span> y <span class="codefrag">EJBHome</span>. En concreto, la petici&oacute;n de creaci&oacute;n del bean se realiza mediante una llamada al objeto <span class="codefrag">EJBHome</span>, que a su vez la solicita al contenedor EJB.  En el ejemplo del carrito de la compra esto sucede de la siguiente forma:</p>
<p>1. El cliente invoca un m&eacute;todo <span class="codefrag">create</span> en el objeto <span class="codefrag">EJBHome</span>:</p>
<pre class="code">
Cart shoppingCart = home.create("Domingo Gallardo","123");
</pre>
<p>2. El EJBHome solicita al contenedor EJB la creaci&oacute;n de una instancia del enterprise bean. El contenedor EJB selecciona alguno de los beans sin usar de la reserva de beans.</p>
<p>3. El contenedor EJB invoca el m&eacute;todo <span class="codefrag">ejbCreate</span> apropiado (puede haber m&aacute;s de un m&eacute;todo ejbCreate, seg&uacute;n los argumentos) en <span class="codefrag">CartBean</span>:</p>
<p>Al tratarse de un bean de sesi&oacute;n con estado, el m&eacute;todo <span class="codefrag">ejbCreate</span> inicializa este estado.</p>
<p>Un enterprise bean debe tener uno o m&aacute;s m&eacute;todos <span class="codefrag">ejbCreate</span>. Las signaturas de estos m&eacute;todos deben cumplir los siguientes requisitos:</p>
<ul>

<li>El modificador de control de acceso debe ser <span class="codefrag">public</span>.</li>

<li>El tipo de retorno debe ser <span class="codefrag">void</span>.</li>

<li>Si el bean permite un acceso remoto, los argumentos deben ser tipos legales de RMI.</li>

<li>El modificador no puede ser <span class="codefrag">static</span> ni final.</li>

</ul>
<p>La cl&aacute;sula throws puede incluir la excepci&oacute;n <span class="codefrag">javax.ejb.CreateException</span> y cualquier otra excepci&oacute;n espec&iacute;fica de la aplicaci&oacute;n. El m&eacute;todo <span class="codefrag">ejbCreate</span> arroja normalmente una excepci&oacute;n <span class="codefrag">CreateException</span> si un par&aacute;metro de entrada no es v&aacute;lido.</p>
<p>Es posible definir m&aacute;s de un m&eacute;todo ejbCreate en la clase bean si quieres tener m&aacute;s de una forma de crear el bean, cada una con distintos tipos de argumentos. Eso s&iacute;, tambi&eacute;n habr&iacute;a que definir los mismos m&eacute;todos en la interfaz home.</p>
<a name="N101D8"></a><a name="M%C3%A9todos+de+negocio"></a>
<h4>M&eacute;todos de negocio</h4>
<p>El prop&oacute;sito fundamental de un bean de sesi&oacute;n es ejecutar tareas de negocio a petici&oacute;n de aplicaciones cliente. El cliente invoca m&eacute;todos de negocio en la referencia remota del objeto que es devuelta por el m&eacute;todo <span class="codefrag">create</span>. Recuerda que esta referencia es una instancia de un stub que implementa la interfaz componente.</p>
<p>Desde la perspectiva del cliente, los m&eacute;todos de negocio parecen ejecutarse de forma local, pero realmente lo que se ejecuta en el cliente es un m&eacute;todo del stub de que env&iacute;a la petici&oacute;n al EJBObject que reside en el contenedor EJB.</p>
<p>Los par&aacute;metros de los m&eacute;todos de negocio son normalmente <em>value objetcs</em>, objetos Java puros (no son objetos remotos) que contienen la informaci&oacute;n necesaria para realizar la funci&oacute;n. En nuestro caso se trata de objetos de la clase <span class="codefrag">BookVO</span> que contienen el t&iacute;tulo y el precio de un libro.</p>
<p>Un ejemplo del punto de vista del cliente:</p>
<pre class="code">Cart shoppingCart = home.create("Domingo Gallardo", "123");
BookVO book = new BookVO("Yo robot", 22.30);
shoppingCart.addBook(book); 
...

// Imprimo los libros guardados hasta el momento
Collection&lt;BookVO&gt; lista = shoppingCart.getAllBooks();
Iterator it = bookList.iterator();
while (it.hasNext()) {
   BookVO book = (BookVO) it.next();
   System.out.print(book.getTitle());
   System.out.println(" "+book.getPrice());
}</pre>
<p>La signatura de un m&eacute;todo de negocio debe cumplir los siguientes requisitos:</p>
<ul>

<li>El nombre del m&eacute;todo no debe entrar en conflicto con ning&uacute;n otro definido por la arquitectura EJB. Por ejemplo, un m&eacute;todo de negocio no se puede llamar <span class="codefrag">ejbCreate</span> o <span class="codefrag">ejbActivate</span>.</li>

<li>El modificador de control de acceso debe ser <span class="codefrag">public</span>.</li>

<li>Si el bean permite acceso remoto, los argumentos y los tipos devueltos deben ser tipos legales de RMI.</li>

<li>El modificador no puede ser <span class="codefrag">static</span> ni <span class="codefrag">final</span>.</li>

</ul>
<p>La cl&aacute;usula <span class="codefrag">throws</span> puede incluir excepciones que se definen en la aplicaci&oacute;n. Por ejemplo, el m&eacute;todo <span class="codefrag">removeBook</span> arroja la excepci&oacute;n <span class="codefrag">BookException</span> si el libro no est&aacute; en el carrito.</p>
<p>Para indicar un problema de nivel de sistema, como la imposibilidad de conectar con una base de datos, un m&eacute;todo de negocio deber&iacute;a arrojar una excepci&oacute;n <span class="codefrag">javax.ejb.EJBException</span>. Cuando un m&eacute;todo de negocio arroja una excepci&oacute;n <span class="codefrag">EJBException</span>, el contenedor EJB la envuelve en una <span class="codefrag">RemoteException</span>, que es capturada por el cliente. El contenedor no envuelve excepciones de aplicaci&oacute;n como <span class="codefrag">BookException</span>. Debido a que <span class="codefrag">EJBException</span> es una subclase de <span class="codefrag">RuntimeException</span>, no es necesario incluirla en la cl&aacute;usula <span class="codefrag">throws</span> del m&eacute;todo de negocio.</p>
<a name="N1023E"></a><a name="La+interfaz+home"></a>
<h3 class="underlined_5">La interfaz home</h3>
<p>La interfaz home extiende la interfaz <span class="codefrag">javax.ejb.EJBHome</span>. Para un bean de sesion, el prop&oacute;sito de la interfaz home es definir los m&eacute;todos <span class="codefrag">create()</span> (puede haber m&aacute;s de uno, dependiendo de los argumentos) que el cliente remoto puede invocar para crear instancias del bean. El cliente <span class="codefrag">CartCliente</span>, por ejemplo, invoca este m&eacute;todo <span class="codefrag">create</span>
</p>
<pre class="code">
Cart shoppingCart = home.create("Domingo Gallardo", "123");
</pre>
<p>Por cada m&eacute;todo create en la interfaz home debe existir un m&eacute;todo <span class="codefrag">ejbCreate</span> correspondiente en la clase de implementaci&oacute;n del bean (clase <span class="codefrag">CartBean</span>). En nuestro ejemplo, defin&iacute;amos dos signaturas de m&eacute;todos <span class="codefrag">ejbCreate</span>:</p>
<pre class="code">
public void ejbCreate(String person) throws CreateException   
... 
public void ejbCreate(String person, String id)  throws CreateException 
</pre>
<p>Y el c&oacute;digo correspondiente en el fichero <span class="codefrag">CartHome.java</span> es el siguiente:</p>
<pre class="code">package sesion3.beans;

import java.rmi.RemoteException;
import javax.ejb.CreateException;
import javax.ejb.EJBHome;

public interface CartHome extends EJBHome {
 
    public Cart create(String person) throws RemoteException, CreateException;
    public Cart create(String person, String id) throws RemoteException, 
                                                 CreateException; 
}
</pre>
<p>Las signaturas de ambos conjuntos de m&eacute;todos son similares, pero difieren en aspectos importantes. Un resumen de las reglas que debemos aplicar al crear ambas signaturas es el siguiente:</p>
<ul>

<li>El n&uacute;mero y tipos de argumentos en el m&eacute;todo create debe corresponderse con los definidos en el m&eacute;todo <span class="codefrag">ejbCreate</span> asociado.</li>

<li>Los tipos de los argumentos y valores devueltos deben ser tipos v&aacute;lidos RMI.</li>

<li>Cuando usemos llamadas remotas, los m&eacute;todos <span class="codefrag">create</span> de la interfaz home siempre debe devolver el tipo de la interfaz componente del bean. Cuando un cliente invoque este m&eacute;todo se le devolver&aacute; una referencia remota del <span class="codefrag">EJBObject</span> del bean reci&eacute;n creado. El m&eacute;todo <span class="codefrag">ejbCreate</span> de la clase bean, sin embargo, debe devolver <span class="codefrag">void</span>. Es el contenedor EJB el que se encarga de crear el bean, llamar al m&eacute;todo <span class="codefrag">ejbCreate</span> y devolver la referencia remota.</li>

<li>La cl&aacute;usula <span class="codefrag">throws</span> del m&eacute;todo <span class="codefrag">create</span> debe incluir las excepciones <span class="codefrag">java.rmi.RemoteException</span> y <span class="codefrag">java.ejb.CreateException</span>.</li>

</ul>
<a name="N102A1"></a><a name="Interfaz+componente"></a>
<h3 class="underlined_5">Interfaz componente</h3>
<p>La interfaz componente siempre debe extender la interfaz <span class="codefrag">javax.ejb.EJBObject</span>. Esta interfaz define los m&eacute;todos de negocio que el cliente remoto puede invocar. A continuaci&oacute;n se muestra el c&oacute;digo fuente del fichero <span class="codefrag">Cart.java</span>:</p>
<pre class="code">package sesion3.beans;

import java.util.*;
import javax.ejb.EJBObject;
import sesion3.datos.BookVO;

import java.rmi.RemoteException;

public interface Cart extends EJBObject {
 
   public void addBook(BookVO book) throws BookException, RemoteException;
   public void removeBook(BookVO book) throws BookException, RemoteException;
   public ArrayList&lt;BookVO&gt; getAllBooks() throws RemoteException;
   public double getOrderPrice() throws RemoteException;
}
</pre>
<p>La definici&oacute;n de los m&eacute;todos en la interfaz componente debe seguir estas reglas:</p>
<ul>

<li>Cada m&eacute;todo en la interfaz componente debe corresponderse con un m&eacute;todo equivalente en la clase del enterprise bean. Las signaturas de ambos deben ser iguales.</li>

<li>Los tipos de los argumentos y valores devueltos deben ser tipos v&aacute;lidos RMI.</li>

<li>La cl&aacute;usula <span class="codefrag">throws</span> debe incluir la excepci&oacute;n <span class="codefrag">java.rmi.RemoteException</span>.</li>

</ul>
<a name="N102CA"></a><a name="Los+ficheros+descriptores+de+despliegue"></a>
<h3 class="underlined_5">Los ficheros descriptores de despliegue</h3>
<p>El fichero <span class="codefrag">ejb-jar.xml</span> se muestra a continuaci&oacute;n</p>
<pre class="code">&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;ejb-jar version="2.1" xmlns="http://java.sun.com/xml/ns/j2ee" 
                       xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" 
                       xsi:schemaLocation="http://java.sun.com/xml/ns/j2ee 
                                           http://java.sun.com/xml/ns/j2ee/ejb-jar_2_1.xsd"&gt;
    &lt;enterprise-beans&gt;
        &lt;session&gt;
            &lt;ejb-name&gt;CartBean&lt;/ejb-name&gt;
            &lt;home&gt;sesion3.beans.CartHome&lt;/home&gt;
            &lt;remote&gt;sesion3.beans.Cart&lt;/remote&gt;
            &lt;ejb-class&gt;sesion3.beans.CartBean&lt;/ejb-class&gt;
            &lt;session-type&gt;Stateful&lt;/session-type&gt;
            &lt;transaction-type&gt;Container&lt;/transaction-type&gt;
        &lt;/session&gt;
    &lt;/enterprise-beans&gt;    
&lt;/ejb-jar&gt;
</pre>
<p>Y el fichero <span class="codefrag">weblogic-ejb-jar.xml</span> es el siguiente. Los &uacute;nicos datos que se definen son el nombre del EJB y el nombre JNDI del bean.</p>
<pre class="code">&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;weblogic-ejb-jar xmlns="http://www.bea.com/ns/weblogic/90"
    xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
    xsi:schemaLocation="http://www.bea.com/ns/weblogic/90 
http://www.bea.com/ns/weblogic/90/weblogic-ejb-jar.xsd"&gt;
    &lt;weblogic-enterprise-bean&gt;
        &lt;ejb-name&gt;CartBean&lt;/ejb-name&gt;
        &lt;jndi-name&gt;CartBean&lt;/jndi-name&gt;
    &lt;/weblogic-enterprise-bean&gt;
&lt;/weblogic-ejb-jar&gt;</pre>
<a name="N102E5"></a><a name="Clases+de+apoyo"></a>
<h3 class="underlined_5">Clases de apoyo</h3>
<p>El bean de sesi&oacute;n <span class="codefrag">CartBean</span> tiene la clase de apoyo <span class="codefrag">BookException</span>. La excepci&oacute;n <span class="codefrag">BookException</span> es arrojada por el m&eacute;todo <span class="codefrag">removeBook</span> cuando se intenta borrar del carrito un libro que no existe. Esta clase debe residir en el mismo directorio y fichero JAR en el que se reside el enterprise bean.</p>
<p>A continuaci&oacute;n se muestran el c&oacute;digo de la clase:</p>
<pre class="code">
public class BookException extends Exception {

    public BookException() {
    }

    public BookException(String msg) {
        super(msg);
    }
}
</pre>
<p>La otra clase de apoyo es la que define el <span class="codefrag">BookVO</span>:</p>
<pre class="code">package sesion3.datos;

import java.io.Serializable;

public class BookVO implements Serializable{

    private static final long serialVersionUID = 1L;

    String title;
    double price;

    public BookVO(String title, double price) {
        this.title = title;
        this.price = price;      
    }
   
    public boolean equals(BookVO another) {
        return (title.equals(another.title));
    }
   
    public void setTitle(String title) {
        this.title = title;
    }
   
    public void setPrice(double price) {
        this.price = price;
    }
   
    public String getTitle(){
        return this.title;
    }
   
    public double getPrice() {
        return this.price;
    }
}</pre>
</div>


<p class="pageBreakAfter"></p>

</div>
<div class="clearboth">&nbsp;</div>
</div>
<div id="footer">
<div class="lastmodified">
<script type="text/javascript"><!--
document.write("<text>Last Published:</text> " + document.lastModified);
//  --></script>
</div>
<div class="copyright">
        Copyright &copy;
         2006-2007 Depto. CCIA</div>
</div>
</body>
</html>
