<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<META http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta content="Apache Forrest" name="Generator">
<meta name="Forrest-version" content="0.7">
<meta name="Forrest-skin-name" content="pelt">
<title>Introducci&oacute;n a Enterprise Java Beans 3.0</title>
<link type="text/css" href="skin/basic.css" rel="stylesheet">
<link media="screen" type="text/css" href="skin/screen.css" rel="stylesheet">
<link media="print" type="text/css" href="skin/print.css" rel="stylesheet">
<link type="text/css" href="skin/profile.css" rel="stylesheet">
<script src="skin/getBlank.js" language="javascript" type="text/javascript"></script><script src="skin/getMenu.js" language="javascript" type="text/javascript"></script><script src="skin/fontsize.js" language="javascript" type="text/javascript"></script>
<link rel="shortcut icon" href="">
</head>
<body onload="init()">
<script type="text/javascript">ndeSetTextSize();</script>
<div id="top">
<div class="header">
<div class="grouplogo">
<a href="http://www.jtech.ua.es/j2ee"><img class="logoImage" alt="J2EE" src="images/baner_j2ee_izq.gif" title="Curso Especialista Universitario J2EE"></a>
</div>
<div class="projectlogoA1">
<a href="http://www.dccia.ua.es/"><img class="logoImage" alt="Componentes EJB" src="images/baner_j2ee_der.gif" title="Componentes EJB"></a>
</div>
<ul id="tabs">
<li>
<a class="base-not-selected" href="../index.html">M&oacute;dulos</a>
</li>
<li class="current">
<a class="base-selected" href="index.html">Componentes EJB</a>
</li>
</ul>
</div>
</div>
<div id="main">
<div id="publishedStrip">
<div id="level2tabs"></div>
<script type="text/javascript"><!--
document.write("<text>Last Published:</text> " + document.lastModified);
//  --></script>
</div>
<div class="breadtrail">
             
             &nbsp;
           </div>
<div id="menu">
<div onclick="SwitchMenu('menu_selected_1.1', 'skin/')" id="menu_selected_1.1Title" class="menutitle" style="background-image: url('skin/images/chapter_open.gif');">Materiales</div>
<div id="menu_selected_1.1" class="selectedmenuitemgroup" style="display: block;">
<div class="menuitem">
<a href="index.html" title="Componentes EJB">&Iacute;ndice</a>
</div>
<div onclick="SwitchMenu('menu_selected_1.1.2', 'skin/')" id="menu_selected_1.1.2Title" class="menutitle" style="background-image: url('skin/images/chapter_open.gif');">Teor&iacute;a</div>
<div id="menu_selected_1.1.2" class="selectedmenuitemgroup" style="display: block;">
<div class="menuitem">
<a href="sesion01-apuntes.html" title="Introducci&oacute;n a los Enterprise Beans">Sesi&oacute;n 1</a>
</div>
<div class="menuitem">
<a href="sesion02-apuntes.html" title="Beans de sesi&oacute;n">Sesi&oacute;n 2</a>
</div>
<div class="menuitem">
<a href="sesion03-apuntes.html" title="Beans de sesi&oacute;n">Sesi&oacute;n 3</a>
</div>
<div class="menuitem">
<a href="sesion04-apuntes.html" title="Beans de sesi&oacute;n">Sesi&oacute;n 4</a>
</div>
<div class="menuitem">
<a href="sesion05-apuntes.html" title="Seguridad">Sesi&oacute;n 5</a>
</div>
<div class="menuitem">
<a href="sesion06-apuntes.html" title="Transacciones">Sesi&oacute;n 6</a>
</div>
<div class="menupage">
<div class="menupagetitle">Sesi&oacute;n 7</div>
</div>
<div class="menuitem">
<a href="sesion08-apuntes.html" title="JPA">Sesi&oacute;n 8</a>
</div>
<div class="menuitem">
<a href="roadmap.html" title="Roadmap EJB">Roadmap</a>
</div>
</div>
<div onclick="SwitchMenu('menu_1.1.3', 'skin/')" id="menu_1.1.3Title" class="menutitle">Ejercicios</div>
<div id="menu_1.1.3" class="menuitemgroup">
<div class="menuitem">
<a href="sesion01-ejercicios.html" title="Introducci&oacute;n a los Enterprise Beans">Sesi&oacute;n 1</a>
</div>
<div class="menuitem">
<a href="sesion02-ejercicios.html" title="Beans de sesi&oacute;n">Sesi&oacute;n 2</a>
</div>
<div class="menuitem">
<a href="sesion03-ejercicios.html" title="Beans de sesi&oacute;n">Sesi&oacute;n 3</a>
</div>
<div class="menuitem">
<a href="sesion04-ejercicios.html" title="Beans de sesi&oacute;n con estado">Sesi&oacute;n 4</a>
</div>
<div class="menuitem">
<a href="sesion05-ejercicios.html" title="Seguridad">Sesi&oacute;n 5</a>
</div>
<div class="menuitem">
<a href="sesion06-ejercicios.html" title="Transacciones">Sesi&oacute;n 6</a>
</div>
<div class="menuitem">
<a href="sesion07-ejercicios.html" title="EJB 3.0">Sesi&oacute;n 7</a>
</div>
<div class="menuitem">
<a href="sesion08-ejercicios.html" title="JPA">Sesi&oacute;n 8</a>
</div>
</div>
</div>
<div id="credit"></div>
<div id="roundbottom">
<img style="display: none" class="corner" height="15" width="15" alt="" src="skin/images/rc-b-l-15-1body-2menu-3menu.png"></div>
<div id="credit2"></div>
</div>
<div id="content">
<div title="Portable Document Format" class="pdflink">
<a class="dida" href="sesion07-apuntes.pdf"><img alt="PDF -icon" src="skin/images/pdfdoc.gif" class="skin"><br>
        PDF</a>
</div>
<h1>Introducci&oacute;n a Enterprise Java Beans 3.0</h1>
<div id="minitoc-area">
<ul class="minitoc">
<li>
<a href="#Un+ejemplo+sencillo+de+EJB+3.0">Un ejemplo sencillo de EJB 3.0</a>
</li>
<li>
<a href="#Instalaci%C3%B3n+de+Netbeans+y+Sun+Application+Server">Instalaci&oacute;n de Netbeans y Sun Application Server</a>
</li>
<li>
<a href="#El+primer+proyecto+con+EJB+3.0">El primer proyecto con EJB 3.0</a>
</li>
<li>
<a href="#Aplicaci%C3%B3n+cliente">Aplicaci&oacute;n cliente</a>
</li>
<li>
<a href="#Java+Web+Start">Java Web Start</a>
</li>
<li>
<a href="#Cliente+web">Cliente web</a>
</li>
<li>
<a href="#Referencias">Referencias</a>
</li>
</ul>
</div>


<a name="N1000C"></a><a name="Un+ejemplo+sencillo+de+EJB+3.0"></a>
<h2 class="underlined_10">Un ejemplo sencillo de EJB 3.0</h2>
<div class="section">
<p>Veamos un ejemplo de declaraci&oacute;n y uso de un EJB 3.0, el t&iacute;pico "Hola, mundo". </p>
<p>La interfaz <span class="codefrag">SaludoRemote</span> define el m&eacute;todo <span class="codefrag">saluda</span> que devuelve un <span class="codefrag">String</span>. La anotaci&oacute;n <span class="codefrag">@Remote</span> la declara como una interfaz remota de un enterprise bean:</p>
<pre class="code">
<strong>@Remote</strong>
public interface SaludoRemote {
   public String saluda();
}</pre>
<p>La interfaz local se define con la anotaci&oacute;n <span class="codefrag">@Local</span>:</p>
<pre class="code">
<strong>@Local</strong>
public interface SaludoLocal {
   public String saluda();
}</pre>
<p>Un enterprise bean sin estado se define como una clase que implementa esas interfaces y que tiene la anotaci&oacute;n <span class="codefrag">@Stateless</span>:</p>
<pre class="code">
<strong>@Stateless</strong>
public class SaludoBean <strong>implements SaludoLocal, SaludoRemote</strong> {
 
    public SaludoBean() {
    }

    public String saluda() {
       return "Hola, mundo";
    }
}</pre>
<p>En EJB 3.0 no es necesario definir el objeto <span class="codefrag">Home</span>, sino que se obtiene directamente un objeto que implementa la interfaz que se desee (local o remota). Este objeto se puede obtener utilizando la "inyecci&oacute;n de dependencias" (<em>dependency injection</em>) proporcionada por la anotaci&oacute;n <span class="codefrag">@EJB</span>. Un ejemplo con un servlet:</p>
<pre class="code">
public class Saluda extends HttpServlet {
    <strong>@EJB
    private SaludoLocal saludo;</strong>

    protected void processRequest(HttpServletRequest request,
                                        HttpServletResponse response)
    throws ServletException, IOException {
        response.setContentType("text/html;charset=UTF-8");
        PrintWriter out = response.getWriter();
        
        out.println("&lt;html&gt;");
        out.println("&lt;head&gt;");
        out.println("&lt;title&gt;Servlet Saluda&lt;/title&gt;");
        out.println("&lt;/head&gt;");
        out.println("&lt;body&gt;");
        out.println("&lt;h1&gt;Saludo&lt;/h1&gt;");
        out.println("&lt;p&gt;");
        <strong>out.println(saludo.saluda());</strong>
        out.println("&lt;/p&gt;");
        out.println("&lt;/body&gt;");
        out.println("&lt;/html&gt;");
        out.close();
    }
    ...
}</pre>
<p>Entre las caracter&iacute;sticas introducidas por la especificaci&oacute;n 3.0 podemos destacar:</p>
<ul>

<li>Desaparece el objeto <span class="codefrag">Home</span> que hac&iacute;a de <em>factor&iacute;a</em> de los enterprise beans. Recordad que este objeto era el que usaban los clientes de los enterprise beans para crear el enterprise bean que implementa la interfaz de negocio. </li>


<li>Los enterprise beans se declaran objetos POJO que implementan interfaces remotas y locales. </li>


<li>Anotaciones: en el bean de sesion (<span class="codefrag">@Stateless</span>), en la interfaz remota (<span class="codefrag">@Remote</span>) y en la interfaz local (<span class="codefrag">@Local</span>)</li>

<li>Inyecci&oacute;n de recursos: anotaci&oacute;n <span class="codefrag">@EJB</span>
</li>


</ul>
<p>En esta sesi&oacute;n vamos a realizar una introducci&oacute;n a EJB 3.0 utilizando el entorno de programaci&oacute;n Netbeans y el servidor de aplicaciones Sun Application Server.</p>
</div>


<a name="N10082"></a><a name="Instalaci%C3%B3n+de+Netbeans+y+Sun+Application+Server"></a>
<h2 class="underlined_10">Instalaci&oacute;n de Netbeans y Sun Application Server</h2>
<div class="section">
<p>Vamos a utilizar la versi&oacute;n m&aacute;s reciente (a fecha actual, mayo de 2007) del entorno de desarrolo Netbeans y del servidor de aplicaciones Sun Application Server. Se encuentran disponibles en un &uacute;nico paquete (el Java EE Tools Bundle Update 3) en la p&aacute;gina de Sun de <a href="http://java.sun.com/javaee/downloads/index.jsp">Java EE Downloads</a>. Hay versiones para Windows, Linux y Mac OS X.</p>
<p>El nombre del ejecutable que realiza la instalaci&oacute;n es:</p>
<pre class="code">java-tools-bundle-u3-preview-windows.exe</pre>
<p>Entre los programas que se instalan en este paquete se encuentran:</p>
<ul>

<li>NetBeans IDE 5.5.1 Beta</li>

<li>NetBeans Enterprise Pack 5.5.1 Beta</li>

<li>Sun Java System Application Server 9.1 Beta</li>

</ul>
<p>Realiza la instalaci&oacute;n del paquete, dejando los valores por defecto que propone. El usuario administrador del servidor de aplicaciones y su contrase&ntilde;a es "admin" y "adminadmin".</p>
<p>El asistente instala NetBeans y el servidor de aplicaciones en los directorios (Windows):</p>
<pre class="code">C:\Archivos de Programa\netbeans-5.5.1beta
C:\Sun\SDK</pre>
<p>Una vez terminada la instalaci&oacute;n se arranca autom&aacute;tica el entorno de programaci&oacute;n NetBeans:</p>
<p>
<img alt="" content-width="13cm" src="imagenes/ejercicios07/img1.png"></p>
<p>Una diferencia importante entre NetBeans y Eclipse es que NetBeans no maneja el concepto de "Perspectiva" para agrupar distintas "Vistas". En NetBeans s&oacute;lo hay ventanas (equivalentes a la "vistas" de Eclipse) que el programador puede abrir, minimizar y modificar el tama&ntilde;o y posici&oacute;n. </p>
<p>1. Prueba a abrir, cerrar, minimizar y cambiar de posici&oacute;n distintas ventanas del entorno.</p>
<p>Si seleccionas la pesta&ntilde;a "Runtime" Puedes comprobar que ya se encuentran instaladas distintas herramientas, como por ejemplo:</p>
<ul>

<li>Servidor Web Tomcat 5.5.17</li>

<li>Servidor de aplicaciones Sun Application Server 9</li>

<li>Gestor de bases de datos Apache Derby</li>

</ul>
<p>
<img alt="" content-width="5cm" src="imagenes/ejercicios07/img2.png"></p>
<p>Puedes acceder a opciones generales relacionadas con las herramientas en el men&uacute; "Tools". Puedes realizar acciones con cada una de las herramientas pulsando con el bot&oacute;n derecho sobre ellas.</p>
<p>2. Lanza el servidor de aplicaciones, pulsando con el bot&oacute;n derecho y seleccionando la opci&oacute;n "Start". Ver&aacute;s que se abre el panel "Output" en la parte inferior de la ventana, con los mensajes del servidor de aplicaciones. En ese panel se colocar&aacute;n distintas pesta&ntilde;as con la salida de distintas consolas:</p>
<p>
<img alt="" content-width="9cm" src="imagenes/ejercicios07/img3.png"></p>
<p>En el caso de la consola del servidor de aplicaciones puedes ver en el borde izquierdo una columna de iconos que permiten arrancar, parar, reiniciar o refrescar el servidor.</p>
<p>3. Para terminar este vistazo r&aacute;pido por las herramientas instaladas, lanza la consola de administraci&oacute;n del servidor de aplicaciones. Pulsa con el bot&oacute;n derecho y escoge la opci&oacute;n "View Admin Console".</p>
<p>Se abrir&aacute; un navegador que se conectar&aacute; a la direcci&oacute;n "localhost:4848" (el puerto del servidor de aplicaciones). Introduce el usuario "admin" y la contrase&ntilde;a "adminadmin" para entrar en la consola de administraci&oacute;n:</p>
<p>
<img alt="" content-width="13cm" src="imagenes/ejercicios07/img4.png"></p>
<p>Ver&aacute;s que tiene opciones muy similares a las que ya conoces del BEA Weblogic. Se puede:</p>
<ul>

<li>Desplegar distintos tipos de aplicaciones</li>

<li>Configurar recursos como JDBC, JMS, JMI</li>

<li>Configurar aspectos del servidor relacionados con la seguridad, las transacciones, etc (en el apartado "Configuration")</li>

</ul>
</div>


<a name="N100FE"></a><a name="El+primer+proyecto+con+EJB+3.0"></a>
<h2 class="underlined_10">El primer proyecto con EJB 3.0</h2>
<div class="section">
<p>Vamos a implementar un primer proyecto con EJB 3.0, el mismo que implementamos en la sesi&oacute;n 2. Se trata de un enterprise bean <span class="codefrag">Saludo</span> con dos m&eacute;todos de negocio: <span class="codefrag">saluda()</span> que devuelve un saludo aleatorio y <span class="codefrag">getSaludo(int numDatos)</span> que devuelve un <span class="codefrag">SaludoTO</span> que contiene un array de enteros.</p>
<p>1. Selecciona en NetBeans el panel "Projects" y pulsa el bot&oacute;n derecho sobre &eacute;l. Pulsa la opci&oacute;n "New Project" y escoge un proyecto de tipo "Enterprise Application" (un EAR). Pulsa "Enterprise &gt; Enterprise Application &gt; Next". Activa la opci&oacute;n "Create Application Client Module". Escribe como nombre de proyecto: "ejb30-saludo":</p>
<p>
<img alt="" content-width="9cm" src="imagenes/ejercicios07/img5.png"></p>
<p>Puedes ver que el directorio en el que va a crear el proyecto es     "C:\Documents and Settings\USUARIO\ejb30-saludo". Pulsa "Finish" para terminar.</p>
<p>Ver&aacute;s que se crean cuatro proyectos en el panel "Projects":</p>
<ul>

<li>
<span class="codefrag">ejb30-saludo</span>: proyecto EAR que contiene al resto.</li>

<li>
<span class="codefrag">ejb30-saludo-app-client</span>: aplicaci&oacute;n cliente</li>

<li>
<span class="codefrag">ejb30-saludo-ejb</span>: proyecto EJB</li>

<li>
<span class="codefrag">ejb30-saludo-war</span>: proyecto web</li>

</ul>
<p>En el sistema de ficheros se ha creado la carpeta <span class="codefrag">ejb30-saludo</span> que contiene los otros proyectos. Puedes ver la estructura de ficheros que crea NetBeans escogiendo la pesta&ntilde;a "Files". Ver&aacute;s que en todos los directorios de proyectos hay ficheros <span class="codefrag">build.xml</span> debido a que NetBeans se basa por completo en Ant. Esta es una caracter&iacute;stica destacable de NetBeans: todas las dependencias entre proyectos y configuraciones del <em>buildpath</em> actualizan los ficheros <span class="codefrag">build.xml</span> que sirven para compilar y desplegar los proyectos.</p>
<p>2. Vamos a crear el enterprise bean <span class="codefrag">Saludo</span>. Pulsa con el bot&oacute;n derecho en el proyecto "ejb30-saludo-ejb" y escoge la opci&oacute;n "New &gt; Session Bean". Escribe como nombre <span class="codefrag">Saludo</span>, como nombre de paquete <span class="codefrag">ejb.beans</span>, escoge la opci&oacute;n <span class="codefrag">Stateless</span> (est&aacute; seleccionada por defecto) y activa ambos tipos de interfaz, remota y local:</p>
<p>
<img alt="" content-width="9cm" src="imagenes/ejercicios07/img6.png"></p>
<p>3. Implementa la clase <span class="codefrag">ejb.beans.SaludoTO</span>:</p>
<pre class="code">package ejb.beans;

import java.io.Serializable;
import java.util.ArrayList;
import java.util.Date;
import java.util.List;

public class SaludoTO implements Serializable {
    String mensaje = null;
    Date fecha = null;
    List&lt;Integer&gt; datos = null;
    
    public SaludoTO() {
        this.mensaje = "";
        this.fecha = new Date();
        this.datos = new ArrayList&lt;Integer&gt;();
    }
    
    public SaludoTO(String mensaje, Date fecha, List&lt;Integer&gt; datos) {
        this.mensaje = mensaje;
        this.fecha = fecha;
        this.datos = datos;
    }
    
    public String getMensaje() {
        return mensaje;
    }
    
    public Date getFecha() {
        return fecha;
    }
    
    public List&lt;Integer&gt; getDatos() {
        return datos;
    }
}</pre>
<p>4. Rellena el c&oacute;digo de las interfaces remota y local:</p>
<pre class="code">@Remote
public interface SaludoRemote {
   public String saluda();
   public SaludoTO getSaludo(int numDatos);
}</pre>
<pre class="code">@Local
public interface SaludoLocal {
   public String saluda();
   public SaludoTO getSaludo(int numDatos);
}</pre>
<p>5. Rellena el c&oacute;digo de la clase <span class="codefrag">SaludoBean</span>
</p>
<pre class="code">
@Stateless
public class SaludoBean implements SaludoLocal, SaludoRemote {
    private String[] saludos = { "Hola, que tal?", 
         "Cuanto tiempo sin verte", "Que te cuentas?", 
          "Me alegro de volver a verte" };
    
    public SaludoBean() {
    }

    public String saluda() {
       int random = (int) (Math.random() * saludos.length);
       return saludos[random];
    }

    public SaludoTO getSaludo(int numDatos) {
       int random = (int) (Math.random() * saludos.length);
       String saludo = saludos[random];
       Date fecha = new Date();
       ArrayList&lt;Integer&gt; datos = new ArrayList&lt;Integer&gt;();
       for (int i=0;i&lt;numDatos;i++){
          datos.add(i);
       }
       SaludoTO miSaludo = new SaludoTO(saludo,fecha,datos);
       return miSaludo;       
    }
}</pre>
<p>5. Con esto has terminado de implementar el enterprise bean. Despliega el EAR, pulsando con el bot&oacute;n derecho sobre el proyecto y seleccionando la opci&oacute;n "Deploy Project".</p>
<p>Consulta en la consola de administraci&oacute;n para comprobar que se ha realizado el despliegue:</p>
<p>
<img alt="" content-width="10cm" src="imagenes/ejercicios07/img7.png"></p>
</div>


<a name="N10188"></a><a name="Aplicaci%C3%B3n+cliente"></a>
<h2 class="underlined_10">Aplicaci&oacute;n cliente</h2>
<div class="section">
<p>Vamos a implementar la aplicaci&oacute;n cliente que se conecta de forma remota con el enterprise bean.</p>
<p>1. Implementa la clase <span class="codefrag">ejb30saluda.Main</span> del proyecto <span class="codefrag">ejb30-saludo-app-client</span>:</p>
<pre class="code">package ejb30saludo;

import ejb.beans.SaludoRemote;
import ejb.beans.SaludoTO;
import java.util.Date;
import java.util.List;
import javax.ejb.EJB;

public class Main {
   <strong>@EJB 
   static SaludoRemote saludo;</strong>
      
    public Main() {
    }
    
    public static void main(String[] args) {
       System.out.println("Voy a llamar al bean");     
       <strong>System.out.println(saludo.saluda());</strong>
       System.out.println("Ya he llamado al bean");
       
       <strong>SaludoTO saludoTO = saludo.getSaludo(100);</strong>
       System.out.println("Datos obtenidos:");
       System.out.println("Mensaje: " + saludoTO.getMensaje());
       System.out.println("Fecha creaci&oacute;n enterprise bean: " + saludoTO.getFecha().toString());
       List datos = saludoTO.getDatos();
       System.out.println("Los datos tienen " + datos.size() + " elementos");
       System.out.println("Fecha actual: " + (new Date()).toString());
    }
}</pre>
<p>Como puedes ver el enterprise bean se declara con una anotaci&oacute;n, y despu&eacute;s el entorno en el que se ejecutar&aacute; la aplicaci&oacute;n cliente inyectar&aacute; en la declaraci&oacute;n el objeto correspondencia.</p>
<p>Esto implica que la aplicaci&oacute;n cliente no puede ejecutarse aislada, sino que necesita un entorno en el que funcionar (el contenedor de aplicaciones clientes o <em>application client container</em>).</p>
<p>2. Para probar la aplicaci&oacute;n cliente debes desplegarla conjuntamente con el EAR. Prueba a desplegarla y ejecutarla de forma independidente pulsando el bot&oacute;n derecho y seleccionando "Deploy Project" y "Run Project". Obtendr&aacute;s un error, porque no se habr&aacute; inyectado el bean. </p>
<p>3. Vamos a hacerlo correctamente. Primero elimina la aplicaci&oacute;n cliente del servidor de aplicaciones. Selecciona la pesta&ntilde;a "Runtime" y examina los m&oacute;dulos desplegados en el servidor de aplicaciones: </p>
<p>
<img alt="" content-width="5cm" src="imagenes/ejercicios07/img8.png"></p>
<p>Para eliminar el m&oacute;dulo del servidor de aplicaciones, pulsa el bot&oacute;n derecho y selecciona "Undeploy".</p>
<p>4. Vamos a indicar que el ejecutable del EAR es la aplicaci&oacute;n cliente que acabamos de implementar. Para ello cambia al panel "Projects" y selecciona la opci&oacute;n "Properties &gt; Run" del projecto principal EAR. Selecciona como m&oacute;dulo cliente al "ejb30-saludo-app-client" y escribe como clase principal <span class="codefrag">ejb30saludo.Main</span>:</p>
<p>
<img alt="" content-width="9cm" src="imagenes/ejercicios07/img9.png"></p>
<p>5. Por &uacute;ltimo, pulsa con el bot&oacute;n derecho en el proyecto y selecciona la opci&oacute;n "Run Project". Ahora s&iacute; que funcionar&aacute; correctamente.</p>
<p>6. Vamos a cambiar la aplicaci&oacute;n cliente para introducir una interfaz Swing. Cambia su c&oacute;digo por el que hay a continuaci&oacute;n. Cuando NetBeans te ofrezca m&aacute;s de una opci&oacute;n a importar, selecciona el import con el paquete <span class="codefrag">swing</span>.</p>
<pre class="code">
... imports...

public class Main extends JPanel {
    
    @EJB
    static SaludoRemote saludo;
    
    protected JTextField tf;
    protected JTextArea textArea;
    
    public Main() {
        
        JPanel entryPanel = new JPanel(new BorderLayout());
        
        tf = new JTextField("", 20);
        JButton botonEnter = new JButton("Enter");
        botonEnter.addActionListener(new EnterListener());
        entryPanel.add(tf,BorderLayout.LINE_START);
        entryPanel.add(botonEnter,BorderLayout.CENTER);
        
        setLayout(new BorderLayout());
        textArea = new JTextArea(10,25);
        textArea.setEditable(false);
        JScrollPane scrollPane = new JScrollPane(textArea,
                JScrollPane.VERTICAL_SCROLLBAR_ALWAYS,
                JScrollPane.HORIZONTAL_SCROLLBAR_ALWAYS);
        
        add(entryPanel,BorderLayout.PAGE_START);
        add(scrollPane,BorderLayout.LINE_START);
    }
    
    public static void main(String[] args) {
        try {
            JFrame frame = new JFrame("Cliente remoto");
            frame.setDefaultCloseOperation(JFrame.EXIT_ON_CLOSE);
            frame.setContentPane(new Main());
            frame.setSize(300, 390);
            frame.setLocation(400,100);
            frame.setResizable(false);
            frame.setVisible(true);
            
        } catch (Exception ex) {
            System.err.println("Caught an unexpected exception!");
            ex.printStackTrace();
            System.exit(1);
        }
    }
    
    class EnterListener implements ActionListener {
        public void actionPerformed(ActionEvent e) {
            try {
                String texto = tf.getText();
                tf.setText("");
                if (texto.equals("")) {
                    textArea.append(saludo.saluda()+"\n");
                } else {

                    SaludoTO saludoTO =
                        saludo.getSaludo(Integer.parseInt(texto));
                    
                    textArea.append(saludoTO.getMensaje()+"\n");
                    textArea.append(saludoTO.getFecha().toString()+"\n");
                    int numDatos = saludoTO.getDatos().size();
                    textArea.append(Integer.toString(numDatos)+"\n");
                }
            } catch (Exception ex) {
                textArea.append("Caught an unexpected exception!\n");
                textArea.append(ex.toString());
            }
        }
    }</pre>
<p>7. Vuelve a seleccionar la opci&oacute;n "Run Project" del paquete principal y ver&aacute;s que la aplicaci&oacute;n cliente tiene ahora interfaz gr&aacute;fica:</p>
<p>
<img alt="" content-width="5cm" src="imagenes/ejercicios07/img10.png"></p>
<p>Prueba la aplicaci&oacute;n cliente.</p>
</div>


<a name="N101E5"></a><a name="Java+Web+Start"></a>
<h2 class="underlined_10">Java Web Start</h2>
<div class="section">
<p>Seguro que te habr&aacute;s preguntado c&oacute;mo utilizar la aplicaci&oacute;n cliente en un cliente remoto, independientemente del servidor de aplicaciones. La respuesta est&aacute; en la utilidad Java Web Start, con la que vamos a descargarnos la aplicaci&oacute;n cliente y el contenedor de aplicaciones clientes.</p>
<p>Java Web Start es una aplicaci&oacute;n que permite gestionar el despliegue y la actualizaci&oacute;n de aplicaciones de escritorio. Java Web Start se asegura de que la aplicaci&oacute;n de escritorio corresponde con la &uacute;ltima versi&oacute;n que reside en el servidor. En el caso de que la aplicaci&oacute;n en el servidor fuera m&aacute;s reciente la descarga al cliente.</p>
<p>1. Con&eacute;ctate a la p&aacute;gina <a href="http://java.sun.com/products/javawebstart/demos.html">p&aacute;gina de Sun con aplicaciones ejemplo</a> y pincha en una de las aplicaciones, por ejemplo el "Military Game". El navegador te preguntar&aacute; si quieres utilizar Java Web Start para lanzar ese programa. Di que s&iacute;, y que lo haga as&iacute; el resto de veces.</p>
<p>Java Web Start se activar&aacute;, se descargar&aacute; el programa ("mg.jnlp") y lo lanzar&aacute;:</p>
<p>
<img alt="" content-width="5cm" src="imagenes/ejercicios07/img11.png"></p>
<p>Puedes configurar distintas opciones de aplicaciones descargadas con JWS y crear enlaces en el escritorio a estas aplicaciones. Lanza el programa (en "C:\Archivos de Programa\Java\jreVERSION\bin\javaws.exe") y examina las distintas opciones que aparecen.</p>
<p>
<img alt="" content-width="8cm" src="imagenes/ejercicios07/img12.png"></p>
<p>Para crear un acceso directo a la aplicaci&oacute;n, pulsa con el bot&oacute;n derecho en ella y selecciona "Instalar accesos directos". Esto crea un acceso directo en el escritorio.</p>
<p>Vamos a utilizar Java Web Start para descargar y lanzar aplicaciones nuestra aplicaci&oacute;n cliente.</p>
<p>2. Abre la consola de administraci&oacute;n del servidor de aplicaciones y selecciona la aplicaci&oacute;n enterprise que hemos desplegado "ejb30-saludo". Ver&aacute;s que aparece una p&aacute;gina con sus componentes y que junto al modulo de aplicaci&oacute;n cliente aparece el enlace "Launch". P&uacute;lsalo y aparece la p&aacute;gina de lanzamiento de la aplicaci&oacute;n cliente:</p>
<p>
<img alt="" content-width="7cm" src="imagenes/ejercicios07/img13.png"></p>
<p>3. Pulsa el bot&oacute;n "Launch" y ver&aacute;s que se pone en marcha JWS para descargar y lanzar la aplicaci&oacute;n cliente que hemos desarrollado (junto con todos los JAR que implementan el contenedor de aplicaciones cliente):</p>
<p>
<img alt="" content-width="7cm" src="imagenes/ejercicios07/img14.png"></p>
<p>4. Prueba por &uacute;ltimo a parar el servidor de aplicaciones y ver&aacute;s   que la aplicaci&oacute;n cliente deja de responder. Vuelve a poner en marcha el servidor de aplicacines para comprobar que vuelve a funcionar la aplicaci&oacute;n cliente.</p>
<p>5. Prueba por &uacute;ltimo a hacer alg&uacute;n peque&ntilde;o cambio en la aplicaci&oacute;n cliente, desplegarlo y volver a arrancar la aplicaci&oacute;n usando el enlace en el escritorio. Ver&aacute;s que JWS descarga detecta que hay una nueva versi&oacute;n, la descarga y la lanza de forma transparente al usuario.</p>
</div>


<a name="N10229"></a><a name="Cliente+web"></a>
<h2 class="underlined_10">Cliente web</h2>
<div class="section">
<p>Por &uacute;ltimo, vamos a desarrollar el cliente web que se comunica de forma local con el enterprise bean.</p>
<p>Un problema es que la inyecci&oacute;n de dependencias no funciona con las etiquetas est&aacute;ndar de JSP (debido a que la especificaci&oacute;n de JSP es previa a la &uacute;ltima especificaci&oacute;n de EJB). S&iacute; que funciona con los <em>backing beans</em> de JSF y con los servlets. Vamos a usar un servlet.</p>
<p>1. Pulsa con el bot&oacute;n derecho en el proyecto war y selecciona "New &gt; Servlet". Introduce el nombre "Saluda" y el paquete <span class="codefrag">ejb.servlets</span>: </p>
<p>
<img alt="" content-width="11cm" src="imagenes/ejercicios07/img15.png"></p>
<p>2. Deja el siguiente formulario con las opciones por defecto, en las que se indica que se a&ntilde;adir&aacute; una entrada en el fichero "web.xml" con la informaci&oacute;n del servlet.</p>
<p>3. Incluye el siguiente c&oacute;digo en el cuerpo del servlet, en el que se llama al interfaz <span class="codefrag">SaludoLocal</span>:</p>
<pre class="code">public class Saluda extends HttpServlet {
    @EJB
    private SaludoLocal saludo;

    /** Processes requests for both HTTP &lt;code&gt;GET&lt;/code&gt; and &lt;code&gt;POST&lt;/code&gt; methods.
     * @param request servlet request
     * @param response servlet response
     */
    protected void processRequest(HttpServletRequest request, HttpServletResponse response)
    throws ServletException, IOException {
        response.setContentType("text/html;charset=UTF-8");
        PrintWriter out = response.getWriter();
        
        out.println("&lt;html&gt;");
        out.println("&lt;head&gt;");
        out.println("&lt;title&gt;Servlet Saluda&lt;/title&gt;");
        out.println("&lt;/head&gt;");
        out.println("&lt;body&gt;");
        out.println("&lt;h1&gt;Servlet Saluda at " + request.getContextPath() + "&lt;/h1&gt;");
        
        out.println("&lt;p&gt;");
        if (saludo != null) {
           out.println(saludo.saluda());
        } else out.println("No hay saludo");
        out.println("&lt;/p&gt;");
        out.println("&lt;/body&gt;");
        out.println("&lt;/html&gt;");

        out.close();
    }</pre>
</div>


<p>4. Despliega el proyecto EAR y abre una p&aacute;gina en la URL:</p>


<pre class="code">http://localhost:8080/ejb30-saludo-war/Saluda</pre>


<a name="N10259"></a><a name="Referencias"></a>
<h2 class="underlined_10">Referencias</h2>
<div class="section">
<ul>

<li>
<a href="http://java.sun.com/developer/technicalArticles/J2EE/jws-glassfish/">Java Web Start y aplicaciones clientes</a>
</li>

</ul>
</div>


<p class="pageBreakAfter"></p>


</div>
<div class="clearboth">&nbsp;</div>
</div>
<div id="footer">
<div class="lastmodified">
<script type="text/javascript"><!--
document.write("<text>Last Published:</text> " + document.lastModified);
//  --></script>
</div>
<div class="copyright">
        Copyright &copy;
         2006-2007 Depto. CCIA</div>
</div>
</body>
</html>
