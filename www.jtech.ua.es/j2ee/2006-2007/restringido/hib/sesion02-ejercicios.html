<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<META http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta content="Apache Forrest" name="Generator">
<meta name="Forrest-version" content="0.7">
<meta name="Forrest-skin-name" content="pelt">
<title>Ejercicios de Mapeado de clases persistentes</title>
<link type="text/css" href="skin/basic.css" rel="stylesheet">
<link media="screen" type="text/css" href="skin/screen.css" rel="stylesheet">
<link media="print" type="text/css" href="skin/print.css" rel="stylesheet">
<link type="text/css" href="skin/profile.css" rel="stylesheet">
<script src="skin/getBlank.js" language="javascript" type="text/javascript"></script><script src="skin/getMenu.js" language="javascript" type="text/javascript"></script><script src="skin/fontsize.js" language="javascript" type="text/javascript"></script>
<link rel="shortcut icon" href="">
</head>
<body onload="init()">
<script type="text/javascript">ndeSetTextSize();</script>
<div id="top">
<div class="header">
<div class="grouplogo">
<a href="http://www.jtech.ua.es/j2ee"><img class="logoImage" alt="J2EE" src="images/baner_j2ee_izq.gif" title="Curso Especialista Universitario J2EE"></a>
</div>
<div class="projectlogoA1">
<a href="http://www.dccia.ua.es/"><img class="logoImage" alt="Hibernate" src="images/baner_j2ee_der.gif" title="Hibernate"></a>
</div>
<ul id="tabs">
<li>
<a class="base-not-selected" href="../index.html">M&oacute;dulos</a>
</li>
<li class="current">
<a class="base-selected" href="index.html">Hibernate</a>
</li>
</ul>
</div>
</div>
<div id="main">
<div id="publishedStrip">
<div id="level2tabs"></div>
<script type="text/javascript"><!--
document.write("<text>Last Published:</text> " + document.lastModified);
//  --></script>
</div>
<div class="breadtrail">
             
             &nbsp;
           </div>
<div id="menu">
<div onclick="SwitchMenu('menu_selected_1.1', 'skin/')" id="menu_selected_1.1Title" class="menutitle" style="background-image: url('skin/images/chapter_open.gif');">Hibernate</div>
<div id="menu_selected_1.1" class="selectedmenuitemgroup" style="display: block;">
<div class="menuitem">
<a href="index.html" title="Hibernate">&Iacute;ndice</a>
</div>
<div onclick="SwitchMenu('menu_1.1.2', 'skin/')" id="menu_1.1.2Title" class="menutitle">Teor&iacute;a</div>
<div id="menu_1.1.2" class="menuitemgroup">
<div class="menuitem">
<a href="sesion01-apuntes.html" title="Sesi&oacute;n 1: Introducci&oacute;n a Hibernate:Configuraci&oacute;n e Inicio">Sesi&oacute;n 1</a>
</div>
<div class="menuitem">
<a href="sesion02-apuntes.html" title="Sesi&oacute;n 2: Mapeado de clases persistentes">Sesi&oacute;n 2</a>
</div>
<div class="menuitem">
<a href="sesion03-apuntes.html" title="Sesi&oacute;n 3: Relaciones entre objetos">Sesi&oacute;n 3</a>
</div>
<div class="menuitem">
<a href="sesion04-apuntes.html" title="Sesi&oacute;n 4: Consultas HQL">Sesi&oacute;n 4</a>
</div>
<div class="menuitem">
<a href="roadmap-apuntes.html" title="Roadmap">Roadmap</a>
</div>
</div>
<div onclick="SwitchMenu('menu_selected_1.1.3', 'skin/')" id="menu_selected_1.1.3Title" class="menutitle" style="background-image: url('skin/images/chapter_open.gif');">Ejercicios</div>
<div id="menu_selected_1.1.3" class="selectedmenuitemgroup" style="display: block;">
<div class="menuitem">
<a href="sesion01-ejercicios.html" title="Sesi&oacute;n 1: Introducci&oacute;n a Hibernate:Configuraci&oacute;n e Inicio">Sesi&oacute;n 1</a>
</div>
<div class="menupage">
<div class="menupagetitle">Sesi&oacute;n 2</div>
</div>
<div class="menuitem">
<a href="sesion03-ejercicios.html" title="Sesi&oacute;n 3: Relaciones entre objetos">Sesi&oacute;n 3</a>
</div>
<div class="menuitem">
<a href="sesion04-ejercicios.html" title="Sesi&oacute;n 4: Consultas HQL">Sesi&oacute;n 4</a>
</div>
</div>
</div>
<div id="credit"></div>
<div id="roundbottom">
<img style="display: none" class="corner" height="15" width="15" alt="" src="skin/images/rc-b-l-15-1body-2menu-3menu.png"></div>
<div id="credit2"></div>
</div>
<div id="content">
<div title="Portable Document Format" class="pdflink">
<a class="dida" href="sesion02-ejercicios.pdf"><img alt="PDF -icon" src="skin/images/pdfdoc.gif" class="skin"><br>
        PDF</a>
</div>
<h1>Ejercicios de Mapeado de clases persistentes</h1>
<div id="minitoc-area">
<ul class="minitoc">
<li>
<a href="#Ejercicio+1%3A+Creaci%C3%B3n+y+mapeado+de+una+tabla.">Ejercicio 1: Creaci&oacute;n y mapeado de una tabla.</a>
</li>
<li>
<a href="#Ejercicio+2%3A+Cambiando+el+estado+de+los+objetos">Ejercicio 2: Cambiando el estado de los objetos</a>
</li>
<li>
<a href="#Ejercicio+3%3A+Tablas+y+colecciones">Ejercicio 3: Tablas y colecciones</a>
</li>
<li>
<a href="#Ejercicio+OPCIONAL">Ejercicio OPCIONAL</a>
</li>
</ul>
</div>

<p>Se os proporciona el fichero <strong>hib-sesion2.doc</strong> como plantilla para que contest&eacute;is a las preguntas 
   formuladas en los ejercicios.
  </p>
   
<p>Vamos a utilizar el proyecto <span class="codefrag">hib-sesion2</span>, que se encuentra en el fichero <strong>sesion02-ejercicios.zip</strong>.
      En dicho proyecto realizaremos las modificaciones que se piden en los ejercicios propuestos.</p>


<a name="N1001B"></a><a name="Ejercicio+1%3A+Creaci%C3%B3n+y+mapeado+de+una+tabla."></a>
<h2 class="underlined_10">Ejercicio 1: Creaci&oacute;n y mapeado de una tabla.</h2>
<div class="section">
<p>Crea el fichero de mapeado <span class="codefrag">Event.hbm.xml</span>, a partir de la clase <em>Event</em>. La nueva tabla de BD se llamar&aacute;
      <span class="codefrag">EVENTS</span>, con los campos: <span class="codefrag">EVENT_ID</span>, <span class="codefrag">EVENT_DATE</span>, <span class="codefrag">EVENT_NAME</span> y 
	  <span class="codefrag">EVENT_SITE</span>. Para probar el mapeado realizado a&ntilde;ade el c&oacute;digo necesario para crear y almacenar un evento en el m&eacute;todo 
	  <em>public void createAndStoreEvent(String theName, Date theDate, String lugar)</em> (y as&oacute;cialo al bot&oacute;n <span class="codefrag">STORE</span>, en
	  el fichero <em>InterfaceUsuario.java</em>), de forma que se active 
	  cuando el usuario introduzca 
	  los datos por pantalla en la interfaz de usuario.
	  Pulsando el bot&oacute;n <span class="codefrag">LIST</span> se muestra en pantalla un listado de los eventos almacenados.</p>
<p>El atributo <em>date</em> puedes asociarlo con el tipo Hibernate <em>timestamp</em>.</p>
</div>


<a name="N1004F"></a><a name="Ejercicio+2%3A+Cambiando+el+estado+de+los+objetos"></a>
<h2 class="underlined_10">Ejercicio 2: Cambiando el estado de los objetos</h2>
<div class="section">
<p>A partir del c&oacute;digo resultante del ejercicio anterior, se pide realizar las modificaciones necesarias para:</p>
<ul>
     
<li>A&ntilde;adir el m&eacute;todo <em>public void createInitialEvents()</em>, que crear filas en la tabla <em>EVENTS</em> 
	     con los siguientes eventos:
	     ("Congreso","10/10/07","Barcelona"), ("Vacaciones","20/10/07","Par&iacute;s"), ("Cumple","14/10/07", "Par&iacute;s"), 
		 ("Aniversario","07/10/07", "Barcelona"), y  ("Cena","28/10/07", "Barcelona"). Ten en cuenta que <strong> cada vez que 
		 iniciemos el programa </strong> tenemos que incializar la tabla de datos con los eventos anteriores. Puedes utilizar
		 el m&eacute;todo privado <em>Date obtenerFecha(String fecha)</em> que se proporciona.</li>
	
<li>A&ntilde;adir el m&eacute;todo <em>public void findEventsBySite(String lugar)</em> que muestra por pantalla todos los eventos que se celebren en
	    la ciudad que se pasa por par&aacute;metro. Por ejemplo, si realizamos la llamada <em>findEventsBySite("Barcelona")</em>
		el resultado ser&aacute;: 
		<p>Eventos que tienen lugar en Barcelona:</p>
        
<p>ID: 1 Evento: Congreso   Fecha: 10/10/2007</p>
        
<p>ID: 4 Evento: Aniversario    Fecha: 07/10/2007</p>
        
<p>ID: 5 Evento: Cena    Fecha: 28/10/2007</p>
		
</li>
	
<li>A&ntilde;adir el m&eacute;todo <em>public void changeEventsSite(String oldSitio, String nuevoSitio)</em> que cambia en la base de datos
	    el lugar de celebraci&oacute;n de todos los eventos desde <em>oldSitio</em> a <em>nuevoSitio</em>. Prueba a cambiar los 
		eventos de Barcelona a Alicante, y luego vu&eacute;lvelos a cambiar a Barcelona. Nota: Para comparar dos elementos utiliza el 
		m&eacute;todo <span class="codefrag">equals</span> en vez de <span class="codefrag">==</span>.</li>
    
<li>A&ntilde;adir el m&eacute;todo <em>public Event makeEventTransient(Long eventId)</em> que borra en la base de datos
	    el evento cuyo identificador de clave primaria es <em>eventId</em>. Para que el usuario pueda cambiar de idea,
		a&ntilde;adir tambi&eacute;n el m&eacute;todo <em>public void undoMakeEventTransient(Event theEvent)</em> que vuelve a insertar en la BD el
		evento que se pasa por par&aacute;metro (y que ser&aacute; el que acabamos de borrar).</li>   
   
</ul>
</div>


<a name="N1009E"></a><a name="Ejercicio+3%3A+Tablas+y+colecciones"></a>
<h2 class="underlined_10">Ejercicio 3: Tablas y colecciones</h2>
<div class="section">
<p>A partir de la clase java <em>Person</em> crea el fichero de mapeado <em>Person.hbm.xml</em>. La nueva tabla tendr&aacute; el 
   nombre <span class="codefrag">PERSON</span>. Las propiedades de la clase <em>Person</em> se <em>mapear&aacute;n</em> como <span class="codefrag">P_EDAD</span>,
   <span class="codefrag">P_NOMBRE</span>, <span class="codefrag">P_APELLIDOS</span>, y <span class="codefrag">P_TELS</span>. Utiliza el nombre de <span class="codefrag">TELEFONOS_PERSONA</span>
   para la tabla que almacena la colecci&oacute;n de tel&eacute;fonos. Utiliza el valor del atributo <span class="codefrag">lazy</span> a <span class="codefrag">false</span>.
   Para probar el fichero de mapeado crea un fichero <em>PersonManager.java</em>
   (al igual que hicimos con <em>EventManager.java</em>), y crea los m&eacute;todos:</p>
<ul>
     
<li>
<em>public void createAndStorePerson(int edad, String nombre,
       String apellidos, Set telefonos)</em>: para crear y almacenar una nueva persona en la base de datos</li>
     
<li>
<em>public void createInitialPersons()</em>. Crea filas inciales en la tabla <em>PERSON</em>
	  (cada vez que ejecutamos el programa) con
	   los siguientes datos: (10,"Pepa","Flores", "1111","2222"),(20,"Maria","Flores", "1111","2222"), (45,"Juan","Flores",
	    "1111","2222"), (30,"Pepe","Flores", "1111","2222"), (56,"Marta","Flores", "1111","2222").  
	 </li>
	 
<li>
<em>private List listPersons()</em>: obtiene una lista de las personas almacenadas en la base de datos.</li>
	 
<li>
<em>public void printPersons()</em>: imprime en pantalla <strong>todos</strong> los datos de las personas almacenadas 
	       en la base de datos con la informaci&oacute;n que devuelve el m&eacute;todo <em>listPersons</em>.</li>
     
<li>
<em>public void addTelefonosToPerson(Long personId, String tel1, String tel2)</em>: a&ntilde;ade dos tel&eacute;fonos nuevos a una persona
	      cuyo identificador en la base de datos es <em>personId</em>.</li>
   
</ul>
</div>
      

<a name="N100FA"></a><a name="Ejercicio+OPCIONAL"></a>
<h2 class="underlined_10">Ejercicio OPCIONAL</h2>
<div class="section">
<p>Una vez implementado en el ejercicio anterior los m&eacute;todos <em>listPersons</em> y <em>printPersons</em>, prueba a 
   poner el atributo <span class="codefrag">lazy</span> en el fichero de mapeado con valor <span class="codefrag">true</span> (quitando el atributo se consigue
   el mismo efecto, ya que &eacute;ste es su valor por defecto). &iquest;Puedes explicar lo que ocurre al ejecutar de nuevo el programa?.
   Realiza los cambios necesarios en <em>PersonManager.java</em> para que el programa funcione correctamente con el
   atributo <span class="codefrag">lazy</span> en su opci&oacute;n por defecto.</p>
</div>   



<p class="pageBreakAfter"></p>


</div>
<div class="clearboth">&nbsp;</div>
</div>
<div id="footer">
<div class="lastmodified">
<script type="text/javascript"><!--
document.write("<text>Last Published:</text> " + document.lastModified);
//  --></script>
</div>
<div class="copyright">
        Copyright &copy;
         2006-2007 Depto. CCIA</div>
</div>
</body>
</html>
