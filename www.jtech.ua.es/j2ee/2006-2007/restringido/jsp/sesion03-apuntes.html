<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<META http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta content="Apache Forrest" name="Generator">
<meta name="Forrest-version" content="0.7">
<meta name="Forrest-skin-name" content="pelt">
<title>Cabeceras y c&oacute;digos desde servlets</title>
<link type="text/css" href="skin/basic.css" rel="stylesheet">
<link media="screen" type="text/css" href="skin/screen.css" rel="stylesheet">
<link media="print" type="text/css" href="skin/print.css" rel="stylesheet">
<link type="text/css" href="skin/profile.css" rel="stylesheet">
<script src="skin/getBlank.js" language="javascript" type="text/javascript"></script><script src="skin/getMenu.js" language="javascript" type="text/javascript"></script><script src="skin/fontsize.js" language="javascript" type="text/javascript"></script>
<link rel="shortcut icon" href="">
</head>
<body onload="init()">
<script type="text/javascript">ndeSetTextSize();</script>
<div id="top">
<div class="header">
<div class="grouplogo">
<a href="http://www.jtech.ua.es/j2ee"><img class="logoImage" alt="J2EE" src="images/baner_j2ee_izq.gif" title="Curso Especialista Universitario J2EE"></a>
</div>
<div class="projectlogoA1">
<a href="http://www.dccia.ua.es/"><img class="logoImage" alt="Servlets y JSP" src="images/baner_j2ee_der.gif" title="Servlets y JSP"></a>
</div>
<ul id="tabs">
<li>
<a class="base-not-selected" href="../index.html">M&oacute;dulos</a>
</li>
<li class="current">
<a class="base-selected" href="index.html">Servlets y JSP</a>
</li>
</ul>
</div>
</div>
<div id="main">
<div id="publishedStrip">
<div id="level2tabs"></div>
<script type="text/javascript"><!--
document.write("<text>Last Published:</text> " + document.lastModified);
//  --></script>
</div>
<div class="breadtrail">
             
             &nbsp;
           </div>
<div id="menu">
<div onclick="SwitchMenu('menu_selected_1.1', 'skin/')" id="menu_selected_1.1Title" class="menutitle" style="background-image: url('skin/images/chapter_open.gif');">Servlets y JSP</div>
<div id="menu_selected_1.1" class="selectedmenuitemgroup" style="display: block;">
<div class="menuitem">
<a href="index.html" title="Servlets y JSP">&Iacute;ndice</a>
</div>
<div onclick="SwitchMenu('menu_selected_1.1.2', 'skin/')" id="menu_selected_1.1.2Title" class="menutitle" style="background-image: url('skin/images/chapter_open.gif');">Teor&iacute;a</div>
<div id="menu_selected_1.1.2" class="selectedmenuitemgroup" style="display: block;">
<div class="menuitem">
<a href="sesion01-apuntes.html">Sesion 1</a>
</div>
<div class="menuitem">
<a href="sesion02-apuntes.html">Sesion 2</a>
</div>
<div class="menupage">
<div class="menupagetitle">Sesion 3</div>
</div>
<div class="menuitem">
<a href="sesion04-apuntes.html">Sesion 4</a>
</div>
<div class="menuitem">
<a href="sesion05-apuntes.html">Sesion 5</a>
</div>
<div class="menuitem">
<a href="sesion06-apuntes.html">Sesion 6</a>
</div>
<div class="menuitem">
<a href="sesion07-apuntes.html">Sesion 7</a>
</div>
<div class="menuitem">
<a href="sesion08-apuntes.html">Sesion 8</a>
</div>
<div class="menuitem">
<a href="sesion09-apuntes.html">Sesion 9</a>
</div>
<div class="menuitem">
<a href="sesion10-apuntes.html">Sesion 10</a>
</div>
<div class="menuitem">
<a href="sesion11-apuntes.html">Sesion 11</a>
</div>
<div class="menuitem">
<a href="sesion12-apuntes.html">Sesion 12</a>
</div>
<div class="menuitem">
<a href="roadmap-apuntes.html">Roadmap</a>
</div>
</div>
<div onclick="SwitchMenu('menu_1.1.3', 'skin/')" id="menu_1.1.3Title" class="menutitle">Ejercicios</div>
<div id="menu_1.1.3" class="menuitemgroup">
<div class="menuitem">
<a href="sesion01-ejercicios.html">Sesion 1</a>
</div>
<div class="menuitem">
<a href="sesion02-ejercicios.html">Sesion 2</a>
</div>
<div class="menuitem">
<a href="sesion03-ejercicios.html">Sesion 3</a>
</div>
<div class="menuitem">
<a href="sesion04-ejercicios.html">Sesion 4</a>
</div>
<div class="menuitem">
<a href="sesion05-ejercicios.html">Sesion 5</a>
</div>
<div class="menuitem">
<a href="sesion06-ejercicios.html">Sesion 6</a>
</div>
<div class="menuitem">
<a href="sesion07-ejercicios.html">Sesion 7</a>
</div>
<div class="menuitem">
<a href="sesion08-ejercicios.html">Sesion 8</a>
</div>
<div class="menuitem">
<a href="sesion09-ejercicios.html">Sesion 9</a>
</div>
<div class="menuitem">
<a href="sesion10-ejercicios.html">Sesion 10</a>
</div>
<div class="menuitem">
<a href="sesion11-ejercicios.html">Sesion 11</a>
</div>
<div class="menuitem">
<a href="sesion12-ejercicios.html">Sesion 12</a>
</div>
</div>
</div>
<div id="credit"></div>
<div id="roundbottom">
<img style="display: none" class="corner" height="15" width="15" alt="" src="skin/images/rc-b-l-15-1body-2menu-3menu.png"></div>
<div id="credit2"></div>
</div>
<div id="content">
<div title="Portable Document Format" class="pdflink">
<a class="dida" href="sesion03-apuntes.pdf"><img alt="PDF -icon" src="skin/images/pdfdoc.gif" class="skin"><br>
        PDF</a>
</div>
<h1>Cabeceras y c&oacute;digos desde servlets</h1>
<div id="minitoc-area">
<ul class="minitoc">
<li>
<a href="#Cabeceras+de+petici%C3%B3n">Cabeceras de petici&oacute;n</a>
</li>
<li>
<a href="#Cabeceras+de+respuesta">Cabeceras de respuesta</a>
</li>
<li>
<a href="#Variables+CGI">Variables CGI</a>
</li>
<li>
<a href="#C%C3%B3digos+de+estado+HTTP">C&oacute;digos de estado HTTP</a>
</li>
<li>
<a href="#Ejemplos">Ejemplos</a>
<ul class="minitoc">
<li>
<a href="#Ejemplo+de+cabeceras+de+petici%C3%B3n">Ejemplo de cabeceras de petici&oacute;n</a>
</li>
<li>
<a href="#Ejemplo+de+cabeceras+de+respuesta">Ejemplo de cabeceras de respuesta</a>
</li>
<li>
<a href="#Ejemplo+de+autentificaci%C3%B3n">Ejemplo de autentificaci&oacute;n</a>
</li>
</ul>
</li>
</ul>
</div>

<p>Veremos a continuaci&oacute;n c&oacute;mo tratar las cabeceras HTTP de una petici&oacute;n y de una respuesta, as&iacute; como los c&oacute;digos de estado que emite un servidor Web ante una petici&oacute;n, y las variables CGI a las que podemos acceder.</p>
           

<a name="N1000F"></a><a name="Cabeceras+de+petici%C3%B3n"></a>
<h2 class="underlined_10">Cabeceras de petici&oacute;n</h2>
<div class="section">
<p> Cuando se env&iacute;a una petici&oacute;n HTTP, se pueden enviar, entre otras cosas, unas cabeceras con informaci&oacute;n sobre el navegador. Para leer estas cabeceras de una petici&oacute;n desde un servlet, se utiliza el m&eacute;todo <strong><span class="codefrag">getHeader()</span></strong> del objeto <strong><span class="codefrag">HttpServletRequest</span></strong>.</p>
<pre class="code">String getHeader(String nombre)</pre>
<p>El par&aacute;metro indica el nombre de la cabecera cuyo valor se quiere obtener. Devuelve el valor de la cabecera, o <span class="codefrag">null</span> si la cabecera no ha sido enviada en la petici&oacute;n. </p>
<p>Se tienen otros m&eacute;todos, como: </p>
<pre class="code">Enumeration getHeaderNames()
Enumeration getHeaders(String nombre)
int getIntHeader(String nombre)
...</pre>
<p>Con <strong><span class="codefrag">getHeaderNames()</span></strong> obtendremos todos los nombres de las cabeceras enviadas. Con <strong><span class="codefrag">getHeaders()</span></strong> obtendremos todos los valores de la cabecera de nombre dado. Tambi&eacute;n hay m&eacute;todos como <strong><span class="codefrag">getIntHeader()</span></strong> que devuelve el valor de una cabecera con un tipo de dato espec&iacute;fico (entero, en este caso). Los nombres de las cabeceras normalmente no distinguen may&uacute;sculas de min&uacute;sculas. </p>
<p>Algunas cabeceras son de uso com&uacute;n, y tienen m&eacute;todos espec&iacute;ficos para obtener sus valores, como: </p>
<pre class="code">Cookie[] getCookies()
String getContentLength()
String getContentType()
...</pre>
<p>Con <strong><span class="codefrag">getCookies()</span></strong>obtendremos todas las cookies de la petici&oacute;n (veremos las cookies con m&aacute;s detalle en otro tema). Con <strong><span class="codefrag">getContentLength()</span></strong> obtenemos el valor de la cabecera <span class="codefrag">Content-Length</span>, y con <strong><span class="codefrag">getContentType()</span></strong> el de la cabecera <span class="codefrag">Content-Type</span>. </p>
</div>


<a name="N1005D"></a><a name="Cabeceras+de+respuesta"></a>
<h2 class="underlined_10">Cabeceras de respuesta</h2>
<div class="section">
<p>En la respuesta de un servidor web a una petici&oacute;n tambi&eacute;n pueden aparecer cabeceras que informan sobre el documento servido o sobre el propio servidor. Podemos definir cabeceras de respuesta para enviar cookies, indicar la fecha de modificaci&oacute;n, etc. Estas cabeceras deben establecerse ANTES de enviar cualquier documento, o antes de obtener el <span class="codefrag">PrintWriter</span> si es el caso. </p>
<p>Para enviar cabeceras, el m&eacute;todo m&aacute;s general es <strong><span class="codefrag">setHeader()</span></strong> del objeto <strong><span class="codefrag">HttpServletResponse</span></strong>.  </p>
<pre class="code">void setHeader(String nombre, String valor)</pre>
<p>Al que se le pasan el nombre de la cabecera y el valor. Hay otros m&eacute;todos &uacute;tiles: </p>
<pre class="code">void setIntHeader(String nombre, int valor)
void addHeader(String nombre, String valor)
void addIntHeader(String nombre, int valor)
...</pre>
<p>
<strong><span class="codefrag">setIntHeader()</span></strong> o <strong><span class="codefrag">setDateHeader()</span></strong> se utilizan para enviar cabeceras de tipo entero o fecha. Los m&eacute;todos <strong><span class="codefrag">add...()</span></strong> se emplean para a&ntilde;adir m&uacute;ltiples valores a una cabecera con el mismo nombre. </p>
<p>Algunas cabeceras tienen m&eacute;todos espec&iacute;ficos de env&iacute;o, como:</p>
<pre class="code">void setContentType(String tipo)
void setContentLength(int tama&ntilde;o)
void sendRedirect(String url)
void addCookie(Cookie cookie)</pre>
<p>Con <strong><span class="codefrag">setContentType()</span></strong> se establece la cabecera <span class="codefrag">Content-Type</span> con el tipo MIME del documento. Con <strong><span class="codefrag">setContentLength()</span></strong> se indican los bytes enviados. Con <strong><span class="codefrag">sendRedirect()</span></strong> se selecciona la cabecera <span class="codefrag">Location</span>, y con ella se redirige a la p&aacute;gina que le digamos. Finalmente, con <strong><span class="codefrag">addCookie()</span></strong> se establecen cookies (esto &uacute;ltimo ya lo veremos con m&aacute;s detalle en otro tema). Es recomendable utilizar estos m&eacute;todos en lugar del m&eacute;todo <span class="codefrag">setHeader()</span> para la cabecera en cuesti&oacute;n.</p>
</div>


<a name="N100B1"></a><a name="Variables+CGI"></a>
<h2 class="underlined_10">Variables CGI</h2>
<div class="section">
<p>Las variables CGI son una forma de recoger informaci&oacute;n sobre una petici&oacute;n. Algunas se derivan de la l&iacute;nea de petici&oacute;n HTTP y de las cabeceras, otras del propio socket (como el nombre o la IP de quien solicita la petici&oacute;n), y otras de los par&aacute;metros de instalaci&oacute;n del servidor (como el mapeo de URLs a los paths actuales). </p>
<p>Mostramos a continuaci&oacute;n una tabla con las variables CGI, y c&oacute;mo acceder a ellas desde servlets: </p>
<table class="ForrestTable" cellspacing="1" cellpadding="4">
		
<tr>
			
<th colspan="1" rowspan="1">VARIABLE CGI</th>
			<th colspan="1" rowspan="1">SIGNIFICADO</th>
			<th colspan="1" rowspan="1">ACCESO DESDE SERVLETS</th>
		
</tr>
		
<tr>
			
<td colspan="1" rowspan="1">AUTH_TYPE</td>
			<td colspan="1" rowspan="1">Tipo de cabecera Authorization (basic o digest)</td>
			<td colspan="1" rowspan="1"><span class="codefrag">request. getAuthType()</span></td>
        
</tr>
        
<tr>
			
<td colspan="1" rowspan="1">CONTENT_LENGTH</td>
			<td colspan="1" rowspan="1">N&uacute;mero de bytes enviados en peticiones POST</td>
			<td colspan="1" rowspan="1"><span class="codefrag">request. getContentLength()</span></td>
        
</tr>
        
<tr>
			
<td colspan="1" rowspan="1">CONTENT_TYPE</td>
			<td colspan="1" rowspan="1">Tipo MIME de los datos adjuntos</td>
			<td colspan="1" rowspan="1"><span class="codefrag">request. getContentType()</span></td>
        
</tr>
        
<tr>
			
<td colspan="1" rowspan="1">DOCUMENT_ROOT</td>
			<td colspan="1" rowspan="1">Path del directorio ra&iacute;z del servidor web</td>
			<td colspan="1" rowspan="1"><span class="codefrag">getServletContext(). getRealPath("/")</span></td>
        
</tr>
        
<tr>
			
<td colspan="1" rowspan="1">HTTP_XXX_YYY</td>
			<td colspan="1" rowspan="1">Acceso a cabeceras arbitrarias HTTP</td>
			<td colspan="1" rowspan="1"><span class="codefrag">request. getHeader("Xxx-Yyy")</span></td>
        
</tr>
        
<tr>
			
<td colspan="1" rowspan="1">PATH_INFO</td>
			<td colspan="1" rowspan="1">Informaci&oacute;n de path adjunto a la URL</td>
			<td colspan="1" rowspan="1"><span class="codefrag">request. getPathInfo()</span></td>
        
</tr>
        
<tr>
			
<td colspan="1" rowspan="1">PATH_TRANSLATED</td>
			<td colspan="1" rowspan="1">Path mapeado al path real del servidor</td>
			<td colspan="1" rowspan="1"><span class="codefrag">request. getPathTranslated()</span></td>
        
</tr>
        
<tr>
			
<td colspan="1" rowspan="1">QUERY_STRING</td>
			<td colspan="1" rowspan="1">Datos adjuntos para peticiones GET</td>
			<td colspan="1" rowspan="1"><span class="codefrag">request. getQueryString()</span></td>
        
</tr>
        
<tr>
			
<td colspan="1" rowspan="1">REMOTE_ADDR</td>
			<td colspan="1" rowspan="1">IP del cliente que hizo la petici&oacute;n</td>
			<td colspan="1" rowspan="1"><span class="codefrag">request. getRemoteAddr()</span></td>
        
</tr>
        
<tr>
			
<td colspan="1" rowspan="1">REMOTE_HOST</td>
			<td colspan="1" rowspan="1">Nombre del dominio del cliente que hizo la petici&oacute;n (o IP si no se puede determinar)</td>
			<td colspan="1" rowspan="1"><span class="codefrag">request. getRemoteHost()</span></td>
        
</tr>
        
<tr>
			
<td colspan="1" rowspan="1">REMOTE_USER</td>
			<td colspan="1" rowspan="1">Parte del usuario en la cabecera Authorization (si se suministr&oacute;)</td>
			<td colspan="1" rowspan="1"><span class="codefrag">request. getRemoteUser</span></td>
        
</tr>
        
<tr>
			
<td colspan="1" rowspan="1">REQUEST_METHOD</td>
			<td colspan="1" rowspan="1">Tipo de petici&oacute;n (GET, POST, PUT, DELETE, HEAD, OPTIONS, TRACE)</td>
			<td colspan="1" rowspan="1"><span class="codefrag">request. getMethod()</span></td>
        
</tr>
        
<tr>
			
<td colspan="1" rowspan="1">SCRIPT_NAME</td>
			<td colspan="1" rowspan="1">Path del servlet</td>
			<td colspan="1" rowspan="1"><span class="codefrag">request. getServletPath()</span></td>
        
</tr>
        
<tr>
			
<td colspan="1" rowspan="1">SERVER_NAME</td>
			<td colspan="1" rowspan="1">Nombre del servidor web</td>
			<td colspan="1" rowspan="1"><span class="codefrag">request. getServerName()</span></td>
        
</tr>
        
<tr>
			
<td colspan="1" rowspan="1">SERVER_PORT</td>
			<td colspan="1" rowspan="1">Puerto por el que escucha el servidor</td>
			<td colspan="1" rowspan="1"><span class="codefrag">request. getServerPort()</span></td>
        
</tr>
        
<tr>
			
<td colspan="1" rowspan="1">SERVER_PROTOCOL</td>
			<td colspan="1" rowspan="1">Nombre y versi&oacute;n usada en la l&iacute;nea de petici&oacute;n (HTTP/1.0, HTTP/1.1 ...)</td>
			<td colspan="1" rowspan="1"><span class="codefrag">request. getServerProtocol()</span></td>
        
</tr>
        
<tr>
			
<td colspan="1" rowspan="1">SERVER_SOFTWARE</td>
			<td colspan="1" rowspan="1">Informaci&oacute;n del servidor web</td>
			<td colspan="1" rowspan="1"><span class="codefrag">getServletContext(). getServerInfo()</span></td>
        
</tr>
	
</table>
<p>
<span class="codefrag">request</span> se asume que es un objeto de tipo <span class="codefrag">HttpServletRequest</span>. Para obtener cualquiera de las variables antes mencionadas, s&oacute;lo hay que llamar al m&eacute;todo apropiado desde <span class="codefrag">doGet()</span> o <span class="codefrag">doPost()</span>. </p>
</div>


<a name="N10224"></a><a name="C%C3%B3digos+de+estado+HTTP"></a>
<h2 class="underlined_10">C&oacute;digos de estado HTTP</h2>
<div class="section">
<p>Cuando un servidor web responde a una petici&oacute;n, en la respuesta aparece, entre otras cosas, un c&oacute;digo de estado que indica el resultado de la petici&oacute;n, y un mensaje corto descriptivo de dicho c&oacute;digo. </p>
<p>El env&iacute;o de cabeceras de respuesta normalmente se planifica junto con el env&iacute;o de c&oacute;digos de estado, ya que muchos de los c&oacute;digos de estado necesitan tener una cabecera definida. Podemos hacer varias cosas con los servlets manipulando las l&iacute;neas de estado y las cabeceras de respuesta, como por ejemplo reenviar al usuario a otros lugares, indicar que se requiere un password para acceder a un determinado sitio web, etc. </p>
<p>Para enviar c&oacute;digos de estado se emplea el m&eacute;todo <strong><span class="codefrag">setStatus()</span></strong> de <strong><span class="codefrag">HttpServletResponse</span></strong>: </p>
<pre class="code">void setStatus(int estado)</pre>
<p>Donde se le pasa como par&aacute;metro el c&oacute;digo del estado. En la clase <span class="codefrag">HttpServletResponse</span> tenemos una serie de constantes para referenciar a cada c&oacute;digo de estado. Por ejemplo, la constante: </p>
<pre class="code">HttpServletResponse.SC_NOT_FOUND</pre>
<p>se corresponde con el c&oacute;digo 404, e indica que el documento solicitado no se ha encontrado. </p>
<p>Existen otros m&eacute;todos para gesti&oacute;n de mensajes de error: </p>
<pre class="code">void sendError(int codigo, String mensaje)
void sendRedirect(String url)</pre>
<p>
<strong><span class="codefrag">sendError()</span></strong> genera una p&aacute;gina de error, con c&oacute;digo de error igual a <span class="codefrag">codigo</span>, y con mensaje de error igual a <span class="codefrag">mensaje</span>. Se suele utilizar este m&eacute;todo para c&oacute;digos de error, y <span class="codefrag">setStatus()</span> para c&oacute;digos normales. </p>
<p>
<strong><span class="codefrag">sendRedirect()</span></strong> genera un error de tipo 302, env&iacute;a una cabecera <span class="codefrag">Location</span> y redirige a la p&aacute;gina indicada en <span class="codefrag">url</span>. Es mejor que enviar directamente el c&oacute;digo, o hacer un <span class="codefrag">response.setHeader("Location", "http...")</span>, porque es m&aacute;s c&oacute;modo, y porque el servlet genera as&iacute; una p&aacute;gina con el enlace a la nueva direcci&oacute;n, para navegadores que no soporten redirecci&oacute;n autom&aacute;tica </p>
<p> Si queremos enviar un c&oacute;digo en la respuesta, se tiene que especificar antes de obtener el objeto <span class="codefrag">PrintWriter</span>. </p>
</div>


<a name="N10278"></a><a name="Ejemplos"></a>
<h2 class="underlined_10">Ejemplos</h2>
<div class="section">
<a name="N1027E"></a><a name="Ejemplo+de+cabeceras+de+petici%C3%B3n"></a>
<h3 class="underlined_5">Ejemplo de cabeceras de petici&oacute;n</h3>
<p>El siguiente servlet muestra los valores de todas las cabeceras HTTP enviadas en la petici&oacute;n. Recorre las cabeceras enviadas y muestra su nombre y valor: </p>
<pre class="code">package ejemplos;

import java.io.*;
import java.util.*;
import javax.servlet.*;
import javax.servlet.http.*;

public class ServletCabecerasPeticion 
extends HttpServlet
{
   <strong>// Metodo para GET
</strong>
   public void doGet(HttpServletRequest request, 
                     HttpServletResponse response) 
   throws ServletException, IOException
   {
	PrintWriter out = response.getWriter();

<strong>	// Mostramos las cabeceras enviadas 
	// en la peticion
</strong>
	out.println ("&lt;HTML&gt;");
	out.println ("&lt;BODY&gt;");	
	out.println ("&lt;H1&gt;Cabeceras&lt;/H1&gt;");
	out.println ("&lt;BR&gt;");

<strong>	Enumeration cabeceras = request.getHeaderNames();
</strong>
	while (cabeceras.hasMoreElements())
	{		
		String nombre = (String)(cabeceras.nextElement());
		out.println ("Nombre: " + nombre + 
		   ", Valor: " + <strong>request.getHeader(nombre)</strong>);
		out.println ("&lt;BR&gt;&lt;BR&gt;");
	}

	out.println ("&lt;/BODY&gt;");			
	out.println ("&lt;/HTML&gt;");
   }	

   <strong>// Metodo para POST
</strong>	
   public void doPost(HttpServletRequest request, 
                      HttpServletResponse response) 
   throws ServletException, IOException
   {
	doGet(request, response);
   }	
}</pre>
<p>Se puede probar con este formulario, pinchando el bot&oacute;n:</p>
<pre class="code">&lt;html&gt;
&lt;body&gt;
&lt;form action=
 "/appcab/servlet/ejemplos.ServletCabecerasPeticion"&gt;
	&lt;input type="submit" value="Pulsa aqui"&gt;
&lt;/form&gt;
&lt;/body&gt;
&lt;/html&gt;</pre>
<a name="N102A2"></a><a name="Ejemplo+de+cabeceras+de+respuesta"></a>
<h3 class="underlined_5">Ejemplo de cabeceras de respuesta</h3>
<p>El siguiente servlet espera un par&aacute;metro <span class="codefrag">accion</span> que puede tomar 4 valores: </p>
<ul>
			
<li>
<strong>primos</strong>: El servlet tiene un hilo que est&aacute; constantemente calculando n&uacute;meros primos. Al elegir esta opci&oacute;n se env&iacute;a una cabecera <span class="codefrag">Refresh</span> y recarga el servlet cada 10 segundos, mostrando el &uacute;ltimo n&uacute;mero primo que ha encontrado.</li>
			
<li>
<strong>redirect</strong>: Utiliza un <span class="codefrag">sendRedirect()</span> para cargar la p&aacute;gina que se indique como par&aacute;metro</li>
			
<li>
<strong>error</strong>: Utiliza un <span class="codefrag">sendError()</span><strong> </strong>para mostrar una p&aacute;gina de error, con un mensaje de error definido por el usuario, y un c&oacute;digo de error a elegir de una lista.</li>
			
<li>
<strong>codigo</strong>: Env&iacute;a un c&oacute;digo de estado HTTP (con <span class="codefrag">setStatus()</span>), a elegir de entre una lista.</li>
		
</ul>
<pre class="code">package ejemplos;

import java.io.*;
import javax.servlet.*;
import javax.servlet.http.*;

public class ServletCabecerasRespuesta 
extends HttpServlet implements Runnable
{
   <strong>// Ultimo numero primo descubierto</strong>
   long primo = 1;			<strong>
   // Hilo para calcular numeros primos</strong><strong>
</strong>   Thread t = new Thread(this);	
	
<strong>   // Metodo de inicializacion
</strong>	
   public void init()
   {
	t.start();
   }
	
<strong>   // Metodo para GET
</strong>	
   public void doGet(HttpServletRequest request, 
                     HttpServletResponse response) 
   throws ServletException, IOException
   {	
	String accion = request.getParameter("accion");
	
<strong>	if (accion.equals("primo"))
</strong>	{
<strong>		// Buscar el ultimo numero 
		// primo y enviarlo
</strong>
		response.setContentType("text/html");
<strong>		response.setHeader("Refresh", "10");
</strong>		PrintWriter out = response.getWriter();
		out.println ("&lt;HTML&gt;&lt;BODY&gt;");
		out.println ("Primo: " + primo);
		out.println ("&lt;/BODY&gt;&lt;/HTML&gt;");	

<strong>	} else if (accion.equals("redirect")) {
</strong>
<strong>		// Redirigir a otra pagina
</strong>
		String url = request.getParameter("url");
		if (url == null)
			url = "http://www.ua.es";
<strong>		response.sendRedirect(url);
</strong>			
<strong>	} else if (accion.equals("error")) {	
</strong>				
<strong>		// Enviar error con sendError()
</strong>
		int codigo = response.SC_NOT_FOUND;
		try
		{
		   codigo = Integer.parseInt
		      (request.getParameter("codigoMensaje"));
		} catch (Exception ex) {
		   codigo = response.SC_NOT_FOUND;
		}
		String mensaje = request.getParameter("mensaje");
		if (mensaje == null)
		   mensaje = "Error generado";
<strong>		response.sendError(codigo, mensaje);
</strong>
<strong>	} else if (accion.equals("codigo")) {
</strong>
		<strong>// Enviar un codigo de error
</strong>
		int codigo = response.SC_NOT_FOUND;
		try
		{
		   codigo = Integer.parseInt
		      (request.getParameter("codigo"));
		} catch (Exception ex) {
		   codigo = response.SC_NOT_FOUND;
		}
<strong>		response.setStatus(codigo);
</strong>	}
   }	

<strong>   // Metodo para POST
</strong>	
   public void doPost(HttpServletRequest request, 
                      HttpServletResponse response) 
   throws ServletException, IOException
   {
	doGet(request, response);
   }

   ... el resto del codigo es para el hilo, 
   para calcular numeros primos
   Puede consultarse en el fichero fuente, 
   aqui se quita por simplificar
}</pre>
<p>Se puede probar con este formulario, eligiendo la acci&oacute;n a realizar, introduciendo los par&aacute;metros necesarios en el formulario y pinchando el bot&oacute;n de Enviar Datos:</p>
<pre class="code">&lt;html&gt;
&lt;body&gt;
&lt;form action=
"/appcab/servlet/ejemplos.ServletCabecerasRespuesta"&gt;

&lt;table border="0"&gt;

&lt;tr&gt;
&lt;td&gt;
&lt;input type="radio" name="accion" value="primo" selected&gt;
<strong>Obtener ultimo numero primo
</strong>&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;/tr&gt;

&lt;tr&gt;
&lt;td&gt;
&lt;input type="radio" name="accion" value="redirect"&gt;
<strong>Redirigir a una pagina
</strong>&lt;/td&gt;
&lt;td&gt;
URL: 
&lt;input type="text" name="url" value="http://www.ua.es"&gt;
&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;/tr&gt;

&lt;tr&gt;
&lt;td&gt;
&lt;input type="radio" name="accion" value="error"&gt;
<strong>Mostrar pagina de error
</strong>&lt;/td&gt;
&lt;td&gt;
Mensaje: 
&lt;input type="text" name="mensaje" 
value="Error generado por el usuario"&gt;
&lt;/td&gt;
&lt;td&gt;
Codigo:
&lt;select name="codigoMensaje"&gt;
&lt;option name="codigoMensaje" value="400"&gt;400&lt;/option&gt;
&lt;option name="codigoMensaje" value="401"&gt;401&lt;/option&gt;
&lt;option name="codigoMensaje" value="403"&gt;403&lt;/option&gt;
&lt;option name="codigoMensaje" value="404" selected&gt;404
&lt;/option&gt;
&lt;/select&gt;
&lt;/td&gt;
&lt;/tr&gt;

&lt;tr&gt;
&lt;td&gt;
&lt;input type="radio" name="accion" value="codigo"&gt;
<strong>Enviar codigo de error
</strong>&lt;/td&gt;
&lt;td&gt;
Codigo:
&lt;select name="codigo"&gt;
&lt;option name="codigo" value="200"&gt;200&lt;/option&gt;	
&lt;option name="codigo" value="204"&gt;204&lt;/option&gt;
&lt;option name="codigo" value="404" selected&gt;404&lt;/option&gt;
&lt;/select&gt;
&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;/tr&gt;

&lt;/table&gt;

&lt;input type="submit" value="Enviar Datos"&gt;

&lt;/form&gt;
&lt;/body&gt;
&lt;/html&gt;</pre>
<a name="N10320"></a><a name="Ejemplo+de+autentificaci%C3%B3n"></a>
<h3 class="underlined_5">Ejemplo de autentificaci&oacute;n</h3>
<p>El siguiente servlet emplea las cabeceras de autentificaci&oacute;n: env&iacute;a una cabecera de autentificaci&oacute;n si no ha recibido ninguna, o si la que ha recibido no est&aacute; dentro de un conjunto de <span class="codefrag">Properties </span>predefinido, con logins y passwords v&aacute;lidos. En el caso de introducir un login o password v&aacute;lidos, muestra un mensaje de bienvenida.  </p>
<p>Los logins y passwords est&aacute;n en un objeto <span class="codefrag">Properties</span>, definido en el m&eacute;todo<span class="codefrag">  init()</span>. Podr&iacute;amos leer estos datos de un fichero, aunque por simplicidad aqu&iacute; se definen como constantes de cadena. </p>
<p>Los datos de autentificaci&oacute;n se env&iacute;an codificados, y se emplea un objeto <span class="codefrag">sun.misc.BASE64Decoder</span> para descodificarlos y sacar el login y password. </p>
<pre class="code">package ejemplos;

import java.io.*;
import java.util.*;
import sun.misc.*;
import javax.servlet.*;
import javax.servlet.http.*;

public class ServletPassword extends HttpServlet
{
   <strong>// Conjunto de logins y passwords permitidos</strong>
   Properties datos = new Properties();	<strong>
</strong>	
   <strong>// Metodo de inicializacion
</strong>	
   public void init()
   {
	datos.setProperty("usuario1", "password1");
	datos.setProperty("usuario2", "password2");
   }
	
   <strong>// Metodo para GET
</strong>	
   public void doGet(HttpServletRequest request, 
                     HttpServletResponse response) 
   throws ServletException, IOException
   {		
	response.setContentType("text/html");

	<strong>// Comprobamos si hay cabecera 
	// de autorizacion
</strong>		
	String autorizacion = request.getHeader("Authorization");
		
	if (autorizacion == null)
	{
		<strong>// Enviamos el codigo 401 y 
		// la cabecera para autentificacion
</strong>			
		response.setStatus(response.SC_UNAUTHORIZED);
		response.setHeader("WWW-Authenticate", 
		   "BASIC realm=\"privileged-few\"");
	}
	else
	{
		<strong>// Obtenemos los datos del usuario 
		// y comparamos con los almacenados
</strong>		
		<strong>// Quitamos los 6 primeros caracteres 
		// que indican tipo de autentificaci&oacute;n 
		// (BASIC)

</strong>		String datosUsuario = 
	 	   autorizacion.substring(6).trim();

		BASE64Decoder dec = new BASE64Decoder();

		String usuarioPassword = new String
		   (dec.decodeBuffer(datosUsuario));

		int indice = usuarioPassword.indexOf(":");

		String usuario = 
		   usuarioPassword.substring(0, indice);

		String password = 
		   usuarioPassword.substring(indice + 1);

		String passwordReal = 
		   datos.getProperty(usuario);
		
		if (passwordReal != null &amp;&amp; 
		    passwordReal.equals(password))
		{
			<strong>// Mensaje de bienvenida
</strong>				
			PrintWriter out = response.getWriter();
			out.println ("&lt;HTML&gt;&lt;BODY&gt;");
			out.println ("OK");
			out.println ("&lt;/BODY&gt;&lt;/HTML&gt;");	
		} else {
				
			<strong>// Pedir autentificacion
</strong>
			response.setStatus 
			   (response.SC_UNAUTHORIZED);
			response.setHeader
			   ("WWW-Authenticate", 
			   "BASIC realm=\"privileged-few\"");
		}
	}
   }	

   <strong>// Metodo para POST
</strong>	
   public void doPost(HttpServletRequest request, 
                      HttpServletResponse response) 
   throws ServletException, IOException
   {
	doGet(request, response);
   }
}</pre>
<p> Se puede probar cada ejemplo, respectivamente, con:</p>
<pre class="code">http://localhost:8080/appcab/inicioCabecerasPeticion.html
http://localhost:8080/appcab/inicioCabecerasRespuesta.html
http://localhost:8080/appcab/servlet/ejemplos.ServletPassword</pre>
<p>Un ejemplo de login y password v&aacute;lidos para el tercer ejemplo es: login=<span class="codefrag">usuario1</span>, password=<span class="codefrag">password1</span>.</p>
</div>

<p class="pageBreakAfter"></p>


</div>
<div class="clearboth">&nbsp;</div>
</div>
<div id="footer">
<div class="lastmodified">
<script type="text/javascript"><!--
document.write("<text>Last Published:</text> " + document.lastModified);
//  --></script>
</div>
<div class="copyright">
        Copyright &copy;
         2006 Depto. CCIA</div>
</div>
</body>
</html>
