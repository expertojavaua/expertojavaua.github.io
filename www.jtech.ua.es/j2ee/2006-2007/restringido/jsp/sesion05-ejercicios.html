<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<META http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta content="Apache Forrest" name="Generator">
<meta name="Forrest-version" content="0.7">
<meta name="Forrest-skin-name" content="pelt">
<title>Ejercicios de Comunicaci&oacute;n</title>
<link type="text/css" href="skin/basic.css" rel="stylesheet">
<link media="screen" type="text/css" href="skin/screen.css" rel="stylesheet">
<link media="print" type="text/css" href="skin/print.css" rel="stylesheet">
<link type="text/css" href="skin/profile.css" rel="stylesheet">
<script src="skin/getBlank.js" language="javascript" type="text/javascript"></script><script src="skin/getMenu.js" language="javascript" type="text/javascript"></script><script src="skin/fontsize.js" language="javascript" type="text/javascript"></script>
<link rel="shortcut icon" href="">
</head>
<body onload="init()">
<script type="text/javascript">ndeSetTextSize();</script>
<div id="top">
<div class="header">
<div class="grouplogo">
<a href="http://www.jtech.ua.es/j2ee"><img class="logoImage" alt="J2EE" src="images/baner_j2ee_izq.gif" title="Curso Especialista Universitario J2EE"></a>
</div>
<div class="projectlogoA1">
<a href="http://www.dccia.ua.es/"><img class="logoImage" alt="Servlets y JSP" src="images/baner_j2ee_der.gif" title="Servlets y JSP"></a>
</div>
<ul id="tabs">
<li>
<a class="base-not-selected" href="../index.html">M&oacute;dulos</a>
</li>
<li class="current">
<a class="base-selected" href="index.html">Servlets y JSP</a>
</li>
</ul>
</div>
</div>
<div id="main">
<div id="publishedStrip">
<div id="level2tabs"></div>
<script type="text/javascript"><!--
document.write("<text>Last Published:</text> " + document.lastModified);
//  --></script>
</div>
<div class="breadtrail">
             
             &nbsp;
           </div>
<div id="menu">
<div onclick="SwitchMenu('menu_selected_1.1', 'skin/')" id="menu_selected_1.1Title" class="menutitle" style="background-image: url('skin/images/chapter_open.gif');">Servlets y JSP</div>
<div id="menu_selected_1.1" class="selectedmenuitemgroup" style="display: block;">
<div class="menuitem">
<a href="index.html" title="Servlets y JSP">&Iacute;ndice</a>
</div>
<div onclick="SwitchMenu('menu_1.1.2', 'skin/')" id="menu_1.1.2Title" class="menutitle">Teor&iacute;a</div>
<div id="menu_1.1.2" class="menuitemgroup">
<div class="menuitem">
<a href="sesion01-apuntes.html">Sesion 1</a>
</div>
<div class="menuitem">
<a href="sesion02-apuntes.html">Sesion 2</a>
</div>
<div class="menuitem">
<a href="sesion03-apuntes.html">Sesion 3</a>
</div>
<div class="menuitem">
<a href="sesion04-apuntes.html">Sesion 4</a>
</div>
<div class="menuitem">
<a href="sesion05-apuntes.html">Sesion 5</a>
</div>
<div class="menuitem">
<a href="sesion06-apuntes.html">Sesion 6</a>
</div>
<div class="menuitem">
<a href="sesion07-apuntes.html">Sesion 7</a>
</div>
<div class="menuitem">
<a href="sesion08-apuntes.html">Sesion 8</a>
</div>
<div class="menuitem">
<a href="sesion09-apuntes.html">Sesion 9</a>
</div>
<div class="menuitem">
<a href="sesion10-apuntes.html">Sesion 10</a>
</div>
<div class="menuitem">
<a href="sesion11-apuntes.html">Sesion 11</a>
</div>
<div class="menuitem">
<a href="sesion12-apuntes.html">Sesion 12</a>
</div>
<div class="menuitem">
<a href="roadmap-apuntes.html">Roadmap</a>
</div>
</div>
<div onclick="SwitchMenu('menu_selected_1.1.3', 'skin/')" id="menu_selected_1.1.3Title" class="menutitle" style="background-image: url('skin/images/chapter_open.gif');">Ejercicios</div>
<div id="menu_selected_1.1.3" class="selectedmenuitemgroup" style="display: block;">
<div class="menuitem">
<a href="sesion01-ejercicios.html">Sesion 1</a>
</div>
<div class="menuitem">
<a href="sesion02-ejercicios.html">Sesion 2</a>
</div>
<div class="menuitem">
<a href="sesion03-ejercicios.html">Sesion 3</a>
</div>
<div class="menuitem">
<a href="sesion04-ejercicios.html">Sesion 4</a>
</div>
<div class="menupage">
<div class="menupagetitle">Sesion 5</div>
</div>
<div class="menuitem">
<a href="sesion06-ejercicios.html">Sesion 6</a>
</div>
<div class="menuitem">
<a href="sesion07-ejercicios.html">Sesion 7</a>
</div>
<div class="menuitem">
<a href="sesion08-ejercicios.html">Sesion 8</a>
</div>
<div class="menuitem">
<a href="sesion09-ejercicios.html">Sesion 9</a>
</div>
<div class="menuitem">
<a href="sesion10-ejercicios.html">Sesion 10</a>
</div>
<div class="menuitem">
<a href="sesion11-ejercicios.html">Sesion 11</a>
</div>
<div class="menuitem">
<a href="sesion12-ejercicios.html">Sesion 12</a>
</div>
</div>
</div>
<div id="credit"></div>
<div id="roundbottom">
<img style="display: none" class="corner" height="15" width="15" alt="" src="skin/images/rc-b-l-15-1body-2menu-3menu.png"></div>
<div id="credit2"></div>
</div>
<div id="content">
<div title="Portable Document Format" class="pdflink">
<a class="dida" href="sesion05-ejercicios.pdf"><img alt="PDF -icon" src="skin/images/pdfdoc.gif" class="skin"><br>
        PDF</a>
</div>
<h1>Ejercicios de Comunicaci&oacute;n</h1>
<div id="minitoc-area">
<ul class="minitoc">
<li>
<a href="#Ejemplo+de+contexto">Ejemplo de contexto</a>
</li>
<li>
<a href="#Chat+con+servlets">Chat con servlets</a>
</li>
</ul>
</div>


<a name="N1000C"></a><a name="Ejemplo+de+contexto"></a>
<h2 class="underlined_10">Ejemplo de contexto</h2>
<div class="section">
<p>Vamos a probar la aplicaci&oacute;n <span class="codefrag">jsp-sesion05-contexto</span> 
  incluida en los ejercicios de la sesi&oacute;n.</p>
<p>
<em>a)</em> Desplegar la aplicaci&oacute;n web en Tomcat, y acceder a la direcci&oacute;n:</p>
<pre class="code">http://localhost:8080/jsp-sesion05-contexto</pre>
<p>Veremos la aplicaci&oacute;n web ya en marcha.</p>
<p>
<em>b)</em> La aplicaci&oacute;n web nos permite visualizar los atributos de contexto 
    definidos y sus valores, y a&ntilde;adir nuevos atributos. A parte de los 
    atributos que nosotros a&ntilde;adimos manualmente, &iquest;hay m&aacute;s 
    atributos de contexto definidos?</p>
<p>
<em>c)</em> Podemos a&ntilde;adir nuevos atributos de contexto. Daremos un nombre 
    del atributo, y un texto que contendr&aacute; como valor. Adem&aacute;s como 
    valor tambi&eacute;n se introducir&aacute; el identificador de sesi&oacute;n 
    del navegador que haya creado dicho atributo. Abrir distintos navegadores 
    y a&ntilde;adir atributos de contexto desde cada 
    uno. Comprobar que en cada navegador vemos tanto los atributos creados en 
    su sesi&oacute;n, como lo atributos creados creados en las sesiones de otros 
    navegadores (el identificador de sesi&oacute;n ser&aacute; distinto).</p>
<p>
<em>d)</em> Si nos fijamos en el descriptor de despligue, <span class="codefrag">web.xml</span>, veremos 
    que se ha a&ntilde;adido un listener sobre los atributos del contexto. Este 
    listener imprime mensajes en el <em>log</em> indicando cuando se a&ntilde;ade, 
    elimina o reemplaza un atributo de contexto. Comprobar en el fichero de logs 
    correspondiente que se han registrado los cambios en los atributos que hayamos hecho.</p>
</div>

<a name="N1003A"></a><a name="Chat+con+servlets"></a>
<h2 class="underlined_10">Chat con servlets</h2>
<div class="section">
<p>Vamos a realizar una aplicaci&oacute;n de chat utilizando
   servlets. En el directorio <span class="codefrag">jsp-sesion05-chat</span> de los fuentes de la
sesi&oacute;n    podr&aacute;s encontrar la base sobre la que construiremos
el chat. Cada mensaje    de chat estar&aacute; encapsulado en la clase <span class="codefrag">Mensaje</span>,
y la    lista de mensajes actual del chat se encontrar&aacute; en la clase
<span class="codefrag">ColaMensajes</span>. </p>
<p>Adem&aacute;s se proporcionan los ficheros HTML necesarios
   para la aplicaci&oacute;n. El fichero <span class="codefrag">index.html</span> contiene
el    formulario de login para que un usuario introduzca el <em>nick</em>
con el que    entrar&aacute; en el chat (no se solicita ning&uacute;n password
para validar).    El login se har&aacute; efectivo por el servlet <span class="codefrag">LoginUsuarioServlet</span>
   tambi&eacute;n proporcionado, que introducir&aacute; el <em>nick</em>
del usuario    en la informaci&oacute;n de sesi&oacute;n y nos redirigir&aacute;
al chat. En    el subdirectorio <span class="codefrag">chat</span> tendremos los ficheros est&aacute;ticos del chat:</p>
<table class="ForrestTable" cellspacing="1" cellpadding="4">
  
<tr>
<th colspan="1" rowspan="1"></th><th colspan="1" rowspan="1"></th><th colspan="1" rowspan="1"></th><th colspan="1" rowspan="1"></th><th colspan="1" rowspan="1"></th>
</tr>
    
<tr>
     
<td colspan="1" rowspan="1">
      <span class="codefrag">chatFrames.html</span>
     </td>
     <td colspan="4" rowspan="1">P&aacute;gina principal de los frames de la aplicaci&oacute;n
chat. Mostrar&aacute;        un frame con el formulario para enviar mensajes,
y otro con la lista de        mensajes enviados.</td>
   
</tr>
   
<tr>
     
<td colspan="1" rowspan="1">
      <span class="codefrag">enviaMensaje.html</span>
      </td>
     <td colspan="4" rowspan="1">Formulario para enviar mensajes al chat.</td>
   
</tr>
   
<tr>
     
<td colspan="1" rowspan="1">
      <span class="codefrag">error.html</span>
      </td>
     <td colspan="4" rowspan="1">P&aacute;gina que nos muestra un mensaje de error cuando se intenta enviar un mensaje sin haber hecho <em>login</em>.</td>
   
</tr>
   
<tr>
     
<td colspan="1" rowspan="1">
      <span class="codefrag">cabecera.html</span>
      </td>
     <td colspan="4" rowspan="1">Cabecera de la tabla de mensajes, a incluir al comienzo de la p&aacute;gina de lista de mensajes.</td>
   
</tr>
   
<tr>
     
<td colspan="1" rowspan="1">
      <span class="codefrag">pie.html</span>
      </td>
     <td colspan="4" rowspan="1">Pie de la tabla de mensajes, a incluir al final de la p&aacute;gina de lista de mensajes.</td>
   
</tr>

</table>
<p>Ahora deberemos implementar los servlets para el envio de mensajes y
para    la consulta de la lista de mensajes enviados. Se pide:</p>
<p>
<em>a)</em> La cola de mensajes ser&aacute; el objeto com&uacute;n al que acceden
     los servlets para el envio y la consulta de estos mensajes. Por lo tanto
el      objeto deber&aacute; a&ntilde;adirse como atributo del contexto.
Esto lo tendremos      que hacer antes de que cualquier servlet se haya ejecutado.
Para ello debemos      crear un objeto <span class="codefrag">ServletContextListener</span>
que en la creaci&oacute;n      del contexto inicialice la cola de mensajes
(<span class="codefrag">ColaMensajes</span>)      y la introduzca como atributo en el
contexto global (atributo <span class="codefrag">es.ua.jtech.jsp.sesion5.chat.mensajes</span>).</p>
<p>
<em>b)</em> Una vez tenemos creada la cola de mensajes, deberemos implementar el servlet 
    <span class="codefrag">EnviaMensajeServlet</span>, que tome un mensaje como par&aacute;metro (el nombre 
    del par&aacute;metro es <span class="codefrag">texto</span>), y lo a&ntilde;ada a la lista de mensajes 
    con el nick del usuario actual (obtenido del atributo <span class="codefrag">es.ua.jtech.jsp.sesion5.chat.nick</span> de la 
    sesi&oacute;n). Una vez enviado el mensaje, mostraremos en la salida el contenido 
    de <span class="codefrag">enviaMensaje.html</span>, mediante un objeto <span class="codefrag">RequestDispatcher</span>. Si 
    no hubiese ning&uacute;n usuario en la sesi&oacute;n, no se registrar&aacute; el mensaje y se deber&aacute;
    redirigir la salida a <span class="codefrag">error.html</span>
</p>
<p>
<em>c)</em> Por &uacute;ltimo, deberemos implementar el servlet <span class="codefrag">ListaMensajesServlet</span> 
    que mostrar&aacute; todos los mensajes del chat. Este servlet debe:</p>
<ul>

<li>Para que la lista de mensajes se actualice periodicamente en el cliente, haremos que se recargue cada 5 segundos. A&ntilde;adir la cabecera HTTP correspondiente a la respuesta para que esto ocurra (cabecera <span class="codefrag">Refresh</span>, indicando como valor el n&uacute;mero de segundos que tardar&aacute; en recargar).</li>

<li>Incluir el contenido del fichero est&aacute;tico <span class="codefrag">cabecera.html</span> al comienzo del documento generado, y <span class="codefrag">pie.html</span> al final, para enmarcar la zona donde aparecen los mensajes del chat.
<div class="frame note">
<div class="label">Nota</div>
<div class="content">Se debe obtener el <span class="codefrag">PrintWriter</span> para escribir la respuesta antes de hacer el
primer <span class="codefrag">include</span>, ya que de lo contrario se obtendr&iacute;a una excepci&oacute;n de tipo <span class="codefrag">IllegalStateException</span>.
Esto de debido a que el <span class="codefrag">include</span> ya habr&iacute;a obtenido previamente el flujo de salida de la respuesta.</div>
</div>
</li>

<li>Obtener el <em>nick</em> del usuario actual de la sesi&oacute;n. Los mensajes enviados con este <em>nick</em> se mostrar&aacute;n en negrita, el resto se mostrar&aacute;n de forma normal.</li>



  
</ul>
<p>
<em>d)</em> Comprobar que el chat funciona correctamente. Conectar desde varios
clientes      a un mismo servidor.</p>
</div>


<p class="pageBreakAfter"></p>
  

</div>
<div class="clearboth">&nbsp;</div>
</div>
<div id="footer">
<div class="lastmodified">
<script type="text/javascript"><!--
document.write("<text>Last Published:</text> " + document.lastModified);
//  --></script>
</div>
<div class="copyright">
        Copyright &copy;
         2006 Depto. CCIA</div>
</div>
</body>
</html>
