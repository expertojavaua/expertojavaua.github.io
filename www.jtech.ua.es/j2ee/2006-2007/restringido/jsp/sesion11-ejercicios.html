<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<META http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta content="Apache Forrest" name="Generator">
<meta name="Forrest-version" content="0.7">
<meta name="Forrest-skin-name" content="pelt">
<title>Ejercicios de Filtros y Wrappers</title>
<link type="text/css" href="skin/basic.css" rel="stylesheet">
<link media="screen" type="text/css" href="skin/screen.css" rel="stylesheet">
<link media="print" type="text/css" href="skin/print.css" rel="stylesheet">
<link type="text/css" href="skin/profile.css" rel="stylesheet">
<script src="skin/getBlank.js" language="javascript" type="text/javascript"></script><script src="skin/getMenu.js" language="javascript" type="text/javascript"></script><script src="skin/fontsize.js" language="javascript" type="text/javascript"></script>
<link rel="shortcut icon" href="">
</head>
<body onload="init()">
<script type="text/javascript">ndeSetTextSize();</script>
<div id="top">
<div class="header">
<div class="grouplogo">
<a href="http://www.jtech.ua.es/j2ee"><img class="logoImage" alt="J2EE" src="images/baner_j2ee_izq.gif" title="Curso Especialista Universitario J2EE"></a>
</div>
<div class="projectlogoA1">
<a href="http://www.dccia.ua.es/"><img class="logoImage" alt="Servlets y JSP" src="images/baner_j2ee_der.gif" title="Servlets y JSP"></a>
</div>
<ul id="tabs">
<li>
<a class="base-not-selected" href="../index.html">M&oacute;dulos</a>
</li>
<li class="current">
<a class="base-selected" href="index.html">Servlets y JSP</a>
</li>
</ul>
</div>
</div>
<div id="main">
<div id="publishedStrip">
<div id="level2tabs"></div>
<script type="text/javascript"><!--
document.write("<text>Last Published:</text> " + document.lastModified);
//  --></script>
</div>
<div class="breadtrail">
             
             &nbsp;
           </div>
<div id="menu">
<div onclick="SwitchMenu('menu_selected_1.1', 'skin/')" id="menu_selected_1.1Title" class="menutitle" style="background-image: url('skin/images/chapter_open.gif');">Servlets y JSP</div>
<div id="menu_selected_1.1" class="selectedmenuitemgroup" style="display: block;">
<div class="menuitem">
<a href="index.html" title="Servlets y JSP">&Iacute;ndice</a>
</div>
<div onclick="SwitchMenu('menu_1.1.2', 'skin/')" id="menu_1.1.2Title" class="menutitle">Teor&iacute;a</div>
<div id="menu_1.1.2" class="menuitemgroup">
<div class="menuitem">
<a href="sesion01-apuntes.html">Sesion 1</a>
</div>
<div class="menuitem">
<a href="sesion02-apuntes.html">Sesion 2</a>
</div>
<div class="menuitem">
<a href="sesion03-apuntes.html">Sesion 3</a>
</div>
<div class="menuitem">
<a href="sesion04-apuntes.html">Sesion 4</a>
</div>
<div class="menuitem">
<a href="sesion05-apuntes.html">Sesion 5</a>
</div>
<div class="menuitem">
<a href="sesion06-apuntes.html">Sesion 6</a>
</div>
<div class="menuitem">
<a href="sesion07-apuntes.html">Sesion 7</a>
</div>
<div class="menuitem">
<a href="sesion08-apuntes.html">Sesion 8</a>
</div>
<div class="menuitem">
<a href="sesion09-apuntes.html">Sesion 9</a>
</div>
<div class="menuitem">
<a href="sesion10-apuntes.html">Sesion 10</a>
</div>
<div class="menuitem">
<a href="sesion11-apuntes.html">Sesion 11</a>
</div>
<div class="menuitem">
<a href="sesion12-apuntes.html">Sesion 12</a>
</div>
<div class="menuitem">
<a href="roadmap-apuntes.html">Roadmap</a>
</div>
</div>
<div onclick="SwitchMenu('menu_selected_1.1.3', 'skin/')" id="menu_selected_1.1.3Title" class="menutitle" style="background-image: url('skin/images/chapter_open.gif');">Ejercicios</div>
<div id="menu_selected_1.1.3" class="selectedmenuitemgroup" style="display: block;">
<div class="menuitem">
<a href="sesion01-ejercicios.html">Sesion 1</a>
</div>
<div class="menuitem">
<a href="sesion02-ejercicios.html">Sesion 2</a>
</div>
<div class="menuitem">
<a href="sesion03-ejercicios.html">Sesion 3</a>
</div>
<div class="menuitem">
<a href="sesion04-ejercicios.html">Sesion 4</a>
</div>
<div class="menuitem">
<a href="sesion05-ejercicios.html">Sesion 5</a>
</div>
<div class="menuitem">
<a href="sesion06-ejercicios.html">Sesion 6</a>
</div>
<div class="menuitem">
<a href="sesion07-ejercicios.html">Sesion 7</a>
</div>
<div class="menuitem">
<a href="sesion08-ejercicios.html">Sesion 8</a>
</div>
<div class="menuitem">
<a href="sesion09-ejercicios.html">Sesion 9</a>
</div>
<div class="menuitem">
<a href="sesion10-ejercicios.html">Sesion 10</a>
</div>
<div class="menupage">
<div class="menupagetitle">Sesion 11</div>
</div>
<div class="menuitem">
<a href="sesion12-ejercicios.html">Sesion 12</a>
</div>
</div>
</div>
<div id="credit"></div>
<div id="roundbottom">
<img style="display: none" class="corner" height="15" width="15" alt="" src="skin/images/rc-b-l-15-1body-2menu-3menu.png"></div>
<div id="credit2"></div>
</div>
<div id="content">
<div title="Portable Document Format" class="pdflink">
<a class="dida" href="sesion11-ejercicios.pdf"><img alt="PDF -icon" src="skin/images/pdfdoc.gif" class="skin"><br>
        PDF</a>
</div>
<h1>Ejercicios de Filtros y Wrappers</h1>
<div id="minitoc-area">
<ul class="minitoc">
<li>
<a href="#Filtro+de+acceso+restringido">Filtro de acceso restringido</a>
</li>
<li>
<a href="#Restringir+el+acceso+al+chat">Restringir el acceso al chat</a>
</li>
<li>
<a href="#Wrapper+de+ejemplo+%28*%29">Wrapper de ejemplo (*)</a>
</li>
<li>
<a href="#Registro+de+accesos+%28*%29">Registro de accesos (*)</a>
</li>
</ul>
</div>


<a name="N1000C"></a><a name="Filtro+de+acceso+restringido"></a>
<h2 class="underlined_10">Filtro de acceso restringido</h2>
<div class="section">
<p>Vamos a probar la aplicaci&oacute;n <span class="codefrag">jsp-sesion11-filtro</span> en la que tenemos 
  un filtro <span class="codefrag">RestringirAcceso</span> que prohibe el acceso de los usuarios 
  no registrados al contenido del directorio <span class="codefrag">restringido</span>. Se pide:</p>
<p>
<em>a)</em> Desplegar la aplicaci&oacute;n en Tomcat. Una vez instalada 
    comprobamos que la aplicaci&oacute;n 
    se ha instalado correctamente. Tras esto intentamos acceder a uno de los recursos 
    del directorio <span class="codefrag">restringido</span>:</p>
<pre class="code">http://localhost:8080/jsp-sesion11-filtro/restringido/index.html
http://localhost:8080/jsp-sesion11-filtro/restringido/index.jsp</pre>
<p>&iquest;Qu&eacute; ocurre? &iquest;Por qu&eacute;?</p>
<p>
<em>b)</em> Validarse como usuario y volver a intentar acceder al directorio <span class="codefrag">restringido</span>. 
    &iquest;Ahora que ocurre? &iquest;Qu&eacute; ventajas tiene implementar esta 
    restricci&oacute;n de acceso mediante un filtro?</p>
</div>

<a name="N10036"></a><a name="Restringir+el+acceso+al+chat"></a>
<h2 class="underlined_10">Restringir el acceso al chat</h2>
<div class="section">
<p>Recordemos que en sesiones anteriores realizamos 
  un chat mediante servlets, en el que hab&iacute;a que registrarse como usuario 
  antes de entrar a hablar. Sin embargo, si se introduce directamente la direcci&oacute;n:</p>
<pre class="code">http://localhost:8080/jsp-sesion05-chat/chat/chatFrames.html</pre>
<p>Podemos acceder directamente al chat sin estar registrados. Se pide:</p>
<p>
<em>a)</em> Implementar un filtro en el chat que restrinja el acceso al chat si no 
    se ha registrado un <em>nick</em> en la sesi&oacute;n.</p>
<p>
<em>b)</em> &iquest;A qu&eacute; recursos deber&aacute; afectar este filtro? Introducir 
    en el descriptor de despliegue (<span class="codefrag">web.xml</span>) la configuraci&oacute;n 
    necesaria para que el filtro intercepte los intentos de acceso a los recursos 
    restringidos.
  </p>
</div>

<a name="N10057"></a><a name="Wrapper+de+ejemplo+%28*%29"></a>
<h2 class="underlined_10">Wrapper de ejemplo (*)</h2>
<div class="section">
<p>La aplicaci&oacute;n <span class="codefrag">jsp-sesion11-wrapper</span> incorpora 
  un filtro que utiliza un <em>wrapper</em> para analizar la respuesta generada. 
  Toma esta respuesta del <em>wrapper</em> (asumimos que es contenido HTML), y 
  la analiza utilizando la librer&iacute;a <em>htmlparser</em>, para extraer su t&iacute;tulo. 
  Una vez tiene el t&iacute;tulo registra que se ha accedido a dicha p&aacute;gina 
  en el <em>log</em> y devuelve la respuesta al cliente. Se pide:</p>
<p>
<em>a)</em> Desplegar la aplicaci&oacute;n en Tomcat. 
    Probar a acceder a varios ficheros HTML est&aacute;ticos de los incluidos 
    dentro de la aplicaci&oacute;n. Comprobar que en el <em>log</em> se ha registrado 
    el acceso indicando el t&iacute;tulo de las p&aacute;ginas.</p>
<p>
<em>b)</em> Si tuviesemos recursos que no fuesen HTML (como por ejemplo im&aacute;genes)
   dentro de la ruta a la que afecta el filtro, &iquest;que ocurrir&iacute;a?.
   Intentar acceder a una imagen dentro de la aplicaci&oacute;n y ver el
error    que se produce. &iquest;A qu&eacute; se debe esto? &iquest;Como
podr&iacute;amos    solucionarlo?</p>
</div>

<a name="N1007D"></a><a name="Registro+de+accesos+%28*%29"></a>
<h2 class="underlined_10">Registro de accesos (*)</h2>
<div class="section">
<p>Vamos a realizar una aplicaci&oacute;n que contabilice 
  el n&uacute;mero de accesos a las p&aacute;ginas mediante un filtro. Esta aplicaci&oacute;n 
  tiene el nombre <span class="codefrag">jsp-sesion11-ranking</span>. Para ello tendremos una base de datos, 
  con una tabla <span class="codefrag">PAGINAS</span> en la que figurar&aacute;:</p>
<table class="ForrestTable" cellspacing="1" cellpadding="4">
  
<tr>
<th colspan="1" rowspan="1"></th><th colspan="1" rowspan="1"></th><th colspan="1" rowspan="1"></th>
</tr>  
  
<tr>
     
<td colspan="1" rowspan="1">
      <span class="codefrag">ruta </span><strong><span class="codefrag">varchar(255)</span></strong>
      </td>
     <td colspan="2" rowspan="1">Ruta de la p&aacute;gina visitada</td>
   
</tr>
   
<tr>
     
<td colspan="1" rowspan="1">
      <span class="codefrag">titulo </span><strong><span class="codefrag">varchar(100)</span></strong>
      </td>
     <td colspan="2" rowspan="1">T&iacute;tulo de la p&aacute;gina</td>
   
</tr>
   
<tr>
     
<td colspan="1" rowspan="1">
      <span class="codefrag">accesos </span><strong><span class="codefrag">integer</span></strong>
      </td>
     <td colspan="2" rowspan="1">N&uacute;mero de accesos realizados</td>
   
</tr> 

</table>
<p>El servlet <span class="codefrag">RankingPaginasServlet</span> nos genera un listado de las p&aacute;ginas 
  ordenadas por n&uacute;mero de visitas. </p>
<p>Lo primero que deberemos hacer ser&aacute; instalar la base de datos. El script 
  para la creaci&oacute;n de esta base de datos se encuentra en el directorio <span class="codefrag">db</span>. </p>
<p>Se pide:</p>
<p>
<em>a)</em> Desarrollar el filtro <span class="codefrag">AccesoPaginaFilter</span> que actue sobre
todos    los recursos est&aacute;ticos, y que contabilice el n&uacute;mero
de visitas    que se realiza a ellos almacenando esta informaci&oacute;n en la base de datos.
Deber&aacute; cumplir    las siguientes caracter&iacute;sticas:</p>
<ul>
   
<li>Cuando una p&aacute;gina sea visitada por primera vez, se deber&aacute;
     registrar una nueva entrada en la BD, con la URL de la p&aacute;gina visitada y el
     contador de visitas inicializado a <span class="codefrag">1</span>. Por el momento no 
     obtendremos el t&iacute;tulo de la p&aacute;gina, ya que para esto se requiere utilizar un
     <em>wrapper</em>, as&iacute; que en este campo introduciremos
     siempre el valor <em>(T&iacute;tulo desconocido)</em>.</li>
   
<li>Cuando la p&aacute;gina ya estuviese registrada en la BD, lo que haremos
     ser&aacute; incrementar el n&uacute;mero de visitas en 1.</li>
 
  
</ul>
<p>
<em>b)</em> Actualizar el filtro <span class="codefrag">AccesoPaginaFilter</span> para que obtenga el t&iacute;tulo
de la p&aacute;gina a la que se ha accedido, utilizando para ello el <em>wrapper</em> gen&eacute;rico
que se proporciona. Deber&aacute; cumplir    las siguientes caracter&iacute;sticas:</p>
<ul>
   
<li>S&oacute;lo registrar&aacute; los recursos cuyo contenido sea html
(tipo      de contenido <span class="codefrag">text/html</span>).</li>
   
<li>Cuando una p&aacute;gina sea visitada por primera vez, se deber&aacute;
     extraer su t&iacute;tulo de la etiqueta <span class="codefrag">&lt;title&gt;</span>, para
lo cual      deber&aacute; usarse un <em>wrapper</em>. En este caso insertaremos los
datos de la      p&aacute;gina en la BD anotando una visita.</li>
   
<li>Cuando la p&aacute;gina ya estuviese registrada en la BD, lo que haremos
     ser&aacute; incrementar el n&uacute;mero de visitas en 1.</li>
 
  
</ul>
<p>
<em>c)</em> Si la p&aacute;gina HTML est&aacute; almacenada en la cach&eacute;
del navegador,    el acceso no se contabilizar&aacute; correctamente. &iquest;Qu&eacute;
cabecera    HTTP podriamos utilizar para solucionar este problema? &iquest;Donde
podriamos    establecer esta cabecera? Establecer las cabeceras necesarias
para evitar el    uso de la cach&eacute; y comprobar el correcto funcionamiento
de la aplicaci&oacute;n.</p>
<div class="frame note">
<div class="label">Nota</div>
<div class="content">Para asegurarnos de que funciona correctamente con los diferentes navegadores, podemos 
incluir una serie de cabeceras destinadas a evitar que la p&aacute;gina se almacene en la cach&eacute;:<br>

<span class="codefrag">Cache-control: no-cache</span>
<br>

<span class="codefrag">Cache-control: no-store</span>
<br>

<span class="codefrag">Pragma: no-cache</span>
<br>

<span class="codefrag">Expires: 0</span>
</div>
</div>
</div>


<p class="pageBreakAfter"></p>
  

</div>
<div class="clearboth">&nbsp;</div>
</div>
<div id="footer">
<div class="lastmodified">
<script type="text/javascript"><!--
document.write("<text>Last Published:</text> " + document.lastModified);
//  --></script>
</div>
<div class="copyright">
        Copyright &copy;
         2006 Depto. CCIA</div>
</div>
</body>
</html>
