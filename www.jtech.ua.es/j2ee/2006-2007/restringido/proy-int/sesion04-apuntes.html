<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<META http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta content="Apache Forrest" name="Generator">
<meta name="Forrest-version" content="0.7">
<meta name="Forrest-skin-name" content="pelt">
<title>Aplicaci&oacute;n web con servlets y JSPs</title>
<link type="text/css" href="skin/basic.css" rel="stylesheet">
<link media="screen" type="text/css" href="skin/screen.css" rel="stylesheet">
<link media="print" type="text/css" href="skin/print.css" rel="stylesheet">
<link type="text/css" href="skin/profile.css" rel="stylesheet">
<script src="skin/getBlank.js" language="javascript" type="text/javascript"></script><script src="skin/getMenu.js" language="javascript" type="text/javascript"></script><script src="skin/fontsize.js" language="javascript" type="text/javascript"></script>
<link rel="shortcut icon" href="">
</head>
<body onload="init()">
<script type="text/javascript">ndeSetTextSize();</script>
<div id="top">
<div class="header">
<div class="grouplogo">
<a href="http://www.jtech.ua.es/j2ee"><img class="logoImage" alt="J2EE" src="images/baner_j2ee_izq.gif" title="Curso Especialista Universitario en Java Enterprise"></a>
</div>
<div class="projectlogoA1">
<a href="http://www.dccia.ua.es/"><img class="logoImage" alt="Proyecto de Integracion" src="images/baner_j2ee_der.gif" title="Proyecto de Integracion"></a>
</div>
<ul id="tabs">
<li>
<a class="base-not-selected" href="../index.html">M&oacute;dulos</a>
</li>
<li class="current">
<a class="base-selected" href="index.html">Proyecto de Integraci&oacute;n</a>
</li>
</ul>
</div>
</div>
<div id="main">
<div id="publishedStrip">
<div id="level2tabs"></div>
<script type="text/javascript"><!--
document.write("<text>Last Published:</text> " + document.lastModified);
//  --></script>
</div>
<div class="breadtrail">
             
             &nbsp;
           </div>
<div id="menu">
<div onclick="SwitchMenu('menu_selected_1.1', 'skin/')" id="menu_selected_1.1Title" class="menutitle" style="background-image: url('skin/images/chapter_open.gif');">Proyecto de Integraci&oacute;n</div>
<div id="menu_selected_1.1" class="selectedmenuitemgroup" style="display: block;">
<div class="menuitem">
<a href="index.html" title="Proyecto de Integraci&oacute;n">&Iacute;ndice</a>
</div>
<div onclick="SwitchMenu('menu_selected_1.1.2', 'skin/')" id="menu_selected_1.1.2Title" class="menutitle" style="background-image: url('skin/images/chapter_open.gif');">Teor&iacute;a</div>
<div id="menu_selected_1.1.2" class="selectedmenuitemgroup" style="display: block;">
<div class="menuitem">
<a href="sesion01-apuntes.html" title="Sesi&oacute;n 1: Caso de estudio">Sesi&oacute;n 1</a>
</div>
<div class="menuitem">
<a href="sesion02-apuntes.html" title="Sesi&oacute;n 2: DAO con JDBC">Sesi&oacute;n 2</a>
</div>
<div class="menuitem">
<a href="sesion03-apuntes.html" title="Sesi&oacute;n 3: Aplicaci&oacute;n web con servlets">Sesi&oacute;n 3</a>
</div>
<div class="menupage">
<div class="menupagetitle">Sesi&oacute;n 4</div>
</div>
<div class="menuitem">
<a href="sesion0506-apuntes.html" title="Sesiones 5 y 6: Aplicaci&oacute;n web con Struts">Sesi&oacute;n 5-6</a>
</div>
<div class="menuitem">
<a href="sesion07-apuntes.html" title="Sesi&oacute;n 7: Aplicaci&oacute;n web con Hibernate">Sesi&oacute;n 7</a>
</div>
<div class="menuitem">
<a href="sesion08-apuntes.html" title="Sesi&oacute;n 8: Proyecto web">Sesi&oacute;n 8</a>
</div>
<div class="menuitem">
<a href="sesion09-apuntes.html" title="Sesi&oacute;n 9: Spring">Sesi&oacute;n 9</a>
</div>
<div class="menuitem">
<a href="sesion10-apuntes.html" title="Sesi&oacute;n 10: Servidores de aplicaciones">Sesi&oacute;n 10</a>
</div>
<div class="menuitem">
<a href="sesion11-apuntes.html" title="Sesi&oacute;n 11: Componentes EJB">Sesi&oacute;n 11</a>
</div>
<div class="menuitem">
<a href="sesion12-apuntes.html" title="Sesi&oacute;n 12: Mensajes: JMS">Sesi&oacute;n 12</a>
</div>
<div class="menuitem">
<a href="sesion13-apuntes.html" title="Sesi&oacute;n 13: Servicios Web">Sesi&oacute;n 13</a>
</div>
<div class="menuitem">
<a href="sesion14-apuntes.html" title="Sesi&oacute;n 14: Proyecto Enterprise">Sesi&oacute;n 14</a>
</div>
</div>
</div>
<div id="credit"></div>
<div id="roundbottom">
<img style="display: none" class="corner" height="15" width="15" alt="" src="skin/images/rc-b-l-15-1body-2menu-3menu.png"></div>
<div id="credit2"></div>
</div>
<div id="content">
<div title="Portable Document Format" class="pdflink">
<a class="dida" href="sesion04-apuntes.pdf"><img alt="PDF -icon" src="skin/images/pdfdoc.gif" class="skin"><br>
        PDF</a>
</div>
<h1>Aplicaci&oacute;n web con servlets y JSPs</h1>
<div id="minitoc-area">
<ul class="minitoc">
<li>
<a href="#Introducci%C3%B3n">Introducci&oacute;n</a>
</li>
<li>
<a href="#Separaci%C3%B3n+en+servlets+y+JSPs">Separaci&oacute;n en servlets y JSPs</a>
</li>
<li>
<a href="#Control+de+acceso+a+los+usuarios">Control de acceso a los usuarios</a>
</li>
<li>
<a href="#Resumen">Resumen</a>
</li>
</ul>
</div>


<a name="N1000C"></a><a name="Introducci%C3%B3n"></a>
<h2 class="underlined_10">Introducci&oacute;n</h2>
<div class="section">
<p>En esta sesi&oacute;n de integraci&oacute;n vamos a refactorizar la aplicaci&oacute;n web din&aacute;mica desarrollada en la sesi&oacute;n anterior 
separando la presentaci&oacute;n (JSPs) del procesamiento (servlets). Adem&aacute;s, a&ntilde;adiremos las funcionalidades de 
<em>login</em> y <em>logout</em>, controlando los permisos de acceso de cada tipo de usuario a cada
funcionalidad de la web.</p>
</div>


<a name="N1001C"></a><a name="Separaci%C3%B3n+en+servlets+y+JSPs"></a>
<h2 class="underlined_10">Separaci&oacute;n en servlets y JSPs</h2>
<div class="section">
<p>En la sesi&oacute;n anterior implementamos una aplicaci&oacute;n web con una serie de servlets que se encargaban tanto
de procesar la informaci&oacute;n necesaria como de generar un documento HTML en el que se presenta el resultado
que se le mostrar&aacute; al usuario. Hemos visto que si bien los servlets son adecuados para procesar la informaci&oacute;n,
a la hora de generar la presentaci&oacute;n es m&aacute;s conveniente utilizar JSPs. El patr&oacute;n <em>Modelo-Vista-Controlador</em> 
(MVC) proporciona esta separaci&oacute;n, dejando la vista (presentaci&oacute;n) en los JSP separada del controlador y del
modelo, que estar&aacute;n implementados mediante servlets y otros componentes y clases Java. </p>
<p>En esta sesi&oacute;n vamos a refactorizar la aplicaci&oacute;n web separando la 
l&oacute;gica de negocio (modelo-controlador) y presentaci&oacute;n (vista), de forma que los servlets simplemente procesar&aacute;n la informaci&oacute;n necesaria,
y proporcionar&aacute;n el resultado de este procesamiento a un JSP que se encargar&aacute; de generar la presentaci&oacute;n
de dicho resultado.</p>
<table class="ForrestTable" cellspacing="1" cellpadding="4">

<tr>

<td colspan="1" rowspan="1"><img alt="Estructura de Proyecto" content-width="7cm" height="386" src="imagenes/s4/packexpl.gif" width="262"></td>
<td colspan="1" rowspan="1">
<p>Se deber&aacute;n implementar las siguientes p&aacute;ginas JSP:</p>

<ul>

<li>
<span class="codefrag">listadoUsuarios.jsp</span>: Recibe la lista de usuarios mediante el atributo <span class="codefrag">lista</span> en
el &aacute;mbito de la petici&oacute;n (<span class="codefrag">request</span>). Se mostrar&aacute;n todos los datos de cada usuario.</li>

<li>
<span class="codefrag">listadoLibros.jsp</span>: Recibe la lista de libros mediante el atributo <span class="codefrag">lista</span> en
el &aacute;mbito de la petici&oacute;n (<span class="codefrag">request</span>). De cada libro se mostrar&aacute; su nombre y su autor. El nombre
del libro ser&aacute; adem&aacute;s un enlace a la p&aacute;gina con todos los datos de dicho libro.</li>

<li>
<span class="codefrag">datosLibro.jsp</span>: Recibe los datos del libro mediante el atributo <span class="codefrag">libro</span> en
el &aacute;mbito de la petici&oacute;n (<span class="codefrag">request</span>). Se mostrar&aacute;n todos los datos de este libro.</li>

<li>
<span class="codefrag">error.jsp</span>: Utilizaremos esta p&aacute;gina para mostrar los errores que se puedan producir en la
aplicaci&oacute;n. Recibe el mensaje de error a mostrar mediante el atributo <span class="codefrag">error</span> en
el &aacute;mbito de la petici&oacute;n (<span class="codefrag">request</span>).</li>

</ul>

<div class="frame note">
<div class="label">Nota</div>
<div class="content">Las p&aacute;ginas <span class="codefrag">index.jsp</span>, <span class="codefrag">menu.jsp</span> y <span class="codefrag">pie.jspf</span> se 
realizar&aacute;n en el segundo apartado de esta sesi&oacute;n de integraci&oacute;n.</div>
</div>

</td>

</tr>

</table>
<p>Estos JSPs s&oacute;lo deber&aacute;n ser llamados desde los servlets de la aplicaci&oacute;n, nunca directamente desde el 
cliente. Para evitar que esto ocurra, los pondremos en un directorio protegido mediante seguridad declarativa
del servidor al que no tendr&aacute; permiso para acceder ning&uacute;n usuario. Este directorio se llamar&aacute; <span class="codefrag">jsp</span>
e impediremos el acceso a su contenido introduciendo las siguientes etiquetas en el descriptor de despliegue
(<span class="codefrag">web.xml</span>):</p>
<pre class="code">&lt;security-constraint&gt;
    &lt;web-resource-collection&gt;
        &lt;web-resource-name&gt;JSPs&lt;/web-resource-name&gt;
        &lt;url-pattern&gt;/jsp/*&lt;/url-pattern&gt;
    &lt;/web-resource-collection&gt;
    &lt;auth-constraint&gt;&lt;/auth-constraint&gt;
&lt;/security-constraint&gt;</pre>
<p>Dado que lo deseable es separar l&oacute;gica de negocio y presentaci&oacute;n, ser&aacute; conveniente evitar introducir
c&oacute;digo Java directamente en los JSPs (<em>scriptlets</em>) siempre que sea posible. Para ello utilizaremos
librer&iacute;as de <em>tags</em> como JSTL. Vamos a ver como ejemplo la implementaci&oacute;n de la funci&oacute;n de listar
libros (<span class="codefrag">listadoLibros.jsp</span>):</p>
<pre class="code">&lt;%@ page language="java" contentType="text/html; charset=ISO-8859-1"
    pageEncoding="ISO-8859-1" %&gt;
&lt;%@ taglib prefix="c" uri="http://java.sun.com/jsp/jstl/core" %&gt;
&lt;!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" 
    "http://www.w3.org/TR/html4/loose.dtd"&gt;
&lt;html&gt;
&lt;head&gt;
&lt;title&gt;Listado de libros&lt;/title&gt;
&lt;/head&gt;
&lt;body&gt;
&lt;h1&gt;Listado de libros&lt;/h1&gt;
&lt;ul&gt;
&lt;c:forEach var="libro" items="${requestScope.lista}"&gt;
  &lt;li&gt;&lt;a href="accionLibro?accion=seleccionar&amp;isbn=${libro.isbn}"&gt;
  ${libro.titulo}&lt;/a&gt;, &lt;em&gt;${libro.autor}&lt;/em&gt;&lt;/li&gt;
&lt;/c:forEach&gt;
&lt;/ul&gt;
&lt;/body&gt;
&lt;/html&gt;</pre>
<p>Para poder utilizar JSTL, deberemos descargar la <a class="external" href="http://jakarta.apache.org/site/downloads/downloads_taglibs-standard.cgi">librer&iacute;a de <em>tags Standard 1.1</em></a> de Jakarta y 
copiar los ficheros <span class="codefrag">jstl.jar</span> y <span class="codefrag">standard.jar</span> a la carpeta <span class="codefrag">/WEB-INF/lib</span> 
del proyecto web. </p>
<p>El aspecto de este listado ser&aacute; el siguiente:</p>
<p>
<img alt="P&aacute;gina del listado de libros" content-width="15cm" height="224" src="imagenes/s4/listado.gif" width="586"></p>
<div class="frame note">
<div class="label">Nota</div>
<div class="content">El pie de p&aacute;gina con las opciones <em>Volver al &iacute;ndice</em> y <em>Cerrar sesi&oacute;n</em> se
a&ntilde;adir&aacute; en el segundo apartado de esta sesi&oacute;n de integraci&oacute;n.</div>
</div>
<p>Para utilizar este JSP deberemos modificar el servlet <span class="codefrag">LibroServlet</span> implementado en la sesi&oacute;n anterior, de forma que
en lugar de generar &eacute;l mismo el HTML, redirija la petici&oacute;n al JSP proporcionando la lista de usuarios a
mostrar en el &aacute;mbito de la petici&oacute;n. Actualmente, la implementaci&oacute;n de la funci&oacute;n para la obtenci&oacute;n del 
listado de libros es como la siguiente:</p>
<pre class="code">private void listaLibros(HttpServletRequest request, HttpServletResponse response)
{
<strong>  String contenido = "";</strong>
  FactoriaDAOs fd = FactoriaDAOs.getInstance();
  ILibroDAO il = fd.getLibroDAO();
  List&lt;LibroTO&gt; lista = null;
  try
  {
    lista = il.getAllLibros();
    if (lista != null)
    {
<strong>      contenido = "&lt;ul&gt;";
      for (int i = 0; i &lt; lista.size(); i++)
      {
        LibroTO libro = lista.get(i);
        contenido += "&lt;li&gt;" + 
                     libro.getIsbn() + "-" + 
                     libro.getTitulo() + "-" + 
                     libro.getAutor() + "-" + 
                     libro.getNumPaginas() + " pags.&lt;/li&gt;";
      }
      contenido += "&lt;/ul&gt;";
      generaPagina(contenido, response);</strong>
      return;
    } else {
<strong>      generaPagina("&lt;h2&gt;No se encontraron resultados&lt;/h2&gt;", response);</strong>
    }
  } catch (Exception ex) {
<strong>    generaPagina("&lt;h2&gt;Error recuperando listado&lt;/h2&gt;", response);</strong>
    return;
  }	
}</pre>
<p>Para hacer que utilice el JSP que hemos descrito anteriormente deberemos hacer los siguientes cambios:</p>
<pre class="code">private void listaLibros(HttpServletRequest request, HttpServletResponse response) 
                             throws ServletException, IOException
{
  FactoriaDAOs fd = FactoriaDAOs.getInstance();
  ILibroDAO il = fd.getLibroDAO();
  List&lt;LibroTO&gt; lista = null;
  try
  {
    lista = il.getAllLibros();
    if (lista != null)
    {
<strong>      request.setAttribute("lista", lista);
      doForward(request, response, "/jsp/listadoLibros.jsp");</strong>
      return;
    } else {
<strong>      request.setAttribute("error", "No se encontraron resultados");
      doForward(request, response, "/jsp/error.jsp");</strong>
    }
  } catch (Exception ex) {
<strong>    request.setAttribute("error", "Error recuperando listado");
    doForward(request, response, "/jsp/error.jsp");</strong>
    return;
  }		
}

<strong>private void doForward(HttpServletRequest request, HttpServletResponse response, String path) 
                         throws ServletException, IOException {
  ServletContext sc = this.getServletContext();
  RequestDispatcher rd = sc.getRequestDispatcher(path);
  rd.forward(request, response);
}</strong>
</pre>
<p>Se deber&aacute; seguir este mismo esquema para las funcionalidades de obtener los datos de un libro 
(<span class="codefrag">datosLibro.jsp</span>) y de obtener el listado de usuarios (<span class="codefrag">listadoUsuarios.jsp</span>).</p>
<div class="frame note">
<div class="label">Nota</div>
<div class="content">Para estos JSP se puede utilizar un c&oacute;digo HTML similar al del ejemplo mostrado anteriormente
(<span class="codefrag">listadoLibros.jsp</span>), con una lista no ordenada (<span class="codefrag">&lt;ul&gt;&lt;li&gt;...&lt;/li&gt;&lt;/ul&gt;</span>) 
en la que se muestren los items o campos necesarios.</div>
</div>
</div>

<a name="N100FE"></a><a name="Control+de+acceso+a+los+usuarios"></a>
<h2 class="underlined_10">Control de acceso a los usuarios</h2>
<div class="section">
<p>Vamos a implementar el control de acceso de los usuarios a la aplicaci&oacute;n. A partir de ahora para acceder
a la aplicaci&oacute;n ser&aacute; necesario hacer <em>login</em> previamente. Seg&uacute;n el tipo de usuario que haya entrado,
la aplicaci&oacute;n deber&aacute; mostrar unas opciones u otras. Las opciones que se deber&aacute;n mostrar para cada uno de
estos tipos son:</p>
<ul>

<li>Administrador
<ul>

<li>Alta de usuarios</li>

<li>Baja de usuarios</li>

<li>Selecci&oacute;n de un usuario</li>

<li>Listado de usuarios</li>

</ul>
</li>

<li>Bibliotecario
<ul>

<li>Alta de libros</li>

<li>Baja de libros</li>

<li>Selecci&oacute;n de un libro</li>

<li>Listado de libros</li>

</ul>
</li>

<li>Registrados (Socios y profesores)
<ul>

<li>Selecci&oacute;n de un libro</li>

<li>Listado de libros</li>

<li>Realizaci&oacute;n de reservas</li>

</ul>
</li>

</ul>
<p>Se deber&aacute; impedir que los usuarios efect&uacute;en acciones para las cuales no tienen permiso.</p>
<p>Por ejemplo, la p&aacute;gina principal para los usuarios de tipo socio o profesor tendr&aacute; las siguientes opciones:</p>
<p>
<img alt="P&aacute;gina del men&uacute; de opciones" content-width="15cm" height="518" src="imagenes/s4/menu.gif" width="732"></p>
<p>Para identificar al usuario que ha entrado en la web introduciremos un objeto <span class="codefrag">UsuarioTO</span> 
como atributo <span class="codefrag">usuario</span> en el &aacute;mbito de la sesi&oacute;n, con los datos de dicho usuario. Si este 
atributo estuviese vac&iacute;o, se entender&aacute; que el usuario no ha hecho <em>login</em>.</p>
<p>Deberemos llevar el men&uacute; principal de acciones, que antes era p&uacute;blico en el &iacute;ndice de la web 
(<span class="codefrag">index.html</span>), a una p&aacute;gina privada a la que llamaremos <span class="codefrag">menu.jsp</span> que estar&aacute; 
ubicada dentro del directorio <span class="codefrag">jsp</span> creado anteriormente. Ahora, en lugar del anterior
<span class="codefrag">index.html</span>, como &iacute;ndice tendremos en el directorio ra&iacute;z de la web una p&aacute;gina JSP llamada 
<span class="codefrag">index.jsp</span> que contendr&aacute; el formulario de <em>login</em>.</p>
<ul>

<li>
<span class="codefrag">index.jsp</span>: Si ning&uacute;n usuario ha hecho <em>login</em> mostrar&aacute; el formulario de <em>login</em>
en el que se deber&aacute; introducir el <em>login</em> y <em>password</em>. En caso contrario nos redirigir&aacute; a la
p&aacute;gina <span class="codefrag">menu.jsp</span>. Si esta p&aacute;gina recibe un atributo <span class="codefrag">error</span> en el &aacute;mbito de la petici&oacute;n
deber&aacute; mostrar el mensaje de error correspondiente.</li>

<li>
<span class="codefrag">menu.jsp</span>: Nos mostrar&aacute; los formularios para realizar las acciones para las que tenga 
permiso el usuario que ha entrado en la web.</li>

</ul>
<p>
<img alt="P&aacute;gina de login" content-width="5cm" height="89" src="imagenes/s4/login.gif" width="162"></p>
<p>El formulario de <em>login</em> llamar&aacute; a un servlet <span class="codefrag">LoginServlet</span> que deberemos implementar.
Este servlet tomar&aacute; dos par&aacute;metros de entrada: <span class="codefrag">login</span> y <span class="codefrag">password</span>. Si dicho 
usuario existe, obtendr&aacute; sus datos de la BD mediante el DAO e insertar&aacute; el objeto <span class="codefrag">UsuarioTO</span>
correspondiente como atributo <span class="codefrag">usuario</span> de la sesi&oacute;n y redirigir&aacute; la respuesta a la p&aacute;gina
<span class="codefrag">menu.jsp</span>. En caso de que el usuario no sea correcto u
ocurra alg&uacute;n error en el acceso a la BD, redirigiremos la salida a <span class="codefrag">index.jsp</span> introduciendo
el mensaje de error correspondiente como atributo <span class="codefrag">error</span> en la petici&oacute;n.</p>
<p>A pesar de haber hecho que s&oacute;lo aparezcan en el men&uacute; las acciones para las que tengamos permiso, un usuario
podr&iacute;a introducir directamente en la barra de direcciones la URL para invocar una acci&oacute;n para la que no 
tenga permiso. Por ejemplo, podr&iacute;a introducir en el navegador una URL como la siguiente:</p>
<pre class="code">http://localhost:8080/proy-int/accionLibro?accion=eliminar&amp;isbn=0131401572</pre>
<p>Con esta URL cualquier usuario podr&iacute;a eliminar un libro aunque no fuese bibliotecario. 
Para evitar este problema, antes de realizar cada acci&oacute;n comprobaremos en el correspondiente
servlet si el usuario actual tiene permisos para realizarla. Esto lo haremos de la siguiente forma:</p>
<pre class="code">public void doGet(HttpServletRequest request, HttpServletResponse response)
                      throws ServletException, IOException 
{
  String parAccion = request.getParameter("accion");		
	
  if ("listar".equals(parAccion)) {
		
    // Listado de libros
    if(!compruebaPermisos(request, TipoUsuario.profesor) &amp;&amp; 
       !compruebaPermisos(request, TipoUsuario.socio) &amp;&amp; 
       !compruebaPermisos(request, TipoUsuario.bibliotecario)) {
      request.setAttribute("error", "Se necesita ser profesor, socio o " +
                       "bibliotecario para obtener el listado de libros");
      doForward(request, response, "/jsp/error.jsp");
    } else { 
      listaLibros(request, response);
    }
  } else if ("seleccionar".equals(parAccion)) {
    ...
}

private boolean compruebaPermisos(HttpServletRequest request, TipoUsuario tipo) {
  HttpSession sesion = request.getSession();
  UsuarioTO usuario = (UsuarioTO)sesion.getAttribute("usuario");
	
  if(usuario==null) {
    return false;
  } else {
    return usuario.getTipo()==tipo;
  }
}</pre>
<p>Por &uacute;ltimo, implementaremos un servlet <span class="codefrag">LogoutServlet</span> que establecer&aacute; el atributo 
<span class="codefrag">usuario</span> de la sesi&oacute;n a <span class="codefrag">null</span> y redirigir&aacute; la petici&oacute;n a <span class="codefrag">index.jsp</span>
para que nos vuelva a mostrar el formulario de <em>login</em>.</p>
<p>Haremos que todas las p&aacute;ginas de la web tengan en el pie un enlace para volver al &iacute;ndice y otro enlace para
cerrar la sesi&oacute;n (<em>logout</em>), en el caso de que el usuario hubiese hecho <em>login</em>. Dado que estos
enlaces deber&aacute;n aparecer en todas las p&aacute;ginas, definiremos un fragmento JSP llamado <span class="codefrag">pie.jspf</span>
dentro del directorio <span class="codefrag">jsp</span> para que pueda ser incluido como pie en todas las p&aacute;ginas.</p>
</div>


<a name="N101E1"></a><a name="Resumen"></a>
<h2 class="underlined_10">Resumen</h2>
<div class="section">
<p>En esta sesi&oacute;n se deber&aacute; entregar el espacio de trabajo del proyecto de integraci&oacute;n actualizando el 
proyecto web con los siguientes puntos:</p>
<ul>

<li>A&ntilde;adir la librer&iacute;a <span class="codefrag">jstl.jar</span> al directorio <span class="codefrag">WEB-INF/lib</span> del proyecto web.</li>

<li>Implementar los JSPs <span class="codefrag">listadoUsuarios.jsp</span>, <span class="codefrag">listadoLibros.jsp</span>, 
<span class="codefrag">datosLibro.jsp</span> y <span class="codefrag">error.jsp</span> en el directorio <span class="codefrag">jsp</span>.</li>

<li>A&ntilde;adir seguridad declarativa para impedir el acceso al directorio <span class="codefrag">jsp</span> desde el cliente.</li>

<li>Actualizar las acciones para listar usuarios (en <span class="codefrag">UsuarioServlet</span>), listar libros y 
seleccionar un libro (en <span class="codefrag">LibroServlet</span>) para que redirijan la petici&oacute;n a los JSPs anteriores.</li>

<li>Implementar el formulario de <em>login</em> en la p&aacute;gina <span class="codefrag">index.jsp</span> y los servlets
<span class="codefrag">LoginServlet</span> y <span class="codefrag">LogoutServlet</span>.</li>

<li>Eliminar el anterior &iacute;ndice <span class="codefrag">index.html</span> y llevar ese men&uacute; a la p&aacute;gina <span class="codefrag">menu.jsp</span>
que mostrar&aacute; s&oacute;lo las opciones para las que tiene permiso el usuario actual.</li>

<li>Actualizar los servlets realizados en la sesi&oacute;n anterior (<span class="codefrag">UsuarioServlet</span>, 
<span class="codefrag">LibroServlet</span> y <span class="codefrag">OperacionServlet</span>) para que comprueben los permisos del usuario a la hora
de realizar cada posible acci&oacute;n.</li>

<li>A&ntilde;adir un pie de p&aacute;gina com&uacute;n (<span class="codefrag">pie.jspf</span>) a todos los JSPs del sitio web con las opciones <em>Volver al &iacute;ndice</em> y
<em>Cerrar sesi&oacute;n</em>.</li>

</ul>
</div>


<p>El &aacute;rbol de navegaci&oacute;n de la web ser&aacute; el siguiente:</p>

<p>
<img alt="Mapa de la web" content-width="10cm" height="406" src="imagenes/s4/navegacion.gif" width="500"></p>


<p>En el diagrama anterior podemos observar la estructura del sitio web desde el punto de vista del cliente. Sin
embargo, si prestamos atenci&oacute;n a los componentes y a las llamadas que se realizan entre ellos de forma interna en el 
servidor, tendremos un diagrama como el siguiente:</p>

<p>
<img alt="Llamadas entre los componentes del servidor" content-width="10cm" height="359" src="imagenes/s4/componentes.gif" width="500"></p>


<p class="pageBreakAfter"></p>


</div>
<div class="clearboth">&nbsp;</div>
</div>
<div id="footer">
<div class="lastmodified">
<script type="text/javascript"><!--
document.write("<text>Last Published:</text> " + document.lastModified);
//  --></script>
</div>
<div class="copyright">
        Copyright &copy;
         2006-2007 Depto. CCIA</div>
</div>
</body>
</html>
