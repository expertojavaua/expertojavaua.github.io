<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<META http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta content="Apache Forrest" name="Generator">
<meta name="Forrest-version" content="0.7">
<meta name="Forrest-skin-name" content="pelt">
<title>Aplicaci&oacute;n web con Struts</title>
<link type="text/css" href="skin/basic.css" rel="stylesheet">
<link media="screen" type="text/css" href="skin/screen.css" rel="stylesheet">
<link media="print" type="text/css" href="skin/print.css" rel="stylesheet">
<link type="text/css" href="skin/profile.css" rel="stylesheet">
<script src="skin/getBlank.js" language="javascript" type="text/javascript"></script><script src="skin/getMenu.js" language="javascript" type="text/javascript"></script><script src="skin/fontsize.js" language="javascript" type="text/javascript"></script>
<link rel="shortcut icon" href="">
</head>
<body onload="init()">
<script type="text/javascript">ndeSetTextSize();</script>
<div id="top">
<div class="header">
<div class="grouplogo">
<a href="http://www.jtech.ua.es/j2ee"><img class="logoImage" alt="J2EE" src="images/baner_j2ee_izq.gif" title="Curso Especialista Universitario en Java Enterprise"></a>
</div>
<div class="projectlogoA1">
<a href="http://www.dccia.ua.es/"><img class="logoImage" alt="Proyecto de Integracion" src="images/baner_j2ee_der.gif" title="Proyecto de Integracion"></a>
</div>
<ul id="tabs">
<li>
<a class="base-not-selected" href="../index.html">M&oacute;dulos</a>
</li>
<li class="current">
<a class="base-selected" href="index.html">Proyecto de Integraci&oacute;n</a>
</li>
</ul>
</div>
</div>
<div id="main">
<div id="publishedStrip">
<div id="level2tabs"></div>
<script type="text/javascript"><!--
document.write("<text>Last Published:</text> " + document.lastModified);
//  --></script>
</div>
<div class="breadtrail">
             
             &nbsp;
           </div>
<div id="menu">
<div onclick="SwitchMenu('menu_selected_1.1', 'skin/')" id="menu_selected_1.1Title" class="menutitle" style="background-image: url('skin/images/chapter_open.gif');">Proyecto de Integraci&oacute;n</div>
<div id="menu_selected_1.1" class="selectedmenuitemgroup" style="display: block;">
<div class="menuitem">
<a href="index.html" title="Proyecto de Integraci&oacute;n">&Iacute;ndice</a>
</div>
<div onclick="SwitchMenu('menu_selected_1.1.2', 'skin/')" id="menu_selected_1.1.2Title" class="menutitle" style="background-image: url('skin/images/chapter_open.gif');">Teor&iacute;a</div>
<div id="menu_selected_1.1.2" class="selectedmenuitemgroup" style="display: block;">
<div class="menuitem">
<a href="sesion01-apuntes.html" title="Sesi&oacute;n 1: Caso de estudio">Sesi&oacute;n 1</a>
</div>
<div class="menuitem">
<a href="sesion02-apuntes.html" title="Sesi&oacute;n 2: DAO con JDBC">Sesi&oacute;n 2</a>
</div>
<div class="menuitem">
<a href="sesion03-apuntes.html" title="Sesi&oacute;n 3: Aplicaci&oacute;n web con servlets">Sesi&oacute;n 3</a>
</div>
<div class="menuitem">
<a href="sesion04-apuntes.html" title="Sesi&oacute;n 4: Aplicaci&oacute;n web con servlets y JSPs">Sesi&oacute;n 4</a>
</div>
<div class="menupage">
<div class="menupagetitle">Sesi&oacute;n 5-6</div>
</div>
<div class="menuitem">
<a href="sesion07-apuntes.html" title="Sesi&oacute;n 7: Aplicaci&oacute;n web con Hibernate">Sesi&oacute;n 7</a>
</div>
<div class="menuitem">
<a href="sesion08-apuntes.html" title="Sesi&oacute;n 8: Proyecto web">Sesi&oacute;n 8</a>
</div>
<div class="menuitem">
<a href="sesion09-apuntes.html" title="Sesi&oacute;n 9: Spring">Sesi&oacute;n 9</a>
</div>
<div class="menuitem">
<a href="sesion10-apuntes.html" title="Sesi&oacute;n 10: Servidores de aplicaciones">Sesi&oacute;n 10</a>
</div>
<div class="menuitem">
<a href="sesion11-apuntes.html" title="Sesi&oacute;n 11: Componentes EJB">Sesi&oacute;n 11</a>
</div>
<div class="menuitem">
<a href="sesion12-apuntes.html" title="Sesi&oacute;n 12: Mensajes: JMS">Sesi&oacute;n 12</a>
</div>
<div class="menuitem">
<a href="sesion13-apuntes.html" title="Sesi&oacute;n 13: Servicios Web">Sesi&oacute;n 13</a>
</div>
<div class="menuitem">
<a href="sesion14-apuntes.html" title="Sesi&oacute;n 14: Proyecto Enterprise">Sesi&oacute;n 14</a>
</div>
</div>
</div>
<div id="credit"></div>
<div id="roundbottom">
<img style="display: none" class="corner" height="15" width="15" alt="" src="skin/images/rc-b-l-15-1body-2menu-3menu.png"></div>
<div id="credit2"></div>
</div>
<div id="content">
<div title="Portable Document Format" class="pdflink">
<a class="dida" href="sesion0506-apuntes.pdf"><img alt="PDF -icon" src="skin/images/pdfdoc.gif" class="skin"><br>
        PDF</a>
</div>
<h1>Aplicaci&oacute;n web con Struts</h1>
<div id="minitoc-area">
<ul class="minitoc">
<li>
<a href="#Introducci%C3%B3n">Introducci&oacute;n</a>
</li>
<li>
<a href="#Conversi%C3%B3n+del+proyecto+para+uso+de+Struts">Conversi&oacute;n del proyecto para uso de Struts</a>
</li>
<li>
<a href="#Refactorizaci%C3%B3n+del+c%C3%B3digo">Refactorizaci&oacute;n del c&oacute;digo</a>
</li>
<li>
<a href="#%22Pistas%22+de+implementaci%C3%B3n">"Pistas" de implementaci&oacute;n</a>
</li>
<li>
<a href="#Entrega">Entrega</a>
</li>
</ul>
</div>


<a name="N1000C"></a><a name="Introducci%C3%B3n"></a>
<h2 class="underlined_10">Introducci&oacute;n</h2>
<div class="section">
<p>En esta sesi&oacute;n de integraci&oacute;n no vamos a implementar funcionalidades nuevas, vamos a refactorizar la aplicaci&oacute;n web usando Struts. 
Cambiaremos por tanto a una arquitectura MVC, que ya se ha ido preparando gradualmente 
en los dos proyectos anteriores.</p>
</div>


<a name="N10016"></a><a name="Conversi%C3%B3n+del+proyecto+para+uso+de+Struts"></a>
<h2 class="underlined_10">Conversi&oacute;n del proyecto para uso de Struts</h2>
<div class="section">
<p>Antes de empezar a refactorizar el c&oacute;digo, hay que importar las librer&iacute;as de Struts y crear
los ficheros de configuraci&oacute;n. Seguir estos pasos:</p>
<ol>

<li>
<strong>Copiad a la carpeta <span class="codefrag">WEB-INF/lib</span> los .jar </strong>necesarios:
<ul>

<li>Jars para Struts 1.2 <a href="recursos/struts1.2-jars.zip"> comprimidos en .zip</a>. Son los
incluidos en la distribuci&oacute;n est&aacute;ndar de Struts m&aacute;s la librer&iacute;a struts-el, por si quer&eacute;is usar
el lenguaje de expresiones en las etiquetas de Struts. Commons-logging no se incluye porque
ya lo ten&eacute;is en el proyecto, aunque es necesario para poder usar Struts.</li>

<li>Jars para StrutsTestCase <a href="recursos/strutsTestCase-jars.zip"> comprimidos en .zip</a>. Muchos no
se incluyen aqu&iacute; porque ya los ten&eacute;is en el proyecto web o bien en el com&uacute;n (como el servlet.jar).
Consultad la documentaci&oacute;n de StrutsTestCase sobre las librer&iacute;as necesarias si en otro momento necesit&aacute;is hacer
otro proyecto distinto. </li>

</ul>

</li>

<li>
<strong>Cread el struts-config.xml</strong>. Os valdr&aacute; por ejemplo el que hab&eacute;is usado en los ejercicios de Struts, eliminando
los <span class="codefrag">&lt;action&gt;</span> y  <span class="codefrag">&lt;form-bean&gt;</span> (ActionForms) que hay&aacute;is creado en los ejercicios.</li>

<li>
<strong>Modificad el web.xml para usar el servlet de Struts</strong>. Los <span class="codefrag">&lt;servlet&gt;</span>
y <span class="codefrag">&lt;servlet-mapping&gt;</span> que tiene actualmente el web.xml del proyecto de integraci&oacute;n
ya no son necesarios. Pod&eacute;is eliminarlos o mejor dejarlos comentados. Ahora todas las 
peticiones acabadas en .do deben llegar al servlet de Struts. Por ello <strong>necesit&aacute;is a&ntilde;adir un <span class="codefrag">&lt;servlet&gt;</span>.
y un <span class="codefrag">&lt;servlet-mapping&gt;</span> para hacer el mapeo</strong>. Pod&eacute;is copiarlo del web.xml que us&aacute;bais en los ejercicios de Struts</li>

<li>
<strong>Cread un fichero <span class="codefrag">mensajes.properties</span></strong> por el momento vac&iacute;o en la carpeta "resources". Tened en cuenta
que este fichero se referencia dentro del struts-config.xml. Comprobad que est&aacute; bien referenciado
por la etiqueta <span class="codefrag">&lt;message-resources parameter="mensajes"/&gt;</span>. </li>

<li>
<strong>
  Para que funcione correctamente Cactus</strong>, que es la capa por debajo de StrutsTestCase
  <ul>
  	
<li>Copiar el fichero <a href="recursos/cactus.properties.txt">cactus.properties</a> a la carpeta "resources". Contiene informaci&oacute;n
  	sobre la URL a la que hay que acceder para hacer las pruebas. Cactus incorpora
  	un servlet que recibe las peticiones de pruebas, ejecuta la aplicaci&oacute;n web y devuelve
  	los resultados.</li>
  	
<li>Incluir en el web.xml de la aplicaci&oacute;n las etiquetas para que se inicialice el 
  	servlet que recibe las peticiones de pruebas.
  	<pre class="code">
&lt;!-- Cactus Servlet Redirector configuration --&gt;
&lt;servlet&gt;
     &lt;servlet-name&gt;ServletRedirector&lt;/servlet-name&gt;
     &lt;servlet-class&gt;org.apache.cactus.server.ServletTestRedirector&lt;/servlet-class&gt;
&lt;/servlet&gt;

&lt;!-- Cactus Servlet Redirector URL mapping --&gt;
&lt;servlet-mapping&gt;
    &lt;servlet-name&gt;ServletRedirector&lt;/servlet-name&gt;
    &lt;url-pattern&gt;/ServletRedirector&lt;/url-pattern&gt;
&lt;/servlet-mapping&gt;
  	</pre>
  	
</li>
  
</ul>

</li>

<li>
<strong>Comprobad que Struts est&aacute; funcionando correctamente</strong> (no estrictamente necesario, pero RECOMENDADO). 
<ul>
 
<li>Cread una clase llamada
<span class="codefrag">AccionDePrueba</span> (aqu&iacute; ten&eacute;is <a href="recursos/AccionDePrueba.java.txt">el c&oacute;digo</a>) 
en el paquete <span class="codefrag">es.ua.jtech.proyint.presentacion.acciones</span>

</li>

<li>Copiad la p&aacute;gina <a href="recursos/prueba.jsp.html">prueba.jsp</a> a la carpeta "WebContent"</li>

<li>Cread el siguiente mapeo en el <span class="codefrag">struts-config.xml</span>

<pre class="code">
&lt;action path="/prueba" type="es.ua.jtech.proyint.presentacion.acciones.AccionDePrueba"&gt;
	&lt;forward name="OK" path="/prueba.jsp"/&gt;
&lt;/action&gt;
</pre>

</li>

<li>Arrancad el servidor y acceded a http://localhost:8080/proyint/prueba.do</li>

</ul>

</li>

<li>
<strong>Comprobad que StrutsTestCase funciona correctamente</strong> (no estrictamente necesario, pero RECOMENDADO)
<ul>
 
<li>Cread una clase llamada
<span class="codefrag">PruebaTest</span> (aqu&iacute; ten&eacute;is <a href="recursos/PruebaTest.java.txt">el c&oacute;digo</a>) 
en el paquete <span class="codefrag">es.ua.jtech.proyint.presentacion.acciones</span>, <strong>pero en
la carpeta de fuentes "test"</strong>
</li>

<li>Ejecutad el test sobre la clase como si fuera de JUnit. Deber&iacute;a ser correcto.</li>


</ul>

</li>

</ol>
</div>

<a name="N100BE"></a><a name="Refactorizaci%C3%B3n+del+c%C3%B3digo"></a>
<h2 class="underlined_10">Refactorizaci&oacute;n del c&oacute;digo</h2>
<div class="section"></div>

<p>Vamos a refactorizar el c&oacute;digo de los servlets en acciones de Struts. Adem&aacute;s introduciremos
ActionForms y validaci&oacute;n autom&aacute;tica. <strong>Se recomienda hacer esto en varias pasadas</strong>,es decir, primero
convertir un servlet (o parte de &eacute;l) en una acci&oacute;n y una vez estemos seguros de que funciona 
introducir el ActionForm y las etiquetas de Struts. Hacerlo todo a la vez incrementa mucho la posibilidad de
cometer errores.</p>

<p>Veremos c&oacute;mo hacer esto para el caso del login en la aplicaci&oacute;n. El resto deb&eacute;is hacerlo
por vuestra cuenta.</p>

<ol>

<li>
<strong>Introducir acciones de Struts</strong>

<ol>

<li>
<strong>Crear la clase de prueba</strong> Hacer esto lo primero ser&iacute;a lo recomendado en una metodolog&iacute;a de 
desarrollo dirigida por las pruebas. Aunque habr&iacute;a que probar m&aacute;s casos, por brevedad vamos a poner
aqu&iacute; solo el test para login correcto:
<pre class="code">
package es.ua.jtech.proyint.presentacion.acciones;

import servletunit.struts.CactusStrutsTestCase;

public class AccionLoginTest extends CactusStrutsTestCase {
	public void testLoginOK() {
		setRequestPathInfo("/accionLogin");
		addRequestParameter("login", "otto");
		addRequestParameter("password", "colomina");
		actionPerform();
		verifyForward("OK");
	}
	
}
</pre>

</li>

<li>

<strong>Convertir un servlet en una o varias acciones</strong>. Algunos servlets, como <span class="codefrag">LoginServlet</span>,
 dar&aacute;n lugar a una sola acci&oacute;n, mientras que otros,como <span class="codefrag">LibroServlet</span> dar&aacute;n lugar
  a varias (en el caso comentado a cuatro: para borrar, insertar, seleccionar y listar libros).
  Se recomienda colocar las acciones en cuatro <em>packages</em> distintos
 <span class="codefrag">es.ua.jtech.proyint.servlet.accion.xxx</span>, donde <em>xxx</em> ser&aacute; <span class="codefrag">libro</span>,
 <span class="codefrag">loginlogout</span>, <span class="codefrag">operacion</span> y <span class="codefrag">usuario</span>. Habr&aacute; que
 cambiar los <span class="codefrag">doForward</span> que ahora ten&eacute;is en el c&oacute;digo por <span class="codefrag">mapping.findForward</span> de Struts.
 <p>Aqu&iacute; tenemos el c&oacute;digo original, de la clase <span class="codefrag">LoginServlet</span>. Nos interesa la parte en negrita:</p>
 
<pre class="code">
 public class LoginServlet extends javax.servlet.http.HttpServlet implements javax.servlet.Servlet {

	private static final long serialVersionUID = -1859584491132060195L;
	<strong>private static Log logger = LogFactory.getLog(LoginServlet.class.getName());</strong>

	public LoginServlet() {
		super();
	}   	
	
	protected void doGet(HttpServletRequest request, HttpServletResponse response) throws ServletException, IOException {
		<strong>String login = request.getParameter("login");
		String password = request.getParameter("password");

		HttpSession sesion = request.getSession();
		
		FactoriaDAOs fd = FactoriaDAOs.getInstance();
		IUsuarioDAO iu = fd.getUsuarioDAO();
		try {
			UsuarioTO usuario = iu.selectUsuario(login, password);
			if(usuario!=null) {
				sesion.setAttribute("usuario", usuario);
				doForward(request, response, "/jsp/menu.jsp");
			} else {
				request.setAttribute("error", "El login y/o password no son correctos");
				doForward(request, response, "/index.jsp");				
			}
		} catch (Exception e) {
			logger.error("Login - " + request.getParameter("login") + " - Error haciendo login");
			request.setAttribute("error", "Error al hacer login");
			doForward(request, response, "/index.jsp");
		}
		</strong>
	}  	
	<em>//Contin&uacute;a,pero el resto no nos interesa...</em>
 
</pre>
 
<p>Podemos reutilizar el c&oacute;digo casi tal cual, simplemente cambiando los <span class="codefrag">doForward</span>
 que apuntan a JSP por <span class="codefrag">return mapping.findForward</span> que devuelvan
 nombres simb&oacute;licos (como "OK", "error", "BadLogin",...). Los nombres de los JSP saldr&aacute;n
 en el <span class="codefrag">struts-config.xml</span>
</p>
 
<pre class="code">
 
<strong>//No ponemos los import para ahorrar espacio</strong>
 public class AccionLogin extends Action {
	private static Log logger = LogFactory.getLog(LoginServlet.class.getName());
	@Override
	public ActionForward execute(ActionMapping mapping, ActionForm form, 
				HttpServletRequest request, HttpServletResponse res) throws Exception {
		

		String login = request.getParameter("login");
		String password = request.getParameter("password");

		HttpSession sesion = request.getSession();
		
		FactoriaDAOs fd = FactoriaDAOs.getInstance();
		IUsuarioDAO iu = fd.getUsuarioDAO();
		try {
			UsuarioTO usuario = iu.selectUsuario(login, password);
			if(usuario!=null) {
				sesion.setAttribute("usuario", usuario);
				           <strong>return mapping.findForward("OK");</strong>
			} else {
				request.setAttribute("error", "El login y/o password no son correctos");
				           <strong>return mapping.findForward("error");</strong>
			}
		} catch (Exception e) {
			logger.error("Login - " + request.getParameter("login") + " - Error haciendo login");
			request.setAttribute("error", "Error al hacer login");
			        <strong>return mapping.findForward("error");</strong>
		}

	}

}
 </pre>
 
</li>
 
<li>
<strong>Realizar el mapeo entre la acci&oacute;n y la URL</strong> en el <span class="codefrag">struts-config.xml</span>. Siguiendo con el caso
 del login, ser&iacute;a: (fijaos en que hemos cogido los nombres de los JSPs que aparec&iacute;an
 en los antiguos doForward del servlet).
 <pre class="code">
 &lt;action path="/accionLogin" type="es.ua.jtech.proyint.presentacion.acciones.AccionLogin"&gt;
 	&lt;forward name="OK" path="/jsp/menu.jsp"/&gt;
 	&lt;forward name="error" path="/index.jsp"/&gt;
 &lt;/action&gt;
 </pre>
 
</li>
 
<li>
<strong>Ejecutar la prueba con StrutsTestCase</strong>: si todo va bien y la prueba
 cubre todos los casos, ya sabemos que la acci&oacute;n funciona. Solo nos falta...</li>
 
<li>
<strong>Cambiar la URL que disparaba el servlet para que ahora siga el formato <span class="codefrag">*.do</span></strong>. Buscar el
 formulario o enlace que llamaba al servlet y cambiar el atributo <span class="codefrag">action</span> 
 o <span class="codefrag">href</span>, respectivamente.
 <p>En el caso de la acci&oacute;n de login, el formulario est&aacute; en index.jsp. Cambiamos el action para
 que apunte a <strong>accionLogin.do</strong>
</p>
 
</li>
 
<li>
<strong>Probar la acci&oacute;n con el interfaz web:</strong> en el navegador abrimos index.jsp
 y comprobamos que se puede entrar con login y password correctos. Si lo has conseguido...
 &iexcl;Enhorabuena! (en estos casos se suele levantar el pu&ntilde;o derecho instintivamente en se&ntilde;al
 de triunfo).</li>
 
</ol>

</li> 

<li>
<strong>Gestionar los errores con <span class="codefrag">ActionMessages</span></strong> de Struts. Donde
ahora en vuestro c&oacute;digo se guardan los errores como atributos de la petici&oacute;n (con 
<span class="codefrag">request.setAttribute("error", "mensaje_de_error")</span>) hay que pasar a usar <span class="codefrag">ActionMessages</span>. Para
poder mostrar los errores en los JSP, usar la etiqueta <span class="codefrag">&lt;html:messages&gt;</span>
de la taglib HTML de Struts, en lugar de mostrar el valor de la variable <span class="codefrag">error</span>
con &aacute;mbito en la petici&oacute;n, como hac&eacute;is ahora.</li>

<li>
<strong>Introducir ActionForms</strong>

<ol>

<li>Crear la clase Java del ActionForm (por ejemplo <span class="codefrag">es.ua.jtech.proyint.presentacion.actionforms.LoginForm</span>). Si hace falta validar datos (fechas, n&uacute;meros, campos
requeridos, etc). Se recomienda que us&eacute;is el plugin validator y por tanto hered&eacute;is de ValidatorForm.
En caso contrario pod&eacute;is heredar de ActionForm.</li>

<li>Poner el nombre simb&oacute;lico del ActionForm y el nombre completo de la clase asociada
en la secci&oacute;n <span class="codefrag">&lt;form-beans&gt;</span> del <span class="codefrag">struts-config.xml</span>.</li>

<li>Tambi&eacute;n en el <span class="codefrag">struts-config.xml</span>, asociar el ActionForm con la acci&oacute;n  a trav&eacute;s de los atributos "name", "validate" e
"input".</li>

<li>Cambiar los request.getParameter por sentencias que saquen los datos del ActionForm. En el caso del login ser&iacute;a
algo como
<pre class="code">
public class AccionLogin extends Action {
	private static Log logger = LogFactory.getLog(LoginServlet.class.getName());
	@Override
	public ActionForward execute(ActionMapping mapping, ActionForm form, 
				HttpServletRequest request, HttpServletResponse res) throws Exception {
			...
				<strong>LoginForm lf = (LoginForm)form;
			String login = lf.getLogin();
			String password = lf.getPassword();
			...</strong>

</pre>

</li>

</ol>


</li>

<li>
<strong>Introducir la validaci&oacute;n autom&aacute;tica</strong> usando validator en los
formularios que la requieran</li>

<li>
<strong>Introducir las etiquetas de la taglib HTML de Struts</strong>
</li>

</ol>

<a name="N101A2"></a><a name="%22Pistas%22+de+implementaci%C3%B3n"></a>
<h2 class="underlined_10">"Pistas" de implementaci&oacute;n</h2>
<div class="section">
<p>Aunque la refactorizaci&oacute;n es bastante directa,el paso de servlets a acciones de Struts
exigir&aacute; hacer algunos cambios. A continuaci&oacute;n algunas "pistas" sobre c&oacute;mo hacerlos</p>
<ul>

<li>Se recomienda crear una clase <span class="codefrag">es.ua.jtech.proyint.presentacion.acciones.AccionComun</span>
en la que se define la variable <span class="codefrag">logger</span> y el m&eacute;todo <span class="codefrag">compruebaPermisos</span>,
ambos usados por el resto de acciones, que <strong>heredar&aacute;n de <span class="codefrag">AccionComun</span></strong>
</li>

<li>En general un solo servlet dar&aacute; lugar a varias acciones. El par&aacute;metro "accion"
que el servlet usaba para distinguir la operaci&oacute;n a efectuar es ahora redundante y habr&aacute; que
eliminar las apariciones tanto en el c&oacute;digo Java como en los formularios de los JSP.</li>

<li>Algunos servlets usan un m&eacute;todo <span class="codefrag">generaPagina</span> para producir p&aacute;ginas de error o
de resultado de una operaci&oacute;n "sobre la marcha". Esto en Struts no es lo adecuado, es mejor saltar
desde la acci&oacute;n a una p&aacute;gina ya creada. Por tanto, todas las referencias a este m&eacute;todo deben desaparecer
y se sustituir&aacute;n por saltos a JSPs ya creados (la p&aacute;gina <span class="codefrag">error.jsp</span>
o una nueva p&aacute;gina <span class="codefrag">realizada.jsp</span>).</li>

<li>En el formulario de reserva de libro, no tiene mucho sentido que se pueda y deba meter login
y password de usuario. Cambiar el c&oacute;digo para que tome estos datos de los que hay en la sesi&oacute;n,
y el JSP para que no aparezca en el formulario.</li>

</ul>
</div>

<a name="N101D1"></a><a name="Entrega"></a>
<h2 class="underlined_10">Entrega</h2>
<div class="section">
<p></p>
<table class="ForrestTable" cellspacing="1" cellpadding="4">

<caption>Clases, recursos y JSPs a entregar</caption>

<tr>

<td colspan="1" rowspan="1">
  <img alt="Clases y recursos Java a entregar" content-width="7cm" src="imagenes/s56/entregajava.jpg">
</td>
<td colspan="1" rowspan="1">

<p>Aclaraciones:</p>

<ul>

<li>Crear al menos casos de prueba para la acci&oacute;n de login. <strong>Como optativo</strong> queda
el crear pruebas para el resto de acciones.</li>

<li>Tambi&eacute;n <strong>como optativo</strong> queda el cambiar los <span class="codefrag">request.setAttribute("error",...</span>
por el uso de <span class="codefrag">ActionErrors</span>
</li>

<li>Hay que crear al menos los<strong> ActionForms</strong> <span class="codefrag">AltaLibroForm</span>,
 <span class="codefrag">AltaUsuarioForm</span> y <span class="codefrag">ReservaForm</span>, con los datos asociados a los formularios
 de alta de libro, de usuario y de reserva de libro, respectivamente. La validaci&oacute;n se debe
 hacer con el <strong>plugin validator</strong>, y se debe validar, al menos:
 <ul>
 
<li>En <span class="codefrag">AltaUsuarioForm</span>: que login y password no son vac&iacute;os y que el email es una direcci&oacute;n
 con formato v&aacute;lido.</li>
 
<li>En <span class="codefrag">AltaLibroForm</span>: que todos los campos tienen contenido y que el n&uacute;mero
 de p&aacute;ginas es un entero</li>
 
<li>En <span class="codefrag">ReservaForm</span>: que todos los campos tienen contenido y que las fechas
 cumplen el formato dd/mm/aaaa (dd/MM/yyyy en Java).</li>
 
<li>
<strong>De forma optativa</strong> se pueden crear ActionForms asociados al resto de formularios.</li>
 
<li>El archivo <span class="codefrag">mensajes.properties</span> contiene los mensajes de error para el
 <strong>plugin validator</strong>, y en su caso para los <span class="codefrag">ActionErrors</span> que us&eacute;is (optativo)</li>
 
</ul>

</li>

</ul>

</td>

</tr>

<tr>

<td colspan="1" rowspan="1">
  <img alt="Fich. de configuraci&oacute;n y JSPs a entregar" content-width="5cm" src="imagenes/s56/entregajsp.jpg">
</td>
<td colspan="1" rowspan="1">

<p>Aclaraciones:</p>

<ul>

<li>En la p&aacute;gina <span class="codefrag">menu.jsp</span> hay que cambiar los formularios HTML relacionados
con los ActionForms para usar <strong>la taglib HTML de Struts</strong>.</li>

<li>La p&aacute;gina <span class="codefrag">realizada.jsp</span> sustituye al JSP generado "sobre la marcha" por el 
m&eacute;todo <span class="codefrag">generaPagina</span> que usaba el servlet, para el caso en que se muestra
el resultado de una operaci&oacute;n.</li>


<li>Recordad que al usar el <strong>Plugin validator</strong> necesitamos crear el <span class="codefrag">validation.xml</span>.El
<span class="codefrag">validator-rules.xml</span> pod&eacute;is tomarlo de otro proyecto de Struts.</li>

</ul>

</td>

</tr>

</table>
</div>

<p class="pageBreakAfter"></p>


</div>
<div class="clearboth">&nbsp;</div>
</div>
<div id="footer">
<div class="lastmodified">
<script type="text/javascript"><!--
document.write("<text>Last Published:</text> " + document.lastModified);
//  --></script>
</div>
<div class="copyright">
        Copyright &copy;
         2006-2007 Depto. CCIA</div>
</div>
</body>
</html>
