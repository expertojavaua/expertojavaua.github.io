<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<META http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta content="Apache Forrest" name="Generator">
<meta name="Forrest-version" content="0.7">
<meta name="Forrest-skin-name" content="pelt">
<title>Aplicaci&oacute;n web con Hibernate</title>
<link type="text/css" href="skin/basic.css" rel="stylesheet">
<link media="screen" type="text/css" href="skin/screen.css" rel="stylesheet">
<link media="print" type="text/css" href="skin/print.css" rel="stylesheet">
<link type="text/css" href="skin/profile.css" rel="stylesheet">
<script src="skin/getBlank.js" language="javascript" type="text/javascript"></script><script src="skin/getMenu.js" language="javascript" type="text/javascript"></script><script src="skin/fontsize.js" language="javascript" type="text/javascript"></script>
<link rel="shortcut icon" href="">
</head>
<body onload="init()">
<script type="text/javascript">ndeSetTextSize();</script>
<div id="top">
<div class="header">
<div class="grouplogo">
<a href="http://www.jtech.ua.es/j2ee"><img class="logoImage" alt="J2EE" src="images/baner_j2ee_izq.gif" title="Curso Especialista Universitario en Java Enterprise"></a>
</div>
<div class="projectlogoA1">
<a href="http://www.dccia.ua.es/"><img class="logoImage" alt="Proyecto de Integracion" src="images/baner_j2ee_der.gif" title="Proyecto de Integracion"></a>
</div>
<ul id="tabs">
<li>
<a class="base-not-selected" href="../index.html">M&oacute;dulos</a>
</li>
<li class="current">
<a class="base-selected" href="index.html">Proyecto de Integraci&oacute;n</a>
</li>
</ul>
</div>
</div>
<div id="main">
<div id="publishedStrip">
<div id="level2tabs"></div>
<script type="text/javascript"><!--
document.write("<text>Last Published:</text> " + document.lastModified);
//  --></script>
</div>
<div class="breadtrail">
             
             &nbsp;
           </div>
<div id="menu">
<div onclick="SwitchMenu('menu_selected_1.1', 'skin/')" id="menu_selected_1.1Title" class="menutitle" style="background-image: url('skin/images/chapter_open.gif');">Proyecto de Integraci&oacute;n</div>
<div id="menu_selected_1.1" class="selectedmenuitemgroup" style="display: block;">
<div class="menuitem">
<a href="index.html" title="Proyecto de Integraci&oacute;n">&Iacute;ndice</a>
</div>
<div onclick="SwitchMenu('menu_selected_1.1.2', 'skin/')" id="menu_selected_1.1.2Title" class="menutitle" style="background-image: url('skin/images/chapter_open.gif');">Teor&iacute;a</div>
<div id="menu_selected_1.1.2" class="selectedmenuitemgroup" style="display: block;">
<div class="menuitem">
<a href="sesion01-apuntes.html" title="Sesi&oacute;n 1: Caso de estudio">Sesi&oacute;n 1</a>
</div>
<div class="menuitem">
<a href="sesion02-apuntes.html" title="Sesi&oacute;n 2: DAO con JDBC">Sesi&oacute;n 2</a>
</div>
<div class="menuitem">
<a href="sesion03-apuntes.html" title="Sesi&oacute;n 3: Aplicaci&oacute;n web con servlets">Sesi&oacute;n 3</a>
</div>
<div class="menuitem">
<a href="sesion04-apuntes.html" title="Sesi&oacute;n 4: Aplicaci&oacute;n web con servlets y JSPs">Sesi&oacute;n 4</a>
</div>
<div class="menuitem">
<a href="sesion0506-apuntes.html" title="Sesiones 5 y 6: Aplicaci&oacute;n web con Struts">Sesi&oacute;n 5-6</a>
</div>
<div class="menupage">
<div class="menupagetitle">Sesi&oacute;n 7</div>
</div>
<div class="menuitem">
<a href="sesion08-apuntes.html" title="Sesi&oacute;n 8: Proyecto web">Sesi&oacute;n 8</a>
</div>
<div class="menuitem">
<a href="sesion09-apuntes.html" title="Sesi&oacute;n 9: Spring">Sesi&oacute;n 9</a>
</div>
<div class="menuitem">
<a href="sesion10-apuntes.html" title="Sesi&oacute;n 10: Servidores de aplicaciones">Sesi&oacute;n 10</a>
</div>
<div class="menuitem">
<a href="sesion11-apuntes.html" title="Sesi&oacute;n 11: Componentes EJB">Sesi&oacute;n 11</a>
</div>
<div class="menuitem">
<a href="sesion12-apuntes.html" title="Sesi&oacute;n 12: Mensajes: JMS">Sesi&oacute;n 12</a>
</div>
<div class="menuitem">
<a href="sesion13-apuntes.html" title="Sesi&oacute;n 13: Servicios Web">Sesi&oacute;n 13</a>
</div>
<div class="menuitem">
<a href="sesion14-apuntes.html" title="Sesi&oacute;n 14: Proyecto Enterprise">Sesi&oacute;n 14</a>
</div>
</div>
</div>
<div id="credit"></div>
<div id="roundbottom">
<img style="display: none" class="corner" height="15" width="15" alt="" src="skin/images/rc-b-l-15-1body-2menu-3menu.png"></div>
<div id="credit2"></div>
</div>
<div id="content">
<div title="Portable Document Format" class="pdflink">
<a class="dida" href="sesion07-apuntes.pdf"><img alt="PDF -icon" src="skin/images/pdfdoc.gif" class="skin"><br>
        PDF</a>
</div>
<h1>Aplicaci&oacute;n web con Hibernate</h1>
<div id="minitoc-area">
<ul class="minitoc">
<li>
<a href="#Introducci%C3%B3n">Introducci&oacute;n</a>
</li>
<li>
<a href="#Creaci%C3%B3n+de+una+nueva+%22rama%22+en+CVS">Creaci&oacute;n de una nueva "rama" en CVS</a>
</li>
<li>
<a href="#Librer%C3%ADas+necesarias+para+trabajar+con+Hibernate">Librer&iacute;as necesarias para trabajar con Hibernate</a>
</li>
<li>
<a href="#Fichero+de+configuraci%C3%B3n+de+Hibernate">Fichero de configuraci&oacute;n de Hibernate</a>
</li>
<li>
<a href="#Ficheros+de+mapeado">Ficheros de mapeado</a>
</li>
<li>
<a href="#Factor%C3%ADa+de+sesiones+Hibernate">Factor&iacute;a de sesiones Hibernate</a>
</li>
<li>
<a href="#Creaci%C3%B3n+del+DAO+generado+mediante+Hibernate">Creaci&oacute;n del DAO generado mediante Hibernate</a>
</li>
<li>
<a href="#%C3%9Altimos+pasos">&Uacute;ltimos pasos</a>
</li>
<li>
<a href="#Resumen+de+cambios+a+realizar">Resumen de cambios a realizar</a>
</li>
<li>
<a href="#Logging">Logging</a>
</li>
</ul>
</div>


<a name="N1000C"></a><a name="Introducci%C3%B3n"></a>
<h2 class="underlined_10">Introducci&oacute;n</h2>
<div class="section">
<p>En esta sesi&oacute;n de integraci&oacute;n incorporaremos Hibernate a nuestra aplicaci&oacute;n web, de forma que los TOs (<em>TransferObjects</em>) sean objetos creados a trav&eacute;s de Hibernate, en lugar de JDBC.
   Vamos a trabajar &uacute;nicamente en la capa de persistencia, y vamos a comprobar que los cambios realizados no afectan a las capas superiores.
   De hecho, vamos a incorporar Hibernate parcialmente, de forma que, de forma totalmente transparente a la aplicaci&oacute;n, estaremos trabajando
   simult&aacute;neamente con <em>TOs</em> creados mediante JDBC, y <em>TOs</em> creados a trav&eacute;s de Hibernate</p>
</div>


<a name="N1001F"></a><a name="Creaci%C3%B3n+de+una+nueva+%22rama%22+en+CVS"></a>
<h2 class="underlined_10">Creaci&oacute;n de una nueva "rama" en CVS</h2>
<div class="section">
<p>El proyecto de integraci&oacute;n de Hibernate se guardar&aacute; en el CVS como una "rama" diferente a la principal. Esta rama la utilizaremos
   para integrar <span class="codefrag">Spring</span>. La rama principal del CVS (<em>HEAD</em>) la retomaremos en las siguientes sesiones de integraci&oacute;n (
   Servidor de aplicaciones, EJBs, Mensajes...).</p>
<p>Para crear la nueva rama:</p>
<ul>
  
<li>Desde el men&uacute; de contexto del proyecto <span class="codefrag">proy-int-comun</span>, seleccionamos <strong>Team &gt; Branch</strong>.</li>
  
<li>El nombre de la nueva rama ser&aacute;: "b07-integracion-Hibernate".</li>
  
<li>Introducir el nombre de la versi&oacute;n del proyecto: "v056-integracion-Struts"</li>
  
<li>Marcar la casilla <em>Start working in the branch immediately</em>.</li>
  
<li>Pulsar <strong>OK</strong>.</li>

</ul>
<p>Hacemos lo mismo para el proyecto <span class="codefrag">proy-int-web</span>:</p>
<ul>
  
<li>Desde el men&uacute; de contexto del proyecto <span class="codefrag">proy-int-web</span>, seleccionamos <strong>Team &gt; Branch</strong>.</li>
  
<li>Con <em>Ctrl-Espacio</em> nos aparecer&aacute; la etiqueta anterior: "b07-integracion-Hibernate" y la seleccionamos.</li>
  
<li>Introducir el nombre de la versi&oacute;n del proyecto: "v056-integracion-Struts"</li>
  
<li>Marcar la casilla <em>Start working in the branch immediately</em>.</li>
  
<li>Pulsar <strong>OK</strong>.</li>

</ul>
<p>Fijaos que a la derecha del nombre del proyecto nos aparece la etiqueta de la 
   rama (<em>b07-integracion-Hibernate</em>.</p>
<p>Ahora ya estamos en disposici&oacute;n de comenzar la sesi&oacute;n de integraci&oacute;n con Hibernate</p>
</div> 


<a name="N10080"></a><a name="Librer%C3%ADas+necesarias+para+trabajar+con+Hibernate"></a>
<h2 class="underlined_10">Librer&iacute;as necesarias para trabajar con Hibernate</h2>
<div class="section">
<p>En primer lugar, vamos a incluir las librerias necesarias para utilizar Hibernate en nuestra aplicaci&oacute;n, en 
   el directorio <span class="codefrag">proy-int-comun\lib</span>. 
   Dichas librer&iacute;as son las siguientes:</p>
<ul>
      
<li>antlr-2.7.6rc1.jar</li>
      
<li>asm.jar</li>
      
<li>asm-attrs.jar</li>
      
<li>cglib-2.1.3.jar</li>
      
<li>commons-collections-2.1.1.jar</li>
      
<li>commons-logging-1.0.4.jar  (sustituye a commons-logging.jar, que ten&eacute;is actualmente)</li>
      
<li>dom4j-1.6.1.jar</li>
      
<li>ehcache-1.1.jar</li>
      
<li>hibernate3.jar</li>
      
<li>jdbc2_0-stdext.jar</li>
      
<li>jta.jar</li>
      
<li>log4j-1.2.14.jar (ya est&aacute;, no hace falta a&ntilde;adirla)</li>
      
<li>mysql-connector-java-5.0.3-bin.jar (ya est&aacute;, no hace falta a&ntilde;adirla)</li>
   
</ul>
<p>Las librer&iacute;as Hibernate las a&ntilde;adiremos en el <em>buildPath</em> del proyecto de integraci&oacute;n com&uacute;n, y tambi&eacute;n las 
   copiaremos en el directorio <span class="codefrag">proy-int-web\WebContent\WEB-INF\lib</span> (esta &uacute;ltima acci&oacute;n har&aacute; que Eclipse 
   autom&aacute;ticamente las incluya en el <em>buildPath</em> del proyecto de integraci&oacute;n <em>web</em>
</p>
<p>Las librer&iacute;as Hibernate las pod&eacute;is obtener del directorio <span class="codefrag">lib</span> de los ejercicios de las sesiones
   de Hibernate, o bien del directorio <span class="codefrag">lib</span> de la distribuci&oacute;n de Hibernate que hemos utilizado</p>
</div>


<a name="N100CE"></a><a name="Fichero+de+configuraci%C3%B3n+de+Hibernate"></a>
<h2 class="underlined_10">Fichero de configuraci&oacute;n de Hibernate</h2>
<div class="section">
<p>Una vez que hemos incluido las librer&iacute;as de Hibernate para que sean accesibles, tenemos que
   generar el fichero de configuraci&oacute;n de Hibernate (<span class="codefrag">hibernate.cfg.xml</span>), en el que indicaremos cu&aacute;l es la 
   base de datos subyacente, entre otras cosas, y as&iacute; poder iniciar Hibernate.</p>
<p>Las propiedades de Hibernate para la <em>SessionFactory</em> que debemos configurar son las siguientes:</p>
<pre class="code">
&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;!DOCTYPE hibernate-configuration PUBLIC
		"-//Hibernate/Hibernate Configuration DTD 3.0//EN"
		"http://hibernate.sourceforge.net/hibernate-configuration-3.0.dtd"&gt;
&lt;hibernate-configuration&gt;
  &lt;session-factory&gt;
    &lt;!-- Definimos el nombre JNDI del datasource para utilizar el pool de conexiones de Tomcat --&gt;
    &lt;property name="hibernate.connection.datasource"&gt;java:comp/env/jdbc/biblioteca&lt;/property&gt;
    &lt;!-- Dialecto de la base de datos, se debe especificar siempre --&gt;
    &lt;property name="hibernate.dialect"&gt;org.hibernate.dialect.MySQLDialect&lt;/property&gt;
    &lt;!-- Vamos a mostrar las sentencias sql de Hibernate por pantalla --&gt;
    &lt;property name="show_sql"&gt;true&lt;/property&gt;
    &lt;!-- Habilitamos la gesti&oacute;n autom&aacute;tica del contexto de sesiones de Hibernate --&gt;
    &lt;property name="current_session_context_class"&gt;thread&lt;/property&gt;
    &lt;!-- Actualizamos el esquema de la base de datos existente --&gt;
    &lt;property name="hbm2ddl.auto"&gt;update&lt;/property&gt;
  &lt;/session-factory&gt;
&lt;/hibernate-configuration&gt; 

</pre>
<p>El fichero de configuraci&oacute;n de Hibernate lo crearemos en el directorio <span class="codefrag">proy-int-comun\resources</span>
</p>
</div>


<a name="N100EA"></a><a name="Ficheros+de+mapeado"></a>
<h2 class="underlined_10">Ficheros de mapeado</h2>
<div class="section">
<p>Vamos a mapear el <em>transfer object</em> <em>LibroTO</em>, para lo cual crearemos el fichero <span class="codefrag">LibroTO.hbm.xml</span> siguiente:</p>
<pre class="code">
&lt;?xml version="1.0"?&gt;
&lt;!DOCTYPE hibernate-mapping PUBLIC
	"-//Hibernate/Hibernate Mapping DTD 3.0//EN"
	"http://hibernate.sourceforge.net/hibernate-mapping-3.0.dtd"&gt;
&lt;hibernate-mapping package="es.ua.jtech.proyint.to"&gt;
  &lt;class name="LibroTO" 
         table="libro"&gt;
         
     &lt;!-- clave primaria natural --&gt;    
     &lt;id name="isbn" column="isbn"/&gt;

     &lt;property name="titulo" length="64"/&gt;
     &lt;property name="autor" length="64"/&gt;
     &lt;property name="numPaginas" type="integer"/&gt;              
  &lt;/class&gt;
&lt;/hibernate-mapping&gt; 

</pre>
<p>Fijaos que hemos incluido el nombre del paquete en el atributo <span class="codefrag">package</span>, de esta forma no tenemos
   que proporcionar el nombre completo de la clase en el atributo <span class="codefrag">name</span>.</p>
<p>A diferencia de los ejemplos vistos en las sesiones de Hibernate, la tabla <span class="codefrag">libro</span> utiliza una clave 
   primaria natural, es decir, una clave con un significado para el negocio. Por lo tanto no es necesario utilizar
   la etiqueta <span class="codefrag">&lt;generator&gt;</span>.</p>
<p>Hemos restringido la longitud de los campos <em>titulo</em> y <em>autor</em> a 64, puesto que as&iacute; se han
   definido en el <em>script</em> de creaci&oacute;n de la base de datos (en proy-int-comun/db/biblioteca.sql).</p>
<p>El fichero de mapeado lo situaremos en el paquete <span class="codefrag">es.ua.jtech.proyint.to</span>, que habremos creado
   previamente en el directorio <em>proy-int-comun/resources</em>. En el caso de realizar el mapeado de las otras
   dos clases <em>UsuarioTO</em> y <em>OperacionTO</em>, situaremos tambi&eacute;n aqu&iacute; los correspondientes ficheros
   <span class="codefrag">.hbm.xml</span> de forma que cuando despleguemos la aplicaci&oacute;n
   estar&aacute;n en el mismo directorio que las clases <em>transfer object</em> a las que hacen referencia. Recordemos
   tambi&eacute;n que &eacute;sto es una recomendaci&oacute;n, no una exigencia de Hibernate.</p>
<p>No olvid&eacute;is incluir el fichero de mapeado en el fichero de configuraci&oacute;n de hibernate (<em>hibernate.cfg.xml</em>),
   a&ntilde;adiendo la siguiente l&iacute;nea anidada en la etiqueta <span class="codefrag">&lt;session-factory&gt;</span>:</p>
<pre class="code">
        &lt;mapping resource="es/ua/jtech/proyint/to/LibroTO.hbm.xml"/&gt;

</pre>
</div>  


<a name="N10141"></a><a name="Factor%C3%ADa+de+sesiones+Hibernate"></a>
<h2 class="underlined_10">Factor&iacute;a de sesiones Hibernate</h2>
<div class="section">
<p>Puesto que nuestra aplicaci&oacute;n solamente utiliza una BD, &uacute;nicamente necesitaremos utilizar una <em>SessionFactory</em>.
   Vamos a crear una clase que denominaremos <em>FactoriaSesionHibernate</em> que crea y configura la <em>SessionFactory</em>
   y que tendremos que utilizar posteriormente para poder abrir sesiones con la base de datos para realizar las operaciones
   pertinentes con los objetos persistentes de nuestra aplicaci&oacute;n.</p>
<p>El c&oacute;digo de <em>FactoriaSesionHibernate.java</em> es similar al que ya hemos utilizado en los ejercicios, de forma que
   creamos una variable global en su inicializador est&aacute;tico denominada <span class="codefrag">sessionFactory</span>, y que se llama una
   &uacute;nica vez por la m&aacute;quina virtual de Java cuando carga la clase.</p>
<pre class="code">
package es.ua.jtech.proyint.dao;

import org.apache.commons.logging.Log;
import org.apache.commons.logging.LogFactory;

import org.hibernate.*;
import org.hibernate.cfg.*;

public class FactoriaSesionHibernate {

    private static final SessionFactory sessionFactory;

	private static Log logger = LogFactory.getLog(FactoriaSesionHibernate.class.getName());

    static {
        try {
            // Crea la SessionFactory a partir de hibernate.cfg.xml
            sessionFactory = new Configuration().configure().buildSessionFactory();
        } catch (Throwable ex) {
            logger.error("Fallo en la creaci&oacute;n de la SessionFactory.",e);
            throw new ExceptionInInitializerError(ex);
        }
    }
    
    public static SessionFactory getSessionFactory() {
        return sessionFactory;
    }
}


</pre>
<p>El fichero <em>FactoriaSesionHibernate.java</em> lo situaremos en el 
   paquete <span class="codefrag">es.ua.jtech.proyint.dao</span>.</p>
</div>


<a name="N1016A"></a><a name="Creaci%C3%B3n+del+DAO+generado+mediante+Hibernate"></a>
<h2 class="underlined_10">Creaci&oacute;n del DAO generado mediante Hibernate</h2>
<div class="section">
<p>El siguiente paso ser&aacute; implementar la clase <em>LibroHIBDAO.java</em> (en el paquete
   <em>es.ua.jtech.proyint.dao.libro</em>), que es la que realizar&aacute; las operaciones que interaccionan directamente
   con la base de datos. </p>
<p>Para poder realizar los cambios y comprobar que &eacute;stos funcionan, m&eacute;todo a m&eacute;todo, copiaremos 
   el fichero <em>LibroJDBCDAO</em> con el nuevo nombre <em>LibroHIBDAO</em>, y sobre &eacute;ste vamos a ir realizando
   las modificaciones que nos interesen. Aseguraos de que el atributo <em>logger</em> hace referencia a la
   clase <em>LibroHIBDAO</em>.</p>
<p>El primer m&eacute;todo que vamos a cambiar es el de listado de libros: 
   <span class="codefrag">List&lt;LibroTO&gt; getAllLibros()</span>. Borramos el c&oacute;digo y tenemos que cambiarlo por
   c&oacute;digo que utilice Hibernate. En este caso, haremos uso de una transacci&oacute;n mediante la sesi&oacute;n actual,
   tal y como hemos hecho en los ejercicios, y crearemos una consulta HQL para recuperar todos los libros
   de la base de datos.</p>
<p>Tendremos que importar las librerias de hibernate: </p>
<pre class="code">
import org.hibernate.Query;
import org.hibernate.Session;
import es.ua.jtech.proyint.dao.FactoriaSesionHibernate;
</pre>
<p> y borrar las de JDBC.</p>
<p>Fijaos que tenemos que el m&eacute;todo <em>getAllLibros()</em> devuelve una lista con elementos LibroTO, y que la consulta a Hibernate nos 
   devolver&aacute; un objeto de tipo <em>List</em>. Por lo tanto, una vez cerrada la transacci&oacute;n, podemos, por ejemplo,
   recorrer dicha lista, hacer un <em>cast</em> de cada uno de los elementos, y a&ntilde;adirlos en una variable local
   de tipo <span class="codefrag">List&lt;LibroTO&gt;</span>, que es la que devolveremos como resultado del m&eacute;todo.</p>
<p>Para probar la ejecuci&oacute;n del nuevo m&eacute;todo <em>getAllLibros()</em>, tenemos que modificar la clase 
   <em>FactoriaDAOs</em> (en el paquete <em>es.ua.jtech.proint.dao</em>) para que devuelva un objeto de tipo
   <em>LibroHIBDAO</em>: </p>
<pre class="code">
   public class FactoriaDAOs {
   ...   
   	public ILibroDAO getLibroDAO() {
		return new LibroHIBDAO();
	}
   ...
   } //fin FactoriaDAOs
</pre>
<p>Finalmente tambi&eacute;n es importante cambiar el tipo de dato del atributo <em>numPaginas</em> de la clase
   <em>LibroTO</em> (paquete <em>es.ua.jtech.proint.to</em>) para que sea <em>Integer</em> en lugar de <em>int</em>.
</p>
<pre class="code">
   public class LibroTO extends TransferObject {
   ...   
   	  private Integer numPaginas;
   ...
   	public Integer getNumPaginas() {
		return numPaginas;
	}

	public void setNumPaginas(Integer numPaginas) {
		this.numPaginas = numPaginas;
	}
   ...
   } //fin LibroTO
</pre>
<p>La raz&oacute;n de este cambio es la siguiente: en la BD se permite que el campo <em>numPaginas</em> de la tabla <em>libro</em>
   tenga un valor igual a <em>null</em>. Cuando Hibernate acceda a la base de datos para recuperar una fila de dicha
   tabla, realizar&aacute; una llamada al m&eacute;todo <em>setNumPaginas()</em>, que espera como par&aacute;metro un objeto de tipo <em>int</em>,
   y al recibir un <em>null</em> provocar&aacute; una excepci&oacute;n.</p>
<p>Y despu&eacute;s de todo esto, podemos ejecutar la aplicaci&oacute;n, y probar la funci&oacute;n para listar los libros.</p>
</div>   


<a name="N101E9"></a><a name="%C3%9Altimos+pasos"></a>
<h2 class="underlined_10">&Uacute;ltimos pasos</h2>
<div class="section">
<p>Una vez que hemos probado que funciona la opci&oacute;n de listar los libros, procederemos de igual forma a
   cambiar el c&oacute;digo de: <em>selectLibro(String isbn)</em>, <em>addLibro(LibroTO libro)</em>, y 
   <em>delLibro(LibroTO libro)</em>, en este orden, y siempre siguiendo los mismos pasos: </p>
<ul>
  
<li>Cambiar el c&oacute;digo JDBC del m&eacute;todo por c&oacute;digo Hibernate</li>
  
<li>Probar que la aplicaci&oacute;n sigue funcionando exactemamente igual que antes</li>

</ul>
<p>Fijaos que al final tendremos en nuestra aplicaci&oacute;n un DAO Hibernate, "conviviendo" con DAOs JDBC
   de forma totalmente transparente a las capas superiores que hacen uso de dichos DAOs. Ello es posible
   gracias al dise&ntilde;o en capas, y a la utilizaci&oacute;n de DAOs y TOs. Pero lo que es m&aacute;s importante, es que este
   "peque&ntilde;o ejercicio" es una muestra de que en una apliaci&oacute;n se puede realizar una migraci&oacute;n a Hibernate
   de forma incremental, sin que el resto de la aplicaci&oacute;n se vea afectada, lo cual resulta fundamental
   si queremos que nuestro "negocio" siga funcionando al mismo tiempo que incluimos cambios en la aplicaci&oacute;n. 
</p>
</div>


<a name="N10208"></a><a name="Resumen+de+cambios+a+realizar"></a>
<h2 class="underlined_10">Resumen de cambios a realizar</h2>
<div class="section">
<p>En la siguiente figura podemos ver c&oacute;mo quedar&aacute; nuestra aplicaci&oacute;n despu&eacute;s de introducir los cambios. En la
   parte derecha de la figura se muestran los pasos que hemos ido introduciendo: </p>
<table class="ForrestTable" cellspacing="1" cellpadding="4">

<tr>

<td colspan="1" rowspan="1"><img alt="Estructura de Proyecto" content-width="7cm" height="507" src="imagenes/s7/situacionFinal.gif" width="255"></td>
<td colspan="1" rowspan="1">
<p>Resumen de cambios.</p>

<ul>

<li>Etiquetamos como versi&oacute;n el proyecto de integraci&oacute;n de <em>Struts</em>, y creamos una nueva rama en el CVS</li>

<li>Se incluimos las librer&iacute;as de Hibernate en <span class="codefrag">proy-int-comun\lib</span> y 
    <span class="codefrag">proy-int-web\WebContent\WEB-INF\lib</span>.</li>

<li>Creamos el fichero de configuraci&oacute;n de Hibernate (<span class="codefrag">hibernate.cfg.xml</span>) en <span class="codefrag">proy-int-comun\resources</span>.</li>

<li>Creamos el fichero de mapeado (<span class="codefrag">LibroTO.hbm.xml</span>) en la carpeta <span class="codefrag">Resources</span>.</li>

<li>Creamos la clase <span class="codefrag">FactoriaSesionHibernate.java</span> en el paquete <span class="codefrag">es.ua.jtech.proyint.dao</span>.</li>

<li>Creamos la clase <span class="codefrag">LibroHIBDAO.java</span> en el paquete <span class="codefrag">es.ua.jtech.proyint.dao</span>
</li>

<li>Modificamos la clase <span class="codefrag">FactoriaDAOs</span> (paquete <span class="codefrag">es.ua.jtech.proint.dao</span>) para que
    devuelva un <span class="codefrag">LibroHIBDAO</span>.</li>

<li>Cambiamos el tipo de datos del atributo <span class="codefrag">numPaginas</span> de la clase <span class="codefrag">LibroTO</span> 
    a <span class="codefrag">Integer</span>.</li>

<li>Modificaciones en <span class="codefrag">LibroHIBDAO.java</span>:
  <ul>
    
<li>Cambiamos el c&oacute;digo de <span class="codefrag">getAllLIbros()</span> y probamos la aplicaci&oacute;n.</li>
    
<li>Cambiamos el c&oacute;digo de <span class="codefrag">selectLibro(String isbn)</span> y probamos la aplicaci&oacute;n.</li>
    
<li>Cambiamos el c&oacute;digo de <span class="codefrag">addLibro(LibroTO libro)</span> y probamos la aplicaci&oacute;n.</li>
    
<li>Cambiamos el c&oacute;digo de <span class="codefrag">delLibro(LibroTO libro)</span> y probamos la aplicaci&oacute;n.</li>
  
</ul>

</li>        

</ul>

</td>

</tr>

</table>
</div>


<a name="N10297"></a><a name="Logging"></a>
<h2 class="underlined_10">Logging</h2>
<div class="section">
<p>Para registrar y poder ver los mensajes relacionados con Hibernate pod&eacute;is a&ntilde;adir las siguientes l&iacute;neas en
   el fichero <span class="codefrag">lo4j.properties</span> del proyecto <span class="codefrag">proy-int</span> (en <span class="codefrag">proy-int\resources</span>).
   </p>
<pre class="code">
log4j.category.org.hibernate=INFO
log4j.category.org.hibernate=DEBUG
log4j.logger.org.hibernate.tool.hbm2ddl=debug
</pre>
</div>


<p class="pageBreakAfter"></p>


</div>
<div class="clearboth">&nbsp;</div>
</div>
<div id="footer">
<div class="lastmodified">
<script type="text/javascript"><!--
document.write("<text>Last Published:</text> " + document.lastModified);
//  --></script>
</div>
<div class="copyright">
        Copyright &copy;
         2006-2007 Depto. CCIA</div>
</div>
</body>
</html>
