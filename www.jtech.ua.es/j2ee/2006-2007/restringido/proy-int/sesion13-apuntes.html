<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<META http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta content="Apache Forrest" name="Generator">
<meta name="Forrest-version" content="0.7">
<meta name="Forrest-skin-name" content="pelt">
<title>Servicios Web</title>
<link type="text/css" href="skin/basic.css" rel="stylesheet">
<link media="screen" type="text/css" href="skin/screen.css" rel="stylesheet">
<link media="print" type="text/css" href="skin/print.css" rel="stylesheet">
<link type="text/css" href="skin/profile.css" rel="stylesheet">
<script src="skin/getBlank.js" language="javascript" type="text/javascript"></script><script src="skin/getMenu.js" language="javascript" type="text/javascript"></script><script src="skin/fontsize.js" language="javascript" type="text/javascript"></script>
<link rel="shortcut icon" href="">
</head>
<body onload="init()">
<script type="text/javascript">ndeSetTextSize();</script>
<div id="top">
<div class="header">
<div class="grouplogo">
<a href="http://www.jtech.ua.es/j2ee"><img class="logoImage" alt="J2EE" src="images/baner_j2ee_izq.gif" title="Curso Especialista Universitario en Java Enterprise"></a>
</div>
<div class="projectlogoA1">
<a href="http://www.dccia.ua.es/"><img class="logoImage" alt="Proyecto de Integracion" src="images/baner_j2ee_der.gif" title="Proyecto de Integracion"></a>
</div>
<ul id="tabs">
<li>
<a class="base-not-selected" href="../index.html">M&oacute;dulos</a>
</li>
<li class="current">
<a class="base-selected" href="index.html">Proyecto de Integraci&oacute;n</a>
</li>
</ul>
</div>
</div>
<div id="main">
<div id="publishedStrip">
<div id="level2tabs"></div>
<script type="text/javascript"><!--
document.write("<text>Last Published:</text> " + document.lastModified);
//  --></script>
</div>
<div class="breadtrail">
             
             &nbsp;
           </div>
<div id="menu">
<div onclick="SwitchMenu('menu_selected_1.1', 'skin/')" id="menu_selected_1.1Title" class="menutitle" style="background-image: url('skin/images/chapter_open.gif');">Proyecto de Integraci&oacute;n</div>
<div id="menu_selected_1.1" class="selectedmenuitemgroup" style="display: block;">
<div class="menuitem">
<a href="index.html" title="Proyecto de Integraci&oacute;n">&Iacute;ndice</a>
</div>
<div onclick="SwitchMenu('menu_selected_1.1.2', 'skin/')" id="menu_selected_1.1.2Title" class="menutitle" style="background-image: url('skin/images/chapter_open.gif');">Teor&iacute;a</div>
<div id="menu_selected_1.1.2" class="selectedmenuitemgroup" style="display: block;">
<div class="menuitem">
<a href="sesion01-apuntes.html" title="Sesi&oacute;n 1: Caso de estudio">Sesi&oacute;n 1</a>
</div>
<div class="menuitem">
<a href="sesion02-apuntes.html" title="Sesi&oacute;n 2: DAO con JDBC">Sesi&oacute;n 2</a>
</div>
<div class="menuitem">
<a href="sesion03-apuntes.html" title="Sesi&oacute;n 3: Aplicaci&oacute;n web con servlets">Sesi&oacute;n 3</a>
</div>
<div class="menuitem">
<a href="sesion04-apuntes.html" title="Sesi&oacute;n 4: Aplicaci&oacute;n web con servlets y JSPs">Sesi&oacute;n 4</a>
</div>
<div class="menuitem">
<a href="sesion0506-apuntes.html" title="Sesiones 5 y 6: Aplicaci&oacute;n web con Struts">Sesi&oacute;n 5-6</a>
</div>
<div class="menuitem">
<a href="sesion07-apuntes.html" title="Sesi&oacute;n 7: Aplicaci&oacute;n web con Hibernate">Sesi&oacute;n 7</a>
</div>
<div class="menuitem">
<a href="sesion08-apuntes.html" title="Sesi&oacute;n 8: Proyecto web">Sesi&oacute;n 8</a>
</div>
<div class="menuitem">
<a href="sesion09-apuntes.html" title="Sesi&oacute;n 9: Spring">Sesi&oacute;n 9</a>
</div>
<div class="menuitem">
<a href="sesion10-apuntes.html" title="Sesi&oacute;n 10: Servidores de aplicaciones">Sesi&oacute;n 10</a>
</div>
<div class="menuitem">
<a href="sesion11-apuntes.html" title="Sesi&oacute;n 11: Componentes EJB">Sesi&oacute;n 11</a>
</div>
<div class="menuitem">
<a href="sesion12-apuntes.html" title="Sesi&oacute;n 12: Mensajes: JMS">Sesi&oacute;n 12</a>
</div>
<div class="menupage">
<div class="menupagetitle">Sesi&oacute;n 13</div>
</div>
<div class="menuitem">
<a href="sesion14-apuntes.html" title="Sesi&oacute;n 14: Proyecto Enterprise">Sesi&oacute;n 14</a>
</div>
</div>
</div>
<div id="credit"></div>
<div id="roundbottom">
<img style="display: none" class="corner" height="15" width="15" alt="" src="skin/images/rc-b-l-15-1body-2menu-3menu.png"></div>
<div id="credit2"></div>
</div>
<div id="content">
<div title="Portable Document Format" class="pdflink">
<a class="dida" href="sesion13-apuntes.pdf"><img alt="PDF -icon" src="skin/images/pdfdoc.gif" class="skin"><br>
        PDF</a>
</div>
<h1>Servicios Web</h1>
<div id="minitoc-area">
<ul class="minitoc">
<li>
<a href="#Introducci%C3%B3n">Introducci&oacute;n</a>
</li>
<li>
<a href="#Creaci%C3%B3n+de+servicios+web">Creaci&oacute;n de servicios web</a>
</li>
<li>
<a href="#Acceso+a+servicios+web+externos">Acceso a servicios web externos</a>
</li>
<li>
<a href="#Cliente+para+los+servicios+web+%28*%29">Cliente para los servicios web (*)</a>
</li>
<li>
<a href="#Resumen">Resumen</a>
</li>
</ul>
</div>


<a name="N1000C"></a><a name="Introducci%C3%B3n"></a>
<h2 class="underlined_10">Introducci&oacute;n</h2>
<div class="section">
<p>En esta sesi&oacute;n de integraci&oacute;n vamos a ofrecer una serie de funcionalidades de la aplicaci&oacute;n como servicios
web. Concretamente expondremos como servicio web las operaciones implementadas mediante EJBs. Adem&aacute;s, 
utilizaremos servicios web externos para obtener informaci&oacute;n extendida sobre los libros de nuestra
biblioteca.</p>
<div class="frame note">
<div class="label">Nota</div>
<div class="content">En este sesi&oacute;n a&ntilde;adiremos controles Beehive al proyecto, por lo que la aplicaci&oacute;n deber&aacute; ser desplegada
en un dominio que cuente con las librer&iacute;as necesarias (preparado para BEA Workshop).</div>
</div>
</div>


<a name="N10019"></a><a name="Creaci%C3%B3n+de+servicios+web"></a>
<h2 class="underlined_10">Creaci&oacute;n de servicios web</h2>
<div class="section">
<p>Lo primero que haremos ser&aacute; crear un servicio web de la biblioteca que permita realizar las siguientes
operaciones:</p>
<ul>

<li>
<span class="codefrag">LibroTO[] listadoDisponibles()</span>
</li>

<li>
<span class="codefrag">OperacionTO[] listadoPrestamos()</span>
</li>

<li>
<span class="codefrag">OperacionTO[] listadoReservas()</span>
</li>

<li>
<span class="codefrag">OperacionTO[] listadoTodosLibros()</span>
</li>

<li>
<span class="codefrag">String realizaReserva(String login, String password, String socio, String isbn) </span>
</li>

</ul>
<p>Para a&ntilde;adir este servicio web a la aplicaci&oacute;n seguiremos los siguientes pasos:</p>
<ol>

<li>Creamos, dentro del proyecto EAR de la aplicaci&oacute;n, un proyecto de servicios web (<em>Web Services 
Project</em>). Este proyecto se llamar&aacute; <span class="codefrag">proy-int-ws</span>, y lo crearemos con las opciones por
defecto.</li>


<li>Dentro de los fuentes del proyecto creamos dos paquetes: <span class="codefrag">es.ua.jtech.proyint.ws</span>, donde 
crearemos la clase que implementar&aacute; nuestro servicio web, y 
<span class="codefrag">es.ua.jtech.proyint.controls</span>, donde crearemos los controles Beehive para acceder a los
componentes que necesitemos (EJBs y servicios web externos en nuestro caso).</li>


<li>Todas estas operaciones est&aacute;n definidas en el EJB implementado en sesiones anteriores. Para ofrecer
las operaciones del EJB desde nuestro servicio web crearemos un <em>EJB Control</em> siguiendo
los siguientes pasos:

<ul>

<li>Pulsando con el bot&oacute;n derecho sobre el paquete <span class="codefrag">es.ua.jtech.proyint.controls</span> seleccionamos
<em>New &gt; EJB Control</em>.

<p>
<img alt="Creaci&oacute;n de un EJB Control. Paso 1." content-width="10cm" height="248" src="imagenes/s13/ejb-1.gif" width="500"></p>


</li>

<li>A la clase que implementar&aacute; el control le damos como nombre <span class="codefrag">OperacionEjbControl</span> y pulsamos
el bot&oacute;n <em>Next</em>.

<p>
<img alt="Creaci&oacute;n de un EJB Control. Paso 2." content-width="9cm" height="480" src="imagenes/s13/ejb-2.gif" width="438"></p>


</li>

<li>En la siguiente pantalla pulsamos sobre el bot&oacute;n <em>Browse Application EJBs...</em> para buscar entre 
los EJBs definidos dentro de nuestra aplicaci&oacute;n (EAR).

<p>
<img alt="Creaci&oacute;n de un EJB Control. Paso 3." content-width="9cm" height="472" src="imagenes/s13/ejb-3.gif" width="438"></p>


</li>

<li>En la lista veremos el EJB <span class="codefrag">OperacionBean</span> y las posibles formas de acceder a &eacute;l. Seleccionamos
en enlace JNDI a la interfaz local.

<p>
<img alt="Creaci&oacute;n de un EJB Control. Paso 4." content-width="9cm" height="414" src="imagenes/s13/ejb-4.gif" width="438"></p>


</li>

<li>Autom&aacute;ticamente se rellenar&aacute;n los datos que el control necesita para acceder a dicho EJB. Pulsamos el bot&oacute;n
<em>Finish</em> para finalizar el asistente y crear el control.

<p>
<img alt="Creaci&oacute;n de un EJB Control. Paso 5." content-width="9cm" height="472" src="imagenes/s13/ejb-5.gif" width="438"></p>


</li>


</ul>

</li>


<li>Creamos en el paquete <span class="codefrag">es.ua.jtech.proyint.ws</span> un nuevo servicio web <span class="codefrag">BibliotecaWS</span>.</li>


<li>A&ntilde;adimos a dicho servicio web una referencia al control <span class="codefrag">OperacionEjbControl</span>.</li>


<li>Creamos una operaci&oacute;n delegada en el servicio web para el m&eacute;todo <span class="codefrag">listadoDisponibles</span> del
control EJB.</li>


<li>Por defecto esta operaci&oacute;n devuelve el listado como un objeto <span class="codefrag">List</span>. Sin embargo, esto nos
puede dar problemas, ya que al no quedar expuesto en la interfaz del servicio el tipo de datos propio
<span class="codefrag">LibroTO</span> no se generar&aacute;n los serializadores y deserializadores necesarios. Por lo tanto, 
modificamos el m&eacute;todo para que devuelva un array de dichos objetos de la siguiente forma:

<pre class="code">public LibroTO[] listadoDisponibles() {
  List libros = operacionEjbControl.listadoDisponibles();
  LibroTO[] result = new LibroTO[libros.size()];
  libros.toArray(result);
  return result;
}</pre>


</li>


<li>Repetimos el proceso para las operaciones <span class="codefrag">listadoPrestamos</span>, <span class="codefrag">listadoReservas</span>,
 y <span class="codefrag">listadoTodosLibros</span>.</li>
 

<li>Generamos un m&eacute;todo delegado para la operaci&oacute;n <span class="codefrag">realizaReserva</span>. Dicha operaci&oacute;n deber&iacute;a
poder ser invocada &uacute;nicamente por un usuario con permisos para hacerlo. Por lo tanto tendremos
que a&ntilde;adir c&oacute;digo para realizar el control de usuarios en este m&eacute;todo, para as&iacute; evitar dejar abierta
una operaci&oacute;n que no deber&iacute;a ser p&uacute;blica. A&ntilde;adiremos dos par&aacute;metros para indicar el usuario que realiza
la petici&oacute;n (<span class="codefrag">login</span> y <span class="codefrag">password</span>) y modificamos el c&oacute;digo como se muestra a 
continuaci&oacute;n:

<pre class="code">public String realizaReserva(String login, String password, 
                             String socio, String isbn) {
  try {
    FactoriaBOs fb = FactoriaBOs.getInstance();
    IUsuarioBO iu = fb.getUsuarioBO();

    UsuarioTO usuario = iu.autenticaUsuario(login, password);
    if (usuario != null) {
      operacionEjbControl.realizaReserva(socio, isbn);
      return "Reserva realizada correctamente";
    } else {
      throw new SOAPFaultException(null, 
                                   "Login y/o password incorrecto",
                                   "Servicio Web Biblioteca", null);
    }
  } catch (Exception e) {
    throw new SOAPFaultException(null, 
                    "Error al realizar la reserva: " + e.getMessage(),
                    "Servicio Web Biblioteca", null);
  }
}</pre>


</li>


</ol>
</div>

<a name="N100E5"></a><a name="Acceso+a+servicios+web+externos"></a>
<h2 class="underlined_10">Acceso a servicios web externos</h2>
<div class="section">
<p>Vamos a a&ntilde;adir a la aplicaci&oacute;n la funcionalidad de obtener los detalles de un libro (portada, precio, 
editorial, fecha de publicaci&oacute;n, ...). Para hacer esto recurriremos a los servicios web de Amazon. Dado que los
precios que ofrece Amazon est&aacute;n en d&oacute;lares, utilizaremos el servicio web <em>Currency Exchange Service</em> de
<em>XMethods</em> para obtener el cambio actual y as&iacute; convertir dichos precios a euros. Seguiremos los 
siguientes pasos:</p>
<ol>

<li>A&ntilde;adimos en el proyecto <span class="codefrag">proy-int-comun</span> un nuevo <em>Transfer Object</em> que extienda
<span class="codefrag">LibroTO</span> para a&ntilde;adir atributos adicionales a los libros:

<pre class="code">package es.ua.jtech.proyint.to;

public class DetalleLibroTO extends LibroTO {

  private static final long serialVersionUID = 
                                     -5489054672037280657L;
  
  float precio;
  String imagen;
  int imagenAncho;
  int imagenAlto;
  String editorial;
  String fechaPublicacion;
  String urlDetalles;
	
  // Getters y setters
  ...	

}
</pre>


</li>



<li>Creamos en el paquete <span class="codefrag">es.ua.jtech.proyint.controls</span> del proyecto <span class="codefrag">proy-int-ws</span>
un control (<em>Service Control</em>) para acceder al servicio web de Amazon, cuyo documento WSDL se 
puede encontrar en la siguiente direcci&oacute;n:

<pre class="code">http://webservices.amazon.com/AWSECommerceService/AWSECommerceService.wsdl</pre>


<div class="frame note">
<div class="label">Nota</div>
<div class="content">Durante el proceso de creaci&oacute;n del control se debe indicar que se creen los tipos mediante
JAX-RPC.</div>
</div>


</li>



<li>A&ntilde;adimos al servicio web una referencia al control anterior, y una operaci&oacute;n <span class="codefrag">DetalleLibroTO [] buscaLibroAmazon(String isbn)</span>, 
que tomar&aacute; como par&aacute;metro el ISBN del libro que buscamos, y nos devolver&aacute; un objeto <span class="codefrag">DetalleLibroTO</span>
con los datos de dicho libro, accediendo para ello al servicio web de Amazon mediante el control referenciado:

<pre class="code">public DetalleLibroTO [] buscaLibroAmazon(String isbn) {
  ItemLookup itemLookup = new ItemLookup();

  itemLookup.setAWSAccessKeyId("15JCR9XWMPTGV91JC1R2");
  ItemLookupRequest shared = new ItemLookupRequest();

  shared.setSearchIndex("Books");
  shared.setIdType(IdType_Enumeration.isbn);
  shared.setItemId(new String []{ isbn });
  shared.setResponseGroup(new String [] { "Offers", "Medium" });

  itemLookup.setShared(shared);
		
  ItemLookupResponse response = AWSECommerceServiceControl1
        .itemLookup(itemLookup);

  List&lt;DetalleLibroTO&gt; libros = new ArrayList&lt;DetalleLibroTO&gt;();		
		
  Items [] listaResultados = response.getItems();
  if(listaResultados==null) {
    return null;
  }
  for (Items resultado : listaResultados) {
    Item_Element [] listaArticulos = resultado.getItem();
    if(listaArticulos==null) {
      return null;
    }
    for (Item_Element articulo : listaArticulos) {
      ItemAttributes atributos = articulo.getItemAttributes();
      DetalleLibroTO libro = new DetalleLibroTO();
      libro.setIsbn(isbn);
      libro.setTitulo(atributos.getTitle());
      libro.setNumPaginas(atributos.getNumberOfPages().intValue());
				
      Image imagen = articulo.getMediumImage(); 
      libro.setImagen(imagen.getURL());
      libro.setImagenAlto(imagen.getHeight().get_value().intValue());
      libro.setImagenAncho(imagen.getWidth().get_value().intValue());
				
      String [] autores = atributos.getAuthor();
      String listaAutores = "";
      for(String autor: autores) {
        listaAutores = autor + "; ";
      }
      libro.setAutor(listaAutores);

      libro.setPrecio(atributos.getListPrice() != null ? atributos
              .getListPrice().getAmount().floatValue()/100
              : -1);
				
      libro.setEditorial(atributos.getPublisher());
      libro.setUrlDetalles(articulo.getDetailPageURL());
      libro.setFechaPublicacion(atributos.getPublicationDate());
				
      libros.add(libro);
    }
  }
		
  DetalleLibroTO [] result = new DetalleLibroTO[libros.size()];
  libros.toArray(result);

  return result;
}</pre>



</li>


<li>Creamos en el paquete <span class="codefrag">es.ua.jtech.proyint.controls</span> del proyecto <span class="codefrag">proy-int-ws</span>
un control (<em>Service Control</em>) para acceder al servicio web <em>Currency Exchange Service</em>, 
cuyo documento WSDL se puede encontrar en la siguiente direcci&oacute;n:

<pre class="code">http://www.xmethods.net/sd/2001/CurrencyExchangeService.wsdl</pre>


</li>

<li>A&ntilde;adimos una referencia al control anterior en el servicio web y creamos una 
operaci&oacute;n delegada para la operaci&oacute;n <span class="codefrag">getRate</span> del servicio al que accede. Renombraremos
nuestra operaci&oacute;n y le daremos como nombre <span class="codefrag">tasaCambio</span>.</li>


<li>A&ntilde;adimos a la carpeta <span class="codefrag">WebContent</span> del proyecto <span class="codefrag">proy-int-ws</span> un JSP llamado 
<span class="codefrag">datosLibro.jsp</span> que
muestre los datos de un libro utilizando para ello el servicio web de Amazon. Deber&aacute; tomar como entrada
un par&aacute;metro <span class="codefrag">isbn</span> con el ISBN del libro buscado. El c&oacute;digo fuente de este JSP ser&aacute; el siguiente:

<pre class="code">&lt;%@ page language="java" contentType="text/html;charset=UTF-8"%&gt;
&lt;!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" 
  "http://www.w3.org/TR/html4/loose.dtd"&gt;
&lt;html&gt;
&lt;head&gt;
&lt;meta http-equiv="Content-Type" 
      content="text/html; charset=ISO-8859-1"&gt;
&lt;title&gt;Biblioteca JTech - Datos del Libro&lt;/title&gt;
&lt;link rel="stylesheet" type="text/css" href="css/style.css"
      title="800px style" media="screen,projection" /&gt;
&lt;/head&gt;
&lt;body&gt; 
&lt;div id="wrap"&gt;   
    &lt;h2&gt;Datos del libro&lt;/h2&gt;

    &lt;% 
    es.ua.jtech.proyint.ws.BibliotecaWS cliente = 
                     new es.ua.jtech.proyint.ws.BibliotecaWS();
    es.ua.jtech.proyint.ws.BibliotecaWSClientInitializer
                                    .initialize(null, cliente);
    es.ua.jtech.proyint.to.DetalleLibroTO [] libros = 
        cliente.buscaLibroAmazon(request.getParameter("isbn")); 
    float tasaCambio = cliente.tasaCambio("usa", "euro");
    java.text.NumberFormat formato = 
                  java.text.NumberFormat.getCurrencyInstance();
    if(libros!=null &amp;&amp; libros.length&gt;0) {
    %&gt;
    
    &lt;table&gt;
    &lt;tr&gt;
    &lt;td valign="top"&gt;
    &lt;img src="&lt;%= libros[0].getImagen() %&gt;" 
         width="&lt;%= libros[0].getImagenAncho() %&gt;" 
         height="&lt;%= libros[0].getImagenAlto() %&gt;"/&gt;
    &lt;/td&gt;
    &lt;td valign="top"&gt;
    &lt;p&gt;&lt;strong&gt;ISBN: &lt;/strong&gt;&lt;%= libros[0].getIsbn() %&gt;&lt;/p&gt;
    &lt;p&gt;&lt;strong&gt;T&iacute;tulo: &lt;/strong&gt;&lt;%= libros[0].getTitulo() %&gt;&lt;/p&gt;
    &lt;p&gt;&lt;strong&gt;Autor: &lt;/strong&gt;&lt;%= libros[0].getAutor() %&gt;&lt;/p&gt;
    &lt;p&gt;&lt;strong&gt;Editorial: &lt;/strong&gt;
       &lt;%= libros[0].getEditorial() %&gt;&lt;/p&gt;
    &lt;p&gt;&lt;strong&gt;Fecha de publicaci&oacute;n: &lt;/strong&gt;
       &lt;%= libros[0].getFechaPublicacion() %&gt;&lt;/p&gt;
    &lt;p&gt;&lt;strong&gt;N&uacute;mero de p&aacute;ginas: &lt;/strong&gt;
       &lt;%= libros[0].getNumPaginas() %&gt;&lt;/p&gt;
    &lt;p&gt;&lt;strong&gt;Precio: &lt;/strong&gt;$&lt;%= libros[0].getPrecio() %&gt; 
       (&lt;%= formato.format(libros[0].getPrecio()*tasaCambio) %&gt;)
    &lt;/p&gt;
    &lt;p&gt;&lt;a href="&lt;%= libros[0].getUrlDetalles() %&gt;" 
          target="_blank"&gt;M&aacute;s informaci&oacute;n&lt;/a&gt;&lt;/p&gt;	
    &lt;/td&gt;
    &lt;/tr&gt;
    &lt;/table&gt;
    
    &lt;% } else { %&gt;
    &lt;p&gt;No se han encontrado datos del libro&lt;/p&gt;
    &lt;% } %&gt;

    &lt;a href="javascript: history.back()"&gt;Volver atr&aacute;s&lt;/a&gt;
&lt;/div&gt;
&lt;/body&gt;
</pre>


</li>


<li>Copiamos la carpeta <span class="codefrag">css</span> del proyecto <span class="codefrag">proy-int-web</span> a <span class="codefrag">proy-int-comun</span>, 
para as&iacute; mantener el mismo estilo en el JSP con los datos del libro.</li>


<li>A&ntilde;adir un enlace en la p&aacute;gina <span class="codefrag">jsp/biblio/listadoLibros.jsp</span> del proyecto <span class="codefrag">proy-int-web</span> a 
la p&aacute;gina con los detalles de cada libro. Cada fila de la tabla del listado de libros deber&aacute; contener un enlace
a la p&aacute;gina <span class="codefrag">datosLibro.jsp</span> de <span class="codefrag">proy-int-ws</span> en el que se le pase como par&aacute;metro
el ISBN correspondiente al libro de dicha fila:

<pre class="code">&lt;a href="/proy-int-ws/datosLibro.jsp?isbn=&lt;bean:write name="operacion" 
   property="libro.isbn" /&gt;"&gt;...&lt;/a&gt;</pre>


</li>



</ol>
</div>

<a name="N10176"></a><a name="Cliente+para+los+servicios+web+%28*%29"></a>
<h2 class="underlined_10">Cliente para los servicios web (*)</h2>
<div class="section">
<p>Crear un cliente Java con Netbeans para nuestro servicio web de la biblioteca. El programa deber&aacute; invocar
la operaci&oacute;n <span class="codefrag">listadoDisponibles</span> y mostrar en la consola el listado de libros.</p>
<div class="frame note">
<div class="label">Nota</div>
<div class="content">Al generar el cliente del servicio es posible que nos aparezcan numerosos errores de 
compilaci&oacute;n. Esto es debido a un problema al generar los comentarios de las clases que encapsulan
los datos que intercambia el servicio (<span class="codefrag">LibroTO</span>, <span class="codefrag">OperacionTO</span>, y 
<span class="codefrag">UsuarioTO</span>). Weblogic introduce en el WSDL como documentaci&oacute;n de estos tipos
el Javadoc de sus correspondientes clases. Por su parte <span class="codefrag">wsimport</span> genera clases
para tratar estos datos en el cliente introduciendo dicha documentaci&oacute;n en el comentario, con
el siguiente resultado:<br>

<br>

<span class="codefrag">/**</span>
<br>

<span class="codefrag"> * /** </span>
<br>

<span class="codefrag"> *  * Clase que representa un libro. Destacar que la</span>
<br>

<span class="codefrag"> *  * app no permite 2 ejemplares de un mismo libro</span>
<br>

<span class="codefrag"> *  * @author $Author: malozano $</span>
<br>

<span class="codefrag"> *  * @version $Revision: 1.14 $</span>
<br>

<span class="codefrag"> *  */ </span><em><span class="codefrag">&lt;-- No debe cerrar el comentario aqu&iacute; </span></em>
<br>

<span class="codefrag"> * </span>
<br>

<br>
Deberemos eliminar el cierre del comentario interno para evitar problemas de compilaci&oacute;n en 
estas clases. Para hacer esto podemos pinchar sobre los errores de compilaci&oacute;n que se muestran
en la consola de Netbeans para que nos lleve a la clase afectada, y ah&iacute; realizar la correcci&oacute;n.
</div>
</div>
</div>

<a name="N101BB"></a><a name="Resumen"></a>
<h2 class="underlined_10">Resumen</h2>
<div class="section">
<table class="ForrestTable" cellspacing="1" cellpadding="4">

<tr>

<td colspan="1" rowspan="1"><img alt="Estructura de Proyecto" content-width="7cm" height="549" src="imagenes/s13/proyecto.gif" width="299"></td>
<td colspan="1" rowspan="1">

<p>Se deber&aacute;n implementar los siguientes componentes dentro del proyecto <span class="codefrag">proy-int-ws</span>:</p>

<ul>

<li>
<span class="codefrag">BibliotecaWS</span>: Servicio web de la biblioteca.</li>

<li>
<span class="codefrag">OperacionEjbControl</span>: Control para acceder a las operaciones del EJB <span class="codefrag">OperacionBean</span>.</li>

<li>
<span class="codefrag">AWSECommerceServiceControl</span>: Control para acceder a los servicios web de Amazon.</li>

<li>
<span class="codefrag">CurrencyExchangeServiceControl</span>: Control para acceder al servicio web de cambio de moneda.</li>

<li>
<span class="codefrag">datosLibro.jsp</span>: P&aacute;gina JSP que muestra los detalles de un libro dado su ISBN (que se proporciona
como par&aacute;metro <span class="codefrag">isbn</span>).</li>

<li>
<span class="codefrag">css</span>: Se debe copiar la carpeta <span class="codefrag">css</span> del proyecto <span class="codefrag">proy-int-web</span>
para mantener el mismo estilo en la p&aacute;gina de datos de un libro.</li>

</ul>


<p>Se deber&aacute; a&ntilde;adir el siguiente componente al proyecto <span class="codefrag">proy-int-comun</span>:</p>

<ul>

<li>
<span class="codefrag">DetalleLibroTO</span>: Extiende <span class="codefrag">LibroTO</span> para a&ntilde;adir informaci&oacute;n adicional.</li>

</ul>


<p>Se deber&aacute; modificar el siguiente componente en el proyecto <span class="codefrag">proy-int-web</span>:</p>

<ul>

<li>
<span class="codefrag">jsp/biblio/listadoLibros.jsp</span>: A&ntilde;adir un enlace en cada fila de la tabla que lleva a 
la p&aacute;gina <span class="codefrag">datosLibro.jsp</span> del proyecto <span class="codefrag">proy-int-ws</span> pasando como par&aacute;metro
<span class="codefrag">isbn</span> el ISBN del libro seleccionado.</li>

</ul>


</td>

</tr>

</table>
</div>


<p class="pageBreakAfter"></p>


</div>
<div class="clearboth">&nbsp;</div>
</div>
<div id="footer">
<div class="lastmodified">
<script type="text/javascript"><!--
document.write("<text>Last Published:</text> " + document.lastModified);
//  --></script>
</div>
<div class="copyright">
        Copyright &copy;
         2006-2007 Depto. CCIA</div>
</div>
</body>
</html>
