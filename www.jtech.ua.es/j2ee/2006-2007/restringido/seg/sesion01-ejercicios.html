<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<META http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta content="Apache Forrest" name="Generator">
<meta name="Forrest-version" content="0.7">
<meta name="Forrest-skin-name" content="pelt">
<title> Ejercicios de PKI</title>
<link type="text/css" href="skin/basic.css" rel="stylesheet">
<link media="screen" type="text/css" href="skin/screen.css" rel="stylesheet">
<link media="print" type="text/css" href="skin/print.css" rel="stylesheet">
<link type="text/css" href="skin/profile.css" rel="stylesheet">
<script src="skin/getBlank.js" language="javascript" type="text/javascript"></script><script src="skin/getMenu.js" language="javascript" type="text/javascript"></script><script src="skin/fontsize.js" language="javascript" type="text/javascript"></script>
<link rel="shortcut icon" href="">
</head>
<body onload="init()">
<script type="text/javascript">ndeSetTextSize();</script>
<div id="top">
<div class="header">
<div class="grouplogo">
<a href="http://www.jtech.ua.es/j2ee"><img class="logoImage" alt="J2EE" src="images/baner_j2ee_izq.gif" title="Curso Especialista Universitario J2EE"></a>
</div>
<div class="projectlogoA1">
<a href="http://www.dccia.ua.es/"><img class="logoImage" alt="Servidores Web" src="images/baner_j2ee_der.gif" title="Servidores Web"></a>
</div>
<ul id="tabs">
<li>
<a class="base-not-selected" href="../index.html">M&oacute;dulos</a>
</li>
<li class="current">
<a class="base-selected" href="index.html">Servidores Web</a>
</li>
</ul>
</div>
</div>
<div id="main">
<div id="publishedStrip">
<div id="level2tabs"></div>
<script type="text/javascript"><!--
document.write("<text>Last Published:</text> " + document.lastModified);
//  --></script>
</div>
<div class="breadtrail">
             
             &nbsp;
           </div>
<div id="menu">
<div onclick="SwitchMenu('menu_selected_1.1', 'skin/')" id="menu_selected_1.1Title" class="menutitle" style="background-image: url('skin/images/chapter_open.gif');">Seguridad en JEEE</div>
<div id="menu_selected_1.1" class="selectedmenuitemgroup" style="display: block;">
<div class="menuitem">
<a href="index.html" title="Seguridad en JEE">&Iacute;ndice</a>
</div>
<div onclick="SwitchMenu('menu_1.1.2', 'skin/')" id="menu_1.1.2Title" class="menutitle">Teor&iacute;a</div>
<div id="menu_1.1.2" class="menuitemgroup">
<div class="menuitem">
<a href="sesion01-apuntes.html">Sesion 1</a>
</div>
<div class="menuitem">
<a href="sesion02-apuntes.html">Sesion 2</a>
</div>
<div class="menuitem">
<a href="sesion03-apuntes.html">Sesion 3</a>
</div>
<div class="menuitem">
<a href="sesion04-apuntes.html">Sesion 4</a>
</div>
<div class="menuitem">
<a href="roadmap-apuntes.html">Roadmap</a>
</div>
</div>
<div onclick="SwitchMenu('menu_selected_1.1.3', 'skin/')" id="menu_selected_1.1.3Title" class="menutitle" style="background-image: url('skin/images/chapter_open.gif');">Ejercicios</div>
<div id="menu_selected_1.1.3" class="selectedmenuitemgroup" style="display: block;">
<div class="menupage">
<div class="menupagetitle">Sesion 1</div>
</div>
<div class="menuitem">
<a href="sesion02-ejercicios.html">Sesion 2</a>
</div>
<div class="menuitem">
<a href="sesion03-ejercicios.html">Sesion 3</a>
</div>
<div class="menuitem">
<a href="sesion04-ejercicios.html">Sesion 4</a>
</div>
</div>
</div>
<div id="credit"></div>
<div id="roundbottom">
<img style="display: none" class="corner" height="15" width="15" alt="" src="skin/images/rc-b-l-15-1body-2menu-3menu.png"></div>
<div id="credit2"></div>
</div>
<div id="content">
<div title="Portable Document Format" class="pdflink">
<a class="dida" href="sesion01-ejercicios.pdf"><img alt="PDF -icon" src="skin/images/pdfdoc.gif" class="skin"><br>
        PDF</a>
</div>
<h1> Ejercicios de PKI</h1>
<div id="minitoc-area">
<ul class="minitoc">
<li>
<a href="#Encriptaci%C3%B3n+de+Tarjetas+de+Cr%C3%A9dito">Encriptaci&oacute;n de Tarjetas de Cr&eacute;dito</a>
</li>
<li>
<a href="#Configuraci%C3%B3n+de+la+Base+de+Datos">Configuraci&oacute;n de la Base de Datos</a>
</li>
<li>
<a href="#Clase+CreditCardFactory">Clase CreditCardFactory</a>
</li>
<li>
<a href="#Modificando+y+Consultando+la+BD">Modificando y Consultando la BD</a>
</li>
</ul>
</div>

<a name="N1000C"></a><a name="Encriptaci%C3%B3n+de+Tarjetas+de+Cr%C3%A9dito"></a>
<h2 class="underlined_10">Encriptaci&oacute;n de Tarjetas de Cr&eacute;dito</h2>
<div class="section">
<p>La seguridad de una base de datos ata&ntilde;e tanto a la seguridad en
la conexi&oacute;n como a la seguridad (encriptaci&oacute;n) de los datos
propiamente dichos. En este tema nos centraremos en el estudio de
&eacute;sta &uacute;ltima y lo haremos a trav&eacute;s de un ejemplo. Supongamos que
tenemos un servidor que acepta datos de tarjetas de cr&eacute;ditos y los
almacena en una BD encriptados con su clave p&uacute;blica. La clave
privada solamente es conocida por el departamento de finanzas de la
empresa.</p>
<p>Para llevar a cabo esta tarea definiremos e implementaremos 4
clases:</p>
<table class="ForrestTable" cellspacing="1" cellpadding="4">

<tr>

<td colspan="1" rowspan="1"><strong>CreditCard</strong></td>
<td colspan="1" rowspan="1">Objeto para incluir datos de la tarjeta: <strong>mAccountID</strong> y
<strong>mCreditCardNumber</strong>. Soporta los m&eacute;todos <strong>CreditCard()</strong>,
<strong>getAccountID</strong> y <strong>getCreditCardNumber()</strong>.</td>

</tr>

<tr>

<td colspan="1" rowspan="1"><strong>CreditCardDBO</strong></td>
<td colspan="1" rowspan="1">Objeto que contiene <strong>mAccountID</strong> y los datos encriptados
de la tarjeta <strong>mEncryptedCCNumber</strong> y
<strong>mEncryptedSessionKey</strong> (n&uacute;mero de tarjeta y clave sesi&oacute;n).
Soporta los m&eacute;todos: <strong>CreditCardDBO()</strong>, <strong>getAccountID()</strong>,
<strong>getEncryptedCCNumber()</strong> y
<strong>getEncryptedSessionKey()</strong>.</td>

</tr>

<tr>

<td colspan="1" rowspan="1"><strong>DatabaseOperations</strong></td>
<td colspan="1" rowspan="1">Maneja el acceso a trav&eacute;s de JDBC. Est&aacute;n definidas las
operaciones: <strong>getAllCreditCardAccountIDs()</strong>,
<strong>loadCreditCardDBO()</strong> y <strong>store()</strong>. Maneja objetos
<strong>CreditCardDBO</strong> sin realizar tareas de
encriptaci&oacute;n/desencriptaci&oacute;n.</td>

</tr>

<tr>

<td colspan="1" rowspan="1"><strong>CreditCardFactory</strong></td>
<td colspan="1" rowspan="1">Maneja la encriptaci&oacute;n y desencriptaci&oacute;n de las tarjetas.
Utiliza una misma <strong>mPublicKey</strong> para encriptar. Permite
<strong>createCreditCard()</strong>, <strong>findAllCreditCards()</strong> y
<strong>findCreditCard()</strong> siempre y cuando la clave privada apropiada
se suministre como argumento.</td>

</tr>

</table>
<p>En este tema nos centraremos en la descripci&oacute;n de la clase
<strong>CreditCardFactory</strong> cuyo c&oacute;digo se encuentra en el fichero
<a href="ejercicios/sesion1/CreditCardFactory.java.txt">CreditCardFactory.java</a>.
El c&oacute;digo de las clases restantes se encuentra, respectivamente, en
los siguientes ficheros: <a href="ejercicios/sesion1/CreditCard.java.txt">CreditCard.java</a>, 
<a href="ejercicios/sesion1/CreditCardDBO.java.txt">CreditCardDBO.java</a> y
<a href="ejercicios/sesion1/DatabaseOperations.java.txt">DatabaseOperations.java</a>.</p>
</div>

<a name="N100A6"></a><a name="Configuraci%C3%B3n+de+la+Base+de+Datos"></a>
<h2 class="underlined_10">Configuraci&oacute;n de la Base de Datos</h2>
<div class="section">
<p>En primer lugar lanzaremos el servidor de mysql (el servidor est&aacute; en 
 <a href="http://www.jtech.ua.es/j2ee/2006-2007/restringido/seg/ejercicios/sesion1/mysql-5.0.41-win32.zip">mySQL</a> y el 
 driver est&aacute; en <a href="ejercicios/sesion1/mysql-connector-java-5.0.6-bin.jar">driver</a>) 
 y crearemos una BD de datos como:</p>
<pre class="code">
CREATE DATABASE projava;
USE projava;
CREATE TABLE account (
    account_id INT8 PRIMARY KEY,
    customer_name VARCHAR(40),
    balance FLOAT,
    cert_serial_number VARCHAR(255)
);
CREATE TABLE credit_card (
    account_id INT8 PRIMARY KEY,
    session_key VARCHAR(255),
    cc_number VARCHAR(100)
);
</pre>
<p>Para finalizar con la configuraci&oacute;n de myslq a&ntilde;adiremos un
usuario de nombre <em>usuario</em> y de password <em>clave</em>:</p>
<pre class="code">
USE projava;
GRANT ALL PRIVILEGES ON * TO usuario@localhost IDENTIFIED BY "clave";
GRANT ALL PRIVILEGES ON * TO usuario@localhost.localdomain IDENTIFIED BY "clave";
</pre>
<p>Salvo que el ususario sea root.</p>
<p>En segundo lugar, asumimos que la clave p&uacute;blica se obtiene del
certificado <em>publica.cer</em>. Este certificado se crea y se
guarda en el almac&eacute;n <em>tarjetas.ks</em> y se exporta en formato
DER:</p>
<p>
<em>keytool -genkey -keyalg RSA -keystore tarjetas.ks</em>
</p>
<p>
<em>keytool -export -file publica.cer -keystore
tarjetas.ks</em>
</p>
<p>En tercer lugar creamos un fichero de configuraci&oacute;n llamado
<strong>config.properties</strong> correspondiente a la clase
<strong>Java.util.Properties</strong> en donde especificamos: (1) path al
certificado que contendr&aacute; la clave p&uacute;blica, (2) usuario de la BD,
(3) password de dicho usuario, (4) URL de la BD y (5) driver de la
BD.</p>
<pre class="code">
PublicKeyFilename:publica.cer
DBUsername:usuario
DBPassword:clave
DBUrl:jdbc:mysql://localhost/projava
DBDriver:com.mysql.jdbc.Driver
</pre>
</div>

<a name="N100EA"></a><a name="Clase+CreditCardFactory"></a>
<h2 class="underlined_10">Clase CreditCardFactory</h2>
<div class="section">
<p>Como ya vimos, la clase <strong>CreditCardFactory</strong> soporta la
creaci&oacute;n, encriptaci&oacute;n, grabaci&oacute;n, acceso y desencriptaci&oacute;n de
tarjetas de cr&eacute;dito (objetos <strong>CreditCard</strong>). El c&oacute;digo completo
est&aacute; en el fichero <a href="ejercicios/sesion1/CreditCardFactory.java.txt">CreditCardFactory.java</a>
del paquete <em>com.projavasecurity.ecommerce.creditcard</em>
</p>
<p>Supongamos que alguien llama al m&eacute;todo
<strong>CreditCardFactory.CreateCreditCard()</strong> con el prop&oacute;sito de
crear, encriptar y almacenar una nueva tarjeta (le pasaremos el
n&uacute;mero de cuenta <strong>accountID</strong> y el n&uacute;mero de tarjeta de cr&eacute;dito
<strong>creditCardNumber</strong>). Se realizan los siguientes pasos:</p>
<p>1. Crear una clave de sesi&oacute;n (sim&eacute;trica) con Blowfish,
inicializar un cifrador y aplicarlo sobre <strong>creditCardNumber</strong>
con lo que tenemos el n&uacute;mero de tarjeta encriptado.</p>
<p>2. Usar la clave p&uacute;blica (<strong>mPublicKey</strong>) del
<strong>CreditCardFactory</strong> para inicializar un cifrador asim&eacute;trico y
encriptar as&iacute; la clave sesi&oacute;n.</p>
<p>3. Crear un nuevo objeto <strong>CreditCardDBO</strong> con el n&uacute;mero de
cuenta, la clave sesi&oacute;n encriptada y el n&uacute;mero de tarjeta
encriptado.</p>
<p>4. Crear un objeto <strong>DatabaseOperations</strong> y llamar al m&eacute;todo
<strong>store</strong> pas&aacute;ndole como argumento el objeto
<strong>CreditCardDBO</strong> que acabamos de crear. Con ello almacenamos
los datos encriptados.</p>
<p>5. Devolver el objeto <strong>CreditCard</strong> con los datos sin
encriptar.</p>
<p>

<img alt="Creaci&oacute;n de una nueva tarjeta" content-width="12cm" src="ejercicios/sesion1/create.gif" width="600">
</p>
<p>El c&oacute;digo se muestra a continuaci&oacute;n. Como puede observarse est&aacute;
incluido en un par <strong>try/catch</strong> con m&uacute;ltiples <strong>catch</strong> para
capturar diversos tipos de excepci&oacute;n:</p>
<pre class="code">
public CreditCard createCreditCard
   (long accountID, String creditCardNumber)
   throws InvalidKeyException, IOException {

   CreditCardDBO creditCardDBO = null;
   byte[] encryptedSessionKey, encryptedCCNumber;

   try {
    <strong>// 1a. Crear clave sesi&oacute;n (sim&eacute;trica).</strong>
    KeyGenerator kg = KeyGenerator.getInstance("Blowfish");
    kg.init(128);
    Key sessionKey = kg.generateKey();

    <strong>// 1b. Inicializar cifrador y encriptar n&uacute;mero de tarjeta.</strong>
    Cipher symmetricCipher = Cipher.getInstance
    ("Blowfish/ECB/PKCS5Padding");
    symmetricCipher.init(Cipher.ENCRYPT_MODE, sessionKey);
    encryptedCCNumber = symmetricCipher.doFinal
    (creditCardNumber.getBytes("UTF8"));

    <strong>// 2. Usar clave p&uacute;blica para encriptar clave sesi&oacute;n.</strong>
    Cipher asymmetricCipher = Cipher.getInstance
    ("RSA/ECB/PKCS1Padding");
    asymmetricCipher.init(Cipher.ENCRYPT_MODE, mPublicKey);
    encryptedSessionKey = asymmetricCipher.doFinal
    (sessionKey.getEncoded());

    // Need to catch a large number of possible exceptions:
    } catch (NoSuchAlgorithmException nsae) {
    // We're in trouble. Missing RSA or Blowfish.
    nsae.printStackTrace();
    throw new RuntimeException("Missing Crypto algorithm");
    } catch (NoSuchPaddingException nspe) {
    // again, we're in trouble. Missing padding.
    nspe.printStackTrace();
    throw new RuntimeException("Missing Crypto algorithm");
    } catch (BadPaddingException bpe) {
    // Probably a bad key.
    bpe.printStackTrace();
    throw new InvalidKeyException("Missing Crypto algorithm");
    } catch (IllegalBlockSizeException ibse) {
    // Probably a bad key.
    ibse.printStackTrace();
    throw new InvalidKeyException("Could not encrypt");
    }

    <strong>// 3. Crear objeto con la informaci&oacute;n encriptada.</strong>
    creditCardDBO = new
       CreditCardDBO(accountID, encryptedSessionKey, encryptedCCNumber);

    <strong>// 4. Almancenar objeto con la informaci&oacute;n encriptada.</strong>
    mDBOperations.store(creditCardDBO);
    CreditCard creditCard = new CreditCard(accountID, creditCardNumber);
    <strong>// 5. Devolver objeto con la informaci&oacute;n original.</strong>
    return creditCard;
}
</pre>
<p>Si ahora, por el contrario pretendemos acceder a los datos
encriptados de una tarjeta y luego devolverlos desencriptados
accederemos al m&eacute;todo <strong>findCreditCard()</strong> pas&aacute;ndole como
argumento el n&uacute;mero de cuenta y la clave privada (<strong>accountID</strong>
y <strong>privateKey</strong>). Se seguir&aacute;n los siguientes pasos:</p>
<p>1. Crear un objeto <strong>DatabaseOperations</strong> y llamar al m&eacute;todo
<strong>loadCreditCardDBO</strong> pas&aacute;ndole como argumento el
<strong>accountID</strong>. Esta llamada devuelve un objeto
<strong>CreditCardDBO</strong> que contiene: n&uacute;mero de cuenta, clave sesi&oacute;n
encriptada y n&uacute;mero de tarjeta encriptado.</p>
<p>2. Utilizar la clave privada para desencriptar la clave
sesi&oacute;n.</p>
<p>3. Utilizar la clave sesi&oacute;n para desencriptar el n&uacute;mero de
tarjeta.</p>
<p>4. Devolver un objeto <strong>CreditCard</strong> con la informaci&oacute;n
desencriptada.</p>
<p>

<img alt="Acceso a una tarjeta" content-width="12cm" src="ejercicios/sesion1/findgif.gif" width="600">
</p>
<p>A continuaci&oacute;n mostramos el c&oacute;digo fuente (de nuevo m&uacute;ltiples
<strong>catch</strong>):</p>
<pre class="code">
public CreditCard findCreditCard
   (long accountID, PrivateKey privateKey)
   throws InvalidKeyException, IOException{

   String creditCardNumber = null;

   <strong>// 1. Cargar la informaci&oacute;n encriptada de la tarjeta desde la BD.</strong>
   CreditCardDBO creditCardDBO =
        mDBOperations.loadCreditCardDBO(accountID);
        try {
           <strong>// 2. Desencriptar la clave sesi&oacute;n.</strong>
           Cipher asymmetricCipher = Cipher.getInstance
                ("RSA/ECB/PKCS1Padding");
           asymmetricCipher.init(Cipher.DECRYPT_MODE, privateKey);
           byte[] sessionKeyBytes = asymmetricCipher.doFinal
           (creditCardDBO.getEncryptedSessionKey());

           <strong>// 3. Desencriptar el n&uacute;mero de tarjeta con la clave sesi&oacute;n.</strong>
           SecretKey symmetricKey = new SecretKeySpec
                (sessionKeyBytes, "Blowfish");
           Cipher symmetricCipher = Cipher.getInstance
                ("Blowfish/ECB/PKCS5Padding");
           symmetricCipher.init(Cipher.DECRYPT_MODE, symmetricKey);
           byte[] ccNumberBytes = symmetricCipher.doFinal
                  (creditCardDBO.getEncryptedCCNumber());

           creditCardNumber = new String(ccNumberBytes, "UTF8");

       // Need to catch a large number of possible exceptions:
       } catch (NoSuchAlgorithmException nsae) {
         // Missing an algorithm.
           nsae.printStackTrace();
               throw new RuntimeException("Missing crypto algorithm");
       } catch (NoSuchPaddingException nspe) {
         // again, we're in trouble. Missing padding.
           nspe.printStackTrace();
               throw new RuntimeException("Missing Crypto algorithm");
       } catch (BadPaddingException bpe) {
         // This means the data is probably bad.
               bpe.printStackTrace();
               throw new InvalidKeyException("Could not decrypt");
       } catch (IllegalBlockSizeException ibse) {
         // Probably a bad key.
               ibse.printStackTrace();
               throw new InvalidKeyException("Could not decrypt");
       }

   <strong>// 4. Crear y devolver objeto CreditCard.</strong>
   CreditCard creditCard = new CreditCard(accountID, creditCardNumber);
   return creditCard;
}
</pre>
<p>En tercer lugar, el m&eacute;todo <strong>CreditCardFactory</strong>, es decir el
constructor de la clase, se invoca cuando desde cualquier programa
java queremos modificar o consultar nuestra base de datos de
tarjetas de cr&eacute;dito. Dicho m&eacute;todo recibe como argumento un objeto
de la clase <strong>Properties</strong> que contiene las propiedades
almacenadas en nuestro fichero <strong>config.properties</strong>. Entonces
accede al fichero que contiene el certificado digital (en nuestro
caso el fichero que figura en el campo <strong>PublicKeyFilename</strong>) y
obtiene la clave p&uacute;blica. Finalmente construye un objeto
<strong>DatabaseOperations</strong> para implementar las operaci&oacute;n de
modificaci&oacute;n o de consulta:</p>
<pre class="code">
public CreditCardFactory (Properties properties) throws IOException {
   String certFilename = properties.getProperty("PublicKeyFilename");
   try {
       <strong>// Acceder a la clave p&uacute;blica</strong>
        FileInputStream fis = new FileInputStream(certFilename);
        java.security.cert.CertificateFactory cf =
            java.security.cert.CertificateFactory.getInstance("X.509");
        java.security.cert.Certificate cert =
             cf.generateCertificate(fis);
        fis.close();
        <strong>mPublicKey = cert.getPublicKey();</strong>
   } catch (Exception e) {
        e.printStackTrace();
        throw new IOException(e.getMessage());
   }
   <strong>// Crear objeto de operacion de base de datos</strong>
   <strong>mDBOperations = new DatabaseOperations(properties);</strong>
}
</pre>
</div>

<a name="N101C3"></a><a name="Modificando+y+Consultando+la+BD"></a>
<h2 class="underlined_10">Modificando y Consultando la BD</h2>
<div class="section">
<p>Finalmente vamos a ver dos programas de aplicaci&oacute;n que permiten
a&ntilde;adir y consultar tarjetas de cr&eacute;dito. El primero de ellos es
<a href="ejercicios/sesion1/CreateTest.java.txt">CreateTest.java</a> y
simplemente lee el fichero de propiedades, crea un
<strong>CreditCardFactory</strong> y almancena el n&uacute;mero de cuenta y la
tarjeta que se le pasan por teclado:</p>
<pre class="code">
...
<strong>// Cargar propiedades.</strong>
Properties properties = new Properties();
FileInputStream fis = new FileInputStream(PROPERTIES_FILE);
properties.load(fis);
fis.close();

<strong>// Crear la tarjeta.</strong>
CreditCardFactory factory = new CreditCardFactory(properties);
CreditCard creditCard = factory.createCreditCard(id,ccNumber);
...
</pre>
<p>Para probar esta aplicaci&oacute;n nos situaremos en el directorio en
donde tenemos los ficheros <em>config.properties</em>,
<em>publica.cer</em> y <em>tarjetas.ks</em>. All&iacute; tenemos todos los
ficheros *.java y hacemos lo siguiente para construir el
package:</p>
<p>
<em>javac -d *.java</em>
</p>
<p>Asumiendo que tenenos el fichero <em>jar</em> del JDBC en el
<em>CLASSPATH</em> o bien accesible en <em>$JAVA_HOME/jre/lib/ext</em>,
teclearemos el comando</p>
<p>
<em>java com.projavasecurity.ecommerce.CreateTest 1 "1234 5678
9012 3456"</em>
</p>
<p>Posteriormente haremos desde <em>mysql</em> haremos</p>
<pre class="code">
USE projava;
SELECT * FROM credit_card;
</pre>
<p>para ver los campos <strong>session_key</strong> y <strong>cc_number</strong>, que
deber&aacute;n aparecer encriptados.</p>
<p>Para listar la informaci&oacute;n desencriptada de todas las tarjetas
de la BD, recurriremos a la aplicaci&oacute;n <a href="ejercicios/sesion1/ViewTest.java.txt">ViewTest.java</a>. Dicha
aplicaci&oacute;n consulta, en primer lugar, el <em>keystore</em>
<em>tarjetas.ks</em>. Para ello hay que suministrar el password
correcto para el almac&eacute;n. Entonces extrae la clave privada para
poder desencriptar la clave sesi&oacute;n que a su vez ha permitido
encriptar los datos de las tarjetas. Despu&eacute;s crea un
<strong>CreditCardFactory</strong> con las <strong>Properties</strong> y despu&eacute;s llama
al m&eacute;todo <strong>findAllCreditCards()</strong> pas&aacute;ndole la clave privada.
Este m&eacute;todo funciona haciendo sucesivas llamadas al m&eacute;todo
<strong>findCreditCard()</strong> y recogiendo el resultado en un iterador.
Este iterador es el que se usa aqu&iacute; para ir mostrando todas las
tarjetas:</p>
<pre class="code">

<strong>// Cargar el keystore y obtener la clave privada.</strong>
String ksType = KeyStore.getDefaultType();
KeyStore ks = KeyStore.getInstance(ksType);
FileInputStream fis = new FileInputStream(KEYSTORE);
ks.load(fis,PASSWORD);
fis.close();
PrivateKey privateKey = (PrivateKey)ks.getKey("mykey",PASSWORD);

<strong>// Cargar las properties</strong>
Properties properties = new Properties();
fis = new FileInputStream(PROPERTIES_FILE);
properties.load(fis);
fis.close();

<strong>// Crear un CreditCardFactory.</strong>
CreditCardFactory factory = new CreditCardFactory(properties);

<strong>// Coger todas las tarjetas</strong>
Iterator iterator = factory.findAllCreditCards(privateKey);

<strong>// Mostrar las tarjetas</strong>
while(iterator.hasNext()) {
   CreditCard creditCard = (CreditCard)iterator.next();
   System.out.println("\nAccount ID: "+creditCard.getAccountID());
   System.out.println("CC Number: "+creditCard.getCreditCardNumber());
}
...
</pre>
<p>Para probar esta aplicaci&oacute;n teclearemos</p>
<p>
<em>java com.projavasecurity.ecommerce.ViewTest</em>
</p>
</div>

<p class="pageBreakAfter"></p>

</div>
<div class="clearboth">&nbsp;</div>
</div>
<div id="footer">
<div class="lastmodified">
<script type="text/javascript"><!--
document.write("<text>Last Published:</text> " + document.lastModified);
//  --></script>
</div>
<div class="copyright">
        Copyright &copy;
         2006 Depto. CCIA</div>
</div>
</body>
</html>
