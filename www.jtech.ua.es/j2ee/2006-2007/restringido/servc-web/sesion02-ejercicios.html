<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<META http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta content="Apache Forrest" name="Generator">
<meta name="Forrest-version" content="0.7">
<meta name="Forrest-skin-name" content="pelt">
<title>Ejercicios de creaci&oacute;n de Servicios Web</title>
<link type="text/css" href="skin/basic.css" rel="stylesheet">
<link media="screen" type="text/css" href="skin/screen.css" rel="stylesheet">
<link media="print" type="text/css" href="skin/print.css" rel="stylesheet">
<link type="text/css" href="skin/profile.css" rel="stylesheet">
<script src="skin/getBlank.js" language="javascript" type="text/javascript"></script><script src="skin/getMenu.js" language="javascript" type="text/javascript"></script><script src="skin/fontsize.js" language="javascript" type="text/javascript"></script>
<link rel="shortcut icon" href="">
</head>
<body onload="init()">
<script type="text/javascript">ndeSetTextSize();</script>
<div id="top">
<div class="header">
<div class="grouplogo">
<a href="http://www.jtech.ua.es/j2ee"><img class="logoImage" alt="J2EE" src="images/baner_j2ee_izq.gif" title="Curso Especialista Universitario J2EE"></a>
</div>
<div class="projectlogoA1">
<a href="http://www.dccia.ua.es/"><img class="logoImage" alt="Servicios Web" src="images/baner_j2ee_der.gif" title="Servicios Web"></a>
</div>
<ul id="tabs">
<li>
<a class="base-not-selected" href="../index.html">M&oacute;dulos</a>
</li>
<li class="current">
<a class="base-selected" href="index.html">Servicios Web</a>
</li>
</ul>
</div>
</div>
<div id="main">
<div id="publishedStrip">
<div id="level2tabs"></div>
<script type="text/javascript"><!--
document.write("<text>Last Published:</text> " + document.lastModified);
//  --></script>
</div>
<div class="breadtrail">
             
             &nbsp;
           </div>
<div id="menu">
<div onclick="SwitchMenu('menu_selected_1.1', 'skin/')" id="menu_selected_1.1Title" class="menutitle" style="background-image: url('skin/images/chapter_open.gif');">Servicios Web</div>
<div id="menu_selected_1.1" class="selectedmenuitemgroup" style="display: block;">
<div class="menuitem">
<a href="index.html" title="Servicios Web">&Iacute;ndice</a>
</div>
<div onclick="SwitchMenu('menu_1.1.2', 'skin/')" id="menu_1.1.2Title" class="menutitle">Teor&iacute;a</div>
<div id="menu_1.1.2" class="menuitemgroup">
<div class="menuitem">
<a href="sesion01-apuntes.html">Sesion 1</a>
</div>
<div class="menuitem">
<a href="sesion02-apuntes.html">Sesion 2</a>
</div>
<div class="menuitem">
<a href="sesion03-apuntes.html">Sesion 3</a>
</div>
<div class="menuitem">
<a href="sesion04-apuntes.html">Sesion 4</a>
</div>
<div class="menuitem">
<a href="roadmap-apuntes.html" title="Roadmap">Roadmap</a>
</div>
</div>
<div onclick="SwitchMenu('menu_selected_1.1.3', 'skin/')" id="menu_selected_1.1.3Title" class="menutitle" style="background-image: url('skin/images/chapter_open.gif');">Ejercicios</div>
<div id="menu_selected_1.1.3" class="selectedmenuitemgroup" style="display: block;">
<div class="menuitem">
<a href="sesion01-ejercicios.html">Sesion 1</a>
</div>
<div class="menupage">
<div class="menupagetitle">Sesion 2</div>
</div>
<div class="menuitem">
<a href="sesion03-ejercicios.html">Sesion 3</a>
</div>
<div class="menuitem">
<a href="sesion04-ejercicios.html">Sesion 4</a>
</div>
</div>
</div>
<div id="credit"></div>
<div id="roundbottom">
<img style="display: none" class="corner" height="15" width="15" alt="" src="skin/images/rc-b-l-15-1body-2menu-3menu.png"></div>
<div id="credit2"></div>
</div>
<div id="content">
<div title="Portable Document Format" class="pdflink">
<a class="dida" href="sesion02-ejercicios.pdf"><img alt="PDF -icon" src="skin/images/pdfdoc.gif" class="skin"><br>
        PDF</a>
</div>
<h1>Ejercicios de creaci&oacute;n de Servicios Web</h1>
<div id="minitoc-area">
<ul class="minitoc">
<li>
<a href="#Creaci%C3%B3n+de+un+servicio+web+b%C3%A1sico">Creaci&oacute;n de un servicio web b&aacute;sico</a>
</li>
<li>
<a href="#Invocar+un+servicio+web+desde+otro+servicio">Invocar un servicio web desde otro servicio</a>
</li>
<li>
<a href="#Validaci%C3%B3n+de+NIFs+%28*%29">Validaci&oacute;n de NIFs (*)</a>
</li>
<li>
<a href="#Tienda+de+DVDs+%28*%29">Tienda de DVDs (*)</a>
</li>
</ul>
</div>



<div class="frame note">
<div class="label">Nota</div>
<div class="content">En las plantillas de la sesi&oacute;n se incluyen &uacute;nicamente los ejemplos vistos en los apuntes. Para realizar 
los ejercicios estas plantillas no son necesarias.</div>
</div>


<a name="N1000F"></a><a name="Creaci%C3%B3n+de+un+servicio+web+b%C3%A1sico"></a>
<h2 class="underlined_10">Creaci&oacute;n de un servicio web b&aacute;sico</h2>
<div class="section">
<p>Vamos a comenzar creando un servicio web b&aacute;sico. Este servicio web ser&aacute; un <em>Hola
Mundo</em> en forma de servicio. Tendr&aacute; como nombre <span class="codefrag">HolaMundoSW</span> y 
una &uacute;nica operaci&oacute;n <span class="codefrag">String saluda(nombre)</span>, que nos devolver&aacute; un mensaje
de saludo incluyendo el nombre proporcionado. Por ejemplo, si al par&aacute;metro de entrada 
<span class="codefrag">nombre</span> le damos como valor <span class="codefrag">"Miguel"</span>, como salida producir&aacute; la cadena
<span class="codefrag">"Hola Miguel"</span>.</p>
<p>Implementar el servicio utilizando BEA Workshop, en un proyecto con nombre
<span class="codefrag">servcweb-sesion02-hola</span>, y probarlo con <em>WebLogic Test
Client</em> para comprobar su correcto funcionamiento.</p>
</div>


<a name="N10034"></a><a name="Invocar+un+servicio+web+desde+otro+servicio"></a>
<h2 class="underlined_10">Invocar un servicio web desde otro servicio</h2>
<div class="section">
<p>Vamos a implementar con BEA Workshop un servicio de conversi&oacute;n monetaria que nos permita convertir
entre euros y ptas y entre euros y d&oacute;lares. Este servicio deber&aacute; llamarse <span class="codefrag">ConversionSW</span>, y 
estar&aacute; dentro de un proyecto con nombre <span class="codefrag">servcweb-sesion02-conversion</span>.</p>
<div class="frame note">
<div class="label">Nota</div>
<div class="content">En los apuntes de teor&iacute;a se puede encontrar una gu&iacute;a paso a paso para
crear este servicio.</div>
</div>
<p>Se pide:</p>
<p>
<em>a)</em> Implementar las operaciones de conversi&oacute;n de euros a ptas y de ptas a euros. Dado que 
conocemos que la tasa de cambio es fija (1 euro = 166.386 ptas) podemos implementar directamente estas 
operaciones:</p>
<pre class="code">double <strong>ptas2euro</strong>(int ptas)
int <strong>euro2ptas</strong>(double euros)</pre>
<p>Probar que estas operaciones funcionan correctamente en <em>WebLogic Test Client</em>.</p>
<p>
<em>b)</em> Ahora implementaremos funciones para convertir una cantidad de euros a d&oacute;lares y de d&oacute;lares 
a euros:</p>
<pre class="code">double <strong>dolar2euro</strong>(double dolar)
double <strong>euro2dolar</strong>(double euros)</pre>
<p>En este caso necesitaremos recurrir a un servicio externo para obtener la tasa de cambio actual. 
Utilizaremos el servicio <em>Currency Exchange Service</em> de <em>XMethods</em>. Utilizar controles
para acceder a este servicio remoto, cuyo documento WSDL se puede encontrar en:</p>
<pre class="code">http://www.xmethods.net/sd/2001/CurrencyExchangeService.wsdl</pre>
</div>


<a name="N1007B"></a><a name="Validaci%C3%B3n+de+NIFs+%28*%29"></a>
<h2 class="underlined_10">Validaci&oacute;n de NIFs (*)</h2>
<div class="section">
<p>Vamos a implementar un servicio con una serie de m&eacute;todos que nos permitan validar 
un NIF. El servicio tendr&aacute; como nombre <span class="codefrag">ValidaDniSW</span>, y estar&aacute; dentro
de un proyecto <span class="codefrag">servcweb-sesion02-dni</span>. Se pide:</p>
<p>
<em>a)</em> Implementar la siguiente operaci&oacute;n:</p>
<pre class="code">boolean validarDni(String dni)</pre>
<p>Esta funci&oacute;n tomar&aacute; como entrada un DNI, y como salida nos dir&aacute; si es correcto 
o no. El resultado ser&aacute; <span class="codefrag">true</span> si el DNI es correcto (est&aacute; formado por 
8 d&iacute;gitos), y <span class="codefrag">false</span> en caso contrario. Podemos utilizar un c&oacute;digo
similar al siguiente para validar el DNI:</p>
<pre class="code">Pattern pattern =  Pattern.compile("[0-9]{8,8}");
Matcher matcher = pattern.matcher(dni);
return matcher.matches();</pre>
<p>
<em>b)</em> Implementar la siguiente operaci&oacute;n:</p>
<pre class="code">char obtenerLetra(String dni)</pre>
<p>Esta funci&oacute;n tomar&aacute; como entrada un DNI, y como salida nos dir&aacute; la letra que 
corresponde a dicho DNI. Lo primero que deber&aacute; hacer es validar el DNI (puede 
utilizar para ello el m&eacute;todo definido en el apartado anterior), y en caso de 
no ser correcto lanzar&aacute; una excepci&oacute;n de tipo <span class="codefrag">SOAPFaultException</span> 
indicando el mensaje de error adecuado. Una vez validado, calcularemos 
la letra que corresponda al DNI. Para ello deberemos:</p>
<ul>

<li>Obtener el &iacute;ndice de la letra correspondiente con:</li>

</ul>
<pre class="code">dni % 23</pre>
<ul>

<li>La letra ser&aacute; el car&aacute;cter de la siguiente cadena que est&eacute; en la posici&oacute;n 
obtenida anteriormente:</li>

</ul>
<pre class="code">"TRWAGMYFPDXBNJZSQVHLCKE"</pre>
<p>
<em>c)</em> Implementar la siguiente operaci&oacute;n:</p>
<pre class="code">boolean validarNif(String nif)</pre>
<p>Esta funci&oacute;n tomar&aacute; como entrada un NIF, y como salida nos dir&aacute; si es correcto 
o no. El resultado ser&aacute; <span class="codefrag">true</span> si el NIF es correcto (est&aacute; formado por 
8 d&iacute;gitos seguidos de la letra correcta), y <span class="codefrag">false</span> en caso contrario. 
Para hacer esta comprobaci&oacute;n se pueden utilizar las dos funciones anteriores: se 
comprobar&aacute;n los 8 primeros caracteres con la funci&oacute;n <span class="codefrag">validarDni</span> y 
posteriormente se comprobar&aacute; si la letra es la correcta utilizando la funci&oacute;n 
<span class="codefrag">obtenerLetra</span>.</p>
</div>




<a name="N100DC"></a><a name="Tienda+de+DVDs+%28*%29"></a>
<h2 class="underlined_10">Tienda de DVDs (*)</h2>
<div class="section">
<p>
  Nuestro negocio consiste en una tienda que 
  vende pel&iacute;culas en DVD a trav&eacute;s de Internet. Para dar una mayor 
  difusi&oacute;n a nuestro cat&aacute;logo de pel&iacute;culas, decidimos implantar 
  una serie de Servicios Web para acceder a informaci&oacute;n sobre las pel&iacute;culas 
  que vendemos.</p>
<p>De cada pel&iacute;cula ofreceremos informaci&oacute;n sobre su t&iacute;tulo, 
  su director y su precio. Esta informaci&oacute;n podemos codificarla en una 
  clase <span class="codefrag">DatosPelicula</span> como la siguiente:</p>
<pre class="code">public class <strong>DatosPelicula</strong> {
  private String titulo;
  private String director;
  private float precio;
   
  public DatosPelicula() {}
   
  public DatosPelicula(String titulo, String director, float precio) {
    this.titulo = titulo;
    this.director = director;
    this.precio = precio;
  }

  // Getters y setters
  ...
}</pre>
<p>Vamos a permitir que se busquen pel&iacute;culas proporcionando el nombre de 
  su director. Por lo tanto, el servicio ofrecer&aacute; una operaci&oacute;n 
  como la siguiente:</p>
<pre class="code">DatosPelicula [] <strong>buscaDirector</strong>(String director)</pre>
<p>Proporcionaremos el nombre del director, y nos devolver&aacute; la lista de 
  pel&iacute;culas disponibles dirigidas por este director.</p>
<p>En un principio, podemos crear una lista est&aacute;tica de pel&iacute;culas 
  dentro del c&oacute;digo de nuestro servicio, como por ejemplo:</p>
<pre class="code">final static DatosPelicula[] peliculas = {
    new DatosPelicula("Mulholland Drive", "David Lynch", 26.96f),
    new DatosPelicula("Carretera perdida", "David Lynch", 18.95f),
    new DatosPelicula("Twin Peaks", "David Lynch", 46.95f),
    new DatosPelicula("Telefono rojo", "Stanley Kubrick", 15.95f),
    new DatosPelicula("Barry Lyndon", "Stanley Kubrick", 24.95f),
    new DatosPelicula("La naranja mec&aacute;nica", "Stanley Kubrick", 22.95f) 
};</pre>
<p>Se pide:</p>
<p>
  
<em>a)</em> Implementar el servicio utilizando BEA Workshop. El servicio se llamar&aacute; 
  <span class="codefrag">TiendaDvdSW</span>, y estar&aacute; dentro de un proyecto con nombre 
  <span class="codefrag">servcweb-sesion02-tienda</span>.
  </p>
<p>Para construir una lista con las pel&iacute;culas cuyo director coincida con 
  el nombre del director que se ha solicitado, podemos utilizar un c&oacute;digo 
  similar al siguiente, donde se ha proporcionado un par&aacute;metro <span class="codefrag">director</span>:</p>
<pre class="code">director = director.toLowerCase();
   
ArrayList&lt;DatosPelicula&gt; list = new ArrayList&lt;DatosPelicula&gt;();
   
for (DatosPelicula pelicula : peliculas) {
  if (pelicula.getDirector().toLowerCase().indexOf(director) != -1) {
    list.add(pelicula);
  }
}
   
DatosPelicula [] result = new DatosPelicula[list.size()];
list.toArray(result);
   
return result;</pre>
<p>Una vez implementado el servicio, desplegarlo en Weblogic y probarlo mediante 
<em>Weblogic test client</em>. Observar los tipos de datos definidos en el documento 
WSDL generado y en los mensajes SOAP para la invocaci&oacute;n del servicio.</p>
<p>
<em>b)</em> Vamos a implementar una segunda operaci&oacute;n en nuestro servicio:</p>
<pre class="code">DatosPelicula [] <strong>buscaDirectorImportacion</strong>(String director)</pre>
<p>En este caso no obtendr&aacute; la lista de pel&iacute;culas de nuestra base de datos local, sino que
las buscar&aacute; en Amazon mediante los servicios web que ofrece esta compa&ntilde;&iacute;a.</p>
<p>Generar los tipos de datos para acceder al servicio de Amazon mediante JAX-RPC, para obtener
una representaci&oacute;n m&aacute;s parecida a la vista en los ejercicios del tema anterior. De esta forma 
podremos utilizar un c&oacute;digo similar para acceder al servicio, con la diferencia de que una 
vez obtenidos los datos, en lugar de imprimirlos en la consola los encapsularemos en una 
serie de objetos <span class="codefrag">DatosPelicula</span> que devolveremos como resultado.</p>
<div class="frame note">
<div class="label">Nota</div>
<div class="content">No debemos devolver directamente el objeto que nos devuelve el servicio de Amazon, ya
que debido a su complejidad el cliente de prueba de Weblogic no es capaz de interpretarlo correctamente
y obtendr&iacute;amos un error.</div>
</div>
</div>



<p class="pageBreakAfter"></p>


</div>
<div class="clearboth">&nbsp;</div>
</div>
<div id="footer">
<div class="lastmodified">
<script type="text/javascript"><!--
document.write("<text>Last Published:</text> " + document.lastModified);
//  --></script>
</div>
<div class="copyright">
        Copyright &copy;
         2007 Depto. CCIA</div>
</div>
</body>
</html>
