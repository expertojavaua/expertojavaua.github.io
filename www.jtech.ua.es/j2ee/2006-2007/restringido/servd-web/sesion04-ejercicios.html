<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<META http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta content="Apache Forrest" name="Generator">
<meta name="Forrest-version" content="0.7">
<meta name="Forrest-skin-name" content="pelt">
<title>Ejercicios de herramientas para aplicaciones web</title>
<link type="text/css" href="skin/basic.css" rel="stylesheet">
<link media="screen" type="text/css" href="skin/screen.css" rel="stylesheet">
<link media="print" type="text/css" href="skin/print.css" rel="stylesheet">
<link type="text/css" href="skin/profile.css" rel="stylesheet">
<script src="skin/getBlank.js" language="javascript" type="text/javascript"></script><script src="skin/getMenu.js" language="javascript" type="text/javascript"></script><script src="skin/fontsize.js" language="javascript" type="text/javascript"></script>
<link rel="shortcut icon" href="">
</head>
<body onload="init()">
<script type="text/javascript">ndeSetTextSize();</script>
<div id="top">
<div class="header">
<div class="grouplogo">
<a href="http://www.jtech.ua.es/j2ee"><img class="logoImage" alt="J2EE" src="images/baner_j2ee_izq.gif" title="Curso Especialista Universitario J2EE"></a>
</div>
<div class="projectlogoA1">
<a href="http://www.dccia.ua.es/"><img class="logoImage" alt="Servidores Web" src="images/baner_j2ee_der.gif" title="Servidores Web"></a>
</div>
<ul id="tabs">
<li>
<a class="base-not-selected" href="../index.html">M&oacute;dulos</a>
</li>
<li class="current">
<a class="base-selected" href="index.html">Servidores Web</a>
</li>
</ul>
</div>
</div>
<div id="main">
<div id="publishedStrip">
<div id="level2tabs"></div>
<script type="text/javascript"><!--
document.write("<text>Last Published:</text> " + document.lastModified);
//  --></script>
</div>
<div class="breadtrail">
             
             &nbsp;
           </div>
<div id="menu">
<div onclick="SwitchMenu('menu_selected_1.1', 'skin/')" id="menu_selected_1.1Title" class="menutitle" style="background-image: url('skin/images/chapter_open.gif');">Servidores Web</div>
<div id="menu_selected_1.1" class="selectedmenuitemgroup" style="display: block;">
<div class="menuitem">
<a href="index.html" title="Servidores Web">&Iacute;ndice</a>
</div>
<div onclick="SwitchMenu('menu_1.1.2', 'skin/')" id="menu_1.1.2Title" class="menutitle">Teor&iacute;a</div>
<div id="menu_1.1.2" class="menuitemgroup">
<div class="menuitem">
<a href="sesion01-apuntes.html">Sesion 1</a>
</div>
<div class="menuitem">
<a href="sesion02-apuntes.html">Sesion 2</a>
</div>
<div class="menuitem">
<a href="sesion03-apuntes.html">Sesion 3</a>
</div>
<div class="menuitem">
<a href="sesion04-apuntes.html">Sesion 4</a>
</div>
<div class="menuitem">
<a href="roadmap-apuntes.html">Roadmap</a>
</div>
</div>
<div onclick="SwitchMenu('menu_selected_1.1.3', 'skin/')" id="menu_selected_1.1.3Title" class="menutitle" style="background-image: url('skin/images/chapter_open.gif');">Ejercicios</div>
<div id="menu_selected_1.1.3" class="selectedmenuitemgroup" style="display: block;">
<div class="menuitem">
<a href="sesion01-ejercicios.html">Sesion 1</a>
</div>
<div class="menuitem">
<a href="sesion02-ejercicios.html">Sesion 2</a>
</div>
<div class="menuitem">
<a href="sesion03-ejercicios.html">Sesion 3</a>
</div>
<div class="menupage">
<div class="menupagetitle">Sesion 4</div>
</div>
</div>
</div>
<div id="credit"></div>
<div id="roundbottom">
<img style="display: none" class="corner" height="15" width="15" alt="" src="skin/images/rc-b-l-15-1body-2menu-3menu.png"></div>
<div id="credit2"></div>
</div>
<div id="content">
<div title="Portable Document Format" class="pdflink">
<a class="dida" href="sesion04-ejercicios.pdf"><img alt="PDF -icon" src="skin/images/pdfdoc.gif" class="skin"><br>
        PDF</a>
</div>
<h1>Ejercicios de herramientas para aplicaciones web</h1>
<div id="minitoc-area">
<ul class="minitoc">
<li>
<a href="#Definir+un+servidor+web+en+WebTools">Definir un servidor web en WebTools</a>
</li>
<li>
<a href="#Creaci%C3%B3n+y+prueba+de+un+proyecto+web">Creaci&oacute;n y prueba de un proyecto web</a>
</li>
<li>
<a href="#Configuraci%C3%B3n+de+un+pooling+de+conexiones+en+una+aplicaci%C3%B3n+web">Configuraci&oacute;n de un pooling de conexiones en una aplicaci&oacute;n web</a>
</li>
<li>
<a href="#Configuraci%C3%B3n+del+logging+en+una+aplicaci%C3%B3n+web">Configuraci&oacute;n del logging en una aplicaci&oacute;n web</a>
</li>
<li>
<a href="#%28*%29+Pruebas+en+aplicaciones+web+con+Cactus">(*) Pruebas en aplicaciones web con Cactus</a>
</li>
<li>
<a href="#PARA+ENTREGAR">PARA ENTREGAR</a>
</li>
</ul>
</div>


<a name="N1000C"></a><a name="Definir+un+servidor+web+en+WebTools"></a>
<h2 class="underlined_10">Definir un servidor web en WebTools</h2>
<div class="section">
<p>Vamos a ir construyendo y probando una aplicaci&oacute;n web compleja utilizando WebTools. Para ello, lo primero que tenemos que hacer es tener nuestro servidor web configurado para poderlo utilizar desde WebTools.</p>
<p>Este primer ejercicio consiste en que definas un nuevo servidor Tomcat 5.5 en la vista <em>Servers</em> de la perspectiva J2EE (si no lo tienes ya creado), siguiendo los pasos que se explican en la parte de teor&iacute;a.</p>
</div>


<p>
<strong>Importante:</strong> En los siguientes ejercicios iremos creando poco a poco un proyecto de aplicaci&oacute;n web, y a&ntilde;adiendo funcionalidades. En cada paso, se te pedir&aacute; que incorpores al proyecto determinados ficheros que se te proporcionan en la plantilla. Procura copiar SOLO los ficheros que se te indican, y no los dem&aacute;s, hasta que se te requieran, para evitar que la aplicaci&oacute;n funcione incorrectamente.</p>


<a name="N10021"></a><a name="Creaci%C3%B3n+y+prueba+de+un+proyecto+web"></a>
<h2 class="underlined_10">Creaci&oacute;n y prueba de un proyecto web</h2>
<div class="section">
<p>A continuaci&oacute;n, crearemos un proyecto web din&aacute;mico (<em>Dynamic Web Project</em>), con el nombre <strong>servd-web-sesion4</strong>. En el asistente para crearlo, pondremos como <em>Context Root</em> (paso 3 del asistente), <strong>sw04</strong>, y dejaremos que nos cree las carpetas por defecto de <span class="codefrag">src</span> y <span class="codefrag">WebContent</span>.</p>
<p>Una vez lo tenemos creado, vamos a ir copiando en los lugares respectivos los siguientes ficheros que tenemos en la plantilla:</p>
<ul>
		
<li>Crea un paquete llamado <strong><span class="codefrag">es.ua.jtech.servdweb.sesion4</span></strong> en la carpeta <strong><span class="codefrag">src</span></strong>
</li>
		
<li>Copia en ese paquete los ficheros Java <strong><span class="codefrag">ConversorServlet</span></strong>, <strong><span class="codefrag">BDServlet</span></strong> y <strong><span class="codefrag">LoggingServlet</span></strong> de la plantilla. Son dos servlets que tendr&aacute;s que cargar m&aacute;s adelante.</li>
		
<li>Copia el fichero <strong><span class="codefrag">index.htm</span></strong> en <strong><span class="codefrag">WebContent</span></strong>
</li>
		
<li>Copia el fichero <strong><span class="codefrag">web.xml</span></strong> de la plantilla en la carpeta <strong><span class="codefrag">WebContent/WEB-INF</span></strong>
</li>
		
<li>Copia los ficheros JAR (<strong><span class="codefrag">commons-logging-1.1.jar</span></strong> y <strong><span class="codefrag">log4j-1.2.8.jar</span></strong>) en la carpeta <strong><span class="codefrag">WebContent/WEB-INF/lib</span></strong>, y el fichero <strong><span class="codefrag">mysql-connector-java-5.0.3-bin.jar</span></strong> en la carpeta <strong><span class="codefrag">common/lib</span></strong> de Tomcat</li>
	
</ul>
<p>Posiblemente tendr&aacute;s que a&ntilde;adir al <em>Build Path</em> del proyecto la librer&iacute;a <span class="codefrag">commons-logging-1.1.jar</span> que hemos copiado antes, para que compile el servlet <span class="codefrag">LoggingServlet</span>.</p>
<p>Una vez lo tengas todo en su sitio y no haya errores, despliega la aplicaci&oacute;n en el servidor de prueba. Para ello, ve con el bot&oacute;n derecho del rat&oacute;n sobre el proyecto, y eliges <em>Run - Run As - Run on Server</em>.</p>
<p>Deber&iacute;a aparecer la p&aacute;gina <span class="codefrag">index.htm</span> en un navegador, con el conversor de euros a pesetas visto en otros ejemplos.</p>
</div>


<a name="N1009F"></a><a name="Configuraci%C3%B3n+de+un+pooling+de+conexiones+en+una+aplicaci%C3%B3n+web"></a>
<h2 class="underlined_10">Configuraci&oacute;n de un pooling de conexiones en una aplicaci&oacute;n web</h2>
<div class="section">
<p>Sobre la aplicaci&oacute;n web que tenemos ya creada del ejercicio anterior, vamos a hacer las siguientes modificaciones:</p>
<ul>
		
<li>Crea una carpeta <strong><span class="codefrag">bd</span></strong> en la carpeta ra&iacute;z del proyecto</li>
		
<li>Copia en esta carpeta los ficheros <strong><span class="codefrag">prueba.sql</span></strong> y <strong><span class="codefrag">build.xml</span></strong> de la carpeta <strong><span class="codefrag">bd</span></strong>  de la plantilla (&iexcl;OJO! No copies a&uacute;n el fichero <span class="codefrag">build.xml</span> de la ra&iacute;z de la plantilla. Ese se te pedir&aacute; m&aacute;s adelante).</li>
		
<li>Ejecuta el script <span class="codefrag">build.xml</span> que acabas de copiar, para que instale la base de datos en el servidor MySQL de tu m&aacute;quina</li>
		
<li>Crea un fichero <strong><span class="codefrag">context.xml</span></strong> en la carpeta <strong><span class="codefrag">WebContent/META-INF</span></strong> del proyecto, con los elementos necesarios para configurar el pooling. Adem&aacute;s, a&ntilde;ade en el fichero <strong><span class="codefrag">web.xml</span></strong> de <strong><span class="codefrag">WebContent/WEB-INF</span></strong> una etiqueta <strong><span class="codefrag">resource-ref</span></strong> con las subetiquetas necesarias para referenciar al pooling creado en el fichero <span class="codefrag">context.xml</span> anterior, tal y como se ha explicado en el apartado de teor&iacute;a. Llama al pooling (atributo <span class="codefrag">name</span>), <strong><span class="codefrag">jdbc/prueba</span></strong>.</li>
		
<li>Vuelve a ejecutar la aplicaci&oacute;n web sobre el servidor, y carga la p&aacute;gina <strong><span class="codefrag">http://localhost:8080/sw04/paginabd</span></strong>. Deber&iacute;a mostrar un listado de nombres y descripciones que existen en la base de datos <span class="codefrag">prueba</span> que acabas de instalar.</li>
	
</ul>
</div>


<a name="N100F6"></a><a name="Configuraci%C3%B3n+del+logging+en+una+aplicaci%C3%B3n+web"></a>
<h2 class="underlined_10">Configuraci&oacute;n del logging en una aplicaci&oacute;n web</h2>
<div class="section">
<p>La clase <span class="codefrag">LoggingServlet</span> que instalaste en el segundo ejercicio es un servlet que saca unos mensajes de log, pero como la aplicaci&oacute;n no est&aacute; configurada, no podemos tener control sobre estos mensajes. Se pide:</p>
<ul>
		
<li>Crea una carpeta de fuentes llamada <strong><span class="codefrag">resources</span></strong> en el proyecto web.</li>
		
<li>
			
<p>Crea en ella dos ficheros, <strong><span class="codefrag">commons-logging.properties</span></strong> y <strong><span class="codefrag">log4j.properties</span></strong>, para que, utilizando Log4J, saque por pantalla los mensajes de log de nivel INFO en adelante, y con el siguiente formato:</p>
			
<p>Prioridad del mensaje - Texto del mensaje - Fecha y hora (formato dd/MM/aa hh:mm) - salto de l&iacute;nea</p>
		
</li>
	
</ul>
<p>Para probar el servlet, accede a la direcci&oacute;n <span class="codefrag">http://localhost:8080/sw04/logging</span>
</p>
</div>


<a name="N10123"></a><a name="%28*%29+Pruebas+en+aplicaciones+web+con+Cactus"></a>
<h2 class="underlined_10">(*) Pruebas en aplicaciones web con Cactus</h2>
<div class="section">
<p>Finalmente, vamos a incorporar un servlet y su caso de prueba (ambos ya implementados) a nuestra aplicaci&oacute;n, y a configurar Cactus para que podamos ejecutar el caso de prueba. Para ello, los pasos a seguir son:</p>
<ul>
		
<li>Copia la clase <strong><span class="codefrag">PruebaServlet</span></strong> de la plantilla al paquete de servlets que ya tienes en <strong><span class="codefrag">src</span></strong>
</li>
		
<li>Crea una carpeta de fuentes llamada <strong><span class="codefrag">test</span></strong>, y copia en ella la clase <strong><span class="codefrag">PruebaServletTest</span></strong> de la plantilla. Este ser&aacute; el caso de prueba del servlet que acabas de copiar.</li>
		
<li>Copia todos los ficheros JAR de la carpeta <strong><span class="codefrag">cactus</span></strong> de la plantilla a la carpeta <strong><span class="codefrag">WebContent/WEB-INF/lib</span></strong>. Son las librer&iacute;as que necesitar&aacute;s para poder ejecutar las pruebas de Cactus. A&ntilde;&aacute;delas tambi&eacute;n al <em>Build Path</em> del proyecto, para poder compilar y ejecutar las pruebas.</li>
		
<li>Crea un fichero <strong><span class="codefrag">cactus.properties</span></strong> en la carpeta <strong><span class="codefrag">resources</span></strong> que indique la ruta de contexto de la aplicaci&oacute;n a probar:
			<pre class="code">cactus.contextURL=http://localhost:8080/sw04</pre>
		
</li>
		
<li>
			
<p>A&ntilde;ade al fichero <strong><span class="codefrag">Web-Content/WEB-INF/web.xml</span></strong> las l&iacute;neas necesarias para definir los redirectores que usar&aacute; Cactus:</p>
			
<pre class="code">&lt;filter&gt;
	&lt;filter-name&gt;FilterRedirector&lt;/filter-name&gt;
	&lt;filter-class&gt;org.apache.cactus.server.FilterTestRedirector&lt;/filter-class&gt;
&lt;/filter&gt;
&lt;filter-mapping&gt;
	&lt;filter-name&gt;FilterRedirector&lt;/filter-name&gt;
	&lt;url-pattern&gt;/FilterRedirector&lt;/url-pattern&gt;
&lt;/filter-mapping&gt;
&lt;servlet&gt;
	&lt;servlet-name&gt;ServletRedirector&lt;/servlet-name&gt;
	&lt;servlet-class&gt;org.apache.cactus.server.ServletTestRedirector&lt;/servlet-class&gt;
&lt;/servlet&gt;
&lt;servlet&gt;
	&lt;servlet-name&gt;JspRedirector&lt;/servlet-name&gt;
	&lt;jsp-file&gt;/jspRedirector.jsp&lt;/jsp-file&gt;
&lt;/servlet&gt;
&lt;servlet-mapping&gt;
	&lt;servlet-name&gt;ServletRedirector&lt;/servlet-name&gt;
	&lt;url-pattern&gt;/ServletRedirector&lt;/url-pattern&gt;
&lt;/servlet-mapping&gt;
&lt;servlet-mapping&gt;
	&lt;servlet-name&gt;JspRedirector&lt;/servlet-name&gt;
	&lt;url-pattern&gt;/JspRedirector&lt;/url-pattern&gt;
&lt;/servlet-mapping&gt;</pre>
		
</li>
		
<li>Det&eacute;n el servidor en la vista <em>Servers</em>. Ejecuta ahora de nuevo la aplicaci&oacute;n web (haz un <em>Run on Server</em>) para rearrancarlo todo.</li>
		
<li>Ejecuta la clase <span class="codefrag">PruebaServletTest</span> como un test de JUnit (<em>Run As - JUnit test</em>) y comprueba que las pruebas son satisfactorias.</li>
	
</ul>
</div>


<a name="N10182"></a><a name="PARA+ENTREGAR"></a>
<h2 class="underlined_10">PARA ENTREGAR</h2>
<div class="section">
<p>Como entrega de esta sesi&oacute;n, empaqueta en un fichero ZIP el proyecto web din&aacute;mico que has creado, con todas las funcionalidades que hayas ido a&ntilde;adiendo a lo largo de todos estos ejercicios.</p>
</div>


<p class="pageBreakAfter"></p>

</div>
<div class="clearboth">&nbsp;</div>
</div>
<div id="footer">
<div class="lastmodified">
<script type="text/javascript"><!--
document.write("<text>Last Published:</text> " + document.lastModified);
//  --></script>
</div>
<div class="copyright">
        Copyright &copy;
         2006 Depto. CCIA</div>
</div>
</body>
</html>
