<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<META http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta content="Apache Forrest" name="Generator">
<meta name="Forrest-version" content="0.7">
<meta name="Forrest-skin-name" content="pelt">
<title>Ejercicios de configuraci&oacute;n de Tomcat y aplicaciones web</title>
<link type="text/css" href="skin/basic.css" rel="stylesheet">
<link media="screen" type="text/css" href="skin/screen.css" rel="stylesheet">
<link media="print" type="text/css" href="skin/print.css" rel="stylesheet">
<link type="text/css" href="skin/profile.css" rel="stylesheet">
<script src="skin/getBlank.js" language="javascript" type="text/javascript"></script><script src="skin/getMenu.js" language="javascript" type="text/javascript"></script><script src="skin/fontsize.js" language="javascript" type="text/javascript"></script>
<link rel="shortcut icon" href="">
</head>
<body onload="init()">
<script type="text/javascript">ndeSetTextSize();</script>
<div id="top">
<div class="header">
<div class="grouplogo">
<a href="http://web.ua.es/especialistajava"><img class="logoImage" alt="jtech" src="images/baner_j2ee_izq.gif" title="Especialista Universitario Java Enterprise"></a>
</div>
<div class="projectlogoA1">
<a href="http://www.dccia.ua.es/"><img class="logoImage" alt="Servidores Web" src="images/baner_j2ee_der.gif" title="Servidores Web"></a>
</div>
<ul id="tabs">
<li>
<a class="base-not-selected" href="javascript:location.href='../index.html'">Home</a>
</li>
<li>
<a class="base-not-selected" href="javascript:location.href='../aplic-web.html'">Aplicaciones Web</a>
</li>
<li>
<a class="base-not-selected" href="javascript:location.href='../aplic-ent.html'">Aplicaciones Enterprise</a>
</li>
<li>
<a class="base-not-selected" href="javascript:location.href='../charlas.html'">Charlas</a>
</li>
<li>
<a class="base-not-selected" href="javascript:location.href='../proy-int/index.html'">Proyecto</a>
</li>
<li class="current">
<a class="base-selected" href="index.html">Servidores Web</a>
</li>
</ul>
</div>
</div>
<div id="main">
<div id="publishedStrip">
<div id="level2tabs"></div>
<script type="text/javascript"><!--
document.write("<text>Last Published:</text> " + document.lastModified);
//  --></script>
</div>
<div class="breadtrail">
             
             &nbsp;
           </div>
<div id="menu">
<div onclick="SwitchMenu('menu_selected_1.1', 'skin/')" id="menu_selected_1.1Title" class="menutitle" style="background-image: url('skin/images/chapter_open.gif');">Servidores Web</div>
<div id="menu_selected_1.1" class="selectedmenuitemgroup" style="display: block;">
<div class="menuitem">
<a href="index.html" title="Servidores Web">&Iacute;ndice</a>
</div>
<div onclick="SwitchMenu('menu_1.1.2', 'skin/')" id="menu_1.1.2Title" class="menutitle">Teor&iacute;a</div>
<div id="menu_1.1.2" class="menuitemgroup">
<div class="menuitem">
<a href="sesion01-apuntes.html">Sesion 1</a>
</div>
<div class="menuitem">
<a href="sesion02-apuntes.html">Sesion 2</a>
</div>
<div class="menuitem">
<a href="sesion03-apuntes.html">Sesion 3</a>
</div>
<div class="menuitem">
<a href="sesion04-apuntes.html">Sesion 4</a>
</div>
<div class="menuitem">
<a href="roadmap-apuntes.html">Roadmap</a>
</div>
</div>
<div onclick="SwitchMenu('menu_selected_1.1.3', 'skin/')" id="menu_selected_1.1.3Title" class="menutitle" style="background-image: url('skin/images/chapter_open.gif');">Ejercicios</div>
<div id="menu_selected_1.1.3" class="selectedmenuitemgroup" style="display: block;">
<div class="menuitem">
<a href="sesion01-ejercicios.html">Sesion 1</a>
</div>
<div class="menupage">
<div class="menupagetitle">Sesion 2</div>
</div>
<div class="menuitem">
<a href="sesion03-ejercicios.html">Sesion 3</a>
</div>
<div class="menuitem">
<a href="sesion04-ejercicios.html">Sesion 4</a>
</div>
</div>
</div>
<div id="credit"></div>
<div id="roundbottom">
<img style="display: none" class="corner" height="15" width="15" alt="" src="skin/images/rc-b-l-15-1body-2menu-3menu.png"></div>
<div id="credit2"></div>
</div>
<div id="content">
<div title="Portable Document Format" class="pdflink">
<a class="dida" href="sesion02-ejercicios.pdf"><img alt="PDF -icon" src="skin/images/pdfdoc.gif" class="skin"><br>
        PDF</a>
</div>
<h1>Ejercicios de configuraci&oacute;n de Tomcat y aplicaciones web</h1>
<div id="minitoc-area">
<ul class="minitoc">
<li>
<a href="#Uso+de+Eclipse+WTP+%281+punto%29">Uso de Eclipse WTP (1 punto)</a>
</li>
<li>
<a href="#Configuraci%C3%B3n+a+trav%C3%A9s+del+web.xml+%280.5+puntos%29">Configuraci&oacute;n a trav&eacute;s del web.xml (0.5 puntos)</a>
</li>
<li>
<a href="#Configuraci%C3%B3n+de+fuentes+de+datos+%281.5+puntos%29">Configuraci&oacute;n de fuentes de datos (1.5 puntos) </a>
</li>
<li>
<a href="#Configuraci%C3%B3n+con+el+contexto+%281+punto%29">Configuraci&oacute;n con el contexto (1 punto)</a>
</li>
</ul>
</div>


<a name="N1000C"></a><a name="Uso+de+Eclipse+WTP+%281+punto%29"></a>
<h2 class="underlined_10">Uso de Eclipse WTP (1 punto)</h2>
<div class="section">
<p>Vamos a desplegar la aplicaci&oacute;n de comentarios de la sesi&oacute;n anterior a trav&eacute;s de Eclipse WebTools. Para ello:</p>
<ol>
	
<li>
<strong>Crearemos una nueva instancia del servidor Tomcat:</strong> Con la opci&oacute;n <em>File &gt; New &gt; Other &gt; (carpeta Server) &gt; Server</em> crearemos una
	instancia de Tomcat dentro de Eclipse. En el cuadro de di&aacute;logo que aparecer&aacute; simplemente tenemos que asegurarnos de elegir Tomcat v6.0, el resto de par&aacute;metros
	los podemos dejar por defecto.
	<p>
	
<img alt="Creaci&oacute;n de nueva instancia de Tomcat con Eclipse WTP" content-width="12cm" src="imagenes/ejercicios/ejer2_1.jpg" width="500">
	</p> 
	En el <span class="codefrag">Project Explorer</span> deber&iacute;a aparecer el nuevo servidor entre nuestros proyectos, en una carpeta llamada <span class="codefrag">Servers</span>.</li>
	
<li>
<strong>Crearemos un proyecto de Eclipse de tipo Dynamic Web Project:</strong>. 
	<ul>
	
<li>En la primera pantalla del asistente le damos el nombre: <span class="codefrag">comentarios</span>
	y nos aseguramos de que como <span class="codefrag">Target runtime</span> tenga el Apache Tomcat 6.0.</li>
	
<li>En la segunda pantalla no hace falta modificar nada, nos basta con una sola carpeta de c&oacute;digo Java</li>
	
<li>En la tercera pantalla tampoco es necesario cambiar nada. No obstante aqu&iacute; podr&iacute;amos cambiar el "contexto" de la aplicaci&oacute;n, que formar&aacute; parte
	de su URL y por defecto es igual al nombre del proyecto. Es decir, que para acceder a este proyecto habr&iacute;a que ir a <span class="codefrag">http://localhost:8080/comentarios</span>. </li>
	
</ul> 
</li>
	
<li>
<strong>Copiamos el contenido de la aplicaci&oacute;n en el proyecto de Eclipse:</strong>
	
<ul>
	
<li>El HTML y el fichero JSP son p&aacute;ginas web y por tanto las copiaremos a <span class="codefrag">WebContent</span>
</li>
	
<li>Crearemos un package <span class="codefrag">es.ua.jtech</span> y dentro de &eacute;l colocaremos las dos clases que hay en la plantilla dentro de la carpeta <span class="codefrag">java</span>.</li>
	
<li>Copiamos el fichero <span class="codefrag">WEB-INF/web.xml</span> sobreescribiendo el mismo archivo del proyecto de Eclipse (WEB-INF en Eclipse est&aacute; dentro de WebContent)</li>
	
</ul>
	
</li>
	
<li>
<strong>Ejecutamos el proyecto despleg&aacute;ndolo en Tomcat</strong>: bot&oacute;n derecho sobre el proyecto y seleccionar <em>Run as &gt; Run on server</em>. En la primera pantalla del 
	asistente elegimos el servidor que hemos creado antes. En la segunda aparecer&aacute; la lista de proyectos que se van a desplegar en el servidor (solo aparecer&aacute; este). Pasados unos segundos aparecer&aacute; el navegador
	con la URL <span class="codefrag">http://localhost:8080/comentarios</span> abierta. Fijaos en que se muestra un mensaje HTTP 404 de "p&aacute;gina no encontrada" porque la aplicaci&oacute;n no tiene configurada una p&aacute;gina principal. <strong>Esto lo solucionaremos
	en el siguiente ejercicio</strong>. Por el momento acceded manualmente a la p&aacute;gina "comentarios.jsp" (la URL completa ser&aacute; <span class="codefrag">http://localhost:8080/comentarios</span>). Probad la aplicaci&oacute;n insertando alg&uacute;n comentario y
	comprobando que se muestra correctamente.</li>
	
</ol>
</div>
	

<a name="N10077"></a><a name="Configuraci%C3%B3n+a+trav%C3%A9s+del+web.xml+%280.5+puntos%29"></a>
<h2 class="underlined_10">Configuraci&oacute;n a trav&eacute;s del web.xml (0.5 puntos)</h2>
<div class="section">
<p>En el ejercicio anterior vimos que la aplicaci&oacute;n carece de p&aacute;gina "principal". Vamos a solucionar esto configurando
	la p&aacute;gina <span class="codefrag">comentarios.jsp</span> como "principal". En el web.xml hay una secci&oacute;n llamada <span class="codefrag">welcome-file-list</span>
	que lista las p&aacute;ginas que el servidor debe buscar cuando se llame a la aplicaci&oacute;n sin especificar la p&aacute;gina a mostrar.
	A&ntilde;adir <span class="codefrag">comentarios.jsp</span> a esta lista y comprobar que funciona adecuadamente, es decir que al llamar a
	<span class="codefrag">http://localhost:8080/comentarios</span> aparece dicha p&aacute;gina. Ser&aacute; necesario rearrancar el servidor, ya que los cambios en 
	el web.xml no se detectan mientras Tomcat est&aacute; funcionando. </p>
</div>


<a name="N1008D"></a><a name="Configuraci%C3%B3n+de+fuentes+de+datos+%281.5+puntos%29"></a>
<h2 class="underlined_10">Configuraci&oacute;n de fuentes de datos (1.5 puntos) </h2>
<div class="section">
<p>En las plantillas de la sesi&oacute;n est&aacute;n los archivos necesarios para crear un nuevo proyecto de Eclipse de la aplicaci&oacute;n de comentarios pero ahora almacenando
	la informaci&oacute;n en una base de datos en lugar de en memoria</p>
<ol>
	
<li>Crea otro proyecto web din&aacute;mico llamado <span class="codefrag">comentariosBD</span>, y copia en el lugar adecuado la p&aacute;gina <span class="codefrag">comentarios.jsp</span>
	y los fuentes Java de <span class="codefrag">AddComentario</span>, <span class="codefrag">ComentariosDAO</span> y <span class="codefrag">FuenteDatos</span>
</li>
	
<li>El fichero <span class="codefrag">comentarios.sql</span> contiene el script de creaci&oacute;n de la base de datos. Desde una ventana
	 de terminal, cambia al directorio donde est&eacute; el script .sql y crea la base de datos escribiendo
	 <pre class="code">mysql -u root -p &lt; comentarios.sql (te pedir&aacute; el password: especialista)</pre>
	 
</li>
	
<li>Crea un context.xml en la carpeta META-INF del proyecto y configura en &eacute;l la conexi&oacute;n con la base de datos. Ay&uacute;date del ejemplo de los apuntes</li>
	
<li>La clase <span class="codefrag">FuenteDatos</span> es la que da acceso al DataSource. Rellena el c&oacute;digo para que
	en el constructor de la clase se instancie el DataSource busc&aacute;ndolo con el API JNDI y se asigne a la variable est&aacute;tica <span class="codefrag">ds</span>.</li>
	
<li>Copia el <a href="recursos/mysql-connector-java-5.1.13-bin.jar">driver de MySQL</a> al directorio <span class="codefrag">lib</span> de Tomcat</li>
	
<li>Arranca el proyecto en Tomcat y comprueba que funciona correctamente. Con el MySQL Query Browser puedes comprobar si al insertar un comentario este aparece en la BD.</li>
	
</ol>
</div>


<a name="N100CE"></a><a name="Configuraci%C3%B3n+con+el+contexto+%281+punto%29"></a>
<h2 class="underlined_10">Configuraci&oacute;n con el contexto (1 punto)</h2>
<div class="section">
<p>Vamos a configurar la aplicaci&oacute;n a trav&eacute;s de su contexto. Si has hecho el ejercicio anterior usa la aplicaci&oacute;n "comentariosBD", si no usa la aplicaci&oacute;n "comentarios". Lo m&aacute;s recomendable es crear la configuraci&oacute;n
	en un fichero <span class="codefrag">context.xml</span> contenido en un directorio <span class="codefrag">META-INF</span> de nuestro proyecto.</p>
<ul>
		
<li>Definir un <span class="codefrag">Valve</span> para registrar &uacute;nicamente los accesos a la aplicaci&oacute;n de comentarios. Dichos accesos deben quedar registrados en el directorio <strong>accesos</strong> dentro del principal de Tomcat. El nombre del fichero de accesos debe comenzar por <strong>comentarios</strong> y tener extensi&oacute;n <strong>".log"</strong>. Probar a hacer peticiones para ver c&oacute;mo quedan registrados los accesos.</li>
		
			
	
</ul>
</div>




<p class="pageBreakAfter"></p>

</div>
<div class="clearboth">&nbsp;</div>
</div>
<div id="footer">
<div class="lastmodified">
<script type="text/javascript"><!--
document.write("<text>Last Published:</text> " + document.lastModified);
//  --></script>
</div>
<div class="copyright">
        Copyright &copy;
         2010-11 Dpto. Ciencia de la Computaci&oacute;n e IA</div>
</div>
</body>
</html>
