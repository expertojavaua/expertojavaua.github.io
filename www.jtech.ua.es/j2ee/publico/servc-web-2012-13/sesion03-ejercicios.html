<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<META http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta content="Apache Forrest" name="Generator">
<meta name="Forrest-version" content="0.7">
<meta name="Forrest-skin-name" content="pelt">
<title>Ejercicios de Orquestaci&oacute;n de servicios BPEL</title>
<link type="text/css" href="skin/highlight/shCore.css" rel="stylesheet">
<link type="text/css" href="skin/highlight/shThemeEclipse.css" rel="stylesheet">
<script src="skin/highlight/shCore.js" type="text/javascript"></script><script src="skin/highlight/shAutoloader.js" type="text/javascript"></script>
<link type="text/css" href="skin/basic.css" rel="stylesheet">
<link media="screen" type="text/css" href="skin/screen.css" rel="stylesheet">
<link media="print" type="text/css" href="skin/print.css" rel="stylesheet">
<link type="text/css" href="skin/profile.css" rel="stylesheet">
<script src="skin/getBlank.js" language="javascript" type="text/javascript"></script><script src="skin/getMenu.js" language="javascript" type="text/javascript"></script><script src="skin/fontsize.js" language="javascript" type="text/javascript"></script>
<link rel="shortcut icon" href="">
</head>
<body onload="init()">
<script type="text/javascript">ndeSetTextSize();</script>
<div id="top">
<div class="header">
<div class="grouplogo">
<a href="http://web.ua.es/especialistajava"><img class="logoImage" alt="jtech" src="images/baner_j2ee_izq.gif" title="Especialista Universitario Java Enterprise"></a>
</div>
<div class="projectlogoA1">
<a href="http://www.dccia.ua.es/"><img class="logoImage" alt="Servicios Web y SOA" src="images/baner_j2ee_der.gif" title="Servicios Web y SOA"></a>
</div>
<ul id="tabs">
<li>
<a class="base-not-selected" href="javascript:location.href='../index.html'">Home</a>
</li>
<li>
<a class="base-not-selected" href="javascript:location.href='../aplic-web.html'">Aplicaciones Web</a>
</li>
<li>
<a class="base-not-selected" href="javascript:location.href='../aplic-ent.html'">Aplicaciones Enterprise</a>
</li>
<li>
<a class="base-not-selected" href="javascript:location.href='../proy-int/index.html'">Proyecto</a>
</li>
<li class="current">
<a class="base-selected" href="index.html">Servicios Web</a>
</li>
</ul>
</div>
</div>
<div id="main">
<div id="publishedStrip">
<div id="level2tabs"></div>
<script type="text/javascript"><!--
document.write("<text>Last Published:</text> " + document.lastModified);
//  --></script>
</div>
<div class="breadtrail">
             
             &nbsp;
           </div>
<div id="menu">
<div onclick="SwitchMenu('menu_selected_1.1', 'skin/')" id="menu_selected_1.1Title" class="menutitle" style="background-image: url('skin/images/chapter_open.gif');">Servicios Web</div>
<div id="menu_selected_1.1" class="selectedmenuitemgroup" style="display: block;">
<div class="menuitem">
<a href="index.html" title="Servicios Web">&Iacute;ndice</a>
</div>
<div onclick="SwitchMenu('menu_1.1.2', 'skin/')" id="menu_1.1.2Title" class="menutitle">Teor&iacute;a</div>
<div id="menu_1.1.2" class="menuitemgroup">
<div class="menuitem">
<a href="sesion01-apuntes.html">Sesion 1</a>
</div>
<div class="menuitem">
<a href="sesion02-apuntes.html">Sesion 2</a>
</div>
<div class="menuitem">
<a href="sesion03-apuntes.html">Sesion 3</a>
</div>
<div class="menuitem">
<a href="sesion04-apuntes.html">Sesion 4</a>
</div>
</div>
<div onclick="SwitchMenu('menu_selected_1.1.3', 'skin/')" id="menu_selected_1.1.3Title" class="menutitle" style="background-image: url('skin/images/chapter_open.gif');">Ejercicios</div>
<div id="menu_selected_1.1.3" class="selectedmenuitemgroup" style="display: block;">
<div class="menuitem">
<a href="sesion01-ejercicios.html">Sesion 1</a>
</div>
<div class="menuitem">
<a href="sesion02-ejercicios.html">Sesion 2</a>
</div>
<div class="menupage">
<div class="menupagetitle">Sesion 3</div>
</div>
<div class="menuitem">
<a href="sesion04-ejercicios.html">Sesion 4</a>
</div>
</div>
</div>
<div id="credit"></div>
<div id="roundbottom">
<img style="display: none" class="corner" height="15" width="15" alt="" src="skin/images/rc-b-l-15-1body-2menu-3menu.png"></div>
<div id="credit2"></div>
</div>
<div id="content">
<div title="Portable Document Format" class="pdflink">
<a class="dida" href="sesion03-ejercicios.pdf"><img alt="PDF -icon" src="skin/images/pdfdoc.gif" class="skin"><br>
        PDF</a>
</div>
<h1>Ejercicios de Orquestaci&oacute;n de servicios BPEL</h1>
<div id="minitoc-area">
<ul class="minitoc">
<li>
<a href="#Pasos+previos+con+Netbeans">Pasos previos con Netbeans</a>
</li>
<li>
<a href="#Creamos+el+proyecto+BPEL">Creamos el proyecto BPEL</a>
</li>
<li>
<a href="#WSDL+y+esquema+de+nombres+del+proyecto+BPEL">WSDL y esquema de nombres del proyecto BPEL</a>
</li>
<li>
<a href="#L%C3%B3gica+del+proceso+BPEL">L&oacute;gica del proceso BPEL</a>
</li>
<li>
<a href="#Desplegamos+el+proyecto+en+el+servidor+de+aplicaciones">Desplegamos el proyecto en el servidor de aplicaciones</a>
</li>
<li>
<a href="#Creamos+un+conductor+de+pruebas">Creamos un conductor de pruebas</a>
</li>
<li>
<a href="#Ejecutamos+las+pruebas+sobre">Ejecutamos las pruebas sobre SynchronousSampleApplication</a>
</li>
<li>
<a href="#Cambios+en+la+l%C3%B3gica+de+negocio">Cambios en la l&oacute;gica de negocio</a>
</li>
</ul>
</div>


<p>Vamos a crear desarrollar, desplegar y probar un sencillo servicio Bpel utilizando <em>Netbeans</em>.
  Para ello seguiremos los pasos que hemos indicado en esta sesi&oacute;n. En este caso, se trata de un proceso BPEL
  s&iacute;ncrono que simplemente recibe un mensaje de entrada y, en funci&oacute;n de su contenido, devuelve una respuesta
  u otra al cliente. Concretamente, el mensaje de entrada consiste en una cadena de caracteres. Si dicha cadena
  tiene el valor 
</p>

<p>El cliente, despu&eacute;s de invocar al proceso BPEL, permanece bloqueado hasta que el proceso termine y
  devuelva el resultado.    (1,5p)
</p>  


<a name="N10017"></a><a name="Pasos+previos+con+Netbeans"></a>
<h2 class="underlined_10">Pasos previos con Netbeans</h2>
<div class="section">
<p>En esta sesi&oacute;n y en la siguiente, vamos a utilizar una versi&oacute;n de Netbeans 7.1 que incluye los plugins necesarios
   para poder crear y editar proyectos BPEL, as&iacute; como proyectos <em>Composite Application</em>, necesarios para 
   poder desplegar nuestro proyecto BPEL como un componente JBI en el servidor de aplicaciones. El IDE con
   la que vamos a trabajar est&aacute; disponible en la m&aacute;quina virtual en:</p>
<pre class="brush:plain;">     /opt/SOA/bin/netbeans
</pre>
<p>Tendr&eacute;is que instalar el <strong>plugin de JUnit</strong> para que puedan ejecutarse los <em>tests</em> de las <em>Composite Applications</em>.
  Para instalar dicho plugin, hay que hacerlo desde <em>Desde Tools-&gt;Plugins-Available Plugins</em>
</p>
<p>En la pesta&ntilde;a "Servers" pod&eacute;is ver que tenemos disponible un segundo servidor de <strong>glassfish (versi&oacute;n 2.x)</strong>. 
   &Eacute;sta es la versi&oacute;n que vamos a utilizar para trabajar con BPEL. El servidor de glassfish 2.x tiene instadado el 
   <strong><em>runtime</em> de JBI</strong>, necesario para poder desplegar nuestro proyecto BPEL. Lo primero que
   haremos ser&aacute; poner el marcha dicho servidor. Entonces podremos ver el componente JBI, que contiene las m&aacute;quinas de servicios
   (<em>service engines</em>), componentes de enlazado (<em>binding components</em>) y
   los ensamblados de servicios (<em>service assemblies)</em>
   
</p>
<p>
<img alt="Servidor Glassfish v2.x con en runtime JBI" content-width="5cm" src="imagenes/sesion3/glassfish-v2.png" width="267">
</p>
<p>Podemos abrir la consola de administraci&oacute;n del servidor de aplicaciones en la direcci&oacute;n:</p>
<pre class="brush:plain;">http://localhost:4848</pre>
<p>Por defecto, los datos para acceder a la consola son:</p>
<pre class="brush:plain;">     User Name: admin
     Password: adminadmin
</pre>
</div>


<a name="N10063"></a><a name="Creamos+el+proyecto+BPEL"></a>
<h2 class="underlined_10">Creamos el proyecto BPEL</h2>
<div class="section">
<p>La mejor forma de familiarizarnos con la construcci&oacute;n de diagramas BPEL es crear un 
  proyecto ejemplo (<em>sample project</em>). <em>Netbeans</em> permite generar dos tipos de
  proyectos ejemplo: s&iacute;ncrono y as&iacute;ncrono. El IDE genera un proyecto esqueleto, con los ficheros
  <em>wsdl</em> y <em>xsd</em> que podremos modificar a nuestra conveniencia.
</p>
<table class="ForrestTable" cellspacing="1" cellpadding="4">

<tr>

<td colspan="1" rowspan="1"><img alt="Plantilla del proyecto BPEL esqueleto s&iacute;ncrono generado" content-width="6cm" height="262" src="imagenes/sesion5/proyectoBPEL.gif" width="261"></td>
<td colspan="1" rowspan="1">

<p>Para crear un nuevo proyecto ejemplo BPEL:</p>

<ul>
  
<li>Elegimos <em>File-&gt;New Project.</em>
</li>
  
<li>En la lista <em>Categories</em>, expandimos el nodo <em>Samples</em> y elegimos
    <em>Service Oriented Architecture</em>.</li>
  
<li>En la lista <em>Projects</em>, seleccionamos el proyecto <em>Synchronous BPEL process</em>.
    </li>
  
<li>Especificamos el nombre y la ubicaci&oacute;n del proyecto. Podemos dejar como nombre del proyecto
    <em>SynchronousSample</em>.</li>        

</ul>

<p>Cuando creamos un proyecto BPEL ejemplo, autom&aacute;ticamente se genera el proyecto de aplicaciones
  compuestas, y autom&aacute;ticamente se a&ntilde;ade el proyecto del m&oacute;dulo BPEL como un m&oacute;dulo JBI en
  el proyecto <em>Composite Application</em>.
</p>

</td>

</tr>

</table>
<p>El proyecto BPEL tiene una serie de propiedades, a las que podemos acceder pulsando con el bot&oacute;n derecho
  sobre el nodo del proyecto (en la ventana <em>Projects</em>), y seleccionando <em>Properties</em>
  del men&uacute; emergente. En este caso, nos aparecer&aacute; un cuadro en el que podemos acceder a varias 
  p&aacute;ginas:</p>
<ul>
  
<li>
<strong>General</strong>: muestra la ruta de directorios de los ficheros del proyecto, entre otros elementos</li>
  
<li>
<strong>Referencias del proyecto</strong>: muestra otros proyectos BPEL referenciados por nuestro proyecto BPEL</li>
  
<li>
<strong>Cat&aacute;logo XML</strong>: muestra las entradas del cat&aacute;logo XML usado en el proyecto BPEL. Los 
     cat&aacute;logos XML proporcionan informaci&oacute;n de mapeo entre una entidad externa en un documento XML y la localizaci&oacute;n real
     del documento que est&aacute; siendo referenciado.</li>

</ul>
</div>


<a name="N100D5"></a><a name="WSDL+y+esquema+de+nombres+del+proyecto+BPEL"></a>
<h2 class="underlined_10">WSDL y esquema de nombres del proyecto BPEL</h2>
<div class="section">
<p>En este caso, al utilizar una plantilla para el proceso BPEL s&iacute;ncrono, <em>Netbeans</em>
   ha creado por nostros el fichero WSDL y el esquema de nombres.</p>
<p>Los ficheros WSDL pueden visualizarse de tres formas: podemos ver el c&oacute;digo fuente 
   (<em>Source view</em>), podemos verlo en forma de &aacute;rbol de componentes(<em>WSDL view</em>), o 
   de forma gr&aacute;fica (<em>Partner view</em>).
</p>
<p>La siguiente figura muestra la vista gr&aacute;fica del fichero WSDL creado:</p>
<p>
<img alt="Vista gr&aacute;fica del fichero WSDL generado" content-width="11cm" height="302" src="imagenes/sesion5/wsdlSincrono.gif" width="653">
</p>
<p>Podemos ver que el fichero WSDL contiene una definici&oacute;n de <em>partnerLinkType</em>, que define
   el rol <em>partnerlinktyperole1</em>, asociado al <em>portType</em> <em>portType1</em>. Tambi&eacute;n
  hay definidos dos mensajes: uno de entrada (<em>requestMessage</em>), y otro de salida 
  (<em>responseMessage</em>), que contienen una cadena de caracteres.</p>
<p>
<img alt="Definici&oacute;n de partnerlinktype en el WSDL" content-width="11cm" src="imagenes/sesion5/wsdlPartnerLinkType.png" width="688">  </p>
<p>El fichero de definici&oacute;n de esquema es opcional en un proyecto BPEL. En este caso <em>Netbeans</em>
  tambi&eacute;n lo ha generado por nostros. Al igual que ocurre con los ficheros WSDL, los ficheros de esquema
  tienen tres vistas diferentes: c&oacute;digo fuente (<em>Source view</em>), &aacute;rbol de componentes(<em>Schema view</em>), 
  y vista gr&aacute;fica (<em>Design view</em>). En la siguiene figura se muestra la vista gr&aacute;fica del fichero
  <em>xsd</em> creado:
</p>
<p>
<img alt="Vista gr&aacute;fica del fichero xsd generado" content-width="7cm" height="322" src="imagenes/sesion5/xsdSincrono.gif" width="342">
</p>
<p>Podemos ver que se ha definido el tipo <em>typeA</em>, que es un elemento del tipo complejo <em>simpleProcess</em>, 
   que a su vez es una cadena de caracteres</p>
<p>En caso de que tuvi&eacute;semos que crear nosotros los ficheros WSDL y de esquema, el proceso que se 
   sigue es similar en ambos casos, tal y como ya hemos visto en sesiones anteriores:</p>
<ul>
  
<li>Crear un nuevo documento: pinchamos con el bot&oacute;n derecho del rat&oacute;n sobre el nodo <em>Process Files</em> y 
     elegimos <em>New-&gt;WSDL Document</em>, o <em>New-&gt;Other/XML/XML Schema</em>.</li>
  
<li>Desde la vista gr&aacute;fica, a&ntilde;adimos componentes arrastr&aacute;ndolos desde la ventana <em>Palette</em>
     a la vista grafica.</li>
  
<li>Desde la vista de &aacute;rbol, a&ntilde;adimos componentes y pinchamos con el bot&oacute;n derecho sobre nodo
     del tipo de componente que queremos a&ntilde;adir, y elegimos el opci&oacute;n <em>Add ...</em> correspondiente
     del men&uacute; emergente</li>
  
<li>Desde la vista de fuente, escribimos el c&oacute;digo en el editor de texto</li>      

</ul>
</div>  


<a name="N1015C"></a><a name="L%C3%B3gica+del+proceso+BPEL"></a>
<h2 class="underlined_10">L&oacute;gica del proceso BPEL</h2>
<div class="section">
<p>
<em>Netbeans</em> ha creado un proceso BPEL s&iacute;ncrono muy sencillo, que podremos modificar seg&uacute;n
  nos interese. En el caso de que tuvi&eacute;semos que crearlo nosotros, tendr&iacute;amos que hacerlo pinchando con
  el bot&oacute;n derecho del rat&oacute;n sobre el nodo <em>Process Files</em> y despu&eacute;s elegir <em>New-&gt;BPEL Process</em> en
  el men&uacute; emergente.</p>
<p>El proceso BPEL presenta tres vistas: c&oacute;digo fuente (<em>Source</em>), vista gr&aacute;fica (<em>Design</em>), y
   vista de mapeado (<em>Mapper</em>). Utilizaremos esta &uacute;ltima vista m&aacute;s adelante. 
   La <strong>vista de dise&ntilde;o</strong>
   (o vista gr&aacute;fica) que se ha generado de forma autom&aacute;tica es la siguiente:</p>
<p>
<img alt="Vista de dise&ntilde;o del proceso BPEL s&iacute;ncrono generado" content-width="9cm" src="imagenes/sesion5/bpelSincrono.png" width="534">
</p>
<p>En el caso de que tuvi&eacute;semos que crear nosotros el proceso BPEL desde cero, tendr&iacute;amos que ir a&ntilde;adiendo
  elementos arrastr&aacute;ndolos desde la ventana <em>Palette</em> hasta la vista de dise&ntilde;o del proceso BPEL.
</p>
<table class="ForrestTable" cellspacing="1" cellpadding="4">

<tr>

<td colspan="1" rowspan="1"><img alt="Paleta de componentes BPEL" content-width="5cm" src="imagenes/sesion5/paletaBPEL.gif" width="187"></td>
<td colspan="1" rowspan="1">

<p>La <strong>paleta de componentes</strong> nos muestra los elementos que podemos insertar en el proceso BPEL,
  clasificados en tres categor&iacute;as:</p>

<ul>
  
<li>Servicios Web: en donde encontramos las actividades <em>Invoque</em>, <em>Receive</em>,
     <em>Reply</em> y el componente <em>PartnerLink</em>
</li>
  
<li>Actividades b&aacute;sicas: <em>Assign</em>, <em>Empty</em>, <em>Wait</em>, <em>Throw</em> y
     <em>Exit</em>
</li>
  
<li>Actividades estructuradas: <em>If</em>, <em>While</em>, <em>Sequence</em>,...
    </li>       

</ul>

</td>

</tr>

</table>
<p>A continuaci&oacute;n mostramos el <strong>c&oacute;digo fuente</strong> generado por <em>Netbeans</em>:</p>
<pre class="brush:xml;"> 
&lt;?xml version="1.0" encoding="UTF-8"?&gt;

&lt;process 
  name="SynchronousSample" 
  targetNamespace="http://enterprise.netbeans.org/bpel/
    				SynchronousSample/SynchronousSample_1"
  xmlns="http://docs.oasis-open.org/wsbpel/2.0/process/executable"
  xmlns:xsd="http://www.w3.org/2001/XMLSchema"
  xmlns:bpws="http://docs.oasis-open.org/wsbpel/2.0/process/executable"
  xmlns:wsdlNS="http://enterprise.netbeans.org/bpel/
    				SynchronousSample/SynchronousSample_1" 
  xmlns:ns1="http://localhost/SynchronousSample/SynchronousSample"

    &lt;import location="SynchronousSample.xsd" 
    	importType="http://www.w3.org/2001/XMLSchema" 
        namespace="http://xml.netbeans.org/schema/SynchronousSample"/&gt;
        
    &lt;import namespace=
            "http://localhost/SynchronousSample/SynchronousSample" 
        location="SynchronousSample.wsdl" 
        importType="http://schemas.xmlsoap.org/wsdl/"/&gt;

    &lt;partnerLinks&gt;
        &lt;partnerLink name="SynchronousSample" 
        		partnerLinkType="ns1:partnerlinktype1" 
                myRole="partnerlinktyperole1"/&gt;
    &lt;/partnerLinks&gt;

    &lt;variables&gt;
        &lt;variable name="outputVar" messageType="ns1:responseMessage"/&gt;
        &lt;variable name="inputVar" messageType="ns1:requestMessage"/&gt;
    &lt;/variables&gt;

    &lt;sequence&gt;
        &lt;receive name="start" 
                 partnerLink="SynchronousSample" 
                 operation="operation1" 
                 portType="ns1:portType1" 
                 variable="inputVar" createInstance="yes"/&gt;
        &lt;assign name="Assign1"&gt;
            &lt;copy&gt;
              &lt;from&gt;$inputVar.inputType/paramA&lt;/from&gt;
              &lt;to&gt;$outputVar.resultType/paramA&lt;/to&gt;
            &lt;/copy&gt;
        &lt;/assign&gt;
        &lt;reply name="end" 
               partnerLink="SynchronousSample" 
               operation="operation1" 
               portType="ns1:portType1" 
               variable="outputVar"/&gt;
    &lt;/sequence&gt;
&lt;/process&gt;

</pre>
<p>Seg&uacute;n el c&oacute;digo fuente anterior, podemos ver que la l&oacute;gica del proceso de negocio consiste
  en esperar a recibir una llamada del <em>partner link</em> cliente sobre la operaci&oacute;n
  <em>operation1</em>, con el mensaje de entrada <em>inputVar</em>. Una vez que el proceso BPEL
  ha sido invocado por un cliente, asignamos el valor del mensaje de entrada en el mensaje de
  salida, denominado <em>outputVar</em> y se lo enviamos al cliente utilizando la actividad <em>reply</em>

</p>
<p>
<strong>A&ntilde;adimos una actividad <em>if</em></strong>
</p>
<p>Vamos a modificar este proceso inicial <strong>a&ntilde;adiendo una actividad <em>if</em></strong> en la vista de
  dise&ntilde;o. Para ello:</p>
<ul>
  
<li>Elegimos la actividad estructurada <em>if</em> de la paleta de componentes y la arrastramos   
     a la vista de dise&ntilde;o del proceso BPEL, situ&aacute;ndolo entre las actividades <em>Start</em> y
     <em>Assign</em>. Esto nos crear&aacute; una actividad <em>if</em> denominada <em>if1</em> en la
     vista de dise&ntilde;o. (El IDE nos indica d&oacute;nde podemos situar los elementos que arrastramos
     mediante dos c&iacute;rculos conc&eacute;ntricos, coloreando el m&aacute;s peque&ntilde;o).</li>
  
<li>Pinchamos dos veces sobre la actividad <em>if1</em> y aparecer&aacute; la ventana de mapeado (<em>BPEL Mapper</em>).
      Otra forma de acceder a la ventana de mapeado es, teniendo el componente <em>if1</em> seleccionado
      (podemos ver que un componente est&aacute; seleccionado proque aparece enmarcado en un rect&aacute;ngulo verde con bordes
     redondeados), simplemente cambiamos a la vista <em>Mapper</em>.
     Usaremos la ventana de mapeado para definir una condici&oacute;n booleana.</li>     
  
  
<li>En el panel de la izquierda vemos  las variables de nuestro proceso BPEL. En el panel de la derecha
      nos aparece una condici&oacute;n booleana asociada a la actividad if. Seleccionamos la condici&oacute;n booleana con el
      bot&oacute;n izquierdo del rat&oacute;n, as&iacute; como el elemento <em>paramA</em> de la variable <em>inputVar</em> 
     
<p>
<img alt="Ventana de mapeado de BPEL" content-width="12cm" src="imagenes/sesion5/bpelMapper.png" width="681">
     </p>      
  
</li>
  
<li>En la barra de men&uacute;s, pinchamos en <em>Operator</em> y seleccionamos la funci&oacute;n <em>EQUAL</em> en el 
     men&uacute; emergente. La funci&oacute;n <em>equal</em> aparecer&aacute; en la parte central de la ventana de mapeado.
     Dicha funci&oacute;n tiene asociados dos conectores de entrada y uno de salida (representados con forma de puntas de
     flecha).</li>
  
<li>En la barra de men&uacute;s, pinchamos sobre la funci&oacute;n <em>String</em> y seleccionamos <em>String Literal</em> en la
     lista desplegable. Aparecer&aacute; una caja con la etiqueta <em>String literal</em> en el panel central.</li>   
  
<li>Tecleamos <span class="codefrag">'Hola mundo'</span> en la funci&oacute;n <em>string literal</em> y pulsamos retorno de carro. 
      </li>
  
<li>Pinchamos con el rat&oacute;n sobre <em>paramA</em> y lo arrastramos hasta el segundo conector de entrada 
     de la funci&oacute;n <em>equal</em>.</li>
  
<li>Pinchamos sobre el conector de salida de <em>String Literal</em> y lo arrastramos hasta el otro conector de
     entrada de <em>Equal</em>.</li>
  
<li>Desde la funci&oacute;n <em>equal</em>, arrastramos el conector de salida hasta <em>Boolean Condition</em> en el panel 
     de la derecha. Si no se muestra el nodo <em>Boolean Condition</em>, simplemente haremos doble click sobre la condici&oacute;n <em>if1</em>.</li>         

</ul>
<p>La siguiente figura muestra el resultado de realizar las acciones anteriores:</p>
<p>
<img alt="Ventana de mapeado de BPEL a la que hemos a&ntilde;adido una condici&oacute;n" content-width="12cm" src="imagenes/sesion5/mapperIf.png" width="650">
</p>
<p>
<strong>A&ntilde;adimos una actividad <em>Assign</em></strong>
</p>
<p>En la vista de dise&ntilde;o, arrastramos la actividad <em>Assign1</em> existente hasta la actividad <em>if</em>.
  Colocamos esta actividad entre rombos con el icono X en el &aacute;rea
  de la actividad <em>if1</em>
</p>
<p>A continuaci&oacute;n, elegimos la actividad <em>Assign</em> de la secci&oacute;n de actividades b&aacute;sicas de la paleta, y la
  arrastramos a la derecha de la actividad <em>Assign1</em> existente.</p>
<p>
<img alt="Resultado de a&ntilde;adir una segunda asignaci&oacute;n" content-width="6cm" height="224" src="imagenes/sesion5/assign2.gif" width="220">
</p>
<p>Seleccionamos la nueva actividad <em>Assign2</em> y volvemos a utilizar la ventana de mapeado de la siguiente forma:</p>
<ul>
  
<li>Expandimos los nodos <em>Variables - inputVar - inputType</em>  y <em>Variables - outputVar - resultType</em> (en el panel de la izquierda). Veremos que en el panel de la derecha
      el nodo <em>Variables</em> no se puede expandir (est&aacute; vac&iacute;o). Para poder ver los sub-nodos hacemos doble click sobre el nodo variables, y nos aparecer&aacute;
      el sub-nodo <em>outputVar</em>, si de nuevo hacemos doble click sobre <em>outputVar</em>, nos aparecer&aacute; el sub-nodo <em>resultType</em>, y as&iacute; sucesivamente
      hasta que aparezca el nodo <em>paramA</em>
</li>
  
<li>Seleccionamos las variables <em>paramA</em> tanto del panel de la derecha como el de la izquierda. Seguidamente seleccionamos el
      grupo de funciones de <em>String</em> y elegimos (pinchamos) sobre la funci&oacute;n <em>concat</em>. Aparecer&aacute;
    la funci&oacute;n <em>Concat</em> en el panel central </li>
  
<li>Hacemos doble <em>click</em> sobre el primer campo de la funci&oacute;n <em>Concat</em>, tecleamos <span class="codefrag">'Hola '</span> 
    y pulsamos el retorno de carro</li>
  
<li>Con el bot&oacute;n izquierdo, arrastramos <em>paramA</em> del panel de la izquierda hasta el segundo 
    campo de la funci&oacute;n <em>concat</em>
</li>
  
<li>Arrastramos el rat&oacute;n desde el conector de salida de la funci&oacute;n <em>concat</em> 
    hasta <em>paramA</em> (en el panel de la derecha). Esto
     concatena la cadena 'Hola ' con la entrada y copia el resultado en la salida</li> 

</ul>
<p>Despu&eacute;s de realizar los pasos anteriores, la ventana de mapeado debe presentar el siguiente aspecto:</p>
<p>
<img alt="Concatenamos el resultado" content-width="11cm" src="imagenes/sesion5/mapperAssign2.png" width="679">
</p>
</div>


<a name="N102FF"></a><a name="Desplegamos+el+proyecto+en+el+servidor+de+aplicaciones"></a>
<h2 class="underlined_10">Desplegamos el proyecto en el servidor de aplicaciones</h2>
<div class="section">
<p>Nuestro proyecto Bpel no es directamente desplegable en el servidor de aplicaciones. Para poder hacer el despliegue 
   tenemos que incluir el "jar" de nuestro proyecto como un m&oacute;dulo JBI en una Composite Application (en nuestro caso
   ser&aacute; el proyecto <em>SynchronousSampleApplication</em>) la composite application contendr&aacute; un ensamblado de servicios
   que s&iacute; podremos desplegar en el servidor de aplicaciones.</p>
<p>Para desplegar el proyecto realizaremos los siguientes pasos:</p>
<ul>
  
<li>Compilamos nuestro proyecto Bpel (<em>SynchronousSample</em>) pinchando con bot&oacute;n derecho y seleccionando <em>Build</em>
      
</li>
  
<li>Pinchamos con el bot&oacute;n derecho sobre el proyecto <em>SynchronousSampleApplication</em> y seleccionamos
     <em>Add JBI module...</em>. Elegimos el proyecto SynchronousSample y pinchamos sobre <em>"Add Project JAR files"</em>
     
<p>
<img alt="A&ntilde;adimos el m&oacute;dulo JBI a la Composite Application" content-width="9cm" src="imagenes/sesion5/bpelDespliegue.png" width="543"></p>    
  
</li>
  
<li>Pinchamos con el bot&oacute;n derecho sobre el proyecto <em>SynchronousSampleApplication</em> y elegimos
     <em>Deploy Project</em>, seleccionando <em>Glassfish v2.x</em>. Aparecer&aacute; el mensaje <em>BUILD SUCCESSFUL</em> en la ventana <em>Output</em>
</li>      

</ul>
<p>Podemos ver el resultado del despliegue en la pesta&ntilde;a <em>Services</em>, en el servidor de aplicaciones <em>Glassfish v2.x</em>. 
   El componente <em>SynchronousSampleApplication</em> se ha desplegado como un ensamblado de servicios dentro del  
   meta-contenedor JBI.</p>
<p>
<img alt="Componente desplegado como un m&oacute;dulo JBI" content-width="7cm" src="imagenes/sesion5/bpelDespliegue2.png" width="346"></p>
</div>


<a name="N10352"></a><a name="Creamos+un+conductor+de+pruebas"></a>
<h2 class="underlined_10">Creamos un conductor de pruebas</h2>
<div class="section">
<p>Vamos a a&ntilde;adir casos de prueba para comprobar el funcionamiento del proceso BPEL que hemos creado. Para
   ello seguiremos los siguientes pasos:
</p>
<ul>
  
<li>En la ventana <em>Projects</em>, expandimos el nodo del proyecto <em>SynchronousSampleApplication</em>,
    pinchamos con el bot&oacute;n derecho sobre el nodo <em>Test</em>, y elegimos <em>New Test Case</em> del men&uacute; 
    emergente.</li>
  
<li>Vamos a darle el nombre <span class="codefrag">CasoPrueba1</span> y pinchamos en <em>Next</em>.</li>
  
<li>Expandimos <em>SynchronousSample - Source Packages</em> y seleccionamos <em>SynchronousSample.wsdl</em>.
      Pinchamos en <em>Next</em>
</li>
  
<li>Seleccionamos <em>operation1</em> y pinchamos en <em>Finish</em>. Ahora, en en &aacute;rbol del proyecto, bajo
      el nodo <em>Test</em> se ha creado la carpeta <em>CasoPrueba1</em>, que contiene dos ficheros: <em>Input</em>
      y <em>Output</em>
</li>
  
<li>Pinchamos dos veces sobre <em>Input</em> y modificamos su contenido de la siguiente forma:
      <ul>
        
<li>Localiza la siguiente l&iacute;nea en los contenidos del cuerpo: <span class="codefrag">&lt;syn:paramA&gt;?string?&lt;syn:paramA&gt;</span>
</li>
        
<li>Reemplaza <span class="codefrag">?string?</span> con <span class="codefrag">Colega</span>
</li>
        
<li>Grabamos los cambios desde <em>File-&gt;Save</em>
</li>         
      
</ul>     
  
</li>
  
<li>Pinchamos dos veces sobre <em>Output.xml</em> para examinar los contenidos. Antes de ejecutar las pruebas, este
     fichero est&aacute; vac&iacute;o. Cada vez que ejecutemos las pruebas, la salida actual se compara con los contenidos de
     <em>Output</em>. La entrada (<em>input</em>) se copia sobre <em>Output</em> cuando <em>Output</em> est&aacute; vac&iacute;o.</li>

</ul>
</div>


<a name="N103C3"></a><a name="Ejecutamos+las+pruebas+sobre"></a>
<h2 class="underlined_10">Ejecutamos las pruebas sobre SynchronousSampleApplication</h2>
<div class="section">
<p>En la ventana <em>Projects</em>, expandimos <em>SynchronousSampleApplication - Test -
   CasoPrueba1</em>. El nodo <em>CasoPrueba1</em> contiene dos ficheros XML: <em>Input</em>
   para la entrada, y <em>Output</em> para la salida esperada. Como ya hemos indicado, cada vez que se ejecuta el caso de 
   prueba, la salida actual se compara con el contenido de <em>Output</em>. Si coinciden,
   entonces superamos la prueba y veremos en la ventana <em>Output</em> el mensaje:
   <em>Nombre_Caso_Prueba passed</em>. Si no coinciden, aparecer&aacute; el mensaje <em>Nombre_Caso_Prueba
   FAILED</em>.
</p>
<p>Pinchamos con el bot&oacute;n derecho sobre el nodo <em>CasoPrueba1</em>, y elegimos <em>Run</em> 
  en el men&uacute; emergente. Nos fijamos en la ventana <em>Output</em> y veremos que el test se
  ha completado y que no pasamos el test, ya que aparece el mensaje <em>CasoPrueba1
  FAILED</em>. En este caso, como
   el fichero <em>Output</em> est&aacute; vac&iacute;o, se nos pregunta si queremos sobreescribirlo. 
   Contestamos que s&iacute;. Despu&eacute;s de la primera ejecuci&oacute;n, el fichero <em>Output.xml</em> ya no est&aacute;
   vac&iacute;o, por lo que su contenido ser&aacute; preservado y no ser&aacute; sobreescrito por el nuevo resultado.
   Si ejecutamos de nuevo el test, podremos ver el mensaje: <em>CasoPrueba1 passed</em>.
</p>
<p>
<img alt="Casos de prueba para nuestro proyecto Bpel" content-width="8cm" src="imagenes/sesion5/projects.png" width="487"></p>
</div>


<a name="N10409"></a><a name="Cambios+en+la+l%C3%B3gica+de+negocio"></a>
<h2 class="underlined_10">Cambios en la l&oacute;gica de negocio</h2>
<div class="section">
<p>Modifica la l&oacute;gia del proceso bpel de forma que: si la cadena de entrada es null, devuelva el mensaje
   de error "ERROR: Valor null". Si la cadena de entrada no es null y es "Hola mundo", entonces 
   debe devolver la misma cadena como salida, y si no es igual a "Hola Mundo" debe devolver "Hola cadena",
   siendo "cadena" el valor de la cadena de entrada. (0,75p)</p>
<p>A&ntilde;ade dos casos de prueba nuevos, con nombres <em>TestHolaMundo</em> y <em>TestNull</em>. 
   Para el primer test, el valor de la cadena de entrada debe ser "Hola mundo", para el segundo test,
   el valor de entrada debe ser "null".  (0,75p)</p>
<p>
<strong>Notas de ayuda:</strong>
</p>
<ul>
  
<li>Cuando a&ntilde;adamos el nuevo "if" en la vista de dise&ntilde;o, y pasemos a la vista de mapeado, en el panel 
      de la derecha vemos que &uacute;nicamente nos aparece el nodo "if". Si hacemos doble click sobre &eacute;l, nos
      generar&aacute; el nuevo sub-elemento "boolean condition"</li>
  
<li>Una forma de comprobar si un elemento es "null" es comprobando si el n&uacute;mero de elementos del nodo correspondiente es
      cero (men&uacute; "Node", funci&oacute;n "Count"). La siguiente figura ilustra la comprobaci&oacute;n de que la cadena de caracteres de
      entrada no sea "null".
      <p>
<img alt="Comprobaci&oacute;n de entrada con valor NULL" content-width="11cm" src="imagenes/sesion5/mapperNULL.png" width="650"></p>
  
</li>
  
<li>Despu&eacute;s de hacer las modificaciones en la l&oacute;gica del proceso bpel, hay que compilar de nuevo el proyecto Bpel, borrar el componente
      JBI de la Composite Application (<em>SynchronousSample.jar</em>) con bot&oacute;n derecho seleccionando "Delete",
      a continuaci&oacute;n a&ntilde;adimos de nuevo el componente JBI, y volvemos a desplegar <em>SynchronousSampleApplication</em>
</li>  
  
<li>En el mensaje soap de entrada para el caso de prueba <em>TestNull</em>, simplemente "borra" la l&iacute;nea 
      <span class="codefrag">&lt;syn:paramA&gt;?string?&lt;/syn:paramA&gt;</span> del fichero <em>input.xml</em>
</li>    
    

</ul>
</div>

<p class="pageBreakAfter"></p>


</div>
<div class="clearboth">&nbsp;</div>
</div>
<div id="footer">
<div class="lastmodified">
<script type="text/javascript"><!--
document.write("<text>Last Published:</text> " + document.lastModified);
//  --></script>
</div>
<div class="copyright">
        Copyright &copy;
         2012-2013 Dept. Ciencia de la Computaci&oacute;n e IA</div>
</div>
<script type="text/javascript">
     
         SyntaxHighlighter.defaults['toolbar'] = false;
         SyntaxHighlighter.autoloader(
  		     'java                   skin/highlight/shBrushJava.js',
  		     'xml xhtml xslt html    skin/highlight/shBrushXml.js',
  		     'js jscript javascript  skin/highlight/shBrushJScript.js',
  		     'groovy                 skin/highlight/shBrushGroovy.js',
  		     'bash shell             skin/highlight/shBrushBash.js',
  		     'php                    skin/highlight/shBrushPhp.js',
  		     'css                    skin/highlight/shBrushCss.js',
  		     'sql                    skin/highlight/shBrushSql.js',
  		     'objc                   skin/highlight/shBrushObjC.js',
  		     'cpp c                  skin/highlight/shBrushCpp.js',
  		     'text plain             skin/highlight/shBrushPlain.js'
         );
         SyntaxHighlighter.all();
     </script><a href="skin/highlight/shBrushJava.js"></a><a href="skin/highlight/shBrushXml.js"></a><a href="skin/highlight/shBrushJScript.js"></a><a href="skin/highlight/shBrushGroovy.js"></a><a href="skin/highlight/shBrushBash.js"></a><a href="skin/highlight/shBrushPhp.js"></a><a href="skin/highlight/shBrushCss.js"></a><a href="skin/highlight/shBrushSql.js"></a><a href="skin/highlight/shBrushObjC.js"></a><a href="skin/highlight/shBrushCpp.js"></a><a href="skin/highlight/shBrushPlain.js"></a>
</body>
</html>
